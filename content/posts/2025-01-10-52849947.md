---
layout: post
title: "Cobertura-统计多模块maven项目测试覆盖率"
date: 2025-01-10 11:51:58 +0800
description: "在多模块项目中，我们往往会把源代码放在一个模块，测试代码放在另一个模块（出于项目分解管理或配置文件的"
keywords: "cobertura 多模块"
categories: ['工具软件Ide']
tags: ['覆盖率', '测试', '单元测试', 'Maven']
artid: "52849947"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=52849947
    alt: "Cobertura-统计多模块maven项目测试覆盖率"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=52849947
featuredImagePreview: https://bing.ee123.net/img/rand?artid=52849947
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Cobertura 统计多模块maven项目测试覆盖率
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      <span style="font-size:14px">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      <span style="font-size:14px">
       Cobertura 统计单元测试覆盖率的机制：运行类，并在一个log文件中记录哪一行被执行，然后将源代码和log文件进行比对。
      </span>
     </span>
    </p>
    <p>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      <strong>
       <span style="font-size:14px">
        <br/>
       </span>
      </strong>
     </span>
    </p>
    <p>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      <strong>
       <span style="font-size:14px">
        1. 简单的情况：单模块maven项目
       </span>
      </strong>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       项目结构
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <img alt="" src="https://img-blog.csdn.net/20161018162010592?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
        <br/>
       </img>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        源代码 src/main/java/se/sigma/calculator/
        <span class="skimlinks-unlinked">
         Calculator.java
        </span>
       </span>
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
        </span>
       </span>
      </span>
     </span>
    </p>
    <pre><code class="language-java">package se.sigma.calculator;

public class Calculator {
    public int nextFibonacci(int a, int b) {
        return a + b;
    }
}</code></pre>
    单元测试
    <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
     src/test/java/se/sigma/calculator/
     <span class="skimlinks-unlinked">
      CalculatorTest.java
     </span>
    </span>
    <p>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
        </span>
       </span>
      </span>
     </span>
    </p>
    <pre><code class="language-java">package se.sigma.calculator;

import org.junit.Test;

import static org.hamcrest.core.Is.is;
import static org.junit.Assert.assertThat;

public class CalculatorTest {

    @Test
    public void shouldCalculateFibonacci() {
        Calculator calculator = new Calculator();
        int expected = 13;
        int actual = calculator.nextFibonacci(5, 8);

        assertThat(actual, is(expected));
    }
}
</code></pre>
    <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
     <span class="skimlinks-unlinked">
     </span>
    </span>
    <p>
    </p>
    <p>
     我们添加maven cobetura插件
    </p>
    pom.xml
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
          <span class="skimlinks-unlinked">
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;one-module-example&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;/properties&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;cobertura-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.5.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;process-classes&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;cobertura&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.10&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
    关键部分是
    <span style="font-family:monospace; line-height:19px">
     cobertura-maven-plugin，它在项目的
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      process-classes阶段被执行，生成的报告如下所示
     </span>
    </span>
    <p>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
          <span class="skimlinks-unlinked">
           <span style="font-family:monospace; line-height:19px">
            <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
             <img alt="" src="https://img-blog.csdn.net/20161018162459002?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
              <br/>
             </img>
            </span>
           </span>
           <br/>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         上图显示覆盖率是100%，两行代码都被执行到。代码没有分支，复杂度是1。
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         点击进入
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
          package
         </span>
         <span class="skimlinks-unlinked" style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
          se.sigma.calculator里面会得到如下结果图：
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <img alt="" src="https://img-blog.csdn.net/20161018163657946?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
        <br/>
       </img>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       点击进入
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
        Calculator 这个类会得到：
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
        <img alt="" src="https://img-blog.csdn.net/20161018163736310?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
         <br/>
        </img>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       cobetura不仅会记录每行是否被执行到，还会记录每行被执行的次数（hits）。
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace; font-size:14px; color:#333333">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
        <span class="skimlinks-unlinked">
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
          <strong>
           2. 复杂的情况：多模块maven项目
          </strong>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace; font-size:14px; color:#333333">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
        <span class="skimlinks-unlinked">
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
          <strong>
           <br/>
          </strong>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       在多模块项目中，我们往往会把源代码放在一个模块，测试代码放在另一个模块（出于项目分解管理或配置文件的原因）。而maven的模块是一个执行完再执行另一个，导致cobetura的代码覆盖率统计出现问题。
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       现有多模块项目结构如下：
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
          <img alt="" src="https://img-blog.csdn.net/20161018164817731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
           <br/>
          </img>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
        </span>
       </span>
      </span>
     </span>
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      功能源代码放在product模块，单元测试代码放在test模块。java文件的内容和前面的一样。test模块添加了product模块的依赖，这样就可以import
      <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
       Calculator这个类。
      </span>
     </span>
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     根项目的pom.xml文件:
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;multi-module-failing-example&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;modules&gt;
        &lt;module&gt;product&lt;/module&gt;
        &lt;module&gt;test&lt;/module&gt;
    &lt;/modules&gt;
    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;/properties&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;cobertura-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.5.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;post-integration-test&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;cobertura&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.10&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      &lt;
     </span>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      modules
     </span>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      &gt;标签里包含它的两个模块 product 和test。
     </span>
     同样加上了 cobertura-maven-plugin来生成测试覆盖率报告.
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      product模块的pom.xml文件:
     </span>
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
        &lt;artifactId&gt;multi-module-failing-example&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;calculator&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/project&gt;</code></pre>
    <br/>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
    </p>
    <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
     test模块的pom.xml文件:
    </span>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     <em>
      <span class="skimlinks-unlinked">
      </span>
     </em>
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
        &lt;artifactId&gt;multi-module-failing-example&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;calculator-test&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
            &lt;artifactId&gt;calculator&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     依赖 product 的源代码，才能引用 Calculator并调用它的方法。
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     测试结果如下：
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     <img alt="" src="https://img-blog.csdn.net/20161018165801307?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    可以看到覆盖率是0，而我们知道正确的结果应该是100%。
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
        </span>
       </span>
      </span>
     </span>
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     点击进入package里面，显示Calculator.java没有被执行
    </p>
    <p style='line-height:19px; margin:15px 15px 2px; font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     <img alt="" src="https://img-blog.csdn.net/20161018165940941?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
     点击进入
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      Calculator.java
     </span>
     里面，显示方法代码没有被执行
    </span>
    <p>
     <img alt="" src="https://img-blog.csdn.net/20161018170118738?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
      <br/>
     </img>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       maven的项目结构是固定的，一个java模块生成一个target文件，各模块是隔离的，因此无法跨模块比对运行的测试类和源代码文件。这时我们想到另一种项目管理工具Ant。Ant与maven相比，它的灵活在于可以让用户自己指定源码的位置和编译后字节码的存放位置，如此又可以达到单模块maven项目的效果。
      </span>
     </span>
    </p>
    <p>
     <span style="line-height:19px">
      <span style="line-height:19px">
       <span class="skimlinks-unlinked">
       </span>
      </span>
     </span>
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px; margin:15px 15px 2px'>
     <strong>
      <span style="font-size:18px">
       maven+Ant
      </span>
     </strong>
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     <span style="font-size:11px">
      在前面工程结构的基础上，我们在根目录加上Ant的
     </span>
     <span class="skimlinks-unlinked" style="font-size:11px">
      build.xml
     </span>
     <span style="font-size:11px">
      文件。
     </span>
    </p>
    <pre style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; background-color:rgb(255,255,255)'>multi-module-example
|-- <span class="skimlinks-unlinked">build.xml</span>
|-- <span class="skimlinks-unlinked">pom.xml</span>
|-- product
|   |-- <span class="skimlinks-unlinked">pom.xml</span>
|   `-- src
|       `-- main
|           `-- java
|               `-- se
|                   `-- sigma
|                       `-- calculator
|                           `-- <span class="skimlinks-unlinked">Calculator.java</span>
`-- test
    |-- <span class="skimlinks-unlinked">pom.xml</span>
    `-- src
        `-- test
            `-- java
                `-- se
                    `-- sigma
                        `-- calculator
                            `-- <span class="skimlinks-unlinked">CalculatorTest.java</span></pre>
    <pre style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; background-color:rgb(255,255,255)'><span class="skimlinks-unlinked">
</span></pre>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     父项目根目录pom.xml:
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;multi-module-example&lt;/artifactId&gt;
    &lt;version&gt;1.1&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;modules&gt;
        &lt;module&gt;product&lt;/module&gt;
        &lt;module&gt;test&lt;/module&gt;
    &lt;/modules&gt;
    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
    &lt;/properties&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.4.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;filesets&gt;
                        &lt;fileset&gt;
                            &lt;directory&gt;.&lt;/directory&gt;
                            &lt;includes&gt;
                                &lt;include&gt;**/*.ser&lt;/include&gt;
                            &lt;/includes&gt;
                        &lt;/fileset&gt;
                    &lt;/filesets&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.10&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
    <br/>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     maven-clean-plugin是用来清楚之前生成的target文件（.ser结尾的是cobetura生成的报告）。
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      这里不用再添加maven-cobetura插件，cobertura需要单独下载，在Ant 脚本中引用。
     </span>
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      Cobertura.下载地址
     </span>
     <a href="http://cobertura.sourceforge.net/download.html" rel="nofollow noopener noreferrer" style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px; color:rgb(160,82,45)' target="_blank">
      http://cobertura.sourceforge.net/download.html
     </a>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      。我这里用的是Cobertura 1.9.4.1下载后解压到
     </span>
     <code style="line-height:19px">
      /Users/tsu/java/cobertura-1.9.4.1
     </code>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      ，你可以修改成其他目录，但是要注意和
     </span>
     <code style="line-height:19px">
      build.xml
     </code>
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      中指定的路径一致。
     </span>
     <br/>
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     Ant构建脚本build.xml：
    </p>
    <pre><code class="language-html">&lt;project&gt;
    &lt;target name="instrument"&gt;
        &lt;!-- Add all modules that should be included below --&gt;
        &lt;!-- &lt;antcall target="instrumentAModule"&gt;
            &lt;param name="module" value="MODULE_NAME_TO_REPLACE"/&gt;
        &lt;/antcall&gt; --&gt;
        &lt;antcall target="instrumentAModule"&gt;
            &lt;param name="module" value="product"/&gt;
        &lt;/antcall&gt;
    &lt;/target&gt;

    &lt;target name="report" depends="merge"&gt;
        &lt;property name="src.dir" value="src/main/java/"/&gt;
        &lt;cobertura-report datafile="sum.ser"
                          format="html"
                          destdir="./target/report"&gt;
            &lt;!-- Add all modules that should be included below --&gt;
            &lt;!-- fileset dir="./MODULE_NAME_TO_REPLACE/${src.dir}"/ --&gt;
            &lt;fileset dir="./product/${src.dir}"/&gt;
        &lt;/cobertura-report&gt;
    &lt;/target&gt;

    &lt;target name="merge"&gt;
        &lt;cobertura-merge datafile="sum.ser"&gt;
            &lt;fileset dir="."&gt;
                &lt;include name="**/cobertura.ser"/&gt;
            &lt;/fileset&gt;
        &lt;/cobertura-merge&gt;
    &lt;/target&gt;

    &lt;target name="instrumentAModule"&gt;
        &lt;property name="classes.dir" value="target/classes"/&gt;
        &lt;cobertura-instrument todir="./${module}/${classes.dir}"&gt;
            &lt;fileset dir="./${module}/target/classes"&gt;
                &lt;include name="**/*.class"/&gt;
            &lt;/fileset&gt;
        &lt;/cobertura-instrument&gt;
    &lt;/target&gt;

    &lt;property environment="env"/&gt;
    &lt;property name="COBERTURA_HOME" value="/Users/tsu/java/cobertura-1.9.4.1"/&gt;
    &lt;property name="cobertura.dir" value="${COBERTURA_HOME}"/&gt;
    &lt;path id="cobertura.classpath"&gt;
        &lt;fileset dir="${cobertura.dir}"&gt;
            &lt;include name="cobertura.jar"/&gt;
            &lt;include name="lib/**/*.jar"/&gt;
        &lt;/fileset&gt;
    &lt;/path&gt;
    &lt;taskdef classpathref="cobertura.classpath" resource="tasks.properties"/&gt;
&lt;/project&gt;</code></pre>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     两个重要的&lt;targets&gt;是：
    </p>
    <ul style="font-family:Simsun; font-size:14px">
     <li style='font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; margin-top:7px; margin-bottom:7px'>
      instrument
     </li>
     <li style='font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; margin-top:7px; margin-bottom:7px'>
      report
     </li>
    </ul>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     <code>
      instrument
     </code>
     用
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      Cobertura instrumentation来执行
     </span>
     编译类文件。
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     <code>
      report
     </code>
     将执行的测试类和源代码组合起来，生成覆盖率报告。
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     product模块的pom.xml和之前一致 ：
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
        &lt;artifactId&gt;multi-module-example&lt;/artifactId&gt;
        &lt;version&gt;1.1&lt;/version&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;calculator&lt;/artifactId&gt;
    &lt;version&gt;1.1&lt;/version&gt;
&lt;/project&gt;</code></pre>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     test
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      模块的pom.xml：
     </span>
    </p>
    <pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
        &lt;artifactId&gt;multi-module-example&lt;/artifactId&gt;
        &lt;version&gt;1.1&lt;/version&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
    &lt;artifactId&gt;calculator-test&lt;/artifactId&gt;
    &lt;version&gt;1.1&lt;/version&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;se.thinkcode&lt;/groupId&gt;
            &lt;artifactId&gt;calculator&lt;/artifactId&gt;
            &lt;version&gt;1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.sourceforge.cobertura&lt;/groupId&gt;
            &lt;artifactId&gt;cobertura&lt;/artifactId&gt;
            &lt;version&gt;1.9.4.1&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
    <br/>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     test 模块需要添加 Cobertura依赖，这样在test
     <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; line-height:19px'>
      phase才能记录执行的踪迹
     </span>
     。
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
    </p>
    <p style='margin:15px 15px 2px; font-size:11px; line-height:19px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     项目的执行有以下四步：
    </p>
    <ol style="line-height:19px; font-family:Simsun; font-size:14px">
     <li style='font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; margin-top:7px; margin-bottom:7px'>
      Compile all code
     </li>
     <li style='font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; margin-top:7px; margin-bottom:7px'>
      Instrument the code
     </li>
     <li style='font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; margin-top:7px; margin-bottom:7px'>
      Execute all tests
     </li>
     <li style='font-size:11px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; margin-top:7px; margin-bottom:7px'>
      Consolidate and build the report
     </li>
    </ol>
    <p style='margin:15px 15px 2px; font-size:11px; line-height:19px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace'>
     即顺序执行下面的四条命令：
    </p>
    <pre style='font-size:11px; line-height:19px; font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; background-color:rgb(255,255,255)'>	<span style="color:#ff0000"><strong>mvn clean compile
	ant instrument
	mvn test
	ant report</strong></span></pre>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     生成的报告：
    </p>
    <p style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px; margin:15px 15px 2px'>
     <img alt="" src="https://img-blog.csdn.net/20161018173919940?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" style="font-size:11px"/>
    </p>
    <img alt="" src="https://img-blog.csdn.net/20161018173956315?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"/>
    <br/>
    <p>
     <span style="line-height:19px">
      <span class="skimlinks-unlinked">
       <img alt="" src="https://img-blog.csdn.net/20161018174013784?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"/>
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
          <br/>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-family:Lucida Sans Unicode,Trebuchet MS,Verdana,monospace">
      <span style="line-height:19px">
       <span style='font-family:"Lucida Sans Unicode","Trebuchet MS",Verdana,monospace; font-size:11px; line-height:19px'>
        <span class="skimlinks-unlinked">
         <br/>
        </span>
       </span>
      </span>
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f7368796d6931393931:2f61727469636c652f64657461696c732f3532383439393437" class_="artid" style="display:none">
 </p>
</div>


