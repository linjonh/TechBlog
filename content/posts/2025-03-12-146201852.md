---
layout: post
title: "Gone-v2-Gin-组件,在gin中使用依赖注入"
date: 2025-03-12 12:36:51 +0800
description: "`gone-gin` 是一个基于 [gin-gonic/gin](https://github.com/gin-gonic/gin) 的 Web 框架封装，为 Gone 框架提供 HTTP 服务支持。它提供了路由管理、中间件处理、HTTP 注入、SSE（Server-Sent Events）等功能，使得在 Gone 框架中开发 Web 应用更加便捷。"
keywords: "Gone v2 Gin 组件，在gin中使用依赖注入"
categories: ['Gone']
tags: ['依赖注入', 'Web', 'Gone', 'Gin']
artid: "146201852"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146201852
    alt: "Gone-v2-Gin-组件,在gin中使用依赖注入"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146201852
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146201852
cover: https://bing.ee123.net/img/rand?artid=146201852
image: https://bing.ee123.net/img/rand?artid=146201852
img: https://bing.ee123.net/img/rand?artid=146201852
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Gone v2 Gin 组件，在gin中使用依赖注入
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      项目地址：
      <a href="https://github.com/gone-io/gone">
       https://github.com/gone-io/gone
      </a>
     </p>
     <p>
      原文地址：
      <a href="https://github.com/gone-io/goner/blob/main/gin/README.md">
       https://github.com/gone-io/goner/blob/main/gin/README.md
      </a>
     </p>
    </blockquote>
    <h2>
     <a id="Gone_v2_Gin_gin_3">
     </a>
     Gone v2 Gin 组件，在gin中使用依赖注入
    </h2>
    <p>
    </p>
    <p>
    </p>
    <p>
     <code>
      gone-gin
     </code>
     是一个基于
     <a href="https://github.com/gin-gonic/gin">
      gin-gonic/gin
     </a>
     的 Web 框架封装，为 Gone 框架提供 HTTP 服务支持。它提供了路由管理、中间件处理、HTTP 注入、SSE（Server-Sent Events）等功能，使得在 Gone 框架中开发 Web 应用更加便捷。
    </p>
    <h3>
     <a id="_8">
     </a>
     功能特性
    </h3>
    <ul>
     <li>
      完整的路由管理
     </li>
     <li>
      灵活的中间件支持
     </li>
     <li>
      HTTP 参数注入
     </li>
     <li>
      SSE（Server-Sent Events）支持
     </li>
     <li>
      统一的错误处理
     </li>
     <li>
      请求限流
     </li>
     <li>
      健康检查
     </li>
     <li>
      请求/响应日志记录
     </li>
     <li>
      分布式追踪支持
     </li>
    </ul>
    <h3>
     <a id="_20">
     </a>
     安装
    </h3>
    <pre><code class="prism language-bash">go get github.com/gone-io/goner/gin
</code></pre>
    <h3>
     <a id="_26">
     </a>
     快速开始
    </h3>
    <h4>
     <a id="1__28">
     </a>
     1. 基础路由
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
   <span class="token string">"github.com/gone-io/gone/v2"</span>
   <span class="token string">"github.com/gone-io/goner"</span>
   <span class="token string">"github.com/gone-io/goner/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> HelloController <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
   gone<span class="token punctuation">.</span>Flag
   gin<span class="token punctuation">.</span>IRouter <span class="token string">`gone:"*"`</span> <span class="token comment">// 注入路由器</span>
<span class="token punctuation">}</span>

<span class="token comment">// Mount 实现 gin.Controller 接口</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>HelloController<span class="token punctuation">)</span> <span class="token function">Mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>MountError <span class="token punctuation">{<!-- --></span>
   h<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>hello<span class="token punctuation">)</span> <span class="token comment">// 注册路由</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>HelloController<span class="token punctuation">)</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> <span class="token string">"Hello, Gone!"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   gone<span class="token punctuation">.</span>
      <span class="token function">Load</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>HelloController<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
      <span class="token function">Loads</span><span class="token punctuation">(</span>goner<span class="token punctuation">.</span>GinLoad<span class="token punctuation">)</span><span class="token punctuation">.</span>
      <span class="token function">Serve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2_HTTP__62">
     </a>
     2. HTTP 参数注入
    </h4>
    <p>
     详细说明请参考
     <a href="https://github.com/gone-io/goner/blob/main/gin/docs/http-inject.md">
      HTTP 注入说明
     </a>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> UserRequest <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    ID        <span class="token builtin">int64</span>  <span class="token string">`http:"param=id"`</span> <span class="token comment">// 路径参数</span>
    Name      <span class="token builtin">string</span> <span class="token string">`http:"query=name"`</span> <span class="token comment">// 查询参数</span>
    Token     <span class="token builtin">string</span> <span class="token string">`http:"header=token"`</span> <span class="token comment">// 请求头</span>
    SessionID <span class="token builtin">string</span> <span class="token string">`http:"cookie=session-id"`</span> <span class="token comment">// Cookie</span>
    Data      User   <span class="token string">`http:"body"`</span> <span class="token comment">// 请求体</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> UserController <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    gone<span class="token punctuation">.</span>Flag
    gin<span class="token punctuation">.</span>IRouter <span class="token string">`gone:"*"`</span>
    http<span class="token punctuation">.</span>HttInjector <span class="token string">`gone:"http"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>UserController<span class="token punctuation">)</span> <span class="token function">Mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>MountError <span class="token punctuation">{<!-- --></span>
    u<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/users/:id"</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>createUser<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>UserController<span class="token punctuation">)</span> <span class="token function">createUser</span><span class="token punctuation">(</span>req UserRequest<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// req 中的字段会自动从 HTTP 请求中注入</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="3contextSuccess_92">
     </a>
     3.直接返回数据，不需要调用
     <code>
      context.Success
     </code>
    </h4>
    <h3>
     <a id="_94">
     </a>
     中间件使用
    </h3>
    <h4>
     <a id="1__96">
     </a>
     1. 系统中间件
    </h4>
    <p>
     系统已内置了一些常用中间件，包括：
    </p>
    <ul>
     <li>
      请求日志记录
     </li>
     <li>
      限流
     </li>
     <li>
      健康检查
     </li>
     <li>
      分布式追踪
     </li>
    </ul>
    <h4>
     <a id="2__105">
     </a>
     2. 自定义中间件
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> CustomMiddleware <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    gone<span class="token punctuation">.</span>Flag
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>CustomMiddleware<span class="token punctuation">)</span> <span class="token function">Process</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 前置处理</span>
    ctx<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 后置处理</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="SSEServerSent_Events_121">
     </a>
     SSE（Server-Sent Events）
    </h3>
    <p>
     支持服务器发送事件：
    </p>
    <pre><code class="prism language-go"><span class="token comment">// SSEController 是一个示例控制器，展示如何使用channel返回SSE流</span>
<span class="token keyword">type</span> SSEController <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	gone<span class="token punctuation">.</span>Flag
	gone<span class="token punctuation">.</span>Logger <span class="token string">`gone:"gone-logger"`</span>
	router gin<span class="token punctuation">.</span>IRouter <span class="token string">`gone:"*"`</span>
<span class="token punctuation">}</span>

<span class="token comment">// Mount 实现Controller接口，挂载路由</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>SSEController<span class="token punctuation">)</span> <span class="token function">Mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>GinMountError <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 注册路由</span>
	c<span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/api/sse/events"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>streamEvents<span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// streamEvents 返回一个channel，系统会自动将其转换为SSE流</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>SSEController<span class="token punctuation">)</span> <span class="token function">streamEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> any<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建一个channel用于发送事件</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>

	<span class="token comment">// 启动一个goroutine来发送事件</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token comment">// 确保在函数结束时关闭channel</span>

		<span class="token comment">// 发送10个事件</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 创建事件数据</span>
			eventData <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>any<span class="token punctuation">{<!-- --></span>
				<span class="token string">"id"</span><span class="token punctuation">:</span>      i<span class="token punctuation">,</span>
				<span class="token string">"message"</span><span class="token punctuation">:</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"这是第%d个事件"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">"time"</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>RFC3339<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 发送事件到channel</span>
			ch <span class="token operator">&lt;-</span> eventData

			<span class="token comment">// 每秒发送一个事件</span>
			time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 发送一个错误事件示例</span>
		ch <span class="token operator">&lt;-</span> gone<span class="token punctuation">.</span><span class="token function">NewParameterError</span><span class="token punctuation">(</span><span class="token string">"这是一个错误事件示例"</span><span class="token punctuation">)</span>

		<span class="token comment">// 等待一秒后结束</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> ch<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_177">
     </a>
     配置说明
    </h3>
    <h4>
     <a id="_179">
     </a>
     服务器基础配置
    </h4>
    <pre><code class="prism language-properties"># 服务器基本配置
server.port=8080                     # 服务器端口，默认8080
server.host=0.0.0.0                  # 服务器主机地址，默认0.0.0.0
server.mode=release                  # 服务器模式，可选：debug, release, test，默认release
server.max-wait-before-stop=5s       # 服务器关闭前最大等待时间，默认5秒
server.network=tcp                   # 服务器网络类型，默认tcp
server.address=                      # 服务器地址，格式为host:port，如果设置了此项，则忽略host和port
server.html-tpl-pattern=             # HTML模板文件匹配模式，用于加载HTML模板
</code></pre>
    <h4>
     <a id="_192">
     </a>
     日志配置
    </h4>
    <pre><code class="prism language-properties"># 日志配置
server.log.format=console                # 日志格式，默认console
server.log.show-request-time=true        # 是否显示请求时间，默认true
server.log.show-request-log=true         # 是否显示请求日志，默认true
server.log.data-max-length=0             # 日志数据最大长度，0表示不限制，默认0
server.log.request-id=true               # 是否记录请求ID，默认true
server.log.remote-ip=true                # 是否记录远程IP，默认true
server.log.request-body=true             # 是否记录请求体，默认true
server.log.user-agent=true               # 是否记录User-Agent，默认true
server.log.referer=true                  # 是否记录Referer，默认true
server.log.show-response-log=true        # 是否显示响应日志，默认true

# 请求体日志内容类型配置
server.log.show-request-body-for-content-types=application/json;application/xml;application/x-www-form-urlencoded

# 响应体日志内容类型配置
server.log.show-response-body-for-content-types=application/json;application/xml;application/x-www-form-urlencoded
</code></pre>
    <h4>
     <a id="_214">
     </a>
     限流配置
    </h4>
    <pre><code class="prism language-properties"># 限流配置
server.req.enable-limit=false        # 是否启用请求限流，默认false
server.req.limit=100                 # 每秒请求限制数，默认100
server.req.limit-burst=300           # 突发请求限制数，默认300
server.req.x-request-id-key=X-Request-Id  # 请求ID的Header键名
server.req.x-trace-id-key=X-Trace-Id      # 追踪ID的Header键名
</code></pre>
    <h4>
     <a id="_225">
     </a>
     健康检查与追踪配置
    </h4>
    <pre><code class="prism language-properties"># 健康检查
server.health-check=/health          # 健康检查路径，默认为/health

# 追踪配置
server.use-tracer=true               # 是否使用追踪，默认true
server.is-after-proxy=false          # 是否在代理后面，默认false
</code></pre>
    <h4>
     <a id="_236">
     </a>
     代理与响应配置
    </h4>
    <pre><code class="prism language-properties"># 代理统计
server.proxy.stat=false              # 是否启用代理统计，默认false

# 响应包装
server.return.wrapped-data=true      # 是否包装响应数据，默认true
</code></pre>
    <h3>
     <a id="_246">
     </a>
     最佳实践
    </h3>
    <ol>
     <li>
      <p>
       路由管理
      </p>
      <ul>
       <li>
        按业务模块划分控制器
       </li>
       <li>
        使用路由分组管理相关接口
       </li>
       <li>
        合理使用 HTTP 方法（GET、POST、PUT、DELETE 等）
       </li>
      </ul>
     </li>
     <li>
      <p>
       参数注入
      </p>
      <ul>
       <li>
        合理使用 HTTP 注入标签（param、query、header、cookie、body）
       </li>
       <li>
        一个请求只能注入一次 body
       </li>
       <li>
        为注入的参数添加验证规则
       </li>
      </ul>
     </li>
     <li>
      <p>
       错误处理
      </p>
      <ul>
       <li>
        使用
        <code>
         gone.Error
        </code>
        统一处理错误
       </li>
       <li>
        在中间件中统一处理异常
       </li>
       <li>
        为不同类型的错误定义清晰的错误码
       </li>
      </ul>
     </li>
     <li>
      <p>
       性能优化
      </p>
      <ul>
       <li>
        合理配置限流参数
       </li>
       <li>
        适当配置日志级别
       </li>
       <li>
        使用连接池管理资源
       </li>
      </ul>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f7761697464656e672f:61727469636c652f64657461696c732f313436323031383532" class_="artid" style="display:none">
 </p>
</div>


