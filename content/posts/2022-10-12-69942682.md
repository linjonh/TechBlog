---
layout: post
title: "云应用数据备份及迁移方案"
date: 2022-10-12 15:19:35 +0800
description: "数据备份0x00 前言目前公司在测试好雨科技的云帮系统，由于其他业务需求，需要将云帮中的某个应用迁移"
keywords: "云平台迁移方案"
categories: ['测试', '好雨云']
tags: ['迁移', '数据备份', '数据中心', '应用', '云平台']
artid: "69942682"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=69942682
    alt: "云应用数据备份及迁移方案"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=69942682
featuredImagePreview: https://bing.ee123.net/img/rand?artid=69942682
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     云应用数据备份及迁移方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3 id="数据备份">
     数据备份
    </h3>
    <h3 id="0x00-前言">
     0x00 前言
    </h3>
    <p>
     目前公司在测试好雨科技的云帮系统，由于其他业务需求，需要将云帮中的某个应用迁移到其他数据中心。花了半天的时间梳理了一下，如何在好雨云平台迁移备份应用数据。好雨云平台应用主要以镜像和持久化数据两个部分构成。故而迁移备份的途径主要就有两大类。
    </p>
    <h3 id="0x01-持久化数据备份">
     0x01 持久化数据备份
    </h3>
    <h4 id="0x0100-基于sftp">
     0x0100 基于sftp
    </h4>
    <p>
     新建一个sftp应用，然后挂载相关应用（想备份或恢复数据的应用）后重启sftp应用。
     <br/>
     本地用ftp工具进行登录操作，和其他ftp操作一样。
     <br/>
     ftp连接成功后会列出当前目录即mysql挂载在ftp上的目录。路径在/mnt/应用id下。根据需求备份所需的文件。
     <br/>
     命令行登录管理：
    </p>
    <pre class="prettyprint"><code class="hljs livecodeserver">sftp -P port user@sftp.domain
<span class="hljs-comment">#下载文件</span>
<span class="hljs-built_in">get</span> [-Ppr] remote  [<span class="hljs-built_in">local</span>]
<span class="hljs-comment">#上传文件</span>
<span class="hljs-built_in">put</span> [-Ppr] <span class="hljs-built_in">local</span> [remote]</code></pre>
    <p>
     接下来谈谈需要备份的主要三大类应用
    </p>
    <h4 id="0x0101-源码构建类应用-dockerfile构建类应用">
     0x0101 源码构建类应用&amp; Dockerfile构建类应用
    </h4>
    <p>
     这类应用备份比较简单,在应用高级选项里查看持久化数据相关设置，默认挂载在/app目录下。
     <br/>
     通常只需sftp服务挂载应用后重启即可用ftp进行登录操作。
     <br/>
     和源码构建类似，相对灵活了一些。
    </p>
    <h4 id="0x0110-数据库类应用">
     0x0110 数据库类应用
    </h4>
    <p>
     公司主要用的是mysql数据库，这里就以mysql为例。
    </p>
    <ul>
     <li>
      使用phpMyAdmin进行操作
     </li>
    </ul>
    <p>
     新建一个phpMyAdmin应用，然后关联mysql数据库后重启应用。在phpMyAdmin页面点击访问按钮访问web界面。密码见MySQL依赖页。
    </p>
    <p>
     导出功能可以将数据从数据库中导出本地／导入功能将本地数据库文件导入到数据库服务中。设置里的导入和导出，用于管理数据库相关设置文件。
    </p>
    <ul>
     <li>
      使用本地MySQL工具连接管理
     </li>
    </ul>
    <p>
     在高级设置里启用对外访问，本地使用客户端进行管理。
     <br/>
     使用Mysqldump进行逻辑备份。mysqldump作为重要的MySQL备份工具，功能相当强大。备份参数、恢复策略，需要仔细研究,这里仅列出常用的命令。
    </p>
    <pre class="prettyprint"><code class="hljs vala"><span class="hljs-preprocessor">#备份数据库：</span>
<span class="hljs-preprocessor">#备份单个数据库或单个数据库中的指定表：</span>
mysqldump [OPTIONS] database [tb1] [tb2]…
<span class="hljs-preprocessor">#备份多个数据库：</span>
mysqldump [OPTIONS] –databases [OPTIONS] DB1 [DB2 DB3...]
<span class="hljs-preprocessor">#备份所有数据库：</span>
mysqldump [OPTIONS] –all-databases [OPTIONS]
<span class="hljs-preprocessor">#如果开启了外部访问可以直接：</span>
mysqldump -uuser -ppasswd -h mysql.domain -P port --all-databases &gt; sql.dump
<span class="hljs-preprocessor">#从备份文件恢复到数据库</span>
mysql [database name] &lt; [backup file name]
mysql -uuser -ppasswd -h mysql.domain -P port -D DB_name &lt;  sql.dump</code></pre>
    <p>
     最后，谈一谈如何迁移备份镜像。
    </p>
    <h4 id="0x0111-完整迁移应用">
     0x0111 完整迁移应用
    </h4>
    <pre class="prettyprint"><code class="hljs vala"><span class="hljs-preprocessor">#在计算节点找到应用的容器id 。</span>
dps | grep mysql #相关关键字
<span class="hljs-preprocessor">#将应用的容器提交为一个新镜像 docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span>
docker commit redis:<span class="hljs-number">2.8</span> redis:<span class="hljs-number">2.8</span>_fix
<span class="hljs-preprocessor">#将镜像保持为一个压缩包文件 docker save [OPTIONS] IMAGE [IMAGE...]</span>
docker save redis:<span class="hljs-number">2.8</span>_fix | bzip2 &gt; redis_2<span class="hljs-number">.8</span>.bz2
<span class="hljs-preprocessor">#下载压缩包上传到其他机房。</span>
<span class="hljs-preprocessor">#加载打包好的镜像</span>
docker load &lt; redis_2<span class="hljs-number">.8</span>.bz2</code></pre>
    <h3 id="0x10-end">
     0x10 END
    </h3>
    <p>
     总之，感觉备份还是很简单。感觉没特殊要求，数据都可以不备份的。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f75303131303433353533:2f61727469636c652f64657461696c732f3639393432363832" class_="artid" style="display:none">
 </p>
</div>


