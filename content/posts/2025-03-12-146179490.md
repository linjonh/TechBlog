---
layout: post
title: "SpringCloudGateway新一代网关"
date: 2025-03-12 16:35:21 +0800
description: "SpringCloud——Gateway新一代网关"
keywords: "SpringCloud——Gateway新一代网关"
categories: ['Springcloud']
tags: ['Spring', 'Spring', 'Gateway', 'Cloud', 'Boot']
artid: "146179490"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146179490
    alt: "SpringCloudGateway新一代网关"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146179490
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146179490
cover: https://bing.ee123.net/img/rand?artid=146179490
image: https://bing.ee123.net/img/rand?artid=146179490
img: https://bing.ee123.net/img/rand?artid=146179490
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SpringCloud——Gateway新一代网关
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     <span style="color:#0d0016">
      一、概述
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）是什么
     </span>
    </h3>
    <ol>
     <li>
      官网：
      <a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/" rel="nofollow" title="Spring Cloud Gateway">
       Spring Cloud Gateway
      </a>
      <img alt="" height="82" src="https://i-blog.csdnimg.cn/direct/406b9761ecb543f9845912c8e96e3453.png" width="1199">
       <img alt="" height="247" src="https://i-blog.csdnimg.cn/direct/7c6ae608e7b24ea8a8b66c2ccec9a38d.png" width="957"/>
      </img>
     </li>
     <li>
      体系定位
      <img alt="" height="82" src="https://i-blog.csdnimg.cn/direct/a4e1b3e4046b4327abafde9f8b93a465.png" width="1174"/>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （2）微服务架构中网关在哪里
     </span>
    </h3>
    <p>
     <img alt="" height="464" src="https://i-blog.csdnimg.cn/direct/727ec523a2424026a2336e9d727fcaaa.png" width="644"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （3）能干嘛
     </span>
    </h3>
    <ol>
     <li>
      反向代理
     </li>
     <li>
      鉴权
     </li>
     <li>
      流量控制
     </li>
     <li>
      熔断
     </li>
     <li>
      日志监控
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （4）总结
     </span>
    </h3>
    <p>
     <img alt="" height="88" src="https://i-blog.csdnimg.cn/direct/79015ec2c1f94cd882e44d80f194acb4.png" width="1196">
      <img alt="" height="372" src="https://i-blog.csdnimg.cn/direct/97b2763dc2d7422e8710632353a94de7.png" width="882"/>
     </img>
    </p>
    <h2>
     <span style="color:#0d0016">
      二、Gateway 三大核心
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）总述官网
     </span>
    </h3>
    <p>
     <img alt="" height="247" src="https://i-blog.csdnimg.cn/direct/81d3d5684a1b4770954e9a592c07678b.png" width="882"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （2）分
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      2.2.1Route（路由）
     </span>
    </h4>
    <p>
     <span style="color:#0d0016">
      路由是构建网关的基本模块，它由 ID，目标 URI，一系列的断言和过滤器组成，如果断言为 true 则匹配该路由
     </span>
    </p>
    <h4>
     <span style="color:#0d0016">
      2.2.2Predicate（断言）
     </span>
    </h4>
    <ol>
     <li>
      参考的是 Java8 的 java.util.function.Predicate
     </li>
     <li>
      开发人员可以匹配 HTTP 请求中的所有内容 (例如请求头或请求参数)，
      <strong>
       <span style="color:#fe2c24">
        如果请求与断言相匹配则进行路由
       </span>
      </strong>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      2.2.3Filter（过滤）
     </span>
    </h4>
    <p>
     <span style="color:#0d0016">
      指的是 Spring 框架中 GatewayFilter 的实例，使用过滤器，可以在请求被路由前或者之后对请求进行修改
     </span>
    </p>
    <h3>
     <span style="color:#0d0016">
      （3）总结
     </span>
    </h3>
    <p>
     <img alt="" height="299" src="https://i-blog.csdnimg.cn/direct/9b4c7de6188a4e4e8c8074f5a44c444b.png" width="798"/>
    </p>
    <ol>
     <li>
      web前端请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后，进行一些精细化控制
     </li>
     <li>
      predicate就是我们的匹配条件
     </li>
     <li>
      filter，就可以理解为一个无所不能的拦截器。有了这两个元素，再加上目标uri，就可以实现一个具体的路由了
     </li>
    </ol>
    <h2>
     <span style="color:#0d0016">
      三、Gateway 工作流程
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）官网总结
     </span>
    </h3>
    <ol>
     <li>
      客户端请求发送到 Spring Cloud Gateway 后，先通过 Gateway Handler Mapping 匹配路由，再交给 Gateway Web Handler。Handler 借助过滤器链，将请求发往实际服务处理业务并返回结果
     </li>
     <li>
      过滤器
      <strong>
       <span style="color:#fe2c24">
        分两类
       </span>
      </strong>
      ：
      <ol>
       <li>
        <strong>
         Pre 过滤器
        </strong>
        ：在代理请求
        <strong>
         <span style="color:#fe2c24">
          前
         </span>
        </strong>
        执行，用于参数校验、权限校验、流量监控、日志输出、协议转换等
       </li>
       <li>
        <strong>
         Post 过滤器
        </strong>
        ：在代理请求
        <strong>
         <span style="color:#fe2c24">
          后
         </span>
        </strong>
        执行，可修改响应内容 / 头，输出日志、监控流量等，作用关键
       </li>
      </ol>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （2）核心逻辑
     </span>
    </h3>
    <p>
     <strong>
      <span style="color:#fe2c24">
       路由转发+断言判断+执行过滤器链
      </span>
     </strong>
    </p>
    <h2>
     <span style="color:#0d0016">
      四、入门配置
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）建Module
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      cloud-gateway9527
     </span>
    </p>
    <h3>
     <span style="color:#0d0016">
      （2）改POM
     </span>
    </h3>
    <div>
     <pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.atguigu.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;mscloudV5&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;cloud-gateway9527&lt;/artifactId&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;


    &lt;dependencies&gt;
        &lt;!--gateway--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--服务注册发现consul discovery,网关也要注册进服务注册中心统一管控--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- 指标监控健康检查的actuator,网关是响应式编程删除掉spring-boot-starter-web dependency--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
    </div>
    <h3>
     <span style="color:#0d0016">
      （3）写YML
     </span>
    </h3>
    <div>
     <pre><code class="language-XML">server:
  port: 9527

spring:
  application:
    name: cloud-gateway
  cloud:
    consul:
      host: localhost
      port: 8500
      discovery:
        prefer-ip-address: true
        service-name: ${spring.application.name}</code></pre>
    </div>
    <h3>
     <span style="color:#0d0016">
      （4）主启动
     </span>
    </h3>
    <p>
     <img alt="" height="501" src="https://i-blog.csdnimg.cn/direct/0add57006668474487811f40e522a749.png" width="1117"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （5）业务类
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      无，不写任何业务代码，网关和业务无关
     </span>
    </p>
    <h3>
     <span style="color:#0d0016">
      （6）测试
     </span>
    </h3>
    <ol>
     <li>
      先启动 8500 服务中心 Consul
     </li>
     <li>
      再启动 9527 网关入驻
      <img alt="" height="567" src="https://i-blog.csdnimg.cn/direct/6a7a14bd33554543a5c1b3762c5f4f07.png" width="2559"/>
     </li>
    </ol>
    <h2>
     <span style="color:#0d0016">
      五、9527 网关如何做路由映射
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）9527 网关如何做路由映射那？？？
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      5.1.1诉求
     </span>
    </h4>
    <p>
     <span style="color:#0d0016">
      我们目前不想暴露8001端口，希望在8001真正的支付微服务外面套一层9527网关
     </span>
    </p>
    <h4>
     <span style="color:#0d0016">
      5.1.28001 新建 PayGateWayController
     </span>
    </h4>
    <p>
     <img alt="" height="930" src="https://i-blog.csdnimg.cn/direct/43a4dd01ec54418da259440d5f8300d8.png" width="1651"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      5.1.3启动 8001 支付
     </span>
     <img alt="" height="629" src="https://i-blog.csdnimg.cn/direct/000d94b50d3e49148d3c733ae88700c9.png" width="2559"/>
    </h4>
    <h4>
     <span style="color:#0d0016">
      5.1.48001 自测通过
     </span>
    </h4>
    <ol>
     <li>
      <span style="color:#0d0016">
       http://localhost:8001/pay/gateway/get/1
      </span>
     </li>
     <li>
      <span style="color:#0d0016">
       http://localhost:8001/pay/gateway/info
      </span>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （2）9527 网关 YML 新增配置
     </span>
    </h3>
    <p>
    </p>
    <h3>
     <span style="color:#0d0016">
      （3）测试 1
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      5.3.1启动 Consul8500 服务
     </span>
    </h4>
    <h4>
     <span style="color:#0d0016">
      5.3.2启动 8001 支付
     </span>
    </h4>
    <h4>
     <span style="color:#0d0016">
      5.3.3启动 9527 网关
     </span>
    </h4>
    <p>
     <img alt="" height="639" src="https://i-blog.csdnimg.cn/direct/17e50c448fd44bdd89076a300a49e8c9.png" width="2559"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      5.3.4访问说明
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）添加网关前
     </span>
    </h5>
    <ol>
     <li>
      <a href="http://localhost:8001/pay/gateway/get/1" rel="nofollow" title="http://localhost:8001/pay/gateway/get/1">
       http://localhost:8001/pay/gateway/get/1
      </a>
     </li>
     <li>
      <a href="http://localhost:8001/pay/gateway/info" rel="nofollow" title="http://localhost:8001/pay/gateway/info">
       http://localhost:8001/pay/gateway/info
      </a>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （2）隐真示假，映射说明
     </span>
    </h5>
    <p>
     <img alt="" height="615" src="https://i-blog.csdnimg.cn/direct/df868a289293427082db973dd8099a69.png" width="1319"/>
    </p>
    <h5>
     <span style="color:#0d0016">
      （3）添加网关后
     </span>
    </h5>
    <ol>
     <li>
      <a href="http://localhost:9527/pay/gateway/get/1" rel="nofollow" title="http://localhost:9527/pay/gateway/get/1">
       http://localhost:9527/pay/gateway/get/1
      </a>
     </li>
     <li>
      http://
      <a href="http://localhost:9527/pay/gateway/info" rel="nofollow" title="localhost:9527/pay/gateway/info">
       localhost:9527/pay/gateway/info
      </a>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      5.3.5目前 8001 支付微服务前面添加 GateWay 成功
     </span>
    </h4>
    <p>
     <img alt="" height="315" src="https://i-blog.csdnimg.cn/direct/f9e80e99aea24c30a5d5e64c5fc48c0e.png" width="812"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （4）测试 2
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      5.4.1启动订单微服务测试，看看是否通过网关？
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）修改 cloud-api-commons
     </span>
    </h5>
    <p>
     <span style="color:#0d0016">
      PayFeignApi接口
     </span>
     <img alt="" height="485" src="https://i-blog.csdnimg.cn/direct/b5fcc4d2f29d4bc88affdbe7dc524099.png" width="1009"/>
    </p>
    <h5>
     <span style="color:#0d0016">
      （2）修改 cloud-consumer-feign-order80
     </span>
    </h5>
    <p>
     <img alt="" height="749" src="https://i-blog.csdnimg.cn/direct/2275c43dd9794febb035660e9631a336.png" width="1367"/>
    </p>
    <h5>
     <span style="color:#0d0016">
      （3）网关开启
     </span>
    </h5>
    <ol>
     <li>
      测试通过
      <img alt="" height="875" src="https://i-blog.csdnimg.cn/direct/b393692a99a9406fa7b1ec3fe6ebeb46.png" width="2559"/>
     </li>
     <li>
      <a href="http://localhost/feign/pay/gateway/get/1" rel="nofollow" title="http://localhost/feign/pay/gateway/get/1">
       http://localhost/feign/pay/gateway/get/1
      </a>
      <img alt="" height="419" src="https://i-blog.csdnimg.cn/direct/5efb6c8ca90e407d8da993675663ca86.png" width="2559"/>
     </li>
     <li>
      <a href="http://localhost/feign/pay/gateway/info" rel="nofollow" title="http://localhost/feign/pay/gateway/info">
       http://localhost/feign/pay/gateway/info
      </a>
      <img alt="" height="418" src="https://i-blog.csdnimg.cn/direct/d15282022d124e08a8d6f0014fe0a7e4.png" width="2559"/>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （4）网关关闭
     </span>
    </h5>
    <ol>
     <li>
      测试通过
      <img alt="" height="636" src="https://i-blog.csdnimg.cn/direct/32c8318d6c3046c28aff516688b4447d.png" width="2559"/>
     </li>
     <li>
      <a href="http://localhost/feign/pay/gateway/get/1" rel="nofollow" title="http://localhost/feign/pay/gateway/get/1">
       http://localhost/feign/pay/gateway/get/1
      </a>
      <img alt="" height="421" src="https://i-blog.csdnimg.cn/direct/0a1797ee5a17402da6f2cd8aca8a8e86.png" width="2559"/>
     </li>
     <li>
      <a href="http://localhost/feign/pay/gateway/info" rel="nofollow" title="http://localhost/feign/pay/gateway/info">
       http://localhost/feign/pay/gateway/info
      </a>
      <img alt="" height="421" src="https://i-blog.csdnimg.cn/direct/aa30197d0781450aa6aeeeece1ffbfd5.png" width="2559"/>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （5）结论
     </span>
    </h5>
    <ol>
     <li>
      9527 网关是否启动，毫无影响，o (π﹏π) o
     </li>
     <li>
      目前的配置来看，网关被绕开了……
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      5.4.2正确做法
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）同一家公司自己人，系统内环境，直接找微服务
     </span>
    </h5>
    <h5>
     <img alt="" height="639" src="https://i-blog.csdnimg.cn/direct/0101e2a7c9a64d899db139d29d55ce00.png" width="1365"/>
    </h5>
    <h5>
     <span style="color:#0d0016">
      （2）不同家公司有外人，系统外访问，先找网关再服务
     </span>
    </h5>
    <p>
     <img alt="" height="280" src="https://i-blog.csdnimg.cn/direct/99c73367d1074a119d3ed2b765646d10.png" width="711"/>
     <img alt="" height="392" src="https://i-blog.csdnimg.cn/direct/7ab7e31727884e6a857bcc647dab31b6.png" width="533"/>
    </p>
    <ol>
     <li>
      刷新 feign 接口 jar 包
     </li>
     <li>
      重启 80 订单微服务
      <img alt="" height="745" src="https://i-blog.csdnimg.cn/direct/c5224e35089743209b2e97c809e60c80.png" width="2559"/>
     </li>
     <li>
      有网关正常 success
      <img alt="" height="329" src="https://i-blog.csdnimg.cn/direct/4015730bed9a417da23984d2c095f4a9.png" width="1179"/>
     </li>
     <li>
      无网关
      <strong>
       <span style="color:#fe2c24">
        异常
       </span>
      </strong>
      <img alt="" height="690" src="https://i-blog.csdnimg.cn/direct/12d22cd8fc364805b5d3ca638d8111e2.png" width="2559"/>
      <img alt="" height="206" src="https://i-blog.csdnimg.cn/direct/08cc3075ee734fcb94f2b6e40702634c.png" width="1185"/>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （5）还有问题
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      请看看网关 9527 的 yml 配置，映射写死问题，^_^
     </span>
     <img alt="" height="468" src="https://i-blog.csdnimg.cn/direct/64f0619d218c4810a2c6554e4c4ab3e5.png" width="910"/>
    </p>
    <h2>
     <span style="color:#0d0016">
      六、GateWay 高级特性
     </span>
     <img alt="" height="569" src="https://i-blog.csdnimg.cn/direct/bc4001d0fafc43708eb8f49cf3d004c3.png" width="1158"/>
     <img alt="" height="459" src="https://i-blog.csdnimg.cn/direct/8d2df51cd210437b87c0aae1bae53746.png" width="1136"/>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）Route 以微服务名 - 动态获取服务 URI
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      6.1.1痛点
     </span>
    </h4>
    <p>
     <img alt="" height="441" src="https://i-blog.csdnimg.cn/direct/216ab9ad546e460ea088335254c622b4.png" width="935"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      6.1.2是什么
     </span>
     <img alt="" height="586" src="https://i-blog.csdnimg.cn/direct/eb127429e7b94a28af574f60ed4d8cae.png" width="926"/>
    </h4>
    <h4>
     <span style="color:#0d0016">
      6.1.3解决 uri 地址写死问题
     </span>
    </h4>
    <ol>
     <li>
      9527 修改前 YML
      <img alt="" height="843" src="https://i-blog.csdnimg.cn/direct/1ff08768b1fc4f17987480edb557a03a.png" width="1377"/>
     </li>
     <li>
      9527 修改后 YML
      <img alt="" height="847" src="https://i-blog.csdnimg.cn/direct/189de12b61004fefadb52cd4ef861729.png" width="1324"/>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      6.1.4测试 1
     </span>
    </h4>
    <ol>
     <li>
      重启网关 9527，80/8001 保持不变
     </li>
     <li>
      <a href="http://localhost/feign/pay/gateway/get/1" rel="nofollow" title="http://localhost/feign/pay/gateway/get/1">
       http://localhost/feign/pay/gateway/get/1
      </a>
      <img alt="" height="511" src="https://i-blog.csdnimg.cn/direct/04c12f5caf264fdbaa645f8fe1d19e99.png" width="2559"/>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      6.1.5测试 2
     </span>
    </h4>
    <ol>
     <li>
      如果将 8001 微服务 yml 文件端口修改为 8007，照样访问
     </li>
     <li>
      我实际启动的程序是 main8001 但是端口名改为 8007
     </li>
     <li>
      我们依据微服务名字，匹配查找即可uri: lb://cloud-payment-service
      <img alt="" height="423" src="https://i-blog.csdnimg.cn/direct/e22e2b89c967409abcd0f21759a41083.png" width="2559"/>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （2）Predicate 断言 (谓词）
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      6.2.1是什么
     </span>
    </h4>
    <ol>
     <li>
      <a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/#gateway-request-predicates-factories" rel="nofollow" title="Spring Cloud Gateway">
       Spring Cloud Gateway
      </a>
     </li>
     <li>
      Route Predicate Factories这个是什么东东?
      <img alt="" height="454" src="https://i-blog.csdnimg.cn/direct/e2e2cc5569d14d759c3d5b032281ab62.png" width="1313"/>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      6.2.2启动微服务 gateway9527，看看 IDEA 后台的输出
     </span>
     <img alt="" height="315" src="https://i-blog.csdnimg.cn/direct/d3b5d4a0145e47a6af2fd90fcf75d3cf.png" width="1067"/>
    </h4>
    <h4>
     <span style="color:#0d0016">
      6.2.3整体架构概述
     </span>
    </h4>
    <p>
     <img alt="" height="705" src="https://i-blog.csdnimg.cn/direct/862c760e3d8b4635990311ca544f8724.png" width="1366"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      6.2.4常用的内置 Route Predicate
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）配置语法总体概述
     </span>
    </h5>
    <ol>
     <li>
      两种配置，二选一（
      <strong>
       <span style="color:#fe2c24">
        Most
       </span>
      </strong>
      examples below
      <span style="color:#fe2c24">
       <strong>
        use the shortcut way
       </strong>
      </span>
      ）
      <img alt="" height="441" src="https://i-blog.csdnimg.cn/direct/e43bb29795ec4cefb0c2b782129ce5c4.png" width="741"/>
      <a href="https://docs.spring.io/spring-cloud-gateway/reference/spring-cloud-gateway/configuring-route-predicate-factories-and-filter-factories.html" rel="nofollow" title="Configuring Route Predicate Factories and Gateway Filter Factories :: Spring Cloud Gateway">
       Configuring Route Predicate Factories and Gateway Filter Factories :: Spring Cloud Gateway
      </a>
     </li>
     <li>
      Shortcut Configuration
      <img alt="" height="442" src="https://i-blog.csdnimg.cn/direct/253ba0f2388c4fd0af232e3bbb4152d9.png" width="798"/>
     </li>
     <li>
      Fully Expanded Arguments
      <img alt="" height="473" src="https://i-blog.csdnimg.cn/direct/49ff7699ed334197be7fa0154c03f4fc.png" width="793"/>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （2）测试地址
     </span>
    </h5>
    <p>
     <a href="http://localhost:9527/pay/gateway/get/1" rel="nofollow" title="http://localhost:9527/pay/gateway/get/1">
      http://localhost:9527/pay/gateway/get/1
     </a>
    </p>
    <h5>
     <span style="color:#0d0016">
      （3）常用断言 api
     </span>
    </h5>
    <ol>
     <li>
      <span style="color:#fe2c24">
       <strong>
        After
       </strong>
      </span>
      Route Predicate
      <img alt="" height="686" src="https://i-blog.csdnimg.cn/direct/92192860c044441ca4ff149f365391a2.png" width="1401"/>
      <pre><code class="language-java">package com.atguigu.test;

import java.time.ZonedDateTime;

public class ZonedDateTimeDemo {
    public static void main(String[] args) {
        ZonedDateTime zbj = ZonedDateTime.now();
        System.out.println(zbj);
    }
}</code></pre>
      <p>
       <img alt="" height="799" src="https://i-blog.csdnimg.cn/direct/6983f32e6071403681ede12583c3f031.png" width="1234"/>
       <img alt="" height="125" src="https://i-blog.csdnimg.cn/direct/8e8977ebda0f4d078ad4f50bb4d3f95a.png" width="1210"/>
      </p>
     </li>
     <li>
      <strong>
       <span style="color:#fe2c24">
        Before
       </span>
      </strong>
      Route Predicate
      <img alt="" height="407" src="https://i-blog.csdnimg.cn/direct/5d9527464e1f4ae6a50ed0db8335427a.png" width="908"/>
      <img alt="" height="818" src="https://i-blog.csdnimg.cn/direct/a3a28cbd13ea41cb97522876e98bf95b.png" width="1297"/>
      <img alt="" height="124" src="https://i-blog.csdnimg.cn/direct/49f1e00ca56b4ce9aab0ae82cc724912.png" width="1199"/>
     </li>
     <li>
      <span style="color:#fe2c24">
       <strong>
        Between
       </strong>
      </span>
      Route Predicate
      <img alt="" height="444" src="https://i-blog.csdnimg.cn/direct/d9f678eeb79e4d71991afec0b9a12d8a.png" width="916"/>
     </li>
     <li>
      <span style="color:#fe2c24">
       <strong>
        Cookie
       </strong>
      </span>
      Route Predicate
      <img alt="" height="819" src="https://i-blog.csdnimg.cn/direct/3a9fbd25b51c416892c201a44fb47199.png" width="1281"/>
      <img alt="" height="784" src="https://i-blog.csdnimg.cn/direct/1131d313b212450fbf7048eef5d43ad2.png" width="1759"/>
      <ol>
       <li>
        方法1，原生命令
        <img alt="" height="219" src="https://i-blog.csdnimg.cn/direct/48f997623a624235aa3ae652cbe51e4d.png" width="1690"/>
       </li>
       <li>
        方法2，postman
        <img alt="" height="579" src="https://i-blog.csdnimg.cn/direct/73323a2d7179457d8d6c2908bac987f1.png" width="1194"/>
       </li>
       <li>
        方法3，chrome浏览器
        <img alt="" height="689" src="https://i-blog.csdnimg.cn/direct/4db88bbb9c634265a28c7f2910be9d5a.png" width="895"/>
       </li>
      </ol>
     </li>
     <li>
      <span style="color:#fe2c24">
       <strong>
        Header
       </strong>
      </span>
      Route Predicate
      <img alt="" height="822" src="https://i-blog.csdnimg.cn/direct/fc9ee7bbae534b6daa17122c394b4733.png" width="1336"/>
      <img alt="" height="443" src="https://i-blog.csdnimg.cn/direct/0bffeb98ec2640f4a6766ba22d457516.png" width="910"/>
      <ol>
       <li>
        方法1，原生命令
        <img alt="" height="285" src="https://i-blog.csdnimg.cn/direct/8eef9f83782c40868a92c5030edd37a8.png" width="1355"/>
       </li>
       <li>
        方法2，postman
        <img alt="" height="408" src="https://i-blog.csdnimg.cn/direct/62d3b965521a4daaba2a7689b06992af.png" width="1193"/>
        <img alt="" height="448" src="https://i-blog.csdnimg.cn/direct/2ff3800f4d7d486a9a7fb943ac574bd9.png" width="1183"/>
       </li>
      </ol>
     </li>
     <li>
      <strong>
       <span style="color:#fe2c24">
        Host
       </span>
      </strong>
      Route Predicate
      <img alt="" height="753" src="https://i-blog.csdnimg.cn/direct/c9913c45c3db42e4867c1c916a5e308f.png" width="1392"/>
      <img alt="" height="820" src="https://i-blog.csdnimg.cn/direct/62b1c85de90344069929e6d93cd30c6a.png" width="1273"/>
      <ol>
       <li>
        方法1，原生命令
        <img alt="" height="248" src="https://i-blog.csdnimg.cn/direct/0ce907ac2edb4d57a4be067e344c0845.png" width="1346"/>
       </li>
       <li>
        方法2，postman
        <img alt="" height="537" src="https://i-blog.csdnimg.cn/direct/89a8690ed8e1464394e970e10a04589a.png" width="1182"/>
       </li>
      </ol>
     </li>
     <li>
      <strong>
       <span style="color:#fe2c24">
        Path
       </span>
      </strong>
      Route Predicate
      <img alt="" height="820" src="https://i-blog.csdnimg.cn/direct/5f779c5e3e1e4fb9a5e04131e49f0d56.png" width="1303"/>
     </li>
     <li>
      Query Route Predicate
      <img alt="" height="346" src="https://i-blog.csdnimg.cn/direct/9fc4a4d58b0e4742a72a92a5281b5888.png" width="907"/>
      <img alt="" height="776" src="https://i-blog.csdnimg.cn/direct/d8115c8066f849ffa65375d55368f1bc.png" width="1390"/>
      <img alt="" height="185" src="https://i-blog.csdnimg.cn/direct/d413fbb50fd243d9a254f83492244175.png" width="1195"/>
      <img alt="" height="465" src="https://i-blog.csdnimg.cn/direct/350008ac630c4d539da39e4d07afd4c0.png" width="1193"/>
     </li>
     <li>
      <strong>
       <span style="color:#fe2c24">
        RemoteAddr
       </span>
      </strong>
      route predicate
      <img alt="" height="419" src="https://i-blog.csdnimg.cn/direct/441c06b5129c4645b827e8d408d2fac6.png" width="913"/>
      <img alt="" height="37" src="https://i-blog.csdnimg.cn/direct/3ba7a0cc021447a69d041006f9d31e19.png" width="1470"/>
      <img alt="" height="311" src="https://i-blog.csdnimg.cn/direct/26d0233d2c2d41d081c5a9917a957768.png" width="902"/>
      <img alt="" height="321" src="https://i-blog.csdnimg.cn/direct/c5559614003740c29215c9c51940d180.png" width="1199"/>
     </li>
     <li>
      <span style="color:#fe2c24">
       <strong>
        Method
       </strong>
      </span>
      Route Predicate
      <img alt="" height="398" src="https://i-blog.csdnimg.cn/direct/b63053a8201f473f8532d384514b843e.png" width="911"/>
      <strong>
       <span style="color:#fe2c24">
        配置某个请求地址，只能用 Get/Post 方法访问，方法限制
       </span>
      </strong>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （4）上述配置小总结
     </span>
     <img alt="" height="82" src="https://i-blog.csdnimg.cn/direct/e9dbe88bc3d44c5bb54bf0c205a39394.png" width="1213"/>
    </h5>
    <h4>
     <span style="color:#0d0016">
      6.2.5自定义断言，XXXRoutePredicateFactory 规则
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）痛点
     </span>
    </h5>
    <ol>
     <li>
      原有的断言配置不满足业务怎么办？
     </li>
     <li>
      看看
      <span style="color:#fe2c24">
       <strong>
        After
       </strong>
      </span>
      RoutePredicateFactory
      <img alt="" height="49" src="https://i-blog.csdnimg.cn/direct/e55ec2bafc614964931e48aa0d47f52e.png" width="1024"/>
     </li>
     <li>
      架构概述
      <img alt="" height="705" src="https://i-blog.csdnimg.cn/direct/b5b01428d4e348ffac996c2424eda94f.png" width="1210"/>
     </li>
     <li>
      模板套路
      <ol>
       <li>
        要么继承
        <strong>
         <span style="color:#fe2c24">
          AbstractRoutePredicateFactory 抽象类
         </span>
        </strong>
       </li>
       <li>
        要么实现
        <strong>
         <span style="color:#fe2c24">
          RoutePredicateFactory 接口
         </span>
        </strong>
       </li>
       <li>
        开头任意取名，但是
        <strong>
         <span style="color:#fe2c24">
          必须以 RoutePredicateFactory 后缀结尾
         </span>
        </strong>
       </li>
      </ol>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （2）自定义路由断言规则步骤套路
     </span>
    </h5>
    <ol>
     <li>
      编写步骤
      <ol>
       <li>
        新建类名 XXX 需要以 RoutePredicateFactory 结尾并继承 AbstractRoutePredicateFactory 类
        <img alt="" height="249" src="https://i-blog.csdnimg.cn/direct/0e47504d5b9c4994ac3897475d9850aa.png" width="1426"/>
       </li>
       <li>
        重写 apply 方法
        <img alt="" height="200" src="https://i-blog.csdnimg.cn/direct/f5319328f48c4f5fa6434968969ba6a1.png" width="1163"/>
       </li>
       <li>
        新建 apply 方法所需要的静态内部类 MyRoutePredicateFactory.Config
        <br/>
        （补充说明：
        <strong>
         <span style="color:#fe2c24">
          这个 Config 类就是我们的路由断言规则，重要
         </span>
        </strong>
        ）
        <strong>
         <span style="color:#fe2c24">
          注意：要在pom文件里添加依赖
         </span>
        </strong>
        <pre><code class="language-XML">&lt;!--lombok--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.18.28&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
        <p>
         <img alt="" height="215" src="https://i-blog.csdnimg.cn/direct/b98793508e864ebfb3bd5c67c90a4c80.png" width="1193"/>
         <img alt="" height="246" src="https://i-blog.csdnimg.cn/direct/9da2060bedd542a09b5aa74bab27b333.png" width="776"/>
        </p>
       </li>
       <li>
        空参构造方法，内部调用 super
        <img alt="" height="125" src="https://i-blog.csdnimg.cn/direct/256bc5cbe60f4168aa91c9058e0e27e6.png" width="641"/>
       </li>
       <li>
        重写 apply 方法第二版
        <img alt="" height="753" src="https://i-blog.csdnimg.cn/direct/0502d53a363c4de8a668c583b46a45aa.png" width="1278"/>
       </li>
      </ol>
     </li>
     <li>
      完整代码 V1
      <pre><code class="language-java">package com.atguigu.cloud.mygateway;

import jakarta.validation.constraints.NotEmpty;
import lombok.Getter;
import lombok.Setter;
import org.springframework.cloud.gateway.handler.predicate.AbstractRoutePredicateFactory;
import org.springframework.stereotype.Component;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.server.ServerWebExchange;

import java.util.function.Predicate;

@Component
public class MyRoutePredicateFactory extends AbstractRoutePredicateFactory&lt;MyRoutePredicateFactory.Config&gt; {

    //这个Config类就是我们的路由断言规则，重要！！！
    @Validated
    public static class Config
    {
        @Setter @Getter @NotEmpty
        private String userType; //钻/金/银和yml配置的会员等级
    }

    @Override
    public Predicate&lt;ServerWebExchange&gt; apply(MyRoutePredicateFactory.Config config)
    {
        return new Predicate&lt;ServerWebExchange&gt;()
        {
            @Override
            public boolean test(ServerWebExchange serverWebExchange)
            {
                //检查request的参数里面，userType是否为指定的值，符合配置就通过
                String userType = serverWebExchange.getRequest().getQueryParams().getFirst("userType");

                if (userType == null) {
                    return false;
                }
                //如果说参数存在，就和config的数据进行比较
                if(userType.equalsIgnoreCase(config.getUserType())){
                    return true;
                }
                return false;
            }
        };
    }

    public MyRoutePredicateFactory() {
        super(MyRoutePredicateFactory.Config.class);
    }
}</code></pre>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （3）测试 1
     </span>
    </h5>
    <ol>
     <li>
      YML
      <img alt="" height="816" src="https://i-blog.csdnimg.cn/direct/a1ac47be823a407f8a31f1849df1a77e.png" width="1324"/>
     </li>
     <li>
      启动后？？？
      <ol>
       <li>
        故障现象
        <img alt="" height="243" src="https://i-blog.csdnimg.cn/direct/1a464f057fbc44038ed770a129c7eb26.png" width="1229"/>
       </li>
       <li>
        导致原因
        <img alt="" height="494" src="https://i-blog.csdnimg.cn/direct/10b68fdd31f3476ca906e9e534bd8ca6.png" width="920"/>
       </li>
       <li>
        解决方案
        <ol>
         <li>
          先解决问题，让我们自定义的能用
         </li>
         <li>
          Fully Expanded Arguments
          <img alt="" height="414" src="https://i-blog.csdnimg.cn/direct/6bb432fe46404824b40d00718a853a86.png" width="815"/>
         </li>
         <li>
          <a href="http://localhost:9527/pay/gateway/get/1?userType=diamond" rel="nofollow" title="http://localhost:9527/pay/gateway/get/1?userType=diamond">
           http://localhost:9527/pay/gateway/get/1?userType=diamond
          </a>
         </li>
         <li>
          success
          <img alt="" height="508" src="https://i-blog.csdnimg.cn/direct/ae6443b4f547404bbb3bd4f2928fd395.png" width="2559"/>
         </li>
        </ol>
       </li>
      </ol>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （4）bug 分析
     </span>
    </h5>
    <p>
     <strong>
      <span style="color:#fe2c24">
       缺少 shortcutFieldOrder 方法的实现，所以不支持短格式
      </span>
     </strong>
    </p>
    <p>
     <img alt="" height="424" src="https://i-blog.csdnimg.cn/direct/1c2d2890253246e6ab507d1cbf096729.png" width="598"/>
    </p>
    <h5>
     <span style="color:#0d0016">
      （5）测试 2
     </span>
    </h5>
    <ol>
     <li>
      完整代码 02（
      <strong>
       <span style="color:#fe2c24">
        再加上下面这段
       </span>
      </strong>
      ）
      <img alt="" height="145" src="https://i-blog.csdnimg.cn/direct/6dd9e57853744e70a398b2d8c0402f90.png" width="719"/>
      <img alt="" height="93" src="https://i-blog.csdnimg.cn/direct/27feab45037d4ed692d3978d0d1059cd.png" width="1191"/>
     </li>
     <li>
      YML
      <img alt="" height="359" src="https://i-blog.csdnimg.cn/direct/cdc438fa513f43dab9c742ffd5b25646.png" width="834"/>
     </li>
     <li>
      重启 9527 并测试
      <img alt="" height="509" src="https://i-blog.csdnimg.cn/direct/f1049d99f79e4bae828e0f93632d77e2.png" width="2559"/>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （3） Filter过滤
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      6.3.1概述
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）官网
     </span>
    </h5>
    <p>
     <a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories" rel="nofollow" title="Spring Cloud Gateway">
      Spring Cloud Gateway
     </a>
    </p>
    <h5>
     <span style="color:#0d0016">
      （2）一句话
     </span>
    </h5>
    <ol>
     <li>
      SpringMVC 里面的拦截器 Interceptor，Servlet 的过滤器
     </li>
     <li>
      “pre” 和 “post” 分别会在请求被执行
      <strong>
       <span style="color:#fe2c24">
        前
       </span>
      </strong>
      调用和被执行
      <strong>
       <span style="color:#fe2c24">
        后
       </span>
      </strong>
      调用，用来
      <strong>
       <span style="color:#fe2c24">
        修改请求和响应信息
       </span>
      </strong>
      <br/>
      能干嘛
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （3）能干嘛
     </span>
    </h5>
    <ol>
     <li>
      <span style="color:#fe2c24">
       <strong>
        请求鉴权
       </strong>
      </span>
     </li>
     <li>
      <strong>
       <span style="color:#fe2c24">
        异常处理
       </span>
      </strong>
     </li>
     <li>
      <span style="color:#fe2c24">
       <strong>
        记录接口调用时长统计
       </strong>
      </span>
      ，重点，大厂面试设计题
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （4）类型
     </span>
    </h5>
    <ol>
     <li>
      全局默认过滤器 Global Filters
      <ol>
       <li>
        <a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#global-filters" rel="nofollow" title="Spring Cloud Gateway">
         Spring Cloud Gateway
        </a>
       </li>
       <li>
        gateway
        <span style="color:#fe2c24">
         <strong>
          出厂默认已有的
         </strong>
        </span>
        ，直接用即可，主要
        <strong>
         <span style="color:#fe2c24">
          作用于所有的路由
         </span>
        </strong>
       </li>
       <li>
        <strong>
         <span style="color:#fe2c24">
          不需要在配置文件中配置
         </span>
        </strong>
        ，作用在所有的路由上，实现 GlobalFilter 接口即可
       </li>
      </ol>
     </li>
     <li>
      单一内置过滤器 GatewayFilter
      <ol>
       <li>
        <a href="https://docs.spring.io/spring-cloud-gateway/docs/4.0.4/reference/html/#gatewayfilter-factories" rel="nofollow" title="Spring Cloud Gateway">
         Spring Cloud Gateway
        </a>
       </li>
       <li>
        也可称为网关过滤器，主要作用于
        <span style="color:#fe2c24">
         <strong>
          单一路由
         </strong>
        </span>
        或某个
        <strong>
         <span style="color:#fe2c24">
          路由分组
         </span>
        </strong>
       </li>
      </ol>
     </li>
     <li>
      自定义过滤器
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      6.3.2Gateway内置的过滤器
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）是什么
     </span>
    </h5>
    <h5>
     <img alt="" height="291" src="https://i-blog.csdnimg.cn/direct/b5d6771e28bd45cc88a51a4b3dcb7167.png" width="1475"/>
    </h5>
    <h5>
     <span style="color:#0d0016">
      （2）只讲解常见和通用的，Not All
     </span>
    </h5>
    <h5>
     <span style="color:#0d0016">
      （3）常用的内置过滤器
     </span>
    </h5>
    <ol>
     <li>
      <span style="color:#fe2c24">
       <strong>
        请求头 (RequestHeader)
       </strong>
      </span>
      相关组
      <ol>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          AddRequestHeader
         </strong>
        </span>
        GatewayFilter Factory
        <ol>
         <li>
          指定请求头内容 ByName
         </li>
         <li>
          8001 微服务 PayGateWayController 新增方法
          <img alt="" height="511" src="https://i-blog.csdnimg.cn/direct/458327f9cf4747c3b9ae34d7c93a08e2.png" width="1282"/>
         </li>
         <li>
          9527 网关 YML 添加过滤内容
          <img alt="" height="366" src="https://i-blog.csdnimg.cn/direct/f8710660c53e4df7b23c3b0080bdbbbb.png" width="969"/>
         </li>
         <li>
          重启 9527 和 8001 并再次调用地址
          <img alt="" height="165" src="https://i-blog.csdnimg.cn/direct/da0d7347f7484edcb515a34f07c4efb3.png" width="1895"/>
         </li>
        </ol>
       </li>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          RemoveRequestHeader
         </strong>
        </span>
        GatewayFilter Factory
        <ol>
         <li>
          删除请求头 ByName
         </li>
         <li>
          修改前
          <img alt="" height="573" src="https://i-blog.csdnimg.cn/direct/9823a6420b6742a4bd8480a85450440d.png" width="1058"/>
          <img alt="" height="163" src="https://i-blog.csdnimg.cn/direct/a6e6e996338e4a618d2f51982f27463b.png" width="651"/>
         </li>
         <li>
          YML
          <img alt="" height="145" src="https://i-blog.csdnimg.cn/direct/afacabce1cf747b68a6f69bbcc447a9a.png" width="697"/>
         </li>
         <li>
          重启 9527 和 8001 并再次调用地址
         </li>
         <li>
          修改后
          <img alt="" height="165" src="https://i-blog.csdnimg.cn/direct/4bf2af950cf94de583d5254df5ff02d7.png" width="876"/>
         </li>
        </ol>
       </li>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          SetRequestHeader
         </strong>
        </span>
        GatewayFilter Factory
        <ol>
         <li>
          修改请求头 ByName
         </li>
         <li>
          修改前 (sec-fetch-mode)
          <img alt="" height="573" src="https://i-blog.csdnimg.cn/direct/7c9232e6cc564909b9112cc1ba83c447.png" width="1058"/>
          <img alt="" height="126" src="https://i-blog.csdnimg.cn/direct/a0861aeebe244834b1ebd48f2900cf79.png" width="759"/>
         </li>
         <li>
          YML
          <img alt="" height="170" src="https://i-blog.csdnimg.cn/direct/a825defaf9904b48b1fcb659a18bfeff.png" width="775"/>
         </li>
         <li>
          重启 9527 和 8001 并再次调用地址
         </li>
         <li>
          修改后
          <img alt="" height="100" src="https://i-blog.csdnimg.cn/direct/6dcdfc1497a04eb1bb8718f76cf7c419.png" width="1183"/>
         </li>
        </ol>
       </li>
      </ol>
     </li>
     <li>
      请求参数 (RequestParameter) 相关组
      <ol>
       <li>
        The
        <strong>
         <span style="color:#fe2c24">
          AddRequestParameter
         </span>
        </strong>
        GatewayFilter Factory
       </li>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          RemoveRequestParameter
         </strong>
        </span>
        GatewayFilter Factory
       </li>
       <li>
        上述两个合一块
        <ol>
         <li>
          YML
          <img alt="" height="239" src="https://i-blog.csdnimg.cn/direct/5dc436dcaddf4282a0f82428575c09b5.png" width="1094"/>
         </li>
         <li>
          修改 PayGateWayController
          <img alt="" height="800" src="https://i-blog.csdnimg.cn/direct/d85c82d7bebe475b9a07b4c606647a0e.png" width="1352"/>
         </li>
         <li>
          测试
          <img alt="" height="134" src="https://i-blog.csdnimg.cn/direct/73ae98e57f214015b8f10f8823559318.png" width="648"/>
         </li>
        </ol>
       </li>
      </ol>
     </li>
     <li>
      回应头 (
      <span style="color:#fe2c24">
       <strong>
        ResponseHeader
       </strong>
      </span>
      ) 相关组
      <ol>
       <li>
        开启配置前，按照地址 chrome 查看一下
        <img alt="" height="633" src="https://i-blog.csdnimg.cn/direct/b9e4084b3caa4b11827d2be794168236.png" width="1001"/>
       </li>
       <li>
        The
        <strong>
         <span style="color:#fe2c24">
          Add
         </span>
        </strong>
        ResponseHeader GatewayFilter Factory
        <img alt="" height="279" src="https://i-blog.csdnimg.cn/direct/d6b7fe3fd99e4fea860dc6b0b1986ab7.png" width="1343"/>
        <img alt="" height="193" src="https://i-blog.csdnimg.cn/direct/d21161658b8f4cc9a35e0124624a6845.png" width="795"/>
       </li>
       <li>
        The
        <strong>
         <span style="color:#fe2c24">
          Set
         </span>
        </strong>
        ResponseHeader GatewayFilter Factory
        <img alt="" height="292" src="https://i-blog.csdnimg.cn/direct/873bf0c28e6c4e719d5af69c57309f35.png" width="1322"/>
        <img alt="" height="198" src="https://i-blog.csdnimg.cn/direct/88908fc52dd44dcab4dfea6cac8205d0.png" width="747"/>
       </li>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          Remove
         </strong>
        </span>
        ResponseHeader GatewayFilter Factory
        <img alt="" height="346" src="https://i-blog.csdnimg.cn/direct/f9762a407d244cd985669e8877e8c1f6.png" width="1351"/>
        <img alt="" height="168" src="https://i-blog.csdnimg.cn/direct/a272e75aac5747bdab0a32f7281fd7f8.png" width="705"/>
        <img alt="" height="123" src="https://i-blog.csdnimg.cn/direct/f4dbddffca6b477bbd90dff0aefb6a77.png" width="1198"/>
       </li>
       <li>
        开启配置后，上面三个配置打包一块上（见上）
       </li>
      </ol>
     </li>
     <li>
      前缀和路径相关组
      <ol>
       <li>
        The
        <strong>
         <span style="color:#fe2c24">
          PrefixPath
         </span>
        </strong>
        GatewayFilter Factory
        <ol>
         <li>
          自动添加路径前缀
         </li>
         <li>
          之前的正确地址：
          <a href="http://localhost:9527/pay/gateway/filter" rel="nofollow" title="http://localhost:9527/pay/gateway/filter">
           http://localhost:9527/pay/gateway/filter
          </a>
         </li>
         <li>
          YML
          <img alt="" height="235" src="https://i-blog.csdnimg.cn/direct/a4d63741280d47778b70a9782ee13ca0.png" width="956"/>
         </li>
         <li>
          Chrome 测试
          <img alt="" height="644" src="https://i-blog.csdnimg.cn/direct/bca3891c6d6245a697c22b9879a2c7b2.png" width="709"/>
         </li>
        </ol>
       </li>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          SetPath
         </strong>
        </span>
        GatewayFilter Factory
        <ol>
         <li>
          访问路径修改
         </li>
         <li>
          测试
          <img alt="" height="711" src="https://i-blog.csdnimg.cn/direct/e9e4271691824ab0940c81d41bf53e20.png" width="1587"/>
          <img alt="" height="194" src="https://i-blog.csdnimg.cn/direct/0324a23025734f5797683cb66f241fc4.png" width="1083"/>
          <img alt="" height="205" src="https://i-blog.csdnimg.cn/direct/9a2e5e0636404974981413d42bd1ab20.png" width="1041"/>
          <img alt="" height="581" src="https://i-blog.csdnimg.cn/direct/d69f847dcc954aae9375c1f97cb5a5e7.png" width="680"/>
         </li>
        </ol>
       </li>
       <li>
        The
        <span style="color:#fe2c24">
         <strong>
          RedirectTo
         </strong>
        </span>
        GatewayFilter Factory
        <ol>
         <li>
          重定向到某个页面
         </li>
         <li>
          YML
          <img alt="" height="211" src="https://i-blog.csdnimg.cn/direct/c8ceda09a14d4fac9ba7ec481e1b9d57.png" width="734"/>
         </li>
        </ol>
       </li>
      </ol>
     </li>
     <li>
      其它
      <ol>
       <li>
        Default Filters
       </li>
       <li>
        配置在此处相当于全局通用，自定义秒变 Global
        <img alt="" height="317" src="https://i-blog.csdnimg.cn/direct/6a4fe2250aee44cebd4ebdc4b9d21bf3.png" width="915"/>
       </li>
      </ol>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      6.3.3Gateway自定义过滤器
     </span>
    </h4>
    <h5>
     <span style="color:#0d0016">
      （1）自定义全局 Filter
     </span>
    </h5>
    <ol>
     <li>
      面试题
      <ol>
       <li>
        统计
        <span style="color:#fe2c24">
         <strong>
          接口调用耗时
         </strong>
        </span>
        情况，如何落地，谈谈设计思路
       </li>
       <li>
        通过
        <span style="color:#fe2c24">
         <strong>
          自定义全局过滤器
         </strong>
        </span>
        搞定上述需求
       </li>
      </ol>
     </li>
     <li>
      案例
      <ol>
       <li>
        自定义接口调用耗时统计的全局过滤器
       </li>
       <li>
        知识出处：
        <a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-combined-global-filter-and-gatewayfilter-ordering" rel="nofollow" title="Spring Cloud Gateway">
         Spring Cloud Gateway
        </a>
       </li>
       <li>
        步骤
        <ol>
         <li>
          新建类 MyGlobalFilter 并实现
          <strong>
           <span style="color:#fe2c24">
            GlobalFilter
           </span>
          </strong>
          ，
          <strong>
           <span style="color:#fe2c24">
            Ordered
           </span>
          </strong>
          两个接口
          <img alt="" height="788" src="https://i-blog.csdnimg.cn/direct/e296058b03744ca2abeceeb46394e137.png" width="1251"/>
         </li>
         <li>
          YML（
          <strong>
           <span style="color:#fe2c24">
            注意，把- My的那个断言去掉，我这里忘记去掉了，留着它会影响访问
           </span>
          </strong>
          ）
          <img alt="" height="558" src="https://i-blog.csdnimg.cn/direct/7ca04d7c467c469da41461f4ea7fd772.png" width="1077"/>
         </li>
         <li>
          code
          <img alt="" height="559" src="https://i-blog.csdnimg.cn/direct/29d94060adbb48088494a15e1587dd3f.png" width="1143"/>
          <img alt="" height="572" src="https://i-blog.csdnimg.cn/direct/258b780ae1694bbb8a7eddf2b8fac635.png" width="1151"/>
          <img alt="" height="541" src="https://i-blog.csdnimg.cn/direct/aa3ddba5fff14b9396688526d1a71687.png" width="1161"/>
          <img alt="" height="662" src="https://i-blog.csdnimg.cn/direct/f7d4ee3e6c9f438e95ae5c09aa1c022b.png" width="1233"/>
         </li>
        </ol>
       </li>
       <li>
        测试
        <ol>
         <li>
          <a href="http://localhost:9527/pay/gateway/info" rel="nofollow" title="localhost:9527/pay/gateway/info">
           localhost:9527/pay/gateway/info
          </a>
          <img alt="" height="236" src="https://i-blog.csdnimg.cn/direct/8a58ab54424d4fb899d54328ddc748b0.png" width="828"/>
         </li>
         <li>
          <a href="http://localhost:9527/pay/gateway/filter" rel="nofollow" title="localhost:9527/pay/gateway/filter">
           localhost:9527/pay/gateway/filter
          </a>
          <img alt="" height="222" src="https://i-blog.csdnimg.cn/direct/3ae161488ee549a5a8f02d82232aead2.png" width="838"/>
         </li>
         <li>
          <a href="http://localhost:9527/pay/gateway/get/1" rel="nofollow" title="localhost:9527/pay/gateway/get/1">
           localhost:9527/pay/gateway/get/1
          </a>
          <img alt="" height="208" src="https://i-blog.csdnimg.cn/direct/4b4cb651c2b649e789632cc912a3252f.png" width="827"/>
         </li>
        </ol>
       </li>
      </ol>
     </li>
    </ol>
    <h5>
     <span style="color:#0d0016">
      （2）自定义条件 Filter
     </span>
    </h5>
    <ol>
     <li>
      自定义，单一内置过滤器 GatewayFilter
     </li>
     <li>
      先参考 GateWay 内置出厂默认的
      <ol>
       <li>
        <strong>
         <span style="color:#fe2c24">
          SetStatus
         </span>
        </strong>
        GatewayFilterFactory
       </li>
       <li>
        <strong>
         <span style="color:#fe2c24">
          SetPath
         </span>
        </strong>
        GatewayFilterFactory
       </li>
       <li>
        <span style="color:#fe2c24">
         <strong>
          AddResponseHeader
         </strong>
        </span>
        GatewayFilterFactory
       </li>
       <li>
        ......
       </li>
      </ol>
     </li>
     <li>
      自定义网关过滤器规则步骤套路
      <ol>
       <li>
        新建类名 XXX 需要以 GatewayFilterFactory 结尾
       </li>
       <li>
        并继承 AbstractGatewayFilterFactory 类
       </li>
       <li>
        新建 XXXGatewayFilterFactory.Config 内部类
       </li>
       <li>
        重写 apply 方法
       </li>
       <li>
        重写 shortcutFieldOrder
       </li>
       <li>
        空参构造方法，内部调用 super
       </li>
       <li>
        完整代码
        <pre><code class="language-java">package com.atguigu.cloud.mygateway;

import lombok.Getter;
import lombok.Setter;
import org.springframework.cloud.gateway.filter.GatewayFilter;
import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.factory.AbstractGatewayFilterFactory;
import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

import java.util.ArrayList;
import java.util.List;

@Component      //千万不能忘记！！！
public class MyGatewayFilterFactory extends AbstractGatewayFilterFactory&lt;MyGatewayFilterFactory.Config&gt; {

    public static class Config{
        @Getter @Setter
        private String status;
    }

    @Override
    public GatewayFilter apply(MyGatewayFilterFactory.Config config) {
        return new GatewayFilter(){
            @Override
            public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {
                ServerHttpRequest request = exchange.getRequest();
                System.out.println("进入自定义网关过滤器MyGatewayFilterFactory，status====" + config.status);
                if (request.getQueryParams().containsKey("atguigu")) {
                    return chain.filter(exchange);
                }else {
                    exchange.getResponse().setStatusCode(HttpStatus.BAD_REQUEST);
                    return exchange.getResponse().setComplete();
                }
            }
        };
    }

    @Override
    public List&lt;String&gt; shortcutFieldOrder() {
        List&lt;String&gt; list = new ArrayList&lt;String&gt;();
        list.add("status");
        return list;
    }

    public MyGatewayFilterFactory() {
        super(MyGatewayFilterFactory.Config.class);
    }
}</code></pre>
        <p>
         <img alt="" height="257" src="https://i-blog.csdnimg.cn/direct/c5357ac24a28472b867191c3c4413649.png" width="1332"/>
         <img alt="" height="559" src="https://i-blog.csdnimg.cn/direct/d566f22aa2054a9fb0672bcf6755d5f5.png" width="1272"/>
         <img alt="" height="358" src="https://i-blog.csdnimg.cn/direct/a182d7dede9442be909b34bf45726dad.png" width="1308"/>
        </p>
       </li>
      </ol>
     </li>
     <li>
      YML
      <img alt="" height="281" src="https://i-blog.csdnimg.cn/direct/5d2f4a09c0a14b369ad4a59db6d21ff0.png" width="1013"/>
      <img alt="" height="270" src="https://i-blog.csdnimg.cn/direct/60210a79a73244399750d6646c8e28a1.png" width="1049"/>
      <img alt="" height="593" src="https://i-blog.csdnimg.cn/direct/92d73ecb50de43d2b3f7da08ccd3a074.png" width="1209"/>
      <img alt="" height="593" src="https://i-blog.csdnimg.cn/direct/48f4a16f221641aaabab94a7e6c92a1c.png" width="1209"/>
     </li>
     <li>
      测试
      <img alt="" height="642" src="https://i-blog.csdnimg.cn/direct/34bd63c93dc44e42b31f257ba1e8eb05.png" width="984"/>
      <img alt="" height="441" src="https://i-blog.csdnimg.cn/direct/d23c16cb2f4f4d8ba63722fcc20ac7e5.png" width="1114"/>
     </li>
    </ol>
    <h2>
     <span style="color:#0d0016">
      七、Gateway 整合阿里巴巴 Sentinel 实现容错
     </span>
    </h2>
    <p>
     <span style="color:#0d0016">
      见后续springcloud alibaba篇章
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37343031393037392f:61727469636c652f64657461696c732f313436313739343930" class_="artid" style="display:none">
 </p>
</div>


