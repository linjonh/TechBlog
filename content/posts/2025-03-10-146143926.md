---
layout: post
title: "C设计模式第十七篇中介者模式Mediator"
date: 2025-03-10 09:21:16 +0800
description: "集中式交互调度中心"
keywords: "​【C++设计模式】第十七篇：中介者模式（Mediator）"
categories: ['C']
tags: ['设计模式', '中介者模式', 'C']
artid: "146143926"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146143926
    alt: "C设计模式第十七篇中介者模式Mediator"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146143926
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146143926
cover: https://bing.ee123.net/img/rand?artid=146143926
image: https://bing.ee123.net/img/rand?artid=146143926
img: https://bing.ee123.net/img/rand?artid=146143926
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ​【C++设计模式】第十七篇：中介者模式（Mediator）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <code>
      注意：复现代码时，确保 VS2022 使用 C++17/20 标准以支持现代特性。
     </code>
    </p>
    <h3>
     <a id="_2">
     </a>
     集中式交互调度中心
    </h3>
    <hr/>
    <h3>
     <a id="1__4">
     </a>
     1. 模式定义与用途
    </h3>
    <h4>
     <a id="_5">
     </a>
     核心思想
    </h4>
    <ul>
     <li>
      ​
      <strong>
       中介者模式
      </strong>
      ：通过
      <strong>
       中介者对象
      </strong>
      集中管理多个对象间的交互，使其
      <strong>
       无需直接引用彼此
      </strong>
      ，从而降低耦合度。
     </li>
     <li>
      ​
      <strong>
       关键用途
      </strong>
      ：
      <br/>
      ​1.
      <strong>
       解耦对象间依赖
      </strong>
      ：避免对象间形成复杂的网状引用关系。
      <br/>
      ​2.
      <strong>
       集中控制交互逻辑
      </strong>
      ：统一管理消息路由、权限校验等公共逻辑。
     </li>
    </ul>
    <h4>
     <a id="_10">
     </a>
     经典场景
    </h4>
    <ul>
     <li>
      聊天室（用户发送消息由聊天室中转）。
     </li>
     <li>
      飞机与塔台通信（所有通信通过塔台调度）。
     </li>
     <li>
      GUI组件交互（按钮点击触发面板显示，通过中介者协调）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2__15">
     </a>
     2. 模式结构解析
    </h3>
    <h4>
     <a id="UML_16">
     </a>
     UML类图
    </h4>
    <pre><code class="prism language-plaintext">+---------------------+          +---------------------+  
|      Mediator       |          |      Colleague      |  
+---------------------+          +---------------------+  
| + notify(sender, msg)|&lt;|---------| - mediator: Mediator |  
+---------------------+          +---------------------+  
          ^                                ^  
          |                                |  
  +-------+-------+              +---------+---------+  
  |               |              |                   |  
+---------------------+    +--------------------+ +--------------------+  
| ConcreteMediator    |    | ConcreteColleagueA | | ConcreteColleagueB |  
+---------------------+    +--------------------+ +--------------------+  
| + notify()          |    | + send()           | | + send()           |  
+---------------------+    +--------------------+ +--------------------+  
</code></pre>
    <h4>
     <a id="_33">
     </a>
     角色说明
    </h4>
    <ol>
     <li>
      <code>
       Mediator
      </code>
      ：中介者接口，定义对象间通信的方法（如
      <code>
       notify
      </code>
      ）。
     </li>
     <li>
      <code>
       ​ConcreteMediator
      </code>
      ：具体中介者，实现协调逻辑（如消息转发）。
     </li>
     <li>
      <code>
       Colleague
      </code>
      ：同事类接口，持有中介者引用，并通过中介者通信。
     </li>
     <li>
      <code>
       ConcreteColleague
      </code>
      ：具体同事类，触发事件并通知中介者。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="3_C_39">
     </a>
     3. 现代C++实现示例
    </h3>
    <h4>
     <a id="_40">
     </a>
     场景：聊天室消息中转
    </h4>
    <h5>
     <a id="1_41">
     </a>
     ​步骤1：定义中介者与同事接口
    </h5>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span>  </span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">;</span>  

<span class="token comment">// 中介者接口  </span>
<span class="token keyword">class</span> <span class="token class-name">ChatMediator</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">ChatMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">,</span> <span class="token keyword">const</span> User<span class="token operator">*</span> sender<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token comment">// 同事类接口  </span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token function">User</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> ChatMediator<span class="token operator">*</span> mediator<span class="token punctuation">)</span>  
        <span class="token operator">:</span> <span class="token function">name_</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mediator_</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  

    <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> name_ <span class="token operator">&lt;&lt;</span> <span class="token string">" 发送消息: "</span> <span class="token operator">&lt;&lt;</span> msg <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>  
        mediator_<span class="token operator">-&gt;</span><span class="token function">broadcast</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> name_ <span class="token operator">&lt;&lt;</span> <span class="token string">" 收到消息: "</span> <span class="token operator">&lt;&lt;</span> msg <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">protected</span><span class="token operator">:</span>  
    std<span class="token double-colon punctuation">::</span>string name_<span class="token punctuation">;</span>  
    ChatMediator<span class="token operator">*</span> mediator_<span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="2_79">
     </a>
     步骤2：实现具体中介者
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">ChatMediator</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        users_<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">,</span> <span class="token keyword">const</span> User<span class="token operator">*</span> sender<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> user <span class="token operator">:</span> users_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> sender<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 不将消息发送给自己  </span>
                user<span class="token operator">-&gt;</span><span class="token function">receive</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">private</span><span class="token operator">:</span>  
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>User<span class="token operator">&gt;&gt;</span> users_<span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="3_100">
     </a>
     步骤3：实现具体同事类（用户）
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">ChatUser</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">User</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">using</span> User<span class="token double-colon punctuation">::</span>User<span class="token punctuation">;</span>  

    <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[私信] "</span><span class="token punctuation">;</span>  
        <span class="token class-name">User</span><span class="token double-colon punctuation">::</span><span class="token function">receive</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="4_113">
     </a>
     步骤4：客户端代码
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">auto</span> chatRoom <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>ChatRoom<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">auto</span> alice <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>ChatUser<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> chatRoom<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">auto</span> bob <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>ChatUser<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> chatRoom<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    chatRoom<span class="token operator">-&gt;</span><span class="token function">addUser</span><span class="token punctuation">(</span>alice<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    chatRoom<span class="token operator">-&gt;</span><span class="token function">addUser</span><span class="token punctuation">(</span>bob<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    alice<span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"大家好！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    bob<span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"欢迎Alice！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token comment">/* 输出：  
Alice 发送消息: 大家好！  
[私信] Bob 收到消息: 大家好！  
Bob 发送消息: 欢迎Alice！  
[私信] Alice 收到消息: 欢迎Alice！  
*/</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="4__136">
     </a>
     4. 应用场景示例
    </h3>
    <h4>
     <a id="1GUI_137">
     </a>
     ​场景1：GUI组件交互（按钮与面板）
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Button</span><span class="token punctuation">;</span>  
<span class="token keyword">class</span> <span class="token class-name">Panel</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">GUIMediator</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">buttonClicked</span><span class="token punctuation">(</span>Button<span class="token operator">*</span> btn<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token function">Button</span><span class="token punctuation">(</span>GUIMediator<span class="token operator">*</span> mediator<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">mediator_</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  
    <span class="token keyword">void</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> mediator_<span class="token operator">-&gt;</span><span class="token function">buttonClicked</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  

<span class="token keyword">private</span><span class="token operator">:</span>  
    GUIMediator<span class="token operator">*</span> mediator_<span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">Panel</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">GUIMediator</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">buttonClicked</span><span class="token punctuation">(</span>Button<span class="token operator">*</span> btn<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"面板刷新显示\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h4>
     <a id="2_164">
     </a>
     场景2：航班调度系统
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Airplane</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">ControlTower</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Mediator</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">requestLanding</span><span class="token punctuation">(</span>Airplane<span class="token operator">*</span> plane<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"塔台允许 "</span> <span class="token operator">&lt;&lt;</span> plane<span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" 降落\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">Airplane</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token function">Airplane</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> id<span class="token punctuation">,</span> ControlTower<span class="token operator">*</span> tower<span class="token punctuation">)</span>  
        <span class="token operator">:</span> <span class="token function">id_</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">tower_</span><span class="token punctuation">(</span>tower<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  
    <span class="token keyword">void</span> <span class="token function">land</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> tower_<span class="token operator">-&gt;</span><span class="token function">requestLanding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> id_<span class="token punctuation">;</span> <span class="token punctuation">}</span>  

<span class="token keyword">private</span><span class="token operator">:</span>  
    std<span class="token double-colon punctuation">::</span>string id_<span class="token punctuation">;</span>  
    ControlTower<span class="token operator">*</span> tower_<span class="token punctuation">;</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="5__189">
     </a>
     5. 优缺点分析
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        ​优点
       </th>
       <th align="left">
        ​缺点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        减少对象间直接依赖，简化系统结构
       </td>
       <td align="left">
        中介者类可能变得臃肿（需处理所有交互）
       </td>
      </tr>
      <tr>
       <td align="left">
        新增同事类无需修改现有代码
       </td>
       <td align="left">
        中介者可能成为单点故障
       </td>
      </tr>
      <tr>
       <td align="left">
        集中管理交互逻辑（如权限、日志）
       </td>
       <td align="left">
        过度使用会掩盖对象间自然关系
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="6__196">
     </a>
     6. 调试与优化策略
    </h3>
    <h4>
     <a id="VS2022_197">
     </a>
     调试技巧（VS2022）​
    </h4>
    <h5>
     <a id="1__198">
     </a>
     1. ​跟踪消息路由：
    </h5>
    <ul>
     <li>
      在
      <code>
       broadcast()
      </code>
      方法内设置断点，观察消息是否被正确转发。
     </li>
    </ul>
    <h5>
     <a id="2__200">
     </a>
     2. 验证同事类状态：
    </h5>
    <ul>
     <li>
      使用 ​内存窗口 检查
      <code>
       User
      </code>
      对象的
      <code>
       mediator_
      </code>
      指针是否指向有效中介者。
     </li>
    </ul>
    <h4>
     <a id="_202">
     </a>
     性能优化
    </h4>
    <h5>
     <a id="1_203">
     </a>
     1.​异步消息处理：
    </h5>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;future&gt;</span>  </span>
<span class="token keyword">void</span> <span class="token class-name">ChatRoom</span><span class="token double-colon punctuation">::</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">,</span> <span class="token keyword">const</span> User<span class="token operator">*</span> sender<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    std<span class="token double-colon punctuation">::</span><span class="token function">async</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>launch<span class="token double-colon punctuation">::</span>async<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> user <span class="token operator">:</span> users_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> sender<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                user<span class="token operator">-&gt;</span><span class="token function">receive</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <h5>
     <a id="2__217">
     </a>
     2. 职责拆分：
    </h5>
    <ul>
     <li>
      将不同交互类型（如日志、权限）拆分到多个中介者子类中。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e637364:6e2e6e65742f4a7569637941637469766547696c626572742f:61727469636c652f64657461696c732f313436313433393236" class_="artid" style="display:none">
 </p>
</div>


