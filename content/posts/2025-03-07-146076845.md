---
layout: post
title: "服务器分区调整方案不影响服务"
date: 2025-03-07 09:44:08 +0800
description: "‌：数据备份与恢复占主要时间，分区调整通常在10分钟内完成。"
keywords: "服务器分区调整方案（不影响服务）"
categories: ['未分类']
tags: ['运维', '服务器']
artid: "146076845"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146076845
    alt: "服务器分区调整方案不影响服务"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146076845
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146076845
cover: https://bing.ee123.net/img/rand?artid=146076845
image: https://bing.ee123.net/img/rand?artid=146076845
img: https://bing.ee123.net/img/rand?artid=146076845
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     服务器分区调整方案（不影响服务）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     CentOS 7服务器调整root与home分区容量方案（不影响服务）
    </h4>
    <h5>
     一、操作前提与风险控制
    </h5>
    <ol>
     <li>
      ‌
      <strong>
       系统要求
      </strong>
      ‌：确认系统为CentOS 7，且使用LVM逻辑卷管理分区‌12。
     </li>
     <li>
      ‌
      <strong>
       文件系统类型
      </strong>
      ‌：若根分区和home分区均为XFS（默认类型），仅支持扩容不支持缩容‌45。
     </li>
     <li>
      ‌
      <strong>
       服务影响
      </strong>
      ‌：操作需卸载/home分区，建议在业务低峰期执行，并优先备份关键数据‌45。
     </li>
    </ol>
    <hr/>
    <h5>
     二、操作流程（无需重启服务）
    </h5>
    <ol>
     <li>
      <p>
       ‌
       <strong>
        备份/home数据（强制）
       </strong>
       ‌
       <br/>
       避免数据丢失，执行以下命令：
      </p>
      <pre><code class="language-bash">tar -czvf /tmp/home_backup.tar.gz /home  # 压缩备份至/tmp目录‌:ml-citation{ref="4,6" data="citationList"}
scp /tmp/home_backup.tar.gz user@backup-server:/path  # 传输至外部存储‌:ml-citation{ref="4" data="citationList"}
</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        查看分区状态
       </strong>
       ‌
       <br/>
       确认逻辑卷分布与文件系统类型：
      </p>
      <pre><code class="language-bash">df -Th  # 查看挂载点与容量
lvdisplay  # 检查逻辑卷详细信息（如VG名称、空闲空间）‌:ml-citation{ref="1,2" data="citationList"}</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        卸载/home分区
       </strong>
       ‌
       <br/>
       终止占用进程并卸载：
      </p>
      <pre><code class="language-bash">fuser -km /home  # 强制终止/home下的进程‌:ml-citation{ref="3,5" data="citationList"}
umount /home  # 卸载分区‌:ml-citation{ref="2,3" data="citationList"}</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        删除home逻辑卷
       </strong>
       ‌
       <br/>
       释放空间至卷组（VG）：
      </p>
      <pre><code class="language-bash">lvremove /dev/centos/home  # 确认操作后输入y‌:ml-citation{ref="1,2" data="citationList"}
vgdisplay  # 验证VG空闲空间是否增加‌:ml-citation{ref="1,5" data="citationList"}</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        扩展根分区
       </strong>
       ‌
       <br/>
       分配空闲空间并生效扩容：
      </p>
      <pre><code class="language-bash">lvextend -l +100%free /dev/centos/root  # 将全部空闲空间分配给root‌:ml-citation{ref="1,5" data="citationList"}
xfs_growfs /dev/centos/root  # 仅适用于XFS文件系统‌:ml-citation{ref="1,4" data="citationList"}</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        （可选）重建/home分区
       </strong>
       ‌
       <br/>
       若需保留/home，按需新建逻辑卷：
      </p>
      <pre><code class="language-bash">
lvcreate -L 200G -n home centos  # 分配指定容量（如200G）‌:ml-citation{ref="5" data="citationList"}
mkfs.xfs /dev/centos/home  # 格式化
mount /dev/centos/home /home  # 临时挂载‌:ml-citation{ref="5" data="citationList"}</code></pre>
      <p>
      </p>
     </li>
    </ol>
    <hr/>
    <h5>
     三、验证与恢复
    </h5>
    <ol>
     <li>
      <p>
       ‌
       <strong>
        检查分区状态
       </strong>
       ‌
      </p>
      <pre><code class="language-bash">df -Th # 确认root分区扩容成功‌:ml-citation{ref="2,5" data="citationList"}</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        恢复/home数据（若重建）
       </strong>
       ‌
      </p>
      <pre><code class="language-bash">tar -xzvf /tmp/home_backup.tar.gz -C /  # 解压备份数据‌:ml-citation{ref="4,6" data="citationList"}
</code></pre>
     </li>
     <li>
      <p>
       ‌
       <strong>
        更新/etc/fstab（重要）
       </strong>
       ‌
       <br/>
       若重建/home分区，需添加挂载配置防止重启失效：
      </p>
      <pre><code class="language-bash">echo "/dev/mapper/centos-home /home xfs defaults 0 0" &gt;&gt; /etc/fstab‌:ml-citation{ref="3,5" data="citationList"}
</code></pre>
     </li>
    </ol>
    <hr/>
    <h5>
     四、注意事项
    </h5>
    <ol>
     <li>
      ‌
      <strong>
       XFS限制
      </strong>
      ‌：XFS文件系统扩容后需立即执行
      <code>
       xfs_growfs
      </code>
      ，否则容量不生效‌14。
     </li>
     <li>
      ‌
      <strong>
       服务中断风险
      </strong>
      ‌：卸载/home时可能影响依赖/home路径的服务，建议提前通知或暂存临时文件至其他目录‌34。
     </li>
     <li>
      ‌
      <strong>
       LVM灵活性
      </strong>
      ‌：若需动态调整（如保留部分home空间），可使用
      <code>
       lvresize
      </code>
      结合
      <code>
       xfs_growfs
      </code>
      分阶段操作‌45。
     </li>
    </ol>
    <blockquote>
     <p>
      ‌
      <strong>
       操作耗时参考
      </strong>
      ‌：数据备份与恢复占主要时间，分区调整通常在10分钟内完成。
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34323238313634382f:61727469636c652f64657461696c732f313436303736383435" class_="artid" style="display:none">
 </p>
</div>


