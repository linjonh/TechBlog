---
arturl_encode: "68747470:733a2f2f626c6f672e6373646e2e6e65742f7777776d79312f:61727469636c652f64657461696c732f313436313535303132"
layout: post
title: "è°ƒè¯•æ­£å¸¸-è¿è¡Œæ­£å¸¸Keil5ä¸­MicroLIBçš„é‡å­æ€BUGç ´è§£å®å½•"
date: 2025-03-10 15:16:33 +0800
description: "ç°è±¡æè¿°ï¼šè°ƒè¯•ä¸çƒ§å½•çš„è¯¡å¼‚å·®å¼‚"
keywords: "è°ƒè¯•æ­£å¸¸ â‰  è¿è¡Œæ­£å¸¸ï¼šKeil5ä¸­MicroLIBçš„â€œé‡å­æ€BUGâ€ç ´è§£å®å½•"
categories: ['æœªåˆ†ç±»']
tags: ['åµŒå…¥å¼ç¡¬ä»¶', 'å•ç‰‡æœº', 'Stm', 'C', 'Arm']
artid: "146155012"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146155012
    alt: "è°ƒè¯•æ­£å¸¸-è¿è¡Œæ­£å¸¸Keil5ä¸­MicroLIBçš„é‡å­æ€BUGç ´è§£å®å½•"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146155012
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146155012
cover: https://bing.ee123.net/img/rand?artid=146155012
image: https://bing.ee123.net/img/rand?artid=146155012
img: https://bing.ee123.net/img/rand?artid=146155012
---

# è°ƒè¯•æ­£å¸¸ â‰  è¿è¡Œæ­£å¸¸ï¼šKeil5ä¸­MicroLIBçš„â€œé‡å­æ€BUGâ€ç ´è§£å®å½•

## è°ƒè¯•æ­£å¸¸ â‰  è¿è¡Œæ­£å¸¸ï¼šKeil5ä¸­MicroLIBçš„â€œé‡å­æ€BUGâ€ç ´è§£å®å½•â€”â€”ä»å‹¾é€‰ä¸€ä¸ªé€‰é¡¹åˆ°ç†è§£åŠä¸»æœºæ¨¡å¼ï¼ŒåµŒå…¥å¼å¼€å‘çš„è®¤çŸ¥å‡çº§

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/8ebadfc1656c47d58d9e6900f700725d.png)

### ğŸ“Œ ç°è±¡æè¿°ï¼šè°ƒè¯•ä¸çƒ§å½•çš„è¯¡å¼‚å·®å¼‚

```diff
+ åœ¨çº¿è°ƒè¯•æ—¶ ç¨‹åºæ­£å¸¸è¿è¡Œ
- ç‹¬ç«‹è¿è¡Œæ—¶ è®¾å¤‡æ— å“åº”
! ç¼–è¯‘è¿‡ç¨‹ 0 Error / 0 Warning

```

### ğŸ” é—®é¢˜æ ¹æºï¼šæ ‡å‡†åº“çš„ä¸‰å¤§è‡´å‘½é™·é˜±

#### ğŸš© é™·é˜±1ï¼šåŠä¸»æœºæ¨¡å¼ï¼ˆSemihostingï¼‰ä¾èµ–

```c
// å±é™©å‡½æ•°ç¤ºä¾‹
printf("Value: %d", data);  // ğŸ“¡ ä¾èµ–ä¸»æœºé€šä¿¡

```

ğŸ”º
**è°ƒè¯•æ¨¡å¼**
ï¼šé€šè¿‡IDEä»£ç†é€šä¿¡
  
ğŸ”»
**ç‹¬ç«‹è¿è¡Œ**
ï¼šæ— ä¸»æœºè¿æ¥è§¦å‘HardFault

#### ğŸš© é™·é˜±2ï¼šå†…å­˜ç®¡ç†å¤±æ§

```armasm
; å¯åŠ¨æ–‡ä»¶å†…å­˜é…ç½®
Stack_Size EQU 0x400   â—€â”€â”
Heap_Size  EQU 0x200    â—€â”€â”´â”€ å¤šæ•°é¡¹ç›®éœ€è¦è°ƒæ•´

```

#### ğŸš© é™·é˜±3ï¼šç³»ç»Ÿè°ƒç”¨ç¼ºå¤±

```c
void main() {
    // ...
    return;  // ğŸ’¥ è§¦å‘æœªå®ç°çš„exit()
}

```

### ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šMicroLIBçš„ä¸‰å¤§é­”æ³•

#### é­”æ³•1ï¼šğŸš« ç¦ç”¨åŠä¸»æœºæ¨¡å¼

Yes







No














Yes







No









printfè°ƒç”¨








MicroLIBæ¨¡å¼?








ç›´æ¥ç¡¬ä»¶è¾“å‡º








å°è¯•åŠä¸»æœºé€šä¿¡








è°ƒè¯•å™¨è¿æ¥?








æ­£å¸¸æ˜¾ç¤º








ç¨‹åºå´©æºƒ

#### é­”æ³•2ï¼šğŸ“‰ ç²¾ç®€å†…å­˜æ¨¡å‹

| æ¨¡å— | æ ‡å‡†åº“ | MicroLIB | èŠ‚çœç‡ |
| --- | --- | --- | --- |
| `printf` | 8.2KB | 1.5KB | 81.7% |
| å†…å­˜ç®¡ç† | 3.8KB | 0.5KB | 86.8% |
| ç³»ç»Ÿè°ƒç”¨ | 2.1KB | 0.2KB | 90.5% |

#### é­”æ³•3ï¼šğŸ”„ å®‰å…¨é€€å‡ºæœºåˆ¶

```c
void exit(int code) {
    while(1) { /* å®‰å…¨é”æ­» */ }  // ğŸ”’ æ›¿ä»£å´©æºƒ
}

```

### âš¡ å®æˆ˜é…ç½®ï¼šKeil5ä¼˜åŒ–å››æ­¥æ³•

1. **å¯ç”¨MicroLIB**
2. **å †æ ˆå®‰å…¨é…ç½®**

   ```diff
   // startup_stm32f10x.s
   - Stack_Size EQU 0x00000200
   + Stack_Size EQU 0x00000400  // âœ… æ¨è1KB

   ```
3. **I/Oé‡å®šå‘æ¨¡æ¿**

   ```c
   // ä¸²å£é‡å®šå‘æ¶æ„
   [PCç»ˆç«¯] â—€â”€â”€â”€â”
               â–¼
   printf() â†’ USART â†’ [ç¡¬ä»¶ä¸²å£]

   ```
4. **è°ƒè¯•éªŒè¯æŠ€å·§**

   ```armasm
   BL __heap_initialized  // ğŸ” æ£€æµ‹å †åˆå§‹åŒ–
   CMP R0, #0
   BEQ ErrorHandler

   ```