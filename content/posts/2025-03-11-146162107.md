---
layout: post
title: "FFmpeg入门最简单的音视频播放器Plus优化版"
date: 2025-03-11 10:03:28 +0800
description: "音视频同步的音视频播放器"
keywords: "FFmpeg入门：最简单的音视频播放器（Plus优化版）"
categories: ['未分类']
tags: ['音视频', 'Ffmpeg']
artid: "146162107"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146162107
    alt: "FFmpeg入门最简单的音视频播放器Plus优化版"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146162107
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146162107
cover: https://bing.ee123.net/img/rand?artid=146162107
image: https://bing.ee123.net/img/rand?artid=146162107
img: https://bing.ee123.net/img/rand?artid=146162107
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     FFmpeg入门：最简单的音视频播放器（Plus优化版）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="FFmpegPlus_0">
     </a>
     FFmpeg入门：最简单的音视频播放器（Plus优化版）
    </h2>
    <p>
     今天我们继续学习FFmpeg的入门，咱们主要是从上一期的音频播放器的基础上进行了部分优化。没有看过上期讲解的朋友可以去回顾一下，链接放下面了。
     <br/>
     <a href="https://blog.csdn.net/m0_51433562/article/details/145999242?spm=1001.2014.3001.5502">
      FFmpeg入门：最简单的音视频播放器
     </a>
    </p>
    <p>
     本期我们对上次遗留的问题进行优化，从而丰富音视频播放器的性能；主要解决下面两个问题，一个一个的进行解决。
    </p>
    <blockquote>
     <ol>
      <li>
       时钟同步怎么做
      </li>
      <li>
       如何边读出packet，边解码frame并播放
      </li>
     </ol>
    </blockquote>
    <h3>
     <a id="_9">
     </a>
     音视频时钟同步
    </h3>
    <p>
     其实音视频同步是我学ffmpeg的时候最早困惑我的一个问题，啥叫做音视频同步啊，怎么同步啊，依据什么进行同步啊？这些问题都让我充满了大大的问号，因此为了让一些和我一样是初学者的朋友能够一起入个门，我尽量讲的通俗易懂一些。
    </p>
    <p>
     <strong>
      首先什么是音视频同步？
     </strong>
     <br/>
     实际上对于常见的多媒体文件来说，通常分为
     <mark>
      音频流和视频流（偶尔还会有个字幕流）
     </mark>
     ，具象的来看就是我们经常在视频剪辑软件下面看到的那几个轨道，其实每个轨道都有对应的音频流或者视频流。
    </p>
    <p>
     居然是不同的轨道，那么他们自己就有自己的运行速度，如果说我们不对音频和视频的播放速度进行同步和调整，那么就会出现我们常说的
     <mark>
      音画不同步
     </mark>
     的现象，观感非常难受。
     <br/>
     <img alt="剪映" src="https://i-blog.csdnimg.cn/direct/062c201e5d2645feacaafc53c12b06ed.png"/>
    </p>
    <p>
     <strong>
      如何实现音视频同步？
     </strong>
     <br/>
     那么我们要如何实现音视频同步呢？其实这就是一个简单的你追我赶的事情。好比现在音频和视频是两位100米选手，要尽可能让二者在奔跑的过程中处于同一个位置。那么我们就要不断的调整。
    </p>
    <p>
     比如现在选手A跑快了，选手B就要加快速度赶上他；选手A跑慢了，选手B就要减慢速度等待他。反过来依然如此。同理到音视频同步，二者之间会有一个作为参照着，比如音频为参照物，那么视频流就会不断检查当前的位置和音频的位置是否有差别，
     <mark>
      如果快了就延迟，慢了就丢帧
     </mark>
     。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/268e9c27db8649d8a547227b6ab30913.png">
      <br/>
      <strong>
       同步相关参数概念
      </strong>
      <br/>
      介绍几个用于音视频同步的核心参数，帮助大家在使用ffpmeg实际运用
     </img>
    </p>
    <blockquote>
     <p>
      time_base：时间基，定义时间戳的单位，和pts息息相关，广泛应用于音视频流处理的各个方面。
      <br/>
      pts：即呈现时间戳，表示每个视频或音频帧在播放时应该出现在时间轴上的具体时间。
      <br/>
      dts：即解码时间戳。DTS 指示每个视频或音频帧应该在什么时候被送到解码器进行解码。
     </p>
    </blockquote>
    <p>
     <strong>
      实现
     </strong>
     <br/>
     具体实现也非常简单，我们以音频时间戳作为参照（
     <mark>
      人对于音频的抖动更加敏感
     </mark>
     ，通过都会选择按照音频时间戳为准），分为下面几步。
    </p>
    <blockquote>
     <ol>
      <li>
       在音频和时间的解码线程中，增加更新当前时间戳的步骤。即没解码一帧，都会获取当前帧的时间戳
      </li>
      <li>
       在视频解码线程中，额外增加和音频时间戳对比的过程。
      </li>
      <li>
       如果视频时间戳大于音频时间戳，丢帧处理；如果小于音频时间戳，延迟处理。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9c0c517b12b6442b87240add2fbb1209.png"/>
      </li>
     </ol>
    </blockquote>
    <p>
     相关代码如下：
    </p>
    <p>
     更新视频和音频的时间戳方法
    </p>
    <pre><code class="prism language-c"><span class="token comment">/**
 更新当前的视频时钟
 */</span>
<span class="token keyword">void</span> <span class="token function">get_current_video_time</span><span class="token punctuation">(</span>VideoState<span class="token operator">*</span> video_state<span class="token punctuation">,</span> AVFrame<span class="token operator">*</span> frame<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	AVFormatContext<span class="token operator">*</span> formatCtx <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token punctuation">;</span>
	AVRational time_base <span class="token operator">=</span> formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>video_state<span class="token operator">-&gt;</span>videoStream<span class="token punctuation">]</span><span class="token operator">-&gt;</span>time_base<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>frame<span class="token operator">-&gt;</span>pts <span class="token operator">!=</span> AV_NOPTS_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>timestamp <span class="token operator">=</span> <span class="token punctuation">(</span>Uint32<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">av_q2d</span><span class="token punctuation">(</span>time_base<span class="token punctuation">)</span><span class="token operator">*</span>frame<span class="token operator">-&gt;</span>pts<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>timestamp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 更新当前的音频时钟
 */</span>
<span class="token keyword">void</span> <span class="token function">get_current_audio_time</span><span class="token punctuation">(</span>VideoState<span class="token operator">*</span> video_state<span class="token punctuation">,</span> AVFrame<span class="token operator">*</span> frame<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	AVFormatContext<span class="token operator">*</span> formatCtx <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token punctuation">;</span>
	AVRational time_base <span class="token operator">=</span> formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>video_state<span class="token operator">-&gt;</span>audioStream<span class="token punctuation">]</span><span class="token operator">-&gt;</span>time_base<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>frame<span class="token operator">-&gt;</span>pts <span class="token operator">!=</span> AV_NOPTS_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		video_state<span class="token operator">-&gt;</span>audioParam<span class="token operator">-&gt;</span>timestamp <span class="token operator">=</span> <span class="token punctuation">(</span>Uint32<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">av_q2d</span><span class="token punctuation">(</span>time_base<span class="token punctuation">)</span> <span class="token operator">*</span> frame<span class="token operator">-&gt;</span>pts<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		video_state<span class="token operator">-&gt;</span>audioParam<span class="token operator">-&gt;</span>timestamp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     音频解码过程中的处理
    </p>
    <pre><code class="prism language-c"><span class="token comment">// 更新音频时钟</span>
<span class="token function">get_current_audio_time</span><span class="token punctuation">(</span>video_state<span class="token punctuation">,</span> pFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     视频解码过程中的处理
    </p>
    <pre><code class="prism language-c">	<span class="token comment">// 更新时钟</span>
	<span class="token function">get_current_video_time</span><span class="token punctuation">(</span>video_state<span class="token punctuation">,</span> pFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 视频同步音频时钟</span>
	Uint32 audio_timestamp <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>audioParam<span class="token operator">-&gt;</span>timestamp<span class="token punctuation">;</span>
	Uint32 video_timestamp <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>timestamp<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>video_timestamp <span class="token operator">&gt;</span> audio_timestamp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">SDL_Delay</span><span class="token punctuation">(</span>video_timestamp<span class="token operator">-</span>audio_timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 延迟视频戳和音频戳的差值</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>video_timestamp <span class="token operator">&lt;</span> audio_timestamp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="packet_91">
     </a>
     优化packet读和解码线程
    </h3>
    <p>
     第二部分就是提高效率，上一期我们做的音视频播放器中，有一个明显的效率问题。我们是将所有的packet读入到队列之后再进行解码和显示。这就导致整个预加载过程非常慢，尤其是对于帧数较多的视频来说。
    </p>
    <p>
     为了解决这个问题，我们对线程进行进一步优化。拆出单独的read_thread线程专门用来读取packet。如图所示
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f8d285b85abb4494af6929f05e070223.png"/>
    </p>
    <h3>
     <a id="_96">
     </a>
     代码实现
    </h3>
    <p>
     主要看main函数就好，其他几个c文件和上期保持一致
    </p>
    <pre><code class="prism language-c"><span class="token comment">//</span>
<span class="token comment">//  main.c</span>
<span class="token comment">//  sample_player</span>
<span class="token comment">//</span>
<span class="token comment">//  Created by chenhuaiyi on 2025/2/26.</span>
<span class="token comment">//</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"utils.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"manager.h"</span></span>

AudioInfo audio_info<span class="token punctuation">;</span>

<span class="token comment">/* udata: 传入的参数
 * stream: SDL音频缓冲区
 * len: SDL音频缓冲区大小
 * 回调函数
 */</span>
<span class="token keyword">void</span> <span class="token function">fill_audio</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>udata<span class="token punctuation">,</span> Uint8 <span class="token operator">*</span>stream<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">SDL_memset</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">// 必须重置，不然全是电音!!!</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audio_info<span class="token punctuation">.</span>audio_len<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>					<span class="token comment">// 有音频数据时才调用</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	len <span class="token operator">=</span> <span class="token punctuation">(</span>len<span class="token operator">&gt;</span>audio_info<span class="token punctuation">.</span>audio_len <span class="token operator">?</span> audio_info<span class="token punctuation">.</span>audio_len <span class="token operator">:</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 最多填充缓冲区大小的数据</span>
	<span class="token function">SDL_MixAudio</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> audio_info<span class="token punctuation">.</span>audio_pos<span class="token punctuation">,</span> len<span class="token punctuation">,</span> SDL_MIX_MAXVOLUME<span class="token punctuation">)</span><span class="token punctuation">;</span>
	audio_info<span class="token punctuation">.</span>audio_pos <span class="token operator">+=</span> len<span class="token punctuation">;</span>
	audio_info<span class="token punctuation">.</span>audio_len <span class="token operator">-=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 音频解码线程
 */</span>
<span class="token keyword">int</span> <span class="token function">audio_thread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**
	 1. 从packet_queue队列中取出packet
	 2. 将packet进行解码
	 3. 写入到sdl的缓冲区中
	 */</span>
	VideoState<span class="token operator">*</span> video_state <span class="token operator">=</span> <span class="token punctuation">(</span>VideoState<span class="token operator">*</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>
	AudioParam<span class="token operator">*</span> audio_param <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>audioParam<span class="token punctuation">;</span>
	PacketQueue<span class="token operator">*</span> queue <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>aQueue<span class="token punctuation">;</span>
	audio_param<span class="token operator">-&gt;</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	AVPacket 	packet<span class="token punctuation">;</span>
	<span class="token keyword">int</span> 		ret<span class="token punctuation">;</span>
	AVFrame<span class="token operator">*</span> 	pFrame <span class="token operator">=</span> <span class="token function">av_frame_alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>video_state<span class="token operator">-&gt;</span>isReadEnd <span class="token operator">||</span> queue<span class="token operator">-&gt;</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			
			<span class="token function">packet_queue_pop</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将packet写入编解码器</span>
			ret <span class="token operator">=</span> <span class="token function">avcodec_send_packet</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> ret <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"send packet error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// 获取解码后的帧</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">avcodec_receive_frame</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token punctuation">,</span> pFrame<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 格式转化</span>
				<span class="token function">swr_convert</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>swrCtx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>audio_param<span class="token operator">-&gt;</span>out_buffer<span class="token punctuation">,</span> audio_param<span class="token operator">-&gt;</span>out_buffer_size<span class="token punctuation">,</span>
							<span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">uint8_t</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>pFrame<span class="token operator">-&gt;</span>data<span class="token punctuation">,</span> pFrame<span class="token operator">-&gt;</span>nb_samples<span class="token punctuation">)</span><span class="token punctuation">;</span>
				audio_param<span class="token operator">-&gt;</span>index<span class="token operator">++</span><span class="token punctuation">;</span>
				<span class="token comment">// 更新音频时钟</span>
				<span class="token function">get_current_audio_time</span><span class="token punctuation">(</span>video_state<span class="token punctuation">,</span> pFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第%d音频帧 \t 帧大小(采样点):%d  \t pts:%lld \t 预期播放点:%.2fs\n"</span><span class="token punctuation">,</span>
					   audio_param<span class="token operator">-&gt;</span>index<span class="token punctuation">,</span>
					   packet<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
					   packet<span class="token punctuation">.</span>pts<span class="token punctuation">,</span>
					   <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> audio_param<span class="token operator">-&gt;</span>timestamp <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">USE_SDL</span></span>
				<span class="token comment">// 设置读取的音频数据</span>
				audio_info<span class="token punctuation">.</span>audio_len <span class="token operator">=</span> audio_param<span class="token operator">-&gt;</span>out_buffer_size<span class="token punctuation">;</span>
				audio_info<span class="token punctuation">.</span>audio_pos <span class="token operator">=</span> <span class="token punctuation">(</span>Uint8 <span class="token operator">*</span><span class="token punctuation">)</span> audio_param<span class="token operator">-&gt;</span>out_buffer<span class="token punctuation">;</span>
				<span class="token comment">// 等待SDL播放完成</span>
				<span class="token keyword">while</span><span class="token punctuation">(</span>audio_info<span class="token punctuation">.</span>audio_len <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
					<span class="token function">SDL_Delay</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
			<span class="token punctuation">}</span>
			<span class="token function">av_packet_unref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">av_frame_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 结束</span>
	video_state<span class="token operator">-&gt;</span>isEnd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 视频解码线程
 */</span>
<span class="token keyword">int</span> <span class="token function">video_thread</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**
	 1. 从视频pkt队列中读出packet
	 2. 送入解码器解码并取出
	 3. 使用SDL进行渲染
	 4. 根据pts计算延迟SDL_DELAY
	 */</span>
	VideoState<span class="token operator">*</span> 	video_state <span class="token operator">=</span> <span class="token punctuation">(</span>VideoState<span class="token operator">*</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>
	PacketQueue<span class="token operator">*</span> 	video_queue <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>vQueue<span class="token punctuation">;</span>
	AVCodecContext<span class="token operator">*</span> pCodecCtx <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token punctuation">;</span>
	AVFrame<span class="token operator">*</span> 		out_frame <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>out_frame<span class="token punctuation">;</span>
	
	AVPacket packet<span class="token punctuation">;</span>
	AVFrame<span class="token operator">*</span> pFrame <span class="token operator">=</span> <span class="token function">av_frame_alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>video_state<span class="token operator">-&gt;</span>isReadEnd <span class="token operator">||</span> video_queue<span class="token operator">-&gt;</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">packet_queue_pop</span><span class="token punctuation">(</span>video_queue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 将packet写入编解码器</span>
			<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">avcodec_send_packet</span><span class="token punctuation">(</span>pCodecCtx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"packet resolve error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 从解码器中取出原始帧</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">avcodec_receive_frame</span><span class="token punctuation">(</span>pCodecCtx<span class="token punctuation">,</span> pFrame<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 帧格式转化，转为YUV420P</span>
				<span class="token function">sws_scale</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>swsCtx<span class="token punctuation">,</span>						<span class="token comment">// sws_context转换</span>
						  <span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token keyword">const</span> <span class="token operator">*</span> <span class="token keyword">const</span> <span class="token operator">*</span><span class="token punctuation">)</span>pFrame<span class="token operator">-&gt;</span>data<span class="token punctuation">,</span>	<span class="token comment">// 输入 data</span>
						  pFrame<span class="token operator">-&gt;</span>linesize<span class="token punctuation">,</span>							<span class="token comment">// 输入 每行数据的大小（对齐）</span>
						  <span class="token number">0</span><span class="token punctuation">,</span>										<span class="token comment">// 输入 Y轴位置</span>
						  pCodecCtx<span class="token operator">-&gt;</span>height<span class="token punctuation">,</span>						<span class="token comment">// 输入 height</span>
						  out_frame<span class="token operator">-&gt;</span>data<span class="token punctuation">,</span>							<span class="token comment">// 输出 data</span>
						  out_frame<span class="token operator">-&gt;</span>linesize<span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">// 输出 linesize</span>
				
				<span class="token comment">// 帧更新</span>
				video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>frame_update <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
				
				<span class="token comment">// 更新时钟</span>
				<span class="token function">get_current_video_time</span><span class="token punctuation">(</span>video_state<span class="token punctuation">,</span> pFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 视频同步音频时钟</span>
				Uint32 audio_timestamp <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>audioParam<span class="token operator">-&gt;</span>timestamp<span class="token punctuation">;</span>
				Uint32 video_timestamp <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>timestamp<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>video_timestamp <span class="token operator">&gt;</span> audio_timestamp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">SDL_Delay</span><span class="token punctuation">(</span>video_timestamp<span class="token operator">-</span>audio_timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 延迟视频戳和音频戳的差值</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>video_timestamp <span class="token operator">&lt;</span> audio_timestamp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">continue</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				
				video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>index<span class="token operator">++</span><span class="token punctuation">;</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第%i视频帧 \t 帧类型(I/P/B):%s帧 \t pts:%d \t 预期播放点:%.2fs\n"</span><span class="token punctuation">,</span>
					   video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>index<span class="token punctuation">,</span>
					   <span class="token function">get_frame_type</span><span class="token punctuation">(</span>pFrame<span class="token punctuation">)</span><span class="token punctuation">,</span>
					   <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> pFrame<span class="token operator">-&gt;</span>pts<span class="token punctuation">,</span>
					   <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span> video_timestamp <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token function">av_packet_unref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">av_frame_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 结束</span>
	video_state<span class="token operator">-&gt;</span>isEnd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 读取packet进程
 */</span>
<span class="token keyword">int</span> <span class="token function">read_thread</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	VideoState<span class="token operator">*</span> video_state <span class="token operator">=</span> <span class="token punctuation">(</span>VideoState<span class="token operator">*</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>
	
	AVPacket<span class="token operator">*</span> packet <span class="token operator">=</span> <span class="token function">av_packet_alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// packet初始化</span>
	
	<span class="token comment">// 循环1: 从文件中读取packet</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">av_read_frame</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token punctuation">,</span> packet<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token comment">/** 写入音频pkt队列 */</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>packet<span class="token operator">-&gt;</span>stream_index<span class="token operator">==</span>video_state<span class="token operator">-&gt;</span>audioStream<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">packet_queue_push</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aQueue<span class="token punctuation">,</span> packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">/** 写入视频pkt队列 */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>packet<span class="token operator">-&gt;</span>stream_index<span class="token operator">==</span>video_state<span class="token operator">-&gt;</span>videoStream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">packet_queue_push</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>vQueue<span class="token punctuation">,</span> packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">av_packet_unref</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">av_packet_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">// 释放packet空间</span>
	
	video_state<span class="token operator">-&gt;</span>isReadEnd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>				<span class="token comment">// 读取线程已结束</span>
	
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	
	VideoState<span class="token operator">*</span> 		video_state<span class="token punctuation">;</span>
	AudioParam<span class="token operator">*</span>			audio_param<span class="token punctuation">;</span>
	VideoParam<span class="token operator">*</span>			video_param<span class="token punctuation">;</span>
	
	SDL_Event 			event<span class="token punctuation">;</span>
	SDL_Rect      		rect<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Usage: test &lt;file&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/** 初始化函数 */</span>
	<span class="token function">init_video_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	audio_param <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>audioParam<span class="token punctuation">;</span>
	video_param <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>videoParam<span class="token punctuation">;</span>
	
	<span class="token function">avformat_network_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 1. 打开视频文件，获取格式上下文</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">avformat_open_input</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Couldn't open input stream.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 2. 对文件探测流信息</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">avformat_find_stream_info</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Couldn't find stream information.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 打印信息</span>
	<span class="token function">av_dump_format</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 3. 找到对应的 音频流/视频流 索引</span>
	video_state<span class="token operator">-&gt;</span>audioStream<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	video_state<span class="token operator">-&gt;</span>videoStream<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>nb_streams<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>codecpar<span class="token operator">-&gt;</span>codec_type<span class="token operator">==</span>AVMEDIA_TYPE_AUDIO<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			video_state<span class="token operator">-&gt;</span>audioStream<span class="token operator">=</span>i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-&gt;</span>codecpar<span class="token operator">-&gt;</span>codec_type<span class="token operator">==</span>AVMEDIA_TYPE_VIDEO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			video_state<span class="token operator">-&gt;</span>videoStream<span class="token operator">=</span>i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>audioStream<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Didn't find a audio stream.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>videoStream<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Didn't find a video stream.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 4. 将 音频流/视频流 编码参数写入上下文</span>
	AVCodecParameters<span class="token operator">*</span> aCodecParam <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>video_state<span class="token operator">-&gt;</span>audioStream<span class="token punctuation">]</span><span class="token operator">-&gt;</span>codecpar<span class="token punctuation">;</span>
	<span class="token function">avcodec_parameters_to_context</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token punctuation">,</span> aCodecParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	AVCodecParameters<span class="token operator">*</span> vCodecParam <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>video_state<span class="token operator">-&gt;</span>videoStream<span class="token punctuation">]</span><span class="token operator">-&gt;</span>codecpar<span class="token punctuation">;</span>
	<span class="token function">avcodec_parameters_to_context</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token punctuation">,</span> vCodecParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 5. 查找流的编码器</span>
	video_state<span class="token operator">-&gt;</span>aCodec <span class="token operator">=</span> <span class="token function">avcodec_find_decoder</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>codec_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodec<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Audio codec not found.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	video_state<span class="token operator">-&gt;</span>vCodec <span class="token operator">=</span> <span class="token function">avcodec_find_decoder</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>codec_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>vCodec<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Video codec not found.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 6. 打开流的编解码器</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">avcodec_open2</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>aCodec<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Could not open audio codec.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">avcodec_open2</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>vCodec<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Could not open video codec.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/** 音频输出信息构建 */</span>
	<span class="token function">audio_output_set</span><span class="token punctuation">(</span>video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/** 视频输出信息构建 */</span>
	<span class="token function">video_output_set</span><span class="token punctuation">(</span>video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	<span class="token comment">//	SDL 初始化</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">USE_SDL</span></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">SDL_Init</span><span class="token punctuation">(</span>SDL_INIT_VIDEO <span class="token operator">|</span> SDL_INIT_AUDIO <span class="token operator">|</span> SDL_INIT_TIMER<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"Could not initialize SDL - %s\n"</span><span class="token punctuation">,</span> <span class="token function">SDL_GetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 在 main 函数开始处添加</span>
	<span class="token function">SDL_SetHint</span><span class="token punctuation">(</span>SDL_HINT_VIDEO_MAC_FULLSCREEN_SPACES<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDL_SetHint</span><span class="token punctuation">(</span>SDL_HINT_MAC_BACKGROUND_APP<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/** 初始化音频SDL设备 */</span>
	SDL_AudioSpec wanted_spec<span class="token punctuation">;</span>
	<span class="token comment">//	audio_sdl_set(video_state, &amp;wanted_spec, fill_audio);</span>
	wanted_spec<span class="token punctuation">.</span>freq <span class="token operator">=</span> audio_param<span class="token operator">-&gt;</span>out_sample_rate<span class="token punctuation">;</span>					<span class="token comment">// 采样率</span>
	wanted_spec<span class="token punctuation">.</span>format <span class="token operator">=</span> AUDIO_S16SYS<span class="token punctuation">;</span>									<span class="token comment">// 采样格式 16bit</span>
	wanted_spec<span class="token punctuation">.</span>channels <span class="token operator">=</span> audio_param<span class="token operator">-&gt;</span>out_channels<span class="token punctuation">;</span>					<span class="token comment">// 通道数</span>
	wanted_spec<span class="token punctuation">.</span>silence <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	wanted_spec<span class="token punctuation">.</span>samples <span class="token operator">=</span> audio_param<span class="token operator">-&gt;</span>out_nb_samples<span class="token punctuation">;</span>					<span class="token comment">// 单帧处理的采样点</span>
	wanted_spec<span class="token punctuation">.</span>callback <span class="token operator">=</span> fill_audio<span class="token punctuation">;</span>									<span class="token comment">// 回调函数</span>
	wanted_spec<span class="token punctuation">.</span>userdata <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token punctuation">;</span>						<span class="token comment">// 回调函数的参数</span>
	
	<span class="token comment">/** 初始化视频SDL设备 */</span>
	SDL_Window<span class="token operator">*</span>       window <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	SDL_Renderer<span class="token operator">*</span>     renderer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	SDL_Texture<span class="token operator">*</span>      texture<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token comment">//	video_sdl_set(video_state, &amp;window, &amp;renderer, &amp;texture);</span>
	<span class="token comment">/** 窗口 */</span>
	window <span class="token operator">=</span> <span class="token function">SDL_CreateWindow</span><span class="token punctuation">(</span><span class="token string">"SDL2 window"</span><span class="token punctuation">,</span>
							  SDL_WINDOWPOS_CENTERED<span class="token punctuation">,</span>
							  SDL_WINDOWPOS_CENTERED<span class="token punctuation">,</span>
							  video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>width<span class="token punctuation">,</span>
							  video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>height<span class="token punctuation">,</span>
							  SDL_WINDOW_SHOWN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SDL_CreateWindow Error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">SDL_GetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SDL_Quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/** 渲染 */</span>
	renderer <span class="token operator">=</span> <span class="token function">SDL_CreateRenderer</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span>
								  <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
								  SDL_RENDERER_ACCELERATED <span class="token operator">|</span> SDL_RENDERER_PRESENTVSYNC<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>renderer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"SDL_CreateRenderer Error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">SDL_GetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SDL_DestroyWindow</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">SDL_Quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/** 纹理 */</span>
	texture <span class="token operator">=</span> <span class="token function">SDL_CreateTexture</span><span class="token punctuation">(</span>renderer<span class="token punctuation">,</span>
								SDL_PIXELFORMAT_YV12<span class="token punctuation">,</span>
								SDL_TEXTUREACCESS_STREAMING<span class="token punctuation">,</span>
								video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>width<span class="token punctuation">,</span>
								video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 打开音频播放器</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">SDL_OpenAudio</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wanted_spec<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"can't open audio.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	
	<span class="token comment">// 音频上下文格式转换</span>
	<span class="token function">swr_alloc_set_opts2</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>video_state<span class="token operator">-&gt;</span>swrCtx<span class="token punctuation">,</span>
						<span class="token operator">&amp;</span>audio_param<span class="token operator">-&gt;</span>out_channel_layout<span class="token punctuation">,</span>			<span class="token comment">// 输出layout</span>
						audio_param<span class="token operator">-&gt;</span>out_sample_fmt<span class="token punctuation">,</span>				<span class="token comment">// 输出格式</span>
						audio_param<span class="token operator">-&gt;</span>out_sample_rate<span class="token punctuation">,</span>				<span class="token comment">// 输出采样率</span>
						<span class="token operator">&amp;</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>ch_layout<span class="token punctuation">,</span>			<span class="token comment">// 输入layout</span>
						video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>sample_fmt<span class="token punctuation">,</span>			<span class="token comment">// 输入格式</span>
						video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>sample_rate<span class="token punctuation">,</span>		<span class="token comment">// 输入采样率</span>
						<span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">swr_init</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>swrCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 视频上下文格式转换</span>
	video_state<span class="token operator">-&gt;</span>swsCtx <span class="token operator">=</span> <span class="token function">sws_getContext</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>width<span class="token punctuation">,</span>			<span class="token comment">// src 宽</span>
										 video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>height<span class="token punctuation">,</span>		<span class="token comment">// src 高</span>
										 video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>pix_fmt<span class="token punctuation">,</span>		<span class="token comment">// src 格式</span>
										 video_param<span class="token operator">-&gt;</span>width<span class="token punctuation">,</span>					<span class="token comment">// dst 宽</span>
										 video_param<span class="token operator">-&gt;</span>height<span class="token punctuation">,</span>					<span class="token comment">// dst 高</span>
										 video_param<span class="token operator">-&gt;</span>pix_fmt<span class="token punctuation">,</span>					<span class="token comment">// dst 格式</span>
										 SWS_BILINEAR<span class="token punctuation">,</span>
										 <span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 开始播放</span>
	<span class="token function">SDL_PauseAudio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">int64_t</span> av_start_time <span class="token operator">=</span> <span class="token function">av_gettime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 播放开始时间戳</span>
	
	<span class="token function">SDL_CreateThread</span><span class="token punctuation">(</span>read_thread<span class="token punctuation">,</span> <span class="token string">"read_thread"</span><span class="token punctuation">,</span> video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 创建一个线程并启动</span>
	<span class="token function">SDL_CreateThread</span><span class="token punctuation">(</span>audio_thread<span class="token punctuation">,</span> <span class="token string">"audio_thread"</span><span class="token punctuation">,</span> video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDL_CreateThread</span><span class="token punctuation">(</span>video_thread<span class="token punctuation">,</span> <span class="token string">"video_thread"</span><span class="token punctuation">,</span> video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//	video_thread(video_state);</span>
	
	AVFrame<span class="token operator">*</span> out_frame <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>video_state<span class="token operator">-&gt;</span>isEnd<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 处理事件（必须由主线程执行）</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">SDL_PollEvent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">==</span> SDL_QUIT<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				video_state<span class="token operator">-&gt;</span>isEnd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">if</span> <span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>frame_update<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 将AVFrame的数据写入到texture中，然后渲染后windows上</span>
			rect<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			rect<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			rect<span class="token punctuation">.</span>w <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>width<span class="token punctuation">;</span>
			rect<span class="token punctuation">.</span>h <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>vCodecCtx<span class="token operator">-&gt;</span>height<span class="token punctuation">;</span>
			
			out_frame <span class="token operator">=</span> video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>out_frame<span class="token punctuation">;</span>
			
			<span class="token comment">// 更新纹理</span>
			<span class="token function">SDL_UpdateYUVTexture</span><span class="token punctuation">(</span>texture<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rect<span class="token punctuation">,</span>
								 out_frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out_frame<span class="token operator">-&gt;</span>linesize<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>	<span class="token comment">// 	Y</span>
								 out_frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out_frame<span class="token operator">-&gt;</span>linesize<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>	<span class="token comment">// 	U</span>
								 out_frame<span class="token operator">-&gt;</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out_frame<span class="token operator">-&gt;</span>linesize<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//  V</span>
			<span class="token comment">// 渲染页面</span>
			<span class="token function">SDL_RenderClear</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">SDL_RenderCopy</span><span class="token punctuation">(</span>renderer<span class="token punctuation">,</span> texture<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">SDL_RenderPresent</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token comment">// 重置标志</span>
			video_state<span class="token operator">-&gt;</span>videoParam<span class="token operator">-&gt;</span>frame_update <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	
	<span class="token comment">// 打印参数</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"格式: %s\n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>iformat<span class="token operator">-&gt;</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"时长: %lld us\n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"音频持续时长为 %.2f，音频帧总数为 %d\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">av_gettime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>av_start_time<span class="token punctuation">)</span><span class="token operator">/</span>AV_TIME_BASE<span class="token punctuation">,</span> audio_param<span class="token operator">-&gt;</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"码率: %lld\n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>bit_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"编码器: %s (%s)\n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>codec<span class="token operator">-&gt;</span>long_name<span class="token punctuation">,</span> <span class="token function">avcodec_get_name</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>codec_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"通道数: %d\n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>ch_layout<span class="token punctuation">.</span>nb_channels<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"采样率: %d \n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>sample_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"单通道每帧的采样点数目: %d\n"</span><span class="token punctuation">,</span> video_state<span class="token operator">-&gt;</span>aCodecCtx<span class="token operator">-&gt;</span>frame_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"pts单位(ms*1000): %.2f\n"</span><span class="token punctuation">,</span> <span class="token function">av_q2d</span><span class="token punctuation">(</span>video_state<span class="token operator">-&gt;</span>formatCtx<span class="token operator">-&gt;</span>streams<span class="token punctuation">[</span>video_state<span class="token operator">-&gt;</span>audioStream<span class="token punctuation">]</span><span class="token operator">-&gt;</span>time_base<span class="token punctuation">)</span> <span class="token operator">*</span> AV_TIME_BASE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">USE_SDL</span></span>
	<span class="token function">SDL_CloseAudio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDL_DestroyTexture</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDL_DestroyRenderer</span><span class="token punctuation">(</span>renderer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDL_DestroyWindow</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SDL_Quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	<span class="token function">destory_video_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>video_state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35313433333536322f:61727469636c652f64657461696c732f313436313632313037" class_="artid" style="display:none">
 </p>
</div>


