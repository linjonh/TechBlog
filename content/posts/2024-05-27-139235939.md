---
layout: post
title: "vpn工作原理与通信过程"
date: 2024-05-27 14:08:27 +0800
description: "互联网中vpn基本原理"
keywords: "vpn工作原理与通信过程"
categories: ['计算机网络']
tags: ['运维开发', '计算机网络', '服务器']
artid: "139235939"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=139235939
    alt: "vpn工作原理与通信过程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=139235939
featuredImagePreview: https://bing.ee123.net/img/rand?artid=139235939
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vpn工作原理与通信过程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p id="main-toc">
     <strong>
      目录
     </strong>
    </p>
    <p id="%EF%BC%881%EF%BC%89VPN%E6%98%AF%E4%BB%80%E4%B9%88-toc" style="margin-left:0px;">
     <a href="#%EF%BC%881%EF%BC%89VPN%E6%98%AF%E4%BB%80%E4%B9%88" rel="nofollow">
      （1）VPN是什么
     </a>
    </p>
    <p id="%EF%BC%882%EF%BC%89vpn%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-toc" style="margin-left:0px;">
     <a href="#%EF%BC%882%EF%BC%89vpn%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" rel="nofollow">
      （2）vpn使用场景
     </a>
    </p>
    <p id="%EF%BC%884%EF%BC%89vpn%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B-toc" style="margin-left:0px;">
     <a href="#%EF%BC%884%EF%BC%89vpn%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B" rel="nofollow">
      （3）vpn通信过程
     </a>
    </p>
    <p id="%EF%BC%885%EF%BC%89VPN%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6%E5%92%8CVPN%E7%BD%91%E5%85%B3%E4%BD%9C%E7%94%A8%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;">
     <a href="#%EF%BC%885%EF%BC%89VPN%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6%E5%92%8CVPN%E7%BD%91%E5%85%B3%E4%BD%9C%E7%94%A8%E6%80%BB%E7%BB%93" rel="nofollow">
      （4）VPN客户端软件和VPN网关作用总结
     </a>
    </p>
    <hr id="hr-toc"/>
    <p>
    </p>
    <h2 id="%EF%BC%881%EF%BC%89VPN%E6%98%AF%E4%BB%80%E4%B9%88">
     <strong>
      （1）VPN是什么
     </strong>
    </h2>
    <p>
     VPN英文全称是“Virtual Private Network”，翻译过来就是“虚拟专用网络”。vpn被定义为通过一个公用网络建立一个临时的、安全的连接，是一条穿过混乱的公用网络的安全、稳定隧道。VPN属于远程访问技术，简单地说就是利用公用网络架设专用网络。
    </p>
    <p>
    </p>
    <h2 id="%EF%BC%882%EF%BC%89vpn%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">
     <strong>
      （2）vpn使用场景
     </strong>
    </h2>
    <p>
     例如某公司员工出差到外地，他想访问企业内网的服务器资源，这种访问就属于远程访问。
    </p>
    <p>
     在传统的企业网络配置中，要进行远程访问，传统的方法是租用DDN（数字数据网）专线或帧中继，这样的通讯方案必然导致高昂的网络通讯和维护费用。对于移动用户（移动办公人员）与远端个人用户而言，一般会通过拨号线路（Internet）进入企业的局域网，但这样必然带来安全上的隐患。
    </p>
    <p>
     <span style="color:#fe2c24;">
      为了让外地员工访问到内网资源，企业会在内网中架设一台VPN服务器。外地员工在当地连接到互联网后，使用VPN客户端软件或应用程序来建立与VPN服务器的安全连接。一旦连接建立成功，员工就可以通过VPN隧道直接访问企业内网的资源。
     </span>
     这种解决方案保证了数据在传输过程中的安全性和隐私性，同时也降低了企业的网络通讯和维护成本。
    </p>
    <p>
     为了保证数据安全，VPN服务器和客户机之间的通讯数据都进行了加密处理。有了数据加密，就可以认为数据是在一条专用的数据链路上进行安全传输，就如同专门架设了一个专用网络一样，但实际上VPN使用的是互联网上的公用链路，因此VPN称为虚拟专用网络，其实质上就是利用加密技术在公网上封装出一个数据通讯隧道。
    </p>
    <p>
     有了VPN技术，用户无论是在外地出差还是在家中办公，只要能上互联网就能利用VPN访问内网资源，这就是VPN在企业中应用得如此广泛的原因。
    </p>
    <p>
    </p>
    <h2 id="%EF%BC%884%EF%BC%89vpn%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B">
     <strong>
      （3）vpn通信过程
     </strong>
    </h2>
    <p>
     <span style="color:#0d0016;">
      <strong>
       网络结构
      </strong>
     </span>
     ：
    </p>
    <ul>
     <li>
      网络一（某局域网）：终端A位于此网络，具有一个私有IP地址和一个连接到互联网的网关。
     </li>
     <li>
      网络二（公司内网）：终端B位于此网络，具有一个私有IP地址。VPN网关也位于此网络，并具有一个外部（公网）IP地址和一个内部（私网）IP地址。
     </li>
    </ul>
    <p>
     <span style="color:#0d0016;">
      <strong>
       通信过程
      </strong>
     </span>
     ：
    </p>
    <p>
     <strong>
      1.建立VPN连接
     </strong>
     ：
    </p>
    <ul>
     <li>
      在终端A上，用户启动VPN客户端软件并输入必要的认证信息（如VPN服务器的地址，用户名和密码等）。
     </li>
     <li>
      VPN客户端软件与VPN服务器（位于网络二的VPN网关）建立加密的隧道连接。这通常是通过安全协议（如IPsec或SSL/TLS）完成的。
     </li>
     <li>
      远程用户设备的路由表自动进行更新：
      <ul>
       <li>
        会增加一条或多条路由，当网络请求的目标地址属于公司内网中的IP地址段（包括终端B的内部IP地址所在网段）时，数据包会被路由到VPN客户端软件
       </li>
       <li>
        会增加一条路由，当网络请求的目标地址是VPN服务器外部ip地址时，数据包会被路由到连接到互联网的网关，该路由指向VPN隧道接口。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <span style="color:#fe2c24;">
      可以通过查看连接vpn前后路由表的变化情况，来看增加了哪些路由。查看路由表命令：route print -4。
     </span>
    </p>
    <p>
     <strong>
      2.数据包封装
     </strong>
     ：
    </p>
    <ul>
     <li>
      终端A发出访问数据包，目标地址是终端B的内部IP地址。
     </li>
     <li>
      由于目标地址是私有IP地址，根据路由表，数据包被路由到VPN客户端软件。
     </li>
     <li>
      VPN客户端软件将数据包封装在VPN隧道协议中（如ESP、UDP或TCP），并添加VPN头部信息，包括VPN网关的外部地址。
     </li>
    </ul>
    <p>
     <strong>
      3.发送VPN数据包
     </strong>
     ：
    </p>
    <ul>
     <li>
      VPN客户端软件将封装后的VPN数据包发送到互联网。
     </li>
     <li>
      数据包经过互联网上的路由和转发，最终到达网络二的VPN网关。
     </li>
    </ul>
    <p>
     <strong>
      4.VPN网关处理
     </strong>
     ：
    </p>
    <ul>
     <li>
      VPN网关接收到VPN数据包后，检查其VPN头部信息，确认其来自有效的VPN连接。
     </li>
     <li>
      VPN网关解封装VPN数据包，还原出原始的数据包。
     </li>
     <li>
      还原后的数据包被路由到网络二中的目标终端B。
     </li>
    </ul>
    <p>
     <strong>
      5.终端B响应
     </strong>
     ：
    </p>
    <ul>
     <li>
      终端B收到数据包后，正常处理并生成响应数据包。
     </li>
     <li>
      响应数据包通过反向路径（即通过VPN网关和VPN隧道）返回到终端A。
     </li>
    </ul>
    <p>
     <strong>
      6.关闭VPN连接
     </strong>
     ：
    </p>
    <ul>
     <li>
      当用户完成通信或VPN连接超时后，VPN客户端软件将关闭VPN隧道连接。
     </li>
     <li>
      远程用户设备的路由表会更新，删除指向VPN服务器的路由。
     </li>
    </ul>
    <p>
     需要注意的是，上述描述假设VPN使用的是路由模式（Routing Mode），其中VPN网关作为路由器工作，负责数据包的封装和解封装。VPN也可以工作在桥接模式（Bridging Mode）下，此时VPN网关更像是一个透明的桥接设备，数据包的封装和解封装在终端上的VPN客户端软件完成。
    </p>
    <p>
     此外，VPN通信过程中的加密和解密操作对于保护数据的安全性和隐私性至关重要。在数据通过VPN隧道传输时，数据会被加密以防止未经授权的访问和篡改。
    </p>
    <p>
    </p>
    <h2 id="%EF%BC%885%EF%BC%89VPN%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6%E5%92%8CVPN%E7%BD%91%E5%85%B3%E4%BD%9C%E7%94%A8%E6%80%BB%E7%BB%93">
     （4）
     <strong>
      VPN客户端软件和VPN网关作用总结
     </strong>
    </h2>
    <p>
     <strong>
      VPN客户端软件的作用
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       连接建立
      </strong>
      ：VPN客户端软件安装在终端A上，负责建立与VPN网关之间的安全连接。
     </li>
     <li>
      <strong>
       数据封装
      </strong>
      ：当终端A需要访问网络二（如公司内网）中的资源时，VPN客户端软件会将原始数据包（如HTTP请求）进行封装，添加VPN协议相关的头部信息，从而创建一个新的VPN数据包。这个封装过程确保了数据在传输过程中的安全性和隐私性。
     </li>
     <li>
      <strong>
       加密和解密
      </strong>
      ：VPN客户端软件还会使用VPN协议中定义的加密算法对封装后的数据进行加密，以确保数据在公共网络（如Internet）上的传输安全。在接收数据时，VPN客户端软件会进行解密操作，还原出原始的数据包。
     </li>
    </ul>
    <p>
     <strong>
      VPN网关的作用
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       连接管理
      </strong>
      ：VPN网关位于网络二的边缘，负责管理和维护所有来自VPN客户端的连接。它会对连接请求进行验证和授权，确保只有合法的用户才能访问内部网络资源。
     </li>
     <li>
      <strong>
       数据转发
      </strong>
      ：当VPN网关接收到来自VPN客户端的VPN数据包时，它会根据VPN数据包中的目标地址和路由规则，将数据包转发到相应的内部网络资源（如终端B）。
     </li>
     <li>
      <strong>
       安全策略执行
      </strong>
      ：VPN网关还可以执行各种安全策略，如防火墙规则、访问控制列表（ACL）等，以进一步保护内部网络的安全。
     </li>
    </ul>
    <hr/>
    <p>
     end
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f687574616f74616f74616f2f:61727469636c652f64657461696c732f313339323335393339" class_="artid" style="display:none">
 </p>
</div>


