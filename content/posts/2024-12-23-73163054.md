---
layout: post
title: linux下通过JNI用CC中调用JAVA类
date: 2024-12-23 17:37:44 +0800
categories: ['编程相关']
tags: ['无标签']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=73163054
    alt: linux下通过JNI用CC中调用JAVA类
artid: 73163054
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=73163054
featuredImagePreview: https://bing.ee123.net/img/rand?artid=73163054
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     linux下通过JNI用C/C++中调用JAVA类
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     决定使用
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     JNI
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     ，实际是为了能够将通讯与调用后台的
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     lucene
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     索引，因此老大决定要采用这种方式来实现
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     index
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     的多机分布式的索引服务。接到任务，使用
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     C++
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     来调用
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     Lucene
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     的
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     java
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; line-height:26px; font-size:9pt">
     查询的封装类。
    </span>
    <span style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
    </span>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <span style="font-size:9pt">
     </span>
     <span style="font-size:9pt">
      用了
     </span>
     <span style="font-size:9pt">
      java
     </span>
     <span style="font-size:9pt">
      ，
     </span>
     <span style="font-size:9pt">
      c++
     </span>
     <span style="font-size:9pt">
      各一段时间，却从未接触过
     </span>
     <span style="font-size:9pt">
      JNI.
     </span>
     <span style="font-size:9pt">
      开始从网上收集该方面的资料，从头开始没有指导的时候特别郁闷，网上找到的大多数资料是讲述如何用
     </span>
     <span style="font-size:9pt">
      java
     </span>
     <span style="font-size:9pt">
      来调用
     </span>
     <span style="font-size:9pt">
      C++
     </span>
     <span style="font-size:9pt">
      的，而且多试
     </span>
     <span style="font-size:9pt">
      windows
     </span>
     <span style="font-size:9pt">
      下以
     </span>
     <span style="font-size:9pt">
      dll
     </span>
     <span style="font-size:9pt">
      方式为
     </span>
     <span style="font-size:9pt">
      java
     </span>
     <span style="font-size:9pt">
      提供动态库的，
     </span>
     <span style="font-size:9pt">
      JAVA
     </span>
     <span style="font-size:9pt">
      是宿主，而我要的是
     </span>
     <span style="font-size:9pt">
      C++
     </span>
     <span style="font-size:9pt">
      为宿主，
     </span>
     <span style="font-size:9pt">
      linux
     </span>
     <span style="font-size:9pt">
      环境下的。长期是各种环境设置，头文件查找，
     </span>
     <span style="font-size:9pt">
      lib
     </span>
     <span style="font-size:9pt">
      库的指定等等东西常常搞得人焦头烂额！一天时间总算摸清了怎么将虚拟机调起来（狂汗！！！），又一天时间总算摸清了如何进行调用
     </span>
     <span style="font-size:9pt">
      java
     </span>
     <span style="font-size:9pt">
      中的类和函数。基本可以开始
     </span>
     <span style="font-size:9pt">
      JNI
     </span>
     <span style="font-size:9pt">
      的程序编写里程了：）现记录自己的心得如下：
     </span>
    </div>
    <div align="left" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:21.75pt; margin:7.5pt 0cm">
     首先，来了解JNI是干什么的。
     <span style="font-size:10pt">
      Java Native Interface
     </span>
     <span style="font-size:10pt">
      （
     </span>
     <span style="font-size:10pt">
      JNI
     </span>
     <span style="font-size:10pt">
      ）是
     </span>
     <span style="font-size:10pt">
      Java
     </span>
     <span style="font-size:10pt">
      语言的本地编程接口，是
     </span>
     <span style="font-size:10pt">
      J2SDK
     </span>
     <span style="font-size:10pt">
      的一部分。在
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      程序中，我们可以通过
     </span>
     <span style="font-size:10pt">
      JNI
     </span>
     <span style="font-size:10pt">
      实现一些用
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      语言不便实现的功能。通常有以下几种情况我们需要使用
     </span>
     <span style="font-size:10pt">
      JNI
     </span>
     <span style="font-size:10pt">
      来实现。
     </span>
    </div>
    <div align="left" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:21.75pt; margin:7.5pt 0cm">
     <span style="font-size:10pt">
      你希望使用一些已经有的类库或者应用程序，而他们并非用
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      语言编写的
     </span>
    </div>
    <div align="left" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:21.75pt; margin:7.5pt 0cm">
     <span style="font-size:10pt">
      程序的某些部分对速度要求比较苛刻，你选择用汇编或者
     </span>
     <span style="font-size:10pt">
      c
     </span>
     <span style="font-size:10pt">
      语言来实现并在
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      语言中调用他们。
     </span>
    </div>
    <div align="left" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:21.75pt; margin:7.5pt 0cm">
     <span style="font-size:10pt">
      另外，也可是使用很多本地的程序来使用
     </span>
     <span style="font-size:10pt">
      JAVA
     </span>
     <span style="font-size:10pt">
      的类。
     </span>
    </div>
    <div align="left" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:21.75pt; margin:7.5pt 0cm">
     <span style="font-size:10pt">
      也就是说
     </span>
     <span style="font-size:10pt">
      JNI
     </span>
     <span style="font-size:10pt">
      就是跟大家进行交互的接口，其已经作为标准成为
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      平台的一部分
     </span>
     <span style="font-size:10pt">
      ,
     </span>
     <span style="font-size:10pt">
      它允许
     </span>
     <span style="font-size:10pt">
      Java
     </span>
     <span style="font-size:10pt">
      代码和其他语言写的代码进行交互。
     </span>
    </div>
    <div align="left" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:21.75pt; margin:7.5pt 0cm">
     <span style="font-size:10pt">
      不管怎么说，
     </span>
     JNI是规范，它规定了虚拟机的接口，而把具体的实现留给开发者。
    </div>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <span style="font-size:10pt">
      我的环境，也就是本文的条件是：
     </span>
     <span style="font-size:10pt">
      LINUX RH EL4
     </span>
     <span style="font-size:10pt">
      ，装了
     </span>
     <span style="font-size:10pt">
      JDK1.5.0
     </span>
     <span style="font-size:10pt">
      的版本。
     </span>
    </div>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <span style="font-size:10pt">
      要使用
     </span>
     <span style="font-size:10pt">
      JVM
     </span>
     <span style="font-size:10pt">
      来调用
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      的类别，首先得让
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      虚拟机启动起来。如何启动？
     </span>
     <span style="font-size:10pt">
      C++
     </span>
     <span style="font-size:10pt">
      如何来调用？
     </span>
    </div>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:15pt">
     <span style="font-size:10pt">
      首先，得找到
     </span>
     <span style="font-size:10pt">
      JNI
     </span>
     <span style="font-size:10pt">
      的头文件，一般为装
     </span>
     <span style="font-size:10pt">
      java
     </span>
     <span style="font-size:10pt">
      的目录，如（
     </span>
     <span style="font-size:10pt">
      /usr/java/jdk1.5.0/include/
     </span>
     <span style="font-size:10pt">
      ）里的
     </span>
     <span style="font-size:10pt">
      jni.h
     </span>
     <span style="font-size:10pt">
      ，
     </span>
     <span style="font-size:10pt">
      linux
     </span>
     <span style="font-size:10pt">
      下大家要牢记
     </span>
     <span style="font-size:10pt">
      G++
     </span>
     <span style="font-size:10pt">
      编译的时候要加上
     </span>
     <span style="font-size:10pt">
      /usr/java/jdk1.5.0/include/linux
     </span>
     <span style="font-size:10pt">
      和上面两个目录，否则一大堆的
     </span>
     <span style="font-size:10pt">
      undefined …! 下面帖一段我自己环境下的代码：
     </span>
    </div>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:15pt">
     <span style="font-size:10pt">
     </span>
     <div style="border:0.5pt solid windowtext; padding:4px 5.4pt; width:684px; word-break:break-all; background:rgb(230,230,230)">
      <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%">
       <span style="color:rgb(0,128,0)">
        //
       </span>
       <span style="color:rgb(0,128,0)">
        创建JVM
       </span>
       <span style="color:rgb(0,128,0)">
        <br/>
        <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%"/>
       </span>
       <span style="color:rgb(0,0,0)">
        JNIEnv
       </span>
       <span style="color:rgb(0,0,0)">
        *
       </span>
       <span style="color:rgb(0,0,0)">
        env
       </span>
       <span style="color:rgb(0,0,0)">
        =
       </span>
       <span style="color:rgb(0,0,0)">
        NULL;
        <br/>
        <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%">
         JavaVM
        </img>
       </span>
       <span style="color:rgb(0,0,0)">
        *
       </span>
       <span style="color:rgb(0,0,0)">
        jvm
       </span>
       <span style="color:rgb(0,0,0)">
        =
       </span>
       <span style="color:rgb(0,0,0)">
        NULL;
        <br/>
        <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%"/>
       </span>
       <span style="color:rgb(0,0,255)">
        bool
       </span>
       <span style="color:rgb(0,0,0)">
        Object::BeginJVM()
        <br/>
        <img align="top" alt="" id="_74_709_Open_Image" src="https://i-blog.csdnimg.cn/blog_migrate/a41954a27d6ad96fa2c2cf816e677448.gif" style="border:none; max-width:100%">
         <img align="top" alt="" id="_74_709_Closed_Image" src="https://i-blog.csdnimg.cn/blog_migrate/1327ab569c1ae82736693a50b8e33378.gif" style="border:none; max-width:100%"/>
        </img>
       </span>
       <span id="_74_709_Closed_Text" style="border:1px solid rgb(128,128,128); background-color:rgb(255,255,255)">
        ...
       </span>
       <span id="_74_709_Open_Text">
        <span style="color:rgb(0,0,0)">
         {
         <!-- -->
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%">
          JavaVMOption options[
         </img>
        </span>
        <span style="color:rgb(0,0,0)">
         4
        </span>
        <span style="color:rgb(0,0,0)">
         ];
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%">
          JavaVMInitArgs vm_args;
          <br/>
          <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         </img>
        </span>
        <span style="color:rgb(0,128,0)">
         //
        </span>
        <span style="color:rgb(0,128,0)">
         各种参数
        </span>
        <span style="color:rgb(0,128,0)">
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,0)">
         options[
        </span>
        <span style="color:rgb(0,0,0)">
         0
        </span>
        <span style="color:rgb(0,0,0)">
         ].optionString
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         -Xmx512m
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         options[
        </span>
        <span style="color:rgb(0,0,0)">
         1
        </span>
        <span style="color:rgb(0,0,0)">
         ].optionString
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         -Xms128m
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,128,0)">
         //
        </span>
        <span style="color:rgb(0,128,0)">
         大家注意这里为你需要使用的java类class所在的目录
        </span>
        <span style="color:rgb(0,128,0)">
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,0)">
         options[
        </span>
        <span style="color:rgb(0,0,0)">
         2
        </span>
        <span style="color:rgb(0,0,0)">
         ].optionString
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         -Djava.class.path=.:../lucene-core-2.0.0.jar
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         options[
        </span>
        <span style="color:rgb(0,0,0)">
         3
        </span>
        <span style="color:rgb(0,0,0)">
         ].optionString
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         -Djava.compiler=NONE
        </span>
        <span style="color:rgb(0,0,0)">
         "
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,128,0)">
         //
        </span>
        <span style="color:rgb(0,128,0)">
         该地方我也不太清除，我的JDK版本是1.5.0,但好像没有JNI_VERSION_1_5
        </span>
        <span style="color:rgb(0,128,0)">
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,0)">
         vm_args.version
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         JNI_VERSION_1_4;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         vm_args.options
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         options;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         vm_args.nOptions
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         4
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,128,0)">
         //
        </span>
        <span style="color:rgb(0,128,0)">
         创建JVM，获得jvm和env
        </span>
        <span style="color:rgb(0,128,0)">
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,0)">
        </span>
        <span style="color:rgb(0,0,255)">
         int
        </span>
        <span style="color:rgb(0,0,0)">
         res
        </span>
        <span style="color:rgb(0,0,0)">
         =
        </span>
        <span style="color:rgb(0,0,0)">
         JNI_CreateJavaVM(
        </span>
        <span style="color:rgb(0,0,0)">
         &amp;
        </span>
        <span style="color:rgb(0,0,0)">
         jvm,(
        </span>
        <span style="color:rgb(0,0,255)">
         void
        </span>
        <span style="color:rgb(0,0,0)">
        </span>
        <span style="color:rgb(0,0,0)">
         **
        </span>
        <span style="color:rgb(0,0,0)">
         )
        </span>
        <span style="color:rgb(0,0,0)">
         &amp;
        </span>
        <span style="color:rgb(0,0,0)">
         env,
        </span>
        <span style="color:rgb(0,0,0)">
         &amp;
        </span>
        <span style="color:rgb(0,0,0)">
         vm_args);
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,255)">
         if
        </span>
        <span style="color:rgb(0,0,0)">
         (res
        </span>
        <span style="color:rgb(0,0,0)">
         ==
        </span>
        <span style="color:rgb(0,0,0)">
         JNI_ERR)
         <br/>
         <img align="top" alt="" id="_624_690_Open_Image" src="https://i-blog.csdnimg.cn/blog_migrate/37c8bf68cdc3cc81759c34160776bc53.gif" style="border:none; max-width:100%"/>
         <img align="top" alt="" id="_624_690_Closed_Image" src="https://i-blog.csdnimg.cn/blog_migrate/7ff8d92cded7e0ce15e7ca1acc870052.gif" style="border:none; max-width:100%"/>
        </span>
        <span id="_624_690_Closed_Text" style="border:1px solid rgb(128,128,128); background-color:rgb(255,255,255)">
         ...
        </span>
        <span id="_624_690_Open_Text">
         <span style="color:rgb(0,0,0)">
          {
          <!-- -->
          <br/>
          <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
          printf(
         </span>
         <span style="color:rgb(0,0,0)">
          "
         </span>
         <span style="color:rgb(0,0,0)">
          Error invoking the JVM
         </span>
         <span style="color:rgb(0,0,0)">
          "
         </span>
         <span style="color:rgb(0,0,0)">
          );
          <br/>
          <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
         </span>
         <span style="color:rgb(0,0,255)">
          return
         </span>
         <span style="color:rgb(0,0,0)">
         </span>
         <span style="color:rgb(0,0,255)">
          false
         </span>
         <span style="color:rgb(0,0,0)">
          ;
          <br/>
          <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/717446ca04a6125dc5b6b54e0fa14ab4.gif" style="border:none; max-width:100%"/>
          }
         </span>
        </span>
        <span style="color:rgb(0,0,0)">
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,255)">
         return
        </span>
        <span style="color:rgb(0,0,0)">
        </span>
        <span style="color:rgb(0,0,255)">
         true
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/0196c3df5ea9e936f21e9932cca91014.gif" style="border:none; max-width:100%"/>
         }
        </span>
       </span>
       <span style="color:rgb(0,0,0)">
        <br/>
        <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%"/>
        <br/>
        <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%"/>
       </span>
       <span style="color:rgb(0,0,255)">
        bool
       </span>
       <span style="color:rgb(0,0,0)">
        Object::EndJVM()
        <br/>
        <img align="top" alt="" id="_734_787_Open_Image" src="https://i-blog.csdnimg.cn/blog_migrate/a41954a27d6ad96fa2c2cf816e677448.gif" style="border:none; max-width:100%"/>
        <img align="top" alt="" id="_734_787_Closed_Image" src="https://i-blog.csdnimg.cn/blog_migrate/1327ab569c1ae82736693a50b8e33378.gif" style="border:none; max-width:100%"/>
       </span>
       <span id="_734_787_Closed_Text" style="border:1px solid rgb(128,128,128); background-color:rgb(255,255,255)">
        ...
       </span>
       <span id="_734_787_Open_Text">
        <span style="color:rgb(0,0,0)">
         {
         <!-- -->
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,128,0)">
         //
        </span>
        <span style="color:rgb(0,128,0)">
         关闭JVM
        </span>
        <span style="color:rgb(0,128,0)">
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,0)">
         jvm
        </span>
        <span style="color:rgb(0,0,0)">
         -&gt;
        </span>
        <span style="color:rgb(0,0,0)">
         DestroyJavaVM();
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6a9c071a08f1dae2d3e1c512000eef41.gif" style="border:none; max-width:100%"/>
        </span>
        <span style="color:rgb(0,0,255)">
         return
        </span>
        <span style="color:rgb(0,0,0)">
        </span>
        <span style="color:rgb(0,0,255)">
         true
        </span>
        <span style="color:rgb(0,0,0)">
         ;
         <br/>
         <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/0196c3df5ea9e936f21e9932cca91014.gif" style="border:none; max-width:100%"/>
         }
        </span>
       </span>
       <span style="color:rgb(0,0,0)">
        <br/>
        <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%"/>
       </span>
      </img>
     </div>
    </div>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; text-indent:15pt">
    </div>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     注意编译的时候，要加上-I指定头文件目录,-L指定libjvm.so的所在目录，如我的：
    </p>
    <div style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; border:0.5pt solid windowtext; padding:4px 5.4pt; width:684px; word-break:break-all; background:rgb(230,230,230)">
     <img align="top" alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6810355c2f78c12e91b7997a8e8c583a.gif" style="border:none; max-width:100%"/>
     <span style="font-size:18px">
      <span style="color:rgb(0,0,0)">
       g
      </span>
      <span style="color:rgb(0,0,0)">
       ++
      </span>
      <span style="color:rgb(0,0,0)">
      </span>
      <span style="color:rgb(0,0,0)">
       -
      </span>
      <span style="color:rgb(0,0,0)">
       I
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       usr
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       java
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       jdk1.
      </span>
      <span style="color:rgb(0,0,0)">
       5.0
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       include
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
      </span>
      <span style="color:rgb(0,0,0)">
       -
      </span>
      <span style="color:rgb(0,0,0)">
       I
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       usr
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       java
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       jdk1.
      </span>
      <span style="color:rgb(0,0,0)">
       5.0
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       include
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       linux
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
      </span>
      <span style="color:rgb(0,0,0)">
       -
      </span>
      <span style="color:rgb(0,0,0)">
       L
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       usr
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       java
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       jdk1.
      </span>
      <span style="color:rgb(0,0,0)">
       5.0
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       jre
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       lib
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       i386
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
       server
      </span>
      <span style="color:rgb(0,0,0)">
       /
      </span>
      <span style="color:rgb(0,0,0)">
      </span>
      <span style="color:rgb(0,0,0)">
       -
      </span>
      <span style="color:rgb(0,0,0)">
       o startJVM startJVM.cpp
      </span>
      <span style="color:rgb(0,0,0)">
       -
      </span>
      <span style="color:rgb(0,0,0)">
       ljvm
      </span>
     </span>
    </div>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     这样至少可以以C/C++的方式启动了
     <a class="replace_word" href="http://lib.csdn.net/base/java" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Java 知识库">
      Java
     </a>
     的JVM，下篇将是实际读取，调用java中的数据和接口。
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     对了有些可能会碰到的出错问题：第一,libjvm.so :no such file or directory. 第二，就是N多的undefine ....的
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     总结下来，第一种是因为没有加入-L 指明lib所在路径，并加上-ljvm ；第二种是由于没有加入-I 指明头文件和
     <a class="replace_word" href="http://lib.csdn.net/base/linux" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Linux知识库">
      Linux
     </a>
     下目录的头文件。
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     另外，在运行的时候，可能会报错cannot find shared lib:libjvm.so,问题是没有加入run_lib_directory,也就是说要设置LD_LIBRARY_PATH。设置的命令为：export LD_LIBRARY_PATH=/usr/java/jdk1.5.0/jre/lib/i386/server
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <br/>
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <br/>
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <br/>
    </p>
    <p style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
    </p>
    <div class="blogzz_ainfo" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px; margin-bottom:12px">
     <span style="margin-right:25px">
      <strong>
       原文地址：
      </strong>
      <a href="http://blog.sina.com.cn/s/blog_48eef8410100fjxr.html" rel="nofollow noopener noreferrer" style="color:rgb(106,57,6); text-decoration:none" target="_blank" title="linux下通过JNI用C/C++中调用JAVA类">
       <span style="color:rgb(136,68,24)">
        linux下通过JNI用C/C++中调用JAVA类
       </span>
      </a>
     </span>
     <strong>
      作者：
     </strong>
     <a href="http://blog.sina.com.cn/u/1223620673" rel="nofollow noopener noreferrer" style="color:rgb(106,57,6); text-decoration:none" target="_blank" title="开心人">
      <span style="color:rgb(136,68,24)">
       开心人
      </span>
     </a>
    </div>
    <div class="blogzz_acon" style="color:rgb(54,46,43); font-family:Arial; font-size:14px; line-height:26px">
     <p>
      最近正在做一个C/C++调用
      <a class="replace_word" href="http://lib.csdn.net/base/java" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Java 知识库">
       Java
      </a>
      的程序，这里说的调用java不是使用方式 exec(/path/to/java,.....)，而是调用一个class文件中的一个特定的函数。
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      实践后总结如下：
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      1. 安装 jdk
     </p>
     <p>
      2. 安装gcc(
      <a class="replace_word" href="http://lib.csdn.net/base/linux" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Linux知识库">
       Linux
      </a>
      自带有的就无需安装了)
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      利用JNI（
      <a class="replace_word" href="http://lib.csdn.net/base/java" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Java 知识库">
       Java
      </a>
      native interface)，来实现动态建立
      <a class="replace_word" href="http://lib.csdn.net/base/java" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Java 知识库">
       java
      </a>
      runtime environment.
     </p>
     <p>
      第一，C/C++程序中包含头文件"jni.h"
     </p>
     <p>
      #include &lt;jni.h&gt; 一般在JAVA_HOME/include 目录下。
     </p>
     <p>
      调用jni.h中的方法建立runtime env 然后调用java 程序。
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      第二，编译
     </p>
     <p>
      g++ -o testjava testjava.cpp -I${JAVA_HOME}/include -I${JAVA_HOME}/include/
      <a class="replace_word" href="http://lib.csdn.net/base/linux" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Linux知识库">
       linux
      </a>
      -L${JRE_HOME}/lib/i386/client -ljvm
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      以上就是大致思路，现详细说明过程如下：
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      #####################################################################################
     </p>
     <p>
      <strong>
       一、安装配置Java环境
      </strong>
     </p>
     <p align="left">
      我的linux是RedHat Enterprise linux 5， 内核版本2.6.18
      <br/>
      在Linux系统中安装Java比较简单。可以访问Java download网站或自由软件库等，选择你所有安装的
      <a class="replace_word" href="http://lib.csdn.net/base/operatingsystem" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="操作系统知识库">
       操作系统
      </a>
      类型(Linux，Linux AMD64，Solaris等)。一旦你已经选择
      <a href="http://download.chinaitlab.com/" rel="nofollow noopener noreferrer" style="color:rgb(106,57,6); text-decoration:none" target="_blank">
       <span style="color:rgb(136,68,24)">
        下载
       </span>
      </a>
      文件──要么是自解压缩执行文件，要么是自解压缩的RPM文件，你都可以安装它。我下载的是jdk-1_5_0_06-linux-i586.bin：
     </p>
     <div align="center">
      <table border="1" cellpadding="0" cellspacing="0" width="95%">
       <tbody>
        <tr>
         <td>
          <p align="left">
           # mkdir /usr/local/java
          </p>
          <p align="left">
           # cd /usr/local/java
          </p>
          <p align="left">
           # cp /home/soft/jdk-1_5_0_06-linux-i586.bin ./
          </p>
          <p align="left">
           # chmod u+x jdk-1_5_0_06-linux-i586.bin
          </p>
          <p align="left">
           # ./jdk-1_5_0_06-linux-i586.bin
          </p>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <p align="left">
      运行完后生成jdk1.5.0_06目录，jdk被安装在/usr/local/java/jdk1.5.0_06/。运行以下执行代码将得到一个
      <a href="http://softtest.chinaitlab.com/" rel="nofollow noopener noreferrer" style="color:rgb(106,57,6); text-decoration:none" target="_blank">
       <span style="color:rgb(136,68,24)">
        测试
       </span>
      </a>
      结果：
     </p>
     <div align="center">
      <table border="1" cellpadding="0" cellspacing="0" width="95%">
       <tbody>
        <tr>
         <td>
          <p align="left">
           # cd jdk1.5.0_06/bin
          </p>
          <p align="left">
           [root@localhost bin]# ./java -version
          </p>
          <p align="left">
           java version "1.5.0_06"
          </p>
          <p align="left">
           Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)
          </p>
          <p align="left">
           Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode, sharing)
          </p>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <p align="left">
     </p>
     <p align="left">
      为了能够使用Java，需要设置如下环境变量：
     </p>
     <div align="center">
      <table border="1" cellpadding="0" cellspacing="0" width="95%">
       <tbody>
        <tr>
         <td>
          <p align="left">
           JAVA_HOME=/usr/local/java/jdk1.5.0_06
          </p>
          <p align="left">
           PATH=$PATH:/usr/local/java/jre1.5.0_05/bin
          </p>
          <p align="left">
           export JAVA_HOME PATH
          </p>
          <p align="left">
           export JRE_HOME=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre
          </p>
          <p align="left">
           export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$JRE_HOME/lib/i386:$JRE_HOME/lib/i386/client
          </p>
         </td>
        </tr>
       </tbody>
      </table>
     </div>
     <p>
      <wbr/>
     </p>
     <p>
      注意JRE_HOME的配置，若机器上没有jre环境，则安装jre，安装方法类似安装jdk
     </p>
     <p>
      设置完后可以查看变量的值
     </p>
     <p>
      [root@localhost bin]# echo $JAVA_HOME
     </p>
     <p>
      /usr/local/java/jdk1.5.0_06
     </p>
     <p>
      [root@localhost bin]# echo $PATH
     </p>
     <p>
      /usr/kerberos/sbin:/usr/kerberos/bin:/usr/local/bin:/bin:/usr/bin:/home/zhangp/bin:/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre/bin:/usr/local/java/jdk1.5.0_06/bin
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      <strong>
       二、编写简单的Java程序
      </strong>
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      package com.test;
     </p>
     <p>
      public class MyTest {
      <!-- -->
      <br/>
      <wbr/>
      public MyTest(){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      super();
      <br/>
      <wbr/>
      }
     </p>
     <p>
      <wbr/>
      public static int add(int a,int b) {
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      return a+b;
      <br/>
      <wbr/>
      }
     </p>
     <p>
      <wbr/>
      public boolean judge(boolean bool) {
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      return !bool;
      <br/>
      <wbr/>
      }
      <br/>
      }
      <br/>
     </p>
     <p>
      编译Java程序：
     </p>
     <p>
      #javac MyTest.java
     </p>
     <p>
      编译之后生成MyTest.class，将其放置于当前目录的com/test目录下，C++程序的JNI调用时会使用相关方法在com/test目录下查找该class。
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      <strong>
       三、C++程序
      </strong>
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      #include &lt;stdio.h&gt;
      <br/>
      #include &lt;iostream&gt;
      <br/>
      #include &lt;jni.h&gt;
      <br/>
      #include &lt;stdlib.h&gt;
      <br/>
      #include &lt;assert.h&gt;
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      <br/>
      jstring stoJstring(JNIEnv* env, const char* pat)
      <br/>
      {
      <!-- -->
      <br/>
      <wbr/>
      jclass strClass = env-&gt;FindClass("java/lang/String");
      <br/>
      <wbr/>
      jmethodID ctorID = env-&gt;GetMethodID(strClass, "&lt;init&gt;", "([BLjava/lang/String;)V");
      <br/>
      <wbr/>
      jbyteArray bytes = env-&gt;NewByteArray(strlen(pat));
      <br/>
      <wbr/>
      env-&gt;SetByteArrayRegion(bytes, 0, strlen(pat), (jbyte*)pat);
      <br/>
      <wbr/>
      jstring encoding = env-&gt;NewStringUTF("utf-8");
      <br/>
      <wbr/>
      return (jstring)env-&gt;NewObject(strClass, ctorID, bytes, encoding);
      <br/>
      }
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      <br/>
      char* jstringTostring(JNIEnv* env, jstring jstr)
      <br/>
      {
      <!-- -->
      <br/>
      <wbr/>
      char* rtn = NULL;
      <br/>
      <wbr/>
      jclass clsstring = env-&gt;FindClass("java/lang/String");
      <br/>
      <wbr/>
      jstring strencode = env-&gt;NewStringUTF("utf-8");
      <br/>
      <wbr/>
      jmethodID mid = env-&gt;GetMethodID(clsstring, "getBytes", "(Ljava/lang/String;)[B");
      <br/>
      <wbr/>
      jbyteArray barr= (jbyteArray)env-&gt;CallObjectMethod(jstr, mid, strencode);
      <br/>
      <wbr/>
      jsize alen = env-&gt;GetArrayLength(barr);
      <br/>
      <wbr/>
      jbyte* ba = env-&gt;GetByteArrayElements(barr,JNI_FALSE);
      <br/>
      <wbr/>
      if(alen &gt; 0){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      rtn = (char*)malloc(alen + 1);
      <br/>
      <wbr/>
      <wbr/>
      memcpy(rtn, ba, alen);
      <br/>
      <wbr/>
      <wbr/>
      rtn[alen] = 0;
      <br/>
      <wbr/>
      }
      <br/>
      <wbr/>
      env-&gt;ReleaseByteArrayElements
      <wbr/>
      (barr, ba, 0);
      <br/>
      <wbr/>
      return rtn;
      <br/>
      }
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      using namespace std;
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      int main()
      <br/>
      {
      <!-- -->
      <br/>
      <wbr/>
      JavaVMOption options[2];
      <br/>
      <wbr/>
      JNIEnv *env;
      <br/>
      <wbr/>
      JavaVM *jvm;
      <br/>
      <wbr/>
      JavaVMInitArgs vm_args;
      <br/>
      <wbr/>
      long status;
      <br/>
      <wbr/>
      jclass cls;
      <br/>
      <wbr/>
      jmethodID mid;
      <br/>
      <wbr/>
      jint square;
      <br/>
      <wbr/>
      jboolean jnot;
      <br/>
      <wbr/>
      jobject jobj;
     </p>
     <p>
      <wbr/>
      options[0].optionString = "-Djava.compiler=NONE";
      <br/>
      <wbr/>
      options[1].optionString = "-Djava.class.path=.";
      <br/>
      <wbr/>
      //options[2].optionString = "-verbose:jni"; //用于跟踪运行时的信息
     </p>
     <p>
      <wbr/>
      vm_args.version = JNI_VERSION_1_4; // JDK版本号
      <br/>
      <wbr/>
      vm_args.nOptions = 2;
      <br/>
      <wbr/>
      vm_args.options = options;
      <br/>
      <wbr/>
      vm_args.ignoreUnrecognized = JNI_TRUE;
     </p>
     <p>
      <wbr/>
      status = JNI_CreateJavaVM(&amp;jvm, (void**)&amp;env, &amp;vm_args);
     </p>
     <p>
      <br/>
      <wbr/>
      if(status != JNI_ERR){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      printf("create java jvm successn");
      <br/>
      <wbr/>
      <wbr/>
      cls = env-&gt;FindClass("com/test/MyTest");
      <wbr/>
      // 在这里查找ava类
      <br/>
      <wbr/>
      <wbr/>
      if(cls !=0){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      printf("find java class successn");
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      // 构造函数
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      mid = env-&gt;GetMethodID(cls,"&lt;init&gt;","()V");
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      if(mid !=0){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      jobj=env-&gt;NewObject(cls,mid);
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      std::cout &lt;&lt; "init ok" &lt;&lt; std::endl;
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      }
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      // 调用add函数
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      mid = env-&gt;GetStaticMethodID( cls, "add", "(II)I");
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      if(mid !=0){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      square = env-&gt;CallStaticIntMethod( cls, mid, 5,5);
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      std::cout &lt;&lt; square &lt;&lt; std::endl;
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      }
     </p>
     <p>
      <wbr/>
      <wbr/>
      <wbr/>
     </p>
     <p>
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      // 调用judge函数
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      mid = env-&gt;GetMethodID( cls, "judge","(Z)Z");
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      if(mid !=0){
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      jnot = env-&gt;CallBooleanMethod(jobj, mid, 1);
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      <wbr/>
      if(!jnot) std::cout &lt;&lt; "Boolean ok" &lt;&lt; std::endl;
     </p>
     <p>
      <wbr/>
      <wbr/>
      <wbr/>
      }
      <br/>
      <wbr/>
      <wbr/>
      }
      <br/>
      <wbr/>
      <wbr/>
      else{
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      <wbr/>
      fprintf(stderr, "FindClass failedn");
      <br/>
      <wbr/>
      <wbr/>
      }
      <br/>
      <wbr/>
      <br/>
      <wbr/>
      <wbr/>
      jvm-&gt;DestroyJavaVM();
      <br/>
      <wbr/>
      <wbr/>
      fprintf(stdout, "Java VM destory.n");
      <br/>
      <wbr/>
      <wbr/>
      return 0;
      <br/>
      <wbr/>
      }
      <br/>
      <wbr/>
      else{
      <!-- -->
      <br/>
      <wbr/>
      <wbr/>
      printf("create java jvm failn");
      <br/>
      <wbr/>
      <wbr/>
      return -1;
      <br/>
      <wbr/>
      }
     </p>
     <p>
      }
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      编译该C++程序（前提：Java环境已设置好，即JAVA_HOME、PATH、JRE_HOME、LD_LIBRARY_PATH）
      <br/>
      [root@localhost jni]# g++ -o testjava testjava.cpp -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux -L${JRE_HOME}/lib/i386/client -ljvm
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      编译好后可以用ldd testjava查看其使用的链接库的正确性。
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      运行：
      <br/>
      [root@localhost jni]# ./testjava
      <br/>
      create java jvm success
      <br/>
      find java class success
      <br/>
      init ok
      <br/>
      10
      <br/>
      Boolean ok
      <br/>
      Java VM destory.
     </p>
     <p>
      <br/>
      JRE_HOME和LD_LIBRARY_PATH要设置好，编译C++程序时要使用JRE_HOME下面的libjvm.so动态库（一开始我使用网上说的使用JAVA_HOME目录下的libjvm.so，结果出现下面错误
     </p>
     <p>
      # An unexpected error has been detected by HotSpot Virtual Machine:
      <br/>
      #
      <br/>
      #
      <wbr/>
      SIGSEGV (0xb) at pc=0xb6d3dbe3, pid=14454, tid=2773482416
      <br/>
      #
      <br/>
      # Java VM: Java HotSpot(TM) Server VM (1.5.0_11-b03 mixed mode)
     </p>
     <p>
      。。。。。
     </p>
     <p>
      <wbr/>
     </p>
     <p>
      ------The End-----
     </p>
     <p>
      #####################################################################################
     </p>
    </div>
    <br/>
    <p>
    </p>
   </div>
  </div>
 </article>
</div>


