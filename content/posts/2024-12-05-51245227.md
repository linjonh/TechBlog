---
layout: post
title: "java和JS代码相互调用"
date: 2024-12-05 18:55:08 +0800
description: "挺帅的移动开发专栏  http://blog.csdn.net/wangtingshuai/arti"
keywords: "java element转javascript"
categories: ['Javascript']
tags: ['移动开发', 'Webview', 'Javascript', 'Android']
artid: "51245227"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=51245227
    alt: "java和JS代码相互调用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=51245227
featuredImagePreview: https://bing.ee123.net/img/rand?artid=51245227
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     java和JS代码相互调用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     挺帅的移动开发专栏
     <a href="http://blog.csdn.net/wangtingshuai/article/details/8631835">
      http://blog.csdn.net/wangtingshuai/article/details/8631835
     </a>
     <br/>
     在android的开发过程中，有很多时候需要用到本地java代码和javascript进行交互。android对交互进行了很好的封装，在开发中我们可以很简单的用java代码调用webview中的js，也可以用webview中的js来调用本地的java代码，这样我们可以实现很多原来做不了的功能，比如点击网页上的电话号码后，手机自动拨打电话，点击网页中的笑话，自动发送短信等.
    </p>
    <p>
     废话不多说，这次教程的目标如下
    </p>
    <ul>
     <li>
      android 中的java代码调用webview里面的js脚本
     </li>
     <li>
      webview中的js脚本调用本地的java代码
     </li>
     <li>
      java调用js并传递参数
     </li>
     <li>
      js调用java并传递参数
     </li>
    </ul>
    <blockquote>
     <p>
      <strong>
       功能一
      </strong>
     </p>
    </blockquote>
    <p>
     android中调用webview中的js脚本非常方便，只需要调用webview的loadUrl方法即可（注意开启js支持）
    </p>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">// 启用javascript  </span>
contentWebView.getSettings().setJavaScriptEnabled(<span class="hljs-keyword">true</span>);  
<span class="hljs-comment">// 从assets目录下面的加载html  </span>
contentWebView.loadUrl(<span class="hljs-string">"file:///android_asset/wst.html"</span>);  

<span class="hljs-comment">// 无参数调用  </span>
contentWebView.loadUrl(<span class="hljs-string">"javascript:javacalljs()"</span>);  </code></pre>
    <blockquote>
     <p>
      <strong>
       功能二
      </strong>
     </p>
    </blockquote>
    <p>
     webview中js调用本地java方法，这个功能实现起来稍微有点麻烦，不过也不怎么复杂，首先要对webview绑定javascriptInterface，js脚本通过这个接口来调用java代码。
    </p>
    <pre class="prettyprint"><code class="hljs cs">contentWebView.addJavascriptInterface(<span class="hljs-keyword">this</span>, <span class="hljs-string">"wst"</span>); </code></pre>
    <p>
     javainterface实际就是一个普通的java类，里面是我们本地实现的java代码， 将object 传递给webview，并指定别名，这样js脚本就可以通过我们给的这个别名来调用我们的方法,在上面的代码中，this是实例化的对象，wst是这个对象在js中的别名
    </p>
    <blockquote>
     <p>
      <strong>
       功能三
      </strong>
     </p>
    </blockquote>
    <p>
     java代码调用js并传递参数
     <br/>
     只需要在待用js函数的时候加入参数即可，下面是传递一个参数的情况，需要多个参数的时候自己拼接及行了，注意str类型在传递的时候参数要用单引号括起来
    </p>
    <pre class="prettyprint"><code class="hljs scilab"><span class="hljs-transposed_variable">mWebView.</span>loadUrl(<span class="hljs-string">"javascript:test('</span><span class="hljs-string">" + aa+ "</span><span class="hljs-string">')"</span>); <span class="hljs-comment">//aa是js的函数test()的参数 </span></code></pre>
    <blockquote>
     <p>
      <strong>
       功能四
      </strong>
     </p>
    </blockquote>
    <p>
     js调用java函数并传参，java函数正常书写，在js脚本中调用的时候稍加注意
     <br/>
     然后在html页面中，利用如下代码，即可实现调用
    </p>
    <pre class="prettyprint"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">'b'</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"window.wst.clickOnAndroid(2)"</span>&gt;</span>b.c<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>  </code></pre>
    <p>
     <img alt="这里写图片描述" src="https://img-blog.csdn.net/20160425203842492" title="">
      <br/>
      这里是实例的html代码，从assert中加载，原来做项目的时候，从assert中加载的中文网页会出现乱码，解决办法就是给html指定编码。如下
     </img>
    </p>
    <pre class="prettyprint"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"Content-Type"</span>  <span class="hljs-attribute">content</span>=<span class="hljs-value">"text/html;charset=gb2312"</span>&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">  
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">javacalljs</span><span class="hljs-params">()</span>{<!-- --></span>  
     document.getElementById(<span class="hljs-string">"content"</span>).innerHTML +=     
         <span class="hljs-string">"&lt;br\&gt;java调用了js函数"</span>;  
}  

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">javacalljswithargs</span><span class="hljs-params">(arg)</span>{<!-- --></span>  
     document.getElementById(<span class="hljs-string">"content"</span>).innerHTML +=     
         (<span class="hljs-string">"&lt;br\&gt;"</span>+arg);  
}  

</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>  
this is my html <span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"window.wst.startFunction()"</span>&gt;</span>点击调用java代码<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"window.wst.startFunction('hello world')"</span> &gt;</span>点击调用java代码并传递参数<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"content"</span>&gt;</span>内容显示<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></code></pre>
    <p>
     java代码 如下
    </p>
    <pre class="prettyprint"><code class="hljs java"><span class="hljs-keyword">package</span> wst.webview;  

<span class="hljs-keyword">import</span> android.annotation.SuppressLint;  
<span class="hljs-keyword">import</span> android.app.Activity;  
<span class="hljs-keyword">import</span> android.os.Bundle;  
<span class="hljs-keyword">import</span> android.view.View;  
<span class="hljs-keyword">import</span> android.view.View.OnClickListener;  
<span class="hljs-keyword">import</span> android.webkit.WebView;  
<span class="hljs-keyword">import</span> android.widget.Button;  
<span class="hljs-keyword">import</span> android.widget.TextView;  
<span class="hljs-keyword">import</span> android.widget.Toast;  

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> {<!-- --></span>  

    <span class="hljs-keyword">private</span> WebView contentWebView = <span class="hljs-keyword">null</span>;  
    <span class="hljs-keyword">private</span> TextView msgView = <span class="hljs-keyword">null</span>;  

    <span class="hljs-annotation">@SuppressLint</span>(<span class="hljs-string">"SetJavaScriptEnabled"</span>)  
    <span class="hljs-annotation">@Override</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {  
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);  
        setContentView(R.layout.main);  
        contentWebView = (WebView) findViewById(R.id.webview);  
        msgView = (TextView) findViewById(R.id.msg);  
        <span class="hljs-comment">// 启用javascript  </span>
        contentWebView.getSettings().setJavaScriptEnabled(<span class="hljs-keyword">true</span>);  
        <span class="hljs-comment">// 从assets目录下面的加载html  </span>
        contentWebView.loadUrl(<span class="hljs-string">"file:///android_asset/wst.html"</span>);  

        Button button = (Button) findViewById(R.id.button);  
        button.setOnClickListener(btnClickListener);  
        contentWebView.addJavascriptInterface(<span class="hljs-keyword">this</span>, <span class="hljs-string">"wst"</span>);  
    }  

    OnClickListener btnClickListener = <span class="hljs-keyword">new</span> Button.OnClickListener() {  
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View v) {  
            <span class="hljs-comment">// 无参数调用  </span>
            contentWebView.loadUrl(<span class="hljs-string">"javascript:javacalljs()"</span>);  
            <span class="hljs-comment">// 传递参数调用  </span>
            contentWebView.loadUrl(<span class="hljs-string">"javascript:javacalljswithargs("</span> + <span class="hljs-string">"'hello world'"</span> + <span class="hljs-string">")"</span>);  
        }  
    };  

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startFunction</span>() {  
        Toast.makeText(<span class="hljs-keyword">this</span>, <span class="hljs-string">"js调用了java函数"</span>, Toast.LENGTH_SHORT).show();  
        runOnUiThread(<span class="hljs-keyword">new</span> Runnable() {  

            <span class="hljs-annotation">@Override</span>  
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {  
                msgView.setText(msgView.getText() + <span class="hljs-string">"\njs调用了java函数"</span>);  

            }  
        });  
    }  

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startFunction</span>(<span class="hljs-keyword">final</span> String str) {  
        Toast.makeText(<span class="hljs-keyword">this</span>, str, Toast.LENGTH_SHORT).show();  
        runOnUiThread(<span class="hljs-keyword">new</span> Runnable() {  

            <span class="hljs-annotation">@Override</span>  
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {  
                msgView.setText(msgView.getText() + <span class="hljs-string">"\njs调用了java函数传递参数："</span> + str);  

            }  
        });  
    }  
}  </code></pre>
    <p>
     布局文件
    </p>
    <pre class="prettyprint"><code class="hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>  
    <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"fill_parent"</span>  
    <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"fill_parent"</span>  
    <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span> &gt;</span>  

    <span class="hljs-tag">&lt;<span class="hljs-title">WebView</span>  
        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/webview"</span>  
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"fill_parent"</span>  
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"fill_parent"</span>  
        <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"9"</span> /&gt;</span>  

    <span class="hljs-tag">&lt;<span class="hljs-title">ScrollView</span>  
        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/scrollView1"</span>  
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"fill_parent"</span>  
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span> &gt;</span>  

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView</span>  
            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/msg"</span>  
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"fill_parent"</span>  
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"fill_parent"</span>  
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"text"</span> /&gt;</span>  
    <span class="hljs-tag">&lt;/<span class="hljs-title">ScrollView</span>&gt;</span>  

    <span class="hljs-tag">&lt;<span class="hljs-title">Button</span>  
        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/button"</span>  
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"fill_parent"</span>  
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>  
        <span class="hljs-attribute">android:layout_weight</span>=<span class="hljs-value">"1"</span>  
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"java调用js函数"</span> /&gt;</span>  

<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span>  </code></pre>
    <p>
     希望对大家有所帮助
     <br/>
     资源下载地址
     <br/>
     <a href="http://download.csdn.net/download/wangtingshuai/5106571">
      http://download.csdn.net/download/wangtingshuai/5106571
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f62696e676b696e67626f79:2f61727469636c652f64657461696c732f3531323435323237" class_="artid" style="display:none">
 </p>
</div>


