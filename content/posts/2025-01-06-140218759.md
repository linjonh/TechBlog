---
layout: post
title: "Spring-Boot集成jacoco实现单元测试覆盖统计"
date: 2025-01-06 22:45:54 +0800
description: "JaCoCo，即 Java Code Coverage，是一款开源的 Java 代码覆盖率统计工具。"
keywords: "jacoco"
categories: ['Spring', 'Demo', 'Boot']
tags: ['后端', '单元测试', 'Spring', 'Jacoco', 'Boot']
artid: "140218759"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=140218759
    alt: "Spring-Boot集成jacoco实现单元测试覆盖统计"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=140218759
featuredImagePreview: https://bing.ee123.net/img/rand?artid=140218759
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring Boot集成jacoco实现单元测试覆盖统计
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     1.什么是jacoco？
    </h3>
    <p>
     JaCoCo，即 Java Code Coverage，是一款开源的 Java 代码覆盖率统计工具。支持 Ant 、Maven、Gradle 等构建工具，支持 Jenkins、Sonar 等持续集成工具，支持 Java Agent 技术远程监控 Java 程序运行情况，支持Eclipse、IDEA等IDE，提供HTML，CSV 等格式的报表导出，轻量级实现，对外部库和系统资源的依赖性小，性能开销小。 JaCoCo 支持从 JDK1.0 版本到 JDK1.8 版本 的 Java 类文件。但是，JaCoCo 工具所需的JRE 版本最小为 1.5。另外，1.6及以上版本的测试中的类文件必须包含有效的堆栈映射帧。
    </p>
    <h4>
     它有以下功能特性：
    </h4>
    <ul>
     <li>
      指令（C0）、分支（C1）、行、方法、类型和圈复杂度的
      <a href="https://www.jacoco.org/jacoco/trunk/doc/counters.html" rel="nofollow" title="覆盖分析">
       覆盖分析
      </a>
      。
     </li>
     <li>
      基于 Java 字节码，因此也可以在没有源文件的情况下工作。
     </li>
     <li>
      通过基于实时检测的
      <a href="https://www.jacoco.org/jacoco/trunk/doc/agent.html" rel="nofollow" title="Java 代理进行">
       Java 代理进行
      </a>
      简单集成。通过 API 可以实现其他集成场景，例如自定义类加载器。
     </li>
     <li>
      与框架无关：基于 Java VM 的应用程序都可以顺利集成，例如普通 Java 程序、OSGi 框架、Web 容器或 EJB 服务器。
     </li>
     <li>
      与所有已发布的 Java 类文件版本兼容。
     </li>
     <li>
      支持不同
      <a href="http://en.wikipedia.org/wiki/List_of_JVM_languages" rel="nofollow" title="JVM 语言">
       JVM 语言
      </a>
      。
     </li>
     <li>
      多种报告格式（HTML、XML、CSV）。
     </li>
     <li>
      在任何时间点，可以使用远程协议和 JMX 控制从覆盖代理请求执行数据转储。
     </li>
     <li>
      用于收集和管理执行数据并创建结构化覆盖率报告的
      <a href="https://www.jacoco.org/jacoco/trunk/doc/ant.html" rel="nofollow" title="Ant 任务">
       Ant 任务
      </a>
      。
     </li>
     <li>
      <a href="https://www.jacoco.org/jacoco/trunk/doc/maven.html" rel="nofollow" title="Maven 插件，">
       Maven 插件，
      </a>
      用于收集覆盖信息并在 Maven 构建中创建报告。
     </li>
    </ul>
    <h4>
     非功能特性：
    </h4>
    <ul>
     <li>
      简单的使用和与现有构建脚本和工具的集成。
     </li>
     <li>
      良好的性能，最小的运行时开销，尤其是对于大型项目。
     </li>
     <li>
      对外部库和系统资源的依赖最小的轻量级实现。
     </li>
     <li>
      综合文档。
     </li>
     <li>
      完整的API文档（
      <a href="https://www.jacoco.org/jacoco/trunk/doc/api/index.html" rel="nofollow" title="JavaDoc">
       JavaDoc
      </a>
      ）和 其他工具
      <a href="https://www.jacoco.org/jacoco/trunk/doc/integrations.html" rel="nofollow" title="集成">
       集成
      </a>
      的
      <a href="https://www.jacoco.org/jacoco/trunk/doc/api.html" rel="nofollow" title="示例">
       示例
      </a>
      。
     </li>
     <li>
      基于
      <a href="http://junit.org/" rel="nofollow" title="JUnit">
       JUnit
      </a>
      <a href="https://www.jacoco.org/jacoco/trunk/test/index.html" rel="nofollow" title="测试用例">
       测试用例
      </a>
      的完整功能
      <a href="https://www.jacoco.org/jacoco/trunk/coverage/index.html" rel="nofollow" title="测试覆盖">
       测试覆盖
      </a>
      的回归测试。
     </li>
    </ul>
    <p>
    </p>
    <h3>
     2.代码工程
    </h3>
    <h4>
     实验目标
    </h4>
    <p>
     实验单元测试覆盖率检测
    </p>
    <h4>
     pom.xml
    </h4>
    <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;springboot-demo&lt;/artifactId&gt;
        &lt;groupId&gt;com.et&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;jacoco&lt;/artifactId&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
                &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;0.8.6&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;prepare-agent&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;id&gt;jacoco-report&lt;/id&gt;
                        &lt;phase&gt;test&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;report&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;id&gt;jacoco-check&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;check&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;rules&gt;
                                &lt;rule&gt;
                                    &lt;element&gt;PACKAGE&lt;/element&gt;
                                    &lt;limits&gt;
                                        &lt;limit&gt;
                                            &lt;counter&gt;LINE&lt;/counter&gt;
                                            &lt;value&gt;COVEREDRATIO&lt;/value&gt;
                                            &lt;minimum&gt;0.0&lt;/minimum&gt;
                                        &lt;/limit&gt;
                                    &lt;/limits&gt;
                                &lt;/rule&gt;
                            &lt;/rules&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.0.0-M5&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;forkedProcessExitTimeoutInSeconds&gt;60&lt;/forkedProcessExitTimeoutInSeconds&gt;
                    &lt;forkCount&gt;1&lt;/forkCount&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
    <h4>
     controller
    </h4>
    <pre><code>package com.et.jacoco.controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.HashMap;
import java.util.Map;

@RestController
public class HelloWorldController {
    @RequestMapping("/hello")
    public Map&lt;String, Object&gt; showHelloWorld(){
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put("msg", "HelloWorld");
        return map;
    }
}</code></pre>
    <h4>
     测试类
    </h4>
    <pre><code>package com.et.jacoco;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;

import static org.hamcrest.core.StringContains.containsString;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@ExtendWith(SpringExtension.class)
@WebMvcTest
@AutoConfigureMockMvc
public class HelloControllerTest {

    @Autowired
    private MockMvc mvc;

    @Test
    public void getHello() throws Exception {
        mvc.perform(MockMvcRequestBuilders.get("/hello").accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(content().string(containsString("HelloWorld")));
    }
}</code></pre>
    <p>
     以上只是一些关键代码，所有代码请参见下面代码仓库
    </p>
    <h4>
     代码仓库
    </h4>
    <ul>
     <li>
      <a href="https://github.com/Harries/springboot-demo" title="GitHub - Harries/springboot-demo: a simple springboot demo with some components for example: redis,solr,rockmq and so on.">
       GitHub - Harries/springboot-demo: a simple springboot demo with some components for example: redis,solr,rockmq and so on.
      </a>
     </li>
    </ul>
    <h3>
     3.测试
    </h3>
    <p>
     执行
     <code>
      mvn clean test 会自动在项目目录：
      <code>
       target/site/jacoco/index.html
      </code>
      即可查看到图形化的测试报告，如下：
     </code>
    </p>
    <p class="img-center">
     <a href="http://www.liuhaihua.cn/wp-content/uploads/2024/07/123.png" rel="nofollow">
      <img alt="123" height="340" src="https://i-blog.csdnimg.cn/blog_migrate/416b8c1c7153184b08a87f3437ab8579.png" width="1200"/>
     </a>
    </p>
    <p>
     点击链接，你可以查看每个类的代码覆盖情况，如下：
    </p>
    <p class="img-center">
     <a href="http://www.liuhaihua.cn/wp-content/uploads/2024/07/2221.png" rel="nofollow">
      <img alt="222" height="746" src="https://i-blog.csdnimg.cn/blog_migrate/5f16112f1a6a63f188b1908ea39b7def.png" width="1200"/>
     </a>
    </p>
    <p>
    </p>
    <h3 id="五总结">
     四.总结
    </h3>
    <p>
     本文简单介绍 JaCoCo 最基本使用和上手，希望你可以通过官网探索更多的高级功能,关于覆盖率给你一些建议：
    </p>
    <ul>
     <li>
      覆盖率指标大多数情况下仅作为参考，不要用它作为考核指标
     </li>
     <li>
      不要过于追求覆盖率指标，100% 的覆盖率也不能代表你的项目没有 BUG
     </li>
    </ul>
    <h3>
     4.引用
    </h3>
    <ul>
     <li>
      <a href="https://www.jacoco.org/jacoco/trunk/doc/index.html" rel="nofollow" title="https://www.jacoco.org/jacoco/trunk/doc/index.html">
       https://www.jacoco.org/jacoco/trunk/doc/index.html
      </a>
     </li>
     <li>
      <a href="http://www.liuhaihua.cn/archives/710819.html" rel="nofollow" title="Spring Boot集成jacoco实现单元测试覆盖统计 | Harries Blog™">
       Spring Boot集成jacoco实现单元测试覆盖统计 | Harries Blog™
      </a>
     </li>
    </ul>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f646f745f6c6966652f:61727469636c652f64657461696c732f313430323138373539" class_="artid" style="display:none">
 </p>
</div>


