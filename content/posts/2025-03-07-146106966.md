---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37343832333433342f:61727469636c652f64657461696c732f313436313036393636"
layout: post
title: "Nginxä¸­http_hosthostproxy_hostçš„åŒºåˆ«"
date: 2025-03-07 22:30:58 +0800
description: "å˜é‡æ˜¯å¦æ˜¾ç¤ºç«¯å£å€¼æ˜¯å¦å­˜åœ¨hostæµè§ˆå™¨è¯·æ±‚çš„ipï¼Œä¸æ˜¾ç¤ºç«¯å£å¦\"Host:value\"æ˜¾ç¤ºå€¼ä¸ºa:bçš„æ—¶å€™ï¼Œåªæ˜¾ç¤ºahttp_hostæµè§ˆå™¨è¯·æ±‚çš„ipå’Œç«¯å£å·æ˜¯â€œHost:valueâ€ï¼Œvalueå­˜åœ¨å°±æ˜¾ç¤ºproxy_hostè¢«ä»£ç†æœåŠ¡çš„ipå’Œç«¯å£å·é»˜è®¤80ä¸æ˜¾ç¤ºå…¶ä»–ç«¯å£æ˜¾ç¤º\"Host:value\"æ˜¾ç¤ºé…ç½®åå‘ä»£ç†æ—¶ï¼Œæ¥å£è¯·æ±‚æŠ¥404é—®é¢˜åº”ç”¨æè¿°ï¼šå‰ç«¯åº”ç”¨åŸŸåä¸ºAï¼ˆww.a.comï¼‰, åç«¯æœåŠ¡åŸŸåä¸ºBï¼ˆwww.b.comï¼‰;"
keywords: "Nginxä¸­$http_hostã€$hostã€$proxy_hostçš„åŒºåˆ«"
categories: ['é¢è¯•', 'é˜¿é‡Œå·´å·´', 'å­¦ä¹ è·¯çº¿']
tags: ['è¿ç»´', 'Nginx', 'Http']
artid: "146106966"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146106966
    alt: "Nginxä¸­http_hosthostproxy_hostçš„åŒºåˆ«"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146106966
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146106966
cover: https://bing.ee123.net/img/rand?artid=146106966
image: https://bing.ee123.net/img/rand?artid=146106966
img: https://bing.ee123.net/img/rand?artid=146106966
---

# Nginxä¸­$http\_hostã€$hostã€$proxy\_hostçš„åŒºåˆ«

**çŸ¥è¯†å·©å›ºï¼**

**ç½‘ä¸Šçœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œè¿™é‡Œè½¬è½½è®°å½•ä¸€ä¸‹ã€‚**

### ç®€ä»‹

å˜é‡

æ˜¯å¦æ˜¾ç¤ºç«¯å£

å€¼æ˜¯å¦å­˜åœ¨

host

æµè§ˆå™¨è¯·æ±‚çš„ipï¼Œä¸æ˜¾ç¤ºç«¯å£

å¦

"Host:value"æ˜¾ç¤º

å€¼ä¸ºa:bçš„æ—¶å€™ï¼Œåªæ˜¾ç¤ºa

http\_host

æµè§ˆå™¨è¯·æ±‚çš„ipå’Œç«¯å£å·

æ˜¯

â€œHost:valueâ€ï¼Œvalueå­˜åœ¨å°±æ˜¾ç¤º

proxy\_host

è¢«ä»£ç†æœåŠ¡çš„ipå’Œç«¯å£å·

é»˜è®¤80ä¸æ˜¾ç¤º

å…¶ä»–ç«¯å£æ˜¾ç¤º

"Host:value"æ˜¾ç¤º

é…ç½®åå‘ä»£ç†æ—¶ï¼Œæ¥å£è¯·æ±‚æŠ¥404é—®é¢˜

åº”ç”¨æè¿°ï¼šå‰ç«¯åº”ç”¨åŸŸåä¸ºAï¼ˆww.a.comï¼‰, åç«¯æœåŠ¡åŸŸåä¸ºBï¼ˆwww.b.comï¼‰; ä¸ºäº†è§£å†³è·¨åŸŸé—®é¢˜ï¼Œé…ç½®nginxåå‘ä»£ç†å¦‚ä¸‹ï¼š

â€¦
  
proxy\_set\_header Host
KaTeX parse error: Undefined control sequence: \\* at position 54: â€¦write "^/api/(.\Ì²\*Ì²)
" /$1 break;
  
proxy\_pass http://www.b.com;
  
}
  
é—®é¢˜ï¼šè¿™æ ·é…ç½®å®Œæˆåï¼Œæ¥å£æŠ¥404é—®é¢˜ã€‚

è§£å†³ï¼š
  
æ–¹æ¡ˆä¸€ï¼šå°†proxy\_set\_headeræ³¨é‡Šæ‰
  
æ–¹æ¡ˆäºŒï¼šä¿®æ”¹åå‘ä»£ç†é…ç½®ï¼Œè®¾ç½®è¯·æ±‚å¤´Hostï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

location ^~ /api/ {
  
rewrite â€œ^/api/(.\*)$â€ /$1 break;
  
proxy\_pass http://www.b.com;
  
**proxy\_set\_header Host $proxy\_host; //æ–¹å¼ä¸€ï¼šè®¾ç½®è¯·æ±‚å¤´hostä¸ºwww.b.comçš„ipå’Œç«¯å£å·
  
proxy\_set\_header Host www.b.com; //æ–¹å¼äºŒï¼šè®¾ç½®è¯·æ±‚hostä¸ºwww.b.com**
  
}

### nginxä¸­proxy\_set\_header Host $hostçš„ä½œç”¨

nginxä¸ºäº†å®ç°åå‘ä»£ç†çš„éœ€æ±‚è€Œå¢åŠ äº†ä¸€ä¸ªngx\_http\_proxy\_moduleæ¨¡å—ã€‚å…¶ä¸­proxy\_set\_headeræŒ‡ä»¤å°±æ˜¯è¯¥æ¨¡å—éœ€è¦è¯»å–çš„é…ç½®æ–‡ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæ‰€æœ‰è®¾ç½®çš„å€¼çš„å«ä¹‰å’Œhttpè¯·æ±‚ä½“ä¸­çš„å«ä¹‰å®Œå…¨ç›¸åŒï¼Œé™¤äº†Hostå¤–è¿˜æœ‰X-Forward-Forã€‚

Hostçš„å«ä¹‰æ˜¯è¡¨æ˜è¯·æ±‚çš„ä¸»æœºåï¼Œå› ä¸ºnginxä½œä¸ºåå‘ä»£ç†ä½¿ç”¨ï¼Œ
**è€Œå¦‚æœåç«¯çœŸå®æœåŠ¡å™¨è®¾ç½®æœ‰ç±»ä¼¼é˜²ç›—é“¾æˆ–è€…æ ¹æ®httpè¯·æ±‚å¤´ä¸­çš„hostå­—æ®µæ¥è¿›è¡Œè·¯ç”±æˆ–åˆ¤æ–­åŠŸèƒ½çš„è¯ï¼Œå¦‚æœåå‘ä»£ç†å±‚çš„nginxä¸é‡å†™è¯·æ±‚å¤´ä¸­çš„hostå­—æ®µï¼Œå°†ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥**
ã€é»˜è®¤åå‘ä»£ç†æœåŠ¡å™¨ä¼šå‘åç«¯çœŸå®æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸”è¯·æ±‚å¤´ä¸­çš„hostå­—æ®µåº”ä¸ºproxy\_passæŒ‡ä»¤è®¾ç½®çš„æœåŠ¡å™¨ã€‘

åŒç†ï¼ŒX\_Forward\_Forå­—æ®µè¡¨ç¤ºè¯¥æ¡httpè¯·æ±‚æ˜¯ç”±è°å‘èµ·çš„ï¼Ÿå¦‚æœåå‘ä»£ç†æœåŠ¡å™¨ä¸é‡å†™è¯¥è¯·æ±‚å¤´çš„è¯ï¼Œé‚£ä¹ˆåç«¯çœŸå®æœåŠ¡å™¨åœ¨å¤„ç†æ—¶ä¼šè®¤ä¸ºæ‰€æœ‰çš„è¯·æ±‚éƒ½æ¥åœ¨åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœ‰é˜²æ”»å‡»ç­–ç•¥çš„è¯ï¼Œé‚£ä¹ˆæœºå™¨å°±è¢«å°æ‰äº†ã€‚å› æ­¤ï¼Œåœ¨é…ç½®ç”¨ä½œåå‘ä»£ç†çš„nginxä¸­ä¸€èˆ¬ä¼šå¢åŠ ä¸¤æ¡é…ç½®ï¼Œä¿®æ”¹httpçš„è¯·æ±‚å¤´ã€‚

1

2

`proxy_set_header Host $http_host;`

`proxy_set_header X-Forward-For $remote_addr;`

è¿™é‡Œçš„

h
t
t
p
\_
h
o
s
t
å’Œ
http\\_hostå’Œ





h

ttp

\_

h

os

t

å’Œ
remote\_addréƒ½æ˜¯nginxçš„å¯¼å‡ºå˜é‡ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨ã€‚å¦‚æœHostè¯·æ±‚å¤´éƒ¨æ²¡æœ‰å‡ºç°åœ¨è¯·æ±‚å¤´ä¸­ï¼Œåˆ™

h
t
t
p
\_
h
o
s
t
å€¼ä¸ºç©ºï¼Œä½†æ˜¯
http\\_hostå€¼ä¸ºç©ºï¼Œä½†æ˜¯





h

ttp

\_

h

os

t

å€¼ä¸ºç©ºï¼Œä½†æ˜¯
hostå€¼ä¸ºä¸»åŸŸåã€‚å› æ­¤ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œä¼šç”¨

h
o
s
t
ä»£æ›¿
hostä»£æ›¿





h

os

t

ä»£æ›¿
http\_hostå˜é‡ï¼Œä»è€Œé¿å…httpè¯·æ±‚ä¸­ä¸¢å¤±Hostå¤´éƒ¨çš„æƒ…å†µä¸‹Hostä¸è¢«é‡å†™çš„å¤±è¯¯ã€‚

X-Forwarded-Forï¼šç®€ç§°XFFå¤´ï¼Œå®ƒä»£è¡¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IPï¼Œåªæœ‰åœ¨é€šè¿‡äº†HTTP ä»£ç†æˆ–è€…è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ—¶æ‰ä¼šæ·»åŠ è¯¥é¡¹ã€‚ å®ƒä¸æ˜¯RFCä¸­å®šä¹‰çš„æ ‡å‡†è¯·æ±‚å¤´ä¿¡æ¯ï¼Œåœ¨squidç¼“å­˜ä»£ç†æœåŠ¡å™¨å¼€å‘æ–‡æ¡£ä¸­å¯ä»¥æ‰¾åˆ°è¯¥é¡¹çš„è¯¦ç»†ä»‹ç»ã€‚æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼šX-Forwarded-For: client1, proxy1, proxy2ã€‚

è¿™ä¸€HTTPå¤´ä¸€èˆ¬æ ¼å¼å¦‚ä¸‹ï¼šX-Forwarded-For: client1, proxy1, proxy2ã€‚å…¶ä¸­çš„å€¼é€šè¿‡ä¸€ä¸ªâ€œé€—å·+ç©ºæ ¼â€æŠŠå¤šä¸ªIPåœ°å€åŒºåˆ†å¼€, æœ€å·¦è¾¹(client1)æ˜¯æœ€åŸå§‹å®¢æˆ·ç«¯çš„IPåœ°å€, ä»£ç†æœåŠ¡å™¨æ¯æˆåŠŸæ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå°±æŠŠ
**è¯·æ±‚æ¥æºIPåœ°å€**
æ·»åŠ åˆ°å³è¾¹ã€‚

åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¸ªè¯·æ±‚æˆåŠŸé€šè¿‡äº†ä¸‰å°ä»£ç†æœåŠ¡å™¨ï¼šproxy1, proxy2 åŠ proxy3ã€‚è¯·æ±‚ç”±client1å‘å‡ºï¼Œåˆ°è¾¾äº†proxy3(proxy3å¯èƒ½æ˜¯è¯·æ±‚çš„ç»ˆç‚¹)ã€‚è¯·æ±‚åˆšä»client1ä¸­å‘å‡ºæ—¶ï¼ŒXFFæ˜¯ç©ºçš„ï¼Œè¯·æ±‚è¢«å‘å¾€proxy1ï¼›é€šè¿‡proxy1çš„æ—¶å€™ï¼Œclient1è¢«æ·»åŠ åˆ°XFFä¸­ï¼Œä¹‹åè¯·æ±‚è¢«å‘å¾€proxy2;é€šè¿‡proxy2çš„æ—¶å€™ï¼Œproxy1è¢«æ·»åŠ åˆ°XFFä¸­ï¼Œä¹‹åè¯·æ±‚è¢«å‘å¾€proxy3ï¼›é€šè¿‡proxy3æ—¶ï¼Œproxy2è¢«æ·»åŠ åˆ°XFFä¸­ï¼Œä¹‹åè¯·æ±‚çš„çš„å»å‘ä¸æ˜ï¼Œå¦‚æœproxy3ä¸æ˜¯è¯·æ±‚ç»ˆç‚¹ï¼Œè¯·æ±‚ä¼šè¢«ç»§ç»­è½¬å‘ã€‚

é‰´äºä¼ªé€ è¿™ä¸€å­—æ®µéå¸¸å®¹æ˜“ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨X-Forwarded-Forå­—æ®µã€‚æ­£å¸¸æƒ…å†µä¸‹XFFä¸­æœ€åä¸€ä¸ªIPåœ°å€æ˜¯æœ€åä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„IPåœ°å€, è¿™é€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¯é çš„ä¿¡æ¯æ¥æºã€‚

### proxy\_set\_headerè®¾ç½®Hostä¸º p r o x y \_ h o s t ï¼Œ proxy\\_hostï¼Œ p ro x y \_ h os t ï¼Œ hostä¸$local\_hostçš„åŒºåˆ«

å…ˆæ¥çœ‹ä¸‹proxy\_set\_headerçš„è¯­æ³•ï¼š
`**proxy_set_header**?`field``value`;`

é»˜è®¤å€¼ï¼š

1

2

`proxy_set_header Host $proxy_host;`

`proxy_set_header Connection close;`

ä¸Šä¸‹æ–‡ï¼š
`http`
,
`server`
,
`location`

ä½œç”¨ï¼šå…è®¸é‡æ–°å®šä¹‰æˆ–è€…æ·»åŠ å‘å¾€åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å¤´ã€‚
`value`
å¯ä»¥åŒ…å«æ–‡æœ¬ã€å˜é‡æˆ–è€…å®ƒä»¬çš„ç»„åˆã€‚ å½“ä¸”ä»…å½“å½“å‰é…ç½®çº§åˆ«ä¸­æ²¡æœ‰å®šä¹‰
`proxy_set_header`
æŒ‡ä»¤æ—¶ï¼Œä¼šä»ä¸Šé¢çš„çº§åˆ«ç»§æ‰¿é…ç½®ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸¤ä¸ªè¯·æ±‚å¤´ä¼šè¢«é‡æ–°å®šä¹‰ï¼š

1

2

`proxy_set_header Host?????? $proxy_host;`

`proxy_set_header Connection close;`

nginxå¯¹äºupstreamé»˜è®¤ä½¿ç”¨çš„æ˜¯åŸºäºIPçš„è½¬å‘ï¼Œå› æ­¤å¯¹äºä»¥ä¸‹é…ç½®ï¼š

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

`upstream backend {?`

`????????``server 127.0.0.1:8080;?`

`????``}?`

`????``upstream crmtest {?`

`????????``server crmtest.aty.sohuno.com;?`

`????``}?`

`????``server {?`

`????????????``listen?????? 80;?`

`????????????``server_name? chuan.aty.sohuno.com;?`

`????????????``proxy_set_header Host $http_host;?`

`????????????``proxy_set_header x-forwarded-for? $remote_addr;?`

`????????????``proxy_buffer_size???????? 64k;?`

`????????????``proxy_buffers???????????? 32 64k;?`

`????????????``charset utf-8;?`

`????????????``access_log? logs/host.access.log? main;?`

`????????????``location = /50x.html {?`

`????????????????``root?? html;?`

`????????????``}?`

`????????``location / {?`

`????????????``proxy_pass backend ;?`

`????????``}?`

`????????``location = /customer/straightcustomer/download {?`

`????????????``proxy_pass http://crmtest;?`

`????????????``proxy_set_header Host $proxy_host;?`

`????????``}?`

`????``}`

å½“åŒ¹é…åˆ° /customer/straightcustomer/downloadæ—¶ï¼Œä½¿ç”¨crmtestå¤„ç†ï¼Œåˆ°upstreamå°±åŒ¹é…åˆ°crmtest.aty.sohuno.comï¼Œè¿™é‡Œç›´æ¥è½¬æ¢æˆIPè¿›è¡Œè½¬å‘äº†ã€‚å‡å¦‚crmtest.aty.sohuno.comæ˜¯åœ¨å¦ä¸€å°nginxä¸‹é…ç½®çš„ï¼Œipä¸º10.22.10.116ï¼Œåˆ™$proxy\_hoståˆ™å¯¹åº”ä¸º10.22.10.116ã€‚æ­¤æ—¶ç›¸å½“äºè®¾ç½®äº†Hostä¸º10.22.10.116ã€‚

1

2

3

4

5

6

7

8

9

10

11

`// å¦‚æœæƒ³è®©Hostæ˜¯crmtest.aty.sohuno.comï¼Œåˆ™è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š`

`proxy_set_header Host crmtest.aty.sohuno.com;`

`// å¦‚æœä¸æƒ³æ”¹å˜è¯·æ±‚å¤´â€œHostâ€çš„å€¼ï¼Œå¯ä»¥è¿™æ ·æ¥è®¾ç½®ï¼š`

`proxy_set_header Host $http_host;`

`// ä½†æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­æ²¡æœ‰æºå¸¦è¿™ä¸ªå¤´éƒ¨ï¼Œé‚£ä¹ˆä¼ é€’åˆ°åç«¯æœåŠ¡å™¨çš„è¯·æ±‚ä¹Ÿä¸å«è¿™ä¸ªå¤´éƒ¨ã€‚`

`// è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨$hostå˜é‡â€”â€”å®ƒçš„å€¼åœ¨è¯·æ±‚åŒ…å«â€œHostâ€è¯·æ±‚å¤´æ—¶ä¸ºâ€œHostâ€å­—æ®µçš„å€¼ï¼Œåœ¨è¯·æ±‚æœªæºå¸¦â€œHostâ€è¯·æ±‚å¤´æ—¶ä¸ºè™šæ‹Ÿä¸»æœºçš„ä¸»åŸŸåï¼š`

`proxy_set_header Host?????? $host;`

`// æ­¤å¤–ï¼ŒæœåŠ¡å™¨åå¯ä»¥å’Œåç«¯æœåŠ¡å™¨çš„ç«¯å£ä¸€èµ·ä¼ é€ï¼š`

`proxy_set_header Host $host:$proxy_port;`

`// å¦‚æœæŸä¸ªè¯·æ±‚å¤´çš„å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å¤´å°†ä¸ä¼šä¼ é€ç»™åç«¯æœåŠ¡å™¨ï¼š`

`proxy_set_header Accept-Encoding "";`

### é€šè¿‡Nginxé…ç½®æ¼”ç¤ºï¼š

[root@ans3 conf]# cat nginx.conf

```
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
error_log  logs/error.log  info;
#pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  logs/access.log  main;
    sendfile        on;
    tcp_nopush     on;
    keepalive_timeout  65;

    server {
       listen       80;
       server_name  a.test.com;

       location / {
            proxy_pass http://10.0.0.50:8080;
            proxy_set_header X-Proxy-Host $proxy_host;
            proxy_set_header Host $http_host;
            index index.html index.htm;
       }
    }
}

```

å¦ä¸€å°æœåŠ¡å™¨é…ç½®

[root@master conf]# cat nginx.conf

```
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;
#pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       8080;
        server_name  www.test.com aa.test.com;

        location / {
              return 200 'http_host=[$http_host] host=[$host] proxy_host=[$http_x_proxy_host]
';
        }
    }
}

```

#### ä¸æºå¸¦è¯·æ±‚å¤´ Host

[root@ans3 conf]# curl -H â€˜Host:â€™ --http1.0 http://a.test.com

http\_host=[]
  
host=[www.test.com]
  
proxy\_host=[10.0.0.50:8080]

å˜é‡

å€¼

è¯´æ˜

http\_host

è¯·æ±‚æ—  Host, åˆ™ http\_host ä¸ºç©º, ç»§è€Œæ—  Host ä¼ åˆ° proxy

host

www.test.com

proxy æ—  Host ä¼ å…¥, åˆ™ä½¿ç”¨å…¶ server\_name çš„ç¬¬ä¸€é¡¹

proxy\_host

10.0.0.50:8080

å–è‡ªäº proxy\_pass çš„å‚æ•°

#### æºå¸¦è¯·æ±‚å¤´ Host

[root@ans3 conf]# curl -H â€˜HostğŸ”¤123â€™ --http1.0 http://a.test.com

http\_host=[abc:123]
  
host=[abc]
  
proxy\_host=[10.0.0.50:8080]

å˜é‡

å€¼

è¯´æ˜

http\_host

abc:123

ç»™å•¥æ‹¿å•¥

host

abc

ç¬¬ä¸€ä¸ª
`:`
å‰çš„å†…å®¹(å°å†™)

proxy\_host

10.0.0.50:8080

å¸¦ç«¯å£æ˜¾ç¤º

ä¿®æ”¹çœŸå®æœåŠ¡å™¨çš„ç«¯å£ä¸ºé»˜è®¤ç«¯å£

http {
  
include mime.types;
  
default\_type application/octet-stream;

```
log\_format  main  '$remote\_addr - $remote\_user \[$time\_local\] "$request" '
                  '$status $body\_bytes\_sent "$http\_referer" '
                  '"$http\_user\_agent" "$http\_x\_forwarded\_for"';

access\_log  logs/access.log  main;
sendfile        on;
tcp\_nopush     on;
keepalive\_timeout  65;

server {
    listen  80;
    server\_name  a.test.com;
    
    location / {
        proxy\_pass http://10.0.0.50:80;
        proxy\_set\_header X-Proxy-Host $proxy\_host;
        proxy\_set\_header Host $http\_host;
        index index.html index.htm;
   }

```

}
  
}

http {
  
include mime.types;
  
default\_type application/octet-stream;

```
sendfile        on;
keepalive\_timeout  65;

server {
    listen       80;
    server\_name www.test.com aa.test.com;


    location / {
         return 200 'http\_host=\[$http\_host\] host=\[$host\] proxy\_host= \[$http\_x\_proxy\_host\]

```

';
  
}
  
}
  
}

è®¿é—®æ—¶proxy\_hostä¼šçœç•¥80ç«¯å£

[root@ans3 conf]# curl -H
**â€˜HostğŸ”¤123â€™**
--http1.0 http://a.test.com

http\_host=[abc:123]
  
host=[abc]
  
proxy\_host=[10.0.0.50]