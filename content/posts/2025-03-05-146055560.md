---
layout: post
title: "大语言模型LLM和嵌入模型的统一调用接口"
date: 2025-03-05 23:14:30 +0800
description: "Python实现LLM模型、Embedding嵌入模型工厂"
keywords: "大语言模型（LLM）和嵌入模型的统一调用接口"
categories: ['Python']
tags: ['Python']
artid: "146055560"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146055560
    alt: "大语言模型LLM和嵌入模型的统一调用接口"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146055560
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146055560
cover: https://bing.ee123.net/img/rand?artid=146055560
image: https://bing.ee123.net/img/rand?artid=146055560
img: https://bing.ee123.net/img/rand?artid=146055560
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     大语言模型（LLM）和嵌入模型的统一调用接口
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="ChatModelFactoryEmbeddingModelFactory_0">
     </a>
     ChatModelFactory、EmbeddingModelFactory
    </h2>
    <pre><code class="prism language-python">讲解代码：<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv<span class="token punctuation">,</span> find_dotenv

_ <span class="token operator">=</span> load_dotenv<span class="token punctuation">(</span>find_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> langchain_openai <span class="token keyword">import</span> ChatOpenAI<span class="token punctuation">,</span> OpenAIEmbeddings<span class="token punctuation">,</span> AzureChatOpenAI<span class="token punctuation">,</span> AzureOpenAIEmbeddings


<span class="token keyword">class</span> <span class="token class-name">ChatModelFactory</span><span class="token punctuation">:</span>
    model_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">"seed"</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> use_azure<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">"gpt"</span> <span class="token keyword">in</span> model_name<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> use_azure<span class="token punctuation">:</span>
                <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span>model_name<span class="token punctuation">,</span> <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> AzureChatOpenAI<span class="token punctuation">(</span>
                    azure_deployment<span class="token operator">=</span>model_name<span class="token punctuation">,</span>
                    api_version<span class="token operator">=</span><span class="token string">"2024-05-01-preview"</span><span class="token punctuation">,</span>
                    <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params
                <span class="token punctuation">)</span>
        <span class="token keyword">elif</span> model_name <span class="token operator">==</span> <span class="token string">"deepseek"</span><span class="token punctuation">:</span>
            <span class="token comment"># 换成开源模型试试</span>
            <span class="token comment"># https://siliconflow.cn/</span>
            <span class="token comment"># 一个 Model-as-a-Service 平台</span>
            <span class="token comment"># 可以通过与 OpenAI API 兼容的方式调用各种开源语言模型。</span>
            <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span>
                model<span class="token operator">=</span><span class="token string">"deepseek-ai/DeepSeek-V2-Chat"</span><span class="token punctuation">,</span>  <span class="token comment"># 模型名称</span>
                openai_api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"SILICONFLOW_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 在平台注册账号后获取</span>
                openai_api_base<span class="token operator">=</span><span class="token string">"https://api.siliconflow.cn/v1"</span><span class="token punctuation">,</span>  <span class="token comment"># 平台 API 地址</span>
                <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_default_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">EmbeddingModelFactory</span><span class="token punctuation">:</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> use_azure<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> model_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"text-embedding"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> use_azure<span class="token punctuation">:</span>
                <span class="token keyword">return</span> OpenAIEmbeddings<span class="token punctuation">(</span>model<span class="token operator">=</span>model_name<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> AzureOpenAIEmbeddings<span class="token punctuation">(</span>
                    azure_deployment<span class="token operator">=</span>model_name<span class="token punctuation">,</span>
                    openai_api_version<span class="token operator">=</span><span class="token string">"2024-05-01-preview"</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Model </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model_name<span class="token punctuation">}</span></span><span class="token string"> not implemented."</span></span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_default_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token string">"text-embedding-ada-002"</span><span class="token punctuation">)</span>

</code></pre>
    <p>
     以下是这段代码的逐层解析，该代码实现了大语言模型（LLM）和嵌入模型的统一调用接口，支持多种云服务和开源模型：
    </p>
    <hr/>
    <h4>
     <a id="_72">
     </a>
     一、环境初始化
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv<span class="token punctuation">,</span> find_dotenv

<span class="token comment"># 加载.env文件中的环境变量</span>
_ <span class="token operator">=</span> load_dotenv<span class="token punctuation">(</span>find_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键技术
      </strong>
      ：
      <ul>
       <li>
        <code>
         dotenv
        </code>
        库自动寻找项目根目录下的
        <code>
         .env
        </code>
        文件（包括上级目录）
       </li>
       <li>
        将环境变量（如API Key）注入系统环境变量
       </li>
      </ul>
     </li>
     <li>
      <strong>
       典型
       <code>
        .env
       </code>
       内容
      </strong>
      ：
      <pre><code class="prism language-ini">OPENAI_API_KEY = "sk-xxx"
AZURE_OPENAI_KEY = "azure-xxx"
SILICONFLOW_API_KEY = "sf-xxx"
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="ChatModelFactory_92">
     </a>
     二、聊天模型工厂（ChatModelFactory）
    </h4>
    <h5>
     <a id="1__94">
     </a>
     1. 基础配置
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">ChatModelFactory</span><span class="token punctuation">:</span>
    model_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment"># 控制生成随机性（0=确定性最高）</span>
        <span class="token string">"seed"</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>        <span class="token comment"># 固定随机种子保证可复现性</span>
    <span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       核心参数
      </strong>
      ：
      <ul>
       <li>
        <code>
         temperature
        </code>
        : 影响生成多样性（0为最保守，1为最随机）
       </li>
       <li>
        <code>
         seed
        </code>
        : 确保相同输入得到相同输出（对测试和调试至关重要）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="2__106">
     </a>
     2. 模型选择逻辑
    </h5>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> use_azure<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># OpenAI官方服务</span>
    <span class="token keyword">if</span> <span class="token string">"gpt"</span> <span class="token keyword">in</span> model_name<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> use_azure<span class="token punctuation">:</span>
            <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span>model_name<span class="token punctuation">,</span> <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> AzureChatOpenAI<span class="token punctuation">(</span>
                azure_deployment<span class="token operator">=</span>model_name<span class="token punctuation">,</span>  <span class="token comment"># Azure部署名称</span>
                api_version<span class="token operator">=</span><span class="token string">"2024-05-01-preview"</span><span class="token punctuation">,</span>  <span class="token comment"># 最新API版本</span>
                <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params
            <span class="token punctuation">)</span>
    
    <span class="token comment"># 第三方开源模型平台</span>
    <span class="token keyword">elif</span> model_name <span class="token operator">==</span> <span class="token string">"deepseek"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span>
            model<span class="token operator">=</span><span class="token string">"deepseek-ai/DeepSeek-V2-Chat"</span><span class="token punctuation">,</span>
            openai_api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"SILICONFLOW_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            openai_api_base<span class="token operator">=</span><span class="token string">"https://api.siliconflow.cn/v1"</span><span class="token punctuation">,</span>
            <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <p>
       <strong>
        多服务支持
       </strong>
       ：
      </p>
      <table>
       <thead>
        <tr>
         <th>
          服务类型
         </th>
         <th>
          适用场景
         </th>
         <th>
          关键参数
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td>
          OpenAI官方
         </td>
         <td>
          直接使用OpenAI的API
         </td>
         <td>
          <code>
           model="gpt-3.5-turbo"
          </code>
         </td>
        </tr>
        <tr>
         <td>
          Azure OpenAI
         </td>
         <td>
          企业级Azure云服务
         </td>
         <td>
          <code>
           azure_deployment
          </code>
         </td>
        </tr>
        <tr>
         <td>
          SiliconFlow平台
         </td>
         <td>
          调用DeepSeek等国产开源模型
         </td>
         <td>
          自定义API Base URL
         </td>
        </tr>
       </tbody>
      </table>
     </li>
     <li>
      <p>
       <strong>
        设计亮点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <strong>
         统一接口
        </strong>
        ：不同服务使用相同调用方式（均继承自
        <code>
         BaseChatModel
        </code>
        ）
       </li>
       <li>
        <strong>
         无缝切换
        </strong>
        ：通过
        <code>
         use_azure
        </code>
        布尔参数切换云服务商
       </li>
       <li>
        <strong>
         开箱即用
        </strong>
        ：预置最新API版本（
        <code>
         2024-05-01-preview
        </code>
        ）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="3__142">
     </a>
     3. 默认模型配置
    </h5>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">get_default_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> cls<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <strong>
       最佳实践
      </strong>
      ：将
      <code>
       gpt-3.5-turbo
      </code>
      设为默认模型（性价比与性能平衡）
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="EmbeddingModelFactory_152">
     </a>
     三、嵌入模型工厂（EmbeddingModelFactory）
    </h4>
    <h5>
     <a id="1__154">
     </a>
     1. 模型分发逻辑
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">EmbeddingModelFactory</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> use_azure<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> model_name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"text-embedding"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> use_azure<span class="token punctuation">:</span>
                <span class="token keyword">return</span> OpenAIEmbeddings<span class="token punctuation">(</span>model<span class="token operator">=</span>model_name<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> AzureOpenAIEmbeddings<span class="token punctuation">(</span>
                    azure_deployment<span class="token operator">=</span>model_name<span class="token punctuation">,</span>
                    openai_api_version<span class="token operator">=</span><span class="token string">"2024-05-01-preview"</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Model </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>model_name<span class="token punctuation">}</span></span><span class="token string"> not implemented."</span></span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <strong>
       模型识别
      </strong>
      ：通过
      <code>
       text-embedding
      </code>
      前缀判断为嵌入模型
     </li>
     <li>
      <strong>
       服务兼容性
      </strong>
      ：
      <ul>
       <li>
        OpenAI：直接指定模型名称（如
        <code>
         text-embedding-ada-002
        </code>
        ）
       </li>
       <li>
        Azure：使用部署名称（需与Azure门户中的部署名一致）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="2__175">
     </a>
     2. 默认配置
    </h5>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">get_default_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> cls<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token string">"text-embedding-ada-002"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <strong>
       行业标准
      </strong>
      ：
      <code>
       text-embedding-ada-002
      </code>
      是OpenAI最常用的嵌入模型
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_185">
     </a>
     四、关键技术点解析
    </h4>
    <h5>
     <a id="1__187">
     </a>
     1. 环境变量管理
    </h5>
    <ul>
     <li>
      <strong>
       安全实践
      </strong>
      ：通过
      <code>
       .env
      </code>
      文件隔离敏感信息
     </li>
     <li>
      <strong>
       多平台支持
      </strong>
      ：
      <pre><code class="prism language-python"><span class="token comment"># SiliconFlow示例</span>
openai_api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"SILICONFLOW_API_KEY"</span><span class="token punctuation">)</span>
openai_api_base<span class="token operator">=</span><span class="token string">"https://api.siliconflow.cn/v1"</span> 
</code></pre>
      即使使用非OpenAI服务，也复用
      <code>
       openai_
      </code>
      前缀的参数名，保持接口统一
     </li>
    </ul>
    <h5>
     <a id="2__197">
     </a>
     2. 工厂模式优势
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        优势
       </th>
       <th>
        具体体现
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         解耦合
        </strong>
       </td>
       <td>
        业务代码无需关心模型初始化细节
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         扩展性
        </strong>
       </td>
       <td>
        新增模型只需修改工厂类
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         配置集中化
        </strong>
       </td>
       <td>
        所有模型参数在单个类中管理
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="3__204">
     </a>
     3. 多云服务兼容
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># Azure的特殊参数</span>
AzureChatOpenAI<span class="token punctuation">(</span>
    azure_deployment<span class="token operator">=</span><span class="token string">"gpt-35-turbo"</span><span class="token punctuation">,</span>  <span class="token comment"># 部署名称（可能与模型名不同）</span>
    api_version<span class="token operator">=</span><span class="token string">"2024-05-01-preview"</span>   <span class="token comment"># 必须指定</span>
<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <strong>
       注意差异
      </strong>
      ：Azure的部署名称可能与OpenAI模型名称不同（如
      <code>
       gpt-35-turbo
      </code>
      对应OpenAI的
      <code>
       gpt-3.5-turbo
      </code>
      ）
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_216">
     </a>
     五、使用示例
    </h4>
    <h5>
     <a id="1__218">
     </a>
     1. 基础调用
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># 获取默认聊天模型</span>
chat_model <span class="token operator">=</span> ChatModelFactory<span class="token punctuation">.</span>get_default_model<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 获取Azure版嵌入模型</span>
embed_model <span class="token operator">=</span> EmbeddingModelFactory<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span>
    <span class="token string">"text-embedding-ada-002"</span><span class="token punctuation">,</span> 
    use_azure<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2__230">
     </a>
     2. 完整工作流
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">from</span> langchain<span class="token punctuation">.</span>schema <span class="token keyword">import</span> HumanMessage

<span class="token comment"># 初始化模型</span>
model <span class="token operator">=</span> ChatModelFactory<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token string">"gpt-4"</span><span class="token punctuation">,</span> use_azure<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># 执行对话</span>
messages <span class="token operator">=</span> <span class="token punctuation">[</span>HumanMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">"你好！"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
response <span class="token operator">=</span> model<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span>messages<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_245">
     </a>
     六、扩展建议
    </h4>
    <h5>
     <a id="1__247">
     </a>
     1. 添加新模型支持
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># 在ChatModelFactory中添加</span>
<span class="token keyword">elif</span> model_name <span class="token operator">==</span> <span class="token string">"moonshot"</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"moonshot-v1"</span><span class="token punctuation">,</span>
        openai_api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"MOONSHOT_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        openai_api_base<span class="token operator">=</span><span class="token string">"https://api.moonshot.cn/v1"</span><span class="token punctuation">,</span>
        <span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params
    <span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="2__259">
     </a>
     2. 动态参数配置
    </h5>
    <pre><code class="prism language-python"><span class="token comment"># 允许运行时修改参数</span>
<span class="token decorator annotation punctuation">@classmethod</span>
<span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">}</span>
    <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span>model<span class="token operator">=</span>model_name<span class="token punctuation">,</span> <span class="token operator">**</span>params<span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="3__268">
     </a>
     3. 错误处理增强
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> AzureChatOpenAI<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> AuthenticationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Azure认证失败，请检查API Key和部署名称"</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_278">
     </a>
     七、架构图示
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="254" id="mermaid-svg-S7y1k9vFmNfWxBye" viewbox="0 0 869.1328125 254" width="869.1328125" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-S7y1k9vFmNfWxBye {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-S7y1k9vFmNfWxBye .error-icon{fill:#552222;}#mermaid-svg-S7y1k9vFmNfWxBye .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-S7y1k9vFmNfWxBye .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-S7y1k9vFmNfWxBye .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-S7y1k9vFmNfWxBye .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-S7y1k9vFmNfWxBye .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-S7y1k9vFmNfWxBye .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-S7y1k9vFmNfWxBye .marker{fill:#333333;stroke:#333333;}#mermaid-svg-S7y1k9vFmNfWxBye .marker.cross{stroke:#333333;}#mermaid-svg-S7y1k9vFmNfWxBye svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-S7y1k9vFmNfWxBye .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-S7y1k9vFmNfWxBye .cluster-label text{fill:#333;}#mermaid-svg-S7y1k9vFmNfWxBye .cluster-label span{color:#333;}#mermaid-svg-S7y1k9vFmNfWxBye .label text,#mermaid-svg-S7y1k9vFmNfWxBye span{fill:#333;color:#333;}#mermaid-svg-S7y1k9vFmNfWxBye .node rect,#mermaid-svg-S7y1k9vFmNfWxBye .node circle,#mermaid-svg-S7y1k9vFmNfWxBye .node ellipse,#mermaid-svg-S7y1k9vFmNfWxBye .node polygon,#mermaid-svg-S7y1k9vFmNfWxBye .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-S7y1k9vFmNfWxBye .node .label{text-align:center;}#mermaid-svg-S7y1k9vFmNfWxBye .node.clickable{cursor:pointer;}#mermaid-svg-S7y1k9vFmNfWxBye .arrowheadPath{fill:#333333;}#mermaid-svg-S7y1k9vFmNfWxBye .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-S7y1k9vFmNfWxBye .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-S7y1k9vFmNfWxBye .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-S7y1k9vFmNfWxBye .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-S7y1k9vFmNfWxBye .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-S7y1k9vFmNfWxBye .cluster text{fill:#333;}#mermaid-svg-S7y1k9vFmNfWxBye .cluster span{color:#333;}#mermaid-svg-S7y1k9vFmNfWxBye div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-S7y1k9vFmNfWxBye :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M436.017578125,38.422554267898114L393.9169921875,45.185461889915096C351.81640625,51.94836951193207,267.615234375,65.47418475596604,225.5146484375,76.40375904464969C183.4140625,87.33333333333333,183.4140625,95.66666666666667,183.4140625,99.83333333333333L183.4140625,104" marker-end="url(#arrowhead63)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead63" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-C" id="L-A-C" style="opacity: 1;">
          <path class="path" d="M528.431640625,43.28295764288496L550.8255208333334,49.23579803573747C573.2194010416666,55.18863842858997,618.0071614583334,67.09431921429498,640.4010416666666,77.21382627381416C662.794921875,87.33333333333333,662.794921875,95.66666666666667,662.794921875,99.83333333333333L662.794921875,104" marker-end="url(#arrowhead64)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead64" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-D" id="L-B-D" style="opacity: 1;">
          <path class="path" d="M120.21834309895834,150L108.76984320746529,154.16666666666666C97.32134331597223,158.33333333333334,74.42434353298611,166.66666666666666,63.05917697482639,175.08333333333334C51.694010416666664,183.5,51.860677083333336,192,51.944010416666664,196.25L52.02734375,200.5" marker-end="url(#arrowhead65)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead65" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-E" id="L-B-E" style="opacity: 1;">
          <path class="path" d="M183.4140625,150L183.4140625,154.16666666666666C183.4140625,158.33333333333334,183.4140625,166.66666666666666,183.49739583333334,175.08333333333334C183.58072916666666,183.5,183.74739583333334,192,183.83072916666666,196.25L183.9140625,200.5" marker-end="url(#arrowhead66)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead66" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-F" id="L-B-F" style="opacity: 1;">
          <path class="path" d="M253.64005533854169,150L266.3621554904514,154.16666666666666C279.08425564236114,158.33333333333334,304.5284559461806,166.66666666666666,317.33388943142364,175.08333333333334C330.1393229166667,183.5,330.3059895833333,192,330.3893229166667,196.25L330.47265625,200.5" marker-end="url(#arrowhead67)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead67" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-G" id="L-C-G" style="opacity: 1;">
          <path class="path" d="M606.1381429036459,150L595.874233669705,154.16666666666666C585.6103244357639,158.33333333333334,565.082505967882,166.66666666666666,554.9019300672743,175.08333333333334C544.7213541666666,183.5,544.8880208333334,192,544.9713541666666,196.25L545.0546875,200.5" marker-end="url(#arrowhead68)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead68" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-H" id="L-C-H" style="opacity: 1;">
          <path class="path" d="M719.4517008463541,150L729.715610080295,154.16666666666666C739.979519314236,158.33333333333334,760.507337782118,166.66666666666666,770.8545803493922,175.08333333333334C781.2018229166666,183.5,781.3684895833334,192,781.4518229166666,196.25L781.53515625,200.5" marker-end="url(#arrowhead69)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead69" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-C" id="L-L-A-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-D" id="L-L-B-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-E" id="L-L-B-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-F" id="L-L-B-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-G" id="L-L-C-G">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-H" id="L-L-C-H">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-70" style="opacity: 1;" transform="translate(482.224609375,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="92.4140625" x="-46.20703125" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-36.20703125,-13)">
            <foreignobject height="26" width="72.4140625">
             <div style="display: inline-block; white-space: nowrap;">
              User Code
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-71" style="opacity: 1;" transform="translate(183.4140625,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="149.125" x="-74.5625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-64.5625,-13)">
            <foreignobject height="26" width="129.125">
             <div style="display: inline-block; white-space: nowrap;">
              ChatModelFactory
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-73" style="opacity: 1;" transform="translate(662.794921875,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="194.71875" x="-97.359375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-87.359375,-13)">
            <foreignobject height="26" width="174.71875">
             <div style="display: inline-block; white-space: nowrap;">
              EmbeddingModelFactory
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-75" style="opacity: 1;" transform="translate(51.52734375,223)">
          <polygon class="label-container" points="0,0 71.0546875,0 71.0546875,-46 0,-46 0,0 -8,0 79.0546875,0 79.0546875,-46 -8,-46 -8,0" transform="translate(-35.52734375,23)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-25.52734375,-13)">
            <foreignobject height="26" width="51.0546875">
             <div style="display: inline-block; white-space: nowrap;">
              OpenAI
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-77" style="opacity: 1;" transform="translate(183.4140625,223)">
          <polygon class="label-container" points="0,0 60.71875,0 60.71875,-46 0,-46 0,0 -8,0 68.71875,0 68.71875,-46 -8,-46 -8,0" transform="translate(-30.359375,23)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-20.359375,-13)">
            <foreignobject height="26" width="40.71875">
             <div style="display: inline-block; white-space: nowrap;">
              Azure
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-79" style="opacity: 1;" transform="translate(329.97265625,223)">
          <polygon class="label-container" points="0,0 100.3984375,0 100.3984375,-46 0,-46 0,0 -8,0 108.3984375,0 108.3984375,-46 -8,-46 -8,0" transform="translate(-50.19921875,23)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40.19921875,-13)">
            <foreignobject height="26" width="80.3984375">
             <div style="display: inline-block; white-space: nowrap;">
              SiliconFlow
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-G-81" style="opacity: 1;" transform="translate(544.5546875,223)">
          <polygon class="label-container" points="0,0 196.765625,0 196.765625,-46 0,-46 0,0 -8,0 204.765625,0 204.765625,-46 -8,-46 -8,0" transform="translate(-98.3828125,23)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-88.3828125,-13)">
            <foreignobject height="26" width="176.765625">
             <div style="display: inline-block; white-space: nowrap;">
              text-embedding-ada-002
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-H-83" style="opacity: 1;" transform="translate(781.03515625,223)">
          <polygon class="label-container" points="0,0 144.1953125,0 144.1953125,-46 0,-46 0,0 -8,0 152.1953125,0 152.1953125,-46 -8,-46 -8,0" transform="translate(-72.09765625,23)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-62.09765625,-13)">
            <foreignobject height="26" width="124.1953125">
             <div style="display: inline-block; white-space: nowrap;">
              Azure Embedding
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <p>
     该代码为构建多模型AI应用提供了标准化基础设施，开发者可以通过简单的参数切换实现：
    </p>
    <ul>
     <li>
      不同云服务商之间的迁移
     </li>
     <li>
      开源模型与商业模型的混合使用
     </li>
     <li>
      嵌入模型与对话模型的协同工作
     </li>
    </ul>
    <h2>
     <a id="Classmethod_297">
     </a>
     @Classmethod
    </h2>
    <p>
     <code>
      @classmethod
     </code>
     是 Python 中一个重要的装饰器，用于定义
     <strong>
      类方法
     </strong>
     。它的核心作用是为类提供一种不依赖实例却能操作类本身或类层级数据的途径。以下是逐层解析：
    </p>
    <hr/>
    <h4>
     <a id="_303">
     </a>
     一、核心特性
    </h4>
    <h5>
     <a id="1__304">
     </a>
     1.
     <strong>
      方法签名
     </strong>
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">my_method</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 第一个参数必须是类本身（惯例命名为`cls`）</span>
        <span class="token keyword">pass</span>
</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        cls
       </code>
       参数
      </strong>
      ：自动接收当前类（而非实例）作为第一个参数
     </li>
     <li>
      <strong>
       调用方式
      </strong>
      ：可通过
      <code>
       类名.方法名()
      </code>
      或
      <code>
       实例.方法名()
      </code>
      调用
     </li>
    </ul>
    <h5>
     <a id="2__314">
     </a>
     2.
     <strong>
      与普通实例方法的对比
     </strong>
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        方法类型
       </th>
       <th>
        第一个参数
       </th>
       <th>
        可访问内容
       </th>
       <th>
        典型用途
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        实例方法
       </td>
       <td>
        <code>
         self
        </code>
       </td>
       <td>
        实例属性/方法
       </td>
       <td>
        操作实例级数据
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         类方法
        </strong>
       </td>
       <td>
        <code>
         cls
        </code>
       </td>
       <td>
        类属性/其他类方法
       </td>
       <td>
        工厂模式、类配置操作
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="_322">
     </a>
     二、核心应用场景
    </h4>
    <h5>
     <a id="1__323">
     </a>
     1. *
     <em>
      工厂模式（核心代码中的用法）
     </em>
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">ChatModelFactory</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 不创建实例即可获取模型</span>
        <span class="token keyword">if</span> model_name <span class="token operator">==</span> <span class="token string">"gpt"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_create_openai_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_create_custom_model<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 直接通过类调用</span>
model <span class="token operator">=</span> ChatModelFactory<span class="token punctuation">.</span>get_model<span class="token punctuation">(</span><span class="token string">"gpt"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      <strong>
       优势
      </strong>
      ：无需实例化工厂类即可创建目标对象
     </li>
     <li>
      <strong>
       扩展性
      </strong>
      ：子类可重写方法改变创建逻辑
     </li>
    </ul>
    <h5>
     <a id="2__339">
     </a>
     2.
     <strong>
      替代构造函数
     </strong>
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>year <span class="token operator">=</span> year

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">from_string</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> date_str<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 接受不同格式的输入</span>
        year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> date_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span>  <span class="token comment"># 调用主构造函数</span>

<span class="token comment"># 使用示例</span>
date <span class="token operator">=</span> Date<span class="token punctuation">.</span>from_string<span class="token punctuation">(</span><span class="token string">"2023-08-01"</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="3__354">
     </a>
     3.
     <strong>
      类状态管理
     </strong>
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Counter</span><span class="token punctuation">:</span>
    _count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">increment</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cls<span class="token punctuation">.</span>_count <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># 修改类属性</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_count</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_count  <span class="token comment"># 读取类属性</span>

Counter<span class="token punctuation">.</span>increment<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Counter<span class="token punctuation">.</span>get_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: 1</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_373">
     </a>
     三、继承场景下的行为
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">identify</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"I am </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>cls<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

Animal<span class="token punctuation">.</span>identify<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: I am Animal</span>
Dog<span class="token punctuation">.</span>identify<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment"># 输出: I am Dog  🐛 cls自动指向实际调用类</span>
</code></pre>
    <ul>
     <li>
      <strong>
       多态性
      </strong>
      ：子类调用父类方法时，
      <code>
       cls
      </code>
      指向子类
     </li>
     <li>
      <strong>
       应用价值
      </strong>
      ：实现继承链中的工厂方法
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_staticmethod__391">
     </a>
     四、与
     <code>
      @staticmethod
     </code>
     的对比
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        特性
       </th>
       <th>
        <code>
         @classmethod
        </code>
       </th>
       <th>
        <code>
         @staticmethod
        </code>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        第一个参数
       </td>
       <td>
        自动传入类 (
        <code>
         cls
        </code>
        )
       </td>
       <td>
        无自动参数
       </td>
      </tr>
      <tr>
       <td>
        访问类属性
       </td>
       <td>
        ✅ 可直接通过
        <code>
         cls
        </code>
        访问
       </td>
       <td>
        ❌ 需通过类名硬编码访问
       </td>
      </tr>
      <tr>
       <td>
        调用其他类方法
       </td>
       <td>
        ✅ 可通过
        <code>
         cls.method()
        </code>
       </td>
       <td>
        ❌ 需硬编码类名
       </td>
      </tr>
      <tr>
       <td>
        典型应用场景
       </td>
       <td>
        需要类引用的操作
       </td>
       <td>
        工具函数
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="_399">
     </a>
     代码示例对比
    </h5>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Utilities</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">class_util</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Called from </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>cls<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">static_util</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Generic utility"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">SubUtilities</span><span class="token punctuation">(</span>Utilities<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

SubUtilities<span class="token punctuation">.</span>class_util<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 输出: Called from SubUtilities</span>
SubUtilities<span class="token punctuation">.</span>static_util<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 输出: Generic utility</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_419">
     </a>
     五、在示例代码中的作用
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">ChatModelFactory</span><span class="token punctuation">:</span>
    model_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>  <span class="token comment"># 类属性</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_model</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> ChatOpenAI<span class="token punctuation">(</span><span class="token operator">**</span>cls<span class="token punctuation">.</span>model_params<span class="token punctuation">)</span>  <span class="token comment"># 通过cls访问类属性</span>
</code></pre>
    <ol>
     <li>
      <strong>
       统一配置管理
      </strong>
      ：通过
      <code>
       cls.model_params
      </code>
      确保所有方法使用相同配置
     </li>
     <li>
      <strong>
       无需实例化
      </strong>
      ：直接
      <code>
       ChatModelFactory.get_model()
      </code>
      调用
     </li>
     <li>
      <strong>
       扩展性
      </strong>
      ：子类可重写
      <code>
       model_params
      </code>
      改变默认参数
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_434">
     </a>
     六、最佳实践原则
    </h4>
    <ol>
     <li>
      <strong>
       优先用于工厂方法
      </strong>
      ：当需要创建类实例但需封装复杂逻辑时
     </li>
     <li>
      <strong>
       避免滥用
      </strong>
      ：不需要访问类状态时使用
      <code>
       @staticmethod
      </code>
     </li>
     <li>
      <strong>
       命名规范
      </strong>
      ：始终将第一个参数命名为
      <code>
       cls
      </code>
      （非强制但强烈建议）
     </li>
     <li>
      <strong>
       继承友好设计
      </strong>
      ：通过
      <code>
       cls
      </code>
      实现多态，而非硬编码类名
     </li>
    </ol>
    <p>
     掌握
     <code>
      @classmethod
     </code>
     的使用，能大幅提升面向对象代码的灵活性和可维护性，尤其在需要类层级操作而非实例层级操作的场景下表现出色。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34323433303934372f:61727469636c652f64657461696c732f313436303535353630" class_="artid" style="display:none">
 </p>
</div>


