---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35373137393639362f:61727469636c652f64657461696c732f313436323131353836"
layout: post
title: "ç¬¬ä¹è¯¾WebSocketä¸å®æ—¶é€šä¿¡æŠ€æœ¯è§£æ"
date: 2025-03-12 21:11:26 +08:00
description: "ä»‹ç»å¦‚ä½•åœ¨Node.jsä¸­ä½¿ç”¨WebSocketå®ç°å®æ—¶é€šä¿¡ï¼Œå¹¶é€šè¿‡socket.ioåº“å®ç°ä¸€ä¸ªèŠå¤©å®¤ç¤ºä¾‹ï¼Œè¿›ä¸€æ­¥æ¢è®¨å¹¿æ’­æ¶ˆæ¯ä¸æˆ¿é—´ç®¡ç†ï¼Œæœ€åå±•ç¤ºä¸€ä¸ªåœ¨çº¿åä½œç™½æ¿åº”ç”¨çš„å®æˆ˜æ¡ˆä¾‹ã€‚"
keywords: "ç¬¬ä¹è¯¾ï¼šWebSocketä¸å®æ—¶é€šä¿¡æŠ€æœ¯è§£æ"
categories: ['Nodejs']
tags: ['ç½‘ç»œåè®®', 'ç½‘ç»œ', 'Websocket', 'Node', 'Html']
artid: "146211586"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146211586
    alt: "ç¬¬ä¹è¯¾WebSocketä¸å®æ—¶é€šä¿¡æŠ€æœ¯è§£æ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146211586
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146211586
cover: https://bing.ee123.net/img/rand?artid=146211586
image: https://bing.ee123.net/img/rand?artid=146211586
img: https://bing.ee123.net/img/rand?artid=146211586
---

# ç¬¬ä¹è¯¾ï¼šWebSocketä¸å®æ—¶é€šä¿¡æŠ€æœ¯è§£æ

åœ¨ç°ä»£çš„ç½‘ç»œåº”ç”¨ä¸­ï¼Œå®æ—¶é€šä¿¡çš„éœ€æ±‚æ—¥ç›Šå¢åŠ ã€‚æ— è®ºæ˜¯å³æ—¶èŠå¤©åº”ç”¨ã€åœ¨çº¿åä½œå·¥å…·è¿˜æ˜¯å®æ—¶æ•°æ®æ›´æ–°çš„ä»ªè¡¨æ¿ï¼Œå®æ—¶é€šä¿¡éƒ½æ˜¾å¾—è‡³å…³é‡è¦ã€‚WebSocketä½œä¸ºä¸€ç§åœ¨åŒå‘é€šä¿¡ä¸Šè¡¨ç°å“è¶Šçš„åè®®ï¼Œèƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹å…¨åŒå·¥çš„é€šä¿¡æ¡¥æ¢ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Node.jsä¸­ä½¿ç”¨WebSocketå®ç°å®æ—¶é€šä¿¡ï¼Œå¹¶é€šè¿‡socket.ioåº“å®ç°ä¸€ä¸ªèŠå¤©å®¤ç¤ºä¾‹ï¼Œè¿›ä¸€æ­¥æ¢è®¨å¹¿æ’­æ¶ˆæ¯ä¸æˆ¿é—´ç®¡ç†ï¼Œæœ€åå±•ç¤ºä¸€ä¸ªåœ¨çº¿åä½œç™½æ¿åº”ç”¨çš„å®æˆ˜æ¡ˆä¾‹ã€‚

#### 1. WebSocketåè®®ä¸HTTPå¯¹æ¯”

##### WebSocketåŸºç¡€æ¦‚å¿µ

WebSocketæ˜¯ä¸€ç§åœ¨å•ä¸ªTCPè¿æ¥ä¸Šæä¾›å…¨åŒå·¥é€šä¿¡èƒ½åŠ›çš„åè®®ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº’ç›¸æ¨é€æ•°æ®ï¼Œæ— éœ€é‡å¤å»ºç«‹è¿æ¥ï¼Œå¤§å¤§æå‡äº†äº¤äº’æ•ˆç‡å’Œå®æ—¶æ€§ã€‚

##### WebSocketä¸HTTPçš„åŒºåˆ«

* **é€šä¿¡æ¨¡å¼ï¼š**
  HTTPæ˜¯è¯·æ±‚-å“åº”æ¨¡å‹ï¼Œæ¯æ¬¡é€šä¿¡éƒ½éœ€è¦å»ºç«‹æ–°çš„è¿æ¥ï¼›è€ŒWebSocketå»ºç«‹æŒä¹…è¿æ¥ï¼Œæ”¯æŒåŒå‘å®æ—¶é€šä¿¡ã€‚
* **æ•°æ®æ ¼å¼ï¼š**
  HTTPé€šå¸¸ä¼ è¾“æ–‡æœ¬æ•°æ®ï¼Œæ¯æ¬¡è¯·æ±‚å’Œå“åº”éƒ½åŒ…å«å®Œæ•´çš„å¤´éƒ¨ä¿¡æ¯ï¼›WebSocketå¯ä»¥ä¼ è¾“æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®ï¼Œå¤´éƒ¨ä¿¡æ¯è¾ƒå°ï¼Œå‡å°‘äº†æ•°æ®ä¼ è¾“é‡ã€‚
* **åº”ç”¨åœºæ™¯ï¼š**
  HTTPé€‚ç”¨äºä¼ ç»Ÿçš„ç½‘é¡µæµè§ˆã€APIè°ƒç”¨ç­‰åœºæ™¯ï¼›WebSocketé€‚ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚åœ¨çº¿èŠå¤©ã€å®æ—¶æ¸¸æˆç­‰ã€‚

#### 2. ä½¿ç”¨socket.ioå®ç°èŠå¤©å®¤

##### ä¸ºä»€ä¹ˆé€‰æ‹©socket.io

Socket.IOæ˜¯ä¸€ä¸ªæ”¯æŒå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å®æ—¶ã€åŒå‘ã€åŸºäºäº‹ä»¶çš„é€šä¿¡çš„åº“ã€‚å®ƒä¸ä»…ç®€åŒ–äº†APIæ¥å£ï¼Œä½¿å¾—æ“ä½œæ›´å®¹æ˜“ï¼Œè€Œä¸”è®©é‚£äº›ä¸æ”¯æŒWebSocketåè®®çš„æµè§ˆå™¨ä¼šå°†WebSocketè¿æ¥è‡ªåŠ¨é™ä¸ºAjaxè¿æ¥ï¼Œæœ€å¤§é™åº¦åœ°ä¿è¯äº†å…¼å®¹æ€§ã€‚

##### å®‰è£…ä¸é…ç½®

é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº†Node.jså’Œnpmã€‚ç„¶åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…socket.ioï¼š

```bash
npm install socket.io express
```

##### æœåŠ¡å™¨ç«¯ä»£ç 

åˆ›å»ºä¸€ä¸ªserver.jsæ–‡ä»¶ï¼Œç”¨äºæ­å»ºWebSocketæœåŠ¡å™¨ï¼š

```javascript
const socketIo = require('socket.io')
const http = require('http')
const express = require('express')

const app = express()
const server = http.createServer(app)

app.use(express.static('simple-chat'))

const IO = socketIo(server)

IO.on('connection', socket => {
    console.log('ä¸€ä¸ªç”¨æˆ·è¿æ¥ä¸Šæ¥äº†')

    socket.on('message', msg => {
        console.log('ç”¨æˆ·å‘é€äº†ä¸€ä¸ªä¿¡æ¯è¿‡æ¥: ' + msg)
    })

    socket.on('disconnect', () => {
        console.log('ä¸€ä¸ªç”¨æˆ·æ–­å¼€è¿æ¥äº†')
    })
})

server.listen(18080, () => {
    console.log('----------------- æœåŠ¡å™¨è¿è¡ŒæˆåŠŸ')
    console.log('----------------- http://localhost:18080')
})
```

##### å®¢æˆ·ç«¯ä»£ç 

åˆ›å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œç”¨äºå±•ç¤ºèŠå¤©ç•Œé¢ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chat</title>
    <script src="./socket.io.min.js"></script>
</head>
<body>

    <hr>
    <input id="msgBox" type="text" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯">
    <hr>
    <button id="connectBtn">è¿æ¥æœåŠ¡</button>
    <hr>
    <button id="sendBtn">å‘é€æ¶ˆæ¯</button>
    <hr>
    <button id="closeBtn">æ–­å¼€è¿æ¥</button>

    <script>
        let socket = null

        connectBtn.addEventListener('click', () => {
            socket = io('http://localhost:18080')
        })

        sendBtn.addEventListener('click', () => {
            if (socket) socket.emit('message', msgBox.value)
        })

        closeBtn.addEventListener('click', () => {
            if (socket) {
                socket.close()
                socket = null
            }
        })
    </script>
</body>
</html>
```

#### 3. å¹¿æ’­æ¶ˆæ¯ä¸æˆ¿é—´ç®¡ç†

##### æˆ¿é—´ç®¡ç†

Socket.IOæ”¯æŒå°†å®¢æˆ·ç«¯åˆ†ç»„åˆ°â€œæˆ¿é—´â€ï¼Œè¿™åœ¨å¤„ç†å¤šä¸ªå¹¶å‘èŠå¤©å®¤æˆ–æ¸¸æˆæˆ¿é—´æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®©ç”¨æˆ·åŠ å…¥ç‰¹å®šçš„èŠå¤©å®¤ï¼Œå¹¶åªæ¥æ”¶è¯¥èŠå¤©å®¤çš„æ¶ˆæ¯ã€‚

##### æœåŠ¡å™¨ç¤ºä¾‹ä»£ç 

åœ¨æœåŠ¡å™¨ç«¯ä»£ç ä¸­ï¼Œç®¡ç†æˆ¿é—´çš„åŠ å…¥å’Œç¦»å¼€ï¼š

```java
const socketIo = require('socket.io')
const http = require('http')
const express = require('express')
const crypto = require('crypto')

const app = express()
const server = http.createServer(app)

app.use(express.static('simple-chat'))

const IO = socketIo(server)

IO.on('connection', socket => {
    console.log('ä¸€ä¸ªç”¨æˆ·è¿æ¥ä¸Šæ¥äº†')

    socket.on('join-room', obj => {
        console.log(`${obj.userName} åŠ å…¥èŠå¤©å®¤ ${obj.roomName}`)
        socket.join(obj.roomName)
    })

    socket.on('leave-room', obj => {
        console.log(`${obj.userName} ç¦»å¼€èŠå¤©å®¤ ${obj.roomName}`)
        socket.leave(obj.roomName)
    })

    socket.on('message', obj => {
        console.log(`${obj.userName} åœ¨èŠå¤©å®¤ ${obj.roomName} å‘é€äº†æ¶ˆæ¯ï¼š${obj.msg}`)
        socket.to(obj.roomName).emit('client-message', obj)
    })

    socket.on('disconnect', () => {
        console.log('ä¸€ä¸ªç”¨æˆ·æ–­å¼€è¿æ¥äº†')
    })
})

server.listen(18080, () => {
    console.log('----------------- æœåŠ¡å™¨è¿è¡ŒæˆåŠŸ')
    console.log('----------------- http://localhost:18080')
})
```

##### å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç 

åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œè®©ç”¨æˆ·é€‰æ‹©åŠ å…¥æˆ–ç¦»å¼€æˆ¿é—´ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Chat</title>
    <script src="./socket.io.min.js"></script>
</head>
<body>

    <hr>
    <label for="userName">ä½ çš„åå­—ï¼š</label>
    <input id="userName" type="text" placeholder="è¾“å…¥ä½ çš„åå­—">
    <hr>
    <label for="roomName">ä½ è¦åŠ å…¥çš„èŠå¤©å®¤ï¼š</label>
    <input id="roomName" type="text" placeholder="è¾“å…¥ä½ è¦åŠ å…¥çš„èŠå¤©å®¤åå­—">
    <button id="joinBtn">åŠ å…¥èŠå¤©å®¤</button>
    <hr>
    <ul id="infoBox"></ul>
    <hr>
    <input id="msgBox" type="text" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯">
    <hr>
    <button id="sendBtn">å‘é€æ¶ˆæ¯</button>
    <hr>
    <button id="leaveBtn">ç¦»å¼€èŠå¤©å®¤</button>

    <script>
        let socket = null

        joinBtn.addEventListener('click', () => {
            socket = io('http://localhost:18080')
            socket.emit('join-room', {userName: userName.value.trim(), roomName: roomName.value.trim()})
            socket.on('client-message', obj => {
                let li = document.createElement('li')
                li.innerHTML = `${obj.userName} å‘é€æ¶ˆæ¯ï¼š${obj.msg}`
                infoBox.appendChild(li)
            })
        })

        sendBtn.addEventListener('click', () => {
            if (socket) {
                socket.emit('message', {userName: userName.value.trim(), roomName: roomName.value.trim(), msg: msgBox.value.trim()})
            }
        })

        leaveBtn.addEventListener('click', () => {
            if (socket) {
                socket.emit('leave-room', {userName: userName.value.trim(), roomName: roomName.value.trim()})
                socket.close()
                socket = null
            }
        })
    </script>
</body>
</html>
```

#### 4. å®æˆ˜ï¼šåœ¨çº¿åä½œç™½æ¿åº”ç”¨

##### é¡¹ç›®æ¦‚è¿°

ä½¿ç”¨Node.jsã€Socket.IOå’ŒVue.jså®ç°ä¸€ä¸ªå®æ—¶å¤šäººåœ¨çº¿åä½œç™½æ¿åº”ç”¨ã€‚è¯¥åº”ç”¨å…è®¸å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€ç™½æ¿ä¸Šè¿›è¡Œå®æ—¶ç»˜å›¾å’ŒèŠå¤©ã€‚

##### æœåŠ¡å™¨ç«¯ä»£ç 

åˆ›å»ºä¸€ä¸ªserver.jsæ–‡ä»¶ï¼Œç”¨äºå¤„ç†WebSocketè¿æ¥å’Œæ¶ˆæ¯è½¬å‘ï¼š

```javascript
const express = require('express');
const http = require('http');
const socketIo = require('socket.io');

const app = express();
const server = http.createServer(app);
const IO = socketIo(server);

app.use(express.static('white-board'))

IO.on('connection', (socket) => {
    console.log('ä¸€ä¸ªç”¨æˆ·åŠ å…¥äº†ä¼šè®®');

    socket.on('draw', data => {
        IO.emit('draw', data);
    });

    socket.on('message', msg => {
        IO.emit('message', msg);
    });

    socket.on('disconnect', () => {
        console.log('ä¸€ä¸ªç”¨æˆ·ç¦»å¼€äº†ä¼šè®®');
    });
});

server.listen(18080, () => {
    console.log('----------------- æœåŠ¡å™¨è¿è¡ŒæˆåŠŸ')
    console.log('----------------- http://localhost:18080')
})
```

##### å‰ç«¯ä»£ç 

åˆ›å»ºä¸€ä¸ªVueé¡¹ç›®ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ç»„ä»¶å’Œä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>White Board</title>
    <script src="./socket.io.min.js"></script>
    <style>
        #msgList,
        #msgBox,
        #boardNode {
            display: block;
            box-sizing: border-box;
            width: 600px;
            height: 400px;
            border: solid 1px #ddd;
            border-radius: 16px;
            margin: 15px auto;
        }
        #msgList {
            height: auto;
            padding: 20px 10px;
        }
        #msgList li {
            margin-left: 18px;
        }
        #msgBox {
            height: 36px;
            font-size: 14px;
            color: #111;
            padding: 0 10px;
        }
    </style>
</head>
<body>
    <div>
        <canvas id="boardNode" width="800" height="600"></canvas>
        <ul id="msgList">
            <li>æ¥æ”¶åˆ°çš„ä¿¡æ¯</li>
        </ul>
        <input type="text" id="msgBox" placeholder="è¾“å…¥å‘é€çš„æ¶ˆæ¯..."/>
    </div>

    <script>
        let socket = io('http://localhost:18080')
        let isDrawing = false
        let context = boardNode.getContext('2d')
        
        socket.on('message', msg => {
            let li = document.createElement('li')
            li.innerHTML = msg
            msgList.appendChild(li)
        })
        msgBox.addEventListener('keyup', evt => {
            if (evt.keyCode == 13) {
                socket.emit('message', msgBox.value.trim())
                msgBox.value = ''
            }
        })

        let x1 = 0
        let y1 = 0
        let x2 = 0
        let y2 = 0
        boardNode.addEventListener('mousedown', evt => {
            isDrawing = true
            context.beginPath()
            x1 = evt.offsetX
            y1 = evt.offsetY
            context.moveTo(x1, y1)
        })
        boardNode.addEventListener('mousemove', evt => {
            if (!isDrawing) return
            x2 = evt.offsetX
            y2 = evt.offsetY
            context.lineTo(x2, y2)
            context.stroke()
            socket.emit('draw', {
                x1,
                y1,
                x2,
                y2
            })
            x1 = evt.offsetX
            y1 = evt.offsetY
        })
        boardNode.addEventListener('mouseup', evt => {
            isDrawing = false
            context.closePath()
        })
        socket.on('draw', data => {
            context.beginPath()
            context.moveTo(data.x1, data.y1)
            context.lineTo(data.x2, data.y2)
            context.stroke()
        })
    </script>
</body>
</html>
```

å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°ç›¸åº”çš„æ–‡ä»¶ä¸­ï¼Œå¹¶è¿è¡Œé¡¹ç›®ï¼š

```bash
npm run serve
```

æ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£è®¿é—®http://localhost:18080ï¼Œä½ å°†çœ‹åˆ°å¤šä¸ªç”¨æˆ·å¯ä»¥åœ¨åŒä¸€ç™½æ¿ä¸Šè¿›è¡Œå®æ—¶ç»˜å›¾å’ŒèŠå¤©ã€‚

#### æ€»ç»“

æœ¬æ–‡é€šè¿‡WebSocketåè®®ä¸HTTPçš„å¯¹æ¯”ï¼Œä»‹ç»äº†WebSocketåœ¨å®æ—¶é€šä¿¡ä¸­çš„ä¼˜åŠ¿ã€‚æ¥ç€ï¼Œé€šè¿‡socket.ioåº“å®ç°äº†ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤ç¤ºä¾‹ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•ç®¡ç†å¹¿æ’­æ¶ˆæ¯å’Œæˆ¿é—´ã€‚æœ€åï¼Œå®æˆ˜éƒ¨åˆ†å®ç°äº†ä¸€ä¸ªåœ¨çº¿åä½œç™½æ¿åº”ç”¨ï¼Œå±•ç¤ºäº†WebSocketåœ¨å®æ—¶å¤šäººåä½œåœºæ™¯ä¸­çš„åº”ç”¨ã€‚å¸Œæœ›è¿™äº›å†…å®¹èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨WebSocketæŠ€æœ¯ï¼Œæ„å»ºå‡ºåŠŸèƒ½ä¸°å¯Œã€æ€§èƒ½é«˜æ•ˆçš„å®æ—¶åº”ç”¨ã€‚

**å…³æ³¨æˆ‘ï¼ï¼ğŸ«µ**
æŒç»­ä¸ºä½ å¸¦æ¥Nodejsç›¸å…³å†…å®¹ã€‚