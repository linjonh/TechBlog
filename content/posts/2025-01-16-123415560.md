---
layout: post
title: "二十数据库的高可用是怎么实现的"
date: 2025-01-16 18:39:46 +0800
description: "高可用，即High Availability，是分布式系统架构设计中必须考虑的因素之一，它通常是指，"
keywords: "数据库的高可用是如何实现的"
categories: ['精通Mysql数据库']
tags: ['系统架构', '数据库', 'Java']
artid: "123415560"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123415560
    alt: "二十数据库的高可用是怎么实现的"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123415560
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123415560
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     二十、数据库的高可用是怎么实现的？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     高可用，即High Availability，是分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计减少系统不能提供服务的时间。单机部署谈不上高可用，因为单点故障问题。高可用都是多个节点的，我们在考虑MySQL数据库的高可用的架构时，需要考虑这几个方面：
    </p>
    <ul>
     <li>
      如果数据库节点宕机，需要尽快回复，保证业务不受宕机影响。
     </li>
     <li>
      从数据库节点的数据，尽可能跟主节点数据实时保持一致，至少保证最终一致性。
     </li>
     <li>
      数据库节点切换时，数据不能缺失。
     </li>
    </ul>
    <p>
     <strong>
      1.1 主从或主主半同步复制
     </strong>
    </p>
    <p>
     用双节点数据库，搭建单向或者双向的半同步复制。架构如下：
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="551" src="https://i-blog.csdnimg.cn/blog_migrate/dca27cd30caf7ee62795c36a9cf2fc19.jpeg" width="1080"/>
    </p>
    <p>
     通常会和proxy、keepalived等第三方软件同时使用，即可以用来监控数据库的健康，又可以执行一系列管理命令。如果主库发生故障，切换到备库后仍然可以继续使用数据库。
    </p>
    <p>
     这种方案优点是架构、部署比较简单，主机宕机直接切换即可。缺点是完全依赖于半同步复制，半同步复制退化为异步复制，无法保证数据一致性；另外，还需要额外考虑haproxy、keepalived的高可用机制。
    </p>
    <p>
     <strong>
      1.2 半同步复制优化
     </strong>
    </p>
    <p>
     半同步复制机制是可靠的，可以保证数据一致性的。但是如果网络发生波动，半同步复制发生超时会切换为异步复制，异复制是无法保证数据的一致性的。因此，可以在半同复制的基础上优化一下，尽可能保证半同复制。如双通道复制方案
    </p>
    <p>
     <img alt="" height="556" src="https://i-blog.csdnimg.cn/blog_migrate/96a7c6d59be10bbdb1a801513a8a7374.png" width="978"/>
    </p>
    <ul>
     <li>
      优点：这种方案架构、部署也比较简单，主机宕机也是直接切换即可。比方案1的半同步复制，更能保证数据的一致性。
     </li>
     <li>
      缺点：需要修改内核源码或者使用mysql通信协议，没有从根本上解决数据一致性问题。
     </li>
    </ul>
    <p>
     <strong>
      1.3 高可用架构优化
     </strong>
    </p>
    <p>
     保证高可用，可以把主从双节点数据库扩展为数据库集群。Zookeeper可以作为集群管理，它使用分布式算法保证集群数据的一致性，可以较好的避免网络分区现象的产生。
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="622" src="https://i-blog.csdnimg.cn/blog_migrate/fe8021b0f58bad79848bfaec36c16d34.png" width="893"/>
    </p>
    <ul>
     <li>
      优点：保证了整个系统的高可用性，扩展性也较好，可以扩展为大规模集群。
     </li>
     <li>
      缺点：数据一致性仍然依赖于原生的mysql半同步复制；引入Zookeeper使系统逻辑更复杂。
     </li>
    </ul>
    <p>
     <strong>
      1.4 共享存储
     </strong>
    </p>
    <p>
     共享存储实现了数据库服务器和存储设备的解耦，不同数据库之间的数据同步不再依赖于MySQL的原生复制功能，而是通过磁盘数据同步的手段，来保证数据的一致性。
    </p>
    <p>
     <strong>
      DRBD磁盘复制
     </strong>
    </p>
    <p>
     DRBD是一个用软件实现的、无共享的、服务器之间镜像块设备内容的存储复制解决方案。主要用于对服务器之间的磁盘、分区、逻辑卷等进行数据镜像，当用户将数据写入本地磁盘时，还会将数据发送到网络中另一台主机的磁盘上，这样的本地主机(主节点)与远程主机(备节点)的数据就可以保证实时同步。常用架构如下：
    </p>
    <p>
     <img alt="" height="549" src="https://i-blog.csdnimg.cn/blog_migrate/a36dd7463bde1662227cf016f5b1af7f.png" width="752"/>
    </p>
    <p>
     当本地主机出现问题，远程主机上还保留着一份相同的数据，即可以继续使用，保证了数据的安全。
    </p>
    <ul>
     <li>
      优点：部署简单，价格合适，保证数据的强一致性
     </li>
     <li>
      缺点：对IO性能影响较大，从库不提供读操作
     </li>
    </ul>
    <p>
     <strong>
      1.5 分布式协议
     </strong>
    </p>
    <p>
     分布式协议可以很好解决数据一致性问题。常见的部署方案就是MySQL cluster，它是官方集群的部署方案，通过使用NDB存储引擎实时备份冗余数据，实现数据库的高可用性和数据一致性。如下：
     <img alt="" height="954" src="https://i-blog.csdnimg.cn/blog_migrate/b9b05dbd5f625b97c83f4010dfb5d25d.png" width="992"/>
    </p>
    <ul>
     <li>
      优点：不依赖于第三方软件，可以实现数据的强一致性；
     </li>
     <li>
      缺点：配置较复杂；需要使用NDB储存引擎；至少三节点；
     </li>
    </ul>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f796d62363135796d622f:61727469636c652f64657461696c732f313233343135353630" class_="artid" style="display:none">
 </p>
</div>


