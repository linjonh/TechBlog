---
layout: post
title: "Qt使用JNI调用Java代码附带完整示例"
date: 2024-01-27 10:56:49 +0800
description: "文章目录0 背景1 调用准备2 调用0 背景在开发Android应用时，有些功能无法使用Qt原生或C"
keywords: "qjniobject 调用java"
categories: ['Gui']
tags: ['调用Java', 'Qt', 'Jni', 'Java']
artid: "115148500"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115148500
    alt: "Qt使用JNI调用Java代码附带完整示例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=115148500
featuredImagePreview: https://bing.ee123.net/img/rand?artid=115148500
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Qt使用JNI调用Java代码—————附带完整示例
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#0__1" rel="nofollow">
        0 背景
       </a>
      </li>
      <li>
       <a href="#1__8" rel="nofollow">
        1 调用准备
       </a>
      </li>
      <li>
       <a href="#2__22" rel="nofollow">
        2 调用
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#21__23" rel="nofollow">
          2.1 调用方法
         </a>
        </li>
        <li>
         <a href="#22__57" rel="nofollow">
          2.2 方法签名
         </a>
        </li>
        <li>
         <a href="#23__64" rel="nofollow">
          2.3 调用示例
         </a>
        </li>
        <li>
         <a href="#24__101" rel="nofollow">
          2.4 注意事项
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#3__107" rel="nofollow">
        3 完整示例代码
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#31__108" rel="nofollow">
          3.1 部分代码
         </a>
        </li>
        <li>
         <a href="#32__198" rel="nofollow">
          3.2 附赠示例
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="0__1">
     </a>
     0 背景
    </h2>
    <p>
     在开发Android应用时，有些功能无法使用Qt原生或C++来实现其功能，只能调用java代码来实现。因此就涉及到在Qt中调用java的问题。
    </p>
    <p>
     调用各个方法结果：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d8211ed8e33be3ed2572fc0a644a585f.png"/>
    </p>
    <h2>
     <a id="1__8">
     </a>
     1 调用准备
    </h2>
    <p>
     在.pro中加入下面代码，因此来提供对Android库的支持
    </p>
    <pre><code class="prism language-cpp">QT <span class="token operator">+</span><span class="token operator">=</span> androidextras
</code></pre>
    <p>
     两个重要的类:
     <br/>
     QAndroidJniEnvironment：实现JNI的环境，用于异常的检查和清除等功能；
     <br/>
     QAndroidJniObject：用于调用java方法
    </p>
    <h2>
     <a id="2__22">
     </a>
     2 调用
    </h2>
    <h3>
     <a id="21__23">
     </a>
     2.1 调用方法
    </h3>
    <p>
     方法签名格式：
    </p>
    <pre><code class="prism language-bash">（参数类型）返回类型
</code></pre>
    <p>
     注意：
    </p>
    <ul>
     <li>
      对于类名（对象名）使用
      <code>
       L
      </code>
      前缀开头，使用
      <code>
       ;
      </code>
      后缀结尾；
     </li>
     <li>
      如果是数组类型，使用
      <code>
       [
      </code>
      前缀开头，使用
      <code>
       ;
      </code>
      后缀结尾；
     </li>
    </ul>
    <p>
     调用静态方法格式：
     <br/>
     QAndroidJniObject 对象名;
     <br/>
     对象名&lt;方法返回类型&gt;(包名，方法名，方法签名，方法参数列表)
     <br/>
     如果没有参数，则方法签名和方法参数列表可以省略，程序会自动提供正确的签名。
    </p>
    <p>
     调用非静态方法格式：
     <br/>
     QAndroidJniObject 对象名;
     <br/>
     对象名(方法名，方法签名，方法参数列表)
     <br/>
     如果没有参数，则方法签名和方法参数列表可以省略，程序会自动提供正确的签名。
    </p>
    <p>
     调用静态类方法格式：
     <br/>
     QAndroidJniObject 对象名;
     <br/>
     对象名(包名，方法名，方法签名，方法参数列表)
     <br/>
     如果没有参数，则方法签名和方法参数列表可以省略，程序会自动提供正确的签名。
    </p>
    <p>
     调用非静态方法格式：
     <br/>
     QAndroidJniObject 对象名;
     <br/>
     对象名(方法名，方法签名，方法参数列表)
     <br/>
     如果没有参数，则方法签名和方法参数列表可以省略，程序会自动提供正确的签名。
    </p>
    <p>
     总结：
    </p>
    <ul>
     <li>
      调用静态类/非类方法时，需要提供完整的包名进行精确匹配。
     </li>
     <li>
     </li>
    </ul>
    <h3>
     <a id="22__57">
     </a>
     2.2 方法签名
    </h3>
    <p>
     基本类型：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/99312c5c45c5bd90914bf8cfc1862a05.png">
      <br/>
      对象类型：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9c83cb041393321255c0b5ac07eb7b41.png">
       <br/>
       其他：
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/66d4c366140baaf9949c8d50367b688f.png"/>
      </img>
     </img>
    </p>
    <h3>
     <a id="23__64">
     </a>
     2.3 调用示例
    </h3>
    <p>
     QAndroidJniObject类中调用方法：
    </p>
    <p>
     下面的调用方法中：
     <br/>
     “com/hjx/TestJNI”：包名（全限定类名）
     <br/>
     “test”：方法名
     <br/>
     “()V”：方法签名
     <br/>
     &lt;void&gt;：方法返回类型
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//获得活动对象</span>
QAndroidJniObject m_activity <span class="token operator">=</span> QtAndroid<span class="token operator">::</span><span class="token function">androidActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用非静态方法</span>
m_activity<span class="token punctuation">.</span>callMethod<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用静态方法</span>
m_activity<span class="token punctuation">.</span>callStaticMethod<span class="token operator">&lt;</span>jint<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"com/hjx/TestJNI"</span><span class="token punctuation">,</span>
                                    <span class="token string">"test"</span>
                                    <span class="token comment">//,"()I"//方法签名可以省略</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//构造String参数</span>
QAndroidJniObject obj <span class="token operator">=</span> QAndroidJniObject<span class="token operator">::</span><span class="token function">fromString</span><span class="token punctuation">(</span><span class="token string">"jiangxueHan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jstring jstr <span class="token operator">=</span> obj<span class="token punctuation">.</span>object<span class="token operator">&lt;</span>jstring<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用非静态对象方法(返回类型为对象，如String)</span>
m_activity<span class="token punctuation">.</span><span class="token function">callObjectMethod</span><span class="token punctuation">(</span><span class="token string">"test5"</span><span class="token punctuation">,</span>
                                         <span class="token string">"(Ljava/lang/String;)Ljava/lang/String;"</span><span class="token punctuation">,</span>
                                        jstr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//调用静态对象方法</span>
 m_activity<span class="token punctuation">.</span><span class="token function">callStaticObjectMethod</span><span class="token punctuation">(</span><span class="token string">"com/hjx/TestJNI"</span><span class="token punctuation">,</span>                                                        
 									<span class="token string">"test3"</span><span class="token punctuation">,</span>
                    				<span class="token string">"(Ljava/lang/String;)Ljava/lang/String;"</span><span class="token punctuation">,</span>
                                   jstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="24__101">
     </a>
     2.4 注意事项
    </h3>
    <p>
     为了能够调用非静态方法，因为类没有创建时，是无法调用非静态方法的。因为需要对
     <code>
      AndroidManifest.xml
     </code>
     进行修改，把android:name改为包名，然后该包的方法继承主Activity的类，使得项目已启动就能创建类，这样我们就能调用非静态方法。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/520e222fa0b488e214ab2cd1a558fc75.png#pic_center">
      <br/>
      引入
      <code>
       AndroidManifest.xml
      </code>
      的方法，在项目中，点击
      <code>
       Create Templates
      </code>
      ：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/70e4863d28796cea4c5ddd02b3edd3bf.png#pic_center"/>
     </img>
    </p>
    <h2>
     <a id="3__107">
     </a>
     3 完整示例代码
    </h2>
    <h3>
     <a id="31__108">
     </a>
     3.1 部分代码
    </h3>
    <p>
     调用的方法
     <br/>
     头文件：
    </p>
    <pre><code class="prism language-cpp">
<span class="token macro property">#<span class="token directive keyword">ifdef</span> Q_OS_ANDROID</span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;QAndroidJniEnvironment&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;QAndroidJniObject&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span><span class="token string">&lt;QtAndroid&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">ifdef</span> Q_OS_ANDROID</span>
        QAndroidJniEnvironment env<span class="token punctuation">;</span>
       QAndroidJniObject m_activity <span class="token operator">=</span> QtAndroid<span class="token operator">::</span><span class="token function">androidActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//调用静态方法</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> m_activity<span class="token punctuation">.</span>callStaticMethod<span class="token operator">&lt;</span>jint<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"com/hjx/TestJNI"</span><span class="token punctuation">,</span>
                                    <span class="token string">"test"</span>
                                    <span class="token comment">//,"()V"//方法签名可以省略</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">;</span>

        jint num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>m_activity<span class="token punctuation">.</span>callStaticMethod<span class="token operator">&lt;</span>jint<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"com/hjx/TestJNI"</span><span class="token punctuation">,</span>
                                         <span class="token string">"test2"</span><span class="token punctuation">,</span>
                                         <span class="token string">"(I)I"</span><span class="token punctuation">,</span>
                                         num<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用静态类方法</span>
        QAndroidJniObject obj <span class="token operator">=</span> QAndroidJniObject<span class="token operator">::</span><span class="token function">fromString</span><span class="token punctuation">(</span><span class="token string">"jiangxueHan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jstring jstr <span class="token operator">=</span> obj<span class="token punctuation">.</span>object<span class="token operator">&lt;</span>jstring<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QAndroidJniObject s <span class="token operator">=</span> m_activity<span class="token punctuation">.</span><span class="token function">callStaticObjectMethod</span><span class="token punctuation">(</span><span class="token string">"com/hjx/TestJNI"</span><span class="token punctuation">,</span>
                                                                <span class="token string">"test3"</span><span class="token punctuation">,</span>
                                                   <span class="token string">"(Ljava/lang/String;)Ljava/lang/String;"</span><span class="token punctuation">,</span>
                                                  jstr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调用非静态方法</span>
        QString qstring <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>qstring<span class="token punctuation">;</span>

         m_activity<span class="token punctuation">.</span>callMethod<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"test4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">//调用非静态类方法</span>
        s <span class="token operator">=</span>  m_activity<span class="token punctuation">.</span><span class="token function">callObjectMethod</span><span class="token punctuation">(</span><span class="token string">"test5"</span><span class="token punctuation">,</span>
                                         <span class="token string">"(Ljava/lang/String;)Ljava/lang/String;"</span><span class="token punctuation">,</span>
                                        jstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        qstring <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>qstring<span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">ExceptionCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">ExceptionDescribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            env<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">ExceptionClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre>
    <p>
     被调用的java方法
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>hjx<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>qtproject<span class="token punctuation">.</span>qt5<span class="token punctuation">.</span>android<span class="token punctuation">.</span>bindings<span class="token punctuation">.</span>QtActivity<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJNI</span> <span class="token keyword">extends</span> <span class="token class-name">org<span class="token punctuation">.</span>qtproject<span class="token punctuation">.</span>qt5<span class="token punctuation">.</span>android<span class="token punctuation">.</span>bindings<span class="token punctuation">.</span>QtActivity</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> num <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> String <span class="token function">test3</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token string">", Hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

   <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"21!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

   <span class="token keyword">public</span>  String <span class="token function">test5</span><span class="token punctuation">(</span>String s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token string">", Hi!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="32__198">
     </a>
     3.2 附赠示例
    </h3>
    <p>
     <a href="https://github.com/fanxinglanyu/QtOpenSourceProject">
      github
     </a>
     <br/>
     <a href="https://gitee.com/fanxinglanyu/qt-calling-java" rel="nofollow">
      码云
     </a>
     <br/>
     <a href="" rel="nofollow">
      csdn下载
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33333337353539382f:61727469636c652f64657461696c732f313135313438353030" class_="artid" style="display:none">
 </p>
</div>


