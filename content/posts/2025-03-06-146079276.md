---
layout: post
title: "AI大模型专家之路No.2用三个模型洞察大模型NLP的基础能力"
date: 2025-03-06 20:30:35 +0800
description: "在这个基于AI构建AI的思维探索项目中，我们实现了一个基于BERT的中文AI助手系统。该系统集成了文本分类、命名实体识别和知识库管理等功能，深入了解本项目可以让读者充分了解AI大模型训练和推理的基本原理，该项目使用了三个基础大模型：`bert-base-chinese，ckiplab/bert-base-chinese-ner``，spacy.lang.zh.Chinese` 旨在展示如何构建一个基础的AI应用系"
keywords: "《AI大模型专家之路》No.2：用三个模型洞察大模型NLP的基础能力"
categories: ['Ai']
tags: ['人工智能']
artid: "146079276"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146079276
    alt: "AI大模型专家之路No.2用三个模型洞察大模型NLP的基础能力"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146079276
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146079276
cover: https://bing.ee123.net/img/rand?artid=146079276
image: https://bing.ee123.net/img/rand?artid=146079276
img: https://bing.ee123.net/img/rand?artid=146079276
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     《AI大模型专家之路》No.2：用三个模型洞察大模型NLP的基础能力
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="NLP_0">
     </a>
     用三个模型洞察大模型NLP的基础能力
    </h2>
    <h3>
     <a id="_2">
     </a>
     一、项目概述
    </h3>
    <p>
     在这个基于AI构建AI的思维探索项目中，我们实现了一个基于BERT的中文AI助手系统。该系统集成了文本分类、命名实体识别和知识库管理等功能，深入了解本项目可以让读者充分了解AI大模型训练和推理的基本原理，该项目使用了三个基础大模型：
     <code>
      bert-base-chinese，ckiplab/bert-base-chinese-ner``，spacy.lang.zh.Chinese
     </code>
     旨在展示如何构建一个基础的AI应用系统。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/df08377c197e43f58fcb4d70a7394ad4.png#pic_center"/>
    </p>
    <h4>
     <a id="11__8">
     </a>
     1.1 技术栈
    </h4>
    <ul>
     <li>
      后端：Python + Flask
     </li>
     <li>
      前端：HTML + JavaScript
     </li>
     <li>
      模型：BERT中文预训练模型
     </li>
     <li>
      框架：Transformers + PyTorch
     </li>
    </ul>
    <h4>
     <a id="12__14">
     </a>
     1.2 核心功能
    </h4>
    <ul>
     <li>
      智能问答
     </li>
     <li>
      知识管理
     </li>
     <li>
      模型训练
     </li>
     <li>
      实体识别
     </li>
    </ul>
    <h4>
     <a id="13__19">
     </a>
     1.3 功能分析
    </h4>
    <p>
     这个应用程序试图实现一个简单的AI助手系统，包含以下功能：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        知识管理
       </strong>
      </p>
      <ul>
       <li>
        通过
        <code>
         KnowledgeBase
        </code>
        类管理知识库
       </li>
       <li>
        支持添加和检索知识
       </li>
       <li>
        知识以JSON格式持久化存储
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        文本分类
       </strong>
      </p>
      <ul>
       <li>
        使用
        <code>
         bert-base-chinese
        </code>
        模型
       </li>
       <li>
        只能进行简单的二分类（0或1）
       </li>
       <li>
        主要用于判断问题是否与AI相关
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        命名实体识别
       </strong>
      </p>
      <ul>
       <li>
        使用
        <code>
         ckiplab/bert-base-chinese-ner
        </code>
        模型
       </li>
       <li>
        识别文本中的人名、地名等实体
       </li>
       <li>
        结果并未充分利用
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        Web界面
       </strong>
      </p>
      <ul>
       <li>
        提供聊天界面
       </li>
       <li>
        支持知识添加
       </li>
       <li>
        支持模型训练
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="14__46">
     </a>
     1.4 对大模型技术的帮助
    </h4>
    <p>
     这个项目对学习大模型技术有以下帮助：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        基础概念学习
       </strong>
      </p>
      <ul>
       <li>
        了解如何加载和使用预训练模型
       </li>
       <li>
        理解模型训练的基本流程
       </li>
       <li>
        掌握文本分类和NER的基本概念
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        实践价值
       </strong>
      </p>
      <ul>
       <li>
        展示了如何构建一个完整的AI应用
       </li>
       <li>
        演示了模型训练和预测的基本流程
       </li>
       <li>
        展示了如何处理中文文本
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        改进方向
       </strong>
      </p>
      <ul>
       <li>
        可以学习如何优化模型训练
       </li>
       <li>
        了解如何更好地整合多个模型
       </li>
       <li>
        学习如何设计更好的系统架构
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_65">
     </a>
     二、系统架构
    </h3>
    <p>
     <strong>
      <font color="red">
       基于Python3.11.5虚拟环境，完整源代码见3.4。
      </font>
     </strong>
    </p>
    <h4>
     <a id="21__67">
     </a>
     2.1 核心模块
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">KnowledgeBase</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""知识库管理模块"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>knowledge <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>load_knowledge<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">LearningModule</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""模型学习模块"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model_name <span class="token operator">=</span> <span class="token string">"bert-base-chinese"</span>
        self<span class="token punctuation">.</span>model_path <span class="token operator">=</span> <span class="token string">"./trained_model"</span>

<span class="token keyword">class</span> <span class="token class-name">ThinkingFramework</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""思维框架模块"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>cognitive_model <span class="token operator">=</span> Chinese<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ner_tagger <span class="token operator">=</span> AutoModelForTokenClassification<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"ckiplab/bert-base-chinese-ner"</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="22__88">
     </a>
     2.2 模块职责
    </h4>
    <ol>
     <li>
      <strong>
       知识库模块
      </strong>
      ：管理系统的知识存储和检索
     </li>
     <li>
      <strong>
       学习模块
      </strong>
      ：处理模型训练和预测
     </li>
     <li>
      <strong>
       思维框架
      </strong>
      ：处理文本分析和实体识别
     </li>
     <li>
      <strong>
       用户界面
      </strong>
      ：提供Web交互界面
     </li>
    </ol>
    <h3>
     <a id="_94">
     </a>
     三、关键技术实现
    </h3>
    <h4>
     <a id="31__96">
     </a>
     3.1 模型加载与训练
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">load_or_train_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""加载或训练模型"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>model <span class="token operator">=</span> AutoModelForTokenClassification<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_path<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>model <span class="token operator">=</span> AutoModelForTokenClassification<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model_name<span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>AdamW<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">2e-5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>train_initial_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"加载模型时出错: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span>
</code></pre>
    <h4>
     <a id="32__113">
     </a>
     3.2 知识检索实现
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""检索与查询相关的知识"""</span>
    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    query_lower <span class="token operator">=</span> query<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>knowledge<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        k_lower <span class="token operator">=</span> k<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> query_lower <span class="token operator">==</span> k_lower<span class="token punctuation">:</span>
            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 完全匹配</span>
        <span class="token keyword">elif</span> query_lower <span class="token keyword">in</span> k_lower <span class="token keyword">or</span> k_lower <span class="token keyword">in</span> query_lower<span class="token punctuation">:</span>
            overlap <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>query_lower<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token builtin">set</span><span class="token punctuation">(</span>k_lower<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>query_lower<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>k_lower<span class="token punctuation">)</span><span class="token punctuation">)</span>
            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> overlap<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 部分匹配</span>
</code></pre>
    <h4>
     <a id="33__129">
     </a>
     3.3 实体识别实现
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_ner</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tokens<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""获取命名实体识别结果"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">"ckiplab/bert-base-chinese-ner"</span><span class="token punctuation">)</span>
        inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>text<span class="token punctuation">,</span> return_tensors<span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">)</span>
        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>ner_tagger<span class="token punctuation">(</span><span class="token operator">**</span>inputs<span class="token punctuation">)</span>
        
        predictions <span class="token operator">=</span> outputs<span class="token punctuation">.</span>logits<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        tokens <span class="token operator">=</span> tokenizer<span class="token punctuation">.</span>convert_ids_to_tokens<span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 提取实体</span>
        entities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        current_entity <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        current_type <span class="token operator">=</span> <span class="token boolean">None</span>
        
        <span class="token keyword">for</span> token<span class="token punctuation">,</span> pred <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> predictions<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> pred <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 如果不是O标签</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> current_entity<span class="token punctuation">:</span>
                    current_entity <span class="token operator">=</span> <span class="token punctuation">[</span>token<span class="token punctuation">]</span>
                    current_type <span class="token operator">=</span> pred
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    current_entity<span class="token punctuation">.</span>append<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="34__154">
     </a>
     3.4 完整源代码
    </h4>
    <p>
     系统运行截图：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/35da04217b254bf494eae25e75e5d1fd.png#pic_center"/>
    </p>
    <p>
     代码文件1：main.py
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#运行成功</span>
<span class="token function">import</span> os
<span class="token function">import</span> json
from flask <span class="token function">import</span> Flask, request, jsonify, render_template
from transformers <span class="token function">import</span> AutoTokenizer, AutoModelForTokenClassification
from spacy.lang.zh <span class="token function">import</span> Chinese
<span class="token function">import</span> numpy as np
<span class="token function">import</span> torch
<span class="token function">import</span> <span class="token function">time</span>
<span class="token function">import</span> torch.nn.functional as F
<span class="token comment"># 设置环境变量，使用镜像源</span>
os.environ<span class="token punctuation">[</span><span class="token string">'HF_ENDPOINT'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'https://hf-mirror.com'</span>

class KnowledgeBase:
    def __init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self.knowledge <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self.load_knowledge<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 启动时加载知识</span>
    
    def add<span class="token punctuation">(</span>self, key, value<span class="token punctuation">)</span>:
        self.knowledge<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    
    def retrieve<span class="token punctuation">(</span>self, query<span class="token punctuation">)</span>:
        <span class="token comment">#return [k for k, v in self.knowledge.items() if query.lower() in k.lower()]</span>

        <span class="token string">""</span>"检索与查询相关的知识
        Args:
        query: 用户查询字符串            
        Returns:
            包含<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span>元组的列表，按相关性排序
        <span class="token string">""</span>"
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        query_lower <span class="token operator">=</span> query.lower<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 首先检查完全匹配</span>
        <span class="token keyword">for</span> k, <span class="token function">v</span> <span class="token keyword">in</span> self.knowledge.items<span class="token punctuation">(</span><span class="token punctuation">)</span>:
            k_lower <span class="token operator">=</span> k.lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> query_lower <span class="token operator">==</span> k_lower:
                results.append<span class="token variable"><span class="token punctuation">((</span>k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">))</span></span>  <span class="token comment"># 完全匹配，相关性为1.0</span>
            <span class="token keyword">elif</span> query_lower <span class="token keyword">in</span> k_lower or k_lower <span class="token keyword">in</span> query_lower:
                <span class="token comment"># 部分匹配，计算相关性分数</span>
                overlap <span class="token operator">=</span> len<span class="token punctuation">(</span>set<span class="token punctuation">(</span>query_lower<span class="token punctuation">)</span> <span class="token operator">&amp;</span> set<span class="token punctuation">(</span>k_lower<span class="token punctuation">))</span> / max<span class="token punctuation">(</span>len<span class="token punctuation">(</span>query_lower<span class="token punctuation">)</span>, len<span class="token punctuation">(</span>k_lower<span class="token punctuation">))</span>
                results.append<span class="token variable"><span class="token punctuation">((</span>k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> overlap<span class="token punctuation">))</span></span>
            else:
                <span class="token comment"># 检查内容中是否包含查询词</span>
                <span class="token keyword">if</span> query_lower <span class="token keyword">in</span> v.lower<span class="token punctuation">(</span><span class="token punctuation">)</span>:
                    results.append<span class="token variable"><span class="token punctuation">((</span>k<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">))</span></span>  <span class="token comment"># 内容匹配，相关性为0.5</span>

        <span class="token comment"># 按相关性排序</span>
        results.sort<span class="token punctuation">(</span>key<span class="token operator">=</span>lambda x: x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>, <span class="token assign-left variable">reverse</span><span class="token operator">=</span>True<span class="token punctuation">)</span>

        <span class="token comment"># 只返回相关性大于0.3的结果</span>
        filtered_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>k, <span class="token function">v</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k, v, score <span class="token keyword">in</span> results <span class="token keyword">if</span> score <span class="token operator">&gt;</span> <span class="token number">0.3</span><span class="token punctuation">]</span>

        <span class="token builtin class-name">return</span> filtered_results

    def save_knowledge<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        with open<span class="token punctuation">(</span><span class="token string">"knowledge_base.json"</span>, <span class="token string">"w"</span>, <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> as f:
            json.dump<span class="token punctuation">(</span>self.knowledge, f, <span class="token assign-left variable">ensure_ascii</span><span class="token operator">=</span>False, <span class="token assign-left variable">indent</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    
    def load_knowledge<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        try:
            with open<span class="token punctuation">(</span><span class="token string">"knowledge_base.json"</span>, <span class="token string">"r"</span>, <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> as f:
                self.knowledge <span class="token operator">=</span> json.load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        except FileNotFoundError:
            self.knowledge <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>



class LearningModule:
    def __init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self.model_name <span class="token operator">=</span> <span class="token string">"bert-base-chinese"</span>
        self.model_path <span class="token operator">=</span> <span class="token string">"./trained_model"</span>  <span class="token comment"># 修改为本地路径</span>
        self.optimizer <span class="token operator">=</span> None  <span class="token comment"># 添加优化器初始化</span>
        self.initial_training_data <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token comment"># 添加初始训练数据</span>
            <span class="token punctuation">(</span><span class="token string">"我是一个AI助手"</span>, <span class="token number">1</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"Python是编程语言"</span>, <span class="token number">0</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"机器学习是人工智能的分支"</span>, <span class="token number">1</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"深度学习使用神经网络"</span>, <span class="token number">1</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"自然语言处理很重要"</span>, <span class="token number">1</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"计算机视觉处理图像"</span>, <span class="token number">1</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"强化学习用于决策"</span>, <span class="token number">1</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"数据科学使用Python"</span>, <span class="token number">0</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"Web开发需要HTML"</span>, <span class="token number">0</span><span class="token punctuation">)</span>,
            <span class="token punctuation">(</span><span class="token string">"数据库存储数据"</span>, <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
        self.training_data <span class="token operator">=</span> self.initial_training_data.copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 添加训练数据存储</span>
        self.load_or_train_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    def save_model<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        <span class="token string">""</span>"保存模型到本地目录<span class="token string">""</span>"
        try:
            <span class="token comment"># 确保目录存在</span>
            os.makedirs<span class="token punctuation">(</span>self.model_path, <span class="token assign-left variable">exist_ok</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
            <span class="token comment"># 保存模型和分词器</span>
            self.model.save_pretrained<span class="token punctuation">(</span>self.model_path<span class="token punctuation">)</span>
            self.tokenizer.save_pretrained<span class="token punctuation">(</span>self.model_path<span class="token punctuation">)</span>
            print<span class="token punctuation">(</span>f<span class="token string">"模型已保存到: {self.model_path}"</span><span class="token punctuation">)</span>
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"保存模型时出错: {str(e)}"</span><span class="token punctuation">)</span>
    
    def load_or_train_model<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        <span class="token string">""</span>"加载或训练模型<span class="token string">""</span>"
        try:
            <span class="token comment"># 首先尝试从本地加载模型</span>
            <span class="token keyword">if</span> os.path.exists<span class="token punctuation">(</span>self.model_path<span class="token punctuation">)</span>:
                print<span class="token punctuation">(</span>f<span class="token string">"从本地加载模型: {self.model_path}"</span><span class="token punctuation">)</span>
                self.model <span class="token operator">=</span> AutoModelForTokenClassification.from_pretrained<span class="token punctuation">(</span>self.model_path<span class="token punctuation">)</span>
                self.tokenizer <span class="token operator">=</span> AutoTokenizer.from_pretrained<span class="token punctuation">(</span>self.model_path<span class="token punctuation">)</span>
            else:
                <span class="token comment"># 如果本地没有模型，从预训练模型加载</span>
                print<span class="token punctuation">(</span>f<span class="token string">"从预训练模型加载: {self.model_name}"</span><span class="token punctuation">)</span>
                self.model <span class="token operator">=</span> AutoModelForTokenClassification.from_pretrained<span class="token punctuation">(</span>self.model_name<span class="token punctuation">)</span>
                self.tokenizer <span class="token operator">=</span> AutoTokenizer.from_pretrained<span class="token punctuation">(</span>self.model_name<span class="token punctuation">)</span>
            
            <span class="token comment"># 初始化优化器</span>
            self.optimizer <span class="token operator">=</span> torch.optim.AdamW<span class="token punctuation">(</span>self.model.parameters<span class="token punctuation">(</span><span class="token punctuation">)</span>, <span class="token assign-left variable">lr</span><span class="token operator">=</span>2e-5<span class="token punctuation">)</span>
            
            <span class="token comment"># 训练初始数据</span>
            self.train_initial_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"加载模型时出错: {str(e)}"</span><span class="token punctuation">)</span>
            raise

    def train_initial_data<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        <span class="token string">""</span>"使用初始数据进行训练<span class="token string">""</span>"
        sentences, labels <span class="token operator">=</span> zip<span class="token punctuation">(</span>*self.initial_training_data<span class="token punctuation">)</span>
        self.train<span class="token punctuation">(</span>list<span class="token punctuation">(</span>sentences<span class="token punctuation">)</span>, list<span class="token punctuation">(</span>labels<span class="token punctuation">))</span>

    def train<span class="token punctuation">(</span>self, sentences, labels<span class="token punctuation">)</span>:
        <span class="token string">""</span>"训练模型<span class="token string">""</span>"
        try:
            <span class="token comment"># 对所有句子一起进行tokenize，确保填充到相同长度</span>
            inputs <span class="token operator">=</span> self.tokenizer<span class="token punctuation">(</span>sentences, <span class="token assign-left variable">padding</span><span class="token operator">=</span>True, <span class="token assign-left variable">truncation</span><span class="token operator">=</span>True, <span class="token assign-left variable">return_tensors</span><span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">)</span>
            input_ids <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span>
            attention_mask <span class="token operator">=</span> inputs<span class="token punctuation">[</span><span class="token string">"attention_mask"</span><span class="token punctuation">]</span>
            labels_ids <span class="token operator">=</span> torch.tensor<span class="token punctuation">(</span>labels<span class="token punctuation">)</span>.long<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 设置模型为训练模式</span>
            self.model.train<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 前向传播</span>
            outputs <span class="token operator">=</span> self.model<span class="token punctuation">(</span>input_ids, <span class="token assign-left variable">attention_mask</span><span class="token operator">=</span>attention_mask<span class="token punctuation">)</span>
            
            <span class="token comment"># 调整输出和标签的形状以匹配交叉熵损失函数的要求</span>
            <span class="token comment"># 假设我们只关心[CLS]标记的输出（序列的第一个标记）</span>
            logits <span class="token operator">=</span> outputs.logits<span class="token punctuation">[</span>:, <span class="token number">0</span>, :<span class="token punctuation">]</span>  <span class="token comment"># 取每个序列的第一个标记的输出</span>
            loss <span class="token operator">=</span> F.cross_entropy<span class="token punctuation">(</span>logits, labels_ids<span class="token punctuation">)</span>
            
            <span class="token comment"># 反向传播和优化</span>
            self.optimizer.zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
            loss.backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self.optimizer.step<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            print<span class="token punctuation">(</span>f<span class="token string">"训练完成，损失: {loss.item():.4f}"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">return</span> loss.item<span class="token punctuation">(</span><span class="token punctuation">)</span>
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"训练过程中出错: {str(e)}"</span><span class="token punctuation">)</span>
            <span class="token function">import</span> traceback
            traceback.print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">return</span> None

    def predict<span class="token punctuation">(</span>self, sentence<span class="token punctuation">)</span>:
        <span class="token string">""</span>"对输入句子进行预测<span class="token string">""</span>"
        try:
            <span class="token comment"># 对输入进行tokenize</span>
            tokenized <span class="token operator">=</span> self.tokenizer<span class="token punctuation">(</span>sentence, <span class="token assign-left variable">return_tensors</span><span class="token operator">=</span><span class="token string">"pt"</span>, <span class="token assign-left variable">padding</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
            input_ids <span class="token operator">=</span> tokenized<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span>
            attention_mask <span class="token operator">=</span> tokenized<span class="token punctuation">[</span><span class="token string">"attention_mask"</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 获取模型输出</span>
            with torch.no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>:
                outputs <span class="token operator">=</span> self.model<span class="token punctuation">(</span>input_ids, <span class="token assign-left variable">attention_mask</span><span class="token operator">=</span>attention_mask<span class="token punctuation">)</span>
            
            <span class="token comment"># 处理输出</span>
            logits <span class="token operator">=</span> outputs.logits
            predictions <span class="token operator">=</span> torch.argmax<span class="token punctuation">(</span>logits, <span class="token assign-left variable">dim</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>.tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 这里可以添加更多处理逻辑，例如将预测结果映射到标签</span>
            <span class="token comment"># 简单返回预测结果</span>
            <span class="token builtin class-name">return</span> f<span class="token string">"预测类别: {predictions[0]}"</span>
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"预测错误: {str(e)}"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">return</span> <span class="token string">"无法进行预测"</span>

    def train_model<span class="token punctuation">(</span>self, sentence, label<span class="token punctuation">)</span>:
        <span class="token comment"># 保存训练数据</span>
        self.training_data.append<span class="token variable"><span class="token punctuation">((</span>sentence<span class="token punctuation">,</span> label<span class="token punctuation">))</span></span>
        <span class="token comment"># 训练模型</span>
        loss <span class="token operator">=</span> self.train<span class="token punctuation">(</span><span class="token punctuation">[</span>sentence<span class="token punctuation">]</span>, <span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 保存模型</span>
        self.save_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">return</span> loss

class ThinkingFramework:
    def __init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self.cognitive_model <span class="token operator">=</span> Chinese<span class="token punctuation">(</span><span class="token punctuation">)</span>
        try:
            print<span class="token punctuation">(</span><span class="token string">"正在加载NER模型..."</span><span class="token punctuation">)</span>
            self.ner_tagger <span class="token operator">=</span> AutoModelForTokenClassification.from_pretrained<span class="token punctuation">(</span><span class="token string">"ckiplab/bert-base-chinese-ner"</span><span class="token punctuation">)</span>
            print<span class="token punctuation">(</span><span class="token string">"NER模型加载成功！"</span><span class="token punctuation">)</span>
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"NER模型加载失败: {str(e)}"</span><span class="token punctuation">)</span>
            print<span class="token punctuation">(</span><span class="token string">"请确保网络连接正常，并已安装所有必要的依赖。"</span><span class="token punctuation">)</span>
            raise
    
    def parse<span class="token punctuation">(</span>self, text<span class="token punctuation">)</span>:
        <span class="token builtin class-name">return</span> self.cognitive_model<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    
    def get_ner<span class="token punctuation">(</span>self, tokens<span class="token punctuation">)</span>:
        <span class="token string">""</span>"获取命名实体识别结果<span class="token string">""</span>"
        try:
            <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>tokens, str<span class="token punctuation">)</span>:
                tokens <span class="token operator">=</span> self.parse<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>
            
            tokenizer <span class="token operator">=</span> AutoTokenizer.from_pretrained<span class="token punctuation">(</span><span class="token string">"ckiplab/bert-base-chinese-ner"</span><span class="token punctuation">)</span>
            text <span class="token operator">=</span> tokens.text <span class="token keyword">if</span> hasattr<span class="token punctuation">(</span>tokens, <span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> str<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>
            
            inputs <span class="token operator">=</span> tokenizer<span class="token punctuation">(</span>text, <span class="token assign-left variable">return_tensors</span><span class="token operator">=</span><span class="token string">"pt"</span><span class="token punctuation">)</span>
            outputs <span class="token operator">=</span> self.ner_tagger<span class="token punctuation">(</span>**inputs<span class="token punctuation">)</span>
            
            <span class="token comment"># 获取预测结果和标签</span>
            predictions <span class="token operator">=</span> outputs.logits.argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>.tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            tokens <span class="token operator">=</span> tokenizer.convert_ids_to_tokens<span class="token punctuation">(</span>inputs<span class="token punctuation">[</span><span class="token string">"input_ids"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 提取实体</span>
            entities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            current_entity <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            current_type <span class="token operator">=</span> None
            
            <span class="token keyword">for</span> token, pred <span class="token keyword">in</span> zip<span class="token punctuation">(</span>tokens, predictions<span class="token punctuation">)</span>:
                <span class="token keyword">if</span> pred <span class="token operator">&gt;</span> <span class="token number">0</span>:  <span class="token comment"># 如果不是O标签</span>
                    <span class="token keyword">if</span> not current_entity:
                        current_entity <span class="token operator">=</span> <span class="token punctuation">[</span>token<span class="token punctuation">]</span>
                        current_type <span class="token operator">=</span> pred
                    else:
                        current_entity.append<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
                <span class="token keyword">elif</span> current_entity:
                    entities.append<span class="token variable"><span class="token punctuation">((</span>''.join<span class="token punctuation">(</span>current_entity<span class="token punctuation">)</span><span class="token punctuation">,</span> current_type<span class="token punctuation">))</span></span>
                    current_entity <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    current_type <span class="token operator">=</span> None
            
            <span class="token builtin class-name">return</span> entities
            
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"NER处理错误: {str(e)}"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


class SelfConsciousness:
    def __init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        self.knowledge <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self.last_update <span class="token operator">=</span> time.time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    def update<span class="token punctuation">(</span>self, new_knowledge<span class="token punctuation">)</span>:
        <span class="token keyword">if</span> new_knowledge:
            self.knowledge.update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>k: time.time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k, _ <span class="token keyword">in</span> new_knowledge<span class="token punctuation">}</span><span class="token punctuation">)</span>
            self.last_update <span class="token operator">=</span> time.time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            print<span class="token punctuation">(</span>f<span class="token string">"自我意识已更新，新增知识点: {len(new_knowledge)}"</span><span class="token punctuation">)</span>
    
    def save<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        with open<span class="token punctuation">(</span><span class="token string">"consciousness.json"</span>, <span class="token string">"w"</span>, <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> as f:
            json.dump<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">"knowledge"</span><span class="token builtin class-name">:</span> self.knowledge,
                <span class="token string">"last_update"</span><span class="token builtin class-name">:</span> self.last_update
            <span class="token punctuation">}</span>, f, <span class="token assign-left variable">ensure_ascii</span><span class="token operator">=</span>False, <span class="token assign-left variable">indent</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        print<span class="token punctuation">(</span><span class="token string">"自我意识已保存"</span><span class="token punctuation">)</span>


class UserInterface:
    def __init__<span class="token punctuation">(</span>self, thinking_framework, learning_module, knowledge_base<span class="token punctuation">)</span>:
        self.thinking_framework <span class="token operator">=</span> thinking_framework
        self.learning_module <span class="token operator">=</span> learning_module
        self.knowledge_base <span class="token operator">=</span> knowledge_base
        self.app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
        self.setup_routes<span class="token punctuation">(</span><span class="token punctuation">)</span>

    def setup_routes<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        @self.app.route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
        def index<span class="token punctuation">(</span><span class="token punctuation">)</span>:
            <span class="token builtin class-name">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

        @self.app.route<span class="token punctuation">(</span><span class="token string">'/chat'</span>, <span class="token assign-left variable">methods</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        def chat<span class="token punctuation">(</span><span class="token punctuation">)</span>:
            data <span class="token operator">=</span> request.get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>
            user_message <span class="token operator">=</span> data.get<span class="token punctuation">(</span><span class="token string">'message'</span>, <span class="token string">''</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> not user_message:
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'response'</span><span class="token builtin class-name">:</span> <span class="token string">'请输入有效的问题。'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

            try:
                <span class="token comment"># 使用思维框架处理用户输入</span>
                doc <span class="token operator">=</span> self.thinking_framework.parse<span class="token punctuation">(</span>user_message<span class="token punctuation">)</span>
                
                <span class="token comment"># 正确处理NER标签</span>
                try:
                    <span class="token comment"># 首先解析文本，然后获取NER标签</span>
                    tokens <span class="token operator">=</span> self.thinking_framework.parse<span class="token punctuation">(</span>user_message<span class="token punctuation">)</span>
                    ner_tags <span class="token operator">=</span> self.thinking_framework.get_ner<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>
                except Exception as e:
                    print<span class="token punctuation">(</span>f<span class="token string">"NER处理错误: {str(e)}"</span><span class="token punctuation">)</span>
                    ner_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 使用学习模块进行预测</span>
                try:
                    prediction <span class="token operator">=</span> self.learning_module.predict<span class="token punctuation">(</span>user_message<span class="token punctuation">)</span>
                except Exception as e:
                    print<span class="token punctuation">(</span>f<span class="token string">"预测错误: {str(e)}"</span><span class="token punctuation">)</span>
                    prediction <span class="token operator">=</span> None
                
                <span class="token comment"># 从知识库中检索相关信息</span>
                try:
                    relevant_knowledge <span class="token operator">=</span> self.knowledge_base.retrieve<span class="token punctuation">(</span>user_message<span class="token punctuation">)</span>
                    print<span class="token punctuation">(</span>f<span class="token string">"检索到的知识: {relevant_knowledge}"</span><span class="token punctuation">)</span>
                except Exception as e:
                    print<span class="token punctuation">(</span>f<span class="token string">"知识库检索错误: {str(e)}"</span><span class="token punctuation">)</span>
                    relevant_knowledge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 生成回复</span>
                response <span class="token operator">=</span> self.generate_response<span class="token punctuation">(</span>user_message, doc, ner_tags, prediction, relevant_knowledge<span class="token punctuation">)</span>
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'response'</span><span class="token builtin class-name">:</span> response<span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            except Exception as e:
                print<span class="token punctuation">(</span>f<span class="token string">"处理消息时出错: {str(e)}"</span><span class="token punctuation">)</span>
                <span class="token function">import</span> traceback
                traceback.print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'response'</span><span class="token builtin class-name">:</span> f<span class="token string">'抱歉，处理您的消息时出现了错误: {str(e)}'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        @self.app.route<span class="token punctuation">(</span><span class="token string">'/add_knowledge'</span>, <span class="token assign-left variable">methods</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        def add_knowledge<span class="token punctuation">(</span><span class="token punctuation">)</span>:
            data <span class="token operator">=</span> request.get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> data.get<span class="token punctuation">(</span><span class="token string">'key'</span>, <span class="token string">''</span><span class="token punctuation">)</span>
            value <span class="token operator">=</span> data.get<span class="token punctuation">(</span><span class="token string">'value'</span>, <span class="token string">''</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> not key or not value:
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> False, <span class="token string">'message'</span><span class="token builtin class-name">:</span> <span class="token string">'请提供有效的知识关键词和内容'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            try:
                <span class="token comment"># 添加知识到知识库</span>
                self.knowledge_base.add<span class="token punctuation">(</span>key, value<span class="token punctuation">)</span>
                print<span class="token punctuation">(</span>f<span class="token string">"添加知识: {key} -&gt; {value}"</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> True<span class="token punctuation">}</span><span class="token punctuation">)</span>
            except Exception as e:
                print<span class="token punctuation">(</span>f<span class="token string">"添加知识时出错: {str(e)}"</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> False, <span class="token string">'message'</span><span class="token builtin class-name">:</span> str<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        @self.app.route<span class="token punctuation">(</span><span class="token string">'/train_model'</span>, <span class="token assign-left variable">methods</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        def train_model<span class="token punctuation">(</span><span class="token punctuation">)</span>:
            data <span class="token operator">=</span> request.get_json<span class="token punctuation">(</span><span class="token punctuation">)</span>
            sentence <span class="token operator">=</span> data.get<span class="token punctuation">(</span><span class="token string">'sentence'</span>, <span class="token string">''</span><span class="token punctuation">)</span>
            label <span class="token operator">=</span> data.get<span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> not sentence or label is None:
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> False, <span class="token string">'message'</span><span class="token builtin class-name">:</span> <span class="token string">'请提供有效的训练句子和标签'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            try:
                <span class="token comment"># 训练模型</span>
                loss <span class="token operator">=</span> self.learning_module.train_model<span class="token punctuation">(</span>sentence, label<span class="token punctuation">)</span>
                <span class="token keyword">if</span> loss is not None:
                    print<span class="token punctuation">(</span>f<span class="token string">"训练模型: '{sentence}' -&gt; {label}, 损失: {loss}"</span><span class="token punctuation">)</span>
                    <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> True, <span class="token string">'loss'</span><span class="token builtin class-name">:</span> loss<span class="token punctuation">}</span><span class="token punctuation">)</span>
                else:
                    <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> False, <span class="token string">'message'</span><span class="token builtin class-name">:</span> <span class="token string">'训练失败，请查看服务器日志'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            except Exception as e:
                print<span class="token punctuation">(</span>f<span class="token string">"训练模型时出错: {str(e)}"</span><span class="token punctuation">)</span>
                <span class="token builtin class-name">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'success'</span><span class="token builtin class-name">:</span> False, <span class="token string">'message'</span><span class="token builtin class-name">:</span> str<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    def generate_response<span class="token punctuation">(</span>self, user_message, doc, ner_tags, prediction, relevant_knowledge<span class="token punctuation">)</span>:
        <span class="token string">""</span>"生成对用户消息的回复<span class="token string">""</span>"
        try:
            response_parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            
            <span class="token comment"># 处理NER结果</span>
            <span class="token keyword">if</span> ner_tags:
                entities <span class="token operator">=</span> <span class="token punctuation">[</span>entity <span class="token keyword">for</span> entity, _ <span class="token keyword">in</span> ner_tags<span class="token punctuation">]</span>
                <span class="token keyword">if</span> entities:
                    response_parts.append<span class="token punctuation">(</span>f<span class="token string">"我注意到您提到了：{', '.join(entities)}"</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 添加知识库中的相关信息</span>
            <span class="token keyword">if</span> relevant_knowledge:
                <span class="token keyword">for</span> key, value <span class="token keyword">in</span> relevant_knowledge<span class="token punctuation">[</span>:2<span class="token punctuation">]</span>:
                    response_parts.append<span class="token punctuation">(</span>f<span class="token string">"关于{key}，我知道：{value}"</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 根据预测结果调整回复</span>
            <span class="token keyword">if</span> prediction and <span class="token string">"预测类别: 1"</span> <span class="token keyword">in</span> prediction:
                response_parts.append<span class="token punctuation">(</span><span class="token string">"这看起来是一个与AI相关的问题，我很乐意帮您解答。"</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 如果没有找到相关信息</span>
            <span class="token keyword">if</span> not response_parts:
                <span class="token keyword">if</span> <span class="token string">"你好"</span> <span class="token keyword">in</span> user_message or <span class="token string">"您好"</span> <span class="token keyword">in</span> user_message:
                    response_parts.append<span class="token punctuation">(</span><span class="token string">"您好！我是AI助手，很高兴为您服务。"</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> any<span class="token punctuation">(</span>word <span class="token keyword">in</span> user_message <span class="token keyword">for</span> <span class="token for-or-select variable">word</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"什么"</span>, <span class="token string">"怎么"</span>, <span class="token string">"如何"</span>, <span class="token string">"为什么"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>:
                    response_parts.append<span class="token punctuation">(</span><span class="token string">"这是一个很好的问题。让我为您详细解释..."</span><span class="token punctuation">)</span>
                else:
                    response_parts.append<span class="token punctuation">(</span><span class="token string">"我理解您的问题，让我为您提供相关信息..."</span><span class="token punctuation">)</span>
            
            <span class="token builtin class-name">return</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span>.join<span class="token punctuation">(</span>response_parts<span class="token punctuation">)</span>
        
        except Exception as e:
            print<span class="token punctuation">(</span>f<span class="token string">"生成回复时出错: {str(e)}"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">return</span> <span class="token string">"我正在处理您的请求，但遇到了一些技术问题。请稍后再试。"</span>

    def start<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
        <span class="token comment"># 在Windows上，使用use_reloader=False可以避免WinError 10038</span>
        self.app.run<span class="token punctuation">(</span>debug<span class="token operator">=</span>True, <span class="token assign-left variable">use_reloader</span><span class="token operator">=</span>False, <span class="token assign-left variable">threaded</span><span class="token operator">=</span>True<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token builtin class-name">:</span>
    try:
        <span class="token comment"># 初始化各个组件</span>
        print<span class="token punctuation">(</span><span class="token string">"初始化知识库..."</span><span class="token punctuation">)</span>
        kb <span class="token operator">=</span> KnowledgeBase<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"初始化学习模块..."</span><span class="token punctuation">)</span>
        lm <span class="token operator">=</span> LearningModule<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"初始化自我意识模块..."</span><span class="token punctuation">)</span>
        sf <span class="token operator">=</span> SelfConsciousness<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"初始化思维框架..."</span><span class="token punctuation">)</span>
        tf <span class="token operator">=</span> ThinkingFramework<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"初始化用户界面..."</span><span class="token punctuation">)</span>
        uif <span class="token operator">=</span> UserInterface<span class="token punctuation">(</span>tf, lm, kb<span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"添加初始知识..."</span><span class="token punctuation">)</span>
        <span class="token comment"># 添加一些初始知识</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"人工智能"</span>, <span class="token string">"人工智能是计算机科学的一个分支，它企图了解智能的实质，并生产出一种新的能以人类智能相似的方式做出反应的智能机器。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"机器学习"</span>, <span class="token string">"机器学习是人工智能的一个分支，它使用各种算法来解析数据、学习数据，然后对新数据进行预测。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"深度学习"</span>, <span class="token string">"深度学习是机器学习的一个分支，它使用多层神经网络来模拟人脑的工作方式。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"自然语言处理"</span>, <span class="token string">"自然语言处理(NLP)是人工智能的一个子领域，专注于使计算机能够理解、解释和生成人类语言。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"计算机视觉"</span>, <span class="token string">"计算机视觉是人工智能的一个领域，专注于使计算机能够从图像或视频中获取高级理解。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"强化学习"</span>, <span class="token string">"强化学习是机器学习的一种方法，通过让代理在环境中采取行动并获得奖励或惩罚来学习最佳策略。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"神经网络"</span>, <span class="token string">"神经网络是一种受人脑结构启发的计算模型，由多层相互连接的节点(神经元)组成，用于模式识别和机器学习。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"大语言模型"</span>, <span class="token string">"大语言模型是一种基于深度学习的自然语言处理模型，通过大量文本数据训练，能够生成、理解和翻译人类语言。"</span><span class="token punctuation">)</span>
        kb.add<span class="token punctuation">(</span><span class="token string">"Python"</span>, <span class="token string">"Python是一种高级编程语言，以其简洁、易读的语法和丰富的库而闻名，广泛应用于数据科学、人工智能和Web开发等领域。"</span><span class="token punctuation">)</span>        
        print<span class="token punctuation">(</span><span class="token string">"更新知识..."</span><span class="token punctuation">)</span>
        <span class="token comment"># 模拟知识更新</span>
        knowledge_items <span class="token operator">=</span> kb.retrieve<span class="token punctuation">(</span><span class="token string">"人工智能"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> knowledge_items:
            print<span class="token punctuation">(</span>f<span class="token string">"找到相关知识: {knowledge_items}"</span><span class="token punctuation">)</span>
            sf.update<span class="token punctuation">(</span>knowledge_items<span class="token punctuation">)</span>
            <span class="token comment"># 保存更新后的知识</span>
            sf.save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        else:
            print<span class="token punctuation">(</span><span class="token string">"未找到相关知识，跳过更新"</span><span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"训练模型..."</span><span class="token punctuation">)</span>
        <span class="token comment"># 开始训练模型</span>
        lm.train<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"我是一个AI助手"</span>, <span class="token string">"Python是编程语言"</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        print<span class="token punctuation">(</span><span class="token string">"启动Web服务..."</span><span class="token punctuation">)</span>
        <span class="token comment"># 启动服务</span>
        uif.start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    except Exception as e:
        print<span class="token punctuation">(</span>f<span class="token string">"启动失败: {str(e)}"</span><span class="token punctuation">)</span>
        <span class="token function">import</span> traceback
        traceback.print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
    <p>
     代码文件2：index.html(放在在 templates文件夹下)
    </p>
    <pre><code class="prism language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>AI助手<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
        body <span class="token punctuation">{<!-- --></span>
            font-family: Arial, sans-serif<span class="token punctuation">;</span>
            margin: <span class="token number">0</span><span class="token punctuation">;</span>
            padding: 20px<span class="token punctuation">;</span>
            background-color: <span class="token comment">#f5f5f5;</span>
        <span class="token punctuation">}</span>
        .container <span class="token punctuation">{<!-- --></span>
            max-width: 1000px<span class="token punctuation">;</span>
            margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
            display: flex<span class="token punctuation">;</span>
            gap: 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .chat-container <span class="token punctuation">{<!-- --></span>
            flex: <span class="token number">2</span><span class="token punctuation">;</span>
            background-color: white<span class="token punctuation">;</span>
            border-radius: 10px<span class="token punctuation">;</span>
            box-shadow: <span class="token number">0</span> 2px 10px rgba<span class="token punctuation">(</span><span class="token number">0,0</span>,0,0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            padding: 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .training-container <span class="token punctuation">{<!-- --></span>
            flex: <span class="token number">1</span><span class="token punctuation">;</span>
            background-color: white<span class="token punctuation">;</span>
            border-radius: 10px<span class="token punctuation">;</span>
            box-shadow: <span class="token number">0</span> 2px 10px rgba<span class="token punctuation">(</span><span class="token number">0,0</span>,0,0.1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            padding: 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .chat-messages <span class="token punctuation">{<!-- --></span>
            height: 500px<span class="token punctuation">;</span>
            overflow-y: auto<span class="token punctuation">;</span>
            padding: 10px<span class="token punctuation">;</span>
            border: 1px solid <span class="token comment">#ddd;</span>
            border-radius: 5px<span class="token punctuation">;</span>
            margin-bottom: 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .message <span class="token punctuation">{<!-- --></span>
            margin: 10px <span class="token number">0</span><span class="token punctuation">;</span>
            padding: 10px<span class="token punctuation">;</span>
            border-radius: 5px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .user-message <span class="token punctuation">{<!-- --></span>
            background-color: <span class="token comment">#e3f2fd;</span>
            margin-left: <span class="token number">20</span>%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .ai-message <span class="token punctuation">{<!-- --></span>
            background-color: <span class="token comment">#f5f5f5;</span>
            margin-right: <span class="token number">20</span>%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .input-container <span class="token punctuation">{<!-- --></span>
            display: flex<span class="token punctuation">;</span>
            gap: 10px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        input<span class="token punctuation">[</span>type<span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">]</span>, textarea <span class="token punctuation">{<!-- --></span>
            flex: <span class="token number">1</span><span class="token punctuation">;</span>
            padding: 10px<span class="token punctuation">;</span>
            border: 1px solid <span class="token comment">#ddd;</span>
            border-radius: 5px<span class="token punctuation">;</span>
            font-size: 16px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        button <span class="token punctuation">{<!-- --></span>
            padding: 10px 20px<span class="token punctuation">;</span>
            background-color: <span class="token comment">#2196f3;</span>
            color: white<span class="token punctuation">;</span>
            border: none<span class="token punctuation">;</span>
            border-radius: 5px<span class="token punctuation">;</span>
            cursor: pointer<span class="token punctuation">;</span>
            font-size: 16px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        button:hover <span class="token punctuation">{<!-- --></span>
            background-color: <span class="token comment">#1976d2;</span>
        <span class="token punctuation">}</span>
        h2 <span class="token punctuation">{<!-- --></span>
            color: <span class="token comment">#333;</span>
            margin-top: <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .form-group <span class="token punctuation">{<!-- --></span>
            margin-bottom: 15px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        label <span class="token punctuation">{<!-- --></span>
            display: block<span class="token punctuation">;</span>
            margin-bottom: 5px<span class="token punctuation">;</span>
            font-weight: bold<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .status <span class="token punctuation">{<!-- --></span>
            margin-top: 10px<span class="token punctuation">;</span>
            padding: 10px<span class="token punctuation">;</span>
            border-radius: 5px<span class="token punctuation">;</span>
            display: none<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .success <span class="token punctuation">{<!-- --></span>
            background-color: <span class="token comment">#d4edda;</span>
            color: <span class="token comment">#155724;</span>
            display: block<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        .error <span class="token punctuation">{<!-- --></span>
            background-color: <span class="token comment">#f8d7da;</span>
            color: <span class="token comment">#721c24;</span>
            display: block<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"chat-container"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>AI助手聊天<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"chat-messages"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"chat-messages"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"input-container"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"user-input"</span> <span class="token assign-left variable">placeholder</span><span class="token operator">=</span><span class="token string">"请输入您的问题..."</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button <span class="token assign-left variable">onclick</span><span class="token operator">=</span><span class="token string">"sendMessage()"</span><span class="token operator">&gt;</span>发送<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"training-container"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>知识训练<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"knowledge-key"</span><span class="token operator">&gt;</span>知识关键词<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"knowledge-key"</span> <span class="token assign-left variable">placeholder</span><span class="token operator">=</span><span class="token string">"例如：人工智能"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"knowledge-value"</span><span class="token operator">&gt;</span>知识内容<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>textarea <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"knowledge-value"</span> <span class="token assign-left variable">rows</span><span class="token operator">=</span><span class="token string">"5"</span> <span class="token assign-left variable">placeholder</span><span class="token operator">=</span><span class="token string">"例如：人工智能是计算机科学的一个分支..."</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/textarea<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button <span class="token assign-left variable">onclick</span><span class="token operator">=</span><span class="token string">"addKnowledge()"</span><span class="token operator">&gt;</span>添加知识<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"knowledge-status"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"status"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
            
            <span class="token operator">&lt;</span>h2 <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"margin-top: 20px;"</span><span class="token operator">&gt;</span>模型训练<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"train-sentence"</span><span class="token operator">&gt;</span>训练句子<span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"train-sentence"</span> <span class="token assign-left variable">placeholder</span><span class="token operator">=</span><span class="token string">"例如：我是一个AI助手"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"form-group"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>label <span class="token assign-left variable">for</span><span class="token operator">=</span><span class="token string">"train-label"</span><span class="token operator">&gt;</span>标签 <span class="token punctuation">(</span><span class="token number">0</span> 或 <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>/label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"number"</span> <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"train-label"</span> <span class="token assign-left variable">min</span><span class="token operator">=</span><span class="token string">"0"</span> <span class="token assign-left variable">max</span><span class="token operator">=</span><span class="token string">"1"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>button <span class="token assign-left variable">onclick</span><span class="token operator">=</span><span class="token string">"trainModel()"</span><span class="token operator">&gt;</span>训练模型<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"train-status"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"status"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        // 添加欢迎消息
        window.onload <span class="token operator">=</span> <span class="token function-name function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            addMessage<span class="token punctuation">(</span><span class="token string">"您好！我是AI助手，有什么可以帮助您的吗？"</span>, <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token keyword">function</span> addMessage<span class="token punctuation">(</span>message, isUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            const messagesDiv <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'chat-messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            const messageDiv <span class="token operator">=</span> document.createElement<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageDiv.className <span class="token operator">=</span> <span class="token variable"><span class="token variable">`</span>message $<span class="token punctuation">{<!-- --></span>isUser ? <span class="token string">'user-message'</span> <span class="token builtin class-name">:</span> <span class="token string">'ai-message'</span><span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
            messageDiv.textContent <span class="token operator">=</span> message<span class="token punctuation">;</span>
            messagesDiv.appendChild<span class="token punctuation">(</span>messageDiv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            messagesDiv.scrollTop <span class="token operator">=</span> messagesDiv.scrollHeight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function-name function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            const input <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'user-input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            const message <span class="token operator">=</span> input.value.trim<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                addMessage<span class="token punctuation">(</span>message, <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                input.value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                
                // 显示加载状态
                const loadingId <span class="token operator">=</span> showLoading<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                fetch<span class="token punctuation">(</span><span class="token string">'/chat'</span>, <span class="token punctuation">{<!-- --></span>
                    method: <span class="token string">'POST'</span>,
                    headers: <span class="token punctuation">{<!-- --></span>
                        <span class="token string">'Content-Type'</span><span class="token builtin class-name">:</span> <span class="token string">'application/json'</span>,
                    <span class="token punctuation">}</span>,
                    body: JSON.stringify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> message: message <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                .then<span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response.json<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .then<span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
                    // 移除加载状态
                    removeLoading<span class="token punctuation">(</span>loadingId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    addMessage<span class="token punctuation">(</span>data.response, <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                .catch<span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
                    // 移除加载状态
                    removeLoading<span class="token punctuation">(</span>loadingId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console.error<span class="token punctuation">(</span><span class="token string">'Error:'</span>, error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    addMessage<span class="token punctuation">(</span><span class="token string">'抱歉，发生了一些错误。请稍后再试。'</span>, <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> <span class="token function-name function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            const messagesDiv <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'chat-messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            const loadingDiv <span class="token operator">=</span> document.createElement<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            loadingDiv.className <span class="token operator">=</span> <span class="token string">'message ai-message'</span><span class="token punctuation">;</span>
            loadingDiv.textContent <span class="token operator">=</span> <span class="token string">'正在思考...'</span><span class="token punctuation">;</span>
            loadingDiv.id <span class="token operator">=</span> <span class="token string">'loading-'</span> + Date.now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messagesDiv.appendChild<span class="token punctuation">(</span>loadingDiv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            messagesDiv.scrollTop <span class="token operator">=</span> messagesDiv.scrollHeight<span class="token punctuation">;</span>
            <span class="token builtin class-name">return</span> loadingDiv.id<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> removeLoading<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            const loadingDiv <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>loadingDiv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                loadingDiv.remove<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> <span class="token function-name function">addKnowledge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            const key <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'knowledge-key'</span><span class="token punctuation">)</span>.value.trim<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            const value <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'knowledge-value'</span><span class="token punctuation">)</span>.value.trim<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            const statusDiv <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'knowledge-status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>key <span class="token operator">||</span> <span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                statusDiv.textContent <span class="token operator">=</span> <span class="token string">'请填写完整的知识信息'</span><span class="token punctuation">;</span>
                statusDiv.className <span class="token operator">=</span> <span class="token string">'status error'</span><span class="token punctuation">;</span>
                <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            fetch<span class="token punctuation">(</span><span class="token string">'/add_knowledge'</span>, <span class="token punctuation">{<!-- --></span>
                method: <span class="token string">'POST'</span>,
                headers: <span class="token punctuation">{<!-- --></span>
                    <span class="token string">'Content-Type'</span><span class="token builtin class-name">:</span> <span class="token string">'application/json'</span>,
                <span class="token punctuation">}</span>,
                body: JSON.stringify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> key: key, value: value <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            .then<span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response.json<span class="token punctuation">(</span><span class="token punctuation">))</span>
            .then<span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>data.success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    statusDiv.textContent <span class="token operator">=</span> <span class="token string">'知识添加成功！'</span><span class="token punctuation">;</span>
                    statusDiv.className <span class="token operator">=</span> <span class="token string">'status success'</span><span class="token punctuation">;</span>
                    // 清空输入框
                    document.getElementById<span class="token punctuation">(</span><span class="token string">'knowledge-key'</span><span class="token punctuation">)</span>.value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                    document.getElementById<span class="token punctuation">(</span><span class="token string">'knowledge-value'</span><span class="token punctuation">)</span>.value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    statusDiv.textContent <span class="token operator">=</span> data.message <span class="token operator">||</span> <span class="token string">'知识添加失败'</span><span class="token punctuation">;</span>
                    statusDiv.className <span class="token operator">=</span> <span class="token string">'status error'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            .catch<span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
                console.error<span class="token punctuation">(</span><span class="token string">'Error:'</span>, error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                statusDiv.textContent <span class="token operator">=</span> <span class="token string">'发生错误，请稍后再试'</span><span class="token punctuation">;</span>
                statusDiv.className <span class="token operator">=</span> <span class="token string">'status error'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> <span class="token function-name function">trainModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            const sentence <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'train-sentence'</span><span class="token punctuation">)</span>.value.trim<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            const label <span class="token operator">=</span> parseInt<span class="token punctuation">(</span>document.getElementById<span class="token punctuation">(</span><span class="token string">'train-label'</span><span class="token punctuation">)</span>.value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            const statusDiv <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">'train-status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sentence <span class="token operator">||</span> isNaN<span class="token punctuation">(</span>label<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>label <span class="token operator">!=</span><span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> label <span class="token operator">!=</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span>
                statusDiv.textContent <span class="token operator">=</span> <span class="token string">'请填写正确的训练数据'</span><span class="token punctuation">;</span>
                statusDiv.className <span class="token operator">=</span> <span class="token string">'status error'</span><span class="token punctuation">;</span>
                <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            fetch<span class="token punctuation">(</span><span class="token string">'/train_model'</span>, <span class="token punctuation">{<!-- --></span>
                method: <span class="token string">'POST'</span>,
                headers: <span class="token punctuation">{<!-- --></span>
                    <span class="token string">'Content-Type'</span><span class="token builtin class-name">:</span> <span class="token string">'application/json'</span>,
                <span class="token punctuation">}</span>,
                body: JSON.stringify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> sentence: sentence, label: label <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            .then<span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">&gt;</span> response.json<span class="token punctuation">(</span><span class="token punctuation">))</span>
            .then<span class="token punctuation">(</span>data <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>data.success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    statusDiv.textContent <span class="token operator">=</span> <span class="token variable"><span class="token variable">`</span>训练成功！损失: $<span class="token punctuation">{<!-- --></span>data.loss<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
                    statusDiv.className <span class="token operator">=</span> <span class="token string">'status success'</span><span class="token punctuation">;</span>
                    // 清空输入框
                    document.getElementById<span class="token punctuation">(</span><span class="token string">'train-sentence'</span><span class="token punctuation">)</span>.value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    statusDiv.textContent <span class="token operator">=</span> data.message <span class="token operator">||</span> <span class="token string">'训练失败'</span><span class="token punctuation">;</span>
                    statusDiv.className <span class="token operator">=</span> <span class="token string">'status error'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            .catch<span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
                console.error<span class="token punctuation">(</span><span class="token string">'Error:'</span>, error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                statusDiv.textContent <span class="token operator">=</span> <span class="token string">'发生错误，请稍后再试'</span><span class="token punctuation">;</span>
                statusDiv.className <span class="token operator">=</span> <span class="token string">'status error'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        // 按回车发送消息
        document.getElementById<span class="token punctuation">(</span><span class="token string">'user-input'</span><span class="token punctuation">)</span>.addEventListener<span class="token punctuation">(</span><span class="token string">'keypress'</span>, function<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e.key <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                sendMessage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>

</code></pre>
    <h3>
     <a id="_920">
     </a>
     四、系统特点与优势
    </h3>
    <h4>
     <a id="41__922">
     </a>
     4.1 特点
    </h4>
    <ol>
     <li>
      <strong>
       模块化设计
      </strong>
      ：各个功能模块独立，便于维护和扩展
     </li>
     <li>
      <strong>
       知识持久化
      </strong>
      ：支持知识的保存和加载
     </li>
     <li>
      <strong>
       实时训练
      </strong>
      ：支持动态添加训练数据
     </li>
     <li>
      <strong>
       多模型集成
      </strong>
      ：结合了分类和NER模型
     </li>
    </ol>
    <h4>
     <a id="42__928">
     </a>
     4.2 优势
    </h4>
    <ol>
     <li>
      <strong>
       易于理解
      </strong>
      ：代码结构清晰，适合学习
     </li>
     <li>
      <strong>
       功能完整
      </strong>
      ：包含了AI应用的基本要素
     </li>
     <li>
      <strong>
       可扩展性
      </strong>
      ：便于添加新功能
     </li>
    </ol>
    <h3>
     <a id="_933">
     </a>
     五、存在的问题与改进方向
    </h3>
    <h4>
     <a id="51__935">
     </a>
     5.1 存在的问题
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        功能混杂
       </strong>
      </p>
      <ul>
       <li>
        同时使用了多个模型，但功能不明确
       </li>
       <li>
        分类模型和NER模型的结果没有很好地整合
       </li>
       <li>
        知识库检索和模型预测结果没有很好地结合
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        技术实现问题
       </strong>
      </p>
      <ul>
       <li>
        分类模型训练数据太少（只有10个样本）
       </li>
       <li>
        模型训练过程过于简单
       </li>
       <li>
        没有充分利用BERT模型的优势
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        架构设计问题
       </strong>
      </p>
      <ul>
       <li>
        各个模块之间耦合度高
       </li>
       <li>
        错误处理不够完善
       </li>
       <li>
        缺乏完整的测试机制
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="52__953">
     </a>
     5.2 改进方向
    </h4>
    <ol>
     <li>
      <strong>
       扩充训练数据
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">add_training_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentences<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""添加更多训练数据"""</span>
    self<span class="token punctuation">.</span>training_data<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>sentences<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>sentences<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       优化模型训练
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sentences<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""优化训练过程"""</span>
    self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 添加学习率调度</span>
        scheduler <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>lr_scheduler<span class="token punctuation">.</span>ReduceLROnPlateau<span class="token punctuation">(</span>self<span class="token punctuation">.</span>optimizer<span class="token punctuation">)</span>
        <span class="token comment"># 添加早停机制</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>should_early_stop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
</code></pre>
    <ol start="3">
     <li>
      <strong>
       改进知识检索
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""改进知识检索算法"""</span>
    <span class="token comment"># 添加语义相似度计算</span>
    <span class="token comment"># 使用向量检索</span>
    <span class="token comment"># 添加缓存机制</span>
</code></pre>
    <h3>
     <a id="_984">
     </a>
     六、总结与展望
    </h3>
    <h4>
     <a id="61__986">
     </a>
     6.1 项目总结
    </h4>
    <p>
     这个项目展示了如何构建一个基础的AI助手系统，并非一个实用的生产系统， 但作为学习案例具有很好的参考价值，它展示了：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        基础架构
       </strong>
      </p>
      <ul>
       <li>
        如何组织AI应用的基本结构
       </li>
       <li>
        如何处理用户输入和输出
       </li>
       <li>
        如何管理数据和模型
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        技术要点
       </strong>
      </p>
      <ul>
       <li>
        预训练模型的使用
       </li>
       <li>
        基本的模型训练流程
       </li>
       <li>
        文本处理的基本方法
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        改进空间
       </strong>
      </p>
      <ul>
       <li>
        模型训练需要优化
       </li>
       <li>
        系统架构需要重构
       </li>
       <li>
        功能需要聚焦
       </li>
      </ul>
     </li>
    </ol>
    <p>
     对于想要学习大模型技术的开发者来说，这个项目可以作为一个起点，但需要在此基础上进行大量的改进和优化才能成为一个实用的系统。
    </p>
    <h4>
     <a id="62__1008">
     </a>
     6.2 未来展望
    </h4>
    <ol>
     <li>
      引入更先进的模型架构
     </li>
     <li>
      优化系统性能
     </li>
     <li>
      增加更多实用功能
     </li>
     <li>
      改进用户体验
     </li>
    </ol>
    <h3>
     <a id="_1014">
     </a>
     七、参考资料
    </h3>
    <ol>
     <li>
      BERT论文：Attention Is All You Need
     </li>
     <li>
      Transformers库文档
     </li>
     <li>
      PyTorch官方文档
     </li>
     <li>
      Flask Web框架文档
     </li>
    </ol>
    <p>
     这篇博文全面介绍了项目的实现过程、技术细节和未来展望，适合作为技术学习资料。您可以根据需要调整内容的深度和广度。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7977656e6731382f:61727469636c652f64657461696c732f313436303739323736" class_="artid" style="display:none">
 </p>
</div>


