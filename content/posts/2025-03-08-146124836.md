---
layout: post
title: "TDengine-服务无法启动常见原因"
date: 2025-03-08 23:27:15 +0800
description: "taosd 是 TDengine 的核心服务进程，如果无法启动将导致整个数据库无法使用，了解常导致无法启动的原因，可以帮你快速解决问题。"
keywords: "taosdlog.1"
categories: ['未分类']
tags: ['时序数据库', '大数据', 'Tdengine']
artid: "146124836"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146124836
    alt: "TDengine-服务无法启动常见原因"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146124836
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146124836
cover: https://bing.ee123.net/img/rand?artid=146124836
image: https://bing.ee123.net/img/rand?artid=146124836
img: https://bing.ee123.net/img/rand?artid=146124836
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     TDengine 服务无法启动常见原因
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     taosd 是 TDengine 的核心服务进程，如果无法启动将导致整个数据库无法使用，了解常导致无法启动的原因，可以帮你快速解决问题。
    </p>
    <h2>
     1. 如何查找日志
    </h2>
    <p>
     无法启动的原因记录在日志中，日志文件默认在 /var/log/taos 的 taosdlog.0 或者 tasdlog.1 文件，当前使用的是哪个看最后修改日期。
    </p>
    <p>
     通常查看日志结尾为 ERROR 类日志即可快速查找出错误原因，可以使用以下脚本快速查找：
    </p>
    <blockquote>
     <p>
      <code>
       tail -n 1000 /var/log/taos/taosdlog.0 | grep ERROR
      </code>
     </p>
    </blockquote>
    <p>
    </p>
    <h2>
     2. 常见原因
    </h2>
    <h3>
     2.1 配置文件不正确
    </h3>
    <h4>
     1. FQDN 不正确
    </h4>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     示例在 taos.cfg 中的 fqdn 配置为一个不合法的名称： abcdef，启动 taosd 会失败，报如下错：
    </p>
    <p>
     <img alt="" height="242" src="https://i-blog.csdnimg.cn/direct/62816f54458746d5b4f671f9efaa26e8.png" width="2168"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     配置正确的 FQDN, 正确的 FQDN 必须是能 ping 通并显示的是预期 IP 地址。
    </p>
    <p>
     配置 fqdn 在 linux 是在 /etc/hosts 中。
    </p>
    <p>
     <span style="color:#fe2c24">
      注意：
     </span>
    </p>
    <p>
     <span style="color:#fe2c24">
      taos.cfg 中的 FQDN 只在 taosd 服务第一次启动时读取使用，启动成功后会保存 dataDir 指向的数据存储目录下的 dnode/dnode.json 文件中，下次再启动不再使用 taos.cfg 配置文件中，而会直接使用 dnode.json 中保存的 FQDN。
     </span>
    </p>
    <p>
    </p>
    <p>
     如果 dnode.json 已创建，若要修改 FQDN,需要 taos.cfg 及 dnode.json 两处都修改方可生效。
    </p>
    <h4>
     2. serverPort 不正确
    </h4>
    <p>
     示例在 taos.cfg 中的 serverPort 配置为一个超出范围的不合法端口：65539，启动 taosd 会失败，报如下错：
    </p>
    <p>
     <img alt="" height="256" src="https://i-blog.csdnimg.cn/direct/105767dd70c44e72a6c45999a2e6576a.png" width="1460"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     确保 serverPort 端口在指定范围内并且不被其它程序占用。
    </p>
    <p>
     <span style="color:#fe2c24">
      注意：
     </span>
    </p>
    <p>
     <span style="color:#fe2c24">
      serverPort 端口修改同上面 FQDN 相同
     </span>
    </p>
    <p>
    </p>
    <h4>
     3. dataDir 配置
    </h4>
    <p>
     dataDir 是配置数据库的存储目录，目录无访问权限或不可写会导致服务启动失败。
    </p>
    <h3>
     2.2 WAL 损坏
    </h3>
    <p>
     WAL 文件在数据写入过程中使用频繁，当突然断电再重启后最容易出现 WAL 损坏的现象。
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     <img alt="" height="285" src="https://i-blog.csdnimg.cn/direct/ef7a31c77053430b8ad1193b00566234.png" width="1280"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     把日志中提示损坏的 WAL 文件移出当前目录并备份到一个安全的地方，重新启动 taosd 即可。
    </p>
    <p>
     WAL 中记录着已落或未落盘的数据，移除 WAL 后可能会导致部分数据丢失。
    </p>
    <p>
     如果数据非常重要，联系涛思数据技术人员尝试修复损坏的 WAL 文件，但数据不一定能修复回来。
    </p>
    <h3>
     2.3 数据版本不兼容，如降版本操作
    </h3>
    <p>
     版本升级，老版本数据可以在新版本中完全兼容，但新版本数据在老版本中有可能会无法识别，以下是降版本后导致的 taosd 无法启动的现象：
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     <img alt="" height="256" src="https://i-blog.csdnimg.cn/direct/e5ff474e8dac4bb0904be6f5ac2cbb52.png" width="1565"/>
    </p>
    <p>
     上面的报错仅是其中一种，数据不兼容可能会报各种错误，识别的方式即看是否有降版本操作。
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     卸载老版本，再安装回原来版本即可。
    </p>
    <p>
    </p>
    <h3>
     2.4 端口被占用
    </h3>
    <p>
     taosd 启动过程中，taos.cfg 中的 serverPort 端口被其它程序占用后，会导致启动失败。
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     如下是指定的 serverPort 为 9100 的端口被其它应用占用：
    </p>
    <p>
     <img alt="" height="256" src="https://i-blog.csdnimg.cn/direct/9cb2c02f2b1c44c9ba84f906d0fa2fb7.png" width="1322"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     更换其它未使用的端口或停止占用端口的应用均可解决
    </p>
    <h3>
     2.5 dataDir 损坏
    </h3>
    <p>
     在突然断电或关机的情况下，可能会导致正在写入数据损坏，再启动 taosd 服务时，会遇到无法启动的现象
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     以下示例是数据文件 v2f1736ver3.data 丢失，导致 taosd 无法启动
    </p>
    <p>
     <img alt="" height="256" src="https://i-blog.csdnimg.cn/direct/fc61d5cf763e469f8e311a91782071aa.png" width="1433"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     如果数据非常重要，联系涛思数据技术人员尝试修复损坏的文件。
    </p>
    <p>
     如果只是测试数据，仅想把 taosd 启动起来，可以根据报错的文件，删除报错文件所在 vnode 目录下的 tsdb 目录即可。如上例中，删除 /var/lib/taos/vnode/vnode2/tsdb 目录，即可重新启动 taosd。
    </p>
    <p>
    </p>
    <h3>
     2.6 磁盘空间不足
    </h3>
    <p>
     TDengine 当存放数据磁盘空间小于 2G 时，会拒绝写入请求并告警磁盘空间不足，此时 taosd 服务仍然可以正常启动和工作，当磁盘空间继续减小，全部被占满后，taosd 服务将无法再启动。
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     <img alt="" height="256" src="https://i-blog.csdnimg.cn/direct/6ece380a1d8f4b35a7ee25e663a24642.png" width="1302"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     清理出磁盘空间或增加磁盘
    </p>
    <h3>
     2.7 已有实例运行
    </h3>
    <p>
     taosd 服务是单进程工作模式，一台机器上只允许运行一个实例，如果前面已有实例在运行，再启动新实例会报启动失败错误，提示日志为尝试多次锁定 .running 失败，如下：
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     <img alt="" height="308" src="https://i-blog.csdnimg.cn/direct/fc462270aaee4164ad3d24c62c7ddee3.png" width="1280"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     ps aux | grep taosd 查看具体占用实例进程，KILLL 后再启动即可
    </p>
    <p>
    </p>
    <h3>
     2.8 正在数据同步
    </h3>
    <p>
     启动 taosd 后，日志长时间显示进行 restore ，无法进入服务状态。
    </p>
    <p>
     这个现象一般出现在集群中，当集群中某个节点上的 taosd 服务停止了一段时间，集群正在大量写入数据中，再启动已停止的节点时会出现此现象。
    </p>
    <p>
     原因是在做数据同步，停止节点上的数据和正在运行集群中的数据有了一段差距，需要更新到与集群数据相同才可接入集群。
    </p>
    <p>
     当需要同步数据比较多时，启动时间就会比较长，日志如下：
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     <img alt="" height="611" src="https://i-blog.csdnimg.cn/direct/9b94dfd11f9941faa117911c2ea9d692.png" width="1280"/>
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <ol>
     <li>
      <p>
       等待，等到与集群数据同步后即会进入服务状态
      </p>
     </li>
     <li>
      <p>
       如果集群仍在大量数据写入，可以暂停集群数据写入，让落后节点尽快赶上来，再启动集群数据写入。
      </p>
     </li>
    </ol>
    <h3>
     2.9不支持的平台
    </h3>
    <p>
     TDengine 服务端支持平台列表如下， 非列表中的平台，服务启动会报 0x8000013A 错误，表示不支持此平台。
    </p>
    <p>
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <br/>
        版本
       </td>
       <td>
        X64 64bit
       </td>
       <td>
        ARM64
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        CentOS
       </td>
       <td>
        7.9 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        Ubuntu
       </td>
       <td>
        18 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        RedHat
       </td>
       <td>
        RHEL 7 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        Debian
       </td>
       <td>
        6.0 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        FreeBSD
       </td>
       <td>
        12 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        OpenSUSE
       </td>
       <td>
        全部版本
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        SUSE Linux
       </td>
       <td>
        11 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        Fedora
       </td>
       <td>
        21 以上
       </td>
       <td>
        ●
       </td>
       <td>
        ●
       </td>
      </tr>
      <tr>
       <td>
        Windows Server
       </td>
       <td>
        2016 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        Windows
       </td>
       <td>
        10月11日
       </td>
       <td>
        ●/E
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        银河麒麟
       </td>
       <td>
        V10 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
        ●/E
       </td>
      </tr>
      <tr>
       <td>
        中标麒麟
       </td>
       <td>
        V7.0 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
        ●/E
       </td>
      </tr>
      <tr>
       <td>
        统信 UOS
       </td>
       <td>
        V20 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        凝思磐石
       </td>
       <td>
        V8.0 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        华为欧拉 openEuler
       </td>
       <td>
        V20.03 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        龙蜥 Anolis OS
       </td>
       <td>
        V8.6 以上
       </td>
       <td>
        ●/E
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        macOS
       </td>
       <td>
        11.0 以上
       </td>
       <td>
       </td>
       <td>
        ●
       </td>
      </tr>
     </tbody>
    </table>
    <p>
    </p>
    <p>
     注：
    </p>
    <p>
     1) ● 表示经过官方测试验证， ○ 表示非官方测试验证，E 表示仅企业版支持。
    </p>
    <p>
     2) 社区版仅支持主流操作系统的较新版本，包括 Ubuntu 18+/CentOS 7+/CentOS Stream/RedHat/Debian/CoreOS/FreeBSD/OpenSUSE/SUSE Linux/Fedora/macOS 等。
    </p>
    <p>
    </p>
    <p>
    </p>
    <h2>
     访问官网
    </h2>
    <p>
     更多内容欢迎访问
     <a class="link-info" href="https://www.taosdata.com/?utm_source=web&amp;utm_medium=all-staff&amp;utm_campaign=2025-01-12" rel="nofollow" title="TDengine 官网">
      TDengine 官网
     </a>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f7469636b7469636b3939392f:61727469636c652f64657461696c732f313436313234383336" class_="artid" style="display:none">
 </p>
</div>


