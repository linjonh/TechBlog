---
layout: post
title: "Python-3-输出重定向使用CC"
date: 2023-10-27 16:44:40 +0800
description: "Python 3 输出重定向使用C/C++By:gddsky 目标希望将Python 3的输出重定向"
keywords: "在c++里python重定向输出到textedit"
categories: ['小玩意儿']
tags: ['脚本', 'Python', 'Null', 'Module', 'Methods', 'Import']
artid: "5006061"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=5006061
    alt: "Python-3-输出重定向使用CC"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=5006061
featuredImagePreview: https://bing.ee123.net/img/rand?artid=5006061
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python 3 输出重定向使用C/C++
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p align="center" class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: center;">
     <span style="font-size: small;">
      <strong style="mso-bidi-font-weight: normal;">
       <span lang="EN-US">
        <span style="font-family: Times New Roman;">
         Python 3
        </span>
       </span>
      </strong>
      <strong style="mso-bidi-font-weight: normal;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        输出重定向使用
       </span>
       <span lang="EN-US">
        <span style="font-family: Times New Roman;">
         C/C++
        </span>
       </span>
      </strong>
     </span>
    </p>
    <p align="right" class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: right;">
     <strong style="mso-bidi-font-weight: normal;">
      <span lang="EN-US">
       <span style="font-size: small;">
        <span style="font-family: Times New Roman;">
         By:gddsky
        </span>
       </span>
      </span>
     </strong>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <strong style="mso-bidi-font-weight: normal;">
      <span style="font-size: small;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        目标
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </strong>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-size: small;">
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       希望将
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        Python 3
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       的输出重定向到自定义的输出目标。
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <strong style="mso-bidi-font-weight: normal;">
      <span style="font-size: small;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        核心
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </strong>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-size: small;">
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        Python
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       使用
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        sys.stdout
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       、
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        sys.stderr
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       做输出目标，只要我们替换这两个值就可以重定向到我们自定义目标。替换的值的规则在
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        Python
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       的文档中
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        sys (module)
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       的
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        sys.stdout
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       上面说明只要添加一个
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        write
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       函数就可以了。像这样：
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
       write(self, str)
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
      <span style="font-size: small;">
       我们只要在这个函数里面调用我们自己的输出函数就可以实现该目标了。
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <strong style="mso-bidi-font-weight: normal;">
      <span style="font-size: small;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        方案
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </strong>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-size: small;">
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       在
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        C++
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       中写一个
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        Python
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       模块，并导入
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-size: small;">
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       在
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        C++
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       中利用
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        PyRun_SimpleString
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       建立一个
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        PyObject
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       去替换原始的
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        sys.stdout
       </span>
      </span>
      <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
       、
      </span>
      <span lang="EN-US">
       <span style="font-family: Times New Roman;">
        sys.stderr
       </span>
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
      <span style="font-size: small;">
       搞定！！！
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <strong style="mso-bidi-font-weight: normal;">
      <span style="font-size: small;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        代码
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </strong>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-size: small;">
      <span style="text-decoration: underline;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        模块定义部分代码（用
       </span>
       <span lang="EN-US">
        <span style="font-family: Times New Roman;">
         python demo
        </span>
       </span>
      </span>
      <span style="text-decoration: underline;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        下的例子改写的）
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; color: blue; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      static
     </span>
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="color: #010001;">
       PyObject
      </span>
      *
      <span style="color: #010001;">
       console_write
      </span>
      (
      <span style="color: #010001;">
       PyObject
      </span>
      *
      <span style="color: #010001;">
       self
      </span>
      ,
      <span style="color: #010001;">
       PyObject
      </span>
      *
      <span style="color: #010001;">
       args
      </span>
      )
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: blue;">
       if
      </span>
      (
      <span style="color: #010001;">
       s_pyConsoleNotify
      </span>
      !=
      <span style="color: #010001;">
       NULL
      </span>
      )
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: blue;">
       const
      </span>
      <span style="color: blue;">
       char
      </span>
      *
      <span style="color: #010001;">
       pMsgString
      </span>
      =0;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: blue;">
       if
      </span>
      (!
      <span style="color: #010001;">
       PyArg_ParseTuple
      </span>
      (
      <span style="color: #010001;">
       args
      </span>
      ,
      <span style="color: #a31515;">
       "s"
      </span>
      , &amp;
      <span style="color: #010001;">
       pMsgString
      </span>
      ))
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 3;">
      </span>
      <span style="color: blue;">
       return
      </span>
      <span style="color: #010001;">
       NULL
      </span>
      ;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; color: red; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="background: yellow; mso-highlight: yellow;">
       //
      </span>
     </span>
     <span style="font-size: 10pt; background: yellow; color: red; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes; mso-highlight: yellow;">
      我们自己的输出函数
     </span>
     <span lang="EN-US" style="font-size: 10pt; color: red; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #010001;">
       myprint(pMsgString);
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       Py_INCREF
      </span>
      (
      <span style="color: #010001;">
       Py_None
      </span>
      );
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: blue;">
       return
      </span>
      <span style="color: #010001;">
       Py_None
      </span>
      ;
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      }
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; color: blue; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      static
     </span>
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="color: #010001;">
       PyMethodDef
      </span>
      <span style="color: #010001;">
       console_methods
      </span>
      [] = {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
      <span style="color: #a31515;">
       "test"
      </span>
      ,
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #010001;">
       console_test
      </span>
      ,
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       METH_NOARGS
      </span>
      ,
      <span style="color: #a31515;">
       "Return the meaning of everything."
      </span>
      },
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
      <span style="color: #a31515;">
       "write"
      </span>
      ,
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       console_write
      </span>
      ,
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       METH_VARARGS
      </span>
      ,
      <span style="color: #010001;">
       NULL
      </span>
      },
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      {
      <!-- -->
      <span style="color: #010001;">
       NULL
      </span>
      ,
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #010001;">
       NULL
      </span>
      }
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: green;">
       /* sentinel */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      };
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; color: blue; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      static
     </span>
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="color: blue;">
       struct
      </span>
      <span style="color: #010001;">
       PyModuleDef
      </span>
      <span style="color: #010001;">
       consolemodule
      </span>
      = {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      {},
      <span style="color: green;">
       /* m_base */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #a31515;">
       "console_capi"
      </span>
      ,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_name */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      0,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_doc */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      0,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_size */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       console_methods
      </span>
      ,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_methods */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      0,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_reload */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      0,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_traverse */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      0,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_clear */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      0,
      <span style="mso-spacerun: yes;">
      </span>
      <span style="color: green;">
       /* m_free */
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      };
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      PyObject
     </span>
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      *
      <span style="color: #010001;">
       PyInit_console
      </span>
      (
      <span style="color: blue;">
       void
      </span>
      )
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: blue;">
       return
      </span>
      <span style="color: #010001;">
       PyModule_Create
      </span>
      (&amp;
      <span style="color: #010001;">
       consolemodule
      </span>
      );
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      }
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span style="font-size: small;">
      <span style="text-decoration: underline;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        用
       </span>
       <span lang="EN-US">
        <span style="font-family: Times New Roman;">
         C++
        </span>
       </span>
      </span>
      <span style="text-decoration: underline;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        执行的
       </span>
       <span lang="EN-US">
        <span style="font-family: Times New Roman;">
         Python
        </span>
       </span>
      </span>
      <span style="text-decoration: underline;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        代码
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      void myOutput()
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      {
      <!-- -->
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       PyImport_AppendInittab
      </span>
      (
      <span style="color: #a31515;">
       "console_capi"
      </span>
      ,
      <span style="color: #010001;">
       PyInit_console
      </span>
      );
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       Py_Initialize
      </span>
      ();
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 1;">
      </span>
      <span style="color: #010001;">
       PyRun_SimpleString
      </span>
      (
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "import sys/n"
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "import console_capi/n"
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "class XConsole:/n"
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "
       <span style="mso-tab-count: 1;">
       </span>
       def write(self, s):/n"
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "
       <span style="mso-tab-count: 2;">
       </span>
       console_capi.write(s)/n"
      </span>
      <span style="color: gray;">
       <span style="mso-tab-count: 1;">
       </span>
      </span>
      <span style="background: yellow; color: red; mso-highlight: yellow;">
       //
      </span>
     </span>
     <span style="font-size: 10pt; background: yellow; color: red; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes; mso-highlight: yellow;">
      这里将输出信息转给
      <span lang="EN-US">
       console_write
      </span>
      函数
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "myconsole = XConsole()/n"
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "sys.stdout = myconsole/n"
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; text-align: left; mso-line-height-rule: exactly; mso-layout-grid-align: none;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      <span style="color: #a31515;">
       "sys.stderr = myconsole"
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; mso-line-height-rule: exactly;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      <span style="mso-tab-count: 2;">
      </span>
      );
     </span>
     <span lang="EN-US" style="font-family: 宋体;">
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 12pt; mso-line-height-rule: exactly;">
     <span lang="EN-US" style="font-family: 宋体;">
      <span style="font-size: small;">
       }
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <span lang="EN-US">
      <span style="font-size: small; font-family: Times New Roman;">
      </span>
     </span>
    </p>
    <p class="MsoNormal" style="margin: 0cm 0cm 0pt;">
     <strong style="mso-bidi-font-weight: normal;">
      <span style="font-size: small;">
       <span style="font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman';">
        经验
       </span>
       <span lang="EN-US">
       </span>
      </span>
     </strong>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt 21pt; text-indent: -21pt; text-align: left; mso-layout-grid-align: none; mso-list: l0 level1 lfo1; tab-stops: list 21.0pt;">
     <span lang="EN-US" style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes; mso-bidi-font-family: 宋体;">
      <span style="mso-list: Ignore;">
       1.
       <span style='font: 7pt "Times New Roman";'>
       </span>
      </span>
     </span>
     <span style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      用
      <span lang="EN-US">
       PyArg_ParseTuple
      </span>
      函数做参数解析，怎么都是错误的，最后才发现原来是因为
      <span lang="EN-US">
       python
      </span>
      的脚本里面写的
      <span lang="EN-US">
       console_capi.write(
      </span>
     </span>
     <span lang="EN-US" style="font-size: 10pt; color: red; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      self
     </span>
     <span lang="EN-US" style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      , s)
     </span>
     <span style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      ，以为
      <span lang="EN-US">
       console_write
      </span>
     </span>
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      (
      <span style="color: #010001;">
       PyObject
      </span>
      *
      <span style="color: #010001;">
       self
      </span>
      ,
      <span style="color: #010001;">
       PyObject
      </span>
      *
      <span style="color: #010001;">
       args
      </span>
      )
     </span>
     <span style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      的
      <span lang="EN-US">
       self
      </span>
      就是由脚本中的这个
      <span lang="EN-US">
       self
      </span>
      传进来了，结果这个
      <span lang="EN-US">
       self
      </span>
      与脚本的
      <span lang="EN-US">
       self
      </span>
      不一样，它是
      <span lang="EN-US">
       module
      </span>
      的
      <span lang="EN-US">
       PyObject
      </span>
      ，将
      <span lang="EN-US" style="color: #010001;">
       console_capi.write(
      </span>
      <span lang="EN-US" style="color: red;">
       self
      </span>
      <span lang="EN-US" style="color: #010001;">
       , s)
      </span>
      <span style="color: #010001;">
       改成
       <span lang="EN-US">
        console_capi.write(s)
       </span>
       之后，解析就对了。
       <span lang="EN-US">
       </span>
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt 21pt; text-indent: -21pt; text-align: left; mso-layout-grid-align: none; mso-list: l0 level1 lfo1; tab-stops: list 21.0pt;">
     <span lang="EN-US" style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes; mso-bidi-font-family: 宋体;">
      <span style="mso-list: Ignore;">
       2.
       <span style='font: 7pt "Times New Roman";'>
       </span>
      </span>
     </span>
     <span style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      在
      <span lang="EN-US">
       C++
      </span>
      中，可以看
      <span lang="EN-US">
       PyObject
      </span>
      结构，里面有一个
      <span lang="EN-US">
       ob_type.tp_name
      </span>
      的值，它直接显示这个
      <span lang="EN-US">
       Object
      </span>
      是什么类型，比如说
      <span lang="EN-US">
       module
      </span>
      、
      <span lang="EN-US">
       str
      </span>
      、
      <span lang="EN-US">
       tuple
      </span>
      ，这个值让我们可以很方便的得到这个
      <span lang="EN-US">
       Object
      </span>
      的类型，调试比较方便。
      <span lang="EN-US">
      </span>
     </span>
    </p>
    <p align="left" class="MsoNormal" style="margin: 0cm 0cm 0pt 21pt; text-indent: -21pt; text-align: left; mso-layout-grid-align: none; mso-list: l0 level1 lfo1; tab-stops: list 21.0pt;">
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes; mso-bidi-font-family: 宋体;">
      <span style="mso-list: Ignore;">
       3.
       <span style='font: 7pt "Times New Roman";'>
       </span>
      </span>
     </span>
     <span style="font-size: 10pt; color: #010001; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
      一些问题实在麻烦，可以考虑直接下
      <span lang="EN-US">
       source
      </span>
      版本编译
      <span lang="EN-US">
       Debug
      </span>
      来调试，有些问题处理还是比较方便。
     </span>
     <span lang="EN-US" style="font-size: 10pt; font-family: 宋体; mso-font-kerning: 0pt; mso-no-proof: yes;">
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874:7470733a2f2f626c6f672e6373646e2e6e65742f676464736b:792f61727469636c652f64657461696c732f35303036303631" class_="artid" style="display:none">
 </p>
</div>


