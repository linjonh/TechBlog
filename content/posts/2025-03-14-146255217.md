---
layout: post
title: "WPF-Prism模块加载-1.Appconfig的配置方式"
date: 2025-03-14 13:56:09 +0800
description: "这行 XML 代码的作用是对一个名为的.NET 模块进行配置，该模块对应程序集，在应用程序启动时会被加载。"
keywords: "WPF Prism模块加载 1.Appconfig的配置方式"
categories: ['Wpf', 'Prism']
tags: ['Wpf']
artid: "146255217"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146255217
    alt: "WPF-Prism模块加载-1.Appconfig的配置方式"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146255217
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146255217
cover: https://bing.ee123.net/img/rand?artid=146255217
image: https://bing.ee123.net/img/rand?artid=146255217
img: https://bing.ee123.net/img/rand?artid=146255217
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     WPF Prism模块加载 1.Appconfig的配置方式
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在使用Prism框架构建模块化WPF应用程序时，可以通过多种方式加载模块。其中一种方法是通过手动配置app.config文件来定义模块。这种方法允许你在不修改代码的情况下添加或移除模块，提高了灵活性和可维护性。
    </p>
    <p>
     手动配置 app.config 加载 Prism 模块的步骤
    </p>
    <h4>
     <a id="1_NuGet_3">
     </a>
     1. 添加必要的NuGet包
    </h4>
    <p>
     确保你的项目中包含了以下NuGet包：
    </p>
    <p>
     Prism.Unity 或其他你选择的依赖注入容器（如 Prism.DryIoc, Prism.Unity, 等）。
     <br/>
     Prism.Wpf
    </p>
    <h4>
     <a id="2__appconfig_8">
     </a>
     2. 配置 app.config
    </h4>
    <p>
     你需要在项目的 app.config 文件中配置模块信息。下面是一个示例配置：
    </p>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modules<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Microsoft.Practices.Composite.Modularity.ModulesConfigurationSection, Microsoft.Practices.Prism<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span> <span class="token attr-name">assemblyFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Modules/ModuleA.dll<span class="token punctuation">"</span></span> <span class="token attr-name">moduleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ModuleA.ModuleAModule, ModuleA<span class="token punctuation">"</span></span> <span class="token attr-name">moduleName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ModuleA<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span> <span class="token attr-name">assemblyFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Modules/ModuleB.dll<span class="token punctuation">"</span></span> <span class="token attr-name">moduleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ModuleB.ModuleBModule, ModuleB<span class="token punctuation">"</span></span> <span class="token attr-name">moduleName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ModuleB<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     在这个配置中，每个元素代表一个要加载的模块。assemblyFile属性指定了模块程序集的相对路径，moduleType属性指定了模块类的完整名称（包括命名空间），而moduleName则是该模块的唯一标识符。
    </p>
    <h4>
     <a id="3__26">
     </a>
     3. 创建模块类
    </h4>
    <p>
     为每个模块创建一个实现IModule接口的类。例如，对于上面提到的ModuleA，你可以创建如下类：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>Modularity</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>Regions</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ModuleA</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModuleAModule</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IModule</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRegionManager</span> _regionManager<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">ModuleAModule</span><span class="token punctuation">(</span><span class="token class-name">IRegionManager</span> regionManager<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _regionManager <span class="token operator">=</span> regionManager<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnInitialized</span><span class="token punctuation">(</span><span class="token class-name">IContainerProvider</span> containerProvider<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 初始化逻辑</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterTypes</span><span class="token punctuation">(</span><span class="token class-name">IContainerRegistry</span> containerRegistry<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 注册服务等</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="4_Appxamlcs_56">
     </a>
     4. 修改App.xaml.cs以支持从配置文件加载模块
    </h4>
    <p>
     你需要重写App.xaml.cs中的ConfigureModuleCatalog方法，以便从app.config读取模块信息并加载它们。这里有一个例子：
    </p>
    <pre><code class="prism language-csharp">  <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PrismApplication</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Window</span> <span class="token function">CreateShell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> Container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MainWindow<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterTypes</span><span class="token punctuation">(</span><span class="token class-name">IContainerRegistry</span> containerRegistry<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">IModuleCatalog</span> <span class="token function">CreateModuleCatalog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConfigurationModuleCatalog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     在这个示例中，我们首先获取了app.config中的modules部分，然后遍历所有模块元素，并将这些信息添加到ModuleCatalog中。
    </p>
    <h4>
     <a id="5__79">
     </a>
     5. 运行应用
    </h4>
    <p>
     现在当你运行应用程序时，它会根据app.config中的配置自动加载指定的模块。
     <br/>
     这种方式使得模块管理更加灵活，因为你可以不用修改代码就能增删模块。这对于需要频繁更新或扩展的应用程序特别有用。同时，这也是一种良好的实践，因为它遵循了关注点分离的原则，使得模块管理和业务逻辑相互独立。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span> <span class="token attr-name">assemblyFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Modules/ModuleA.dll<span class="token punctuation">"</span></span> <span class="token attr-name">moduleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ModuleA.ModuleAModule, ModuleA<span class="token punctuation">"</span></span> <span class="token attr-name">moduleName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ModuleA<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     这行代码是一个 XML 元素，一般用于配置文件里对.NET 模块进行描述，下面来详细解释其中各个属性：
    </p>
    <h4>
     <a id="_90">
     </a>
     整体结构
    </h4>
    <p>
     此 XML 元素属于
     <code>
      &lt;module&gt;
     </code>
     类型，它代表一个.NET 模块的配置信息。
    </p>
    <h4>
     <a id="_93">
     </a>
     属性解释
    </h4>
    <ol>
     <li>
      <strong>
       <code>
        assemblyFile
       </code>
      </strong>
      ：
      <ul>
       <li>
        此属性的值为
        <code>
         "ModuleA.dll"
        </code>
        ，表明该模块所对应的程序集文件是
        <code>
         ModuleA.dll
        </code>
        。在.NET 里，程序集属于一个自包含的部署单元，包含类型、资源等信息。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        moduleType
       </code>
      </strong>
      ：
      <ul>
       <li>
        属性值
        <code>
         "ModuleA.ModuleAModule, ModuleA, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"
        </code>
        给出了模块的完整类型名称以及相关程序集的详细信息。
       </li>
       <li>
        <code>
         ModuleA.ModuleAModule
        </code>
        是模块的具体类型名称。
       </li>
       <li>
        <code>
         ModuleA
        </code>
        是程序集的名称。
       </li>
       <li>
        <code>
         Version=1.0.0.0
        </code>
        指明程序集的版本号为
        <code>
         1.0.0.0
        </code>
        。
       </li>
       <li>
        <code>
         Culture=neutral
        </code>
        意味着这个程序集不特定于某一种文化或区域设置。
       </li>
       <li>
        <code>
         PublicKeyToken=null
        </code>
        表示该程序集没有强名称，也就是没有经过数字签名。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        moduleName
       </code>
      </strong>
      ：
      <ul>
       <li>
        属性值为
        <code>
         "ModuleAModule"
        </code>
        ，它为该模块提供了一个友好的名称，方便在配置文件里引用与识别。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        startupLoaded
       </code>
      </strong>
      ：
      <ul>
       <li>
        属性值是
        <code>
         "True"
        </code>
        ，这表明在应用程序启动的时候，该模块会被加载。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_108">
     </a>
     总结
    </h4>
    <p>
     这行 XML 代码的作用是对一个名为
     <code>
      ModuleAModule
     </code>
     的.NET 模块进行配置，该模块对应
     <code>
      ModuleA.dll
     </code>
     程序集，在应用程序启动时会被加载。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343936373231332f:61727469636c652f64657461696c732f313436323535323137" class_="artid" style="display:none">
 </p>
</div>


