---
layout: post
title: 微信小程序系列二小程序常用功能跳转地图扫一扫人脸识别拍照拨打电话调整屏幕亮度文字可复制监听截屏...
date: 2022-10-24 11:39:18 +0800
description: "(～￣▽￣)～，hello，微信小程序系列第二篇，介绍"
keywords: 小程序跳转地图导航
categories: ['微信小程序与Uniapp', '前端大杂烩']
tags: ['拍照', '微信小程序', '前端', '人脸识别', '1024程序员节']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=127486163
    alt: 微信小程序系列二小程序常用功能跳转地图扫一扫人脸识别拍照拨打电话调整屏幕亮度文字可复制监听截屏...
artid: 127486163
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=127486163
featuredImagePreview: https://bing.ee123.net/img/rand?artid=127486163
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【微信小程序系列：二】小程序常用功能：跳转地图、扫一扫、人脸识别、拍照、拨打电话、调整屏幕亮度、文字可复制、监听截屏...
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     一.先言：
    </h3>
    <p>
     (～￣▽￣)～，hello，微信小程序系列第二篇，介绍下小程序里的
     <strong>
      前端常用功能api
     </strong>
     ，可以快速copy使用~
    </p>
    <h3>
     <a id="_3">
     </a>
     二.文字可复制：
    </h3>
    <p>
     小程序页面里的文字默认是没有长按复制功能的，需要套个标签来实现：
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/text.html" rel="nofollow">
      跳转官方文档
     </a>
    </p>
    <pre><code class="prism language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">user-select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{<!-- -->{true}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>哈哈<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     点击按钮，直接复制文本，直接调用微信方法：
    </p>
    <pre><code class="prism language-javascript">  wx<span class="token punctuation">.</span><span class="token function">setClipboardData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'要复制文本，可用变量表示'</span> <span class="token punctuation">,</span>
         <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
               wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                 <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'复制成功'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">"none"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">mask</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token comment">//是否设置点击蒙版，防止点击穿透</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_27">
     </a>
     三.跳转地图：
    </h3>
    <p>
     有时显示一些地址需要在地图显示，这时可以直接借助跳转到小程序内置腾讯地图的api，直接自定义一个点击方法，然后在里面调用下面这个就行：
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.openLocation.html" rel="nofollow">
      跳转官方文档
     </a>
    </p>
    <pre><code class="prism language-javascript">    wx<span class="token punctuation">.</span><span class="token function">openLocation</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">longitude</span><span class="token operator">:</span>  <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//纬度     必填</span>
        <span class="token literal-property property">latitude</span><span class="token operator">:</span>  <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//经度     必填</span>
        <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token comment">//地址的详细说明</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">''</span><span class="token comment">//位置名</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre>
    <p>
     效果如：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5d637377122c67887d080317391ee719.png#pic_center"/>
    </p>
    <h3>
     <a id="_40">
     </a>
     四.扫一扫：
    </h3>
    <p>
     有时候会调用扫码功能，就是相当于微信的扫一扫，扫码获取码值后进行相应操作。
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/device/scan/wx.scanCode.html" rel="nofollow">
      官方文档
     </a>
    </p>
    <pre><code class="prism language-javascript">    wx<span class="token punctuation">.</span><span class="token function">scanCode</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">onlyFromCamera</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 是否只能从相机扫码，不允许从相册选择图片</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"扫码成功："</span><span class="token operator">+</span>  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token comment">//码值</span>
         <span class="token keyword">let</span> codeResult <span class="token operator">=</span> res<span class="token punctuation">.</span>result
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">// Toast('无法识别该二维码')</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_57">
     </a>
     五.拨打电话：
    </h3>
    <p>
     实现点击小程序某个按钮时，直接跳到手机拨打电话界面，且号码自动输入好，直接调下面方法就好。
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/device/phone/wx.makePhoneCall.html" rel="nofollow">
      官方文档
     </a>
    </p>
    <pre><code class="prism language-javascript">  wx<span class="token punctuation">.</span><span class="token function">makePhoneCall</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>   
      <span class="token literal-property property">phoneNumber</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      <span class="token comment">//需要拨打的电话号码</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>         
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"拨打电话成功！"</span><span class="token punctuation">)</span>      
      <span class="token punctuation">}</span><span class="token punctuation">,</span>      
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>        
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"拨打电话失败！"</span><span class="token punctuation">)</span>      
      <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span><span class="token punctuation">)</span>  
</code></pre>
    <h3>
     <a id="_71">
     </a>
     六.调整屏幕亮度：
    </h3>
    <p>
     有时跳到小程序某个页面时，比如有二维码的页面，想要手机屏幕可以高亮度显示，怕用户看不清。注意的是，先把原先手机屏幕亮度在变量保存下来，当离开这个页面，要恢复原亮度，可在onUnload生命周期恢复。
    </p>
    <pre><code class="prism language-javascript">    <span class="token comment">// 获取屏幕亮度</span>
    wx<span class="token punctuation">.</span><span class="token function">getScreenBrightness</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">ScreenBrightness</span><span class="token operator">:</span> res<span class="token punctuation">.</span>value <span class="token comment">//先把原先手机屏幕亮度在变量保存下来</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">//设置屏幕亮度</span>
    wx<span class="token punctuation">.</span><span class="token function">setScreenBrightness</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment">//屏幕亮度值，范围 0~1，0 最暗，1 最亮</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_89">
     </a>
     七.监听截屏：
    </h3>
    <p>
     当用户用手机自带的截屏功能截屏的时候，可以监听到并显示个提示文字或其它操作啥的。
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/device/screen/wx.onUserCaptureScreen.html" rel="nofollow">
      官方文档
     </a>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">//监听截屏事件</span>
wx<span class="token punctuation">.</span><span class="token function">onUserCaptureScreen</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">Toast</span><span class="token punctuation">(</span><span class="token string">'截屏成功，请不要将清远码交给他人'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_98">
     </a>
     八.人脸识别：
    </h3>
    <p>
     先得开通业务，然后代码直接调微信api方法即可，简单引用如下：
     <a href="https://developers.weixin.qq.com/community/business/doc/000442d352c1202bd498ecb105c00d" rel="nofollow">
      官方文档
     </a>
    </p>
    <pre><code class="prism language-javascript">   <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
    wx<span class="token punctuation">.</span><span class="token function">startFacialRecognitionVerify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token comment">//身份证姓名</span>
      <span class="token literal-property property">idCardNumber</span><span class="token operator">:</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>idCard<span class="token punctuation">,</span> <span class="token comment">//身份证号码</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>errCode <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>errMsg <span class="token operator">===</span> <span class="token string">"startFacialRecognitionVerify:ok"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">var</span> verifyResult <span class="token operator">=</span> res<span class="token punctuation">.</span>verifyResult<span class="token punctuation">;</span> <span class="token comment">//认证结果</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>verifyResult<span class="token punctuation">,</span> <span class="token string">'认证结果'</span><span class="token punctuation">)</span>
          <span class="token comment">// 认证成功</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">checkAliveType</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//屏幕闪烁(人脸核验的交互方式，默认0,读数字)</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">'err'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_121">
     </a>
     九.拍照：
    </h3>
    <p>
     有两种方法，一种是调用调用wx.chooseImage方法，一种是camera标签自定义拍照页。
    </p>
    <p>
     wx.chooseImage(Object object) ，调用后可以直接
     <strong>
      相机拍照，也支持从相册选择
     </strong>
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html" rel="nofollow">
      官方文档
     </a>
    </p>
    <pre><code class="prism language-javascript">wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sizeType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'original'</span><span class="token punctuation">,</span> <span class="token string">'compressed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">,</span> <span class="token string">'camera'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// tempFilePath可以作为 img 标签的 src 属性显示图片</span>
    <span class="token keyword">const</span> tempFilePaths <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths
     <span class="token comment">//小知识： 将图片转为base64</span>
        <span class="token keyword">const</span> picBase64 <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     camera标签就比较神奇，系统相机，可以自定义拍照页面，比如可以在相机拍摄页面加个蒙版框框啥的，可以
     <strong>
      自定义拍摄页面样式
     </strong>
     。
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/camera.html" rel="nofollow">
      官方文档
     </a>
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>camera</span> <span class="token attr-name">device-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>back<span class="token punctuation">"</span></span> <span class="token attr-name">flash</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span> <span class="token attr-name">binderror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>camera</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>takePhoto<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>拍照<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>预览<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>widthFix<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{<!-- -->{src}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-javascript"><span class="token comment">// camera.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">takePhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCameraContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    ctx<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token string">'high'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">src</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempImagePath
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_171">
     </a>
     后续补充：
    </h3>
    <h3>
     <a id="1_172">
     </a>
     1.提示小程序版本更新：
    </h3>
    <p>
     在app.js文件添加：
     <a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/update/UpdateManager.html" rel="nofollow">
      文档
     </a>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> updateManager <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getUpdateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

updateManager<span class="token punctuation">.</span><span class="token function">onCheckForUpdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 请求完新版本信息的回调</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>hasUpdate<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

updateManager<span class="token punctuation">.</span><span class="token function">onUpdateReady</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'更新提示'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'新版本已经准备好，是否重启应用？'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span>
        updateManager<span class="token punctuation">.</span><span class="token function">applyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

updateManager<span class="token punctuation">.</span><span class="token function">onUpdateFailed</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 新版本下载失败</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="2__200">
     </a>
     2. 打开显示一个网页
    </h3>
    <p>
     要跳转的网页都得在它那服务器配置过才有权限跳。新建一个文件夹，包括wxml、wxss、json、js四个基本文件，专门用来打开网页链接的，改动其中wxml内容为：
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>web<span class="token operator">-</span>view src<span class="token operator">=</span><span class="token string">"{<!-- -->{path}}"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>web<span class="token operator">-</span>view<span class="token operator">&gt;</span>
</code></pre>
    <p>
     path为网页的地址，这样就行了，就这么简单。
    </p>
    <h3>
     <a id="3__208">
     </a>
     3. 显示富文本内容
    </h3>
    <p>
     微信小程序的富文本主要在rich-text标签显示：
    </p>
    <pre><code class="prism language-javascript">  <span class="token operator">&lt;</span>rich<span class="token operator">-</span>text  nodes<span class="token operator">=</span><span class="token string">"{<!-- -->{notice}}"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>rich<span class="token operator">-</span>text<span class="token operator">&gt;</span>
</code></pre>
    <p>
     notice为文本内容。
    </p>
    <p>
     <strong>
      小知识：
     </strong>
     其中，有些富文本的图片比较大，可以用replace替换修改图片的样式，已达到在小程序正常显示的目的。
    </p>
    <pre><code class="prism language-javascript">noticeContent <span class="token operator">=</span> noticeContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;img</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">,</span><span class="token string">'&lt;img style="max-width:100%;height:auto;margin:0 auto;display:block"'</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="4__222">
     </a>
     4. 下载文件
    </h3>
    <pre><code class="prism language-javascript">  <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token comment">//文件链接</span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>url
    <span class="token comment">// 下载文件</span>
    <span class="token keyword">var</span> downloadFile <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">// 把文件下载到一个临时文件中</span>
    <span class="token keyword">const</span> downloadTask <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 下面是临时文件的路径</span>
        <span class="token keyword">const</span> tempFilePath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">;</span>
        wx<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          tempFilePath<span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> savedFilePath <span class="token operator">=</span> res<span class="token punctuation">.</span>savedFilePath<span class="token punctuation">;</span>
            <span class="token comment">// 打开文件</span>
            wx<span class="token punctuation">.</span><span class="token function">openDocument</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              <span class="token literal-property property">filePath</span><span class="token operator">:</span> savedFilePath<span class="token punctuation">,</span>
              <span class="token literal-property property">showMenu</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 监控下载过程</span>
    downloadTask<span class="token punctuation">.</span><span class="token function">onProgressUpdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <p>
     上面的兼容不了ios，下面的可以：
    </p>
    <pre><code class="prism language-javascript">   <span class="token comment">// 判断文件类型</span>
   <span class="token function">whatFileType</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> sr <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token comment">//  最后一次出现的位置</span>
    <span class="token keyword">let</span> fileType <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sr<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 截取url的类型</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>url
    <span class="token keyword">let</span> fileTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'doc'</span><span class="token punctuation">,</span><span class="token string">'docx'</span><span class="token punctuation">,</span><span class="token string">'xls'</span><span class="token punctuation">,</span><span class="token string">'xlsx'</span><span class="token punctuation">,</span><span class="token string">'ppt'</span><span class="token punctuation">,</span><span class="token string">'pptx'</span><span class="token punctuation">,</span><span class="token string">'pdf'</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> imageTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"jpg"</span><span class="token punctuation">,</span> <span class="token string">"jpeg"</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> fileType <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">whatFileType</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">let</span> fileId <span class="token operator">=</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>id
    wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'加载中'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    wx<span class="token punctuation">.</span><span class="token function">getSavedFileList</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">// 获取文件列表</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span>fileList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 遍历文件列表里的数据</span>
          <span class="token comment">// 删除存储的垃圾数据</span>
          wx<span class="token punctuation">.</span><span class="token function">removeSavedFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">filePath</span><span class="token operator">:</span> val<span class="token punctuation">.</span>filePath
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
      <span class="token literal-property property">filePath</span><span class="token operator">:</span> wx<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">USER_DATA_PATH</span> <span class="token operator">+</span> <span class="token string">"/"</span><span class="token operator">+</span> fileId <span class="token operator">+</span> <span class="token string">"."</span><span class="token operator">+</span>fileType<span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  
         <span class="token keyword">if</span><span class="token punctuation">(</span>fileTypes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          wx<span class="token punctuation">.</span><span class="token function">openDocument</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">filePath</span><span class="token operator">:</span> res<span class="token punctuation">.</span>filePath<span class="token punctuation">,</span>
            <span class="token literal-property property">showMenu</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">flieType</span><span class="token operator">:</span> fileType<span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打开文档成功'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打开文档失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>imageTypes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          wx<span class="token punctuation">.</span><span class="token function">previewImage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">showmenu</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">current</span><span class="token operator">:</span> res<span class="token punctuation">.</span>filePath<span class="token punctuation">,</span> <span class="token comment">// 当前显示图片的http链接</span>
            <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token punctuation">[</span>res<span class="token punctuation">.</span>filePath<span class="token punctuation">]</span> <span class="token comment">// 需要预览的图片http链接列表</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
          wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"文件类型不支持预览"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"下载超时"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'下载失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h3>
     <a id="5overflow_scroll_335">
     </a>
     5.小程序overflow: scroll;不显示滚动条问题
    </h3>
    <pre><code class="prism language-css"><span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">{<!-- --></span> <span class="token property">width</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span>#ffffff<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">::-webkit-scrollbar-track</span> <span class="token punctuation">{<!-- --></span> <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> inset 0 0 10px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 6px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span>#FFFFFF<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">::-webkit-scrollbar-thumb</span> <span class="token punctuation">{<!-- --></span> <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span> <span class="token property">-webkit-box-shadow</span><span class="token punctuation">:</span> inset 0 0 10px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">box-shadow</span><span class="token punctuation">:</span> inset 0 0 6px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token property">background-color</span><span class="token punctuation">:</span><span class="token function">rgb</span><span class="token punctuation">(</span>170<span class="token punctuation">,</span> 170<span class="token punctuation">,</span> 170<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="6_341">
     </a>
     6.扫描二维码微信小程序获取码内容：
    </h3>
    <p>
     后端设置码值时 scene:“t/123*a/456” , 不能"t=12;a=56" , 不然获取不到。因为=号不行，得特殊符号才行。
    </p>
    <pre><code class="prism language-javascript">  <span class="token function">analysisCode</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// options 中的 scene 需要使用 decodeURIComponent 才能获取到生成二维码时传入的 scene</span>
    <span class="token keyword">var</span> scene <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> scene<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> arr <span class="token operator">=</span> scene<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">[</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 生命周期函数--监听页面加载
     */</span>
    <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

      <span class="token keyword">let</span> scene <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>scene<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// options 中的 scene 需要使用 decodeURIComponent 才能获取到生成二维码时传入的 scene</span>
          scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">analysisCode</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>scene<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"二维码值scene is "</span><span class="token punctuation">,</span> scene<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="7_369">
     </a>
     7.网络图片缓存到本地：
    </h3>
    <pre><code class="prism language-javascript">    <span class="token comment">///把在线logo图片放本地服务器  重新启动小程序，去缓存中获取图片的缓存地址。 然后给Imagesrc赋值</span>
      <span class="token keyword">const</span> path <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'image_logo'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'path===='</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'图片已缓存'</span><span class="token punctuation">)</span> <span class="token comment">// res.savedFilePath 为一个本地缓存文件路径  </span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://sbk.hrss.gdqy.gov.cn/ykttest/Integration/xcx/images/BrightQRCode/qy-logo.png'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'图片下载成功'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span>
              <span class="token comment">// 第二步: 使用小程序的文件系统，通过小程序的api获取到全局唯一的文件管理器</span>
              <span class="token keyword">const</span> fs <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token comment">//  fs为全局唯一的文件管理器。那么文件管理器的作用是什么，我们可以用来做什么呢？</span>
             <span class="token comment">//   文件管理器的作用之一就是可以根据临时文件路径，通过saveFile把文件保存到本地缓存.</span>
              fs<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">tempFilePath</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span> <span class="token comment">// 传入一个临时文件路径</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'图片缓存成功'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>savedFilePath<span class="token punctuation">)</span> <span class="token comment">// res.savedFilePath 为一个本地缓存文件路径  </span>
                  wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'image_logo'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>savedFilePath<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'响应失败'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_401">
     </a>
     十.总结：
    </h3>
    <p>
     暂时先这么多，写多了后面系列就没得写了，哈哈。欲知后事如何，请看下集~
    </p>
    <p>
     不得不说，10月出了好多番，都是高质量的，有没有追《灵能百分百》、《电锯人》等等等的
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2ec716fb21fe6f8dca7338433ab2dc2e.png"/>
    </p>
    <p>
     <a href="https://space.bilibili.com/176586698" rel="nofollow">
      我的哔哩哔哩空间
     </a>
     <br/>
     Gitee仓库地址：
     <a href="https://gitee.com/aurora-in-winter/blog" rel="nofollow">
      全部特效源码
     </a>
     <br/>
     其它文章：
     <br/>
     <strong>
      ~关注我看更多简单创意特效：
     </strong>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/116452424">
      文字烟雾效果 html+css+js
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/115534417">
      环绕倒影加载特效 html+css
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/113657124">
      气泡浮动背景特效 html+css
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/113436552">
      简约时钟特效 html+css+js
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/113360844">
      赛博朋克风格按钮 html+css
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/114393724">
      仿网易云官网轮播图 html+css+js
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/111714413">
      水波加载动画 html+css
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/111601962">
      导航栏滚动渐变效果 html+css+js
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/111398881?spm=1001.2014.3001.5502">
      书本翻页 html+css
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/111032274?spm=1001.2014.3001.5502">
      3D立体相册 html+css
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/114338506">
      霓虹灯绘画板效果 html+css+js
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/111320280">
      记一些css属性总结（一）
     </a>
     <br/>
     <a href="https://blog.csdn.net/luo1831251387/article/details/113179630">
      Sass总结笔记
     </a>
     <br/>
     …等等
     <br/>
     <a href="https://blog.csdn.net/luo1831251387?spm=1000.2115.3001.5343">
      进我主页看更多~
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f6c756f313833313235313338372f:61727469636c652f64657461696c732f313237343836313633" class_="artid" style="display:none">
 </p>
</div>


