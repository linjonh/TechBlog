---
layout: post
title: "记第一次跟踪seatunnel的任务运行过程三解析配置的具体方法getLogicalDag"
date: 2025-03-13 11:11:17 +0800
description: "从这里开始，就是使用seatunnel-2.3.9的源码了。前面部分没有变化，2.3.X版本都是通用的。"
keywords: "记第一次跟踪seatunnel的任务运行过程三——解析配置的具体方法getLogicalDag"
categories: ['日常记录', 'Seatunnel']
tags: ['Seatunnel']
artid: "146224236"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146224236
    alt: "记第一次跟踪seatunnel的任务运行过程三解析配置的具体方法getLogicalDag"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146224236
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146224236
cover: https://bing.ee123.net/img/rand?artid=146224236
image: https://bing.ee123.net/img/rand?artid=146224236
img: https://bing.ee123.net/img/rand?artid=146224236
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     记第一次跟踪seatunnel的任务运行过程三——解析配置的具体方法getLogicalDag
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前绪
    </h2>
    <p>
     <a href="https://blog.csdn.net/u011924665/article/details/143433848?spm=1001.2014.3001.5501">
      记第一次跟踪seatunnel的任务运行过程二——ClientJobExecutionEnvironment的execture方法
     </a>
    </p>
    <p>
     从这里开始，就是使用seatunnel-2.3.9的源码了。前面部分没有变化，2.3.X版本都是通用的。
     <br/>
     <strong>
      建议打开源码，边读文章，边阅读源码
     </strong>
    </p>
    <h2>
     <a id="_5">
     </a>
     正文
    </h2>
    <p>
     getLogicalDag()方法还是在ClientJobExecutionEnvironment这个类中。
    </p>
    <h3>
     <a id="DAG_8">
     </a>
     关键词DAG
    </h3>
    <p>
     DAG：有向无环图。
     <br/>
     LogicalDag：在此可以理解为一个seatunnel job的运行结构图。管理的是从source到transform到sink的过程。
    </p>
    <h3>
     <a id="_12">
     </a>
     解析配置文件，生成资源对
    </h3>
    <pre><code class="prism language-java"><span class="token class-name">ImmutablePair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Action</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> immutablePair <span class="token operator">=</span> <span class="token function">getJobConfigParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     getJobConfigParser().parse()方法中解析在seatunnel执行名中使用‘–config’指定的配置文件，将其中的source、transformer、sink解析成一个个的anction，并且将每个action（即source、transform、sink）所需要用到的jar包地址提取出来。
    </p>
    <h3>
     <a id="actionjar_18">
     </a>
     收集全部的action，以备后用（后面还收集了全部的jar包资源）
    </h3>
    <pre><code class="prism language-java">actions<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>immutablePair<span class="token punctuation">.</span><span class="token function">getLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     使用actions这个对象，直接引用所有的action，方便后续的使用。例如：遍历所有的action进行某个动作处理。
    </p>
    <h3>
     <a id="jar_24">
     </a>
     读去配置，确定是否自动上传jar包
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">boolean</span> enableUploadConnectorJarPackage <span class="token operator">=</span> seaTunnelConfig<span class="token punctuation">.</span><span class="token function">getEngineConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnectorJarStorageConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     前面已经解析出来的所有的action和对应用到的jar包，这里就是根据配置是否将jar自动上传到服务器。
     <br/>
     默认值是：false，即不自动上传。代表着需要提前将需要用到的jar包上传到seatunnel的lib文件夹下。
     <br/>
     这里的配置就是从${SEATUNNEL_HOME}/config/seatunnel.yaml这个配置文件中解析出来了的。但是2.3.9版本的seatunnel.yaml中默认是没有
     <em>
      seatunnel.engine.jar-storage.enable
     </em>
     这一项的，所以使用的基本都是默认值，即：false。
    </p>
    <h4>
     <a id="seatunnnlyaml_32">
     </a>
     seatunnnl.yaml配置文件完整版及解析
    </h4>
    <p>
     seatunnel.yaml文件的解析对象对应的是
     <strong>
      org.apache.seatunnel.engine.common.config.server.ServerConfigOptions
     </strong>
     这个类。
     <br/>
     seatunnel.yaml中配置不全且没有明确的说明，可以到这个文件中查找。
    </p>
    <h3>
     <a id="jar_36">
     </a>
     处理jar包
    </h3>
    <h4>
     <a id="seatunnelenginejarstorageenabletruejar_37">
     </a>
     配置seatunnel.engine.jar-storage.enable=true，上传jar包
    </h4>
    <pre><code class="prism language-java"> <span class="token keyword">if</span> <span class="token punctuation">(</span>enableUploadConnectorJarPackage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectorJarIdentifier</span><span class="token punctuation">&gt;</span></span> commonJarIdentifiers <span class="token operator">=</span> connectorPackageClient<span class="token punctuation">.</span><span class="token function">uploadCommonPluginJars</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>jobConfig<span class="token punctuation">.</span><span class="token function">getJobContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> commonPluginJars<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> commonPluginJarUrls <span class="token operator">=</span> <span class="token function">getJarUrlsFromIdentifiers</span><span class="token punctuation">(</span>commonJarIdentifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectorJarIdentifier</span><span class="token punctuation">&gt;</span></span> pluginJarIdentifiers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">uploadActionPluginJar</span><span class="token punctuation">(</span>actions<span class="token punctuation">,</span> pluginJarIdentifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> connectorPluginJarUrls <span class="token operator">=</span> <span class="token function">getJarUrlsFromIdentifiers</span><span class="token punctuation">(</span>pluginJarIdentifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            connectorJarIdentifiers<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>commonJarIdentifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            connectorJarIdentifiers<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>pluginJarIdentifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
            jarUrls<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>commonPluginJarUrls<span class="token punctuation">)</span><span class="token punctuation">;</span>
            jarUrls<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>connectorPluginJarUrls<span class="token punctuation">)</span><span class="token punctuation">;</span>
            actions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
                    action <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">addCommonPluginJarsToAction</span><span class="token punctuation">(</span>
                                action<span class="token punctuation">,</span> commonPluginJarUrls<span class="token punctuation">,</span> commonJarIdentifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
    <p>
     如果要上传jar包，则将公共插件的jar包、前面解析出来的action使用到的jar包上传上去。
     <br/>
     收集所有的jar包，并且给每个action添加公共插件jar包。
    </p>
    <h4>
     <a id="seatunnelenginejarstorageenablefalsejar_58">
     </a>
     配置seatunnel.engine.jar-storage.enable=false（默认），不上传jar包
    </h4>
    <pre><code class="prism language-java">jarUrls<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>commonPluginJars<span class="token punctuation">)</span><span class="token punctuation">;</span>
            jarUrls<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>immutablePair<span class="token punctuation">.</span><span class="token function">getRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            actions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
                    action <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">addCommonPluginJarsToAction</span><span class="token punctuation">(</span>
                                action<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>commonPluginJars<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     收集所有的jar包，并且给每个action添加公共插件jar包。
    </p>
    <h3>
     <a id="logicDag_70">
     </a>
     结束：生成logicDag
    </h3>
    <pre><code class="prism language-java"><span class="token function">getLogicalDagGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     生成一个logicDag，并返回。
    </p>
    <h3>
     <a id="_76">
     </a>
     后续
    </h3>
    <p>
     <a href="https://blog.csdn.net/u011924665/article/details/146228755?spm=1001.2014.3001.5501">
      记第一次跟踪seatunnel的任务运行过程四——getJobConfigParser().parse()的动作
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031313932343636352f:61727469636c652f64657461696c732f313436323234323336" class_="artid" style="display:none">
 </p>
</div>


