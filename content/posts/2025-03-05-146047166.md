---
layout: post
title: "JAVA编程JVM编程"
date: 2025-03-05 16:52:34 +0800
description: "类加载器（ClassLoader）运行时数据区（Runtime Data Area）执行引擎（Execution Engine）本地方法接口（Native Interface）"
keywords: "JAVA编程【JVM编程】"
categories: ['未分类']
tags: ['Php', 'Jvm', 'Java']
artid: "146047166"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146047166
    alt: "JAVA编程JVM编程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146047166
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146047166
cover: https://bing.ee123.net/img/rand?artid=146047166
image: https://bing.ee123.net/img/rand?artid=146047166
img: https://bing.ee123.net/img/rand?artid=146047166
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     JAVA编程【JVM编程】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1_JVM__0">
     </a>
     1. JVM 体系结构
    </h2>
    <h3>
     <a id="JVM__1">
     </a>
     JVM 主要包括以下几个核心部分：
    </h3>
    <p>
     类加载器（ClassLoader）
     <br/>
     运行时数据区（Runtime Data Area）
     <br/>
     执行引擎（Execution Engine）
     <br/>
     本地方法接口（Native Interface）
    </p>
    <h3>
     <a id="JVM__7">
     </a>
     JVM 运行流程如下：
    </h3>
    <p>
     Java 源码 → 字节码（.class 文件）
     <br/>
     类加载器 加载字节码到 JVM
     <br/>
     字节码校验 确保字节码合法
     <br/>
     解释器 &amp; JIT 编译器 执行字节码
     <br/>
     垃圾回收 释放无用对象
    </p>
    <h2>
     <a id="2__14">
     </a>
     2. 类加载机制
    </h2>
    <p>
     类加载是指 JVM 将 .class 文件加载到内存，并将其转换为 Class 对象。
    </p>
    <h3>
     <a id="_17">
     </a>
     类加载过程
    </h3>
    <p>
     JVM 采用 双亲委派模型 进行类加载，过程如下：
    </p>
    <p>
     加载（Loading）：从磁盘或网络读取 .class 文件
     <br/>
     验证（Verification）：检查 .class 文件的格式与安全性
     <br/>
     准备（Preparation）：分配静态变量内存
     <br/>
     解析（Resolution）：将符号引用转换为直接引用
     <br/>
     初始化（Initialization）：执行静态代码块
    </p>
    <h3>
     <a id="_25">
     </a>
     代码示例
    </h3>
    <p>
     自定义一个类加载器：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token function">loadClassData</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">loadClassData</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> b<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MyClassLoader</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.example.MyClass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Class loaded: "</span> <span class="token operator">+</span> clazz<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     此代码实现了一个自定义类加载器，手动读取 .class 文件并加载。
    </p>
    <h2>
     <a id="3__64">
     </a>
     3. 运行时数据区
    </h2>
    <h3>
     <a id="JVM__65">
     </a>
     JVM 运行时数据区包括：
    </h3>
    <p>
     方法区（Method Area）
     <br/>
     堆（Heap）
     <br/>
     虚拟机栈（JVM Stack）
     <br/>
     本地方法栈（Native Method Stack）
     <br/>
     程序计数器（PC Register）
    </p>
    <h3>
     <a id="_72">
     </a>
     内存分区示例
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemoryTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> staticVar<span class="token punctuation">;</span> <span class="token comment">// 方法区</span>
    <span class="token keyword">int</span> instanceVar<span class="token punctuation">;</span>      <span class="token comment">// 堆</span>
    <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> localVar <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// JVM 栈</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     staticVar 存在 方法区
     <br/>
     instanceVar 存在 堆
     <br/>
     localVar 存在 JVM 栈
    </p>
    <h2>
     <a id="4_JVM__87">
     </a>
     4. JVM 执行引擎
    </h2>
    <h3>
     <a id="JVM__88">
     </a>
     JVM 主要有两种执行方式：
    </h3>
    <p>
     解释执行（Interpreter）：逐行执行字节码，速度较慢
     <br/>
     JIT（Just-In-Time 编译器）：热点代码编译成机器码，提高性能
    </p>
    <h3>
     <a id="JIT__92">
     </a>
     JIT 代码优化
    </h3>
    <p>
     JIT 会优化热点代码，例如：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JITTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1_000_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 热点代码</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Execution Time: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1_000_000</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     JVM 会对 Math.pow(i, 2) 进行优化，提高执行效率。
    </p>
    <h2>
     <a id="5_GC_110">
     </a>
     5. 垃圾回收（GC）
    </h2>
    <h3>
     <a id="JVM__111">
     </a>
     垃圾回收用于回收无用对象，JVM 主要有以下几种垃圾回收器：
    </h3>
    <p>
     Serial GC（单线程）
     <br/>
     Parallel GC（多线程）
     <br/>
     CMS GC（低停顿）
     <br/>
     G1 GC（大内存优化）
     <br/>
     ZGC / Shenandoah GC（超低延迟）
    </p>
    <h3>
     <a id="_118">
     </a>
     对象生命周期
    </h3>
    <p>
     JVM 采用 GC Roots 可达性分析：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GCTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">GCTest</span> instance<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GCTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 失去引用，等待 GC</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 手动触发 GC</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"GC is running!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行时可能会看到 GC is running!，表示对象被回收。
    </p>
    <h2>
     <a id="6__140">
     </a>
     6. 逃逸分析与栈上分配
    </h2>
    <p>
     JVM 可能会优化对象分配，使其在栈上分配，减少 GC 负担。
    </p>
    <h3>
     <a id="_143">
     </a>
     代码示例
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EscapeAnalysis</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyObject</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1_000_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">MyObject</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能分配到栈上</span>
            obj<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Execution Time: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1_000_000</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     如果 JIT 认为对象未逃逸，可能会在栈上分配，而非堆上。
    </p>
    <h2>
     <a id="7_JVM__165">
     </a>
     7. JVM 调优
    </h2>
    <h3>
     <a id="JVM__166">
     </a>
     JVM 提供多种参数进行调优，如：
    </h3>
    <p>
     -Xmx512m：最大堆大小 512MB
     <br/>
     -Xms512m：初始堆大小 512MB
     <br/>
     -XX:+UseG1GC：启用 G1 GC
     <br/>
     -XX:MaxGCPauseMillis=200：最大 GC 停顿时间 200ms
    </p>
    <h3>
     <a id="JVM__172">
     </a>
     JVM 监控工具
    </h3>
    <h4>
     <a id="_JVM_173">
     </a>
     可以使用以下工具监控 JVM：
    </h4>
    <p>
     jps：列出 Java 进程
     <br/>
     jstat：监控 GC
     <br/>
     jmap：查看内存分配
     <br/>
     jstack：线程栈分析
     <br/>
     VisualVM：可视化监控 JVM
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343235393231322f:61727469636c652f64657461696c732f313436303437313636" class_="artid" style="display:none">
 </p>
</div>


