---
layout: post
title: "ESP32的IDF开发学习-移植lvgl并显示简单ui以gc9a01为例"
date: 2025-03-10 17:18:59 +0800
description: "历经数日的调试与优化，终于成功攻克GC9A01显示屏的驱动开发！🎉 本文将聚焦LVGL图形库的移植与实践，详细介绍如何在ESP32-S3平台上实现基础UI渲染，为后续复杂界面开发奠定基础。"
keywords: "ESP32的IDF开发学习-移植lvgl并显示简单ui(以gc9a01为例)"
categories: ['未分类']
tags: ['学习', 'Ui']
artid: "146159168"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146159168
    alt: "ESP32的IDF开发学习-移植lvgl并显示简单ui以gc9a01为例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146159168
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146159168
cover: https://bing.ee123.net/img/rand?artid=146159168
image: https://bing.ee123.net/img/rand?artid=146159168
img: https://bing.ee123.net/img/rand?artid=146159168
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ESP32的IDF开发学习-移植lvgl并显示简单ui(以gc9a01为例)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="__0">
     </a>
     📖 前言
    </h3>
    <p>
     历经数日的调试与优化，终于成功攻克GC9A01显示屏的驱动开发！🎉 本文将聚焦
     <strong>
      LVGL图形库的移植与实践
     </strong>
     ，详细介绍如何在ESP32-S3平台上实现基础UI渲染，为后续复杂界面开发奠定基础。
    </p>
    <hr/>
    <h3>
     <a id="_LVGL_5">
     </a>
     🛠️ LVGL组件集成
    </h3>
    <h4>
     <a id="1__7">
     </a>
     1️⃣
     <strong>
      组件安装
     </strong>
    </h4>
    <p>
     通过
     <strong>
      ESP-IDF组件管理器
     </strong>
     快速集成LVGL：
    </p>
    <ol>
     <li>
      打开组件注册器，搜索
      <code>
       lvgl
      </code>
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/img_convert/bc60e23ea1fadd12f6d273a94323edbe.png"/>
     </li>
     <li>
      选择
      <strong>
       v8.x版本
      </strong>
      （更稳定的长期支持版本）并安装
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/img_convert/75bc10303848fdea8b5dd658130baad7.png"/>
     </li>
     <li>
      同时安装
      <strong>
       lvgl_port
      </strong>
      端口适配层
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1e06473cf727c7d89c66341365797616.png"/>
     </li>
    </ol>
    <h4>
     <a id="2__16">
     </a>
     2️⃣
     <strong>
      关键配置
     </strong>
    </h4>
    <pre><code class="prism language-c"><span class="token class-name">lvgl_port_cfg_t</span> port_cfg <span class="token operator">=</span> <span class="token function">ESP_LVGL_PORT_INIT_CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">lvgl_port_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>port_cfg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre>
    <p>
     📌
     <strong>
      配置项解析
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       <code>
        task_priority
       </code>
      </strong>
      : 建议设为
      <code>
       5
      </code>
      （低于WiFi/BT等高优先级任务）
     </li>
     <li>
      <strong>
       <code>
        task_stack
       </code>
      </strong>
      : 至少
      <code>
       4096
      </code>
      字（复杂UI需增大）
     </li>
     <li>
      <strong>
       <code>
        task_affinity
       </code>
      </strong>
      : 绑定到
      <code>
       CPU1
      </code>
      可隔离渲染任务与其他逻辑
     </li>
    </ul>
    <p>
     ⚠️
     <strong>
      重要提示
     </strong>
     ：
    </p>
    <blockquote>
     <ul>
      <li>
       若显示屏出现撕裂，需调整
       <code>
        timer_period_ms
       </code>
       与刷新率同步
      </li>
      <li>
       多任务操作LVGL前必须
       <strong>
        加锁
       </strong>
      </li>
     </ul>
    </blockquote>
    <hr/>
    <h3>
     <a id="__32">
     </a>
     🖥️ 显示器注册与配置
    </h3>
    <h4>
     <a id="1__34">
     </a>
     1️⃣
     <strong>
      硬件定义
     </strong>
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">gc9a01_swap_xy</span>  <span class="token expression">false </span><span class="token comment">// XY轴交换（适配屏幕方向）</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">gc9a01_mirror_x</span> <span class="token expression">true  </span><span class="token comment">// X轴镜像（物理安装方向补偿）</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">gc9a01_mirror_y</span> <span class="token expression">false </span><span class="token comment">// Y轴镜像</span></span>

<span class="token class-name">esp_lcd_panel_io_handle_t</span> io_handle <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// LCD总线句柄</span>
<span class="token class-name">esp_lcd_panel_handle_t</span> panel_handle <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// 面板控制句柄</span>
<span class="token class-name">lv_disp_t</span> <span class="token operator">*</span>disp_ <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// LVGL显示设备对象</span>
</code></pre>
    <h4>
     <a id="2__45">
     </a>
     2️⃣
     <strong>
      显示端口注册
     </strong>
    </h4>
    <pre><code class="prism language-c"><span class="token keyword">const</span> <span class="token class-name">lvgl_port_display_cfg_t</span> display_cfg <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span>io_handle <span class="token operator">=</span> io_handle<span class="token punctuation">,</span> 
    <span class="token punctuation">.</span>panel_handle <span class="token operator">=</span> panel_handle<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>buffer_size <span class="token operator">=</span> LCD_WIDTH <span class="token operator">*</span> <span class="token number">80</span><span class="token punctuation">,</span>   <span class="token comment">// 双缓冲每帧80行</span>
    <span class="token punctuation">.</span>double_buffer <span class="token operator">=</span> true<span class="token punctuation">,</span>           <span class="token comment">// ✅ 启用双缓冲防撕裂</span>
    <span class="token punctuation">.</span>hres <span class="token operator">=</span> LCD_WIDTH<span class="token punctuation">,</span>               <span class="token comment">// 水平分辨率</span>
    <span class="token punctuation">.</span>vres <span class="token operator">=</span> LCD_HEIGHT<span class="token punctuation">,</span>              <span class="token comment">// 垂直分辨率</span>
    <span class="token punctuation">.</span>rotation <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span>swap_xy <span class="token operator">=</span> gc9a01_swap_xy<span class="token punctuation">,</span>   <span class="token comment">// 坐标系变换</span>
        <span class="token punctuation">.</span>mirror_x <span class="token operator">=</span> gc9a01_mirror_x<span class="token punctuation">,</span> 
        <span class="token punctuation">.</span>mirror_y <span class="token operator">=</span> gc9a01_mirror_y<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>flags <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span>buff_dma <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>               <span class="token comment">// 🚀 DMA加速传输</span>
        <span class="token punctuation">.</span>buff_spiram <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment">// 禁用PSRAM（片上内存充足时）</span>
        <span class="token punctuation">.</span>sw_rotate <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 不使用软件旋转</span>
        <span class="token punctuation">.</span>full_refresh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 不使用全屏刷新</span>
        <span class="token punctuation">.</span>direct_mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 不使用直接模式</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

disp_ <span class="token operator">=</span> <span class="token function">lvgl_port_add_disp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>display_cfg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册显示器到LVGL</span>
</code></pre>
    <p>
     🔧
     <strong>
      调试技巧
     </strong>
     ：
    </p>
    <ul>
     <li>
      若帧率不足，可尝试增大
      <code>
       buffer_size
      </code>
      至全屏尺寸（牺牲内存换取速度）
     </li>
     <li>
      <code>
       sw_rotate=1
      </code>
      可在不修改硬件排线的情况下软件旋转屏幕
     </li>
     <li>
      PSRAM和DMA不能同时开启
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="__77">
     </a>
     🔍
     <strong>
      核心代码剖析
     </strong>
    </h3>
    <h4>
     <a id="lvgl_port_init__78">
     </a>
     <code>
      lvgl_port_init()
     </code>
     函数详解
    </h4>
    <p>
     该函数实现了LVGL与FreeRTOS的深度整合，主要功能如下：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        模块
       </th>
       <th>
        功能说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         心跳定时器
        </strong>
       </td>
       <td>
        通过
        <code>
         lvgl_port_tick_init()
        </code>
        注入系统时钟，维持LVGL动画/事件处理（默认5ms中断）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         互斥量保护
        </strong>
       </td>
       <td>
        递归锁防止多线程竞争LVGL对象（如UI线程与传感器数据更新线程）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         任务绑定
        </strong>
       </td>
       <td>
        可指定渲染任务运行的CPU核心，提升多核利用率
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     ⚠️
     <strong>
      线程安全警告
     </strong>
     ：
    </p>
    <blockquote>
     <p>
      所有LVGL对象操作必须包裹在锁内：
     </p>
     <pre><code class="prism language-c"><span class="token function">xSemaphoreTakeRecursive</span><span class="token punctuation">(</span>lvgl_port_ctx<span class="token punctuation">.</span>lvgl_mux<span class="token punctuation">,</span> portMAX_DELAY<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">lv_label_set_text</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> <span class="token string">"New Value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">xSemaphoreGiveRecursive</span><span class="token punctuation">(</span>lvgl_port_ctx<span class="token punctuation">.</span>lvgl_mux<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    </blockquote>
    <hr/>
    <h3>
     <a id="_UI_97">
     </a>
     🎨 基础UI开发示例
    </h3>
    <pre><code class="prism language-c"><span class="token comment">// 获取默认屏幕对象</span>
<span class="token class-name">lv_obj_t</span> <span class="token operator">*</span>scr <span class="token operator">=</span> <span class="token function">lv_disp_get_scr_act</span><span class="token punctuation">(</span>disp_<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置背景样式（50%透明度，白色底色）</span>
<span class="token function">lv_obj_set_style_bg_opa</span><span class="token punctuation">(</span>scr<span class="token punctuation">,</span> LV_OPA_50<span class="token punctuation">,</span> LV_STATE_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lv_obj_set_style_bg_color</span><span class="token punctuation">(</span>scr<span class="token punctuation">,</span> <span class="token function">lv_color_white</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LV_PART_MAIN<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 创建文本标签并定位</span>
<span class="token class-name">lv_obj_t</span> <span class="token operator">*</span>label <span class="token operator">=</span> <span class="token function">lv_label_create</span><span class="token punctuation">(</span>scr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lv_label_set_text</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> <span class="token string">"Hello ESP32"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">lv_obj_align</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> LV_ALIGN_CENTER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 居中显示</span>

<span class="token function">ESP_LOGI</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"UI初始化完成✅"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     编译烧录后效果：
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/aeb6a5fd81bfe9818ab8aa7da74e90bd.jpeg">
      <br/>
      大功告成！！！
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35333434303437372f:61727469636c652f64657461696c732f313436313539313638" class_="artid" style="display:none">
 </p>
</div>


