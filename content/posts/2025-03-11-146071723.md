---
layout: post
title: "SpringBoot缓存抽象Cacheable与缓存管理器配置"
date: 2025-03-11 06:30:00 +0800
description: "SpringBoot的缓存抽象建立在Spring Framework的缓存支持之上，提供了一套统一的缓存操作接口。这种抽象允许开发者在不修改业务代码的情况下，轻松切换底层缓存实现，如从本地缓存迁移到分布式缓存。缓存抽象的核心是CacheManager接口，它管理应用中的缓存，而@Cacheable等注解则提供了声明式缓存的能力。/*** SpringBoot缓存示例项目启动类*/@EnableCaching // 启用SpringBoot的缓存支持/*** 配置日志以显示缓存操作*/"
keywords: "springboot自己定义缓存key"
categories: ['全家桶', 'Spring', 'Java']
tags: ['缓存', 'Spring', 'Java', 'Boot']
artid: "146071723"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146071723
    alt: "SpringBoot缓存抽象Cacheable与缓存管理器配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146071723
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146071723
cover: https://bing.ee123.net/img/rand?artid=146071723
image: https://bing.ee123.net/img/rand?artid=146071723
img: https://bing.ee123.net/img/rand?artid=146071723
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SpringBoot缓存抽象：@Cacheable与缓存管理器配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d5e988badfd04991931ff2fea52ea54f.png"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="_4">
     </a>
     引言
    </h3>
    <p>
     缓存是提升应用性能的关键技术，SpringBoot提供了强大的缓存抽象层，使开发者能够以一致的方式操作不同的缓存实现。本文深入探讨SpringBoot的缓存机制，重点阐述@Cacheable注解的使用技巧及缓存管理器的配置方法，帮助开发者构建高效的缓存策略，优化应用性能。
    </p>
    <h3>
     <a id="SpringBoot_8">
     </a>
     一、SpringBoot缓存抽象概述
    </h3>
    <p>
     SpringBoot的缓存抽象建立在Spring Framework的缓存支持之上，提供了一套统一的缓存操作接口。这种抽象允许开发者在不修改业务代码的情况下，轻松切换底层缓存实现，如从本地缓存迁移到分布式缓存。缓存抽象的核心是CacheManager接口，它管理应用中的缓存，而@Cacheable等注解则提供了声明式缓存的能力。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * SpringBoot缓存示例项目启动类
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableCaching</span>  <span class="token comment">// 启用SpringBoot的缓存支持</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheDemoApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">CacheDemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 配置日志以显示缓存操作
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LoggingCacheErrorHandler</span> <span class="token function">cacheErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoggingCacheErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Cacheable_33">
     </a>
     二、@Cacheable注解详解
    </h3>
    <p>
     @Cacheable是SpringBoot缓存抽象中最常用的注解，用于标记方法的返回值应被缓存。当标记了@Cacheable的方法被调用时，SpringBoot会检查指定的缓存是否已包含对应键的值，如存在则直接返回缓存值，不执行方法；如不存在，则执行方法并将返回值放入缓存。这种机制显著减少了重复计算，提升了应用响应速度。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 用户服务实现类，演示@Cacheable注解的基本用法
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository <span class="token operator">=</span> userRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"users"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 模拟数据库查询的耗时操作</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 模拟2秒的查询延迟</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"User not found"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="21_Cacheable_65">
     </a>
     2.1 @Cacheable的关键属性
    </h4>
    <p>
     @Cacheable注解具有多个属性，可精细控制缓存行为。value或cacheNames指定缓存名称；key定义缓存键生成规则，支持SpEL表达式；condition指定缓存条件；unless定义不缓存的条件；cacheManager指定使用的缓存管理器。合理设置这些属性可以实现精确的缓存控制，满足复杂业务场景的需求。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 产品服务，展示@Cacheable的高级属性用法
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ProductRepository</span> productRepository<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ProductService</span><span class="token punctuation">(</span><span class="token class-name">ProductRepository</span> productRepository<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>productRepository <span class="token operator">=</span> productRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>
        cacheNames <span class="token operator">=</span> <span class="token string">"products"</span><span class="token punctuation">,</span>  <span class="token comment">// 缓存名称</span>
        key <span class="token operator">=</span> <span class="token string">"#category.concat('-').concat(#price)"</span><span class="token punctuation">,</span>  <span class="token comment">// 组合键</span>
        condition <span class="token operator">=</span> <span class="token string">"#price &gt; 100"</span><span class="token punctuation">,</span>  <span class="token comment">// 仅缓存价格大于100的产品</span>
        unless <span class="token operator">=</span> <span class="token string">"#result == null"</span><span class="token punctuation">,</span>  <span class="token comment">// 不缓存null结果</span>
        cacheManager <span class="token operator">=</span> <span class="token string">"productCacheManager"</span>  <span class="token comment">// 指定缓存管理器</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findProductsByCategoryAndPrice</span><span class="token punctuation">(</span><span class="token class-name">String</span> category<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 模拟复杂查询</span>
        <span class="token keyword">return</span> productRepository<span class="token punctuation">.</span><span class="token function">findByCategoryAndPriceGreaterThan</span><span class="token punctuation">(</span>category<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_96">
     </a>
     三、缓存管理器配置
    </h3>
    <p>
     缓存管理器是SpringBoot缓存抽象的核心组件，负责创建、获取和管理缓存实例。SpringBoot默认使用ConcurrentMapCacheManager作为缓存管理器，它基于ConcurrentHashMap实现，适用于开发环境或小型应用。对于生产环境，通常需要配置更高性能的缓存管理器，如Caffeine、Redis或EhCache等。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 缓存配置类，演示多种缓存管理器的配置
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfig</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">/**
     * 配置基于Caffeine的本地缓存管理器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">caffeineCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">CaffeineCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CaffeineCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 全局缓存配置</span>
        cacheManager<span class="token punctuation">.</span><span class="token function">setCaffeine</span><span class="token punctuation">(</span><span class="token class-name">Caffeine</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expireAfterWrite</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">)</span>  <span class="token comment">// 写入后30分钟过期</span>
                <span class="token punctuation">.</span><span class="token function">maximumSize</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">// 最大缓存条目数</span>
                <span class="token punctuation">.</span><span class="token function">recordStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 记录缓存统计信息</span>
        <span class="token comment">// 预设缓存名称</span>
        cacheManager<span class="token punctuation">.</span><span class="token function">setCacheNames</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"products"</span><span class="token punctuation">,</span> <span class="token string">"orders"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 配置Redis缓存管理器，用于分布式缓存
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">redisCacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Redis缓存配置</span>
        <span class="token class-name">RedisCacheConfiguration</span> cacheConfiguration <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 设置TTL为60分钟</span>
                <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 禁止缓存null值</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
        <span class="token comment">// 为不同的缓存设置不同的配置</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">&gt;</span></span> cacheConfigurations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cacheConfigurations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> cacheConfiguration<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cacheConfigurations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"products"</span><span class="token punctuation">,</span> cacheConfiguration<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofHours</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>cacheConfiguration<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withInitialCacheConfigurations</span><span class="token punctuation">(</span>cacheConfigurations<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_149">
     </a>
     四、自定义键生成策略
    </h3>
    <p>
     缓存键的设计直接影响缓存命中率和性能。SpringBoot默认使用方法参数的哈希值作为缓存键，但在复杂场景下，可能需要自定义键生成策略。通过实现KeyGenerator接口，开发者可以控制缓存键的生成逻辑，例如基于参数特定字段或组合多个参数生成键，从而提高缓存的精确性和有效性。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 自定义缓存键生成器
 */</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"customKeyGenerator"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomKeyGenerator</span> <span class="token keyword">implements</span> <span class="token class-name">KeyGenerator</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StringBuilder</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加类名</span>
        key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加方法名</span>
        key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 处理参数</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> param <span class="token operator">:</span> params<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>param <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 对于User类型参数，使用其id作为键的一部分</span>
                key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>param <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 对于其他参数，使用其toString()方法</span>
                key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            key<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 移除末尾的冒号</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">':'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            key<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 使用自定义键生成器的服务方法
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">"orders"</span><span class="token punctuation">,</span> keyGenerator <span class="token operator">=</span> <span class="token string">"customKeyGenerator"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">getOrderDetails</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">,</span> <span class="token class-name">String</span> customerCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 业务逻辑...</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span>orderId<span class="token punctuation">,</span> customerCode<span class="token punctuation">,</span> <span class="token comment">/* 其他订单信息 */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_205">
     </a>
     五、缓存同步与失效策略
    </h3>
    <p>
     缓存数据与源数据的同步是缓存系统设计中的关键挑战。SpringBoot提供了@CachePut和@CacheEvict注解分别用于更新缓存和移除缓存项。@CachePut在不影响方法执行的情况下更新缓存，而@CacheEvict则负责清除缓存中的数据。通过合理使用这些注解，可以构建出高效的缓存同步机制，确保缓存数据的一致性。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 演示缓存同步与失效的服务类
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductInventoryService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ProductRepository</span> productRepository<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ProductInventoryService</span><span class="token punctuation">(</span><span class="token class-name">ProductRepository</span> productRepository<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>productRepository <span class="token operator">=</span> productRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">"inventory"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#productId"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getProductInventory</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 从数据库查询库存</span>
        <span class="token keyword">return</span> productRepository<span class="token punctuation">.</span><span class="token function">findInventoryByProductId</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">"inventory"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#productId"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">updateProductInventory</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> newInventory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 更新数据库库存</span>
        productRepository<span class="token punctuation">.</span><span class="token function">updateInventory</span><span class="token punctuation">(</span>productId<span class="token punctuation">,</span> newInventory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> newInventory<span class="token punctuation">;</span>  <span class="token comment">// 返回值将被缓存</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">"inventory"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#productId"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invalidateInventoryCache</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 仅清除缓存，不执行实际业务逻辑</span>
        <span class="token comment">// 方法体可以为空，注解会处理缓存清除</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 批量清除缓存</span>
    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">"inventory"</span><span class="token punctuation">,</span> allEntries <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearAllInventoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 清除inventory缓存中的所有条目</span>
        <span class="token comment">// 例如在库存批量更新后调用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="SpringBoot_250">
     </a>
     六、SpringBoot缓存最佳实践
    </h3>
    <p>
     在实际应用中，缓存的使用需要遵循一些最佳实践。避免过度缓存，只缓存热点数据和计算密集型操作结果；设置合理的过期时间，避免缓存数据长时间不一致；为缓存配置适当的大小限制，防止内存溢出；实现缓存监控和统计，及时发现缓存问题。遵循这些实践可以充分发挥缓存的性能优势，同时避免常见的缓存陷阱。
    </p>
    <pre><code class="prism language-java"><span class="token comment">/**
 * 缓存监控配置
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheMonitoringConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">CacheMonitoringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * 自定义缓存解析器，添加日志记录
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheResolver</span> <span class="token function">cacheResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoggingCacheResolver</span><span class="token punctuation">(</span><span class="token function">caffeineCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 自定义缓存错误处理器
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheErrorHandler</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CacheErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleCacheGetError</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> exception<span class="token punctuation">,</span> <span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cache get error for cache: {} and key: {}"</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleCachePutError</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> exception<span class="token punctuation">,</span> <span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cache put error for cache: {} and key: {}"</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleCacheEvictError</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> exception<span class="token punctuation">,</span> <span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cache evict error for cache: {} and key: {}"</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleCacheClearError</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> exception<span class="token punctuation">,</span> <span class="token class-name">Cache</span> cache<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Cache clear error for cache: {}"</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 缓存统计信息收集任务
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedRate <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">)</span>  <span class="token comment">// 每分钟执行一次</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCacheStatistics</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">CaffeineCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CaffeineCacheManager</span><span class="token punctuation">)</span> <span class="token function">caffeineCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cacheManager<span class="token punctuation">.</span><span class="token function">getCacheNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>cacheName <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>benmanes<span class="token punctuation">.</span>caffeine<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span>Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> nativeCache <span class="token operator">=</span> 
                    <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>benmanes<span class="token punctuation">.</span>caffeine<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span>Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> 
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CaffeineCache</span><span class="token punctuation">)</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNativeCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token class-name">CacheStats</span> stats <span class="token operator">=</span> nativeCache<span class="token punctuation">.</span><span class="token function">stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Cache: {} stats - Hit rate: {}, Eviction count: {}, Load time: {}ms"</span><span class="token punctuation">,</span>
                    cacheName<span class="token punctuation">,</span>
                    <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%.2f"</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span><span class="token function">hitRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">,</span>
                    stats<span class="token punctuation">.</span><span class="token function">evictionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    stats<span class="token punctuation">.</span><span class="token function">totalLoadTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1_000_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_322">
     </a>
     总结
    </h3>
    <p>
     SpringBoot的缓存抽象为Java应用提供了强大而灵活的缓存支持。通过@Cacheable注解和多样化的缓存管理器配置，开发者可以轻松实现高效的缓存策略。本文详细阐述了缓存抽象的核心概念、@Cacheable注解的使用技巧、缓存管理器的配置方法、自定义键生成策略以及缓存同步与失效机制。在实际应用中，开发者应根据业务需求选择合适的缓存实现，并遵循缓存最佳实践，如合理设置缓存大小和过期时间、实施缓存监控与统计等。恰当地使用SpringBoot缓存不仅能显著提升应用性能，还能减轻数据库负担，提高系统整体响应能力和用户体验。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35353334343337352f:61727469636c652f64657461696c732f313436303731373233" class_="artid" style="display:none">
 </p>
</div>


