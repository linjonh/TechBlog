---
layout: post
title: "WebHTML5-Canvas-2D绘图的封装"
date: 2025-03-12 22:59:22 +0800
description: "(原文写自2024年10月9日，整理笔记所以现在发出)HTML5 Canvas并不是一项很新的技术了，但是作为一名业余程序员，我是不需要考虑新旧技术和投入实际生产的问题，相反，我只需要考虑有趣，什么有趣搞什么。在Godot中玩味了一圈CanvasItem的绘图函数，也慢慢补齐了一点三角函数、向量和线性变换的基础之后，发现绘图才是程序中最有意思的内容。关于Canvas的2D绘图指令，确实没有必要重复讲述，有很好的文章和在线文档讲述这些内容。"
keywords: "【Web】HTML5 Canvas 2D绘图的封装"
categories: ['网页', 'Javascript']
tags: ['类', '前端', 'Html', 'Es', 'Canvas']
artid: "146217199"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146217199
    alt: "WebHTML5-Canvas-2D绘图的封装"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146217199
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146217199
cover: https://bing.ee123.net/img/rand?artid=146217199
image: https://bing.ee123.net/img/rand?artid=146217199
img: https://bing.ee123.net/img/rand?artid=146217199
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Web】HTML5 Canvas 2D绘图的封装
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     概述
    </h3>
    <p>
     (原文写自2024年10月9日，整理笔记所以现在发出)
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0f95e79c2ecc9e7bc24c7416e40141b1.png#pic_center" width="300"/>
    </p>
    <p>
     HTML5 Canvas并不是一项很新的技术了，但是作为一名
     <strong>
      业余程序员
     </strong>
     ，我是不需要考虑新旧技术和投入实际生产的问题，相反，我只需要考虑有趣，什么有趣搞什么。在Godot中玩味了一圈
     <code>
      CanvasItem
     </code>
     的绘图函数，也慢慢补齐了一点三角函数、向量和线性变换的基础之后，发现
     <strong>
      绘图才是程序中最有意思的内容
     </strong>
     。
    </p>
    <p>
     关于Canvas的2D绘图指令，确实没有必要重复讲述，有很好的文章和在线文档讲述这些内容。相反，一些除绘图指令之外的用法是非常值得进阶学习的，因为我有Godot中的一些经验，理解和运用这些内容也变得非常容易，这大概就叫做“触类旁通”吧。
    </p>
    <p>
     本文部分参考《HTML5 Canvas核心技术——图形、动画与游戏开发》（下文简称《HC开发》）一书，MDN文档、菜鸟教程和其他各处博文等。
    </p>
    <p>
     本文的主要目标是试图精炼Canvas 2D绘图的一些高级和核心内容，并将其封装为一个自定义类的方法，从而简化原来的大量基础绘图代码，并且作为后续高级应用开发的基础。你可以看到我糅合了很多Godot中的思路和做法，之前封装JS版本的
     <code>
      Vector2
     </code>
     类就是我无法忘掉从Godot中学习到的内容。
    </p>
    <p>
     另外推荐渡一教育的几个Canvas视频，我觉得是目前讲的最牛最清晰的一个，而且也是最接近《HC开发》一书内容的，可以作为速通和辅助学习视频。渡一教育的视频在B站、小红书等社交账号都可以找到。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/7656ee2626666e8d0b8b0b70641790a7.png#pic_center" width="500"/>
    </p>
    <p>
     本文的最大特点，一个是业余，一个就是会讲述整个自定义类逐渐添加和封装Canvas核心功能的过程和思路。并且会以小tip的形式补充大量JavaScript的基础知识点（毕竟我的JavaScript基础也不是很牢固）。
    </p>
    <h3>
     <a id="canvas_18">
     </a>
     动态创建canvas
    </h3>
    <p>
     在2D绘制方面，最重要的是下面两句：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="ES6_26">
     </a>
     封装为ES6类
    </h3>
    <hr/>
    <p>
     <strong>
      JavaScript中的类
     </strong>
    </p>
    <p>
     ECMAScript（简称ES）是一种由Ecma International通过ECMA-262标准定义的脚本语言规范。ES5和ES6是这个规范的两个版本，分别代表JavaScript语言的两个不同的发展阶段。
    </p>
    <p>
     在ES5中，JavaScript并没有原生的类（class）概念，但是可以通过构造函数和原型链（prototype）来模拟面向对象编程中的类。而在ES6中，JavaScript正式引入了类（class）的概念，提供了一种更简洁和直观的方式来实现面向对象编程，但是其本质还是通过构造函数和原型链（prototype）实现。
    </p>
    <hr/>
    <p>
     可以看到，很多脚本和语言都有趋同化的设计，如果你将JavaScript和Python以及GDSCript放在一起，会发现很多相似的东西，毕竟思路和用途都大差不差。
    </p>
    <p>
     以下是一个简单的ES6风格的类定义形式和实例化用法：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">class</span> 类名<span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">参数列表</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>属性<span class="token constant">A</span> <span class="token operator">=</span> 参数<span class="token number">1</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>属性<span class="token constant">B</span> <span class="token operator">=</span> 参数<span class="token number">2</span>
      <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
    <span class="token function">方法</span><span class="token punctuation">(</span><span class="token parameter">参数</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> 实例 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">类名</span><span class="token punctuation">(</span>参数列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      类名一般首字母大写
     </li>
     <li>
      <code>
       constructor()
      </code>
      是类的构造函数，可以传入一些参数，为属性进行初始的赋值
     </li>
     <li>
      构造函数和一般的方法都不需要带
      <code>
       function
      </code>
      关键字
     </li>
     <li>
      <code>
       new 类名(参数列表)
      </code>
      而不是
      <code>
       类名.new()
      </code>
      ，习惯了GDSCript，很容易写错
     </li>
    </ul>
    <p>
     我们依照ES6风格的类定义形式，定义一个初步的·
     <code>
      Canvas2D
     </code>
     类型如下：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span>height<span class="token punctuation">,</span>p_node <span class="token operator">=</span> document<span class="token punctuation">.</span>body</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
        p_node<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其中：
    </p>
    <ul>
     <li>
      <code>
       Canvas2D
      </code>
      的构造函数，有三个参数：
      <ul>
       <li>
        <code>
         width
        </code>
        和
        <code>
         height
        </code>
        分别指定
        <code>
         &lt;canvas&gt;
        </code>
        的画布宽度和高度
       </li>
       <li>
        <code>
         p_node
        </code>
        指定
        <code>
         &lt;canvas&gt;
        </code>
        标签的父元素，默认为
        <code>
         document.body
        </code>
       </li>
      </ul>
     </li>
    </ul>
    <p>
     如上定义后，我们只需要在测试代码中
     <code>
      new
     </code>
     一个
     <code>
      Canvas2D
     </code>
     的实例，并传入宽高和父元素，就可以自定在测试页面的
     <code>
      &lt;body&gt;
     </code>
     标签或其他元素中添加一个
     <code>
      &lt;canvas&gt;
     </code>
     标签，
     <code>
      Canvas2D
     </code>
     实例会在其canvas属性中存储对
     <code>
      &lt;canvas&gt;
     </code>
     标签实例的引用。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     因为需要再浏览器中使用和测试，所以我们搭建如下的测试页面：
    </p>
    <pre><code class="prism language-html"><span class="token comment">&lt;!-- test.html --&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Canvas2D测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Canvas2D.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">canvas</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">box-shadow</span><span class="token punctuation">:</span> 1px 1px 5px #ccc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>draw.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     其中：
    </p>
    <ul>
     <li>
      在
      <code>
       &lt;head&gt;
      </code>
      部分引入
      <code>
       Canvas2D.js
      </code>
      ，并且用
      <code>
       &lt;style&gt;
      </code>
      直接定义所有
      <code>
       canvas
      </code>
      标签的统一样式，为其添加一个
      <code>
       box-shadow
      </code>
      ，用于在HTML页面中与白色背景区分
     </li>
     <li>
      在
      <code>
       &lt;body&gt;
      </code>
      外，引入
      <code>
       draw.js
      </code>
      ，作为测试代码
     </li>
    </ul>
    <p>
     测试效果：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3c90f6210dcdf012f3dc492888ca8d5d.png#pic_center" width="500"/>
    </p>
    <h3>
     <a id="GetterSetter_122">
     </a>
     使用Getter和Setter
    </h3>
    <p>
     使用
     <code>
      set
     </code>
     和
     <code>
      get
     </code>
     关键字，可以定义属性的Getter和Setter方法，用于更细节的控制属性的读写操作。
    </p>
    <p>
     这里我们将
     <code>
      Canvas2D
     </code>
     的
     <code>
      width
     </code>
     和
     <code>
      height
     </code>
     属性设定为读写
     <code>
      Canvas2D.canvas
     </code>
     的
     <code>
      width
     </code>
     和
     <code>
      height
     </code>
     属性，以简化代码：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span>height<span class="token punctuation">,</span>p_node <span class="token operator">=</span> document<span class="token punctuation">.</span>body</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这样我们就可以直接像下面这样重新定义和读取canvas的尺寸：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通过height和width属性重新设定canvas的尺寸</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>

<span class="token comment">// 读取canvas的尺寸</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/88330a45c63dd3df3415c287733feedc.png#pic_center" width="300"/>
    </p>
    <h3>
     <a id="_164">
     </a>
     编写绘图方法
    </h3>
    <p>
     在搞定canvas的实例化之后，我们开始正式封装一些绘图方法。
    </p>
    <h4>
     <a id="draw_circle_167">
     </a>
     draw_circle()
    </h4>
    <p>
     以绘制圆为例，封装一个方法如下：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//...</span>
    <span class="token comment">// ================= 方法 =================</span>
    <span class="token function">draw_circle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 样式设定</span>
        ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> border<span class="token punctuation">;</span>      <span class="token comment">// 轮廓样式</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> border_width<span class="token punctuation">;</span>  <span class="token comment">// 轮廓线宽</span>
        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> fill<span class="token punctuation">;</span>          <span class="token comment">// 填充样式</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dash <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dash<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">//虚线样式</span>
            ctx<span class="token punctuation">.</span><span class="token function">setLineDash</span><span class="token punctuation">(</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 主体路径</span>
        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 填充和轮廓绘制</span>
        ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     测试：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_circle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3f11a9b9cbeff2740878e6f8af20568a.png#pic_center" width="300"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_circle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">"#444"</span><span class="token punctuation">,</span><span class="token string">"#eee"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0c60c8e62d268f024bc4335e7c333800.png#pic_center" width="300"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_circle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">"#FF5722"</span><span class="token punctuation">,</span><span class="token string">"#F0F4C3"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/61563323f98c996fbdfbb60cd2ec59a6.png#pic_center" width="300"/>
    </p>
    <h4>
     <a id="draw_circle_221">
     </a>
     对draw_circle()的改进
    </h4>
    <p>
     可以看到对轮廓和填充样式的设定，以及调用
     <code>
      fill()
     </code>
     和
     <code>
      stroke()
     </code>
     进行绘制，对于每个绘图函数封装都是必须且重复的，所以可以将代码提炼出来，作为单独的方法。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
    <span class="token comment">// ================= 方法 =================</span>
    <span class="token comment">// 设定绘图样式</span>
    <span class="token function">set_draw_style</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 样式设定</span>
        ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> border<span class="token punctuation">;</span>      <span class="token comment">// 轮廓样式</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> border_width<span class="token punctuation">;</span>  <span class="token comment">// 轮廓线宽</span>
        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> fill<span class="token punctuation">;</span>          <span class="token comment">// 填充样式</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dash <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dash<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">//虚线样式</span>
            ctx<span class="token punctuation">.</span><span class="token function">setLineDash</span><span class="token punctuation">(</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 填充和轮廓绘制</span>
    <span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>border <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> border_width <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fill <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw_circle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token comment">// 设定绘图样式</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set_draw_style</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 主体路径</span>
        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 填充和轮廓绘制</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     进一步的还可以改进为：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
    <span class="token comment">// ================= 方法 =================</span>
    <span class="token comment">// 设定绘图样式</span>
    <span class="token function">set_draw_style</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 样式设定</span>
        ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> border<span class="token punctuation">;</span>      <span class="token comment">// 轮廓样式</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> border_width<span class="token punctuation">;</span>  <span class="token comment">// 轮廓线宽</span>
        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> fill<span class="token punctuation">;</span>          <span class="token comment">// 填充样式</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dash <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dash<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">//虚线样式</span>
            ctx<span class="token punctuation">.</span><span class="token function">setLineDash</span><span class="token punctuation">(</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 填充和轮廓绘制</span>
    <span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>border <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> border_width <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fill <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw_circle</span><span class="token punctuation">(</span><span class="token parameter">cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token comment">// 主体路径</span>
        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     两种方式各有利弊吧，第二种形式更像是将原来的设定样式工作和填充和轮廓绘制工作整体封装起来，绘图函数的参数也可以更加简化。
    </p>
    <p>
     我更倾向于第一种设计，因为每绘制一个图形只需要调用一个方法，而不是两个。
    </p>
    <h4>
     <a id="_306">
     </a>
     绘制折线和多边形
    </h4>
    <hr/>
    <p>
     <strong>
      Javascript不定参数函数设计
     </strong>
    </p>
    <p>
     在ES6之前，JavaScript中处理不定参数的常用方法是使用arguments对象，ES6引入了Rest参数，用来创建更清晰和简洁的代码。Rest参数通过在参数名前加上…来表示，它将所有剩余的参数收集到一个数组中。
    </p>
    <hr/>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
     <span class="token comment">// 直线和折线</span>
    <span class="token function">draw_polyline</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span>close <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>points<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> points<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">// 至少有2个点，而且的数量是2的整数倍</span>
            <span class="token comment">// 设定绘图样式</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set_draw_style</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 绘图线段</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>points<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//偶数项</span>
                    <span class="token keyword">let</span> x <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 设定路径是否闭合</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>close <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
             <span class="token comment">// 填充和轮廓绘制</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token comment">// 多边形</span>
    <span class="token function">draw_polygon</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/926caa4f14a6aa85f3cc538ebefbf769.png#pic_center" width="300"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">"#000"</span><span class="token punctuation">,</span><span class="token string">"#abc"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e855bcffc556d17bf0fb2e18ecbcb42f.png#pic_center" width="300"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string">"#000"</span><span class="token punctuation">,</span><span class="token string">"#abc"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9b3a264893839dcc595cb9aa51893eb3.png#pic_center" width="300"/>
    </p>
    <p>
     也可以直接使用
     <code>
      draw_polygon
     </code>
     ：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_polygon</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"#000"</span><span class="token punctuation">,</span><span class="token string">"#abc"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_379">
     </a>
     鼠标事件监听
    </h3>
    <p>
     可以使用以下两种方式监听鼠标事件：
    </p>
    <pre><code class="prism language-javascript">canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function-variable function">onmousedown</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 事件处理代码</span>
<span class="token punctuation">}</span>
canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousedown"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 事件处理代码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="clientXclientY_391">
     </a>
     clientX和clientY
    </h4>
    <p>
     Event对象有clientX和clientY两个属性：
    </p>
    <pre><code class="prism language-javascript">canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     上面的代码，只有鼠标再canvas的矩形范围内才会在控制台输出，但是打印的clientX和clientY是基于整个页面的，而不是canvas自己的坐标，所以我们还需要转化一下。
    </p>
    <hr/>
    <p>
     <strong>
      获取HTML元素的矩形
     </strong>
    </p>
    <p>
     <code>
      Element.getBoundingClientRect()
     </code>
     方法返回一个
     <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/DOMRect" rel="nofollow">
      DOMRect
     </a>
     对象，其提供了元素的大小及其相对于
     <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Viewport" rel="nofollow">
      视口
     </a>
     的位置。
    </p>
    <p>
     是包含整个元素的最小矩形（包括
     <code>
      padding
     </code>
     和
     <code>
      border-width
     </code>
     ）。该对象使用
     <code>
      left
     </code>
     、
     <code>
      top
     </code>
     、
     <code>
      right
     </code>
     、
     <code>
      bottom
     </code>
     、
     <code>
      x
     </code>
     、
     <code>
      y
     </code>
     、
     <code>
      width
     </code>
     和
     <code>
      height
     </code>
     这几个以像素为单位的只读属性描述整个矩形的位置和大小。除了
     <code>
      width
     </code>
     和
     <code>
      height
     </code>
     以外的属性是相对于视图窗口的左上角来计算的。
    </p>
    <hr/>
    <p>
     改成如下形式，就可以获取canvas内的局部坐标了：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> rect <span class="token operator">=</span> canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>x<span class="token punctuation">,</span>e<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     封装方法，简化代码：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span>height<span class="token punctuation">,</span>p_node <span class="token operator">=</span> document<span class="token punctuation">.</span>body</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token comment">// ================= 方法 =================</span>
    <span class="token function">get_rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 获取矩形边界框</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">to_local</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 将全局坐标转换为canvas局部坐标</span>
        <span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get_rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>x <span class="token operator">-</span> rect<span class="token punctuation">.</span>x<span class="token punctuation">,</span>y <span class="token operator">-</span> rect<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw_circle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token parameter">border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>close <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token operator">...</span>positions</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token function">draw_polygon</span><span class="token punctuation">(</span><span class="token parameter">border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span><span class="token operator">...</span>positions</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     测试代码改写为：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span><span class="token function">to_local</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_452">
     </a>
     画布清除
    </h3>
    <p>
     clearRect
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span>height<span class="token punctuation">,</span>p_node <span class="token operator">=</span> document<span class="token punctuation">.</span>body</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token comment">// ================= 方法 =================</span>
    <span class="token function">get_rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token function">to_local</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 清空画布</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw_circle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token parameter">border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>close <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token operator">...</span>positions</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token function">draw_polygon</span><span class="token punctuation">(</span><span class="token parameter">border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span><span class="token operator">...</span>positions</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     测试代码：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_circle</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousedown"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    canvas<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     初始绘制一个圆，点击画布后清空。
    </p>
    <h3>
     <a id="_484">
     </a>
     绘制水平和垂直间隔线
    </h3>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/65fb3fc9c8580e26480e1d176b21de59.png#pic_center" width="300"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_vlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e910b949464c17417c89db744eb1bd49.png#pic_center" width="300"/>
    </p>
    <p>
     :::tips
     <br/>
     <strong>
      Edge浏览器对canvas另存为和复制的支持
     </strong>
    </p>
    <p>
     现在的Edge浏览器好像直接支持将canvas绘制的内容当做是类似img插入的图片，可以直接另存和复制。这相当于，你拥有了基于浏览器的图片创建能力。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e2023d6118826890b0f7d5bf5fcc36ad.png#pic_center" width="500"/>
    </p>
    <p>
     :::
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"#ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_vlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"#ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9f77d3ce3b3442ceb74e9f48320c7aaf.png#pic_center" width="300"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"#ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_vlines</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"#ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"#444"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">draw_vlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"#444"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8cd73a5b637e81e262aebb43a5b3705b.png#pic_center" width="300"/>
    </p>
    <h3>
     <a id="_527">
     </a>
     动态绘制辅助线
    </h3>
    <pre><code class="prism language-javascript"><span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始绘制</span>

<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//主体绘制部分</span>
    canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"#ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">draw_vlines</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token string">"#ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">draw_hlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"#444"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">draw_vlines</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"#444"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 鼠标移动</span>
canvas<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    canvas<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">draw_help_lines</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9245ac8fbfed1550c41db938f9df6b13.gif#pic_center" width="300"/>
    </p>
    <h3>
     <a id="_549">
     </a>
     绘制图片
    </h3>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token comment">// 创建并添加一个canvas</span>
<span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1200</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"godot.png"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/2ecf5105e0ca7594b3e3310f1c663627.png#pic_center" width="300"/>
    </p>
    <h3>
     <a id="_574">
     </a>
     全屏
    </h3>
    <h3>
     <a id="font_stylecolorrgb33_37_41requestAnimationFramefont_575">
     </a>
     requestAnimationFrame
    </h3>
    <p>
     <a href="https://segmentfault.com/a/1190000044314827" rel="nofollow">
      前端 - 浅析requestAnimationFrame的用法与优化 - 个人文章 - SegmentFault 思否
     </a>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">animation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 绘制代码</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animation<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//结束后调用</span>
<span class="token punctuation">}</span>

<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animation<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 第一次调用</span>
</code></pre>
    <h4>
     <a id="requestAnimationFrame_587">
     </a>
     基于requestAnimationFrame的动画
    </h4>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token comment">// 创建并添加一个canvas</span>
<span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 矩形的起点和宽高</span>
<span class="token keyword">let</span> x<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> w<span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> h<span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> deltaX <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 绘制函数</span>
<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 绘制逻辑</span>
    ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除上一帧绘制内容</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&gt;</span> canvas<span class="token punctuation">.</span>width <span class="token operator">-</span> w <span class="token operator">||</span> x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        deltaX <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    x <span class="token operator">+=</span> deltaX<span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span>
    <span class="token comment">// 下一帧</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用绘制函数</span>
<span class="token punctuation">}</span>


window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用绘制函数</span>
</code></pre>
    <p>
     实现了动画：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8c5ed8097a382d2b24bc1747ce768bc0.gif#pic_center" width="300"/>
    </p>
    <h3>
     <a id="saverestore_627">
     </a>
     save()和restore()
    </h3>
    <p>
     <a href="https://blog.csdn.net/YMX2020/article/details/118516852">
      canvas理解：一看就懂的save和restore_canvas save restore-CSDN博客
     </a>
    </p>
    <ul>
     <li>
      <code>
       save()
      </code>
      保存上下文的边线、填充以及线性变换状态，每次保存状态压入栈内
     </li>
     <li>
      <code>
       restore()
      </code>
      弹出并恢复栈顶的上下文状态
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token comment">// draw.js</span>
<span class="token comment">// 创建并添加一个canvas</span>
<span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">"red"</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存状态</span>


ctx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">"yellow"</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ctx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//恢复状态</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">"green"</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <code>
       ctx.translate(50,50);
      </code>
      是对
      <strong>
       画布的绘制位置
      </strong>
      进行了偏移，类似于GDScript中
      <code>
       CanvasItem
      </code>
      的
      <code>
       set_tramsform()
      </code>
      用法。
     </li>
    </ul>
    <h3>
     <a id="_658">
     </a>
     完整代码
    </h3>
    <pre><code class="prism language-javascript"><span class="token comment">// Canvas2D.js</span>
<span class="token comment">// 2D canvas 辅助类</span>
<span class="token keyword">class</span> <span class="token class-name">Canvas2D</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span>height<span class="token punctuation">,</span>p_node <span class="token operator">=</span> document<span class="token punctuation">.</span>body</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
        p_node<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ================= 绘图样式 =================</span>
    <span class="token comment">// 设定绘图样式</span>
    <span class="token function">set_draw_style</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 样式设定</span>
        ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> border<span class="token punctuation">;</span>      <span class="token comment">// 轮廓样式</span>
        ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> border_width<span class="token punctuation">;</span>  <span class="token comment">// 轮廓线宽</span>
        ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> fill<span class="token punctuation">;</span>          <span class="token comment">// 填充样式</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dash <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dash<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">//虚线样式</span>
            ctx<span class="token punctuation">.</span><span class="token function">setLineDash</span><span class="token punctuation">(</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">setLineDash</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 填充和轮廓绘制</span>
    <span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>border <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> border_width <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fill <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ================= 基础图形绘制 =================</span>
    <span class="token comment">// 圆</span>
    <span class="token function">draw_circle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token comment">// 设定绘图样式</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set_draw_style</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 主体路径</span>
        ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span>cy<span class="token punctuation">,</span>radius<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 填充和轮廓绘制</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 直线和折线</span>
    <span class="token function">draw_polyline</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span>close <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ctx <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>points<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> points<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">// 至少有2个点，而且的数量是2的整数倍</span>
            <span class="token comment">// 设定绘图样式</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set_draw_style</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 绘图线段</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>points<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//偶数项</span>
                    <span class="token keyword">let</span> x <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 设定路径是否闭合</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>close <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
             <span class="token comment">// 填充和轮廓绘制</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stroke_and_fill</span><span class="token punctuation">(</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token comment">// 多边形</span>
    <span class="token function">draw_polygon</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>fill <span class="token operator">=</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>border<span class="token punctuation">,</span>fill<span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ================= 矩形与坐标 =================</span>
    <span class="token function">get_rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 获取矩形边界框</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">full_screen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 全屏 - 设置canvas的尺寸为页面尺寸</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span>  window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span>  window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">to_local</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 将全局坐标转换为canvas局部坐标</span>
        <span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get_rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>x <span class="token operator">-</span> rect<span class="token punctuation">.</span>x<span class="token punctuation">,</span>y <span class="token operator">-</span> rect<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     <span class="token comment">// ================= 矩形与坐标 =================</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 清空画布</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ================= 网格线 =================</span>
    <span class="token function">draw_hlines</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">// 绘制水平间隔线</span>
        <span class="token keyword">const</span> dh <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">/</span> num<span class="token punctuation">;</span>
        <span class="token keyword">const</span> w <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>dh <span class="token operator">*</span> i<span class="token punctuation">,</span>w<span class="token punctuation">,</span>dh <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>border<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">draw_vlines</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"#000"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">// 绘制垂直间隔线</span>
        <span class="token keyword">const</span> dw <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">/</span> num<span class="token punctuation">;</span>
        <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dw <span class="token operator">*</span> i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>dw <span class="token operator">*</span> i<span class="token punctuation">,</span>h<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>border<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ================= 辅助线 =================</span>
    <span class="token function">draw_help_lines</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>border <span class="token operator">=</span> <span class="token string">"orange"</span><span class="token punctuation">,</span>border_width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>dash <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 绘制水平和垂直辅助线</span>
        <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token keyword">const</span> w <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        <span class="token keyword">const</span> local <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">to_local</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>local<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>local<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>border<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw_polyline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>local<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>local<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>h<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>border<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>border_width<span class="token punctuation">,</span>dash<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f67726179706967656e313939302f:61727469636c652f64657461696c732f313436323137313939" class_="artid" style="display:none">
 </p>
</div>


