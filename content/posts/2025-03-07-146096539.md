---
layout: post
title: "DeepSeek-ReAct-实现-Agent"
date: 2025-03-07 15:15:41 +0800
description: "借助DeepSeek强大的推理能力，再结合ReAct框架的驱动，我们可以非常方便地实现一个初级的AI Agent"
keywords: "DeepSeek + ReAct 实现 Agent"
categories: ['Llm']
tags: ['人工智能', 'Deepseek', 'Chatgpt', 'Aigc', 'Ai']
artid: "146096539"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146096539
    alt: "DeepSeek-ReAct-实现-Agent"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146096539
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146096539
cover: https://bing.ee123.net/img/rand?artid=146096539
image: https://bing.ee123.net/img/rand?artid=146096539
img: https://bing.ee123.net/img/rand?artid=146096539
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     DeepSeek + ReAct 实现 Agent
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1__0">
     </a>
     1. 大模型自身的局限
    </h2>
    <p>
     最近 DeepSeek 的爆火，再一次点燃了大家对于大模型的热情，身边很多日常不关注 AI 领域的人，也开始交流 DeepSeek 的使用体验。
     <strong>
      DeepSeek 的确非常强大，它将推理能力拉齐到了 GPT 水平的同时，还大幅降低了训练成本，成为当下最炙手可热的大模型
     </strong>
     。
    </p>
    <p>
     但是，即使像 DS 如此强大的大模型，它也不是万能的，有一些问题它也回答不了，特别是一些垂直领域的知识或实时性比较高的知识。比如我们想做一个居家生活小助手，直接调用 DeepSeek 是行不通的（未开启联网搜索的情况下）。
    </p>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/91e7bc65a963cea65627efc86dff434a.png"/>
    </p>
    <p>
     那么如何解决这个问题呢？
     <strong>
      每当我们遇到这种需要模型做自主判断、自行调用工具、自行决定下一步行动的时候，Agent 就轮到出场了。
     </strong>
    </p>
    <h2>
     <a id="Agent__14">
     </a>
     Agent 概述
    </h2>
    <p>
     后面有机会我们会详细讲解下 AI Agent，这里简单理解：
     <strong>
      Agent 是一种基于 LLM 驱动的、能够自主感知周围环境、做出决策、采取行动达成特定目标的系统。一个 Agent 系统的整体架构如下：
     </strong>
    </p>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/724efe30a653f3937ee3f926dd64c967.jpeg"/>
    </p>
    <p>
     一个 Agent 通常包含了以下几个关键模块：
    </p>
    <ul>
     <li>
      <strong>
       规划（Planning）
      </strong>
      ：它负责将大目标分解成小的子目标，也可以对已有行为进行反思和自我改善。
     </li>
     <li>
      <strong>
       记忆（Memory）
      </strong>
      ：包括短期记忆和长期记忆，短期记忆提供上下文内的学习，长期记忆则提供长时间保留和回忆信息的能力。
     </li>
     <li>
      <strong>
       工具（Tools）
      </strong>
      ：通过调用外部 API 获取外部信息（作为感知器），执行外部动作（作为执行器）。
     </li>
    </ul>
    <p>
     Agent 看起来是一个非常复杂的系统，但是实际上有一种快速的实现方式，那就是
     <strong>
      LLM + ReAct 框架
     </strong>
     。那么什么是 ReAct 呢？
    </p>
    <h2>
     <a id="ReAct__30">
     </a>
     ReAct 核心原理
    </h2>
    <p>
     <strong>
      ReAct 实际上是两个单词的缩写：Reasoning + Acting，也就是推理 + 行动，它是一个引导大语言模型进行推理和行动的思维框架。在《ReAct: Synergizing Reasoning and Acting in Language Models》这篇论文中首次提出。
     </strong>
    </p>
    <p>
     我们引用论文中的示例来解释一下。假设我们想要问大模型这样一个问题：
    </p>
    <blockquote>
     <p>
      除了苹果遥控器，还有哪些设备可以控制苹果遥控器最初设计用来交互的程序?Aside from the Apple Remote, what other devices can control the program Apple Remote was originally designed to interact with?
     </p>
    </blockquote>
    <p>
     使用 ReAct 框架，可以引导大模型进行如下的推理：
    </p>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/a3c1e8024be364e7deef4a39d27ae90f.jpeg"/>
    </p>
    <p>
     <strong>
      在这个例子中，大模型为了完成一个复杂任务时，首先会进行子任务拆分，且每个子任务的执行都会经过如下几个阶段：
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       Thought 思考
      </strong>
      ：大模型根据任务进行思考和推理，制定执行计划。
     </li>
     <li>
      <strong>
       Action 行动
      </strong>
      ：大模型从可用的工具列表中筛选出可用的工具，执行具体的动作。
     </li>
     <li>
      <strong>
       Observation 观察
      </strong>
      ：动作执行完成后，由大模型观察执行结果，并判断是继续下一步动作，还是执行结束返回结果。
     </li>
    </ul>
    <p>
     理论好像大概了解了，但具体要如何实现呢？
     <strong>
      下面我们就基于 DeepSeek 大模型 + ReAct 框架，实现一个简单的 Agent，解决文章开头提出的那个查询水果价格的问题。
     </strong>
    </p>
    <h2>
     <a id="ReAct_Agent__58">
     </a>
     ReAct Agent 实战
    </h2>
    <h3>
     <a id="_api_key_60">
     </a>
     申请 api_key
    </h3>
    <p>
     一步一步来。首先，我们需要搞定 DeepSeek 的 api_key。
    </p>
    <p>
     最近 DeepSeek 实在太火了，由于算力和资源的限制，DeepSeek 的官方平台可能没有那么稳定，我们可以考虑使用大厂的云平台，比如阿里云百炼，使用阿里云私有部署的 DeepSeek 模型。具体的流程就不展开了，大家按照官网的说明操作即可。
    </p>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/0bb469b99337c48d6130968225048eb8.png"/>
    </p>
    <h3>
     <a id="_Tools__70">
     </a>
     定义 Tools 工具
    </h3>
    <p>
     **工具本质上就是我们为大模型提供的扩展能力，它可以是一些 Open API（如 Google 搜索、高德天气等等），也可以是我们内部的一些函数，甚至是第三方的服务。**这里为了方便演示，我们实现一个本地的函数
     <code>
      query_fruit_unit_price
     </code>
     作为工具, 它以 Mock 的方式查询水果的价格。另外，我们也针对该工具编写标准的调用参数：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@Time    : 2025/3/4 20:35 
@Author  : ZhangShenao 
@File    : tools.py 
@Desc    : 工具模块
"""</span>


<span class="token keyword">def</span> <span class="token function">query_fruit_unit_price</span><span class="token punctuation">(</span>fruit_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    查询水果单价
    :param fruit_name: 水果名称
    :return: 水果单价
    """</span>
    <span class="token keyword">if</span> fruit_name <span class="token operator">==</span> <span class="token string">"苹果"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"2.8"</span>
    <span class="token keyword">if</span> fruit_name <span class="token operator">==</span> <span class="token string">"香蕉"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"1.6"</span>
    <span class="token keyword">return</span> <span class="token string">"未查询到该种类水果的价格"</span>


<span class="token comment"># 可以调用的外部工具描述</span>
TOOLS_DESCRIPTION <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"query_fruit_unit_price"</span><span class="token punctuation">,</span>
        <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"使用该工具可以查询到指定种类水果的单价"</span><span class="token punctuation">,</span>
        <span class="token string">"parameters"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
            <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"fruit_name"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"水果名称"</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"fruit_name"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
    <h3>
     <a id="_Promot_116">
     </a>
     构造 Promot
    </h3>
    <p>
     ReAct 的 Prompt 比较复杂，但是我们并不需要自己探索，因为
     <strong>
      LangChain 官方的 Prompt Hub 中已经提供了一个 Prompt 模版，个人认为这是一段可以封神的 Promopt，我们直接拿来用就可以了
     </strong>
     。
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">{<!-- --></span>instructions<span class="token punctuation">}</span>

TOOLS:
------

You have access to the following tools:

<span class="token punctuation">{<!-- --></span>tools<span class="token punctuation">}</span>

To use a tool, please use the following format:

``<span class="token variable"><span class="token variable">`</span>
Thought: Do I need to use a tool? Yes
Action: the action to take, should be one of <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>tool_names<span class="token punctuation">}</span><span class="token punctuation">]</span>
Action Input: the input to the action
Observation: the result of the action
<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span>

When you have a response to say to the Human, or <span class="token keyword">if</span> you <span class="token keyword">do</span> not need to use a tool, you MUST use the format:

<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span>
Thought: Do I need to use a tool? No
Final Answer: <span class="token punctuation">[</span>your response here<span class="token punctuation">]</span>
<span class="token variable">`</span></span>``

Begin<span class="token operator">!</span>

Previous conversation history:
<span class="token punctuation">{<!-- --></span>chat_history<span class="token punctuation">}</span>

New input: <span class="token punctuation">{<!-- --></span>input<span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span>agent_scratchpad<span class="token punctuation">}</span>
</code></pre>
    <p>
     这段 Prompt 中主要包含下面这些关键内容：
    </p>
    <ul>
     <li>
      instructions：类似 System Prompt，是为大模型设置的指令和人设。
     </li>
     <li>
      tools：定义工具列表和描述信息，告诉大模型有哪些工具是可以使用的，并且具体的用法是什么。
     </li>
     <li>
      chat_history：聊天历史，即对话的上下文信息。
     </li>
     <li>
      agent_scratchpad：这是一个 Agent 剪贴板，用于记录 Agent 的思考过程。这部分是可选的，并不影响整个 Agent 的执行过程。
     </li>
    </ul>
    <p>
     对这段 Prompt 进行格式化，就可以生成一个完整的 ReAct Prompt 了。
    </p>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@Time    : 2025/3/4 20:37 
@Author  : ZhangShenao 
@File    : prompt.py 
@Desc    : prompt提示词模块
"""</span>
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict

<span class="token comment"># ReAct Prompt模板</span>
REACT_PROMPT_TEMPLATE <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
{instructions}

TOOLS:
------

You have access to the following tools:

{tools}

To use a tool, please use the following format:

```
Thought: Do I need to use a tool? Yes
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
```

Then wait for Human will response to you the result of action by use Observation.
... (this Thought/Action/Action Input/Observation can repeat N times)
When you have a response to say to the Human, or if you do not need to use a tool, you MUST use the format:

```
Thought: Do I need to use a tool? No
Final Answer: [your response here]
```

Begin!

New input: {input}

"""</span>


<span class="token keyword">def</span> <span class="token function">build_react_prompt</span><span class="token punctuation">(</span>instructions<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> tool_desc<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">,</span> tool_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    构造ReAct Prompt
    :param instructions: 系统指令
    :param query: 用户的提问
    :param tool_desc: 外部工具描述
    :param tool_name: 外部工具名称
    :return: React Prompt
    """</span>

    <span class="token keyword">return</span> REACT_PROMPT_TEMPLATE<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>instructions<span class="token operator">=</span>instructions<span class="token punctuation">,</span>
                                        tools<span class="token operator">=</span>tool_desc<span class="token punctuation">,</span>
                                        tool_names<span class="token operator">=</span>tool_name<span class="token punctuation">,</span>
                                        <span class="token builtin">input</span><span class="token operator">=</span>query<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_LLM_229">
     </a>
     封装 LLM
    </h3>
    <p>
     接下来，我们对大模型进行一些简单的封装，便于后面的调用。
    </p>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@Time    : 2025/3/4 20:45 
@Author  : ZhangShenao 
@File    : llm.py 
@Desc    : LLM大模型模块
"""</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict

<span class="token keyword">import</span> dotenv
<span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI<span class="token punctuation">,</span> Stream
<span class="token keyword">from</span> openai<span class="token punctuation">.</span>types<span class="token punctuation">.</span>chat <span class="token keyword">import</span> ChatCompletion<span class="token punctuation">,</span> ChatCompletionChunk


<span class="token keyword">class</span> <span class="token class-name">LLM</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        初始化LLM大模型
        :param model_name: LLM大模型名称
        """</span>

        <span class="token comment"># 加载环境变量</span>
        dotenv<span class="token punctuation">.</span>load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 创建通义百炼客户端,兼容OpenAI协议</span>
        self<span class="token punctuation">.</span>_client <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>
            api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"DASHSCOPE_API_KEY"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            base_url<span class="token operator">=</span><span class="token string">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_model_name <span class="token operator">=</span> model_name

    <span class="token keyword">def</span> <span class="token function">send_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> messages<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ChatCompletion <span class="token operator">|</span> Stream<span class="token punctuation">[</span>ChatCompletionChunk<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        发送消息
        :param messages: 消息列表
        :return: 消息发送结果
        """</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
            model<span class="token operator">=</span>self<span class="token punctuation">.</span>_model_name<span class="token punctuation">,</span>
            messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_Agent_279">
     </a>
     执行 Agent
    </h3>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@Time    : 2025/3/4 20:45 
@Author  : ZhangShenao 
@File    : agent.py 
@Desc    : Agent模块
"""</span>
<span class="token keyword">import</span> json
<span class="token keyword">import</span> re

<span class="token keyword">from</span> llm <span class="token keyword">import</span> LLM
<span class="token keyword">from</span> prompt <span class="token keyword">import</span> build_react_prompt
<span class="token keyword">from</span> tools <span class="token keyword">import</span> TOOLS_DESCRIPTION<span class="token punctuation">,</span> query_fruit_unit_price

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 构造Prompt</span>
    instructions <span class="token operator">=</span> <span class="token string">"你是一个居家生活小助手，可以回答用户的日常问题。"</span>
    query <span class="token operator">=</span> <span class="token string">"我想买2个苹果和3根香蕉，一共需要多少钱？"</span>
    prompt <span class="token operator">=</span> build_react_prompt<span class="token punctuation">(</span>instructions<span class="token operator">=</span>instructions<span class="token punctuation">,</span>
                                query<span class="token operator">=</span>query<span class="token punctuation">,</span>
                                tool_desc<span class="token operator">=</span>TOOLS_DESCRIPTION<span class="token punctuation">,</span>
                                tool_name<span class="token operator">=</span><span class="token string">"query_fruit_unit_price"</span><span class="token punctuation">,</span>
                                <span class="token punctuation">)</span>

    <span class="token comment"># 创建LLM</span>
    llm <span class="token operator">=</span> LLM<span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">"deepseek-v3"</span><span class="token punctuation">)</span>

    <span class="token comment"># 保存上下文</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"初始提问: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>prompt<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">]</span>

    <span class="token comment"># 执行ReAct过程</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> llm<span class="token punctuation">.</span>send_msg<span class="token punctuation">(</span>messages<span class="token punctuation">)</span>
        response_text <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"大模型的回复：\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>response_text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

        <span class="token comment"># 通过正则表达式匹配,判断是否结束执行</span>
        final_answer_match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'Final Answer:\s*(.*)'</span><span class="token punctuation">,</span> response_text<span class="token punctuation">)</span>
        <span class="token keyword">if</span> final_answer_match<span class="token punctuation">:</span>
            final_answer <span class="token operator">=</span> final_answer_match<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最终答案:"</span><span class="token punctuation">,</span> final_answer<span class="token punctuation">)</span>
            <span class="token keyword">break</span>

        <span class="token comment"># 保存上下文</span>
        messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span>

        <span class="token comment"># 通过正则表达式匹配,解析Function Calling参数</span>
        action_match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'Action:\s*(\w+)'</span><span class="token punctuation">,</span> response_text<span class="token punctuation">)</span>
        action_input_match <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'Action Input:\s*({.*?}|".*?")'</span><span class="token punctuation">,</span> response_text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>DOTALL<span class="token punctuation">)</span>

        <span class="token comment"># 匹配需要调用的工具</span>
        <span class="token keyword">if</span> action_match <span class="token keyword">and</span> action_input_match<span class="token punctuation">:</span>
            tool_name <span class="token operator">=</span> action_match<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            params <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>action_input_match<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"需要执行Function Calling, 工具名称: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>tool_name<span class="token punctuation">}</span></span><span class="token string">, 调用参数: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>params<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

            <span class="token comment"># 调用工具,获取执行结果</span>
            <span class="token keyword">if</span> tool_name <span class="token operator">==</span> <span class="token string">"query_fruit_unit_price"</span><span class="token punctuation">:</span>
                observation <span class="token operator">=</span> query_fruit_unit_price<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token string">'fruit_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"工具的执行结果: \n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>observation<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token punctuation">)</span>

                <span class="token comment"># 保存上下文</span>
                messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Observation: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>observation<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     可以看到完整执行过程：
    </p>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/82b08361ed77b874d6d0001f0d1f9b39.png"/>
    </p>
    <p>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/59d84638dd0cf3cfafd6c107c799e2ac.png"/>
    </p>
    <p>
     从执行过程可以看出，大模型主要进行了以下的推理过程：
    </p>
    <ol>
     <li>
      Planning：判断出需要调用工具。
     </li>
     <li>
      Action：生成实际的 Function Calling 参数。
     </li>
     <li>
      Observation: 工具调用完成后，观察执行结果，最终生成回答。
     </li>
    </ol>
    <p>
     可以看出：
     <strong>
      基于 DeepSeek 模型强大的推理能力，再结合 ReAct 框架的驱动，我们非常轻松就可以实现一个简单的 Agent。
     </strong>
    </p>
    <p>
     最后，对于以上的实现做出一些提示：
    </p>
    <ul>
     <li>
      <strong>
       这里我们使用的是 DeepSeek-V3 这个 Chat Model，而并没有选择 DeepSeek-R1 这个 Reasoning Model，因为在我们的场景里，模型的推理能力是由 ReAct Prompt 驱动的，而 DeepSeek-R1 自身内置了思维链，可能与我们的 Prompt 产生冲突。
      </strong>
     </li>
     <li>
      最终的执行结果在不同的模型上可能有差异，特别是一些小参数模型，可能无法识别出工具调用，进而产生幻觉。
     </li>
     <li>
      在我们的实现中，工具参数调用的解析是基于正则表达式匹配来完成的，这种方式可能存在一定的误差，可以采用大模型的 Function Calling 功能来优化，但是需要对 Prompt 进行一些改造，这个工作就留给大家来完成了。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33343435323835302f:61727469636c652f64657461696c732f313436303936353339" class_="artid" style="display:none">
 </p>
</div>


