---
layout: post
title: "Python调用CC的种种方法"
date: 2024-04-28 15:47:01 +0800
description: "Python调用C/C++的种种方法_python 模块的 wrap 只有psaa 何调用c++"
keywords: "python 模块的 wrap 只有psaa 何调用c++"
categories: ['Python', 'C']
tags: ['无标签']
artid: "77102445"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=77102445
    alt: "Python调用CC的种种方法"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=77102445
featuredImagePreview: https://bing.ee123.net/img/rand?artid=77102445
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python调用C/C++的种种方法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="article_title" style='margin:5px 0px; font-size:20px; line-height:30px; font-family:"Microsoft YaHei"'>
     <h2 style="margin:0px; padding:0px; display:inline; font-weight:normal; font-size:20px; line-height:30px; vertical-align:middle">
      <span class="link_title">
       <a href="http://blog.csdn.net/fxjtoday/article/details/6059874" rel="noopener noreferrer" style="color:rgb(0,0,0); text-decoration:none" target="_blank">
        Python调用C/C++的种种方法
       </a>
      </span>
     </h2>
    </div>
    <div class="article_title" style='margin:5px 0px; font-size:20px; line-height:30px; font-family:"Microsoft YaHei"'>
     原文：http://blog.csdn.net/fxjtoday/article/details/6059874
    </div>
    <div class="article_content tracking-ad" id="article_content" style="margin:20px 0px 0px; font-size:14px; line-height:26px; font-family:Arial; color:rgb(51,51,51)">
     <p>
      <a class="replace_word" href="http://lib.csdn.net/base/python" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Python知识库">
       Python
      </a>
      是解释性语言, 底层就是用c实现的, 所以用
      <a class="replace_word" href="http://lib.csdn.net/base/python" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title="Python知识库">
       python
      </a>
      调用C是很容易的, 下面就总结一下各种调用的方法, 给出例子, 所有例子都在ubuntu9.10, python2.6下试过.
     </p>
     <p>
     </p>
     <p>
      <span style="font-size:12px">
       <strong>
        1. Python 调用 C (base)
       </strong>
      </span>
     </p>
     <p>
      想在python中调用c函数, 如这儿的fact
     </p>
     <p>
      #include &lt;Python.h&gt;
      <br/>
      <br/>
      int fact(int n)
      <br/>
      {
      <!-- -->
      <br/>
      if (n &lt;= 1)
      <br/>
      return 1;
      <br/>
      else
      <br/>
      return n * fact(n - 1);
      <br/>
      }
      <br/>
      <br/>
      PyObject* wrap_fact(PyObject* self, PyObject* args)
      <br/>
      {
      <!-- -->
      <br/>
      int n, result;
      <br/>
      <br/>
      if (! PyArg_ParseTuple(args, "i:fact", &amp;n))
      <br/>
      return NULL;
      <br/>
      result = fact(n);
      <br/>
      return Py_BuildValue("i", result);
      <br/>
      }
      <br/>
      <br/>
      static PyMethodDef exampleMethods[] =
      <br/>
      {
      <!-- -->
      <br/>
      {"fact", wrap_fact, METH_VARARGS, "Caculate N!"},
      <br/>
      {NULL, NULL}
      <br/>
      };
      <br/>
      <br/>
      void initexample()
      <br/>
      {
      <!-- -->
      <br/>
      PyObject* m;
      <br/>
      m = Py_InitModule("example", exampleMethods);
      <br/>
      }
     </p>
     <p>
     </p>
     <p>
      把这段代码存为wrapper.c, 编成so库,
     </p>
     <p>
      gcc -fPIC wrapper.c -o example.so -shared  -I/usr/include/python2.6 -I/usr/lib/python2.6/config
     </p>
     <p>
     </p>
     <p>
      然后在有此so库的目录, 进入python, 可以如下使用
     </p>
     <p>
      import example
     </p>
     <p>
      example.fact(4)
     </p>
     <p>
     </p>
     <p>
      <strong>
       <span style="font-size:12px">
        2. Python 调用 C++ (base)
       </span>
      </strong>
     </p>
     <p>
      在python中调用C++类成员函数, 如下调用TestFact类中的fact函数,
     </p>
     <p>
      #include &lt;Python.h&gt;
      <br/>
      <br/>
      class TestFact{
      <!-- -->
      <br/>
      public:
      <br/>
      TestFact(){};
      <br/>
      ~TestFact(){};
      <br/>
      int fact(int n);
      <br/>
      };
      <br/>
      <br/>
      int TestFact::fact(int n)
      <br/>
      {
      <!-- -->
      <br/>
      if (n &lt;= 1)
      <br/>
      return 1;
      <br/>
      else
      <br/>
      return n * (n - 1);
      <br/>
      }
      <br/>
      <br/>
      int fact(int n)
      <br/>
      {
      <!-- -->
      <br/>
      TestFact t;
      <br/>
      return t.fact(n);
      <br/>
      }
     </p>
     <p>
      PyObject* wrap_fact(PyObject* self, PyObject* args)
      <br/>
      {
      <!-- -->
      <br/>
      int n, result;
      <br/>
      <br/>
      if (! PyArg_ParseTuple(args, "i:fact", &amp;n))
      <br/>
      return NULL;
      <br/>
      result = fact(n);
      <br/>
      return Py_BuildValue("i", result);
      <br/>
      }
      <br/>
      <br/>
      static PyMethodDef exampleMethods[] =
      <br/>
      {
      <!-- -->
      <br/>
      {"fact", wrap_fact, METH_VARARGS, "Caculate N!"},
      <br/>
      {NULL, NULL}
      <br/>
      };
      <br/>
      <br/>
      <span style="color:rgb(255,0,0)">
       extern "C"
      </span>
      //不加会导致找不到initexample
      <br/>
      void initexample()
      <br/>
      {
      <!-- -->
      <br/>
      PyObject* m;
      <br/>
      m = Py_InitModule("example", exampleMethods);
      <br/>
      }
     </p>
     <p>
     </p>
     <p>
      把这段代码存为wrapper.cpp, 编成so库,
     </p>
     <p>
      <span style="color:rgb(255,0,0)">
       g++
      </span>
      -fPIC wrapper.cpp -o example.so -shared -I/usr/include/python2.6 -I/usr/lib/python2.6/config
     </p>
     <p>
     </p>
     <p>
      然后在有此so库的目录, 进入python, 可以如下使用
     </p>
     <p>
      import example
     </p>
     <p>
      example.fact(4)
     </p>
     <p>
     </p>
     <p>
      <span style="font-size:12px">
       <strong>
        3. Python 调用 C++ (Boost.Python)
       </strong>
      </span>
     </p>
     <p>
      Boost库是非常强大的库, 其中的python库可以用来封装c++被python调用, 功能比较强大, 不但可以封装函数还能封装类, 类成员.
     </p>
     <p>
      http://dev.gameres.com/Program/Abstract/Building%20Hybrid%20Systems%20with%20Boost_Python.CHN.by.JERRY.htm
     </p>
     <p>
      首先在ubuntu下安装boost.python, apt-get install libboost-python-dev
     </p>
     <p>
      #include &lt;boost/python.hpp&gt;
      <br/>
      char const* greet()
      <br/>
      {
      <!-- -->
      <br/>
      return "hello, world";
      <br/>
      }
      <br/>
      <br/>
      BOOST_PYTHON_MODULE(hello)
      <br/>
      {
      <!-- -->
      <br/>
      using namespace boost::python;
      <br/>
      def("greet", greet);
      <br/>
      }
      <br/>
     </p>
     <p>
      把代码存为hello.cpp, 编译成so库
     </p>
     <p>
      g++ hello.cpp -o hello.so -shared -I/usr/include/python2.5 -I/usr/lib/python2.5/config -lboost_python-gcc42-mt-1_34_1
     </p>
     <p>
     </p>
     <p>
      此处python路径设为你的python路径, 并且必须加-lboost_python-gcc42-mt-1_34_1, 这个库名不一定是这个, 去/user/lib查
     </p>
     <p>
     </p>
     <p>
      然后在有此so库的目录, 进入python, 可以如下使用
     </p>
     <p>
      &gt;&gt;&gt; import hello
      <br/>
      &gt;&gt;&gt; hello.greet()
      <br/>
      'hello, world'
     </p>
     <p>
     </p>
     <p>
      <span style="font-size:12px">
       <strong>
        4. python 调用 c++ (ctypes)
       </strong>
      </span>
     </p>
     <p>
      <tt class="docutils literal">
       <span class="pre">
        ctypes
       </span>
      </tt>
      is an advanced ffi (Foreign Function Interface) package for
      <a class="reference" href="http://www.python.org/" rel="nofollow noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none" target="_blank">
       Python
      </a>
      2.3 and higher. In
      <a class="reference" href="http://www.python.org/" rel="nofollow noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none" target="_blank">
       Python
      </a>
      2.5 it is already included.
     </p>
     <p>
      ctypes allows to call functions in dlls/shared libraries and has extensive facilities to create, access and manipulate simple and complicated C data types in Python - in other words: wrap libraries in pure Python. It is even possible to implement C callback functions in pure Python.
     </p>
     <p>
      http://python
      <a class="replace_word" href="http://lib.csdn.net/base/dotnet" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold" target="_blank" title=".NET知识库">
       .NET
      </a>
      /crew/theller/ctypes/
     </p>
     <p>
     </p>
     <p>
      #include &lt;Python.h&gt;
      <br/>
      <br/>
      class TestFact{
      <!-- -->
      <br/>
      public:
      <br/>
      TestFact(){};
      <br/>
      ~TestFact(){};
      <br/>
      int fact(int n);
      <br/>
      };
      <br/>
      <br/>
      int TestFact::fact(int n)
      <br/>
      {
      <!-- -->
      <br/>
      if (n &lt;= 1)
      <br/>
      return 1;
      <br/>
      else
      <br/>
      return n * (n - 1);
      <br/>
      }
      <br/>
      <br/>
      extern "C"
      <br/>
      int fact(int n)
      <br/>
      {
      <!-- -->
      <br/>
      TestFact t;
      <br/>
      return t.fact(n);
      <br/>
      }
      <br/>
      将代码存为wrapper.cpp不用写python接口封装, 直接编译成so库,
     </p>
     <p>
      g++ -fPIC wrapper.cpp -o example.so -shared -I/usr/include/python2.6 -I/usr/lib/python2.6/config
     </p>
     <p>
     </p>
     <p>
      进入python, 可以如下使用
     </p>
     <p>
      &gt;&gt;&gt; import ctypes
      <br/>
      &gt;&gt;&gt; pdll = ctypes.CDLL('/home/ubuntu/tmp/example.so')
      <br/>
      &gt;&gt;&gt; pdll.fact(4)
      <br/>
      12
     </p>
    </div>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6a61636b65313231:2f61727469636c652f64657461696c732f3737313032343435" class_="artid" style="display:none">
 </p>
</div>


