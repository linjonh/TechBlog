---
arturl_encode: "68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34383333373536362f:61727469636c652f64657461696c732f313233353937333832"
layout: post
title: "ä¸€æ–‡å›¾è§£å‰ç«¯WebSocket-å®æ—¶é€šä¿¡"
date: 2022-03-20 13:03:28 +0800
description: "æœ¬æ–‡ä»‹ç»äº†WebSocketä½œä¸ºå…¨åŒå·¥é€šä¿¡åè®®çš„åŸºç¡€æ¦‚å¿µã€ä¼˜åŠ¿ï¼Œ"
keywords: "websocketå›¾è§£"
categories: ['åå°ç®¡ç†ç³»ç»Ÿ']
tags: ['å®æ—¶é€šä¿¡', 'åè®®', 'Websocket']
artid: "123597382"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123597382
    alt: "ä¸€æ–‡å›¾è§£å‰ç«¯WebSocket-å®æ—¶é€šä¿¡"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123597382
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123597382
---

# ä¸€æ–‡å›¾è§£å‰ç«¯WebSocket å®æ—¶é€šä¿¡

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/529103b3602e9c0ac4b69a42d2410544.png#pic_center)

### ğŸ’Œ ä½œè€…ç®€ä»‹

1. ğŸ“– ä¸ªäººä»‹ç»ï¼šå°ä¼™ä¼´ä»¬ï¼Œå¤§å®¶å¥½ï¼æˆ‘æ˜¯æ°´é¦™æœ¨é±¼ï¼Œã€
   `å‰ç«¯é¢†åŸŸåˆ›ä½œè€…`
   ã€‘ğŸ˜œ
2. ğŸ“œ CSDNä¸»é¡µï¼š
   [æ°´é¦™æœ¨é±¼](https://blog.csdn.net/weixin_48337566?type=blog)
3. ğŸ“‘ ä¸ªäººåšå®¢ï¼š
   [é™ˆæ˜¥æ³¢](https://shadow.org.cn)
4. ğŸ¨ ç³»åˆ—ä¸“æ ï¼š
   [ç½‘ç»œé€šä¿¡](https://blog.csdn.net/weixin_48337566/category_11790903.html)
5. ğŸŒ¹ ä¸€é”®å››è¿ï¼šå…³æ³¨ğŸ’‹+ç‚¹èµğŸ‘+æ”¶è—â­+ç•™è¨€ğŸ“
6. ğŸ“¢ äººç”Ÿç®´è¨€ï¼šå³ä½¿æ²¡æœ‰ä¸‡å…¨å‡†å¤‡ï¼Œä¹Ÿè¦å‹‡æ•¢è¿ˆå‡ºç¬¬ä¸€æ­¥ã€‚

---

> åœ¨
> `å‰ç«¯é¢†åŸŸ`
> ï¼Œ
> `å®æ—¶é€šä¿¡ WebSocket æ˜¯æˆ‘ä»¬å¿…é¡»æŒæ¡çš„å…¶ä¸­ä¸€ä¸ªæŠ€æœ¯ç‚¹`
> ï¼Œä»Šå¤©æœ¨é±¼å’Œå¤§å®¶é€šè¿‡æ¡ˆä¾‹ï¼Œ
> `å¿«é€Ÿçš„å…¥é—¨WebSocket å®æ—¶é€šä¿¡`
> ã€‚ä¸€ğŸ å±Šæ—¶æˆ‘å°†ä»£ç éƒ¨åˆ†ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºï¼Œç»™å¤§å®¶é€šè¿‡æ–‡ç« çš„å½¢å¼å»åˆ†æã€‚

æœ¨é±¼ä¹Ÿæ˜¯åˆšåˆšå¼€å§‹äº†è§£
`WebSocket`
,å¦‚æœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·è°…è§£ã€‚ç•™è¨€åŒºï¼Œæ—¶åˆ»æ­å€™å¤§å®¶ï¼Œæˆ‘ä»¬å…±åŒè¿ˆè¿›é€šä¿¡å·¥ç¨‹ã€‚

ä¸ºäº†æ–¹ä¾¿å¤§å®¶å­¦ä¹ ï¼Œæœ¬æ–‡åªå±•ç¤º
`UIç»„ä»¶åº“`
ã€
`é€»è¾‘éƒ¨åˆ†`
|
`æ ·å¼éƒ¨åˆ† ä¸åšå±•ç¤º`
å°ä¼™ä¼´ä»¬å¯ä»¥å» ğŸ‘‰
[æ¡ˆä¾‹æºç ](https://gitee.com/chunbochen/web-socket-demo)
è·å–ã€‚

---

### 1ã€ä»€ä¹ˆæ˜¯WebSocketï¼Ÿ

> æ ¹æ®ç™¾ç§‘ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼š
>
> * WebSocketæ˜¯ä¸€ç§åœ¨
>   `å•ä¸ªTCPè¿æ¥ä¸Š`
>   è¿›è¡Œ
>   `å…¨åŒå·¥é€šä¿¡`
>   çš„åè®®ã€‚
> * WebSocketé€šä¿¡åè®®äº2011å¹´è¢«IETFå®šä¸ºæ ‡å‡†RFC 6455ï¼Œå¹¶ç”±RFC7936è¡¥å……è§„èŒƒã€‚
> * WebSocket APIä¹Ÿè¢«
>   `W3Cå®šä¸ºæ ‡å‡†`
>   ã€‚
> * WebSocketä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•ï¼Œå…è®¸æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚

åœ¨WebSocket APIä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚

å…¶å®ä¸€å¥è¯å°±å¯ä»¥åšå‡ºæ¦‚æ‹¬ï¼š
`å®ƒå°±æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®`
ï¼Œå¾ˆå¤šé«˜çº§åŠŸèƒ½éƒ½éœ€è¦å®ƒã€‚

### 2ã€ä¸ºä»€ä¹ˆéœ€è¦ WebSocketï¼Ÿ

åˆæ¬¡æ¥è§¦ WebSocket çš„äººï¼Œéƒ½ä¼šé—®æƒ³ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿå®ƒåˆ°åº•èƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ

> ç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸º HTTP åè®®æœ‰ä¸€ä¸ªç¼ºé™·ï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚

æ¯”å¦‚è¯´ï¼šæˆ‘ä»¬æƒ³äº†è§£ä»Šå¤©çš„å¤©æ°”ï¼Œåªèƒ½æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›æŸ¥è¯¢ç»“æœã€‚HTTP åè®®åšä¸åˆ°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚

### 3ã€ç‰¹ç‚¹

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/5c3b5d4cee9c07849b8006e6e4af78f4.jpeg#pic_center)

> `æœåŠ¡å™¨`
> å¯ä»¥
> `ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯`
> ï¼Œ
> `å®¢æˆ·ç«¯`
> ä¹Ÿå¯ä»¥
> `ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯`
> ï¼Œæ˜¯çœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯ï¼Œå±äºæœåŠ¡å™¨æ¨é€æŠ€æœ¯çš„ä¸€ç§ã€‚

ï¼ˆ1ï¼‰å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼ŒæœåŠ¡å™¨ç«¯çš„å®ç°æ¯”è¾ƒå®¹æ˜“ã€‚

ï¼ˆ2ï¼‰ä¸ HTTP åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ã€‚é»˜è®¤ç«¯å£ä¹Ÿæ˜¯80å’Œ443ï¼Œå¹¶ä¸”æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œå› æ­¤æ¡æ‰‹æ—¶ä¸å®¹æ˜“å±è”½ï¼Œèƒ½é€šè¿‡å„ç§ HTTP ä»£ç†æœåŠ¡å™¨ã€‚

ï¼ˆ3ï¼‰æ•°æ®æ ¼å¼æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡é«˜æ•ˆã€‚

ï¼ˆ4ï¼‰å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®ã€‚

ï¼ˆ5ï¼‰æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡ã€‚

ï¼ˆ6ï¼‰åè®®æ ‡è¯†ç¬¦æ˜¯wsï¼ˆå¦‚æœåŠ å¯†ï¼Œåˆ™ä¸ºwssï¼‰ï¼ŒæœåŠ¡å™¨ç½‘å€å°±æ˜¯ URLã€‚

---

### 4ã€vue2æ¡ˆä¾‹

#### (1) æŠ€æœ¯æ ˆ

* vue-cli@3.12.1
* Ant Design of Vue
* vue-router
* localStorage
* moment
* ws

##### é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `Ant Design of Vue æ ·å¼ç»„ä»¶åº“`

###### â‘ å®‰è£… `ant-design-vue`

```js
npm i --save ant-design-vue

```

###### â‘¡åœ¨ `main.jsä¸­` å®Œæ•´å¼•å…¥

```js
import Antd from 'ant-design-vue';
import 'ant-design-vue/dist/antd.css';
Vue.use(Antd);

```

---

#### (2) ç›®å½•ç»“æ„

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/bcb05136bbded25acc5997f7663c63fb.png#pic_center)

#### (3)router.jsé…ç½®

```js
import Vue from 'vue'
import Router from 'vue-router'
//å¯¼å…¥ç™»å½•é¡µ
import Login from './views/Login.vue'

Vue.use(Router)

export default new Router({
  mode: 'history',
  base: process.env.BASE_URL,
  routes: [
    //ç™»å½•é¡µ
    {
      path: '/Login',
      name: 'Login',
      component: Login
    },
    //é¦–é¡µ
    {
      path: '/',
      name: 'Home',
      // route level code-splitting
      // this generates a separate chunk (about.[hash].js) for this route
      // which is lazy-loaded when the route is visited.
      component: () => import(/* webpackChunkName: "Home" */ './views/Home.vue')
    }
  ]
})

```

#### (4) ç™»å½• ã€Login.vueã€‘

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/1eb40a03aceacea57d9881540a306707.gif#pic_center)

---

##### ä¸€ğŸ’•ç™»å½•å¸ƒå±€ï¼š

> åœ¨å¸ƒå±€å‰ï¼Œæˆ‘ä»¬å…ˆæ„æ€å¥½é¡µé¢åˆ†å¸ƒï¼Œè‰¯å¥½çš„å¼€ç«¯ï¼Œè¦å æ®å¼€å‘çš„ä¸€åŠã€‚æœ‰æ€è·¯ï¼Œæ‰ä¼šäº‹åŠåŠŸå€ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/e0a95bc10b3c3a9405da7a963d421fcd.png#pic_center)

* èŠå¤©å®¤æ ‡é¢˜
* ç”¨æˆ·åè¾“å…¥æ¡†
* è¿›å…¥èŠå¤©å®¤æŒ‰é’®
* èƒŒæ™¯ç•Œé¢åœ†è§’ ã€æ ·å¼å¤„ç†ã€‘

###### â‘ èŠå¤©å®¤æ ‡é¢˜

```html
<!--æ ‡é¢˜-->
<div class="boxs">
   <h1>æœ¨é±¼å…¨çƒÂ·ç•…èŠ</h1>
</div>

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/5011cab8dd69848db599f9537b4c7e14.gif#pic_center)

###### â‘¡ç”¨æˆ·åè¾“å…¥æ¡†

```html
<!--ç”¨æˆ·åè¾“å…¥æ¡†-->
 <a-input placeholder="è¯·æ‚¨è¾“å…¥ç”¨æˆ·å">
   <!-- ç”¨æˆ·å›¾æ ‡-->
   <a-icon slot="prefix" type="user" style="color: rgba(0, 0, 0, 0.25)"/>
 </a-input>

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/92924814907bc96f3867b1e2ba0708ef.gif#pic_center)

###### â‘¢è¿›å…¥èŠå¤©å®¤æŒ‰é’®

```html
<!--è¿›å…¥èŠå¤©å®¤æŒ‰é’®-->
 <a-button type="dashed" ghost>
    <!--è‡ªå®šä¹‰å›¾æ ‡-->
   <i class="iconfont icon-SEND" @click="æ·»åŠ è¿›å…¥èŠå¤©å®¤äº‹ä»¶ğŸ‘‡"></i>è¿›å…¥èŠå¤©å®¤
 </a-button>

```

å¦‚ä½•è‡ªå®šä¹‰å›¾æ ‡è¯·å‚è€ƒ ğŸ‘‰
[å¦‚ä½•å¼•ç”¨é˜¿é‡Œå›¾æ ‡åº“](https://chenchunbo.blog.csdn.net/article/details/123379553)

##### ä¸€ğŸ’•ç™»å½•é€»è¾‘ï¼š

###### â‘ ç”¨æˆ·è¾“å…¥ä¿¡æ¯ï¼šåœ¨è¾“å…¥æ¡† å†…ç»‘å®š `v-model="username"`

åœ¨
`data`
ä¸­å®šä¹‰å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æ¡¶

```js
  data() {
    return {
      username: "",
    };
  },

```

###### â‘¡è¿›å…¥èŠå¤©å®¤äº‹ä»¶ï¼š `@click="handleEnterBtnClick"`

```js
   //è¿›å…¥èŠå¤©å®¤
    handleEnterBtnClick() {
     // trim() å»é™¤ç”¨æˆ·åé‡Œçš„ç©ºæ ¼
      const username = this.username.trim();
      //å¦‚æœ è¾“å…¥çš„ç”¨æˆ·å å°‘äº3ä½ï¼Œç¨‹åºä¼šç»™å‡ºæç¤ºï¼Œå¦‚æœæ»¡è¶³ åˆ™è·³è½¬è‡³é¦–é¡µèŠå¤©å®¤
      if (username.length < 3) {
        this.$message.warning("ç”¨æˆ·åä¸èƒ½å°äº3ä½", 1);
        return;
      }
      //å°†è¾“å…¥çš„ç”¨æˆ·å ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem("username", username);
      //è·³è½¬åˆ°é¦–é¡µ
      this.$router.push("/");
    },

```

###### â‘¢é’ˆå¯¹äº æœ¬åœ°é‡Œ `æœ‰æˆ–è€…æ²¡æœ‰ç”¨æˆ·åä¿¡æ¯`

> å¦‚æœæœ‰ è¿›å…¥é¦–é¡µèŠå¤©å®¤ï¼Œå¦åˆ™ è¿”å›ç™»å½•é¡µã€é¦–é¡µè¿”å›çš„æ“ä½œã€‘

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/1eef7377406ceb37da81a5a5cd0224af.gif#pic_center)

---

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/1de559c667f57e0e8dab2b4453670457.gif#pic_center)

```js
  mounted() {
  //å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨æœ¬åœ°
    const username = localStorage.getItem("username");
    if (username) {
      this.$router.push("/");
      return;
    }
  },

```

###### â‘£æ¸…é™¤æœ¬åœ°å­˜å‚¨å½“ä¸­çš„ä¿¡æ¯ã€æ¼”ç¤ºæ•ˆæœã€‘

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/0280258803deaabe6a8a8d8280aa3db7.gif#pic_center)

#### (5) é¦–é¡µã€Home.vueã€‘

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/d97e70320c300ca3d9f1dbb2ad7138fe.gif#pic_center)

##### ä¸€ğŸ’•é¦–é¡µå¸ƒå±€ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/a9f1f74bd6853a4994973069283c9f79.gif#pic_center)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/70d914d41bf179b24d1f52408c4502d0.png#pic_center)

* æ¶ˆæ¯åˆ—è¡¨
* å†…å®¹è¾“å…¥æ¡†
* å‘é€æŒ‰é’®

###### â‘ æ¶ˆæ¯åˆ—è¡¨ï¼š

```html
   <!--å¾ªç¯ åˆ—è¡¨-->
   <a-list ref="record" item-layout="horizontal" :data-source="msgList">
      <!--Ant ç»„ä»¶ é»˜è®¤çš„å¾ªç¯éå†æ•°æ®ç»“æ„  ä¸å¯æ›´æ”¹-->
      <a-list-item slot="renderItem" slot-scope="item">
        <a-list-item-meta>
          <p slot="title">
          <!--éå†ç”¨æˆ·å-->
            <span> {{ item.user }}</span>
           <!--å‘å¸ƒæ—¶é—´--> 
            <span>å‘é€æ—¶é—´ï¼š{{ $moment(item.dateTime).format("YYYY-MM-DD HH:mm:ss") }}</span>
          </p>
          <!--ä¼šè¯å†…å®¹-->
          <p slot="title">ä¼šè¯å†…å®¹ï¼š{{ item.msg }}</p>
          <!--ç”¨æˆ·å¤´åƒæ˜¾ç¤º-->
          <a-avatar slot="avatar" src="https://gw.alicdn.com/tps/TB1W_X6OXXXXXcZXVXXXXXXXXXX-400-400.png"/>
        </a-list-item-meta>
      </a-list-item>
    </a-list>

```

é™„åŠ ï¼šå…³äºéå†çš„æ—¶é—´æ ¼å¼å¤„ç† è¯·çœ‹ï¼š
[vueæ—¶é—´æ ¼å¼å¤„ç†(YYYY-MM-DD HH:mm:ss)](https://chenchunbo.blog.csdn.net/article/details/123468209)

###### â‘¡å†…å®¹è¾“å…¥æ¡†:

```html
<a-input placeholder="è¯·è¾“å…¥æ¶ˆæ¯"/>

```

###### â‘¢å‘é€æŒ‰é’®ï¼š

```html
<a-button type="dashed" ghost>
	<i class="iconfont icon-SEND"></i>
	å‘é€
</a-button>

```

##### ä¸€ğŸ’•é¦–é¡µé€»è¾‘ã€WebSocketé»˜è®¤é…ç½®ã€‘ï¼š

é¦–å…ˆå»ºç«‹WebSocket è¿æ¥ï¼Œæˆ‘ä»¬è¦çŸ¥é“ WebSocket åœ¨å‰ç«¯å·¥ç¨‹ æ”¯æŒ 4ç§å±æ€§ä¸€ğŸ‘‡

* open ã€å»ºç«‹è¿æ¥ã€‘
* close ã€å…³é—­è¿æ¥ã€‘
* error ã€é”™è¯¯ä¿¡æ¯ã€‘
* message ã€æ¥æ”¶å¤„ç†ã€‘

é™„åŠ äº†è§£å†…å®¹ï¼šä¸€ğŸ¾

> åç«¯çš„WebSocket æ”¯æŒäº”ç§ï¼š
>
> 1. open ã€å»ºç«‹è¿æ¥ã€‘
> 2. close ã€å…³é—­è¿æ¥ã€‘
> 3. error ã€é”™è¯¯ä¿¡æ¯ã€‘
> 4. message ã€è¿æ¥å¤„ç†ã€‘
> 5. connection ã€ä¿¡æ¯å¤„ç†å‡½æ•°ã€‘

---

åœ¨å¤–éƒ¨ä½œç”¨åŸŸè°ƒç”¨ï¼š
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/c3cee8e5be1b79b58647cc251d09a013.png#pic_center)
  
è¯¦ç»†WebSocket æœåŠ¡é“¾æ¥éƒ¨ç½² ï¼Œè¯·çœ‹ä¸‹é¢
`(6) node é€šä¿¡éƒ¨ç½²`
ä¸€ğŸˆ

```js
//è°ƒç”¨æœ¬åœ°çš„WebSocket æœåŠ¡
const ws = new WebSocket("ws://localhost:8000");

```

æ­¤æ—¶éœ€è¦vue2 é¡¹ç›®ä½ç½®â€“ã€‹ä¸‹è½½
`ws`
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/f7f370a249264a4bdf54dd496ca5da4f.png#pic_center)

```js
npm install ws -g

```

###### â‘ å»ºç«‹è¿æ¥ï¼š

> åœ¨mounted ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå†™å‡º WebSocket è¿æ¥ç»“æ„ä»£ç ã€ä»¥ä¸‹å±äºåŸç”Ÿå†™æ³•ã€‘

æ³¨æ„ï¼š

1. `this.handleWsOpen`
   ã€ä½œç”¨äºè°ƒç”¨ methodsä¸­çš„è¿æ¥å‡½æ•°äº‹ä»¶ã€‘
2. `bind(this)`
   ã€bind(this)çš„ä½œç”¨æ˜¯æ”¹å˜thisçš„æŒ‡å‘ã€‘

###### â‘¡é»˜è®¤é…ç½®ï¼š

```js
  mounted() {
    //è¿æ¥   
    ws.addEventListener("open", this.handleWsOpen.bind(this), false);
    //å…³é—­
    ws.addEventListener("close", this.handleWsClose.bind(this), false);
    //é”™è¯¯
    ws.addEventListener("error", this.handleWsError.bind(this), false);
    //æ¥æ”¶å¤„ç†
    ws.addEventListener("message", this.handleWsMessage.bind(this), false);
  },

```

###### â‘¢é…ç½®è¿æ¥å‚æ•°ï¼š

> åœ¨methods ç”Ÿå‘½å‘¨æœŸå†… é…ç½®ï¼Œå®ƒçš„é»˜è®¤å‚æ•°

```js
 methods: {}

```

```js
//å»ºç«‹è¿æ¥
handleWsOpen(e) {
   console.log("FE:WebSocket open", e);
},

```

```js
//å…³é—­è¿æ¥
handleWsClose(e) {
   console.log("FE:WebSocket close", e);
},

```

```js
 //é”™è¯¯ä¿¡æ¯
handleWsError(e) {
   console.log("FE:WebSocket error", e);
},

```

è¿™æ­¥å¾ˆé‡è¦ï¼Œä½œç”¨äºå‰ç«¯æ¥æ”¶å¹¿æ’­æ•°æ® ä¸€ğŸ¯

```js
//æ¥æ”¶æ•°æ®å¤„ç† é»˜è®¤ç»“æ„
handleWsMessage(e) {
   console.log("FE:WebSocket message", e);
},

```

---

###### â‘£åˆ·æ–°å¤„ç†å‡½æ•°äº‹ä»¶:

> æˆ‘ä»¬éœ€è¦åœ¨
> `mounted ç”Ÿå‘½å‘¨æœŸ`
> ä¸­ æ·»åŠ 
> `åˆ·æ–°é¡µé¢å¤„ç†å‡½æ•°`

åˆ¤æ–­æœ¬åœ°å­˜å‚¨å½“ä¸­æœ‰æ²¡æœ‰ç”¨æˆ·åï¼Œå¦‚æœæœ‰ç”¨æˆ·å ç‚¹å‡»æµè§ˆå™¨åˆ·æ–°ã€F5ã€‘ï¼Œä¸åšè·³è½¬ï¼Œå¦åˆ™è·³è½¬è‡³ç™»å½•é¡µ

```js
mounted(){
   //å°†ç”¨æˆ·å­˜å‚¨åˆ°æœ¬åœ°
   this.username = localStorage.getItem("username");
    //åˆ¤æ–­ å¦‚æœæœ¬åœ°å­˜å‚¨æ²¡æœ‰å½“å‰ç”¨æˆ·å åˆ™ è·³è½¬å›ç™»å½•é¡µ
   if (!this.username) {
     this.$router.push("/Login");
     return;
   }
}

```

#### (6) nodeé€šä¿¡éƒ¨ç½²

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/464ff99497fb17d971c2cba2a6b525cf.gif#pic_center)

---

##### ä¸€ğŸ’•åˆå§‹åŒ–å¤„ç†

æ³¨æ„ï¼šåœ¨éƒ¨ç½²å‰ï¼Œé¦–å…ˆå¿…é¡»è¦åšåˆå§‹åŒ–å¤„ç†

> åœ¨server ç›®å½•ä¸‹ è¿è¡Œ
> `npm init -y`
> åˆå§‹åŒ–
>   
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/2b3ab645455bc3eab0952c0b0204c65d.png#pic_center)

```js
npm init -y

```

##### ä¸€ğŸ’•ç›‘å¬å¤„ç†

> ä½¿ç”¨nodemon æ’ä»¶ åšç›‘å¬å¤„ç†å‡½æ•° ä¸€ğŸ‘† ä¹Ÿæ˜¯åœ¨server ç›®å½•ä¸‹è¿è¡Œ

```js
npm install nodemon -g

```

##### ä¸€ğŸ’•å¯ç”¨ç›‘å¬

> åœ¨
> `package.json`
> æ–‡ä»¶ä¸­ä¿®æ”¹
> `scripts`
> å†…çš„å‚æ•°

* dev ã€è¿è¡Œæ–¹å¼ï¼Œé€šè¿‡npm run devã€‘
* nodemon index.js ã€ä½¿ç”¨ç›‘å¬nodemonã€‘ã€ã€å¼•ç”¨index.js æ–‡ä»¶ã€‘

```js
"scripts": {
  "dev": "nodemon index.js"
},

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/c3cee8e5be1b79b58647cc251d09a013.png#pic_center)

##### ä¸€ğŸ’•ä¸‹è½½ ws åº“ã€ é™„å±äº WebSocketã€‘

> ä¸€ğŸ‘† ä¹Ÿæ˜¯åœ¨server ç›®å½•ä¸‹è¿è¡Œ

```js
npm install ws

```

##### ä¸€ğŸ’•æ–°å»ºindex.js

###### â‘ å¯¼å…¥ `const Ws = require('ws');`

```js
const Ws = require('ws');
//å»ºç«‹æ¨¡å—
;((Ws) => {
  //......ä¸»è¦ä»£ç  åœ¨æ¨¡å—å†…å†™
})(Ws)

```

###### â‘¡ä¸»è¦WebSocketé…ç½®ã€ä¸»è¦ä»£ç ã€‘

```js
//æ¥å£ ä¸º8000
    const server = new Ws.Server({
        port: 8000
    });


    const init = () => {
        bindEvent()
    }

    function bindEvent() {
        server.on('open', handleOpen)
        server.on('close', handleClose)
        server.on('error', handleError)
        server.on('connection', handleConnection)
    }
    //ä¸å‰ç«¯å»ºç«‹è¿æ¥
    function handleOpen() {
        console.log('BE:WebSocket open');
    }
    //ä¸å‰ç«¯å…³é—­è¿æ¥
    function handleClose() {
        console.log('BE:WebSocket close');
    }
    //é”™è¯¯ä¿¡æ¯
    function handleError() {
        console.log('BE:WebSocket error');
    }
    //ä¿¡æ¯å¤„ç†
    function handleConnection(ws) {
        console.log('BE:WebSocket connection');
        ws.on('message', handleMessage)
    }
    //ä¸å‰ç«¯å»ºç«‹è¿æ¥
    function handleMessage(msg) {
        //éå†æ¯ä¸€æ¡å†…å®¹ä¿¡æ¯
        server.clients.forEach((c) => {
            // å‘é€send ä¿¡æ¯ åˆ°å‰ç«¯
            c.send(msg);
        })
    }

```

#### (7) é¦–é¡µæ·»åŠ è§¦å‘äº‹ä»¶å‡½æ•°

###### â‘  è¯·è¾“å…¥æ¶ˆæ¯æ¡† ç»‘å®š `v-model="msg"`

```html
  <a-input placeholder="è¯·è¾“å…¥æ¶ˆæ¯" v-model="msg"/>

```

```js
  data() {
    return {
      msg: "",//å‘é€çš„å†…å®¹
      username: "",//ç”¨æˆ·å
      msgList: [],//æ¶ˆæ¯åˆ—è¡¨æ•°æ®
    };
  },

```

###### â‘¡å‘é€æŒ‰é’®ç»‘å®šäº‹ä»¶ `@click="handleSendBtnClick"`

```html
<a-button type="dashed" ghost @click="handleSendBtnClick">
	<i class="iconfont icon-SEND"></i>å‘é€
</a-button>

```

```js
   //å‘é€é€»è¾‘
    handleSendBtnClick(e) {
      if (this.msg == "") {
        this.$message.warning("ä¸èƒ½å‘é€ç©ºç™½æ¶ˆæ¯", 1);
      } else {
        const msg = this.msg;
        //å»é™¤å¤´å°¾ç©ºæ ¼
        if (!msg.trim().length) {
          return;
        }
        //æ¥æ”¶å‘é€çš„å†…å®¹
        ws.send(
          //å°†è¿”å›çš„æ•°æ®ä»¥å¯¹è±¡çš„å½¢å¼ å±•ç¤ºåœ¨å‰å°
          JSON.stringify({
            id: new Date().getTime(),
            user: this.username,
            dateTime: new Date().getTime(),
            msg: this.msg,
          })
        );
        //è¾“å…¥å®Œä¿¡æ¯å ç½®ç©º
        this.msg = "";
      }
    },

```

###### â‘¢ æ¥æ”¶å¹¿æ’­æ•°æ®

> åœ¨methods ä¸­å¢åŠ 
> `handleWsMessage`
> å¤„ç†å‡½æ•° æ¥æ”¶è¿”å›çš„æ•°æ®

```js
   //å‰ç«¯æ¥æ”¶å¹¿æ’­æ•°æ®
    handleWsMessage(e) {
      //æ•°æ®ç±»å‹è½¬æ¢ ä¸ºå¯¹è±¡çš„å½¢å¼
      const msg = JSON.parse(e.data);    
	  //å°†è¾“å…¥çš„å†…å®¹ æ·»åŠ åˆ° æ¶ˆæ¯åˆ—è¡¨
      this.msgList.push(msg);

      console.log(msg);
      // console.log("FE:WebSocket message", e);
    },

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/b817e835b192f764ff7b2936b77e6088.png#pic_center)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/3032b100b732d4c2353d9aba809545f9.png#pic_center)

#### (8) é€šä¿¡æ¼”ç¤º

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/6689ed28c3effebe532b82a1591045ac.gif#pic_center)

---

### ğŸ“– åšä¸»è‡´è°¢

æ„Ÿè°¢å¤§å®¶é˜…è¯»åˆ°ç»“å°¾ï¼Œæœ¬æ¬¡çš„æ–‡ç« å°±åˆ†äº«åˆ°è¿™é‡Œï¼Œæ€»ç»“äº†
`ã€å‰ç«¯WebSocket å®æ—¶é€šä¿¡çš„æ¡ˆä¾‹ã€‘`
ï¼Œå¸Œæœ›å¯ä»¥å¸®åˆ°å¤§å®¶ï¼Œè°¢è°¢ã€‚

å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©åˆ°æ‚¨çš„çš„è¯ä¸å¦¨ã€
`å…³æ³¨+ç‚¹èµ+æ”¶è—+è¯„è®º+è½¬å‘`
ã€‘æ”¯æŒä¸€ä¸‹å“Ÿ~~ğŸ˜›æ‚¨çš„æ”¯æŒå°±æ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ã€‚ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/671cc590e8d4c9005874bf02d41babe3.png#pic_center)

---

**ğŸ›©å¾€æœŸç²¾å½©ï¼š**

[ä¸€æ–‡å›¾è§£è‡ªå®šä¹‰ä¿®æ”¹el-tableæ ·å¼](https://chenchunbo.blog.csdn.net/article/details/123340499)

[ç›˜ç‚¹ï¼Œè¿™äº›å¹´ä½ çŸ¥é“çš„é¼ æ ‡ç§»å…¥æ˜¾ç¤ºå°æ‰‹å›¾æ ‡çš„cssçš„cursor å±æ€§ï¼Œä½ è¿˜è®°å¾—å—ï¼Ÿ](https://chenchunbo.blog.csdn.net/article/details/123422182)

[ä¸€é”®å›¾è§£iframeæ ‡ç­¾å±æ€§ä»¥åŠä½¿ç”¨](https://chenchunbo.blog.csdn.net/article/details/123526834)

[iframeæ ‡ç­¾åµŒå¥—é¡µé¢æ—¶ï¼Œå¦‚ä½•è®©é¡µé¢å†…çš„é«˜åº¦è‡ªé€‚åº”](https://chenchunbo.blog.csdn.net/article/details/123555947)