---
layout: post
title: "极光-OrbitSTC8x05.-GPIO库函数驱动LED流动"
date: 2025-03-16 20:41:40 +0800
description: "本文基于STC8H8K64U4单片机，通过整合GPIO库函数实现跑马灯功能。教程详细讲解如何使用库函数替代直接寄存器操作，涵盖端口模式配置、驱动层优化及代码重构。通过模块化设计与库函数封装，提升代码可读性与复用性，为复杂项目开发奠定基础。"
keywords: "【极光 Orbit·STC8x】05. GPIO库函数驱动LED流动"
categories: ['极光', 'Orbit']
tags: ['嵌入式', '单片机', 'Stm', 'Stc', 'Mongodb']
artid: "146301054"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146301054
    alt: "极光-OrbitSTC8x05.-GPIO库函数驱动LED流动"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146301054
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146301054
cover: https://bing.ee123.net/img/rand?artid=146301054
image: https://bing.ee123.net/img/rand?artid=146301054
img: https://bing.ee123.net/img/rand?artid=146301054
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【极光 Orbit·STC8x】05. GPIO库函数驱动LED流动
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_OrbitSTC805_GPIOLED_0">
     </a>
     【极光 Orbit·STC8】05. GPIO库函数驱动LED流动
    </h2>
    <hr/>
    <h3>
     <a id="___4">
     </a>
     七律 · 逐光流转
    </h3>
    <p>
     <strong>
      八灯列阵若星河，状态为舟渡长波。
     </strong>
     <br/>
     <strong>
      寄存器中藏玄机，Switch语句定山河。
     </strong>
     <br/>
     <strong>
      循环往复如潮涌，步骤变量掌沉浮。
     </strong>
     <br/>
     <strong>
      单片机前展锋芒，代码织就光之舞。
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="_13">
     </a>
     摘要
    </h3>
    <p>
     本文基于STC8H8K64U4单片机，通过整合GPIO库函数实现跑马灯功能。教程详细讲解如何使用库函数替代直接寄存器操作，涵盖端口模式配置、驱动层优化及代码重构。通过模块化设计与库函数封装，提升代码可读性与复用性，为复杂项目开发奠定基础。
    </p>
    <blockquote>
     <p>
      与 switch 相关的编程技巧请参考：
      <br/>
      https://blog.csdn.net/weixin_46419409/article/details/146279134?spm=1001.2014.3001.5502
      <br/>
      https://blog.csdn.net/weixin_46419409/article/details/146288291?spm=1001.2014.3001.5502
      <br/>
      https://blog.csdn.net/weixin_46419409/article/details/146288301?spm=1001.2014.3001.5502
     </p>
     <p>
      https://blog.csdn.net/weixin_46419409/article/details/146288312?spm=1001.2014.3001.5502
     </p>
    </blockquote>
    <hr/>
    <h3>
     <a id="_25">
     </a>
     关键字
    </h3>
    <p>
     STC8H8K64U4, GPIO库函数, 推挽输出, 模块化设计
    </p>
    <hr/>
    <h3>
     <a id="_30">
     </a>
     引言
    </h3>
    <p>
     STC官方提供的GPIO库函数通过宏定义封装了寄存器操作，简化了端口配置流程。本教程通过以下改进实现功能：
    </p>
    <ol>
     <li>
      <strong>
       库函数替代寄存器操作
      </strong>
      ：使用
      <code>
       GPIO_Init
      </code>
      宏配置端口模式。
     </li>
     <li>
      <strong>
       模块化架构
      </strong>
      ：BSP层负责硬件抽象，驱动层实现状态机逻辑。
     </li>
     <li>
      <strong>
       Switch状态机
      </strong>
      ：通过步骤变量
      <code>
       run_step
      </code>
      控制LED流动方向与速度。
     </li>
     <li>
      <strong>
       代码复用性
      </strong>
      ：驱动层可扩展为多模式控制（如正反向流动、变速模式）。
     </li>
     <li>
      <strong>
       代码解耦
      </strong>
      ：BSP层仅依赖库函数，无需直接操作硬件寄存器。
     </li>
     <li>
      <strong>
       扩展性增强
      </strong>
      ：支持快速切换GPIO模式（如开漏、上拉等）。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_41">
     </a>
     硬件设计
    </h3>
    <h4>
     <a id="1__43">
     </a>
     1. 硬件连接
    </h4>
    <p>
     LED通过灌电流方式连接至P1口：
    </p>
    <div class="mermaid">
     <svg class="mermaid-svg" height="158" id="mermaid-svg-avlfPt73uMZuyeur" viewbox="0 0 640.8125 158" width="640.8125" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-avlfPt73uMZuyeur {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-avlfPt73uMZuyeur .error-icon{fill:#552222;}#mermaid-svg-avlfPt73uMZuyeur .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-avlfPt73uMZuyeur .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-avlfPt73uMZuyeur .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-avlfPt73uMZuyeur .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-avlfPt73uMZuyeur .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-avlfPt73uMZuyeur .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-avlfPt73uMZuyeur .marker{fill:#333333;stroke:#333333;}#mermaid-svg-avlfPt73uMZuyeur .marker.cross{stroke:#333333;}#mermaid-svg-avlfPt73uMZuyeur svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-avlfPt73uMZuyeur .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-avlfPt73uMZuyeur .cluster-label text{fill:#333;}#mermaid-svg-avlfPt73uMZuyeur .cluster-label span{color:#333;}#mermaid-svg-avlfPt73uMZuyeur .label text,#mermaid-svg-avlfPt73uMZuyeur span{fill:#333;color:#333;}#mermaid-svg-avlfPt73uMZuyeur .node rect,#mermaid-svg-avlfPt73uMZuyeur .node circle,#mermaid-svg-avlfPt73uMZuyeur .node ellipse,#mermaid-svg-avlfPt73uMZuyeur .node polygon,#mermaid-svg-avlfPt73uMZuyeur .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-avlfPt73uMZuyeur .node .label{text-align:center;}#mermaid-svg-avlfPt73uMZuyeur .node.clickable{cursor:pointer;}#mermaid-svg-avlfPt73uMZuyeur .arrowheadPath{fill:#333333;}#mermaid-svg-avlfPt73uMZuyeur .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-avlfPt73uMZuyeur .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-avlfPt73uMZuyeur .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-avlfPt73uMZuyeur .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-avlfPt73uMZuyeur .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-avlfPt73uMZuyeur .cluster text{fill:#333;}#mermaid-svg-avlfPt73uMZuyeur .cluster span{color:#333;}#mermaid-svg-avlfPt73uMZuyeur div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-avlfPt73uMZuyeur :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M126.5625,31L130.72916666666666,31C134.89583333333334,31,143.22916666666666,31,151.5625,31C159.89583333333334,31,168.22916666666666,31,172.39583333333334,31L176.5625,31" marker-end="url(#arrowhead266)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead266" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M265.5999984741211,31L269.7666651407878,31C273.9333318074544,31,282.2666651407878,31,290.5999984741211,31C298.9333318074544,31,307.2666651407878,31,311.4333318074544,31L315.5999984741211,31" marker-end="url(#arrowhead267)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead267" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;">
          <path class="path" d="M403.4749984741211,31L407.6416651407878,31C411.8083318074544,31,420.1416651407878,31,428.4749984741211,31C436.8083318074544,31,445.1416651407878,31,449.3083318074544,31L453.4749984741211,31" marker-end="url(#arrowhead268)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead268" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M531.9625015258789,31L536.1291681925455,31C540.2958348592123,31,548.6291681925455,31,556.9625015258789,31C565.2958348592123,31,573.6291681925455,31,577.7958348592123,31L581.9625015258789,31" marker-end="url(#arrowhead269)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead269" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-F LE-G" id="L-F-G" style="opacity: 1;">
          <path class="path" d="M91.55624961853027,127L101.55729134877522,127C111.55833307902019,127,131.5604165395101,127,146.60729122161865,127C161.6541659037272,127,171.74583180745444,127,176.79166475931802,127L181.83749771118164,127" marker-end="url(#arrowhead270)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead270" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-D" id="L-L-C-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-F' L-LE-G" id="L-L-F-G">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-223" style="opacity: 1;" transform="translate(67.28125,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="118.5625" x="-59.28125" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-49.28125,-13)">
            <foreignobject height="26" width="98.5625">
             <div style="display: inline-block; white-space: nowrap;">
              STC8H8K64U4
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-224" style="opacity: 1;" transform="translate(221.08124923706055,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="89.0374984741211" x="-44.51874923706055" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-34.51874923706055,-13)">
            <foreignobject height="26" width="69.0374984741211">
             <div style="display: inline-block; white-space: nowrap;">
              P1.0-P1.7
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-226" style="opacity: 1;" transform="translate(359.5374984741211,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="87.875" x="-43.9375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-33.9375,-13)">
            <foreignobject height="26" width="67.875">
             <div style="display: inline-block; white-space: nowrap;">
              220Ω电阻
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-228" style="opacity: 1;" transform="translate(492.71875,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="78.48749923706055" x="-39.24374961853027" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-29.243749618530273,-13)">
            <foreignobject height="26" width="58.48749923706055">
             <div style="display: inline-block; white-space: nowrap;">
              LED阴极
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-230" style="opacity: 1;" transform="translate(607.3875007629395,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="50.85000038146973" x="-25.425000190734863" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-15.425000190734863,-13)">
            <foreignobject height="26" width="30.850000381469727">
             <div style="display: inline-block; white-space: nowrap;">
              GND
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-231" style="opacity: 1;" transform="translate(67.28125,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="48.55000114440918" x="-24.27500057220459" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-14.27500057220459,-13)">
            <foreignobject height="26" width="28.55000114440918">
             <div style="display: inline-block; white-space: nowrap;">
              VCC
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-G-232" style="opacity: 1;" transform="translate(221.08124923706055,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="78.48749923706055" x="-39.24374961853027" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-29.243749618530273,-13)">
            <foreignobject height="26" width="58.48749923706055">
             <div style="display: inline-block; white-space: nowrap;">
              LED阳极
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <hr/>
    <h3>
     <a id="_56">
     </a>
     软件配置
    </h3>
    <h4>
     <a id="1__58">
     </a>
     1. 模块化架构设计
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="254" id="mermaid-svg-TM2pzU9d6Ow2zYxC" viewbox="0 0 416 254" width="416" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-TM2pzU9d6Ow2zYxC {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .error-icon{fill:#552222;}#mermaid-svg-TM2pzU9d6Ow2zYxC .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-TM2pzU9d6Ow2zYxC .marker{fill:#333333;stroke:#333333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .marker.cross{stroke:#333333;}#mermaid-svg-TM2pzU9d6Ow2zYxC svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-TM2pzU9d6Ow2zYxC .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .cluster-label text{fill:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .cluster-label span{color:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .label text,#mermaid-svg-TM2pzU9d6Ow2zYxC span{fill:#333;color:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .node rect,#mermaid-svg-TM2pzU9d6Ow2zYxC .node circle,#mermaid-svg-TM2pzU9d6Ow2zYxC .node ellipse,#mermaid-svg-TM2pzU9d6Ow2zYxC .node polygon,#mermaid-svg-TM2pzU9d6Ow2zYxC .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-TM2pzU9d6Ow2zYxC .node .label{text-align:center;}#mermaid-svg-TM2pzU9d6Ow2zYxC .node.clickable{cursor:pointer;}#mermaid-svg-TM2pzU9d6Ow2zYxC .arrowheadPath{fill:#333333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-TM2pzU9d6Ow2zYxC .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-TM2pzU9d6Ow2zYxC .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-TM2pzU9d6Ow2zYxC .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-TM2pzU9d6Ow2zYxC .cluster text{fill:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC .cluster span{color:#333;}#mermaid-svg-TM2pzU9d6Ow2zYxC div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-TM2pzU9d6Ow2zYxC :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M174,41.88L154.66666666666666,48.06666666666666C135.33333333333334,54.25333333333333,96.66666666666667,66.62666666666667,77.33333333333333,76.98C58,87.33333333333333,58,95.66666666666667,58,99.83333333333333L58,104" marker-end="url(#arrowhead285)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead285" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M58,150L58,154.16666666666666C58,158.33333333333334,58,166.66666666666666,58,175C58,183.33333333333334,58,191.66666666666666,58,195.83333333333334L58,200" marker-end="url(#arrowhead286)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead286" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-D" id="L-A-D" style="opacity: 1;">
          <path class="path" d="M242,52.760000000000005L248.83333333333334,57.13333333333333C255.66666666666666,61.50666666666667,269.3333333333333,70.25333333333333,276.1666666666667,78.79333333333334C283,87.33333333333333,283,95.66666666666667,283,99.83333333333333L283,104" marker-end="url(#arrowhead287)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead287" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M252.16250038146973,146.73599975585938L244.80208365122476,151.44666646321616C237.44166692097983,156.1573331705729,222.7208334604899,165.57866658528647,215.36041673024496,174.4559999593099C208,183.33333333333334,208,191.66666666666666,208,195.83333333333334L208,200" marker-end="url(#arrowhead288)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead288" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-F" id="L-D-F" style="opacity: 1;">
          <path class="path" d="M313.8374996185303,146.73599975585938L321.1979163487752,151.44666646321616C328.5583330790202,156.1573331705729,343.2791665395101,165.57866658528647,350.63958326975506,174.4559999593099C358,183.33333333333334,358,191.66666666666666,358,195.83333333333334L358,200" marker-end="url(#arrowhead289)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead289" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-D" id="L-L-A-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-F" id="L-L-D-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-243" style="opacity: 1;" transform="translate(208,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              主函数
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-244" style="opacity: 1;" transform="translate(58,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              驱动层
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-246" style="opacity: 1;" transform="translate(58,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              状态机实现
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-248" style="opacity: 1;" transform="translate(283,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="61.67499923706055" x="-30.837499618530273" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-20.837499618530273,-13)">
            <foreignobject height="26" width="41.67499923706055">
             <div style="display: inline-block; white-space: nowrap;">
              BSP层
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-250" style="opacity: 1;" transform="translate(208,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              端口初始化
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-252" style="opacity: 1;" transform="translate(358,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              寄存器配置
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h4>
     <a id="2__69">
     </a>
     2. 文件结构
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="208" id="mermaid-svg-9yC4pY0Un8GThpAW" viewbox="0 0 902.6500244140625 208" width="902.6500244140625" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-9yC4pY0Un8GThpAW {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-9yC4pY0Un8GThpAW .error-icon{fill:#552222;}#mermaid-svg-9yC4pY0Un8GThpAW .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-9yC4pY0Un8GThpAW .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-9yC4pY0Un8GThpAW .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-9yC4pY0Un8GThpAW .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-9yC4pY0Un8GThpAW .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-9yC4pY0Un8GThpAW .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-9yC4pY0Un8GThpAW .marker{fill:#333333;stroke:#333333;}#mermaid-svg-9yC4pY0Un8GThpAW .marker.cross{stroke:#333333;}#mermaid-svg-9yC4pY0Un8GThpAW svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-9yC4pY0Un8GThpAW .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-9yC4pY0Un8GThpAW .cluster-label text{fill:#333;}#mermaid-svg-9yC4pY0Un8GThpAW .cluster-label span{color:#333;}#mermaid-svg-9yC4pY0Un8GThpAW .label text,#mermaid-svg-9yC4pY0Un8GThpAW span{fill:#333;color:#333;}#mermaid-svg-9yC4pY0Un8GThpAW .node rect,#mermaid-svg-9yC4pY0Un8GThpAW .node circle,#mermaid-svg-9yC4pY0Un8GThpAW .node ellipse,#mermaid-svg-9yC4pY0Un8GThpAW .node polygon,#mermaid-svg-9yC4pY0Un8GThpAW .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-9yC4pY0Un8GThpAW .node .label{text-align:center;}#mermaid-svg-9yC4pY0Un8GThpAW .node.clickable{cursor:pointer;}#mermaid-svg-9yC4pY0Un8GThpAW .arrowheadPath{fill:#333333;}#mermaid-svg-9yC4pY0Un8GThpAW .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-9yC4pY0Un8GThpAW .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-9yC4pY0Un8GThpAW .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-9yC4pY0Un8GThpAW .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-9yC4pY0Un8GThpAW .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-9yC4pY0Un8GThpAW .cluster text{fill:#333;}#mermaid-svg-9yC4pY0Un8GThpAW .cluster span{color:#333;}#mermaid-svg-9yC4pY0Un8GThpAW div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-9yC4pY0Un8GThpAW :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
         <g class="cluster" id="flowchart-subGraph0-281" style="opacity: 1;" transform="translate(451.3250045776367,104)">
          <rect height="192" width="886.6500091552734" x="-443.3250045776367" y="-96">
          </rect>
          <g class="label" id="mermaid-svg-9yC4pY0Un8GThpAWText" transform="translate(0, -82)">
           <g transform="translate(-47.587501525878906,-13)">
            <foreignobject height="26" width="95.17500305175781">
             <div style="display: inline-block; white-space: nowrap;">
              STC8_Project
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-Projects LE-MDK-C51" id="L-Projects-MDK-C51" style="opacity: 1;">
          <path class="path" d="M117.18222848574321,79L111.7028989924325,83.16666666666667C106.22356949912178,87.33333333333333,95.26491051250035,95.66666666666667,89.78558101918964,104C84.3062515258789,112.33333333333333,84.3062515258789,120.66666666666667,84.3062515258789,124.83333333333333L84.3062515258789,129" marker-end="url(#arrowhead318)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead318" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Projects LE-Output" id="L-Projects-Output" style="opacity: 1;">
          <path class="path" d="M177.67402609189352,79L183.15335558520425,83.16666666666667C188.63268507851498,87.33333333333333,199.59134406513638,95.66666666666667,205.0706735584471,104C210.5500030517578,112.33333333333333,210.5500030517578,120.66666666666667,210.5500030517578,124.83333333333333L210.5500030517578,129" marker-end="url(#arrowhead319)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead319" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-BSP" id="L-Drivers-BSP" style="opacity: 1;">
          <path class="path" d="M447.79687786102295,66.19871158613888L426.21823199590045,72.4989263217824C404.639586130778,78.79914105742593,361.482294400533,91.39957052871296,339.9036485354106,101.86645193102315C318.3250026702881,112.33333333333333,318.3250026702881,120.66666666666667,318.3250026702881,124.83333333333333L318.3250026702881,129" marker-end="url(#arrowhead320)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead320" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-Module" id="L-Drivers-Module" style="opacity: 1;">
          <path class="path" d="M455.8753296335538,79L451.0106919970777,83.16666666666667C446.14605436060157,87.33333333333333,436.41677908764945,95.66666666666667,431.5521414511734,104C426.68750381469727,112.33333333333333,426.68750381469727,120.66666666666667,426.68750381469727,124.83333333333333L426.68750381469727,129" marker-end="url(#arrowhead321)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead321" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-Core" id="L-Drivers-Core" style="opacity: 1;">
          <path class="path" d="M509.5809291402499,79L514.445566776726,83.16666666666667C519.3102044132021,87.33333333333333,529.0394796861543,95.66666666666667,533.9041173226303,104C538.7687549591064,112.33333333333333,538.7687549591064,120.66666666666667,538.7687549591064,124.83333333333333L538.7687549591064,129" marker-end="url(#arrowhead322)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead322" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-STC8_Libraries" id="L-Drivers-STC8_Libraries" style="opacity: 1;">
          <path class="path" d="M517.6593809127808,64.58264449841293L544.3974016507467,71.15220374867745C571.1354223887125,77.72176299894195,624.6114638646444,90.86088149947098,651.3494846026102,101.59710741640215C678.0875053405762,112.33333333333333,678.0875053405762,120.66666666666667,678.0875053405762,124.83333333333333L678.0875053405762,129" marker-end="url(#arrowhead323)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead323" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-User LE-main.c" id="L-User-main.c" style="opacity: 1;">
          <path class="path" d="M825.2500076293945,79L825.2500076293945,83.16666666666667C825.2500076293945,87.33333333333333,825.2500076293945,95.66666666666667,825.2500076293945,104C825.2500076293945,112.33333333333333,825.2500076293945,120.66666666666667,825.2500076293945,124.83333333333333L825.2500076293945,129" marker-end="url(#arrowhead324)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead324" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Projects' L-LE-MDK-C51" id="L-L-Projects-MDK-C51">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Projects' L-LE-Output" id="L-L-Projects-Output">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-BSP" id="L-L-Drivers-BSP">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-Module" id="L-L-Drivers-Module">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-Core" id="L-L-Drivers-Core">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-STC8_Libraries" id="L-L-Drivers-STC8_Libraries">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-User' L-LE-main.c" id="L-L-User-main.c">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-MDK-C51-268" style="opacity: 1;" transform="translate(84.3062515258789,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="82.61249923706055" x="-41.30624961853027" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-31.306249618530273,-13)">
            <foreignobject height="26" width="62.61249923706055">
             <div style="display: inline-block; white-space: nowrap;">
              MDK-C51
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Projects-267" style="opacity: 1;" transform="translate(147.42812728881836,56)">
          <rect class="label-container" height="46" rx="0" ry="0" width="78.3125" x="-39.15625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-29.15625,-13)">
            <foreignobject height="26" width="58.3125">
             <div style="display: inline-block; white-space: nowrap;">
              Projects
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Output-270" style="opacity: 1;" transform="translate(210.5500030517578,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="69.875" x="-34.9375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24.9375,-13)">
            <foreignobject height="26" width="49.875">
             <div style="display: inline-block; white-space: nowrap;">
              Output
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-BSP-272" style="opacity: 1;" transform="translate(318.3250026702881,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="45.67500114440918" x="-22.83750057220459" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-12.83750057220459,-13)">
            <foreignobject height="26" width="25.67500114440918">
             <div style="display: inline-block; white-space: nowrap;">
              BSP
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Drivers-271" style="opacity: 1;" transform="translate(482.72812938690186,56)">
          <rect class="label-container" height="46" rx="0" ry="0" width="69.86249923706055" x="-34.93124961853027" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24.931249618530273,-13)">
            <foreignobject height="26" width="49.86249923706055">
             <div style="display: inline-block; white-space: nowrap;">
              Drivers
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Module-274" style="opacity: 1;" transform="translate(426.68750381469727,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="71.04999923706055" x="-35.52499961853027" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-25.524999618530273,-13)">
            <foreignobject height="26" width="51.04999923706055">
             <div style="display: inline-block; white-space: nowrap;">
              Module
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Core-276" style="opacity: 1;" transform="translate(538.7687549591064,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="53.11249923706055" x="-26.556249618530273" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-16.556249618530273,-13)">
            <foreignobject height="26" width="33.11249923706055">
             <div style="display: inline-block; white-space: nowrap;">
              Core
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-STC8_Libraries-278" style="opacity: 1;" transform="translate(678.0875053405762,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="125.5250015258789" x="-62.76250076293945" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-52.76250076293945,-13)">
            <foreignobject height="26" width="105.5250015258789">
             <div style="display: inline-block; white-space: nowrap;">
              STC8_Libraries
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-main.c-280" style="opacity: 1;" transform="translate(825.2500076293945,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68.79999923706055" x="-34.39999961853027" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24.399999618530273,-13)">
            <foreignobject height="26" width="48.79999923706055">
             <div style="display: inline-block; white-space: nowrap;">
              main.c
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-User-279" style="opacity: 1;" transform="translate(825.2500076293945,56)">
          <rect class="label-container" height="46" rx="0" ry="0" width="51.80000114440918" x="-25.90000057220459" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-15.90000057220459,-13)">
            <foreignobject height="26" width="31.80000114440918">
             <div style="display: inline-block; white-space: nowrap;">
              User
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <hr/>
    <h4>
     <a id="3_GPIO_86">
     </a>
     3. GPIO库函数集成
    </h4>
    <h5>
     <a id="_87">
     </a>
     <strong>
      库文件位置
     </strong>
    </h5>
    <pre><code>Drivers/STC8_Libraries/  
├── STC8Ax_GPIO.c  
└── STC8Ax_GPIO.h  
</code></pre>
    <h5>
     <a id="_94">
     </a>
     <strong>
      关键宏定义
     </strong>
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        宏定义
       </th>
       <th>
        作用描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         GPIO_Init
        </code>
       </td>
       <td>
        配置GPIO端口模式
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GPIO_MODE_OUT_PP
        </code>
       </td>
       <td>
        推挽输出模式
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GPIO_P1
        </code>
       </td>
       <td>
        表示P1端口
       </td>
      </tr>
      <tr>
       <td>
        <code>
         Pin_All
        </code>
       </td>
       <td>
        表示端口所有引脚
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_104">
     </a>
     代码实现
    </h3>
    <h4>
     <a id="1_BSPbsp_ledcbsp_ledh_106">
     </a>
     1. BSP层：硬件抽象（
     <code>
      bsp_led.c
     </code>
     /
     <code>
      bsp_led.h
     </code>
     ）
    </h4>
    <h5>
     <a id="bsp_ledh_107">
     </a>
     <strong>
      <code>
       bsp_led.h
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__BSP_LED_H  </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__BSP_LED_H</span>  </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STC8Ax_GPIO.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">bsp_led_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">void</span> <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> led_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  </span>
</code></pre>
    <h5>
     <a id="bsp_ledc_120">
     </a>
     <strong>
      <code>
       bsp_led.c
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">bsp_led_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// 1. 使用库函数配置P1口为推挽输出模式  </span>
    <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIO_P1<span class="token punctuation">,</span> Pin_All<span class="token punctuation">,</span> GPIO_MODE_OUT_PP<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment">// 2. 初始化所有LED为熄灭状态  </span>
    P1 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">void</span> <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> led_mask<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    P1 <span class="token operator">=</span> led_mask<span class="token punctuation">;</span> <span class="token comment">// 直接设置P1口电平  </span>
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h4>
     <a id="2_drv_runcdrv_runh_139">
     </a>
     2. 驱动层：状态机实现（
     <code>
      drv_run.c
     </code>
     /
     <code>
      drv_run.h
     </code>
     ）
    </h4>
    <h5>
     <a id="drv_runc_140">
     </a>
     <strong>
      <code>
       drv_run.c
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"drv_run.h"</span>  </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_NUM</span> <span class="token expression"><span class="token number">8</span>  </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_ON_TIME</span> <span class="token expression"><span class="token number">10000</span> </span><span class="token comment">// 循环计数阈值（假设主循环周期为1ms）  </span></span>

<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> run_step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token keyword">static</span> <span class="token class-name">uint32_t</span> led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  

<span class="token keyword">void</span> <span class="token function">drv_run_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    run_step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">void</span> <span class="token function">drv_run_update</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">switch</span><span class="token punctuation">(</span>run_step<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token comment">// LED1亮  </span>
            led_cnt<span class="token operator">++</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span><span class="token punctuation">(</span>led_cnt <span class="token operator">&gt;</span> LED_ON_TIME<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
                <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点亮P1.0  </span>
                run_step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  

        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// LED2亮  </span>
            led_cnt<span class="token operator">++</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span><span class="token punctuation">(</span>led_cnt <span class="token operator">&gt;</span> LED_ON_TIME<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
                <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点亮P1.1  </span>
                run_step <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  

        <span class="token comment">// ...（省略中间case，同理至case7）  </span>

        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token comment">// LED8亮  </span>
            led_cnt<span class="token operator">++</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span><span class="token punctuation">(</span>led_cnt <span class="token operator">&gt;</span> LED_ON_TIME<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
                <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点亮P1.7  </span>
                run_step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 循环复位  </span>
            <span class="token punctuation">}</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h4>
     <a id="3_mainc_191">
     </a>
     3. 主函数（
     <code>
      main.c
     </code>
     ）
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"drv_run.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token function">bsp_led_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化LED端口  </span>
    <span class="token function">drv_run_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化状态机  </span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">drv_run_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行状态机逻辑  </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="_208">
     </a>
     流程图与状态转换
    </h3>
    <h4>
     <a id="1__210">
     </a>
     1. 系统初始化流程
    </h4>
    <pre><code class="prism language-mermaid">graph TD  
    A[系统启动] --&gt; B[调用bsp_led_init()配置端口]  
    B --&gt; C[调用drv_run_init()初始化状态变量]  
    C --&gt; D[进入主循环]  
</code></pre>
    <h4>
     <a id="2__218">
     </a>
     2. 状态迁移流程
    </h4>
    <pre><code class="prism language-mermaid">graph LR  
    A[状态0（LED1亮）] --&gt; B[状态1（LED2亮）]  
    B --&gt; C[状态2（LED3亮）]  
    C --&gt; D[状态3（LED4亮）]  
    D --&gt; E[状态4（LED5亮）]  
    E --&gt; F[状态5（LED6亮）]  
    F --&gt; G[状态6（LED7亮）]  
    G --&gt; H[状态7（LED8亮）]  
    H --&gt; A[状态0循环]  
</code></pre>
    <hr/>
    <h3>
     <a id="_233">
     </a>
     测试验证
    </h3>
    <h4>
     <a id="1__235">
     </a>
     1. 硬件连接
    </h4>
    <ul>
     <li>
      <strong>
       电路要求
      </strong>
      ：
      <ul>
       <li>
        8个LED的阳极通过220Ω电阻连接至VCC。
       </li>
       <li>
        阴极分别连接至P1.0~P1.7引脚。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="2__240">
     </a>
     2. 预期结果
    </h4>
    <ul>
     <li>
      LED依次从P1.0到P1.7逐个点亮，形成流动效果。
     </li>
     <li>
      每个LED亮灯时长为
      <code>
       LED_ON_TIME * 主循环周期
      </code>
      （默认1秒）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_248">
     </a>
     文件结构与工程配置
    </h3>
    <h4>
     <a id="1__250">
     </a>
     1. 目录结构
    </h4>
    <pre><code>STC8_Project/  
├── Projects/  
│   ├── MDK-C51/  
│   │   ├── STC8_LED2.uvproj  
│   │   └── Output/STC8_LED2.hex  
├── Drivers/  
│   ├── BSP/  
│   │   ├── bsp_led.c  
│   │   └── bsp_led.h  
│   ├── Module/  
│   │   ├── drv_run.c  
│   │   └── drv_run.h  
│   ├── Core/  
│   │   └── stc8h8k64u4.h  
│   └── STC8_Libraries/  
│       ├── STC8Ax_GPIO.c  
│       └── STC8Ax_GPIO.h  
└── User/  
    ├── main.c  
    └── startup_stc8h.asm  
</code></pre>
    <h4>
     <a id="2_Keil_274">
     </a>
     2. Keil配置
    </h4>
    <ul>
     <li>
      <strong>
       分组设置
      </strong>
      ：
      <ul>
       <li>
        <strong>
         Core
        </strong>
        ：添加
        <code>
         Drivers/Core/stc8h8k64u4.h
        </code>
       </li>
       <li>
        <strong>
         BSP
        </strong>
        ：添加
        <code>
         Drivers/BSP/bsp_led.c
        </code>
       </li>
       <li>
        <strong>
         Module
        </strong>
        ：添加
        <code>
         Drivers/Module/drv_run.c
        </code>
       </li>
       <li>
        <strong>
         STC8_Libraries
        </strong>
        ：添加
        <code>
         Drivers/STC8_Libraries/STC8Ax_GPIO.c
        </code>
       </li>
       <li>
        <strong>
         Include Paths
        </strong>
        ：
        <pre><code>Drivers/BSP  
Drivers/Module  
Drivers/Core/Inc  
Drivers/STC8_Libraries  
User  
</code></pre>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_291">
     </a>
     扩展应用
    </h3>
    <ol>
     <li>
      <strong>
       模式切换
      </strong>
      ：通过修改
      <code>
       GPIO_Init
      </code>
      的
      <code>
       mode
      </code>
      参数，可快速切换为开漏输出（
      <code>
       GPIO_MODE_OUT_OD
      </code>
      ）。
     </li>
     <li>
      <strong>
       上拉控制
      </strong>
      ：使用
      <code>
       GPIO_PULLUP_ENABLE
      </code>
      宏启用GPIO上拉电阻。
     </li>
     <li>
      <strong>
       驱动强度
      </strong>
      ：通过
      <code>
       GPIO_DRIVE_HIGH
      </code>
      宏设置高驱动强度。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_298">
     </a>
     结论
    </h3>
    <p>
     本教程通过整合GPIO库函数，实现了更简洁、可维护的跑马灯代码。库函数封装了底层寄存器操作，降低了开发复杂度，同时保持了代码的模块化与扩展性。开发者可基于此范式快速构建复杂GPIO控制场景，提升开发效率。
    </p>
    <h3>
     <a id="_300">
     </a>
     扩展应用
    </h3>
    <ol>
     <li>
      <strong>
       模式切换
      </strong>
      ：通过修改
      <code>
       GPIO_Init
      </code>
      的
      <code>
       mode
      </code>
      参数，可快速切换为开漏输出（
      <code>
       GPIO_MODE_OUT_OD
      </code>
      ）。
     </li>
     <li>
      <strong>
       上拉控制
      </strong>
      ：使用
      <code>
       GPIO_PULLUP_ENABLE
      </code>
      宏启用GPIO上拉电阻。
     </li>
     <li>
      <strong>
       驱动强度
      </strong>
      ：通过
      <code>
       GPIO_DRIVE_HIGH
      </code>
      宏设置高驱动强度。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_307">
     </a>
     结论
    </h3>
    <p>
     本教程通过整合GPIO库函数，实现了更简洁、可维护的跑马灯代码。库函数封装了底层寄存器操作，降低了开发复杂度，同时保持了代码的模块化与扩展性。开发者可基于此范式快速构建复杂GPIO控制场景，提升开发效率。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363431393430392f:61727469636c652f64657461696c732f313436333031303534" class_="artid" style="display:none">
 </p>
</div>


