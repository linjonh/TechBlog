---
layout: post
title: "极光-OrbitSTC8x05.-GPIO库函数驱动LED流动"
date: 2025-03-16 20:41:40 +0800
description: "本文基于STC8H8K64U4单片机，通过整合GPIO库函数实现跑马灯功能。教程详细讲解如何使用库函数替代直接寄存器操作，涵盖端口模式配置、驱动层优化及代码重构。通过模块化设计与库函数封装，提升代码可读性与复用性，为复杂项目开发奠定基础。"
keywords: "【极光 Orbit·STC8x】05. GPIO库函数驱动LED流动"
categories: ['极光', 'Orbit']
tags: ['嵌入式', '单片机', 'Stm', 'Stc', 'Mongodb']
artid: "146301054"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146301054
    alt: "极光-OrbitSTC8x05.-GPIO库函数驱动LED流动"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146301054
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146301054
cover: https://bing.ee123.net/img/rand?artid=146301054
image: https://bing.ee123.net/img/rand?artid=146301054
img: https://bing.ee123.net/img/rand?artid=146301054
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【极光 Orbit·STC8x】05. GPIO库函数驱动LED流动
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_OrbitSTC805_GPIOLED_0">
     </a>
     【极光 Orbit·STC8】05. GPIO库函数驱动LED流动
    </h2>
    <hr/>
    <h3>
     <a id="___4">
     </a>
     七律 · 逐光流转
    </h3>
    <p>
     <strong>
      八灯列阵若星河，状态为舟渡长波。
     </strong>
     <br/>
     <strong>
      寄存器中藏玄机，Switch语句定山河。
     </strong>
     <br/>
     <strong>
      循环往复如潮涌，步骤变量掌沉浮。
     </strong>
     <br/>
     <strong>
      单片机前展锋芒，代码织就光之舞。
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="_13">
     </a>
     摘要
    </h3>
    <p>
     本文基于STC8H8K64U4单片机，通过整合GPIO库函数实现跑马灯功能。教程详细讲解如何使用库函数替代直接寄存器操作，涵盖端口模式配置、驱动层优化及代码重构。通过模块化设计与库函数封装，提升代码可读性与复用性，为复杂项目开发奠定基础。
    </p>
    <blockquote>
     <p>
      与 switch 相关的编程技巧请参考：
      <br/>
      https://blog.csdn.net/weixin_46419409/article/details/146279134?spm=1001.2014.3001.5502
      <br/>
      https://blog.csdn.net/weixin_46419409/article/details/146288291?spm=1001.2014.3001.5502
      <br/>
      https://blog.csdn.net/weixin_46419409/article/details/146288301?spm=1001.2014.3001.5502
     </p>
     <p>
      https://blog.csdn.net/weixin_46419409/article/details/146288312?spm=1001.2014.3001.5502
     </p>
    </blockquote>
    <hr/>
    <h3>
     <a id="_25">
     </a>
     关键字
    </h3>
    <p>
     STC8H8K64U4, GPIO库函数, 推挽输出, 模块化设计
    </p>
    <hr/>
    <h3>
     <a id="_30">
     </a>
     引言
    </h3>
    <p>
     STC官方提供的GPIO库函数通过宏定义封装了寄存器操作，简化了端口配置流程。本教程通过以下改进实现功能：
    </p>
    <ol>
     <li>
      <strong>
       库函数替代寄存器操作
      </strong>
      ：使用
      <code>
       GPIO_Init
      </code>
      宏配置端口模式。
     </li>
     <li>
      <strong>
       模块化架构
      </strong>
      ：BSP层负责硬件抽象，驱动层实现状态机逻辑。
     </li>
     <li>
      <strong>
       Switch状态机
      </strong>
      ：通过步骤变量
      <code>
       run_step
      </code>
      控制LED流动方向与速度。
     </li>
     <li>
      <strong>
       代码复用性
      </strong>
      ：驱动层可扩展为多模式控制（如正反向流动、变速模式）。
     </li>
     <li>
      <strong>
       代码解耦
      </strong>
      ：BSP层仅依赖库函数，无需直接操作硬件寄存器。
     </li>
     <li>
      <strong>
       扩展性增强
      </strong>
      ：支持快速切换GPIO模式（如开漏、上拉等）。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_41">
     </a>
     硬件设计
    </h3>
    <h4>
     <a id="1__43">
     </a>
     1. 硬件连接
    </h4>
    <p>
     LED通过灌电流方式连接至P1口：
    </p>
    <div class="mermaid">
     <svg class="mermaid-svg" height="166" id="mermaid-svg-LuuFpiWzke5cGLWV" viewbox="-8 -8 648.796875 166" width="648.796875" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-LuuFpiWzke5cGLWV {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-LuuFpiWzke5cGLWV .error-icon{fill:#552222;}#mermaid-svg-LuuFpiWzke5cGLWV .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-LuuFpiWzke5cGLWV .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-LuuFpiWzke5cGLWV .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-LuuFpiWzke5cGLWV .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-LuuFpiWzke5cGLWV .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-LuuFpiWzke5cGLWV .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-LuuFpiWzke5cGLWV .marker{fill:#333333;stroke:#333333;}#mermaid-svg-LuuFpiWzke5cGLWV .marker.cross{stroke:#333333;}#mermaid-svg-LuuFpiWzke5cGLWV svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-LuuFpiWzke5cGLWV .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-LuuFpiWzke5cGLWV .cluster-label text{fill:#333;}#mermaid-svg-LuuFpiWzke5cGLWV .cluster-label span{color:#333;}#mermaid-svg-LuuFpiWzke5cGLWV .label text,#mermaid-svg-LuuFpiWzke5cGLWV span{fill:#333;color:#333;}#mermaid-svg-LuuFpiWzke5cGLWV .node rect,#mermaid-svg-LuuFpiWzke5cGLWV .node circle,#mermaid-svg-LuuFpiWzke5cGLWV .node ellipse,#mermaid-svg-LuuFpiWzke5cGLWV .node polygon,#mermaid-svg-LuuFpiWzke5cGLWV .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-LuuFpiWzke5cGLWV .node .label{text-align:center;}#mermaid-svg-LuuFpiWzke5cGLWV .node.clickable{cursor:pointer;}#mermaid-svg-LuuFpiWzke5cGLWV .arrowheadPath{fill:#333333;}#mermaid-svg-LuuFpiWzke5cGLWV .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-LuuFpiWzke5cGLWV .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-LuuFpiWzke5cGLWV .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-LuuFpiWzke5cGLWV .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-LuuFpiWzke5cGLWV .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-LuuFpiWzke5cGLWV .cluster text{fill:#333;}#mermaid-svg-LuuFpiWzke5cGLWV .cluster span{color:#333;}#mermaid-svg-LuuFpiWzke5cGLWV div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-LuuFpiWzke5cGLWV :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M126.5625,31L130.72916666666666,31C134.89583333333334,31,143.22916666666666,31,151.5625,31C159.89583333333334,31,168.22916666666666,31,172.39583333333334,31L176.5625,31" marker-end="url(#arrowhead104)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead104" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M265.59375,31L269.7604166666667,31C273.9270833333333,31,282.2604166666667,31,290.59375,31C298.9270833333333,31,307.2604166666667,31,311.4270833333333,31L315.59375,31" marker-end="url(#arrowhead105)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead105" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;">
          <path class="path" d="M403.46875,31L407.6354166666667,31C411.8020833333333,31,420.1354166666667,31,428.46875,31C436.8020833333333,31,445.1354166666667,31,449.3020833333333,31L453.46875,31" marker-end="url(#arrowhead106)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead106" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M531.953125,31L536.1197916666666,31C540.2864583333334,31,548.6197916666666,31,556.953125,31C565.2864583333334,31,573.6197916666666,31,577.7864583333334,31L581.953125,31" marker-end="url(#arrowhead107)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead107" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-F LE-G" id="L-F-G" style="opacity: 1;">
          <path class="path" d="M91.5546875,127L101.55598958333333,127C111.55729166666667,127,131.55989583333334,127,146.60677083333334,127C161.65364583333334,127,171.74479166666666,127,176.79036458333334,127L181.8359375,127" marker-end="url(#arrowhead108)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead108" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-D" id="L-L-C-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-F' L-LE-G" id="L-L-F-G">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-81" style="opacity: 1;" transform="translate(67.28125,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="118.5625" x="-59.28125" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-49.28125,-13)">
            <foreignobject height="26" width="98.5625">
             <div style="display: inline-block; white-space: nowrap;">
              STC8H8K64U4
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-82" style="opacity: 1;" transform="translate(221.078125,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="89.03125" x="-44.515625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-34.515625,-13)">
            <foreignobject height="26" width="69.03125">
             <div style="display: inline-block; white-space: nowrap;">
              P1.0-P1.7
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-84" style="opacity: 1;" transform="translate(359.53125,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="87.875" x="-43.9375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-33.9375,-13)">
            <foreignobject height="26" width="67.875">
             <div style="display: inline-block; white-space: nowrap;">
              220Ω电阻
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-86" style="opacity: 1;" transform="translate(492.7109375,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="78.484375" x="-39.2421875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-29.2421875,-13)">
            <foreignobject height="26" width="58.484375">
             <div style="display: inline-block; white-space: nowrap;">
              LED阴极
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-88" style="opacity: 1;" transform="translate(607.375,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="50.84375" x="-25.421875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-15.421875,-13)">
            <foreignobject height="26" width="30.84375">
             <div style="display: inline-block; white-space: nowrap;">
              GND
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-89" style="opacity: 1;" transform="translate(67.28125,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="48.546875" x="-24.2734375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-14.2734375,-13)">
            <foreignobject height="26" width="28.546875">
             <div style="display: inline-block; white-space: nowrap;">
              VCC
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-G-90" style="opacity: 1;" transform="translate(221.078125,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="78.484375" x="-39.2421875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-29.2421875,-13)">
            <foreignobject height="26" width="58.484375">
             <div style="display: inline-block; white-space: nowrap;">
              LED阳极
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <hr/>
    <h3>
     <a id="_56">
     </a>
     软件配置
    </h3>
    <h4>
     <a id="1__58">
     </a>
     1. 模块化架构设计
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="262" id="mermaid-svg-c1fjqtFd2ZueO6nh" viewbox="-8 -8 424 262" width="424" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-c1fjqtFd2ZueO6nh {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh .error-icon{fill:#552222;}#mermaid-svg-c1fjqtFd2ZueO6nh .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-c1fjqtFd2ZueO6nh .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-c1fjqtFd2ZueO6nh .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-c1fjqtFd2ZueO6nh .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-c1fjqtFd2ZueO6nh .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-c1fjqtFd2ZueO6nh .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-c1fjqtFd2ZueO6nh .marker{fill:#333333;stroke:#333333;}#mermaid-svg-c1fjqtFd2ZueO6nh .marker.cross{stroke:#333333;}#mermaid-svg-c1fjqtFd2ZueO6nh svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-c1fjqtFd2ZueO6nh .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh .cluster-label text{fill:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh .cluster-label span{color:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh .label text,#mermaid-svg-c1fjqtFd2ZueO6nh span{fill:#333;color:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh .node rect,#mermaid-svg-c1fjqtFd2ZueO6nh .node circle,#mermaid-svg-c1fjqtFd2ZueO6nh .node ellipse,#mermaid-svg-c1fjqtFd2ZueO6nh .node polygon,#mermaid-svg-c1fjqtFd2ZueO6nh .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-c1fjqtFd2ZueO6nh .node .label{text-align:center;}#mermaid-svg-c1fjqtFd2ZueO6nh .node.clickable{cursor:pointer;}#mermaid-svg-c1fjqtFd2ZueO6nh .arrowheadPath{fill:#333333;}#mermaid-svg-c1fjqtFd2ZueO6nh .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-c1fjqtFd2ZueO6nh .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-c1fjqtFd2ZueO6nh .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-c1fjqtFd2ZueO6nh .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-c1fjqtFd2ZueO6nh .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-c1fjqtFd2ZueO6nh .cluster text{fill:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh .cluster span{color:#333;}#mermaid-svg-c1fjqtFd2ZueO6nh div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-c1fjqtFd2ZueO6nh :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M174,41.88L154.66666666666666,48.06666666666666C135.33333333333334,54.25333333333333,96.66666666666667,66.62666666666667,77.33333333333333,76.98C58,87.33333333333333,58,95.66666666666667,58,99.83333333333333L58,104" marker-end="url(#arrowhead123)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead123" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M58,150L58,154.16666666666666C58,158.33333333333334,58,166.66666666666666,58,175C58,183.33333333333334,58,191.66666666666666,58,195.83333333333334L58,200" marker-end="url(#arrowhead124)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead124" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-D" id="L-A-D" style="opacity: 1;">
          <path class="path" d="M242,52.760000000000005L248.83333333333334,57.13333333333333C255.66666666666666,61.50666666666667,269.3333333333333,70.25333333333333,276.1666666666667,78.79333333333334C283,87.33333333333333,283,95.66666666666667,283,99.83333333333333L283,104" marker-end="url(#arrowhead125)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead125" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M252.1640625,146.735L244.80338541666666,151.44583333333335C237.44270833333334,156.15666666666667,222.72135416666666,165.57833333333335,215.36067708333334,174.45583333333335C208,183.33333333333334,208,191.66666666666666,208,195.83333333333334L208,200" marker-end="url(#arrowhead126)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead126" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-F" id="L-D-F" style="opacity: 1;">
          <path class="path" d="M313.8359375,146.735L321.1966145833333,151.44583333333335C328.5572916666667,156.15666666666667,343.2786458333333,165.57833333333335,350.6393229166667,174.45583333333335C358,183.33333333333334,358,191.66666666666666,358,195.83333333333334L358,200" marker-end="url(#arrowhead127)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead127" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-D" id="L-L-A-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-F" id="L-L-D-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-101" style="opacity: 1;" transform="translate(208,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              主函数
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-102" style="opacity: 1;" transform="translate(58,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              驱动层
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-104" style="opacity: 1;" transform="translate(58,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              状态机实现
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-106" style="opacity: 1;" transform="translate(283,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="61.671875" x="-30.8359375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-20.8359375,-13)">
            <foreignobject height="26" width="41.671875">
             <div style="display: inline-block; white-space: nowrap;">
              BSP层
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-108" style="opacity: 1;" transform="translate(208,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              端口初始化
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-110" style="opacity: 1;" transform="translate(358,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              寄存器配置
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h4>
     <a id="2__69">
     </a>
     2. 文件结构
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="216" id="mermaid-svg-ZrOlGqnuWLCIfj1Z" viewbox="-8 -8 910.640625 216" width="910.640625" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-ZrOlGqnuWLCIfj1Z {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .error-icon{fill:#552222;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .marker{fill:#333333;stroke:#333333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .marker.cross{stroke:#333333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .cluster-label text{fill:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .cluster-label span{color:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .label text,#mermaid-svg-ZrOlGqnuWLCIfj1Z span{fill:#333;color:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .node rect,#mermaid-svg-ZrOlGqnuWLCIfj1Z .node circle,#mermaid-svg-ZrOlGqnuWLCIfj1Z .node ellipse,#mermaid-svg-ZrOlGqnuWLCIfj1Z .node polygon,#mermaid-svg-ZrOlGqnuWLCIfj1Z .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .node .label{text-align:center;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .node.clickable{cursor:pointer;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .arrowheadPath{fill:#333333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .cluster text{fill:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z .cluster span{color:#333;}#mermaid-svg-ZrOlGqnuWLCIfj1Z div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-ZrOlGqnuWLCIfj1Z :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
         <g class="cluster" id="flowchart-subGraph0-139" style="opacity: 1;" transform="translate(451.3203125,104)">
          <rect height="192" width="886.640625" x="-443.3203125" y="-96">
          </rect>
          <g class="label" id="mermaid-svg-ZrOlGqnuWLCIfj1ZText" transform="translate(0, -82)">
           <g transform="translate(-47.5859375,-13)">
            <foreignobject height="26" width="95.171875">
             <div style="display: inline-block; white-space: nowrap;">
              STC8_Project
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-Projects LE-MDK-C51" id="L-Projects-MDK-C51" style="opacity: 1;">
          <path class="path" d="M117.18025716145833,79L111.70099555121527,83.16666666666667C106.22173394097221,87.33333333333333,95.2632107204861,95.66666666666667,89.78394911024304,104C84.3046875,112.33333333333333,84.3046875,120.66666666666667,84.3046875,124.83333333333333L84.3046875,129" marker-end="url(#arrowhead156)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead156" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Projects LE-Output" id="L-Projects-Output" style="opacity: 1;">
          <path class="path" d="M177.67130533854166,79L183.1505669487847,83.16666666666667C188.62982855902774,87.33333333333333,199.58835177951389,95.66666666666667,205.06761338975693,104C210.546875,112.33333333333333,210.546875,120.66666666666667,210.546875,124.83333333333333L210.546875,129" marker-end="url(#arrowhead157)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead157" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-BSP" id="L-Drivers-BSP" style="opacity: 1;">
          <path class="path" d="M447.7890625,66.19854583471938L426.2109375,72.49878819559949C404.6328125,78.7990305564796,361.4765625,91.39951527823979,339.8984375,101.86642430578657C318.3203125,112.33333333333333,318.3203125,120.66666666666667,318.3203125,124.83333333333333L318.3203125,129" marker-end="url(#arrowhead158)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead158" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-Module" id="L-Drivers-Module" style="opacity: 1;">
          <path class="path" d="M455.86669921875,79L451.002197265625,83.16666666666667C446.1376953125,87.33333333333333,436.40869140625,95.66666666666667,431.544189453125,104C426.6796875,112.33333333333333,426.6796875,120.66666666666667,426.6796875,124.83333333333333L426.6796875,129" marker-end="url(#arrowhead159)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead159" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-Core" id="L-Drivers-Core" style="opacity: 1;">
          <path class="path" d="M509.57080078125,79L514.435302734375,83.16666666666667C519.2998046875,87.33333333333333,529.02880859375,95.66666666666667,533.893310546875,104C538.7578125,112.33333333333333,538.7578125,120.66666666666667,538.7578125,124.83333333333333L538.7578125,129" marker-end="url(#arrowhead160)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead160" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-Drivers LE-STC8_Libraries" id="L-Drivers-STC8_Libraries" style="opacity: 1;">
          <path class="path" d="M517.6484375,64.5822602575382L544.38671875,71.1518835479485C571.125,77.72150683835879,624.6015625,90.8607534191794,651.33984375,101.59704337625637C678.078125,112.33333333333333,678.078125,120.66666666666667,678.078125,124.83333333333333L678.078125,129" marker-end="url(#arrowhead161)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead161" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-User LE-main.c" id="L-User-main.c" style="opacity: 1;">
          <path class="path" d="M825.2421875,79L825.2421875,83.16666666666667C825.2421875,87.33333333333333,825.2421875,95.66666666666667,825.2421875,104C825.2421875,112.33333333333333,825.2421875,120.66666666666667,825.2421875,124.83333333333333L825.2421875,129" marker-end="url(#arrowhead162)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead162" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Projects' L-LE-MDK-C51" id="L-L-Projects-MDK-C51">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Projects' L-LE-Output" id="L-L-Projects-Output">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-BSP" id="L-L-Drivers-BSP">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-Module" id="L-L-Drivers-Module">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-Core" id="L-L-Drivers-Core">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-Drivers' L-LE-STC8_Libraries" id="L-L-Drivers-STC8_Libraries">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-User' L-LE-main.c" id="L-L-User-main.c">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-MDK-C51-126" style="opacity: 1;" transform="translate(84.3046875,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="82.609375" x="-41.3046875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-31.3046875,-13)">
            <foreignobject height="26" width="62.609375">
             <div style="display: inline-block; white-space: nowrap;">
              MDK-C51
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Projects-125" style="opacity: 1;" transform="translate(147.42578125,56)">
          <rect class="label-container" height="46" rx="0" ry="0" width="78.3125" x="-39.15625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-29.15625,-13)">
            <foreignobject height="26" width="58.3125">
             <div style="display: inline-block; white-space: nowrap;">
              Projects
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Output-128" style="opacity: 1;" transform="translate(210.546875,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="69.875" x="-34.9375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24.9375,-13)">
            <foreignobject height="26" width="49.875">
             <div style="display: inline-block; white-space: nowrap;">
              Output
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-BSP-130" style="opacity: 1;" transform="translate(318.3203125,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="45.671875" x="-22.8359375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-12.8359375,-13)">
            <foreignobject height="26" width="25.671875">
             <div style="display: inline-block; white-space: nowrap;">
              BSP
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Drivers-129" style="opacity: 1;" transform="translate(482.71875,56)">
          <rect class="label-container" height="46" rx="0" ry="0" width="69.859375" x="-34.9296875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24.9296875,-13)">
            <foreignobject height="26" width="49.859375">
             <div style="display: inline-block; white-space: nowrap;">
              Drivers
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Module-132" style="opacity: 1;" transform="translate(426.6796875,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="71.046875" x="-35.5234375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-25.5234375,-13)">
            <foreignobject height="26" width="51.046875">
             <div style="display: inline-block; white-space: nowrap;">
              Module
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-Core-134" style="opacity: 1;" transform="translate(538.7578125,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="53.109375" x="-26.5546875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-16.5546875,-13)">
            <foreignobject height="26" width="33.109375">
             <div style="display: inline-block; white-space: nowrap;">
              Core
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-STC8_Libraries-136" style="opacity: 1;" transform="translate(678.078125,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="125.53125" x="-62.765625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-52.765625,-13)">
            <foreignobject height="26" width="105.53125">
             <div style="display: inline-block; white-space: nowrap;">
              STC8_Libraries
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-main.c-138" style="opacity: 1;" transform="translate(825.2421875,152)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68.796875" x="-34.3984375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24.3984375,-13)">
            <foreignobject height="26" width="48.796875">
             <div style="display: inline-block; white-space: nowrap;">
              main.c
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-User-137" style="opacity: 1;" transform="translate(825.2421875,56)">
          <rect class="label-container" height="46" rx="0" ry="0" width="51.796875" x="-25.8984375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-15.8984375,-13)">
            <foreignobject height="26" width="31.796875">
             <div style="display: inline-block; white-space: nowrap;">
              User
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <hr/>
    <h4>
     <a id="3_GPIO_86">
     </a>
     3. GPIO库函数集成
    </h4>
    <h5>
     <a id="_87">
     </a>
     <strong>
      库文件位置
     </strong>
    </h5>
    <pre><code>Drivers/STC8_Libraries/  
├── STC8Ax_GPIO.c  
└── STC8Ax_GPIO.h  
</code></pre>
    <h5>
     <a id="_94">
     </a>
     <strong>
      关键宏定义
     </strong>
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        宏定义
       </th>
       <th>
        作用描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         GPIO_Init
        </code>
       </td>
       <td>
        配置GPIO端口模式
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GPIO_MODE_OUT_PP
        </code>
       </td>
       <td>
        推挽输出模式
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GPIO_P1
        </code>
       </td>
       <td>
        表示P1端口
       </td>
      </tr>
      <tr>
       <td>
        <code>
         Pin_All
        </code>
       </td>
       <td>
        表示端口所有引脚
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_104">
     </a>
     代码实现
    </h3>
    <h4>
     <a id="1_BSPbsp_ledcbsp_ledh_106">
     </a>
     1. BSP层：硬件抽象（
     <code>
      bsp_led.c
     </code>
     /
     <code>
      bsp_led.h
     </code>
     ）
    </h4>
    <h5>
     <a id="bsp_ledh_107">
     </a>
     <strong>
      <code>
       bsp_led.h
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__BSP_LED_H  </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__BSP_LED_H</span>  </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STC8Ax_GPIO.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">bsp_led_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">void</span> <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> led_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>  </span>
</code></pre>
    <h5>
     <a id="bsp_ledc_120">
     </a>
     <strong>
      <code>
       bsp_led.c
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">bsp_led_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// 1. 使用库函数配置P1口为推挽输出模式  </span>
    <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIO_P1<span class="token punctuation">,</span> Pin_All<span class="token punctuation">,</span> GPIO_MODE_OUT_PP<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment">// 2. 初始化所有LED为熄灭状态  </span>
    P1 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">void</span> <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> led_mask<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    P1 <span class="token operator">=</span> led_mask<span class="token punctuation">;</span> <span class="token comment">// 直接设置P1口电平  </span>
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h4>
     <a id="2_drv_runcdrv_runh_139">
     </a>
     2. 驱动层：状态机实现（
     <code>
      drv_run.c
     </code>
     /
     <code>
      drv_run.h
     </code>
     ）
    </h4>
    <h5>
     <a id="drv_runc_140">
     </a>
     <strong>
      <code>
       drv_run.c
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"drv_run.h"</span>  </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_NUM</span> <span class="token expression"><span class="token number">8</span>  </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LED_ON_TIME</span> <span class="token expression"><span class="token number">10000</span> </span><span class="token comment">// 循环计数阈值（假设主循环周期为1ms）  </span></span>

<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> run_step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token keyword">static</span> <span class="token class-name">uint32_t</span> led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  

<span class="token keyword">void</span> <span class="token function">drv_run_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    run_step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">void</span> <span class="token function">drv_run_update</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">switch</span><span class="token punctuation">(</span>run_step<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token comment">// LED1亮  </span>
            led_cnt<span class="token operator">++</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span><span class="token punctuation">(</span>led_cnt <span class="token operator">&gt;</span> LED_ON_TIME<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
                <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点亮P1.0  </span>
                run_step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  

        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// LED2亮  </span>
            led_cnt<span class="token operator">++</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span><span class="token punctuation">(</span>led_cnt <span class="token operator">&gt;</span> LED_ON_TIME<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
                <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点亮P1.1  </span>
                run_step <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  

        <span class="token comment">// ...（省略中间case，同理至case7）  </span>

        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token comment">// LED8亮  </span>
            led_cnt<span class="token operator">++</span><span class="token punctuation">;</span>  
            <span class="token keyword">if</span><span class="token punctuation">(</span>led_cnt <span class="token operator">&gt;</span> LED_ON_TIME<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                led_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
                <span class="token function">bsp_set_led</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 点亮P1.7  </span>
                run_step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 循环复位  </span>
            <span class="token punctuation">}</span>  
            <span class="token keyword">break</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h4>
     <a id="3_mainc_191">
     </a>
     3. 主函数（
     <code>
      main.c
     </code>
     ）
    </h4>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_led.h"</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"drv_run.h"</span>  </span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token function">bsp_led_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化LED端口  </span>
    <span class="token function">drv_run_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化状态机  </span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">drv_run_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行状态机逻辑  </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="_208">
     </a>
     流程图与状态转换
    </h3>
    <h4>
     <a id="1__210">
     </a>
     1. 系统初始化流程
    </h4>
    <pre><code class="prism language-mermaid">graph TD  
    A[系统启动] --&gt; B[调用bsp_led_init()配置端口]  
    B --&gt; C[调用drv_run_init()初始化状态变量]  
    C --&gt; D[进入主循环]  
</code></pre>
    <h4>
     <a id="2__218">
     </a>
     2. 状态迁移流程
    </h4>
    <pre><code class="prism language-mermaid">graph LR  
    A[状态0（LED1亮）] --&gt; B[状态1（LED2亮）]  
    B --&gt; C[状态2（LED3亮）]  
    C --&gt; D[状态3（LED4亮）]  
    D --&gt; E[状态4（LED5亮）]  
    E --&gt; F[状态5（LED6亮）]  
    F --&gt; G[状态6（LED7亮）]  
    G --&gt; H[状态7（LED8亮）]  
    H --&gt; A[状态0循环]  
</code></pre>
    <hr/>
    <h3>
     <a id="_233">
     </a>
     测试验证
    </h3>
    <h4>
     <a id="1__235">
     </a>
     1. 硬件连接
    </h4>
    <ul>
     <li>
      <strong>
       电路要求
      </strong>
      ：
      <ul>
       <li>
        8个LED的阳极通过220Ω电阻连接至VCC。
       </li>
       <li>
        阴极分别连接至P1.0~P1.7引脚。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="2__240">
     </a>
     2. 预期结果
    </h4>
    <ul>
     <li>
      LED依次从P1.0到P1.7逐个点亮，形成流动效果。
     </li>
     <li>
      每个LED亮灯时长为
      <code>
       LED_ON_TIME * 主循环周期
      </code>
      （默认1秒）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_248">
     </a>
     文件结构与工程配置
    </h3>
    <h4>
     <a id="1__250">
     </a>
     1. 目录结构
    </h4>
    <pre><code>STC8_Project/  
├── Projects/  
│   ├── MDK-C51/  
│   │   ├── STC8_LED2.uvproj  
│   │   └── Output/STC8_LED2.hex  
├── Drivers/  
│   ├── BSP/  
│   │   ├── bsp_led.c  
│   │   └── bsp_led.h  
│   ├── Module/  
│   │   ├── drv_run.c  
│   │   └── drv_run.h  
│   ├── Core/  
│   │   └── stc8h8k64u4.h  
│   └── STC8_Libraries/  
│       ├── STC8Ax_GPIO.c  
│       └── STC8Ax_GPIO.h  
└── User/  
    ├── main.c  
    └── startup_stc8h.asm  
</code></pre>
    <h4>
     <a id="2_Keil_274">
     </a>
     2. Keil配置
    </h4>
    <ul>
     <li>
      <strong>
       分组设置
      </strong>
      ：
      <ul>
       <li>
        <strong>
         Core
        </strong>
        ：添加
        <code>
         Drivers/Core/stc8h8k64u4.h
        </code>
       </li>
       <li>
        <strong>
         BSP
        </strong>
        ：添加
        <code>
         Drivers/BSP/bsp_led.c
        </code>
       </li>
       <li>
        <strong>
         Module
        </strong>
        ：添加
        <code>
         Drivers/Module/drv_run.c
        </code>
       </li>
       <li>
        <strong>
         STC8_Libraries
        </strong>
        ：添加
        <code>
         Drivers/STC8_Libraries/STC8Ax_GPIO.c
        </code>
       </li>
       <li>
        <strong>
         Include Paths
        </strong>
        ：
        <pre><code>Drivers/BSP  
Drivers/Module  
Drivers/Core/Inc  
Drivers/STC8_Libraries  
User  
</code></pre>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_291">
     </a>
     扩展应用
    </h3>
    <ol>
     <li>
      <strong>
       模式切换
      </strong>
      ：通过修改
      <code>
       GPIO_Init
      </code>
      的
      <code>
       mode
      </code>
      参数，可快速切换为开漏输出（
      <code>
       GPIO_MODE_OUT_OD
      </code>
      ）。
     </li>
     <li>
      <strong>
       上拉控制
      </strong>
      ：使用
      <code>
       GPIO_PULLUP_ENABLE
      </code>
      宏启用GPIO上拉电阻。
     </li>
     <li>
      <strong>
       驱动强度
      </strong>
      ：通过
      <code>
       GPIO_DRIVE_HIGH
      </code>
      宏设置高驱动强度。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_298">
     </a>
     结论
    </h3>
    <p>
     本教程通过整合GPIO库函数，实现了更简洁、可维护的跑马灯代码。库函数封装了底层寄存器操作，降低了开发复杂度，同时保持了代码的模块化与扩展性。开发者可基于此范式快速构建复杂GPIO控制场景，提升开发效率。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363431393430392f:61727469636c652f64657461696c732f313436333031303534" class_="artid" style="display:none">
 </p>
</div>


