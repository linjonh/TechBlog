---
layout: post
title: Java操作Word文档
date: 2025-01-09 16:41:12 +0800
categories: ['开发语言']
tags: ['开发语言', '后端', 'Java']
image:
    path: https://img-blog.csdnimg.cn/img_convert/fc34657b710de4122c79b0942d8db889.png?x-oss-process=image/resize,m_fixed,h_150
    alt: Java操作Word文档
artid: 121240987
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=121240987
featuredImagePreview: https://bing.ee123.net/img/rand?artid=121240987
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Java操作Word文档
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <hr/>
    <p>
     title: Java操作Word文档
     <br/>
     description: 使用 Spire.Doc for Java操作Word文档；替换Word模板中的占位符，然后生成新的Word文档
     <br/>
     tags: [工具]
     <br/>
     categories:
    </p>
    <ul>
     <li>
      其他
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="Java__Word__10">
     </a>
     Java 生成 Word 的几种方案
    </h3>
    <blockquote>
     <p>
      <a href="http://blog.sina.com.cn/s/blog_a5e968370101crtl.html" rel="nofollow">
       参考
      </a>
     </p>
    </blockquote>
    <p>
     ​ 主要有这么一些工具可以使用 Jacob、Apache POI、Java2word、iText，还有一种方法是使用XML作为模板。
    </p>
    <p>
     ​ 使用 XML 的思路：先用 office 编辑好word的样式，然后另存为xml，将xml翻译为FreeMarker模板，最后用java来解析 FreeMarker模板 并输出 Word 文档。经测试这样方式生成的word文档完全符合 office 标准，样式、内容控制非常便利，打印也不会变形，生成的文档和office中编辑文档完全一样。 ===&gt;
     <a href="https://www.cnblogs.com/hongzm/p/11266805.html" rel="nofollow">
      参考
     </a>
    </p>
    <p>
     <img alt="image-20211021162828629" src="https://i-blog.csdnimg.cn/blog_migrate/64462d489e25d0444e36d53f8f5aef2f.png"/>
    </p>
    <ul>
     <li>
      Jacob 和 Java2word需要服务器端支持 office，相对麻烦。
     </li>
     <li>
      Apache POI 功能较少。===&gt;
      <a href="http://deepoove.com/poi-tl/apache-poi-guide.html" rel="nofollow">
       参考
      </a>
     </li>
    </ul>
    <p>
     ​ 这里推荐一个刚刚发现的产品，由成都冰蓝科技开发的产品 Spire，可以用于操作各种文档，目前我只体验过 Spire.Doc for Java，个人认为使用简单，功能强大，对样式的支持非常好（虽然Spire主要面向企业提供产品，但是也提供了免费使用的产品）。最大的缺点是，免费版，没有 Api 文档且Jar包不能完美反编译，只有使用文档，有些代码只能依靠名称推断作用，所以很难深入的挖掘 Spire 的用法。
    </p>
    <h3>
     <a id="_SpireDoc__Word__27">
     </a>
     使用 Spire.Doc 替换 Word 模板中占位符
    </h3>
    <p>
     这里使用 Maven 下载 Spire.Doc 也可以直接
     <a href="https://repo.e-iceblue.cn/repository/maven-public/e-iceblue/spire.doc.free/3.9.0/spire.doc.free-3.9.0.jar" rel="nofollow">
      下载 jar 包
     </a>
     ==&gt;
     <a href="https://repo.e-iceblue.cn/#browse/browse:maven-public:e-iceblue%2Fspire.doc.free%2F3.9.0%2Fspire.doc.free-3.9.0.jar" rel="nofollow">
      参考
     </a>
    </p>
    <p>
     1️⃣：首先引入 Maven 依赖
    </p>
    <p>
     ​ 在 Maven 的官方仓库或者阿里云镜像仓库中是没有 Spire 依赖的，所以需要配置 Spire 自己的一个仓库源。
    </p>
    <pre><code class="prism language-pom">&lt;repositories&gt;
	&lt;repository&gt;
        &lt;id&gt;com.e-iceblue&lt;/id&gt;
        &lt;url&gt;https://repo.e-iceblue.cn/repository/maven-public/&lt;/url&gt;
	&lt;/repository&gt;
&lt;/repositories&gt;
</code></pre>
    <p>
     ​ 以下就是 Spire.Doc for Java 的依赖
    </p>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!--spire.doc 操作word文档--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>e-iceblue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spire.doc.free<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     2️⃣：设计一个Word模板，此文档中存在占位符
    </p>
    <img alt="image-20211021172656642" src="https://i-blog.csdnimg.cn/blog_migrate/8e47df6ee4580d32941d74283358feeb.png">
     <p>
      3️⃣：编码
     </p>
     <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSpireWord</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">generateAndReplaceText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        doc<span class="token punctuation">.</span><span class="token function">loadFromFile</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\template.docx"</span><span class="token punctuation">,</span> <span class="token class-name">FileFormat<span class="token punctuation">.</span>Docx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"${name}"</span><span class="token punctuation">,</span> <span class="token string">"张山"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"${birthday}"</span><span class="token punctuation">,</span> <span class="token string">"2021-10-18"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"${result}"</span><span class="token punctuation">,</span> <span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"${col}"</span><span class="token punctuation">,</span> <span class="token string">"第一列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"${col1}"</span><span class="token punctuation">,</span> <span class="token string">"第二列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"${col2}"</span><span class="token punctuation">,</span> <span class="token string">"第三列"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">replaceSpecialWord</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 保存为文件</span>
        doc<span class="token punctuation">.</span><span class="token function">saveToFile</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\result.docx"</span><span class="token punctuation">,</span><span class="token class-name">FileFormat<span class="token punctuation">.</span>Docx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 或者保存至输出流中</span>
        <span class="token comment">//ByteArrayOutputStream os = new ByteArrayOutputStream();</span>
        <span class="token comment">//doc.saveToStream(os, FileFormat.Docx);</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 替换Word文件中 ${} 标识的特殊字符
     * &lt;br&gt;
     * &lt;strong&gt;注意：如果存在部分特殊表示无法替换，请尝试将 ${} 的整个字符串复制到word中，有可能word没有将${}识别为一个整体&lt;/strong&gt;
     * @param doc: Sprire Document
     * @param map: 占位符${} 与 需要替换的为字符串的对应关系
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">replaceSpecialWord</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 正则表达式，匹配所有的占位符 ${}</span>
        <span class="token class-name">Pattern</span> pattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"\\$\\{.*?}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据正则表达式获取所有文本</span>
        <span class="token class-name">TextSelection</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allPattern <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">findAllPattern</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 逐个替换占位符</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TextSelection</span> textSelection <span class="token operator">:</span> allPattern<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> tmp <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>textSelection<span class="token punctuation">.</span><span class="token function">getSelectedText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>textSelection<span class="token punctuation">.</span><span class="token function">getSelectedText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> res <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>textSelection<span class="token punctuation">.</span><span class="token function">getSelectedText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tmp<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">": "</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     <p>
      最终结果：
     </p>
     <pre><code class="prism language-java"><span class="token comment">// 控制台输出</span>
$<span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token number">1</span>
$<span class="token punctuation">{<!-- --></span>birthday<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token number">1</span>
$<span class="token punctuation">{<!-- --></span>result<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token number">1</span>
$<span class="token punctuation">{<!-- --></span>col<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token number">1</span>
$<span class="token punctuation">{<!-- --></span>col1<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token number">1</span>
$<span class="token punctuation">{<!-- --></span>col2<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token number">1</span>
</code></pre>
     <img alt="image-20211021173346574" src="https://i-blog.csdnimg.cn/blog_migrate/e78fabc145f294e17cced182c5e08961.png">
      <p>
       ​ 可以看到使用 Spire.Doc for Java 替换占位符十分简单，并且不会破坏模板的原有样 式。
      </p>
      <p>
       ​ 如果需要了解 Spire.Doc for Java 的更多操作，参考 ===&gt;
       <a href="https://www.e-iceblue.cn/spiredocforjava/spire-doc-for-java-program-guide-content.html" rel="nofollow">
        官方文档
       </a>
      </p>
      <h3>
       <a id="SpireDoc_Word_133">
       </a>
       使用Spire.Doc 将Word文档中占位符替换为图片
      </h3>
      <p>
       1️⃣：编写一个测试文档
      </p>
      <img alt="image-20211023191349321" src="https://i-blog.csdnimg.cn/blog_migrate/9251c3d3082ab1714bdd0fbd45b2fd1f.png">
       <p>
        2️⃣：了解Sprie.Doc 是如何插入一张图片
       </p>
       <blockquote>
        <p>
         <a href="https://www.e-iceblue.cn/docforjava/insert-image-into-word-document-in-java.html" rel="nofollow">
          参考—官方文档
         </a>
        </p>
       </blockquote>
       <p>
        Spire.Doc for Java中的 Paragraph类 提供了appendPicture ()方法用于给Word段落添加图片。
       </p>
       <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InsertImage</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建Document对象</span>
        <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加节</span>
        <span class="token class-name">Section</span> section <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">addSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//添加第一个段落</span>
        <span class="token class-name">Paragraph</span> paragraph <span class="token operator">=</span> section<span class="token punctuation">.</span><span class="token function">addParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加图片到段落</span>
        <span class="token class-name">DocPicture</span> picture <span class="token operator">=</span> paragraph<span class="token punctuation">.</span><span class="token function">appendPicture</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Administrator\\Desktop\\Hydrangeas.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置图片宽度</span>
        picture<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token number">300f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置图片高度</span>
        picture<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">250f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//给段落设置水平居中对齐方式</span>
        paragraph<span class="token punctuation">.</span><span class="token function">getFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHorizontalAlignment</span><span class="token punctuation">(</span><span class="token class-name">HorizontalAlignment<span class="token punctuation">.</span>Center</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//保存</span>
        doc<span class="token punctuation">.</span><span class="token function">saveToFile</span><span class="token punctuation">(</span><span class="token string">"InsertImage.docx"</span><span class="token punctuation">,</span> <span class="token class-name">FileFormat<span class="token punctuation">.</span>Docx_2013</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
       <p>
        第二种方式： ===&gt;
        <a href="https://www.evget.com/article/2019/6/18/30761.html" rel="nofollow">
         参考
        </a>
       </p>
       <p>
        ​ 通过获取 Spire.Doc 中的 TextRange 对象，可以用这个对象插入图片。
       </p>
       <pre><code class="prism language-java"><span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">loadFromFile</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\template.docx"</span><span class="token punctuation">,</span> <span class="token class-name">FileFormat<span class="token punctuation">.</span>Docx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 或者可以加载流loadFromStream(.,.)</span>
<span class="token comment">// 0. 使用 Spire.Doc 的 DocPicture类 加载一张图片，并且可以设置图片的宽高</span>
<span class="token class-name">DocPicture</span> pic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DocPicture</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
pic<span class="token punctuation">.</span><span class="token function">loadImage</span><span class="token punctuation">(</span>imgList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. 获取 TextSelection</span>
<span class="token class-name">TextSelection</span> selection <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">findString</span><span class="token punctuation">(</span><span class="token string">"matchString"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 第一个参数是需要的匹配字符串即占位符，后面两个参数的意思为：是否大小写敏感、是否匹配整个单词</span>
<span class="token comment">// 2. 根据 selection 获取 TextRange</span>
<span class="token class-name">TextRange</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getAsOneRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 通过 TextRange 找到 占位符在一个段落中的位置</span>
<span class="token keyword">int</span> index <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getOwnerParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 4. 通过获取到的 index 位置，插入一张图片</span>
range<span class="token punctuation">.</span><span class="token function">getOwnerParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
range<span class="token punctuation">.</span><span class="token function">getOwnerParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 这个remove 操作具体作用不太清楚，但是没有这一步图片是无法正确插入的</span>
</code></pre>
       <p>
        3️⃣：开始编码​
       </p>
       <pre><code class="prism language-java"><span class="token comment">// 测试方法</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">imageTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        doc<span class="token punctuation">.</span><span class="token function">loadFromFile</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\template.docx"</span><span class="token punctuation">,</span> <span class="token class-name">FileFormat<span class="token punctuation">.</span>Docx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\orange.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> file1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\orange.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> in1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">&gt;</span></span> imgList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            imgList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imgList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>in1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> matchString <span class="token operator">=</span> <span class="token string">"${images}"</span><span class="token punctuation">;</span>
            <span class="token function">replaceTextToImage</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> matchString<span class="token punctuation">,</span> imgList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        doc<span class="token punctuation">.</span><span class="token function">saveToFile</span><span class="token punctuation">(</span><span class="token string">"F:\\yourlocation\\result.docx"</span><span class="token punctuation">,</span><span class="token class-name">FileFormat<span class="token punctuation">.</span>Docx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">/**
     * 替换Word文档中的同一占位符，为多张不同的图片，每一个占位符对应一张图片，
     * 如果占位符比图片数量多则该占位符会被写为空字符串
     * @param doc: Spire Document
     * @param matchString: 占位符
     * @param imgList: 图片输入流集合
     * @date 2021/10/22 20:09
     */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">replaceTextToImage</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">String</span> matchString<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">&gt;</span></span> imgList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">TextSelection</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selections <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">findAllString</span><span class="token punctuation">(</span>matchString<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> imgList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TextSelection</span> selection <span class="token operator">:</span> selections<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> total <span class="token operator">&amp;&amp;</span> imgList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">DocPicture</span> pic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DocPicture</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pic<span class="token punctuation">.</span><span class="token function">loadImage</span><span class="token punctuation">(</span>imgList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pic<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token number">100f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 设置图片宽高</span>
            pic<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">100f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TextRange</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getAsOneRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> index <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getOwnerParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
            range<span class="token punctuation">.</span><span class="token function">getOwnerParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> pic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            range<span class="token punctuation">.</span><span class="token function">getOwnerParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getChildObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果已近没有了图片则将所有占位符替换为空</span>
            doc<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span><span class="token function">getSelectedText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



	<span class="token comment">/**
     * 按照横纵比缩放图片
     * @param pic: Spire 图片对象
     * @param rate: 缩放比例 0.1&lt;= rate &lt;=10，
     * @author He Peng
     * @date 2021/10/23 9:28
     */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">zoomImage</span><span class="token punctuation">(</span><span class="token class-name">DocPicture</span> pic<span class="token punctuation">,</span> <span class="token keyword">float</span> rate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rate <span class="token operator">&lt;</span> <span class="token number">0.1</span> <span class="token operator">||</span> rate <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"缩放比例参数的数值范围为：0.1&lt;= rate &lt;=10，不能超过此范围"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">float</span> originalWidth <span class="token operator">=</span> pic<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> originalHeight <span class="token operator">=</span> pic<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pic<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>originalWidth <span class="token operator">*</span> rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pic<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span>originalHeight <span class="token operator">*</span> rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
       <p>
        最终结果：
       </p>
       <img alt="image-20211023191231049" src="https://i-blog.csdnimg.cn/blog_migrate/a8db7b6ebb9d39296bc07322f2229f4a.png">
        <h3>
         <a id="blue_book__279">
         </a>
         📘 参考资料
        </h3>
        <p>
         <a href="https://orange-code.gitee.io/" rel="nofollow">
          个人博客同步发布
         </a>
        </p>
        <p>
         <a href="https://www.jianshu.com/p/6603b1ea3ad1" rel="nofollow">
          POI操作word模板并生成新的word–jianshu
         </a>
         <br/>
         <a href="https://www.e-iceblue.cn/spiredocforjavaoperating/java-draw-checkbox-to-word-document.html" rel="nofollow">
          Spire.doc for Java—官方文档
         </a>
         <br/>
         <a href="https://blog.csdn.net/weixin_45266979/article/details/118969799">
          Spire.Doc for Java 资源—csdn
         </a>
         <br/>
         <a href="https://www.e-iceblue.cn/licensing/install-spirepdf-for-java-from-maven-repository.html" rel="nofollow">
          通过 Maven 仓库安装 Spire 系列 Java 产品—官方文档
         </a>
         <br/>
         <a href="https://www.evget.com/article/2019/6/18/30761.html" rel="nofollow">
          Spire.Doc 系列教程
         </a>
        </p>
       </img>
      </img>
     </img>
    </img>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
</div>


