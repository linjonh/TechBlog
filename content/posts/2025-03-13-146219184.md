---
layout: post
title: "HashMap-中的-key-值类型"
date: 2025-03-13 01:03:37 +0800
description: "String在 Java 中，HashMap的key一般建议使用String。"
keywords: "java map key 推荐类型"
categories: ['未分类']
tags: ['Java']
artid: "146219184"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146219184
    alt: "HashMap-中的-key-值类型"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146219184
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146219184
cover: https://bing.ee123.net/img/rand?artid=146219184
image: https://bing.ee123.net/img/rand?artid=146219184
img: https://bing.ee123.net/img/rand?artid=146219184
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     HashMap 中的 key 值类型
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 Java 中，
     <code>
      HashMap
     </code>
     的
     <code>
      key
     </code>
     一般建议使用
     <code>
      String
     </code>
     而不是自定义对象，主要有以下几个原因：
    </p>
    <h2>
     <a id="1_String_Immutable_1">
     </a>
     1.
     <strong>
      <code>
       String
      </code>
      是不可变对象（Immutable）
     </strong>
    </h2>
    <ul>
     <li>
      <code>
       String
      </code>
      在 Java 中是不可变的，一旦创建就不会改变其哈希值 (
      <code>
       hashCode
      </code>
      )。
     </li>
     <li>
      <code>
       HashMap
      </code>
      依赖
      <code>
       key
      </code>
      的
      <code>
       hashCode()
      </code>
      计算存储位置，如果
      <code>
       key
      </code>
      是可变对象，修改
      <code>
       key
      </code>
      后，它的
      <code>
       hashCode()
      </code>
      可能会改变，导致
      <code>
       HashMap
      </code>
      无法正确查找该
      <code>
       key
      </code>
      ，引发潜在问题（如数据丢失、无法查找等）。
     </li>
     <li>
      例如：
      <pre><code class="prism language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
key<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

key<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 修改 key</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能返回 null</span>
</code></pre>
      由于
      <code>
       ArrayList
      </code>
      的
      <code>
       hashCode()
      </code>
      依赖于内容，
      <code>
       key
      </code>
      变化后
      <code>
       hashCode
      </code>
      变化，导致
      <code>
       HashMap
      </code>
      无法找到原来的
      <code>
       value
      </code>
      。
     </li>
    </ul>
    <h2>
     <a id="2_String__hashCode__15">
     </a>
     2.
     <strong>
      <code>
       String
      </code>
      的
      <code>
       hashCode()
      </code>
      计算高效且稳定
     </strong>
    </h2>
    <ul>
     <li>
      <code>
       String
      </code>
      在 Java 中的
      <code>
       hashCode()
      </code>
      实现是经过高度优化的，并且被广泛使用，计算效率高。
     </li>
     <li>
      <code>
       String
      </code>
      的
      <code>
       hashCode()
      </code>
      计算方式如下：
      <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        h <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> h <span class="token operator">+</span> <span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      由于
      <code>
       String
      </code>
      是
      <code>
       final
      </code>
      类，它的
      <code>
       hashCode()
      </code>
      计算逻辑不会被子类重写或修改，保证了哈希值的一致性。
     </li>
    </ul>
    <h2>
     <a id="3_String__Hash__28">
     </a>
     3.
     <strong>
      <code>
       String
      </code>
      具有良好的分布性，减少 Hash 冲突
     </strong>
    </h2>
    <ul>
     <li>
      在
      <code>
       HashMap
      </code>
      中，良好的
      <code>
       hashCode()
      </code>
      设计可以减少哈希冲突，提高查询效率。
     </li>
     <li>
      <code>
       String
      </code>
      的
      <code>
       hashCode()
      </code>
      计算方式能够较好地分布数据，避免大量
      <code>
       key
      </code>
      落在相同的桶（bucket）里。
     </li>
    </ul>
    <h2>
     <a id="4_String__31">
     </a>
     4.
     <strong>
      <code>
       String
      </code>
      适合作为标识符
     </strong>
    </h2>
    <ul>
     <li>
      <code>
       String
      </code>
      直观易读，可以直接表示用户名、ID、类别等，便于代码理解。
     </li>
     <li>
      例如：
      <pre><code class="prism language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      相比于自定义对象，
      <code>
       String
      </code>
      更适合作为
      <code>
       key
      </code>
      来表示业务属性。
     </li>
    </ul>
    <h2>
     <a id="5__equals__hashCode__40">
     </a>
     5.
     <strong>
      避免
      <code>
       equals()
      </code>
      和
      <code>
       hashCode()
      </code>
      方法实现错误
     </strong>
    </h2>
    <ul>
     <li>
      使用自定义对象作为
      <code>
       key
      </code>
      时，需要正确实现
      <code>
       equals()
      </code>
      和
      <code>
       hashCode()
      </code>
      方法，否则会导致
      <code>
       HashMap
      </code>
      行为异常，如无法正确查找
      <code>
       key
      </code>
      或发生哈希冲突。
     </li>
     <li>
      例如：
      <pre><code class="prism language-java"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      如果
      <code>
       Person
      </code>
      没有正确重写
      <code>
       equals()
      </code>
      和
      <code>
       hashCode()
      </code>
      ，那么
      <code>
       HashMap
      </code>
      可能无法正确区分两个
      <code>
       Person
      </code>
      对象，即使它们的
      <code>
       name
      </code>
      和
      <code>
       age
      </code>
      相同。
     </li>
    </ul>
    <h2>
     <a id="6_String__50">
     </a>
     6.
     <strong>
      <code>
       String
      </code>
      具有内存优化（字符串常量池）
     </strong>
    </h2>
    <ul>
     <li>
      <code>
       String
      </code>
      在 JVM 中有字符串常量池（String Pool），相同字符串可复用，减少内存占用。
     </li>
     <li>
      例如：
      <pre><code class="prism language-java"><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，共享同一个对象</span>
</code></pre>
     </li>
    </ul>
    <h2>
     <a id="_58">
     </a>
     <strong>
      总结
     </strong>
    </h2>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         比较项
        </strong>
       </th>
       <th>
        <strong>
         使用
         <code>
          String
         </code>
         作为
         <code>
          key
         </code>
        </strong>
       </th>
       <th>
        <strong>
         使用对象作为
         <code>
          key
         </code>
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         不可变性
        </strong>
       </td>
       <td>
        不可变，哈希值稳定
       </td>
       <td>
        可能可变，影响
        <code>
         hashCode()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         哈希分布性
        </strong>
       </td>
       <td>
        <code>
         String
        </code>
        的
        <code>
         hashCode()
        </code>
        分布良好
       </td>
       <td>
        需要自定义
        <code>
         hashCode()
        </code>
        ，可能不均匀
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         易用性
        </strong>
       </td>
       <td>
        直观，易读易维护
       </td>
       <td>
        需要正确实现
        <code>
         equals()
        </code>
        和
        <code>
         hashCode()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         性能
        </strong>
       </td>
       <td>
        <code>
         String
        </code>
        的
        <code>
         hashCode()
        </code>
        计算高效
       </td>
       <td>
        可能计算复杂，影响
        <code>
         HashMap
        </code>
        效率
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         内存优化
        </strong>
       </td>
       <td>
        享受 JVM
        <code>
         String Pool
        </code>
        优势
       </td>
       <td>
        没有字符串池机制
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     因此，在
     <code>
      HashMap
     </code>
     中，
     <strong>
      推荐优先使用
      <code>
       String
      </code>
      作为
      <code>
       key
      </code>
     </strong>
     ，如果必须使用对象作为
     <code>
      key
     </code>
     ，需要确保：
    </p>
    <ol>
     <li>
      该对象是不可变的；
     </li>
     <li>
      正确重写
      <code>
       equals()
      </code>
      和
      <code>
       hashCode()
      </code>
      方法。
     </li>
    </ol>
    <p>
     在
     <code>
      HashMap
     </code>
     中，如果
     <code>
      key
     </code>
     是一个对象，并且该对象的
     <strong>
      某个属性发生变化
     </strong>
     ，那么可能会导致无法通过原来的
     <code>
      key
     </code>
     找到对应的
     <code>
      value
     </code>
     。
    </p>
    <h2>
     <a id="_value_72">
     </a>
     <strong>
      为什么找不到原来的
      <code>
       value
      </code>
      ？
     </strong>
    </h2>
    <ol>
     <li>
      <strong>
       <code>
        HashMap
       </code>
       依赖
       <code>
        key
       </code>
       的
       <code>
        hashCode()
       </code>
       计算存储位置
      </strong>
      <ul>
       <li>
        <code>
         HashMap
        </code>
        通过
        <code>
         key
        </code>
        的
        <code>
         hashCode()
        </code>
        计算存储桶（bucket）的索引。
       </li>
       <li>
        如果
        <code>
         key
        </code>
        是对象，并且对象的某些属性影响了
        <code>
         hashCode()
        </code>
        计算，那么修改该属性会导致
        <code>
         hashCode()
        </code>
        变化，使得
        <code>
         HashMap
        </code>
        无法在原来的位置找到该
        <code>
         key
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        HashMap
       </code>
       依赖
       <code>
        equals()
       </code>
       方法查找
       <code>
        key
       </code>
      </strong>
      <ul>
       <li>
        在
        <code>
         HashMap
        </code>
        中，即使两个对象的
        <code>
         hashCode()
        </code>
        相同，最终还是要通过
        <code>
         equals()
        </code>
        方法确认它们是否相等。
       </li>
       <li>
        如果
        <code>
         equals()
        </code>
        方法依赖于某些可变属性，而这些属性发生了变化，那么即使
        <code>
         hashCode()
        </code>
        仍然相同，也可能会导致
        <code>
         equals()
        </code>
        失效，使得
        <code>
         HashMap
        </code>
        无法匹配原来的
        <code>
         key
        </code>
        。
       </li>
      </ul>
     </li>
    </ol>
    <h2>
     <a id="_79">
     </a>
     <strong>
      示例代码
     </strong>
    </h2>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Objects</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
        <span class="token keyword">return</span> age <span class="token operator">==</span> person<span class="token punctuation">.</span>age <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMapKeyTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"Engineer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Before change: "</span> <span class="token operator">+</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常获取 "Engineer"</span>

        <span class="token comment">// 修改 key 对象的属性</span>
        p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"After change: "</span> <span class="token operator">+</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能返回 null</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Contains key: "</span> <span class="token operator">+</span> map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能返回 false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_124">
     </a>
     <strong>
      分析
     </strong>
    </h2>
    <ol>
     <li>
      <code>
       Person
      </code>
      作为
      <code>
       key
      </code>
      ，它的
      <code>
       hashCode()
      </code>
      依赖于
      <code>
       name
      </code>
      和
      <code>
       age
      </code>
      。
     </li>
     <li>
      存入
      <code>
       HashMap
      </code>
      后，
      <code>
       p
      </code>
      计算的
      <code>
       hashCode()
      </code>
      确定了它在
      <code>
       HashMap
      </code>
      的存储位置。
     </li>
     <li>
      修改
      <code>
       p.age
      </code>
      后，
      <code>
       hashCode()
      </code>
      发生变化，导致
      <code>
       HashMap
      </code>
      在查找
      <code>
       p
      </code>
      时，计算出的
      <code>
       hashCode()
      </code>
      对应的存储桶位置可能已经改变。
     </li>
     <li>
      <strong>
       结果：
       <code>
        map.get(p)
       </code>
       可能返回
       <code>
        null
       </code>
       ，即无法找到原来的
       <code>
        value
       </code>
       。
      </strong>
     </li>
    </ol>
    <h2>
     <a id="_129">
     </a>
     <strong>
      如何解决？
     </strong>
    </h2>
    <h3>
     <a id="_1_key_130">
     </a>
     <strong>
      方案 1：使用不可变对象作为
      <code>
       key
      </code>
     </strong>
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
        <span class="token keyword">return</span> age <span class="token operator">==</span> person<span class="token punctuation">.</span>age <span class="token operator">&amp;&amp;</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       优点
      </strong>
      ：保证
      <code>
       key
      </code>
      不变，避免
      <code>
       hashCode()
      </code>
      变化导致查找失败。
     </li>
     <li>
      <strong>
       适用场景
      </strong>
      ：如果
      <code>
       key
      </code>
      需要稳定，建议使用
      <code>
       final
      </code>
      关键字让属性不可变，或者使用
      <code>
       String
      </code>
      作为
      <code>
       key
      </code>
      。
     </li>
    </ul>
    <h3>
     <a id="_2_put__key_157">
     </a>
     <strong>
      方案 2：使用
      <code>
       put()
      </code>
      重新存入修改后的
      <code>
       key
      </code>
     </strong>
    </h3>
    <p>
     如果
     <code>
      key
     </code>
     发生变化，需要重新
     <code>
      put()
     </code>
     进去：
    </p>
    <pre><code class="prism language-java">map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先删除旧的 key</span>
p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token comment">// 修改属性</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">"Engineer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重新放入 HashMap</span>
</code></pre>
    <ul>
     <li>
      <strong>
       适用场景
      </strong>
      ：如果一定要修改
      <code>
       key
      </code>
      ，需要确保
      <code>
       HashMap
      </code>
      结构同步更新。
     </li>
    </ul>
    <h2>
     <a id="_165">
     </a>
     <strong>
      总结
     </strong>
    </h2>
    <table>
     <thead>
      <tr>
       <th>
        方案
       </th>
       <th>
        影响
       </th>
       <th>
        适用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         修改
         <code>
          key
         </code>
         属性
        </strong>
       </td>
       <td>
        <code>
         hashCode()
        </code>
        变更，导致查找失败
       </td>
       <td>
        不推荐
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         使用不可变对象
        </strong>
       </td>
       <td>
        <code>
         key
        </code>
        保持不变，避免问题
       </td>
       <td>
        推荐
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         使用
         <code>
          remove()
         </code>
         后重新
         <code>
          put()
         </code>
        </strong>
       </td>
       <td>
        需要额外操作，保证
        <code>
         HashMap
        </code>
        一致性
       </td>
       <td>
        适用于可变对象
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     👉
     <strong>
      最佳实践：建议
      <code>
       HashMap
      </code>
      的
      <code>
       key
      </code>
      选择
      <code>
       String
      </code>
      或不可变对象，避免因
      <code>
       hashCode()
      </code>
      变化导致查找失败！
     </strong>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34313839333530352f:61727469636c652f64657461696c732f313436323139313834" class_="artid" style="display:none">
 </p>
</div>


