---
layout: post
title: "Unity2D-井字棋"
date: 2025-03-13 17:58:57 +0800
description: "学习Unity2D后胡编乱造写的井字棋，很粗糙，低劣，让人无语，慎看！嘿嘿。欢迎指正批评。直接导入写好的md，不知道有没有可能识别出错，图片是一定识别不到，是手动添加的。"
keywords: "Unity2D 井字棋"
categories: ['游戏开发']
tags: ['学习', 'Unity']
artid: "146238198"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146238198
    alt: "Unity2D-井字棋"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146238198
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146238198
cover: https://bing.ee123.net/img/rand?artid=146238198
image: https://bing.ee123.net/img/rand?artid=146238198
img: https://bing.ee123.net/img/rand?artid=146238198
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Unity2D 井字棋
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="Unity20223_1">
     </a>
     Unity版本2022.3
    </h3>
    <h3>
     <a id="_2">
     </a>
     场景布置
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b5bd7125ead14ec9b783d46ecfb75763.png">
      <br/>
      其中可以通过给Board对象添加Grid Layout Group，然后设置每个子物体所占宽高快速排整齐。用完删掉。每个落子的方格ChessBox都是一个Button。
     </img>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b6ea7e1c912f4cdab7ffa46177dfc781.png"/>
    </p>
    <p>
     根据Board的宽高除以三即可。
    </p>
    <p>
     然后隐藏按钮，通过设置alpha值实现。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/588a936798a04a43b87ce3c85bca17d9.png"/>
    </p>
    <p>
     将ChessBox的Alpha值设置为1，如果是0-1的格式，设置为0.1即可，后续在代码里控制alpha值，让落子可以被看到。
    </p>
    <p>
     看心情摆一摆就好了，然后是写代码放引用。
    </p>
    <h3>
     <a id="_20">
     </a>
     代码编写
    </h3>
    <h4>
     <a id="_22">
     </a>
     棋子种类
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Chess</span> 
<span class="token punctuation">{<!-- --></span>
    None<span class="token punctuation">,</span>
    X<span class="token punctuation">,</span>
    O<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_33">
     </a>
     落子的九宫格
    </h4>
    <p>
     每个落子的方格都是一个Button，实现被点击的效果。可以加标识符拒绝再次点击，或者关闭button的交互。都行。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChessBox</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Button</span> currentButton<span class="token punctuation">;</span>    <span class="token comment">// 当前脚本所在的按钮的引用</span>
    <span class="token keyword">public</span> <span class="token class-name">Image</span> currentImage<span class="token punctuation">;</span>      <span class="token comment">// 当前脚本所在的图片的引用</span>
    <span class="token keyword">public</span> <span class="token class-name">Chess</span> chess<span class="token punctuation">;</span>             <span class="token comment">// 当前格子的棋子</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> isChessed<span class="token punctuation">;</span>          <span class="token comment">// 当前格子是否落子</span>
    <span class="token comment">// Start is called before the first frame update</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        currentButton <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        currentButton<span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>DrawChess<span class="token punctuation">)</span><span class="token punctuation">;</span>
        currentImage <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Image<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isChessed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     其中CurrentButton和CurrentImage是预防需要反复getComponent写的，实际可以去掉，然后代码中用到的位置都用GetComponent。此处两个字段是引用，而非值类型，所以可以直接修改这两个字段实现修改组件内部的属性，避免使用Sprite sprite来控制Image的Sprite。如果通过保存Image的Sprite作为字段，此处sprite是值类型，不是引用，对它的修改不会应用到Image组件的Sprite参数。
    </p>
    <pre><code class="prism language-csharp"><span class="token class-name">Sprite</span> sprite<span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        sprite <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Image<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sprite<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     这样后续修改sprite是无效的。
    </p>
    <p>
     然后实现其中的落子函数，通过isChessed作为标识符判断是否可以落子，或者直接关闭按钮的交互，因为它是按钮。因为原本按钮是被设置为几乎不可见，所以落子后要重新设置alpha值，让他可见，R,G,B,A参数范围是0-1。
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 落子</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DrawChess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 落子或游戏结束，直接返回，不处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isChessed <span class="token operator">||</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>isGameOver<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>isPlayerTurn<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        currentImage<span class="token punctuation">.</span>sprite <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerChessSprite<span class="token punctuation">;</span>
        currentImage<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chess <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerChess<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        currentImage<span class="token punctuation">.</span>sprite <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>aiChessSprite<span class="token punctuation">;</span>
        currentImage<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chess <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>aiChess<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    isChessed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 不用isChessed的话</span>
    <span class="token comment">// currentButton.interactable = false;</span>
    <span class="token class-name">Board</span> board <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponentInParent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Board<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    board<span class="token punctuation">.</span><span class="token function">OnChessBoxClicked</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     落子后要让棋盘知道，所以这里使用的
     <code>
      GetComponentInParent&lt;Board&gt;()
     </code>
     的方式。也可以给每个格子都像CurentButton那样保存对棋盘的引用。
    </p>
    <p>
     这里暂时到这里。
    </p>
    <h4>
     <a id="_105">
     </a>
     棋盘
    </h4>
    <p>
     然后是棋盘的代码，判断游戏的进展之类的，还有重开。
    </p>
    <p>
     实现格子落子时执行的棋盘的函数。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">TMPro</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Board</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 九个落子的格子</span>
    <span class="token keyword">public</span> <span class="token class-name">ChessBox<span class="token punctuation">[</span><span class="token punctuation">]</span></span> chessBoxes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChessBox</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 获胜文本框</span>
    <span class="token keyword">public</span> <span class="token class-name">TextMeshProUGUI</span> text_Winner<span class="token punctuation">;</span>
    <span class="token comment">// 胜者</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> winner<span class="token punctuation">;</span>
    <span class="token comment">// 重开按钮</span>
    <span class="token keyword">public</span> <span class="token class-name">Button</span> restartButton<span class="token punctuation">;</span>
    <span class="token comment">// 落子数量</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> chessCount<span class="token punctuation">;</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        chessCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        chessBoxes <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponentsInChildren</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ChessBox<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        restartButton<span class="token punctuation">.</span>onClick<span class="token punctuation">.</span><span class="token function">AddListener</span><span class="token punctuation">(</span>ReStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 落子时调用</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnChessBoxClicked</span><span class="token punctuation">(</span><span class="token class-name">ChessBox</span> chessBox<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        chessCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CheckIfWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">GameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> chessCount <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span>   <span class="token comment">// 没赢但是满了</span>
        <span class="token punctuation">{<!-- --></span>
            winner <span class="token operator">=</span> <span class="token string">"Nobody"</span><span class="token punctuation">;</span>
            <span class="token function">GameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">SwitchTurn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     此处的pulic字段其实都应使用private，毕竟其他地方也不用，然后通过其他方式赋初值，写在Awake函数中，或者序列化私有字段。
    </p>
    <p>
     就像这样。
    </p>
    <pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SerializeField</span></span><span class="token punctuation">]</span><span class="token keyword">private</span> <span class="token class-name">TextMeshProUGUI</span> text_Winner<span class="token punctuation">;</span>
</code></pre>
    <p>
     这样可以在Unity中通过拖拽赋值，但是其他脚本访问不到。
    </p>
    <p>
     每次落子后都要判断谁赢了或者是不是平局。
    </p>
    <p>
     井字棋的获胜方式只有八种，即三行三列两个对角。
     <br/>
     所以判断八种情况下的棋子有哪一种情况是相同的棋子，并且必须是其中一方的棋子，要避开初始情况下棋子全是None。
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 检查是否获胜</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CheckIfWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">||</span>
           <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">||</span>
           <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 棋子匹配检查，是否三连子</span>
<span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ChessMatch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> j<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> k<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>chessBoxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>chess <span class="token operator">==</span> chessBoxes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>chess <span class="token operator">&amp;&amp;</span> chessBoxes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>chess <span class="token operator">==</span> chessBoxes<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>chess <span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>chessBoxes<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>chess <span class="token operator">==</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerChess<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            winner <span class="token operator">=</span> <span class="token string">"player"</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>chessBoxes<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>chess <span class="token operator">==</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>aiChess<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            winner <span class="token operator">=</span> <span class="token string">"ai"</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     接下来是落子后如果游戏结束，显示文本和不允许落子即可。
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 结束游戏,显示胜者</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GameOver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    text_Winner<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">winner</span><span class="token punctuation">}</span></span><span class="token string"> is win!"</span></span><span class="token punctuation">;</span>
    GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>isGameOver <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chessBoxes<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 禁止所有格子落子</span>
        chessBoxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isChessed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">// 不用isChessed的话</span>
        <span class="token comment">// chessBoxes[i].GetComponent&lt;Button&gt;().interactable = false;</span>
        <span class="token comment">// chessBoxes[i].currentButton.interactable = false;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_219">
     </a>
     重新开始
    </h4>
    <p>
     让所有格子重置，所以棋盘上写：
    </p>
    <pre><code class="prism language-csharp">    <span class="token comment">// 清空棋盘状态，将上局最后一手设置为后手</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>isGameOver <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chessBoxes<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            chessBoxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ReStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        text_Winner<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"gaming"</span><span class="token punctuation">;</span>
        GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">SwitchTurn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     重置状态，alpha值要设置的小一些，不然会显示null的sprite是纯白的，会挡住背景，但不要设置为0，如果是0就点不到了。格子按钮上写：
    </p>
    <pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        isChessed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        chess <span class="token operator">=</span> Chess<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
        currentImage<span class="token punctuation">.</span>sprite <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 不用isChessed的话</span>
        <span class="token comment">// GetComponent&lt;Button&gt;().interactable = true;</span>
        currentImage<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.01f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="GameManager_251">
     </a>
     GameManager
    </h4>
    <p>
     存一堆到处用的东西？大概吧。
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> isPlayerTurn<span class="token punctuation">;</span>   <span class="token comment">// 是否是玩家回合</span>
    <span class="token keyword">public</span> <span class="token class-name">Chess</span> playerChess<span class="token punctuation">;</span>   <span class="token comment">// 玩家棋子</span>
    <span class="token keyword">public</span> <span class="token class-name">Chess</span> aiChess<span class="token punctuation">;</span>       <span class="token comment">// ai棋子</span>
    <span class="token keyword">public</span> <span class="token class-name">Sprite</span> playerChessSprite<span class="token punctuation">;</span>    <span class="token comment">// 玩家的棋子精灵</span>
    <span class="token keyword">public</span> <span class="token class-name">Sprite</span> aiChessSprite<span class="token punctuation">;</span>        <span class="token comment">// ai的棋子精灵</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> isGameOver<span class="token punctuation">;</span>             <span class="token comment">// 游戏是否已结束</span>

    <span class="token keyword">public</span> <span class="token class-name">Board</span> board<span class="token punctuation">;</span>     <span class="token comment">// 棋盘引用</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">GameManager</span> Instance <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>



    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 不切换场景，这样就够了</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Instance <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 初始化状态</span>
        isPlayerTurn <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        isGameOver <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        board <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Board<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     在Inspector中给了Board引用后，其中的
     <code>
      FindObjectOfType&lt;Board&gt;()
     </code>
     可以删除。
    </p>
    <p>
     切换回合，很简单，如果不写AI行为，那AI其实算是P2。
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">// 切换回合</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SwitchTurn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    isPlayerTurn <span class="token operator">=</span> <span class="token operator">!</span>isPlayerTurn<span class="token punctuation">;</span>
    <span class="token comment">// 如果是 AI 的回合，调用 AI 落子逻辑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isPlayerTurn <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isGameOver<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">AIPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="AIAI_302">
     </a>
     AI行为–基于规则的AI
    </h4>
    <p>
     由于井字棋很简单，所以AI的逻辑也很简单，如果玩家能赢，那就堵，如果AI能赢，那就填，不然随便放，也可以加一步，如果AI先手，即场上全空，那优先抢中间。
    </p>
    <pre><code class="prism language-csharp">    <span class="token comment">// 获取没落子的空位置</span>
    <span class="token keyword">private</span> <span class="token return-type class-name">ChessBox<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetEmptyChessBoxes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取所有 ChessBox</span>
        <span class="token class-name">ChessBox<span class="token punctuation">[</span><span class="token punctuation">]</span></span> allBoxes <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectsOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ChessBox<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 过滤出空的 ChessBox</span>
        <span class="token class-name">List<span class="token punctuation">&lt;</span>ChessBox<span class="token punctuation">&gt;</span></span> emptyBoxes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>ChessBox<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ChessBox</span> box <span class="token keyword">in</span> allBoxes<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>box<span class="token punctuation">.</span>chess <span class="token operator">==</span> Chess<span class="token punctuation">.</span>None<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                emptyBoxes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> emptyBoxes<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// AI行为</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AIPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ChessBox<span class="token punctuation">[</span><span class="token punctuation">]</span></span> emptyBoxes <span class="token operator">=</span> <span class="token function">GetEmptyChessBoxes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//if(emptyBoxes.Length == 9)</span>
        <span class="token comment">//{<!-- --></span>
        <span class="token comment">//    Board board = FindObjectOfType&lt;Board&gt;();</span>
        <span class="token comment">//    board.chessBoxes[4].DrawChess();</span>
        <span class="token comment">//    return;</span>
        <span class="token comment">//}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>emptyBoxes<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 检查是否有可以立即获胜的位置</span>
            <span class="token class-name">ChessBox</span> winningBox <span class="token operator">=</span> <span class="token function">FindWinningBox</span><span class="token punctuation">(</span>aiChess<span class="token punctuation">,</span> emptyBoxes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>winningBox <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                winningBox<span class="token punctuation">.</span><span class="token function">DrawChess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 检查玩家是否有即将获胜的位置</span>
            <span class="token class-name">ChessBox</span> blockingBox <span class="token operator">=</span> <span class="token function">FindWinningBox</span><span class="token punctuation">(</span>playerChess<span class="token punctuation">,</span> emptyBoxes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>blockingBox <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                blockingBox<span class="token punctuation">.</span><span class="token function">DrawChess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 随机选择一个空的位置</span>
            <span class="token class-name"><span class="token keyword">int</span></span> randomIndex <span class="token operator">=</span> Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> emptyBoxes<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChessBox</span> selectedBox <span class="token operator">=</span> emptyBoxes<span class="token punctuation">[</span>randomIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
            selectedBox<span class="token punctuation">.</span><span class="token function">DrawChess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 寻找可以获胜的格子</span>
    <span class="token keyword">private</span> <span class="token return-type class-name">ChessBox</span> <span class="token function">FindWinningBox</span><span class="token punctuation">(</span><span class="token class-name">Chess</span> targetChess<span class="token punctuation">,</span> <span class="token class-name">ChessBox<span class="token punctuation">[</span><span class="token punctuation">]</span></span> emptyBoxes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ChessBox</span> box <span class="token keyword">in</span> emptyBoxes<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 模拟落子</span>
            box<span class="token punctuation">.</span>chess <span class="token operator">=</span> targetChess<span class="token punctuation">;</span>

            <span class="token comment">// 检查是否获胜</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>board<span class="token punctuation">.</span><span class="token function">CheckIfWin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 恢复 ChessBox 状态</span>
                box<span class="token punctuation">.</span>chess <span class="token operator">=</span> Chess<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
                <span class="token keyword">return</span> box<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 恢复 ChessBox 状态</span>
            box<span class="token punctuation">.</span>chess <span class="token operator">=</span> Chess<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_385">
     </a>
     最后
    </h3>
    <p>
     在每次重开后，切换回合是为了避免上一局最后是玩家，那么玩家落子后就是AI了，而没有写AI先手。
    </p>
    <p>
     可以改为重置为玩家回合，或者给Restart里写如果是AI那就执行一次AIplay。
    </p>
    <p>
     直接执行切换回合，不仅使上一局最后一手为后手，还同时检测了是谁，如果是AI那就落子，如果是玩家那就玩家落子，同时做到了开局可以是玩家也可以是AI。
    </p>
    <p>
     其实反正小东西，无脑public的好处是写得少，还能直接在Inspector里看情况，如果真需要调用，不用回来重新改private为public。
    </p>
    <h3>
     <a id="_394">
     </a>
     最后一点截图，场景中的引用
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7450c5fe5d5e4470914c3f81e4a71ccd.png">
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ef69c6b0b66740fbab831a7f9dfcdfbf.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1b0294bb38a6481bacae640dbf86f8e9.png"/>
      </img>
     </img>
    </p>
    <h3>
     <a id="_399">
     </a>
     参考链接
    </h3>
    <p>
     <a href="https://www.youtube.com/watch?v=t6rrTYR221w" rel="nofollow">
      Unity tutorial - How to make Tic Tac Toe game [ Part 1 ]
     </a>
    </p>
    <p>
     <a href="https://www.youtube.com/watch?v=nRlf47js_lE&amp;t=2s" rel="nofollow">
      Unity tutorial - How to make Tic Tac Toe game [ Part 2 ]
     </a>
    </p>
    <h3>
     <a id="_404">
     </a>
     仓库链接
    </h3>
    <p>
     <a href="https://github.com/MapleInori/JingZiQi">
      MapleInori/JingZiQi: 学习记录 (github.com)
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35323536313330322f:61727469636c652f64657461696c732f313436323338313938" class_="artid" style="display:none">
 </p>
</div>


