---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f6a6573736973655f7a68616e:2f61727469636c652f64657461696c732f3830313330323239"
layout: post
title: "区块链技术的本质是分布式数据库"
date: 2024-09-02 14:17:14 +0800
description: "本文转自微信号EAWorld。扫描下方二维码，关注成功后，回复“普元方法+”，将会获得热门课堂免费学"
keywords: "区块链是一个分布式"
categories: ['未分类']
tags: ['方法', '数据库', '技术', '分布式', '信号']
artid: "80130229"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=80130229
  alt: "区块链技术的本质是分布式数据库"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=80130229
featuredImagePreview: https://bing.ee123.net/img/rand?artid=80130229
---

# 区块链技术的本质是分布式数据库

本文转自微信号EAWorld。扫描下方二维码，关注成功后，回复“普元方法+”，将会获得热门课堂免费学习机会！
  
《当微服务撞上区块链》系列微课分为：
  
1、区块链的业务价值是通过数据共享降低信任成本
  
2、区块链的本质是分布式数据库（本文）
  
3、区块链与微服务是天生的一对

区块链技术是基于比特币应用提出的一个概念，他是一个融合了多种技术的一个集成式创新。目前区块链的应用早已不仅仅局限在比特币上。人们在谈论或使用“区块链”这个词时，有时候是指技术的商业应用，有时是指技术实现本身。

在《区块链的业务价值是通过数据共享降低信任成本》一文中，我论述了应用区块链技术的商业价值，有在多方参与的场景下更适合采用区块链技术，也提到了区块链的技术特征：（1）多副本、（2）可靠记录、（3）不可篡改、（4）多方透明几个特性，上述特性总结下来，采用区块链技术后，应用技术架构如下图所示，可以看出，区块链技术对应用而言，就是一个分布式数据库（估计看到我这个结论，很多砖就要拍过来了，请大家拍砖的同时继续看），我一一说来：

![图片描述](https://img-blog.csdn.net/20170627092824499?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSmVzc2lzZV96aGFu/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

**一、从分布式数据库的基本概念理解区块链技术**

和区块链技术比，分布式数据库的概念显然更容易被理解，我就从分布式数据库的一些基本概念出发，理解区块链的技术实现，这些概念包括数据存储、点对点可靠传输、存储过程与触发器（智能合约）、数据安全：

**1、分布式数据存储**

区块链技术的数据共享是一个分布式的记账簿，交易记录具备多个副本，因此首先要解决分布式数据存储的问题。

1）区块链存储的基本单元是区块，区块采用链式结构，即新增的区块（类似数据库一行记录）都知道自己前一个区块（前一行记录）是什么，可以一直追溯到根，区块的标识是区块的哈希值，同时链式结构保留了业务产生的轨迹，可以在新增交易的时候根据前面的记录做校验，保证了区块的内容不容易篡改。

![**图片描述**](https://img-blog.csdn.net/20170627092915572?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSmVzc2lzZV96aGFu/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

这种模式，我们在传统的数据库设计也会采用，例如拉链表的形式，每次对数据的更新都采用追加（ Insert而不是Update）模式，有起始时间、失效时间和是否生效标识，保持全部交易历史。区块链把这一点变成了一种底层固有模式，加入了哈希、时间戳等机制在技术上保证链条的正确性，因此非常有价值。

2）既然是分布式、多中心的存储方式，就必须解决存储时的分布式一致性问题。在区块链的前身比特币应用中，解决这一问题的方式是工作量证明（POW Proof-Of-Work）方式，即通过工作以获得指定成果，用成果来证明曾经付出的努力。这也是接触区块链技术时第一个比较迷惑的地方，我为啥一定要用工作量来证明，是不是还有其他方式？区块链技术从比特币中独立出来后，大家把这一问题归结为共识问题，工作量证明是达成共识的一种方式，这样就清晰多了。

于是就产生了权益证明（POS Proof of Stake）方式，是一种通过业务规则达成共识的方式；实用拜占庭容错（PBFT Practical Byzantine Fault Tolerance）方式，是一种通过技术规则达成共识的机制。在公有链上，工作量证明（POW）还是一种最主要的共识方式，不容易取代，但在联盟链上，完全可以根据自己的情况，创造出新的共识方式出来。我们就根据这一想法，在特定业务中创造过共识算法，解决分布式数据存储的一致性问题，以后有机会再展开说。

**2、点对点可靠传输**

区块链技术是一组技术的组合，既然是一个分布式的记账簿，就要解决数据可靠传输问题。包括记账节点（信任节点）之间、非记账节点（非信任节点）、客户端与记账节点（信任节点）之间的数据传输。在以前我们的方案中，往往通过可靠消息或者P2P方式解决数据传输问题，这些技术也被用于区块链技术中。

但必须说明的是，在真实业务场景下，不可能把所有的数据都记录在记账簿中，部分业务数据还是要保存在自己的系统中，这就还需要在技术框架上做到本地业务数据与区块链的记账簿保持一致，后面微服务架构与区块链技术整合时会具体阐述，总之，区块链平台只能保证自身数据之间的一致，业务不能完全依赖区块链平台保证数据一致性。

**3、智能合约：触发器与存储过程**

智能合约是指当一定条件满足的情况下，可以被自动执行的数字化合约。实现这一特性，在数据库中就是由触发器和存储过程完成的。虽然在目前流行的应用架构中，都不建议把逻辑写在存储过程中，但触发器和存储过程还是常用的工具，尤其在数据迁移相关的运维活动中。区块链技术中智能合约就是触发器和存储过程，他是一个在沙箱中运行的脚本，用于执行区块链业务中的业务逻辑，也可以用于各种检查。

举个例子，A产生一笔支付时，可以通过智能合约在数据链上进行检查，如果发现A的余额无法支付这笔交易，就可以中止这笔交易。和存储过程相比，智能合约运行在沙箱之中，不能对外部 API 做调用。这也比较好理解，如果允许外部调用，就可能无法保证自身的数据一致性，后面我们会讲到这种缺陷如何弥补。美中不足的是目前的智能合约并不支持 SQL 语法。

**4、数据安全**

交易数据是透明的，但不是全部透明，而是相对透明，这是区块链技术的一个难点，关键有二：（1）如何保护隐私，仅仅能看到自己可见的数据；（2）密钥分配问题，例如新加入链中的一个节点会被分配一个新的密钥，如何用这个密钥解读以前链中存储的信息。可见与不可见，这是一个矛盾，理论上没有一个完美的方案，这里我不对区块链技术如何加密、如何做密钥管理、如何同态加密等方式做解读，而是讲讲如何通过业务方法而不是技术手段规避这一问题。

举个例子，在一个小企业支付的联盟链中，核心企业包括某银行、企业A，为A的上下游企业提供信贷业务，对于所有交易的数据，银行和核心企业A都是可见的，他们拥有记账节点，对于其他加盟企业，只拥有非记账节点，他们虽然也有全部的数据，但是只能看到自己相关的数据。

很明显，加盟企业放弃了自己的部分隐私权，但也得到了生意的机会，这种方式加盟企业是可以接受的，就好比贷款企业要向银行提供经营数据一样。数据安全问题，在技术上很难解决，但通过业务手段是可以规避的，这也是我们看好联盟链的重要原因。

**二、理解区块链技术常见的几个困惑**

从刚刚接触区块链技术的一头雾水，到概念的逐步清晰，再到区块链应用的研发，经历很多困惑，这里列出几个常见的困惑。

**困惑1：比特币是区块链技术的一个应用，不能把比特币应用的所有内容都归结为区块链技术**

上文提到，区块链技术从比特币中独立出来是 2014 年左右的事情，此前每每举出区块链的案例都是比特币，给区块链技术的应用造成了很多误解。我建议先了解区块链技术，再了解比特币，先理解联盟链的业务场景，再了解公有链的业务场景，公有链看作是联盟链的一种大规模延展，，可以少走一些弯路。

**困惑2：公有链情况下数据存储性能不高，但联盟链的性能可以远高于公有链，能满足多数场景的要求**

数据一致性问题是分布式存储最大的问题，而并发越高，冲突的概率就越大。区块链技术之所以能支持的每秒交易数（TPS）不高，主要是共识机制比较复杂，或者说共识机制就是刻意为了降低并发性，减少数据冲突的概率。

在公有链上，这是一个无法逾越的问题，只能从事实时性要求不敏感的业务。但是，在联盟链中，由于链中的参与方并不多，也不需要每个节点都记账，就可以使用一些性能更高的共识机制，例如前面说的PBFT。我们曾经尝试过一种全对等的算法，可以支持更高的性能。

**困惑3：应用区块链技术不一定必须有矿工来挖矿**

初次接触区块链技术，矿工/挖矿这个概念让人非常费解：
  
（1）为什么一定要挖矿？
  
（2）为什么要给记账成功的节点奖励比特币来鼓励记账？
  
（3）非比特币的业务中如何鼓励记账？

这个困惑归根结底还是把区块链和比特币混淆造成的。前面说过，挖矿是通过工作量证明（POW）达成共识的机制，挖矿能力愈强就取得了记录权。更重要的是比特币的货币属性，发行货币要么靠国家信用（例如纸币），要么靠奇缺资源（例如黄金），比特币为了防止滥发，就需要用算力做为一种奇缺资源。

这样说来，比特币实际上把共识算法、货币属性、鼓励记账这几件事都用挖矿来解决了，思路确实精妙。但是，在业务规则不同的联盟链中就不一样了，除了有其他更高效的共识算法外，不需要奇缺资源，不需要专门对记账做鼓励，因为必须记账已经是核心企业之间的契约，可以通过技术手段保证数据的同步，支持审计等能力，自然就不需要挖矿了。

**困惑4：目前应用区块链技术不是去中心，而是多中心**

去中心是一个理想，经常有人问，为什么要去中心？去中心有什么好处？真的能去中心吗？后来，我深入研究联盟链的场景时发现，实际的业务场景大多是多中心（这又是比特币惹的祸，他真的想去中心），例如上述的企业联盟方式，几个建立联盟的核心企业就是多中心，他们共同成为一个新的中心。传统方式建立新的中心，往往通过建立清算机构的方式，而区块链技术让建立中心的成本降低了。

**困惑5：不是所有的区块链节点都是记账节点，很多节点仅仅用来进行数据同步而已**

多中心就意味着不是每个节点都需要记账，记账的工作由几个中心节点负责就可以了，其他节点与记账节点间是数据同步的关系，也就是非记账节点上也有全部数据。联盟链中非记账节点一般处在加盟企业，由于数据可见性的要求，非记账节点中的数据并不是都可见的，但是这一副本可以做为一种法律依据，提高了篡改数据的成本。

**三、总结**

从数据的角度来看，区块链本质是一种分布式数据库，这里的“分布式”是指区块链技术利用链式存储结构不仅解决了分布式数据存储问题，也解决了存储时的分布式一致性问题。区块链技术利用分布式记账簿保证数据可靠传输和访问，利用可自动执行的智能合约来编程和操作数据。所以，我认为，基于分布式数据库来理解区块链，认清区块链技术常见的一些困惑和误区，可以让大家对区块链有个比较正确的理解方式。

采用区块链技术后，应用技术架构是什么，与微服务架构的关系，现有应用如何进行迁移？下节微课我会为大家逐一详细介绍。

关于作者
  
焦烈焱
  
EAII-企业架构创新研究院 常务理事
  
2001年加入普元信息，现任CTO，全面负责普元信息技术与产品的运营工作，公司技术发展战略的重要决策人。焦烈焱在企业技术架构研究方面有二十余年的经验，长期致力于分布式环境的企业计算、 SOA与云计算技术研究与实践。加入普元信息后组织完成一系列核心产品的研发工作，包括SOA应用平台、以BPM &/ESB为核心的业务集成平台、以复杂事件处理/数据治理/作业调度为核心的大数据平台，期间主持了中国工商银行、中国建设银行等多家大型企业技术平台的规划与研发。著有《SOA中国路线图—实施版》一书。
  
![图片描述](https://img-blog.csdn.net/20170627093524941?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSmVzc2lzZV96aGFu/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

关于EAWorld
  
微服务，DevOps，元数据，企业架构原创技术分享，EAii（Enterprise Architecture Innovation Institute）企业架构创新研究院旗下官方微信公众号。

扫描下方二维码，关注成功后，回复“普元方法+”，将会获得热门课堂免费学习机会！
  
微信号：EAWorld。
  
![图片描述](https://img-blog.csdn.net/20170627093636636?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvSmVzc2lzZV96aGFu/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

全新形态的PWorld2017盛大开启，首四场定于7月1日在北京、上海、广州、成都四城同步举行。CSDN专项报名通道可获得现场伴手礼个性T恤一件！

7月1日北京站报名：
<http://www.bagevent.com/event/611620?bag_track=csdn>

7月1日上海站报名：
<http://www.bagevent.com/event/626256?bag_track=csdn>

7月1日广州站报名：
<http://www.bagevent.com/event/625055?bag_track=csdn>

7月1日成都站报名：
<http://www.bagevent.com/event/626275?bag_track=csdn>