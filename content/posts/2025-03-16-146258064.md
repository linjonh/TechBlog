---
layout: post
title: "UDP协议和Socket编程"
date: 2025-03-16 20:18:32 +0800
description: "天天开心！！！"
keywords: "UDP协议和Socket编程"
categories: ['未分类']
tags: ['网络协议', '网络', '服务器', '后端', '单片机', 'Udp', 'C']
artid: "146258064"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146258064
    alt: "UDP协议和Socket编程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146258064
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146258064
cover: https://bing.ee123.net/img/rand?artid=146258064
image: https://bing.ee123.net/img/rand?artid=146258064
img: https://bing.ee123.net/img/rand?artid=146258064
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     UDP协议和Socket编程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      天天开心！！！
     </p>
    </blockquote>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="UDP_10">
     </a>
     一、UDP的特点
    </h2>
    <p>
     UDP（User Datagram Protocol，用户数据协议）是互联网协议套件中的一种传输层协议，与广泛使用的TCP（Tramsmission Control Protocol，传输控制协议）相比，它是一种无连接、不可靠的协议。UDP被用于对传输速度要求较高、但对可靠性要求较低的场景。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4cc14e68bb304109856e1ce35dd3157d.png#pic_center"/>
    </p>
    <h2>
     <a id="TCPUDP_17">
     </a>
     二、TCP和UDP的区别
    </h2>
    <p>
     UDP（用胡数据报协议）和TCP（传输控制协议）都是传输层协议，负责在网络中传输数据，但它们的设计目标和实现方式有很大的区别。
     <br/>
     以下是UDP和TCP的主要区别：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e738b1944d8f4968967b2622fce11892.png#pic_center"/>
    </p>
    <h2>
     <a id="UDP_30">
     </a>
     三、UDP的包头格式
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c1224754985447aca1b823e4a2291d82.png"/>
    </p>
    <ol>
     <li>
      UDP伪首部（Pseudo Header）
      <br/>
      伪首部适用于计算校验和的虚拟头部信息，它不包含在实际传输的数据中，但用于保证数据完整性。伪首部包含以下字段
     </li>
    </ol>
    <ul>
     <li>
      32位源IP地址：表示数据包的源IP地址，即发送方的IP地址
     </li>
     <li>
      32位目的IP地址：表示数据包的目的IP地址，即接收方的IP地址
     </li>
     <li>
      0：固定填充的8位0字段，不使用
     </li>
     <li>
      8位协议（17）：标识传输协议类型。对于UDP协议来说，这个字段的值是17
     </li>
     <li>
      16位UDP长度：表示整个UDP数据报的长度，包括UDP首部和数据部分
     </li>
    </ul>
    <ol start="2">
     <li>
      UDP首部
      <br/>
      UDP首部是真正的数据报头部，它包含了与UDP通信相关的基本信息。UDP首部固定为8字节，包含以下字段：
     </li>
    </ol>
    <ul>
     <li>
      16位源端口号：发送方的端口号，标识发送数据的应用程序。如果不需要，值可以为0
     </li>
     <li>
      16位目的端口号：接收方的端口号，表示接收数据的应用程序
      <br/>
      16位UDP长度：表示UDP报文的总长度（包括UDP首部和数据部分）。由于UDP首部固定为8字节，因此长度至少为8
     </li>
     <li>
      16位UDP校验和：用于确保数据报在传输过程中没有被破坏。它由UDP伪首部、UDP首部和数据部分计算而得。如果发送方不计算校验和，则该字段可以为0。
     </li>
    </ul>
    <ol start="3">
     <li>
      <p>
       数据部分
       <br/>
       UDP数据报的实际数据内容。数据部分的长度可以根据具体的应用需求而变化，但必须与首部中的UDP长度字段保持一致
      </p>
     </li>
     <li>
      <p>
       填充字段（0）
       <br/>
       数据包需要一定的字节对齐规则（如32位对齐）填充到合适的长度，以确保数据包的完整性和便于传输
      </p>
     </li>
     <li>
      <p>
       重点
      </p>
     </li>
    </ol>
    <ul>
     <li>
      UDP伪首部并不实际存在于UDP报文中，它仅在计算校验和时使用，用于提供更多的上下文（如IP地址）来验证数据的完整性
     </li>
     <li>
      UDP首部非常简单，仅有8字节，保证了UDP的轻量和高效
     </li>
     <li>
      UDP数据：携带的实际传输数据，长度可以根据应用而变化
      <br/>
      这个图展示了UDP协议的简单性和高效性，因为UDP协议不需要复杂的连接管理或传输控制机制。
     </li>
    </ul>
    <h2>
     <a id="UDP__Socket_61">
     </a>
     四、UDP Socket编程流程
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/befc45767b4f44cb89308533b6bb28b9.png"/>
    </p>
    <ol>
     <li>
      UDP客户端流程
     </li>
    </ol>
    <ul>
     <li>
      socket（）：创建一个UDP套接字（Socket）。这是启动UDP通信的第一步，客户端通过调用socket（）函数生成一个用于通信的套接字
     </li>
     <li>
      sendto（（）：向服务器发送数据。客户端使用sendto（）函数来将数据报发送到指定的服务器IP地址和端口。这是一个无连接的操作，不需要事先建立连接
     </li>
     <li>
      等待响应：客户端待用recvform（）函数，进入阻塞状态，等待从服务器返回的数据。recvform（）会接收来自服务器的数据报，函数会在接收到数据后解除阻塞。
     </li>
     <li>
      recvform（）：接收到服务器返回的数据后，继续处理该数据。
     </li>
     <li>
      close（）：通信完成后，关闭客户端套接字，释放系统资源。
     </li>
    </ul>
    <ol start="2">
     <li>
      UDP服务器流程
     </li>
    </ol>
    <ul>
     <li>
      socket（）：与客户端一样，服务器首先创建一个UDP套接字，通过调用socket（）函数。
     </li>
     <li>
      bind（）：将套接字与指定的IP地址和端口绑定。服务器必须绑定到一个特定的端口上。这样才能接收来自客户端的数据，bind（）是服务器端持有的操作，客户端通常不需要显式的调用bind（）
     </li>
     <li>
      recvform（）：服务器使用recvform（）接收客户端发送的数据报，并进入阻塞状态，直到接收到数据为止。
     </li>
     <li>
      处理请求：收到数据后，服务器使用recvform（）接收客户端发送的数据报，并进入阻塞状态，直到接收到数据为止。
     </li>
     <li>
      sendto（）：处理完成后，服务器通过sendto（）向客户端发送响应数据。
     </li>
     <li>
      继续等待：服务器可以继续调用recvform（）来接收下一个数据请求
     </li>
    </ul>
    <ol start="3">
     <li>
      图中的其他元素
     </li>
    </ol>
    <ul>
     <li>
      阻塞直到收到数据：无论是客户端还是服务器，调用recvform（）后，程序会进入阻塞状态，等待对方发送数据，这是一个UDP通信中的常见模式
     </li>
     <li>
      数据请求和数据响应：图中显示了客户端向服务器发送请求数据，服务器处理后会返回响应数据的流程。
     </li>
    </ul>
    <ol start="4">
     <li>
      UDP通信的特点
     </li>
    </ol>
    <ul>
     <li>
      无连接：UDP协议是无连接的，客户端不需要先与服务器建立连接，直接发送数据。服务器收到数据后可以立即处理。
     </li>
     <li>
      阻塞模式：图中显示的recvform（）操作是阻塞的，直到有数据到来才会继续执行
     </li>
     <li>
      简单轻量：由于UDP不需要维护连接状态，它比TCP更加简单和轻量，适用于对实时性要求高但是对数据可靠性要求较低的场景。
     </li>
    </ul>
    <h2>
     <a id="UDP_87">
     </a>
     五、UDP代码实现
    </h2>
    <ol>
     <li>
      UDP服务器代码实现
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">,</span> client_addr<span class="token punctuation">;</span>
    socklen_t addr_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>client_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建UDPsocket</span>
    sockfd<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sockfd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cerr<span class="token operator">&lt;&lt;</span><span class="token string">"socket error"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//配置服务器地址</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>   <span class="token comment">//IPv4</span>
    server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>  <span class="token comment">//监听所有地址</span>
    server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//端口号</span>

    <span class="token comment">//绑定socket到地址</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cerr<span class="token operator">&lt;&lt;</span><span class="token string">"bind error"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        <span class="token function">clsoe</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Server is listening on port "</span><span class="token operator">&lt;&lt;</span>PORT<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//接收消息</span>
        <span class="token keyword">int</span> n<span class="token operator">=</span><span class="token function">recvform</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>
        cout<span class="token operator">&lt;&lt;</span><span class="token string">"Client:"</span><span class="token operator">&lt;&lt;</span>buffer<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>

        <span class="token comment">//响应消息</span>
        <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> message<span class="token operator">=</span><span class="token string">"Message received!!!"</span><span class="token punctuation">;</span>
        <span class="token function">sendto</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> message<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span> addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      UDP客户端代码实现
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span>   </span><span class="token comment">// 端口号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span>  </span><span class="token comment">// 缓冲区大小</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IP</span> <span class="token string">"127.0.0.1"</span>  <span class="token comment">//定义服务器地址</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span>

    <span class="token comment">//创建UDP套接字</span>
    sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sockfd <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cerr<span class="token operator">&lt;&lt;</span><span class="token string">"Socket creation faliure"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//配置服务器地址</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//使用inet_pton将IP地址从字符串转换为网络字节序</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">inet_pton</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> IP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cerr<span class="token operator">&lt;&lt;</span><span class="token string">"Invalid address/Address not supported"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//发送消息到服务器</span>
        string message<span class="token punctuation">;</span>
        cout<span class="token operator">&lt;&lt;</span><span class="token string">"Enter message: "</span><span class="token punctuation">;</span>
        <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从标准输入读取用户输入</span>

        <span class="token comment">//发送消息</span>
        <span class="token keyword">int</span> send_result<span class="token operator">=</span><span class="token function">sendto</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>send_result<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            cerr<span class="token operator">&lt;&lt;</span><span class="token string">"Failed to send message"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//接收服务器的响应</span>
        socklen_t addrlen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//服务器地址长度</span>
        <span class="token keyword">int</span> n<span class="token operator">=</span><span class="token function">recvform</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            cerr<span class="token operator">&lt;&lt;</span><span class="token string">"Failed to receive response"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        buffer<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>
        cout<span class="token operator">&lt;&lt;</span><span class="token string">"Server response: "</span><span class="token operator">&lt;&lt;</span>buffer<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token comment">//输出服务器的响应</span>
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="3">
     <li>
      Windows客户端的代码实现
     </li>
    </ol>
    <ul>
     <li>
      头文件和库的引入
     </li>
     <li>
      <ul>
       <li>
        在Windows中需要引入winsock2.h和ws2tcpip.h，并且需要链接Ws2_32.lib库
       </li>
      </ul>
     </li>
     <li>
      Winsock初始化和清理
     </li>
     <li>
      <ul>
       <li>
        在Windows中，使用网络功能之前需要调用WSAStartup（）进行初始化，使用完毕后需要调用WSACleanup（）释放资源
       </li>
      </ul>
     </li>
     <li>
      Windows和Linux之间的一些差异
     </li>
     <li>
      <ul>
       <li>
        close（）在Windows上对应的是closesocket（）
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        perroor（）函数在Windows上不常用，通常使用std：：cerr输出错误
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;winsock2.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ws2tcpip.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span> </span><span class="token string">"Ws2_32.lib"</span><span class="token expression"><span class="token punctuation">)</span>   </span><span class="token comment">//链接ws2_32.lib库</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PORT</span> <span class="token expression"><span class="token number">8080</span>   </span><span class="token comment">// 端口号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span>  </span><span class="token comment">// 缓冲区大小</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IP</span> <span class="token string">"127.0.0.1"</span>  <span class="token comment">//定义服务器地址</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    WSADATA wsaData<span class="token punctuation">;</span>   <span class="token comment">// 用于初始化WinSock</span>
    SOCKET sockfd<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span>

    <span class="token comment">//初始化WinSock</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>wsaData<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"WSAStartup failed."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//创建UDP套接字</span>
    sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sockfd <span class="token operator">==</span> INVALID_SOCKET<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"socket failed."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//配置服务器地址</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// inet_pton函数用于将点分十进制的IP地址转换为网络字节序的二进制地址</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">inet_pton</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> IP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"inet_pton failed."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token function">closesocket</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//发送消息到服务器</span>
        string message<span class="token punctuation">;</span>
        cout<span class="token operator">&lt;&lt;</span><span class="token string">"Enter message: "</span><span class="token punctuation">;</span>
        <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从标准输入读取用户输入</span>

        <span class="token comment">//发送消息</span>
        <span class="token keyword">int</span> send_result<span class="token operator">=</span><span class="token function">sendto</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>send_result<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            cerr<span class="token operator">&lt;&lt;</span><span class="token string">"Failed to send message"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//接收服务器的响应</span>
        socklen_t addrlen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//服务器地址长度</span>
        <span class="token keyword">int</span> n<span class="token operator">=</span><span class="token function">recvfrom</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span>buffer<span class="token punctuation">,</span>BUFFER_SIZE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span><span class="token operator">&amp;</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            cerr<span class="token operator">&lt;&lt;</span><span class="token string">"Failed to receive response"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        buffer<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>
        cout<span class="token operator">&lt;&lt;</span><span class="token string">"Server response: "</span><span class="token operator">&lt;&lt;</span>buffer<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token comment">//输出服务器的响应</span>
    <span class="token punctuation">}</span>
    <span class="token function">closesocket</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">WSACleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_315">
     </a>
     六、函数细节
    </h2>
    <ol>
     <li>
      关于recvform（）函数
      <br/>
      recvform（）函数是套接字编程中用于从他套接字接收数据的一个函数，特别用于UDP协议下的数据接收。它允许程序从一个未连接的套接字（如UDP套接字）接收数据报。下面是对recvform（）函数及其参数int n=recvform（sockfd，buffer，BUFFER_SIZE，0，nullptr，nullptr）;的详细解释：
     </li>
    </ol>
    <ul>
     <li>
      函数原型
     </li>
    </ul>
    <pre><code class="prism language-cpp">ssize_t recvform（<span class="token keyword">int</span> sockfd，<span class="token keyword">void</span> <span class="token operator">*</span>buf，size_t len，<span class="token keyword">int</span> falgs，<span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>src_addr，socklen_t <span class="token operator">*</span>addrlen）<span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      参数解释：
     </li>
     <li>
      <ul>
       <li>
        sockfd：套接字描述符，这个套接字通常是通过socket（）函数创建的，并且绑定到了一个特定的端口（对于UDP来说）
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        buf：指定数据缓冲区的指针，这个缓冲区用于存储接收到的数据。接收的数据会被复制到这个缓冲区中
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        flags：标志位，用于修改recvform的行为，常用的标志包括MSG_PEEK（查看数据但不从队列中移除），MSG_WAITALL（请求阻塞操作直到接收到完整的请求数据，但这对于UDP来说通常不适用，因为UDP是无连接的、数据报驱动的协议）等。
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        src_addr：：指向sockaddr结构体的指针，用于存储发送方的地址信息。如果不需要这个信息，可以传递nullptr。。。
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        addrlen：指向socklen_t变量的指针，该变量在带哦用前应该被初始化位src_addr所指向的地址结构的大小。在函数被调用后，这个变量会被更新为实际存储在src_addr中的地址结构的大小。如果src_addr是nullptr，则addrlen也应该是nullptr。
       </li>
      </ul>
     </li>
     <li>
      返回值：recvform（）函数
      <br/>
      返回成功接收到的字节数。如果返回0，表示连接已正常关闭（但这对UDP来说并不常见，因为UDP是无连接的），如果返回-1，表示发生了错误，错误类型可以通过errno来检查。
     </li>
    </ul>
    <ol start="2">
     <li>
      关于memset
      <br/>
      memset是一个C/C++标准库函数，用于将一块内存区域的内容设置为指定的值。它通常用于初始化数组或结构体，以确保在使用这些数据之前内存中的内容是已知的。memset函数定义在（C++）中或《string.h》（C）头文件中。
     </li>
    </ol>
    <ul>
     <li>
      函数原型
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token operator">*</span> memset（<span class="token keyword">void</span> <span class="token operator">*</span>ptr，<span class="token keyword">int</span> value，size_t num）<span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      参数说明
     </li>
     <li>
      <ul>
       <li>
        ptr：指向要设置的内存块的指针
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        value：要设置的值，这个值会被转换成unsigned char类型，并且将其填充到内存块中
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        num：要设置的字节数
       </li>
      </ul>
     </li>
    </ul>
    <ol start="3">
     <li>
      关于sendto（）函数
      <br/>
      sendto函数是套接字编程中用于发送数据的一个函数，特别适用于UDP协议下的数据发送。它允许程序向指定的地址发送数据报。
     </li>
    </ol>
    <ul>
     <li>
      函数原型
     </li>
    </ul>
    <pre><code class="prism language-cpp">ssize_t sendto（<span class="token keyword">int</span> sockfd ，<span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf，size_t len，<span class="token keyword">int</span> flags<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>dest_addr<span class="token punctuation">,</span>socklen_t addrlen）<span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      <p>
       参数解释
      </p>
     </li>
     <li>
      <ul>
       <li>
        sockfd：套接字描述符，对于UDP来说，它可能还没有通过connect函数与特定的远程地址关联
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        buf：只想数据缓冲区的指针
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        len：指定了buf缓冲区的长度
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        flags：标志位，用于修改sendto的行为。常用的标志包括MSG_CONFIRM（请求确认消息已发送）、MSG_TROUTE（绕过路由表直接发送）等。
       </li>
      </ul>
     </li>
     <li>
      <ul>
       <li>
        dest_addr：指向sockaddr结构体的指针，用于指定接收方的地址信息。这个结构体包含了目标主机的IP地址和端口号。
       </li>
      </ul>
     </li>
     <li>
      <p>
       addrlen：指定了dest_addr所指向的地址结构的大小。这个值是通过sizeof操作符获取的
      </p>
     </li>
     <li>
      <p>
       返回值：sendto（）函数返回成功发送的字节数。如果返回-1，表示发生了错误，错误类型可以通过errno来检查
      </p>
     </li>
    </ul>
    <ol start="4">
     <li>
      WASDATA结构体
      <br/>
      WASDATA是Windows Sockets API（Winsock）中的一个结构体，包含有关Windows Sockets的实现版本和系统的配置信息。在调用WSAStartup（）函数时，应用程序必须传递该结构体的指针，以便Winsock初始化并返回相关信息。
     </li>
    </ol>
    <ul>
     <li>
      WSADATA结构体定义在&lt;winsock2.h&gt;头文件中，具体如下：
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">WSAData</span><span class="token punctuation">{<!-- --></span>
	WORD wVersion；  <span class="token comment">//Winsock实现的版本号</span>
	WORD wHighVersion；<span class="token comment">//支持的最高版本号</span>
	<span class="token keyword">char</span> szDescription<span class="token punctuation">[</span>WSADESCRIPTION_LEN<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>；<span class="token comment">//描述Winsock的文本字符串</span>
	<span class="token keyword">char</span> szSystemStatus<span class="token punctuation">[</span>WSASYSSTATUS_LEN<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>；<span class="token comment">//当前的状态或配置</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> iMaxSockets<span class="token punctuation">;</span><span class="token comment">//系统支持的最大套接字数</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> iMaxUdpDg；<span class="token comment">//支持的最大UDP数据报大小</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>IpVendorInfo；<span class="token comment">//供应商特定的信息	</span>
<span class="token punctuation">}</span>WSADATA，<span class="token operator">*</span>LPWSADATA<span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="UDP_382">
     </a>
     七、UDP的挑战
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/03e7a5d202f5425d8b3c53239e9cb3a9.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e3ebb335c8574e0aafe31ea03e78758b.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0442b73911e14ee796f96f86278eae31.png">
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8754261560e44f44bc3bb0080de1f481.png"/>
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dca448e47ae24b219f34b231151e42d9.png"/>
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cffae08bfdcb42819801c4e5ac27b5ef.png"/>
       </img>
      </img>
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f68756a696168616e67646577612f:61727469636c652f64657461696c732f313436323538303634" class_="artid" style="display:none">
 </p>
</div>


