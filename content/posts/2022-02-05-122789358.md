---
layout: post
title: "鸿蒙之连接IoT云平台华为云"
date: 2022-02-05 13:27:11 +0800
description: "配置云平台端可以查看官方提供的文档：https://support"
keywords: "华为hap应用连接华为iot平台"
categories: ['鸿蒙']
tags: ['物联网', '华为云', 'Harmonyos']
artid: "122789358"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122789358
    alt: "鸿蒙之连接IoT云平台华为云"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122789358
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122789358
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     鸿蒙之连接IoT云平台（华为云）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     配置云平台端
    </h2>
    <p>
     可以查看官方提供的文档：https://support.huaweicloud.com/devg-iothub/iot_01_2127.html
    </p>
    <ol>
     <li>
      首先进入华为云主页，然后在产品中找到IoT物联网中的设备接入 IoTDA。
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/7b81f796016d9b47e7379d900dce6ec1.png#pic_center"/>
     </li>
     <li>
      找到管理控制台
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1bd00aad5b373acc9b38c73b4e1b1e0c.png#pic_center"/>
     </li>
     <li>
      点击快速体验
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b330fc056dc9b30d1de06f6fb6413383.png#pic_center"/>
     </li>
     <li>
      点击向导式极速体验
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3fb31114c067457de4a5a64c9e949840.png#pic_center">
       <br/>
       填写产品名称
      </img>
     </li>
     <li>
      注册设备
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/5ed3ac841ea7b97fe6f59d1fc0293371.png#pic_center"/>
     </li>
     <li>
      选择设备演示包
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3b7923c53785939679ee1546ca3a28fd.png#pic_center"/>
     </li>
     <li>
      完成
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/2b5db82fdf29829cf29d52be1f85db15.png#pic_center"/>
     </li>
     <li>
      可以看到我们已经完成了产品的创建和设备的注册
     </li>
     <li>
      自定义Topic
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/04817cf4f365c1a0187a7d941b1f963b.png#pic_center">
       <br/>
       点击新增自定义Topic
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/ff659e4adbe9b30dada6b863097c9c32.png#pic_center"/>
       <br/>
       填写相关信息，点击确认即可.
      </img>
     </li>
     <li>
      找到设备ID
      <br/>
      找到刚才创建的设备
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/4d2fdc89c939413ba2d81615d2243380.png#pic_center"/>
     </li>
     <li>
      获得MQTT相关信息MQTT ClientId
      <br/>
      点击： https://iot-tool.obs-website.cn-north-4.myhuaweicloud.com/
      <br/>
      将设备中的设备ID和密钥填入到此网站中。
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/8d0ebde3389e19862a8cd003712e2a21.png"/>
      <br/>
      获得以上三种编码，后面会用到
     </li>
     <li>
      获得接入地址
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/1712bb9b5d35c99dffd6688bec5f8686.png#pic_center"/>
      <br/>
      点击平台接入地址
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/512c2f2fc31ffd182e0fcb9e7e0d45d2.png#pic_center"/>
      <br/>
      在里面找到相应MQTT地址，后面会用到。
     </li>
    </ol>
    <h2>
     <a id="_36">
     </a>
     硬件设备端
    </h2>
    <p>
     将以前的MQTT程序修改。
    </p>
    <pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">mqtt_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>		<span class="token comment">// MQTT初始化开始连接</span>
	MQTTPacket_connectData data <span class="token operator">=</span> MQTTPacket_connectData_initializer<span class="token punctuation">;</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>host <span class="token operator">=</span> <span class="token string">"xxxxxxxxxxxxxx"</span><span class="token punctuation">;</span>		<span class="token comment">// 地址</span>
	<span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">1883</span><span class="token punctuation">;</span>					<span class="token comment">// 端口	</span>
	mqtt_sock <span class="token operator">=</span> <span class="token function">transport_open</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>mqtt_sock <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> mqtt_sock<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	data<span class="token punctuation">.</span>clientID<span class="token punctuation">.</span>cstring <span class="token operator">=</span> <span class="token string">"转换得到的ClientID"</span><span class="token punctuation">;</span><span class="token comment">// ClientID</span>
	data<span class="token punctuation">.</span>keepAliveInterval <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>cleansession <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	data<span class="token punctuation">.</span>username<span class="token punctuation">.</span>cstring <span class="token operator">=</span> <span class="token string">"转换得到的用户名"</span><span class="token punctuation">;</span>	<span class="token comment">// 用户名</span>
	data<span class="token punctuation">.</span>password<span class="token punctuation">.</span>cstring <span class="token operator">=</span> <span class="token string">"转换得到的密码"</span><span class="token punctuation">;</span>	<span class="token comment">// 密码</span>
</code></pre>
    <p>
     也可以直接下载所有改动的源码：https://download.csdn.net/download/qq_44629109/79326208
    </p>
    <h2>
     <a id="_55">
     </a>
     使用
    </h2>
    <ol>
     <li>
      编译后烧录到开发板，之后按下复位
     </li>
     <li>
      在串口调试助手中通过AT指令使开发板连接WIFI
     </li>
    </ol>
    <pre><code class="prism language-c">AT<span class="token operator">+</span>STARTSTA	启动STA模式
AT<span class="token operator">+</span>SCAN	扫描周边AP
AT<span class="token operator">+</span>SCANRESULT	显示扫描结果
AT<span class="token operator">+</span>CONN<span class="token operator">=</span><span class="token string">"BAHUYANG"</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"123456789"</span>	连接指定AP，其中SSID<span class="token operator">/</span>PASSWORD为待连接的热点名称和密码
AT<span class="token operator">+</span>STASTAT	查看连接结果
AT<span class="token operator">+</span>DHCP<span class="token operator">=</span>wlan0<span class="token punctuation">,</span><span class="token number">1</span>	通过DHCP向AP请求wlan0的IP地址
AT<span class="token operator">+</span>IFCFG	查看模组接口IP
</code></pre>
    <ol start="3">
     <li>
      连接成功后输入： AT+MQTTTEST
      <br/>
      连接MQTT
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/63c0877e888839873ac85e319fda641c.png#pic_center"/>
     </li>
     <li>
      然后查看云平台
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/3d28e9dcb08de9125a846fd21f1ebd41.png#pic_center"/>
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/1dc260692da585f49b6e6bea16227196.png#pic_center"/>
      <br/>
      可以看到平台已经收到设备的消息了
     </li>
    </ol>
    <h2>
     <a id="_78">
     </a>
     后续
    </h2>
    <p>
     可以关注我的
     <a href="https://blog.csdn.net/qq_44629109/category_10441148.html">
      程序设计专栏
     </a>
     。
     <br/>
     关注微信公众号
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/098f41d3a3b6340e1913a05e4bb644fe.jpeg#pic_center"/>
    </p>
    <p>
     编写不易，感谢支持。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343632393130392f:61727469636c652f64657461696c732f313232373839333538" class_="artid" style="display:none">
 </p>
</div>


