---
layout: post
title: "Selenium-中的-alert-处理"
date: 2025-03-13 21:48:08 +0800
description: "弹窗的基本处理"
keywords: "Selenium 中的 alert 处理"
categories: ['测试学习']
tags: ['测试工具', 'Selenium', 'Python']
artid: "146242954"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146242954
    alt: "Selenium-中的-alert-处理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146242954
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146242954
cover: https://bing.ee123.net/img/rand?artid=146242954
image: https://bing.ee123.net/img/rand?artid=146242954
img: https://bing.ee123.net/img/rand?artid=146242954
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Selenium 中的 alert 处理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     在 Selenium 中，
     <code>
      alert
     </code>
     是浏览器的 JavaScript 弹窗（如
     <code>
      alert()
     </code>
     ,
     <code>
      confirm()
     </code>
     ,
     <code>
      prompt()
     </code>
     ），通常用于警告、确认操作或输入信息。Selenium 提供了
     <code>
      driver.switch_to.alert
     </code>
     来处理这些弹窗。
    </p>
    <p>
     <img alt="" height="455" src="https://i-blog.csdnimg.cn/direct/56cfe05e6fce4294825c952075600f25.png" width="2353"/>
    </p>
    <p>
     <img alt="" height="502" src="https://i-blog.csdnimg.cn/direct/eb0f6434bf7f47f2b5235a04068e2efc.png" width="1291"/>
    </p>
    <hr/>
    <h3>
     1.
     <strong>
      获取
      <code>
       alert
      </code>
      对象
     </strong>
    </h3>
    <p>
     当页面弹出
     <code>
      alert
     </code>
     时，你需要先切换到该
     <code>
      alert
     </code>
     ，然后才能对其进行操作：
    </p>
    <pre><code class="language-python">alert = driver.switch_to.alert
</code></pre>
    <hr/>
    <h3>
     2.
     <strong>
      常见操作
     </strong>
    </h3>
    <h4>
     <strong>
      （1）获取
      <code>
       alert
      </code>
      文本
     </strong>
    </h4>
    <p>
     获取弹窗的文本内容：
    </p>
    <pre><code class="language-python">text = alert.text
print(text)
</code></pre>
    <h4>
     <strong>
      （2）接受
      <code>
       alert
      </code>
     </strong>
    </h4>
    <p>
     点击
     <strong>
      “确定”
     </strong>
     按钮：
    </p>
    <pre><code class="language-python">alert.accept()
</code></pre>
    <h4>
     <strong>
      （3）取消
      <code>
       alert
      </code>
     </strong>
    </h4>
    <p>
     点击
     <strong>
      “取消”
     </strong>
     按钮（适用于确认弹窗和输入弹窗）：
    </p>
    <pre><code class="language-python">alert.dismiss()
</code></pre>
    <h4>
     <strong>
      （4）输入文本
     </strong>
    </h4>
    <p>
     适用于输入类型的弹窗：
    </p>
    <pre><code class="language-python">alert.send_keys("Hello, Selenium!")
alert.accept()  # 发送文本后点击“确定”
</code></pre>
    <h3 style="background-color:transparent">
     3.
     <strong>
      等待
      <code>
       alert
      </code>
      出现
     </strong>
    </h3>
    <p>
     有时候
     <code>
      alert
     </code>
     可能不会立刻出现，因此可以使用
     <strong>
      显式等待
     </strong>
     让 Selenium 等待弹窗：
    </p>
    <pre><code class="language-python">from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# 等待 `alert` 出现（最多 10 秒）
wait = WebDriverWait(driver, 10)
alert = wait.until(EC.alert_is_present())

# 获取文本并接受
print(alert.text)
alert.accept()
</code></pre>
    <p>
     <strong>
      (在这种时候它就自己切换了！不用再alert = driver.switch_to.alert）
     </strong>
    </p>
    <p>
    </p>
    <h4 style="background-color:transparent">
     <strong>
      等价于
     </strong>
    </h4>
    <p>
     如果不用
     <code>
      WebDriverWait
     </code>
     ，手动
     <code>
      switch_to.alert
     </code>
     需要自己检查
     <code>
      alert
     </code>
     是否存在：
    </p>
    <pre><code class="language-python">from selenium.common.exceptions import NoAlertPresentException
import time

time.sleep(3)  # 先等待几秒，假设 `alert` 可能延迟出现

try:
    alert = self.driver.switch_to.alert  # 手动切换到 `alert`
    print("弹窗内容:", alert.text)
    alert.accept()
except NoAlertPresentException:
    print("没有弹窗")
</code></pre>
    <p>
    </p>
    <h3>
     4.
     <strong>
      常见
      <code>
       alert
      </code>
      相关异常
     </strong>
    </h3>
    <h4>
     <strong>
      （1）
      <code>
       NoAlertPresentException
      </code>
     </strong>
    </h4>
    <blockquote>
     <p>
      <code>
       selenium.common.exceptions.NoAlertPresentException: Message: no such alert
      </code>
     </p>
     <p>
      <strong>
       原因
      </strong>
      ：试图操作
      <code>
       alert
      </code>
      ，但当前页面没有弹窗。
     </p>
    </blockquote>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      确保
      <code>
       alert
      </code>
      确实存在，可以先用
      <code>
       WebDriverWait
      </code>
      等待弹窗。
     </li>
     <li>
      使用
      <code>
       try-except
      </code>
      处理异常：
      <pre><code class="language-python">try:
    alert = driver.switch_to.alert
    print(alert.text)
    alert.accept()
except NoAlertPresentException:
    print("没有弹窗")
</code></pre>
     </li>
    </ul>
    <h4 style="background-color:transparent">
     <strong>
      2）
      <code>
       UnexpectedAlertPresentException
      </code>
     </strong>
    </h4>
    <blockquote>
     <p>
      <code>
       selenium.common.exceptions.UnexpectedAlertPresentException
      </code>
     </p>
     <p>
      <strong>
       原因
      </strong>
      ：执行某个 Selenium 操作时，页面突然弹出
      <code>
       alert
      </code>
      ，导致操作失败。
     </p>
    </blockquote>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      先处理
      <code>
       alert
      </code>
      ，然后再执行 Selenium 操作：
     </li>
    </ul>
    <pre><code class="language-python">try:
    alert = driver.switch_to.alert
    alert.accept()  # 先处理弹窗
except NoAlertPresentException:
    pass  # 没有弹窗就继续执行

# 继续执行 Selenium 操作
driver.find_element(By.CSS_SELECTOR, "#submit").click()
</code></pre>
    <h4 style="background-color:transparent">
     <strong>
      处理
      <code>
       alert
      </code>
      关闭后仍然存在的问题
     </strong>
    </h4>
    <p>
     有些
     <code>
      alert
     </code>
     在关闭后，可能仍然会影响 Selenium 操作（
     <strong>
      比如
      <code>
       accept()
      </code>
      之后仍然报
      <code>
       alert
      </code>
      存在的错误
     </strong>
     ）。
    </p>
    <p>
     <strong>
      解决方案
     </strong>
     ：执行
     <code>
      time.sleep(1)
     </code>
     <strong>
      或再次检查
      <code>
       alert
      </code>
      是否仍然存在
     </strong>
    </p>
    <pre><code class="language-python">import time

alert = WebDriverWait(self.driver, 5).until(EC.alert_is_present())
alert.accept()

# 等待 alert 彻底消失
time.sleep(1)

try:
    self.driver.switch_to.alert  # 这里如果 alert 还在会报错
    print("alert 仍然存在")
except NoAlertPresentException:
    print("alert 已成功关闭")
</code></pre>
    <h4>
     <strong>
      <code>
       alert
      </code>
      可能出现在
      <code>
       iframe
      </code>
      里
     </strong>
    </h4>
    <p>
     如果
     <code>
      alert
     </code>
     是
     <strong>
      嵌套在
      <code>
       iframe
      </code>
      内部
     </strong>
     ，你可能需要先切换
     <code>
      iframe
     </code>
     ：
    </p>
    <pre><code class="language-python"># 先切换到 `iframe`
iframe = self.driver.find_element(By.CSS_SELECTOR, "iframe")
self.driver.switch_to.frame(iframe)

# 再等待 `alert`
alert = WebDriverWait(self.driver, 5).until(EC.alert_is_present())
alert.accept()

# 切回默认页面
self.driver.switch_to.default_content()
</code></pre>
    <h3>
     5.
     <strong>
      示例：处理登录失败的
      <code>
       alert
      </code>
     </strong>
    </h3>
    <pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.common.exceptions import NoAlertPresentException

# 启动浏览器
driver = webdriver.Edge()
driver.get("https://example.com/login")

# 输入错误的用户名和密码
driver.find_element(By.CSS_SELECTOR, "#username").send_keys("")
driver.find_element(By.CSS_SELECTOR, "#password").send_keys("123456")
driver.find_element(By.CSS_SELECTOR, "#submit").click()

# 等待 `alert` 并获取文本
try:
    wait = WebDriverWait(driver, 10)
    alert = wait.until(EC.alert_is_present())
    print("弹窗内容:", alert.text)
    alert.accept()
except NoAlertPresentException:
    print("没有弹窗")

# 关闭浏览器
driver.quit()
</code></pre>
    <ul>
     <li>
      <code>
       driver.switch_to.alert
      </code>
      用于切换到
      <code>
       alert
      </code>
      并进行操作。
     </li>
     <li>
      <code>
       alert.text
      </code>
      获取弹窗内容，
      <code>
       accept()
      </code>
      点击
      <strong>
       确定
      </strong>
      ，
      <code>
       dismiss()
      </code>
      点击
      <strong>
       取消
      </strong>
      。
     </li>
     <li>
      <code>
       send_keys()
      </code>
      仅适用于
      <code>
       prompt()
      </code>
      类型的弹窗。
     </li>
     <li>
      使用
      <code>
       WebDriverWait(driver, timeout).until(EC.alert_is_present())
      </code>
      等待
      <code>
       alert
      </code>
      出现，避免
      <code>
       NoAlertPresentException
      </code>
      。
     </li>
    </ul>
    <h3>
    </h3>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f626270706f6f692f:61727469636c652f64657461696c732f313436323432393534" class_="artid" style="display:none">
 </p>
</div>


