---
layout: post
title: "在-UniApp-中实现stream流式输出-AI-聊天功能,AI输出内容用Markdown格式展示"
date: 2025-03-10 16:24:52 +0800
description: "在 UniApp 中实现stream流式输出 AI 聊天功能，AI输出内容用Markdown格式展示"
keywords: "在 UniApp 中实现stream流式输出 AI 聊天功能，AI输出内容用Markdown格式展示"
categories: ['Uniapp']
tags: ['流式输出', '前端', 'Stream', 'App', 'Ai']
artid: "146156356"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146156356
    alt: "在-UniApp-中实现stream流式输出-AI-聊天功能,AI输出内容用Markdown格式展示"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146156356
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146156356
cover: https://bing.ee123.net/img/rand?artid=146156356
image: https://bing.ee123.net/img/rand?artid=146156356
img: https://bing.ee123.net/img/rand?artid=146156356
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     在 UniApp 中实现stream流式输出 AI 聊天功能，AI输出内容用Markdown格式展示
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_UniApp__AI__0">
     </a>
     在 UniApp 中实现流式 AI 聊天功能
    </h2>
    <h3>
     <a id="_2">
     </a>
     介绍
    </h3>
    <p>
     在现代 Web 开发中，流式 API 响应能够显著提升用户体验，尤其是在与 AI 聊天接口进行交互时。本文将介绍如何在 UniApp 中使用 Fetch API 实现一个流式响应的 AI 聊天功能，包括实时更新聊天内容和滚动到底部的功能。
    </p>
    <h3>
     <a id="_6">
     </a>
     实现
    </h3>
    <p>
     用 Markdown 格式展示 AI 输出的内容
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> index<span class="token punctuation">.</span>vue <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>view v<span class="token operator">-</span><span class="token keyword">else</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bot-message"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"'bot-msg-' + index"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"avatar-container"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>image
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"message-avatar"</span>
      src<span class="token operator">=</span><span class="token string">"/static/images/icon_robot.png"</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"message-content bot-bubble"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>u<span class="token operator">-</span>loading<span class="token operator">-</span>icon
      v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span>"
        isSendLoading <span class="token operator">&amp;&amp;</span>
        index <span class="token operator">==</span> chatMessages<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span><span class="token function">getText</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
      "
    <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>u<span class="token operator">-</span>loading<span class="token operator">-</span>icon<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>text v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>
        <span class="token comment">// 用Markdown格式展示</span>
      <span class="token operator">&lt;</span>AiMarkdownViewer
        <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"message-text"</span>
        <span class="token operator">:</span>content<span class="token operator">=</span><span class="token string">"message.content"</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> message<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">'服务异常，请重试'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>


<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> AiMarkdownViewer<span class="token punctuation">.</span>vue <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token comment">// 使用showdown插件</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>view
		<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"markdown-container"</span>
		v<span class="token operator">-</span>html<span class="token operator">=</span><span class="token string">"parsedContent"</span>
		ref<span class="token operator">=</span><span class="token string">"markdownContainer"</span>
	<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> showdown <span class="token keyword">from</span> <span class="token string">'showdown'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
	<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'AiMarkdownViewer'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
			<span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">converter</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">showdown<span class="token punctuation">.</span>Converter</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">tables</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">tasklists</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">simplifiedAutoLink</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">strikethrough</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tableEnhancement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">parsedContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">const</span> processed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
					<span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^```markdown\n([\s\S]*?)\n```$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gm</span></span><span class="token punctuation">,</span> <span class="token comment">// 添加m标志处理多行</span>
					<span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">return</span> content
					<span class="token punctuation">}</span>
				<span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>converter<span class="token punctuation">.</span><span class="token function">makeHtml</span><span class="token punctuation">(</span>processed<span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token string">'微警灌云还在学习中，请您咨询当地派出所'</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">tableEnhancement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'output'</span><span class="token punctuation">,</span>
				<span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 为表格添加容器和样式类</span>
					<span class="token keyword">return</span> text
						<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
							<span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;table&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
							<span class="token string">'&lt;div class="table-wrapper"&gt;&lt;table class="data-table"&gt;'</span>
						<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;\/table&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&lt;/table&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;td&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&lt;td class="data-cell"&gt;'</span><span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;th&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&lt;th class="header-cell"&gt;'</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style scoped lang<span class="token operator">=</span><span class="token string">"scss"</span><span class="token operator">&gt;</span>
<span class="token punctuation">.</span>markdown<span class="token operator">-</span>container <span class="token punctuation">{<!-- --></span>
	<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>
	<span class="token comment">// padding: 20px;</span>
	<span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
	font<span class="token operator">-</span>size<span class="token operator">:</span> 26rpx<span class="token punctuation">;</span>
	line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">1.7</span><span class="token punctuation">;</span>
	<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token number">374151</span><span class="token punctuation">;</span>
  white<span class="token operator">-</span>space<span class="token operator">:</span> normal<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token operator">/</span>deep<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">.</span>table<span class="token operator">-</span>wrapper <span class="token punctuation">{<!-- --></span>
		overflow<span class="token operator">-</span>x<span class="token operator">:</span> auto<span class="token punctuation">;</span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> 1em <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid #ebeef5<span class="token punctuation">;</span>
		border<span class="token operator">-</span>radius<span class="token operator">:</span> 4px<span class="token punctuation">;</span>
		box<span class="token operator">-</span>shadow<span class="token operator">:</span> <span class="token number">0</span> 2px 12px <span class="token number">0</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span>data<span class="token operator">-</span>table <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
			min<span class="token operator">-</span>width<span class="token operator">:</span> 600px<span class="token punctuation">;</span>
			border<span class="token operator">-</span>collapse<span class="token operator">:</span> collapse<span class="token punctuation">;</span>
			font<span class="token operator">-</span>size<span class="token operator">:</span> 28rpx<span class="token punctuation">;</span>
			line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">1.5</span><span class="token punctuation">;</span>

			<span class="token punctuation">.</span>header<span class="token operator">-</span>cell <span class="token punctuation">{<!-- --></span>
				background<span class="token operator">-</span>color<span class="token operator">:</span> #f8f9fa<span class="token punctuation">;</span>
				<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token number">606266</span><span class="token punctuation">;</span>
				font<span class="token operator">-</span>weight<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">;</span>
				<span class="token literal-property property">padding</span><span class="token operator">:</span> 12px 16px<span class="token punctuation">;</span>
				border<span class="token operator">-</span>bottom<span class="token operator">:</span> 2px solid #ebeef5<span class="token punctuation">;</span>
				white<span class="token operator">-</span>space<span class="token operator">:</span> nowrap<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token punctuation">.</span>data<span class="token operator">-</span>cell <span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">padding</span><span class="token operator">:</span> 12px 16px<span class="token punctuation">;</span>
				border<span class="token operator">-</span>bottom<span class="token operator">:</span> 1px solid #ebeef5<span class="token punctuation">;</span>
				<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token number">606266</span><span class="token punctuation">;</span>
				min<span class="token operator">-</span>width<span class="token operator">:</span> 80px<span class="token punctuation">;</span>

				<span class="token operator">&amp;</span><span class="token operator">:</span>empty<span class="token operator">:</span><span class="token operator">:</span>before <span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">' '</span><span class="token punctuation">;</span>
					<span class="token literal-property property">display</span><span class="token operator">:</span> inline<span class="token operator">-</span>block<span class="token punctuation">;</span>
					<span class="token literal-property property">width</span><span class="token operator">:</span> 1px<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token literal-property property">tr</span><span class="token operator">:</span>hover <span class="token punctuation">{<!-- --></span>
				background<span class="token operator">-</span>color<span class="token operator">:</span> #f5f7fa<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token literal-property property">tr</span><span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token parameter">even</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				background<span class="token operator">-</span>color<span class="token operator">:</span> #fafafa<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token literal-property property">td</span><span class="token operator">:</span>first<span class="token operator">-</span>child<span class="token punctuation">,</span>
			<span class="token literal-property property">th</span><span class="token operator">:</span>first<span class="token operator">-</span>child <span class="token punctuation">{<!-- --></span>
				border<span class="token operator">-</span>left<span class="token operator">:</span> 1px solid #ebeef5<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token literal-property property">td</span><span class="token operator">:</span>last<span class="token operator">-</span>child<span class="token punctuation">,</span>
			<span class="token literal-property property">th</span><span class="token operator">:</span>last<span class="token operator">-</span>child <span class="token punctuation">{<!-- --></span>
				border<span class="token operator">-</span>right<span class="token operator">:</span> 1px solid #ebeef5<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">/</span>deep<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
	h1<span class="token punctuation">,</span>
	h2<span class="token punctuation">,</span>
	h3<span class="token punctuation">,</span>
	h4<span class="token punctuation">,</span>
	h5<span class="token punctuation">,</span>
	h6 <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> 1em <span class="token number">0</span><span class="token punctuation">;</span>
		font<span class="token operator">-</span>weight<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #1f2937<span class="token punctuation">;</span>

		<span class="token operator">&amp;</span><span class="token operator">:</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token parameter">h1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			border<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5px solid #e5e7eb<span class="token punctuation">;</span>
			padding<span class="token operator">-</span>bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>4em<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	h1 <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>5em<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	h2 <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>4em<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	h3 <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>3em<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	h4 <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>2em<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	h5 <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>1em<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	h6 <span class="token punctuation">{<!-- --></span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> 1em<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 列表样式</span>
	ul<span class="token punctuation">,</span>
	ol <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>8em <span class="token number">0</span><span class="token punctuation">;</span>
		padding<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>5em<span class="token punctuation">;</span>

		li <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>4em <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token operator">&amp;</span><span class="token operator">:</span><span class="token operator">:</span>marker <span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">color</span><span class="token operator">:</span> #6b7280<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 分割线</span>
	hr <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5px<span class="token punctuation">;</span>
		<span class="token literal-property property">background</span><span class="token operator">:</span> #e5e7eb<span class="token punctuation">;</span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>5em <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 代码块</span>
	pre <span class="token punctuation">{<!-- --></span>
		background<span class="token operator">-</span>color<span class="token operator">:</span> #f9fafb<span class="token punctuation">;</span>
		border<span class="token operator">-</span>radius<span class="token operator">:</span> 8px<span class="token punctuation">;</span>
		<span class="token literal-property property">padding</span><span class="token operator">:</span> 1em<span class="token punctuation">;</span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">.</span>2em <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5px solid #e5e7eb<span class="token punctuation">;</span>

		code <span class="token punctuation">{<!-- --></span>
			font<span class="token operator">-</span>family<span class="token operator">:</span> <span class="token string">'JetBrains Mono'</span><span class="token punctuation">,</span> Consolas<span class="token punctuation">,</span> monospace<span class="token punctuation">;</span>
			font<span class="token operator">-</span>size<span class="token operator">:</span> 13px<span class="token punctuation">;</span>
			<span class="token literal-property property">color</span><span class="token operator">:</span> #<span class="token number">374151</span><span class="token punctuation">;</span>
			line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">1.6</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 行内代码</span>
	<span class="token literal-property property">code</span><span class="token operator">:</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token parameter">pre code</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		background<span class="token operator">-</span>color<span class="token operator">:</span> #f3f4f6<span class="token punctuation">;</span>
		<span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>2em <span class="token number">0</span><span class="token punctuation">.</span>4em<span class="token punctuation">;</span>
		border<span class="token operator">-</span>radius<span class="token operator">:</span> 4px<span class="token punctuation">;</span>
		font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>9em<span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #dc2626<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 引用块</span>
	blockquote <span class="token punctuation">{<!-- --></span>
		border<span class="token operator">-</span>left<span class="token operator">:</span> 3px solid #e5e7eb<span class="token punctuation">;</span>
		<span class="token literal-property property">margin</span><span class="token operator">:</span> 1em <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">.</span>5em 1em<span class="token punctuation">;</span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #4b5563<span class="token punctuation">;</span>
		background<span class="token operator">-</span>color<span class="token operator">:</span> #f8fafc<span class="token punctuation">;</span>
		border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">0</span> 4px 4px <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 链接</span>
	a <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">color</span><span class="token operator">:</span> #3b82f6<span class="token punctuation">;</span>
		text<span class="token operator">-</span>decoration<span class="token operator">:</span> none<span class="token punctuation">;</span>
		<span class="token operator">&amp;</span><span class="token operator">:</span>hover <span class="token punctuation">{<!-- --></span>
			text<span class="token operator">-</span>decoration<span class="token operator">:</span> underline<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">/</span>deep<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
	pre <span class="token punctuation">{<!-- --></span>
		code <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">display</span><span class="token operator">:</span> block<span class="token punctuation">;</span>
			<span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
			overflow<span class="token operator">-</span>x<span class="token operator">:</span> auto<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre>
    <p>
     我们需要使用 Fetch API 向 AI 聊天服务发送请求，并读取其流式响应。以下是实现的关键代码段。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">async</span> <span class="token function">getAIChat</span><span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> aiMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// 使用 Fetch API 进行流式请求  </span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>config<span class="token punctuation">.</span>aiBaseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/v1/chat/completions</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>  
        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>config<span class="token punctuation">.</span>apikey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>  
            <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>  
        <span class="token punctuation">}</span><span class="token punctuation">,</span>  
        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment">// 检测响应状态  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">const</span> errorData <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errorData<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token string">'请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">this</span><span class="token punctuation">.</span>isSendLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 更新加载状态  </span>

    <span class="token comment">// 使用 response.body.getReader() 开始逐块读取流式响应，使用 UTF-8 编码解码数据。</span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> response<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  

    <span class="token comment">// 用于流式读取数据  </span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">done</span><span class="token operator">:</span> readerDone<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        done <span class="token operator">=</span> readerDone<span class="token punctuation">;</span>  

        <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token comment">// 逐块解码并拼接  </span>
            <span class="token keyword">const</span> chunkText <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">stream</span><span class="token operator">:</span> <span class="token operator">!</span>done <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// 解析接收到的 JSON 数据  </span>
            <span class="token keyword">const</span> lines <span class="token operator">=</span> chunkText<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按行分割  </span>

            lines<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'data:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                    <span class="token keyword">const</span> jsonString <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>  
                        <span class="token keyword">const</span> jsonData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span>  

                        <span class="token comment">// 提取内容部分  </span>
                        <span class="token keyword">const</span> content <span class="token operator">=</span> jsonData<span class="token punctuation">.</span>choices<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>delta<span class="token operator">?.</span>content <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>  

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                            aiMessage<span class="token punctuation">.</span>content <span class="token operator">+=</span> content<span class="token punctuation">;</span> <span class="token comment">// 更新聊天内容  </span>

                            <span class="token comment">// 清除开头的换行符  </span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>aiMessage<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                                aiMessage<span class="token punctuation">.</span>content <span class="token operator">=</span> aiMessage<span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                            <span class="token punctuation">}</span>  

                            <span class="token comment">// 刷新页面渲染  </span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$forceUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 确保视图更新  </span>

                            <span class="token comment">// 滚动到底部  </span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>  
                                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用滚动到底部的方法  </span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                        <span class="token punctuation">}</span>  
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error parsing JSON:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token punctuation">}</span>  
                <span class="token punctuation">}</span>  
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343039343239362f:61727469636c652f64657461696c732f313436313536333536" class_="artid" style="display:none">
 </p>
</div>


