---
layout: post
title: "GoLang的select是什么在什么时候场景下用"
date: 2025-03-06 12:28:36 +0800
description: "在 Go 语言中，select 是专门用于处理通道（Channel）多路复用的关键字，它可以同时监听多个通道的读写操作，并根据就绪的通道执行对应的逻辑。"
keywords: "GoLang的select是什么？在什么时候场景下用"
categories: ['未分类']
tags: ['数据库', 'Select', 'Java', 'Golang', 'Go', 'Channel']
artid: "146065771"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146065771
    alt: "GoLang的select是什么在什么时候场景下用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146065771
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146065771
cover: https://bing.ee123.net/img/rand?artid=146065771
image: https://bing.ee123.net/img/rand?artid=146065771
img: https://bing.ee123.net/img/rand?artid=146065771
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     GoLang的select是什么？在什么时候场景下用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 Go 语言中，select 是专门用于处理通道（Channel）多路复用的关键字，它可以同时监听多个通道的读写操作，并根据就绪的通道执行对应的逻辑。以下是 select 的用法和典型应用场景：
    </p>
    <h3>
     <a id="_3">
     </a>
     一、基本用法
    </h3>
    <p>
     select 语法类似于 switch，但每个 case 必须是一个通道操作（发送或接收）。select 会阻塞，直到某个 case 对应的通道操作就绪，然后执行该 case 的代码。如果有多个 case 同时就绪，会随机选择一个执行。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> data <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch1<span class="token punctuation">:</span>  <span class="token comment">// 监听 ch1 的接收操作</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Received from ch1:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">case</span> ch2 <span class="token operator">&lt;-</span> <span class="token number">42</span><span class="token punctuation">:</span>      <span class="token comment">// 监听 ch2 的发送操作</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Sent to ch2"</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">// 超时控制</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Timeout"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="_19">
     </a>
     二、核心应用场景
    </h3>
    <h5>
     <a id="1__21">
     </a>
     1. 多通道监听
    </h5>
    <pre><code class="prism language-go"><span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> res <span class="token operator">:=</span> <span class="token operator">&lt;-</span>api1Chan<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"API1 response:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token keyword">case</span> res <span class="token operator">:=</span> <span class="token operator">&lt;-</span>api2Chan<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"API2 response:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2__33">
     </a>
     2. 超时控制
    </h5>
    <p>
     场景：避免某个通道操作永久阻塞，强制结束长时间未响应的操作。
    </p>
    <p>
     示例：结合 time.After 实现超时逻辑。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> data <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Received:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Timeout: No data received"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     三、执行流程
    </p>
    <ol>
     <li>
      <p>
       当执行到 select 语句时，它会监听页面 case 中的两个通道操作：从 ch 接收数据和从 time.After 返回的通道接收数据。
      </p>
     </li>
     <li>
      <p>
       如果此时通道 ch 中有数据发送，那么第一个分支会被执行，接收到数据并打印，然后 select 语句结束。
      </p>
     </li>
     <li>
      <p>
       如果通道 ch 中没有数据发送，那么 select 会等待，直到 3 秒后 time.After 返回的通道发送数据，此时第二个分支被执行，打印超时信息，select 语句结束。
      </p>
     </li>
     <li>
      <p>
       如果在等待过程中，通道 ch 收到数据的时间刚好在 3 秒内，那么第一个分支会优先执行，因为一旦有通道操作可以执行，select 就会选择执行对应的分支，而不会等待其他分支的操作完成。
      </p>
     </li>
    </ol>
    <p>
     这种代码结构在处理需要等待某个事件发生，同时又不想无限期等待的场景时非常有用，比如在网络编程中等待服务器响应、在并发任务中等待某个任务完成等场景，可以有效地避免程序因某个操作长时间没有响应而陷入死等状态。
    </p>
    <h5>
     <a id="3_Cancellation_59">
     </a>
     3. 任务取消（Cancellation）
    </h5>
    <p>
     场景：通过监听一个取消通道（如 context.Done()），主动终止协程。
    </p>
    <p>
     示例：使用 context 实现优雅退出。
    </p>
    <pre><code class="prism language-go"># 定时<span class="token number">5</span>秒后结束
ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Operation cancelled:"</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">case</span> result <span class="token operator">:=</span> <span class="token operator">&lt;-</span>workChan<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Work completed:"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="4_Default_Case_78">
     </a>
     4. 非阻塞操作（Default Case）
    </h5>
    <p>
     场景：尝试发送或接收数据，若无法立即执行，则执行默认逻辑。
    </p>
    <p>
     示例：非阻塞读取通道。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> data <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Data received:"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"No data available"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="5__93">
     </a>
     5. 并发任务协调
    </h5>
    <p>
     场景：等待多个并发任务完成，收集第一个结果或全部结果。
    </p>
    <p>
     示例：等待多个服务返回，取最快的结果。
    </p>
    <pre><code class="prism language-go">ch1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
ch2 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span>

<span class="token keyword">go</span> <span class="token function">fetchFromService1</span><span class="token punctuation">(</span>ch1<span class="token punctuation">)</span>
<span class="token keyword">go</span> <span class="token function">fetchFromService2</span><span class="token punctuation">(</span>ch2<span class="token punctuation">)</span>

<span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">case</span> res <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch1<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Result from Service1:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token keyword">case</span> res <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch2<span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Result from Service2:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34303337343630342f:61727469636c652f64657461696c732f313436303635373731" class_="artid" style="display:none">
 </p>
</div>


