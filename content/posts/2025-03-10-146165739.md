---
layout: post
title: "Pythonå®æˆ˜è¿›é˜¶No20-ç½‘ç»œçˆ¬è™«å¼€å‘Scrapyæ¡†æ¶è¯¦è§£"
date: 2025-03-10 22:31:06 +0800
description: "æœ¬æ–‡æ·±å…¥è§£æScrapyæ ¸å¿ƒæ¶æ„ï¼Œé€šè¿‡**ä¸­é—´ä»¶é“¾å¼å¤„ç†**ã€**å¸ƒéš†è¿‡æ»¤å™¨å¢é‡çˆ¬å–**ã€**SplashåŠ¨æ€æ¸²æŸ“**ã€**åˆ†å¸ƒå¼æŒ‡çº¹ç­–ç•¥**å››å¤§æ ¸å¿ƒæŠ€æœ¯ï¼Œç»“åˆæ”¿åºœæ•°æ®çˆ¬å–ä¸åŠ¨æ€APIé€†å‘å·¥ç¨‹å®æˆ˜æ¡ˆä¾‹ï¼Œæ„å»ºä¼ä¸šçº§çˆ¬è™«ç³»ç»Ÿã€‚æä¾›å®Œæ•´ä»£ç ä¸è¿è¡Œç»“æœï¼ŒåŒ…å«æ³•å¾‹åˆè§„è®¾è®¡ä¸åçˆ¬å¯¹æŠ—æ–¹æ¡ˆã€‚---Scrapyæ˜¯é€‚ç”¨äºPythonçš„ä¸€ä¸ªå¿«é€Ÿã€é«˜å±‚æ¬¡çš„å±å¹•æŠ“å–å’ŒwebæŠ“å–æ¡†æ¶ï¼Œç”¨äºæŠ“å–webç«™ç‚¹å¹¶ä»é¡µé¢ä¸­æå–ç»“æ„åŒ–çš„æ•°æ®ã€‚Scrapyç”¨é€”å¹¿æ³›ï¼Œå¯ä»¥ç”¨äºæ•°æ®æŒ–æ˜ã€ç›‘æµ‹å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ "
keywords: "ã€ŠPythonå®æˆ˜è¿›é˜¶ã€‹No20: ç½‘ç»œçˆ¬è™«å¼€å‘ï¼šScrapyæ¡†æ¶è¯¦è§£"
categories: ['Python']
tags: ['çˆ¬è™«', 'Scrapy', 'Python']
artid: "146165739"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146165739
    alt: "Pythonå®æˆ˜è¿›é˜¶No20-ç½‘ç»œçˆ¬è™«å¼€å‘Scrapyæ¡†æ¶è¯¦è§£"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146165739
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146165739
cover: https://bing.ee123.net/img/rand?artid=146165739
image: https://bing.ee123.net/img/rand?artid=146165739
img: https://bing.ee123.net/img/rand?artid=146165739
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ã€ŠPythonå®æˆ˜è¿›é˜¶ã€‹No20: ç½‘ç»œçˆ¬è™«å¼€å‘ï¼šScrapyæ¡†æ¶è¯¦è§£
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="No20_Scrapy_0">
     </a>
     No20: ç½‘ç»œçˆ¬è™«å¼€å‘ï¼šScrapyæ¡†æ¶è¯¦è§£
    </h2>
    <h3>
     <a id="_2">
     </a>
     æ‘˜è¦
    </h3>
    <p>
     æœ¬æ–‡æ·±å…¥è§£æScrapyæ ¸å¿ƒæ¶æ„ï¼Œé€šè¿‡
     <strong>
      ä¸­é—´ä»¶é“¾å¼å¤„ç†
     </strong>
     ã€
     <strong>
      å¸ƒéš†è¿‡æ»¤å™¨å¢é‡çˆ¬å–
     </strong>
     ã€
     <strong>
      SplashåŠ¨æ€æ¸²æŸ“
     </strong>
     ã€
     <strong>
      åˆ†å¸ƒå¼æŒ‡çº¹ç­–ç•¥
     </strong>
     å››å¤§æ ¸å¿ƒæŠ€æœ¯ï¼Œç»“åˆæ”¿åºœæ•°æ®çˆ¬å–ä¸åŠ¨æ€APIé€†å‘å·¥ç¨‹å®æˆ˜æ¡ˆä¾‹ï¼Œæ„å»ºä¼ä¸šçº§çˆ¬è™«ç³»ç»Ÿã€‚æä¾›å®Œæ•´ä»£ç ä¸è¿è¡Œç»“æœï¼ŒåŒ…å«æ³•å¾‹åˆè§„è®¾è®¡ä¸åçˆ¬å¯¹æŠ—æ–¹æ¡ˆã€‚
    </p>
    <hr/>
    <p>
     Scrapyæ˜¯é€‚ç”¨äºPythonçš„ä¸€ä¸ªå¿«é€Ÿã€é«˜å±‚æ¬¡çš„å±å¹•æŠ“å–å’ŒwebæŠ“å–æ¡†æ¶ï¼Œç”¨äºæŠ“å–webç«™ç‚¹å¹¶ä»é¡µé¢ä¸­æå–ç»“æ„åŒ–çš„æ•°æ®ã€‚Scrapyç”¨é€”å¹¿æ³›ï¼Œå¯ä»¥ç”¨äºæ•°æ®æŒ–æ˜ã€ç›‘æµ‹å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
     <br/>
     Scrapyå¸å¼•äººçš„åœ°æ–¹åœ¨äºå®ƒæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ ¹æ®éœ€æ±‚æ–¹ä¾¿çš„ä¿®æ”¹ã€‚å®ƒä¹Ÿæä¾›äº†å¤šç§ç±»å‹çˆ¬è™«çš„åŸºç±»ï¼Œå¦‚BaseSpiderã€sitemapçˆ¬è™«ç­‰ï¼Œæœ€æ–°ç‰ˆæœ¬åˆæä¾›äº†web2.0çˆ¬è™«çš„æ”¯æŒã€‚
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/709e6cb1bd604ad89bad9a173e57e694.png#pic_center"/>
    </p>
    <h3>
     <a id="_11">
     </a>
     è¿è¡Œç¯å¢ƒä¸ä¾èµ–è¯´æ˜
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># ç¯å¢ƒè¦æ±‚</span>
Python <span class="token number">3.8</span>+
Redis <span class="token number">6.0</span>+ <span class="token punctuation">(</span>åˆ†å¸ƒå¼åœºæ™¯<span class="token punctuation">)</span>

<span class="token comment"># ä¾èµ–å®‰è£…</span>
pip <span class="token function">install</span> <span class="token assign-left variable">scrapy</span><span class="token operator">==</span><span class="token number">2.8</span>.0 scrapy-splash<span class="token operator">==</span><span class="token number">0.9</span>.0 scrapy-redis<span class="token operator">==</span><span class="token number">0.7</span>.2
pip <span class="token function">install</span> <span class="token assign-left variable">redis</span><span class="token operator">==</span><span class="token number">4.5</span>.5 <span class="token assign-left variable">requests</span><span class="token operator">==</span><span class="token number">2.31</span>.0 <span class="token assign-left variable">beautifulsoup4</span><span class="token operator">==</span><span class="token number">4.12</span>.2
</code></pre>
    <hr/>
    <h3>
     <a id="_24">
     </a>
     æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜ä»£ç 
    </h3>
    <h4>
     <a id="1__26">
     </a>
     1. ä¸­é—´ä»¶é“¾å¼å¤„ç†æœºåˆ¶
    </h4>
    <p>
     <strong>
      æ ¸å¿ƒé€»è¾‘
     </strong>
     ï¼šé€šè¿‡
     <code>
      process_request
     </code>
     å’Œ
     <code>
      process_response
     </code>
     å®ç°è¯·æ±‚/å“åº”é¢„å¤„ç†
    </p>
    <pre><code class="prism language-python"><span class="token comment"># ä¸­é—´ä»¶å®ç°ç¤ºä¾‹ï¼šéšæœºUser-Agent</span>
<span class="token keyword">class</span> <span class="token class-name">RandomUserAgentMiddleware</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>user_agents <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"Mozilla/5.0 (Windows NT 10.0...)"</span><span class="token punctuation">,</span>
            <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15...)"</span>
        <span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_agents<span class="token punctuation">)</span>
        spider<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using User-Agent: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># settings.pyé…ç½®</span>
DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'myproject.middlewares.RandomUserAgentMiddleware'</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      è¾“å‡ºæ—¥å¿—
     </strong>
     ï¼š
    </p>
    <pre><code>[scrapy.core.engine] INFO: Using User-Agent: Mozilla/5.0 (Windows NT 10.0...
</code></pre>
    <hr/>
    <h4>
     <a id="2__55">
     </a>
     2. å¢é‡çˆ¬å–ä¸å¸ƒéš†è¿‡æ»¤å™¨
    </h4>
    <p>
     <strong>
      å®ç°æ–¹æ¡ˆ
     </strong>
     ï¼šåŸºäºScrapy-Redisçš„BloomFilterå»é‡
    </p>
    <pre><code class="prism language-python"><span class="token comment"># å¸ƒéš†è¿‡æ»¤å™¨é…ç½®ï¼ˆsettings.pyï¼‰</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span>
DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">"scrapy_redis.dupefilter.BloomFilter"</span>
REDIS_URL <span class="token operator">=</span> <span class="token string">'redis://localhost:6379'</span>

<span class="token comment"># å¯åŠ¨çˆ¬è™«ï¼ˆä¿ç•™å†å²æŒ‡çº¹ï¼‰</span>
scrapy crawl gov_spider <span class="token operator">-</span>s SCHEDULER_PERSIST<span class="token operator">=</span><span class="token boolean">True</span>
</code></pre>
    <p>
     <strong>
      è¿è¡Œæ•ˆæœ
     </strong>
     ï¼š
    </p>
    <pre><code>[scrapy_redis.scheduler] INFO: Resuming crawl (5678 requests scheduled)
</code></pre>
    <hr/>
    <h4>
     <a id="3_Splash_75">
     </a>
     3. Splashæ¸²æŸ“ä¸è‡ªåŠ¨ä»£ç†æ± 
    </h4>
    <p>
     <strong>
      åŠ¨æ€é¡µé¢å¤„ç†
     </strong>
     ï¼šé›†æˆSplashæ¸²æŸ“JavaScript
    </p>
    <pre><code class="prism language-python"><span class="token comment"># ä½¿ç”¨SplashRequestçˆ¬å–åŠ¨æ€é¡µé¢</span>
<span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy_splash <span class="token keyword">import</span> SplashRequest

<span class="token keyword">class</span> <span class="token class-name">DynamicSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'dynamic_spider'</span>
    
    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> SplashRequest<span class="token punctuation">(</span>
            url<span class="token operator">=</span><span class="token string">"https://example.com/ajax-page"</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">,</span>
            args<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'wait'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'content'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="dynamic-content"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      è¾“å‡ºç»“æœ
     </strong>
     ï¼š
    </p>
    <pre><code>{'content': 'è¿™æ˜¯åŠ¨æ€åŠ è½½çš„å†…å®¹'}
</code></pre>
    <hr/>
    <h4>
     <a id="4__106">
     </a>
     4. åˆ†å¸ƒå¼çˆ¬è™«æŒ‡çº¹ç­–ç•¥
    </h4>
    <p>
     <strong>
      åˆ†å¸ƒå¼æ¶æ„
     </strong>
     ï¼šé€šè¿‡Rediså…±äº«æŒ‡çº¹å’Œé˜Ÿåˆ—
    </p>
    <pre><code class="prism language-python"><span class="token comment"># åˆ†å¸ƒå¼é…ç½®ï¼ˆsettings.pyï¼‰</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span>
SCHEDULER_QUEUE_CLASS <span class="token operator">=</span> <span class="token string">'scrapy_redis.queue.FifoQueue'</span>
REDIS_HOST <span class="token operator">=</span> <span class="token string">'192.168.1.100'</span>
</code></pre>
    <p>
     <strong>
      è¿è¡Œå‘½ä»¤
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># åœ¨å¤šå°æœºå™¨ä¸Šå¯åŠ¨</span>
scrapy runspider myspider.py <span class="token parameter variable">-a</span> <span class="token assign-left variable">slave_id</span><span class="token operator">=</span><span class="token number">1</span>
scrapy runspider myspider.py <span class="token parameter variable">-a</span> <span class="token assign-left variable">slave_id</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre>
    <hr/>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/d544bc3780d54852adeffb8884a40927.webp#pic_center"/>
    </p>
    <h3>
     <a id="_126">
     </a>
     å®æˆ˜æ¡ˆä¾‹
    </h3>
    <h4>
     <a id="1_128">
     </a>
     æ¡ˆä¾‹1ï¼šæ”¿åºœå…¬å¼€æ•°æ®ç»“æ„åŒ–çˆ¬å–
    </h4>
    <p>
     <strong>
      ç›®æ ‡
     </strong>
     ï¼šçˆ¬å–å›½å®¶ç»Ÿè®¡å±€å­£åº¦GDPæ•°æ®
    </p>
    <pre><code class="prism language-python"><span class="token comment"># items.pyå®šä¹‰ç»“æ„</span>
<span class="token keyword">class</span> <span class="token class-name">GovDataItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    quarter <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    gdp <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    growth_rate <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># spiders/gov_spider.py</span>
<span class="token keyword">class</span> <span class="token class-name">GovSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'gov_spider'</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.stats.gov.cn/tjsj/zxfb/'</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'table.data-table tr'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> GovDataItem<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">'quarter'</span><span class="token punctuation">:</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'td[1]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'gdp'</span><span class="token punctuation">:</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'td[2]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'growth_rate'</span><span class="token punctuation">:</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'td[3]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      è¾“å‡ºç¤ºä¾‹
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span><span class="token string-property property">"quarter"</span><span class="token operator">:</span> <span class="token string">"2023-Q1"</span><span class="token punctuation">,</span> <span class="token string-property property">"gdp"</span><span class="token operator">:</span> <span class="token string">"284997"</span><span class="token punctuation">,</span> <span class="token string-property property">"growth_rate"</span><span class="token operator">:</span> <span class="token string">"4.5%"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span><span class="token string-property property">"quarter"</span><span class="token operator">:</span> <span class="token string">"2023-Q2"</span><span class="token punctuation">,</span> <span class="token string-property property">"gdp"</span><span class="token operator">:</span> <span class="token string">"308038"</span><span class="token punctuation">,</span> <span class="token string-property property">"growth_rate"</span><span class="token operator">:</span> <span class="token string">"6.3%"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h4>
     <a id="2API_162">
     </a>
     æ¡ˆä¾‹2ï¼šåŠ¨æ€APIé€†å‘å·¥ç¨‹
    </h4>
    <p>
     <strong>
      ç›®æ ‡
     </strong>
     ï¼šç ´è§£æŸç”µå•†å•†å“åˆ—è¡¨åŠ å¯†å‚æ•°
    </p>
    <pre><code class="prism language-python"><span class="token comment"># é€†å‘åˆ†æåŠ å¯†å‚æ•°</span>
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

<span class="token keyword">def</span> <span class="token function">get_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://api.example.com/init'</span><span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data-token'</span><span class="token punctuation">]</span>

<span class="token comment"># åœ¨Scrapyä¸­ä½¿ç”¨</span>
<span class="token keyword">class</span> <span class="token class-name">ApiSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        token <span class="token operator">=</span> get_token<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span>
            url<span class="token operator">=</span><span class="token string">"https://api.example.com/data"</span><span class="token punctuation">,</span>
            formdata<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'token'</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span> <span class="token string">'page'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_data
        <span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      å“åº”ç¤ºä¾‹
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"æ™ºèƒ½æ‰‹æœº"</span><span class="token punctuation">,</span> <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">2999</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1002</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"ç¬”è®°æœ¬ç”µè„‘"</span><span class="token punctuation">,</span> <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">8999</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_198">
     </a>
     æ‰©å±•æ€è€ƒ
    </h3>
    <h4>
     <a id="1__200">
     </a>
     1. æ³•å¾‹åˆè§„è®¾è®¡
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># robots.txtéµå®ˆä¸­é—´ä»¶</span>
<span class="token keyword">class</span> <span class="token class-name">RobotsTxtMiddleware</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> spider<span class="token punctuation">.</span>allowed_domains<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token comment"># æ ¡éªŒrobotsåè®®</span>
        rp <span class="token operator">=</span> RobotFileParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
        rp<span class="token punctuation">.</span>set_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>spider<span class="token punctuation">.</span>allowed_domains<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">/robots.txt"</span></span><span class="token punctuation">)</span>
        rp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> rp<span class="token punctuation">.</span>can_fetch<span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
            spider<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Blocked by robots.txt: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> dont_filter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token keyword">_</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="2__218">
     </a>
     2. åçˆ¬è™«å¯¹æŠ—æµ‹è¯•æ¡†æ¶
    </h4>
    <p>
     <strong>
      æµ‹è¯•æ–¹æ¡ˆ
     </strong>
     ï¼šæ¨¡æ‹ŸIPå°ç¦ã€éªŒè¯ç åœºæ™¯
    </p>
    <pre><code class="prism language-python"><span class="token comment"># ä½¿ç”¨Seleniumæµ‹è¯•åçˆ¬</span>
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://example.com/protected-page"</span><span class="token punctuation">)</span>

<span class="token comment"># æ£€æµ‹æ˜¯å¦å‡ºç°éªŒè¯ç </span>
<span class="token keyword">if</span> <span class="token string">"éªŒè¯ç "</span> <span class="token keyword">in</span> driver<span class="token punctuation">.</span>page_source<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"è§¦å‘éªŒè¯ç é˜²æŠ¤"</span><span class="token punctuation">)</span>
    <span class="token comment"># è°ƒç”¨ç¬¬ä¸‰æ–¹éªŒè¯ç è¯†åˆ«API</span>
    captcha <span class="token operator">=</span> solve_captcha<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"captcha-img"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"captcha-input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>captcha<span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_239">
     </a>
     æ€»ç»“
    </h3>
    <p>
     æœ¬æ–‡æ„å»ºäº†å®Œæ•´çš„ScrapyæŠ€æœ¯ä½“ç³»ï¼š
    </p>
    <ol>
     <li>
      <strong>
       ä¸­é—´ä»¶ç³»ç»Ÿ
      </strong>
      ï¼šå®ç°è¯·æ±‚æŒ‡çº¹ç®¡ç†ã€åŠ¨æ€æ¸²æŸ“ã€ä»£ç†åˆ‡æ¢
     </li>
     <li>
      <strong>
       å¢é‡æœºåˆ¶
      </strong>
      ï¼šé€šè¿‡Redis+BloomFilterå®ç°ç™¾äº¿çº§URLå»é‡
     </li>
     <li>
      <strong>
       åˆè§„è®¾è®¡
      </strong>
      ï¼šå†…ç½®robotsåè®®æ ¡éªŒä¸é€Ÿç‡é™åˆ¶
     </li>
     <li>
      <strong>
       åˆ†å¸ƒå¼æ‰©å±•
      </strong>
      ï¼šæ”¯æŒè·¨æœåŠ¡å™¨ååŒçˆ¬å–
     </li>
    </ol>
    <blockquote>
     <p>
      ğŸ“Œ å®æˆ˜å»ºè®®ï¼š
     </p>
     <ul>
      <li>
       ä¼˜å…ˆä½¿ç”¨
       <code>
        scrapy shell
       </code>
       è°ƒè¯•Selector
      </li>
      <li>
       åŠ¨æ€é¡µé¢ä¼˜å…ˆå°è¯•é€†å‘APIè€Œéç›´æ¥æ¸²æŸ“
      </li>
      <li>
       ä¼ä¸šçº§é¡¹ç›®å»ºè®®ç»“åˆScrapy-Redis+Gerapyåˆ†å¸ƒå¼éƒ¨ç½²
      </li>
     </ul>
    </blockquote>
    <hr/>
    <p>
     <strong>
      ç›¸å…³é˜…è¯»
     </strong>
     ï¼šNo19-æ—¶é—´åºåˆ—é¢„æµ‹ | No21-å¾®æœåŠ¡æ¶æ„è®¾è®¡
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7977656e6731382f:61727469636c652f64657461696c732f313436313635373339" class_="artid" style="display:none">
 </p>
</div>


