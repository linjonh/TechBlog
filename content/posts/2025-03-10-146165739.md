---
layout: post
title: "Python实战进阶No20-网络爬虫开发Scrapy框架详解"
date: 2025-03-10 22:31:06 +0800
description: "本文深入解析Scrapy核心架构，通过**中间件链式处理**、**布隆过滤器增量爬取**、**Splash动态渲染**、**分布式指纹策略**四大核心技术，结合政府数据爬取与动态API逆向工程实战案例，构建企业级爬虫系统。提供完整代码与运行结果，包含法律合规设计与反爬对抗方案。---Scrapy是适用于Python的一个快速、高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试。 "
keywords: "《Python实战进阶》No20: 网络爬虫开发：Scrapy框架详解"
categories: ['Python']
tags: ['爬虫', 'Scrapy', 'Python']
artid: "146165739"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146165739
    alt: "Python实战进阶No20-网络爬虫开发Scrapy框架详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146165739
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146165739
cover: https://bing.ee123.net/img/rand?artid=146165739
image: https://bing.ee123.net/img/rand?artid=146165739
img: https://bing.ee123.net/img/rand?artid=146165739
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     《Python实战进阶》No20: 网络爬虫开发：Scrapy框架详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="No20_Scrapy_0">
     </a>
     No20: 网络爬虫开发：Scrapy框架详解
    </h2>
    <h3>
     <a id="_2">
     </a>
     摘要
    </h3>
    <p>
     本文深入解析Scrapy核心架构，通过
     <strong>
      中间件链式处理
     </strong>
     、
     <strong>
      布隆过滤器增量爬取
     </strong>
     、
     <strong>
      Splash动态渲染
     </strong>
     、
     <strong>
      分布式指纹策略
     </strong>
     四大核心技术，结合政府数据爬取与动态API逆向工程实战案例，构建企业级爬虫系统。提供完整代码与运行结果，包含法律合规设计与反爬对抗方案。
    </p>
    <hr/>
    <p>
     Scrapy是适用于Python的一个快速、高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试。
     <br/>
     Scrapy吸引人的地方在于它是一个框架，任何人都可以根据需求方便的修改。它也提供了多种类型爬虫的基类，如BaseSpider、sitemap爬虫等，最新版本又提供了web2.0爬虫的支持。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/709e6cb1bd604ad89bad9a173e57e694.png#pic_center"/>
    </p>
    <h3>
     <a id="_11">
     </a>
     运行环境与依赖说明
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># 环境要求</span>
Python <span class="token number">3.8</span>+
Redis <span class="token number">6.0</span>+ <span class="token punctuation">(</span>分布式场景<span class="token punctuation">)</span>

<span class="token comment"># 依赖安装</span>
pip <span class="token function">install</span> <span class="token assign-left variable">scrapy</span><span class="token operator">==</span><span class="token number">2.8</span>.0 scrapy-splash<span class="token operator">==</span><span class="token number">0.9</span>.0 scrapy-redis<span class="token operator">==</span><span class="token number">0.7</span>.2
pip <span class="token function">install</span> <span class="token assign-left variable">redis</span><span class="token operator">==</span><span class="token number">4.5</span>.5 <span class="token assign-left variable">requests</span><span class="token operator">==</span><span class="token number">2.31</span>.0 <span class="token assign-left variable">beautifulsoup4</span><span class="token operator">==</span><span class="token number">4.12</span>.2
</code></pre>
    <hr/>
    <h3>
     <a id="_24">
     </a>
     核心概念与实战代码
    </h3>
    <h4>
     <a id="1__26">
     </a>
     1. 中间件链式处理机制
    </h4>
    <p>
     <strong>
      核心逻辑
     </strong>
     ：通过
     <code>
      process_request
     </code>
     和
     <code>
      process_response
     </code>
     实现请求/响应预处理
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 中间件实现示例：随机User-Agent</span>
<span class="token keyword">class</span> <span class="token class-name">RandomUserAgentMiddleware</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>user_agents <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"Mozilla/5.0 (Windows NT 10.0...)"</span><span class="token punctuation">,</span>
            <span class="token string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15...)"</span>
        <span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_agents<span class="token punctuation">)</span>
        spider<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using User-Agent: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'User-Agent'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># settings.py配置</span>
DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'myproject.middlewares.RandomUserAgentMiddleware'</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      输出日志
     </strong>
     ：
    </p>
    <pre><code>[scrapy.core.engine] INFO: Using User-Agent: Mozilla/5.0 (Windows NT 10.0...
</code></pre>
    <hr/>
    <h4>
     <a id="2__55">
     </a>
     2. 增量爬取与布隆过滤器
    </h4>
    <p>
     <strong>
      实现方案
     </strong>
     ：基于Scrapy-Redis的BloomFilter去重
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 布隆过滤器配置（settings.py）</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span>
DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">"scrapy_redis.dupefilter.BloomFilter"</span>
REDIS_URL <span class="token operator">=</span> <span class="token string">'redis://localhost:6379'</span>

<span class="token comment"># 启动爬虫（保留历史指纹）</span>
scrapy crawl gov_spider <span class="token operator">-</span>s SCHEDULER_PERSIST<span class="token operator">=</span><span class="token boolean">True</span>
</code></pre>
    <p>
     <strong>
      运行效果
     </strong>
     ：
    </p>
    <pre><code>[scrapy_redis.scheduler] INFO: Resuming crawl (5678 requests scheduled)
</code></pre>
    <hr/>
    <h4>
     <a id="3_Splash_75">
     </a>
     3. Splash渲染与自动代理池
    </h4>
    <p>
     <strong>
      动态页面处理
     </strong>
     ：集成Splash渲染JavaScript
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 使用SplashRequest爬取动态页面</span>
<span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy_splash <span class="token keyword">import</span> SplashRequest

<span class="token keyword">class</span> <span class="token class-name">DynamicSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'dynamic_spider'</span>
    
    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> SplashRequest<span class="token punctuation">(</span>
            url<span class="token operator">=</span><span class="token string">"https://example.com/ajax-page"</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">,</span>
            args<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'wait'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'content'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="dynamic-content"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      输出结果
     </strong>
     ：
    </p>
    <pre><code>{'content': '这是动态加载的内容'}
</code></pre>
    <hr/>
    <h4>
     <a id="4__106">
     </a>
     4. 分布式爬虫指纹策略
    </h4>
    <p>
     <strong>
      分布式架构
     </strong>
     ：通过Redis共享指纹和队列
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 分布式配置（settings.py）</span>
SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span>
SCHEDULER_QUEUE_CLASS <span class="token operator">=</span> <span class="token string">'scrapy_redis.queue.FifoQueue'</span>
REDIS_HOST <span class="token operator">=</span> <span class="token string">'192.168.1.100'</span>
</code></pre>
    <p>
     <strong>
      运行命令
     </strong>
     ：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 在多台机器上启动</span>
scrapy runspider myspider.py <span class="token parameter variable">-a</span> <span class="token assign-left variable">slave_id</span><span class="token operator">=</span><span class="token number">1</span>
scrapy runspider myspider.py <span class="token parameter variable">-a</span> <span class="token assign-left variable">slave_id</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre>
    <hr/>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d544bc3780d54852adeffb8884a40927.webp#pic_center"/>
    </p>
    <h3>
     <a id="_126">
     </a>
     实战案例
    </h3>
    <h4>
     <a id="1_128">
     </a>
     案例1：政府公开数据结构化爬取
    </h4>
    <p>
     <strong>
      目标
     </strong>
     ：爬取国家统计局季度GDP数据
    </p>
    <pre><code class="prism language-python"><span class="token comment"># items.py定义结构</span>
<span class="token keyword">class</span> <span class="token class-name">GovDataItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    quarter <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    gdp <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    growth_rate <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># spiders/gov_spider.py</span>
<span class="token keyword">class</span> <span class="token class-name">GovSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'gov_spider'</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://www.stats.gov.cn/tjsj/zxfb/'</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'table.data-table tr'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> GovDataItem<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">'quarter'</span><span class="token punctuation">:</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'td[1]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'gdp'</span><span class="token punctuation">:</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'td[2]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'growth_rate'</span><span class="token punctuation">:</span> row<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'td[3]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      输出示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span><span class="token string-property property">"quarter"</span><span class="token operator">:</span> <span class="token string">"2023-Q1"</span><span class="token punctuation">,</span> <span class="token string-property property">"gdp"</span><span class="token operator">:</span> <span class="token string">"284997"</span><span class="token punctuation">,</span> <span class="token string-property property">"growth_rate"</span><span class="token operator">:</span> <span class="token string">"4.5%"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span><span class="token string-property property">"quarter"</span><span class="token operator">:</span> <span class="token string">"2023-Q2"</span><span class="token punctuation">,</span> <span class="token string-property property">"gdp"</span><span class="token operator">:</span> <span class="token string">"308038"</span><span class="token punctuation">,</span> <span class="token string-property property">"growth_rate"</span><span class="token operator">:</span> <span class="token string">"6.3%"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h4>
     <a id="2API_162">
     </a>
     案例2：动态API逆向工程
    </h4>
    <p>
     <strong>
      目标
     </strong>
     ：破解某电商商品列表加密参数
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 逆向分析加密参数</span>
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

<span class="token keyword">def</span> <span class="token function">get_token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://api.example.com/init'</span><span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data-token'</span><span class="token punctuation">]</span>

<span class="token comment"># 在Scrapy中使用</span>
<span class="token keyword">class</span> <span class="token class-name">ApiSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        token <span class="token operator">=</span> get_token<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>FormRequest<span class="token punctuation">(</span>
            url<span class="token operator">=</span><span class="token string">"https://api.example.com/data"</span><span class="token punctuation">,</span>
            formdata<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'token'</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span> <span class="token string">'page'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_data
        <span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      响应示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"智能手机"</span><span class="token punctuation">,</span> <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">2999</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1002</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"笔记本电脑"</span><span class="token punctuation">,</span> <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">8999</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_198">
     </a>
     扩展思考
    </h3>
    <h4>
     <a id="1__200">
     </a>
     1. 法律合规设计
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># robots.txt遵守中间件</span>
<span class="token keyword">class</span> <span class="token class-name">RobotsTxtMiddleware</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> spider<span class="token punctuation">.</span>allowed_domains<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token comment"># 校验robots协议</span>
        rp <span class="token operator">=</span> RobotFileParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
        rp<span class="token punctuation">.</span>set_url<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>spider<span class="token punctuation">.</span>allowed_domains<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">/robots.txt"</span></span><span class="token punctuation">)</span>
        rp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> rp<span class="token punctuation">.</span>can_fetch<span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
            spider<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Blocked by robots.txt: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> dont_filter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token keyword">lambda</span> <span class="token keyword">_</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="2__218">
     </a>
     2. 反爬虫对抗测试框架
    </h4>
    <p>
     <strong>
      测试方案
     </strong>
     ：模拟IP封禁、验证码场景
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 使用Selenium测试反爬</span>
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://example.com/protected-page"</span><span class="token punctuation">)</span>

<span class="token comment"># 检测是否出现验证码</span>
<span class="token keyword">if</span> <span class="token string">"验证码"</span> <span class="token keyword">in</span> driver<span class="token punctuation">.</span>page_source<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"触发验证码防护"</span><span class="token punctuation">)</span>
    <span class="token comment"># 调用第三方验证码识别API</span>
    captcha <span class="token operator">=</span> solve_captcha<span class="token punctuation">(</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"captcha-img"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"captcha-input"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>captcha<span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_239">
     </a>
     总结
    </h3>
    <p>
     本文构建了完整的Scrapy技术体系：
    </p>
    <ol>
     <li>
      <strong>
       中间件系统
      </strong>
      ：实现请求指纹管理、动态渲染、代理切换
     </li>
     <li>
      <strong>
       增量机制
      </strong>
      ：通过Redis+BloomFilter实现百亿级URL去重
     </li>
     <li>
      <strong>
       合规设计
      </strong>
      ：内置robots协议校验与速率限制
     </li>
     <li>
      <strong>
       分布式扩展
      </strong>
      ：支持跨服务器协同爬取
     </li>
    </ol>
    <blockquote>
     <p>
      📌 实战建议：
     </p>
     <ul>
      <li>
       优先使用
       <code>
        scrapy shell
       </code>
       调试Selector
      </li>
      <li>
       动态页面优先尝试逆向API而非直接渲染
      </li>
      <li>
       企业级项目建议结合Scrapy-Redis+Gerapy分布式部署
      </li>
     </ul>
    </blockquote>
    <hr/>
    <p>
     <strong>
      相关阅读
     </strong>
     ：No19-时间序列预测 | No21-微服务架构设计
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7977656e6731382f:61727469636c652f64657461696c732f313436313635373339" class_="artid" style="display:none">
 </p>
</div>


