---
layout: post
title: "如何在Spring-Boot中校验用户上传的图片文件的两种方法"
date: 2025-03-11 12:40:06 +0800
description: "通过以上步骤，我们学习了如何在Spring Boot中校验用户上传的图片文件。我们探讨了使用@Valid和的简单校验方法，以及使用Apache Commons FileUpload进行更复杂的校验。校验用户上传的文件不仅提升了系统的稳定性，也保障了安全性。在实际项目中，灵活运用这些技巧将大大提高你的开发效率！快去实践一下吧！"
keywords: "如何在Spring Boot中校验用户上传的图片文件的两种方法"
categories: ['Java']
tags: ['后端', 'Spring', 'Java', 'Boot']
artid: "146175642"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146175642
    alt: "如何在Spring-Boot中校验用户上传的图片文件的两种方法"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146175642
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146175642
cover: https://bing.ee123.net/img/rand?artid=146175642
image: https://bing.ee123.net/img/rand?artid=146175642
img: https://bing.ee123.net/img/rand?artid=146175642
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     如何在Spring Boot中校验用户上传的图片文件的两种方法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在现代应用中，用户上传图片是一个常见的需求。无论是社交平台、电子商务网站还是任何需要用户交互的应用，图片上传功能都显得尤为重要。但合理地校验用户上传的图片文件是必不可少的步骤，避免不合规的文件影响系统的稳定性和安全性。本文将介绍在Spring Boot中校验用户上传的图片文件的两种方式，帮助你更好地实现这一功能。
    </p>
    <h4>
     <a id="Spring_Boot_4">
     </a>
     创建Spring Boot项目
    </h4>
    <p>
     在开始之前，首先需要创建一个Spring Boot项目。如果你使用的是Spring Initializr，可以选择“Spring Web”和“Spring Boot DevTools”依赖，方便开发和调试。使用IDE（如IntelliJ IDEA或Eclipse）创建项目后，可以在
     <code>
      pom.xml
     </code>
     文件中引入必要的依赖。
    </p>
    <h4>
     <a id="_8">
     </a>
     配置文件上传的基本设置
    </h4>
    <p>
     在
     <code>
      application.properties
     </code>
     文件中，可以设置文件上传的相关属性。例如，可以设置上传文件的大小限制：
    </p>
    <pre><code class="prism language-properties">spring.servlet.multipart.max-file-size=2MB
spring.servlet.multipart.max-request-size=2MB
</code></pre>
    <p>
     这些设置将限制用户上传的文件大小，避免过大的文件影响系统性能。
    </p>
    <h4>
     <a id="ValidMultipartFile_19">
     </a>
     使用
     <code>
      @Valid
     </code>
     和
     <code>
      @MultipartFile
     </code>
     进行文件校验
    </h4>
    <p>
     在Spring Boot中，可以使用
     <code>
      @Valid
     </code>
     和
     <code>
      @MultipartFile
     </code>
     注解来实现文件上传和校验。首先，需要创建一个简单的控制器来处理文件上传请求。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints<span class="token punctuation">.</span></span><span class="token class-name">NotNull</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploadController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 校验文件类型和大小</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isImage</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"文件类型不符合要求！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 处理文件保存逻辑</span>
        <span class="token keyword">return</span> <span class="token string">"文件上传成功！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isImage</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> contentType <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> contentType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"image/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这个控制器中，定义了一个
     <code>
      uploadFile
     </code>
     方法来处理上传的文件。通过
     <code>
      @RequestParam
     </code>
     注解获取文件，并使用
     <code>
      @NotNull
     </code>
     确保用户上传的文件不为null。接着，调用
     <code>
      isImage
     </code>
     方法来校验文件类型，如果不是图片类型，就返回错误信息。
    </p>
    <h4>
     <a id="Apache_Commons_FileUpload_52">
     </a>
     使用Apache Commons FileUpload进行更复杂的校验
    </h4>
    <p>
     对于更复杂的文件校验需求，可以使用Apache Commons FileUpload库。它提供了更多的功能，能够处理文件上传的细节。在项目中添加Apache Commons FileUpload的依赖：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     然后，可以创建一个新的控制器来处理文件上传：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span></span><span class="token class-name">FileItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>disk<span class="token punctuation">.</span></span><span class="token class-name">DiskFileItemFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletFileUpload</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUploadCommonsController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ServletFileUpload</span><span class="token punctuation">.</span><span class="token function">isMultipartContent</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"请求类型不正确！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileItem</span><span class="token punctuation">&gt;</span></span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletFileUpload</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DiskFileItemFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileItem</span> item <span class="token operator">:</span> items<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">isFormField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 校验文件类型</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isImage</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token string">"文件类型不符合要求！"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// 处理文件保存逻辑</span>
                    <span class="token comment">// item.write(new File("path/to/save/" + item.getName()));</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token string">"文件上传成功！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">"文件上传失败！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> contentType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> contentType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"image/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这个控制器中，
     <code>
      uploadFile
     </code>
     方法使用Apache Commons FileUpload库来处理文件上传。通过
     <code>
      ServletFileUpload
     </code>
     类，我们可以解析请求并获取文件项。然后，遍历文件项并校验文件类型和大小。
    </p>
    <h4>
     <a id="_112">
     </a>
     添加更多校验逻辑
    </h4>
    <p>
     在实际应用中，可能还需要添加更多的校验逻辑，比如文件大小、文件名的合法性等。可以在
     <code>
      isImage
     </code>
     方法中进行扩展，以满足项目需求。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> contentType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> contentType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"image/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isValidFileName</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> fileName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>fileName<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fileName<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">"^[a-zA-Z0-9_.-]+$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在这个方法中，
     <code>
      isValidFileName
     </code>
     用来校验文件名，确保文件名不包含非法字符。
    </p>
    <h4>
     <a id="_128">
     </a>
     处理上传的文件
    </h4>
    <p>
     一旦校验通过，就可以处理上传的文件。可以将其保存到本地文件系统、云存储或其他存储服务中。以下是一个简单的保存逻辑示例：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">File</span> uploadDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"uploads"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>uploadDir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    uploadDir<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
item<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>uploadDir<span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     这段代码会将文件保存到项目的
     <code>
      uploads
     </code>
     文件夹中。
    </p>
    <h4>
     <a id="_142">
     </a>
     测试文件上传功能
    </h4>
    <p>
     完成以上步骤后，可以使用Postman或其他工具测试文件上传功能。确保发送一个包含图片文件的POST请求到
     <code>
      http://localhost:8080/upload
     </code>
     ，并检查返回的响应信息是否符合预期。
    </p>
    <h4>
     <a id="_146">
     </a>
     记录日志和异常处理
    </h4>
    <p>
     在实际开发中，记录日志和处理异常是非常重要的。可以使用SLF4J与Logback日志库，在文件上传的关键步骤中添加日志信息，方便后续的调试和排查问题。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">FileUploadController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"开始上传文件: {}"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_159">
     </a>
     总结
    </h4>
    <p>
     通过以上步骤，我们学习了如何在Spring Boot中校验用户上传的图片文件。我们探讨了使用
     <code>
      @Valid
     </code>
     和
     <code>
      @MultipartFile
     </code>
     的简单校验方法，以及使用Apache Commons FileUpload进行更复杂的校验。校验用户上传的文件不仅提升了系统的稳定性，也保障了安全性。在实际项目中，灵活运用这些技巧将大大提高你的开发效率！快去实践一下吧！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f71715f3532303136313735372f:61727469636c652f64657461696c732f313436313735363432" class_="artid" style="display:none">
 </p>
</div>


