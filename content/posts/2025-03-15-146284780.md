---
layout: post
title: "react加antd封装表格单多选组件,支持跨页选择缓存"
date: 2025-03-15 20:21:42 +0800
description: "【代码】react加antd封装表格单、多选组件，支持跨页选择缓存。"
keywords: "react加antd封装表格单、多选组件，支持跨页选择缓存"
categories: ['未分类']
tags: ['缓存', 'React', 'Javascript']
artid: "146284780"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146284780
    alt: "react加antd封装表格单多选组件,支持跨页选择缓存"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146284780
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146284780
cover: https://bing.ee123.net/img/rand?artid=146284780
image: https://bing.ee123.net/img/rand?artid=146284780
img: https://bing.ee123.net/img/rand?artid=146284780
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     react加antd封装表格单、多选组件，支持跨页选择缓存
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     页面效果
    </p>
    <p>
     <img alt="" height="846" src="https://i-blog.csdnimg.cn/direct/23072fab6e6142189746d7140d0ed01a.png" width="1078"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     子组件
    </p>
    <pre><code class="hljs">import React, { useState, useEffect, forwardRef, useImperativeHandle } from 'react';
import { Modal, Input, Table, Pagination, Avatar, Select } from 'antd';
import { UserOutlined } from '@ant-design/icons';
import type { TableProps, PaginationProps } from 'antd';

// 用户接口
interface User {
    id: string;
    name: string;
    avatar: string;
}


// 组件属性接口
interface UserSelectorProps&lt;T&gt; {
    open: boolean;
    mode: 'single' | 'multiple';
    dataSource: T[];
    total: number;
    onCancel: () =&gt; void;
    onOk: (selectedItems: T[]) =&gt; void;
    onSearch: (searchText: string) =&gt; void;
    onPageChange: (page: number, pageSize: number) =&gt; void;
}

// 暴露给父组件的接口
export interface UserSelectorRef&lt;T&gt; {
    setSelectedItems: (items: T[]) =&gt; void;
}

// 主函数
const UserSelector = forwardRef&lt;UserSelectorRef&lt;User&gt;, UserSelectorProps&lt;User&gt;&gt;(
    (
        {
            open,
            onCancel,
            onOk,
            mode,
            dataSource,
            total,
            onSearch,
            onPageChange,
        },
        ref,
    ) =&gt; {
         当前选中项
        const [selectedItems, setSelectedItems] = useState&lt;User[]&gt;([]);

        // 暴露方法给父组件
        useImperativeHandle(ref, () =&gt; ({
            setSelectedItems: (items: User[]) =&gt; {
                setSelectedItems(items);
            },
        }));

        / 搜索框
        const [searchText, setSearchText] = useState('');

        // 处理搜索框变化
        const handleSearch = (value: string) =&gt; {
            setSearchText(value);
            onSearch(value);
        };

         对话框关闭时重置选中和搜索框
        useEffect(() =&gt; {
            if (!open) {
                setSelectedItems([]);
                setSearchText('');
            }
        }, [open]);


         分页
        const [currentPage, setCurrentPage] = useState(1);
        const [pageSize, setPageSize] = useState(5);

        // 分页改变
        const handlePageChange: PaginationProps['onChange'] = (page, pageSize) =&gt; {
            setCurrentPage(page);
            setPageSize(pageSize);
            onPageChange(page, pageSize);
        };

        / 表格
        // 列配置对象
        const columns: TableProps&lt;User&gt;['columns'] = [
            {
                key: 'avatar',
                render: (_, record) =&gt; (
                    &lt;div style={<!-- -->{ display: 'flex', alignItems: 'center' }}&gt;
                        {record.avatar ? (&lt;Avatar
                            src={record.avatar}
                        /&gt;) : (&lt;Avatar
                            icon={&lt;UserOutlined /&gt;} // 如果头像为空，显示默认图标
                        /&gt;)}


                        &lt;span style={<!-- -->{ marginLeft: 8 }}&gt;{record.name}&lt;/span&gt;
                    &lt;/div&gt;
                ),
            },
        ];

        // 表格行点击事件
        const handleRowClick = (record: User) =&gt; {
            if (mode === 'single') {
                onOk([record]);
                onCancel()
            } else {
                // 判断该行是否已经选择
                const isSelected = selectedItems.some(item =&gt; item.id === record.id);
                if (isSelected) {
                    // 已选择，进行删除操作
                    setSelectedItems(selectedItems.filter(item =&gt; item.id !== record.id));
                } else {
                    // 未选择，进行添加
                    setSelectedItems([...selectedItems, record]);
                }
            }
        };

        // 表格全选，全取消
        const handleSelectAll = (selected: boolean) =&gt; {
            if (selected) {
                // 全选时，将当前页未选择的用户追加到已选用户列表
                const newSelectedItems = [
                    ...selectedItems,
                    ...dataSource.filter(
                        item =&gt; !selectedItems.some(selectedItem =&gt; selectedItem.id === item.id),
                    ),
                ];
                setSelectedItems(newSelectedItems);
            } else {
                // 取消全选时，移除当前页的用户
                const newSelectedItems = selectedItems.filter(
                    item =&gt; !dataSource.some(row =&gt; row.id === item.id),
                );
                setSelectedItems(newSelectedItems);
            }
        };

         多选框

        // 监听多选框的改变
        const handleSelectChange = (values: string[]) =&gt; {
            const newSelectedItems = selectedItems.filter(item =&gt; values.includes(item.id));
            setSelectedItems(newSelectedItems);
        };

        return (
            &lt;Modal
                title="Select"
                open={open}
                onCancel={onCancel}
                onOk={() =&gt; onOk(selectedItems)}
                width={600}
            &gt;
                &lt;Input.Search
                    size="large"
                    allowClear
                    placeholder="search"
                    value={searchText}
                    onChange={e =&gt; handleSearch(e.target.value)}
                    style={<!-- -->{ marginBottom: 16 }}
                /&gt;
                {mode === 'multiple' &amp;&amp; (
                    &lt;div style={<!-- -->{ display: 'flex', alignItems: 'center', marginBottom: 16 }}&gt;
                        &lt;Select
                            size="large"
                            mode="multiple"
                            allowClear
                            value={selectedItems.map(item =&gt; item.id)}
                            onChange={handleSelectChange}
                            style={<!-- -->{ width: '100%' }}
                            placeholder="select"
                            optionLabelProp="label"
                            options={selectedItems.map(item =&gt; ({
                                value: item.id,
                                label: (
                                    &lt;div style={<!-- -->{ display: 'flex', alignItems: 'center', }}&gt;
                                        {item.avatar ? (&lt;Avatar
                                            src={item.avatar}
                                        /&gt;) : (&lt;Avatar
                                            icon={&lt;UserOutlined /&gt;} // 如果头像为空，显示默认图标
                                        /&gt;)}
                                        {item.name}
                                    &lt;/div&gt;
                                ),
                            }))}
                        /&gt;
                    &lt;/div&gt;
                )}
                &lt;Table
                    dataSource={dataSource}
                    columns={columns}
                    rowKey="id"
                    pagination={false}
                    onRow={record =&gt; ({
                        onClick: () =&gt; handleRowClick(record),
                    })}
                    rowSelection={
                        mode === 'multiple'
                            ? {
                                selectedRowKeys: selectedItems.map(item =&gt; item.id),
                                onSelect: (record, selected, selectedRows, nativeEvent) =&gt; {
                                    handleRowClick(record)
                                },
                                onSelectAll: (selected, selectedRows, changeRows) =&gt; {
                                    handleSelectAll(selected);
                                },
                            }
                            : undefined
                    }
                /&gt;
                &lt;Pagination
                    {
                    ...{
                        pageSize: pageSize,
                        current: currentPage,
                        showTotal: (total, range) =&gt; `${range[0]}-${range[1]} of ${total} items`,
                        showSizeChanger: true,
                        pageSizeOptions: ['5', '10', '20', '30'],
                        onChange: handlePageChange,
                        total: total
                    }
                    }

                    style={<!-- -->{ marginTop: 16 }}
                /&gt;
            &lt;/Modal&gt;
        );
    },
);

export default UserSelector;</code></pre>
    <p>
     父组件
    </p>
    <pre><code class="hljs">import React, { useState, useRef } from 'react';
import UserSelector, { UserSelectorRef } from './UserSelector2';
import { Button, Avatar } from 'antd';

interface User {
  id: string;
  name: string;
  avatar: string;
}


const App: React.FC = () =&gt; {
  const [open, setOpen] = useState(false);
  const [selectedUsers, setSelectedUsers] = useState&lt;User[]&gt;([]);
  const userSelectorRef = useRef&lt;UserSelectorRef&lt;User&gt;&gt;(null);

  const [mockUsers, setMockUsers] = useState&lt;User[]&gt;([
    { id: '1', name: '用户1', avatar: '1' },
    { id: '2', name: '用户2', avatar: 'https://example.com/avatar2.png' },
    { id: '3', name: '用户3', avatar: '1' },
    { id: '4', name: '用户4', avatar: 'https://example.com/avatar2.png' },
    { id: '5', name: '用户5', avatar: '' },
  ]);

  const handleSearch = (searchText: string) =&gt; {
    console.log('Search:', searchText);
  };

  const handlePageChange = (page: number, pageSize: number) =&gt; {

    if (page === 1) {
      setMockUsers([
        { id: '1', name: '用户1', avatar: '1' },
        { id: '2', name: '用户2', avatar: 'https://example.com/avatar2.png' },
        { id: '3', name: '用户3', avatar: '1' },
        { id: '4', name: '用户4', avatar: 'https://example.com/avatar2.png' },
        { id: '5', name: '用户5', avatar: '1' },
      ])
    } else {
      setMockUsers([
        { id: '6', name: '用户6', avatar: 'https://example.com/avatar2.png' },
        { id: '7', name: '用户7', avatar: '1' },
        { id: '8', name: '用户8', avatar: 'https://example.com/avatar2.png' },
        { id: '9', name: '用户9', avatar: '1' },
        { id: '10', name: '用户10', avatar: 'https://example.com/avatar2.png' },
      ])
    }
  };

  const handleSetSelectedUsers = () =&gt; {
    // 父组件调用子组件的方法，设置选中用户
    if (userSelectorRef.current) {
      userSelectorRef.current.setSelectedItems([
        { id: '1', name: '用户1', avatar: 'https://example.com/avatar1.png' },
      ]);
    }
  };

  return (
    &lt;div&gt;
      &lt;Button type="primary" onClick={() =&gt; setOpen(true)} style={<!-- -->{ marginRight: 8 }}&gt;
        选择用户
      &lt;/Button&gt;
      &lt;Button onClick={handleSetSelectedUsers}&gt;设置选中用户&lt;/Button&gt;
      &lt;UserSelector
        ref={userSelectorRef}
        open={open} // 使用 open 替代 visible
        onCancel={() =&gt; setOpen(false)}
        onOk={setSelectedUsers}
        mode="multiple"
        dataSource={mockUsers}
        total={10}
        onSearch={handleSearch}
        onPageChange={handlePageChange}
      /&gt;
      &lt;div&gt;
        &lt;h3&gt;已选用户:&lt;/h3&gt;
        {selectedUsers.map(user =&gt; (
          &lt;div key={user.id}&gt;
            &lt;Avatar src={user.avatar} /&gt;
            &lt;span&gt;{user.name}&lt;/span&gt;
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default App;</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6831383337373532383338362f:61727469636c652f64657461696c732f313436323834373830" class_="artid" style="display:none">
 </p>
</div>


