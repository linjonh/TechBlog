---
layout: post
title: å‰ç«¯é¡¹ç›®ä¸­çš„CICDå®è·µè‡ªåŠ¨åŒ–éƒ¨ç½²
date: 2022-04-15 14:48:29 +08:00
categories: ['è‡ªåŠ¨åŒ–']
tags: ['è‡ªåŠ¨åŒ–', 'å‰ç«¯', 'Jenkins', 'Github']
image:
    path: https://img-blog.csdnimg.cn/img_convert/06457dfce1e40dddc04ec31910574e3c.png?x-oss-process=image/resize,m_fixed,h_150
    alt: å‰ç«¯é¡¹ç›®ä¸­çš„CICDå®è·µè‡ªåŠ¨åŒ–éƒ¨ç½²
artid: 124194274
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=124194274
featuredImagePreview: https://bing.ee123.net/img/rand?artid=124194274
---

# å‰ç«¯é¡¹ç›®ä¸­çš„CI/CDå®è·µï¼ˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰

### å‰è¨€

#### å‰ç½®çŸ¥è¯†

* Linux
* Docker
* Nginx
* Github

#### å¯ä»¥å¹²å˜›

ä½œä¸ºä¸€å¥—é¢å‘å¼€å‘å’Œè¿ç»´å›¢é˜Ÿçš„è§£å†³æ–¹æ¡ˆï¼ŒCI/CD ä¸»è¦è§£å†³é›†æˆæ–°ä»£ç å’Œå‘ç”¨æˆ·é¢‘ç¹äº¤ä»˜åº”ç”¨çš„é—®é¢˜ã€‚

æ›´ç›´æ¥åœ°è¯´ï¼Œå°±æ˜¯å¯ä»¥è§£æ”¾å¼€å‘äººå‘˜çš„åŒæ‰‹ï¼Œå°†æ—¶é—´å’Œç²¾åŠ›ä¸“æ³¨äºä»£ç æœ¬èº«ã€‚

### CI/CDæ˜¯ä»€ä¹ˆ

**CI/CD**
ï¼ˆContinuous Intergration/Continuous Delpoyï¼‰ï¼Œ
**æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²**
ï¼Œæˆ–è€…
**æŒç»­é›†æˆ/æŒç»­äº¤ä»˜**
ï¼ˆContinuous Deliveryï¼‰ï¼Œæ˜¯ä¸€ç§åœ¨
**å¼€å‘é˜¶æ®µ**
å¼•å…¥
**è‡ªåŠ¨åŒ–**
æ¥é¢‘ç¹äº¤ä»˜åº”ç”¨çš„æ–¹æ³•ã€‚ä»å‰ç«¯çš„è§’åº¦çœ‹ï¼ŒCICDçš„æµç¨‹ä¸­æ¶‰åŠï¼š

* CIï¼šä»£ç 
  **push**
  åˆ°æ‰˜ç®¡å¹³å°ä¹‹åçš„
  **lintæµ‹è¯•**
  ã€
  **å•å…ƒæµ‹è¯•**
* CDï¼šå°†
  **build**
  åçš„é¡¹ç›®ä¸¢åˆ°è¿œç«¯
  **Nginx**
  çš„é™æ€èµ„æºç›®å½•ä¸‹

#### æ„å»º/éƒ¨ç½²

å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ä¸­ï¼Œå‰ç«¯é¡¹ç›®ç»å¸¸ä¼šä½¿ç”¨æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œç»ç”±
**Webpack**
ï¼ˆæˆ–è€…å…¶ä»–æ„å»ºå·¥å…·ï¼‰ æ‰“åŒ…åçš„SPAåº”ç”¨ï¼ˆä»£ç ï¼‰ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯é™æ€èµ„æºï¼Œåªéœ€è¦æŠŠå®ƒä»¬éƒ½æ”¾åˆ°
**Nginx**
çš„é™æ€èµ„æºç›®å½•ä¸‹ï¼Œé…å¥½ç›¸å…³çš„è·¯å¾„ï¼Œå³å¯å®Œæˆéƒ¨ç½²ã€‚

å‰ç«¯é¡¹ç›®çš„æ„å»ºã€éƒ¨ç½²ã€ä¸Šçº¿æµç¨‹ï¼Œä»
**ç®€é™‹ç–æ•£**
åˆ°
**å®Œå–„ä¸¥è°¨**
ï¼Œå¤§è‡´ç»å†äº†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š

#### æ‰‹åŠ¨æŒ¡

æœ¬åœ°buildé¡¹ç›®








sftpä¸Šä¼ è¿œç¨‹æœåŠ¡å™¨








é…ç½®nginxè®¿é—®è·¯å¾„

1. æœ¬åœ°æ‰§è¡Œ
   `yarn build`
   æ„å»ºé¡¹ç›®
2. ä½¿ç”¨
   **transmit**
   æˆ–å…¶ä»–æ”¯æŒ
   **sftp**
   çš„è½¯ä»¶ä¸Šä¼ æ‰“åŒ…åçš„é¡¹ç›®ï¼ˆå½“ç„¶ä¹Ÿæœ‰å…¶ä»–æ–¹å¼ï¼‰
3. ä¿®æ”¹ Nginx çš„
   **nginx.conf**
   æ–‡ä»¶ï¼Œé…ç½®é¡¹ç›®çš„è®¿é—®è·¯å¾„

æ‰‹åŠ¨éƒ¨ç½²æ“ä½œèµ·æ¥å¾ˆç®€å•ï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¯æ¬¡æ„å»ºå®Œéƒ½è¦äººä¸ºåœ°è¿›è¡Œéƒ¨ç½²çš„åŠ¨ä½œï¼Œä¸€æ–¹é¢å‡å°‘äº†å®é™…æ•²ä»£ç çš„æ—¶é—´ï¼Œå¦ä¸€æ–¹é¢ï¼Œäººå·¥æ“ä½œå…ä¸äº†ä¼šæœ‰ç–å¿½å‡ºé”™çš„æ—¶å€™ã€‚

#### è‡ªåŠ¨æŒ¡

éšç€
**å·¥ç¨‹åŒ–**
çš„å‘å±•å’Œ
**å·¥å…·é“¾**
çš„æˆç†Ÿï¼Œé¡¹ç›®éƒ¨ç½²ä¸å†åƒä»¥å‰ç®€å•ç²—æš´ã€‚å‰ç«¯ä»£ç çš„
**å¥å£®æ€§**
ã€
**å¯é æ€§**
è¶Šæ¥è¶Šè¢«é‡è§†ï¼Œé¡¹ç›®å‘å¸ƒå‰å¾€å¾€éœ€è¦
**ä»£ç çº¦æŸ**
å’Œ
**ä»£ç æµ‹è¯•**
ï¼Œæ ¡éªŒé€šè¿‡åæœåŠ¡å™¨æ‹‰å–æœ€æ–°çš„ä»£ç ï¼Œè¿›è¡Œ build å’Œ nginx é…ç½®åæ‰ç®—å®Œæˆæ•´ä¸ªéƒ¨ç½²çš„è¿‡ç¨‹ã€‚

lintæ ¡éªŒ








å•å…ƒæµ‹è¯•








pushè¿œç«¯ä»“åº“








æœåŠ¡å™¨æ‹‰å–æœ€æ–°ä»£ç 








buildæ„å»ºé¡¹ç›®








é…ç½®nginx

1. ä»£ç æ‰«æ
   `yarn lint`
   æ£€æŸ¥ä»£ç æ˜¯å¦è§„èŒƒ
2. `yarn unit`
   è¿›è¡Œå•å…ƒæµ‹è¯•
3. `git push`
   æäº¤æ›´æ”¹åˆ°è¿œç«¯ä»“åº“
4. ç™»å½•æœåŠ¡å™¨ï¼Œ
   `git pull`
   æ‹‰å–æœ€æ–°ä»£ç 
5. `yarn build`
   æ„å»ºé¡¹ç›®
6. é…ç½® nginx è®¿é—®è·¯å¾„

è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œèƒ½å¤Ÿå‡å°‘ä»£ç ä¸è§„èŒƒæˆ–éšè—bugçš„é—®é¢˜ã€‚ä½†æ‰€æœ‰çš„æ“ä½œè¿˜æ˜¯å¾—ä¸€è¡Œä¸€è¡Œå‘½ä»¤å»æ•²ï¼Œé¡¹ç›®çœŸæ­£çš„éƒ¨ç½²ä¹Ÿè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å»æ“ä½œæœåŠ¡å™¨ã€‚

> å…¶å®å®Œå…¨å¯ä»¥å°†ä¸Šé¢çš„æ“ä½œç»†èŠ‚éƒ½é›†æˆåˆ°ä¸€ä¸ª shell è„šæœ¬é‡Œï¼Œé€šçŸ¥æ‰§è¡Œ shell ä¹Ÿèƒ½å‡å°‘å¾ˆå¤šé‡å¤çš„å·¥ä½œã€‚

#### CI/CD

ä¸Šé¢æåˆ°ï¼Œå€ŸåŠ©
**shell**
ä¹Ÿèƒ½ä½¿å¾—ä¸€éƒ¨åˆ†æ“ä½œè‡ªåŠ¨åŒ–ï¼Œä½†æ— è®ºæ˜¯ä»£ç æ‰«æã€å•å…ƒæµ‹è¯•è¿˜æ˜¯é¡¹ç›®çš„æ„å»ºï¼Œéƒ½è¿˜æ˜¯åœ¨æœ¬åœ°çš„å¼€å‘æœºä¸Šè¿›è¡Œï¼ˆæˆ–è€…è¯´è·Ÿå¼€å‘å¼ºè€¦åˆï¼‰ï¼Œæœ‰æ²¡æœ‰åŠæ³•å°†è¿™äº›é™„å±çš„æ“ä½œæŠ½ç¦»å‡ºæ¥ï¼Œæ”¾åˆ°å¦å¤–çš„ä¸“æœ‰ç¯å¢ƒä¸‹è¿›è¡Œå‘¢ï¼Ÿ

ç°åœ¨å¾ˆæµè¡Œçš„
**DevOps**
ç†å¿µä¸­ï¼Œ
**CI/CD**
çš„é‚£ä¸€ç¯å°±èƒ½å¾ˆå¥½åœ°å®ç°ã€‚

![](https://i-blog.csdnimg.cn/blog_migrate/6ef1f524357ea981a4a31d110f4d2496.png)

> DevOpsæ˜¯ä¸€ç§æ€æƒ³ç†å¿µï¼Œå¼ºè°ƒè½¯ä»¶å¼€å‘æµ‹è¯•è¿ç»´çš„ä¸€ä½“åŒ–ï¼Œç›®æ ‡æ˜¯å‡å°‘å„ä¸ªéƒ¨é—¨ä¹‹é—´çš„æ²Ÿé€šæˆæœ¬ï¼Œä»è€Œå®ç°è½¯ä»¶çš„å¿«é€Ÿé«˜è´¨é‡çš„å‘å¸ƒã€‚CI/CDæ˜¯ä¸€å¥—å®è·µæ–¹æ¡ˆï¼Œå®ç°è½¯ä»¶çš„æ„å»ºæµ‹è¯•éƒ¨ç½²çš„è‡ªåŠ¨åŒ–ã€‚

### CI/CDå®è·µ â€”â€” å‰ç«¯é¡¹ç›®è‡ªåŠ¨åŒ–éƒ¨ç½²

#### æµç¨‹æ¶æ„

##### æƒ³è¦è¾¾åˆ°çš„æ•ˆæœ

è¿œç¨‹ä¸»åˆ†æ”¯ä»£ç å‘ç”Ÿæ”¹å˜ï¼Œæ‹‰å–ä¸»åˆ†æ”¯ä»£ç è¿›è¡Œæ„å»ºï¼Œå®Œæˆåé€šè¿‡ ssh ä¸Šä¼ åˆ°æµ‹è¯•/ç”Ÿäº§æœåŠ¡å™¨ã€‚

##### Github + Jenkins çš„å®ç°é“¾è·¯

VSCode








Github








Jenkins








æœåŠ¡å™¨








æµè§ˆå™¨



























æäº¤ä»£ç 



åˆå¹¶åˆ°master



é€šçŸ¥







æ‰§è¡Œä»»åŠ¡









æ‹‰å–ä»£ç 





æ„å»ºé¡¹ç›®



æ¨é€åˆ°æœåŠ¡å™¨







é…ç½®nginxè®¿é—®è·¯å¾„

è®¿é—®é¡¹ç›®éƒ¨ç½²åœ°å€







VSCode





Github





Jenkins





æœåŠ¡å™¨





æµè§ˆå™¨

å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²

##### Github Actions çš„å®ç°é“¾è·¯

VSCode








Github








æœåŠ¡å™¨








æµè§ˆå™¨



























æäº¤ä»£ç 



åˆå¹¶åˆ°master



è§¦å‘é’©å­







æ‰§è¡Œ build ä»»åŠ¡

æ¨é€åˆ°æœåŠ¡å™¨







é…ç½®nginxè®¿é—®è·¯å¾„

è®¿é—®é¡¹ç›®éƒ¨ç½²åœ°å€







VSCode





Github





æœåŠ¡å™¨





æµè§ˆå™¨

å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²

#### æ­å»ºè¿‡ç¨‹

##### Github + Jenkins

###### dockerç¯å¢ƒçš„æ­å»º

1. å®‰è£… docker

   ```shell
   # å®‰è£… docker çš„ä¾èµ–åº“ï¼Œ-y é€‰é¡¹è¡¨ç¤ºæ‰€æœ‰çš„ Is this OK[y/d/N]ï¼Œéƒ½ä¼šè‡ªåŠ¨é€‰æ‹©y
   yum install -y yum-utils 

   # æ·»åŠ  docker cd è½¯ä»¶æºä¿¡æ¯
   sudo yum-config-manager --add-repo \ https://download.docker.com/linux/centos/docker-ce.repo

   # å®‰è£… docker 
   sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

   ```
2. å¯åŠ¨ docker

   ```bash
   sudo systemctl enable docker # è®¾ç½®å¼€æœºè‡ªå¯
   sudo systemctl start docker /#  å¯åŠ¨docker

   ```

> [docker centos å®‰è£…æŒ‡å—](https://docs.docker.com/engine/install/centos/)

###### å®‰è£…docker-compose

docker-compose ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ docker åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨
**yml**
æ–‡ä»¶é…ç½®åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æœåŠ¡ã€‚

1. å®‰è£… docker-compose

   ```bash
   sudo curl -L "https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

   ```
2. æå‡æƒé™

   ```bash
   sudo chmod +x /usr/local/bin/docker-compos

   ```

> [docker-compose å®‰è£…æŒ‡å—](https://docs.docker.com/compose/install/)

###### åˆ›å»º docker-compose åº”ç”¨

è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œ nginx é€šè¿‡å®¹å™¨çš„æ–¹å¼å»å¯åŠ¨ï¼ˆä¸ä¼šå½±å“åˆ°æˆ‘ç›®å‰çš„ nginx ï¼‰ï¼Œjenkins å°±è¿˜æ˜¯æ”¾åœ¨æ ¹é¡¹ç›®éƒ¨ç½²çš„æœåŠ¡å™¨ä¸Šï¼ˆæ–¹ä¾¿åç»­ç›´æ¥é€šè¿‡ shell å¤åˆ¶æ„å»ºå¥½çš„é¡¹ç›®ï¼‰

ï¼ˆæ‹‰å–nginxé•œåƒï¼Œç¼–å†™ç›®å½•æ•°æ®å·æ˜ å°„ï¼‰

1. æ‹‰å–
   **nginx**
   é•œåƒ

   ```shell
   docker pull nginx

   docker images # æŸ¥çœ‹å®‰è£…çš„é•œåƒ

   ```
2. åˆ›å»ºæ•°æ®å·ç›®å½•ï¼Œä»¥ä¾¿æŒ‚è½½åˆ°å®¹å™¨é‡Œ

   ```bash
   + compose # docker-compose é…ç½®ç›®å½•
   	- docker-compose.yml 
   + nginx  		
    	+ conf	# nginx é…ç½®
    		- nginx.conf
    	+ html	# nginx é™æ€èµ„æº
     	- index.html

   ```
3. ç¼–å†™
   **docker-compose.yml**

   ```bash
   version: '3'
   services:                                            
     cicd_nginx:
       restart: always
       image: nginx
       container_name: nginx
       ports:
         - 3300:80
         - 3301:433
       volumes:
         - ../nginx/html:/usr/share/nginx/html
         - ../nginx/conf/nginx.conf:/etc/nginx/nginx.conf
         - ../nginx/log:/var/log/nginx
         - ../nginx/localtime:/etc/localtime:ro

   ```
4. å¯åŠ¨

   ```bash
   docker-compose up -d
   docker-compose stop //åœæ­¢nginxå’Œjenkins

   ```
5. å…¬ç½‘æŸ¥çœ‹ nginx

![image-20220122154400721](https://i-blog.csdnimg.cn/blog_migrate/3a5439ebce3337a526adea6a52f789f7.png)

![image-20220122154557051](https://i-blog.csdnimg.cn/blog_migrate/07a9fbd8e2c631bc0cca4e449c1ff09b.png)

###### JenkinsåŸºæœ¬é…ç½®

1. å‰å¾€ jenkins å®¹å™¨æŒ‚è½½çš„æ•°æ®å·ä¸­è·å¾—åˆå§‹å¯†ç 

   ```bash
   cat /home/cicd_demo/jenkins/jenkins_home/secrets/initialAdminPassword 

   ```

   > è¿™ä¸ªå¯†ç åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œä¹‹åå¦‚æœå¿˜è®°å¯†ç éœ€è¦é‡ç½®
2. è¾“å…¥å¯†ç è¿›å…¥é¡µé¢ä¹‹åï¼Œé€‰æ‹©æ¨èå®‰è£…

   ![image-20220122155307819](https://i-blog.csdnimg.cn/blog_migrate/2d9ea2a603f7171c6d63434980038efe.png)

   å¯ä»¥çœ‹åˆ°ï¼Œjenkins ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®‰è£…å¾ˆå¤šæ’ä»¶ï¼Œæ¯”å¦‚æœ€å¸¸ç”¨çš„
   **git**

   ![image-20220122155629224](https://i-blog.csdnimg.cn/blog_migrate/bb3214f2904b350d911e5a8cdf7594b6.png)
3. æ–°å»ºè´¦æˆ·

   ![image-20220122155900060](https://i-blog.csdnimg.cn/blog_migrate/bb956d672502b594b51b86c93aa6f51b.png)
4. è¿›å…¥åˆ°ä¸»é¡µåï¼Œå…ˆå‰å¾€
   **Manage Jenkins - Manage Plugins**
   å®‰è£…éœ€è¦ç”¨åˆ°çš„æ’ä»¶ï¼Œç›®å‰å°±åªéœ€è¦å®‰è£…
   **NodeJS**
     
   ![image-20220122172232223](https://i-blog.csdnimg.cn/blog_migrate/1be4d4e7d1d8cc5d4944a9724ee138c5.png)
5. å‰å¾€å…¨å±€å·¥å…·é…ç½®ï¼Œå®‰è£…éœ€è¦çš„ä¸åŒç‰ˆæœ¬çš„
   **node**
   ç¯å¢ƒ

   ![image-20220122222048344](https://i-blog.csdnimg.cn/blog_migrate/2f9b825ded22e33cab80894c613d741a.png)
6. é…ç½® github

   åœ¨é…ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦åˆ°
   **GitHub**
   ç”Ÿæˆ
   **Personal access token**
   ã€‚

   **å¤´åƒ - Settings - Developer settings - Personal access tokens - Generate new token**
   ï¼ŒæŒ‰ä¸‹å›¾å‹¾é€‰éœ€è¦çš„æƒé™
     
   ![image-20220122222951817](https://i-blog.csdnimg.cn/blog_migrate/cc44f91990346bd823beb8372f05f7b6.png)
     
   è¿˜è®°å¾—æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœå—ï¼Ÿå½“ä¸»åˆ†æ”¯æœ‰æ–°çš„ä»£ç æäº¤ï¼Œå°±è¦é€šçŸ¥ jenkins å»æ‹‰å–ä»£ç å¹¶è¿›è¡Œæ„å»ºã€‚æ—¢ç„¶æ˜¯
   **é€šçŸ¥**
   ï¼Œé‚£ä¹ˆè‚¯å®šå°±éœ€è¦ç”¨åˆ°
   **Webhook**
   ã€‚è¿™é‡Œå¹¶ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º
   **Webhock**
   ï¼Œjenkinsæä¾›çš„æ’ä»¶ä¼šå¸®æˆ‘ä»¬åˆ›å»ºã€‚

   æ¥ä¸‹æ¥ç»§ç»­é…ç½®æ’ä»¶ï¼Œ**Manage Jenkisn - Config System - **ï¼Œæ‰¾åˆ° Github é…ç½®çš„éƒ¨åˆ†

![image-20220122223754425](https://i-blog.csdnimg.cn/blog_migrate/031b2db5eab9980e4a4745d23d21bc76.png)
  
ç‚¹å‡»æ·»åŠ å‡­è¯ï¼Œé€‰æ‹©
**Jenkins**
ï¼Œç‚¹å‡»åä¼šå¼¹å‡ºä¸€ä¸ªæ·»åŠ å‡­æ®çš„çª—å£ï¼Œ
**Type**
é€‰æ‹©ä¸º
**Secret text**
ï¼Œå°†æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„
**Personal access token**
å¤åˆ¶åˆ°
**Secret**
ä¸€æ ä¸­ï¼Œç‚¹å‡»æ·»åŠ 
  
![image-20220122223948772](https://i-blog.csdnimg.cn/blog_migrate/d8da84e548e0c1da2ad29b26fa340d76.png)
  
æ·»åŠ ååœ¨
**Credentials**
ä¸€æ é€‰ä¸­
**Secret text**
ï¼Œå‹¾é€‰
**Manage Hook**
ï¼Œç‚¹å‡»
**Test connection**
ï¼Œå¦‚æœæ­£ç¡®æ˜¾ç¤ºäº†GitHub ç”¨æˆ·åï¼Œå°±è¯´æ˜é…ç½®æˆåŠŸäº†ã€‚

ç»è¿‡ä¸Šé¢å‡ æ­¥åï¼Œå°±å®Œæˆäº†ä¸¤ä»¶äº‹æƒ…ï¼ŒNode ç¯å¢ƒçš„é…ç½®å’Œ Github Webhock çš„æ·»åŠ ï¼Œä¸‹é¢å°±å¯ä»¥å¼€å§‹æ–°å»ºä»»åŠ¡äº†ã€‚

###### æ–°å»ºä¸€ä¸ªItem

1. å›åˆ°é¦–é¡µï¼Œæ–°å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„ä»»åŠ¡

   ![image-20220122225529611](https://i-blog.csdnimg.cn/blog_migrate/3bf11ae65a371594e805e292ccb14650.png)
2. å‹¾é€‰
   **GitHub project**
   ï¼Œè¾“å…¥é¡¹ç›®åœ°å€ã€‚å°†ä¸‹é¢çš„
   **Source Code Management**
   é€‰ä¸­ä¸º
   **Git**
   ï¼Œå°†ä½ è¦æ„å»ºéƒ¨ç½²çš„é¡¹ç›®çš„
   **clone**
   åœ°å€å¡«åˆ°
   **Repository URL**
   ä¸€æ ä¸­ã€‚

   ![image-20220122225920767](https://i-blog.csdnimg.cn/blog_migrate/0b69c210035728bad64771a62301f636.png)

   ![image-20220122230320553](https://i-blog.csdnimg.cn/blog_migrate/bb52610598327d50baa1918c34ad4a40.png)

   å¦‚æœæ˜¯å…¬å¼€çš„ä»“åº“ï¼Œ
   **Credentials**
   å¯ä»¥é€‰æ‹©æ— ã€‚è¿™é‡Œæˆ‘å‡†å¤‡çš„æ˜¯ä¸€ä¸ªç§æœ‰çš„ä»“åº“ï¼Œè¿˜éœ€è¦æ·»åŠ ä¸€ä¸ªå¯ä»¥è®¿é—®è®¿é—® Githubè´¦æˆ· çš„å‡­è¯ï¼Œæ·»åŠ æ–¹æ³•ç±»ä¼¼ä¸Šé¢é…ç½®
   **Github Webhock**
   ã€‚è¿™é‡Œé€‰æ‹©
   **ssh private key**
   çš„æ–¹å¼

   ![image-20220122231214377](https://i-blog.csdnimg.cn/blog_migrate/0693e22ff04b8620d680c1aa804b99da.png)
3. è®¾ç½®æ„å»ºè§¦å‘å™¨å’Œæ„å»ºç¯å¢ƒ

   ![image-20220122231805390](https://i-blog.csdnimg.cn/blog_migrate/9312d41258b9ad0f988f0c64ecd7af1a.png)
4. ç¼–å†™æ„å»ºshell

   ![image-20220123000138842](https://i-blog.csdnimg.cn/blog_migrate/51bf6f84bfdd23a156987183badc5661.png)

ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå°±ç®—å®Œæˆä¸€ä¸ª
**Item**
äº†ï¼Œå½“
**Github**
ä¸»åˆ†æ”¯æœ‰æ–°çš„ä»£ç æäº¤ï¼Œå°±ä¼šè§¦å‘æ„å»ºï¼š

![image-20220123002304395](https://i-blog.csdnimg.cn/blog_migrate/cedd923d3ac68f3beeab9cbf34181f64.png)

##### Github Actions

Github Actions æ˜¯ Github æä¾›çš„æŒç»­é›†æˆæœåŠ¡ï¼Œå¯ä»¥ä½¿æˆ‘ä»¬çš„ repo è·å¾—ä¸€äº›è‡ªåŠ¨åŒ–çš„èƒ½åŠ›ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼š

* æ¯æ¬¡ repo æœ‰æ–°çš„æäº¤æˆ– pr å°±è‡ªåŠ¨æ‰§è¡Œ build
* åœ¨ repo ä¸­å®šæ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„è„šæœ¬
* å°†ä»£ç æ‰“æˆé•œåƒï¼Œè‡ªåŠ¨æäº¤åˆ°é•œåƒä»“åº“ä¸­

###### ä¸€äº›æ¦‚å¿µ

* `workflow`
  ï¼šä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¯ä¸ª
  `workflow`
  ä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ç»´æŠ¤
* `job`
  ï¼š
  `workflow`
  çš„åˆ†è§£ï¼Œ
  **å¯ä¸²è¡Œ**
  å­˜åœ¨ä¾èµ–ï¼Œä¹Ÿ
  **å¯å¹¶è¡Œ**
  æ‰§è¡Œ
* `step`
  ï¼š
  `job`
  çš„åˆ†è§£ï¼Œå³å…·ä½“æ‰§è¡Œçš„æ­¥éª¤
* `action`
  ï¼šæ‰§è¡Œè¿‡ç¨‹çš„å°è£…ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Github ç¤¾åŒºå®šä¹‰å¥½çš„
  `action`
* `artifact`
  ï¼š
  `workflow`
  è¿è¡Œæ—¶äº§ç”Ÿçš„ä¸­é—´æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ—¥å¿—ã€æµ‹è¯•ç»“æœç­‰
* `event`
  ï¼šè§¦å‘
  `workflow`
  çš„äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸º
  **ç”Ÿå‘½å‘¨æœŸé’©å­**

###### å¦‚ä½•é…ç½®

é…ç½® CI/CD ä»»åŠ¡çš„è¿‡ç¨‹æœ¬è´¨ä¸Šæ˜¯å‘ runner æè¿°å¦‚ä¸‹å†…å®¹ï¼š

* ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ
* æ‰§è¡Œä»€ä¹ˆæ“ä½œ

è¿™é‡Œçš„ workflow é…ç½®æ–‡ä»¶å°±æ˜¯ç”¨æ¥åšè¿™ä¸ªå·¥ä½œçš„

###### workflow çš„è§¦å‘

æ¯ä¸ª workflow çš„é…ç½®æ–‡ä»¶éƒ½éœ€è¦å®šäº
`on`
å­—æ®µï¼Œç”¨ä»¥æè¿°åœ¨ä½•ç§æƒ…å†µä¸‹ï¼ˆ
`event`
ï¼‰ä¸‹è§¦å‘
`job`
çš„æ‰§è¡Œ

`event`
å¯ä»¥åˆ†ä¸º 3 ç±»ï¼š

* å®šæ—¶äº‹ä»¶ï¼šç”±å®šæ—¶ä»»åŠ¡è§¦å‘çš„äº‹ä»¶
* æ‰‹åŠ¨è§¦å‘äº‹ä»¶ï¼šåœ¨ actions é¡µé¢ä¸­æ‰‹åŠ¨è§¦å‘çš„æ—¶é—´
* Webhook äº‹ä»¶ï¼šGithub è‡ªèº«çš„é’©å­å‡½æ•°è§¦å‘çš„äº‹ä»¶ï¼Œé€šå¸¸ä¼´éšç€ git æ“ä½œ

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªä¼šç”¨åˆ°æœ€åä¸€ç§ï¼Œæ¥æè¿°
**git æ“ä½œ**
è§¦å‘çš„ CI/CD è¡Œä¸º

###### è‡ªåŠ¨åŒ–éƒ¨ç½²çš„ workflow

ä¸‹é¢æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ç»å¸¸ä½¿ç”¨çš„éƒ¨ç½²æ¨¡æ¿ï¼Œæˆ‘ç»™å®ƒä»¬åŠ ä¸Šäº†è¯¦ç»†çš„æ³¨é‡Š

```yml
name: build and deploy # workflow åç§°
on: 
  push: # push äº‹ä»¶è§¦å‘
    branches: [ dev ] # åªåœ¨ dev åˆ†æ”¯æœ‰æ–°çš„ push æƒ…å†µä¸‹è§¦å‘

jobs:
  build: # job åç§°
    runs-on: ubuntu-latest # æ‰§è¡Œ workflow æ‰€éœ€çš„æ“ä½œç³»ç»Ÿç¯å¢ƒ
    steps:
      - name: checkout
        uses: actions/checkout@v2 # ä½¿ç”¨åˆ‡æ¢åˆ†æ”¯çš„ action æ“ä½œ

      - name: build
        run: yarn && yarn build # æ„å»ºå‘½ä»¤

      - name: deploy
        uses: easingthemes/ssh-deploy@main # ä½¿ç”¨ ssh ä¸Šä¼ æ–‡ä»¶çš„ action æ“ä½œ
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }} # ssh å¯†é’¥å¯¹ä¸­çš„ç§é’¥
          ARGS: "-rltgoDzvO"
          SOURCE: "dist" # è¦è¿›è¡Œä¸Šä¼ çš„æ–‡ä»¶ç›®å½•
          REMOTE_HOST: ${{ secrets.REMOTE_HOST  }} # æœåŠ¡å™¨ä¸»æœº ip
          REMOTE_USER: ${{ secrets.REMOTE_USER }} # æœåŠ¡å™¨ç”¨æˆ·å
          TARGET: ${{ secrets.REMOTE_TARGET }} # è¦è¿›è¡Œéƒ¨ç½²çš„ç”Ÿäº§ç¯å¢ƒç›®å½•


      - name: print env
        run: printenv # æ‰“å°ç¯å¢ƒå˜é‡

      - name: build success
        if: ${{ success() }} # ${{ }} å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡å‚æ•°,success() è¡¨ç¤ºå½“ä¸Šä¸€æ­¥æ‰§è¡ŒæˆåŠŸæ—¶è¿”å› true
        uses: chf007/action-wechat-work@master # ä½¿ç”¨å‘é€ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯çš„ action
        env:
          WECHAT_WORK_BOT_WEBHOOK: ${{secrets.WX_WEBHOOK}} # github tokenï¼Œéœ€è¦è‡ªå·±åœ¨ repo çš„ settings ä¸­ç”Ÿæˆ
        with:
          msgtype: news
          articles: '[{"title":"ğŸ’¯ğŸ‘¨â€ğŸ’» Success Deploy ! ğŸ‰ğŸ‰ğŸ‰","description":"click here to visit the test site ~","url":"http://xxxx:8080/","picurl":"https://xxxx.com/xxxx/figure-bed/raw/master/images/202203101823814.jpeg"}]'
          mentioned_list: '[@all"]'

      - name: build failure
        if: ${{ failure() }}
        uses: chf007/action-wechat-work@master
        env:
          WECHAT_WORK_BOT_WEBHOOK: ${{secrets.WX_WEBHOOK}}
        with:
          msgtype: markdown
          content: |
            # ğŸ’¤ğŸ¤·â€â™€ï¸ Deploy Failure ğŸ™…â€â™‚ï¸ğŸ’£
            > (â‹Ÿï¹â‹)  from github action message
          mentioned_list: '[@all"]'

```

> æ³¨ï¼šä¸Šé¢ ssh éƒ¨ç½²çš„æ–¹å¼ä½¿ç”¨äº† rsa ç§˜é’¥å¯¹ä¸­çš„ç§é’¥ï¼Œä¸çŸ¥é“æ€ä¹ˆç”Ÿæˆçš„è¯è¯·å‚è€ƒ
> [æœåŠ¡å™¨ä¸Šçš„-Git-ç”Ÿæˆ-SSH-å…¬é’¥](https://git-scm.com/book/zh/v2/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E7%94%9F%E6%88%90-SSH-%E5%85%AC%E9%92%A5)

###### pr åˆå¹¶æ¶ˆæ¯æé†’çš„ workflow

```yml
name: pull request

on:
   pull_request:
      branches: [ master, dev ]

jobs:
  pr:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2

      # è·å– pr ä¿¡æ¯ï¼Œæ·»åŠ åˆ°ç¯å¢ƒå˜é‡
      - name: set pr info
        run: |
          echo PR_NUMBER=$(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }') >> $GITHUB_ENV
          echo PR_FROM=$(echo $GITHUB_HEAD_REF ) >> $GITHUB_ENV
          echo PR_TO=$(echo $GITHUB_B_REF ) >> $GITHUB_ENV
          echo PR_TITLE=$(jq --raw-output .pull_request.title "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
          echo PR_URL=$(jq --raw-output .pull_request.html_url "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
          echo PR_USER=$(jq --raw-output .pull_request.user.login "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
          echo PR_COMMITS_NUM=$(jq --raw-output .pull_request.commits "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
      - name: print env
        run: printenv

      - name: pull request
        uses: chf007/action-wechat-work@master
        env:
          WECHAT_WORK_BOT_WEBHOOK: ${{secrets.WX_WEBHOOK}}
        with:
          msgtype: markdown
          content: |
            # ğŸ˜ Pull Request ğŸ¤¤ ï¼ (ï¼¾ï¼ï¼¾)V
            > [${{ env.PR_TITLE }} #${{ env.PR_NUMBER }}](${{ env.PR_URL }})
            > ${{ env.PR_USER }} wants to merge ${{ env.PR_COMMITS_NUM }} commits
            > into <font color=#2F8CDB>${{ env.PR_TO }}</font> from <font color=#008000>${{ env.PR_FROM }}</font>

```

###### ä»£ç  push å¹¶å‘èµ· prï¼Œè§¦å‘ workflow

å°è¯•å°†æœ¬åœ°çš„ä»£ç æ¨é€åˆ°è¿œç«¯ï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®è§¦å‘äº†éƒ¨ç½²çš„æ“ä½œ
  
![image-20220415134754666](https://i-blog.csdnimg.cn/blog_migrate/eabb76a90172ac823cec157460eefa69.png)
  
å‘èµ·ä¸€ä¸ªä»å¼€å‘åˆ†æ”¯åˆ°ä¸»åˆ†æ”¯çš„åˆå¹¶ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿèƒ½è§¦å‘å¯¹åº”çš„ workflow
  
![image-20220415144404314](https://i-blog.csdnimg.cn/blog_migrate/e38b75a4c54d1e925a39f9ad8d550ba6.png)

### 

### æ€»ç»“

ç»è¿‡ä»¥ä¸Šçš„æ­¥éª¤ï¼Œä¹Ÿå°±å®ç°äº†ä¸€ä¸ª
**æœ€å°åŒ–è‡ªåŠ¨åŒ–éƒ¨ç½²**
çš„å®è·µï¼Œä½†è¿™ä»…ä»…åªæ˜¯ CI/CD åºæ‚ç®¡é“æµç¨‹ä¸­çš„ä¸€ç¯ï¼Œå¾ˆå¤šæ—¶å€™è¿˜ä¼šç»“åˆ dockerã€k8sã€sentryã€gitlabç­‰å®ç°
**å¤šå¹³å°ååŒ**
ã€‚ä¸Šé¢ç”¨åˆ°çš„ Jenkinsã€Github Actions ï¼Œä¹Ÿåªæ˜¯å·¥å…·ä¸­çš„ä¸¤ç§ï¼Œç±»ä¼¼çš„è¿˜æœ‰å›½äººå¼€å‘çš„ Giteaã€Onedevç­‰å„ç±»é›†æˆäº† CI/CD çš„ä»£ç è‡ªå»ºæ‰˜ç®¡å¹³å°ï¼›ä¼ä¸šä¸­ï¼Œä¹Ÿå¾ˆæœ‰å¯èƒ½ä¼šè‡ªå»ºä¸€å¥—å®Œæ•´çš„ç³»ç»Ÿå»æ»¡è¶³å†…éƒ¨çš„è¦æ±‚ã€‚

ä¸Šé¢ä¸¤ç§æ–¹æ¡ˆè™½ç„¶ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†å…¶å†…éƒ¨çš„å®ç°ï¼Œæƒ³å¿…è¿˜æ˜¯ååˆ†å¤æ‚çš„ï¼Œåé¢æœ‰æ—¶é—´ä¹Ÿä¼šç»§ç»­å­¦ä¹ çš„ã€‚

### å‚è€ƒ

> [ä½¿ç”¨GithubActionsè‡ªåŠ¨åŒ–å·¥ä½œæµ](https://blog.hszofficial.site/introduce/2020/11/30/%E4%BD%BF%E7%94%A8GithubActions%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81/)
>
> [èŠ±åŠå¤©æ—¶é—´ï¼Œè½»æ¾æ‰“é€ å‰ç«¯CI/CDå·¥ä½œæµ](https://juejin.cn/post/6944878021560139783)
>
> [ä»é›¶æ­å»ºdocker+jenkins+node.jsè‡ªåŠ¨åŒ–éƒ¨ç½²ç¯å¢ƒ](https://juejin.cn/post/6844903669381464071)