---
layout: post
title: "静态网页的爬虫以电影天堂为例"
date: 2025-03-08 20:22:37 +0800
description: "静态网页爬虫（具体操作步骤以及代码基础知识点的详情解释请看上一篇），或者打开爬虫专栏。"
keywords: "静态网页的爬虫（以电影天堂为例）"
categories: ['Python']
tags: ['爬虫', 'Python']
artid: "146121964"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146121964
    alt: "静态网页的爬虫以电影天堂为例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146121964
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146121964
cover: https://bing.ee123.net/img/rand?artid=146121964
image: https://bing.ee123.net/img/rand?artid=146121964
img: https://bing.ee123.net/img/rand?artid=146121964
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     静态网页的爬虫（以电影天堂为例）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、电影天堂的网址（url）
    </h2>
    <p>
     <a class="has-card" href="https://dydytt.net/index.htm" rel="nofollow" title="电影天堂_免费电影_迅雷电影下载_电影天堂网">
      <span class="link-card-box" contenteditable="false">
       <span class="link-title">
        电影天堂_免费电影_迅雷电影下载_电影天堂网
       </span>
       <span class="link-desc">
        最好的迅雷电影下载网，分享最新电影，高清电影、综艺、动漫、电视剧等下载！
       </span>
       <span class="link-link">
        <img class="link-link-icon" src="https://csdnimg.cn/release/blog_editor_html/release2.3.8/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=P1C7">
         https://dydytt.net/index.htm
        </img>
       </span>
      </span>
     </a>
     <img alt="" height="924" src="https://i-blog.csdnimg.cn/direct/9d9c3467ca6445ca9a1c5fb76ef634c0.png" width="1769"/>
    </p>
    <p>
     我们要爬取这个页面上的内容
    </p>
    <h2>
     二、代码详情解释和介绍功能中所用到的知识点
    </h2>
    <h3>
     这个代码涵盖了以下主要知识点：
    </h3>
    <ol>
     <li>
      <p>
       HTTP 请求与响应处理。
      </p>
     </li>
     <li>
      <p>
       HTML 解析与 XPath 使用。
      </p>
     </li>
     <li>
      <p>
       字符串处理与数据格式化。
      </p>
     </li>
     <li>
      <p>
       异常处理与程序健壮性。
      </p>
     </li>
     <li>
      <p>
       列表、字典与数据结构操作。
      </p>
     </li>
     <li>
      <p>
       编码处理与国际化支持。
      </p>
     </li>
     <li>
      <p>
       请求间隔与反爬虫策略。
      </p>
     </li>
     <li>
      <p>
       函数定义与模块化编程。
      </p>
     </li>
     <li>
      <p>
       日志输出与调试技巧。
      </p>
     </li>
    </ol>
    <pre><code class="language-python">import requests
from lxml import etree
import time
import warnings

# 禁用 SSL 警告
warnings.filterwarnings("ignore", category=requests.packages.urllib3.exceptions.InsecureRequestWarning)

# 请求头，模拟浏览器访问
HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
    'Referer': 'https://dydytt.net/',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Connection': 'keep-alive',
}

# 基础域名
BASE_DOMAIN = "https://dydytt.net"


def get_detail_urls(url):
    """
    获取电影详情页的 URL
    """
    try:
        # 发送 HTTP 请求
        response = requests.get(url, headers=HEADERS, verify=False)
        response.raise_for_status()  # 检查请求是否成功
        # 解码响应内容（电影天堂使用 gbk 编码）
        text = response.content.decode("gbk", "ignore")
        # 使用 lxml 解析 HTML
        html = etree.HTML(text)
        # 提取电影详情页的链接
        detail_urls = html.xpath("//div[@class='co_content8']//table//a/@href")
        # 将相对路径转换为完整 URL
        detail_urls = [BASE_DOMAIN + url if url.startswith("/") else BASE_DOMAIN + "/" + url for url in detail_urls]
        return detail_urls
    except Exception as e:
        print(f"Error fetching detail URLs: {e}")
        return []


def parse_detail(url):
    """
    解析电影详情页，提取电影信息
    """
    try:
        # 发送 HTTP 请求
        response = requests.get(url, headers=HEADERS, verify=False)
        response.raise_for_status()  # 检查请求是否成功
        # 解码响应内容
        text = response.content.decode("gbk", "ignore")
        # 使用 lxml 解析 HTML
        html = etree.HTML(text)

        # 提取电影标题
        title_elements = html.xpath("//div[@class='title_all']//font[@color='#07519a']/text()")
        title = title_elements[0] if title_elements else "未知标题"

        # 提取电影图片
        image_elements = html.xpath("//div[@id='Zoom']//img/@src")
        image = image_elements[0] if image_elements else "未知图片"

        # 提取电影信息（年份、评分、导演、主演、简介等）
        infos = html.xpath("//div[@id='Zoom']//text()")
        movie_info = {}
        for info in infos:
            info = info.strip()
            if info.startswith("◎年 代"):
                movie_info["year"] = info.replace("◎年 代", "").strip()
            elif info.startswith("◎豆瓣评分"):
                movie_info["score"] = info.replace("◎豆瓣评分", "").strip()
            elif info.startswith("◎片 长"):
                movie_info["duration"] = info.replace("◎片 长", "").strip()
            elif info.startswith("◎导 演"):
                movie_info["director"] = info.replace("◎导 演", "").strip()
            elif info.startswith("◎主 演"):
                movie_info["actors"] = info.replace("◎主 演", "").strip()
            elif info.startswith("◎简 介"):
                movie_info["profile"] = info.replace("◎简 介", "").strip()

        # 提取下载链接
        downurl_elements = html.xpath("//td[@bgcolor='#fdfddf']/a/@href")
        downurl = downurl_elements[0] if downurl_elements else "未知下载链接"

        # 返回电影信息
        return {
            "title": title,
            "image": image,
            **movie_info,
            "downurl": downurl,
        }
    except Exception as e:
        print(f"Error parsing detail page: {e}")
        return None


def spider():
    """
    主爬虫函数
    """
    # 基础 URL（电影列表页）
    base_url = "https://dydytt.net/index.htm"
    movies = []

    # 获取电影详情页的 URL
    print("Fetching movie list from:", base_url)
    detail_urls = get_detail_urls(base_url)

    # 遍历每个详情页，提取电影信息
    for detail_url in detail_urls:
        print("Fetching movie details from:", detail_url)
        time.sleep(5)  # 增加请求间隔，避免被封禁
        movie = parse_detail(detail_url)
        if movie:
            movies.append(movie)

    # 打印所有电影信息
    for movie in movies:
        print(movie)


if __name__ == '__main__':
    spider()</code></pre>
    <p>
     代码爬虫成功标志：
    </p>
    <p>
     <img alt="" height="690" src="https://i-blog.csdnimg.cn/direct/90e50c24de8249438398cf6059c4d50b.png" width="1773"/>
    </p>
    <p>
     这个代码涉及多个 Python 编程和网络爬虫的知识点。以下是代码中用到的关键知识点及其作用：
    </p>
    <hr/>
    <h4 style="background-color:transparent">
     1.
     <strong>
      HTTP 请求 (
      <code>
       requests
      </code>
      库)
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：发送 HTTP 请求，获取网页内容。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          requests.get(url, headers=headers, verify=False)
         </code>
         ：发送 GET 请求，获取网页内容。
        </p>
       </li>
       <li>
        <p>
         <code>
          response.content
         </code>
         ：获取响应的二进制内容。
        </p>
       </li>
       <li>
        <p>
         <code>
          response.text
         </code>
         ：获取响应的文本内容（自动解码）。
        </p>
       </li>
       <li>
        <p>
         <code>
          response.raise_for_status()
         </code>
         ：检查请求是否成功，失败时抛出异常。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4 style="background-color:transparent">
     2.
     <strong>
      HTML 解析 (
      <code>
       lxml
      </code>
      和
      <code>
       etree
      </code>
      )
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：解析 HTML 文档，提取所需的数据。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          etree.HTML(text)
         </code>
         ：将 HTML 文本转换为可解析的
         <code>
          etree
         </code>
         对象。
        </p>
       </li>
       <li>
        <p>
         <code>
          html.xpath("XPath表达式")
         </code>
         ：使用 XPath 表达式定位 HTML 元素。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          html.xpath("//div[@class='title_all']//font[@color='#07519a']/text()")
         </code>
         提取电影标题。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4 style="background-color:transparent">
     3.
     <strong>
      XPath 表达式
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：用于定位 HTML 文档中的特定元素。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          //
         </code>
         ：从根节点开始查找。
        </p>
       </li>
       <li>
        <p>
         <code>
          [@属性名='值']
         </code>
         ：根据属性值筛选元素。
        </p>
       </li>
       <li>
        <p>
         <code>
          /text()
         </code>
         ：提取元素的文本内容。
        </p>
       </li>
       <li>
        <p>
         <code>
          /@属性名
         </code>
         ：提取元素的属性值。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          //div[@class='co_content8']//table//a/@href
         </code>
         提取电影详情页的链接。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4 style="background-color:transparent">
     4.
     <strong>
      字符串处理
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：清理和格式化提取的数据。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          str.strip()
         </code>
         ：去除字符串两端的空白字符。
        </p>
       </li>
       <li>
        <p>
         <code>
          str.replace(old, new)
         </code>
         ：替换字符串中的部分内容。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          info.replace("◎年 代", "").strip()
         </code>
         提取电影年份。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4 style="background-color:transparent">
     5.
     <strong>
      异常处理 (
      <code>
       try-except
      </code>
      )
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：捕获和处理程序运行中的异常，避免程序崩溃。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          try
         </code>
         ：尝试执行可能出错的代码。
        </p>
       </li>
       <li>
        <p>
         <code>
          except
         </code>
         ：捕获异常并处理。
        </p>
       </li>
       <li>
        <p>
         示例：捕获
         <code>
          requests.get
         </code>
         的异常，防止网络请求失败导致程序崩溃。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4 style="background-color:transparent">
     6.
     <strong>
      列表和字典操作
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：存储和处理提取的数据。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          list.append(item)
         </code>
         ：向列表中添加元素。
        </p>
       </li>
       <li>
        <p>
         <code>
          dict[key] = value
         </code>
         ：向字典中添加键值对。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          movies.append({"title": title, "href": href})
         </code>
         将电影信息存储到列表中。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     7.
     <strong>
      编码处理
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：正确处理网页的编码问题。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          response.content.decode("gbk", "ignore")
         </code>
         ：将二进制内容解码为文本，忽略无法解码的字符。
        </p>
       </li>
       <li>
        <p>
         电影天堂使用
         <code>
          gbk
         </code>
         编码，必须正确解码才能获取可读的文本内容。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     8.
     <strong>
      请求间隔 (
      <code>
       time.sleep
      </code>
      )
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：避免频繁请求导致被封禁。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          time.sleep(seconds)
         </code>
         ：暂停程序执行指定的秒数。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          time.sleep(5)
         </code>
         每次请求后暂停 5 秒。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     9.
     <strong>
      禁用 SSL 验证
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：忽略 SSL 证书验证，避免 HTTPS 请求失败。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          requests.get(verify=False)
         </code>
         ：禁用 SSL 验证。
        </p>
       </li>
       <li>
        <p>
         <code>
          warnings.filterwarnings("ignore", category=InsecureRequestWarning)
         </code>
         ：禁用 SSL 警告。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     10.
     <strong>
      函数定义与调用
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：将代码模块化，提高可读性和复用性。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          def function_name(parameters):
         </code>
         ：定义函数。
        </p>
       </li>
       <li>
        <p>
         <code>
          function_name(arguments)
         </code>
         ：调用函数。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          get_detail_urls(url)
         </code>
         获取电影详情页的 URL。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     11.
     <strong>
      循环与条件判断
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：遍历数据并根据条件执行不同的操作。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          for item in list:
         </code>
         ：遍历列表中的每个元素。
        </p>
       </li>
       <li>
        <p>
         <code>
          if condition:
         </code>
         ：根据条件执行代码。
        </p>
       </li>
       <li>
        <p>
         示例：遍历电影详情页的 URL 并解析每个页面。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     12.
     <strong>
      日志输出 (
      <code>
       print
      </code>
      )
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：打印程序运行状态和结果，便于调试。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          print(message)
         </code>
         ：输出信息到控制台。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          print("Fetching movie list from:", base_url)
         </code>
         打印当前正在处理的 URL。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     13.
     <strong>
      模块导入 (
      <code>
       import
      </code>
      )
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：引入外部库或模块，扩展 Python 的功能。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          import requests
         </code>
         ：导入
         <code>
          requests
         </code>
         库。
        </p>
       </li>
       <li>
        <p>
         <code>
          from lxml import etree
         </code>
         ：从
         <code>
          lxml
         </code>
         库中导入
         <code>
          etree
         </code>
         模块。
        </p>
       </li>
       <li>
        <p>
         <code>
          import time
         </code>
         ：导入
         <code>
          time
         </code>
         模块。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     14.
     <strong>
      URL 拼接
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：将相对路径转换为完整 URL。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          BASE_DOMAIN + url
         </code>
         ：拼接基础域名和相对路径。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          BASE_DOMAIN + "/" + url
         </code>
         处理相对路径。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     15.
     <strong>
      默认值处理
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        作用
       </strong>
       ：在数据缺失时提供默认值，避免程序崩溃。
      </p>
     </li>
     <li>
      <p>
       <strong>
        知识点
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <code>
          list[0] if list else "默认值"
         </code>
         ：如果列表不为空，返回第一个元素，否则返回默认值。
        </p>
       </li>
       <li>
        <p>
         示例：
         <code>
          title_elements[0] if title_elements else "未知标题"
         </code>
         处理电影标题缺失的情况。
        </p>
       </li>
      </ul>
     </li>
    </ul>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38303934353131332f:61727469636c652f64657461696c732f313436313231393634" class_="artid" style="display:none">
 </p>
</div>


