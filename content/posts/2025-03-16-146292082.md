---
layout: post
title: "VSCode-CMake"
date: 2025-03-16 11:13:35 +0800
description: "在 VSCode 中配置 CMake 扩展的调试环境"
keywords: "VSCode + CMake"
categories: ['杂类']
tags: ['计算机', '编辑器', '算法', 'Vscode', 'Ide']
artid: "146292082"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146292082
    alt: "VSCode-CMake"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146292082
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146292082
cover: https://bing.ee123.net/img/rand?artid=146292082
image: https://bing.ee123.net/img/rand?artid=146292082
img: https://bing.ee123.net/img/rand?artid=146292082
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     VSCode + CMake
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     参考文献：
    </p>
    <ol>
     <li>
      <a href="https://blog.csdn.net/weixin_44885334/article/details/129432917">
       如何用 GCC, CMake 和 Make 编译C/C++代码
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/weixin_44885334/article/details/129336336">
       Windows 上的 Linux 子系统：WSL
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/weixin_44885334/article/details/139968317">
       WSL：桌面 UI + 远程连接 RDP + 配置 VScode
      </a>
     </li>
    </ol>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="CMake__8">
     </a>
     CMake 配置
    </h2>
    <p>
     编写如下的
     <code>
      CmakeLists.txt
     </code>
     ，设置文件之间的链接关系，
    </p>
    <pre><code class="prism language-python">cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">3.10</span><span class="token punctuation">)</span>

project<span class="token punctuation">(</span>PQC VERSION <span class="token number">1.0</span> LANGUAGES CXX<span class="token punctuation">)</span>

<span class="token builtin">set</span><span class="token punctuation">(</span>CMAKE_CXX_COMPILER <span class="token string">"g++"</span><span class="token punctuation">)</span>
<span class="token builtin">set</span><span class="token punctuation">(</span>CMAKE_CXX_STANDARD <span class="token number">17</span><span class="token punctuation">)</span>
<span class="token builtin">set</span><span class="token punctuation">(</span>CMAKE_CXX_STANDARD_REQUIRED ON<span class="token punctuation">)</span>
<span class="token builtin">set</span><span class="token punctuation">(</span>CMAKE_BUILD_TYPE Debug<span class="token punctuation">)</span> 								<span class="token comment"># Debug, Release</span>

include_directories<span class="token punctuation">(</span>SYSTEM<span class="token punctuation">)</span>
link_directories<span class="token punctuation">(</span>SYSTEM<span class="token punctuation">)</span>

<span class="token builtin">set</span><span class="token punctuation">(</span>EXECUTABLE_OUTPUT_PATH $<span class="token punctuation">{<!-- --></span>PROJECT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span><span class="token builtin">bin</span><span class="token punctuation">)</span> 		<span class="token comment"># 配置执行文件目录</span>
<span class="token builtin">set</span><span class="token punctuation">(</span>LIBRARY_OUTPUT_PATH $<span class="token punctuation">{<!-- --></span>PROJECT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>lib<span class="token operator">/</span><span class="token punctuation">)</span>			<span class="token comment"># 配置库文件目录</span>

add_compile_options<span class="token punctuation">(</span>
    <span class="token operator">-</span>march<span class="token operator">=</span>native <span class="token operator">-</span>O3 <span class="token operator">-</span>maes <span class="token operator">-</span>mavx2 <span class="token operator">-</span>fPIC
    <span class="token operator">-</span>w <span class="token operator">-</span>Wl<span class="token punctuation">,</span><span class="token operator">-</span><span class="token operator">-</span>no<span class="token operator">-</span><span class="token keyword">as</span><span class="token operator">-</span>needed<span class="token punctuation">,</span><span class="token operator">-</span>lprofiler<span class="token punctuation">,</span><span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">as</span><span class="token operator">-</span>needed
<span class="token punctuation">)</span>

link_libraries<span class="token punctuation">(</span>stdc<span class="token operator">+</span><span class="token operator">+</span> m ssl crypto profiler<span class="token punctuation">)</span>				<span class="token comment"># 在所有编译指令中添加这些链接库</span>

<span class="token builtin">set</span><span class="token punctuation">(</span>PATH_KEM $<span class="token punctuation">{<!-- --></span>PROJECT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>kem<span class="token punctuation">)</span>						<span class="token comment"># 源文件目录</span>
<span class="token builtin">set</span><span class="token punctuation">(</span>PATH_TEST $<span class="token punctuation">{<!-- --></span>PROJECT_SOURCE_DIR<span class="token punctuation">}</span><span class="token operator">/</span>test<span class="token punctuation">)</span>					<span class="token comment"># 测试文件目录</span>

<span class="token builtin">file</span><span class="token punctuation">(</span>GLOB SRC_KEM CONFIGURE_DEPENDS $<span class="token punctuation">{<!-- --></span>PATH_KEM<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>cpp<span class="token punctuation">)</span>		<span class="token comment"># 找到全部的源文件</span>

add_library<span class="token punctuation">(</span>kem_128 SHARED $<span class="token punctuation">{<!-- --></span>SRC_KEM<span class="token punctuation">}</span><span class="token punctuation">)</span>						<span class="token comment"># 根据全部的源文件，构造出库文件</span>
target_compile_definitions<span class="token punctuation">(</span>test_128 PUBLIC SAFETY<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span>		<span class="token comment"># 配置宏，编译出不同的可执行文件</span>

add_executable<span class="token punctuation">(</span>test_128 $<span class="token punctuation">{<!-- --></span>PATH_TEST<span class="token punctuation">}</span><span class="token operator">/</span>test<span class="token punctuation">.</span>cpp<span class="token punctuation">)</span>				<span class="token comment"># 构造可执行文件</span>
target_link_libraries<span class="token punctuation">(</span>test_128 kem_128<span class="token punctuation">)</span>						<span class="token comment"># 链接到编译出的库文件</span>

</code></pre>
    <h2>
     <a id="VSCode__50">
     </a>
     VSCode 配置
    </h2>
    <p>
     首先安装微软的
     <code>
      CMake Tools
     </code>
     扩展包，左栏如图所示，
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4074717d1ca24f4799bcd4757ad2acb6.png#pic_center" width="800"/>
    </p>
    <h3>
     <a id="launchjson_57">
     </a>
     launch.json
    </h3>
    <p>
     该文件用于配置
     <strong>
      调试器
     </strong>
     ，我们将其中的
     <code>
      program
     </code>
     设置为
     <code>
      command:cmake.launchTargetPath
     </code>
     ，这是使用
     <code>
      CMake
     </code>
     构建出的可执行文件路径，
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"CMake Debug"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"program"</span><span class="token operator">:</span> <span class="token string">"${command:cmake.launchTargetPath}"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token string-property property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"Enable pretty-printing for gdb"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     现在，可以在左栏中配置、生成、调试文件，使用
     <code>
      ctrl + F5
     </code>
     不调试执行，使用
     <code>
      F5
     </code>
     调试执行（打断点、查看寄存器的值，等等）
    </p>
    <h3>
     <a id="taskjson_92">
     </a>
     task.json
    </h3>
    <p>
     该文件用于配置
     <strong>
      编译器
     </strong>
     ，可在
     <code>
      command
     </code>
     属性配置编译器路径（
     <code>
      usr/bin/g++
     </code>
     ），在
     <code>
      args
     </code>
     属性中设置依赖库文件（
     <code>
      -I, -L, -l
     </code>
     ）的路径，等等。这里，我们使用 CMake 扩展，上述的
     <code>
      launch.json
     </code>
     将会覆盖该文件，它通过命令面板（
     <code>
      Ctrl + Shift + P
     </code>
     ）中的
     <code>
      CMake: Configure
     </code>
     和
     <code>
      CMake: Build
     </code>
     完成项目的配置和构建。因此该文件不需要编写。
    </p>
    <h3>
     <a id="c_cpp_propertiesjson_97">
     </a>
     c_cpp_properties.json
    </h3>
    <p>
     该文件用于配置
     <strong>
      C/C++ 开发环境
     </strong>
     ，包括：头文件目录
     <code>
      includePath
     </code>
     , 编译器目录
     <code>
      compilerPath
     </code>
     , 宏定义
     <code>
      defines
     </code>
     ，等等。这里，我们使用 CMake 扩展，上述的
     <code>
      launch.json
     </code>
     将会覆盖该文件，它根据
     <code>
      CmakeLists.txt
     </code>
     中的设置来配置环境。因此该文件不需要编写。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343838353333342f:61727469636c652f64657461696c732f313436323932303832" class_="artid" style="display:none">
 </p>
</div>


