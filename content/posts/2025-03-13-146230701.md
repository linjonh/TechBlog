---
arturl_encode: "68747470733a2f2f626c:6f672e6373646e2e6e65742f6e3965636f6d6d756e6974792f:61727469636c652f64657461696c732f313436323330373031"
layout: post
title: "夜莺监控-v8.0-新版通知规则-对接企微告警"
date: 2025-03-13 14:45:52 +0800
description: "夜莺监控v8.0版本引入了新版通知规则，可以很方便对接钉钉、企微、飞书，本文介绍如何对接企微告警"
keywords: "夜莺监控 v8.0 新版通知规则 | 对接企微告警"
categories: ['未分类']
tags: ['监控告警', '夜莺监控', '企微告警', '企微', '企业微信']
artid: "146230701"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146230701
    alt: "夜莺监控-v8.0-新版通知规则-对接企微告警"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146230701
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146230701
cover: https://bing.ee123.net/img/rand?artid=146230701
image: https://bing.ee123.net/img/rand?artid=146230701
img: https://bing.ee123.net/img/rand?artid=146230701
---

# 夜莺监控 v8.0 新版通知规则 | 对接企微告警

对新版本通知规则还不太了解的用户可以阅读文章：《
[夜莺监控巨大革新：抽象出通知规则，增强告警通知的灵活性](https://flashcat.cloud/blog/nightingale-release-v8beta7/ "夜莺监控巨大革新：抽象出通知规则，增强告警通知的灵活性")
》。下面我们将以企微通知为例，介绍如何使用新版通知规则来对接企微通知。

![](https://i-blog.csdnimg.cn/direct/cc63d95f344a43a7ad9020ec6c522f67.png)

上图是通知规则对接企微通知的示意逻辑图。

* 在告警规则中配置查询语句做阈值判定，同时关联一个通知规则，即这个告警规则生成的所有的告警，都交由这个通知规则进行分发。
* 通知规则可以配置不同的告警发给不同的通知媒介，比如Critical的告警打电话发短信，Warning的告警发邮件。本文演示企微告警，会把交由这个通知规则的所有告警事件都发送到企微群。
* 发企微消息的时候，可以指定消息模板和 Key，不同的团队可以自定义自己的消息模板，不同的 Key 即对应不同的企微机器人。

下面我们看看各部分是如何配置的。

### 告警规则

![](https://i-blog.csdnimg.cn/direct/32bed15495d9447fa4a9d4945daabd70.png)

我提前创建了一个通知规则，叫做“测试通知规则”。上图是告警规则的截图，上图中的告警规则关联了“测试通知规则”这个通知规则。

### 通知规则

![](https://i-blog.csdnimg.cn/direct/99e3649467004e5c9d39dccfe89fbcdc.png)

上图中的关键部分我用红框标注了出来：

* 授权团队：这个通知规则属于哪个团队，这个团队里的人可以管理这个通知规则。
* 通知媒介：这里我要测试企微通知方式，所以通知媒介选择的 Wecom，这个通知媒介已经内置到系统中了，夜莺启动后会自动创建。
* 消息模板：这里我选择了一个内置的消息模板 wecom，wecom 这个消息模板也是内置的，需要改，待会再说。
* Key：这个是企微机器人的 Key，这个需要自己创建一个企微机器人，Key 从企微机器人的 Webhook 地址中获取。
* Bot Name：这个是企微机器人的名字，随便填写，不太关键，因为 Key 不好记忆，名字可以帮助记忆。
* 适用级别：我这里测试是希望把所有级别的告警都发给企微，所以适用级别就全选了。
* 适用时段、使用标签、适用属性，都是过滤条件，每个字段旁边都有个小问号 tooltip，鼠标放上去可以看到说明，这里我都没填，就是不做任何过滤，所有事件都发给企微。

一个通知规则可以创建很多个通知媒介，后面你可以自行测试。

### 消息模板

![](https://i-blog.csdnimg.cn/direct/3deb3dd31ad54f06b9755e4fa368a932.png)

消息模板只改动一个地方，就是 domain 变量，改成你自己的夜莺的域名即可。之后企微中收到的消息里的那几个按钮（事件详情|屏蔽1小时|查询曲线）就可以用了。

### 最后的效果

![](https://i-blog.csdnimg.cn/direct/8062e55992544ca993ac659c84864fca.png)

v8.0.0-beta7 这个版本还不是特别完善，不过基本逻辑都有了，下个版本会更完善，支持企微 at 人的功能，敬请期待。