---
layout: post
title: "vscode一键编译运行cc程序"
date: 2025-03-06 21:35:50 +0800
description: "虽然我这里使用CMake，但是它只是一个用于编译生成可执行文件的工具，完全不影响将工具换成g++，gcc等，这套配置是完全通用的右上角一键编译运行的内部流程task.json格式概述launch.json格式概述CMake格式概述攒起来，组合成通用开发环境举例},},task.json中，在方括号中的，每一组用{ }括起来“东西”，都是一个task，也是这个文件真正要去执行的事。"
keywords: "【vscode】一键编译运行c/c++程序"
categories: ['编程语言']
tags: ['Vscode', 'Debug', 'Cmake', 'C', 'C']
artid: "146079646"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146079646
    alt: "vscode一键编译运行cc程序"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146079646
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146079646
cover: https://bing.ee123.net/img/rand?artid=146079646
image: https://bing.ee123.net/img/rand?artid=146079646
img: https://bing.ee123.net/img/rand?artid=146079646
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【vscode】一键编译运行c/c++程序
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     概述
    </h3>
    <p>
     虽然我这里使用CMake，但是它只是一个用于编译生成可执行文件的工具，完全不影响将工具换成g++，gcc等，这套
     <strong>
      配置是完全通用的
     </strong>
    </p>
    <ol>
     <li>
      右上角一键编译运行的内部流程
     </li>
     <li>
      task.json格式概述
     </li>
     <li>
      launch.json格式概述
     </li>
     <li>
      CMake格式概述
     </li>
     <li>
      攒起来，组合成通用开发环境
     </li>
    </ol>
    <h3>
     <a id="_9">
     </a>
     一键编译运行的内部流程
    </h3>
    <ol>
     <li>
      点击
      <code>
       运行 C/C++ 文件
      </code>
      (或按下F5)
     </li>
     <li>
      vscode调用launch.json挑选调试器、根据参数配置运行环境
     </li>
     <li>
      调用task.json生成可执行文件
     </li>
     <li>
      启动调试器，加载用task.json生成的可执行文件
     </li>
     <li>
      开始调试
     </li>
    </ol>
    <h3>
     <a id="taskjson_16">
     </a>
     task.json格式概述
    </h3>
    <ul>
     <li>
      举例
     </li>
    </ul>
    <pre><code class="prism language-json">		<span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"CMake: Build"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"cmake"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}/build"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"create"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
    <h4>
     <a id="_30">
     </a>
     概述
    </h4>
    <ol>
     <li>
      task.json中，在
      <strong>
       “tasks”: [ ]
      </strong>
      方括号中的，每一组用
      <strong>
       { }
      </strong>
      括起来“东西”，都是一个task，也是这个文件真正要去执行的事
     </li>
     <li>
      将一系列task组合起来，就可以实现一个完整的目标（有点类似于shell脚本，只不过shell以指令为单位，task.json以任务为单位）
     </li>
    </ol>
    <h4>
     <a id="_34">
     </a>
     具体变量解释
    </h4>
    <ol>
     <li>
      “label” 表示当前任务的名称，
     </li>
     <li>
      “type” 表示当前任务的类型，不同类型对应了该任务不同的执行的方式
      <ul>
       <li>
        “shell”，在终端执行；
       </li>
       <li>
        “process”，在一个新的进程中直接执行，常用于避免 shell 特定的行为或环境变量影响
       </li>
       <li>
        “customExecution”，使用一个扩展来提供自定义的任务执行逻辑
       </li>
       <li>
        “npm”，专门用于执行 npm 脚本
       </li>
      </ul>
     </li>
     <li>
      “command” 表示执行时要使用的指令
     </li>
     <li>
      “args” 表示执行指令时要输入的参数
     </li>
     <li>
      “cwd” 表示执行该任务的目录
     </li>
     <li>
      “dependsOn” 表示该任务依赖于其他什么任务，填入需要在此之前执行完的任务名称
     </li>
    </ol>
    <h4>
     <a id="taskjson_46">
     </a>
     完整task.json
    </h4>
    <p>
     实现了一个完整的清除build，重新编译生成的全流程
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"clean"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"rm"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"-r"</span><span class="token punctuation">,</span> <span class="token string">"build"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"create"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"mkdir"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"build"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"clean"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"CMake: Build"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"cmake"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}/build"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"create"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"make"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"command"</span><span class="token operator">:</span> <span class="token string">"make"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}/build"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"CMake: Build"</span><span class="token punctuation">]</span>  <span class="token comment">// make 依赖 CMake 生成 Makefile</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"label"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"clean"</span><span class="token punctuation">,</span> <span class="token string">"create"</span><span class="token punctuation">,</span> <span class="token string">"CMake: Build"</span><span class="token punctuation">,</span> <span class="token string">"make"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"dependsOrder"</span><span class="token operator">:</span> <span class="token string">"sequence"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       重点解释build任务
      </strong>
      <ul>
       <li>
        相当于将之前的所有任务都攒起来，变成一个完整的处理流程，launch只需要调用这个build任务，就可以完成一次清理并重建
       </li>
       <li>
        最后一个属性"dependsOrder": “sequence”，指定了依赖任务的执行顺序。表示所有前置任务将按照它们在 “dependsOn” 数组中出现的顺序依次执行。
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="launchjson_104">
     </a>
     launch.json格式概述
    </h3>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"CMake Debug"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"program"</span><span class="token operator">:</span> <span class="token string">"${fileDirname}/build/bsp"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token string-property property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token string-property property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"Enable pretty-printing for gdb"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">"miDebuggerPath"</span><span class="token operator">:</span> <span class="token string">"/usr/bin/gdb"</span><span class="token punctuation">,</span>
            <span class="token string-property property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"build"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="_135">
     </a>
     概述
    </h4>
    <p>
     launch很简单，只干三件事：
    </p>
    <ol>
     <li>
      定义如何启动调试器（GDB）
     </li>
     <li>
      调试前的构建任务（preLaunchTask）
     </li>
     <li>
      调试目标程序的位置
     </li>
    </ol>
    <h4>
     <a id="_140">
     </a>
     具体变量解释
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        <code>
         name
        </code>
       </strong>
       :
       <code>
        "CMake Debug"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 调试配置的名称，显示在 VS Code 调试器下拉列表中。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         type
        </code>
       </strong>
       :
       <code>
        "cppdbg"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 指定调试器类型为 C++ Debugger
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         request
        </code>
       </strong>
       :
       <code>
        "launch"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 表示启动一个新的程序进行调试（而非附加到已运行的进程）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         program
        </code>
       </strong>
       :
       <code>
        "${fileDirname}/build/bsp"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 指定要调试的
       <strong>
        可执行文件
       </strong>
       路径。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         stopAtEntry
        </code>
       </strong>
       :
       <code>
        false
       </code>
       <br/>
       <em>
        作用
       </em>
       : 是否在程序入口（如
       <code>
        main
       </code>
       函数）自动暂停。设为
       <code>
        false
       </code>
       表示直接运行程序。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         cwd
        </code>
       </strong>
       :
       <code>
        "${workspaceFolder}"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 调试程序的工作目录，此处设为工作区根目录。影响程序的文件读写路径（如相对路径的文件访问）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         externalConsole
        </code>
       </strong>
       :
       <code>
        false
       </code>
       <br/>
       <em>
        作用
       </em>
       : 是否在外部系统终端中运行程序。设为
       <code>
        false
       </code>
       表示使用 VS Code 内置终端。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         MIMode
        </code>
       </strong>
       :
       <code>
        "gdb"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 指定底层调试器为 GDB（GNU Debugger）。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         setupCommands
        </code>
       </strong>
       <br/>
       <em>
        作用
       </em>
       : 调试器启动时执行的初始化命令。通常我们不需要反汇编的，将自动生成的反汇编部分删除即可
      </p>
      <ul>
       <li>
        <code>
         text
        </code>
        : 向 GDB 发送
        <code>
         -enable-pretty-printing
        </code>
        命令，启用结构化数据（如 STL 容器）的友好显示。
       </li>
       <li>
        <code>
         ignoreFailures
        </code>
        : 即使命令执行失败，也不终止调试会话。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <code>
         miDebuggerPath
        </code>
       </strong>
       :
       <code>
        "/usr/bin/gdb"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 显式指定 GDB 的路径。缺省时，VS Code 会从系统环境变量中查找 GDB。
      </p>
     </li>
     <li>
      <p>
       <strong>
        <code>
         preLaunchTask
        </code>
       </strong>
       :
       <code>
        "build"
       </code>
       <br/>
       <em>
        作用
       </em>
       : 在启动调试前自动执行
       <code>
        tasks.json
       </code>
       中定义的
       <code>
        build
       </code>
       任务（如编译代码）。在上面的task.json中已经着重介绍过
       <code>
        build
       </code>
       任务了。
      </p>
     </li>
    </ul>
    <h4>
     <a id="CMake_174">
     </a>
     CMake格式概述
    </h4>
    <p>
     CMake本质就是告诉编译器如何编译（生成makefile）
     <br/>
     无非就是用相对简单的方式，管理结构比较复杂的程序，然后在不同平台的兼容性上相对好一些，和c_cpp_properties.json几乎是一样的功能
    </p>
    <pre><code class="prism language-CMakeLists"># 设置 CMake 最低版本要求
cmake_minimum_required(VERSION 3.10)

# 设置项目名称和编程语言
project(BSP_Project C)

# 添加头文件目录
include_directories(${CMAKE_SOURCE_DIR})

# 设置可执行文件输出目录（可选）
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/build)

# 添加可执行文件
add_executable(bsp 		# 生成的可执行文件的名称
    main.c 				# 两个用于生成可执行文件的源文件
    bsp.c
)
target_include_directories(bsp PUBLIC ${CMAKE_SOURCE_DIR})
</code></pre>
    <p>
     需要注意的是，生成的可执行文件名称，一定要和launch中的program对应，不然launch会找不到它
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35393437353031342f:61727469636c652f64657461696c732f313436303739363436" class_="artid" style="display:none">
 </p>
</div>


