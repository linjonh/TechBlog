---
layout: post
title: "服务器系统盘满了解决方法"
date: 2022-11-04 14:58:28 +0800
description: "现在云服务器厂商一般都会把系统盘和数据盘分开卖，系统盘一般都是50GB左右，尤其是Linux使用物理"
keywords: "服务器磁盘空间满了该如何处理"
categories: ['未分类']
tags: ['运维', '服务器', '容器', 'Linux', 'Docker']
artid: "127685777"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=127685777
  alt: "服务器系统盘满了解决方法"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=127685777
featuredImagePreview: https://bing.ee123.net/img/rand?artid=127685777
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     服务器系统盘满了（解决方法）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      问题描述
     </strong>
    </p>
    <p>
     现在云服务器厂商一般都会把系统盘和数据盘分开卖，系统盘一般都是50GB左右，尤其是Linux使用物理盘之前需提前初始化挂载硬盘，要不然就白买了，如果我们安装docker，默认的情况容器的默认存储路径会存储系统盘的/var/lib/docker目录下，我们的容器输出的所有的日志，文件，镜像，都会存在这个地方，时间久了就会占满系统盘，导致各种问题
    </p>
    <p>
     接下来我把我自己最常用的一种解决方法分享给大家，供大家参考
    </p>
    <p>
     <strong>
      解决方法：
     </strong>
    </p>
    <p>
     如果是服务器安装docker占用系统盘空间大，其他服务或者目录可以使用同样过程来解决
    </p>
    <p>
     <strong>
      1、首先需要我们添加一块数据盘
     </strong>
    </p>
    <p>
     如下图使用lsblk命令查看，我的系统盘有50G,数据盘有100G
    </p>
    <p>
     <img alt="" height="165" src="https://i-blog.csdnimg.cn/blog_migrate/bd76abc1fac390e564c7de26768ae4b5.png" width="763"/>
    </p>
    <p>
     <strong>
      2、格式化分区数据盘
     </strong>
    </p>
    <p>
     一般我们使用ext4类型来进行格式化磁盘
    </p>
    <p>
     mkfs.ext4 (磁盘的路径)
    </p>
    <p>
     <img alt="" height="438" src="https://i-blog.csdnimg.cn/blog_migrate/c76cbf50ba87065b089117b172b0891d.png" width="864"/>
    </p>
    <p>
     如以上界面格式化完成
    </p>
    <p>
     <strong>
      3、挂载磁盘
     </strong>
    </p>
    <p>
     命令格式：mount （磁盘目录） （要挂载的目录）
    </p>
    <p>
     <img alt="" height="68" src="https://i-blog.csdnimg.cn/blog_migrate/d09059ca6936284cb5707febd0e43c64.png" width="504"/>
    </p>
    <p>
     <strong>
      <span style="color:#fe2c24;">
       注意！！
      </span>
     </strong>
     一定要设置开机自动挂载，否则重启不生效
    </p>
    <pre><code class="language-bash">vim /etc/rc.local</code></pre>
    <p>
     <img alt="" height="269" src="https://i-blog.csdnimg.cn/blog_migrate/348fff4b2c2dd2bd3c04197fb8c4281e.png" width="663"/>
    </p>
    <p>
     添加可执行权限
    </p>
    <pre><code class="language-bash">chmod +x /etc/rc.local</code></pre>
    <p>
     <strong>
      4、查看磁盘占用情况
     </strong>
    </p>
    <p>
     使用df命令来查看磁盘使用情况
    </p>
    <p>
     <img alt="" height="358" src="https://i-blog.csdnimg.cn/blog_migrate/bf9b682b4f2193af2eb02c2ba3571ae5.png" width="1200"/>
    </p>
    <p>
     举个例子 ，比如我的docker占用系统盘内存过多，docker的默认存储路径在/var/lib/docker
    </p>
    <p>
     <strong>
      5、将docker服务停止
     </strong>
    </p>
    <p>
     停止docker服务
    </p>
    <pre><code class="language-bash">systemctl stop docker</code></pre>
    <p>
     <strong>
      6、移动/var/lib/docker目录到我们磁盘挂载的地方
     </strong>
    </p>
    <p>
     <img alt="" height="45" src="https://i-blog.csdnimg.cn/blog_migrate/d9de4eff25ab93d00af23e2ab8f1e0c2.png" width="533"/>
    </p>
    <p>
     <strong>
      7、创建软连接
      <span style="color:#fe2c24;">
       （一定要是绝对路径，不然不生效）
      </span>
     </strong>
    </p>
    <p>
     <img alt="" height="65" src="https://i-blog.csdnimg.cn/blog_migrate/a2807ac7a8a64f5005770d6d8f22372e.png" width="638"/>
    </p>
    <p>
     <span style="color:#fe2c24;">
      <strong>
       注意！删除软连接的时候，路径后面千万不要带/（否则会将原始目录下内容删除）
      </strong>
     </span>
    </p>
    <p>
     <strong>
      8、启动docker
     </strong>
    </p>
    <pre><code class="language-bash">systemctl start docker</code></pre>
    <p>
     <strong>
      9、验证是否成功使用df命令查看磁盘使用情况
     </strong>
    </p>
    <p>
     df查看
     <img alt="" height="649" src="https://i-blog.csdnimg.cn/blog_migrate/b09866c08adf6e445f0c57d008d42b3e.png" width="1200"/>
    </p>
    <p>
     可以看到 /opt目录下内存使用了百分之4，是从系统盘移动过来的，由此可见，以后docker就不会在使用系统盘的内存了
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36353330373733352f:61727469636c652f64657461696c732f313237363835373737" class_="artid" style="display:none">
 </p>
</div>
