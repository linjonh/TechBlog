---
layout: post
title: "SpringCloudSleuthMicrometerZipKin分布式链路追踪"
date: 2025-03-11 14:53:01 +0800
description: "SpringCloud——Sleuth(Micrometer)+ZipKin分布式链路追踪"
keywords: "SpringCloud——Sleuth(Micrometer)+ZipKin分布式链路追踪"
categories: ['Springcloud']
tags: ['分布式', 'Spring', 'Spring', 'Cloud']
artid: "146163668"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146163668
    alt: "SpringCloudSleuthMicrometerZipKin分布式链路追踪"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146163668
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146163668
cover: https://bing.ee123.net/img/rand?artid=146163668
image: https://bing.ee123.net/img/rand?artid=146163668
img: https://bing.ee123.net/img/rand?artid=146163668
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SpringCloud——Sleuth(Micrometer)+ZipKin分布式链路追踪
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     <span style="color:#0d0016">
      一、Sleuth 目前也进入维护模式
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）Sleuth 官宣，改头换面
     </span>
    </h3>
    <h3>
     <img alt="" height="423" src="https://i-blog.csdnimg.cn/direct/faa43f357459469ba37d1659f9acfb81.png" width="863"/>
    </h3>
    <h3>
     <span style="color:#0d0016">
      （2）Sleuth 未来替换方案
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      Micrometer Tracing
     </span>
    </p>
    <h2>
     <span style="color:#0d0016">
      二、分布式链路追踪概述
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）为什么会出现这个技术？需要解决哪些问题？
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      在微服务框架中，
     </span>
     <span style="color:#fe2c24">
      <u>
       <em>
        一个由客户端发起的请求在后端系统中会经过
        <strong>
         多个不同的的服务节点
        </strong>
        调用来
        <strong>
         协同
        </strong>
        产生最后的请求结果
       </em>
      </u>
     </span>
     <span style="color:#0d0016">
      ，每一个前段请求都会形成一条复杂的
     </span>
     <span style="color:#fe2c24">
      <strong>
       分布式服务调用链路
      </strong>
     </span>
     <span style="color:#0d0016">
      ，链路中的
     </span>
     <span style="color:#fe2c24">
      <u>
       <em>
        任何一环出现
        <strong>
         高延时
        </strong>
        或
        <strong>
         错误
        </strong>
        都会引起整个请求最后的失败
       </em>
      </u>
     </span>
     <img alt="" height="369" src="https://i-blog.csdnimg.cn/direct/b9fa4621d32a48d48106a5ca1a5c384e.png" width="534"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （2）随着问题的复杂化 + 微服务的增多 + 调用链条的变长
     </span>
    </h3>
    <p>
     <img alt="" height="538" src="https://i-blog.csdnimg.cn/direct/06c9c2861a2d45ceb6e8d3dbe1f4fd5d.png" width="563"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （3）在分布式与微服务场景下需要解决的问题
     </span>
    </h3>
    <ol>
     <li>
      在分布式与微服务场景下，
      <strong>
       <span style="color:#fe2c24">
        我们需要解决如下问题
       </span>
      </strong>
      ：
      <ol>
       <li>
        在大规模分布式与微服务集群下，如何实时观测
        <strong>
         <span style="color:#fe2c24">
          系统的整体调用链路情况
         </span>
        </strong>
       </li>
       <li>
        在大规模分布式与微服务集群下，如何
        <strong>
         <span style="color:#fe2c24">
          快速发现并定位到问题
         </span>
        </strong>
       </li>
       <li>
        在大规模分布式与微服务集群下，如何尽可能精确的判断
        <strong>
         <span style="color:#fe2c24">
          故障对系统的影响范围与影响程度
         </span>
        </strong>
       </li>
       <li>
        在大规模分布式与微服务集群下，如何尽可能精确的梳理出
        <strong>
         <span style="color:#fe2c24">
          服务之间的依赖关系
         </span>
        </strong>
        ，并判断出服务之间的依赖关系是否合理
       </li>
       <li>
        在大规模分布式与微服务集群下，如何尽可能精确的分析
        <strong>
         <span style="color:#fe2c24">
          整个系统调用链路的性能与瓶颈点
         </span>
        </strong>
       </li>
       <li>
        在大规模分布式与微服务集群下，如何尽可能精确的分析
        <strong>
         <span style="color:#fe2c24">
          系统的存储瓶颈与容量规划
         </span>
        </strong>
       </li>
      </ol>
     </li>
     <li>
      上述问题就是我们的落地议题答案：分布式链路追踪技术要解决的问题，分布式链路追踪（Distributed Tracing），就是
      <span style="color:#fe2c24">
       <u>
        <em>
         将一次分布式请求还原成调用链路，进行日志记录，性能监控并将一次分布式请求的调用情况集中展示
        </em>
       </u>
      </span>
      。比如各个服务节点上的耗时、请求具体到达哪台机器上、每个服务节点的请求状态等等
     </li>
    </ol>
    <h2>
     <span style="color:#0d0016">
      三、新一代 Spring Cloud Sleuth：Micrometer
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）(官网重要提示)
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      3.1.1新一代 Sleuth
     </span>
    </h4>
    <ol>
     <li>
      sleuth 被 micrometer 替代
      <img alt="" height="533" src="https://i-blog.csdnimg.cn/direct/77a49b34ad2c48f29930dea22d292ceb.png" width="1334"/>
     </li>
     <li>
      <a href="https://micrometer.io/docs/tracing" rel="nofollow" title="https://micrometer.io/docs/tracing">
       https://micrometer.io/docs/tracing
      </a>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      3.1.2官网
     </span>
    </h4>
    <ol>
     <li>
      <a href="https://spring.io/projects/spring-cloud-sleuth#overview" rel="nofollow" title="Spring Cloud Sleuth">
       Spring Cloud Sleuth
      </a>
     </li>
     <li>
      github：
      <a href="https://github.com/spring-cloud/spring-cloud-sleuth" title="https://github.com/spring-cloud/spring-cloud-sleuth">
       https://github.com/spring-cloud/spring-cloud-sleuth
      </a>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      3.1.3说明
     </span>
    </h4>
    <ol>
     <li>
      老项目还能用 Sleuth 开发吗
      <img alt="" height="423" src="https://i-blog.csdnimg.cn/direct/e482eb4552884d0dbba21bf744890aa5.png" width="863"/>
     </li>
     <li>
      版本注意
      <img alt="" height="575" src="https://i-blog.csdnimg.cn/direct/33b3c50669b04e938c92d15dd86b635d.png" width="871"/>
     </li>
    </ol>
    <ul>
    </ul>
    <h3>
     <span style="color:#0d0016">
      （2）zipkin 那？
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      Spring Cloud Sleuth (
     </span>
     <span style="color:#fe2c24">
      <strong>
       micrometer
      </strong>
     </span>
     <span style="color:#0d0016">
      )
     </span>
     <strong>
      <span style="color:#fe2c24">
       提供
      </span>
     </strong>
     <span style="color:#0d0016">
      了一套完整的分布式链路追踪（Distributed Tracing）解决方案且兼容支持了
     </span>
     <span style="color:#fe2c24">
      <strong>
       zipkin 展现
      </strong>
     </span>
     <img alt="" height="39" src="https://i-blog.csdnimg.cn/direct/4cc26a5fac0d46cfa7ed20639c2dbda2.png" width="846">
      <img alt="" height="459" src="https://i-blog.csdnimg.cn/direct/cf8640a2f14c4c7890f79e378b51dfa9.png" width="533"/>
     </img>
    </p>
    <h3>
     <span style="color:#0d0016">
      （3）小总结
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      将一次分布式请求还原成调用链路，进行日志记录和性能监控，并将一次分布式请求的调用情况集中 web 展示
     </span>
     <img alt="" height="115" src="https://i-blog.csdnimg.cn/direct/40dec6742c034ef8ae6de775befd59c2.png" width="1199"/>
    </p>
    <h3>
     <span style="color:#0d0016">
      （4）行业内比较成熟的其它分布式链路追踪技术解决方案
     </span>
    </h3>
    <p>
     <img alt="" height="295" src="https://i-blog.csdnimg.cn/direct/954f832166544b5ea30e3afdad3b4891.png" width="842"/>
    </p>
    <h2>
     <span style="color:#0d0016">
      四、分布式链路追踪原理
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）假定 3 个微服务调用的链路
     </span>
    </h3>
    <p>
     <img alt="" height="254" src="https://i-blog.csdnimg.cn/direct/d1ebfde13ca14b78ad0fad56c8cae05c.png" width="771"/>
    </p>
    <p>
     <span style="color:#0d0016">
      假定三个微服务调用的链路如下图所示：Service 1 调用 Service 2，Service 2 调用 Service 3 和 Service 4
     </span>
    </p>
    <h3>
     <span style="color:#0d0016">
      （2）上一步完整的调用链路
     </span>
    </h3>
    <ol>
     <li>
      <span style="color:#0d0016">
       那么一条链路追踪会在每个服务调用的时候加上Trace ID 和 Span ID
      </span>
     </li>
     <li>
      <span style="color:#0d0016">
       链路通过TraceId唯一标识
      </span>
     </li>
     <li>
      <span style="color:#0d0016">
       Span标识发起的请求信息，各span通过parent id 关联起来（Span:表示调用链路来源，通俗的理解span就是一次请求信息）
      </span>
      <img alt="" height="99" src="https://i-blog.csdnimg.cn/direct/87ea2a4652b345de96c8101838e33601.png" width="1195"/>
      <img alt="" height="475" src="https://i-blog.csdnimg.cn/direct/a1f2d71f05ed49ac8539a6b750f96a45.png" width="891"/>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （3）彻底把链路追踪整明白
     </span>
    </h3>
    <ol>
     <li>
      一条链路通过Trace Id唯一标识，Span标识发起的请求信息，各span通过parent id 关联起来
      <img alt="" height="299" src="https://i-blog.csdnimg.cn/direct/bd1fd6c2ce40485c88a38ad90ad77532.png" width="944"/>
     </li>
     <li>
      解读：
      <img alt="" height="434" src="https://i-blog.csdnimg.cn/direct/34e1a2918cff45fbaaaf6fd1dcb6ef66.png" width="1253"/>
     </li>
    </ol>
    <h2>
     <span style="color:#0d0016">
      五、Zipkin
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）官网
     </span>
    </h3>
    <p>
     <a href="https://zipkin.io/" rel="nofollow" title="          OpenZipkin · A distributed tracing system      ">
      OpenZipkin · A distributed tracing system
     </a>
    </p>
    <h3>
     <span style="color:#0d0016">
      （2）是什么
     </span>
     <img alt="" height="565" src="https://i-blog.csdnimg.cn/direct/c16a507ca18e434e81a76ecb206b2af2.png" width="649"/>
    </h3>
    <p>
     <span style="color:#0d0016">
      Zipkin 是 Twitter 开源的分布式链路跟踪工具，用于
     </span>
     <strong>
      <span style="color:#fe2c24">
       收集
      </span>
     </strong>
     <span style="color:#0d0016">
      微服务运行中的实时调用链路
     </span>
     <span style="color:#fe2c24">
      <strong>
       信息
      </strong>
     </span>
     <span style="color:#0d0016">
      ，
     </span>
     <span style="color:#fe2c24">
      <strong>
       通过 Web 图形化界面展示
      </strong>
     </span>
     <span style="color:#0d0016">
      ，助力开发人员分析链路性能瓶颈、定位问题应用，进而解决问题
     </span>
    </p>
    <h3>
     <span style="color:#0d0016">
      （3）Zipkin 为什么出现？
     </span>
    </h3>
    <p>
     <span style="color:#0d0016">
      单有 Sleuth (Micrometer) 行不行？
     </span>
     <img alt="" height="213" src="https://i-blog.csdnimg.cn/direct/9d7c59809e124fddb0a5760a823a3e73.png" width="923"/>
    </p>
    <ol>
     <li>
      说明：当没有配置 Sleuth 链路追踪的时候，INFO 信息里面是 [passjava-question,,,]，后面跟着三个空字符串
     </li>
     <li>
      当配置了 Sleuth 链路追踪的时候，追踪到的信息是 [passjava-question,504a5360ca906016,e55ff064b3941956,false] ，第一个是 Trace ID，第二个是 Span ID。
      <span style="color:#fe2c24">
       <strong>
        只有日志没有图，观看不方便，不美观，so，
       </strong>
      </span>
      引入图形化Zipkin链路监控让你好看
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （4）下载 + 安装 + 运行一套带走
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      5.4.1下载主页
     </span>
    </h4>
    <ol>
     <li>
      <a href="https://zipkin.io/pages/quickstart" rel="nofollow" title="          Quickstart · OpenZipkin      ">
       Quickstart · OpenZipkin
      </a>
     </li>
     <li>
      支持三个方式：
      <img alt="" height="348" src="https://i-blog.csdnimg.cn/direct/52843acbd9d7417bb54cd0341fbcebe0.png" width="733"/>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      5.4.2下载地址
     </span>
    </h4>
    <p>
     <img alt="" height="232" src="https://i-blog.csdnimg.cn/direct/0a99f1c630854fab9a7326ea90c8a9ff.png" width="761"/>
    </p>
    <ol>
     <li>
      点击
      <span style="color:#fe2c24">
       <strong>
        latest release
       </strong>
      </span>
      即可下载
     </li>
     <li>
      zipkin-server-3.5.0-rc0-exec.jar
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      5.4.3运行jar
     </span>
    </h4>
    <pre><code class="hljs">java -jar zipkin-server-3.5.0-exec.jar</code></pre>
    <p>
     <img alt="" height="898" src="https://i-blog.csdnimg.cn/direct/28ca9a8914fc4800b8be896a0a214ad0.png" width="1143"/>
     <img alt="" height="215" src="https://i-blog.csdnimg.cn/direct/bb51c53c742a4648a4e1eb1b7963ce0e.png" width="1446"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      5.4.4运行控制台
     </span>
    </h4>
    <p>
     <a href="http://localhost:9411/zipkin/" rel="nofollow" title="http://localhost:9411/zipkin/">
      http://localhost:9411/zipkin/
     </a>
     <img alt="" height="1044" src="https://i-blog.csdnimg.cn/direct/d1000c64658f4122b6c58f1c6182b3c0.png" width="2559"/>
    </p>
    <h2>
     <span style="color:#0d0016">
      六、Micrometer+ZipKin 搭建链路监控案例步骤
     </span>
    </h2>
    <h3>
     <span style="color:#0d0016">
      （1）Micrometer+ZipKin 两者各自的分工
     </span>
    </h3>
    <ol>
     <li>
      <strong>
       Micrometer
      </strong>
      ：数据采样
     </li>
     <li>
      <strong>
       ZipKin
      </strong>
      ：图形展示
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （2）步骤
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      6.2.1总体父工程 POM
     </span>
    </h4>
    <ol>
     <li>
      <span style="color:#0d0016">
       本案例：
      </span>
      <pre><code class="language-XML">&lt;!--micrometer-tracing-bom导入链路追踪版本中心  1--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-tracing-bom&lt;/artifactId&gt;
    &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
    &lt;scope&gt;import&lt;/scope&gt;
&lt;/dependency&gt;
&lt;!--micrometer-tracing指标追踪  2--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt;
    &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt;
    &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--micrometer-observation 4--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt;
    &lt;version&gt;${micrometer-observation.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--feign-micrometer 5--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;
    &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt;
    &lt;version&gt;${feign-micrometer.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--zipkin-reporter-brave 6--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt;
    &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt;
    &lt;version&gt;${zipkin-reporter-brave.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
      <p>
       <img alt="" height="683" src="https://i-blog.csdnimg.cn/direct/923d53154ab443d2a4999f26ed94c4fc.png" width="1256"/>
       <img alt="" height="268" src="https://i-blog.csdnimg.cn/direct/1dc76e76051f45dfbb6a8a6282d7742c.png" width="1191"/>
       <img alt="" height="155" src="https://i-blog.csdnimg.cn/direct/4dee3b535b8b43e89ea998a2d483b043.png" width="994"/>
      </p>
     </li>
     <li>
      <span style="color:#0d0016">
       all：
      </span>
      <pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.atguigu.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;mscloudV6&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;modules&gt;
        &lt;module&gt;cloud-provider-payment8001&lt;/module&gt;
        &lt;module&gt;cloud-consumer-order80&lt;/module&gt;
        &lt;module&gt;cloud-api-commons&lt;/module&gt;
        &lt;module&gt;cloud-provider-payment8002&lt;/module&gt;
        &lt;module&gt;cloud-consumer-feign-order80&lt;/module&gt;
    &lt;/modules&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;hutool.version&gt;5.8.22&lt;/hutool.version&gt;
        &lt;lombok.version&gt;1.18.26&lt;/lombok.version&gt;
        &lt;druid.version&gt;1.1.20&lt;/druid.version&gt;
        &lt;mybatis.springboot.version&gt;3.0.2&lt;/mybatis.springboot.version&gt;
        &lt;mysql.version&gt;8.0.11&lt;/mysql.version&gt;
        &lt;swagger3.version&gt;2.2.0&lt;/swagger3.version&gt;
        &lt;mapper.version&gt;4.2.3&lt;/mapper.version&gt;
        &lt;fastjson2.version&gt;2.0.41&lt;/fastjson2.version&gt;
        &lt;persistence-api.version&gt;1.0.2&lt;/persistence-api.version&gt;
        &lt;spring.boot.test.version&gt;3.1.5&lt;/spring.boot.test.version&gt;
        &lt;spring.boot.version&gt;3.2.0&lt;/spring.boot.version&gt;
        &lt;spring.cloud.version&gt;2023.0.0&lt;/spring.cloud.version&gt;
        &lt;spring.cloud.alibaba.version&gt;2022.0.0.0-RC2&lt;/spring.cloud.alibaba.version&gt;
        &lt;micrometer-tracing.version&gt;1.2.0&lt;/micrometer-tracing.version&gt;
        &lt;micrometer-observation.version&gt;1.12.0&lt;/micrometer-observation.version&gt;
        &lt;feign-micrometer.version&gt;12.5&lt;/feign-micrometer.version&gt;
        &lt;zipkin-reporter-brave.version&gt;2.17.0&lt;/zipkin-reporter-brave.version&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;!--springboot 3.2.0--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
                &lt;version&gt;${spring.boot.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!--springcloud 2023.0.0--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring.cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!--springcloud alibaba 2022.0.0.0-RC2--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring.cloud.alibaba.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!--SpringBoot集成mybatis--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;${mybatis.springboot.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--Mysql数据库驱动8 --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;mysql&lt;/groupId&gt;
                &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
                &lt;version&gt;${mysql.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--SpringBoot集成druid连接池--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
                &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;${druid.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--通用Mapper4之tk.mybatis--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
                &lt;artifactId&gt;mapper&lt;/artifactId&gt;
                &lt;version&gt;${mapper.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--persistence--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;javax.persistence&lt;/groupId&gt;
                &lt;artifactId&gt;persistence-api&lt;/artifactId&gt;
                &lt;version&gt;${persistence-api.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!-- fastjson2 --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt;
                &lt;artifactId&gt;fastjson2&lt;/artifactId&gt;
                &lt;version&gt;2.0.40&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!-- swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springdoc&lt;/groupId&gt;
                &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;
                &lt;version&gt;${swagger3.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--hutool--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
                &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
                &lt;version&gt;${hutool.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--lombok--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                &lt;version&gt;${lombok.version}&lt;/version&gt;
                &lt;optional&gt;true&lt;/optional&gt;
            &lt;/dependency&gt;
            &lt;!-- spring-boot-starter-test --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
                &lt;version&gt;${spring.boot.test.version}&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!--micrometer-tracing-bom导入链路追踪版本中心  1--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
                &lt;artifactId&gt;micrometer-tracing-bom&lt;/artifactId&gt;
                &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!--micrometer-tracing指标追踪  2--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
                &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt;
                &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 3--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
                &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt;
                &lt;version&gt;${micrometer-tracing.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--micrometer-observation 4--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
                &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt;
                &lt;version&gt;${micrometer-observation.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--feign-micrometer 5--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;
                &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt;
                &lt;version&gt;${feign-micrometer.version}&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!--zipkin-reporter-brave 6--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt;
                &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt;
                &lt;version&gt;${zipkin-reporter-brave.version}&lt;/version&gt;
            &lt;/dependency&gt;

        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
&lt;/project&gt;</code></pre>
     </li>
    </ol>
    <h4 style="background-color:transparent">
     <span style="color:#0d0016">
      6.2.2服务提供者 8001
     </span>
    </h4>
    <ol>
     <li>
      cloud-provider-payment8001
     </li>
     <li>
      POM
      <pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.atguigu.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;mscloudV6&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;cloud-provider-payment8001&lt;/artifactId&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;



    &lt;dependencies&gt;
        &lt;!--micrometer-tracing指标追踪  1--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
            &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 2--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
            &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--micrometer-observation 3--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
            &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--feign-micrometer 4--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;
            &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--zipkin-reporter-brave 5--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt;
            &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--SpringCloud consul config--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-config&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--SpringCloud consul discovery --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- 引入自己定义的api通用包 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.atguigu.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--SpringBoot通用依赖模块--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--SpringBoot集成druid连接池--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Swagger3 调用方式 http://你的主机IP地址:5555/swagger-ui/index.html --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;
            &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--mybatis和springboot整合--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--Mysql数据库驱动8 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--persistence--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.persistence&lt;/groupId&gt;
            &lt;artifactId&gt;persistence-api&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--通用Mapper4--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mapper&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--hutool--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- fastjson2 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.fastjson2&lt;/groupId&gt;
            &lt;artifactId&gt;fastjson2&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--lombok--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.18.28&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--test--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;</code></pre>
     </li>
     <li>
      YML
      <img alt="" height="264" src="https://i-blog.csdnimg.cn/direct/98d837d9fb4048978d3daef073a25196.png" width="948"/>
      <img alt="" height="323" src="https://i-blog.csdnimg.cn/direct/42edb2c92304499ca4c27de0e9957fc1.png" width="1197"/>
     </li>
     <li>
      新建业务类PayMicrometerController
      <img alt="" height="574" src="https://i-blog.csdnimg.cn/direct/3a0904aacbe246f58035cba1237c5fda.png" width="1288"/>
     </li>
    </ol>
    <h4>
     <span style="color:#0d0016">
      6.2.3Api 接口 PayFeignApi
     </span>
     <img alt="" height="830" src="https://i-blog.csdnimg.cn/direct/6c9862458a3845988081fad6886896f3.png" width="1260"/>
    </h4>
    <h4>
     <span style="color:#0d0016">
      6.2.4服务调用者 80
     </span>
    </h4>
    <ol>
     <li>
      cloud-consumer-feign-order80
     </li>
     <li>
      POM新增
      <pre><code class="language-XML">&lt;!--micrometer-tracing指标追踪  1--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
        &lt;artifactId&gt;micrometer-tracing&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!--micrometer-tracing-bridge-brave适配zipkin的桥接包 2--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
        &lt;artifactId&gt;micrometer-tracing-bridge-brave&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!--micrometer-observation 3--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
        &lt;artifactId&gt;micrometer-observation&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!--feign-micrometer 4--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;
        &lt;artifactId&gt;feign-micrometer&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;!--zipkin-reporter-brave 5--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.zipkin.reporter2&lt;/groupId&gt;
        &lt;artifactId&gt;zipkin-reporter-brave&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
     </li>
     <li>
      YML
      <img alt="" height="259" src="https://i-blog.csdnimg.cn/direct/627220082d824124b73416d9fccbe0c8.png" width="971"/>
     </li>
     <li>
      新建业务类 OrderMicrometerController
      <img alt="" height="685" src="https://i-blog.csdnimg.cn/direct/4d4336759d404a049f95636892e5a734.png" width="1386"/>
     </li>
    </ol>
    <h3>
     <span style="color:#0d0016">
      （3）测试
     </span>
    </h3>
    <h4>
     <span style="color:#0d0016">
      6.2.1本次案例，默认已经成功启动 Zipkin
     </span>
    </h4>
    <h4>
     <span style="color:#0d0016">
      6.2.2依次启动 8001/80 两个微服务并注册进入 Consul
     </span>
    </h4>
    <p>
     <img alt="" height="635" src="https://i-blog.csdnimg.cn/direct/40a3ae7cbd0c4601a2ed1ce0de8beda3.png" width="2559"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      6.2.3测试地址
     </span>
    </h4>
    <p>
     <img alt="" height="244" src="https://i-blog.csdnimg.cn/direct/425ccfb68b9f400c87c5548c06530511.png" width="1045"/>
    </p>
    <h4>
     <span style="color:#0d0016">
      6.2.4打开浏览器访问
     </span>
    </h4>
    <ol>
     <li>
      会出现以下界面：
      <img alt="" height="555" src="https://i-blog.csdnimg.cn/direct/34102d47239749c0949378d60fd934f4.png" width="1360"/>
     </li>
     <li>
      点击SHOW按钮查看
      <img alt="" height="1026" src="https://i-blog.csdnimg.cn/direct/470ef99751ad4b5a83f3432576167896.png" width="2534"/>
     </li>
     <li>
      查看依赖关系：
      <img alt="" height="561" src="https://i-blog.csdnimg.cn/direct/d4eeffe016f1470280c4a0e84bbf57df.png" width="1360"/>
     </li>
    </ol>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37343031393037392f:61727469636c652f64657461696c732f313436313633363638" class_="artid" style="display:none">
 </p>
</div>


