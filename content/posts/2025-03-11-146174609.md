---
layout: post
title: "最佳实践Go-责任链模式实现参数校验"
date: 2025-03-11 16:00:00 +0800
description: "这里我们使用责任链模式来创建一个参数校验的示例。在这个示例中，我们将实现一个简单的责任链来校验不同的参数条件。这种模式允许我们将多个校验步骤串联在一起，以便可以在不同的条件下进行灵活的校验。"
keywords: "【最佳实践】Go 责任链模式实现参数校验"
categories: ['Go']
tags: ['责任链模式', '服务器', 'Golang']
artid: "146174609"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146174609
    alt: "最佳实践Go-责任链模式实现参数校验"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146174609
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146174609
cover: https://bing.ee123.net/img/rand?artid=146174609
image: https://bing.ee123.net/img/rand?artid=146174609
img: https://bing.ee123.net/img/rand?artid=146174609
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【最佳实践】Go 责任链模式实现参数校验
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     这里我们使用责任链模式来创建一个参数校验的示例。在这个示例中，我们将实现一个简单的责任链来校验不同的参数条件。这种模式允许我们将多个校验步骤串联在一起，以便可以在不同的条件下进行灵活的校验。
    </p>
    <h4>
     <a id="_2">
     </a>
     设计思路
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        接口定义 (
        <code>
         Validator
        </code>
        )
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         目的
        </strong>
        ：定义责任链中每个节点的基本行为。
       </li>
       <li>
        <strong>
         设计思想
        </strong>
        ：接口包含三个方法：
        <ul>
         <li>
          <code>
           Validate(params *Params) error
          </code>
          ：执行具体的校验逻辑。
         </li>
         <li>
          <code>
           SetNext(v Validator) Validator
          </code>
          ：设置链中的下一个校验节点，实现链式调用。
         </li>
         <li>
          <code>
           Execute(params *Params) error
          </code>
          ：执行当前节点的
          <code>
           Validate
          </code>
          方法，并继续执行链中的下一个节点。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        复用机制 (
        <code>
         BaseValidator
        </code>
        )
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         目的
        </strong>
        ：通过合成复用来实现校验链的连接机制。
       </li>
       <li>
        <strong>
         设计思想
        </strong>
        ：
        <code>
         BaseValidator
        </code>
        是一个可复用的结构体，包含
        <code>
         nextValidator
        </code>
        字段（用于指向链中的下一个校验节点）和实现
        <code>
         SetNext
        </code>
        、
        <code>
         Execute
        </code>
        方法。任何实现了
        <code>
         Validator
        </code>
        接口的结构体都可以通过嵌入
        <code>
         BaseValidator
        </code>
        来获得这些方法。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        具体校验器
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         目的
        </strong>
        ：每个校验器负责校验请求中的某一特定参数。
       </li>
       <li>
        <strong>
         设计思想
        </strong>
        ：
        <ul>
         <li>
          例如，
          <code>
           NonEmptyValidator
          </code>
          用于检查字符串是否为空，
          <code>
           PositiveNumberValidator
          </code>
          用于检查数字是否为正。
         </li>
         <li>
          这些校验器通过嵌入
          <code>
           BaseValidator
          </code>
          来获得链式调用的能力。
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        链式调用
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         目的
        </strong>
        ：通过链式调用初始化责任链，使代码结构清晰，增强可读性。
       </li>
       <li>
        <strong>
         设计思想
        </strong>
        ：通过
        <code>
         SetNext
        </code>
        方法将各个校验器连接起来，使得责任链的逻辑关系一目了然。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        扩展性
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         目的
        </strong>
        ：轻松扩展系统功能，支持更多的校验逻辑。
       </li>
       <li>
        <strong>
         设计思想
        </strong>
        ：由于责任链是动态配置的，可以方便地添加、移除或重排校验器节点，而无需修改现有代码结构。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_30">
     </a>
     案例代码
    </h4>
    <p>
     以下是一个基于责任链模式的参数校验示例：
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
<span class="token punctuation">)</span>

<span class="token comment">// Validator 接口定义了校验器的基本行为</span>
<span class="token keyword">type</span> Validator <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">Validate</span><span class="token punctuation">(</span>params <span class="token operator">*</span>Params<span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">SetNext</span><span class="token punctuation">(</span>v Validator<span class="token punctuation">)</span> Validator
	<span class="token function">Execute</span><span class="token punctuation">(</span>params <span class="token operator">*</span>Params<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token comment">// BaseValidator 复用结构体，实现 Validator 接口的 SetNext 和 Execute 方法</span>
<span class="token keyword">type</span> BaseValidator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	nextValidator Validator
<span class="token punctuation">}</span>

<span class="token comment">// SetNext 设置下一个校验器</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>BaseValidator<span class="token punctuation">)</span> <span class="token function">SetNext</span><span class="token punctuation">(</span>v Validator<span class="token punctuation">)</span> Validator <span class="token punctuation">{<!-- --></span>
	b<span class="token punctuation">.</span>nextValidator <span class="token operator">=</span> v
	<span class="token keyword">return</span> v
<span class="token punctuation">}</span>

<span class="token comment">// Execute 执行当前校验和后续校验</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>BaseValidator<span class="token punctuation">)</span> <span class="token function">Execute</span><span class="token punctuation">(</span>params <span class="token operator">*</span>Params<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> b<span class="token punctuation">.</span>nextValidator <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> b<span class="token punctuation">.</span>nextValidator<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> b<span class="token punctuation">.</span>nextValidator<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// Params 结构体包含需要校验的参数</span>
<span class="token keyword">type</span> Params <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name  <span class="token builtin">string</span>
	Age   <span class="token builtin">int</span>
	Email <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// NonEmptyValidator 校验字符串是否为空</span>
<span class="token keyword">type</span> NonEmptyValidator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	BaseValidator
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>v <span class="token operator">*</span>NonEmptyValidator<span class="token punctuation">)</span> <span class="token function">Validate</span><span class="token punctuation">(</span>params <span class="token operator">*</span>Params<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> params<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"name cannot be empty"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// PositiveNumberValidator 校验数字是否为正</span>
<span class="token keyword">type</span> PositiveNumberValidator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	BaseValidator
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>v <span class="token operator">*</span>PositiveNumberValidator<span class="token punctuation">)</span> <span class="token function">Validate</span><span class="token punctuation">(</span>params <span class="token operator">*</span>Params<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> params<span class="token punctuation">.</span>Age <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"age must be a positive number"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// EmailFormatValidator 校验邮件格式（简单示例）</span>
<span class="token keyword">type</span> EmailFormatValidator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	BaseValidator
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>v <span class="token operator">*</span>EmailFormatValidator<span class="token punctuation">)</span> <span class="token function">Validate</span><span class="token punctuation">(</span>params <span class="token operator">*</span>Params<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> params<span class="token punctuation">.</span>Email <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">contains</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>Email<span class="token punctuation">,</span> <span class="token string">"@"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"invalid email format"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// contains 是一个简单的字符串包含判断函数</span>
<span class="token keyword">func</span> <span class="token function">contains</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> substr <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">len</span><span class="token punctuation">(</span>substr<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>substr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> substr <span class="token operator">||</span> <span class="token function">contains</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> substr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	params <span class="token operator">:=</span> <span class="token operator">&amp;</span>Params<span class="token punctuation">{<!-- --></span>
		Name<span class="token punctuation">:</span>  <span class="token string">"John Doe"</span><span class="token punctuation">,</span>
		Age<span class="token punctuation">:</span>   <span class="token number">30</span><span class="token punctuation">,</span>
		Email<span class="token punctuation">:</span> <span class="token string">"johndoe@example.com"</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 初始化校验链</span>
	validator <span class="token operator">:=</span> <span class="token operator">&amp;</span>NonEmptyValidator<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	validator<span class="token punctuation">.</span><span class="token function">SetNext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>PositiveNumberValidator<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">SetNext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EmailFormatValidator<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 执行校验</span>
	err <span class="token operator">:=</span> validator<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Validation failed:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Validation succeeded"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f73696e61745f34313838333938352f:61727469636c652f64657461696c732f313436313734363039" class_="artid" style="display:none">
 </p>
</div>


