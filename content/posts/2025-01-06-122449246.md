---
layout: post
title: "微信小程序-连接云数据库不使用云函数进行-登录注册查询包括模糊查询快速实现-亲测可用"
date: 2025-01-06 20:36:47 +0800
description: "当连接MySQL的时候总是出现各种各样的小问题，可以选用微信小程序自带的云数据库目 录建立云数据库建"
keywords: "微信小程序不使用云开发连接数据库"
categories: ['微信小程序']
tags: ['数据库', '微信小程序', '小程序']
artid: "122449246"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122449246
    alt: "微信小程序-连接云数据库不使用云函数进行-登录注册查询包括模糊查询快速实现-亲测可用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122449246
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122449246
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序 连接云数据库（不使用云函数）进行 登录、注册、查询（包括模糊查询）快速实现 亲测可用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     当连接MySQL的时候总是出现各种各样的小问题，可以选用微信小程序自带的云数据库
     <br/>
    </p>
    <div class="toc">
     <h4>
      目 录
     </h4>
     <ul>
      <li>
       <a href="#_2" rel="nofollow">
        建立云数据库
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_6" rel="nofollow">
          建表
         </a>
        </li>
        <li>
         <a href="#MySQL_15" rel="nofollow">
          导入MySQL中的表
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#_16" rel="nofollow">
            导出
           </a>
          </li>
          <li>
           <a href="#_20" rel="nofollow">
            导入
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_23" rel="nofollow">
          云数据库初始化
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_52" rel="nofollow">
        登录注册
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_54" rel="nofollow">
          注册功能
         </a>
        </li>
        <li>
         <a href="#_78" rel="nofollow">
          登录功能
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_143" rel="nofollow">
        查询（模糊查找）
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     建立云数据库
    </h2>
    <p>
     注：测试号不能建立云数据库
     <br/>
     按图中步骤来
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bb752da17dbe4d770adf42d4e16c3b26.png"/>
    </p>
    <h3>
     <a id="_6">
     </a>
     建表
    </h3>
    <p>
     第4步中，有两种添加方式
     <br/>
     <strong>
      第一种
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3ea2dd07556533dd68c1fdc8e746f9ac.png">
      <br/>
      <strong>
       第二种
      </strong>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/838d5e940c4e49874b39e78125dbfbc6.png">
       <br/>
       注意：
       <br/>
       如果你是粘贴复制的，他会报错
       <code>
        非数字字符"无法使用外部字符串表示法位于第1行
       </code>
       。这时，在第一行的
       <code>
        {
        <!-- -->
       </code>
       后敲个回车就可以通过了。
      </img>
     </img>
    </p>
    <h3>
     <a id="MySQL_15">
     </a>
     导入MySQL中的表
    </h3>
    <h4>
     <a id="_16">
     </a>
     导出
    </h4>
    <p>
     在SQLyog中，选中你要导出的表，右键，备份/导出—导出表数据作为
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6a69a54ecfc378560c856f52edbdd3e5.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bc2a498f06762502d88b02b2732aee82.png"/>
     </img>
    </p>
    <h4>
     <a id="_20">
     </a>
     导入
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7b68f40e99d41fcefccc6d5e976833c0.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5f3426cd533adb743fba0d017ff12134.png"/>
     </img>
    </p>
    <h3>
     <a id="_23">
     </a>
     云数据库初始化
    </h3>
    <p>
     把一下代码复制到指定位置
    </p>
    <p>
     <strong>
      app.js 中
     </strong>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// app.js</span>

<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>

  onLaunch<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 展示本地存储能力</span>
    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      traceUser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      env<span class="token punctuation">:</span><span class="token string">'cloud1-1grn69gh9be4f1c3'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> logs <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'logs'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    logs<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'logs'</span><span class="token punctuation">,</span> logs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  

<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
    <p>
     你需要用到云数据库的页面的js代码的最上面（
     <code>
      Page({})
     </code>
     的上面）
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> db <span class="token operator">=</span> wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_52">
     </a>
     登录注册
    </h2>
    <h3>
     <a id="_54">
     </a>
     注册功能
    </h3>
    <p>
     下面这段代码放在你设置的注册按钮上的点击
     <strong>
      函数
     </strong>
     里
    </p>
    <pre><code class="prism language-javascript">      wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//user 指的是表，替换成你自己的。add相当于sql中的insert</span>
       data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
       <span class="token comment">//表中的字段，替换成你自己的</span>
        username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>username<span class="token punctuation">,</span><span class="token comment">//页面input传入的值</span>
        password<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>password
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册成功'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
         title<span class="token punctuation">:</span> <span class="token string">'注册成功'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
         url<span class="token punctuation">:</span> <span class="token string">'/pages/login/index'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token function">fail</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册失败'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_78">
     </a>
     登录功能
    </h3>
    <p>
     下面这段代码放在你设置的登录按钮上的点击
     <strong>
      函数
     </strong>
     里
    </p>
    <pre><code class="prism language-javascript">    wx<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//先是查询用户名是否存在</span>
    username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>username
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"获取数据成功"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
      <span class="token keyword">let</span> user <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
      wx<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        data<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        key<span class="token punctuation">:</span> <span class="token string">'loginOk'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token operator">==</span>undefined<span class="token punctuation">)</span>
      <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'登陆失败'</span><span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          icon<span class="token punctuation">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
          title<span class="token punctuation">:</span> <span class="token string">'账号或密码不正确'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">==</span> user<span class="token punctuation">.</span>password<span class="token operator">&amp;&amp;</span>username <span class="token operator">==</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'登陆成功'</span><span class="token punctuation">)</span>
      wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        url<span class="token punctuation">:</span> <span class="token string">'/pages/user/user'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        title<span class="token punctuation">:</span> <span class="token string">'登陆成功'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      wx<span class="token punctuation">.</span><span class="token function">switchTab</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        url<span class="token punctuation">:</span> <span class="token string">"/pages/user/user"</span><span class="token punctuation">,</span>
        success<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
          <span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
          <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> undefined <span class="token operator">||</span> page <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>  
          page<span class="token punctuation">.</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">//保存用户登陆状态</span>
      wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
      
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          title<span class="token punctuation">:</span> <span class="token string">"请先注册"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          url<span class="token punctuation">:</span> <span class="token string">'/pages/register/register'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'登陆失败'</span><span class="token punctuation">)</span>
      wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        icon<span class="token punctuation">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token string">'账号或密码不正确'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fail</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"获取数据失败"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="_143">
     </a>
     查询（模糊查找）
    </h2>
    <p>
     注，精确查找的话，刚刚登录里面找用户名的就是
    </p>
    <pre><code class="prism language-javascript">  <span class="token comment">//获取输入的内容</span>
  inCiju<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>ciju <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// getGuInfo1是查找按钮的函数</span>
getGuInfo1<span class="token punctuation">:</span><span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> that<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>ciju<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//就在控制台检查一下传参是否正常</span>
  db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">"poems"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>	 	
  <span class="token comment">//poems是表名，替换成你自己的</span>
  <span class="token comment">//利用正则进行模糊查询</span>
  content<span class="token punctuation">:</span> db<span class="token punctuation">.</span><span class="token function">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    regexp<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>ciju<span class="token punctuation">,</span><span class="token comment">//ciju是input传过来的字段，替换成自己的</span>
    options<span class="token punctuation">:</span> <span class="token string">'s'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  success<span class="token punctuation">:</span> res<span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  	<span class="token comment">//下面这俩都是检查用的，可以删掉</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
 	<span class="token comment">//获取数据库的数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      gushi<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//下面是带参数跳转到另一页面，不需要可以删掉。</span>
     <span class="token keyword">const</span> shici <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
       url<span class="token punctuation">:</span> <span class="token string">'../search/search?shici='</span><span class="token operator">+</span>shici<span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34353838343738332f:61727469636c652f64657461696c732f313232343439323436" class_="artid" style="display:none">
 </p>
</div>


