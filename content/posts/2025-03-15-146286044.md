---
layout: post
title: "K8S学习之基础三十k8s中RBAC-的核心概念"
date: 2025-03-15 21:44:32 +0800
description: "k8s中rbca的核心概念"
keywords: "K8S学习之基础三十：k8s中RBAC 的核心概念"
categories: ['K']
tags: ['学习', '云原生', 'Kubernetes', 'Java']
artid: "146286044"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146286044
    alt: "K8S学习之基础三十k8s中RBAC-的核心概念"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146286044
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146286044
cover: https://bing.ee123.net/img/rand?artid=146286044
image: https://bing.ee123.net/img/rand?artid=146286044
img: https://bing.ee123.net/img/rand?artid=146286044
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     K8S学习之基础三十：k8s中RBAC 的核心概念
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Kubernetes (k8s) 中的 RBAC（Role-Based Access Control，基于角色的访问控制）是一种用于管理用户和服务账户对集群资源访问权限的机制。RBAC 允许管理员通过定义角色（Role）和角色绑定（RoleBinding）来精确控制谁可以在哪些资源上执行哪些操作。
    </p>
    <h4>
     <a id="RBAC__2">
     </a>
     RBAC 的核心概念
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        Role
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         定义了一组权限，指定了可以对哪些资源执行哪些操作。
        </p>
       </li>
       <li>
        <p>
         Role 是命名空间（Namespace）级别的，即它只适用于特定的命名空间。
        </p>
        <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: pod-reader
rules:
- apiGroups: [""] # "" 表示核心 API 组
  resources: ["pods"]
  verbs: ["get", "watch", "list"]
</code></pre>
        <p>
         这个 Role 允许用户在
         <code>
          default
         </code>
         命名空间中获取、查看和列出 Pod。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        ClusterRole
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         类似于 Role，但它是集群级别的，适用于整个集群，而不仅仅是某个命名空间。
        </p>
        <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-admin
rules:
- apiGroups: [""]
  resources: ["*"]
  verbs: ["*"]
</code></pre>
        <p>
         这个 ClusterRole 允许用户对所有资源执行所有操作。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        RoleBinding
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         将 Role 或 ClusterRole 绑定到用户、组或服务账户（ServiceAccount）。
        </p>
       </li>
       <li>
        <p>
         RoleBinding 是命名空间级别的，即它只适用于特定的命名空间。
        </p>
        <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: default
subjects:
- kind: User
  name: alice
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
</code></pre>
        <p>
         这个 RoleBinding 将
         <code>
          pod-reader
         </code>
         Role 绑定到用户
         <code>
          alice
         </code>
         ，允许她在
         <code>
          default
         </code>
         命名空间中读取 Pod。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        ClusterRoleBinding
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         类似于 RoleBinding，但它是集群级别的，适用于整个集群。
        </p>
        <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-binding
subjects:
- kind: User
  name: admin
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
</code></pre>
        <p>
         这个 ClusterRoleBinding 将
         <code>
          cluster-admin
         </code>
         ClusterRole 绑定到用户
         <code>
          admin
         </code>
         ，允许她对整个集群中的所有资源执行所有操作。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="RBAC__86">
     </a>
     RBAC 的常见操作
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        创建 Role 和 RoleBinding
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         使用
         <code>
          kubectl create role
         </code>
         和
         <code>
          kubectl create rolebinding
         </code>
         命令可以快速创建 Role 和 RoleBinding。
        </p>
        <pre><code>kubectl create role pod-reader --verb=get,list,watch --resource=pods
kubectl create rolebinding read-pods --role=pod-reader --user=alice
</code></pre>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        查看 Role 和 RoleBinding
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         使用
         <code>
          kubectl get role
         </code>
         和
         <code>
          kubectl get rolebinding
         </code>
         命令可以查看现有的 Role 和 RoleBinding。
        </p>
        <pre><code>kubectl get role -n default
kubectl get rolebinding -n default
</code></pre>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        删除 Role 和 RoleBinding
       </strong>
       :
      </p>
      <ul>
       <li>
        <p>
         使用
         <code>
          kubectl delete role
         </code>
         和
         <code>
          kubectl delete rolebinding
         </code>
         命令可以删除 Role 和 RoleBinding。
        </p>
        <pre><code>kubectl delete role pod-reader -n default
kubectl delete rolebinding read-pods -n default
</code></pre>
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="RBAC__115">
     </a>
     RBAC 的最佳实践
    </h4>
    <ol>
     <li>
      <strong>
       最小权限原则
      </strong>
      :
      <ul>
       <li>
        只授予用户或服务账户完成其任务所需的最小权限。
       </li>
       <li>
        避免使用过于宽泛的权限，如
        <code>
         cluster-admin
        </code>
        ，除非确实需要。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       使用命名空间隔离
      </strong>
      :
      <ul>
       <li>
        将不同的应用或团队分配到不同的命名空间，并使用 Role 和 RoleBinding 来控制权限。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       定期审计权限
      </strong>
      :
      <ul>
       <li>
        定期检查 Role 和 RoleBinding，确保没有不必要的权限被授予。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       使用 ServiceAccount
      </strong>
      :
      <ul>
       <li>
        为每个应用或服务创建专用的 ServiceAccount，并为其分配适当的权限，而不是使用默认的 ServiceAccount。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_127">
     </a>
     总结
    </h4>
    <p>
     RBAC 是 Kubernetes 中管理访问控制的重要机制，通过定义 Role、ClusterRole、RoleBinding 和 ClusterRoleBinding，管理员可以精确控制用户和服务账户对集群资源的访问权限。遵循最小权限原则和最佳实践，可以有效地提高集群的安全性。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f7869616f66656e676b616e672f:61727469636c652f64657461696c732f313436323836303434" class_="artid" style="display:none">
 </p>
</div>


