---
layout: post
title: "Https-SSL证书配置"
date: 2025-03-14 16:59:38 +0800
description: "【代码】Https SSL证书配置。"
keywords: "Https SSL证书配置"
categories: ['环境参数配置', 'Web']
tags: ['网络协议', 'Ssl', 'Https']
artid: "146261608"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146261608
    alt: "Https-SSL证书配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146261608
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146261608
cover: https://bing.ee123.net/img/rand?artid=146261608
image: https://bing.ee123.net/img/rand?artid=146261608
img: https://bing.ee123.net/img/rand?artid=146261608
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Https SSL证书配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Https_SSL__Nginx_0">
     </a>
     Https 自定义SSL证书配置 – 通过Nginx代理
    </h2>
    <pre><code class="prism language-properties">前提：
1. 安装 openSSL，注册环境变量；（生成证书用）
2. 安装 Nginx 服务；

ps: 建议在新文件夹下运行openSSL，生成的相关文件容易找到；
</code></pre>
    <h4>
     <a id="_SSLCA_10">
     </a>
     一. 生成SSL证书(模拟CA机构方式)
    </h4>
    <h5>
     <a id="1__CA_cakeycacrt_12">
     </a>
     1. 生成 CA 的私钥ca.key和自签名证书ca.crt：
    </h5>
    <pre><code class="prism language-shell">openssl req <span class="token parameter variable">-x509</span> <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-days</span> <span class="token number">365000</span> <span class="token parameter variable">-newkey</span> rsa:2048 <span class="token parameter variable">-subj</span> <span class="token string">"/C=CN/ST=guangdong/L=shenzhen/O=DAS"</span> <span class="token parameter variable">-keyout</span> ca.key <span class="token parameter variable">-out</span> ca.crt <span class="token parameter variable">-reqexts</span> v3_req <span class="token parameter variable">-extensions</span> v3_ca
</code></pre>
    <h5>
     <a id="2_serverkey_18">
     </a>
     2. 生成服务器证书请求文件server.key：
    </h5>
    <pre><code class="prism language-shell">openssl genrsa <span class="token parameter variable">-out</span> server.key <span class="token number">2048</span>
</code></pre>
    <h5>
     <a id="3__servercsr_24">
     </a>
     3. 生成服务器证书请求文件 server.csr：
    </h5>
    <pre><code class="prism language-shell">openssl req <span class="token parameter variable">-new</span> <span class="token parameter variable">-key</span> server.key <span class="token parameter variable">-subj</span> <span class="token string">"/C=CN/ST=guangdong/L=shenzhen/O=DAS/CN=www.example.com"</span> <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-out</span> server.csr
</code></pre>
    <h5>
     <a id="4__privateext_IP_30">
     </a>
     4. 新建 private.ext 文件(让证书可以关联多个受信任域名或者IP)
    </h5>
    <pre><code>[ req ]
default_bits        = 2048
distinguished_name  = req_distinguished_name
req_extensions      = san
extensions          = san

[ req_distinguished_name ]
countryName         = CN
stateOrProvinceName = Definesys
localityName        = Definesys
organizationName    = Definesys

[SAN]
authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
subjectAltName = @alt_names

[alt_names]
#DNS.x: 绑定域名
#DNS.1 = www.example.com
#DNS.2 = www.example.net
#IP.x: 绑定IP
IP.1 = 192.168.2.5
#IP.2 = 192.168.2.4
</code></pre>
    <h5>
     <a id="5__servercrt_60">
     </a>
     5. 生成服务器证书文件 server.crt：
    </h5>
    <pre><code class="prism language-shell">openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-days</span> <span class="token number">365000</span> <span class="token parameter variable">-in</span> server.csr <span class="token parameter variable">-CA</span> ca.crt <span class="token parameter variable">-CAkey</span> ca.key <span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-out</span> server.crt <span class="token parameter variable">-extfile</span> private.ext <span class="token parameter variable">-extensions</span> SAN
</code></pre>
    <h5>
     <a id="PS__66">
     </a>
     PS: 验证生成的证书（：
    </h5>
    <pre><code class="prism language-shell"><span class="token comment"># 这个命令会显示证书的详细信息，包括颁发者、有效期、公钥等</span>
openssl x509 <span class="token parameter variable">-in</span> server.crt <span class="token parameter variable">-text</span> <span class="token parameter variable">-noout</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/bb7c20f51a594fc1b72b4ae8ae7a8cd8.png#pic_center">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/71c228eb713f468eb3e7a8cb6bcb09e1.png#pic_center"/>
     </img>
    </p>
    <h4>
     <a id="__Nginx__SSL__77">
     </a>
     二. 修改 Nginx 配置 SSL 证书
    </h4>
    <h5>
     <a id="1_nginxconfnginxconf__79">
     </a>
     1. 修改./nginx/conf/nginx.conf 文件
    </h5>
    <pre><code class="prism language-properties">http{
	...
	
	#======这里实现通过 https://ip:9988/xxx -&gt; 访问内部http://ip:9999/xxx 地址======
    server {
        listen       9988 ssl;#https 对外开放端口
        server_name  localhost;

		#ssl配置
        ssl_certificate      D:\openSSL\server.crt;# 证书文件路径
        ssl_certificate_key  D:\openSSL\server.key;# 私钥文件路径

        ssl_session_cache    shared:SSL:1m;
        ssl_session_timeout  5m; # ssl会话信息保留时间

        ssl_ciphers  HIGH:!aNULL:!MD5;# 指定加密套件
	    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # 仅启用安全的 TLS 版本
        ssl_prefer_server_ciphers  on;# 优先使用服务器端的加密套件

		#重定向所有9988端口请求
        location / {
			proxy_pass http://192.168.2.5:9999;
			proxy_redirect http:// https://;#防止重定向变回http
			proxy_set_header Referer $http_referer;##++
            proxy_set_header Host $host:9988;#防止重定向端口丢失
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333733383931312f:61727469636c652f64657461696c732f313436323631363038" class_="artid" style="display:none">
 </p>
</div>


