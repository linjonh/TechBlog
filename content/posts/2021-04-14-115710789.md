---
layout: post
title: "Esp8266天猫精灵_RGB灯_非点灯平台"
date: 2021-04-14 23:03:48 +0800
description: "arduino接入阿里云_天猫精灵_云智能APP_RGB灯鉴于很多平台的物联网设备数量都受到限制，比"
keywords: "8266直连天猫精灵"
categories: ['Aduino']
tags: ['阿里云', '物联网', '人工智能']
artid: "115710789"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=115710789
    alt: "Esp8266天猫精灵_RGB灯_非点灯平台"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=115710789
featuredImagePreview: https://bing.ee123.net/img/rand?artid=115710789
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Esp8266天猫精灵_RGB灯_非点灯平台
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="arduino__APP_RGB_0">
     </a>
     arduino接入阿里云_天猫精灵_云智能APP_RGB灯
    </h3>
    <p>
     鉴于很多平台的物联网设备数量都受到限制，比如说blinker，免费的只有5个，使用了物联网里的老大哥阿里云，性能稳定，生态完善，响应速度快。
    </p>
    <p>
     首先感谢
     <a href="https://www.bilibili.com/video/BV1nA411x71V/?spm_id_from=333.788.recommend_more_video.2" rel="nofollow">
      Esp8266接入阿里云_天猫精灵_云智能APP_控制LED_插座
     </a>
     的详细教程以及各位大佬的点评，个人做了整理便于小白多多明白
     <br/>
     <strong>
      水平有限，仅供参考
     </strong>
    </p>
    <p>
     关于平台注意：
     <br/>
     <a href="https://iot.console.aliyun.com" rel="nofollow">
      阿里云物联网平台
     </a>
     <br/>
     <a href="https://living.aliyun.com" rel="nofollow">
      阿里云生活物联网平台
     </a>
     <br/>
     注意：这两个是不同的平台，阿里云物联网平台里面的设备包含了阿里云旗下所有的物联网平台设备，也就是说生活物联网平台是阿里云物联网平台的一个分支。
     <br/>
     **注意：**两个平台一定要使用同一个账号（支付宝）
    </p>
    <p>
     关于产品注册流程：
     <br/>
     两个平台同时登陆，且同一账号；
    </p>
    <p>
     创建项目
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9d13fd377cbd7e79a51952bc3e267f38.png#pic_center">
      <br/>
      注意名字和类型
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/273c1c5837d5cabd127b2af118dcdf99.png#pic_center"/>
     </img>
    </p>
    <p>
     注意莫名字和连网方式
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/024791db55eef32b5609c04966d73640.png#pic_center">
      <br/>
      添加RGB对应的功能
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c5e491cffa2caf87295e18cb2475e84d.png#pic_center">
       <br/>
       <strong>
        注意选中公版APP，从现在开始，每完成一步必须保存一下
       </strong>
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b4df6c1dd2c08b75cad0ba7dad0836a2.png#pic_center">
        <br/>
        自定义面板
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3bac410f5227e1e7cf6eef899cb7a1fe.png#pic_center">
         <br/>
         <strong>
          注意：RGB颜色
         </strong>
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/016b7157c4f5d084693847eee28d7fdd.png#pic_center">
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5f0d24babebaa3c2149f523d2173c096.png#pic_center">
           <br/>
           注意保存
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/838d867d95805cb1f82e581fef98a77e.png#pic_center"/>
           <br/>
           重新选择刚刚的面板，确认
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f7c9ed6a4c53b61b8dcd4e9a325d1cda.png#pic_center"/>
           <br/>
           语言栏切勿存在空白
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/db3bbef3c6c8c4eea5bb8bd81e60a0cf.png#pic_center"/>
           <br/>
           此时会自动开启天猫精灵
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/eb21ce105b87f0f11360c868354524de.png#pic_center"/>
           <br/>
           注意选择的模块型号
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fa2891bf29dc1cb05569ccd20d38954d.png#pic_center"/>
           <br/>
           重新建设备
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f79ce88dbbad3230875874dafcc4e85c.png#pic_center"/>
           <br/>
           去程序里面修改你的密钥
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/42c9b99c095300c4f899607dba511015.png#pic_center"/>
           <br/>
           先发布产品再下载APP进行扫码，
           <br/>
           <strong>
            进入APP的更多服务里面绑定天猫精灵
            <br/>
            注意：建议都用同一个手机号
           </strong>
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b30a1799f7d8939e02c22d1baf8e7ba3.png#pic_center"/>
           <br/>
           配网，扫码
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0cdd243a33a339b318daec063fd62d27.png#pic_center"/>
           <br/>
           此时烧录完程序就可以去
           <a href="https://iot.console.aliyun.com" rel="nofollow">
            阿里云物联网平台
           </a>
           查看设备，不是同一账号不会自动同步的
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/75cd1482f73c40ea1ff6454d0b022785.png#pic_center"/>
          </img>
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <p>
     完成以上步骤就可以呼叫天猫精灵了，也可以APP上操作
    </p>
    <p>
     先到我的博客下载并添加库文件
     <br/>
     下面代码，大佬请绕路。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// An highlighted block</span>
#include <span class="token operator">&lt;</span>ESP8266WiFi<span class="token punctuation">.</span>h<span class="token operator">&gt;</span> <span class="token comment">//安装esp8266arduino开发环境</span>
#include <span class="token operator">&lt;</span>RGBConverterLib<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#include <span class="token operator">&lt;</span>DNSServer<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#include <span class="token operator">&lt;</span>ESP8266WebServer<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#include <span class="token operator">&lt;</span>CustomWiFiManager<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
#include <span class="token operator">&lt;</span>ArduinoJson<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>

#include <span class="token operator">&lt;</span>AliyunIoTSDK<span class="token punctuation">.</span>h<span class="token operator">&gt;</span> <span class="token comment">//引入阿里云 IoT SDK，需要安装crypto库、PubSubClient库</span>
AliyunIoTSDK iot<span class="token punctuation">;</span>
<span class="token keyword">static</span> WiFiClient espClient<span class="token punctuation">;</span>
<span class="token keyword">static</span> RGBConverter espRGB<span class="token punctuation">;</span>

<span class="token comment">//设置产品和设备的信息，从阿里云设备信息里查看</span>
#define <span class="token constant">PRODUCT_KEY</span> <span class="token string">"xxxxx"</span>                        <span class="token comment">//替换自己的PRODUCT_KEY</span>
#define <span class="token constant">DEVICE_NAME</span> <span class="token string">"xxxxx"</span>                               <span class="token comment">//替换自己的DEVICE_NAME</span>
#define <span class="token constant">DEVICE_SECRET</span> <span class="token string">"xxxxx"</span> <span class="token comment">//替换自己的DEVICE_SECRET</span>
#define <span class="token constant">REGION_ID</span> <span class="token string">"cn-shanghai"</span>                          <span class="token comment">//默认cn-shanghai</span>

unsigned long lastMsMain <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//定时的时基</span>
#define RGB_red <span class="token number">15</span>     <span class="token comment">//对应引脚</span>
#define RGB_green <span class="token number">12</span>
#define RGB_blue <span class="token number">13</span>
int RGB_bool <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//LED的开关状态</span>
int RGBlan <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>   <span class="token comment">//LED的亮度 80%</span>
int led_red <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//LED的默认颜色和亮度</span>
int led_green <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
int led_blue <span class="token operator">=</span> <span class="token number">212</span><span class="token punctuation">;</span>

<span class="token comment">// web配网页面自定义我的图标请随便使用一个图片转base64工具转换https://tool.css-js.com/base64.html, 64*64</span>
<span class="token keyword">const</span> char Icon<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">PROGMEM</span> <span class="token operator">=</span> <span class="token string">"data:image/png;base64,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"</span><span class="token punctuation">;</span>

<span class="token comment">// 开关</span>
<span class="token keyword">void</span> <span class="token function">powerstate</span><span class="token punctuation">(</span>JsonVariant <span class="token constant">L</span><span class="token punctuation">)</span> <span class="token comment">//固定格式，修改参数l</span>
<span class="token punctuation">{<!-- --></span>
  int powerstate <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token string">"powerstate"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//参数l</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>powerstate <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>              <span class="token comment">//板载led默认高电平，此时灯灭</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//根据输入值调节各LED亮度</span>
    <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_red<span class="token punctuation">,</span> led_red<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_green<span class="token punctuation">,</span> led_green<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_blue<span class="token punctuation">,</span> led_blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    RGB_bool <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>RGB_red<span class="token punctuation">,</span> <span class="token constant">LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>RGB_green<span class="token punctuation">,</span> <span class="token constant">LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>RGB_blue<span class="token punctuation">,</span> <span class="token constant">LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RGB_bool <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Serial<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"收到的powerstate是："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>powerstate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"powerstate"</span><span class="token punctuation">,</span> RGB_bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 亮度</span>
<span class="token keyword">void</span> <span class="token function">brightness</span><span class="token punctuation">(</span>JsonVariant <span class="token constant">L</span><span class="token punctuation">)</span> <span class="token comment">//固定格式，修改参数2</span>
<span class="token punctuation">{<!-- --></span>
  RGBlan <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token string">"brightness"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//参数2</span>
  Serial<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"收到的brightness是："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>RGBlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_red<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>RGBlan<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> led_red<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_green<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>RGBlan<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> led_green<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_blue<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>RGBlan<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> led_blue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"brightness"</span><span class="token punctuation">,</span> RGBlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 修改颜色</span>
<span class="token keyword">void</span> <span class="token function">RGBColor</span><span class="token punctuation">(</span>JsonVariant <span class="token constant">L</span><span class="token punctuation">)</span> <span class="token comment">//固定格式，修改参数2</span>
<span class="token punctuation">{<!-- --></span>
  led_red <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token string">"RGBColor"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"Red"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//参数1</span>
  led_blue <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token string">"RGBColor"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"Blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">//参数2</span>
  led_green <span class="token operator">=</span> <span class="token constant">L</span><span class="token punctuation">[</span><span class="token string">"RGBColor"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"Green"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//参数3</span>
  String led_hex <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  int RGB_color <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  char ch<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/*
  Serial.print("Red:");
  Serial.println(led_red);
  Serial.print("Blue:");
  Serial.println(led_blue);
  Serial.print("Green:");
  Serial.println(led_green);
  */</span>
  <span class="token comment">//根据输入值调节各LED亮度</span>
  <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_red<span class="token punctuation">,</span> led_red<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_green<span class="token punctuation">,</span> led_green<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">analogWrite</span><span class="token punctuation">(</span>RGB_blue<span class="token punctuation">,</span> led_blue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  RGB_bool <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">//RGB的三值得十六进制的值，再转十进制进行上报颜色</span>
  espRGB<span class="token punctuation">.</span><span class="token function">RgbToHex</span><span class="token punctuation">(</span>led_red<span class="token punctuation">,</span> led_green<span class="token punctuation">,</span> led_blue<span class="token punctuation">,</span> led_hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> led_hex<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sscanf</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> <span class="token string">"%x"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>RGB_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>RGB_color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">,</span> RGB_color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//上报数据</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span>RGB_red<span class="token punctuation">,</span> <span class="token constant">OUTPUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>RGB_red<span class="token punctuation">,</span> <span class="token constant">LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span>RGB_green<span class="token punctuation">,</span> <span class="token constant">OUTPUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>RGB_green<span class="token punctuation">,</span> <span class="token constant">LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">pinMode</span><span class="token punctuation">(</span>RGB_blue<span class="token punctuation">,</span> <span class="token constant">OUTPUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">digitalWrite</span><span class="token punctuation">(</span>RGB_blue<span class="token punctuation">,</span> <span class="token constant">LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//开始连接WiFi</span>
  WiFiManager wifiManager<span class="token punctuation">;</span>                                  <span class="token comment">//实例化WiFiManager</span>
  wifiManager<span class="token punctuation">.</span><span class="token function">setHeadImgBase64</span><span class="token punctuation">(</span><span class="token constant">FPSTR</span><span class="token punctuation">(</span>Icon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//设置图标</span>
  wifiManager<span class="token punctuation">.</span><span class="token function">setPageTitle</span><span class="token punctuation">(</span><span class="token string">"欢迎来到冷月满天的WiFi配置页"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置页标题</span>
  wifiManager<span class="token punctuation">.</span><span class="token function">autoConnect</span><span class="token punctuation">(</span><span class="token string">"TP561-IoT-ESP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// AP模式，可以修改成你的ESP8266WiFi热点名称</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"connected...恭喜!一切就绪。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//初始化 iot，需传入 wifi 的 client，和设备产品信息</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">begin</span><span class="token punctuation">(</span>espClient<span class="token punctuation">,</span> <span class="token constant">PRODUCT_KEY</span><span class="token punctuation">,</span> <span class="token constant">DEVICE_NAME</span><span class="token punctuation">,</span> <span class="token constant">DEVICE_SECRET</span><span class="token punctuation">,</span> <span class="token constant">REGION_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//绑定一个设备属性回调，当远程修改此属性，会触发powerstate函数;天猫精灵控制的就是powerstate的高低电平（高 = 1，低 = 0）</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">bindData</span><span class="token punctuation">(</span><span class="token string">"powerstate"</span><span class="token punctuation">,</span> powerstate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">bindData</span><span class="token punctuation">(</span><span class="token string">"brightness"</span><span class="token punctuation">,</span> brightness<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">bindData</span><span class="token punctuation">(</span><span class="token string">"RGBColor"</span><span class="token punctuation">,</span> RGBColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//初始化开关和亮度</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"powerstate"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"brightness"</span><span class="token punctuation">,</span> RGBlan<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">//发送数据的间隔，2秒发送一次，“云智能APP”上电源按钮的UI实时显示会有2秒延时。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> lastMsMain <span class="token operator">&gt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//心跳机制</span>
    lastMsMain <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//发送电源状态到云平台（高电平：1；低电平：0）</span>
    <span class="token literal-property property">AliyunIoTSDK</span><span class="token operator">:</span><span class="token operator">:</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"powerstate"</span><span class="token punctuation">,</span> RGB_bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333637383336382f:61727469636c652f64657461696c732f313135373130373839" class_="artid" style="display:none">
 </p>
</div>


