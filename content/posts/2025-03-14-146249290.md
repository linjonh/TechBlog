---
layout: post
title: "rv1106-sdk-的ipcweb-分析"
date: 2025-03-14 10:49:34 +0800
description: "Boardconfig文件中的RK_APP_IPCWEB_BACKEND传递到这里，如果为真，添加ipcweb-build。整个过程是进入ipcweb-backend，编译，把etc4oem里面的内容复制到etc文件夹里面。在末尾把编译出来的entry.cgi放到oem的www/cgi-bin文件夹。这个文件也是设置编译规则，添加源代码文件，最后把各个文件安装到安装目录。ipcweb 的编译控制开关在Boardconfig文件中。这里是前端的文件，根据md的说明，使用了angular架构。"
keywords: "rv1106 sdk 的ipcweb 分析"
categories: ['未分类']
tags: ['前端', 'Linux']
artid: "146249290"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146249290
    alt: "rv1106-sdk-的ipcweb-分析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146249290
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146249290
cover: https://bing.ee123.net/img/rand?artid=146249290
image: https://bing.ee123.net/img/rand?artid=146249290
img: https://bing.ee123.net/img/rand?artid=146249290
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     rv1106 sdk 的ipcweb 分析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_0">
     </a>
     控制开关
    </h4>
    <p>
     ipcweb 的编译控制开关在Boardconfig文件中
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># build ipc web backend</span>
<span class="token comment"># export RK_APP_IPCWEB_BACKEND=y</span>
</code></pre>
    <p>
     缺省是关闭的，去除#号打开编译开关。
    </p>
    <h4>
     <a id="Makefile_7">
     </a>
     主Makefile分析
    </h4>
    <p>
     主Makefile在luckfox-pico/project/app/ipcweb/中
     <br/>
     Boardconfig文件中的RK_APP_IPCWEB_BACKEND传递到这里，如果为真，添加ipcweb-build
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># define project/cfg/BoardConfig*.mk</span>
ifeq <span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>RK_APP_IPCWEB_BACKEND<span class="token variable">)</span></span>,y<span class="token punctuation">)</span>
PKG_TARGET :<span class="token operator">=</span> ipcweb-build
endif
</code></pre>
    <p>
     ipcweb-build是编译主要部分
    </p>
    <pre><code class="prism language-bash">all: <span class="token variable"><span class="token variable">$(</span>PKG_TARGET<span class="token variable">)</span></span>
	@echo <span class="token string">"build <span class="token variable"><span class="token variable">$(</span>PKG_NAME<span class="token variable">)</span></span> done"</span>

ipcweb-build:
	<span class="token comment"># 设置各种文件夹</span>
	@rm <span class="token parameter variable">-rf</span> <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>PKG_BUILD<span class="token variable">)</span></span><span class="token punctuation">;</span>
	@cp <span class="token parameter variable">-rfa</span> <span class="token variable"><span class="token variable">$(</span>PKG_TARBALL<span class="token variable">)</span></span>/include <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span>/<span class="token punctuation">;</span>
	@cp <span class="token parameter variable">-rfa</span> <span class="token variable"><span class="token variable">$(</span>PKG_TARBALL<span class="token variable">)</span></span>/usr <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span>/<span class="token punctuation">;</span>
	@echo <span class="token string">"PKG_TARPATH is <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span>"</span><span class="token punctuation">;</span>
	<span class="token function">pushd</span> <span class="token variable"><span class="token variable">$(</span>PKG_BUILD<span class="token variable">)</span></span>/<span class="token punctuation">;</span> <span class="token punctuation">\</span>
		<span class="token function">rm</span> <span class="token parameter variable">-rf</span> CMakeCache.txt<span class="token punctuation">;</span> <span class="token punctuation">\</span>
		cmake <span class="token variable"><span class="token variable">$(</span>CURRENT_DIR<span class="token variable">)</span></span>/<span class="token variable"><span class="token variable">$(</span>PKG_NAME<span class="token variable">)</span></span>/ <span class="token punctuation">\</span>
			<span class="token parameter variable">-DCMAKE_C_COMPILER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>RK_APP_CROSS<span class="token variable">)</span></span>-gcc <span class="token punctuation">\</span>
			<span class="token parameter variable">-DCMAKE_CXX_COMPILER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>RK_APP_CROSS<span class="token variable">)</span></span>-g++ <span class="token punctuation">\</span>
			<span class="token parameter variable">-DCMAKE_INSTALL_PREFIX</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>CURRENT_DIR<span class="token variable">)</span></span>/<span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>"</span> <span class="token punctuation">\</span>
			<span class="token parameter variable">-DCMAKE_BUILD_TYPE</span><span class="token operator">=</span>Release <span class="token punctuation">\</span>
			<span class="token parameter variable">-DCMAKE_COLOR_MAKEFILE</span><span class="token operator">=</span>OFF <span class="token punctuation">\</span>
			<span class="token parameter variable">-DCMAKE_SYSTEM_NAME</span><span class="token operator">=</span>Linux <span class="token punctuation">\</span>
			<span class="token parameter variable">-DUSE_RKIPC</span><span class="token operator">=</span>ON <span class="token punctuation">\</span>
			<span class="token variable"><span class="token variable">$(</span>PKG_CONF_OPTS<span class="token variable">)</span></span> <span class="token punctuation">;</span><span class="token punctuation">\</span>
			<span class="token function">make</span> -j<span class="token variable"><span class="token variable">$(</span>RK_APP_JOBS<span class="token variable">)</span></span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> -1<span class="token punctuation">;</span> <span class="token punctuation">\</span>
			<span class="token function">make</span> <span class="token function">install</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
	<span class="token function">popd</span><span class="token punctuation">;</span>
	<span class="token punctuation">(</span>mkdir <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>/usr<span class="token punctuation">;</span><span class="token function">mv</span> <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>/www <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>/usr<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ifeq <span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>PKG_INSTALL_TO_ROOTFS<span class="token variable">)</span></span>,YES<span class="token punctuation">)</span>
	@cp <span class="token parameter variable">-rfa</span> <span class="token variable"><span class="token variable">$(</span>PKG_TARBALL<span class="token variable">)</span></span>/etc <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span>/<span class="token punctuation">;</span>
	@cp <span class="token parameter variable">-rfa</span> <span class="token variable"><span class="token variable">$(</span>PKG_TARBALL<span class="token variable">)</span></span>/usr <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span>/<span class="token punctuation">;</span>
<span class="token keyword">else</span>
	@cp <span class="token parameter variable">-rfa</span> <span class="token variable"><span class="token variable">$(</span>PKG_TARBALL<span class="token variable">)</span></span>/etc4oem <span class="token variable"><span class="token variable">$(</span>PKG_TARPATH<span class="token variable">)</span></span>/etc
endif

	@test <span class="token operator">!</span> <span class="token parameter variable">-d</span> <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>/root/include <span class="token operator">||</span> <span class="token function">mv</span> <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>/root/include <span class="token variable"><span class="token variable">$(</span>PKG_BIN<span class="token variable">)</span></span>/<span class="token punctuation">;</span>
	<span class="token variable"><span class="token variable">$(</span>call MAROC_COPY_PKG_TO_APP_OUTPUT, <span class="token punctuation">$(</span>RK_APP_OUTPUT<span class="token punctuation">)</span>, <span class="token punctuation">$(</span>PKG_BIN<span class="token punctuation">)</span><span class="token variable">)</span></span>
</code></pre>
    <p>
     整个过程是进入ipcweb-backend，编译，把etc4oem里面的内容复制到etc文件夹里面
    </p>
    <h4>
     <a id="ipcwebbackend_Cmakelist_54">
     </a>
     ipcweb-backend 的Cmakelist分析
    </h4>
    <p>
     这个文件就是添加源代码的目录
    </p>
    <pre><code class="prism language-bash">add_subdirectory<span class="token punctuation">(</span>src<span class="token punctuation">)</span>
</code></pre>
    <p>
     这个就是把src目录添加进来编译
    </p>
    <h4>
     <a id="srcCmakelist_62">
     </a>
     src的Cmakelist分析
    </h4>
    <p>
     这个文件也是设置编译规则，添加源代码文件，最后把各个文件安装到安装目录
     <br/>
     在末尾把编译出来的entry.cgi放到oem的www/cgi-bin文件夹
     <br/>
     把www-rkipc 的内容放到 www 文件夹
    </p>
    <pre><code class="prism language-bash">if<span class="token punctuation">(</span>IPCWEBBACKEND_INSTALL_ON_OEM_PARTITION<span class="token punctuation">)</span>
install<span class="token punctuation">(</span>TARGETS entry.cgi RUNTIME DESTINATION /www/cgi-bin<span class="token punctuation">)</span>
else<span class="token punctuation">(</span><span class="token punctuation">)</span>
install<span class="token punctuation">(</span>TARGETS entry.cgi RUNTIME DESTINATION www/cgi-bin<span class="token punctuation">)</span>
endif<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">${USE_RKIPC}</span><span class="token punctuation">)</span>
install<span class="token punctuation">(</span>DIRECTORY <span class="token variable">${PROJECT_SOURCE_DIR}</span>/www-rkipc/ DESTINATION www<span class="token punctuation">)</span>
endif<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="wwwrkipc__77">
     </a>
     www-rkipc 文件夹分析
    </h4>
    <p>
     这里是前端的文件，根据md的说明，使用了angular架构
    </p>
    <pre><code class="prism language-bash">luckfox-pico/project/app/ipcweb/ipcweb-backend/www-rkipc$ tree ./
./
├── assets
│   ├── css
│   │   └── bootstrap-extended.css.gz
│   ├── i18n
│   │   └── zh-CN.json.gz
│   ├── images
│   │   ├── btn_blue_01.9.png.gz
│   │   ├── btn_blue_02.9.png.gz
│   │   ├── btn_red_01.9.png.gz
│   │   ├── btn_red_02.9.png.gz
│   │   ├── icon_checkbox_01.png.gz
│   │   ├── icon_checkbox_02.png.gz
│   │   ├── icon_choice_01.png.gz
│   │   ├── icon_choice_02.png.gz
│   │   ├── icon_copy_time_table.png.gz
│   │   ├── icon_play_l_01.png.gz
│   │   ├── icon_play_l_02.png.gz
│   │   ├── icon_stop_l_01.png.gz
│   │   ├── icon_stop_l_02.png.gz
│   │   ├── icon_triangle_s_b_01-12.png.gz
│   │   ├── icon_triangle_s_b_01.png.gz
│   │   ├── icon_triangle_s_b_02-12.png.gz
│   │   ├── icon_triangle_s_b_02.png.gz
│   │   ├── left_icon_a_01.png.gz
│   │   ├── left_icon_a_02.png.gz
│   │   ├── left_icon_b_01.png.gz
│   │   ├── left_icon_b_02.png.gz
│   │   ├── left_icon_c_01.png.gz
│   │   ├── left_icon_c_02.png.gz
│   │   ├── left_icon_d_01.png.gz
│   │   ├── left_icon_d_02.png.gz
│   │   ├── left_icon_e_01.png.gz
│   │   ├── left_icon_e_02.png.gz
│   │   ├── left_icon_f_01.png.gz
│   │   ├── left_icon_f_02.png.gz
│   │   ├── left_icon_g_01.png.gz
│   │   ├── left_icon_g_02.png.gz
│   │   ├── left_icon_h_01.png.gz
│   │   ├── left_icon_h_02.png.gz
│   │   ├── left_icon_i_01.png.gz
│   │   ├── left_icon_i_02.png.gz
│   │   ├── left_icon_j_01.png.gz
│   │   ├── left_icon_j_02.png.gz
│   │   ├── light-on.gif
│   │   ├── play_icon_a_01.png.gz
│   │   ├── play_icon_a_02.png.gz
│   │   ├── play_icon_b_01.png.gz
│   │   ├── play_icon_b_02.png.gz
│   │   ├── play_icon_c_01.png.gz
│   │   ├── play_icon_c_02.png.gz
│   │   ├── play_icon_d_01.png.gz
│   │   ├── play_icon_d_02.png.gz
│   │   ├── play_icon_dot.png.gz
│   │   ├── play_icon_e_01.png.gz
│   │   ├── play_icon_e_02.png.gz
│   │   ├── play_icon_f_01.png.gz
│   │   ├── play_icon_f_02.png.gz
│   │   ├── play_icon_h_01.png.gz
│   │   ├── play_icon_h_02.png.gz
│   │   ├── play_icon_i_01.png.gz
│   │   ├── play_icon_i_02.png.gz
│   │   ├── top_icon_i_01.png.gz
│   │   ├── top_icon_i_02.png.gz
│   │   ├── top_icon_quit_01.png.gz
│   │   ├── top_icon_quit_02.png.gz
│   │   ├── top_icon_user_01.png.gz
│   │   ├── top_icon_user_02.png.gz
│   │   ├── yt_icon_a_01.png.gz
│   │   ├── yt_icon_a_02.png.gz
│   │   ├── yt_icon_b_01.png.gz
│   │   ├── yt_icon_b_02.png.gz
│   │   ├── yt_icon_c_01.png.gz
│   │   ├── yt_icon_c_02.png.gz
│   │   ├── yt_icon_d_01.png.gz
│   │   ├── yt_icon_d_02.png.gz
│   │   ├── yt_icon_e_01.png.gz
│   │   ├── yt_icon_e_02.png.gz
│   │   ├── yt_icon_f_01.png.gz
│   │   ├── yt_icon_f_02.png.gz
│   │   ├── yt_icon_g_01.png.gz
│   │   ├── yt_icon_g_02.png.gz
│   │   ├── yt_icon_h_01.png.gz
│   │   ├── yt_icon_h_02.png.gz
│   │   ├── yt_icon_i_01.png.gz
│   │   ├── yt_icon_i_02.png.gz
│   │   ├── yt_icon_j_01.png.gz
│   │   ├── yt_icon_j_02.png.gz
│   │   ├── yt_icon_k_01.png.gz
│   │   ├── yt_icon_k_02.png.gz
│   │   ├── yt_icon_l_01.png.gz
│   │   ├── yt_icon_l_02.png.gz
│   │   ├── yt_icon_m_01.png.gz
│   │   ├── yt_icon_m_02.png.gz
│   │   ├── yt_icon_n_01.png.gz
│   │   ├── yt_icon_n_02.png.gz
│   │   ├── yt_icon_o_01.png.gz
│   │   ├── yt_icon_o_02.png.gz
│   │   ├── yt_icon_p_01.png.gz
│   │   ├── yt_icon_p_02.png.gz
│   │   ├── yt_icon_q_01.png.gz
│   │   ├── yt_icon_q_02.png.gz
│   │   ├── yt_icon_r_01.png.gz
│   │   ├── yt_icon_r_02.png.gz
│   │   ├── yt_icon_s_01.png.gz
│   │   ├── yt_icon_s_02.png.gz
│   │   ├── yt_icon_t_01.png.gz
│   │   ├── yt_icon_t_02.png.gz
│   │   ├── yt_icon_u_01.png.gz
│   │   └── yt_icon_u_02.png.gz
│   └── wxplayer
│       ├── prod.all.wasm.combine.js.gz
│       ├── prod.h265.wasm.combine.js.gz
│       ├── wxplayer.d.ts
│       └── wxplayer.js.gz
├── favicon.ico
├── index.html
├── main-es2015.325ceb896438639cd1f7.js.gz
├── polyfills-es2015.ca64e4516afbb1b890d5.js.gz
├── runtime-es2015.0811dcefd377500b5b1a.js.gz
├── scripts.6ee986b7cd7aefa6baef.js.gz
├── styles.7ce364de74ca93e3cffa.css.gz
├── yt_icon_r_02.5ab0362730f3d936e77e.png.gz
├── yt_icon_s_02.963b0e47ebf0b2056c86.png.gz
└── yt_icon_t_02.cb9304ec1b4d2eadae95.png.gz
</code></pre>
    <h4>
     <a id="ipcwebenvarm_207">
     </a>
     ipcweb-env-arm文件夹分析
    </h4>
    <pre><code class="prism language-bash">luckfox-pico/project/app/ipcweb/ipcweb-backend/ipcweb-env-arm$ tree ./
./
├── etc
│   ├── init.d
│   │   ├── S50fcgiwrap
│   │   └── S50nginx
│   └── nginx
│       ├── fastcgi.conf
│       ├── fastcgi.conf.default
│       ├── fastcgi_params
│       ├── fastcgi_params.default
│       ├── koi-utf
│       ├── koi-win
│       ├── mime.types
│       ├── mime.types.default
│       ├── nginx.conf
│       ├── nginx.conf.default
│       └── win-utf
├── etc4oem //有OEM分区时候的配置文件
│   ├── init.d
│   │   ├── S50fcgiwrap //启动fcgiwrap，nginx本身不支持cgi，要通过fcgiwrap代理
│   │   └── S50nginx 启动nginx
│   └── nginx //nginx的配置文件
│       ├── fastcgi.conf
│       ├── fastcgi.conf.default
│       ├── fastcgi_params
│       ├── fastcgi_params.default
│       ├── koi-utf
│       ├── koi-win
│       ├── mime.types
│       ├── mime.types.default
│       ├── nginx.conf
│       ├── nginx.conf.default
│       └── win-utf
├── include
│   ├── cgicc
│   │   ├── Cgicc.h
│   │   ├── CgiDefs.h
│   │   ├── CgiEnvironment.h
│   │   ├── CgiInput.h
│   │   ├── CgiUtils.h
│   │   ├── FormEntry.h
│   │   ├── FormFile.h
│   │   ├── HTMLAtomicElement.h
│   │   ├── HTMLAttribute.h
│   │   ├── HTMLAttributeList.h
│   │   ├── HTMLBooleanElement.h
│   │   ├── HTMLClasses.h
│   │   ├── HTMLDoctype.h
│   │   ├── HTMLElement.h
│   │   ├── HTMLElementList.h
│   │   ├── HTTPContentHeader.h
│   │   ├── HTTPCookie.h
│   │   ├── HTTPHeader.h
│   │   ├── HTTPHTMLHeader.h
│   │   ├── HTTPPlainHeader.h
│   │   ├── HTTPRedirectHeader.h
│   │   ├── HTTPResponseHeader.h
│   │   ├── HTTPStatusHeader.h
│   │   ├── HTTPXHTMLHeader.h
│   │   ├── MStreamable.h
│   │   ├── XHTMLDoctype.h
│   │   ├── XMLDeclaration.h
│   │   └── XMLPI.h
│   └── nlohmann
│       └── json.hpp
└── usr
    ├── bin
    │   └── cgi-fcgi
    ├── lib
    │   ├── libcgicc.so -<span class="token operator">&gt;</span> libcgicc.so.3
    │   ├── libcgicc.so.3
    │   ├── libfcgi++.so
    │   ├── libfcgi.so -<span class="token operator">&gt;</span> libfcgi.so.0
    │   ├── libfcgi.so.0
    │   ├── libpcre.so -<span class="token operator">&gt;</span> libpcre.so.1
    │   └── libpcre.so.1
    └── sbin
        ├── fcgiwrap
        └── nginx  //nginx的主程序
</code></pre>
    <h4>
     <a id="S50nginx__290">
     </a>
     S50nginx 分析
    </h4>
    <pre><code class="prism language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment">#</span>
<span class="token comment"># Start/stop nginx</span>
<span class="token comment">#</span>

<span class="token comment"># 指定nginx位置</span>
<span class="token assign-left variable">NGINX</span><span class="token operator">=</span>/oem/usr/sbin/nginx
<span class="token comment"># 指定nginx的PID文件</span>
<span class="token assign-left variable">PIDFILE</span><span class="token operator">=</span>/var/run/nginx.pid

<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
  start<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Starting nginx..."</span>
	<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/log/nginx /var/tmp/nginx
	<span class="token function">sleep</span> <span class="token number">1</span>
<span class="token comment">#   配置文件	 /oem/usr/etc/nginx/nginx.conf</span>
	start-stop-daemon <span class="token parameter variable">-S</span> <span class="token parameter variable">-x</span> <span class="token string">"<span class="token variable">$NGINX</span>"</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$PIDFILE</span>"</span> -- <span class="token parameter variable">-c</span> /oem/usr/etc/nginx/nginx.conf
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
  stop<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Stopping nginx..."</span>
	start-stop-daemon <span class="token parameter variable">-K</span> <span class="token parameter variable">-x</span> <span class="token string">"<span class="token variable">$NGINX</span>"</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$PIDFILE</span>"</span> <span class="token parameter variable">-o</span>
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
  reload<span class="token operator">|</span>force-reload<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Reloading nginx configuration..."</span>
	<span class="token string">"<span class="token variable">$NGINX</span>"</span> <span class="token parameter variable">-s</span> reload
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
  restart<span class="token punctuation">)</span>
	<span class="token string">"<span class="token variable">$0</span>"</span> stop
	<span class="token function">sleep</span> <span class="token number">1</span> <span class="token comment"># Prevent race condition: ensure nginx stops before start.</span>
	<span class="token string">"<span class="token variable">$0</span>"</span> start
	<span class="token punctuation">;</span><span class="token punctuation">;</span>
  *<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$0</span> {start|stop|restart|reload|force-reload}"</span>
	<span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">esac</span>

</code></pre>
    <h4>
     <a id="nginxconf__330">
     </a>
     nginx.conf 文件分析
    </h4>
    <p>
     http 部分
    </p>
    <pre><code class="prism language-bash">http <span class="token punctuation">{<!-- --></span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>

    access_log off<span class="token punctuation">;</span>

    <span class="token comment"># 头控制</span>
    add_header Access-Control-Allow-Origin *<span class="token punctuation">;</span>
    add_header Access-Control-Allow-Methods <span class="token string">'GET, POST, PUT, DELETE, OPTIONS'</span><span class="token punctuation">;</span>
    add_header Access-Control-Allow-Headers <span class="token string">'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Range,Content-Type,Authorization'</span><span class="token punctuation">;</span>
    add_header <span class="token string">'Access-Control-Expose-Headers'</span> <span class="token string">'X-Location'</span><span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment"># 压缩支持</span>
    <span class="token function">gzip</span>  on<span class="token punctuation">;</span>
    gzip_min_length <span class="token number">20</span><span class="token punctuation">;</span>
    gzip_comp_level <span class="token number">5</span><span class="token punctuation">;</span>
    gzip_vary on<span class="token punctuation">;</span>
    gzip_types text/html application/javascript application/x-javascript text/javascript image/png image/x-icon<span class="token punctuation">;</span>
    gzip_static on<span class="token punctuation">;</span>
    gzip_buffers <span class="token number">2</span> 4k<span class="token punctuation">;</span>
    gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>

    <span class="token comment"># 端口80</span>
    server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

	<span class="token comment"># /live开flv</span>
	location /live <span class="token punctuation">{<!-- --></span>
		flv_live on<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

        <span class="token comment"># /主文件夹/oem/usr/www， 入口index.html index.htm</span>
        location / <span class="token punctuation">{<!-- --></span>
            root   /oem/usr/www<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

	<span class="token comment"># 媒体文件</span>
	location ~* <span class="token punctuation">\</span>.<span class="token punctuation">(</span>mp4<span class="token operator">|</span>bmp<span class="token punctuation">)</span>$  <span class="token punctuation">{<!-- --></span>
	    root /oem/usr/www<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> ~* view$<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		add_header Content-Disposition inline<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> <span class="token operator">!</span>~* view$<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		add_header Content-Disposition attachment<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

        error_page  <span class="token number">404</span>              /<span class="token punctuation">;</span>

       <span class="token comment"># cgi调用</span>
        location /cgi-bin/ <span class="token punctuation">{<!-- --></span>
            <span class="token function">gzip</span>           off<span class="token punctuation">;</span>
            root           /oem/usr/www<span class="token punctuation">;</span>
            fastcgi_pass   unix:/run/fcgiwrap.sock<span class="token punctuation">;</span>
            fastcgi_index  entry.cgi<span class="token punctuation">;</span>
            fastcgi_param  DOCUMENT_ROOT     /oem/usr/www/cgi-bin<span class="token punctuation">;</span>
            fastcgi_param  SCRIPT_NAME       /entry.cgi<span class="token punctuation">;</span>
            include        fastcgi_params<span class="token punctuation">;</span>
            <span class="token builtin class-name">set</span> <span class="token variable">$path_info</span> <span class="token string">""</span><span class="token punctuation">;</span>
            <span class="token builtin class-name">set</span> <span class="token variable">$real_script_name</span> <span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$fastcgi_script_name</span> ~ <span class="token string">"^(.+?\.cgi)(/.+)$"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token builtin class-name">set</span> <span class="token variable">$real_script_name</span> <span class="token variable">$1</span><span class="token punctuation">;</span>
                <span class="token builtin class-name">set</span> <span class="token variable">$path_info</span> <span class="token variable">$2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            fastcgi_param PATH_INFO       <span class="token variable">$path_info</span><span class="token punctuation">;</span>
            fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$real_script_name</span><span class="token punctuation">;</span>
            fastcgi_param SCRIPT_NAME     <span class="token variable">$real_script_name</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="rtmp__409">
     </a>
     rtmp 反代
    </h4>
    <pre><code class="prism language-bash">rtmp <span class="token punctuation">{<!-- --></span>
    server <span class="token punctuation">{<!-- --></span>
        listen <span class="token number">1935</span><span class="token punctuation">;</span>
        chunk_size <span class="token number">4096</span><span class="token punctuation">;</span>
        <span class="token comment">#allow publish 127.0.0.1;</span>
        <span class="token comment">#deny publish all;</span>

        application live <span class="token punctuation">{<!-- --></span>
            live on<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#application hls {<!-- --></span>
        <span class="token comment">#    live on;</span>
        <span class="token comment">#    hls on;</span>
        <span class="token comment">#    hls_path /tmp/hls;</span>
        <span class="token comment">#    hls_fragment 1s;</span>
        <span class="token comment">#}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="cginginx__432">
     </a>
     无cgi的nginx 服务器测试
    </h4>
    <p>
     单纯用nginx加index.html可以测试静态服务器
    </p>
    <h5>
     <a id="_434">
     </a>
     启动
    </h5>
    <p>
     创建启动文件夹并把启动文件复制过去
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@luckfox etc<span class="token punctuation">]</span><span class="token comment"># mkdir ./init.d/</span>
</code></pre>
    <pre><code class="prism language-bash">luckfox-pico/project/app/ipcweb/ipcweb-backend/ipcweb-env-arm/etc4oem/init.d$ <span class="token function">scp</span> ./S50nginx root@192.168.9.161:/oem/usr/etc/init.d
</code></pre>
    <h5>
     <a id="nginx_445">
     </a>
     nginx配置
    </h5>
    <pre><code class="prism language-bash">luckfox-pico/project/app/ipcweb/ipcweb-backend/ipcweb-env-arm/etc4oem$ <span class="token function">scp</span> <span class="token parameter variable">-r</span> ./nginx root@192.168.9.161:/oem/usr/etc
</code></pre>
    <h5>
     <a id="nginx_450">
     </a>
     nginx主程序
    </h5>
    <pre><code class="prism language-bash">luckfox-pico/project/app/ipcweb/ipcweb-backend/ipcweb-env-arm$ <span class="token function">scp</span> <span class="token parameter variable">-r</span> ./usr root@192.168.9.161:/oem
</code></pre>
    <h5>
     <a id="_455">
     </a>
     创建前端文件夹
    </h5>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@luckfox usr<span class="token punctuation">]</span><span class="token comment"># mkdir ./www</span>
</code></pre>
    <h5>
     <a id="indexhtml_460">
     </a>
     在前端文件夹里面创建index.html
    </h5>
    <pre><code class="prism language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>nginx测试<span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Hello, World<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre>
    <h4>
     <a id="_477">
     </a>
     测试
    </h4>
    <p>
     重启下位机，在浏览器输入下位机ip，正常显示hello world。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343634333138392f:61727469636c652f64657461696c732f313436323439323930" class_="artid" style="display:none">
 </p>
</div>


