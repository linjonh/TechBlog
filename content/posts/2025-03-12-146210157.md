---
layout: post
title: "Google-Filament-渲染引擎2-Backend-核心类介绍"
date: 2025-03-12 17:21:26 +0800
description: "本文基于 filament 版本: v1.58.0文本更加阐述 Backend 内部核心类的关系, 示例代码作了非常多的删减和简化文本将以创建纹理为例, 阐述 Backend 内部的流程。后端图形接口以 OpenGL 为例。Dispatcher: 本质上只是一个函数指针的集合，用于将命令与驱动接口的方法绑定。在初始化阶段，这些函数指针就被填充好。Driver: 负责管理底层驱动的状态，以及与硬件交互的具体实现。CommandStream: 负责接收命令，并将其发送到驱动。"
keywords: "Google Filament 渲染引擎(2)-Backend 核心类介绍"
categories: ['图形学基础']
tags: ['渲染引擎', 'Falament']
artid: "146210157"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146210157
    alt: "Google-Filament-渲染引擎2-Backend-核心类介绍"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146210157
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146210157
cover: https://bing.ee123.net/img/rand?artid=146210157
image: https://bing.ee123.net/img/rand?artid=146210157
img: https://bing.ee123.net/img/rand?artid=146210157
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Google Filament 渲染引擎(2)-Backend 核心类介绍
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="Google_Filament_2Backend__0">
     </a>
     Google Filament 渲染引擎(2)-Backend 核心类介绍
    </h3>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/f119900954cf42448731d881cb1f1ab0.png"/>
    </p>
    <p>
     阅读说明:
    </p>
    <ul>
     <li>
      本文基于 filament 版本: v1.58.0
     </li>
     <li>
      文本更加阐述 Backend 内部核心类的关系, 示例代码作了非常多的删减和简化
     </li>
    </ul>
    <p>
     文本将以创建纹理为例, 阐述 Backend 内部的流程。后端图形接口以 OpenGL 为例。
    </p>
    <p>
     核心类的功能概览:
    </p>
    <ul>
     <li>
      Dispatcher: 本质上只是一个函数指针的集合，用于将命令与驱动接口的方法绑定。在初始化阶段，这些函数指针就被填充好。
     </li>
     <li>
      Driver: 负责管理底层驱动的状态，以及与硬件交互的具体实现。
     </li>
     <li>
      CommandStream: 负责接收命令，并将其发送到驱动。
     </li>
     <li>
      Command: 命令对象，包含了具体的命令类型和参数, 负责命令的封装和执行.
     </li>
     <li>
      Engine: 负责管理资源的创建和销毁，以及命令的提交。
     </li>
    </ul>
    <h4>
     <a id="_17">
     </a>
     一、底层驱动初始化
    </h4>
    <pre><code class="prism language-cpp"><span class="token comment">// --------------------------------- step1: 创建 Driver ----------------------------------</span>
Backend mBackend <span class="token operator">=</span> Backend<span class="token double-colon punctuation">::</span>OPENGL<span class="token punctuation">;</span>
<span class="token comment">// 根据类型选择平台, 以 PlatformCocoaGL 为例</span>
PlatformCocoaGL platform <span class="token operator">=</span> filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span><span class="token class-name">PlatformFactory</span><span class="token double-colon punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mBackend<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 根据平台创建驱动, 这里 driver 的类型是 OpenGLDriver</span>
Driver<span class="token operator">*</span> driver <span class="token operator">=</span> platform<span class="token operator">-&gt;</span><span class="token function">createDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// --------------------------------- step2: 创建 CommandStream ----------------------------------</span>
<span class="token keyword">using</span> DriverApi <span class="token operator">=</span> filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>CommandStream<span class="token punctuation">;</span>
<span class="token comment">// 这里完成 底层驱动 绑定到 CommandStream 的 Dispatcher 上</span>
DriverApi<span class="token operator">*</span> driverApi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">DriverApi</span><span class="token punctuation">(</span><span class="token operator">*</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_33">
     </a>
     二、创建纹理
    </h4>
    <p>
     应用层创建代码:
    </p>
    <pre><code class="prism language-cpp">filament<span class="token double-colon punctuation">::</span>Texture<span class="token operator">*</span> texture <span class="token operator">=</span> <span class="token class-name">Texture</span><span class="token double-colon punctuation">::</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">levels</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sampler</span><span class="token punctuation">(</span>Texture<span class="token double-colon punctuation">::</span>Sampler<span class="token double-colon punctuation">::</span>SAMPLER_EXTERNAL<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token operator">*</span>mEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-cpp">Texture<span class="token operator">*</span> Texture<span class="token double-colon punctuation">::</span><span class="token class-name">Builder</span><span class="token double-colon punctuation">::</span><span class="token function">build</span><span class="token punctuation">(</span>Engine<span class="token operator">&amp;</span> engine<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 调用 Engine 的 createTexture 方法</span>
    <span class="token keyword">return</span> <span class="token function">downcast</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_49">
     </a>
     三、核心类
    </h4>
    <h5>
     <a id="1Engine_50">
     </a>
     1、Engine
    </h5>
    <pre><code class="prism language-cpp"><span class="token comment">// ====&gt; 模板展开后的 createTexture 函数</span>
FTexture<span class="token operator">*</span> <span class="token class-name">FEngine</span><span class="token double-colon punctuation">::</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token keyword">const</span> Texture<span class="token double-colon punctuation">::</span>Builder<span class="token operator">&amp;</span> builder<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 展开 create 模板调用</span>
    FTexture<span class="token operator">*</span> p <span class="token operator">=</span> mHeapAllocator<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">make</span><span class="token generic class-name"><span class="token operator">&lt;</span>FTexture<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mTextures<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token class-name">FTexture</span><span class="token double-colon punctuation">::</span><span class="token function">FTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    backend<span class="token double-colon punctuation">::</span>Handle<span class="token operator">&lt;</span>backend<span class="token double-colon punctuation">::</span>HwTexture<span class="token operator">&gt;</span> mHandle<span class="token punctuation">;</span>

    <span class="token comment">// driver 的实际类型是 CommandStream</span>
    FEngine<span class="token double-colon punctuation">::</span>DriverApi<span class="token operator">&amp;</span> driver <span class="token operator">=</span> engine<span class="token punctuation">.</span><span class="token function">getDriverApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mHandle <span class="token operator">=</span> driver<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span>
                mTarget<span class="token punctuation">,</span> mLevelCount<span class="token punctuation">,</span> mFormat<span class="token punctuation">,</span> mSampleCount<span class="token punctuation">,</span> mWidth<span class="token punctuation">,</span> mHeight<span class="token punctuation">,</span> mDepth<span class="token punctuation">,</span> mUsage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2CommandStream_75">
     </a>
     2、CommandStream
    </h5>
    <pre><code class="prism language-cpp"><span class="token comment">// 构造函数:</span>
<span class="token class-name">CommandStream</span><span class="token double-colon punctuation">::</span><span class="token function">CommandStream</span><span class="token punctuation">(</span>Driver<span class="token operator">&amp;</span> driver<span class="token punctuation">,</span> CircularBuffer<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
        <span class="token operator">:</span> <span class="token function">mDriver</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">mCurrentBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">mDispatcher</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span><span class="token function">getDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">// 纹理创建函数</span>
  <span class="token keyword">inline</span> backend<span class="token double-colon punctuation">::</span>TextureHandle <span class="token function">createTexture</span><span class="token punctuation">(</span>
    backend<span class="token double-colon punctuation">::</span>SamplerType target<span class="token punctuation">,</span>
    <span class="token keyword">uint8_t</span> levels<span class="token punctuation">,</span>
    backend<span class="token double-colon punctuation">::</span>TextureFormat format<span class="token punctuation">,</span>
    <span class="token keyword">uint8_t</span> samples<span class="token punctuation">,</span>
    <span class="token keyword">uint32_t</span> width<span class="token punctuation">,</span>
    <span class="token keyword">uint32_t</span> height<span class="token punctuation">,</span>
    <span class="token keyword">uint32_t</span> depth<span class="token punctuation">,</span>
    backend<span class="token double-colon punctuation">::</span>TextureUsage usage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 分配结构体内存</span>
    backend<span class="token double-colon punctuation">::</span>TextureHandle result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>mDriver<span class="token punctuation">.</span><span class="token function">createTextureS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 定义命令类型</span>
    <span class="token keyword">using</span> Cmd <span class="token operator">=</span> CommandType<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Driver<span class="token double-colon punctuation">::</span>createTextureR<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Command<span class="token operator">&lt;</span><span class="token operator">&amp;</span>Driver<span class="token double-colon punctuation">::</span>createTextureR<span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token comment">// 分配命令缓冲区内存</span>
    <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">allocateCommand</span><span class="token punctuation">(</span><span class="token class-name">CommandBase</span><span class="token double-colon punctuation">::</span><span class="token function">align</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Cmd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在分配的内存上构造命令对象</span>
    <span class="token keyword">new</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token function">Cmd</span><span class="token punctuation">(</span>
        <span class="token comment">// 真正需要执行的命令</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>mDispatcher<span class="token punctuation">.</span>createTexture_<span class="token punctuation">,</span>
        backend<span class="token double-colon punctuation">::</span><span class="token function">TextureHandle</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>levels<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>samples<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>depth<span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>usage<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="3Command_127">
     </a>
     3、Command
    </h5>
    <pre><code class="prism language-cpp"><span class="token comment">// 特化模板类 Command</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Command</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Driver<span class="token double-colon punctuation">::</span>createTextureR<span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token keyword">public</span> filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>CommandBase <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">using</span> SavedParameters <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>tuple<span class="token operator">&lt;</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Handle<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>HwTexture<span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>SamplerType<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureFormat<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token double-colon punctuation">::</span>remove_reference_t<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureUsage<span class="token operator">&gt;</span>
    <span class="token operator">&gt;</span><span class="token punctuation">;</span>

    SavedParameters mArgs<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span>
    <span class="token keyword">template</span> <span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>size_t <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>I<span class="token operator">&gt;</span>
    <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>index_sequence<span class="token operator">&lt;</span>I<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">M</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">D</span><span class="token operator">&gt;</span>
    <span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>M <span class="token operator">&amp;&amp;</span>method<span class="token punctuation">,</span> D <span class="token operator">&amp;&amp;</span>driver<span class="token punctuation">,</span> filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>CommandBase <span class="token operator">*</span>base<span class="token punctuation">,</span> intptr_t <span class="token operator">*</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">inline</span> <span class="token function">Command</span><span class="token punctuation">(</span>Command<span class="token operator">&lt;</span><span class="token operator">&amp;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Driver<span class="token double-colon punctuation">::</span>createTextureR<span class="token operator">&gt;</span> <span class="token operator">&amp;&amp;</span>rhs<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>A<span class="token operator">&gt;</span>
    <span class="token keyword">inline</span> <span class="token keyword">constexpr</span> <span class="token keyword">explicit</span> <span class="token function">Command</span><span class="token punctuation">(</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Execute execute<span class="token punctuation">,</span> A <span class="token operator">&amp;&amp;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token keyword">inline</span> <span class="token keyword">constexpr</span> <span class="token keyword">explicit</span> <span class="token generic-function"><span class="token function">Command</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Handle<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>HwTexture<span class="token operator">&gt;</span><span class="token punctuation">,</span>
                                      filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>SamplerType<span class="token punctuation">,</span>
                                      <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">,</span>
                                      filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureFormat<span class="token punctuation">,</span>
                                      <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">,</span>
                                      <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
                                      <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
                                      <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
                                      filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureUsage<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
        filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Execute execute<span class="token punctuation">,</span>
        filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Handle<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>HwTexture<span class="token operator">&gt;</span> <span class="token operator">&amp;&amp;</span>arg1<span class="token punctuation">,</span>
        filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>SamplerType <span class="token operator">&amp;&amp;</span>arg2<span class="token punctuation">,</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">&amp;&amp;</span>arg3<span class="token punctuation">,</span>
        filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureFormat <span class="token operator">&amp;&amp;</span>arg4<span class="token punctuation">,</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">&amp;&amp;</span>arg5<span class="token punctuation">,</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>arg6<span class="token punctuation">,</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>arg7<span class="token punctuation">,</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>arg8<span class="token punctuation">,</span>
        filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureUsage <span class="token operator">&amp;&amp;</span>arg9
    <span class="token punctuation">)</span> <span class="token operator">:</span> filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span><span class="token function">CommandBase</span><span class="token punctuation">(</span>execute<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">mArgs</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>Handle<span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>HwTexture<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>arg1<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>SamplerType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg2<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg3<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureFormat<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg4<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg5<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg6<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg7<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg8<span class="token punctuation">)</span><span class="token punctuation">,</span>
              std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>TextureUsage<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>arg9<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>size_t<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            utils<span class="token double-colon punctuation">::</span><span class="token function">panic</span><span class="token punctuation">(</span><span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token string">"root/filament/filament/backend/include/private/backend/CommandStream.h"</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token string">"ptr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ptr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="4Driver_200">
     </a>
     4、Driver
    </h5>
    <h6>
     <a id="1_202">
     </a>
     1)命令的绑定
    </h6>
    <pre><code class="prism language-cpp">Dispatcher <span class="token class-name">OpenGLDriver</span><span class="token double-colon punctuation">::</span><span class="token function">getDispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> dispatcher <span class="token operator">=</span> <span class="token class-name">ConcreteDispatcher</span><span class="token operator">&lt;</span>OpenGLDriver<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dispatcher<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="2_210">
     </a>
     2)分配结构体内存
    </h6>
    <pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">GLTexture</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">HwTexture</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">using</span> HwTexture<span class="token double-colon punctuation">::</span>HwTexture<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">GL</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">GL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">imported</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">external</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sidecarSamples</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">reserved1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        GLuint id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">// texture or renderbuffer id</span>
        GLenum target <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        GLenum internalFormat <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        GLuint sidecarRenderBufferMS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// multi-sample sidecar renderbuffer</span>

        <span class="token comment">// texture parameters go here too</span>
        GLfloat anisotropy <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword">int8_t</span> baseLevel <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
        <span class="token keyword">int8_t</span> maxLevel <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">uint8_t</span> reserved0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">bool</span> imported           <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">bool</span> external           <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">uint8_t</span> sidecarSamples  <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">uint8_t</span> reserved1       <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>array<span class="token operator">&lt;</span>TextureSwizzle<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">&gt;</span> swizzle<span class="token punctuation">{<!-- --></span>
                TextureSwizzle<span class="token double-colon punctuation">::</span>CHANNEL_0<span class="token punctuation">,</span>
                TextureSwizzle<span class="token double-colon punctuation">::</span>CHANNEL_1<span class="token punctuation">,</span>
                TextureSwizzle<span class="token double-colon punctuation">::</span>CHANNEL_2<span class="token punctuation">,</span>
                TextureSwizzle<span class="token double-colon punctuation">::</span>CHANNEL_3
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> gl<span class="token punctuation">;</span>
    <span class="token keyword">mutable</span> Handle<span class="token operator">&lt;</span>GLTextureRef<span class="token operator">&gt;</span> ref<span class="token punctuation">;</span>
    OpenGLPlatform<span class="token double-colon punctuation">::</span>ExternalTexture<span class="token operator">*</span> externalTexture <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 分配内存并构造一个 filament::backend::GLTexture 对象</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span> Handle<span class="token operator">&lt;</span>GLTexture<span class="token operator">&gt;</span> <span class="token generic-function"><span class="token function">initHandle</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>GLTexture<span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>mHandleAllocator<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">allocateAndConstruct</span><span class="token generic class-name"><span class="token operator">&lt;</span>filament<span class="token double-colon punctuation">::</span>backend<span class="token double-colon punctuation">::</span>GLTexture<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Handle<span class="token operator">&lt;</span>HwTexture<span class="token operator">&gt;</span> <span class="token class-name">OpenGLDriver</span><span class="token double-colon punctuation">::</span><span class="token function">createTextureS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token generic-function"><span class="token function">initHandle</span><span class="token generic class-name"><span class="token operator">&lt;</span>GLTexture<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="3_OpenGL_API__251">
     </a>
     3)使用 OpenGL API 创建纹理
    </h6>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">OpenGLDriver</span><span class="token double-colon punctuation">::</span><span class="token function">createTextureR</span><span class="token punctuation">(</span>Handle<span class="token operator">&lt;</span>HwTexture<span class="token operator">&gt;</span> th<span class="token punctuation">,</span> SamplerType target<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> levels<span class="token punctuation">,</span>
        TextureFormat format<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> samples<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> w<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> h<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> depth<span class="token punctuation">,</span>
        TextureUsage usage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span>gl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>mContext<span class="token punctuation">;</span>
    <span class="token function">glTexStorage2D</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span>gl<span class="token punctuation">.</span>target<span class="token punctuation">,</span> <span class="token function">GLsizei</span><span class="token punctuation">(</span>t<span class="token operator">-&gt;</span>levels<span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token operator">-&gt;</span>gl<span class="token punctuation">.</span>internalFormat<span class="token punctuation">,</span> <span class="token function">GLsizei</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GLsizei</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="5Dispatcher_263">
     </a>
     5、Dispatcher
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">using</span> Execute <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Driver<span class="token operator">&amp;</span> driver<span class="token punctuation">,</span> CommandBase<span class="token operator">*</span> self<span class="token punctuation">,</span> intptr_t<span class="token operator">*</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
Execute createTexture_<span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">// 这里完成 底层驱动 绑定到 Dispatcher 上</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">ConcreteDriver</span><span class="token operator">&gt;</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteDispatcher</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTexture</span><span class="token punctuation">(</span>Driver <span class="token operator">&amp;</span>driver<span class="token punctuation">,</span> CommandBase <span class="token operator">*</span>base<span class="token punctuation">,</span> intptr_t <span class="token operator">*</span>next<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">using</span> Cmd <span class="token operator">=</span> CommandType<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Driver<span class="token double-colon punctuation">::</span>createTextureR<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Command<span class="token operator">&lt;</span><span class="token operator">&amp;</span>Driver<span class="token double-colon punctuation">::</span>createTextureR<span class="token operator">&gt;</span><span class="token punctuation">;</span>
        ConcreteDriver <span class="token operator">&amp;</span>concreteDriver <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>ConcreteDriver <span class="token operator">&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cmd</span><span class="token double-colon punctuation">::</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span> ConcreteDriver<span class="token double-colon punctuation">::</span>createTextureR<span class="token punctuation">,</span> concreteDriver<span class="token punctuation">,</span> base<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">ConcreteDriver</span><span class="token operator">&gt;</span> Dispatcher <span class="token class-name">ConcreteDispatcher</span><span class="token operator">&lt;</span>ConcreteDriver<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Dispatcher dispatcher<span class="token punctuation">;</span>
    dispatcher<span class="token punctuation">.</span>createTexture_ <span class="token operator">=</span> <span class="token operator">&amp;</span>ConcreteDispatcher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>createTexture<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> dispatcher<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_286">
     </a>
     四、总结
    </h4>
    <p>
     这表明 Engine -&gt; CommandStream -&gt; Dispatcher 形成了调用链，每一层都负责不同的任务，Engine 负责 API 层接口，CommandStream 负责命令封装，Dispatcher 负责命令派发, Driver 负责最终执行。
    </p>
    <h4>
     <a id="_290">
     </a>
     五、辅助工具
    </h4>
    <h5>
     <a id="1Engine_291">
     </a>
     1)Engine
    </h5>
    <p>
     命令出处：
    </p>
    <blockquote>
     <p>
      cmake-build-debug/compile_commands.json
     </p>
    </blockquote>
    <p>
     预处理命令:
    </p>
    <pre><code class="prism language-js"><span class="token comment">// root/filament:</span>
clang<span class="token operator">++</span> <span class="token operator">-</span><span class="token constant">E</span> \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>libs<span class="token operator">/</span>filabridge<span class="token operator">/</span>include \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>third_party<span class="token operator">/</span>robin<span class="token operator">-</span>map \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>libs<span class="token operator">/</span>utils<span class="token operator">/</span>include \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>libs<span class="token operator">/</span>filaflat<span class="token operator">/</span>include \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>libs<span class="token operator">/</span>math<span class="token operator">/</span>include \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>cmake<span class="token operator">-</span>build<span class="token operator">-</span>debug<span class="token operator">/</span>filament<span class="token operator">/</span> \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token operator">/</span>include \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token operator">/</span>backend<span class="token operator">/</span>include \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>details \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token operator">/</span>components \
<span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token operator">/</span>src \
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>details<span class="token operator">/</span>Engine<span class="token punctuation">.</span>cpp <span class="token operator">-</span>o <span class="token number">123</span><span class="token punctuation">.</span>cpp
</code></pre>
    <p>
     编译模板展开:
    </p>
    <pre><code class="prism language-js"><span class="token comment">// root/filament:</span>
clang<span class="token operator">++</span> \
<span class="token operator">-</span>Xclang <span class="token operator">-</span>ast<span class="token operator">-</span>print <span class="token operator">-</span>fsyntax<span class="token operator">-</span>only <span class="token operator">-</span>std<span class="token operator">=</span>c<span class="token operator">++</span><span class="token number">17</span> \
 root<span class="token operator">/</span>filament<span class="token operator">/</span>filament<span class="token operator">/</span>src<span class="token operator">/</span>Engine<span class="token punctuation">.</span>cpp <span class="token operator">&gt;</span> record_layouts<span class="token punctuation">.</span>txt <span class="token number">2</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token number">1</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>filament<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>cmake<span class="token operator">-</span>build<span class="token operator">-</span>debug<span class="token operator">/</span>filament \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>filament<span class="token operator">/</span>src \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>filament<span class="token operator">/</span>backend<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>math<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>utils<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>robin<span class="token operator">-</span>map<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>bluevk<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>vkmemalloc<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>smol<span class="token operator">-</span>v<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>source \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>filaflat<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>filabridge<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>ibl<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>matdbg<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>civetweb<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>libs<span class="token operator">/</span>filamat<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>cmake<span class="token operator">-</span>build<span class="token operator">-</span>debug<span class="token operator">/</span>shaders \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>cmake<span class="token operator">-</span>build<span class="token operator">-</span>debug<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>glslang<span class="token operator">/</span>glslang<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>Include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>glslang<span class="token operator">/</span>glslang<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>Public \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>glslang<span class="token operator">/</span>glslang<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>MachineIndependent \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>glslang<span class="token operator">/</span>glslang<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>glslang<span class="token operator">/</span><span class="token constant">SPIRV</span><span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>glslang<span class="token operator">/</span><span class="token constant">SPIRV</span><span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>spirv<span class="token operator">-</span>tools<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>spirv<span class="token operator">-</span>headers<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>third_party<span class="token operator">/</span>spirv<span class="token operator">-</span>cross<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
    <h5>
     <a id="2CommandStream_349">
     </a>
     2)CommandStream
    </h5>
    <p>
     预处理命令:
    </p>
    <pre><code class="prism language-js"><span class="token comment">// root/filament/backend:</span>
g<span class="token operator">++</span> <span class="token operator">-</span><span class="token constant">E</span> <span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>libs<span class="token operator">/</span>utils<span class="token operator">/</span>include <span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>libs<span class="token operator">/</span>math<span class="token operator">/</span>include <span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>include <span class="token operator">-</span><span class="token constant">I</span><span class="token punctuation">.</span><span class="token operator">/</span>include  <span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>CommandStream<span class="token punctuation">.</span>cpp <span class="token operator">-</span>o CommandStream<span class="token punctuation">.</span>i
</code></pre>
    <h5>
     <a id="3Driver_356">
     </a>
     3)Driver
    </h5>
    <pre><code class="prism language-js">clang<span class="token operator">++</span> \
<span class="token operator">-</span>Xclang <span class="token operator">-</span>ast<span class="token operator">-</span>print <span class="token operator">-</span>fsyntax<span class="token operator">-</span>only <span class="token operator">-</span>std<span class="token operator">=</span>c<span class="token operator">++</span><span class="token number">17</span> \
root<span class="token operator">/</span>filament<span class="token operator">/</span>backend<span class="token operator">/</span>src<span class="token operator">/</span>opengl<span class="token operator">/</span>OpenGLDriver<span class="token punctuation">.</span>cpp <span class="token operator">&gt;</span> record_layouts<span class="token punctuation">.</span>txt <span class="token number">2</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token number">1</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>cmake<span class="token operator">-</span>build<span class="token operator">-</span>debug<span class="token operator">/</span>filament \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>src \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>backend<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>filament<span class="token operator">/</span>backend<span class="token operator">/</span>src \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>cmake<span class="token operator">-</span>build<span class="token operator">-</span>debug<span class="token operator">/</span>filament<span class="token operator">/</span>backend \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>libs<span class="token operator">/</span>math<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>libs<span class="token operator">/</span>utils<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>third_party<span class="token operator">/</span>robin<span class="token operator">-</span>map<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span> \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>libs<span class="token operator">/</span>bluegl<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>libs<span class="token operator">/</span>bluevk<span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>third_party<span class="token operator">/</span>vkmemalloc<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>include \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>third_party<span class="token operator">/</span>smol<span class="token operator">-</span>v<span class="token operator">/</span>tnt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>source \
<span class="token operator">-</span>Iroot<span class="token operator">/</span>third_party<span class="token operator">/</span>spirv<span class="token operator">-</span>headers<span class="token operator">/</span>include
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32313437363935332f:61727469636c652f64657461696c732f313436323130313537" class_="artid" style="display:none">
 </p>
</div>


