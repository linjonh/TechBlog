---
layout: post
title: "redis有哪几种持久化方式"
date: 2025-03-07 17:31:31 +0800
description: "适合对性能要求高、数据丢失不敏感的场景。"
keywords: "redis有哪几种持久化方式"
categories: ['Redis']
tags: ['缓存', '数据库', 'Redis']
artid: "146101062"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146101062
    alt: "redis有哪几种持久化方式"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146101062
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146101062
cover: https://bing.ee123.net/img/rand?artid=146101062
image: https://bing.ee123.net/img/rand?artid=146101062
img: https://bing.ee123.net/img/rand?artid=146101062
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     redis有哪几种持久化方式
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     Redis 提供了两种持久化方式：
     <strong>
      RDB（Redis Database）
     </strong>
     和
     <strong>
      AOF（Append-Only File）
     </strong>
     。它们各有优缺点，适用于不同的场景。以下是它们的原理、优缺点以及如何选择的建议：
    </p>
    <hr/>
    <h4>
     1.
     <strong>
      RDB（Redis Database）
     </strong>
    </h4>
    <h5>
     <strong>
      原理
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       RDB 是 Redis 的快照持久化方式。
      </p>
     </li>
     <li>
      <p>
       Redis 会定期将内存中的数据生成一个二进制快照文件（
       <code>
        .rdb
       </code>
       ），并保存到磁盘。
      </p>
     </li>
     <li>
      <p>
       可以通过配置
       <code>
        save
       </code>
       参数设置触发快照的条件（如
       <code>
        save 900 1
       </code>
       表示 900 秒内至少有 1 个 Key 被修改时触发快照）。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      优点
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        性能高
       </strong>
       ：生成快照是异步操作，对 Redis 的性能影响较小。
      </p>
     </li>
     <li>
      <p>
       <strong>
        文件紧凑
       </strong>
       ：RDB 文件是二进制格式，文件体积小，适合备份和恢复。
      </p>
     </li>
     <li>
      <p>
       <strong>
        恢复速度快
       </strong>
       ：恢复数据时直接加载 RDB 文件，速度比 AOF 快。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      缺点
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        数据丢失风险
       </strong>
       ：如果 Redis 崩溃，最后一次快照之后的数据会丢失。
      </p>
     </li>
     <li>
      <p>
       <strong>
        不适合实时持久化
       </strong>
       ：快照是定期生成的，无法做到实时持久化。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      适用场景
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       适合对数据丢失不敏感的场景，如缓存、数据分析等。
      </p>
     </li>
     <li>
      <p>
       适合需要快速备份和恢复的场景。
      </p>
     </li>
    </ul>
    <hr/>
    <h4>
     2.
     <strong>
      AOF（Append-Only File）
     </strong>
    </h4>
    <h5>
     <strong>
      原理
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       AOF 是 Redis 的日志持久化方式。
      </p>
     </li>
     <li>
      <p>
       Redis 会将每个写操作（如
       <code>
        SET
       </code>
       、
       <code>
        DEL
       </code>
       ）追加到 AOF 文件的末尾。
      </p>
     </li>
     <li>
      <p>
       可以通过配置
       <code>
        appendfsync
       </code>
       参数控制 AOF 文件的同步频率：
      </p>
      <ul>
       <li>
        <p>
         <code>
          always
         </code>
         ：每次写操作都同步到磁盘，数据最安全，但性能最低。
        </p>
       </li>
       <li>
        <p>
         <code>
          everysec
         </code>
         ：每秒同步一次，性能和数据安全性折中（默认配置）。
        </p>
       </li>
       <li>
        <p>
         <code>
          no
         </code>
         ：由操作系统决定同步时机，性能最高，但数据安全性最低。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <strong>
      优点
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        数据安全性高
       </strong>
       ：AOF 文件记录了所有写操作，数据丢失风险低。
      </p>
     </li>
     <li>
      <p>
       <strong>
        支持实时持久化
       </strong>
       ：通过
       <code>
        appendfsync always
       </code>
       可以实现实时持久化。
      </p>
     </li>
     <li>
      <p>
       <strong>
        可读性强
       </strong>
       ：AOF 文件是文本格式，可以手动编辑或分析。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      缺点
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        文件体积大
       </strong>
       ：AOF 文件记录了所有写操作，文件体积通常比 RDB 大。
      </p>
     </li>
     <li>
      <p>
       <strong>
        恢复速度慢
       </strong>
       ：恢复数据时需要重放 AOF 文件中的写操作，速度比 RDB 慢。
      </p>
     </li>
     <li>
      <p>
       <strong>
        性能开销大
       </strong>
       ：频繁的写操作和同步会影响 Redis 的性能。
      </p>
     </li>
    </ul>
    <h5>
     <strong>
      适用场景
     </strong>
     ：
    </h5>
    <ul>
     <li>
      <p>
       适合对数据安全性要求高的场景，如金融、订单等。
      </p>
     </li>
     <li>
      <p>
       适合需要实时持久化的场景。
      </p>
     </li>
    </ul>
    <hr/>
    <h4>
     3.
     <strong>
      RDB 和 AOF 的对比
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        特性
       </th>
       <th>
        RDB（快照）
       </th>
       <th>
        AOF（日志）
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         持久化方式
        </strong>
       </td>
       <td>
        定期生成快照
       </td>
       <td>
        记录每个写操作
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         文件格式
        </strong>
       </td>
       <td>
        二进制
       </td>
       <td>
        文本
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         文件体积
        </strong>
       </td>
       <td>
        小
       </td>
       <td>
        大
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         数据安全性
        </strong>
       </td>
       <td>
        较低（可能丢失最后一次快照后的数据）
       </td>
       <td>
        较高（可以配置为实时持久化）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         恢复速度
        </strong>
       </td>
       <td>
        快
       </td>
       <td>
        慢
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         性能开销
        </strong>
       </td>
       <td>
        低
       </td>
       <td>
        高
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         适用场景
        </strong>
       </td>
       <td>
        缓存、数据分析
       </td>
       <td>
        金融、订单等对数据安全性要求高的场景
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     4.
     <strong>
      如何选择？
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        单独使用 RDB
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         适合对数据丢失不敏感的场景。
        </p>
       </li>
       <li>
        <p>
         适合需要快速备份和恢复的场景。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        单独使用 AOF
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         适合对数据安全性要求高的场景。
        </p>
       </li>
       <li>
        <p>
         适合需要实时持久化的场景。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        同时使用 RDB 和 AOF
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         结合两者的优点，RDB 用于定期备份，AOF 用于实时持久化。
        </p>
       </li>
       <li>
        <p>
         恢复时优先使用 AOF 文件，确保数据完整性。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     5.
     <strong>
      配置示例
     </strong>
    </h4>
    <h5>
     <strong>
      RDB 配置
     </strong>
     ：
    </h5>
    <p>
     bash
    </p>
    <p>
    </p>
    <pre>save 900 1      # 900 秒内至少有 1 个 Key 被修改时触发快照
save 300 10     # 300 秒内至少有 10 个 Key 被修改时触发快照
save 60 10000   # 60 秒内至少有 10000 个 Key 被修改时触发快照
dbfilename dump.rdb  # RDB 文件名
dir /var/lib/redis   # RDB 文件保存路径</pre>
    <h5>
     <strong>
      AOF 配置
     </strong>
     ：
    </h5>
    <p>
     bash
    </p>
    <pre>appendonly yes               # 启用 AOF
appendfilename "appendonly.aof"  # AOF 文件名
appendfsync everysec         # 每秒同步一次
dir /var/lib/redis           # AOF 文件保存路径</pre>
    <hr/>
    <h4>
     6.
     <strong>
      总结
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        RDB
       </strong>
       ：适合对性能要求高、数据丢失不敏感的场景。
      </p>
     </li>
     <li>
      <p>
       <strong>
        AOF
       </strong>
       ：适合对数据安全性要求高、需要实时持久化的场景。
      </p>
     </li>
     <li>
      <p>
       <strong>
        结合使用
       </strong>
       ：可以同时启用 RDB 和 AOF，兼顾性能和数据安全性。
      </p>
     </li>
    </ul>
   </div>
  </div>
 </article>
 <p alt="687474:70733a2f2f626c6f672e6373646e2e6e65742f6a766571692f:61727469636c652f64657461696c732f313436313031303632" class_="artid" style="display:none">
 </p>
</div>


