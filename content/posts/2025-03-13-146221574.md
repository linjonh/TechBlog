---
layout: post
title: "spark实验"
date: 2025-03-13 08:48:37 +0800
description: "每个输入文件表示班级学生某个学科的成绩，每行内容由两个字段组成，第一个是学生名字，第二个是学生的成绩；下面是输入文件和输出文件的一个样例，供参考。# 读取所有输入文件，假设它们是以空格分隔的文本文件，并且第一列是学生名字，第二列是成绩。# 读取文件A和B，假设它们是以空格分隔的文本文件，并且没有列头。独立应用程序，对两个文件进行合并，并剔除其中重复的内容，得到一个新文件。# 输入文件列表（这里假设有三个文件，分别代表不同学科的成绩）下面是输入文件和输出文件的一个样例，供参考。"
keywords: "spark实验"
categories: ['未分类']
tags: ['大数据', '前端', '分布式', 'Vim', 'Python', 'Hadoop']
artid: "146221574"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146221574
    alt: "spark实验"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146221574
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146221574
cover: https://bing.ee123.net/img/rand?artid=146221574
image: https://bing.ee123.net/img/rand?artid=146221574
img: https://bing.ee123.net/img/rand?artid=146221574
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     spark实验
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       “data01.txt”
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       数据集包含了某大学计算机系的成绩，数据格式如下所示：
      </span>
     </span>
    </p>
    <table border="1" cellspacing="0" style="margin-left:3.0000pt; width:489.6000pt">
     <tbody>
      <tr>
       <td style="vertical-align:top; width:332.4000pt">
        <p style="margin-left:0; margin-right:0; text-align:left">
         Tom,DataBase,80
        </p>
        <p style="margin-left:0; margin-right:0; text-align:left">
         Tom,Algorithm,50
        </p>
        <p style="margin-left:0; margin-right:0; text-align:left">
         Tom,DataStructure,60
        </p>
        <p style="margin-left:0; margin-right:0; text-align:left">
         Jim,DataBase,90
        </p>
        <p style="margin-left:0; margin-right:0; text-align:left">
         Jim,Algorithm,60
        </p>
        <p style="margin-left:0; margin-right:0; text-align:left">
         Jim,DataStructure,80
        </p>
        <p style="margin-left:0; margin-right:0; text-align:left">
         ……
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       请根据给定的实验数据，在
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       pyspark
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       中通过编程来计算以下内容：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       （1）
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       该系总共有多少学生；
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       （2）
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       该系共开设了多少门课程；
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       （3）
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       Tom
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       同学的总成绩平均分是多少；
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       （4）
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       求每名同学的选修的课程门数；
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       （5）
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       该系
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       DataBase
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       课程共有多少人选修；
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       （6）
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       各门课程的平均分是多少；
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       2.编写独立应用程序实现数据去重
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       对于两个输入文件
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       A
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       和
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       B
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       ，编写
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       Spark
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       独立应用程序，对两个文件进行合并，并剔除其中重复的内容，得到一个新文件
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       C
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       。下面是输入文件和输出文件的一个样例，供参考。
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       输入文件
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       A
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       的样例如下：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170101    x
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170102    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170103    x
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170104    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170105    z
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170106    z
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       输入文件
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       B
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       的样例如下：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170101    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170102    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170103    x
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170104    z
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170105    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       根据输入的文件
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       A
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       和
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       B
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       合并得到的输出文件
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       C
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       的样例如下：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170101    x
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170101    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170102    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170103    x
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170104    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170104    z
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170105    y
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170105    z
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       20170106    z
      </span>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:left">
     <span style="background-color:#f7f8fa">
      <span style="background-color:#f7f8fa">
       <span style="color:#acb4bf">
        Plain Text
       </span>
      </span>
     </span>
    </p>
    <table border="1" cellspacing="0" style="margin-left:5.4000pt; width:464.6500pt">
     <tbody>
      <tr>
       <td style="vertical-align:top">
        <p style="margin-left:.0001pt; margin-right:0; text-align:left">
        </p>
       </td>
       <td style="vertical-align:center">
        <p style="margin-left:.0001pt; margin-right:0; text-align:left">
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       3.编写独立应用程序实现求平均值问题
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       每个输入文件表示班级学生某个学科的成绩，每行内容由两个字段组成，第一个是学生名字，第二个是学生的成绩；编写
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       Spark
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       独立应用程序求出所有学生的平均成绩，并输出到一个新文件中。下面是输入文件和输出文件的一个样例，供参考。
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       Algorithm
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       成绩：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小明
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       92
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小红
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       87
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小新
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       82
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小丽
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       90
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       Database
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       成绩：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小明
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       95
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小红
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       81
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小新
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       89
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小丽
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       85
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       Python
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       成绩：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小明
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       82
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小红
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       83
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小新
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       94
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小丽
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       91
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       平均成绩如下：
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       (
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小红
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       ,83.67)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       (
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小新
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       ,88.33)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       (
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小明
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       ,89.67)
      </span>
     </span>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       (
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       小丽
      </span>
     </span>
     <span style="background-color:#ffffff">
      <span style="color:#181e33">
       ,88.67)
      </span>
     </span>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     下载spark 可以使用下载pip install pyspark
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     官网下载spark
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     实际代码
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql import SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql.functions import avg, col, countDistinct
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 初始化 SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     spark = SparkSession.builder.appName("GradeAnalysis").getOrCreate()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 读取数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     data_path = "data01.txt"
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     lines = spark.read.text(data_path).rdd
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 分割数据并转换为 DataFrame
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     data = lines.map(lambda line: line.value.split(',')) \
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .map(lambda x: (x[0], x[1], int(x[2]))) \
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .toDF(["Student", "Course", "Score"])
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 1. 计算该系总共有多少学生
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     students_count = data.select("Student").distinct().count()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     print(f"学生总数: {students_count}")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 2. 计算该系共开设了多少门课程
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     courses_count = data.select("Course").distinct().count()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     print(f"课程总数: {courses_count}")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 3. 计算Tom同学的总成绩平均分
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     tom_avg_score = data.filter(data.Student == "Tom").groupBy().agg(avg("Score").alias("AvgScore")).collect()[0]["AvgScore"]
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     print(f"Tom同学的总成绩平均分: {tom_avg_score}")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 4. 计算每名同学的选修的课程门数
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     students_courses_count = data.groupBy("Student").agg(countDistinct("Course").alias("CourseCount")).show()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     print("每名同学的选修的课程门数:")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     students_courses_count.show()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 5. 计算该系DataBase课程共有多少人选修
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     db_students_count = data.filter(data.Course == "DataBase").select("Student").distinct().count()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     print(f"DataBase课程选修人数: {db_students_count}")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 6. 计算各门课程的平均分
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     courses_avg_score = data.groupBy("Course").agg(avg("Score").alias("AvgScore")).show()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     print("各门课程的平均分:")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     courses_avg_score.show()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 停止 SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     spark.stop()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="399" src="https://i-blog.csdnimg.cn/direct/67cdcb610b3e44ae9ca1fd18872a5bb4.png" width="691"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     二．
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql import SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql.functions import col
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     def merge_and_deduplicate(fileA, fileB, outputFile):
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 创建SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     spark = SparkSession.builder \
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .appName("MergeAndDeduplicate") \
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .getOrCreate()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 读取文件A和B，假设它们是以空格分隔的文本文件，并且没有列头
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfA = spark.read.csv(fileA, header=False, inferSchema=True, sep=" ")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfB = spark.read.csv(fileB, header=False, inferSchema=True, sep=" ")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 为DataFrame设置列名（这里我们假设只有两列，分别是日期和值）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfA = dfA.withColumnRenamed("_c0", "date").withColumnRenamed("_c1", "value")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfB = dfB.withColumnRenamed("_c0", "date").withColumnRenamed("_c1", "value")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 合并两个DataFrame
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfCombined = dfA.unionByName(dfB)
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 去重（基于两列的组合）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfDeduplicated = dfCombined.dropDuplicates()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 将结果写入新的文件C
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfDeduplicated.write.csv(outputFile, header=True, sep=" ")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 停止SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     spark.stop()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 调用函数，传入文件路径和输出路径
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     merge_and_deduplicate("A.txt", "B.txt", "C.txt")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="83" src="https://i-blog.csdnimg.cn/direct/16db902f617c4df98c13e4f35019960c.png" width="691"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="389" src="https://i-blog.csdnimg.cn/direct/8bb061e9659944bca90e5d9bed6205cb.png" width="691"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="389" src="https://i-blog.csdnimg.cn/direct/51dad4958d0647d796a634c82d77795c.png" width="691"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     三．
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql import SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql.functions import avg
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from pyspark.sql.group import GroupedData
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     def calculate_average_scores(input_files, output_file):
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 创建SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     spark = SparkSession.builder \
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .appName("AverageScoresCalculator") \
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .getOrCreate()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 读取所有输入文件，假设它们是以空格分隔的文本文件，并且第一列是学生名字，第二列是成绩
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 由于我们不知道有多少个文件，所以使用reduce来逐个union它们
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     from functools import reduce
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     dfs = [spark.read.csv(file, header=False, inferSchema=True, sep=" ") for file in input_files]
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     df_combined = reduce(lambda df1, df2: df1.unionByName(df2), dfs)
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 为DataFrame设置列名
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     df_combined = df_combined.withColumnRenamed("_c0", "student_name").withColumnRenamed("_c1", "score")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 将成绩列转换为数值类型（如果inferSchema没有正确推断的话）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     df_combined = df_combined.withColumn("score", df_combined["score"].cast("double"))
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 按学生名字分组，并计算平均成绩
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     grouped = df_combined.groupBy("student_name")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     avg_scores = grouped.agg(avg("score").alias("average_score"))
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 将结果写入新的文件
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     avg_scores.write.csv(output_file, header=True, sep=" ")
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 停止SparkSession
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     spark.stop()
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 输入文件列表（这里假设有三个文件，分别代表不同学科的成绩）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     input_files = ["1.txt", "2.txt", "3.txt"]
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 输出文件路径
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     output_file = "average_scores.txt"
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     # 调用函数，传入输入文件列表和输出文件路径
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     calculate_average_scores(input_files, output_file)
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="124" src="https://i-blog.csdnimg.cn/direct/258c9b29250041428ddef5f493a9ac2b.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="604" src="https://i-blog.csdnimg.cn/direct/cd7363690e0f4564856960d31c18a1fa.png" width="692"/>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <img alt="" height="389" src="https://i-blog.csdnimg.cn/direct/3876c1505ec64f07a83706e2a5fe74db.png" width="692"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37353034323136392f:61727469636c652f64657461696c732f313436323231353734" class_="artid" style="display:none">
 </p>
</div>


