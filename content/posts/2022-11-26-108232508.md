---
layout: post
title: "Python3,网站搭建之数据库表设计及数据存储文末的彩蛋,我酸了"
date: 2022-11-26 23:15:30 +0800
description: "搭建自己的网站，是作为一个码农成功标志之一，那其他的成功标志能就有，左手搂着白富美，右手撸着小烧烤，"
keywords: "Python爬虫,学术论文,数据抓取"
categories: ['Python', 'Python']
tags: ['数据库', 'Python', 'Mysql']
artid: "108232508"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=108232508
    alt: "Python3,网站搭建之数据库表设计及数据存储文末的彩蛋,我酸了"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=108232508
featuredImagePreview: https://bing.ee123.net/img/rand?artid=108232508
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python3，网站搭建之数据库表设计及数据存储！文末的彩蛋，我酸了~
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     搭建自己的网站，是作为一个码农
     <strong>
      成功标志
     </strong>
     之一，
     <br/>
     那其他成功标志有啥呢，
     <br/>
     嘿…
     <br/>
     <strong>
      左手搂着白富美，右手撸着小烧烤，脚底踩着桑塔纳…
     </strong>
     <br/>
     嗯~
     <br/>
     这么潇洒的人生，就从
     <strong>
      数据库表设计及数据存储
     </strong>
     开始吧！
    </p>
    <p>
    </p>
    <div class="toc">
     <h4>
      数据库表设计及存储数据
     </h4>
     <ul>
      <li>
       <a href="#1__8" rel="nofollow">
        1. 爬取数据
       </a>
      </li>
      <li>
       <a href="#2__168" rel="nofollow">
        2. 创建数据库
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#21__169" rel="nofollow">
          2.1 创建数据库表
         </a>
        </li>
        <li>
         <a href="#22__195" rel="nofollow">
          2.2 连接数据库
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#3__291" rel="nofollow">
        3. 数据存储
       </a>
      </li>
      <li>
       <a href="#4__348" rel="nofollow">
        4. 彩蛋
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="1__8">
     </a>
     1. 爬取数据
    </h2>
    <p>
     有的小朋友会说，鱼叔，你这不是数据库表设计吗，怎么还送套餐是咋的？
     <br/>
     哈哈~
     <br/>
     买二送一…
     <br/>
     我们爬取数据，是为了把数据直接存储到数据库中，这样就省下来造数据的过程~
     <br/>
     我们今天爬取的内容，是这个网站
    </p>
    <pre><code class="prism language-python">url <span class="token operator">=</span> https<span class="token punctuation">:</span><span class="token operator">//</span>arxiv<span class="token punctuation">.</span>org<span class="token operator">/</span><span class="token builtin">list</span><span class="token operator">/</span>cs<span class="token operator">/</span>recent
</code></pre>
    <p>
     这里汇集了外国各路大佬的大神级作品，而且还是
     <strong>
      免费
     </strong>
     的！
     <br/>
     如果看不懂的话，可以谷歌翻译~！
     <br/>
     <strong>
      我们看看这个网站长啥样子
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8e508d651581096526e510ae29a840b3.png#pic_center"/>
    </p>
    <p>
     <strong>
      老规矩，上代码
     </strong>
    </p>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-8-26
"""</span>

<span class="token keyword">import</span> requests
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> traceback
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">from</span> PaperWeb<span class="token punctuation">.</span>Servers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>requests <span class="token keyword">import</span> get_http_session

<span class="token keyword">def</span> <span class="token function">gen_paper</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">#url的skip设定参数，每次展示100条数据</span>
        url <span class="token operator">=</span> <span class="token string">'https://arxiv.org/list/cs/pastweek?skip={skip}&amp;show=100'</span>
        <span class="token comment">#设定headers</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36'</span>

        <span class="token punctuation">}</span>
        <span class="token comment">#设定代理,如果未购买，则不需要填写，</span>
        proxies  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:1092"</span>
            <span class="token string">'https'</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:1092"</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#引用http代理池，避免资源被耗尽</span>
        r <span class="token operator">=</span> get_http_session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>
        <span class="token comment">#不运用代理，则注释掉proxies=proxies</span>
        <span class="token comment">#r = get_http_session().get(url,headers=headers)</span>
        <span class="token comment">#判断返回状态</span>
        <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code <span class="token operator">!=</span><span class="token number">200</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'请求网页失败'</span>
        <span class="token comment">#使用lxml，是因为解析速度快</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>

        <span class="token comment">#获取论文url的信息</span>
        all_dt <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'dt'</span><span class="token punctuation">)</span>
        <span class="token comment">#获取论文的标题与作者</span>
        all_dd <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'dd'</span><span class="token punctuation">)</span>

        <span class="token comment">#使用zip方法，循环获取dd 和dt的内容,</span>
        <span class="token keyword">for</span>  dt<span class="token punctuation">,</span>dd <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>all_dt<span class="token punctuation">,</span>all_dd<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment">#因为class是关键字，所以用_作区分，</span>
            <span class="token comment">#获取url，通过class下的a标签的href链接来获取</span>
            api_url <span class="token operator">=</span> dt<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_ <span class="token operator">=</span> <span class="token string">'list-identifier'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
            root_url <span class="token operator">=</span> <span class="token string">'https://arxiv.org'</span>
            full_url <span class="token operator">=</span> root_url <span class="token operator">+</span> api_url

            <span class="token triple-quoted-string string">"""
            最开始使用contents，是直接获取到title的内容，text获取的内容很多，多而乱
            """</span>

            <span class="token comment">#获取title,通过class标签下的contents获取,返回list</span>
            title <span class="token operator">=</span> dd<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_ <span class="token operator">=</span> <span class="token string">'list-title mathjax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contents
            <span class="token comment">#对内容进行判断,如果titles的长度＞=3，就截取第2部分</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token number">3</span><span class="token punctuation">:</span>
                title <span class="token operator">=</span> title<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment">#text，返回的是str，</span>
                title <span class="token operator">=</span> dd<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_ <span class="token operator">=</span> <span class="token string">'list-title mathjax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text

            <span class="token comment">#论文作者</span>
            authors <span class="token operator">=</span> dd<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'descriptor'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
            <span class="token comment">#由于一行很多作者，所以要进行切分</span>
            authors <span class="token operator">=</span> authors<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>

            <span class="token comment">#生成器</span>
            <span class="token keyword">yield</span> title<span class="token punctuation">,</span>full_url<span class="token punctuation">,</span>authors
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token comment">#输出错误日志信息</span>
        log<span class="token punctuation">(</span>traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token string">'gen_paper.log'</span><span class="token punctuation">)</span>
        error_str <span class="token operator">=</span>  f<span class="token string">'authors:[full_url:[{full_url},{authors}],title:[{title}'</span>
        log<span class="token punctuation">(</span>error_str<span class="token punctuation">,</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token string">'gen_paper.log'</span><span class="token punctuation">)</span>
        <span class="token comment"># #打印错误</span>
        <span class="token comment"># print(e)</span>
        <span class="token comment"># traceback.print_exc()</span>

<span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span>level<span class="token punctuation">,</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""

    :param content:输入错误信息内容
    :param level:错误等级
    :param filepath:路径
    :return:
    """</span>
    <span class="token keyword">if</span> level <span class="token operator">==</span><span class="token string">'error'</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> level <span class="token operator">==</span><span class="token string">'fail'</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f <span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    保存到csv文件中
    :return:
    '''</span>
    <span class="token comment">#定义一个空列表</span>
    resl <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">#循环所有的数据信息，一共有1273条论文，间隔100</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1273</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#这里的i 就是 skip，</span>
        <span class="token keyword">for</span> full_url<span class="token punctuation">,</span>title<span class="token punctuation">,</span>authors <span class="token keyword">in</span> gen_paper<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment">#添加到list中</span>
            resl<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>title<span class="token punctuation">,</span>full_url<span class="token punctuation">,</span>authors<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span><span class="token string">'done'</span><span class="token punctuation">)</span>

        <span class="token comment">#打开文件，进行保存</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'paper.csv'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f <span class="token punctuation">:</span>
            <span class="token comment">#打开上面获取到的文件内容</span>
            cw <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token comment">#写数据到csv中</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> resl<span class="token punctuation">:</span>
                <span class="token comment">#写一行</span>
                cw<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>i<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    run_main<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
    <p>
     这里不过多的对内容进行解析，不太明白的，可以看注释，
     <br/>
     个人觉得，嗯~，
     <strong>
      虽然不是句句有注释，但是也没达到句句没有注释！
     </strong>
     <br/>
     在不明白的，看小鱼这篇文章
     <a href="https://blog.csdn.net/wuyoudeyuer/article/details/108198224">
      <strong>
       《Python3，多线程爬完B站UP主的视频弹幕及评论》
      </strong>
     </a>
     这里面，能解释的，可都解释了！
     <br/>
     瞅瞅，这就是运用到的
     <strong>
      代理
     </strong>
    </p>
    <pre><code class="prism language-python">        <span class="token comment">#设定代理,如果未购买，则不需要填写</span>
        proxies  <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:1092"</span>
            <span class="token string">'https'</span><span class="token punctuation">:</span><span class="token string">"http://127.0.0.1:1092"</span>
         <span class="token punctuation">}</span>
        <span class="token comment">#引用http代理池，避免资源被耗尽，传入三个参数</span>
         r <span class="token operator">=</span> get_http_session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>
</code></pre>
    <p>
     代理是要
     <strong>
      花银子
     </strong>
     的，如果不是靠吃爬虫这碗饭的，或者不是发烧友，弄个免费的代理就行，虽然不稳定，但是，也行~
     <br/>
     <strong>
      运行结果
     </strong>
     ：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/90713ed3c950aa9885c351d6e5e00a15.png#pic_center">
      <br/>
      我为啥要把展示结果，
      <br/>
      是因为要品一品，这爬取的结果，
      <strong>
       香不香
      </strong>
      。
     </img>
    </p>
    <h2>
     <a id="2__168">
     </a>
     2. 创建数据库
    </h2>
    <h3>
     <a id="21__169">
     </a>
     2.1 创建数据库表
    </h3>
    <p>
     一个是把创建的数据表，在pycharm的工程中写入
     <br/>
     如下：
     <br/>
     create.sql
    </p>
    <pre><code class="prism language-python"><span class="token operator">-</span><span class="token operator">-</span>数据表

CREATE TABLE <span class="token string">'papers'</span><span class="token punctuation">(</span>
    <span class="token string">'id'</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT<span class="token punctuation">,</span>
    <span class="token string">'title'</span> varchar<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">''</span>COMMIT <span class="token string">'论文标题'</span><span class="token punctuation">,</span>
    <span class="token string">'url'</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">''</span>COMMIT <span class="token string">'论文url'</span><span class="token punctuation">,</span>
    <span class="token string">'authors'</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token string">''</span>COMMIT <span class="token string">'论文作者'</span><span class="token punctuation">,</span>
    <span class="token string">'create_time'</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token number">0</span> COMMIT <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
    <span class="token string">'update_time'</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token number">0</span> COMMIT <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
    <span class="token string">'is_delete'</span> tinyint<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> NOT NULL DEFAULT <span class="token number">0</span> COMMIT <span class="token string">'是否删除'</span><span class="token punctuation">,</span>
    PRIMARY KEY <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    KEY <span class="token string">'title_IDX'</span> <span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span> USING BTREE<span class="token punctuation">,</span>
    KEY <span class="token string">'authors_IDX'</span> <span class="token punctuation">(</span><span class="token string">'authors'</span><span class="token punctuation">)</span> USING BTREE
<span class="token punctuation">)</span>ENGINE<span class="token operator">=</span>InnoDB AUTO_INCREMENT <span class="token operator">=</span><span class="token number">1</span> DEFAULT CHARSET<span class="token operator">=</span>utf8 COMMIT<span class="token operator">=</span><span class="token string">'论文表'</span>
</code></pre>
    <p>
     这里展示的是MySQL的基本创建表的内容，不会的，可以看小鱼这篇
     <a href="https://blog.csdn.net/wuyoudeyuer/article/details/102837061">
      <strong>
       《SQL基本用法一》
      </strong>
     </a>
     <br/>
     再看不懂的，就看看自己的银行卡余额，自己的左手及右手~
     <br/>
     估计就会了！
     <br/>
     写完之后，别忘了在数据库执行一下，不然怎么能生成表呢~
    </p>
    <h3>
     <a id="22__195">
     </a>
     2.2 连接数据库
    </h3>
    <p>
     我们创建了数据库，就要通过pymysql把数据库连接起来，这样才能用起来~
     <br/>
     继续上代码
     <br/>
     mysql.py
    </p>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-8-26
"""</span>

<span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> logging

<span class="token triple-quoted-string string">'''
创建mysql数据库链接
'''</span>

<span class="token keyword">class</span> <span class="token class-name">MySQL</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#创建数据库的基本链接信息</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>port <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>password <span class="token operator">=</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>db<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#cursorclass = pymysql.cursors.DictCursor 数据库查询返回dict --&gt; 默认返回值是 tuple</span>
        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
            host <span class="token operator">=</span> host<span class="token punctuation">,</span>
            port <span class="token operator">=</span> port<span class="token punctuation">,</span>
            user<span class="token operator">=</span>user<span class="token punctuation">,</span>
            password<span class="token operator">=</span>password<span class="token punctuation">,</span>
            db<span class="token operator">=</span>db<span class="token punctuation">,</span>
            charset <span class="token operator">=</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
            cursorclass <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>cursors<span class="token punctuation">.</span>DictCursor
        <span class="token punctuation">)</span>
        <span class="token comment">#定义logger</span>
        self<span class="token punctuation">.</span>log <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>kwargs <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建mysql数据库链接</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment">#获取游标</span>
            cursor <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">#通过游标获取执行方法</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span>kwargs<span class="token punctuation">)</span>
            <span class="token comment">#提交插入，删除等操作</span>
            self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> cursor

        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token comment">#记录错误信息</span>
            self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>error<span class="token punctuation">(</span>f<span class="token string">'mysql execute eror:{e}'</span><span class="token punctuation">,</span>exc_info<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e

    <span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>kwargs <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#创建查询方法</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            cursor <span class="token operator">=</span> self<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span>kwargs<span class="token punctuation">)</span>

            <span class="token keyword">if</span> cursor<span class="token punctuation">:</span>
                <span class="token comment"># 返回查询到的所有内容</span>
                <span class="token keyword">return</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span>f<span class="token string">'sql error:{sql}'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>error<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            <span class="token comment">#关闭游标</span>
            cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>kwargs <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#数据插入</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            cursor  <span class="token operator">=</span> self<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">if</span> cursor<span class="token punctuation">:</span>
                <span class="token comment">#获取最后行的id</span>
                row_id <span class="token operator">=</span> cursor<span class="token punctuation">.</span>lastrowid
                <span class="token keyword">return</span> row_id
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span>f<span class="token string">'sql error:{e}'</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>error<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token keyword">raise</span> e
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">escape_string</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#对数据文件的内容进行转码，防止有一些特殊字符等</span>
        <span class="token keyword">return</span> pymysql<span class="token punctuation">.</span>escape_string<span class="token punctuation">(</span>_<span class="token punctuation">)</span>

db <span class="token operator">=</span> MySQL<span class="token punctuation">(</span>user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>db<span class="token operator">=</span><span class="token string">'papers'</span><span class="token punctuation">)</span>


</code></pre>
    <p>
     这里用到的是
     <strong>
      pymysql
     </strong>
     这个库，不会使用的，看小鱼这篇文章
     <a href="https://blog.csdn.net/wuyoudeyuer/article/details/106495430">
      <strong>
       《Python3链接Mysql数据库》
      </strong>
     </a>
    </p>
    <h2>
     <a id="3__291">
     </a>
     3. 数据存储
    </h2>
    <p>
     我们把爬取的数据，存储到数据库中。
     <br/>
     同样，直接上代码
    </p>
    <p>
     csv_to_mysql.py
    </p>
    <pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
@ auth : carl_DJ
@ time : 2020-8-26
"""</span>

<span class="token keyword">import</span> csv
<span class="token keyword">import</span> time
<span class="token keyword">from</span> PaperWeb<span class="token punctuation">.</span>libs<span class="token punctuation">.</span>mysql <span class="token keyword">import</span> db

<span class="token keyword">def</span> <span class="token function">get_csv_info</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">'paper.csv'</span><span class="token punctuation">)</span>
    <span class="token comment">#打开csv文件</span>
    csvfile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>csvfile<span class="token punctuation">)</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">yield</span> item

<span class="token keyword">def</span> <span class="token function">get_insert_sql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#把数据插入到数据库</span>
    items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">#获取时间</span>
    _time <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> get_csv_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#对csv文件中的字符进行转码</span>
        item <span class="token operator">=</span> <span class="token punctuation">[</span>db<span class="token punctuation">.</span>escape_string<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> item<span class="token punctuation">]</span>
        <span class="token comment">#添加到对应的list中，创建数据库时列表字段</span>
        items<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token string">"('{item[0]}'，{item[1]}，{item[2]}，{_time}，{_time})"</span><span class="token punctuation">)</span>
    <span class="token comment">#获取values值</span>
    values <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>items<span class="token punctuation">)</span>

    <span class="token comment">#执行sql 语句的插入</span>
    sql <span class="token operator">=</span> f<span class="token triple-quoted-string string">'''
        INSERT INTO 
         Paper ('title','url','authors','create_time','updata_time')
        Values
         {values}
    '''</span>
    row_id <span class="token operator">=</span> db<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{row_id}条数据插入完成'</span><span class="token punctuation">)</span>


</code></pre>
    <p>
     执行完之后，则就可以去数据库，看结果！
     <br/>
     要是不完美，小鱼觉得那是不可能的~
     <br/>
     要是完美，也不枉费小鱼肝到十二点的成果！
    </p>
    <blockquote>
     <p>
      <strong>
       录完课 ，做总结，
       <br/>
       喝点咖啡，溜溜娃，
       <br/>
       娃睡了，我也开始肝代码。
      </strong>
     </p>
    </blockquote>
    <h2>
     <a id="4__348">
     </a>
     4. 彩蛋
    </h2>
    <p>
     这个网站搭建完成，小鱼接下来的目标有两个：
     <br/>
     1.会写一些
     <strong>
      python数据分析的博文；
     </strong>
     <br/>
     2.小鱼分享 自己
     <a href="https://blog.csdn.net/wuyoudeyuer/article/details/109099046">
      <strong>
       四面阿里，终拿offer的经历及面试题
      </strong>
     </a>
     。
    </p>
    <p>
     哈哈，这提前剧透了~
    </p>
    <p>
     <strong>
      为啥又要写 阿里面试的经历
     </strong>
     <br/>
     因为，最近有小伙伴要准备阿里的面试，问了我一些关于阿里面试的问题，与其逐一的说，不如整理出来，share更多人！
    </p>
    <p>
     这样小鱼我也省下更多的时间，做更多事情！！
    </p>
    <p>
     好了，最后借用王二的一句话，结束今天的技术分享：
    </p>
    <blockquote>
     <p>
      <strong>
       如果不是生活所迫，谁愿意才华一身！
      </strong>
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f7775796f756465797565722f:61727469636c652f64657461696c732f313038323332353038" class_="artid" style="display:none">
 </p>
</div>


