---
layout: post
title: "部署vuedjango项目初版"
date: 2025-03-10 18:12:53 +0800
description: "nginx部署前端端记录"
keywords: "部署vue+django项目（初版）"
categories: ['测试平台']
tags: ['前端', 'Vue', 'Django']
artid: "146113892"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146113892
    alt: "部署vuedjango项目初版"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146113892
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146113892
cover: https://bing.ee123.net/img/rand?artid=146113892
image: https://bing.ee123.net/img/rand?artid=146113892
img: https://bing.ee123.net/img/rand?artid=146113892
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     部署vue+django项目（初版）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1_0">
     </a>
     1.准备
    </h2>
    <p>
     vscode 插件Remote SSH，连接远程，打开远程中home文件夹。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/958ec0a2ac0a4c54825448380dd478ca.png">
      <br/>
      镜像和容器的一些常用命令
     </img>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> images
<span class="token function">docker</span> <span class="token function">ps</span>   查看所有正在运行的容器
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
<span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> tk-django-app  删除镜像
<span class="token function">docker</span> <span class="token function">rm</span>  xxx  删除容器
<span class="token function">docker</span> start xxxx    启动容器
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span>   xxxx /bin/sh
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span>   xxxx <span class="token function">sh</span>
看容器日志  <span class="token function">docker</span> logs xxx
应用内：检查8000端口是否成功 （容器中访问， 宿主机中访问）
 <span class="token function">curl</span> http://localhost:8000   
宿主机防火墙检查  检查8000是否开开放
<span class="token function">sudo</span> iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">':8000'</span>
<span class="token comment"># 查看映射文件</span>
<span class="token function">docker</span> inspect tk-django <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">10</span> <span class="token string">"Mounts"</span>
</code></pre>
    <p>
     我在home下建了一个 部署目录叫 taoke作为部署目录。
    </p>
    <pre><code>/home/taoke/
├── back/                      
│   ├── Dockerfile                 # Django 的 Dockerfile
│   │── base.py						# 为了支持mysql5.8以下的要更换下源码
│   │── allure-commandline-2.20.1.tgz    # 生成allure报告需要这个java插件
│   │── openjdk-8u40-b25-linux-x64-10_feb_2015.tar.gz
│   └── tkplat/                    # Django 项目根目录（代码）
│       ├── manage.py            
│       ├── tkplat/                
│       │   ├── settings.py        
│       │   └── wsgi.py            # WSGI 入口文件
│       ├── apps/                  # 自定义应用目录
│       │   └── ...                # 你的 Django 应用
│       └── requirements.txt        # Python 依赖文件
├── front/                         #  前端
│   └── dist/                      # 前端构建后的静态资源
│       ├── index.html             
└── nginx-docker/               
    ├── conf/                      # Nginx 配置
    │   ├── nginx.conf             # 主配置文件
    │   └── default.conf       
    ├── html/                      # 默认 HTML 页面（可选）
    │   └── 50x.html
    ├── logs/                      # Nginx 日志目录
    │   ├── access.log
    │   └── error.log
    └── static/                    # 静态资源目录（用来指向django的静态文件）
</code></pre>
    <h2>
     <a id="2__django_53">
     </a>
     2. 准备好公共网络 、拿到django的静态文件
    </h2>
    <h3>
     <a id="_54">
     </a>
     公共网络
    </h3>
    <p>
     创建nginx容器，和djang应用容器时都公用这个网络。
     <br/>
     目的是：nginx 要使用8000 端口。 因为有需求是，访问后端的static的静态文件和接口 的端口要一样。（以上方式就能满足）
    </p>
    <ul>
     <li>
      使用
      <code>
       :8000/
      </code>
      去对应django容器内的8000端口。 (建django容器的时候不用 -p 8000：8000 宿主机的8000端口留给nginx)
     </li>
     <li>
      使用
      <code>
       :8000/static
      </code>
      对应django内的静态文件
     </li>
    </ul>
    <pre><code class="prism language-bash"><span class="token function">docker</span> network create tk_django_ng
</code></pre>
    <h3>
     <a id="django_63">
     </a>
     创建django镜像
    </h3>
    <p>
     到back目录下，里面放tkplat后端的djang代码和其他创建镜像需要的，如allure插件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cadbec3da1904befa5bfba8a2752093f.png">
      <br/>
      Dockerfile 的内容如下
     </img>
    </p>
    <pre><code class="prism language-json"><span class="token constant">FROM</span> <span class="token literal-property property">python</span><span class="token operator">:</span><span class="token number">3.9</span><span class="token number">.7</span>

# 解压jdk和allure
<span class="token constant">ADD</span> allure<span class="token operator">-</span>commandline<span class="token operator">-</span><span class="token number">2.20</span><span class="token number">.1</span><span class="token punctuation">.</span>tgz <span class="token operator">/</span>opt
<span class="token constant">ADD</span> openjdk<span class="token operator">-</span>8u40<span class="token operator">-</span>b25<span class="token operator">-</span>linux<span class="token operator">-</span>x64<span class="token operator">-</span>10_feb_2015<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">/</span>opt

# 设置工作目录
 <span class="token constant">WORKDIR</span> <span class="token operator">/</span>app

# <span class="token function">复制</span><span class="token punctuation">(</span>项目内的<span class="token punctuation">)</span>依赖文件并安装
<span class="token constant">COPY</span> tkplat<span class="token operator">/</span>requirements<span class="token punctuation">.</span>txt <span class="token punctuation">.</span>
<span class="token constant">RUN</span> pip install mysqlclient<span class="token operator">==</span><span class="token number">2.2</span><span class="token number">.4</span> <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple
<span class="token constant">RUN</span> pip install <span class="token operator">--</span>no<span class="token operator">-</span>cache<span class="token operator">-</span>dir <span class="token operator">-</span>r requirements<span class="token punctuation">.</span>txt <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple

# 解决django不能使用<span class="token number">5.8</span>以下mysql的问题
<span class="token constant">COPY</span> base<span class="token punctuation">.</span>py  <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>python3<span class="token punctuation">.</span><span class="token number">9</span><span class="token operator">/</span>site<span class="token operator">-</span>packages<span class="token operator">/</span>django<span class="token operator">/</span>db<span class="token operator">/</span>backends<span class="token operator">/</span>base

# <span class="token function">复制项目代码</span><span class="token punctuation">(</span>这种事 <span class="token operator">/</span>app目录下还有 一个 tkplat<span class="token punctuation">)</span>
# <span class="token constant">COPY</span> tkplat <span class="token operator">/</span>app<span class="token operator">/</span>tkplat
<span class="token constant">COPY</span> tkplat<span class="token operator">/</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">app</span><span class="token regex-delimiter">/</span></span> 


# env 用于设置环境变量的
<span class="token constant">RUN</span> mv <span class="token operator">/</span>opt<span class="token operator">/</span>java<span class="token operator">-</span>se<span class="token operator">-</span>8u40<span class="token operator">-</span>ri  <span class="token operator">/</span>opt<span class="token operator">/</span>java
<span class="token constant">ENV</span>  <span class="token constant">JAVA_HOME</span>  <span class="token operator">/</span>opt<span class="token operator">/</span>java
<span class="token constant">ENV</span> <span class="token constant">PATH</span> $<span class="token constant">PATH</span><span class="token operator">:</span>$<span class="token constant">JAVA_HOME</span><span class="token operator">/</span>bin<span class="token operator">:</span><span class="token operator">/</span>opt<span class="token operator">/</span>allure<span class="token operator">-</span><span class="token number">2.20</span><span class="token number">.1</span><span class="token operator">/</span>bin


# 暴露端口
<span class="token constant">EXPOSE</span> <span class="token number">8000</span>

# # 启动命令  
# 设置 <span class="token constant">PYTHONPATH</span> <span class="token function">如果Dockerfile在django项目里面</span><span class="token punctuation">(</span>或者上面的copy项目方式变成以上的写法<span class="token punctuation">)</span>，就不需要<span class="token constant">ENV</span>
#<span class="token constant">ENV</span> <span class="token constant">PYTHONPATH</span><span class="token operator">=</span><span class="token operator">/</span>app<span class="token operator">/</span>tkplat
<span class="token constant">CMD</span> <span class="token punctuation">[</span><span class="token string">"gunicorn"</span><span class="token punctuation">,</span> <span class="token string">"--bind"</span><span class="token punctuation">,</span> <span class="token string">"0.0.0.0:8000"</span><span class="token punctuation">,</span> <span class="token string">"tkplat.wsgi:application"</span><span class="token punctuation">]</span>  

</code></pre>
    <p>
     然后到back目录中，运行下面， 就创建好了镜像了
     <br/>
     <code>
      创建镜像
     </code>
     <br/>
     <code>
      docker build -t tk-django-app .
     </code>
    </p>
    <h3>
     <a id="djangocp_108">
     </a>
     临时django容器、把静态文件cp出来
    </h3>
    <p>
     先创建一个临时的django容器，用共用网络或者8000:8000或者其他
    </p>
    <p>
     <code>
      docker run -d -p 8000:8000 --name tmp-django tk-django-app
     </code>
     <br/>
     <code>
      docker run -d --network tk_django_ng --name tmp-django tk-django-app
     </code>
    </p>
    <p>
     <strong>
      检查django应用容器
     </strong>
    </p>
    <ul>
     <li>
      使用 docker logs 容器名, 如下图表示
      <code>
       运行了
      </code>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/82c6a937993a448cbe0d9e6ab995dd42.png"/>
     </li>
     <li>
      进入容器内，curl一下检查，django应用是否正常
      <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> tmp-django <span class="token function">sh</span> 
apk <span class="token function">add</span> --no-cache <span class="token function">curl</span>   <span class="token comment"># 安装一下</span>
 <span class="token function">curl</span> http://localhost:8000
 <span class="token function">curl</span>  http://127.0.0.1:8000/api/sys/students/   <span class="token comment"># 验证接口</span>
 <span class="token builtin class-name">exit</span>
</code></pre>
     </li>
     <li>
      查看allure命令，也是要进入到容器内
      <pre><code class="prism language-bash">allure <span class="token parameter variable">--version</span>
</code></pre>
     </li>
    </ul>
    <p>
     <strong>
      把容器内的文件复制出来
     </strong>
     和 放到宿主机目录下（后面django容器和ng容器都要映射这个目录）。
     <br/>
     到taoke 目录下，
    </p>
    <pre><code class="prism language-bash"><span class="token function">mkdir</span> nginx-docker
</code></pre>
    <p>
     再到 nginx-docker 目录下 把静态文件复制出来
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">cp</span> tmp-django:/app/static ./
</code></pre>
    <p>
     这样后， nginx-docker/static 里面就有静态文件。
     <br/>
     再删除临时的django容器
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> stop tmp-django 
<span class="token function">docker</span> <span class="token function">rm</span> tmp-django 
</code></pre>
    <h2>
     <a id="3_Nginxnginx_144">
     </a>
     3. 准备Nginx本地目录其他结构（假设已经有了nginx镜像）
    </h2>
    <p>
     /home/taoke/nginx-docker 下
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 创建本地工作目录（当前目录下建一个nginx-dokcer ,然后下面又有4个目录）</span>
<span class="token comment"># mkdir -p ./nginx-docker/{html,conf,logs}</span>

/home/taoke/nginx-docker 下
<span class="token function">mkdir</span> ./<span class="token punctuation">{<!-- --></span>html,conf,logs<span class="token punctuation">}</span>

<span class="token comment"># 运行临时容器（用于复制默认配置）</span>
<span class="token function">docker</span> run <span class="token parameter variable">--name</span> nginx-temp <span class="token parameter variable">-d</span> nginx   <span class="token comment"># 默认为80，如果没有80指定一个</span>
<span class="token function">docker</span> <span class="token function">cp</span> nginx-temp:/etc/nginx/nginx.conf ./nginx.conf  <span class="token comment"># 容器内一般是这个路径</span>
<span class="token function">docker</span> <span class="token function">cp</span> nginx-temp:/etc/nginx/conf.d/default.conf ./default.conf 
<span class="token comment"># 停止并删除临时容器</span>
<span class="token function">docker</span> stop nginx-temp 
<span class="token function">docker</span> <span class="token function">rm</span> nginx-temp 

<span class="token comment"># 把复制出来的配置文件移动到对应位置</span>
<span class="token function">mv</span> nginx.conf ./nginx-docker/conf/
<span class="token function">mv</span> default.conf ./nginx-docker2/conf/

<span class="token comment"># 准备一个测试用的静态文件</span>
<span class="token builtin class-name">echo</span> <span class="token string">"hello 静态文件"</span> <span class="token operator">&gt;</span> ./nginx-docker2/static/test.txt
</code></pre>
    <h2>
     <a id="4_vue_168">
     </a>
     4. 准备vue前端静态文件
    </h2>
    <h3>
     <a id="_169">
     </a>
     准备好前端打包文件
    </h3>
    <p>
     taoke 下建一个 文件叫 front（叫
     <code>
      front好点
     </code>
     ，表示前端，） , 里面放 npm run build 打包好的dist文件（注，需提前把后端请求地址设置好哟）
    </p>
    <h3>
     <a id="8011_171">
     </a>
     准备好要用的端口，如8011
    </h3>
    <pre><code class="prism language-bash">docker要添加一次 <span class="token number">8011</span>， 
并重启sudo systemctl stop <span class="token function">docker</span>
<span class="token function">sudo</span> iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-F</span>
<span class="token function">sudo</span> iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-F</span>
<span class="token function">sudo</span> iptables <span class="token parameter variable">-F</span>
<span class="token function">sudo</span> iptables <span class="token parameter variable">-X</span>

<span class="token comment"># 重启 Docker</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span>

<span class="token comment"># 对于 firewalld</span>
<span class="token function">sudo</span> firewall-cmd <span class="token parameter variable">--permanent</span> <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8011</span>/tcp
<span class="token function">sudo</span> firewall-cmd <span class="token parameter variable">--reload</span>
<span class="token function">sudo</span> firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --list-ports
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre>
    <pre><code class="prism language-bash">
步骤1：检查宿主机端口8011是否被占用，使用sudo <span class="token function">lsof</span> <span class="token parameter variable">-i</span> :8011或
<span class="token function">sudo</span> <span class="token function">netstat</span> <span class="token parameter variable">-tulnp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">8011</span>
</code></pre>
    <h3>
     <a id="Nginx_195">
     </a>
     正式启动Nginx容器（映射配置、静态文件、公共网络、）
    </h3>
    <p>
     如下、使用了容器
     <code>
      公共网络
     </code>
     和
     <code>
      前端vue映射到了nginx容器内部
     </code>
     和
     <code>
      宿主机一个目录映射到了容器内部的static
     </code>
     以及
     <code>
      default.conf
     </code>
     配置
     <br/>
     这样，只需要改宿主机，就能改nginx容器内部的文件了
     <br/>
     到taoke目录下
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span>   <span class="token parameter variable">-p</span> <span class="token number">8011</span>:8011 <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> tk_django_ng  <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ./front/dist:/usr/share/nginx/html  <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ./nginx-docker/static:/static <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ./nginx-docker/conf/default.conf:/etc/nginx/conf.d/default.conf   <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ./nginx-docker/logs:/var/log/nginx <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> tk-nginx  <span class="token punctuation">\</span>
nginx
</code></pre>
    <h3>
     <a id="ng_209">
     </a>
     ng配置
    </h3>
    <p>
     配置宿主机的
     <code>
      nginx-docker/conf/default.conf
     </code>
     文件。
     <br/>
     修改了一下，就要 重启 一下
    </p>
    <pre><code>docker restart tk-nginx
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4dfe2b2d26824d07a5a5ccb7aff75a17.png">
      <br/>
      前端8011的端口配置，配置好，重启，就可以访问页面了（主要端口要开放）
     </img>
    </p>
    <pre><code class="prism language-c">server <span class="token punctuation">{<!-- --></span>
    listen       <span class="token number">8011</span><span class="token punctuation">;</span>
    listen  <span class="token punctuation">[</span><span class="token operator">::</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token number">8011</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">access</span><span class="token expression">_log  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span></span></span>
   
	<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">vue</span> <span class="token expression">前端路由</span></span>
    location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
        root   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
        index  index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>  # 该步表示，所有非真实文件路径的请求都会回退到index<span class="token punctuation">.</span>html
    <span class="token punctuation">}</span>

    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{<!-- --></span>
        root   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
    <p>
     后端静态文件
    </p>
    <pre><code class="prism language-json">server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">8000</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>


        # 反向代理 Django <span class="token constant">API</span>
#    location <span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
#        #proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token operator">:</span><span class="token number">8000</span><span class="token punctuation">;</span>  # 根据你的后端地址调整
#        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>tk<span class="token operator">-</span>django<span class="token operator">:</span><span class="token number">8000</span><span class="token punctuation">;</span>  # 共用网络的django容器<span class="token operator">:</span><span class="token number">8000</span>
#        proxy_set_header Host $host<span class="token punctuation">;</span>
#        proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Real<span class="token operator">-</span><span class="token constant">IP</span> $remote_addr<span class="token punctuation">;</span>
#        proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
#    <span class="token punctuation">}</span>

    	# django静态文件	
    location <span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
    alias <span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      修改ngix配置后，记得restart 容器
     </code>
     <br/>
     前端静态文件，就可以用 8011访问了
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a8aa9e8174254940b50fb355e16324b8.png"/>
    </p>
    <p>
     宿主机（/home/taoke/nginx-docker3/static）的静态文件，可以被访问了、
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b3dcce39dbcc4b0c8e53b1ed21baeb7c.png"/>
    </p>
    <p>
     根据配置 text.txt在容器内部的static内部，就能通过8000/static访问到
    </p>
    <pre><code>curl http://localhost:8000/static/test.txt
</code></pre>
    <p>
     也可以用通过浏览器访问静态文件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d127775c0af54ebe96037d8dd216ca68.png"/>
    </p>
    <h2>
     <a id="5_django_277">
     </a>
     5. 创建django正式容器
    </h2>
    <p>
     在taoke目录下运行， 不用映射 端口号， 它和ng共用一个端口号
     <br/>
     docker run -d --network tk_django_ng -v ./nginx-docker/static:/app/static --name tk-django tk-django-app
    </p>
    <h2>
     <a id="6_nginx_282">
     </a>
     6. 再配置哈nginx，即可访问前后端
    </h2>
    <p>
     default.conf 修改后重启一下，
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c9dc16ad91ae4b1daa82e9602f49a985.png"/>
    </p>
    <pre><code class="prism language-bash"> <span class="token function">docker</span> restart tk-nginx 
</code></pre>
    <p>
     完整default的配置
    </p>
    <pre><code class="prism language-json">server <span class="token punctuation">{<!-- --></span>
    listen       <span class="token number">8011</span><span class="token punctuation">;</span>
    listen  <span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token number">8011</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    #access_log  <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>host<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log  main<span class="token punctuation">;</span>
   
	# vue 前端路由
    location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
        root   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
        index  index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>  # 该步表示，所有非真实文件路径的请求都会回退到index<span class="token punctuation">.</span>html
    <span class="token punctuation">}</span>

    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span>50x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> <span class="token operator">/</span>50x<span class="token punctuation">.</span>html <span class="token punctuation">{<!-- --></span>
        root   <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">8000</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>


        # 反向代理 Django <span class="token constant">API</span>
   location <span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
       #proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>backend<span class="token operator">:</span><span class="token number">8000</span><span class="token punctuation">;</span>  # 根据你的后端地址调整
       proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>tk<span class="token operator">-</span>django<span class="token operator">:</span><span class="token number">8000</span><span class="token punctuation">;</span>  # 共用网络的django容器<span class="token operator">:</span><span class="token number">8000</span>
       proxy_set_header Host $host<span class="token punctuation">;</span>
       proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Real<span class="token operator">-</span><span class="token constant">IP</span> $remote_addr<span class="token punctuation">;</span>
       proxy_set_header <span class="token constant">X</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span>For $proxy_add_x_forwarded_for<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

    	# django静态文件	
    location <span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
    alias <span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ab77655c0d344ba99ca2face4a0a71de.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f4174616f6b65722f:61727469636c652f64657461696c732f313436313133383932" class_="artid" style="display:none">
 </p>
</div>


