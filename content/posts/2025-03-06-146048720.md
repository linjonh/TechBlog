---
layout: post
title: "物联网IoT系列之MQTT协议基础知识"
date: 2025-03-06 12:54:40 +0800
description: "MQTT（Message Queuing Telemetry Transport）是一种轻量级的、基于发布订阅模式的网络传输协议，适用于资源受限的设备和低带宽、高延迟或不稳定的网络环境，在物联网环境应用广泛，能够实现传感器、执行器和其它设备之间的高效通信。"
keywords: "iot与mqtt"
categories: ['物联网Iot']
tags: ['物联网', 'Mqtt', 'Iot']
artid: "146048720"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146048720
    alt: "物联网IoT系列之MQTT协议基础知识"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146048720
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146048720
cover: https://bing.ee123.net/img/rand?artid=146048720
image: https://bing.ee123.net/img/rand?artid=146048720
img: https://bing.ee123.net/img/rand?artid=146048720
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     物联网IoT系列之MQTT协议基础知识
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="IoTMQTT_3">
     </a>
     物联网IoT系列之MQTT协议基础知识
    </h3>
    <h4>
     <a id="IoT_5">
     </a>
     物联网IoT是什么？
    </h4>
    <p>
     物联网（Internet of Things，简称IoT）是一个由互联网、传统电信网、传感器网络等组成的庞大网络，它通过嵌入式传感器、设备和软件，将物理世界中的物体连接起来，实现物与物、物与人、物与网络之间的智能化交互。简单来说，物联网就是让“万物互联”，让设备能够自主地感知、传输和处理数据，从而为人类生活和工业生产带来更高的效率和便利。
    </p>
    <h4>
     <a id="MQTT_8">
     </a>
     什么是MQTT？
    </h4>
    <p>
     MQTT（Message Quelemetry Transport）是一种轻量级的、基于发布订阅模式的网络传输协议，适用于资源受限的设备和低带宽、高延迟或不稳定的网络环境。它在物联网环境中应用广泛，能够实现传感器、执行器和其他设备之间的高效通信。
    </p>
    <h4>
     <a id="MQTT_11">
     </a>
     为什么说MQTT是适用于物联网的协议？
    </h4>
    <ul>
     <li>
      <strong>
       轻量级设计
      </strong>
      ：MQTT协议头部最小仅2字节，网络传输开销极小，适合在窄带网络（如NB-IoT）中使用。
     </li>
     <li>
      <strong>
       低功耗
      </strong>
      ：使用异步传输机制和较小的数据包传输，使得设备在通信过程中的能耗更低。
     </li>
     <li>
      <strong>
       高可靠性
      </strong>
      ：提供3种QoS级别（0/1/2），确保消息必达。
     </li>
     <li>
      <strong>
       灵活扩展
      </strong>
      ：通过主题（Topic）和通配符机制，设备可以灵活订阅和发布消息，支持大规模设备接入。
     </li>
     <li>
      <strong>
       适应不稳定网络
      </strong>
      ：心跳机制和会话恢复功能，确保设备在断网后能够快速恢复连接并获取未读消息。
     </li>
    </ul>
    <h4>
     <a id="MQTT_18">
     </a>
     MQTT工作原理
    </h4>
    <h5>
     <a id="_20">
     </a>
     核心组件
    </h5>
    <ul>
     <li>
      <strong>
       发布者（Publisher）
      </strong>
      ：将消息发布到指定的主题（Topic），例如温度传感器、智能开关等。
     </li>
     <li>
      <strong>
       消息代理（Broker）
      </strong>
      ：作为中间节点，负责接收发布者的消息并转发给订阅者，例如EMQX、Mosquitto、AWS IoT等。
     </li>
     <li>
      <strong>
       订阅者（Subscriber）
      </strong>
      ：订阅特定Topic的消息，例如手机App、云端控制台等。
     </li>
    </ul>
    <h5>
     <a id="_25">
     </a>
     核心机制
    </h5>
    <ul>
     <li>
      <strong>
       Topic通配符
      </strong>
      <ul>
       <li>
        示例：
        <code>
         home/floor1/#
        </code>
        ，订阅
        <code>
         floor1
        </code>
        下所有子主题的消息。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       QoS机制
      </strong>
      <ul>
       <li>
        QoS是MQTT中用于控制信息传输质量的机制，MQTT定义了三种不同的QoS等级：QoS 0、QoS 1和QoS 2。
       </li>
      </ul>
     </li>
    </ul>
    <table>
     <thead>
      <tr>
       <th>
        QoS等级
       </th>
       <th>
        传输过程
       </th>
       <th>
        适用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        0
       </td>
       <td>
        最多发送一次（无需确认）
       </td>
       <td>
        实时性高但允许丢失数据的场景
       </td>
      </tr>
      <tr>
       <td>
        1
       </td>
       <td>
        至少一次（Broker确认）
       </td>
       <td>
        设备控制指令
       </td>
      </tr>
      <tr>
       <td>
        2
       </td>
       <td>
        精确一次（四次握手确保唯一性）
       </td>
       <td>
        支付、安全告警
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="MQTT_37">
     </a>
     MQTT工作流程
    </h4>
    <h5>
     <a id="1__39">
     </a>
     1. 建立连接
    </h5>
    <p>
     客户端向Broker发送
     <code>
      CONNECT
     </code>
     报文，包含客户端ID、用户名和密码等认证信息。Broker验证后返回
     <code>
      CONNACK
     </code>
     报文，表示连接成功。
    </p>
    <h5>
     <a id="2__42">
     </a>
     2. 发布和订阅
    </h5>
    <ul>
     <li>
      <strong>
       发布
      </strong>
      ：发布者将消息通过
      <code>
       PUBLISH
      </code>
      报文发送到Broker指定的主题（Topic），Broker根据订阅关系将消息发送给指定的订阅者。
     </li>
     <li>
      <strong>
       订阅
      </strong>
      ：订阅者发送
      <code>
       SUBSCRIBE
      </code>
      报文，指定要订阅的主题（Topic）和QoS级别。
     </li>
    </ul>
    <h5>
     <a id="3__46">
     </a>
     3. 消息确认
    </h5>
    <p>
     根据QoS级别，消息可能需要确认：
    </p>
    <ul>
     <li>
      QoS 0：消息“最多发送一次”，无需确认。
     </li>
     <li>
      QoS 1：消息“至少发送一次”，需要确认。
     </li>
     <li>
      QoS 2：消息“仅发送一次”，需要复杂的确认流程。
     </li>
    </ul>
    <h5>
     <a id="4__52">
     </a>
     4. 断开连接
    </h5>
    <p>
     客户端发送
     <code>
      DISCONNECT
     </code>
     报文，通知Broker主动断开连接。
    </p>
    <h4>
     <a id="MQTT_55">
     </a>
     MQTT工作流程图
    </h4>
    <p>
     以下是文字描述的流程图结构：
    </p>
    <pre><code>客户端
  |
  v
[建立连接] -&gt; [发送CONNECT报文] -&gt; [接收CONNACK报文]
  |
  v
[发布消息] -&gt; [发送PUBLISH报文] -&gt; [Broker转发消息]
  |
  v
[订阅消息] -&gt; [发送SUBSCRIBE报文] -&gt; [接收消息]
  |
  v
[消息确认] -&gt; [根据QoS级别确认消息]
  |
  v
[断开连接] -&gt; [发送DISCONNECT报文]
</code></pre>
    <p>
     MQTT工作流程图：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/bef35b4d382044089f7acc7a035cc900.png"/>
    </p>
    <h4>
     <a id="MQTT_79">
     </a>
     MQTT在物联网中的应用
    </h4>
    <p>
     MQTT广泛应用于设备监控、车联网、智能家居等领域。例如：
    </p>
    <ul>
     <li>
      <strong>
       工业设备监控
      </strong>
      ：通过MQTT实现设备状态的实时传输。
     </li>
     <li>
      <strong>
       智慧城市
      </strong>
      ：用于环境传感器实时传输温度、湿度等数据。
     </li>
     <li>
      <strong>
       智能家居
      </strong>
      ：通过MQTT连接智能设备，实现远程控制和自动化管理。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343432373339312f:61727469636c652f64657461696c732f313436303438373230" class_="artid" style="display:none">
 </p>
</div>


