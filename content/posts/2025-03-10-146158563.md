---
layout: post
title: "vue3elementuiplus的table表格动态高度"
date: 2025-03-10 17:06:57 +0800
description: "table表格流体高度。"
keywords: "vue3+element plus实现表格流体高度"
categories: ['Vue', 'Elementuiplus']
tags: ['前端', 'Vue', 'Javascript']
artid: "146158563"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146158563
    alt: "vue3elementuiplus的table表格动态高度"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146158563
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146158563
cover: https://bing.ee123.net/img/rand?artid=146158563
image: https://bing.ee123.net/img/rand?artid=146158563
img: https://bing.ee123.net/img/rand?artid=146158563
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vue3+elementuiplus的table表格动态高度
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="video">
     <iframe allowfullscreen="true" data-mediaembed="csdn" frameborder="0" id="tmQgyCi6-1741597609651" src="https://live.csdn.net/v/embed/468098" style="width:100%;height:100%;">
     </iframe>
     <p>
      table表格流体高度
     </p>
    </div>
    <h3>
     1、前提
    </h3>
    <p>
     了解自定义指令、hooks
    </p>
    <h3>
     2、核心思路
    </h3>
    <p>
     通过自定义指令（new ResizeObserver）监听表格变化，然后通过hooks去更新表格高度。
    </p>
    <h4>
     3、核心代码
    </h4>
    <blockquote>
     <p>
      src/directives/resize.ts
     </p>
    </blockquote>
    <pre><code class="language-TypeScript">// import { debounce } from '@/utils';

import { type Directive } from "vue";

const resizeDirective: Directive = {
  mounted(el, binding) {
    // update 要高效，否则会导致 ResizeObserver loop completed with undelivered notifications.
    // 这里通过 setTimeout 延迟实际更新到下个 tick
    let update = (entry: ResizeObserverEntry) =&gt; {
      setTimeout(() =&gt; {
        binding.value(entry);
      }, 0);
    };
    if (binding.arg) {
      try {
        let delay = Number.parseInt(binding.arg);
        console.log(delay);
        // update = debounce(binding.value, delay);
      } catch (error) {
        console.log(error);
      }
    }
    // 创建 ResizeObserver 实例
    const resizeObserver = (el.__resizeObserver__ = new ResizeObserver((entries) =&gt; {
      // 当目标元素的大小发生变化时，执行回调函数
      update(entries[0]);
    }));
    // 开始监听目标元素的大小变化
    resizeObserver.observe(el);
  },
  unmounted(el) {
    el.__resizeObserver__.disconnect();
  },
};

export default resizeDirective;
</code></pre>
    <blockquote>
     <p>
      src/hooks/useTableConfig.ts
     </p>
    </blockquote>
    <pre><code class="language-TypeScript">import { type TableInstance } from "element-plus";

/** 获取表格的基本配置 */
export const useTableConfig = &lt;T&gt;(padding: number = 20) =&gt; {
  const tableLoading = ref&lt;boolean&gt;(false);
  const pageData = ref&lt;T[]&gt;([]);
  const total = ref&lt;number&gt;(0);
  const tableRef = ref&lt;TableInstance | null&gt;(null);
  const selectedTableIds = ref&lt;string[]&gt;([]);

  /**表格高度 */
  const tableFluidHeight = ref&lt;number&gt;(0);

  const tableResize = (rect: DOMRectReadOnly) =&gt; {
    tableFluidHeight.value = rect.height - padding * 2;
  };

  return {
    tableLoading,
    pageData,
    total,
    tableRef,
    selectedTableIds,
    tableFluidHeight,
    tableResize,
  };
};
</code></pre>
    <p>
     这里padding：20的原因是
    </p>
    <p>
     <img alt="" height="642" src="https://i-blog.csdnimg.cn/direct/36d8d9f0c1df4a86a45fa364b20e6dc1.png" width="1715"/>
    </p>
    <blockquote>
     <p>
      src/components/BaseTableSearchContainer/index.vue
     </p>
    </blockquote>
    <pre><code class="language-html">&lt;template&gt;
  &lt;div class="flex flex-col h-full"&gt;
    &lt;slot name="search" /&gt;
    &lt;div ref="centerRef" v-resize="onResize" class="flex-1 overflow-auto"&gt;
      &lt;div :class="centerClass" class="p-20px bg-light-50"&gt;
        &lt;slot name="table" /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div style="background: white"&gt;
      &lt;slot name="pagination" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { useTemplateRef } from "vue";
defineProps({ centerClass: { type: String, default: "" } });
const emit = defineEmits(["sizeChanged"]);

const centerRef = useTemplateRef&lt;HTMLElement&gt;("centerRef");
const onResize = (e: ResizeObserverEntry) =&gt; {
  // console.log("resize", e, centerRef.value, centerRef.value?.getBoundingClientRect().height);
  emit("sizeChanged", e.contentRect);
};
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;&lt;/style&gt;
</code></pre>
    <p>
     使用：
    </p>
    <pre><code class="language-html">&lt;template&gt;
  &lt;div class="app-container"&gt;
    &lt;BaseTableSearchContainer @size-changed="tableResize"&gt;
      &lt;template #search&gt;
        &lt;TBSearchContainer :is-show-toggle="true"&gt;
          &lt;template #left&gt; &lt;/template&gt;
          &lt;template #right&gt; &lt;/template&gt;
        &lt;/TBSearchContainer&gt;
      &lt;/template&gt;
      &lt;template #table&gt;
        &lt;el-table
          ref="tableRef"
          v-loading="tableLoading"
          :data="pageData"
          highlight-current-row
          row-key="Id"
          border
          :height="tableFluidHeight"
          style="text-align: center; flex: 1"
          @select="handleTableSelect"
          @select-all="handleTableSelect"
        &gt;
        &lt;/el-table&gt;
      &lt;/template&gt;
      &lt;template #pagination&gt;
        &lt;Pagination
          v-if="total &gt; 0"
          v-model:total="total"
          v-model:page="queryParams.pageIndex"
          v-model:limit="queryParams.pageSize"
          @pagination="handleGetTableList"
        /&gt;
      &lt;/template&gt;
    &lt;/BaseTableSearchContainer&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
const {
  tableLoading,
  pageData,
  total,
  tableRef,
  tableFluidHeight,
  tableResize,
} = useTableConfig&lt;MoItemPackItem&gt;();
&lt;/script&gt;

&lt;style scoped lang="scss"&gt;&lt;/style&gt;
</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35373935323031382f:61727469636c652f64657461696c732f313436313538353633" class_="artid" style="display:none">
 </p>
</div>


