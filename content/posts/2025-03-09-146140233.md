---
layout: post
title: "å·¥ç¨‹åŒ–ä¸æ¡†æ¶ç³»åˆ—27-å‰ç«¯éŸ³è§†é¢‘å¤„ç†"
date: 2025-03-09 22:32:32 +0800
description: "å·¥ç¨‹åŒ–ä¸æ¡†æ¶ä¹‹æ—…ç¬¬äºŒåä¸ƒç«™"
keywords: "å·¥ç¨‹åŒ–ä¸æ¡†æ¶ç³»åˆ—ï¼ˆ27ï¼‰--å‰ç«¯éŸ³è§†é¢‘å¤„ç†"
categories: ['å‰ç«¯å·¥ç¨‹åŒ–ä¸æ¡†æ¶']
tags: ['éŸ³è§†é¢‘', 'çŠ¶æ€æ¨¡å¼', 'å‰ç«¯']
artid: "146140233"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146140233
    alt: "å·¥ç¨‹åŒ–ä¸æ¡†æ¶ç³»åˆ—27-å‰ç«¯éŸ³è§†é¢‘å¤„ç†"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146140233
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146140233
cover: https://bing.ee123.net/img/rand?artid=146140233
image: https://bing.ee123.net/img/rand?artid=146140233
img: https://bing.ee123.net/img/rand?artid=146140233
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     å·¥ç¨‹åŒ–ä¸æ¡†æ¶ç³»åˆ—ï¼ˆ27ï¼‰--å‰ç«¯éŸ³è§†é¢‘å¤„ç†
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="__0">
     </a>
     å‰ç«¯éŸ³è§†é¢‘å¤„ç† ğŸ¥
    </h2>
    <h3>
     <a id="_2">
     </a>
     å¼•è¨€
    </h3>
    <p>
     å‰ç«¯éŸ³è§†é¢‘å¤„ç†æ˜¯ç°ä»£Webåº”ç”¨ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ¶‰åŠéŸ³é¢‘æ’­æ”¾ã€è§†é¢‘å¤„ç†ã€æµåª’ä½“ä¼ è¾“ç­‰å¤šä¸ªæ–¹é¢ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å‰ç«¯éŸ³è§†é¢‘å¤„ç†çš„å…³é”®æŠ€æœ¯å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºé«˜è´¨é‡çš„å¤šåª’ä½“åº”ç”¨ã€‚
    </p>
    <h3>
     <a id="_6">
     </a>
     éŸ³è§†é¢‘æŠ€æœ¯æ¦‚è¿°
    </h3>
    <p>
     å‰ç«¯éŸ³è§†é¢‘å¤„ç†ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æŠ€æœ¯æ–¹å‘ï¼š
    </p>
    <ul>
     <li>
      <strong>
       éŸ³é¢‘å¤„ç†
      </strong>
      ï¼šéŸ³é¢‘æ’­æ”¾ã€å½•åˆ¶ã€åˆ†æ
     </li>
     <li>
      <strong>
       è§†é¢‘å¤„ç†
      </strong>
      ï¼šè§†é¢‘æ’­æ”¾ã€å½•åˆ¶ã€ç¼–è¾‘
     </li>
     <li>
      <strong>
       æµåª’ä½“
      </strong>
      ï¼šå®æ—¶éŸ³è§†é¢‘ã€ç›´æ’­æ¨æµ
     </li>
     <li>
      <strong>
       WebRTC
      </strong>
      ï¼šç‚¹å¯¹ç‚¹é€šä¿¡
     </li>
     <li>
      <strong>
       åª’ä½“æ ¼å¼
      </strong>
      ï¼šç¼–è§£ç ã€è½¬æ¢
     </li>
    </ul>
    <h3>
     <a id="_16">
     </a>
     éŸ³é¢‘å¤„ç†å®ç°
    </h3>
    <h4>
     <a id="_18">
     </a>
     éŸ³é¢‘æ’­æ”¾å™¨
    </h4>
    <pre><code class="prism language-typescript"><span class="token comment">// éŸ³é¢‘æ’­æ”¾å™¨ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">AudioPlayer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> audio<span class="token operator">:</span> HTMLAudioElement<span class="token punctuation">;</span>
    <span class="token keyword">private</span> audioContext<span class="token operator">:</span> AudioContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> source<span class="token operator">:</span> MediaElementAudioSourceNode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> analyser<span class="token operator">:</span> AnalyserNode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> gainNode<span class="token operator">:</span> GainNode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> equalizer<span class="token operator">:</span> EqualizerNode<span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Audio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºéŸ³é¢‘æº</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>source <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>audioContext<span class="token punctuation">.</span><span class="token function">createMediaElementSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºåˆ†æå™¨</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>audioContext<span class="token punctuation">.</span><span class="token function">createAnalyser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span>fftSize <span class="token operator">=</span> <span class="token number">2048</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºéŸ³é‡æ§åˆ¶</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>gainNode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>audioContext<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºå‡è¡¡å™¨</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>equalizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EqualizerNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>audioContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è¿æ¥éŸ³é¢‘èŠ‚ç‚¹</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>source
            <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>equalizer<span class="token punctuation">.</span>input<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gainNode<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>audioContext<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeEventListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åŠ è½½éŸ³é¢‘</span>
    <span class="token function">loadAudio</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function-variable function">oncanplaythrough</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to load audio'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ’­æ”¾</span>
    <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æš‚åœ</span>
    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·³è½¬åˆ°æŒ‡å®šæ—¶é—´</span>
    <span class="token function">seek</span><span class="token punctuation">(</span>time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®éŸ³é‡</span>
    <span class="token function">setVolume</span><span class="token punctuation">(</span>volume<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>gainNode<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> volume<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®å‡è¡¡å™¨</span>
    <span class="token function">setEqualizerBand</span><span class="token punctuation">(</span>frequency<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> gain<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>equalizer<span class="token punctuation">.</span><span class="token function">setBand</span><span class="token punctuation">(</span>frequency<span class="token punctuation">,</span> gain<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–é¢‘è°±æ•°æ®</span>
    <span class="token function">getSpectrumData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Uint8Array <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> dataArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span>frequencyBinCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span><span class="token function">getByteFrequencyData</span><span class="token punctuation">(</span>dataArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataArray<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–æ³¢å½¢æ•°æ®</span>
    <span class="token function">getWaveformData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Uint8Array <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> dataArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span>frequencyBinCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>analyser<span class="token punctuation">.</span><span class="token function">getByteTimeDomainData</span><span class="token punctuation">(</span>dataArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataArray<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬</span>
    <span class="token keyword">private</span> <span class="token function">initializeEventListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// æ’­æ”¾çŠ¶æ€å˜åŒ–</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'play'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>audioContext<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// éŸ³é¢‘ç»“æŸ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'ended'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å¤„ç†æ’­æ”¾ç»“æŸ</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// éŸ³é¢‘é”™è¯¯</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Audio error:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å‡è¡¡å™¨èŠ‚ç‚¹ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">EqualizerNode</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> context<span class="token operator">:</span> AudioContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> bands<span class="token operator">:</span> BiquadFilterNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> _input<span class="token operator">:</span> GainNode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> _output<span class="token operator">:</span> GainNode<span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span>context<span class="token operator">:</span> AudioContext<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bands <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºè¾“å…¥è¾“å‡ºèŠ‚ç‚¹</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_input <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_output <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createGain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºå‡è¡¡å™¨é¢‘æ®µ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createBands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è¿æ¥é¢‘æ®µ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connectBands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–è¾“å…¥èŠ‚ç‚¹</span>
    <span class="token keyword">get</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AudioNode <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_input<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–è¾“å‡ºèŠ‚ç‚¹</span>
    <span class="token keyword">get</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AudioNode <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_output<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®é¢‘æ®µå¢ç›Š</span>
    <span class="token function">setBand</span><span class="token punctuation">(</span>frequency<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> gain<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> band <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bands<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> 
            Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>frequency<span class="token punctuation">.</span>value <span class="token operator">-</span> frequency<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>band<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            band<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> gain<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åˆ›å»ºå‡è¡¡å™¨é¢‘æ®µ</span>
    <span class="token keyword">private</span> <span class="token function">createBands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> frequencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">310</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">6000</span><span class="token punctuation">,</span> <span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">14000</span><span class="token punctuation">,</span> <span class="token number">16000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        frequencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>freq <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">createBiquadFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            filter<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'peaking'</span><span class="token punctuation">;</span>
            filter<span class="token punctuation">.</span>frequency<span class="token punctuation">.</span>value <span class="token operator">=</span> freq<span class="token punctuation">;</span>
            filter<span class="token punctuation">.</span><span class="token constant">Q</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            filter<span class="token punctuation">.</span>gain<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span>bands<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è¿æ¥é¢‘æ®µ</span>
    <span class="token keyword">private</span> <span class="token function">connectBands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bands<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> curr<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> curr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_input<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>bands<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>bands<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŠ è½½å¹¶æ’­æ”¾éŸ³é¢‘</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">playAudio</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">await</span> player<span class="token punctuation">.</span><span class="token function">loadAudio</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è®¾ç½®éŸ³é‡</span>
        player<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è®¾ç½®å‡è¡¡å™¨</span>
        player<span class="token punctuation">.</span><span class="token function">setEqualizerBand</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¢å¼ºä½é¢‘</span>
        player<span class="token punctuation">.</span><span class="token function">setEqualizerBand</span><span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¢å¼ºé«˜é¢‘</span>
        
        <span class="token comment">// å®æ—¶æ›´æ–°é¢‘è°±æ˜¾ç¤º</span>
        <span class="token keyword">function</span> <span class="token function">updateSpectrum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> spectrumData <span class="token operator">=</span> player<span class="token punctuation">.</span><span class="token function">getSpectrumData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ä½¿ç”¨é¢‘è°±æ•°æ®ç»˜åˆ¶å¯è§†åŒ–æ•ˆæœ</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateSpectrum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token function">updateSpectrum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Failed to play audio:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_227">
     </a>
     éŸ³é¢‘å½•åˆ¶å™¨
    </h4>
    <pre><code class="prism language-typescript"><span class="token comment">// éŸ³é¢‘å½•åˆ¶å™¨ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">AudioRecorder</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> stream<span class="token operator">:</span> MediaStream <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> mediaRecorder<span class="token operator">:</span> MediaRecorder <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> audioChunks<span class="token operator">:</span> Blob<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> isRecording<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioChunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRecording <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è¯·æ±‚éº¦å…‹é£æƒé™</span>
    <span class="token keyword">async</span> <span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                audio<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to get microphone permission'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¼€å§‹å½•åˆ¶</span>
    <span class="token function">startRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'No audio stream available'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioChunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaRecorder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dataavailable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>audioChunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRecording <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åœæ­¢å½•åˆ¶</span>
    <span class="token function">stopRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Blob<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isRecording<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Not recording'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> audioBlob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>audioChunks<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                    type<span class="token operator">:</span> <span class="token string">'audio/webm'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>audioBlob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isRecording <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æš‚åœå½•åˆ¶</span>
    <span class="token function">pauseRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isRecording<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ¢å¤å½•åˆ¶</span>
    <span class="token function">resumeRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isRecording<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// é‡Šæ”¾èµ„æº</span>
    <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>track <span class="token operator">=&gt;</span> track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>mediaRecorder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>audioChunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRecording <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">const</span> recorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioRecorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// è¯·æ±‚éº¦å…‹é£æƒé™</span>
        <span class="token keyword">await</span> recorder<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å¼€å§‹å½•åˆ¶</span>
        recorder<span class="token punctuation">.</span><span class="token function">startRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 5ç§’ååœæ­¢å½•åˆ¶</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> audioBlob <span class="token operator">=</span> <span class="token keyword">await</span> recorder<span class="token punctuation">.</span><span class="token function">stopRecording</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// åˆ›å»ºéŸ³é¢‘URL</span>
            <span class="token keyword">const</span> audioUrl <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>audioBlob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// åˆ›å»ºéŸ³é¢‘å…ƒç´ æ’­æ”¾å½•éŸ³</span>
            <span class="token keyword">const</span> audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Audio</span><span class="token punctuation">(</span>audioUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// æ¸…ç†èµ„æº</span>
            recorder<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Recording failed:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_354">
     </a>
     è§†é¢‘å¤„ç†å®ç°
    </h3>
    <h4>
     <a id="_356">
     </a>
     è§†é¢‘æ’­æ”¾å™¨
    </h4>
    <pre><code class="prism language-typescript"><span class="token comment">// è§†é¢‘æ’­æ”¾å™¨ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">VideoPlayer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> video<span class="token operator">:</span> HTMLVideoElement<span class="token punctuation">;</span>
    <span class="token keyword">private</span> canvas<span class="token operator">:</span> HTMLCanvasElement<span class="token punctuation">;</span>
    <span class="token keyword">private</span> ctx<span class="token operator">:</span> CanvasRenderingContext2D<span class="token punctuation">;</span>
    <span class="token keyword">private</span> isPlaying<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span>
        videoElement<span class="token operator">:</span> HTMLVideoElement<span class="token punctuation">,</span>
        canvas<span class="token operator">:</span> HTMLCanvasElement
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video <span class="token operator">=</span> videoElement<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializePlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åˆå§‹åŒ–æ’­æ”¾å™¨</span>
    <span class="token keyword">private</span> <span class="token function">initializePlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// è®¾ç½®ç”»å¸ƒå°ºå¯¸</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
        
        <span class="token comment">// ç›‘å¬è§†é¢‘äº‹ä»¶</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'play'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pause'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'ended'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åŠ è½½è§†é¢‘</span>
    <span class="token function">loadVideo</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function-variable function">oncanplaythrough</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to load video'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ’­æ”¾</span>
    <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æš‚åœ</span>
    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·³è½¬åˆ°æŒ‡å®šæ—¶é—´</span>
    <span class="token function">seek</span><span class="token punctuation">(</span>time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®æ’­æ”¾é€Ÿåº¦</span>
    <span class="token function">setPlaybackRate</span><span class="token punctuation">(</span>rate<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>playbackRate <span class="token operator">=</span> rate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åº”ç”¨æ»¤é•œæ•ˆæœ</span>
    <span class="token function">applyFilter</span><span class="token punctuation">(</span>filter<span class="token operator">:</span> VideoFilter<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>filter <span class="token operator">=</span> filter<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ¸²æŸ“è§†é¢‘å¸§</span>
    <span class="token keyword">private</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPlaying<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ç»˜åˆ¶è§†é¢‘å¸§</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ç»§ç»­æ¸²æŸ“ä¸‹ä¸€å¸§</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æˆªå–å½“å‰å¸§</span>
    <span class="token function">captureFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¯¼å‡ºè§†é¢‘ç‰‡æ®µ</span>
    <span class="token keyword">async</span> <span class="token function">exportClip</span><span class="token punctuation">(</span>
        startTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
        endTime<span class="token operator">:</span> <span class="token builtin">number</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Blob<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">captureStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> recorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaRecorder</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> chunks<span class="token operator">:</span> Blob<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        recorder<span class="token punctuation">.</span><span class="token function-variable function">ondataavailable</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            recorder<span class="token punctuation">.</span><span class="token function-variable function">onstop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>chunks<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> <span class="token string">'video/webm'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token comment">// å¼€å§‹å½•åˆ¶</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> startTime<span class="token punctuation">;</span>
            recorder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// åˆ°è¾¾ç»“æŸæ—¶é—´ååœæ­¢</span>
            <span class="token keyword">const</span> <span class="token function-variable function">checkTime</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>currentTime <span class="token operator">&gt;=</span> endTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>checkTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>checkTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// è§†é¢‘æ»¤é•œç±»</span>
<span class="token keyword">class</span> <span class="token class-name">VideoFilter</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> filters<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®äº®åº¦</span>
    <span class="token function">setBrightness</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'brightness'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®å¯¹æ¯”åº¦</span>
    <span class="token function">setContrast</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'contrast'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®é¥±å’Œåº¦</span>
    <span class="token function">setSaturation</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'saturate'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®è‰²ç›¸</span>
    <span class="token function">setHue</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'hue-rotate'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è®¾ç½®æ¨¡ç³Š</span>
    <span class="token function">setBlur</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è½¬æ¢ä¸ºCSSæ»¤é•œå­—ç¬¦ä¸²</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUnit</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–æ»¤é•œå•ä½</span>
    <span class="token keyword">private</span> <span class="token function">getUnit</span><span class="token punctuation">(</span>filter<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>filter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token string">'blur'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'hue-rotate'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">'deg'</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token string">'%'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLVideoElement<span class="token punctuation">;</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLCanvasElement<span class="token punctuation">;</span>
<span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoPlayer</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŠ è½½å¹¶æ’­æ”¾è§†é¢‘</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">playVideo</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">await</span> player<span class="token punctuation">.</span><span class="token function">loadVideo</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åº”ç”¨æ»¤é•œæ•ˆæœ</span>
        <span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">setBrightness</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">setContrast</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filter<span class="token punctuation">.</span><span class="token function">setSaturation</span><span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        player<span class="token punctuation">.</span><span class="token function">applyFilter</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// æˆªå–å½“å‰å¸§</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> frameData <span class="token operator">=</span> player<span class="token punctuation">.</span><span class="token function">captureFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            img<span class="token punctuation">.</span>src <span class="token operator">=</span> frameData<span class="token punctuation">;</span>
            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å¯¼å‡ºè§†é¢‘ç‰‡æ®µ</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> clip <span class="token operator">=</span> <span class="token keyword">await</span> player<span class="token punctuation">.</span><span class="token function">exportClip</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>clip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            a<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
            a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">'clip.webm'</span><span class="token punctuation">;</span>
            a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Failed to play video:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_593">
     </a>
     æµåª’ä½“å¤„ç†
    </h3>
    <h4>
     <a id="WebRTC_595">
     </a>
     WebRTCå®ç°
    </h4>
    <pre><code class="prism language-typescript"><span class="token comment">// WebRTCè¿æ¥ç®¡ç†å™¨</span>
<span class="token keyword">class</span> <span class="token class-name">WebRTCManager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> peerConnection<span class="token operator">:</span> RTCPeerConnection<span class="token punctuation">;</span>
    <span class="token keyword">private</span> localStream<span class="token operator">:</span> MediaStream <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> remoteStream<span class="token operator">:</span> MediaStream <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> dataChannel<span class="token operator">:</span> RTCDataChannel <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            iceServers<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span> urls<span class="token operator">:</span> <span class="token string">'stun:stun.l.google.com:19302'</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>localStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>remoteStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åˆå§‹åŒ–è¿æ¥</span>
    <span class="token keyword">private</span> <span class="token function">initializeConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ç›‘å¬ICEå€™é€‰</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function-variable function">onicecandidate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// å‘é€ICEå€™é€‰åˆ°è¿œç«¯</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendSignalingMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    type<span class="token operator">:</span> <span class="token string">'candidate'</span><span class="token punctuation">,</span>
                    candidate<span class="token operator">:</span> event<span class="token punctuation">.</span>candidate
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ç›‘å¬è¿œç«¯æµ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function-variable function">ontrack</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>remoteStream <span class="token operator">=</span> event<span class="token punctuation">.</span>streams<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// è§¦å‘è¿œç«¯æµæ›´æ–°äº‹ä»¶</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onRemoteStreamUpdate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>remoteStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºæ•°æ®é€šé“</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">createDataChannel</span><span class="token punctuation">(</span><span class="token string">'messageChannel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ç›‘å¬æ•°æ®é€šé“äº‹ä»¶</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onDataChannelMessage</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è·å–æœ¬åœ°åª’ä½“æµ</span>
    <span class="token keyword">async</span> <span class="token function">getLocalStream</span><span class="token punctuation">(</span>
        constraints<span class="token operator">:</span> MediaStreamConstraints
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>MediaStream<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>localStream <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// æ·»åŠ æœ¬åœ°æµåˆ°è¿æ¥</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>localStream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>track <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>localStream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localStream<span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to get local stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åˆ›å»ºè¿æ¥è¯·æ±‚</span>
    <span class="token keyword">async</span> <span class="token function">createOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>RTCSessionDescriptionInit<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> offer <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">createOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>offer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> offer<span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to create offer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// åˆ›å»ºè¿æ¥åº”ç­”</span>
    <span class="token keyword">async</span> <span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>RTCSessionDescriptionInit<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> answer <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> answer<span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to create answer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¤„ç†è¿œç«¯æè¿°</span>
    <span class="token keyword">async</span> <span class="token function">handleRemoteDescription</span><span class="token punctuation">(</span>
        description<span class="token operator">:</span> RTCSessionDescriptionInit
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">RTCSessionDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>description<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'offer'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> answer <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å‘é€åº”ç­”åˆ°è¿œç«¯</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendSignalingMessage</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    type<span class="token operator">:</span> <span class="token string">'answer'</span><span class="token punctuation">,</span>
                    answer
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to handle remote description'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¤„ç†ICEå€™é€‰</span>
    <span class="token keyword">async</span> <span class="token function">handleCandidate</span><span class="token punctuation">(</span>candidate<span class="token operator">:</span> RTCIceCandidate<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to handle ICE candidate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å‘é€æ¶ˆæ¯</span>
    <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">'open'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å…³é—­è¿æ¥</span>
    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>localStream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>localStream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>track <span class="token operator">=&gt;</span> track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>dataChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>peerConnection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å‘é€ä¿¡ä»¤æ¶ˆæ¯ï¼ˆéœ€è¦å®ç°ï¼‰</span>
    <span class="token keyword">private</span> <span class="token function">sendSignalingMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// é€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€æ¶ˆæ¯</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// è¿œç«¯æµæ›´æ–°å›è°ƒï¼ˆéœ€è¦å®ç°ï¼‰</span>
    <span class="token keyword">private</span> <span class="token function">onRemoteStreamUpdate</span><span class="token punctuation">(</span>stream<span class="token operator">:</span> MediaStream<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å¤„ç†è¿œç«¯æµæ›´æ–°</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// æ•°æ®é€šé“æ¶ˆæ¯å›è°ƒï¼ˆéœ€è¦å®ç°ï¼‰</span>
    <span class="token keyword">private</span> <span class="token function">onDataChannelMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// å¤„ç†æ•°æ®é€šé“æ¶ˆæ¯</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">const</span> rtcManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebRTCManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¼€å§‹è§†é¢‘é€šè¯</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startVideoCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// è·å–æœ¬åœ°åª’ä½“æµ</span>
        <span class="token keyword">const</span> localStream <span class="token operator">=</span> <span class="token keyword">await</span> rtcManager<span class="token punctuation">.</span><span class="token function">getLocalStream</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            video<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            audio<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// æ˜¾ç¤ºæœ¬åœ°è§†é¢‘</span>
        <span class="token keyword">const</span> localVideo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'localVideo'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLVideoElement<span class="token punctuation">;</span>
        localVideo<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> localStream<span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ›å»ºè¿æ¥è¯·æ±‚</span>
        <span class="token keyword">const</span> offer <span class="token operator">=</span> <span class="token keyword">await</span> rtcManager<span class="token punctuation">.</span><span class="token function">createOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å‘é€offeråˆ°è¿œç«¯ï¼ˆé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨ï¼‰</span>
        <span class="token comment">// ...</span>
        
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Video call failed:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤„ç†è¿œç«¯æ¶ˆæ¯</span>
<span class="token keyword">function</span> <span class="token function">handleRemoteMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">'offer'</span><span class="token operator">:</span>
            rtcManager<span class="token punctuation">.</span><span class="token function">handleRemoteDescription</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>offer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
            
        <span class="token keyword">case</span> <span class="token string">'answer'</span><span class="token operator">:</span>
            rtcManager<span class="token punctuation">.</span><span class="token function">handleRemoteDescription</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
            
        <span class="token keyword">case</span> <span class="token string">'candidate'</span><span class="token operator">:</span>
            rtcManager<span class="token punctuation">.</span><span class="token function">handleCandidate</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_806">
     </a>
     æœ€ä½³å®è·µä¸å»ºè®®
    </h3>
    <ol>
     <li>
      <p>
       <strong>
        æ€§èƒ½ä¼˜åŒ–
       </strong>
      </p>
      <ul>
       <li>
        ä½¿ç”¨é€‚å½“çš„ç¼–è§£ç æ ¼å¼
       </li>
       <li>
        å®ç°é¢„åŠ è½½å’Œç¼“å†²
       </li>
       <li>
        ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½
       </li>
       <li>
        æ§åˆ¶å†…å­˜ä½¿ç”¨
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        ç”¨æˆ·ä½“éªŒ
       </strong>
      </p>
      <ul>
       <li>
        æµç•…çš„æ’­æ”¾ä½“éªŒ
       </li>
       <li>
        åˆé€‚çš„ç¼“å†²ç­–ç•¥
       </li>
       <li>
        æ¸…æ™°çš„é”™è¯¯æç¤º
       </li>
       <li>
        å‹å¥½çš„æ§åˆ¶ç•Œé¢
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        å…¼å®¹æ€§å¤„ç†
       </strong>
      </p>
      <ul>
       <li>
        æ”¯æŒå¤šç§æ ¼å¼
       </li>
       <li>
        ä¼˜é›…é™çº§æ–¹æ¡ˆ
       </li>
       <li>
        è·¨æµè§ˆå™¨å…¼å®¹
       </li>
       <li>
        ç§»åŠ¨ç«¯é€‚é…
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        å®‰å…¨æ€§è€ƒè™‘
       </strong>
      </p>
      <ul>
       <li>
        å†…å®¹åŠ å¯†
       </li>
       <li>
        æƒé™æ§åˆ¶
       </li>
       <li>
        é˜²ç›—é“¾æªæ–½
       </li>
       <li>
        æ•°æ®ä¿æŠ¤
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_832">
     </a>
     æ€»ç»“
    </h3>
    <p>
     å‰ç«¯éŸ³è§†é¢‘å¤„ç†éœ€è¦è€ƒè™‘ä»¥ä¸‹æ–¹é¢ï¼š
    </p>
    <ol>
     <li>
      é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆ
     </li>
     <li>
      ä¼˜åŒ–æ’­æ”¾æ€§èƒ½
     </li>
     <li>
      æä¾›è‰¯å¥½ä½“éªŒ
     </li>
     <li>
      ä¿è¯å®‰å…¨å¯é 
     </li>
     <li>
      å¤„ç†å…¼å®¹æ€§
     </li>
    </ol>
    <p>
     é€šè¿‡åˆç†çš„æŠ€æœ¯é€‰å‹å’Œä¼˜åŒ–æªæ–½ï¼Œå¯ä»¥æ„å»ºå‡ºé«˜è´¨é‡çš„éŸ³è§†é¢‘åº”ç”¨ã€‚
    </p>
    <h3>
     <a id="_844">
     </a>
     å­¦ä¹ èµ„æº
    </h3>
    <ol>
     <li>
      Web Audio APIæ–‡æ¡£
     </li>
     <li>
      Media Source ExtensionsæŒ‡å—
     </li>
     <li>
      WebRTCå¼€å‘æ•™ç¨‹
     </li>
     <li>
      éŸ³è§†é¢‘ç¼–è§£ç çŸ¥è¯†
     </li>
     <li>
      æµåª’ä½“åè®®è§„èŒƒ
     </li>
    </ol>
    <hr/>
    <p>
     å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼Œä¹ŸæœŸå¾…åœ¨è¯„è®ºåŒºçœ‹åˆ°ä½ çš„æƒ³æ³•å’Œå»ºè®®ï¼ğŸ‘‡
    </p>
    <p>
     <em>
      <strong>
       ç»ˆèº«å­¦ä¹ ï¼Œå…±åŒæˆé•¿ã€‚
      </strong>
     </em>
    </p>
    <p>
     å’±ä»¬ä¸‹ä¸€æœŸè§
    </p>
    <p>
     ğŸ’»
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f4368656e374368616e2f:61727469636c652f64657461696c732f313436313430323333" class_="artid" style="display:none">
 </p>
</div>


