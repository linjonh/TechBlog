---
layout: post
title: "基于qt的桌面宠物纳西妲源码纯享"
date: 2025-03-05 17:35:56 +0800
description: "本专栏会不定时更新，如果有有趣的C++代码或者编程可以在评论区留言，我会尽量满足粉丝的要求，同时还希望看到的朋友点个赞/收藏（感谢/感谢）main.cpp:widget.h:widget.cpp打包参考文章：Qt程序发布完整教程以及打包成exe文件【小白版】_qt发布可执行程序-CSDN博客需要代码的可以评论区留言，私聊。"
keywords: "基于qt的桌面宠物——纳西妲源码纯享"
categories: ['有趣的编程']
tags: ['宠物']
artid: "146048606"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146048606
    alt: "基于qt的桌面宠物纳西妲源码纯享"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146048606
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146048606
cover: https://bing.ee123.net/img/rand?artid=146048606
image: https://bing.ee123.net/img/rand?artid=146048606
img: https://bing.ee123.net/img/rand?artid=146048606
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     基于qt的桌面宠物——纳西妲源码纯享
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     本专栏会不定时更新，如果有有趣的C++代码或者编程可以在评论区留言，我会尽量满足粉丝的要求，同时还希望看到的朋友点个赞/收藏（感谢/感谢）
    </p>
    <h2>
     代码
    </h2>
    <p>
     main.cpp:
    </p>
    <pre><code>#include "widget.h"

#include &lt;QApplication&gt;
#include&lt;QSystemTrayIcon&gt;
#include&lt;QIcon&gt;

int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    Widget w;

    QSystemTrayIcon sysTray(QIcon("://img/icon.png"),&amp;w);

    QMenu menu;
    auto showAct=new QAction("show",&amp;sysTray);
    auto exitAct=new QAction("exit",&amp;sysTray);

    QObject::connect(showAct,&amp;QAction::triggered,[&amp;](){
        w.setVisible(true);
    });
    QObject::connect(exitAct,&amp;QAction::triggered,[&amp;](){
        QApplication::quit();
    });

    menu.addAction(showAct);
    menu.addAction(exitAct);

    sysTray.setContextMenu(&amp;menu);

    sysTray.show();
    w.show();
    return a.exec();
}
</code></pre>
    <p>
     widget.h:
    </p>
    <pre><code>#ifndef WIDGET_H
#define WIDGET_H

#include &lt;QWidget&gt;
#include&lt;QMap&gt;
#include&lt;QList&gt;
#include&lt;QUrl&gt;
#include&lt;QTimer&gt;
#include&lt;QEvent&gt;
#include&lt;QMouseEvent&gt;
#include&lt;QContextMenuEvent&gt;
#include&lt;QMenu&gt;

class QPaintEvent;

namespace Act {
Q_NAMESPACE

enum RoleAct{
    Swing,
    Sleep,
    SayHello
};
Q_ENUM_NS(RoleAct)

}

using namespace  Act ;

class Widget : public QWidget
{
    Q_OBJECT

public:
    Widget(QWidget *parent = nullptr);
    ~Widget();

public:
    void showActAnimation(RoleAct k);

public slots:
    void onMenuTriggered(QAction* action);

protected:
    void paintEvent(QPaintEvent* event)override;
    void contextMenuEvent(QContextMenuEvent* event);

private:
    void loadRoleActRes();
    void initMenu();

private:
    QMap&lt;RoleAct,QList&lt;QUrl&gt;&gt; action_map;
    QTimer* timer;
    RoleAct cur_role_act;
    QUrl cur_role_pix;
    QMenu* menu;
};

class DragFilter:public QObject{

public:
    bool eventFilter(QObject* obj,QEvent* event)
    {
        auto w=dynamic_cast&lt;QWidget*&gt;(obj);
        if(!w)
            return false;

        if(event-&gt;type()==QEvent::MouseButtonPress)
        {
            auto e=dynamic_cast&lt;QMouseEvent*&gt;(event);
            if(e)
            {
                pos=e-&gt;pos();
            }
        }
        else if(event-&gt;type()==QEvent::MouseMove)
        {
            auto e=dynamic_cast&lt;QMouseEvent*&gt;(event);
            if(e)
            {
                if(e-&gt;buttons()&amp;Qt::MouseButton::LeftButton)
                {
                    w-&gt;move(e-&gt;globalPos()-pos);
                }
            }
        }
        return QObject::eventFilter(obj,event);
    }

private:
    QPoint pos;
};

#endif // WIDGET_H
</code></pre>
    <p>
     widget.cpp
    </p>
    <pre><code>#include "widget.h"
#include&lt;QPaintEvent&gt;
#include&lt;QPainter&gt;//绘图
#include&lt;QPixmap&gt;//图片
#include&lt;QCursor&gt;
#include&lt;QMetaEnum&gt;


Widget::Widget(QWidget *parent)
    : QWidget(parent),
    timer(new QTimer(this)),
    menu(new QMenu(this))
{
    this-&gt;setWindowFlag(Qt::FramelessWindowHint);//去除窗口边框
    this-&gt;setAttribute(Qt::WA_TranslucentBackground);//背景透明

    this-&gt;installEventFilter(new DragFilter);

    connect(timer,&amp;QTimer::timeout,[this](){
        static int index=0;//记录显示动作的当前图片索引
        auto paths = this-&gt;action_map.value(this-&gt;cur_role_act);
        this-&gt;cur_role_pix=paths[index++ % paths.size()];
        //paintEvent() 不允许的
        this-&gt;update();

    });

    initMenu();

    loadRoleActRes();

    showActAnimation(RoleAct::Swing);
}

Widget::~Widget() {}

void Widget::showActAnimation(RoleAct k)
{
    timer-&gt;stop();

    this-&gt;cur_role_act=k;

    timer-&gt;start(60);
}

void Widget::onMenuTriggered(QAction *action)
{
    QMetaEnum me=QMetaEnum::fromType&lt;RoleAct&gt;();

    bool ok;
    int k =  me.keyToValue(action-&gt;text().toStdString().c_str(),&amp;ok);
    if(!ok)
      return;

    showActAnimation(static_cast&lt;RoleAct&gt;(k));
}

void Widget::paintEvent(QPaintEvent *event)
{

    QPainter painter(this);

    QPixmap pix;
    pix.load(this-&gt;cur_role_pix.toLocalFile());

    painter.drawPixmap(0,0,pix);

}

void Widget::contextMenuEvent(QContextMenuEvent *event)
{
    this-&gt;menu-&gt;popup(QCursor::pos());
}

void Widget::loadRoleActRes()
{
    auto addRes=[this](RoleAct k,QString path,int count)
    {
        QList&lt;QUrl&gt; paths;
        char buf[260];
        for (int i = 0; i &lt; count; ++i) {
            memset(buf, 0,sizeof(buf));
            sprintf_s(buf,path.toStdString().c_str(),i);
            paths.append(QUrl::fromLocalFile(buf));
        }
        action_map.insert(k,paths);
    };

    addRes(RoleAct::SayHello,"D:/001/pet/img/sayHello/sayHello_%d.png",28);
    addRes(RoleAct::Swing,"D:/001/pet/img/swing/swing_%d.png",32);
    addRes(RoleAct::Sleep,"D:/001/pet/img/sleep/sleep_%d.png",25);
}

void Widget::initMenu()
{
    menu-&gt;addAction("SayHello");
    menu-&gt;addAction("Sleep");
    menu-&gt;addAction("Swing");

    QAction* act=new QAction("Hide");
    connect(act,&amp;QAction::triggered,[this](){
        this-&gt;setVisible(false);
    });

    menu-&gt;addAction(act);

    connect(this-&gt;menu,&amp;QMenu::triggered,this,&amp;Widget::onMenuTriggered);
}
</code></pre>
    <blockquote>
     <p>
      演示：
     </p>
     <p style="text-align:center">
      <img alt="" height="300" src="https://i-blog.csdnimg.cn/direct/50a65405c4274c76b773dcaabc89c61b.png" width="241"/>
     </p>
     <p>
      右键会出现四个选项：
     </p>
     <p class="img-center">
      <img alt="" height="267" src="https://i-blog.csdnimg.cn/direct/1ca21e094bb1422ca7084f6fc8b0857b.png" width="264"/>
     </p>
     <p>
      点击相应图标会有不同动作。
     </p>
     <p>
      sleep:
     </p>
     <p class="img-center">
      <img alt="" height="156" src="https://i-blog.csdnimg.cn/direct/b9585c9263a04b19ba9020c0a347f139.png" width="253"/>
     </p>
     <p>
      hello:
     </p>
     <p class="img-center">
      <img alt="" height="248" src="https://i-blog.csdnimg.cn/direct/8a96b516795c43eea8f836189005c6b1.png" width="227"/>
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     打包参考文章：
     <a href="https://blog.csdn.net/j1499/article/details/129306922" title="Qt程序发布完整教程以及打包成exe文件【小白版】_qt发布可执行程序-CSDN博客">
      Qt程序发布完整教程以及打包成exe文件【小白版】_qt发布可执行程序-CSDN博客
     </a>
    </p>
    <p>
     需要代码的可以评论区留言，私聊。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f37343831313337382f:61727469636c652f64657461696c732f313436303438363036" class_="artid" style="display:none">
 </p>
</div>


