---
layout: post
title: "爬虫的精准识别基于-User-Agent-的正则实现"
date: 2025-03-12 00:15:00 +0800
description: "想象一个典型的在线客服场景：用户访问网站后，通过 WebSocket 与客服实时沟通。然而，大量爬虫（如搜索引擎索引、SEO 工具、恶意扫描程序）的请求也会触发 WebSocket 连接。这些爬虫不会主动发送消息，却会长期占用连接资源。客服人员看到“在线用户”列表中的爬虫会话，尝试对话却得不到任何回应，最终导致：    资源浪费：服务器带宽、连接数被无效占用。    效率下降：客服需要手动排查“沉默用户”，增加工作负担。    数据污染：统计报表中的“用户活跃数”被虚假流量污染。"
keywords: "爬虫的精准识别：基于 User-Agent 的正则实现"
categories: ['Java']
tags: ['爬虫', '正则表达式', 'Javascript', 'Java']
artid: "146177182"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146177182
    alt: "爬虫的精准识别基于-User-Agent-的正则实现"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146177182
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146177182
cover: https://bing.ee123.net/img/rand?artid=146177182
image: https://bing.ee123.net/img/rand?artid=146177182
img: https://bing.ee123.net/img/rand?artid=146177182
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     爬虫的精准识别：基于 User-Agent 的正则实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      🧑 博主简介：
      <strong>
       CSDN博客专家
      </strong>
      ，
      <strong>
       历代文学网
      </strong>
      （PC端可以访问：
      <a href="https://literature.sinhy.com/#/?__c=1000" rel="nofollow">
       https://literature.sinhy.com/#/?__c=1000
      </a>
      ，移动端可微信小程序搜索“
      <strong>
       历代文学
      </strong>
      ”）总架构师，
      <code>
       15年
      </code>
      工作经验，精通
      <code>
       Java编程
      </code>
      ，
      <code>
       高并发设计
      </code>
      ，
      <code>
       Springboot和微服务
      </code>
      ，熟悉
      <code>
       Linux
      </code>
      ，
      <code>
       ESXI虚拟化
      </code>
      以及
      <code>
       云原生Docker和K8s
      </code>
      ，热衷于探索科技的边界，并将理论知识转化为实际应用。保持对新技术的好奇心，乐于分享所学，希望通过我的实践经历和见解，启发他人的创新思维。在这里，我希望能与志同道合的朋友交流探讨，共同进步，一起在技术的世界里不断学习成长。
      <br/>
      <strong>
       技术合作
      </strong>
      请加本人wx（
      <em>
       注明来自csdn
      </em>
      ）：
      <code>
       foreast_sea
      </code>
     </p>
    </blockquote>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/11968bb92b404ca7bd9fdfe004b640b1.gif#pic_center">
      <br/>
      ------
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8bf91bdcd6f4415ab296f7252553e592.png"/>
     </img>
    </p>
    <h2>
     <a id="_UserAgent__6">
     </a>
     爬虫的精准识别：基于 User-Agent 的正则实现
    </h2>
    <hr/>
    <h3>
     <a id="_9">
     </a>
     引言
    </h3>
    <p>
     在当今实时交互场景中，WebSocket 技术已成为在线客服、即时通讯、实时数据推送等服务的核心支柱。然而，一个看似简单的技术细节却可能让企业付出高昂的代价：
     <strong>
      当爬虫机器人伪装成“用户”接入 WebSocket 时，客服系统可能误将其识别为真实客户，导致客服资源被无意义消耗，甚至因“无响应对话”而影响用户体验
     </strong>
     。
    </p>
    <h4>
     <a id="_12">
     </a>
     <strong>
      场景痛点：当技术便利遭遇“无效流量”
     </strong>
    </h4>
    <p>
     想象一个典型的在线客服场景：用户访问网站后，通过
     <code>
      WebSocket
     </code>
     与客服实时沟通。然而，大量爬虫（如搜索引擎索引、
     <code>
      SEO
     </code>
     工具、恶意扫描程序）的请求也会触发
     <code>
      WebSocket
     </code>
     连接。这些爬虫不会主动发送消息，却会长期占用连接资源。客服人员看到“在线用户”列表中的爬虫会话，尝试对话却得不到任何回应，最终导致：
    </p>
    <ol>
     <li>
      <strong>
       资源浪费
      </strong>
      ：服务器带宽、连接数被无效占用。
     </li>
     <li>
      <strong>
       效率下降
      </strong>
      ：客服需要手动排查“沉默用户”，增加工作负担。
     </li>
     <li>
      <strong>
       数据污染
      </strong>
      ：统计报表中的“用户活跃数”被虚假流量污染。
     </li>
    </ol>
    <p>
     更糟糕的是，部分攻击者会利用
     <code>
      WebSocket
     </code>
     的长连接特性，发起高频请求或注入攻击，进一步威胁系统安全。
    </p>
    <h4>
     <a id="_20">
     </a>
     <strong>
      传统方案的局限性
     </strong>
    </h4>
    <p>
     许多开发者试图通过简单的
     <strong>
      IP 封禁
     </strong>
     或
     <strong>
      请求频率限制
     </strong>
     解决问题，但爬虫的 IP 池和访问策略日益动态化，传统方案往往力不从心。而直接依赖
     <strong>
      User-Agent 字符串过滤
     </strong>
     看似直接，却常因正则表达式设计不当（如漏判新爬虫、误伤正常用户）导致效果大打折扣。
    </p>
    <h4>
     <a id="_23">
     </a>
     <strong>
      本文目标
     </strong>
    </h4>
    <p>
     本文将聚焦
     <strong>
      “如何在 WebSocket 握手阶段精准识别爬虫”
     </strong>
     ，通过以下实践方案实现高效拦截：
    </p>
    <ol>
     <li>
      <strong>
       多维度 User-Agent 检测
      </strong>
      ：基于正则表达式覆盖 95% 的已知爬虫标识，确保关键词精准匹配。
     </li>
     <li>
      <strong>
       轻量化浏览器端拦截
      </strong>
      ：提供 JavaScript 正则方案，避免爬虫触发前端资源加载。
     </li>
     <li>
      <strong>
       服务端兜底逻辑
      </strong>
      ：结合 IP 黑名单与行为分析，应对伪造 User-Agent 的高级爬虫。
     </li>
    </ol>
    <p>
     文章将深入解析正则表达式设计技巧、跨语言（Java/JavaScript）实现方案，并探讨如何在开源数据集（如
     <a href="https://github.com/monperrus/crawler-user-agents">
      crawler-user-agents
     </a>
     ）基础上动态更新策略。无论您是构建客服系统的开发者，还是需优化实时服务性能的架构师，均可通过本文获得可直接复用的代码与实践经验。
    </p>
    <hr/>
    <p>
     <strong>
      以下是基于常见爬虫和机器人的
      <code>
       User-Agent
      </code>
      关键词整理的正则表达式实现方案：
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="1__UserAgent__36">
     </a>
     1. 常见爬虫 User-Agent 关键词
    </h3>
    <p>
     以下关键词覆盖了主流搜索引擎、SEO 工具、社交媒体、监控服务等类型的爬虫机器人：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        关键词（不区分大小写）
       </th>
       <th>
        示例爬虫名称
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         bot
        </code>
       </td>
       <td>
        Googlebot, Bingbot
       </td>
      </tr>
      <tr>
       <td>
        <code>
         spider
        </code>
       </td>
       <td>
        YandexSpider, Baiduspider
       </td>
      </tr>
      <tr>
       <td>
        <code>
         crawler
        </code>
       </td>
       <td>
        AhrefsBot, SemrushBot
       </td>
      </tr>
      <tr>
       <td>
        <code>
         slurp
        </code>
       </td>
       <td>
        Yahoo! Slurp
       </td>
      </tr>
      <tr>
       <td>
        <code>
         facebookexternalhit
        </code>
       </td>
       <td>
        Facebook 链接预览机器人
       </td>
      </tr>
      <tr>
       <td>
        <code>
         duckduckbot
        </code>
       </td>
       <td>
        DuckDuckGo 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         facebot
        </code>
       </td>
       <td>
        Facebook 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         alexa
        </code>
       </td>
       <td>
        Amazon 的 Alexa 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         applebot
        </code>
       </td>
       <td>
        Apple 的搜索引擎爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         pinterest
        </code>
       </td>
       <td>
        Pinterest 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         twitterbot
        </code>
       </td>
       <td>
        Twitter 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         linkedinbot
        </code>
       </td>
       <td>
        LinkedIn 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         telegrambot
        </code>
       </td>
       <td>
        Telegram 爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         uptimerobot
        </code>
       </td>
       <td>
        UptimeRobot 监控服务
       </td>
      </tr>
      <tr>
       <td>
        <code>
         exabot
        </code>
       </td>
       <td>
        Exalead 搜索引擎
       </td>
      </tr>
      <tr>
       <td>
        <code>
         msnbot
        </code>
       </td>
       <td>
        MSN 搜索引擎爬虫
       </td>
      </tr>
      <tr>
       <td>
        <code>
         yahoo
        </code>
       </td>
       <td>
        Yahoo 爬虫
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="2__61">
     </a>
     2. 正则表达式实现
    </h3>
    <p>
     以下正则表达式会匹配包含上述关键词的 User-Agent（不区分大小写）：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">String</span> pattern <span class="token operator">=</span> <span class="token string">"(?i).*\\b(bot|spider|crawler|slurp|facebookexternalhit|duckduckbot|facebot|alexa|applebot|pinterest|twitterbot|linkedinbot|telegrambot|uptimerobot|exabot|msnbot|yahoo|googlebot|bingbot|yandexbot|baiduspider|ahrefsbot|semrushbot)\\b.*"</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="3__68">
     </a>
     3. 正则关键表达式说明
    </h3>
    <h4>
     <a id="31_i_69">
     </a>
     3.1
     <code>
      (?i)
     </code>
     ：忽略大小写的标记
    </h4>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：表示后续的正则匹配
      <strong>
       不区分大小写
      </strong>
      。
     </li>
     <li>
      <strong>
       原理
      </strong>
      ：
      <code>
       (?i)
      </code>
      是正则表达式的
      <strong>
       模式修饰符
      </strong>
      （Pattern Modifier），它会从当前位置开始，对整个表达式生效。
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：
      <pre><code class="prism language-regex">(?i)bot   → 可以匹配 "Bot", "BOT", "bOt" 等任意大小写组合
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="32_b__79">
     </a>
     3.2
     <code>
      \\b
     </code>
     ： 单词边界
    </h4>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：表示
      <strong>
       单词边界
      </strong>
      （Word Boundary），确保匹配的是一个完整的单词（而不是单词的一部分）。
     </li>
     <li>
      <strong>
       原理
      </strong>
      ：
      <code>
       \\b
      </code>
      会匹配一个位置，该位置的一侧是单词字符（字母、数字、下划线），另一侧是非单词字符（如空格、标点或字符串边界）。
     </li>
     <li>
      <strong>
       示例
      </strong>
      ：
      <pre><code class="prism language-regex">\\bbot\\b → 匹配 "bot" 但不会匹配 "robot" 或 "bots"
</code></pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="33_ibbotspiderb_89">
     </a>
     3.3 组合后的效果：
     <code>
      (?i).*\\b(bot|spider)\\b.*
     </code>
    </h4>
    <p>
     假设原始正则表达式为：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">String</span> pattern <span class="token operator">=</span> <span class="token string">"(?i).*\\b(bot|spider)\\b.*"</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="331__94">
     </a>
     3.3.1 匹配逻辑
    </h5>
    <ol>
     <li>
      <code>
       (?i)
      </code>
      → 忽略大小写。
     </li>
     <li>
      <code>
       .*
      </code>
      → 允许目标关键词出现在
      <strong>
       任意位置
      </strong>
      （如开头、中间、结尾）。
     </li>
     <li>
      <code>
       \\b
      </code>
      → 确保关键词是完整单词（避免部分匹配，如
      <code>
       robot
      </code>
      中的
      <code>
       bot
      </code>
      ）。
     </li>
     <li>
      <code>
       (bot|spider)
      </code>
      → 匹配 “bot” 或 “spider”。
     </li>
     <li>
      最后的
      <code>
       .*
      </code>
      → 允许关键词后有其他字符。
     </li>
    </ol>
    <h5>
     <a id="332__UserAgent_101">
     </a>
     3.3.2 示例匹配的 User-Agent
    </h5>
    <ul>
     <li>
      <code>
       "Googlebot/2.1"
      </code>
      → 匹配
      <code>
       bot
      </code>
     </li>
     <li>
      <code>
       "YandexSpider"
      </code>
      → 匹配
      <code>
       spider
      </code>
     </li>
     <li>
      <code>
       "BingPreviewBot"
      </code>
      → 匹配
      <code>
       bot
      </code>
     </li>
    </ul>
    <h5>
     <a id="333__UserAgent_106">
     </a>
     3.3.3 不匹配的 User-Agent
    </h5>
    <ul>
     <li>
      <code>
       "Robot/1.0"
      </code>
      →
      <code>
       \\bbot\\b
      </code>
      不会匹配 “Robot” 中的 “bot”
     </li>
     <li>
      <code>
       "Mozilla/5.0 (Windows NT 10.0; Win64; x64)"
      </code>
      → 不含关键词
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="4_Java__112">
     </a>
     4. Java 代码实现
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CrawlerDetector</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BOT_PATTERN</span> <span class="token operator">=</span> <span class="token string">"(?i).*\\b(bot|spider|crawler|slurp|facebookexternalhit|duckduckbot|facebot|alexa|applebot|pinterest|twitterbot|linkedinbot|telegrambot|uptimerobot|exabot|msnbot|yahoo|googlebot|bingbot|yandexbot|baiduspider|ahrefsbot|semrushbot)\\b.*"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> pattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token constant">BOT_PATTERN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isCrawler</span><span class="token punctuation">(</span><span class="token class-name">String</span> userAgent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userAgent <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> userAgent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="41_java__130">
     </a>
     4.1 java 使用示例
    </h4>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> userAgent1 <span class="token operator">=</span> <span class="token string">"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> userAgent2 <span class="token operator">=</span> <span class="token string">"Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Mobile/15E148 Safari/604.1"</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Is crawler 1? "</span> <span class="token operator">+</span> <span class="token class-name">CrawlerDetector</span><span class="token punctuation">.</span><span class="token function">isCrawler</span><span class="token punctuation">(</span>userAgent1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Is crawler 2? "</span> <span class="token operator">+</span> <span class="token class-name">CrawlerDetector</span><span class="token punctuation">.</span><span class="token function">isCrawler</span><span class="token punctuation">(</span>userAgent2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="5_JS__142">
     </a>
     5. JS 代码实现
    </h3>
    <p>
     以下是
     <strong>
      JavaScript 版本
     </strong>
     的正则表达式实现（适配浏览器环境）：
    </p>
    <h4>
     <a id="51_JavaScript__144">
     </a>
     5.1 JavaScript 正则表达式
    </h4>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> crawlerRegex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b(bot|spider|crawler|slurp|facebookexternalhit|duckduckbot|facebot|alexa|applebot|pinterest|twitterbot|linkedinbot|telegrambot|uptimerobot|exabot|msnbot|yahoo|googlebot|bingbot|yandexbot|baiduspider|ahrefsbot|semrushbot)\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h4>
     <a id="52__151">
     </a>
     5.2 实现解析
    </h4>
    <h5>
     <a id="521__152">
     </a>
     5.2.1
     <strong>
      正则结构
     </strong>
    </h5>
    <ul>
     <li>
      <code>
       \b
      </code>
      ：匹配单词边界（确保关键词是完整单词，避免误匹配类似
      <code>
       robot
      </code>
      中的
      <code>
       bot
      </code>
      ）。
     </li>
     <li>
      <code>
       (bot|spider|...)
      </code>
      ：匹配列表中的任意关键词。
     </li>
     <li>
      <code>
       i
      </code>
      标志：忽略大小写（替代 Java 的
      <code>
       (?i)
      </code>
      ）。
     </li>
    </ul>
    <h5>
     <a id="522__157">
     </a>
     5.2.2
     <strong>
      浏览器端使用示例
     </strong>
    </h5>
    <pre><code class="prism language-javascript"><span class="token comment">// 检测当前浏览器 User-Agent 是否是爬虫</span>
<span class="token keyword">function</span> <span class="token function">isCrawler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> userAgent <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
  <span class="token keyword">return</span> crawlerRegex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用示例</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCrawler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"检测到爬虫，阻止 WebSocket 连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"允许连接 WebSocket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="53_175">
     </a>
     5.3
     <strong>
      注意事项
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        关键词动态更新
       </strong>
       <br/>
       可以将正则关键词提取到配置中，便于动态扩展：
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> botKeywords <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"bot"</span><span class="token punctuation">,</span> <span class="token string">"spider"</span><span class="token punctuation">,</span> <span class="token string">"crawler"</span><span class="token punctuation">,</span> <span class="token string">"slurp"</span><span class="token punctuation">,</span> 
  <span class="token string">"facebookexternalhit"</span><span class="token punctuation">,</span> <span class="token string">"duckduckbot"</span><span class="token punctuation">,</span> <span class="token string">"facebot"</span><span class="token punctuation">,</span>
  <span class="token comment">// ...其他关键词</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> crawlerRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\\b(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>botKeywords<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)\\b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        浏览器兼容性
       </strong>
      </p>
      <ul>
       <li>
        所有现代浏览器（Chrome/Firefox/Safari/Edge）均支持
        <code>
         RegExp
        </code>
        和
        <code>
         i
        </code>
        标志。
       </li>
       <li>
        兼容到 IE9+。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="54__191">
     </a>
     5.4
     <strong>
      完整代码
     </strong>
    </h4>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 定义正则表达式</span>
<span class="token keyword">const</span> botKeywords <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"bot"</span><span class="token punctuation">,</span> <span class="token string">"spider"</span><span class="token punctuation">,</span> <span class="token string">"crawler"</span><span class="token punctuation">,</span> <span class="token string">"slurp"</span><span class="token punctuation">,</span> <span class="token string">"facebookexternalhit"</span><span class="token punctuation">,</span>
  <span class="token string">"duckduckbot"</span><span class="token punctuation">,</span> <span class="token string">"facebot"</span><span class="token punctuation">,</span> <span class="token string">"alexa"</span><span class="token punctuation">,</span> <span class="token string">"applebot"</span><span class="token punctuation">,</span> <span class="token string">"pinterest"</span><span class="token punctuation">,</span>
  <span class="token string">"twitterbot"</span><span class="token punctuation">,</span> <span class="token string">"linkedinbot"</span><span class="token punctuation">,</span> <span class="token string">"telegrambot"</span><span class="token punctuation">,</span> <span class="token string">"uptimerobot"</span><span class="token punctuation">,</span>
  <span class="token string">"exabot"</span><span class="token punctuation">,</span> <span class="token string">"msnbot"</span><span class="token punctuation">,</span> <span class="token string">"yahoo"</span><span class="token punctuation">,</span> <span class="token string">"googlebot"</span><span class="token punctuation">,</span> <span class="token string">"bingbot"</span><span class="token punctuation">,</span>
  <span class="token string">"yandexbot"</span><span class="token punctuation">,</span> <span class="token string">"baiduspider"</span><span class="token punctuation">,</span> <span class="token string">"ahrefsbot"</span><span class="token punctuation">,</span> <span class="token string">"semrushbot"</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> crawlerRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\\b(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>botKeywords<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)\\b</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检测逻辑</span>
<span class="token keyword">function</span> <span class="token function">isCrawler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> crawlerRegex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 根据检测结果控制 WebSocket 连接</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isCrawler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"wss://your-websocket-endpoint"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocket 已连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"爬虫客户端，禁止连接 WebSocket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <hr/>
    <h4>
     <a id="_220">
     </a>
     <strong>
      注意事项
     </strong>
    </h4>
    <ol>
     <li>
      <strong>
       误判风险
      </strong>
      ：极少数正常浏览器可能包含关键词（如
      <code>
       Bot
      </code>
      ），但概率极低。
     </li>
     <li>
      <strong>
       动态更新
      </strong>
      ：定期更新正则中的关键词列表以覆盖新出现的爬虫。
     </li>
     <li>
      <strong>
       性能
      </strong>
      ：正则表达式复杂度较低，适合高频调用。
     </li>
    </ol>
    <p>
     如果需要更全面的关键词列表，可以参考
     <a href="https://user-agents.net/" rel="nofollow">
      user-agents
     </a>
     等公开数据集。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6c696c696e6861693534382f:61727469636c652f64657461696c732f313436313737313832" class_="artid" style="display:none">
 </p>
</div>


