---
layout: post
title: "使用chroot预安装软件到ubuntu22中"
date: 2025-03-07 11:09:45 +0800
description: "---------- 在Chroot环境中操作，以下是安装nginx的例子 ----------# ---------- 在Chroot环境中操作，以下是安装nginx的例子 ----------# 添加自定义软件（示例安装nginx）# 生成新squashfs文件。# 解压squashfs文件。# 进入chroot环境。# 复制文件到工作目录。# 退出chroot。"
keywords: "使用chroot预安装软件到ubuntu22中"
categories: ['未分类']
tags: ['运维', 'Ubuntu', 'Linux']
artid: "146090709"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146090709
    alt: "使用chroot预安装软件到ubuntu22中"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146090709
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146090709
cover: https://bing.ee123.net/img/rand?artid=146090709
image: https://bing.ee123.net/img/rand?artid=146090709
img: https://bing.ee123.net/img/rand?artid=146090709
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用chroot预安装软件到ubuntu22中
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <br/>
    </p>
    <h2>
     1、安装依赖
    </h2>
    <blockquote>
     <p>
      # 安装依赖工具
     </p>
     <p>
      sudo apt update &amp;&amp; sudo apt install -y \
     </p>
     <p>
      squashfs-tools \
     </p>
     <p>
      genisoimage \
     </p>
     <p>
      xorriso \
     </p>
     <p>
      isolinux \
     </p>
     <p>
      syslinux-utils \
     </p>
     <p>
      p7zip-full
     </p>
     <p>
      sudo apt update
     </p>
     <p>
      sudo apt install grub-pc-bin grub-efi-amd64-bin -y
     </p>
     <p>
     </p>
     <p>
      # 创建工作目录
     </p>
     <p>
      mkdir -p ./custom-iso/{original,edit}
     </p>
    </blockquote>
    <h2>
     2、提取ISO内容
    </h2>
    <blockquote>
     <p>
      # 挂载原始ISO
     </p>
     <p>
      sudo mount -o loop ubuntu-22.04.5-live-server-amd64.iso /mnt
     </p>
     <p>
      # 复制文件到工作目录
     </p>
     <p>
      sudo rsync -a /mnt/ ./custom-iso/original/
     </p>
     <p>
      sudo umount /mnt
     </p>
     <p>
      cd ./custom-iso
     </p>
    </blockquote>
    <h2>
     3、 解压系统文件
    </h2>
    <blockquote>
     <p>
      # 解压squashfs文件
     </p>
     <p>
      sudo unsquashfs -f -d ./edit ./original/casper/ubuntu-server-minimal.squashfs
     </p>
    </blockquote>
    <h2>
     4、配置Chroot环境
    </h2>
    <blockquote>
     <p>
      # 进入chroot环境
     </p>
     <p>
      sudo chroot ./edit
     </p>
     <p>
     </p>
     <p>
      # ---------- 在Chroot环境中操作，以下是安装nginx的例子 ----------
     </p>
     <p>
      # 配置基础环境
     </p>
     <p>
      apt update
     </p>
     <p>
      apt install -y debconf-utils
     </p>
     <p>
      export DEBIAN_FRONTEND=noninteractive
     </p>
     <p>
     </p>
     <p>
      # 添加自定义软件（示例安装nginx）
     </p>
     <p>
      apt install -y nginx
     </p>
     <p>
     </p>
     <p>
      # 清理缓存
     </p>
     <p>
      apt clean
     </p>
     <p>
      rm -rf /var/lib/apt/lists/*
     </p>
     <p>
      rm -rf /tmp/*
     </p>
     <p>
      # ---------- 在Chroot环境中操作，以下是安装nginx的例子 ----------
     </p>
     <p>
     </p>
     <p>
      # 退出chroot
     </p>
     <p>
      exit
     </p>
     <p>
     </p>
    </blockquote>
    <p>
    </p>
    <h2>
     5、重新打包系统文件
    </h2>
    <blockquote>
     <p>
      # 生成新squashfs文件
     </p>
     <p>
      rm -rf original/casper/ubuntu-server-minimal.squashfs
     </p>
     <p>
      sudo mksquashfs edit original/casper/ubuntu-server-minimal.squashfs \
     </p>
     <p>
      -comp xz \
     </p>
     <p>
      -b 1M \
     </p>
     <p>
      -noappend
     </p>
     <p>
      #生成md5
     </p>
     <p>
      cd original
     </p>
     <p>
      find -type f -exec md5sum {} \; &gt; md5sum.txt
     </p>
     <p>
      cd ..
     </p>
     <p>
      <br/>
     </p>
     <p>
      xorriso -as mkisofs -iso-level 3 -full-iso9660-filenames \
     </p>
     <p>
      -volid "Custom Ubuntu" \
     </p>
     <p>
      -eltorito-boot boot/grub/i386-pc/eltorito.img \
     </p>
     <p>
      -no-emul-boot -boot-load-size 4 -boot-info-table \
     </p>
     <p>
      -eltorito-alt-boot -e EFI/boot/grubx64.efi -no-emul-boot \
     </p>
     <p>
      -isohybrid-gpt-basdat \
     </p>
     <p>
      -o ./custom-ubuntu-22.04.5-fixed.iso ./original
     </p>
    </blockquote>
    <h2>
     6、验证
    </h2>
    <blockquote>
     <p>
      qemu-system-x86_64 -m 2G -cdrom ./custom-ubuntu-22.04.5-fixed.iso -curses
     </p>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f5a5f6c696e68742f:61727469636c652f64657461696c732f313436303930373039" class_="artid" style="display:none">
 </p>
</div>


