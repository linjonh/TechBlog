---
layout: post
title: "RecyclerView与ListView的优化"
date: 2025-03-06 16:07:33 +0800
description: "本文详细介绍了ListView和RecyclerView的优化技巧，从基础概念到高级应用，系统地讲解了如何提高列表性能和用户体验。RecyclerView作为Android现代列表控件，提供了更多的灵活性和性能优势，是开发高性能列表界面的首选。在实际开发中，应根据具体需求选择合适的优化策略，如使用DiffUtil进行高效更新、实现分页加载、优化布局结构等。同时，结合Epoxy、Paging等优秀的开源库，可以更轻松地构建复杂且高性能的列表界面。下一篇文章将介绍Fragment的生命周期与使用，敬请期待。"
keywords: "RecyclerView与ListView的优化"
categories: ['Android']
tags: ['开发语言', 'Java', 'Android']
artid: "146068151"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146068151
    alt: "RecyclerView与ListView的优化"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146068151
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146068151
cover: https://bing.ee123.net/img/rand?artid=146068151
image: https://bing.ee123.net/img/rand?artid=146068151
img: https://bing.ee123.net/img/rand?artid=146068151
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     RecyclerView与ListView的优化
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="RecyclerViewListView_0">
     </a>
     RecyclerView与ListView的优化
    </h2>
    <h3>
     <a id="_2">
     </a>
     一、基础概念对比
    </h3>
    <h4>
     <a id="11_ListViewRecyclerView_4">
     </a>
     1.1 ListView与RecyclerView概述
    </h4>
    <p>
     ListView和RecyclerView都是Android中用于展示列表数据的重要控件，但RecyclerView是更现代化的解决方案，提供了更多的灵活性和性能优势。
    </p>
    <h5>
     <a id="ListView_8">
     </a>
     ListView特点
    </h5>
    <ul>
     <li>
      Android早期提供的列表控件
     </li>
     <li>
      使用简单，上手容易
     </li>
     <li>
      内置了常见的分割线、选择模式等功能
     </li>
     <li>
      性能优化相对有限
     </li>
    </ul>
    <h5>
     <a id="RecyclerView_14">
     </a>
     RecyclerView特点
    </h5>
    <ul>
     <li>
      Android Support Library（现AndroidX）提供的现代列表控件
     </li>
     <li>
      更加灵活，支持多种布局方式
     </li>
     <li>
      强制使用ViewHolder模式
     </li>
     <li>
      提供了丰富的动画API
     </li>
     <li>
      通过LayoutManager实现不同的布局效果
     </li>
    </ul>
    <h4>
     <a id="12__21">
     </a>
     1.2 基本使用对比
    </h4>
    <h5>
     <a id="ListView_23">
     </a>
     ListView基本使用
    </h5>
    <pre><code class="prism language-kotlin"><span class="token comment">// 定义Adapter</span>
<span class="token keyword">class</span> <span class="token function">MyListAdapter</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
    ArrayAdapter<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> android<span class="token punctuation">.</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_list_item_1<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 可以重写getView方法进行优化</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在Activity中使用</span>
<span class="token keyword">val</span> listView <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>ListView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>list_view<span class="token punctuation">)</span>
<span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Item 1"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Item 2"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Item 3"</span></span><span class="token punctuation">)</span>
listView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> <span class="token function">MyListAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="RecyclerView_38">
     </a>
     RecyclerView基本使用
    </h5>
    <pre><code class="prism language-kotlin"><span class="token comment">// 定义ViewHolder和Adapter</span>
<span class="token keyword">class</span> <span class="token function">MyAdapter</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
    RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>MyAdapter<span class="token punctuation">.</span>ViewHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">class</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> textView<span class="token operator">:</span> TextView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_view<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> ViewHolder <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_view<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> ViewHolder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        holder<span class="token punctuation">.</span>textView<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">[</span>position<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">.</span>size
<span class="token punctuation">}</span>

<span class="token comment">// 在Activity中使用</span>
<span class="token keyword">val</span> recyclerView <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>RecyclerView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recycler_view<span class="token punctuation">)</span>
recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> <span class="token function">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Item 1"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Item 2"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Item 3"</span></span><span class="token punctuation">)</span>
recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> <span class="token function">MyAdapter</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="ListView_69">
     </a>
     二、ListView优化技巧
    </h3>
    <h4>
     <a id="21_ViewHolder_71">
     </a>
     2.1 ViewHolder模式
    </h4>
    <p>
     在ListView中，ViewHolder模式不是强制的，但使用它可以显著提高性能：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> <span class="token function">OptimizedAdapter</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">val</span> <span class="token keyword">data</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
    ArrayAdapter<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>list_item<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">private</span> <span class="token keyword">class</span> ViewHolder <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> textView<span class="token operator">:</span> TextView<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">,</span> convertView<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> view <span class="token operator">=</span> convertView
        <span class="token keyword">val</span> holder<span class="token operator">:</span> ViewHolder
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>view <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>list_item<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            holder <span class="token operator">=</span> <span class="token function">ViewHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            holder<span class="token punctuation">.</span>textView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_view<span class="token punctuation">)</span>
            view<span class="token punctuation">.</span>tag <span class="token operator">=</span> holder
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            holder <span class="token operator">=</span> view<span class="token punctuation">.</span>tag <span class="token keyword">as</span> ViewHolder
        <span class="token punctuation">}</span>
        
        holder<span class="token punctuation">.</span>textView<span class="token operator">?</span><span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">[</span>position<span class="token punctuation">]</span>
        <span class="token keyword">return</span> view<span class="token operator">!!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="22_ListView_102">
     </a>
     2.2 其他ListView优化技巧
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        合理设置ListView高度
       </strong>
      </p>
      <ul>
       <li>
        避免在ScrollView中嵌套ListView
       </li>
       <li>
        使用
        <code>
         android:layout_height="wrap_content"
        </code>
        时需谨慎
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        减少getView()中的复杂操作
       </strong>
      </p>
      <ul>
       <li>
        避免在getView()中进行耗时操作
       </li>
       <li>
        图片加载使用异步方式
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        使用分页加载
       </strong>
      </p>
      <ul>
       <li>
        实现滑动到底部加载更多数据
       </li>
       <li>
        避免一次性加载大量数据
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="RecyclerView_116">
     </a>
     三、RecyclerView优化技巧
    </h3>
    <h4>
     <a id="31__118">
     </a>
     3.1 布局优化
    </h4>
    <ol>
     <li>
      <strong>
       使用DiffUtil进行高效更新
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> <span class="token function">MyDiffCallback</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> oldList<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">val</span> newList<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
    DiffUtil<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getOldListSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> oldList<span class="token punctuation">.</span>size
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getNewListSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> newList<span class="token punctuation">.</span>size
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">areItemsTheSame</span><span class="token punctuation">(</span>oldPos<span class="token operator">:</span> Int<span class="token punctuation">,</span> newPos<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span> 
        oldList<span class="token punctuation">[</span>oldPos<span class="token punctuation">]</span> <span class="token operator">==</span> newList<span class="token punctuation">[</span>newPos<span class="token punctuation">]</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">areContentsTheSame</span><span class="token punctuation">(</span>oldPos<span class="token operator">:</span> Int<span class="token punctuation">,</span> newPos<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">=</span> 
        oldList<span class="token punctuation">[</span>oldPos<span class="token punctuation">]</span> <span class="token operator">==</span> newList<span class="token punctuation">[</span>newPos<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用DiffUtil更新数据</span>
<span class="token keyword">fun</span> <span class="token function">updateData</span><span class="token punctuation">(</span>newData<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> diffResult <span class="token operator">=</span> DiffUtil<span class="token punctuation">.</span><span class="token function">calculateDiff</span><span class="token punctuation">(</span><span class="token function">MyDiffCallback</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">data</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">data</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span>
    diffResult<span class="token punctuation">.</span><span class="token function">dispatchUpdatesTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       使用setHasFixedSize
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-kotlin">recyclerView<span class="token punctuation">.</span><span class="token function">setHasFixedSize</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 当列表项大小固定时使用</span>
</code></pre>
    <ol start="3">
     <li>
      <strong>
       使用RecycledViewPool共享ViewHolder
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token comment">// 在嵌套RecyclerView的场景中</span>
<span class="token keyword">val</span> viewPool <span class="token operator">=</span> RecyclerView<span class="token punctuation">.</span><span class="token function">RecycledViewPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
parentRecyclerView<span class="token punctuation">.</span><span class="token function">setRecycledViewPool</span><span class="token punctuation">(</span>viewPool<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="32__160">
     </a>
     3.2 数据处理优化
    </h4>
    <ol>
     <li>
      <strong>
       异步加载数据
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token function">loadDataFromDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Main<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        adapter<span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       分页加载
      </strong>
     </li>
    </ol>
    <p>
     使用Paging库实现高效分页：
    </p>
    <pre><code class="prism language-kotlin"><span class="token comment">// 定义DataSource</span>
<span class="token keyword">class</span> MyDataSource <span class="token operator">:</span> PageKeyedDataSource<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">loadInitial</span><span class="token punctuation">(</span>params<span class="token operator">:</span> LoadInitialParams<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> LoadInitialCallback<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 加载初始数据</span>
        <span class="token keyword">val</span> items <span class="token operator">=</span> <span class="token function">fetchDataFromNetwork</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>requestedLoadSize<span class="token punctuation">)</span>
        callback<span class="token punctuation">.</span><span class="token function">onResult</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">loadAfter</span><span class="token punctuation">(</span>params<span class="token operator">:</span> LoadParams<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> LoadCallback<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 加载后续页面</span>
        <span class="token keyword">val</span> items <span class="token operator">=</span> <span class="token function">fetchDataFromNetwork</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>key<span class="token punctuation">,</span> params<span class="token punctuation">.</span>requestedLoadSize<span class="token punctuation">)</span>
        callback<span class="token punctuation">.</span><span class="token function">onResult</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> params<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">loadBefore</span><span class="token punctuation">(</span>params<span class="token operator">:</span> LoadParams<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> LoadCallback<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 通常不需要实现</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="33__198">
     </a>
     3.3 滑动优化
    </h4>
    <ol>
     <li>
      <strong>
       预加载
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-kotlin">recyclerView<span class="token punctuation">.</span><span class="token function">addOnScrollListener</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">OnScrollListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onScrolled</span><span class="token punctuation">(</span>recyclerView<span class="token operator">:</span> RecyclerView<span class="token punctuation">,</span> dx<span class="token operator">:</span> Int<span class="token punctuation">,</span> dy<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onScrolled</span><span class="token punctuation">(</span>recyclerView<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
        <span class="token keyword">val</span> layoutManager <span class="token operator">=</span> recyclerView<span class="token punctuation">.</span>layoutManager <span class="token keyword">as</span> LinearLayoutManager
        <span class="token keyword">val</span> lastVisibleItem <span class="token operator">=</span> layoutManager<span class="token punctuation">.</span><span class="token function">findLastVisibleItemPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> totalItemCount <span class="token operator">=</span> layoutManager<span class="token punctuation">.</span>itemCount
        
        <span class="token comment">// 当滑动到倒数第5个item时预加载下一页数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lastVisibleItem <span class="token operator">&gt;=</span> totalItemCount <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">loadMoreData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       滑动时暂停加载
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-kotlin">recyclerView<span class="token punctuation">.</span><span class="token function">addOnScrollListener</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">OnScrollListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onScrollStateChanged</span><span class="token punctuation">(</span>recyclerView<span class="token operator">:</span> RecyclerView<span class="token punctuation">,</span> newState<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onScrollStateChanged</span><span class="token punctuation">(</span>recyclerView<span class="token punctuation">,</span> newState<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newState <span class="token operator">==</span> RecyclerView<span class="token punctuation">.</span>SCROLL_STATE_IDLE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 滑动停止时加载图片</span>
            imageLoader<span class="token punctuation">.</span><span class="token function">resumeLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 滑动时暂停图片加载</span>
            imageLoader<span class="token punctuation">.</span><span class="token function">pauseLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_235">
     </a>
     四、实战案例
    </h3>
    <h4>
     <a id="41__237">
     </a>
     4.1 多类型列表实现
    </h4>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> <span class="token function">MultiTypeAdapter</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> items<span class="token operator">:</span> List<span class="token operator">&lt;</span>Any<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
    RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">val</span> TYPE_HEADER <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">const</span> <span class="token keyword">val</span> TYPE_NORMAL <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getItemViewType</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> TYPE_HEADER <span class="token keyword">else</span> TYPE_NORMAL
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>viewType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            TYPE_HEADER <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">val</span> view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_header<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token function">HeaderViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">val</span> view <span class="token operator">=</span> LayoutInflater<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_normal<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token function">NormalViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">when</span> <span class="token punctuation">(</span>holder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">is</span> HeaderViewHolder <span class="token operator">-&gt;</span> holder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>position<span class="token punctuation">]</span> <span class="token keyword">as</span> Header<span class="token punctuation">)</span>
            <span class="token keyword">is</span> NormalViewHolder <span class="token operator">-&gt;</span> holder<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>position<span class="token punctuation">]</span> <span class="token keyword">as</span> NormalItem<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> items<span class="token punctuation">.</span>size
    
    <span class="token keyword">class</span> <span class="token function">HeaderViewHolder</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>header<span class="token operator">:</span> Header<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 绑定头部数据</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">class</span> <span class="token function">NormalViewHolder</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span><span class="token function">ViewHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token operator">:</span> NormalItem<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 绑定普通项数据</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="42__290">
     </a>
     4.2 网格布局与瀑布流实现
    </h4>
    <pre><code class="prism language-kotlin"><span class="token comment">// 网格布局</span>
<span class="token keyword">val</span> gridLayoutManager <span class="token operator">=</span> <span class="token function">GridLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 3列网格</span>
recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> gridLayoutManager

<span class="token comment">// 设置跨列显示的项</span>
gridLayoutManager<span class="token punctuation">.</span>spanSizeLookup <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> GridLayoutManager<span class="token punctuation">.</span><span class="token function">SpanSizeLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getSpanSize</span><span class="token punctuation">(</span>position<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>adapter<span class="token punctuation">.</span><span class="token function">getItemViewType</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span> <span class="token operator">==</span> MultiTypeAdapter<span class="token punctuation">.</span>TYPE_HEADER<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token number">3</span> <span class="token comment">// 头部占据3列</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token number">1</span> <span class="token comment">// 普通项占据1列</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 瀑布流布局</span>
<span class="token keyword">val</span> staggeredGridLayoutManager <span class="token operator">=</span> 
    <span class="token function">StaggeredGridLayoutManager</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> StaggeredGridLayoutManager<span class="token punctuation">.</span>VERTICAL<span class="token punctuation">)</span> <span class="token comment">// 2列瀑布流</span>
recyclerView<span class="token punctuation">.</span>layoutManager <span class="token operator">=</span> staggeredGridLayoutManager
</code></pre>
    <h3>
     <a id="_314">
     </a>
     五、性能监测与调优
    </h3>
    <h4>
     <a id="51__316">
     </a>
     5.1 性能监测工具
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        Systrace
       </strong>
      </p>
      <ul>
       <li>
        分析UI渲染性能
       </li>
       <li>
        检测帧率和卡顿问题
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        Android Profiler
       </strong>
      </p>
      <ul>
       <li>
        监控内存使用情况
       </li>
       <li>
        分析CPU使用率
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        自定义性能监测
       </strong>
      </p>
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> PerformanceMonitorAdapter<span class="token operator">&lt;</span>VH <span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>ViewHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> wrappedAdapter<span class="token operator">:</span> RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>VH<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
    RecyclerView<span class="token punctuation">.</span>Adapter<span class="token operator">&lt;</span>VH<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> ViewGroup<span class="token punctuation">,</span> viewType<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> VH <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> startTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> holder <span class="token operator">=</span> wrappedAdapter<span class="token punctuation">.</span><span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> viewType<span class="token punctuation">)</span>
        <span class="token keyword">val</span> endTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Performance"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onCreateViewHolder took </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression"><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> holder
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> VH<span class="token punctuation">,</span> position<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> startTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        wrappedAdapter<span class="token punctuation">.</span><span class="token function">onBindViewHolder</span><span class="token punctuation">(</span>holder<span class="token punctuation">,</span> position<span class="token punctuation">)</span>
        <span class="token keyword">val</span> endTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Performance"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onBindViewHolder for position </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">position</span></span><span class="token string"> took </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression"><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> wrappedAdapter<span class="token punctuation">.</span>itemCount
<span class="token punctuation">}</span>

<span class="token comment">// 使用方式</span>
recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> <span class="token function">PerformanceMonitorAdapter</span><span class="token punctuation">(</span>myAdapter<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="52__354">
     </a>
     5.2 常见性能问题及解决方案
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        布局层级过深
       </strong>
      </p>
      <ul>
       <li>
        使用Hierarchy Viewer分析布局层级
       </li>
       <li>
        使用ConstraintLayout减少嵌套
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        频繁创建对象
       </strong>
      </p>
      <ul>
       <li>
        使用对象池复用临时对象
       </li>
       <li>
        避免在onBindViewHolder中创建新对象
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        主线程阻塞
       </strong>
      </p>
      <ul>
       <li>
        耗时操作放到后台线程
       </li>
       <li>
        使用协程或RxJava处理异步任务
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_368">
     </a>
     六、面试题解析
    </h3>
    <h4>
     <a id="Q1RecyclerViewListView_370">
     </a>
     Q1：RecyclerView相比ListView有哪些优势？
    </h4>
    <p>
     答：RecyclerView相比ListView的主要优势：
    </p>
    <ol>
     <li>
      强制使用ViewHolder模式，提高性能
     </li>
     <li>
      通过LayoutManager支持多种布局方式（线性、网格、瀑布流）
     </li>
     <li>
      提供了ItemAnimator实现丰富的动画效果
     </li>
     <li>
      通过ItemDecoration自定义分割线和装饰
     </li>
     <li>
      支持局部刷新，减少不必要的重绘
     </li>
     <li>
      提供了更好的事件处理机制
     </li>
     <li>
      与DiffUtil结合，高效处理数据变化
     </li>
    </ol>
    <h4>
     <a id="Q2RecyclerView_381">
     </a>
     Q2：如何优化RecyclerView的性能？
    </h4>
    <p>
     答：优化RecyclerView性能的主要方法：
    </p>
    <ol>
     <li>
      使用DiffUtil进行高效的数据更新
     </li>
     <li>
      对于固定大小的列表，使用setHasFixedSize(true)
     </li>
     <li>
      复杂布局使用多级缓存和RecycledViewPool
     </li>
     <li>
      避免在onBindViewHolder中进行耗时操作
     </li>
     <li>
      使用异步加载和图片缓存
     </li>
     <li>
      实现分页加载，避免一次加载大量数据
     </li>
     <li>
      滑动时暂停加载图片等耗时操作
     </li>
     <li>
      优化item布局，减少嵌套和过度绘制
     </li>
    </ol>
    <h4>
     <a id="Q3ListViewRecyclerView_393">
     </a>
     Q3：ListView和RecyclerView的缓存机制有什么区别？
    </h4>
    <p>
     答：ListView和RecyclerView的缓存机制区别：
    </p>
    <ol>
     <li>
      <p>
       ListView的缓存机制：
      </p>
      <ul>
       <li>
        一级缓存：mActiveViews，屏幕内可见的View
       </li>
       <li>
        二级缓存：mScrapViews，离开屏幕的View
       </li>
      </ul>
     </li>
     <li>
      <p>
       RecyclerView的缓存机制：
      </p>
      <ul>
       <li>
        一级缓存：mAttachedScrap，屏幕内可见的ViewHolder
       </li>
       <li>
        二级缓存：mCachedViews，离开屏幕的ViewHolder，默认大小为2
       </li>
       <li>
        三级缓存：ViewCacheExtension，开发者自定义缓存
       </li>
       <li>
        四级缓存：RecycledViewPool，缓存不同类型的ViewHolder，可以在多个RecyclerView间共享
       </li>
      </ul>
     </li>
     <li>
      <p>
       主要区别：
      </p>
      <ul>
       <li>
        RecyclerView缓存粒度更细，缓存层次更多
       </li>
       <li>
        RecyclerView支持多个RecyclerView共享缓存池
       </li>
       <li>
        RecyclerView缓存ViewHolder而不仅是View
       </li>
       <li>
        RecyclerView支持自定义缓存策略
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_412">
     </a>
     七、开源项目实战
    </h3>
    <h4>
     <a id="71_Epoxy_414">
     </a>
     7.1 使用Epoxy实现复杂列表
    </h4>
    <p>
     Airbnb的Epoxy是一个用于构建复杂RecyclerView的库，它使用了类似于React的组件化思想：
    </p>
    <pre><code class="prism language-kotlin"><span class="token comment">// 定义Model</span>
<span class="token annotation builtin">@EpoxyModelClass</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> HeaderModel <span class="token operator">:</span> EpoxyModelWithHolder<span class="token operator">&lt;</span>HeaderHolder<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation builtin">@EpoxyAttribute</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> title<span class="token operator">:</span> String
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getDefaultLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_header
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">bind</span><span class="token punctuation">(</span>holder<span class="token operator">:</span> HeaderHolder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        holder<span class="token punctuation">.</span>titleView<span class="token punctuation">.</span>text <span class="token operator">=</span> title
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义Controller</span>
<span class="token keyword">class</span> MyEpoxyController <span class="token operator">:</span> TypedEpoxyController<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Item<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">buildModels</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>Item<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 添加头部</span>
        header <span class="token punctuation">{<!-- --></span>
            <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"header"</span></span><span class="token punctuation">)</span>
            <span class="token function">title</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"我的列表"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 添加列表项</span>
        <span class="token keyword">data</span><span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{<!-- --></span> item <span class="token operator">-&gt;</span>
            itemModel <span class="token punctuation">{<!-- --></span>
                <span class="token function">id</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
                <span class="token function">title</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
                <span class="token function">description</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
                clickListener <span class="token punctuation">{<!-- --></span> _ <span class="token operator">-&gt;</span> <span class="token function">onItemClicked</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">onItemClicked</span><span class="token punctuation">(</span>item<span class="token operator">:</span> Item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理点击事件</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在Activity中使用</span>
<span class="token keyword">val</span> controller <span class="token operator">=</span> <span class="token function">MyEpoxyController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> recyclerView <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>RecyclerView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recycler_view<span class="token punctuation">)</span>
recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> controller<span class="token punctuation">.</span>adapter

<span class="token comment">// 更新数据</span>
controller<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
</code></pre>
    <p>
     项目地址：
     <a href="https://github.com/airbnb/epoxy">
      Epoxy
     </a>
    </p>
    <h4>
     <a id="72_Paging3_467">
     </a>
     7.2 使用Paging3实现无限滚动列表
    </h4>
    <p>
     Jetpack Paging3库提供了一种更现代化的分页加载方案：
    </p>
    <pre><code class="prism language-kotlin"><span class="token comment">// 定义PagingSource</span>
<span class="token keyword">class</span> <span class="token function">MyPagingSource</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> api<span class="token operator">:</span> MyApi
<span class="token punctuation">)</span> <span class="token operator">:</span> PagingSource<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">load</span><span class="token punctuation">(</span>params<span class="token operator">:</span> LoadParams<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> LoadResult<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">val</span> page <span class="token operator">=</span> params<span class="token punctuation">.</span>key <span class="token operator">?:</span> <span class="token number">1</span>
            <span class="token keyword">val</span> response <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> params<span class="token punctuation">.</span>loadSize<span class="token punctuation">)</span>
            
            LoadResult<span class="token punctuation">.</span><span class="token function">Page</span><span class="token punctuation">(</span>
                <span class="token keyword">data</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>items<span class="token punctuation">,</span>
                prevKey <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">null</span> <span class="token keyword">else</span> page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>
                nextKey <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">null</span> <span class="token keyword">else</span> page <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LoadResult<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getRefreshKey</span><span class="token punctuation">(</span>state<span class="token operator">:</span> PagingState<span class="token operator">&lt;</span>Int<span class="token punctuation">,</span> Item<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> state<span class="token punctuation">.</span>anchorPosition<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span> anchorPosition <span class="token operator">-&gt;</span>
            state<span class="token punctuation">.</span><span class="token function">closestPageToPosition</span><span class="token punctuation">(</span>anchorPosition<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>prevKey<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token operator">?:</span> state<span class="token punctuation">.</span><span class="token function">closestPageToPosition</span><span class="token punctuation">(</span>anchorPosition<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>nextKey<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在ViewModel中使用</span>
<span class="token keyword">class</span> MyViewModel <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> items <span class="token operator">=</span> <span class="token function">Pager</span><span class="token punctuation">(</span>
        config <span class="token operator">=</span> <span class="token function">PagingConfig</span><span class="token punctuation">(</span>
            pageSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
            enablePlaceholders <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            maxSize <span class="token operator">=</span> <span class="token number">100</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        pagingSourceFactory <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">MyPagingSource</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>flow<span class="token punctuation">.</span><span class="token function">cachedIn</span><span class="token punctuation">(</span>viewModelScope<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在Activity中使用</span>
<span class="token keyword">class</span> MyActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> viewModel<span class="token operator">:</span> MyViewModel <span class="token keyword">by</span> <span class="token function">viewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> adapter <span class="token operator">=</span> <span class="token function">MyPagingAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_my<span class="token punctuation">)</span>
        
        <span class="token keyword">val</span> recyclerView <span class="token operator">=</span> findViewById<span class="token operator">&lt;</span>RecyclerView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>recycler_view<span class="token punctuation">)</span>
        recyclerView<span class="token punctuation">.</span>adapter <span class="token operator">=</span> adapter
        
        lifecycleScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{<!-- --></span>
            viewModel<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">collectLatest</span> <span class="token punctuation">{<!-- --></span> pagingData <span class="token operator">-&gt;</span>
                adapter<span class="token punctuation">.</span><span class="token function">submitData</span><span class="token punctuation">(</span>pagingData<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     项目地址：
     <a href="https://developer.android.com/jetpack/androidx/releases/paging" rel="nofollow">
      Paging
     </a>
    </p>
    <h3>
     <a id="_535">
     </a>
     总结
    </h3>
    <p>
     本文详细介绍了ListView和RecyclerView的优化技巧，从基础概念到高级应用，系统地讲解了如何提高列表性能和用户体验。RecyclerView作为Android现代列表控件，提供了更多的灵活性和性能优势，是开发高性能列表界面的首选。
    </p>
    <p>
     在实际开发中，应根据具体需求选择合适的优化策略，如使用DiffUtil进行高效更新、实现分页加载、优化布局结构等。同时，结合Epoxy、Paging等优秀的开源库，可以更轻松地构建复杂且高性能的列表界面。
    </p>
    <p>
     下一篇文章将介绍Fragment的生命周期与使用，敬请期待！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f77616e673239353638393634392f:61727469636c652f64657461696c732f313436303638313531" class_="artid" style="display:none">
 </p>
</div>


