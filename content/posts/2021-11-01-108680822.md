---
layout: post
title: "编译选项中的硬浮点与软浮点区别"
date: 2021-11-01 17:40:06 +0800
description: "一、硬浮点与软浮点 1. 硬浮点 编译器将代码直接编译成硬件浮点协处理器(浮点运算单元FPU)能识别"
keywords: "软浮点"
categories: ['Linux']
tags: ['Linux']
artid: "108680822"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=108680822
    alt: "编译选项中的硬浮点与软浮点区别"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=108680822
featuredImagePreview: https://bing.ee123.net/img/rand?artid=108680822
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     编译选项中的硬浮点与软浮点区别
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <div class="article_content clearfix" id="article_content">
     <div class="markdown_views prism-atom-one-light" id="content_views">
      <svg xmlns="http://www.w3.org/2000/svg">
       <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round">
       </path>
      </svg>
      <h5>
       <a id="_1">
       </a>
       一、硬浮点与软浮点
      </h5>
      <h6>
       <a id="1__3">
       </a>
       1. 硬浮点
      </h6>
      <p>
       编译器将代码直接编译成硬件浮点协处理器(浮点运算单元FPU)能识别的指令，这些指令在执行的时候ARM核直接把它转给协处理器执行。FPU 通常有一套额外的寄存器来完成浮点参数传递和运算。使用实际的硬件浮点运算单元(FPU)会带来性能的提升
      </p>
      <h6>
       <a id="2__7">
       </a>
       2. 软浮点
      </h6>
      <p>
       编译器把浮点运算转成
       <strong>
        浮点运算的函数调用和库函数调用
       </strong>
       (即用整数运算模拟浮点运算)，没有FPU的指令调用，也没有浮点寄存器的参数传递。浮点参数的传递也是通过ARM寄存器或者堆栈完成。现在的Linux系统默认编译选择使用hard-float,如果系统没有任何浮点处理器单元，这就会产生非法指令和异常。因而一般的系统镜像都采用软浮点以兼容没有VFP的处理器。
      </p>
      <h6>
       <a id="3_ARM_11">
       </a>
       3. ARM软浮点与硬浮点编译
      </h6>
      <p>
       出于
       <strong>
        低功耗、封装限制
       </strong>
       等种种原因，
       <strong>
        以前的
       </strong>
       一些ARM处理器没有独立的硬件浮点运算单元，需要用软件来实现浮点运算。随着技术发展，现在高端的ARM处理器基本都具备了
       <strong>
        硬件执行浮点操作
       </strong>
       的能力。 新旧两种架构之间的差异，就产生了两个不同的接口 – 软浮点与硬浮点。
      </p>
      <p>
       编译选项：
      </p>
      <p>
       -mfpu =name（neon or vfp）指定FPU 单元
      </p>
      <p>
       -mfloat-abi= name（soft、hard、 softfp）：指定软件浮点或硬件浮点或 兼容软浮点调用接口
      </p>
      <p>
       -mfpu可以指定使用FPU单元类型，以ARM A76为例有两种：VFP和Neon
      </p>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6245530ce5a3ab108fc9af21bd54f8b7.png"/>
      </p>
      <p>
       <strong>
        VFP与Neon
       </strong>
      </p>
      <ul>
       <li>
        <p>
         VFP (vector floating-point)
        </p>
        <p>
         VFP是一个按顺序工作的浮点协处理器, 它对一组输入执行一个操作并返回一个输出。目的是加快浮点计算,支持单精度和双精度浮点。
        </p>
       </li>
       <li>
        <p>
         NEON
        </p>
        <p>
         Neon是SIMD (Single Instruction Multiple Data) ， 支持单指令多数据操作，意味着在执行一条指令期间，将对多达16个数据集并行执行相同的操作，支持整数和单精度浮点数向量化(并行)操作。
        </p>
       </li>
       <li>
        <p>
         二者区别
        </p>
        <p>
         VFP 支持单精度和双精度浮点，顺序执行，目的加快浮点计算
        </p>
        <p>
         Neon 是SIMD，支持单指令多数据操作，支持整数和单精度浮点数向量化(并行)操作，不支持双浮点 。Neon最大的好处是如果想要执行矢量操作，如对视频的编码/解码， 它可以并行执行单精度浮点（float）操作。 从而提高对视频编码/解码性能
        </p>
        <p>
         VFP 和Neon是共用浮点寄存器，只是执行的指令不同。
        </p>
       </li>
      </ul>
      <p>
       <strong>
        soft、hard、 softfp
       </strong>
      </p>
      <p>
       在有fpu的情况下，可以通过
       <code>
        -mfloat-abi
       </code>
       来指定使用哪种，有如下三种值：
      </p>
      <ul>
       <li>
        **soft：**不用fpu计算，即使有fpu浮点运算单元也不用。
       </li>
       <li>
        <strong>
         armel：
        </strong>
        (arm eabi little endian) 也即
        <strong>
         softfp
        </strong>
        ，用fpu计算（即会将浮点运算编译成对应的浮点指令），但是传参数用普通寄存器传，这样中断的时候，只需要保存普通寄存器，中断负荷小，但是参数需要转换成浮点的再计算。
       </li>
       <li>
        <strong>
         armhf：
        </strong>
        (arm hard float)也即
        <strong>
         hard
        </strong>
        ，用fpu计算，传参数用fpu中的浮点寄存器传，省去了转换性能最好，但是中断负荷高。
       </li>
      </ul>
      <p>
       而arm64，64位的arm默认就是hard float的，因此不需要hf的后缀。
       <strong>
        kernel、rootfs和app编译的时候，指定的必须保持一致才行。
       </strong>
      </p>
      <p>
       使用softfp模式，会存在不必要的浮点到整数、整数到浮点的转换。而使用
       <code>
        hard
       </code>
       模式，在每次浮点相关函数调用时，平均能节省20个CPU周期。
      </p>
      <h6>
       <a id="4_ARM_55">
       </a>
       4. ARM启用硬浮点运算
      </h6>
      <p>
       需要使用硬浮点，需要内核开启对硬浮点支持，同时编译时要使用上面的softfp或hard，才可以使用FPU/Neon进行计算。
      </p>
      <h5>
       <a id="__59">
       </a>
       二、 在内核代码中使用浮点问题
      </h5>
      <h6>
       <a id="1_ARM64___61">
       </a>
       1. ARM64的用户空间进程切换 ---- 浮点寄存器切换
      </h6>
      <p>
       ARM64，默认使用的是硬浮点，在进程切换时会涉及对浮点寄存器的操作。
      </p>
      <p>
       对于ARM64而言，进程切换的context包括：
      </p>
      <p>
       （1）通用寄存器
      </p>
      <p>
       （2）浮点寄存器
      </p>
      <p>
       （3）地址空间寄存器（ttbr0_el1和ttbr1_el1）
      </p>
      <p>
       （4）其他寄存器（ASID、thread process ID register等）
      </p>
      <pre class="prettyprint"><code class="prism language-c has-numbering">Path<span class="token punctuation">:</span>arch<span class="token operator">/</span>arm64<span class="token operator">/</span>kernel<span class="token operator">/</span>process<span class="token punctuation">.</span>c
<span class="token comment">/*
 * Thread switching.
 */</span>
__notrace_funcgraph <span class="token keyword">struct</span> task_struct <span class="token operator">*</span><span class="token function">__switch_to</span><span class="token punctuation">(</span><span class="token keyword">struct</span> task_struct <span class="token operator">*</span>prev<span class="token punctuation">,</span>
				<span class="token keyword">struct</span> task_struct <span class="token operator">*</span>next<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> task_struct <span class="token operator">*</span>last<span class="token punctuation">;</span>
</code><pre><code>&lt;span class="token function"&gt;fpsimd_thread_switch&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;next&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt; 
&lt;span class="token comment"&gt;/*fp是float-point的意思，和浮点运算相关。fpsimd_thread_switch
其实就是把当前FPSIMD的状态保存到了内存中（task.thread.fpsimd_state），
从要切入的next进程描述符中获取FPSIMD状态，并加载到CPU上。*/&lt;/span&gt;
&lt;span class="token function"&gt;tls_thread_switch&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;next&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token function"&gt;hw_breakpoint_thread_switch&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;next&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token function"&gt;contextidr_thread_switch&lt;/span&gt;&lt;span class="token punctuation"&gt;(&lt;/span&gt;next&lt;span class="token punctuation"&gt;)&lt;/span&gt;&lt;span class="token punctuation"&gt;;&lt;/span&gt;
&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;&lt;span class="token punctuation"&gt;.&lt;/span&gt;
&lt;span class="token keyword"&gt;return&lt;/span&gt; last&lt;span class="token punctuation"&gt;;&lt;/span&gt;
</code></pre>
</pre>
     </div>
    </div>
    <p>
     <span class="token punctuation">
      }
     </span>
     <br/>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      -
     </span>
     <br/>
     Path
     <span class="token punctuation">
      :
     </span>
     arch
     <span class="token operator">
      /
     </span>
     arm64
     <span class="token operator">
      /
     </span>
     kernel
     <span class="token operator">
      /
     </span>
     fpsimd
     <span class="token punctuation">
      .
     </span>
     c
     <br/>
     <span class="token keyword">
      void
     </span>
     <span class="token function">
      fpsimd_thread_switch
     </span>
     <span class="token punctuation">
      (
     </span>
     <span class="token keyword">
      struct
     </span>
     task_struct
     <span class="token operator">
      <em>
      </em>
     </span>
     next
     <span class="token punctuation">
      )
     </span>
     <br/>
     <span class="token punctuation">
      {
     </span>
     <br/>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <br/>
     <span class="token comment">
      / Save unsaved fpsimd state, if any:
      <em>
       /
      </em>
     </span>
     <br/>
     <span class="token function">
      fpsimd_save
     </span>
     <span class="token punctuation">
      (
     </span>
     <span class="token punctuation">
      )
     </span>
     <span class="token punctuation">
      ;
     </span>
     <span class="token comment">
      //这里将struct fpsimd_state保存到通用寄存器X0中
     </span>
     <br/>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      .
     </span>
     <br/>
     <span class="token punctuation">
      }
     </span>
     <br/>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      -
     </span>
     <br/>
     Path
     <span class="token punctuation">
      :
     </span>
     arch
     <span class="token operator">
      /
     </span>
     arm64
     <span class="token operator">
      /
     </span>
     kernel
     <span class="token operator">
      /
     </span>
     entry
     <span class="token operator">
      -
     </span>
     fpsimd
     <span class="token punctuation">
      .
     </span>
     S
     <br/>
     <span class="token comment">
      / Save the FP registers. x0 - pointer to struct fpsimd_state*/
     </span>
     <br/>
     <span class="token function">
      ENTRY
     </span>
     <span class="token punctuation">
      (
     </span>
     fpsimd_save_state
     <span class="token punctuation">
      )
     </span>
     <br/>
     fpsimd_save x0
     <span class="token punctuation">
      ,
     </span>
     <span class="token number">
      8
     </span>
     <br/>
     ret
     <br/>
     <span class="token function">
      ENDPROC
     </span>
     <span class="token punctuation">
      (
     </span>
     fpsimd_save_state
     <span class="token punctuation">
      )
     </span>
    </p>
    <div class="hljs-button {2}">
    </div>
    <ul class="pre-numbering">
     <li>
      1
     </li>
     <li>
      2
     </li>
     <li>
      3
     </li>
     <li>
      4
     </li>
     <li>
      5
     </li>
     <li>
      6
     </li>
     <li>
      7
     </li>
     <li>
      8
     </li>
     <li>
      9
     </li>
     <li>
      10
     </li>
     <li>
      11
     </li>
     <li>
      12
     </li>
     <li>
      13
     </li>
     <li>
      14
     </li>
     <li>
      15
     </li>
     <li>
      16
     </li>
     <li>
      17
     </li>
     <li>
      18
     </li>
     <li>
      19
     </li>
     <li>
      20
     </li>
     <li>
      21
     </li>
     <li>
      22
     </li>
     <li>
      23
     </li>
     <li>
      24
     </li>
     <li>
      25
     </li>
     <li>
      26
     </li>
     <li>
      27
     </li>
     <li>
      28
     </li>
     <li>
      29
     </li>
     <li>
      30
     </li>
     <li>
      31
     </li>
     <li>
      32
     </li>
     <li>
      33
     </li>
     <li>
      34
     </li>
     <li>
      35
     </li>
    </ul>
    <h6>
     <a id="2__113">
     </a>
     2. 内核使用浮点
    </h6>
    <p>
     关于内核使用浮点， Robert Love’s 《Linux Kernel Development》(Linux内核设计与实现)书中提到
    </p>
    <p>
     <strong>
      No (Easy) Use of Floating Point
     </strong>
    </p>
    <p>
     When a user-space process uses floating-point instructions, the kernel manages the transition from integer to floating point mode. What the kernel has to do when using floating-point instructions varies by architecture, but the kernel normally catches a trap and then initiates the transition from integer to floating point mode.
    </p>
    <p>
     Unlike user-space, the kernel does not have the luxury of seamless support for floating point because it cannot easily trap itself.
     <strong>
      Using a floating point inside the kernel requires manually saving and restoring the floating point registers, among other possible chores. The short answer is:
      <em>
       Don’t do it!
      </em>
      Except in the rare cases, no floating-point operations are in the kernel
     </strong>
     .
    </p>
    <p>
     后面这句话提到如果内核使用浮点则需要保存恢复浮点寄存器等其他杂项，这样会导致内核性能下降，所以一般不建议使用浮点，除非特殊情况。
    </p>
    <p>
     但是Robert Love’s在这里并没有讨论如何在内核中正确使用浮点，以及未正确使用浮点可能会出现什么问题。**当你需要在内核中使用浮点，如果按照用户空间的写法可能会出现一些意想不到的情况。如：程序Crash，内存越界、访问非法内存地址，浮点计算出错等稀奇古怪的问题。出现这种问题的原因是：内核由于性能原因，在内核运行的代码，内核在进行上下文切换时，不会主动保存和恢复浮点寄存器。**这样可能会导致内核在进行浮点运算时，可能会破坏此时用户空间的浮点寄存器状态，导致用户空间的fpsimd_state状态异常，随后程序的行为将变的不可控。
    </p>
    <ul>
     <li>
      <p>
       如何在内核使用浮点
      </p>
      <p>
       在内核中使用浮点，在不同架构下会有不同操作流程。这部分需要查阅内核文档，如在X86上要用 kernel_fpu_begin()/kernel_fpu_end()，在arm上用 kernel_neon_begin()/ kernel_neon_end()。但并非在使用浮点时简单的使用上面代码就可以，以arm为例，内核文档里介绍了为何要使用该函数，以及如何使用
      </p>
      <pre class="prettyprint"><code class="prism language-c has-numbering">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>kernel<span class="token punctuation">.</span>org<span class="token operator">/</span>doc<span class="token operator">/</span>Documentation<span class="token operator">/</span>arm<span class="token operator">/</span>kernel_mode_neon<span class="token punctuation">.</span>rst
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Kernel mode NEON
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre>
     </li>
    </ul>
    <p>
     TL
     <span class="token punctuation">
      ;
     </span>
     DR summary
     <br/>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      -
     </span>
     <br/>
     <span class="token operator">
      <em>
      </em>
     </span>
     Use only NEON instructions
     <span class="token punctuation">
      ,
     </span>
     or VFP instructions that don’t rely on support
     <br/>
     code
     <br/>
     <span class="token operator">
     </span>
     Isolate your NEON code in a separate compilation unit
     <span class="token punctuation">
      ,
     </span>
     and compile it with
     <br/>
     <span class="token string">
      ‘-march=armv7-a -mfpu=neon -mfloat-abi=softfp’
     </span>
     <br/>
     <span class="token operator">
      <em>
      </em>
     </span>
     Put
     <span class="token function">
      kernel_neon_begin
     </span>
     <span class="token punctuation">
      (
     </span>
     <span class="token punctuation">
      )
     </span>
     and
     <span class="token function">
      kernel_neon_end
     </span>
     <span class="token punctuation">
      (
     </span>
     <span class="token punctuation">
      )
     </span>
     calls around the calls into your
     <br/>
     NEON code
     <br/>
     <span class="token operator">
     </span>
     Don’t sleep in your NEON code
     <span class="token punctuation">
      ,
     </span>
     and be aware that it will be executed with
     <br/>
     preemption disabled
    </p>
    <p>
     Introduction
     <br/>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <br/>
     It is possible to use NEON instructions
     <span class="token punctuation">
      (
     </span>
     and in some cases
     <span class="token punctuation">
      ,
     </span>
     VFP instructions
     <span class="token punctuation">
      )
     </span>
     in
     <br/>
     code that runs in kernel mode
     <span class="token punctuation">
      .
     </span>
     However
     <span class="token punctuation">
      ,
     </span>
     <span class="token keyword">
      for
     </span>
     performance reasons
     <span class="token punctuation">
      ,
     </span>
     the NEON
     <span class="token operator">
      /
     </span>
     VFP
     <br/>
     <span class="token keyword">
      register
     </span>
     file is not preserved and restored at every context
     <span class="token keyword">
      switch
     </span>
     or taken
     <br/>
     exception like the normal
     <span class="token keyword">
      register
     </span>
     file is
     <span class="token punctuation">
      ,
     </span>
     so some manual intervention is
     <br/>
     required
     <span class="token punctuation">
      .
     </span>
     Furthermore
     <span class="token punctuation">
      ,
     </span>
     special care is required
     <span class="token keyword">
      for
     </span>
     code that may sleep
     <span class="token punctuation">
      [
     </span>
     i
     <span class="token punctuation">
      .
     </span>
     e
     <span class="token punctuation">
      .
     </span>
     <span class="token punctuation">
      ,
     </span>
     <br/>
     may call
     <span class="token function">
      schedule
     </span>
     <span class="token punctuation">
      (
     </span>
     <span class="token punctuation">
      )
     </span>
     <span class="token punctuation">
      ]
     </span>
     <span class="token punctuation">
      ,
     </span>
     as NEON or VFP instructions will be executed in a
     <br/>
     non
     <span class="token operator">
      -
     </span>
     preemptible section
     <span class="token keyword">
      for
     </span>
     reasons outlined below
     <span class="token punctuation">
      .
     </span>
     <br/>
     <span class="token comment">
      //这里就说明了在内核运行的代码，内核在进行上下文切换时，不会主动保存和恢复浮点寄存器。
     </span>
    </p>
    <p>
     Interruptions in kernel mode
     <br/>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <span class="token operator">
      –
     </span>
     <br/>
     For reasons of performance and simplicity
     <span class="token punctuation">
      ,
     </span>
     it was decided that there shall be no
     <br/>
     preserve
     <span class="token operator">
      /
     </span>
     restore mechanism
     <span class="token keyword">
      for
     </span>
     the kernel mode NEON
     <span class="token operator">
      /
     </span>
     VFP
     <span class="token keyword">
      register
     </span>
     contents
     <span class="token punctuation">
      .
     </span>
     This
     <br/>
     implies that interruptions of a kernel mode NEON section can only be allowed
     <span class="token keyword">
      if
     </span>
     <br/>
     they are guaranteed not to touch the NEON
     <span class="token operator">
      /
     </span>
     VFP registers
     <span class="token punctuation">
      .
     </span>
     For this reason
     <span class="token punctuation">
      ,
     </span>
     the
     <br/>
     following rules and restrictions apply in the kernel
     <span class="token punctuation">
      :
     </span>
     <br/>
     <span class="token operator">
      <em>
      </em>
     </span>
     NEON
     <span class="token operator">
      /
     </span>
     VFP code is not allowed in interrupt context
     <span class="token punctuation">
      ;
     </span>
     <br/>
     <span class="token operator">
     </span>
     NEON
     <span class="token operator">
      /
     </span>
     VFP code is not allowed to sleep
     <span class="token punctuation">
      ;
     </span>
     <br/>
     <span class="token operator">
      *
     </span>
     NEON
     <span class="token operator">
      /
     </span>
     VFP code is executed with preemption disabled
     <span class="token punctuation">
      .
     </span>
    </p>
    <div class="hljs-button {2}">
    </div>
    <ul class="pre-numbering">
     <li>
      1
     </li>
     <li>
      2
     </li>
     <li>
      3
     </li>
     <li>
      4
     </li>
     <li>
      5
     </li>
     <li>
      6
     </li>
     <li>
      7
     </li>
     <li>
      8
     </li>
     <li>
      9
     </li>
     <li>
      10
     </li>
     <li>
      11
     </li>
     <li>
      12
     </li>
     <li>
      13
     </li>
     <li>
      14
     </li>
     <li>
      15
     </li>
     <li>
      16
     </li>
     <li>
      17
     </li>
     <li>
      18
     </li>
     <li>
      19
     </li>
     <li>
      20
     </li>
     <li>
      21
     </li>
     <li>
      22
     </li>
     <li>
      23
     </li>
     <li>
      24
     </li>
     <li>
      25
     </li>
     <li>
      26
     </li>
     <li>
      27
     </li>
     <li>
      28
     </li>
     <li>
      29
     </li>
     <li>
      30
     </li>
     <li>
      31
     </li>
     <li>
      32
     </li>
     <li>
      33
     </li>
     <li>
      34
     </li>
     <li>
      35
     </li>
     <li>
      36
     </li>
     <li>
      37
     </li>
     <li>
      38
     </li>
    </ul>
    <p>
     这里提到在使用 kernel_neon_begin()/ kernel_neon_end()规则：
    </p>
    <ol>
     <li>
      NEON/VFP code 不允许在中断中使用
     </li>
     <li>
      NEON/VFP code 不允许睡眠
     </li>
     <li>
      NEON/VFP code 执行时是禁止抢占的
     </li>
    </ol>
    <ul>
     <li>
      <p>
       ARM架构内核使用浮点示例
      </p>
      <pre class="prettyprint"><code class="prism language-c has-numbering">下面分别为三段计算代码，其执行的结果是相同的。
ARM64 寄存器
x0 <span class="token operator">-</span> x30 是<span class="token number">31</span>个通用整形寄存器 <span class="token punctuation">,</span> w0 <span class="token operator">~</span> w30来访问这<span class="token number">31</span>个<span class="token number">64</span>位寄存器的低<span class="token number">32</span>位，写入时会将高<span class="token number">32</span>位清零
V0 <span class="token operator">-</span> V31 浮点寄存器<span class="token punctuation">(</span>向量寄存器<span class="token punctuation">)</span>，用于处理SIMD和浮点运算。长度不同称谓也不同，b，h，s，d，q，分别代表<span class="token function">byte</span><span class="token punctuation">(</span><span class="token number">8</span>位<span class="token punctuation">)</span>，<span class="token function">half</span><span class="token punctuation">(</span><span class="token number">16</span>位<span class="token punctuation">)</span>，<span class="token function">single</span><span class="token punctuation">(</span><span class="token number">32</span>位<span class="token punctuation">)</span>，<span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">64</span>位<span class="token punctuation">)</span>，<span class="token function">quad</span><span class="token punctuation">(</span><span class="token number">128</span>位<span class="token punctuation">)</span>。
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">int</span> <span class="token function">kernl_float_test_1</span><span class="token punctuation">(</span><span class="token keyword">int</span> test<span class="token punctuation">,</span><span class="token keyword">int</span> ratio<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    result <span class="token operator">=</span> test<span class="token operator">*</span><span class="token number">2.6</span><span class="token operator">/</span>ratio <span class="token operator">-</span> test<span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
ARM汇编：
    <span class="token number">4084</span><span class="token punctuation">:</span>       <span class="token number">1e620280</span>        scvtf   d0<span class="token punctuation">,</span> w20 <span class="token comment">//将寄存器w20中的定点数转化为浮点数，存储在浮点寄存器d0中</span>
    <span class="token number">4088</span><span class="token punctuation">:</span>       fd400101        ldr     d1<span class="token punctuation">,</span> <span class="token punctuation">[</span>x8<span class="token punctuation">]</span> <span class="token comment">//浮点乘. dx为浮点寄存器，长度64(double)</span>
    <span class="token number">408</span>c<span class="token punctuation">:</span>       <span class="token number">529999</span>a8        mov     w8<span class="token punctuation">,</span> #<span class="token number">0xcccd</span>                     <span class="token comment">// #52429</span>
    <span class="token number">4090</span><span class="token punctuation">:</span>       <span class="token number">72</span>b99988        movk    w8<span class="token punctuation">,</span> #<span class="token number">0xcccc</span><span class="token punctuation">,</span> lsl #<span class="token number">16</span>
    <span class="token number">4094</span><span class="token punctuation">:</span>       <span class="token number">9</span>ba87e88        umull   x8<span class="token punctuation">,</span> w20<span class="token punctuation">,</span> w8
    <span class="token number">4098</span><span class="token punctuation">:</span>       <span class="token number">1e610800</span>        fmul    d0<span class="token punctuation">,</span> d0<span class="token punctuation">,</span> d1 
    <span class="token number">409</span>c<span class="token punctuation">:</span>       <span class="token number">1e620301</span>        scvtf   d1<span class="token punctuation">,</span> w24
    <span class="token number">40</span>a0<span class="token punctuation">:</span>       d364fd08        lsr     x8<span class="token punctuation">,</span> x8<span class="token punctuation">,</span> #<span class="token number">36</span>
    <span class="token number">40</span>a4<span class="token punctuation">:</span>       <span class="token number">1e611800</span>        fdiv    d0<span class="token punctuation">,</span> d0<span class="token punctuation">,</span> d1  <span class="token comment">//浮点除</span>
    <span class="token number">40</span>a8<span class="token punctuation">:</span>       <span class="token number">1e620101</span>        scvtf   d1<span class="token punctuation">,</span> w8
    <span class="token number">40</span>ac<span class="token punctuation">:</span>       <span class="token number">1e613800</span>        fsub    d0<span class="token punctuation">,</span> d0<span class="token punctuation">,</span> d1
    <span class="token number">40</span>b0<span class="token punctuation">:</span>       <span class="token number">1e780014</span>        fcvtzs  w20<span class="token punctuation">,</span> d0    <span class="token comment">//将浮点数转化为定点数</span>
</code></pre>
     </li>
     <li>
      <p>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        -
       </span>
       <br/>
       <span class="token macro property">
        #
        <span class="token directive keyword">
         include
        </span>
        <span class="token string">
         &lt;asm/neon.h&gt;
        </span>
       </span>
       <br/>
       <span class="token keyword">
        int
       </span>
       <span class="token function">
        kernl_float_test_2
       </span>
       <span class="token punctuation">
        (
       </span>
       <span class="token keyword">
        int
       </span>
       test
       <span class="token punctuation">
        ,
       </span>
       <span class="token keyword">
        int
       </span>
       ratio
       <span class="token punctuation">
        )
       </span>
       <span class="token punctuation">
        {
       </span>
       <br/>
       <span class="token keyword">
        int
       </span>
       result
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token keyword">
        if
       </span>
       <span class="token punctuation">
        (
       </span>
       <span class="token operator">
        !
       </span>
       <span class="token function">
        may_use_simd
       </span>
       <span class="token punctuation">
        (
       </span>
       <span class="token punctuation">
        )
       </span>
       <span class="token punctuation">
        )
       </span>
       <span class="token punctuation">
        {
       </span>
       <br/>
       <span class="token comment">
        //判断是否可以使用浮点，如果为判断在执行kernel_neon_begin可能会死机
       </span>
       <br/>
       <span class="token keyword">
        return
       </span>
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token punctuation">
        }
       </span>
       <br/>
       <span class="token function">
        kernel_neon_begin
       </span>
       <span class="token punctuation">
        (
       </span>
       <span class="token punctuation">
        )
       </span>
       <span class="token punctuation">
        ;
       </span>
       <br/>
       result
       <span class="token operator">
        =
       </span>
       test
       <span class="token operator">
        <em>
        </em>
       </span>
       <span class="token number">
        2.6
       </span>
       <span class="token operator">
        /
       </span>
       ratio
       <span class="token operator">
        -
       </span>
       test
       <span class="token operator">
        /
       </span>
       <span class="token number">
        20
       </span>
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token function">
        kernel_neon_end
       </span>
       <span class="token punctuation">
        (
       </span>
       <span class="token punctuation">
        )
       </span>
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token keyword">
        return
       </span>
       result
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token punctuation">
        }
       </span>
       <br/>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <br/>
       Path
       <span class="token punctuation">
        :
       </span>
       arch
       <span class="token operator">
        /
       </span>
       arm64
       <span class="token operator">
        /
       </span>
       kernel
       <span class="token operator">
        /
       </span>
       fpsimd
       <span class="token punctuation">
        .
       </span>
       c
       <br/>
       <span class="token comment">
        /
       </span>
      </p>
      <ul>
       <li>
        kernel_neon_begin(): obtain the CPU FPSIMD registers for use by the calling
       </li>
       <li>
        context
       </li>
       <li>
        Must not be called unless may_use_simd() returns true.
       </li>
       <li>
        Task context in the FPSIMD registers is saved back to memory as necessary.
       </li>
       <li>
        A matching call to kernel_neon_end() must be made before returning from the
       </li>
       <li>
        calling context.
       </li>
       <li>
        The caller may freely use the FPSIMD registers until kernel_neon_end() is
       </li>
       <li>
        called.
        <br/>
        <em>
         /
         <br/>
         <span class="token keyword">
          void
         </span>
         <span class="token function">
          kernel_neon_begin
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token keyword">
          void
         </span>
         <span class="token punctuation">
          )
         </span>
         <br/>
         <span class="token punctuation">
          {
         </span>
         <br/>
         <span class="token keyword">
          if
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token function">
          WARN_ON
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token operator">
          !
         </span>
         <span class="token function">
          system_supports_fpsimd
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token punctuation">
          )
         </span>
         <span class="token punctuation">
          )
         </span>
         <span class="token punctuation">
          )
         </span>
         <br/>
         <span class="token keyword">
          return
         </span>
         <span class="token punctuation">
          ;
         </span>
         <br/>
         <span class="token function">
          BUG_ON
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token operator">
          !
         </span>
         <span class="token function">
          may_use_simd
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token punctuation">
          )
         </span>
         <span class="token punctuation">
          )
         </span>
         <span class="token punctuation">
          ;
         </span>
         <br/>
         <span class="token function">
          get_cpu_fpsimd_context
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token punctuation">
          )
         </span>
         <span class="token punctuation">
          ;
         </span>
         <br/>
         <span class="token comment">
          /
         </span>
        </em>
        Save unsaved fpsimd state, if any:
        <em>
         /
         <br/>
         <span class="token function">
          fpsimd_save
         </span>
         <span class="token punctuation">
          (
         </span>
         <span class="token punctuation">
          )
         </span>
         <span class="token punctuation">
          ;
         </span>
         <br/>
         <span class="token comment">
          /
         </span>
        </em>
        Invalidate any task state remaining in the fpsimd regs: */
        <br/>
        <span class="token function">
         fpsimd_flush_cpu_state
        </span>
        <span class="token punctuation">
         (
        </span>
        <span class="token punctuation">
         )
        </span>
        <span class="token punctuation">
         ;
        </span>
        <br/>
        <span class="token punctuation">
         }
        </span>
        <br/>
        <span class="token function">
         EXPORT_SYMBOL
        </span>
        <span class="token punctuation">
         (
        </span>
        kernel_neon_begin
        <span class="token punctuation">
         )
        </span>
        <span class="token punctuation">
         ;
        </span>
        <br/>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <span class="token operator">
         –
        </span>
        <br/>
        ARM汇编：
        <br/>
        <span class="token number">
         4088
        </span>
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         94000000
        </span>
        bl
        <span class="token number">
         0
        </span>
        <span class="token operator">
         &lt;
        </span>
        kernel_neon_begin
        <span class="token operator">
         &gt;
        </span>
        <br/>
        <span class="token number">
         408
        </span>
        c
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         90000008
        </span>
        adrp x8
        <span class="token punctuation">
         ,
        </span>
        <span class="token number">
         0
        </span>
        <span class="token operator">
         &lt;
        </span>
        <span class="token operator">
         &gt;
        </span>
        <br/>
        <span class="token number">
         4090
        </span>
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e620280
        </span>
        scvtf d0
        <span class="token punctuation">
         ,
        </span>
        w20
        <br/>
        <span class="token number">
         4094
        </span>
        <span class="token punctuation">
         :
        </span>
        fd400101 ldr d1
        <span class="token punctuation">
         ,
        </span>
        <span class="token punctuation">
         [
        </span>
        x8
        <span class="token punctuation">
         ]
        </span>
        <br/>
        <span class="token number">
         4098
        </span>
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         529999
        </span>
        a8 mov w8
        <span class="token punctuation">
         ,
        </span>
        #
        <span class="token number">
         0xcccd
        </span>
        <span class="token comment">
         // #52429
        </span>
        <br/>
        <span class="token number">
         409
        </span>
        c
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         72
        </span>
        b99988 movk w8
        <span class="token punctuation">
         ,
        </span>
        #
        <span class="token number">
         0xcccc
        </span>
        <span class="token punctuation">
         ,
        </span>
        lsl #
        <span class="token number">
         16
        </span>
        <br/>
        <span class="token number">
         40
        </span>
        a0
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         9
        </span>
        ba87e88 umull x8
        <span class="token punctuation">
         ,
        </span>
        w20
        <span class="token punctuation">
         ,
        </span>
        w8
        <br/>
        <span class="token number">
         40
        </span>
        a4
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e610800
        </span>
        fmul d0
        <span class="token punctuation">
         ,
        </span>
        d0
        <span class="token punctuation">
         ,
        </span>
        d1
        <br/>
        <span class="token number">
         40
        </span>
        a8
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e620301
        </span>
        scvtf d1
        <span class="token punctuation">
         ,
        </span>
        w24
        <br/>
        <span class="token number">
         40
        </span>
        ac
        <span class="token punctuation">
         :
        </span>
        d364fd08 lsr x8
        <span class="token punctuation">
         ,
        </span>
        x8
        <span class="token punctuation">
         ,
        </span>
        #
        <span class="token number">
         36
        </span>
        <br/>
        <span class="token number">
         40
        </span>
        b0
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e611800
        </span>
        fdiv d0
        <span class="token punctuation">
         ,
        </span>
        d0
        <span class="token punctuation">
         ,
        </span>
        d1
        <br/>
        <span class="token number">
         40
        </span>
        b4
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e620101
        </span>
        scvtf d1
        <span class="token punctuation">
         ,
        </span>
        w8
        <br/>
        <span class="token number">
         40
        </span>
        b8
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e613800
        </span>
        fsub d0
        <span class="token punctuation">
         ,
        </span>
        d0
        <span class="token punctuation">
         ,
        </span>
        d1
        <br/>
        <span class="token number">
         40
        </span>
        bc
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         1e780014
        </span>
        fcvtzs w20
        <span class="token punctuation">
         ,
        </span>
        d0
        <br/>
        <span class="token number">
         40
        </span>
        c0
        <span class="token punctuation">
         :
        </span>
        <span class="token number">
         94000000
        </span>
        bl
        <span class="token number">
         0
        </span>
        <span class="token operator">
         &lt;
        </span>
        kernel_neon_end
        <span class="token operator">
         &gt;
        </span>
       </li>
      </ul>
      <p>
       <span class="token number">
        0000000000001580
       </span>
       <span class="token operator">
        &lt;
       </span>
       kernel_neon_begin
       <span class="token operator">
        &gt;
       </span>
       <span class="token punctuation">
        :
       </span>
       <br/>
       <span class="token number">
        1580
       </span>
       <span class="token punctuation">
        :
       </span>
       f81d0ff5 str x21
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       sp
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token operator">
        -
       </span>
       <span class="token number">
        48
       </span>
       <span class="token punctuation">
        ]
       </span>
       <span class="token operator">
        !
       </span>
       <br/>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <br/>
       <span class="token number">
        15
       </span>
       d4
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        37
       </span>
       a00628 tbnz w8
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        20
       </span>
       <span class="token punctuation">
        ,
       </span>
       <span class="token number">
        1698
       </span>
       <span class="token operator">
        &lt;
       </span>
       kernel_neon_begin
       <span class="token operator">
        +
       </span>
       <span class="token number">
        0x118
       </span>
       <span class="token operator">
        &gt;
       </span>
       <br/>
       <span class="token number">
        15
       </span>
       d8
       <span class="token punctuation">
        :
       </span>
       b9404a68 ldr w8
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x19
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        72
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        15
       </span>
       dc
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        90000014
       </span>
       adrp x20
       <span class="token punctuation">
        ,
       </span>
       <span class="token number">
        8
       </span>
       <span class="token operator">
        &lt;
       </span>
       fpsimd_save
       <span class="token operator">
        +
       </span>
       <span class="token number">
        0x8
       </span>
       <span class="token operator">
        &gt;
       </span>
      </p>
      <p>
       <span class="token number">
        0000000000000000
       </span>
       <span class="token operator">
        &lt;
       </span>
       fpsimd_save
       <span class="token operator">
        &gt;
       </span>
       <span class="token punctuation">
        :
       </span>
       <br/>
       <span class="token number">
        0
       </span>
       <span class="token punctuation">
        :
       </span>
       a9be4ff4 stp x20
       <span class="token punctuation">
        ,
       </span>
       x19
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       sp
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token operator">
        -
       </span>
       <span class="token number">
        32
       </span>
       <span class="token punctuation">
        ]
       </span>
       <span class="token operator">
        !
       </span>
       <br/>
       <span class="token number">
        4
       </span>
       <span class="token punctuation">
        :
       </span>
       a9017bfd stp x29
       <span class="token punctuation">
        ,
       </span>
       x30
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       sp
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        16
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <span class="token punctuation">
        .
       </span>
       <br/>
       <span class="token number">
        68
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        37
       </span>
       b80088 tbnz w8
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        23
       </span>
       <span class="token punctuation">
        ,
       </span>
       <span class="token number">
        78
       </span>
       <span class="token operator">
        &lt;
       </span>
       fpsimd_save
       <span class="token operator">
        +
       </span>
       <span class="token number">
        0x78
       </span>
       <span class="token operator">
        &gt;
       </span>
       <br/>
       <span class="token number">
        6
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       aa1303e0 mov x0
       <span class="token punctuation">
        ,
       </span>
       x19
       <br/>
       <span class="token number">
        70
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        94000000
       </span>
       bl
       <span class="token number">
        0
       </span>
       <span class="token operator">
        &lt;
       </span>
       fpsimd_save_state
       <span class="token operator">
        &gt;
       </span>
      </p>
      <p>
       <span class="token number">
        0000000000000000
       </span>
       <span class="token operator">
        &lt;
       </span>
       fpsimd_save_state
       <span class="token operator">
        &gt;
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token comment">
        //这里就保存了浮点寄存器状态到X0
       </span>
       <br/>
       <span class="token number">
        0
       </span>
       <span class="token punctuation">
        :
       </span>
       ad000400 stp q0
       <span class="token punctuation">
        ,
       </span>
       q1
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        4
       </span>
       <span class="token punctuation">
        :
       </span>
       ad010c02 stp q2
       <span class="token punctuation">
        ,
       </span>
       q3
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        32
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        8
       </span>
       <span class="token punctuation">
        :
       </span>
       ad021404 stp q4
       <span class="token punctuation">
        ,
       </span>
       q5
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        64
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       c
       <span class="token punctuation">
        :
       </span>
       ad031c06 stp q6
       <span class="token punctuation">
        ,
       </span>
       q7
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        96
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        10
       </span>
       <span class="token punctuation">
        :
       </span>
       ad042408 stp q8
       <span class="token punctuation">
        ,
       </span>
       q9
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        128
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        14
       </span>
       <span class="token punctuation">
        :
       </span>
       ad052c0a stp q10
       <span class="token punctuation">
        ,
       </span>
       q11
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        160
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        18
       </span>
       <span class="token punctuation">
        :
       </span>
       ad06340c stp q12
       <span class="token punctuation">
        ,
       </span>
       q13
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        192
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        1
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       ad073c0e stp q14
       <span class="token punctuation">
        ,
       </span>
       q15
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        224
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        20
       </span>
       <span class="token punctuation">
        :
       </span>
       ad084410 stp q16
       <span class="token punctuation">
        ,
       </span>
       q17
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        256
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        24
       </span>
       <span class="token punctuation">
        :
       </span>
       ad094c12 stp q18
       <span class="token punctuation">
        ,
       </span>
       q19
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        288
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        28
       </span>
       <span class="token punctuation">
        :
       </span>
       ad0a5414 stp q20
       <span class="token punctuation">
        ,
       </span>
       q21
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        320
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        2
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       ad0b5c16 stp q22
       <span class="token punctuation">
        ,
       </span>
       q23
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        352
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        30
       </span>
       <span class="token punctuation">
        :
       </span>
       ad0c6418 stp q24
       <span class="token punctuation">
        ,
       </span>
       q25
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        384
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        34
       </span>
       <span class="token punctuation">
        :
       </span>
       ad0d6c1a stp q26
       <span class="token punctuation">
        ,
       </span>
       q27
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        416
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        38
       </span>
       <span class="token punctuation">
        :
       </span>
       ad0e741c stp q28
       <span class="token punctuation">
        ,
       </span>
       q29
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        448
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        3
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       ad8f7c1e stp q30
       <span class="token punctuation">
        ,
       </span>
       q31
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        480
       </span>
       <span class="token punctuation">
        ]
       </span>
       <span class="token operator">
        !
       </span>
       <br/>
       <span class="token number">
        40
       </span>
       <span class="token punctuation">
        :
       </span>
       d53b4428 mrs x8
       <span class="token punctuation">
        ,
       </span>
       fpsr
       <br/>
       <span class="token number">
        44
       </span>
       <span class="token punctuation">
        :
       </span>
       b9002008 str w8
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        32
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        48
       </span>
       <span class="token punctuation">
        :
       </span>
       d53b4408 mrs x8
       <span class="token punctuation">
        ,
       </span>
       fpcr
       <br/>
       <span class="token number">
        4
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       b9002408 str w8
       <span class="token punctuation">
        ,
       </span>
       <span class="token punctuation">
        [
       </span>
       x0
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        36
       </span>
       <span class="token punctuation">
        ]
       </span>
       <br/>
       <span class="token number">
        50
       </span>
       <span class="token punctuation">
        :
       </span>
       d65f03c0 ret
      </p>
      <p>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        -
       </span>
       <br/>
       <span class="token keyword">
        int
       </span>
       <span class="token function">
        kernl_float_test_3
       </span>
       <span class="token punctuation">
        (
       </span>
       <span class="token keyword">
        int
       </span>
       test
       <span class="token punctuation">
        ,
       </span>
       <span class="token keyword">
        int
       </span>
       ratio
       <span class="token punctuation">
        )
       </span>
       <span class="token punctuation">
        {
       </span>
       <br/>
       <span class="token keyword">
        int
       </span>
       result
       <span class="token punctuation">
        ;
       </span>
       <br/>
       result
       <span class="token operator">
        =
       </span>
       <span class="token punctuation">
        (
       </span>
       test
       <span class="token operator">
        <em>
        </em>
       </span>
       <span class="token number">
        26
       </span>
       <span class="token punctuation">
        )
       </span>
       <span class="token operator">
        /
       </span>
       <span class="token punctuation">
        (
       </span>
       ratio
       <span class="token operator">
       </span>
       <span class="token number">
        10
       </span>
       <span class="token punctuation">
        )
       </span>
       <span class="token operator">
        -
       </span>
       test
       <span class="token operator">
        /
       </span>
       <span class="token number">
        20
       </span>
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token keyword">
        return
       </span>
       result
       <span class="token punctuation">
        ;
       </span>
       <br/>
       <span class="token punctuation">
        }
       </span>
       <br/>
       ARM汇编：
       <br/>
       <span class="token number">
        4084
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        529999
       </span>
       a9 mov w9
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        0xcccd
       </span>
       <span class="token comment">
        // #52429
       </span>
       <br/>
       <span class="token number">
        4088
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        72
       </span>
       b99989 movk w9
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        0xcccc
       </span>
       <span class="token punctuation">
        ,
       </span>
       lsl #
       <span class="token number">
        16
       </span>
       <br/>
       <span class="token number">
        408
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        1
       </span>
       b087e88 mul w8
       <span class="token punctuation">
        ,
       </span>
       w20
       <span class="token punctuation">
        ,
       </span>
       w8
       <br/>
       <span class="token number">
        4090
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        0
       </span>
       b180b0a add w10
       <span class="token punctuation">
        ,
       </span>
       w24
       <span class="token punctuation">
        ,
       </span>
       w24
       <span class="token punctuation">
        ,
       </span>
       lsl #
       <span class="token number">
        2
       </span>
       <br/>
       <span class="token number">
        4094
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        9
       </span>
       ba97e89 umull x9
       <span class="token punctuation">
        ,
       </span>
       w20
       <span class="token punctuation">
        ,
       </span>
       w9
       <br/>
       <span class="token number">
        4098
       </span>
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        531f
       </span>
       <span class="token number">
        794
       </span>
       a lsl w10
       <span class="token punctuation">
        ,
       </span>
       w10
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        1
       </span>
       <br/>
       <span class="token number">
        409
       </span>
       c
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        1
       </span>
       aca0908 udiv w8
       <span class="token punctuation">
        ,
       </span>
       w8
       <span class="token punctuation">
        ,
       </span>
       w10
       <br/>
       <span class="token number">
        40
       </span>
       a0
       <span class="token punctuation">
        :
       </span>
       d364fd29 lsr x9
       <span class="token punctuation">
        ,
       </span>
       x9
       <span class="token punctuation">
        ,
       </span>
       #
       <span class="token number">
        36
       </span>
       <br/>
       <span class="token number">
        40
       </span>
       a4
       <span class="token punctuation">
        :
       </span>
       <span class="token number">
        4
       </span>
       b090114 sub w20
       <span class="token punctuation">
        ,
       </span>
       w8
       <span class="token punctuation">
        ,
       </span>
       w9
       <br/>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
       <span class="token operator">
        –
       </span>
      </p>
      <div class="hljs-button {2}">
      </div>
      <ul class="pre-numbering">
       <li>
        1
       </li>
       <li>
        2
       </li>
       <li>
        3
       </li>
       <li>
        4
       </li>
       <li>
        5
       </li>
       <li>
        6
       </li>
       <li>
        7
       </li>
       <li>
        8
       </li>
       <li>
        9
       </li>
       <li>
        10
       </li>
       <li>
        11
       </li>
       <li>
        12
       </li>
       <li>
        13
       </li>
       <li>
        14
       </li>
       <li>
        15
       </li>
       <li>
        16
       </li>
       <li>
        17
       </li>
       <li>
        18
       </li>
       <li>
        19
       </li>
       <li>
        20
       </li>
       <li>
        21
       </li>
       <li>
        22
       </li>
       <li>
        23
       </li>
       <li>
        24
       </li>
       <li>
        25
       </li>
       <li>
        26
       </li>
       <li>
        27
       </li>
       <li>
        28
       </li>
       <li>
        29
       </li>
       <li>
        30
       </li>
       <li>
        31
       </li>
       <li>
        32
       </li>
       <li>
        33
       </li>
       <li>
        34
       </li>
       <li>
        35
       </li>
       <li>
        36
       </li>
       <li>
        37
       </li>
       <li>
        38
       </li>
       <li>
        39
       </li>
       <li>
        40
       </li>
       <li>
        41
       </li>
       <li>
        42
       </li>
       <li>
        43
       </li>
       <li>
        44
       </li>
       <li>
        45
       </li>
       <li>
        46
       </li>
       <li>
        47
       </li>
       <li>
        48
       </li>
       <li>
        49
       </li>
       <li>
        50
       </li>
       <li>
        51
       </li>
       <li>
        52
       </li>
       <li>
        53
       </li>
       <li>
        54
       </li>
       <li>
        55
       </li>
       <li>
        56
       </li>
       <li>
        57
       </li>
       <li>
        58
       </li>
       <li>
        59
       </li>
       <li>
        60
       </li>
       <li>
        61
       </li>
       <li>
        62
       </li>
       <li>
        63
       </li>
       <li>
        64
       </li>
       <li>
        65
       </li>
       <li>
        66
       </li>
       <li>
        67
       </li>
       <li>
        68
       </li>
       <li>
        69
       </li>
       <li>
        70
       </li>
       <li>
        71
       </li>
       <li>
        72
       </li>
       <li>
        73
       </li>
       <li>
        74
       </li>
       <li>
        75
       </li>
       <li>
        76
       </li>
       <li>
        77
       </li>
       <li>
        78
       </li>
       <li>
        79
       </li>
       <li>
        80
       </li>
       <li>
        81
       </li>
       <li>
        82
       </li>
       <li>
        83
       </li>
       <li>
        84
       </li>
       <li>
        85
       </li>
       <li>
        86
       </li>
       <li>
        87
       </li>
       <li>
        88
       </li>
       <li>
        89
       </li>
       <li>
        90
       </li>
       <li>
        91
       </li>
       <li>
        92
       </li>
       <li>
        93
       </li>
       <li>
        94
       </li>
       <li>
        95
       </li>
       <li>
        96
       </li>
       <li>
        97
       </li>
       <li>
        98
       </li>
       <li>
        99
       </li>
       <li>
        100
       </li>
       <li>
        101
       </li>
       <li>
        102
       </li>
       <li>
        103
       </li>
       <li>
        104
       </li>
       <li>
        105
       </li>
       <li>
        106
       </li>
       <li>
        107
       </li>
       <li>
        108
       </li>
       <li>
        109
       </li>
       <li>
        110
       </li>
       <li>
        111
       </li>
       <li>
        112
       </li>
       <li>
        113
       </li>
       <li>
        114
       </li>
       <li>
        115
       </li>
       <li>
        116
       </li>
       <li>
        117
       </li>
       <li>
        118
       </li>
       <li>
        119
       </li>
       <li>
        120
       </li>
       <li>
        121
       </li>
       <li>
        122
       </li>
       <li>
        123
       </li>
       <li>
        124
       </li>
       <li>
        125
       </li>
       <li>
        126
       </li>
       <li>
        127
       </li>
       <li>
        128
       </li>
       <li>
        129
       </li>
       <li>
        130
       </li>
       <li>
        131
       </li>
       <li>
        132
       </li>
       <li>
        133
       </li>
       <li>
        134
       </li>
      </ul>
      <p>
       上面三段计算代码，其结果是相同的，但是在用户空间和内核空间的执行产生效果可能不同，执行效率不同：
      </p>
      <ol>
       <li>
        kernl_float_test_1 在用户空间和内核空间都可以编译通过，在用户空间使用没有任何问题，但是在内核虽然可以编译通过，但使用时可能会破坏用户空间的浮点寄存器的状态
       </li>
       <li>
        kernl_float_test_2
        <strong>
         内核使用浮点，必须按照这种方式使用
        </strong>
        ，浮点计算安全，但是效率不高，可以看到汇编代码需要执行对浮点寄存器进行保存，相比较于保存恢复浮点寄存器状态开销，使用浮点运算有点不划算。
       </li>
       <li>
        kernl_float_test_3 内核和用户空间使用都没有问题，把浮点转化为整型计算，执行效率高于前两种
       </li>
      </ol>
     </li>
     <li>
      <p>
       在什么情况下适合启用内核Neon/VFP
      </p>
      <p>
       由前面可以了解到Neon是SIMD (Single Instruction Multiple Data) ， 支持单指令多数据操作。也就是说不仅仅是浮点运算可以使用Neon，当你使用大量连续计算时，可以使用Neon对算法加速。其实内核中的加密算法基本都是了Neon加速，如sha1、sha2…sha512、aes、chacha20等。加密源码在 arch/arm64/crypto/
      </p>
     </li>
     <li>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ad53aee70b4a0de9f2d7d14e0bc8e0f8.png"/>
      </p>
      <p>
       参考文章：
      </p>
      <p>
       <a href="https://blog.csdn.net/gujintong1110/article/details/23038217">
        ARM 浮点运算，软浮点，硬浮点
       </a>
      </p>
      <p>
       <a href="https://stackoverflow.com/questions/4097034/arm-cortex-a8-whats-the-difference-between-vfp-and-neon" rel="nofollow">
        ARM Cortex-A8: Whats the difference between VFP and NEON
       </a>
      </p>
      <p>
       <a href="https://www.veryarm.com/872.html" rel="nofollow">
        armel、armhf和arm64区别选择
       </a>
      </p>
      <p>
       <a href="https://www.jianshu.com/p/2f4a5f74ac7a" rel="nofollow">
        ARM64 汇编——寄存器和指令
       </a>
      </p>
      <p>
       <a href="https://winddoing.github.io/post/7190.html" rel="nofollow">
        ARMv8-aarch64寄存器和指令集
       </a>
      </p>
      <p>
       <a href="http://www.wowotech.net/process_management/context-switch-arch.html" rel="nofollow">
        进程切换分析(1)：基本框架
       </a>
      </p>
      <p>
       <a href="https://www.cnblogs.com/liuwanpeng/p/7833000.html" rel="nofollow">
        linux kernel态下使用NEON对算法进行加速
       </a>
      </p>
      <div>
       <div>
       </div>
      </div>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f736473737a6b2f:61727469636c652f64657461696c732f313038363830383232" class_="artid" style="display:none">
 </p>
</div>


