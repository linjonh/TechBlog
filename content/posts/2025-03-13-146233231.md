---
layout: post
title: "nginx匹配规则"
date: 2025-03-13 15:46:53 +0800
description: "当一个请求进来时，Nginx 按如下顺序匹配。在 Nginx 中，一个请求的匹配规则遵循。Nginx 配置中，"
keywords: "nginx匹配规则"
categories: ['Nginx']
tags: ['前端', 'Nginx', 'Javascript']
artid: "146233231"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146233231
    alt: "nginx匹配规则"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146233231
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146233231
cover: https://bing.ee123.net/img/rand?artid=146233231
image: https://bing.ee123.net/img/rand?artid=146233231
img: https://bing.ee123.net/img/rand?artid=146233231
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     nginx匹配规则
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 Nginx 中，一个请求的匹配规则遵循
     <strong>
      “最佳匹配优先”
     </strong>
     原则，即
     <strong>
      匹配度最高的规则生效
     </strong>
     ，匹配顺序如下：
    </p>
    <hr/>
    <h3>
     <a id="1__4">
     </a>
     <strong>
      1. 关键匹配类型
     </strong>
    </h3>
    <p>
     Nginx 配置中，
     <code>
      location
     </code>
     有不同的匹配方式，匹配优先级如下（从高到低）：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        优先级
       </th>
       <th>
        匹配类型
       </th>
       <th>
        例子
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         1
        </strong>
       </td>
       <td>
        <code>
         =
        </code>
        精确匹配
       </td>
       <td>
        <code>
         location = /login {}
        </code>
       </td>
       <td>
        <strong>
         完全匹配
        </strong>
        ，如果匹配成功，则立即使用该规则，不再继续匹配。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         2
        </strong>
       </td>
       <td>
        <code>
         ^~
        </code>
        前缀匹配（优先）
       </td>
       <td>
        <code>
         location ^~ /static/ {}
        </code>
       </td>
       <td>
        <strong>
         如果匹配，直接使用，不再检查正则匹配
        </strong>
        。适用于静态资源。
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         3
        </strong>
       </td>
       <td>
        <code>
         ~
        </code>
        正则匹配（区分大小写）
       </td>
       <td>
        `location ~ .(png
       </td>
       <td>
        jpg)$ {}`
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         4
        </strong>
       </td>
       <td>
        <code>
         ~*
        </code>
        正则匹配（不区分大小写）
       </td>
       <td>
        `location ~* .(png
       </td>
       <td>
        jpg)$ {}`
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         5
        </strong>
       </td>
       <td>
        <code>
         /
        </code>
        前缀匹配（默认）
       </td>
       <td>
        <code>
         location / {}
        </code>
       </td>
       <td>
        <strong>
         最普通的前缀匹配
        </strong>
        ，如果没有更高优先级的规则匹配，就使用这个。
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="2__17">
     </a>
     <strong>
      2. 匹配规则的执行流程
     </strong>
    </h3>
    <p>
     当一个请求进来时，Nginx 按如下顺序匹配
     <code>
      location
     </code>
     ：
    </p>
    <ol>
     <li>
      <strong>
       先检查
       <code>
        =
       </code>
       精确匹配
      </strong>
      ，如果匹配，立即使用该规则，停止搜索。
     </li>
     <li>
      <strong>
       然后检查
       <code>
        ^~
       </code>
      </strong>
      ，如果匹配，立即使用该规则，停止搜索。
     </li>
     <li>
      <strong>
       接着检查所有
       <code>
        ~
       </code>
       和
       <code>
        ~*
       </code>
       的正则匹配
      </strong>
      ，如果多个正则匹配上了，选择
      <strong>
       最长的匹配规则
      </strong>
      。
     </li>
     <li>
      <strong>
       最后检查普通的
       <code>
        /
       </code>
       前缀匹配
      </strong>
      ，如果没有其他匹配，就使用
      <strong>
       最长的前缀匹配
      </strong>
      。
     </li>
     <li>
      <strong>
       如果都没有匹配，则使用默认的
       <code>
        location /
       </code>
       规则
      </strong>
      。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="3__27">
     </a>
     <strong>
      3. 具体示例
     </strong>
    </h3>
    <p>
     假设有以下
     <code>
      location
     </code>
     规则：
    </p>
    <pre><code class="prism language-nginx">server {
    listen 80;

    location = /exact {
        return 200 "精确匹配 /exact\n";
    }

    location ^~ /static/ {
        return 200 "匹配 /static/ 及其子路径\n";
    }

    location ~ \.(jpg|png|gif)$ {
        return 200 "匹配图片后缀\n";
    }

    location /blog {
        return 200 "匹配 /blog 及其子路径\n";
    }

    location / {
        return 200 "默认匹配\n";
    }
}
</code></pre>
    <hr/>
    <h3>
     <a id="4__57">
     </a>
     <strong>
      4. 请求匹配示例
     </strong>
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        请求 URL
       </th>
       <th>
        匹配的
        <code>
         location
        </code>
       </th>
       <th>
        解释
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         /exact
        </code>
       </td>
       <td>
        <code>
         location = /exact
        </code>
       </td>
       <td>
        <strong>
         精确匹配
        </strong>
        ，直接使用此规则。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         /static/js/app.js
        </code>
       </td>
       <td>
        <code>
         location ^~ /static/
        </code>
       </td>
       <td>
        <code>
         ^~
        </code>
        优先级高，匹配后直接使用，不再检查正则规则。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         /images/photo.jpg
        </code>
       </td>
       <td>
        `location ~ .(jpg
       </td>
       <td>
        png
       </td>
      </tr>
      <tr>
       <td>
        <code>
         /blog/article
        </code>
       </td>
       <td>
        <code>
         location /blog
        </code>
       </td>
       <td>
        <strong>
         前缀匹配
        </strong>
        <code>
         /blog
        </code>
        ，最长匹配优先。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         /somethingelse
        </code>
       </td>
       <td>
        <code>
         location /
        </code>
       </td>
       <td>
        <strong>
         默认匹配
        </strong>
        ，因为没有其他匹配规则适用。
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="5__68">
     </a>
     <strong>
      5. 重点总结
     </strong>
    </h3>
    <ol>
     <li>
      <strong>
       精确匹配 (
       <code>
        =
       </code>
       ) 优先级最高
      </strong>
      ，匹配成功就直接使用，不再检查其他规则。
     </li>
     <li>
      <strong>
       <code>
        ^~
       </code>
       规则比正则高
      </strong>
      ，如果匹配
      <code>
       ^~
      </code>
      ，直接使用，不再检查正则。
     </li>
     <li>
      <strong>
       多个正则 (
       <code>
        ~
       </code>
       或
       <code>
        ~*
       </code>
       ) 匹配时，选择最长的匹配规则
      </strong>
      。
     </li>
     <li>
      <strong>
       普通前缀匹配 (
       <code>
        /blog
       </code>
       这种) 选择最长匹配的路径
      </strong>
      。
     </li>
     <li>
      <strong>
       如果都匹配不上，默认使用
       <code>
        location /
       </code>
      </strong>
      。
     </li>
    </ol>
    <p>
     🚀
     <strong>
      这个机制可以帮助你优化 Nginx 规则，减少不必要的匹配计算，提高性能！
     </strong>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4c656f6e4e6f31312f:61727469636c652f64657461696c732f313436323333323331" class_="artid" style="display:none">
 </p>
</div>


