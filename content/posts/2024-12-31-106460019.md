---
layout: post
title: "根据后台返回路由表配置前端菜单"
date: 2024-12-31 10:28:26 +0800
description: "前言本以为这个功能我2天就能做好，结果本大爷在公司都做了3天，再加上问我们领导和自己研究，花了四天时"
keywords: "后端返回menucode匹配前端路由"
categories: ['Vuex']
tags: ['Vue']
artid: "106460019"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=106460019
    alt: "根据后台返回路由表配置前端菜单"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=106460019
featuredImagePreview: https://bing.ee123.net/img/rand?artid=106460019
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     根据后台返回路由表配置前端菜单
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h5>
     <a id="_0">
     </a>
     前言
    </h5>
    <p>
     本以为这个功能我2天就能做好，结果本大爷在公司都做了3天，再加上问我们领导和自己研究，花了四天时间。实际上这个不难，但是有很多细节要注意的，但是我们后台因为是其他项目的后台，他们之前前端用的不是vue-cli，所以返回的路由表数据并不是完整的路由表数据，但是跟我们前端还有一个key是匹配的，有这个key来连通后台数据和前端已有的路由表，就可以筛选出每个用户的权限。
     <br/>
     理是这么个理，但是处理起来好多问题。
    </p>
    <h5>
     <a id="_4">
     </a>
     上代码
    </h5>
    <h6>
     <a id="apiuserjs_5">
     </a>
     api/user.js----获取权限的接口
    </h6>
    <pre><code class="prism language-javascript"><span class="token comment">/** *
 * 获取菜单
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getAsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token punctuation">:</span> <span class="token string">'/auth/resource/menuPer?resPlate=3'</span><span class="token punctuation">,</span>
    method<span class="token punctuation">:</span> <span class="token string">'get'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="routerindexjs404_18">
     </a>
     router/index.js-----前端配置路由，404的页面一定要在最后
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span>

<span class="token comment">/* Layout */</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/layout'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> constantRoutes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/login/index.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    hidden<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/404'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/404'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    hidden<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>


  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    redirect<span class="token punctuation">:</span> <span class="token string">'/monitor'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>


  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/monitor'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> Layout<span class="token punctuation">,</span>
    redirect<span class="token punctuation">:</span> <span class="token string">'/monitor/traffic-monitor'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Monitor'</span><span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'实时监测'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'shishijiance'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'traffic-monitor'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'TrafficMonitor'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/trafficmonitor/TrafficMonitor.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'事件监控'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'monitor'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'running-monitor'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'RunningMonitor'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/trafficmonitor/RunningMonitor.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'运行监测'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'yunxingjianche'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'video-monitor'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'VideoMonitor'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/videomonitor/VideoMonitor.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'视频监测'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'shipinjianche'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/nested'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> Layout<span class="token punctuation">,</span>
    redirect<span class="token punctuation">:</span> <span class="token string">'/nested/menu1'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Nested'</span><span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'指挥调度'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'command'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'menu2'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'Menu2'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu2/EventWarning.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'事件研判'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'shijianyujin'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'menu1'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'Menu1'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/index.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'事件处理'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'emergency-plan'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'EmergencyPlan'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/Nested.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'应急预案'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'yuan'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'plan'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Plan'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/Plan'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'预案管理'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'process'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Process'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/Process'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'流程管理'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'liuchen'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'emergency-resource'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'EmergencyResource'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/Nested.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'应急资源'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'resource'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'risk'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Risk'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/Risk'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'风险源管理'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'team'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Team'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/EmergencyTeam'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'应急队伍'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'vehicle'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Vehicle'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/EmergencyVehicles'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'应急车辆'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'professor'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Professor'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/EmergencyExperts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'应急专家'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">:</span> <span class="token string">'supply'</span><span class="token punctuation">,</span>
            name<span class="token punctuation">:</span> <span class="token string">'Supply'</span><span class="token punctuation">,</span>
            component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/baseInfo/EmergencySupply'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'应急物资'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/equipment'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> Layout<span class="token punctuation">,</span>
    redirect<span class="token punctuation">:</span> <span class="token string">'/equipment/weighing'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Equipment'</span><span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'设备管理'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'devicemange'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'Radio'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/equipment/Weighing.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'广播管理'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'table'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/statistic'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> Layout<span class="token punctuation">,</span>
    redirect<span class="token punctuation">:</span> <span class="token string">'/statistic/analyse'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Statistic'</span><span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'统计分析'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'tongji'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'analyse'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'Analyse'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/statistic/Statistic.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'统计分析'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'tongji'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    path<span class="token punctuation">:</span> <span class="token string">'/visual-model'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> Layout<span class="token punctuation">,</span>
    redirect<span class="token punctuation">:</span> <span class="token string">'/visual-model/bim'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'VisualModel'</span><span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'可视化模型'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'bim'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">:</span> <span class="token string">'bim'</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">'Bim'</span><span class="token punctuation">,</span>
        component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/bim/BimIndex.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        meta<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token punctuation">:</span> <span class="token string">'三维可视化'</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token string">'bim'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 404 page must be placed at the end !!!</span>
  <span class="token punctuation">{<!-- --></span> path<span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> redirect<span class="token punctuation">:</span> <span class="token string">'/404'</span><span class="token punctuation">,</span> hidden<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// filterRoute() // 根据用户权限筛选出路由表</span>

<span class="token comment">// 生产环境不显示</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  constantRoutes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span>em<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> flag <span class="token operator">=</span> em<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> em<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>hiddenInProd <span class="token operator">===</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      constantRoutes<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> flag
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createRouter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// mode: 'history', // require service support</span>
    scrollBehavior<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    routes<span class="token punctuation">:</span> constantRoutes
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Detail see: https://github.com/vuejs/vue-router/issues/1234#issuecomment-357941465</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resetRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> newRouter <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  router<span class="token punctuation">.</span>matcher <span class="token operator">=</span> newRouter<span class="token punctuation">.</span>matcher <span class="token comment">// reset router</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router

</code></pre>
    <h6>
     <a id="permissonjs_237">
     </a>
     permisson.js----处理后台返回来的路由
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> NProgress <span class="token keyword">from</span> <span class="token string">'nprogress'</span> <span class="token comment">// progress bar</span>
<span class="token keyword">import</span> <span class="token string">'nprogress/nprogress.css'</span> <span class="token comment">// progress bar style</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span> <span class="token comment">// get token from cookie</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getAsyncRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user'</span>

<span class="token keyword">import</span> getPageTitle <span class="token keyword">from</span> <span class="token string">'@/utils/get-page-title'</span>

NProgress<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> showSpinner<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// NProgress Configuration</span>

<span class="token keyword">const</span> whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">]</span> <span class="token comment">// no redirect whitelist</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// start progress bar</span>
  NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// set page title</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token function">getPageTitle</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

  <span class="token comment">// determine whether the user has logged in</span>
  <span class="token keyword">const</span> hasToken <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasToken<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// if is logged in, redirect to the home page</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> path<span class="token punctuation">:</span> <span class="token string">'/'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> hasGetUserInfo <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>name
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasGetUserInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// get user info</span>
          <span class="token comment">// await store.dispatch('user/getInfo')</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// remove token and go to login page to re-login</span>
          <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/resetToken'</span><span class="token punctuation">)</span>
          Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error <span class="token operator">||</span> <span class="token string">'Has Error'</span><span class="token punctuation">)</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/login?redirect=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>to<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
          NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> router<span class="token punctuation">.</span>options<span class="token punctuation">.</span>routes
    <span class="token function">filterRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* has no token*/</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>whiteList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// in the free login whitelist, go directly</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// other pages that do not have permission to access are redirected to the login page.</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/login?redirect=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>to<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
      NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 筛选出用户权限</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">filterRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> resPermissions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> asyncRouter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 刷新时重新请求</span>
  <span class="token keyword">await</span> <span class="token function">getAsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> res
    asyncRouter <span class="token operator">=</span> data
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">fetchName</span><span class="token punctuation">(</span>asyncRouter<span class="token punctuation">)</span>
  <span class="token function">setHidden</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
  <span class="token comment">// 取出用户权限</span>
  <span class="token keyword">function</span> <span class="token function">fetchName</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      resPermissions<span class="token punctuation">[</span>v<span class="token punctuation">.</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>childNode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fetchName</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>childNode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">return</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置需要隐藏的菜单</span>
  <span class="token keyword">function</span> <span class="token function">setHidden</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 没有name，默认的不处理</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        item<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token operator">!</span>resPermissions<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">true</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>hidden<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果一级已经是hidden,则无需进行后面的循环判断</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果有子集，则进行递归</span>
          <span class="token function">setHidden</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// finish progress bar</span>
  NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
    <h6>
     <a id="loginvuevuexAction_347">
     </a>
     login.vue----因为我领导叫我将返回的路由数据存在vuex中，所以登陆时我触发了一个Action
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token punctuation">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// const validatePassword = (rule, value, callback) =&gt; {<!-- --></span>
    <span class="token comment">//   if (value.length &lt; 6) {<!-- --></span>
    <span class="token comment">//     callback(new Error('The password can not be less than 6 digits'))</span>
    <span class="token comment">//   } else {<!-- --></span>
    <span class="token comment">//     callback()</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      loginForm<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        account<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        captcha<span class="token punctuation">:</span> <span class="token string">'12345'</span><span class="token punctuation">,</span>
        loginSource<span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loginRules<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        account<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
          required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          trigger<span class="token punctuation">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          message<span class="token punctuation">:</span> <span class="token string">'请输入登录账号'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
          type<span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
          min<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          max<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          message<span class="token punctuation">:</span> <span class="token string">'登录账号长度在 2 到 30 个字符之间'</span><span class="token punctuation">,</span>
          trigger<span class="token punctuation">:</span> <span class="token string">'blur'</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
          required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          trigger<span class="token punctuation">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          message<span class="token punctuation">:</span> <span class="token string">'请输入密码'</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      passwordType<span class="token punctuation">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span>
      redirect<span class="token punctuation">:</span> undefined
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    $route<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      handler<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>redirect <span class="token operator">=</span> route<span class="token punctuation">.</span>query <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirect
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      immediate<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">showPwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>passwordType <span class="token operator">===</span> <span class="token string">'password'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>passwordType <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>passwordType <span class="token operator">=</span> <span class="token string">'password'</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handleLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>valid <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/login'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              path<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redirect <span class="token operator">||</span> <span class="token string">'/'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getAsyncRouter'</span><span class="token punctuation">)</span> <span class="token comment">// 获取用户权限并存储在vuex中</span>

            <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// console.log('error submit!!')</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h6>
     <a id="storemodulesuserjsvuex_436">
     </a>
     store/modules/user.js----存储用户相关数据的vuex
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> login<span class="token punctuation">,</span> getInfo<span class="token punctuation">,</span> getAsyncRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getToken<span class="token punctuation">,</span> setToken<span class="token punctuation">,</span> removeToken<span class="token punctuation">,</span> getUserInfo<span class="token punctuation">,</span> setUserInfo<span class="token punctuation">,</span> removeUserInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> resetRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>

<span class="token keyword">const</span> <span class="token function-variable function">getDefaultState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    token<span class="token punctuation">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    userInfo<span class="token punctuation">:</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">getDefaultState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token constant">RESET_STATE</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token function">getDefaultState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">SET_TOKEN</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> token<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>token <span class="token operator">=</span> token
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">SET_NAME</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">SET_AVATAR</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> avatar<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>avatar <span class="token operator">=</span> avatar
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">SET_INFO</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> userInfo
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token constant">SET_ROUTER</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> asyncRouterMap<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>asyncRouterMap <span class="token operator">=</span> asyncRouterMap
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// user login</span>
  <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// const { account, password } = userInfo</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">login</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data<span class="token punctuation">,</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> response
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_INFO'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

        <span class="token function">setUserInfo</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// get user info</span>
  <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> commit<span class="token punctuation">,</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">getInfo</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Verification failed, please Login again.'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> name<span class="token punctuation">,</span> avatar <span class="token punctuation">}</span> <span class="token operator">=</span> data

        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_NAME'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_AVATAR'</span><span class="token punctuation">,</span> avatar<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// get user permission</span>
  <span class="token function">getAsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> commit<span class="token punctuation">,</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">getAsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROUTER'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token comment">// 存储在状态机</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// user logout</span>
  <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> commit<span class="token punctuation">,</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// logout(state.token).then(() =&gt; {<!-- --></span>
      <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// must remove  token  first</span>
      <span class="token function">resetRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'RESET_STATE'</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// }).catch(error =&gt; {<!-- --></span>
      <span class="token comment">//   reject(error)</span>
      <span class="token comment">// })</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// remove token</span>
  <span class="token function">resetToken</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// must remove  token  first</span>
      <span class="token function">removeUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'RESET_STATE'</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  namespaced<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span>


</code></pre>
    <h5>
     <a id="_560">
     </a>
     注意点
    </h5>
    <p>
     permission.js中注意使用async和await，将异步请求拉平，不然拿不到数据，就是这个地方一开始没太懂async await的写法， 所以一直出不来数据。
     <br/>
     对async await不太懂的，可以看看这篇文章
     <br/>
     <a href="https://www.jianshu.com/p/a912b44cb68f" rel="nofollow">
      https://www.jianshu.com/p/a912b44cb68f
     </a>
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">filterRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> resPermissions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> asyncRouter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 刷新时重新请求</span>
  <span class="token keyword">await</span> <span class="token function">getAsyncRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> res
    asyncRouter <span class="token operator">=</span> data
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="_574">
     </a>
     总结
    </h5>
    <p>
     每个公司每个项目每个后台返回的数据其实都跟网上的其实都不大一致，如果你非要要求你们后台给你返回网上要求的那种格式也无妨，但是怎么利用现有条件也能简单快速的完整需求也是自身的一种能力吧。
     <br/>
     到现在我还是很多东西都是会写但是不知道为什么这么做的状态，但是项目要求时间紧，只能先做了再说，以后可能久了就会融会贯通了。
     <br/>
     关于权限的处理，一定要自己去测试各种细节，然后自己总结吧，以后肯定一次会比一次好的。
    </p>
    <h6>
     <a id="_578">
     </a>
     不积跬步无以至千里，希望对你有帮助。
    </h6>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333132303930312f:61727469636c652f64657461696c732f313036343630303139" class_="artid" style="display:none">
 </p>
</div>


