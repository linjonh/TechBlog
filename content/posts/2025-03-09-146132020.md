---
layout: post
title: "Godot实现对话系统"
date: 2025-03-09 14:28:18 +0800
description: "在 Godot 中实现对话系统（Dialogue System）是游戏开发中的常见需求。Godot本身自带的的灵活性和轻量级脚本语言 GDScript 使得实现对话系统变得相对简单。以下是实现一个基础对话系统的示例。（语言为GDScript但高亮选择Python因为类似）通过 Godot 和 GDScript，我们可以给我们的游戏实现一个对话系统。从简单的文本显示到复杂的分支对话，Godot 提供了足够的灵活性来满足我们的需求。如果需要更高级的功能，可以尝试使用现成的插件如 Dialogic。"
keywords: "【Godot】实现对话系统"
categories: ['未分类']
tags: ['游戏程序', '游戏引擎', 'Godot']
artid: "146132020"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146132020
    alt: "Godot实现对话系统"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146132020
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146132020
cover: https://bing.ee123.net/img/rand?artid=146132020
image: https://bing.ee123.net/img/rand?artid=146132020
img: https://bing.ee123.net/img/rand?artid=146132020
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Godot】实现对话系统
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     前言
    </h3>
    <p>
     在 Godot 中实现对话系统（Dialogue System）是游戏开发中的常见需求。
     <br/>
     Godot本身自带的的灵活性和轻量级脚本语言 GDScript 使得实现对话系统变得相对简单。
     <br/>
     以下是实现一个基础对话系统的示例。（语言为GDScript但高亮选择Python因为类似）
    </p>
    <h3>
     <a id="__4">
     </a>
     第一步—— 设计对话数据结构
    </h3>
    <p>
     对话通常由以下内容组成：
    </p>
    <ul>
     <li>
      <p>
       对话ID：唯一标识一段对话。
      </p>
     </li>
     <li>
      <p>
       发言者：当前对话的说话者（例如角色名）。
      </p>
     </li>
     <li>
      <p>
       内容：对话的具体文本。
      </p>
     </li>
     <li>
      <p>
       选项（可选）：玩家可以选择的回应选项。
      </p>
     </li>
    </ul>
    <p>
     可以使用
     <code>
      Dictionary
     </code>
     或自定义资源（
     <code>
      Resource
     </code>
     ）来存储对话数据。
    </p>
    <p>
     <strong>
      示例
     </strong>
     ：使用 Dictionary 存储对话
    </p>
    <pre><code class="prism language-python">var dialogue <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"speaker"</span><span class="token punctuation">:</span> <span class="token string">"NPC"</span><span class="token punctuation">,</span>
        <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"你好，旅行者！"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string">"speaker"</span><span class="token punctuation">:</span> <span class="token string">"NPC"</span><span class="token punctuation">,</span>
        <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"你需要帮助吗？"</span><span class="token punctuation">,</span>
        <span class="token string">"options"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"是的，谢谢！"</span><span class="token punctuation">,</span> <span class="token string">"next_id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"不用了，谢谢。"</span><span class="token punctuation">,</span> <span class="token string">"next_id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string">"speaker"</span><span class="token punctuation">:</span> <span class="token string">"NPC"</span><span class="token punctuation">,</span>
        <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"很高兴能帮到你！"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token string">"speaker"</span><span class="token punctuation">:</span> <span class="token string">"NPC"</span><span class="token punctuation">,</span>
        <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"好吧，如果你需要帮助，随时告诉我。"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
    <h3>
     <a id="__47">
     </a>
     第二步—— 创建对话管理器
    </h3>
    <p>
     对话管理器负责加载对话数据、显示当前对话内容，并处理玩家的选择。
    </p>
    <p>
     <strong>
      示例
     </strong>
     ：简单的对话管理器
    </p>
    <pre><code class="prism language-python">extends Node

var current_dialogue_id <span class="token operator">=</span> <span class="token number">1</span>
var dialogue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 这里填充你的对话数据</span>

func start_dialogue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    current_dialogue_id <span class="token operator">=</span> <span class="token number">1</span>
    show_dialogue<span class="token punctuation">(</span>current_dialogue_id<span class="token punctuation">)</span>

func show_dialogue<span class="token punctuation">(</span>dialogue_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    var entry <span class="token operator">=</span> find_dialogue_entry<span class="token punctuation">(</span>dialogue_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> entry<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>entry<span class="token punctuation">[</span><span class="token string">"speaker"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> entry<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> entry<span class="token punctuation">.</span>has<span class="token punctuation">(</span><span class="token string">"options"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            show_options<span class="token punctuation">(</span>entry<span class="token punctuation">[</span><span class="token string">"options"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            end_dialogue<span class="token punctuation">(</span><span class="token punctuation">)</span>

func show_options<span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> options<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

func choose_option<span class="token punctuation">(</span>option_index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    var entry <span class="token operator">=</span> find_dialogue_entry<span class="token punctuation">(</span>current_dialogue_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> entry <span class="token keyword">and</span> entry<span class="token punctuation">.</span>has<span class="token punctuation">(</span><span class="token string">"options"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        var next_id <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">"options"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>option_index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"next_id"</span><span class="token punctuation">]</span>
        show_dialogue<span class="token punctuation">(</span>next_id<span class="token punctuation">)</span>

func find_dialogue_entry<span class="token punctuation">(</span>dialogue_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> entry <span class="token keyword">in</span> dialogue<span class="token punctuation">:</span>
        <span class="token keyword">if</span> entry<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">==</span> dialogue_id<span class="token punctuation">:</span>
            <span class="token keyword">return</span> entry
    <span class="token keyword">return</span> null

func end_dialogue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"对话结束。"</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="__89">
     </a>
     第三步—— 在场景中显示对话
    </h3>
    <p>
     通常，对话会通过 UI 元素（如 Label 和 Button）显示。以下是一个简单的 UI 实现示例：
    </p>
    <p>
     场景结构
    </p>
    <ul>
     <li>
      <p>
       Control 节点（作为对话 UI 的根节点）
      </p>
      <ul>
       <li>
        <p>
         Label（显示发言者和对话内容）
        </p>
       </li>
       <li>
        <p>
         VBoxContainer（用于显示选项按钮）
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      示例
     </strong>
     ：UI 脚本
    </p>
    <pre><code class="prism language-python">extends Control

<span class="token decorator annotation punctuation">@onready</span> var label <span class="token operator">=</span> $Label
<span class="token decorator annotation punctuation">@onready</span> var options_container <span class="token operator">=</span> $VBoxContainer

var dialogue_manager <span class="token operator">=</span> preload<span class="token punctuation">(</span><span class="token string">"res://DialogueManager.gd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token punctuation">)</span>

func _ready<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dialogue_manager<span class="token punctuation">.</span>dialogue <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token comment"># 这里填充你的对话数据</span>
    <span class="token punctuation">]</span>
    start_dialogue<span class="token punctuation">(</span><span class="token punctuation">)</span>

func start_dialogue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dialogue_manager<span class="token punctuation">.</span>start_dialogue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    update_ui<span class="token punctuation">(</span><span class="token punctuation">)</span>

func update_ui<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    var entry <span class="token operator">=</span> dialogue_manager<span class="token punctuation">.</span>find_dialogue_entry<span class="token punctuation">(</span>dialogue_manager<span class="token punctuation">.</span>current_dialogue_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> entry<span class="token punctuation">:</span>
        label<span class="token punctuation">.</span>text <span class="token operator">=</span> entry<span class="token punctuation">[</span><span class="token string">"speaker"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> entry<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> entry<span class="token punctuation">.</span>has<span class="token punctuation">(</span><span class="token string">"options"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            show_options<span class="token punctuation">(</span>entry<span class="token punctuation">[</span><span class="token string">"options"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            options_container<span class="token punctuation">.</span>hide<span class="token punctuation">(</span><span class="token punctuation">)</span>

func show_options<span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>
    options_container<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> options_container<span class="token punctuation">.</span>get_children<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        child<span class="token punctuation">.</span>queue_free<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清除旧选项</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        var button <span class="token operator">=</span> Button<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span>text <span class="token operator">=</span> options<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span>
        button<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">"pressed"</span><span class="token punctuation">,</span> Callable<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"on_option_selected"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bind<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
        options_container<span class="token punctuation">.</span>add_child<span class="token punctuation">(</span>button<span class="token punctuation">)</span>

func on_option_selected<span class="token punctuation">(</span>option_index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dialogue_manager<span class="token punctuation">.</span>choose_option<span class="token punctuation">(</span>option_index<span class="token punctuation">)</span>
    update_ui<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_141">
     </a>
     第四步——扩展功能
    </h3>
    <ul>
     <li>
      <p>
       分支对话：通过 next_id 实现不同的对话分支。
      </p>
     </li>
     <li>
      <p>
       对话事件：在特定对话后触发游戏事件（如任务更新、场景切换）。
      </p>
     </li>
     <li>
      <p>
       保存对话状态：使用 Resource 或文件保存对话进度。
      </p>
     </li>
    </ul>
    <h3>
     <a id="_148">
     </a>
     第五步——使用插件
    </h3>
    <p>
     如果不想从头实现对话系统，其实可以使用现成的 Godot 插件，例如：
    </p>
    <ul>
     <li>
      <p>
       Dialogic：功能强大的对话系统插件，支持分支、变量、事件等。
      </p>
      <ul>
       <li>
        <p>
         GitHub: https://github.com/coppolaemilio/dialogic
        </p>
       </li>
       <li>
        <p>
         安装后可以直接在 Godot 编辑器中使用。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="_156">
     </a>
     总结
    </h3>
    <p>
     通过 Godot 和 GDScript，我们可以给我们的游戏实现一个对话系统。从简单的文本显示到复杂的分支对话，Godot 提供了足够的灵活性来满足我们的需求。如果需要更高级的功能，可以尝试使用现成的插件如 Dialogic。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38323133353038362f:61727469636c652f64657461696c732f313436313332303230" class_="artid" style="display:none">
 </p>
</div>


