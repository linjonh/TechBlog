---
layout: post
title: "Django创建数据库和表"
date: 2022-03-25 16:35:39 +0800
description: "Django——创建数据库和表Django拥有内置的ORM框架（object relational "
keywords: "django创建数据库表"
categories: ['Python']
tags: ['Python', 'Django']
artid: "123739476"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123739476
    alt: "Django创建数据库和表"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123739476
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123739476
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Django——创建数据库和表
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Django_0">
     </a>
     Django——创建数据库和表
    </h2>
    <blockquote>
     <p>
      Django拥有内置的ORM框架（object relational mapping），通过对象操作数据库。
     </p>
    </blockquote>
    <p>
     模型是项目的数据来源，其中每一个模型都是一个python类，
     <strong>
      并且全部继承django.db.models.Model类
     </strong>
    </p>
    <ul>
     <li>
      定义django.db.models.Model的子类，创建数据库表；
     </li>
     <li>
      定义表中的字段，类里面的属性；
     </li>
     <li>
      类中的方法就是对数据库进行数据的增删改查等操作；
     </li>
     <li>
      模型的文件名默认是models.py；
     </li>
    </ul>
    <p>
     <strong>
      在使用指令创建项目时，django默认不会自动创建模型文件;在创建应用时，会主动创建模型文件。
     </strong>
    </p>
    <h3>
     <a id="_11">
     </a>
     创建模型
    </h3>
    <blockquote>
     <p>
      项目的数据存在数据库中，每模型文件中的一个子类都是一个数据表
     </p>
    </blockquote>
    <p>
     创建一个phoneNumber类，定义字段类型为
     <code>
      models.CharField
     </code>
     的两个字段，表示的类型是varchar
    </p>
    <pre><code class="prism language-models.py">from django.db import models

class phoneNumber(models.Model):  # 每一个类都必须继承models.Model
    name = models.CharField(max_length=10, verbose_name='名称')
    number = models.CharField(max_length=11, verbose_name='电话号码')
</code></pre>
    <p>
     在模型文件中定义完类后，需要配置模型，在项目的配置文件
     <code>
      setting.py
     </code>
     中修改
     <code>
      INSTALLED_APPS
     </code>
     <br/>
     和
     <code>
      DATABASES
     </code>
     变量的值
    </p>
    <pre><code class="prism language-angular2html">INSTALLED_APPS = [
    ...
    '创建的应用名'   # 添加模型文件所在的位置
]

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

</code></pre>
    <p>
     <strong>
      Django中默认的数据库是SQLite3
     </strong>
     ，同时也支持MySQL、Oracle和PostgreSQL等数据库
    </p>
    <h4>
     <a id="MySQL_41">
     </a>
     设置数据库为MySQL
    </h4>
    <pre><code class="prism language-angular2html">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'mysqldb',
        'USER': '',
        'PASSWORD': '',
        'HOST': '',     # 数据库所在的IP地址，为空表示127.0.0.1
        'POST': '',     # 连接端口号，为空表示默认端口号3306
    }
}
</code></pre>
    <h3>
     <a id="_54">
     </a>
     更新数据
    </h3>
    <blockquote>
     <p>
      在任何数据改动后，都需要执行更新数据的操作，在Django中叫做
      <strong>
       数据库迁移
      </strong>
      。
     </p>
    </blockquote>
    <pre><code class="prism language-angular2html">python manage.py makemigrations 应用名称    # 在应用模块进行数据的更新
python manage.py migrate                   # 数据更新到数据库中
</code></pre>
    <ul>
     <li>
      在进行数据更新时，Django会自动生成一个
      <code>
       001_initial.py
      </code>
      迁移文件；
     </li>
     <li>
      迁移文件位置在应用目录下的
      <code>
       migrations
      </code>
      目录；
     </li>
     <li>
      Django只为更改的部分生产迁移文件；
     </li>
    </ul>
    <pre><code class="prism language-angular2html">from django.db import models
class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='phoneNumber',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=10, verbose_name='名称')),
                ('number', models.CharField(max_length=11, verbose_name='电话号码')),
            ],
        ),
    ]
</code></pre>
    <h3>
     <a id="_85">
     </a>
     添加数据
    </h3>
    <blockquote>
     <p>
      Django通过Manager提供数据库访问接口。默认是为每个模型添加一个名为
      <code>
       objects
      </code>
      的管理器，调用objects的各种
      <br/>
      方法对数据进行相关操作。
     </p>
    </blockquote>
    <ul>
     <li>
      只有进入
      <strong>
       当前的python交互式环境
      </strong>
      才能正确的使用模型；
     </li>
     <li>
      系统的python的交互式环境，因为无法加载manager.py文件的配置信息，所以会出错；
     </li>
     <li>
      执行
      <code>
       python manager.py shell
      </code>
      进入当前项目的交互式环境进行添加数据；
     </li>
    </ul>
    <h4>
     <a id="save_93">
     </a>
     save()方法将对象数据写入数据库
    </h4>
    <pre><code class="prism language-angular2html">&gt;&gt;&gt; from apps.models import phoneNumber            # 导入模型
&gt;&gt;&gt; n = phoneNumber(name='小米', number='123')     # 创建模型
&gt;&gt;&gt; n.save()                                       # 保存数据
</code></pre>
    <h4>
     <a id="create_99">
     </a>
     create()方法创建并保存对象
    </h4>
    <pre><code class="prism language-angular2html">&gt;&gt;&gt; from apps.models import phoneNumber            # 导入模型
&gt;&gt;&gt; n = phoneNumber.objects.create(name='小米', number='123')
</code></pre>
    <p>
     不管使用哪种方法进行数据保存，django都会默认给新添加的数据进行添加一个名为id的字段，作为模型的
     <strong>
      主键
     </strong>
     ，
     <br/>
     也可以指定id的值。
    </p>
    <ul>
     <li>
      id作为主键，具有唯一标识的作用；
     </li>
     <li>
      当存在相同的id时，会将旧数据进行覆盖；
     </li>
    </ul>
    <pre><code class="prism language-angular2html">&gt;&gt;&gt; from apps.models import phoneNumber            # 导入模型
&gt;&gt;&gt; n = phoneNumber.objects.create(id='2', name='小米', number='123')
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34393538313936382f:61727469636c652f64657461696c732f313233373339343736" class_="artid" style="display:none">
 </p>
</div>


