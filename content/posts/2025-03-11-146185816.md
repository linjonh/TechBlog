---
layout: post
title: "GitLab的Dockerfile-追踪"
date: 2025-03-11 18:22:17 +0800
description: "通过以上步骤，你就可以在 GitLab 上准备每个平台的 Docker 镜像文件，并实现完整的 Dockerfile 追踪。"
keywords: "GitLab的Dockerfile 追踪"
categories: ['未分类']
tags: ['Gitlab']
artid: "146185816"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146185816
    alt: "GitLab的Dockerfile-追踪"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146185816
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146185816
cover: https://bing.ee123.net/img/rand?artid=146185816
image: https://bing.ee123.net/img/rand?artid=146185816
img: https://bing.ee123.net/img/rand?artid=146185816
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     GitLab的Dockerfile 追踪
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     为了在 GitLab 上准备每个平台的 Docker 镜像文件，并实现完整的 Dockerfile 追踪，可以按照以下步骤进行操作：
    </p>
    <ol>
     <li>
      项目准备
      <br/>
      首先，确保你有一个 GitLab 项目，并且本地已经克隆了该项目的仓库。如果还没有项目，可以在 GitLab 上创建一个新的项目，然后使用以下命令将其克隆到本地：
      <br/>
      bash
      <br/>
      git clone
      <br/>
      cd
     </li>
     <li>
      编写 Dockerfile
      <br/>
      在项目根目录下，为每个目标平台编写对应的 Dockerfile。例如，如果你要为 amd64 和 arm64 平台构建镜像，可以分别创建 Dockerfile.amd64 和 Dockerfile.arm64。
      <br/>
      以下是一个简单的示例 Dockerfile.arm64：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment"># 使用官方的 Ubuntu 20.04 作为基础镜像</span>
FROM ubuntu:20.04

<span class="token comment"># 设置工作目录</span>
WORKDIR /app

<span class="token comment"># 安装必要的软件包</span>
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token punctuation">\</span>
    python3 <span class="token punctuation">\</span>
    python3-pip <span class="token punctuation">\</span>
    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/apt/lists/*

<span class="token comment"># 复制项目文件到工作目录</span>
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>

<span class="token comment"># 安装项目依赖</span>
RUN pip3 <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt

<span class="token comment"># 暴露端口</span>
EXPOSE <span class="token number">8080</span>

<span class="token comment"># 定义启动命令</span>
CMD <span class="token punctuation">[</span><span class="token string">"python3"</span>, <span class="token string">"app.py"</span><span class="token punctuation">]</span>
</code></pre>
    <ol start="3">
     <li>
      配置 GitLab CI/CD
      <br/>
      在项目根目录下创建一个 .gitlab-ci.yml 文件，用于定义 CI/CD 流程。以下是一个示例配置：
     </li>
    </ol>
    <pre><code class="prism language-yaml"><span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build

<span class="token key atrule">build-amd64</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>dind
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>t your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">:</span>amd64 <span class="token punctuation">-</span>f Dockerfile.amd64 .
    <span class="token punctuation">-</span> docker save <span class="token punctuation">-</span>o your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">-</span>amd64.tar your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">:</span>amd64
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">-</span>amd64.tar

<span class="token key atrule">build-arm64</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">image</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>latest
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> docker<span class="token punctuation">:</span>dind
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>t your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">:</span>arm64 <span class="token punctuation">-</span>f Dockerfile.arm64 .
    <span class="token punctuation">-</span> docker save <span class="token punctuation">-</span>o your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">-</span>arm64.tar your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">:</span>arm64
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> your<span class="token punctuation">-</span>image<span class="token punctuation">-</span>name<span class="token punctuation">-</span>arm64.tar
</code></pre>
    <ol start="4">
     <li>
      提交代码到 GitLab
      <br/>
      将编写好的 Dockerfile 和 .gitlab-ci.yml 文件提交到 GitLab 仓库：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">git</span> <span class="token function">add</span> Dockerfile.amd64 Dockerfile.arm64 .gitlab-ci.yml
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Add Dockerfiles and GitLab CI/CD configuration"</span>
<span class="token function">git</span> push origin main
</code></pre>
    <ol start="5">
     <li>
      触发 CI/CD 流程
      <br/>
      提交代码后，GitLab 会自动触发 CI/CD 流程。你可以在 GitLab 项目的 CI/CD 菜单中查看构建进度和结果。
     </li>
     <li>
      下载镜像文件
      <br/>
      构建完成后，你可以在 GitLab 项目的 Jobs 页面中找到每个构建任务，点击下载按钮下载生成的 Docker 镜像文件。
     </li>
     <li>
      实现 Dockerfile 追踪
      <br/>
      由于 Dockerfile 已经包含在 Git 仓库中，你可以通过 Git 的版本控制功能实现对 Dockerfile 的追踪。每次对 Dockerfile 进行修改时，提交并推送到 GitLab，就可以记录 Dockerfile 的变更历史。
     </li>
    </ol>
    <p>
     通过以上步骤，你就可以在 GitLab 上准备每个平台的 Docker 镜像文件，并实现完整的 Dockerfile 追踪。
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343635393330392f:61727469636c652f64657461696c732f313436313835383136" class_="artid" style="display:none">
 </p>
</div>


