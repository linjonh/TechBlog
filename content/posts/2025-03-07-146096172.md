---
layout: post
title: "监听-追溯"
date: 2025-03-07 15:01:50 +0800
description: "immediate: true // 初始化时立即执行。// 替换旧前缀（如果有）"
keywords: "监听-追溯"
categories: ['未分类']
tags: ['Java']
artid: "146096172"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146096172
    alt: "监听-追溯"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146096172
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146096172
cover: https://bing.ee123.net/img/rand?artid=146096172
image: https://bing.ee123.net/img/rand?artid=146096172
img: https://bing.ee123.net/img/rand?artid=146096172
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     监听-追溯
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     ‘info.moduleNameSub’: {
     <!-- -->
     <br/>
     handler(newVal, oldVal) {
     <!-- -->
     <br/>
     if (newVal) {
     <!-- -->
     <br/>
     const newPrefix = newVal.charAt(0).toUpperCase() + newVal.slice(1);
     <br/>
     let currentBusinessName = this.info.businessName || ‘’;
     <br/>
     // 替换旧前缀（如果有）
     <br/>
     if (oldVal) {
     <!-- -->
     <br/>
     const oldPrefix = oldVal.charAt(0).toUpperCase() + oldVal.slice(1);
     <br/>
     currentBusinessName = currentBusinessName.replace(oldPrefix, ‘’);
     <br/>
     }
     <br/>
     this.info.businessName = newPrefix + currentBusinessName;
     <br/>
     }
     <br/>
     },
     <br/>
     immediate: true // 初始化时立即执行
    </p>
    <pre><code>&lt;template&gt;
  &lt;el-form ref="genInfoForm" :model="info" :rules="rules" label-width="150px"&gt;
    &lt;el-row&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="tplCategory"&gt;
          &lt;span slot="label"&gt;生成模板&lt;/span&gt;
          &lt;el-select v-model="info.tplCategory" @change="tplSelectChange"&gt;
            &lt;el-option label="单表（增删改查）" value="crud"/&gt;
            &lt;el-option label="树表（增删改查）" value="tree"/&gt;
            &lt;el-option label="主子表（增删改查）" value="sub"/&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="tplWebType"&gt;
          &lt;span slot="label"&gt;前端类型&lt;/span&gt;
          &lt;el-select v-model="info.tplWebType"&gt;
            &lt;el-option label="Vue2 Element UI 模版" value="element-ui"/&gt;
            &lt;el-option label="Vue3 Element Plus 模版" value="element-plus"/&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="packageName"&gt;
          &lt;span slot="label"&gt;
            生成包路径
            &lt;el-tooltip content="基础的根路径，在配置文件中定义" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.packageName"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="entityPath"&gt;
          &lt;span slot="label"&gt;
            实体类根路径
            &lt;el-tooltip content="基础的根路径，在配置文件中定义" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.entityPath"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="mapperPath"&gt;
          &lt;span slot="label"&gt;
            业务根路径
            &lt;el-tooltip content="三层代码(controller,service,mapper)生成在哪个java包下，计算得出" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.mapperPath"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="businessName"&gt;
          &lt;span slot="label"&gt;
            生成业务名
            &lt;el-tooltip content="功能英文名，用来组成文件命名" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.businessName"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="moduleName"&gt;
          &lt;span slot="label"&gt;
            生成模块名
            &lt;el-tooltip content="功能英文名，用来组成分包命名" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.moduleName"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="moduleName"&gt;
          &lt;span slot="label"&gt;
            生成子模块名
            &lt;el-tooltip content="用于切分子文件夹，防止文件过多导致阅读性下降，比如MesModuleDbcRelIn的模块名是tms，子模块名是mes" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.moduleNameSub"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="functionName"&gt;
          &lt;span slot="label"&gt;
            生成功能名
            &lt;el-tooltip content="用作类描述，例如 用户" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.functionName"/&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item prop="genType"&gt;
          &lt;span slot="label"&gt;
            生成代码方式
            &lt;el-tooltip content="默认为zip压缩包下载，也可以自定义生成路径" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-radio v-model="info.genType" label="0"&gt;zip压缩包&lt;/el-radio&gt;
          &lt;el-radio v-model="info.genType" label="1"&gt;自定义路径&lt;/el-radio&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="12"&gt;
        &lt;el-form-item&gt;
          &lt;span slot="label"&gt;
            上级菜单
            &lt;el-tooltip content="分配到指定菜单下，例如 系统管理" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;treeselect
            :append-to-body="true"
            v-model="info.parentMenuId"
            :options="menus"
            :normalizer="normalizer"
            :show-count="true"
            placeholder="请选择系统菜单"
          /&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;

      &lt;el-col :span="24" v-if="info.genType == '1'"&gt;
        &lt;el-form-item prop="genPath"&gt;
          &lt;span slot="label"&gt;
            自定义路径
            &lt;el-tooltip content="填写磁盘绝对路径，若不填写，则生成到当前Web项目下" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-input v-model="info.genPath"&gt;
            &lt;el-dropdown slot="append"&gt;
              &lt;el-button type="primary"&gt;
                最近路径快速选择
                &lt;i class="el-icon-arrow-down el-icon--right"&gt;&lt;/i&gt;
              &lt;/el-button&gt;
              &lt;el-dropdown-menu slot="dropdown"&gt;
                &lt;el-dropdown-item @click.native="info.genPath = '/'"&gt;恢复默认的生成基础路径&lt;/el-dropdown-item&gt;
              &lt;/el-dropdown-menu&gt;
            &lt;/el-dropdown&gt;
          &lt;/el-input&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row v-show="info.tplCategory == 'tree'"&gt;
      &lt;h4 class="form-header"&gt;其他信息&lt;/h4&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item&gt;
          &lt;span slot="label"&gt;
            树编码字段
            &lt;el-tooltip content="树显示的编码字段名， 如：dept_id" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-select v-model="info.treeCode" placeholder="请选择"&gt;
            &lt;el-option
              v-for="(column, index) in info.columns"
              :key="index"
              :label="column.columnName + '：' + column.columnComment"
              :value="column.columnName"
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item&gt;
          &lt;span slot="label"&gt;
            树父编码字段
            &lt;el-tooltip content="树显示的父编码字段名， 如：parent_Id" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-select v-model="info.treeParentCode" placeholder="请选择"&gt;
            &lt;el-option
              v-for="(column, index) in info.columns"
              :key="index"
              :label="column.columnName + '：' + column.columnComment"
              :value="column.columnName"
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item&gt;
          &lt;span slot="label"&gt;
            树名称字段
            &lt;el-tooltip content="树节点的显示名称字段名， 如：dept_name" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-select v-model="info.treeName" placeholder="请选择"&gt;
            &lt;el-option
              v-for="(column, index) in info.columns"
              :key="index"
              :label="column.columnName + '：' + column.columnComment"
              :value="column.columnName"
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
    &lt;el-row v-show="info.tplCategory == 'sub'"&gt;
      &lt;h4 class="form-header"&gt;关联信息&lt;/h4&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item&gt;
          &lt;span slot="label"&gt;
            关联子表的表名
            &lt;el-tooltip content="关联子表的表名， 如：sys_user" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-select v-model="info.subTableName" placeholder="请选择" @change="subSelectChange"&gt;
            &lt;el-option
              v-for="(table, index) in tables"
              :key="index"
              :label="table.tableName + '：' + table.tableComment"
              :value="table.tableName"
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="12"&gt;
        &lt;el-form-item&gt;
          &lt;span slot="label"&gt;
            子表关联的外键名
            &lt;el-tooltip content="子表关联的外键名， 如：user_id" placement="top"&gt;
              &lt;i class="el-icon-question"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/span&gt;
          &lt;el-select v-model="info.subTableFkName" placeholder="请选择"&gt;
            &lt;el-option
              v-for="(column, index) in subColumns"
              :key="index"
              :label="column.columnName + '：' + column.columnComment"
              :value="column.columnName"
            &gt;&lt;/el-option&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
  &lt;/el-form&gt;
&lt;/template&gt;

&lt;script&gt;
import Treeselect from "@riophae/vue-treeselect";
import "@riophae/vue-treeselect/dist/vue-treeselect.css";

export default {
  components: { Treeselect },
  props: {
    info: {
      type: Object,
      default: null,
    },
    tables: {
      type: Array,
      default: null,
    },
    menus: {
      type: Array,
      default: [],
    },
  },
  data() {
    return {
      subColumns: [],
      rules: {
        tplCategory: [
          { required: true, message: "请选择生成模板", trigger: "blur" },
        ],
        packageName: [
          { required: true, message: "请输入生成包路径", trigger: "blur" },
        ],
        moduleName: [
          { required: true, message: "请输入生成模块名", trigger: "blur" },
        ],
        businessName: [
          { required: true, message: "请输入生成业务名", trigger: "blur" },
        ],
        functionName: [
          { required: true, message: "请输入生成功能名", trigger: "blur" },
        ],
        entityPath: [
          { required: true, message: "请输入实体类根路径", trigger: "blur" },
        ],
        mapperPath: [
          { required: true, message: "请输入业务根路径", trigger: "blur" },
        ],
      },
    };
  },
  watch: {
    "info.subTableName": function(val) {
      this.setSubTableColumns(val);
    },
    "info.tplWebType": function(val) {
      if (val === "") {
        this.info.tplWebType = "element-ui";
      }
    },
  },
  methods: {
    /** 转换菜单数据结构 */
    normalizer(node) {
      if (node.children &amp;&amp; !node.children.length) {
        delete node.children;
      }
      return {
        id: node.menuId,
        label: node.menuName,
        children: node.children,
      };
    },
    /** 选择子表名触发 */
    subSelectChange(value) {
      this.info.subTableFkName = "";
    },
    /** 选择生成模板触发 */
    tplSelectChange(value) {
      if (value !== "sub") {
        this.info.subTableName = "";
        this.info.subTableFkName = "";
      }
    },
    /** 设置关联外键 */
    setSubTableColumns(value) {
      for (var item in this.tables) {
        const name = this.tables[item].tableName;
        if (value === name) {
          this.subColumns = this.tables[item].columns;
          break;
        }
      }
    },
  },
};
&lt;/script&gt;

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f6c69756665696665696875617765692f:61727469636c652f64657461696c732f313436303936313732" class_="artid" style="display:none">
 </p>
</div>


