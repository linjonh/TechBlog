---
layout: post
title: "极光-OrbitSTC8AH04.-深度探索-GPIO-底层逻辑"
date: 2025-03-14 22:08:45 +0800
description: "* GPIO组号，是GPIO宏操作函数的第一个参数，支持对这个宏进行再封装 *//* GPIO端口号，是GPIO宏操作函数的第二个参数，支持多个宏进行或运算，同时配置多个IO *//* GPIO Bit SET和Bit RESET枚举 *//* ## 字符连接宏定义 A(x) (T_##X) == A(1) --> T_1 \t*/寄存器直接操作：适合对性能要求极高的场景（如实时控制）。官方库函数：适合快速开发与调试，代码可读性高。优化库函数：在保证高效性的同时，提供对单个引脚的精准控制。"
keywords: "【极光 Orbit·STC8A&H】04. 深度探索 GPIO 底层逻辑"
categories: ['极光', 'Orbit']
tags: ['嵌入式', '单片机', 'Stm', 'Stc']
artid: "146268302"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146268302
    alt: "极光-OrbitSTC8AH04.-深度探索-GPIO-底层逻辑"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146268302
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146268302
cover: https://bing.ee123.net/img/rand?artid=146268302
image: https://bing.ee123.net/img/rand?artid=146268302
img: https://bing.ee123.net/img/rand?artid=146268302
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【极光 Orbit·STC8A&amp;H】04. 深度探索 GPIO 底层逻辑
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <hr/>
    <h2>
     <a id="_OrbitSTC8AH04__GPIO__4">
     </a>
     【极光 Orbit·STC8A&amp;H】04. 深度探索 GPIO 底层逻辑
    </h2>
    <h3>
     <a id="_6">
     </a>
     引言：当代码遇见硬件
    </h3>
    <p>
     上周我看着学生调试的工控产品，他们困惑地盯着自己编写的代码：“老师，这段C语言明明在PC上跑得没问题啊！” ，让我想起自己初学嵌入式时的窘迫——那时我曾用标准C的思维写代码，结果让价值数万的工业控制器冒起了青烟。
    </p>
    <p>
     这个小插曲恰恰揭示了嵌入式开发的核心矛盾：
     <strong>
      纯软件思维与硬件物理特性的碰撞
     </strong>
     。学生们用熟悉的
     <code>
      printf()
     </code>
     调试习惯，将LED控制写成简单的
     <code>
      led = 1;
     </code>
     ，却忽略了单片机GPIO需要先配置方向寄存器的底层逻辑。这种思维差异，正是本文要探讨的嵌入式编程特殊性。
    </p>
    <p>
     故此，STC8A 这个专栏停更了一周，专门开设了【编程技巧】，写了一点嵌入式编程的感悟，全是学校里学不到的内容，希望大家喜欢。
    </p>
    <h5>
     <a id="CC_14">
     </a>
     纯C与嵌入式C的三大本质区别
    </h5>
    <ol>
     <li>
      <strong>
       硬件寄存器的直接操作
      </strong>
      <br/>
      纯C代码：
      <code>
       int led = 1;
      </code>
      （逻辑值）
      <br/>
      嵌入式C：
      <code>
       P0 = 0xFF; P0M0 = 0xFF;
      </code>
      （需同时配置数据寄存器和模式寄存器）
     </li>
     <li>
      <strong>
       时序敏感性
      </strong>
      <br/>
      纯C：
      <code>
       delay(1000);
      </code>
      （依赖系统时钟）
      <br/>
      嵌入式C：
      <code>
       for(volatile uint16_t i=0;i&lt;12000;i++);
      </code>
      （精确控制时序）
     </li>
     <li>
      <strong>
       资源约束
      </strong>
      <br/>
      纯C：可自由使用动态内存、复杂数据结构
      <br/>
      嵌入式C：需手动管理有限的RAM（如STC8H仅8KB SRAM）
     </li>
    </ol>
    <p>
     当用标准C的
     <code>
      int led_array[8]
     </code>
     记录LED状态时，程序在STC8A上频繁崩溃——因为数组占用了宝贵的硬件堆栈空间。这正是本文要深入剖析的
     <strong>
      GPIO底层逻辑
     </strong>
     ：从寄存器直接操作的"硬件级编程"，到官方库函数封装的"开发友好模式"，再到结合两者优势的"优化位操作"，开发者需要理解不同模式背后的硬件原理。
    </p>
    <p>
     接下来我们将通过GPIO控制LED的典型案例，对比三种编程模式的实现差异，揭示嵌入式C语言如何通过代码与硬件的"对话"，实现从算法到物理世界的精准控制。这个过程就像在数字电路与软件逻辑之间架设桥梁——而这座桥梁的建材，正是本文要展开的底层寄存器配置与优化技巧。
    </p>
    <h3>
     <a id="_30">
     </a>
     硬件连接
    </h3>
    <h4>
     <a id="_32">
     </a>
     硬件电路图
    </h4>
    <ul>
     <li>
      <strong>
       LED连接方式
      </strong>
      ：
      <br/>
      将8只LED的阳极分别连接到单片机的GPIO引脚（如P0.0~P0.7），阴极通过限流电阻（如220Ω）接地。
      <ul>
       <li>
        <strong>
         共阳极接法
        </strong>
        ：GPIO输出低电平点亮LED。
       </li>
       <li>
        <strong>
         共阴极接法
        </strong>
        ：GPIO输出高电平点亮LED。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_38">
     </a>
     单片机引脚分配
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        引脚名称
       </th>
       <th>
        功能
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        P0.0~P0.7
       </td>
       <td>
        GPIO输出
       </td>
       <td>
        控制8只LED的亮灭
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_45">
     </a>
     编程模式详解
    </h3>
    <h4>
     <a id="1__47">
     </a>
     1. 寄存器直接操作模式
    </h4>
    <h5>
     <a id="_48">
     </a>
     步骤说明
    </h5>
    <ol>
     <li>
      <strong>
       配置GPIO方向
      </strong>
      ：将P0端口的所有引脚设置为推挽输出模式。
     </li>
     <li>
      <strong>
       控制LED状态
      </strong>
      ：通过写入P0寄存器的值直接控制LED的亮灭。
     </li>
    </ol>
    <h5>
     <a id="_52">
     </a>
     关键寄存器
    </h5>
    <ul>
     <li>
      <strong>
       P0M0和P0M1
      </strong>
      ：控制P0端口每个引脚的模式。
      <ul>
       <li>
        <code>
         P0M0 = 0xFF
        </code>
        和
        <code>
         P0M1 = 0xFF
        </code>
        ：设置所有引脚为推挽输出模式。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       P0
      </strong>
      ：数据寄存器，直接控制引脚的输出电平。
     </li>
    </ul>
    <h5>
     <a id="_57">
     </a>
     代码示例
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stc8h.h"</span></span>

<span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> ms<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ms<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token class-name">uint16_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">12000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 配置P0端口为推挽输出模式</span>
    P0M0 <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>  <span class="token comment">// 低四位控制P0.0~P0.3，高四位控制P0.4~P0.7</span>
    P0M1 <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>  <span class="token comment">// 低四位控制P0.0~P0.3，高四位控制P0.4~P0.7</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 2. 全部点亮LED（假设共阴极）</span>
        P0 <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>  <span class="token comment">// 输出高电平</span>
        <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 熄灭所有LED</span>
        P0 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>  <span class="token comment">// 输出低电平</span>
        <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_84">
     </a>
     原理分析
    </h5>
    <ul>
     <li>
      <strong>
       优势
      </strong>
      ：直接操作硬件寄存器，执行效率最高，适合对性能要求高的场景。
     </li>
     <li>
      <strong>
       缺点
      </strong>
      ：代码可读性低，需熟悉寄存器功能。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2__90">
     </a>
     2. 官方库函数模式
    </h4>
    <p>
     GPIO.C
    </p>
    <pre><code class="prism language-c">#### 步骤说明
<span class="token number">1.</span> <span class="token operator">*</span><span class="token operator">*</span>包含头文件<span class="token operator">*</span><span class="token operator">*</span>：引入STC标准库头文件。
<span class="token number">2.</span> <span class="token operator">*</span><span class="token operator">*</span>初始化GPIO<span class="token operator">*</span><span class="token operator">*</span>：通过结构体配置GPIO方向和初始值。
<span class="token number">3.</span> <span class="token operator">*</span><span class="token operator">*</span>控制LED<span class="token operator">*</span><span class="token operator">*</span>：使用库函数切换GPIO电平。
<span class="token comment">/*---------------------------------------------------------------------*/</span>
<span class="token comment">/* --- STC MCU Limited ------------------------------------------------*/</span>
<span class="token comment">/* --- STC 1T Series MCU Demo Programme -------------------------------*/</span>
<span class="token comment">/* --- Mobile: (86)13922805190 ----------------------------------------*/</span>
<span class="token comment">/* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/</span>
<span class="token comment">/* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/</span>
<span class="token comment">/* --- Web: www.STCMCU.com --------------------------------------------*/</span>
<span class="token comment">/* --- Web: www.STCMCUDATA.com  ---------------------------------------*/</span>
<span class="token comment">/* --- QQ:  800003751 -------------------------------------------------*/</span>
<span class="token comment">/* 如果要在程序中使用此代码,请在程序中注明使用了STC的资料及程序            */</span>
<span class="token comment">/*---------------------------------------------------------------------*/</span>

<span class="token comment">/***************	功能说明	****************

本文件为STC8系列的端口初始化程序,用户几乎可以不修改这个程序.

******************************************/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>	<span class="token string">"GPIO.h"</span></span>

<span class="token comment">//========================================================================</span>
<span class="token comment">// 函数: u8	GPIO_Inilize(u8 GPIO, GPIO_InitTypeDef *GPIOx)</span>
<span class="token comment">// 描述: 初始化IO口.</span>
<span class="token comment">// 参数: GPIOx: 结构参数,请参考timer.h里的定义.</span>
<span class="token comment">// 返回: 成功返回0, 空操作返回1,错误返回2.</span>
<span class="token comment">// 版本: V1.0, 2012-10-22</span>
<span class="token comment">//========================================================================</span>
u8	<span class="token function">GPIO_Inilize</span><span class="token punctuation">(</span>u8 GPIO<span class="token punctuation">,</span> GPIO_InitTypeDef <span class="token operator">*</span>GPIOx<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">&gt;</span> GPIO_P7<span class="token punctuation">)</span>				<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//空操作</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">&gt;</span> GPIO_OUT_PP<span class="token punctuation">)</span>	<span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>	<span class="token comment">//错误</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P0<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P0M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P0M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P0M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P0M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P0M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P0M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P0M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P0M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P1<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P1M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P1M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P1M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P1M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P1M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P1M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P1M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P1M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P2<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P2M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P2M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P2M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P2M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P2M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P2M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P2M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P2M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P3<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P3M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P3M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P3M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P3M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P3M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P3M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P3M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P3M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P4<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P4M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P4M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P4M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P4M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P4M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P4M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P4M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P4M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P5<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P5M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P5M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P5M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P5M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P5M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P5M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P5M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P5M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P6<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P6M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P6M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P6M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P6M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P6M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P6M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P6M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P6M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO <span class="token operator">==</span> GPIO_P7<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_PullUp<span class="token punctuation">)</span>		P7M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P7M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//上拉准双向口</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_HighZ<span class="token punctuation">)</span>		P7M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P7M0 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//浮空输入</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_OD<span class="token punctuation">)</span>		P7M1 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P7M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//开漏输出</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>GPIOx<span class="token operator">-&gt;</span>Mode <span class="token operator">==</span> GPIO_OUT_PP<span class="token punctuation">)</span>		P7M1 <span class="token operator">&amp;=</span> <span class="token operator">~</span>GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">,</span>	P7M0 <span class="token operator">|=</span>  GPIOx<span class="token operator">-&gt;</span>Pin<span class="token punctuation">;</span>	 <span class="token comment">//推挽输出</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">//成功</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     GPIO.H
    </p>
    <pre><code class="prism language-c"><span class="token comment">/*---------------------------------------------------------------------*/</span>
<span class="token comment">/* --- STC MCU Limited ------------------------------------------------*/</span>
<span class="token comment">/* --- STC 1T Series MCU Demo Programme -------------------------------*/</span>
<span class="token comment">/* --- Mobile: (86)13922805190 ----------------------------------------*/</span>
<span class="token comment">/* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/</span>
<span class="token comment">/* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/</span>
<span class="token comment">/* --- Web: www.STCMCU.com --------------------------------------------*/</span>
<span class="token comment">/* --- Web: www.STCMCUDATA.com  ---------------------------------------*/</span>
<span class="token comment">/* --- QQ:  800003751 -------------------------------------------------*/</span>
<span class="token comment">/* 如果要在程序中使用此代码,请在程序中注明使用了STC的资料及程序            */</span>
<span class="token comment">/*---------------------------------------------------------------------*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span>	<span class="token expression">__GPIO_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">__GPIO_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>	<span class="token string">"config.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_PullUp</span>		<span class="token expression"><span class="token number">0</span>	</span><span class="token comment">//上拉准双向口</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_HighZ</span>		<span class="token expression"><span class="token number">1</span>	</span><span class="token comment">//浮空输入</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_OUT_OD</span>		<span class="token expression"><span class="token number">2</span>	</span><span class="token comment">//开漏输出</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_OUT_PP</span>		<span class="token expression"><span class="token number">3</span>	</span><span class="token comment">//推挽输出</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_0</span>		<span class="token expression"><span class="token number">0x01</span>	</span><span class="token comment">//IO引脚 Px.0</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_1</span>		<span class="token expression"><span class="token number">0x02</span>	</span><span class="token comment">//IO引脚 Px.1</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_2</span>		<span class="token expression"><span class="token number">0x04</span>	</span><span class="token comment">//IO引脚 Px.2</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_3</span>		<span class="token expression"><span class="token number">0x08</span>	</span><span class="token comment">//IO引脚 Px.3</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_4</span>		<span class="token expression"><span class="token number">0x10</span>	</span><span class="token comment">//IO引脚 Px.4</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_5</span>		<span class="token expression"><span class="token number">0x20</span>	</span><span class="token comment">//IO引脚 Px.5</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_6</span>		<span class="token expression"><span class="token number">0x40</span>	</span><span class="token comment">//IO引脚 Px.6</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_7</span>		<span class="token expression"><span class="token number">0x80</span>	</span><span class="token comment">//IO引脚 Px.7</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_Pin_All</span>	<span class="token expression"><span class="token number">0xFF</span>	</span><span class="token comment">//IO所有引脚</span></span>
	
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P0</span>			<span class="token expression"><span class="token number">0</span>		</span><span class="token comment">//</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P1</span>			<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P2</span>			<span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P3</span>			<span class="token expression"><span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P4</span>			<span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P5</span>			<span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P6</span>			<span class="token expression"><span class="token number">6</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>	<span class="token macro-name">GPIO_P7</span>			<span class="token expression"><span class="token number">7</span></span></span>


<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
	u8	Mode<span class="token punctuation">;</span>		<span class="token comment">//IO模式,  		GPIO_PullUp,GPIO_HighZ,GPIO_OUT_OD,GPIO_OUT_PP</span>
	u8	Pin<span class="token punctuation">;</span>		<span class="token comment">//要设置的端口	</span>
<span class="token punctuation">}</span> GPIO_InitTypeDef<span class="token punctuation">;</span>

u8	<span class="token function">GPIO_Inilize</span><span class="token punctuation">(</span>u8 GPIO<span class="token punctuation">,</span> GPIO_InitTypeDef <span class="token operator">*</span>GPIOx<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre>
    <h5>
     <a id="_243">
     </a>
     关键库函数
    </h5>
    <ul>
     <li>
      <code>
       GPIO_Inilize(u8 GPIO, GPIO_InitTypeDef *GPIOx)
      </code>
      ：初始化GPIO引脚方向和模式。
     </li>
    </ul>
    <h5>
     <a id="_246">
     </a>
     代码示例
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stc8h.h"</span></span>

<span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> ms<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>ms<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token class-name">uint16_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">12000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span>	<span class="token function">GPIO_config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	GPIO_InitTypeDef	GPIO_InitStructure<span class="token punctuation">;</span>				<span class="token comment">//结构定义</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Pin  <span class="token operator">=</span> GPIO_Pin_All<span class="token punctuation">;</span>				<span class="token comment">//指定要初始化的IO,</span>
	GPIO_InitStructure<span class="token punctuation">.</span>Mode <span class="token operator">=</span> GPIO_PullUp<span class="token punctuation">;</span>				<span class="token comment">//指定IO的输入或输出方式,</span>
    GPIO_PullUp<span class="token punctuation">,</span>GPIO_HighZ<span class="token punctuation">,</span>GPIO_OUT_OD<span class="token punctuation">,</span>GPIO_OUT_PP
	<span class="token function">GPIO_Inilize</span><span class="token punctuation">(</span>GPIO_P0<span class="token punctuation">,</span><span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//初始化</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 配置P0端口为推挽输出模式</span>
    <span class="token function">GPIO_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 2. 全部点亮LED（假设共阴极）</span>
        P0 <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>  <span class="token comment">// 输出高电平</span>
        <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 全部熄灭LED</span>
        P0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 输出低电平</span>
        <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_281">
     </a>
     原理分析
    </h5>
    <ul>
     <li>
      <strong>
       优势
      </strong>
      ：代码简洁易读，封装了寄存器操作细节。
     </li>
     <li>
      <strong>
       缺点
      </strong>
      ：函数调用开销较大，执行速度略低于直接寄存器操作。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3__287">
     </a>
     3. 优化库函数模式（位操作）
    </h4>
    <h5>
     <a id="_288">
     </a>
     步骤说明
    </h5>
    <ol>
     <li>
      <strong>
       配置GPIO模式
      </strong>
      ：通过寄存器设置为推挽输出。
     </li>
     <li>
      <strong>
       位操作
      </strong>
      ：利用STC的位（Bit-Band）功能快速操作单个引脚。
     </li>
    </ol>
    <h5>
     <a id="_292">
     </a>
     优化技巧：
    </h5>
    <h6>
     <a id="1GPIO_294">
     </a>
     （1）使用宏定义GPIO端口和引脚
    </h6>
    <pre><code>/* GPIO组号，是GPIO宏操作函数的第一个参数，支持对这个宏进行再封装 */
#define	GPIO_P0  0 /*!&lt; IO P0. */
#define	GPIO_P1  1 /*!&lt; IO P1. */
#define	GPIO_P2  2 /*!&lt; IO P2. */
#define	GPIO_P3  3 /*!&lt; IO P3. */
#define	GPIO_P4  4 /*!&lt; IO P4. */
#define	GPIO_P5  5 /*!&lt; IO P5. */
#define	GPIO_P6  6 /*!&lt; IO P6. */
#define	GPIO_P7  7 /*!&lt; IO P7. */

/* GPIO端口号，是GPIO宏操作函数的第二个参数，支持多个宏进行或运算，同时配置多个IO */
#define	Pin_0    0x01  /*!&lt; IO Pin Px.0 . */
#define	Pin_1    0x02  /*!&lt; IO Pin Px.1 . */
#define	Pin_2    0x04  /*!&lt; IO Pin Px.2 . */
#define	Pin_3    0x08  /*!&lt; IO Pin Px.3 . */
#define	Pin_4    0x10  /*!&lt; IO Pin Px.4 . */
#define	Pin_5    0x20  /*!&lt; IO Pin Px.5 . */
#define	Pin_6    0x40  /*!&lt; IO Pin Px.6 . */
#define	Pin_7    0x80  /*!&lt; IO Pin Px.7 . */
#define	Pin_Low  0x0F  /*!&lt; IO Pin Px.0~3 . */
#define	Pin_High 0xF0  /*!&lt; IO Pin Px.4~7 . */
#define	Pin_All  0xFF  /*!&lt; IO Pin All . */
</code></pre>
    <h6>
     <a id="2IO_321">
     </a>
     （2）用枚举定义输入输出模式和IO端口电平
    </h6>
    <pre><code>typedef enum
{
    GPIO_MODE_WEAK_PULL 	= 0x00,
    GPIO_MODE_IN_FLOATING = 0x01,
    GPIO_MODE_OUT_OD 			= 0x10,
    GPIO_MODE_OUT_PP 			= 0x11,
} eGPIO_Mode;

/* GPIO Bit SET和Bit RESET枚举 */
typedef enum
{
    GPIO_PIN_RESET = 0,
    GPIO_PIN_SET = 1
} eGPIO_PinState;
</code></pre>
    <h6>
     <a id="3___340">
     </a>
     （3）使用 ## 字符连接宏定义
    </h6>
    <pre><code>/* ## 字符连接宏定义 A(x) (T_##X) == A(1) --&gt; T_1 	*/
#define GPIO_Px(x)  (P##x)		// GPIO_Px(1) --&gt; P1
#define Px_M1(x) 	(P##x##M1)  // Px_M1(0) --&gt; P0M1	//GPIO_P0M1 GPIO_P0M0
#define Px_M0(x) 	(P##x##M0)  // P0M1 P0M0
</code></pre>
    <h6>
     <a id="4_349">
     </a>
     （4）写模式配置宏函数
    </h6>
    <pre><code>/* GPIO设置为准双向口（弱上拉）模式宏函数。*/
#define GPIO_MODE_WEAK_PULL(gpio_x,pin)   	\
    do{Px_M1(gpio_x) &amp;= ~(pin); Px_M0(gpio_x) &amp;= ~(pin);}while(0)

/* GPIO设置为浮空输入模式宏函数。*/
#define GPIO_MODE_IN_FLOATING(gpio_x,pin) 	\
    do{ Px_M1(gpio_x) |=  (pin); Px_M0(gpio_x) &amp;= ~(pin);}while(0)

/* GPIO设置为开漏输出模式宏函数。*/
#define GPIO_MODE_OUT_OD(gpio_x,pin) 		\
    do{Px_M1(gpio_x) |=  (pin); Px_M0(gpio_x) |=  (pin);}while(0)

/* GPIO设置为推挽输出模式宏函数。*/
#define	GPIO_MODE_OUT_PP(gpio_x,pin) 		\
    do{Px_M1(gpio_x) &amp;= ~(pin); Px_M0(gpio_x) |=  (pin);}while(0)
</code></pre>
    <h6>
     <a id="5_if__369">
     </a>
     （5）使用 if 优化模式配置宏函数
    </h6>
    <pre><code>#define GPIO_Init(gpio_x, pin, mode)					\
    do{ if(mode &amp; 0x01)	Px_M0(gpio_x) |= (pin);			\
        else	Px_M0(gpio_x) &amp;= ~(pin);				\
        if((mode &amp; 0x02))	Px_M1(gpio_x) |= (pin);		\
        else	Px_M1(gpio_x) &amp;= ~(pin);				\
    }while(0)
</code></pre>
    <h6>
     <a id="6_380">
     </a>
     （6）使用三目运算符优化模式配置宏函数
    </h6>
    <pre><code>#define GPIO_MODE_CFG(gpio_x, pin, mode)							  					  		\	
			do{ Px_M0(gpio_x) = ((mode &amp; 0x01)? Px_M0(gpio_x)|(pin) : Px_M0(gpio_x)&amp;(~pin));	\
				Px_M1(gpio_x) = ((mode &amp; 0x02)? Px_M1(gpio_x)|(pin) : Px_M1(gpio_x)&amp;(~pin));  	\	
			}while(0)
						
</code></pre>
    <p>
     看到这里，是不是有一种代码好美的感觉。
    </p>
    <hr/>
    <h3>
     <a id="_394">
     </a>
     三种模式对比
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        模式
       </th>
       <th>
        代码复杂度
       </th>
       <th>
        执行效率
       </th>
       <th>
        可读性
       </th>
       <th>
        适用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        寄存器直接操作
       </td>
       <td>
        高
       </td>
       <td>
        最高
       </td>
       <td>
        低
       </td>
       <td>
        需极致性能的实时控制
       </td>
      </tr>
      <tr>
       <td>
        标准库函数
       </td>
       <td>
        低
       </td>
       <td>
        中
       </td>
       <td>
        高
       </td>
       <td>
        快速开发与调试
       </td>
      </tr>
      <tr>
       <td>
        优化库函数
       </td>
       <td>
        中
       </td>
       <td>
        高
       </td>
       <td>
        中
       </td>
       <td>
        高效且可读的代码
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_401">
     </a>
     总结
    </h3>
    <p>
     通过三种编程模式的对比与示例，开发者可根据项目需求灵活选择实现方式：
    </p>
    <ul>
     <li>
      <strong>
       寄存器直接操作
      </strong>
      ：适合对性能要求极高的场景（如实时控制）。
     </li>
     <li>
      <strong>
       官方库函数
      </strong>
      ：适合快速开发与调试，代码可读性高。
     </li>
     <li>
      <strong>
       优化库函数
      </strong>
      ：在保证高效性的同时，提供对单个引脚的精准控制。
     </li>
    </ul>
    <p>
     通过合理选择模式，可兼顾开发效率与硬件性能，满足不同场景需求。顾性能与开发效率。
    </p>
    <p>
     <strong>
      终极奥义
     </strong>
     ：
     <br/>
     <strong>
      “通过重构库函数，深入单片机寄存器操作，悟出最佳逻辑，掌控单片机！”
     </strong>
    </p>
    <p>
     希望本教程对您有所帮助，祝您在嵌入式开发的道路上取得更大的成功！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363431393430392f:61727469636c652f64657461696c732f313436323638333032" class_="artid" style="display:none">
 </p>
</div>


