---
layout: post
title: "深入解析跨域问题及其解决方案从原理到代码实践"
date: 2025-03-09 18:30:22 +0800
description: "CORS：适用于现代浏览器，支持复杂请求。JSONP：适用于简单场景，但功能有限。代理服务器：通过同源服务器中转请求，适用于复杂场景。WebSocket：适用于实时通信。：适用于跨文档通信。理解这些解决方案的代码实现，有助于在实际开发中灵活应对跨域问题，同时确保安全性和性能。"
keywords: "深入解析跨域问题及其解决方案：从原理到代码实践"
categories: ['未分类']
tags: ['后端', '前端']
artid: "146136339"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146136339
    alt: "深入解析跨域问题及其解决方案从原理到代码实践"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146136339
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146136339
cover: https://bing.ee123.net/img/rand?artid=146136339
image: https://bing.ee123.net/img/rand?artid=146136339
img: https://bing.ee123.net/img/rand?artid=146136339
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     深入解析跨域问题及其解决方案：从原理到代码实践
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      跨域问题
     </strong>
     是前端开发中常见的安全限制问题，主要源于浏览器的
     <strong>
      同源策略
     </strong>
     （Same-Origin Policy）。同源策略限制了从一个源加载的文档或脚本如何与另一个源的资源进行交互。为了更深入地理解跨域问题及其解决方案，我们需要从原理、限制条件以及具体解决方案等多个角度进行分析。
    </p>
    <h3>
     <a id="1_CORS_3">
     </a>
     1. CORS（跨域资源共享）
    </h3>
    <h4>
     <a id="11__CORS__5">
     </a>
     1.1 简单请求的 CORS 处理
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        前端代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        服务器响应头
       </strong>
       ：
      </p>
      <pre><code class="prism language-http">Access-Control-Allow-Origin: https://www.example.com
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="12__CORS__24">
     </a>
     1.2 非简单请求的 CORS 处理
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        前端代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'Authorization'</span><span class="token operator">:</span> <span class="token string">'Bearer token'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        服务器响应头
       </strong>
       ：
      </p>
      <pre><code class="prism language-http">Access-Control-Allow-Origin: https://www.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="13__Cookie__47">
     </a>
     1.3 携带 Cookie 的跨域请求
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        前端代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        服务器响应头
       </strong>
       ：
      </p>
      <pre><code class="prism language-http">Access-Control-Allow-Origin: https://www.example.com
Access-Control-Allow-Credentials: true
</code></pre>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2_JSONPJSON_with_Padding_67">
     </a>
     2. JSONP（JSON with Padding）
    </h3>
    <h4>
     <a id="21__69">
     </a>
     2.1 实现原理
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        前端代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://api.example.com/data?callback=handleResponse'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        服务器返回
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="3__88">
     </a>
     3. 代理服务器
    </h3>
    <h4>
     <a id="31__Nginx__90">
     </a>
     3.1 使用 Nginx 实现代理
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        Nginx 配置
       </strong>
       ：
      </p>
      <pre><code class="prism language-nginx">server {
    location /api/ {
        proxy_pass https://api.example.com/;
    }
}
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        前端代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="32__Nodejs__110">
     </a>
     3.2 使用 Node.js 实现代理
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        Node.js 代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> httpProxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> proxy <span class="token operator">=</span> httpProxy<span class="token punctuation">.</span><span class="token function">createProxyServer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    proxy<span class="token punctuation">.</span><span class="token function">web</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'https://api.example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        前端代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/api/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="4_WebSocket_135">
     </a>
     4. WebSocket
    </h3>
    <h4>
     <a id="41__137">
     </a>
     4.1 实现实时通信
    </h4>
    <ul>
     <li>
      <strong>
       前端代码
      </strong>
      ：
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://api.example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket connection established.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message from server:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket connection closed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5_postMessage_158">
     </a>
     5. postMessage
    </h3>
    <h4>
     <a id="51__160">
     </a>
     5.1 跨文档通信
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        父页面代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'https://child.example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        子页面代码
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">===</span> <span class="token string">'https://parent.example.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message from parent:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="6__178">
     </a>
     6. 结合代码的注意事项
    </h3>
    <h4>
     <a id="61__180">
     </a>
     6.1 安全性
    </h4>
    <ul>
     <li>
      <strong>
       CORS
      </strong>
      ：避免使用
      <code>
       Access-Control-Allow-Origin: *
      </code>
      ，除非明确允许所有源。
     </li>
     <li>
      <strong>
       JSONP
      </strong>
      ：确保回调函数名是动态生成的，避免 XSS 攻击。
     </li>
    </ul>
    <h4>
     <a id="62__184">
     </a>
     6.2 性能
    </h4>
    <ul>
     <li>
      <strong>
       CORS 预检请求
      </strong>
      ：尽量减少非简单请求的数量，优化服务器响应时间。
     </li>
     <li>
      <strong>
       代理服务器
      </strong>
      ：确保代理服务器的性能足够高，避免成为瓶颈。
     </li>
    </ul>
    <h4>
     <a id="63__188">
     </a>
     6.3 兼容性
    </h4>
    <ul>
     <li>
      <strong>
       CORS
      </strong>
      ：现代浏览器广泛支持，但需要服务器配合。
     </li>
     <li>
      <strong>
       JSONP
      </strong>
      ：兼容性较好，但功能有限，仅支持
      <code>
       GET
      </code>
      请求。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="7__194">
     </a>
     7. 总结
    </h3>
    <p>
     通过代码示例，我们可以清晰地看到每种跨域解决方案的具体实现和应用场景：
    </p>
    <ul>
     <li>
      <strong>
       CORS
      </strong>
      ：适用于现代浏览器，支持复杂请求。
     </li>
     <li>
      <strong>
       JSONP
      </strong>
      ：适用于简单场景，但功能有限。
     </li>
     <li>
      <strong>
       代理服务器
      </strong>
      ：通过同源服务器中转请求，适用于复杂场景。
     </li>
     <li>
      <strong>
       WebSocket
      </strong>
      ：适用于实时通信。
     </li>
     <li>
      <strong>
       postMessage
      </strong>
      ：适用于跨文档通信。
     </li>
    </ul>
    <p>
     理解这些解决方案的代码实现，有助于在实际开发中灵活应对跨域问题，同时确保安全性和性能。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37323930303134302f:61727469636c652f64657461696c732f313436313336333339" class_="artid" style="display:none">
 </p>
</div>


