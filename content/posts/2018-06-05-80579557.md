---
layout: post
title: "CentOS搭建云服务平台"
date: 2018-06-05 15:19:07 +0800
description: "目录目录前言创建主机配置主机网络安装环境前言最近在学习在centOS上搭建一个云服务平台，所以写下该"
keywords: "centos云服务"
categories: ['后端']
tags: ['虚拟机', '云服务', 'Centos']
artid: "80579557"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=80579557
    alt: "CentOS搭建云服务平台"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=80579557
featuredImagePreview: https://bing.ee123.net/img/rand?artid=80579557
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CentOS搭建云服务平台
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     目录
    </h2>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        目录
       </a>
      </li>
      <li>
       <a href="#_3" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#_6" rel="nofollow">
        创建主机
       </a>
      </li>
      <li>
       <a href="#_79" rel="nofollow">
        配置主机网络
       </a>
      </li>
      <li>
       <a href="#_104" rel="nofollow">
        安装环境
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#Xshell_106" rel="nofollow">
          使用Xshell
         </a>
        </li>
        <li>
         <a href="#_116" rel="nofollow">
          修改系统镜像源
         </a>
        </li>
        <li>
         <a href="#_139" rel="nofollow">
          开始安装环境
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_172" rel="nofollow">
        安装虚拟机
       </a>
      </li>
      <li>
       <a href="#_217" rel="nofollow">
        配置虚拟机网络
       </a>
      </li>
      <li>
       <a href="#_247" rel="nofollow">
        克隆虚拟机
       </a>
      </li>
      <li>
       <a href="#_281" rel="nofollow">
        网络桥接
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_284" rel="nofollow">
          修改主机网络配置
         </a>
        </li>
        <li>
         <a href="#_329" rel="nofollow">
          修改虚拟机网络配置
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_371" rel="nofollow">
        注意
       </a>
      </li>
      <li>
       <a href="#_395" rel="nofollow">
        参考资料
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_3">
     </a>
     前言
    </h2>
    <p>
     最近在学习在centOS上搭建一个云服务平台，所以写下该文章当做笔者的学习笔记，提供给大家一起学习。虽然我们没有办法实现像百度云、腾讯云、阿里云那么强大的云服务平台，但是可以学习它们这些思维，做一个简单的云平台给自己的团队或公司使用。
    </p>
    <h2>
     <a id="_6">
     </a>
     创建主机
    </h2>
    <p>
     我们的云服务器平台的结构是这样的：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2f8ba6ea6b5677c0abd50a98777b3a8b.png"/>
    </p>
    <p>
     这个平台是在一个主机，然后在主机中创建多个虚拟机给用户使用，所以我们首先要有一个主机。这个主机理论上是真正的物理机，同时有着非常多的物理资源，比如内存，磁盘，CPU等等。为了学习，我们在VMware中创建一个机器当做我们的主机，使用的系统是CentOS6.5。我们先要下载这个镜像，笔者使用的镜像是CentOS-6.5-x86_64-minimal.iso这个镜像，其下载地址是：http://vault.centos.org/6.5/isos/x86_64/CentOS-6.5-x86_64-minimal.iso 。
    </p>
    <p>
     我们在VMware创建一个新的虚拟机，操作如小：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ccf9f06634e33850498fc81db08b9faa.png"/>
    </p>
    <p>
     然后选择经典模型开始创建：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/62171798814d2956666a653fdacbf183.png"/>
    </p>
    <p>
     接下来是选择第三个的稍后安装操作系统：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/12301eb71c16885448aacc56eea2ee39.png"/>
    </p>
    <p>
     选择的系统类型是Linux，具体的是CentOS 64位：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/48b6f7e2af9c0ce28ef23da66ccd9f5a.png"/>
    </p>
    <p>
     然后是创建虚拟机的名字和磁盘所在的位置：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/17d610704dc5a7db385d371f7afaeb5f.png"/>
    </p>
    <p>
     这一步是硬件选择，不要急着下一步，我们要对硬件做一些处理：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/137b807e0401b1cf65c614f1c5dfc592.png"/>
    </p>
    <p>
     我们尽可能选择大的内存，和CPU的个数，但是也不能超过本身物理机的值。默认的网络是NAT的，不用修改：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5d20f126abf1a00368d14b736dbe6589.png"/>
    </p>
    <p>
     最后是选择镜像，就是选择刚才我们下载的CentOS-6.5-x86_64-minimal.iso镜像：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e8f00d75556f1c0190c4e11b90e7ae42.png"/>
    </p>
    <p>
     关闭之后就回到了这个，直接完成就可以了。
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d4c2d7c7cb5f2bd15beabaab1de8e691.png"/>
    </p>
    <p>
     完成之后就可以启动虚拟机了。
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ef7ccc16e1783f7c35de1961f464bbe2.png"/>
    </p>
    <p>
     启动之后，选择第一个开始安装镜像。顺便说一下，解锁鼠标的Ctrl+Alt。
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9ca2885dffa1300ced03843cf1b88c21.png"/>
    </p>
    <p>
     这里选择跳过：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2275c664446e7bbd8d5ac5226b4beaae.png"/>
    </p>
    <p>
     然后直接一步就可以了：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a7ad50eb212b8b501b58e7602d46449b.png"/>
    </p>
    <p>
     这里选系统的语言，比如笔者选择的是中文：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ff0385c6ca9b5365e2d9307f9a84262e.png"/>
    </p>
    <p>
     这样选择的是键盘的布局，我们的键盘基本上都是一样的布局方式，所以直接默认就可以了：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a5ac5343180df3545a23af427bdede43.png"/>
    </p>
    <p>
     这里也是直接默认：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/195fc6069853ceaea5013237716f183d.png"/>
    </p>
    <p>
     忽略所有数据，应该我们的虚拟磁盘本身就没有数据：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0a20ba5f0e225af4fdb23573f21c9aff.png"/>
    </p>
    <p>
     这里是修改主机名的，笔者就使用默认的主机名：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/375ff79f654f79f9c4d1a2e71ebbdaa5.png"/>
    </p>
    <p>
     这样是选择时区：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2511b1d781d046f8144fd3fb33eff700.png"/>
    </p>
    <p>
     然后是创建系统密码，长度不少于6
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c6d50e8f32c5ce800a72b8ebef40eddc.png"/>
    </p>
    <p>
     最后选择使用所有空间，开始写入数据：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e6f5b9a9b18fbd35abb4a8d1f806fbe1.png"/>
    </p>
    <p>
     等待安装，一段时间后就可以安装成功了：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1e8c7a6fdd9ff54269ce3cfe104e2c51.png"/>
    </p>
    <h2>
     <a id="_79">
     </a>
     配置主机网络
    </h2>
    <p>
     安装完成之后，还不能连接网络，所以我们要配置网络，首先我要先看看虚拟机的网段：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1986aa3a3bd75b70778befdda2b6581f.png"/>
    </p>
    <p>
     在这里可以看到VMnet8的网段为：
     <code>
      192.168.204.0
     </code>
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8f0cefe5d1c74673a7dd63fd1333d116.png"/>
    </p>
    <p>
     然后在系统的终端输入以下命令，编辑网络配置：
    </p>
    <pre><code class="prism language-text">vi /etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre>
    <p>
     修改内容如下，修改ONBOOT=yes，BOOTPROTO=static，增加IP地址、子网掩码、网关地址、DNS1：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/62a45de985085acce8933af475f3c446.png"/>
    </p>
    <p>
     最后重启一下网络：
    </p>
    <pre><code class="prism language-text">service network restart
</code></pre>
    <p>
     最后可以使用
     <code>
      ping
     </code>
     测试网络是否正常：
    </p>
    <pre><code class="prism language-text">ping www.baidu.com
</code></pre>
    <h2>
     <a id="_104">
     </a>
     安装环境
    </h2>
    <h3>
     <a id="Xshell_106">
     </a>
     使用Xshell
    </h3>
    <p>
     为了方便操作，笔者使用Xshell连接CentOS，可以直接在Xshell上操作CentOS，操作如下：
    </p>
    <ul>
     <li>
      <p>
       下载Xshell，地址为：https://www.netsarang.com/download/down_form.html?code=622&amp;downloadType=0&amp;licenseType=1
      </p>
     </li>
     <li>
      <p>
       启动 Xshell 创建新连接，如下：
       <br/>
       <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ca5192224f28b2b28a6a113e4195af0e.png"/>
      </p>
     </li>
     <li>
      <p>
       输入账号和密码就可以连接成功了，在Xshell上跟在原系统的终端是一样的
      </p>
     </li>
    </ul>
    <h3>
     <a id="_116">
     </a>
     修改系统镜像源
    </h3>
    <p>
     为了加快下载资源的速度，笔者把下载资源的地址改成阿里巴巴的镜像源，操作如下：
    </p>
    <ol>
     <li>
      首先备份原来的CentOS-Base.repo
     </li>
    </ol>
    <pre><code class="prism language-text">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
</code></pre>
    <ol start="2">
     <li>
      安装wget命令，命令如下：
     </li>
    </ol>
    <pre><code class="prism language-text">yum -y install wget
</code></pre>
    <ol start="3">
     <li>
      下载镜像源，命令如下：
     </li>
    </ol>
    <pre><code class="prism language-text">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
</code></pre>
    <ol start="4">
     <li>
      最后生成缓存，命令如下：
     </li>
    </ol>
    <pre><code class="prism language-text">yum makecache
</code></pre>
    <h3>
     <a id="_139">
     </a>
     开始安装环境
    </h3>
    <p>
     安装依赖环境，只需要一条命令，命令入下：
    </p>
    <pre><code class="prism language-text">yum -y install qemu-kvm  virt-manager libvirt libvirt-python python-virtinst bridge-utils
</code></pre>
    <p>
     安装完成之后，需求启动一个服务方便之后的安装虚拟机：
    </p>
    <pre><code class="prism language-text">service libvirtd restart
</code></pre>
    <p>
     然后关闭防火墙，方便之后连接虚拟机，命令如下：
    </p>
    <pre><code class="prism language-text">service iptables stop
</code></pre>
    <p>
     创建一个文件夹用来保存虚拟机的镜像和虚拟磁盘的，命令如下：
    </p>
    <pre><code class="prism language-text">mkdir /kvmtest
</code></pre>
    <p>
     安装一个上传下载的工具，用于上传CentOS镜像，安装命令如下：
    </p>
    <pre><code class="prism language-text">yum -y install lrzsz
</code></pre>
    <p>
     然后使用命令
     <code>
      rz
     </code>
     把CentOS镜像上传到
     <code>
      /kvmtest
     </code>
     ，命令如下：
    </p>
    <pre><code class="prism language-text">cd /kvmtest
rz
</code></pre>
    <h2>
     <a id="_172">
     </a>
     安装虚拟机
    </h2>
    <p>
     现在安装虚拟机是在CentOS系统上安装的虚拟机，这个才是真正的云服务器。
    </p>
    <ul>
     <li>
      创建虚拟磁盘，命令如下：
     </li>
    </ul>
    <pre><code class="prism language-text">qemu-img create -f qcow2 /kvmtest/centos-6.5.qcow2  10G
</code></pre>
    <ul>
     <li>
      然后就可以创建虚拟机，第一行是指定虚拟机的名称和内存大小；第二行是指定CPU个数；第三行是指定系统镜像；第四行是指定虚拟磁盘的位置，也就是上一步创建的虚拟磁盘。
     </li>
    </ul>
    <pre><code class="prism language-text">virt-install --virt-type kvm --name centos-6.5 --ram 1024 \
--vcpus 1 \
--cdrom=/kvmtest/CentOS-6.5-x86_64-minimal.iso \
--disk /kvmtest/centos-6.5.qcow2,format=qcow2 \
--network network=default \
--graphics vnc,listen=0.0.0.0 --noautoconsole \
--os-type=linux --os-variant=rhel6
</code></pre>
    <ul>
     <li>
      <p>
       最后使用vnc完成安装，当执行上面的命令之后，我们需要下载一个vnc，官网下载链接为：https://www.realvnc.com/en/connect/download/vnc/ ，也可以百度搜索
       <code>
        vnc-4_1_3-x86_win32_viewer
       </code>
       下载，然后打开软件开始连接。IP地址是主机的地址，端口是5900，如果还有更多的虚拟机，端口就自加1，如：5901。如果连接不成功，而虚拟机有启动了，那可能是防火墙没关闭，需要关闭防火墙。
       <br/>
       <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d3f842cc3851733b0feb3c19de7dddbb.png"/>
      </p>
     </li>
     <li>
      <p>
       连接虚拟机之后，就可安装了，安装过程跟一开始安装主机的过程一样，这里集不重复介绍了。顺便提一下，这个软件只能在因为输入法下输入。
       <br/>
       <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9df43adcbee2fb6ef6cf60bfe183a956.png"/>
      </p>
     </li>
    </ul>
    <p>
     安装完成之后，还要重新启动，启动命令如下：
    </p>
    <pre><code class="prism language-text">virsh start centos-6.5
</code></pre>
    <p>
     既然说到virsh命令，那就说说virsh命令的使用：
    </p>
    <pre><code class="prism language-python">virsh <span class="token builtin">list</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">all</span>             <span class="token comment"># 显示本地活动虚拟机</span>
virsh start <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>      <span class="token comment"># 启动名字为ubuntu的非活动虚拟机</span>
virsh create <span class="token operator">&lt;</span>虚拟机名称<span class="token punctuation">.</span>xml<span class="token operator">&gt;</span> <span class="token comment"># 创建虚拟机（创建后，虚拟机立即启动）</span>
virsh resume <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>     <span class="token comment"># 启动暂停的虚拟机</span>
virsh shutdown <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>   <span class="token comment"># 正常关闭虚拟机</span>
virsh destroy <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>    <span class="token comment"># 强制关闭虚拟机</span>
virsh dominfo <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>    <span class="token comment"># 显示虚拟机的基本信息</span>
virsh dumpxml <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>    <span class="token comment"># 显示虚拟机的当前配置文件</span>
virsh setmem <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span> <span class="token number">51200</span> <span class="token comment"># 给不活动虚拟机设置内存大小</span>
virsh setvcpus <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token comment"># 给不活动虚拟机设置cpu个数</span>
virsh edit <span class="token operator">&lt;</span>虚拟机名称<span class="token operator">&gt;</span>       <span class="token comment"># 编辑配置文件（一般用在刚定义完VM）</span>
</code></pre>
    <h2>
     <a id="_217">
     </a>
     配置虚拟机网络
    </h2>
    <p>
     同样使用vi编辑网络配置文件：
    </p>
    <pre><code class="prism language-text">vi /etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre>
    <p>
     然后删除物理地址和UUID，并修改ONBOOT=yes，修改后如下：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e1a0d1af88914836ed4beeb51b7b3f88.png"/>
    </p>
    <p>
     最后重启一下网络，命令如下：
    </p>
    <pre><code class="prism language-text">service network restart
</code></pre>
    <p>
     测试网络是否可以正常使用，使用
     <code>
      ping
     </code>
     测试：
    </p>
    <pre><code class="prism language-text">ping www.baidu.com
</code></pre>
    <p>
     到这里就完成了虚拟机的安装，我们可以使用vnc连接我们的虚拟机，使用我们的虚拟机。
    </p>
    <p>
     在介绍virsh命令的时候，有介绍到使用
     <code>
      shutdown
     </code>
     在主机上关闭虚拟机，但是并不能直接使用，还需要在虚拟机中安装acpid，并启动acpid，同时还添加到开机服务中。命令如下：
    </p>
    <pre><code class="prism language-text">yum install acpid
service acpid start
chkconfig acpid on
</code></pre>
    <p>
     这样就可以在主机上使用
     <code>
      shutdown
     </code>
     关闭虚拟机了。
    </p>
    <h2>
     <a id="_247">
     </a>
     克隆虚拟机
    </h2>
    <p>
     如果需要多个虚拟机，但有想一个一个安装，可以复制之前文件，然后做适当的修改就可以快速创建一个新的虚拟机了。
    </p>
    <ul>
     <li>
      复杂虚拟磁盘，在
      <code>
       /kvmtest/
      </code>
      下我们有创建一个虚拟磁盘centos-6.5.qcow2，我们可以复制这个文件并改名，命令如下：
     </li>
    </ul>
    <pre><code class="prism language-text">cp centos-6.5.qcow2 centos-6.5-2.qcow2
</code></pre>
    <ul>
     <li>
      然后进入到
      <code>
       /etc/libvirt/qemu
      </code>
      目录下，复制centos-6.5.xml并改名，命令如下：
     </li>
    </ul>
    <pre><code class="prism language-text">cp centos-6.5.xml centos-6.5-2.xml
</code></pre>
    <ul>
     <li>
      <p>
       然后修改centos-6.5-2.xml中的内容，修改名称跟之前的复制文件命名一样，然后删除uuid。修改虚拟磁盘的位置，指定上面复制的虚拟磁盘。删除虚拟机物理地址。如下：
       <br/>
       <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7a57798a32ab8e38936da6953e8eaf3d.png"/>
       <br/>
       <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6766ad8831b1bfff4e7499233d37b27a.png"/>
       <br/>
       <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4399168d1e420eb4c59d5bcef855ce6b.png"/>
      </p>
     </li>
     <li>
      <p>
       最后创建虚拟机，命令如下：
      </p>
     </li>
    </ul>
    <pre><code class="prism language-text">virsh create centos-6.5-2.xml
</code></pre>
    <p>
     这样就已经创建一个虚拟机了，使用命令
     <code>
      virsh list --all
     </code>
     查看：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e037bf5c0f5d3b02590a0d6c8d113197.png"/>
    </p>
    <p>
     不过还不能正常连接网络，还要删除一个文件并重启网络服务：
    </p>
    <pre><code class="prism language-text">rm -rf /etc/udev/rules.d/70-persistent-net.rules
service network restart
</code></pre>
    <p>
     这样就完整克隆了一个虚拟机了。
    </p>
    <h2>
     <a id="_281">
     </a>
     网络桥接
    </h2>
    <p>
     我们在使用虚拟机的时候，是使用vnc连接主机IP地址加端口号，通过主机来映射到虚拟机的。这是很不合理的，比如现在的腾讯云等的云服务器都是直接连接服务器的IP地址的，所以我们要对虚拟机的网络进行处理，使得它可以在外界直接访问。因为虚拟机现在是通过路由转换的，所以外界是不能够直接访问到虚拟机的，我们要把它的网络修改成桥接的方式，这才能在外界直接访问和连接这个虚拟机。
    </p>
    <h3>
     <a id="_284">
     </a>
     修改主机网络配置
    </h3>
    <p>
     进入到该目录下，准备对网络文件进行配置：
    </p>
    <pre><code class="prism language-text">cd /etc/sysconfig/network-scripts/
</code></pre>
    <p>
     然后复制原来的网络配置文件，方便之后的修改：
    </p>
    <pre><code class="prism language-text">cp ifcfg-eth0 ifcfg-br100
</code></pre>
    <p>
     然后编辑原来的网络配置文件
     <code>
      vi ifcfg-eth0
     </code>
     ，修改如下，注销无用的配置，注意添加了
     <code>
      BRIDGE
     </code>
     和修改了
     <code>
      BOOTPROTO=none
     </code>
     ：
    </p>
    <pre><code class="prism language-text">DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
# NM_CONTROLLED=yes
BOOTPROTO=none
BRIDGE=br100
# IPADDR=192.168.171.127
# NETNASK=255.255.255.0
# GATEWAY=192.168.171.2
# DNS1=192.168.171.2
</code></pre>
    <p>
     然后编辑原来的网络配置文件
     <code>
      vi ifcfg-br100
     </code>
     ，注意笔者修改了
     <code>
      DEVICE
     </code>
     和
     <code>
      TYPE
     </code>
     ，IP地址还是原来的IP地址，不用修改：
    </p>
    <pre><code class="prism language-text">DEVICE=br100
TYPE=Bridge
ONBOOT=yes
# NM_CONTROLLED=yes
BOOTPROTO=static
IPADDR=192.168.171.127
NETNASK=255.255.255.0
GATEWAY=192.168.171.2
DNS1=192.168.171.2
</code></pre>
    <p>
     然后重启网络服务，命令如下：
    </p>
    <pre><code class="prism language-text">service network restart
</code></pre>
    <p>
     最后可以使用命令
     <code>
      ifconfig
     </code>
     查看网络是否配置成功。
    </p>
    <h3>
     <a id="_329">
     </a>
     修改虚拟机网络配置
    </h3>
    <p>
     在主机上编辑虚拟机的配置文件，主要是修改网络配置，在虚拟机关闭后操作。命令如下：
    </p>
    <pre><code class="prism language-text">virsh edit centos-6.5
</code></pre>
    <p>
     主要是修改以下这些配置文件，其中修改
     <code>
      type='bridge'
     </code>
     ，然后删除mac地址，这里为了方便读者观察，显示在这里，实际是删除的了，每次重启虚拟机都会自动生成的。最后修改
     <code>
      &lt;source bridge='br100'/&gt;
     </code>
     ，修改后如下：
    </p>
    <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>interface</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>bridge<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mac</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>52:54:00:27:5a:65<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">bridge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>br100<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>model</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>virtio<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>address</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>pci<span class="token punctuation">'</span></span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0x0000<span class="token punctuation">'</span></span> <span class="token attr-name">bus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0x00<span class="token punctuation">'</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0x03<span class="token punctuation">'</span></span> <span class="token attr-name">function</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0x0<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>interface</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     修改完成之后，启动虚拟机，命令如下：
    </p>
    <pre><code class="prism language-text">virsh start centos-6.5
</code></pre>
    <p>
     然后关闭防火墙，因为接下来还要使用vnc来连接虚拟机，关闭防火墙命令如下：
    </p>
    <pre><code class="prism language-text">service iptables stop
</code></pre>
    <p>
     之后使用vnc连接虚拟机，主要主机的IP地址和端口号。连接之后，删除虚拟机的网络规则，命令如下：
    </p>
    <pre><code class="prism language-text">rm -rf /etc/udev/rules.d/70-persistent-net.rules
</code></pre>
    <p>
     删除这个文件之后，可以重启一下虚拟机，使用命令
     <code>
      init 6
     </code>
     进行重启。
    </p>
    <p>
     重启虚拟机之后，使用
     <code>
      ifconfig
     </code>
     查看网络是否配置成功，然后使用
     <code>
      ping
     </code>
     命令尝试
     <code>
      ping
     </code>
     外网，如：
    </p>
    <pre><code class="prism language-text">ping www.baidu.com
</code></pre>
    <p>
     如果访问外网正常，那使用Xshell连接我们所创建的虚拟机，如何成功连接，那就达到我们的需求了，真正创建一个云服务器了。
    </p>
    <p>
     多个云服务器到底有什么用呢，在下一篇文章
     <a href="https://blog.doiduoyi.com/articles/1584972693454.html" rel="nofollow">
      《在CentOS上使用Nginx和Tomcat搭建高可用高并发网站》
     </a>
     介绍如何使用多个机器搭建一个高可用高并发的网站服务器，这种情况下就需要多个服务器了，这种情况下就可以使用云服务平台了。
    </p>
    <h2>
     <a id="_371">
     </a>
     注意
    </h2>
    <p>
     这里要说一下的是，我们为了方便外界可以访问到服务器的端口，我们把防火墙关闭了，但是这种是非常不安全的。所以我们可以单独开放某一端口，比如我们要开放MySQL数据库的3306端口号，操作如下：
    </p>
    <p>
     编辑防火墙配置文件：
    </p>
    <pre><code class="prism language-text">vim /etc/sysconfig/iptables
</code></pre>
    <p>
     添加以下信息：
    </p>
    <pre><code class="prism language-text">-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT
</code></pre>
    <p>
     如下图所示：
     <br/>
     <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/179cfe39af3dc2f54530d2cd5d33250f.png"/>
    </p>
    <p>
     保存退出，最后重启防火墙：
    </p>
    <pre><code class="prism language-text">service iptables restart
</code></pre>
    <p>
     开放其他端口也是同样的操作。
    </p>
    <h2>
     <a id="_395">
     </a>
     参考资料
    </h2>
    <ol>
     <li>
      https://opsx.alibaba.com/mirror
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f71715f3333323030393637:2f61727469636c652f64657461696c732f3830353739353537" class_="artid" style="display:none">
 </p>
</div>


