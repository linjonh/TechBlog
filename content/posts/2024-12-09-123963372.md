---
layout: post
title: "物联网设备接入阿里云"
date: 2024-12-09 14:03:11 +0800
description: "本文介绍了通过FS724模块连接阿里云平台，实现传感器数据上传与存储的过程。主要内容包括：注册阿里云"
keywords: "物联网设备接入"
categories: ['嵌入式基础知识']
tags: ['物联网', '嵌入式硬件']
artid: "123963372"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123963372
    alt: "物联网设备接入阿里云"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123963372
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123963372
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     物联网设备接入——阿里云
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-left:0;text-align:left;">
     <span style="color:#000000;">
      背景：近年来，物联网技术在工业、农业、环境、交通、物流以及安保等领域具有广泛的应用，其核心框架为：1. 传感器实时采集现实世界的的物理信息; 2. 通过计算机技术实现系统的全局优化，进行资源的合理分配，进而提高加工生产效率。因此，近来购买了dtu模块（FS724模块），实现mcu与阿里云平台的连接；整个过程中完成了物理模型创建，数据解析程序的编写调试，规则的创建以及数据保存等环节的调试工作，在此基础上，相关的内容进行了简要的整理，具体如下所示：
     </span>
     <br/>
     <br/>
     <img alt="" height="560" src="https://i-blog.csdnimg.cn/blog_migrate/39e6f1452703cbf041565be53916c645.png" width="1080">
      <br/>
      <br/>
      <span style="color:#000000;">
       目标：1. 将传感器采集数据的上传到阿里云平台；2. 将数据保存到云平台；
       <br/>
       <br/>
       需要准备的材料：1. dtu模块（FS724模块）；2. 阿里云平台账号申请；3. ttl串口工具；4. 电源；5. 导线若干；
      </span>
      <br/>
      <br/>
      <img alt="" height="386" src="https://i-blog.csdnimg.cn/blog_migrate/a6b8e0dd7e1ccfd33f86ab9db130c23b.png" width="427">
       <span style="color:#000000;">
       </span>
       <img alt="" height="660" src="https://i-blog.csdnimg.cn/blog_migrate/f2eadc912e4ab45fc7b07d9c6afcb135.png" width="938">
        <br/>
        <br/>
        <span style="color:#000000;">
         主要步骤：
         <br/>
         1. 注册阿里云平台，创建产品及设备，获取设备证书（三元组）（网上有大量的教程，该过程不赘述），具体结果如下图所示：
        </span>
        <br/>
        <br/>
        <img alt="" height="384" src="https://i-blog.csdnimg.cn/blog_migrate/723e589f5994cce5d9c43bb32ea081bb.png" width="1080">
         <br/>
         <img alt="" height="481" src="https://i-blog.csdnimg.cn/blog_migrate/712d93db82608b85e644b63358a59dc7.png" width="792">
          <br/>
          <span style="color:#000000;">
           2. 通过usb-TTL串口工具，将FS724模块与电脑连接；主要引脚有：VIN、GND、TX、RX；其中，电路板需要单独的电源供电（非常关键）（血泪教训）；具体过程如下图所示：
          </span>
          <br/>
          <br/>
          <img alt="" height="233" src="https://i-blog.csdnimg.cn/blog_migrate/5be4e935e2cb34528f701d4df45ef98e.png" width="919">
           <span style="color:#000000;">
            <br/>
            <br/>
            <br/>
            模块与电脑连接成功后，点击“读取所有参数”按钮，返回读取成功的信息提示；
           </span>
           <br/>
           <br/>
           <img alt="" height="594" src="https://i-blog.csdnimg.cn/blog_migrate/1fe4585f75fba928d4e1c8d465a5b638.png" width="870">
            <br/>
            <br/>
            <br/>
            <span style="color:#000000;">
             3. 打开YunDTU ConfigTool工具，点击socket参数，配置阿里云接口信息，将产品三元组信息填写到相应位置；
            </span>
            <br/>
            <br/>
            <img alt="" height="660" src="https://i-blog.csdnimg.cn/blog_migrate/6789bab868415ee55e3d7e1c75adb79f.png" width="1079">
             <br/>
             <br/>
             <span style="color:#000000;">
              4.
             </span>
             <span style="color:#000000;">
              登录阿里云平台，配置解析程序；（后续步骤较为关键，核心内容）
             </span>
             <br/>
             <br/>
             <br/>
             <img alt="" height="720" src="https://i-blog.csdnimg.cn/blog_migrate/f9dae4f7a00f5706be71a2d42f51ad0c.png" width="852">
              <br/>
              <br/>
              <br/>
              <img alt="" height="456" src="https://i-blog.csdnimg.cn/blog_migrate/59983d3d0bf98bc1eb990605b0f5d5f2.png" width="1078"/>
              <br/>
              <br/>
              <br/>
              采用Javascipt脚本语言，将解析程序嵌入到阿里云平台
             </img>
            </img>
           </img>
          </img>
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <p>
     <span title="点击并拖拽以改变尺寸">
      <span title="点击并拖拽以改变尺寸">
       <span title="点击并拖拽以改变尺寸">
        <span title="点击并拖拽以改变尺寸">
         <span title="点击并拖拽以改变尺寸">
          <span title="点击并拖拽以改变尺寸">
           <span title="点击并拖拽以改变尺寸">
            <span title="点击并拖拽以改变尺寸">
             <span title="点击并拖拽以改变尺寸">
              <span title="点击并拖拽以改变尺寸">
               采用Javascipt脚本语言，将解析程序嵌入到阿里云平台
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     "3"/**
    </p>
    <p>
     <em>
      将设备自定义
     </em>
     <em>
      topic
     </em>
     <em>
      数据转换为
     </em>
     <em>
      json
     </em>
     <em>
      格式数据
     </em>
     <em>
      ,
     </em>
     <em>
      设备上报数据到物联网平台时调用
     </em>
     <br/>
    </p>
    <p>
     <em>
      入参：
     </em>
     <em>
      topic string
     </em>
     <em>
      设备上报消息的
     </em>
     <em>
      topic
     </em>
     <br/>
    </p>
    <p>
     <em>
      入参：
     </em>
     <em>
      rawData byte[]
     </em>
     <em>
      数组
     </em>
     <em>
      不能为空
     </em>
     <br/>
    </p>
    <p>
     <em>
      出参：
     </em>
     <em>
      jsonObj JSON
     </em>
     <em>
      对象
     </em>
     <em>
      不能为空
     </em>
     <br/>
    </p>
    <p>
     <em>
      */
     </em>
     <br/>
    </p>
    <p>
     //
     <em>
      物联网平台
     </em>
     <em>
      Topic
     </em>
     <em>
      ，设备上传属性数据到云端。
     </em>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     function transformPayload(topic, rawData) {
     <!-- -->
     <br/>
    </p>
    <p>
     var jsonObj = {};
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     var dataSrc = String.fromCharCode.apply(String, rawData);
     <br/>
    </p>
    <p>
     var data = dataSrc.split(',');
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     //ALink JSON
     <em>
      格式，属性上报
     </em>
     <em>
      topic
     </em>
     <em>
      。
     </em>
     <br/>
    </p>
    <p>
     '1.0'//ALink JSON
     <em>
      格式，协议版本号固定字段。
     </em>
     <br/>
    </p>
    <p>
     <em>
      格式，标示该次请求
     </em>
     <em>
      id
     </em>
     <em>
      值。
     </em>
     <br/>
    </p>
    <p>
     var params = {};
     <br/>
    </p>
    <p>
     parseInt//
     <em>
      对应产品属性中
     </em>
     <em>
      prop_int16
     </em>
     <em>
      。
     </em>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     //ALink JSON
     <em>
      格式，
     </em>
     <em>
      params
     </em>
     <em>
      标准字段。
     </em>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <em>
      //  jsonObj.v = parseInt(data[1]);
     </em>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     return jsonObj;
     <br/>
    </p>
    <p>
     /font&gt;
    </p>
    <p>
     <br/>
     5. 云平台能够将传感器采集的数据保存在服务器端，后续通过算法解算设备的运行状态，其中，具体过程为：创建数据源，开通存储到表格（tablestore）功能等；
    </p>
    <p style="margin-left:0;text-align:left;">
     <br/>
     <br/>
     <br/>
     <img alt="" height="631" src="https://i-blog.csdnimg.cn/blog_migrate/cd7cd0ec014734d0e0b8ea92599ba90d.png" width="539"/>
     <br/>
     <br/>
     <span style="color:#000000;">
      6.
     </span>
     <span style="color:#000000;">
      配置数据流转规则，创建解析器，将数据源与表格存储链接到一起；（关键步骤）
     </span>
     <br/>
     <br/>
     <br/>
     <img alt="" height="295" src="https://i-blog.csdnimg.cn/blog_migrate/06bbb34a596d0c35e3fd3bbe6a162707.png" width="1078"/>
     <br/>
     <br/>
     <br/>
     <span style="color:#000000;">
      程序调试：
     </span>
     <br/>
     <br/>
     <br/>
     <img alt="" height="720" src="https://i-blog.csdnimg.cn/blog_migrate/13cc9cdf61036cecb98345dfde2ee62d.png" width="552"/>
     <br/>
     <br/>
     <br/>
     <span style="color:#000000;">
      编辑解析器脚本，具体程序代码为：
     </span>
    </p>
    <p style="margin-left:0;text-align:left;">
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       &lt;font size=
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "3"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       color=
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "#000000"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       &gt;
      </span>
     </span>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        //
       </span>
      </span>
     </em>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        通过
       </span>
      </span>
     </em>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        payload
       </span>
      </span>
     </em>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        函数，获取设备上报的消息内容，并按照
       </span>
      </span>
     </em>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        JSON
       </span>
      </span>
     </em>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        格式转换。
       </span>
      </span>
     </em>
    </p>
    <p style="margin-left:0;text-align:left;">
     <span style="background-color:#282c34;">
      <span style="color:#c678dd;">
       var
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       data = payload(
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "json"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       );
      </span>
     </span>
     <br/>
    </p>
    <p style="margin-left:0;text-align:left;">
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        //
       </span>
      </span>
     </em>
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        直接流转物模型上报数据。
       </span>
      </span>
     </em>
    </p>
    <p style="margin-left:0;text-align:left;">
     <em>
      <span style="background-color:#282c34;">
       <span style="color:#5c6370;">
        //var dianyatest = data.items.dianya.value;
       </span>
      </span>
     </em>
    </p>
    <p style="margin-left:0;text-align:left;">
     <span style="background-color:#282c34;">
      <span style="color:#c678dd;">
       var
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       dianya_value = getOrNull(data,
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "items"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       ,
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "dianya"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       ,
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "value"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       );
      </span>
     </span>
    </p>
    <p style="margin-left:0;text-align:left;">
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       writeTableStore(
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#d19a66;">
       1001
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       , {
       <!-- -->
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "timestamp"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       :timestamp(),
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#98c379;">
       "dianya"
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       :dianya_value});&lt;/
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#e06c75;">
       font
      </span>
     </span>
     <span style="background-color:#282c34;">
      <span style="color:#abb2bf;">
       &gt;
      </span>
     </span>
     <br/>
     <br/>
     <span style="color:#000000;">
      7.
     </span>
     <span style="color:#000000;">
      结果展示：通过阿里云平台，将传感器数据保存到表格中，后续可以进行特征识别
     </span>
     <br/>
     <br/>
     <br/>
     <img alt="" height="409" src="https://i-blog.csdnimg.cn/blog_migrate/11268f92c855a68486fdf6f49c496ce8.png" width="1078"/>
     <br/>
     <br/>
     <br/>
     <span style="color:#000000;">
      展示了阿里云平台将传感器传输的数据进行了保存的结果；
     </span>
     <br/>
     <br/>
     <br/>
     <span style="color:#000000;">
      8.
     </span>
     <span style="color:#000000;">
      钉钉助手配置：添加条件控制命令，当采集信号触发后，能够给后台提供预警信息，具体如下图所示;
     </span>
     <br/>
     <br/>
     <br/>
     <img alt="" height="339" src="https://i-blog.csdnimg.cn/blog_migrate/1e3efec34251aae74011bb1d52d9553f.png" width="670"/>
     <br/>
     <br/>
     <br/>
     <span style="color:#000000;">
      图b-c展示了系统对传感器采集的数据进行分析，当满足触发条件后(例如：传感器电压过低)，能够通过钉钉将设备状态告知用户端，实现设备的远程管理。
      <br/>
      <br/>
      整个过程中问题及解决方案：
     </span>
     <br/>
     <br/>
     <br/>
     <span style="color:#000000;">
      1. 数据传输过程中出现断开连接问题；
     </span>
     <br/>
     <br/>
     <img alt="" height="368" src="https://i-blog.csdnimg.cn/blog_migrate/38ce6ef49e0e31154449027b61e74422.jpeg" width="980"/>
     <br/>
     <br/>
     <span style="color:#000000;">
      解决方案：最开始测试中，发现信号传输的延时达到2s左右（震惊），后来发现电脑端口输出功率为2-4w，不能满足Fs724模块的功率（7W），引发连接不稳定的现象。
      <br/>
      <br/>
      3.数据解析功能；当整个系统对网络流量较为敏感、底端硬件配置较低或者资源受限等应用场景中，设备与阿里云进行通信时，一般采用透传/自定义数据格式的方式。例如：LoRaWAN温湿度传感器与阿里云进行通信时，传输的数据源文件为：000102（三个字节），后续通过阿里云平台的数据解析程序，转换为JSON格式数据；{"method":"thing.event.property.post","id":"12345", "params":{"Temperature":1,"Humidity":2}, "version":"1.1"}
     </span>
     <br/>
     <br/>
     <img alt="" height="659" src="https://i-blog.csdnimg.cn/blog_migrate/91eab00e817b1f21c609b68332ef0694.jpeg" width="936"/>
     <br/>
     <br/>
     <span style="color:#000000;">
      阿里云物理模型采用json格式数据，需要配置解析程序代码；
      <br/>
      ---------------------
      <br/>
      作者：mayuanliang
      <br/>
      链接：https://bbs.21ic.com/icview-3204928-1-1.html
      <br/>
      来源：21ic.com
      <br/>
      此文章已获得原创/原创奖标签，著作权归21ic所有，任何人未经允许禁止转载。
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f6963323132312f:61727469636c652f64657461696c732f313233393633333732" class_="artid" style="display:none">
 </p>
</div>


