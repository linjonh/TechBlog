---
layout: post
title: "重构及封装"
date: 2025-03-10 08:18:22 +0800
description: "1. 注册路由【通过两个函数】【把 router 传进去】2. 使用app.use(Router.routes())// 遍历所有的控制器，动态导入每个控制器模块。console.log('图书列表');ctx.body = '图书列表'ctx.body = '单个图书'ctx.body = '新增图书'ctx.body = '修改图书'\"name\":\"巴拉巴拉\"// 找到并遍历所有指定路径下的js文件。ctx.body = '删除'// 找到所有的控制器文件。// 找到所有的控制器文件。"
keywords: "重构及封装"
categories: ['未分类']
tags: ['重构', 'Windows', 'Javascript']
artid: "146143314"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146143314
    alt: "重构及封装"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146143314
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146143314
cover: https://bing.ee123.net/img/rand?artid=146143314
image: https://bing.ee123.net/img/rand?artid=146143314
img: https://bing.ee123.net/img/rand?artid=146143314
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     重构及封装
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     ## 重构笔记
    </p>
    <p>
     - 关键代码
    </p>
    <p>
     1. app.js
    </p>
    <p>
     ```js
    </p>
    <p>
     import koa from "koa"
    </p>
    <p>
     import router from "koa-router"
    </p>
    <p>
     import bodyparser from "koa-bodyparser"
    </p>
    <p>
     import { route } from "./router/index.js"
    </p>
    <p>
    </p>
    <p>
     const app = new koa()
    </p>
    <p>
     const Router = new router()
    </p>
    <p>
     app.use(bodyparser())
    </p>
    <p>
    </p>
    <p>
     // 找到并遍历所有指定路径下的js文件
    </p>
    <p>
    </p>
    <p>
     app.use(route)
    </p>
    <p>
     app.listen(4000)
    </p>
    <p>
     ```
    </p>
    <p>
    </p>
    <p>
     2. books.js
    </p>
    <p>
     ```js
    </p>
    <p>
     let list = async(ctx,next) =&gt;{
     <!-- -->
    </p>
    <p>
     console.log('图书列表');
    </p>
    <p>
     ctx.body = '图书列表'
    </p>
    <p>
     }
    </p>
    <p>
     let list_Id = async(ctx,next) =&gt;{
     <!-- -->
    </p>
    <p>
     let Id = ctx.params.Id
    </p>
    <p>
     ctx.body = '单个图书'
    </p>
    <p>
     }
    </p>
    <p>
     let list_add = async(ctx,next) =&gt;{
     <!-- -->
    </p>
    <p>
     ctx.body = '新增图书'
    </p>
    <p>
     }
    </p>
    <p>
     let list_update = async(ctx,next) =&gt;{
     <!-- -->
    </p>
    <p>
     let Id = ctx.params.Id
    </p>
    <p>
     ctx.body = '修改图书'
    </p>
    <p>
     }
    </p>
    <p>
     let list_del = async(ctx,next) =&gt;{
     <!-- -->
    </p>
    <p>
     ctx.body = '删除'
    </p>
    <p>
     }
    </p>
    <p>
    </p>
    <p>
     export const obj = {
     <!-- -->
    </p>
    <p>
     'get /books' : list,
    </p>
    <p>
     'get /books/:id' :list_Id,
    </p>
    <p>
     'post /books/' : list_add,
    </p>
    <p>
     'put /books/:id' : list_update,
    </p>
    <p>
     'delete /books' : list_del
    </p>
    <p>
     }
    </p>
    <p>
     ```
    </p>
    <p>
     3. router/index.js
    </p>
    <p>
     ```js
    </p>
    <p>
     import Router from "koa-router"
    </p>
    <p>
     import path from "path"
    </p>
    <p>
    </p>
    <p>
     import {FAllCon,Reg} from "./utils.js"
    </p>
    <p>
    </p>
    <p>
     let router =new Router()
    </p>
    <p>
    </p>
    <p>
     /*
    </p>
    <p>
     1. 注册路由【通过两个函数】【把 router 传进去】
    </p>
    <p>
     2. 使用app.use(Router.routes())
    </p>
    <p>
     */
    </p>
    <p>
    </p>
    <p>
     // 传路径
    </p>
    <p>
     let dir = '../Controller'
    </p>
    <p>
     <br/>
    </p>
    <p>
     // 找到所有的控制器文件
    </p>
    <p>
     let controllers = FAllCon(dir)
    </p>
    <p>
     <br/>
    </p>
    <p>
     // 注册路由
    </p>
    <p>
     Reg(router,controllers)
    </p>
    <p>
     <br/>
     <br/>
     <br/>
    </p>
    <p>
     /*
    </p>
    <p>
     1. 具名导出
    </p>
    <p>
     export let abc      // import {abc} from ''
    </p>
    <p>
     2. deefault {} 全场只能出现一个 default
    </p>
    <p>
     export default {}   // import x from ''
    </p>
    <p>
     */
    </p>
    <p>
     export let route = router.routes();
    </p>
    <p>
     ```
    </p>
    <p>
     4. router/utils.js
    </p>
    <p>
     ```js
    </p>
    <p>
     import { log } from 'console';
    </p>
    <p>
     import fs from 'fs'
    </p>
    <p>
     import path from "path"
    </p>
    <p>
    </p>
    <p>
     // 找到所有的控制器文件
    </p>
    <p>
     function findAllControllers(ConDir){
     <!-- -->
    </p>
    <p>
     // 使用绝对路径
    </p>
    <p>
     const ab = `F:/123/28/Controller`
    </p>
    <p>
    </p>
    <p>
     let aaa = fs.readdirSync(ab)
    </p>
    <p>
     console.log(aaa);
    </p>
    <p>
    </p>
    <p>
     if (fs.existsSync(ab)) {
     <!-- -->
    </p>
    <p>
     let allFile = fs.readdirSync(ab)
    </p>
    <p>
     let allConFiles = allFile.filter(x=&gt;x.endsWith('.js')).map(x=&gt;`file:///${ab}/${x}`)
    </p>
    <p>
    </p>
    <p>
     return allConFiles
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
    </p>
    <p>
     // 注册路由
    </p>
    <p>
     function regRouter(router,controllers){
     <!-- -->
    </p>
    <p>
     // 遍历所有的控制器，动态导入每个控制器模块
    </p>
    <p>
     controllers.forEach(async file =&gt; {
     <!-- -->
    </p>
    <p>
     // 动态导入模块
    </p>
    <p>
     let {obj} = await import(file)
    </p>
    <p>
     // 遍历对象
    </p>
    <p>
     for (const key in obj) {
     <!-- -->
    </p>
    <p>
     let x = key.split(' ')
    </p>
    <p>
     console.log(x);
    </p>
    <p>
    </p>
    <p>
     let [keyMethod,keyPath] = key.split(' ')
    </p>
    <p>
     let keyFn = obj[key]
    </p>
    <p>
     console.log(keyMethod);
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     if (keyMethod === 'get') {
     <!-- -->
    </p>
    <p>
     router.get(keyPath,keyFn)
    </p>
    <p>
     }
    </p>
    <p>
     if (keyMethod === 'post') {
     <!-- -->
    </p>
    <p>
     router.post(keyPath,keyFn)
    </p>
    <p>
     }
    </p>
    <p>
     if (keyMethod === 'delete') {
     <!-- -->
    </p>
    <p>
     router.delete(keyPath,keyFn)
    </p>
    <p>
     }
    </p>
    <p>
     if (keyMethod === 'put') {
     <!-- -->
    </p>
    <p>
     router.put(keyPath,keyFn)
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     });
    </p>
    <p>
     }
    </p>
    <p>
    </p>
    <p>
     export const FAllCon = findAllControllers
    </p>
    <p>
     export const Reg = regRouter
    </p>
    <p>
     ```
    </p>
    <p>
    </p>
    <p>
     5.
    </p>
    <p>
     ```h
    </p>
    <p>
     @url = http://localhost:4000
    </p>
    <p>
    </p>
    <p>
     ###
    </p>
    <p>
     GET {
     <!-- -->
     {url}}/blogs HTTP/1.1
    </p>
    <p>
     Content-Type: application/json
    </p>
    <p>
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     "name":"巴拉巴拉"
    </p>
    <p>
     }
    </p>
    <p>
     ###
    </p>
    <p>
     get {
     <!-- -->
     {url}}/blogs/:id HTTP/1.1
    </p>
    <p>
     ```
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e63:73646e2e6e65742f4368656e6531323334353637383931302f:61727469636c652f64657461696c732f313436313433333134" class_="artid" style="display:none">
 </p>
</div>


