---
layout: post
title: "win32汇编环境,对话框程序中创建托盘示例一"
date: 2025-03-14 22:45:39 +0800
description: "托盘，就是电脑桌面右下角那个角落里的图标，这里展示基本的应用方法。"
keywords: "win32汇编环境,对话框程序中创建托盘示例一"
categories: ['未分类']
tags: ['汇编']
artid: "146268829"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146268829
    alt: "win32汇编环境,对话框程序中创建托盘示例一"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146268829
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146268829
cover: https://bing.ee123.net/img/rand?artid=146268829
image: https://bing.ee123.net/img/rand?artid=146268829
img: https://bing.ee123.net/img/rand?artid=146268829
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     win32汇编环境,对话框程序中创建托盘示例一
    </h1>
   </div>
   <div class="article-resource-info-box">
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     ;运行效果
    </p>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/7b7ac790e40b47c08103eff7711b96f4.png"/>
    </p>
    <p style="text-align:center">
     <img alt="" src="https://i-blog.csdnimg.cn/direct/443ca9a5a2ea43a8bfd2a30c5f653a63.png"/>
    </p>
    <p>
     ;win32汇编环境,对话框程序中创建托盘示例一
     <br/>
     ;托盘，就是电脑桌面右下角那个角落里的图标，这里展示基本的应用方法。
     <br/>
     ;直接抄进RadAsm可编译运行。重要部分加备注。
     <br/>
     ;下面为asm文件
     <br/>
     ;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     .386
     <br/>
     .model flat,stdcall
     <br/>
     option casemap:none
     <br/>
     ;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     ; Include 文件定义
     <br/>
     include    windows.inc
     <br/>
     include    user32.inc
     <br/>
     include    kernel32.inc
     <br/>
     include    shell32.inc     ;添加必需的头文件
    </p>
    <p>
     includelib user32.lib
     <br/>
     includelib kernel32.lib
     <br/>
     includelib shell32.lib     ;添加必需的库文件
     <br/>
     ;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     ; 自定义函数声明
     <br/>
     DlgProc proto :DWORD,:DWORD,:DWORD,:DWORD   ;对话框窗口函数
     <br/>
     ;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     ;Equ 等值定义
    </p>
    <p>
     MAINDIALOG      equ 1
     <br/>
     ICO_MAIN        equ 1000                          ;图标
     <br/>
     WM_SHELLNOTIFY  equ WM_USER + 9                   ;自定义私人消息，用来处理托盘图标方面的反应
     <br/>
     IDI_TRAY        equ 2
     <br/>
     IDM_RESTORE     equ 100
     <br/>
     IDM_EXIT        equ 101
     <br/>
     ; 数据段
     <br/>
     .data
     <br/>
     szAppName       db "我在这里",0                  ;当鼠标在其上面时，显示的提示
     <br/>
     szRestoreString db "恢复窗口",0
     <br/>
     szExitString    db "退出程序",0
     <br/>
     .data?
     <br/>
     hInstance  HINSTANCE   ?
     <br/>
     Snote NOTIFYICONDATA   &lt;&gt;                        ;定义包含系统需要在通知区域中显示通知的信息的结构
     <br/>
     hPopupMenu dd          ?
     <br/>
     .const
    </p>
    <p>
     ; 代码段
     <br/>
     ;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     .code
     <br/>
     start:
     <br/>
     invoke GetModuleHandle, NULL
     <br/>
     mov    hInstance,eax
     <br/>
     invoke DialogBoxParam, hInstance,MAINDIALOG,NULL, addr DlgProc, NULL
     <br/>
     invoke ExitProcess,eax
     <br/>
     DlgProc proc hWnd:HWND, uMsg:UINT, wParam:WPARAM, lParam:LPARAM
     <br/>
     LOCAL pt:POINT
     <br/>
     <br/>
     .if uMsg == WM_INITDIALOG
     <br/>
     invoke    LoadIcon,hInstance,ICO_MAIN
     <br/>
     invoke    SendMessage,hWnd,WM_SETICON,ICON_BIG,eax
     <br/>
     <br/>
     invoke CreatePopupMenu                                                   ;创建弹出式菜单
     <br/>
     mov hPopupMenu,eax
     <br/>
     invoke AppendMenu,hPopupMenu,MF_STRING,IDM_RESTORE,addr szRestoreString  ;给创建的弹出式菜单增加项目
     <br/>
     invoke AppendMenu,hPopupMenu,MF_STRING,IDM_EXIT,addr szExitString
     <br/>
     .elseif uMsg == WM_SIZE                                          ;WM_SIZE消息是当窗口大小或位置发生变化时捕获的消息
     <br/>
     .if wParam == SIZE_MINIMIZED                             ;当窗口最小化时，则
     <br/>
     mov Snote.cbSize,sizeof NOTIFYICONDATA           ;NOTIFYICONDATA此结构的大小
     <br/>
     push hWnd
     <br/>
     pop Snote.hwnd                                   ;把相关联的主窗口句柄给这个结构变量
     <br/>
     mov Snote.uID,IDI_TRAY                           ;任务栏图标的应用程序定义标识符，就是其ID，这个用来区分你点了哪个不同的托盘图标
     <br/>
     mov Snote.uFlags,NIF_ICON+NIF_MESSAGE+NIF_TIP    ;指出在这个NOTIFYICONDATA结构中，哪些成员有效。这里指uCallbackMessage成员,hIcon成员,szTip成员有效
     <br/>
     mov Snote.uCallbackMessage,WM_SHELLNOTIFY        ;告诉NOTIFYICONDATA结构，当有消息在系统图标时，去找 WM_SHELLNOTIFY 这个私人消息处理
     <br/>
     invoke LoadIcon,hInstance,ICO_MAIN               ;加载图标
     <br/>
     mov Snote.hIcon,eax                              ;把图标给这个NOTIFYICONDATA结构
     <br/>
     invoke lstrcpy,addr Snote.szTip,addr szAppName   ;当鼠标停留在托盘图标上面时，显示的字符串
     <br/>
     invoke ShowWindow,hWnd,SW_HIDE                   ;把主窗口隐藏
     <br/>
     invoke Shell_NotifyIcon,NIM_ADD,addr Snote       ;调用Shell_NotifyIcon函数，把前面塞满内容的NOTIFYICONDATA结构当作参数给它.并告诉电脑，将图标添加消息发送到右下角的任务栏的状态区域
     <br/>
     .endif
     <br/>
     .elseif uMsg == WM_SHELLNOTIFY                                   ;处理自定义消息
     <br/>
     .if wParam == IDI_TRAY                                   ;如果是这个程序的托盘图标，则
     <br/>
     .if lParam == WM_RBUTTONDOWN                     ;如果鼠标单击右键，则
     <br/>
     invoke GetCursorPos,addr pt              ;得到当前鼠标的坐标并将X值及Y值给坐标结构 pt
     <br/>
     invoke SetForegroundWindow,hWnd          ;将创建指定窗口的线程引入前台并激活窗口
     <br/>
     invoke TrackPopupMenu,hPopupMenu,TPM_RIGHTALIGN,pt.x,pt.y,NULL,hWnd,NULL    ;在鼠标所点的位置显示所创建的菜单，并跟踪菜单上项的选择
     <br/>
     invoke PostMessage,hWnd,WM_NULL,0,0      ;发送空消息给主窗口
     <br/>
     .elseif lParam == WM_LBUTTONDBLCLK               ;如果鼠标左键双击时，则
     <br/>
     invoke SendMessage,hWnd,WM_COMMAND,IDM_RESTORE,0    ;发送WM_COMMAND消息，即后面的命令消息给主窗口，其wParam值是IDM_RESTORE，其lParam值是0
     <br/>
     .endif
     <br/>
     .endif
     <br/>
     .elseif uMsg == WM_COMMAND
     <br/>
     .if lParam == 0                                          ;选择菜单时
     <br/>
     invoke Shell_NotifyIcon,NIM_DELETE,addr Snote    ;删除图标
     <br/>
     mov eax,wParam
     <br/>
     .if ax == IDM_RESTORE                            ;如果是恢复主窗口，则恢复
     <br/>
     invoke ShowWindow,hWnd,SW_RESTORE
     <br/>
     .else
     <br/>
     invoke DestroyWindow,hWnd
     <br/>
     .endif
     <br/>
     .endif
     <br/>
     .elseif uMsg == WM_CLOSE
     <br/>
     invoke DestroyMenu,hPopupMenu                            ;退出时清除创建的菜单
     <br/>
     invoke EndDialog, hWnd,NULL
     <br/>
     .else
     <br/>
     mov eax,FALSE
     <br/>
     ret
     <br/>
     .endif
     <br/>
     mov eax,TRUE
     <br/>
     ret
     <br/>
     DlgProc endp
    </p>
    <p>
     end start
    </p>
    <p>
     ;下面为rc文件内容
     <br/>
     #include "resource.h"              //提示缺少该文件，可以在资源里下载
    </p>
    <p>
     //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     #define    MAINDIALOG      1
     <br/>
     #define    ICO_MAIN        1000    //图标
    </p>
    <p>
     //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
     <br/>
     ICO_MAIN    ICON        "Main.ico"
    </p>
    <p>
     //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
    </p>
    <p>
     //定义对话框
     <br/>
     MAINDIALOG DIALOG 10, 10, 205, 60
     <br/>
     STYLE  DS_CENTER | WS_CAPTION | WS_MINIMIZEBOX | WS_SYSMENU | WS_VISIBLE | WS_OVERLAPPED | DS_MODALFRAME | DS_3DLOOK
     <br/>
     CAPTION "对话框程序模版"
     <br/>
     FONT 12, "方正姚体"
     <br/>
     BEGIN
     <br/>
     CONTROL "点击最化小按钮则会缩为右下角的托盘", -1, "Static", WS_CHILD | WS_VISIBLE, 30, 20, 200, 10
     <br/>
     END
    </p>
    <p>
     //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f696c746f6b796f2f:61727469636c652f64657461696c732f313436323638383239" class_="artid" style="display:none">
 </p>
</div>


