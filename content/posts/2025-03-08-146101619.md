---
layout: post
title: "项目基于FreeRTOS的STM32四轴飞行器-六.2.4g通信"
date: 2025-03-08 17:36:35 +0800
description: "进行了2.4g通信模块的学习和调试"
keywords: "[项目]基于FreeRTOS的STM32四轴飞行器: 六.2.4g通信"
categories: ['基于Freertos的Stm32四轴飞行器']
tags: ['嵌入式硬件', '单片机', 'Stm', 'Mcu', 'Iot', 'C']
artid: "146101619"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146101619
    alt: "项目基于FreeRTOS的STM32四轴飞行器-六.2.4g通信"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146101619
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146101619
cover: https://bing.ee123.net/img/rand?artid=146101619
image: https://bing.ee123.net/img/rand?artid=146101619
img: https://bing.ee123.net/img/rand?artid=146101619
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [项目]基于FreeRTOS的STM32四轴飞行器: 六.2.4g通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Si24Ri_1">
     </a>
     一.Si24Ri原理图
    </h2>
    <p>
     Si24R1芯片原理图如下：
     <br/>
     右侧为晶振。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8843e4f59da74150a6babe0c89a7b591.png">
      <br/>
      模块芯片与主控芯片连接引脚如下：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e182e74091414ad6a03c646c5ae4e1d9.png">
       <br/>
       SI-EN：使能引脚。
       <br/>
       SI-IRO：可屏蔽中断信号，低电平有效。
       <br/>
       SPI1-NSS：片选信号。
       <br/>
       SPI1-CLK：时钟信号。
       <br/>
       SPI1-MOSI：主设备输出从设备输入。
       <br/>
       SPI1-MISO：主设备输入从设备输出。
      </img>
     </img>
    </p>
    <h2>
     <a id="Si24R1_13">
     </a>
     二.Si24R1芯片手册解读
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/38aac8bb4dcd4a06975e32fa2d7a95e8.png">
      <br/>
      信道取值范围1到126，如果两个人同时使用一个信道会导致干扰。
      <br/>
      <strong>
       状态机转换图：
      </strong>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6fcd6ee6376a46f5b60314ccd9992de9.png">
       <br/>
       <strong>
        TX工作模式：
       </strong>
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/088adfc62d0a4450982d51967634a410.png">
        <br/>
        <strong>
         RX工作模式：
        </strong>
        <br/>
        <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/58400600351e443991a263e47ce9afa6.png">
         <br/>
         <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7b5f60312b644f46a9b3e26c096a1644.png">
          <br/>
          当芯片数据过多处理不过来时，FIFO中可以存储三个数据包起到存储缓冲作用，当满了时接收到的数据包被自动丢掉。所以最好
          <strong>
           协调发送接收的频率
          </strong>
          相等，或者发送稍微慢一些。
          <br/>
          <strong>
           数据包处理协议：
          </strong>
          <br/>
          <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c50029c378e84e9d99ae951760c3b4f0.png">
           <br/>
           在实际代码编写时在负载数据中加入自己的数据校验。
           <br/>
           <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/05e5863c8cb84e09a808e7af32b6e29d.png"/>
          </img>
         </img>
        </img>
       </img>
      </img>
     </img>
    </p>
    <h2>
     <a id="_28">
     </a>
     三.驱动函数讲解
    </h2>
    <p>
     <strong>
      定义两个地址：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ba06354192ef41bb96c6c9b52469c8c7.png"/>
     <br/>
     <strong>
      定义两个缓冲区：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/acd99f2cb813454d9a08fcdaf8d8984b.png"/>
     <br/>
     <strong>
      在.h文件中extern两个缓冲区：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d1739fc189734fa9bbcb8fd359936a88.png"/>
     <br/>
     <strong>
      标记位：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/511f6f9e8b7448819822328ae2dd5cd1.png"/>
     <br/>
     <strong>
      写寄存器：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5762b99f71f640e096f81d69aa29a3e1.png"/>
     <br/>
     <strong>
      读寄存器：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2da678e2c9b24204830b84fb35b5d72f.png"/>
     <br/>
     <strong>
      写多个字节：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/31cc6cf054894fe08420c46008851fec.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/131db5970d0940fa891bacdc22921568.png"/>
     <br/>
     <strong>
      自检判断校验是否成功：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8725392f36ca4147addbec38f515f2fd.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/02535ee6d9464ea3af5041a2440588dd.png"/>
    </p>
    <h2>
     <a id="24g_47">
     </a>
     五.移植2.4g通讯（飞控部分）
    </h2>
    <p>
     文件夹创建.c.h文件，将代码复制粘贴进文件：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d2554cda891846f3a67c4f9fbb191656.png"/>
     <br/>
     配置为全双工模式，不能超过18M，设置为4分频：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/10fcce5f10a7403b994f8151af49a55e.png"/>
     <br/>
     观察配置引脚是否与原理图一致：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1ad72d7c713d45ddbc06e76bd8120f2b.png"/>
     <br/>
     配置片选信号NSS低电平有效，所以PA4引脚设置为高电平，使用时拉低电平：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ab34f3d4267343bc896a8e83c9544329.png"/>
     <br/>
     配置使能信号，默认使能：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/bd04ab6825464d838a772b9edd9d4382.png"/>
     <br/>
     配置IRQ中断输入引脚，低电平有效默认上拉：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1e9fe9ec94114586a55ac0da866f1888.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e31e2e6060dd461c8b88d58fc73c7cd7.png"/>
     <br/>
     .h文件2.4g通道设置：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/202ea09484734ebb872d27799d9c56e3.png"/>
     <br/>
     将该函数Driver_SPI_SwapByte定义：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2598957e4483414b9dd41a42bf2527be.png"/>
     <br/>
     在应用层编写Start函数，在中间自检：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/18c4e3c7b7f24c94b43026c4c47c70a9.png"/>
     <br/>
     App_Task中编写通信任务：
     <br/>
     与飞控任务优先级保持一致，与飞控任务重要性差不多。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/24b97f4cb5ac4fad9e29f58716283199.png"/>
     <br/>
     <strong>
      测试通讯任务：
     </strong>
     <br/>
     因为通讯任务和飞控任务优先级相同，所以可能会导致硬件出问题，在该处开头延时1000ms。使用Inf_Si24R1_TxPacket函数接受数据包，将数据保存在RX_BUFF中，返回值0接收到数据，1未接收到数据。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d340ec747bcb427d9659d0bcaec53346.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/350736611d594878ae69dfe670d16635.png"/>
    </p>
    <h2>
     <a id="24g_74">
     </a>
     六.移植2.4g通讯（遥控部分）
    </h2>
    <p>
     <strong>
      根据原理图配置SPI接口：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/60644356ee5447159947ca1c28af3c6a.png"/>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/784ed3e9600144b28c33a29131d22fe6.png"/>
     <br/>
     <strong>
      在keil中配置.h文件：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/395eb508e216477abeb0c860b5f8b93c.png"/>
     <br/>
     <strong>
      管理目录结构：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ee6fc079134e4b978f09a04f06c6ab89.png"/>
     <br/>
     删除多余功能后，
     <strong>
      编写通讯任务：
     </strong>
     <br/>
     将数据填入TX_BUFF并根据返回值判读发射成功与否。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/455e7190620042a7ac5528513f80e8fa.png"/>
     <br/>
     <strong>
      配置为发送模式：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/00e8e808867b4fc0bf45f05a8dfd11bb.png"/>
     <br/>
     根据原理图
     <strong>
      更改为串口一：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0f5dba53f08c4b46aecb9a0f35208880.png"/>
     <br/>
     <strong>
      飞控端
     </strong>
     串口有数据打印，通讯正常：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f2a4ca7b65164d628c1921482e14c303.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37343736393835342f:61727469636c652f64657461696c732f313436313031363139" class_="artid" style="display:none">
 </p>
</div>


