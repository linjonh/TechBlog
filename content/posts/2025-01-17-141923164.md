---
layout: post
title: "详解前端中的跨域及解决措施"
date: 2025-01-17 15:06:44 +0800
description: "针对浏览器的同源策略进行了详细的解释，文章中还包含了一些关于"
keywords: "前端跨域问题"
categories: ['前端基础']
tags: ['网络协议', '网络', '改行学It', '前端', 'Javascript', 'Http', 'Html']
artid: "141923164"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=141923164
    alt: "详解前端中的跨域及解决措施"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=141923164
featuredImagePreview: https://bing.ee123.net/img/rand?artid=141923164
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     详解前端中的跨域及解决措施
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1_0">
     </a>
     <em>
      <mark>
       1、跨越介绍
      </mark>
     </em>
    </h3>
    <h4>
     <a id="11_1">
     </a>
     1.1、概念
    </h4>
    <ol>
     <li>
      <code>
       概念
      </code>
      ：跨域是
      <code>
       浏览器
      </code>
      的
      <code>
       同源策略
      </code>
      产生的一个
      <code>
       限制
      </code>
     </li>
     <li>
      <code>
       同源策略
      </code>
      ：
      <ul>
       <li>
        浏览器制定的一个
        <code>
         安全策略
        </code>
        ，这个
        <code>
         安全策略
        </code>
        的主要目标是：不让我们向别人的
        <code>
         服务器
        </code>
        发起请求
       </li>
       <li>
        <code>
         同源策略
        </code>
        要求：
        <code>
         同域名
        </code>
        、
        <code>
         同端口号
        </code>
        、
        <code>
         同协议
        </code>
        ，
        <em>
         <strong>
          不符合同源策略的，浏览器为了安全会阻止这个请求
         </strong>
        </em>
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="12_6">
     </a>
     1.2、如何界定服务器是自己的还是别人的
    </h4>
    <ol>
     <li>
      查看请求的
      <code>
       "协议/端口/域名
      </code>
      " 这3个内容和
      <code>
       请求源
      </code>
      (当前打开页面的"协议/端口/域名")是否相同
     </li>
     <li>
      如果三者有一者不同，那么就会触发
      <code>
       跨域错误
      </code>
     </li>
    </ol>
    <h4>
     <a id="13_9">
     </a>
     1.3、常见源
    </h4>
    <ol>
     <li>
      常见源1：
      <code>
       file:///E:/
      </code>
      ——没有域名/端口 =&gt; 本地磁盘的路径
     </li>
     <li>
      常见源2：
      <code>
       http://127.0.0.1:5500/
      </code>
      ——协议是：http，域名是：127.0.0.1，端口是：5500 =&gt; 在服务器打开的路径
     </li>
    </ol>
    <h4>
     <a id="14_13">
     </a>
     1.4、如何解决跨域错误
    </h4>
    <ol>
     <li>
      注意：如果
      <code>
       服务端
      </code>
      不想给
      <code>
       跨域请求数据
      </code>
      ，那么我们解决不了跨域问题
     </li>
     <li>
      <code>
       跨域
      </code>
      这件事其实
      <code>
       主导者
      </code>
      还是在
      <code>
       服务端
      </code>
      ，如果服务端允许我们的跨域请求，那么就可以发起跨域请求，反之就不能发起请求
     </li>
    </ol>
    <h4>
     <a id="15_16">
     </a>
     1.5、示例跨域错误
    </h4>
    <pre><code class="prism language-javascript"><span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span> <span class="token string">"click"</span> <span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 演示：向百度发起一个ajax请求 =&gt; 这里的演示只要是和当前源的协议、端口、域名不一致的即可 </span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>
  <span class="token comment">// 报错：报错信息中的No 'Access-Control-Allow-Origin'这段话表示ajax请求是违背了同源策略的，此时不可以发送ajax请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="2JSONP_27">
     </a>
     <em>
      <mark>
       2、解决跨域——JSONP
      </mark>
     </em>
    </h3>
    <h4>
     <a id="21_28">
     </a>
     2.1、解释
    </h4>
    <blockquote>
     <p>
      把原本的
      <code>
       ajax请求
      </code>
      ——替换成：在
      <code>
       "script"标签
      </code>
      的
      <code>
       "src"属性
      </code>
      发起请求
     </p>
    </blockquote>
    <ol>
     <li>
      <code>
       示例
      </code>
      ：
      <ul>
       <li>
        <code>
         &lt;script src="https://www.baidu.com"&gt;&lt;script&gt;
        </code>
        ——向百度发起请求
       </li>
      </ul>
     </li>
     <li>
      <code>
       解释
      </code>
      ：
      <ul>
       <li>
        如果我们定义了一个带有src属性的script标签，那么浏览器就会根据script标签的src属性发起请求
       </li>
       <li>
        注意1：我们当前发起的请求，它的响应数据会被当成js来执行！要求响应数据必须符合js代码执行标准，是有意义的js代码 =&gt; 告知服务端给我们返回的响应数据必须是有意义的js代码
       </li>
       <li>
        注意2：我们当前发起的请求，请求方式只能是get =&gt; 因为script标签发出去的请求没有什么危害性，也算是ajax请求的"阉割版"
       </li>
      </ul>
     </li>
     <li>
      <code>
       和ajax请求的区别
      </code>
      ：
      <ul>
       <li>
        发起的请求响应会被当作js代码立即执行，而ajax返回的请求响应是被放在对象中的一条属性
       </li>
       <li>
        ajax可以任意使用请求方式
       </li>
      </ul>
     </li>
     <li>
      <code>
       查看请求是否发送
      </code>
      ：
      <ul>
       <li>
        在网络请求部分将过滤分页调成js
       </li>
       <li>
        左侧的请求图标是黄色的——把百度的代码当成js来解释
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="22_43">
     </a>
     2.2、注意
    </h4>
    <ol>
     <li>
      当前的
      <code>
       script标签请求
      </code>
      会在页面打开后就立即发送
     </li>
     <li>
      这会导致有了响应数据后，如果没有全局函数会报错，所以这种请求一定要放在全局函数创建后，再进行请求发起！
     </li>
    </ol>
    <h4>
     <a id="23_46">
     </a>
     2.3、面试
    </h4>
    <ol>
     <li>
      <code>
       问题
      </code>
      ：jsonp原理
     </li>
     <li>
      <code>
       回答
      </code>
      ：动态创建script标签，src属性指向没有跨域限制
     </li>
    </ol>
    <h4>
     <a id="24_49">
     </a>
     2.4、示例
    </h4>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>demo-1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 1、先设置好回调函数 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  
  <span class="token comment">&lt;!-- 2、发送jsonp请求并携带数据 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&amp;wd=你好&amp;cb=callback<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="3CORS_73">
     </a>
     <em>
      <mark>
       3、解决跨域——CORS跨域
      </mark>
     </em>
    </h3>
    <h4>
     <a id="31_74">
     </a>
     3.1、简述概念
    </h4>
    <ol>
     <li>
      <code>
       CORS跨域
      </code>
      ：
      <ul>
       <li>
        CORS是在服务端返回响应的时候，向响应头中添加可以跨域访问的响应头信息实现的 =&gt; 在服务端添加响应头实现的跨域方案
       </li>
       <li>
        在条件允许的情况下，尽可能的使用CORS的跨域会比较好
       </li>
      </ul>
     </li>
     <li>
      <code>
       问题
      </code>
      ：向目标服务器发起请求：http://localhost:8889报错
      <ul>
       <li>
        解释：如果用当前页面(open in default browser / live server)发起请求就会产生跨域问题，因为和目标服务器的路径不一致
       </li>
       <li>
        解决：
        <ul>
         <li>
          注意1：要先开启测试服务器，再通过当前页面向测试服务器发起请求 =&gt; 另外：使用CORS跨域的时候，服务端必须是我们自己写的 (或者跟后端沟通，让他改一下响应头的配置项)，因为要能改服务端的代码才可以，用别人的端口实现CORS跨域不太可能
         </li>
         <li>
          我们需要配置服务器响应头，才可以实现跨域的数据访问
         </li>
         <li>
          注意2：如果服务端启用了CORS跨域，我们可以使用所有前端的ajax技术
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="32_84">
     </a>
     3.2、示例客户端代码
    </h4>
    <pre><code class="prism language-javascript"><span class="token comment">// 1、获取页面元素的dom对象</span>
        <span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3、编写事件处理函数</span>
        <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8889"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在没有设置响应头时，点击发送请求是报错的</span>
        <span class="token punctuation">}</span>
<span class="token comment">// 2、给元素添加事件</span>
        btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span> <span class="token punctuation">,</span> sendRequest<span class="token punctuation">)</span>

<span class="token comment">// 4、设置服务器响应头步骤——这里可以用小伙伴们自己得服务端代码，写入这行代码即可</span>
        <span class="token comment">// 写入：res.setHeader("Access-Control-Allow-Origin" , "*")即可</span>
</code></pre>
    <h4>
     <a id="33_101">
     </a>
     3.3、示例服务端代码
    </h4>
    <pre><code class="prism language-javascript"><span class="token keyword">let</span> http  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"chalk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token parameter">req <span class="token punctuation">,</span> res</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 注意：在这里使用响应头添加工具，添加CORS跨域响应头  </span>
    <span class="token comment">// res.setHeader( 响应头key"Access-Control-Allow-Origin" , 响应头value"*" );</span>
    <span class="token comment">// 配置项 =&gt; "Access...：允许哪一个地址去进行跨域请求"</span>
    <span class="token comment">// 地址信息 =&gt; "*"：所有地址都行；也可以写 http://127.0.0.1:5500/这种，但是这种完整的路径需要携带协议(http/其它协议)</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span> <span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
    <span class="token comment">// 响应数据</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"message"</span><span class="token operator">:</span> <span class="token string">"我已经接受到了你的请求, 这是我给你的回应, 我是一个 json 格式"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"tips"</span><span class="token operator">:</span> <span class="token string">"后端返回给前端的数据"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"code"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 响应头设置（否则无法正常显示中文）</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span> <span class="token punctuation">,</span> <span class="token string">"text/html;charset=utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将数据写入响应体</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 结束响应</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8889</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port
  <span class="token keyword">const</span> text <span class="token operator">=</span> 
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    恭喜你，服务器启动成功啦 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">'^_^'</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!
    目前正在监听 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 端口号!
    基准地址: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'http://localhost:'</span> <span class="token operator">+</span> port<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token template-punctuation string">`</span></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="4_138">
     </a>
     <em>
      <mark>
       4、解决跨域——服务器代理跨域
      </mark>
     </em>
    </h3>
    <h4>
     <a id="41_139">
     </a>
     4.1、简述概念
    </h4>
    <ol>
     <li>
      <code>
       服务器代理跨域
      </code>
      就是在本地开启一个服务器，代理发送我们的请求
     </li>
     <li>
      可以实现跨域的原因是：因为同源策略是给浏览器设置的，对服务器不生效，所以我们的服务器代理跨域是不受同源策略限制的
     </li>
    </ol>
    <h4>
     <a id="42_142">
     </a>
     4.2、示例客户端代码
    </h4>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>向百度接口发起请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>向代理服务器发起请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 测试是否可以直接向百度发起请求 =&gt; 不能，会报错</span>
        <span class="token keyword">let</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"btn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com/sugrec"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span> <span class="token punctuation">,</span> sendRequest <span class="token punctuation">)</span>

    <span class="token comment">// 根据代理服务器(proxy-server.js)——测试代理请求</span>
        <span class="token keyword">let</span> btn2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"btn2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendProxyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 1、此时我们的代理请求就是 =&gt; 给本地的代理服务器发请求，具体服务器怎么做那是服务器的事了 </span>
            <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8890"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2、给我们自己配置的本地服务器发送请求，让它替我们向百度发请求</span>
                   <span class="token comment">// 3、注意：如果本地服务器没设置cors跨域的话，一样会报错，所以不要忘记在proxy-server.js配置响应头，先实现能给自己的服务器发送请求，再让它代替我们发请求</span>
            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        btn2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span> <span class="token punctuation">,</span> sendProxyRequest <span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="43_170">
     </a>
     4.3、示例服务端代码
    </h4>
    <pre><code class="prism language-javascript"><span class="token keyword">let</span> http  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"chalk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span> <span class="token parameter">req <span class="token punctuation">,</span> res</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 代理服务器配置cors跨域</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span> <span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">// 配置请求信息</span>
    <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">params</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">prod</span> <span class="token operator">:</span> <span class="token string">"pc"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">from</span> <span class="token operator">:</span> <span class="token string">"pc_web"</span><span class="token punctuation">,</span> 
        <span class="token literal-property property">wd</span> <span class="token operator">:</span> <span class="token string">"hello world"</span> <span class="token punctuation">,</span>
        <span class="token comment">// !发起的请求可以不带cb =&gt; 因为这是服务器端</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 使用axios根据路径进行请求配置: </span>
    <span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token string">"https://www.baidu.com/sugrec"</span> <span class="token punctuation">,</span> options <span class="token punctuation">)</span>
    <span class="token comment">// 响应头设置 =&gt; 否则无法正常显示中文</span>
    <span class="token comment">// 响应头设置 =&gt; 否则无法正常显示中文</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span> <span class="token punctuation">,</span> <span class="token string">"text/html;charset=utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将数据写入响应体 </span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 结束响应</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8890</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port
  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    恭喜你, 服务器启动成功啦 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">'^_^'</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> !
    目前正在监听 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 端口号 !
    基准地址: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span> chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'http://localhost:'</span> <span class="token operator">+</span> port<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  </span><span class="token template-punctuation string">`</span></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="44_211">
     </a>
     4.4、服务器代理原理示例图
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cea0fb2bc141403d9e6f175a7a13a1df.png"/>
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37383637353637302f:61727469636c652f64657461696c732f313431393233313634" class_="artid" style="display:none">
 </p>
</div>


