---
layout: post
title: "Yashan-DB-文件管理"
date: 2025-03-11 19:26:09 +0800
description: "Yashan DB 文件管理"
keywords: "Yashan DB 文件管理"
categories: ['后端开发', 'Yashandb']
tags: ['数据库', 'Oracle']
artid: "146186956"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146186956
    alt: "Yashan-DB-文件管理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146186956
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146186956
cover: https://bing.ee123.net/img/rand?artid=146186956
image: https://bing.ee123.net/img/rand?artid=146186956
img: https://bing.ee123.net/img/rand?artid=146186956
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Yashan DB 文件管理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、文件类型介绍
    </h2>
    <p>
     本章主要介绍了YashanDB生命周期中涉及的文件类型，包括以下几类：
    </p>
    <p>
     1. 密码文件：用于存放系统用户的密码信息。
    </p>
    <p>
     2. 参数文件：记录数据库的配置信息，用于实例启动时的初始化。
    </p>
    <p>
     3. 控制文件：存储数据库运行所需的元数据信息，如数据文件和Redo日志文件的位置等。
    </p>
    <p>
     4. Redo日志文件：记录数据库的所有历史变更，用于数据恢复。
    </p>
    <p>
     5. 归档文件：Redo日志归档后的备份文件，用于数据恢复或主备库同步。
    </p>
    <p>
     6. 数据文件：存储数据库的实际数据，包括系统数据、用户数据等。
    </p>
    <p>
     7. 运行日志：记录数据库运行过程中的日志信息。
    </p>
    <p>
     8. 告警日志：记录数据库的告警信息，用于问题排查。
    </p>
    <p>
     这些文件在数据库的启动、运行和维护过程中起着关键作用。
    </p>
    <p>
     <br/>
     ---
    </p>
    <h2>
     二、密码文件
     <br/>
    </h2>
    <h3>
     1. 作用
    </h3>
    <p>
     • 密码文件以加密方式存放系统用户的密码（如`sys`用户）。
    </p>
    <p>
     • 在用户登录时，密码文件用于校验用户身份。
    </p>
    <h3>
     <br/>
     2. 位置
    </h3>
    <p>
     • 密码文件名为`yasdb.pwd`，为文本文件，不可直接编辑。
    </p>
    <p>
     • 文件路径由`PASSWORD_FILE`参数控制，默认路径为`$YASDB_DATA/instance/yasdb.pwd`。
    </p>
    <h3>
     <br/>
     3. 修改方式
    </h3>
    <p>
     • 不建议直接编辑密码文件，可以通过`yaspwd`工具或`yasboot`工具修改密码。
    </p>
    <h3>
     <br/>
     4. 命令格式
    </h3>
    <p>
     <br/>
    </p>
    <pre><code class="hljs"> yaspwd file=&lt;fname&gt; password=&lt;password&gt; input_file=&lt;input-fname&gt; 'sys={y | password}'</code></pre>
    <p>
     <br/>
    </p>
    <p>
     示例：
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">$ yaspwd file=yasdb.pwd password=yasdb_123</code></pre>
    <p>
     <br/>
    </p>
    <p>
     提示：只有当`yasdb.pwd`文件不存在时，才能生成新的密码文件。
    </p>
    <p>
     <br/>
     ---
    </p>
    <h2>
     三、参数文件
     <br/>
    </h2>
    <h3>
     1. 作用
    </h3>
    <p>
     • 参数文件记录数据库的配置信息，实例在启动阶段会读取参数文件，并根据其中的参数设置来配置数据库。
    </p>
    <h3>
     <br/>
     2. 内容
    </h3>
    <p>
     • 参数文件定义了数据库实例的内存组件大小、监听端口、字符集、数据块大小等配置信息。
    </p>
    <h3>
     <br/>
     3. 位置
    </h3>
    <p>
     • 参数文件名为`yasdb.ini`，为文本文件，存放在`$YASDB_DATA/config`路径下。
    </p>
    <p>
     • 虽然可以直接编辑，但不建议直接修改，推荐使用SQL命令修改参数。
    </p>
    <h3>
     <br/>
     4. 修改参数配置
    </h3>
    <p>
     • 示例：修改`data_buffer_size`参数
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">ALTER SYSTEM SET data_buffer_size=2G SCOPE=spfile;
SHOW PARAMETER data_buffer_size;</code></pre>
    <p>
     <br/>
    </p>
    <p>
     ---
    </p>
    <h2>
     四、控制文件
     <br/>
    </h2>
    <h3>
     1. 作用及重要性
    </h3>
    <p>
     • 控制文件包含数据库运行所需的关键信息，如数据文件、Redo日志文件、表空间信息等。
    </p>
    <p>
     • YashanDB默认会创建3份冗余控制文件，以提高安全性。
    </p>
    <p>
     • 如果控制文件损坏，数据库将无法启动。
    </p>
    <h3>
     <br/>
     2. 内容
    </h3>
    <p>
     • 数据库名称
    </p>
    <p>
     • 数据文件名字及位置
    </p>
    <p>
     • Redo日志文件名字及位置
    </p>
    <p>
     • 表空间信息
    </p>
    <p>
     • 归档日志信息等
    </p>
    <h3>
     <br/>
     3. 查看方式
    </h3>
    <p>
     • 通过参数`CONTROL_FILES`：查看控制文件的路径。
    </p>
    <p>
     • 通过视图`V$CONTROLFILE`：查看控制文件的详细信息。
    </p>
    <p>
     <br/>
     ---
    </p>
    <h2>
     五、Redo日志文件
     <br/>
    </h2>
    <h3>
     1. 作用
    </h3>
    <p>
     • Redo日志记录数据库的所有历史变更。
    </p>
    <p>
     • 在事务提交前，只需将Redo日志持久化即可，数据文件的持久化可以延迟。
    </p>
    <p>
     • 系统崩溃时，Redo日志可用于恢复数据到最新状态。
    </p>
    <h3>
     <br/>
     2. 查看方式
    </h3>
    <p>
     • 通过视图`V$LOGFILE`查看Redo日志的信息，包括ID、路径、块大小、已用大小、序列号与状态等。
    </p>
    <p>
     • 示例：
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">SELECT id, name, block_size, block_size * block_count / 1024 / 1024 AS size_mb, status FROM v$logfile;</code></pre>
    <p>
     <br/>
    </p>
    <h3>
     3. 维护操作
    </h3>
    <p>
     • 添加Redo日志：
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">ALTER DATABASE ADD LOGFILE ('redo6' SIZE 128M, 'redo7' SIZE 128M);</code></pre>
    <p>
     <br/>
    </p>
    <p>
     <br/>
     • 删除Redo日志：只有状态为`INACTIVE`或`NEW`的Redo日志可以删除。
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">ALTER DATABASE DROP LOGFILE '/home/yashan/yasdb_data/db-1-1/dbfiles/redo6';</code></pre>
    <p>
     <br/>
    </p>
    <p>
     <br/>
     • 切换Redo日志：在需要对当前Redo日志进行维护时，切换日志组并执行checkpoint。
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">ALTER SYSTEM SWITCH LOGFILE;
ALTER SYSTEM CHECKPOINT;</code></pre>
    <p>
     <br/>
    </p>
    <p>
     ---
    </p>
    <h2>
     六、归档文件
     <br/>
    </h2>
    <h3>
     1. 作用
    </h3>
    <p>
     • 归档日志是Redo日志完成归档后的备份文件，为二进制文件。
    </p>
    <p>
     • 归档日志可用于数据恢复，也可在主备库中的备库上应用，还原主库的数据。
    </p>
    <h3>
     <br/>
     2. 归档模式查看
    </h3>
    <p>
     • 默认安装下，数据库为归档模式。
    </p>
    <p>
     • 可以通过`V$DATABASE`视图中的`log_mode`字段查看当前归档模式配置。
    </p>
    <p>
     • 示例：
    </p>
    <p>
     <br/>
    </p>
    <pre><code class="hljs">SELECT database_name, log_mode, open_mode FROM v$database;</code></pre>
    <p>
     <br/>
    </p>
    <p>
     <br/>
     • 字段值为`ARCHIVELOG`表示归档模式，`NOARCHIVELOG`表示非归档模式。
    </p>
    <p>
     • 为了能将数据库还原到任意时间点以及主备库的搭建，建议生产环境配置为归档模式。
    </p>
    <h3>
     <br/>
     3. 归档模式切换
    </h3>
    <p>
     • 查看归档路径：
    </p>
    <pre><code class="hljs">SHOW PARAMETER archive_local_dest;</code></pre>
    <p>
     <br/>
     • 修改归档路径：
    </p>
    <p>
     • 归档路径只允许静态修改，需要重启生效。
    </p>
    <p>
     • 确保路径存在，且操作系统用户`yashan`有读写权限。
    </p>
    <pre><code class="hljs">ALTER SYSTEM SET archive_local_dest='/home/yashan/arch' scope=spfile;</code></pre>
    <p>
     • 关闭数据库实例：
    </p>
    <pre><code class="hljs">SHUTDOWN IMMEDIATE;</code></pre>
    <p>
     • 调整到归档模式：
    </p>
    <p>
     • 从非归档模式调整到归档模式：
    </p>
    <pre><code class="hljs">ALTER DATABASE ARCHIVELOG;</code></pre>
    <p>
     • 从归档模式调整到非归档模式：
    </p>
    <pre><code class="hljs">ALTER DATABASE NOARCHIVELOG;</code></pre>
    <p>
     • 注意：从归档模式调整到非归档模式时，需要设置`replication_addr`为空。
    </p>
    <pre><code class="hljs"> ALTER SYSTEM SET replication_addr='' SCOPE=spfile;</code></pre>
    <p>
     • 开启数据库到OPEN状态：
    </p>
    <pre><code class="hljs">ALTER DATABASE OPEN;</code></pre>
    <p>
     • 查看当前归档模式：
    </p>
    <pre><code class="hljs">SELECT database_name, log_mode, open_mode FROM v$database;</code></pre>
    <p>
     ---
    </p>
    <h2>
     七、数据文件
     <br/>
    </h2>
    <h3>
     1. 分类
    </h3>
    <p>
     • 系统数据文件：存放数据库系统内部生成的数据（如SYSTEM和SYSAUX表空间）。
    </p>
    <p>
     • UNDO数据文件：存放回滚段的数据，用于事务回滚。
    </p>
    <p>
     • TEMP数据文件：用于临时表的段分配，存储临时数据。
    </p>
    <p>
     • SWAP数据文件：当虚拟内存不足时，将虚拟内存交换到SWAP表空间释放内存。
    </p>
    <p>
     • 用户数据文件：存放实际的生产数据，包括内置表空间`USERS`的数据文件以及用户自定义表空间的文件。
    </p>
    <h3>
     <br/>
     2. 属性
    </h3>
    <p>
     • 大小：
    </p>
    <p>
     • 数据块默认大小为8KB，单个普通数据文件最大为512GB。
    </p>
    <p>
     • 数据块为16KB和32KB时，单个数据文件的最大大小相应成倍增大。
    </p>
    <p>
     • 状态：
    </p>
    <p>
     • 数据文件的状态有`ONLINE`和`OFFLINE`，`OFFLINE`状态下的数据文件不能被访问。
    </p>
    <p>
     • 自动扩展性：
    </p>
    <p>
     • 自动扩展性有`ON`和`OFF`两种模式，`ON`表示允许数据文件空间自动扩展，`OFF`表示不允许自动扩展。
    </p>
    <h3>
     <br/>
     3. 查看方式
    </h3>
    <p>
     • 通过视图`V$DATAFILE`查看数据文件的信息。
    </p>
    <p>
     • 示例：
    </p>
    <pre><code class="hljs">SELECT name, bytes, status, auto_extend FROM v$datafile;</code></pre>
    <p>
     ---
    </p>
    <h2>
     八、小结
    </h2>
    <p>
     1. 本章回顾了YashanDB生命周期中涉及的文件类型，包括密码文件、参数文件、控制文件、Redo日志文件、归档文件和数据文件。
    </p>
    <p>
     2. 分别介绍了各文件的作用、查看方式和维护操作。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38383838353134392f:61727469636c652f64657461696c732f313436313836393536" class_="artid" style="display:none">
 </p>
</div>


