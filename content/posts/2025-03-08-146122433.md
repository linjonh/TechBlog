---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f4d656d6f72795f6d756d752f:61727469636c652f64657461696c732f313436313232343333"
layout: post
title: "OpenCVè§†é¢‘è§£ç å…¨æµç¨‹è¯¦è§£"
date: 2025-03-08 20:50:38 +08:00
description: "æœ¬æ–‡æ‰‹æŠŠæ‰‹æ‹†è§£OpenCVè§†é¢‘è§£ç çš„æ¯ä¸ªç¯èŠ‚ï¼Œä»æ‘„åƒå¤´æ•è·åˆ°ç½‘ç»œæµå¤„ç†ä¸€ç½‘æ‰“å°½ï¼æ–‡æœ«é™„ã€å¸§ç‡ç¿»å€ã€‘çš„éšè—å‚æ•°è®¾ç½®æŠ€å·§ã€‚"
keywords: "OpenCVè§†é¢‘è§£ç å…¨æµç¨‹è¯¦è§£"
categories: ['æœªåˆ†ç±»']
tags: ['éŸ³è§†é¢‘', 'è®¡ç®—æœºè§†è§‰', 'æ·±åº¦å­¦ä¹ ', 'äººå·¥æ™ºèƒ½', 'Opencv', 'Ffmpeg']
artid: "146122433"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146122433
    alt: "OpenCVè§†é¢‘è§£ç å…¨æµç¨‹è¯¦è§£"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146122433
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146122433
cover: https://bing.ee123.net/img/rand?artid=146122433
image: https://bing.ee123.net/img/rand?artid=146122433
img: https://bing.ee123.net/img/rand?artid=146122433
---

# OpenCVè§†é¢‘è§£ç å…¨æµç¨‹è¯¦è§£

> æœ¬æ–‡æ‰‹æŠŠæ‰‹æ‹†è§£OpenCVè§†é¢‘è§£ç çš„æ¯ä¸ªç¯èŠ‚ï¼Œä»æ‘„åƒå¤´æ•è·åˆ°ç½‘ç»œæµå¤„ç†ä¸€ç½‘æ‰“å°½ï¼æ–‡æœ«é™„ã€å¸§ç‡ç¿»å€ã€‘çš„éšè—å‚æ•°è®¾ç½®æŠ€å·§ã€‚

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### åŸºç¡€ä¾èµ–

```bash
# Ubuntuå®‰è£…å‘½ä»¤
sudo apt install libopencv-dev python3-opencv ffmpeg
# éªŒè¯å®‰è£…ï¼ˆè¾“å‡ºåº”æœ‰FFMPEG=YESï¼‰
pkg-config --modversion opencv4

```

## ğŸ”§ å››æ­¥æ ¸å¿ƒè§£ç æµç¨‹

### æ­¥éª¤1ï¼šè§†é¢‘æºåˆå§‹åŒ–

```python
import cv2

# æ”¯æŒå¤šç§è¾“å…¥æº
source = 0                  # é»˜è®¤æ‘„åƒå¤´
# source = "test.mp4"       # æœ¬åœ°æ–‡ä»¶
# source = "rtsp://example" # ç½‘ç»œæµ

cap = cv2.VideoCapture(source)

# å…³é”®å‚æ•°æ ¡éªŒ
if not cap.isOpened():
    print(f"æ— æ³•æ‰“å¼€è§†é¢‘æº: {source}")
    exit()

# è·å–è§†é¢‘å±æ€§
fps = cap.get(cv2.CAP_PROP_FPS)
width = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
height = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))
print(f"è§†é¢‘è§„æ ¼ï¼š{width}x{height} @ {fps:.2f}fps")

```

### æ­¥éª¤2ï¼šå¸§è¯»å–å¾ªç¯ï¼ˆç”Ÿäº§çº§å†™æ³•ï¼‰

```python
# é…ç½®é‡è¯•æœºåˆ¶
max_retries = 3
current_retry = 0

while cap.isOpened():
    ret, frame = cap.read()
    
    # å¼‚å¸¸å¤„ç†ä¸‰è¿å‡»
    if not ret:
        if current_retry < max_retries:
            print(f"å¸§è¯»å–å¤±è´¥ï¼Œé‡è¯• {current_retry+1}/{max_retries}")
            current_retry += 1
            continue
        else:
            print("è¿ç»­å¤±è´¥è¶…è¿‡é˜ˆå€¼ï¼Œç»ˆæ­¢è¯»å–")
            break
    
    current_retry = 0  # é‡ç½®é‡è¯•è®¡æ•°å™¨
    
    # åŸºç¡€å¤„ç†ç¤ºä¾‹
    rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    
    # æ˜¾ç¤ºç›‘æ§çª—å£
    cv2.imshow('Video Preview', rgb_frame)
    
    # é€€å‡ºæ§åˆ¶ï¼ˆå¸¦å»¶è¿Ÿè®¡ç®—ï¼‰
    key = cv2.waitKey(max(1, int(1000/fps))) & 0xFF
    if key == ord('q'):
        break

```

### æ­¥éª¤3ï¼šèµ„æºé‡Šæ”¾ï¼ˆé˜²å†…å­˜æ³„æ¼ï¼‰

```python
# æ ‡å‡†é‡Šæ”¾
cap.release()
cv2.destroyAllWindows()

# æ·±åº¦æ¸…ç†ï¼ˆå¤„ç†å¼‚å¸¸é€€å‡ºï¼‰
if 'cap' in locals() and cap.isOpened():
    cap.release()
cv2.waitKey(1)  # ç¡®ä¿çª—å£å…³é—­
for i in range(5):
    cv2.destroyAllWindows()
    cv2.waitKey(1)
æ­¥éª¤4ï¼šæ—¥å¿—ä¸ç›‘æ§ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…å¤‡ï¼‰
python
å¤åˆ¶
# è®°å½•å…³é”®æŒ‡æ ‡
import time

start_time = time.time()
frame_count = 0

while True:
    # ...è¯»å–å¸§...
    frame_count += 1
    
    # å®æ—¶è®¡ç®—å¸§ç‡
    if frame_count % 30 == 0:
        elapsed = time.time() - start_time
        real_fps = frame_count / elapsed
        print(f"å®æ—¶å¸§ç‡: {real_fps:.2f} | è§£ç å»¶è¿Ÿ: {1000/real_fps:.1f}ms")

```

## âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—

### é—®é¢˜1ï¼šè§†é¢‘æ— æ³•æ‰“å¼€

```python
# è¯Šæ–­è„šæœ¬
print("åç«¯æ¥å£:", cap.getBackendName())
print("ç¼–è§£ç å™¨:", cap.get(cv2.CAP_PROP_FOURCC))
print("æƒé™æ£€æŸ¥:", os.access(source, os.R_OK))

```

### é—®é¢˜2ï¼šèŠ±å±/ç»¿å¸§

```python
# æ·»åŠ å¸§æ ¡éªŒ
if frame is None or frame.size == 0:
    print("è·å–åˆ°ç©ºå¸§ï¼Œè·³è¿‡å¤„ç†")
    continue

# æ£€æŸ¥é¢œè‰²é€šé“
if frame.shape[2] != 3:
    print(f"å¼‚å¸¸é¢œè‰²é€šé“æ•°: {frame.shape[2]}")
    frame = cv2.cvtColor(frame, cv2.COLOR_BGRA2BGR)

```

### é—®é¢˜3ï¼šå†…å­˜æš´æ¶¨

```python
# é™åˆ¶ç¼“å­˜å¸§æ•°
from collections import deque

frame_buffer = deque(maxlen=30)  # åªä¿ç•™æœ€è¿‘30å¸§

while True:
    ret, frame = cap.read()
    frame_buffer.append(frame)

```

## ğŸš€ æ€§èƒ½è°ƒä¼˜å‚æ•°

### 1. ç¡¬ä»¶åŠ é€Ÿé…ç½®

Â·Â·Â·python

## CUDAåŠ é€Ÿï¼ˆéœ€ç¼–è¯‘OpenCV contribæ¨¡å—ï¼‰

cap = cv2.VideoCapture(source, cv2.CAP_FFMPEG)
  
cap.set(cv2.CAP_PROP_HW_ACCELERATION, cv2.VIDEO_ACCELERATION_ANY)

```
## 2. ç½‘ç»œæµä¼˜åŒ–
```python
# RTSPä¸“ç”¨å‚æ•°
os.environ["OPENCV_FFMPEG_CAPTURE_OPTIONS"] = "rtsp_transport;tcp|buffer_size;1024000"

```

### 3. å†…å­˜ä¼˜åŒ–

```python
# ä½¿ç”¨UMatå‡å°‘æ‹·è´
success, frame = cap.read_umat()  # è¿”å›UMatå¯¹è±¡

```

ğŸ“Œ ç»ˆææŠ€å·§ï¼š

* å¼€å¯FFmpegæ—¥å¿—åˆ†æï¼šexport OPENCV_FFMPEG_DEBUG=1
* å¼ºåˆ¶æŒ‡å®šè§£ç å™¨ï¼šcv2.CAP_PROP_CODEC_PREFERENCE= cv2.VIDEO_ACCELERATION_ANY
* å®æ—¶ç›‘æ§GPUå†…å­˜ï¼šnvidia-smi -l 1

### ğŸ¥ è§†é¢‘è§£ç æ ¸å¿ƒæµç¨‹å›¾

æˆåŠŸ







å¤±è´¥














æˆåŠŸ







å¤±è´¥



































ç»“æŸ









è§†é¢‘æº








åˆå§‹åŒ–VideoCapture








è¯»å–å…ƒæ•°æ®








é”™è¯¯å¤„ç†








é€å¸§è¯»å–








è§£ç ä¸ºMat








å¼‚å¸¸å¤„ç†








å›¾åƒå¤„ç†








é‡è¯•/è·³è¿‡








é‡Šæ”¾èµ„æº