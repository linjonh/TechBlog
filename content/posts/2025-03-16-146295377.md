---
layout: post
title: "goweb中文件上传和文件下载"
date: 2025-03-16 14:45:28 +0800
description: "服务端可以使用FormFile(“name”)获取到上传的文件main.goindex.html文件下载文件下载总体步骤下载时需要设置的响应头信息content-Type:内容MIME类型application/octet-stream 任意类型Content-Disposition:客户端对内容的操作方式inline 默认值,表示浏览器能解析就解析,不能解析下载attachment;filename=下载时显示的文件名,客户端浏览器恒下载mian.goindex.html"
keywords: "goweb中文件上传和文件下载"
categories: ['未分类']
tags: ['Xcode', 'Macos', 'Ide', 'Golang']
artid: "146295377"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146295377
    alt: "goweb中文件上传和文件下载"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146295377
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146295377
cover: https://bing.ee123.net/img/rand?artid=146295377
image: https://bing.ee123.net/img/rand?artid=146295377
img: https://bing.ee123.net/img/rand?artid=146295377
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     goweb中文件上传和文件下载
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     文件上传
    </h2>
    <ul>
     <li>
      文件上传:客户端把上传文件转换为二进制流后发送给服务器,服务器对二进制流进行解析
     </li>
     <li>
      HTML表单(form)enctype(Encode Type)属性控制表单在提交数据到服务器时数据的编码类型
      <ul>
       <li>
        enctype=“application/x-www-form-urlencoded” 默认值,表单数据会被编码为名称/值形式。
       </li>
       <li>
        oenctype="multipart/form-data”编码成消息,每个控件对应消息的一部分.请求方式必须是post
       </li>
       <li>
        oenctype=“text/plain"纯文本形式进行编码的
       </li>
      </ul>
     </li>
    </ul>
    <p>
     服务端可以使用FormFile(“name”)获取到上传的文件
    </p>
    <p>
     main.go
    </p>
    <pre><code>package main

import (
    "html/template"
    "io/ioutil"
    "net/http"
    "strings"
)

func welcome(w http.ResponseWriter, r *http.Request) {
    t, _ := template.ParseFiles("demo/view/index.html")
    t.Execute(w, nil)
}

func upload(w http.ResponseWriter, r *http.Request) {
    fileName := r.FormValue("name")
    //获取到文件，文件名
    file, fileHeader, _ := r.FormFile("file")
    b, _ := ioutil.ReadAll(file)
    //获取文件名扩展名
    s := fileHeader.Filename[strings.LastIndex(fileHeader.Filename, "."):]
    //文件名，[]byte,模式
    ioutil.WriteFile("D:/"+fileName+s, b, 0777)

    t, _ := template.ParseFiles("demo/view/success.html")
    t.Execute(w, nil)
}

func main() {
    server := http.Server{Addr: ":8090"}
    http.HandleFunc("/", welcome)
    http.HandleFunc("/upload", upload)
    server.ListenAndServe()
}
</code></pre>
    <p>
     index.html
    </p>
    <pre><code>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;title&gt;文件上传&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action="upload" method="post" enctype="multipart/form-data"&gt;
    文件名:&lt;input type="text" name="name"/&gt;&lt;br/&gt;
    文件:&lt;input type="file" name="file"/&gt;&lt;br/&gt;
    &lt;input type="submit" value="提交"/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
    <h2>
     <a id="_69">
     </a>
     文件下载
    </h2>
    <p>
     文件下载总体步骤
    </p>
    <ul>
     <li>
      客户端向服务端发起请求,请求参数包含要下载文件的名称
     </li>
     <li>
      服务器接收到客户端请求后把文件设置到响应对象中,响应给客户端浏览器
     </li>
    </ul>
    <p>
     下载时需要设置的响应头信息
    </p>
    <ul>
     <li>
      <p>
       content-Type:内容MIME类型
      </p>
      <p>
       application/octet-stream 任意类型
      </p>
     </li>
     <li>
      <p>
       Content-Disposition:客户端对内容的操作方式
      </p>
      <p>
       inline 默认值,表示浏览器能解析就解析,不能解析下载
      </p>
      <p>
       attachment;filename=下载时显示的文件名,客户端浏览器恒下载
      </p>
     </li>
    </ul>
    <p>
     mian.go
    </p>
    <pre><code>package main

import (
    "fmt"
    "html/template"
    "io/ioutil"
    "net/http"
    "strings"
)

func welcome(w http.ResponseWriter, r *http.Request) {
    t, _ := template.ParseFiles("demo/view/index.html")
    t.Execute(w, nil)
}

func download(w http.ResponseWriter, r *http.Request) {
    filename := r.FormValue("fileName")
    f, err := ioutil.ReadFile("D:/gofile/" + filename)
    if err != nil {
       fmt.Fprintln(w, "文件下载失败", err)
       return
    }

    //设置响应头
    h := w.Header()
    h.Set("Content-Type", "application/octet-stream")
    h.Set("Content-Disposition", "attachment;filename="+filename)
    w.Write(f)

}

func main() {
    server := http.Server{Addr: ":8090"}
    http.HandleFunc("/", welcome)
    http.HandleFunc("/download", download)
    server.ListenAndServe()
}
</code></pre>
    <p>
     index.html
    </p>
    <pre><code>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;title&gt;文件下载&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;a href="download?fileName=abc.png"&gt;下载&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
    <h2>
     <a id="_146">
     </a>
    </h2>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f56696c6c69616d5f41592f:61727469636c652f64657461696c732f313436323935333737" class_="artid" style="display:none">
 </p>
</div>


