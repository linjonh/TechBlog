---
layout: post
title: "即时通讯音视频开发三视频编解码之编码基础"
date: 2018-11-05 20:25:32 +0800
description: "前言即时通讯应用中的实时音视频技术，几乎是IM开发中的最后一道高墙。原因在于：实时音视频技术 = 音"
keywords: "蒙版"
categories: ['开发']
tags: ['无标签']
artid: "83746088"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=83746088
    alt: "即时通讯音视频开发三视频编解码之编码基础"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=83746088
featuredImagePreview: https://bing.ee123.net/img/rand?artid=83746088
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     即时通讯音视频开发（三）：视频编解码之编码基础
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     前言
    </h3>
    <p>
     <br/>
     即时通讯应用中的实时音视频技术，几乎是IM开发中的最后一道高墙。原因在于：实时音视频技术 = 音视频处理技术 + 网络传输技术 的横向技术应用集合体，而公共互联网不是为了实时通信设计的。
    </p>
    <h3>
     系列文章
    </h3>
    <ul>
     <li>
      《
      <a href="https://yunxin.163.com/blog/52im3-1/?from=csdn&amp;utm_source=csdn&amp;utm_medium=article&amp;utm_campaign=seo&amp;utm_content=repost" rel="nofollow">
       即时通讯音视频开发（一）：视频编解码之理论概述
      </a>
      》
     </li>
     <li>
      《
      <a href="https://yunxin.163.com/blog/52im3-2/?from=csdn&amp;utm_source=csdn&amp;utm_medium=article&amp;utm_campaign=seo&amp;utm_content=repost" rel="nofollow">
       即时通讯音视频开发（二）：视频编解码之数字视频介绍
      </a>
      》
     </li>
    </ul>
    <h3 style="margin-left:0px;">
     <span style="color:#2f2f2f;">
      1. 如何理解压缩码流？
     </span>
    </h3>
    <p>
     <br/>
     <strong>
      可按2部分进行理解：
     </strong>
     <br/>
    </p>
    <ul style="margin-left:0px;">
     <li>
      <br/>
     </li>
     <li>
      语法：码流中各个元素的位置关系。
      <br/>
      <span style="color:#808080;">
       如：01001001…，表示图像编码类型(01)，宏块类型(00)，编码系数1001等。
      </span>
     </li>
     <li>
      语义：每个语法元素所表达的意义。
      <br/>
      <span style="color:#808080;">
       例如：图像编码类型。
      </span>
     </li>
    </ul>
    <p>
     <img alt="100546diiig6dikvvdgy65.png (233Ã106)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/75507e58e43780b8362d93521c3c6742.png"/>
    </p>
    <p>
    </p>
    <h3>
     2. 编码层次的组成
    </h3>
    <p>
     <br/>
     <strong>
      编码层次由如下部分组成：
     </strong>
     <br/>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      序列（Sequence）
     </li>
     <li>
      图像组（Group of Pictures，GOP）
     </li>
     <li>
      图像（Picture）
     </li>
     <li>
      条带（Slice）
     </li>
     <li>
      宏块（Macroblock，MB）
     </li>
     <li>
      块(Block)
     </li>
    </ul>
    <p>
    </p>
    <h3>
     3. 具体的码流结构
    </h3>
    <p>
     <img alt="100745g7rp7d0zr7u0k7dh.png (576Ã371)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/31ad82c2d3a0e1d1edca8a518f946d1f.png"/>
    </p>
    <h3>
     4. PB帧编码
    </h3>
    <p>
     <img alt="101223qm68p1ql9lcc6qmn.png (576Ã377)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/9b5a6f7d3ede6eaa360720e420e89174.png"/>
    </p>
    <h3>
     5. IBBP序列编码对象
    </h3>
    <p>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      <strong>
       序列
      </strong>
      是指一段连续编码的并具有相同参数的视频图像。
     </li>
     <li>
      <strong>
       序列起始码
      </strong>
      是指专有的一段比特串，标识一个序列的压缩数据的开始。如MPEG-2的序列起始码为十六进制数000001(B3)。
     </li>
     <li>
      <strong>
       序列头
      </strong>
      是指记录序列信息，包含档次（Profile），级别（Level），宽度，高度，是否是逐行序列，帧率等内容。
     </li>
     <li>
      <strong>
       序列结束码
      </strong>
      是指专有的一段比特串，标识该序列的压缩数据的结束。如MPEG-2的序列结束码为十六进制数000001(B7)。
     </li>
    </ul>
    <h3>
     6. 图像组编码对象
    </h3>
    <p>
     <img alt="101527zlmosudtvfhmlzs7.png (576Ã304)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/0220e1926f7550ad01601a3d9031b56b.png"/>
    </p>
    <h3>
     7. 图像编码结构
    </h3>
    <p>
     <br/>
     <strong>
      包括：
     </strong>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      图像。
     </li>
     <li>
      图像起始码：专有的一段比特串，标识一个图像的压缩数据的开始。
      <br/>
      如MPEG-2的图像起始码为十六进制数000001(00)。
     </li>
     <li>
      图像头：记录图像信息。
      <br/>
      包含图像编码类型，图像距离，图像编码结构，图像是否为逐行扫描。
     </li>
    </ul>
    <h3>
     8. 图像分块编码
    </h3>
    <p>
     <img alt="101741x6r6rr0eddj0z6eh.png (337Ã511)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/f4921203a3e3f4303fe809f1584c293c.png"/>
    </p>
    <h3>
     9. 条带编码结构
    </h3>
    <p>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      条带：多个宏块的组合。
     </li>
     <li>
      条带起始码：专有的一段比特串，标识一个条带的压缩数据的开始。如MPEG-2的条带起始码为十六进制数000001(0~AF)。
     </li>
     <li>
      条带头：记录当前图像的相关信息。含条带位置，条带量化参数，宏块编码技术标识等。
     </li>
    </ul>
    <h3>
     10. 条带编码对象
    </h3>
    <p>
     <img alt="102009ktoaznaitb6iiivn.png (576Ã407)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/5ae32307e7f0effeba479029d0fe194b.png"/>
    </p>
    <h3>
     11. 宏块编码结构
    </h3>
    <p>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      宏块：16x16的像素块（对亮度而言）。
     </li>
     <li>
      宏块内容：宏块编码类型，编码模式，参考帧索引，运动矢量信息，宏块编码系数等。
     </li>
    </ul>
    <h3>
     12. 宏块编码对象
    </h3>
    <p>
     <img alt="102328p4rb88sb9k9s1bvg.png (576Ã297)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/567b1c4cce88dd712144b8d909ddec63.png"/>
    </p>
    <h3 style="margin-left:0px;">
     <span style="color:#2f2f2f;">
      13. 块编码结构
     </span>
    </h3>
    <p>
    </p>
    <ul style="margin-left:0px;">
     <li>
      <br/>
     </li>
     <li>
      8x8或4x4块的变换量化系数的熵编码数据。
     </li>
     <li>
      CBP (Coded Block Patten)：用来指示块的变换量化系数是否全为零。
      <br/>
      对于YUV(4:2:0)编码，CBP通常6比特长，每个比特对应一个块，当某一块的变换量化系数全为零时，其对应比特位值为0，否则为1。
     </li>
     <li>
      每个块的变换量化系数的最后用一个EOB (End of Block)符号来标识。
     </li>
    </ul>
    <h3 style="margin-left:0px;">
     <span style="color:#2f2f2f;">
      14. 视频编解码关键技术
     </span>
    </h3>
    <p>
    </p>
    <ul style="margin-left:0px;">
     <li>
      <br/>
     </li>
     <li>
      预测：通过帧内预测和帧间预测降低视频图像的空间冗余和时间冗余。
     </li>
     <li>
      变换：通过从时域到频域的变换，去除相邻数据之间的相关性，即去除空间冗余。
     </li>
     <li>
      量化：通过用更粗糙的数据表示精细的数据来降低编码的数据量，或者通过去除人眼不敏感的信息来降低编码数据量。
     </li>
     <li>
      扫描：将二维变换量化数据重新组织成一维的数据序列。
     </li>
     <li>
      熵编码：根据待编码数据的概率特性减少编码冗余。
     </li>
    </ul>
    <p>
     <img alt="102504nnbzypnl2mar0ood.png (576Ã82)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/cb79e85144e2ae8262eb6e4e3bbe8c62.png"/>
    </p>
    <h3>
     15. 预测
    </h3>
    <p>
     <br/>
     <strong>
      空间预测：
     </strong>
     利用图像空间相邻像素的相关性来预测的方法
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      帧内预测技术：利用当前编码块周围已经重构出来的像素预测当前块
     </li>
     <li>
      Intra图像编码（I帧）
     </li>
    </ul>
    <p>
     <br/>
     <strong>
      时间预测：
     </strong>
     利用时间上相邻图像的相关性来预测的方法
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      帧间预测：运动估计（Motion Estimation，ME），运动补偿（Motion Compensation，MC）
     </li>
     <li>
      Inter图像编码：前向预测编码图像（P帧），双向预测编码图像（B帧）
     </li>
    </ul>
    <h3>
     16. 帧内预测
    </h3>
    <p>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      I帧图像的每个宏块都采用帧内（Intra）预测编码模式。
     </li>
     <li>
      宏块分成8x8或者4x4块，对每个块采用帧内预测编码，称作Intra8x8或者Intra4x4。
     </li>
     <li>
      帧内预测有多个预测方向：水平，垂直，左下，右上。
     </li>
     <li>
      帧内预测还有直流（DC）预测。
     </li>
     <li>
      色度块预测还有平面预测。
     </li>
    </ul>
    <p>
     <img alt="102652f1vtkdgt993j7rad.png (576Ã452)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/0b3cd76353c7dd72eab2a84c79d873b2.png"/>
    </p>
    <h3>
     17. 量化
    </h3>
    <p>
    </p>
    <h4>
     1量化原理
    </h4>
    <p>
     <br/>
     将含有大量的数据集合映射到含有少量的数据集合中。
    </p>
    <p>
     <img alt="103023bzp1131pl555plc2.png (576Ã363)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/5f9171f6a4ab3eca5470ce7ca1e10794.png"/>
    </p>
    <p>
     <img alt="103023rl55gkkpyy5jgz4m.png (496Ã257)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/648038bb93aa1e5abf72c9c2222365ec.png"/>
    </p>
    <p>
     <img alt="103024evm2zr1pmmppprq8.png (576Ã252)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/98f8368ef90632156319a8ac01820687.png"/>
    </p>
    <p>
     <img alt="103024hmxem82khg8hkhyk.png (576Ã388)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/0c3ddd39cc1aff12d61953f1d47be48d.png"/>
    </p>
    <p>
     <img alt="103024fy6glzlm7l8oz796.png (576Ã376)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/7f7304638e3efefbb8d92913aa62b33a.png"/>
    </p>
    <h4>
     一般情况下量化后高频部分包含大量的零系数
    </h4>
    <p>
     <img alt="103121q1s149s9mxmavags.png (576Ã208)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/512562fcdf908639e89fca3334dab038.png"/>
    </p>
    <h4>
     量化对主观质量的影响
    </h4>
    <p>
     <img alt="103155t9y92iuyi27b9zi2.png (576Ã345)" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/8bd147871ea6b32dc0e23071ee78036e.png"/>
    </p>
    <h3>
     18. 码率控制
    </h3>
    <p>
     <br/>
     受到缓冲区，带宽的限制，编码码率不能无限制的增长，因此需要通过码率控制来将编码码流控制在目标码率范围内。
     <br/>
     <br/>
     <strong>
      一般通过调整量化参数的手段控制码率：
     </strong>
     <br/>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      帧级控制
     </li>
     <li>
      条带级控制
     </li>
     <li>
      宏块级控制
     </li>
    </ul>
    <p>
     <br/>
     <strong>
      码率控制考虑的问题：
     </strong>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      防止码流有较大的波动，导致缓冲区发生溢出，
     </li>
     <li>
      同时保持缓冲区尽可能的充满，让图像质量尽可能的好而且稳定
     </li>
    </ul>
    <p>
     <br/>
     CBR（Constant Bit Rate）：比特率稳定，但图像质量变化大。VBR（Variable Bit Rate）：比特率波动大，但图像质量稳定。
     <br/>
     <br/>
     <strong>
      码率控制算法：
     </strong>
    </p>
    <ul>
     <li>
      <br/>
     </li>
     <li>
      码率分配
     </li>
     <li>
      码率控制
     </li>
    </ul>
    <p>
     <br/>
     码率控制属于非标准技术，编码端有，解码端没有。
    </p>
    <p>
     网易云信，你身边的即时通讯和音视频技术专家，了解我们，请戳
     <a href="https://yunxin.163.com/?from=csdn&amp;utm_source=csdn&amp;utm_medium=article&amp;utm_campaign=seo&amp;utm_content=repost" rel="nofollow">
      网易云信官网
     </a>
    </p>
    <p>
     想要阅读更多行业洞察和技术干货，请关注
     <a href="https://yunxin.163.com/dev-blog?from=csdn&amp;utm_source=csdn&amp;utm_medium=article&amp;utm_campaign=seo&amp;utm_content=repost" rel="nofollow">
      网易云信博客
     </a>
    </p>
    <p>
     本文转载自52im,作者：JackJiang
    </p>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6e6574656173655f696d:2f61727469636c652f64657461696c732f3833373436303838" class_="artid" style="display:none">
 </p>
</div>


