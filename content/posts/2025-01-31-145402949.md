---
layout: post
title: "用AI对一段代码进行单元测试"
date: 2025-01-31 16:12:01 +0800
description: "利用AI工具对以上代码编写单元测试用例。_ai单元测试"
keywords: "ai单元测试"
categories: ['未分类']
tags: ['嵌入式硬件', '单元测试', '人工智能', 'C', 'Ai']
artid: "145402949"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=145402949
  alt: "用AI对一段代码进行单元测试"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145402949
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145402949
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     用AI对一段代码进行单元测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1__0">
     </a>
     1 题目
    </h2>
    <p>
     测试代码如下：
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MIN_RUN</span> <span class="token expression"><span class="token number">32</span></span></span>

<span class="token comment">// 插入排序算法</span>
<span class="token keyword">void</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> right<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> key <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> left <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
j<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 归并函数</span>
<span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> mid<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> len1 <span class="token operator">=</span> mid <span class="token operator">-</span> left <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> len2 <span class="token operator">=</span> right <span class="token operator">-</span> mid<span class="token punctuation">;</span>
<span class="token keyword">int</span> L<span class="token punctuation">[</span>len1<span class="token punctuation">]</span><span class="token punctuation">,</span> R<span class="token punctuation">[</span>len2<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> k<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len1<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>left <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        R<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>mid <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>

    i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    k <span class="token operator">=</span> left<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1 <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> R<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            arr<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            arr<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1<span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>k<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&gt;</span>j <span class="token operator">&amp;&amp;</span> len1<span class="token operator">&lt;</span>len2<span class="token punctuation">)</span>
    	arr<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">// Timsort 算法</span>
<span class="token keyword">void</span> <span class="token function">timSort</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">+=</span> MIN_RUN<span class="token punctuation">)</span>
<span class="token function">insertionSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> MIN_RUN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> n <span class="token operator">?</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> MIN_RUN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> size <span class="token operator">=</span> MIN_RUN<span class="token punctuation">;</span> size <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> size <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> left <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> left <span class="token operator">+=</span> <span class="token number">2</span> <span class="token operator">*</span> size<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> mid <span class="token operator">=</span> left <span class="token operator">+</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">merge</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>
利用 AI 工具对以上代码编写单元测试用例
</p>
<h2>
<a id="2__68">
</a>
2 说明
</h2>
<p>
<strong>
ai 工具
</strong>
：文心大模型 4.0 Turbo。
<br/>
<strong>
测试环境
</strong>
：在 Linux 环境下，用 gcc、gcov 和 lcov。
<br/>
<strong>
测试方式
</strong>
：将以上代码放到 sort.c 文件中，用 ai 工具生成测试用例，放到 test.c 文件中，然后在 Linux 环境下编译运行，测试是否所有测试用例可以通过，用 lcov 生成 html 格式的测试报告。
</p>
<h2>
<a id="3__73">
</a>
3 操作过程
</h2>
<h3>
<a id="31_AI_74">
</a>
3.1 用 AI 优化需求
</h3>
<p>
首先编写一个让 ai 生成单元测试代码的需求，然后发给 ai 让其优化一下。
<br/>
<mark>
输入
</mark>
</p>
<pre><code class="prism language-bash">对这段代码编写单元测试案例，实现 100%语句覆盖、判定覆盖、条件覆盖<span class="token punctuation">(</span>CC<span class="token punctuation">)</span>、条件/判定覆盖<span class="token punctuation">(</span>C/DC<span class="token punctuation">)</span>、条件组合覆盖<span class="token punctuation">(</span>MCC<span class="token punctuation">)</span>、修正判定条件覆盖<span class="token punctuation">(</span>MCDC<span class="token punctuation">)</span>。
要求：
<span class="token number">1</span>、验证结果是否正确，不用预期结果与输出结果对比的方式，用遍历输出结果，判断是否前一个数据比后一个小
<span class="token number">2</span>、打印出哪些测试用例通过了，哪些测试用例没通过，生成一个结果测试报告。
<span class="token number">3</span>、除了生成一些常规的测试数据，再生成一些超长的，里面是随机数的输入数组，数组长度一个是 500，一个是 1000
<span class="token number">4</span>、生成一些长度不同的输入数组，长度从 100 连续到 299，共 200 组，里面都是随机数
<span class="token number">5</span>、每个测试用例封装成一个函数。
<span class="token number">6</span>、对于第 3 条和第 4 条要求的测试用例，打印测试结果时要标明测试数组长度。
<span class="token number">7</span>、用 malloc 申请内存存放输入数据时，测试完要及时释放。
<span class="token number">9</span>、常规测试数据里类型多一些，都是一些容易测试出代码问题的数据。
<span class="token number">10</span>、测试代码和被测试代码不在同一个文件中，被测试代码已经写好不需要 ai 再写一遍，只需要生成测试代码

以上是一个我要输入给文心一言的需求，现在对这个需求进行优化，让文心一言输出效果更好

</code></pre>
<p>
<mark>
输出
</mark>
</p>
<pre><code class="prism language-bash">为了优化您的需求描述，使其更清晰、具体，并引导生成更高质量的测试代码，以下是对原始需求的优化版本：

---

测试代码生成需求优化版
目标：
为给定的排序函数编写单元测试，确保实现 100%的语句覆盖、判定覆盖、条件覆盖<span class="token punctuation">(</span>CC<span class="token punctuation">)</span>、条件/判定覆盖<span class="token punctuation">(</span>C/DC<span class="token punctuation">)</span>、条件组合覆盖<span class="token punctuation">(</span>MCC<span class="token punctuation">)</span>、修正判定条件覆盖<span class="token punctuation">(</span>MCDC<span class="token punctuation">)</span>。
具体要求：
<span class="token number">1</span>. 验证方法：
不通过预期结果与输出结果对比，而是通过遍历输出结果，判断数组是否已排序（即前一个数据是否比后一个小）。
<span class="token number">2</span>. 测试报告：
打印出哪些测试用例通过了，哪些没通过。
生成一个详细的测试报告，包括测试用例名称和测试结果。
<span class="token number">3</span>. 测试用例生成：
常规测试数据：
包含多种类型的数据，如空数组、单元素数组、已排序数组、逆序数组、含重复元素的数组、特殊值数组（如最大/最小值、负数、零等）。
这些数据应易于触发代码中的潜在问题。
超长随机数组：
生成两个长度分别为 500 和 1000 的随机数组。
打印测试结果时标明测试数组长度。
连续长度随机数组：
生成长度从 100 到 299 的 200 组随机数组。
每组数组长度连续递增，打印测试结果时标明测试数组长度。
<span class="token number">4</span>. 测试用例封装：
每个测试用例应封装成一个独立的函数，便于管理和复用。
<span class="token number">5</span>. 内存管理：
使用 malloc 申请内存存放输入数据时，测试完成后要及时释放内存，避免内存泄漏。
<span class="token number">6</span>. 测试代码与被测试代码分离：
假设被测试代码已经写好，只需编写测试代码。
测试代码应位于与被测试代码不同的文件中。
优化后的详细步骤：
<span class="token number">1</span>. 编写测试框架：
创建一个测试框架，能够执行测试用例并记录结果。
提供函数用于打印测试报告。
<span class="token number">2</span>. 实现测试用例：
常规测试用例：
空数组测试。
单元素数组测试。
已排序数组测试。
逆序数组测试。
含重复元素的数组测试。
特殊值数组测试（如全为正数、全为负数、混合正负数、含零等）。
超长随机数组测试用例：
生成并测试长度为 500 和 1000 的随机数组。
连续长度随机数组测试用例：
生成并测试长度从 100 到 299 的 200 组随机数组。
<span class="token number">3</span>. 验证排序结果：
在每个测试用例中，遍历排序后的数组，检查是否满足排序条件（前一个元素小于或等于后一个元素）。
<span class="token number">4</span>. 内存管理：
确保在每个测试用例中，使用 malloc 分配的内存都在测试完成后被正确释放。
<span class="token number">5</span>. 生成测试报告：
在所有测试用例执行完毕后，生成并打印详细的测试报告，包括每个测试用例的名称、测试结果（通过/失败）以及任何额外的信息（如数组长度）。
期望输出：
• 一个清晰的测试报告，显示所有测试用例的执行结果。
• 对于失败的测试用例，应提供足够的信息以便定位问题。

---

通过优化后的需求描述，您可以更清晰地指导文心一言生成高质量的测试代码，确保覆盖所有必要的测试场景，并生成详细的测试报告。

</code></pre>
<h3>
<a id="32_AI_154">
</a>
3.2 用 AI 生成单元测试代码
</h3>
<p>
将被测试代码和需求发给 AI，让其生成相应的单元测试代码。
<br/>
<mark>
输入
</mark>
</p>
<pre><code class="prism language-bash"><span class="token comment">#include &lt;stdio.h&gt;</span>

<span class="token comment">#define MIN_RUN 32</span>

// 插入排序算法
void insertionSort<span class="token punctuation">(</span>int arr<span class="token punctuation">[</span><span class="token punctuation">]</span>, int left, int right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> left + <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> right<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int key <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
int j <span class="token operator">=</span> i - <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> left <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
arr<span class="token punctuation">[</span>j + <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
j--<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
arr<span class="token punctuation">[</span>j + <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

// 归并函数
void merge<span class="token punctuation">(</span>int arr<span class="token punctuation">[</span><span class="token punctuation">]</span>, int left, int mid, int right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int len1 <span class="token operator">=</span> mid - left + <span class="token number">1</span><span class="token punctuation">;</span>
int len2 <span class="token operator">=</span> right - mid<span class="token punctuation">;</span>
int L<span class="token punctuation">[</span>len1<span class="token punctuation">]</span>, R<span class="token punctuation">[</span>len2<span class="token punctuation">]</span><span class="token punctuation">;</span>

    int i <span class="token operator">=</span> <span class="token number">0</span>, j <span class="token operator">=</span> <span class="token number">0</span>, k<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len1<span class="token punctuation">;</span> i++<span class="token punctuation">)</span>
        L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>left + i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">;</span> j++<span class="token punctuation">)</span>
        R<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>mid + <span class="token number">1</span> + j<span class="token punctuation">]</span><span class="token punctuation">;</span>

    i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    k <span class="token operator">=</span> left<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1 <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> R<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            arr<span class="token punctuation">[</span>k++<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i++<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            arr<span class="token punctuation">[</span>k++<span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">[</span>j++<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1<span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>k++<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i++<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span>
        arr<span class="token punctuation">[</span>k++<span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">[</span>j++<span class="token punctuation">]</span><span class="token punctuation">;</span>
    while<span class="token punctuation">(</span>i<span class="token operator">&gt;</span>j <span class="token operator">&amp;&amp;</span> len<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>len2<span class="token punctuation">)</span>
    	arr<span class="token punctuation">[</span>i++<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j++<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

// Timsort 算法
void timSort<span class="token punctuation">(</span>int arr<span class="token punctuation">[</span><span class="token punctuation">]</span>, int n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">+=</span> MIN_RUN<span class="token punctuation">)</span>
insertionSort<span class="token punctuation">(</span>arr, i, <span class="token punctuation">(</span>i + MIN_RUN - <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> n ? <span class="token punctuation">(</span>i + MIN_RUN - <span class="token number">1</span><span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token punctuation">(</span>n - <span class="token number">1</span><span class="token punctuation">))</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>int size <span class="token operator">=</span> MIN_RUN<span class="token punctuation">;</span> size <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> size *<span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> left <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> left <span class="token operator">+=</span> <span class="token number">2</span> * size<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            int mid <span class="token operator">=</span> left + size - <span class="token number">1</span><span class="token punctuation">;</span>
            int right <span class="token operator">=</span> <span class="token punctuation">(</span>left + <span class="token number">2</span> * size - <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>n - <span class="token number">1</span><span class="token punctuation">)</span> ? <span class="token punctuation">(</span>left + <span class="token number">2</span> * size - <span class="token number">1</span><span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token punctuation">(</span>n - <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            merge<span class="token punctuation">(</span>arr, left, mid, right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

测试代码生成需求优化版

目标：
为给定的排序函数编写单元测试，确保实现 100%的语句覆盖、判定覆盖、条件覆盖<span class="token punctuation">(</span>CC<span class="token punctuation">)</span>、条件/判定覆盖<span class="token punctuation">(</span>C/DC<span class="token punctuation">)</span>、条件组合覆盖<span class="token punctuation">(</span>MCC<span class="token punctuation">)</span>、修正判定条件覆盖<span class="token punctuation">(</span>MCDC<span class="token punctuation">)</span>。

具体要求：

验证方法：
不通过预期结果与输出结果对比，而是通过遍历输出结果，判断数组是否已排序（即前一个数据是否比后一个小）。
测试报告：
打印出哪些测试用例通过了，哪些没通过。
生成一个详细的测试报告，包括测试用例名称和测试结果。
测试用例生成：
常规测试数据：
包含多种类型的数据，如空数组、单元素数组、已排序数组、逆序数组、含重复元素的数组、特殊值数组（如最大/最小值、负数、零等）。
这些数据应易于触发代码中的潜在问题。
超长随机数组：
生成两个长度分别为 500 和 1000 的随机数组。
打印测试结果时标明测试数组长度。
连续长度随机数组：
生成长度从 100 到 299 的 200 组随机数组。
每组数组长度连续递增，打印测试结果时标明测试数组长度。
测试用例封装：
每个测试用例应封装成一个独立的函数，便于管理和复用。
内存管理：
使用 malloc 申请内存存放输入数据时，测试完成后要及时释放内存，避免内存泄漏。
测试代码与被测试代码分离：
假设被测试代码已经写好，只需编写测试代码。
测试代码应位于与被测试代码不同的文件中。
优化后的详细步骤：

编写测试框架：
创建一个测试框架，能够执行测试用例并记录结果。
提供函数用于打印测试报告。
实现测试用例：
常规测试用例：
空数组测试。
单元素数组测试。
已排序数组测试。
逆序数组测试。
含重复元素的数组测试。
特殊值数组测试（如全为正数、全为负数、混合正负数、含零等）。
超长随机数组测试用例：
生成并测试长度为 500 和 1000 的随机数组。
连续长度随机数组测试用例：
生成并测试长度从 100 到 299 的 200 组随机数组。
验证排序结果：
在每个测试用例中，遍历排序后的数组，检查是否满足排序条件（前一个元素小于或等于后一个元素）。
内存管理：
确保在每个测试用例中，使用 malloc 分配的内存都在测试完成后被正确释放。
生成测试报告：
在所有测试用例执行完毕后，生成并打印详细的测试报告，包括每个测试用例的名称、测试结果（通过/失败）以及任何额外的信息（如数组长度）。
期望输出：

一个清晰的测试报告，显示所有测试用例的执行结果。
对于失败的测试用例，应提供足够的信息以便定位问题。

</code></pre>
<p>
<mark>
输出
</mark>
</p>
<pre><code class="prism language-bash">为了实现你要求的测试框架和测试用例，我们将创建一个新的 C 文件来包含测试代码，并确保与被测试代码（即 timSort 函数）分离。以下是详细的实现步骤：
<span class="token number">1</span>. 测试框架
首先，我们创建一个测试框架，能够执行测试用例并记录结果。
c 复制代码
<span class="token comment">#include &lt;stdio.h&gt;</span>
<span class="token comment">#include &lt;stdlib.h&gt;</span>
<span class="token comment">#include &lt;stdbool.h&gt;</span>
<span class="token comment">#include &lt;time.h&gt;</span>
// 假设 timSort 函数声明在这里（通常通过包含头文件）
extern void timSort<span class="token punctuation">(</span>int arr<span class="token punctuation">[</span><span class="token punctuation">]</span>, int n<span class="token punctuation">)</span><span class="token punctuation">;</span>
// 检查数组是否已排序
bool isSorted<span class="token punctuation">(</span>int arr<span class="token punctuation">[</span><span class="token punctuation">]</span>, int n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n - <span class="token number">1</span><span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> arr<span class="token punctuation">[</span>i + <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token builtin class-name">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
// 打印测试报告
void printTestReport<span class="token punctuation">(</span>const char* testName, bool result, int length <span class="token operator">=</span> -1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> -1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
printf<span class="token punctuation">(</span><span class="token string">"Test Case: %s - %s<span class="token entity" title="\n">\n</span>"</span>, testName, result ? <span class="token string">"Passed"</span> <span class="token builtin class-name">:</span> <span class="token string">"Failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
printf<span class="token punctuation">(</span><span class="token string">"Test Case: %s (Length: %d) - %s<span class="token entity" title="\n">\n</span>"</span>, testName, length, result ? <span class="token string">"Passed"</span> <span class="token builtin class-name">:</span> <span class="token string">"Failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
// 测试用例模板
void runTestCase<span class="token punctuation">(</span>const char* testName, int* arr, int n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
timSort<span class="token punctuation">(</span>arr, n<span class="token punctuation">)</span><span class="token punctuation">;</span>
bool result <span class="token operator">=</span> isSorted<span class="token punctuation">(</span>arr, n<span class="token punctuation">)</span><span class="token punctuation">;</span>
printTestReport<span class="token punctuation">(</span>testName, result, n<span class="token punctuation">)</span><span class="token punctuation">;</span>
// 释放内存（如果适用）
// 注意：在这个框架中，假设传入数组不是动态分配的，因此不需要释放
<span class="token punctuation">}</span>
<span class="token number">2</span>. 实现测试用例
接下来，我们实现具体的测试用例。
c 复制代码
void <span class="token function-name function">testEmptyArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Empty Array"</span>, arr, <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void <span class="token function-name function">testSingleElementArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Single Element Array"</span>, arr, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void <span class="token function-name function">testSortedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span>, <span class="token number">4</span>, <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Sorted Array"</span>, arr, <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void <span class="token function-name function">testReverseSortedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span>, <span class="token number">4</span>, <span class="token number">3</span>, <span class="token number">2</span>, <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Reverse Sorted Array"</span>, arr, <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void <span class="token function-name function">testArrayWithDuplicates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span>, <span class="token number">3</span>, <span class="token number">3</span>, <span class="token number">2</span>, <span class="token number">2</span>, <span class="token number">1</span>, <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Array With Duplicates"</span>, arr, <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void <span class="token function-name function">testSpecialValuesArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>INT_MAX, INT_MIN, <span class="token number">0</span>, -1, <span class="token number">1</span>, <span class="token number">99999</span>, -99999<span class="token punctuation">}</span><span class="token punctuation">;</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Special Values Array"</span>, arr, <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void testLongRandomArray<span class="token punctuation">(</span>int length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
int* arr <span class="token operator">=</span> <span class="token punctuation">(</span>int*<span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>length * sizeof<span class="token punctuation">(</span>int<span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> NULL<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
printf<span class="token punctuation">(</span><span class="token string">"Memory allocation failed for length %d<span class="token entity" title="\n">\n</span>"</span>, length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
// 填充随机数
srand<span class="token punctuation">(</span>time<span class="token punctuation">(</span>NULL<span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> % <span class="token number">100000</span> - <span class="token number">50000</span><span class="token punctuation">;</span> // 随机数范围 <span class="token punctuation">[</span>-50000, <span class="token number">49999</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
runTestCase<span class="token punctuation">(</span><span class="token string">"Long Random Array"</span>, arr, length<span class="token punctuation">)</span><span class="token punctuation">;</span>
// 释放内存
free<span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
void <span class="token function-name function">testSequentialLengthRandomArrays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>int length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> length <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">;</span> length++<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
testLongRandomArray<span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
int <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
// 运行常规测试用例
testEmptyArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testSingleElementArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testSortedArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testReverseSortedArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testArrayWithDuplicates<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testSpecialValuesArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
// 运行超长随机数组测试用例
testLongRandomArray<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testLongRandomArray<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
// 运行连续长度随机数组测试用例
testSequentialLengthRandomArrays<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token number">3</span>. 解释与注意事项
• 测试框架：runTestCase 函数用于执行排序并检查结果，同时打印测试报告。
• 测试用例：每个测试用例都是一个独立的函数，便于管理和复用。
• 内存管理：在 testLongRandomArray 中，使用 malloc 分配内存，并在测试完成后使用 free 释放内存。
• 随机数组生成：使用 rand 函数生成随机数，并用 srand<span class="token punctuation">(</span>time<span class="token punctuation">(</span>NULL<span class="token punctuation">))</span>确保每次运行产生不同的随机数序列。
• 测试报告：printTestReport 函数用于打印每个测试用例的结果，包括名称、是否通过以及数组长度（如果适用）。
这个测试框架和测试用例覆盖了多种可能的输入情况，确保了较高的代码覆盖率，并能够帮助定位潜在的问题。

</code></pre>
<h3>
<a id="33__406">
</a>
3.3 搭建测试环境
</h3>
<p>
将 ai 生成的代码放到 test.c 中，并做一些优化。内容如下：
</p>
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MIN_RUN</span> <span class="token expression"><span class="token number">32</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INT_MAX</span> <span class="token expression"><span class="token number">2147483647</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INT_MIN</span> <span class="token expression"><span class="token operator">-</span><span class="token number">2147483648</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>

<span class="token comment">// 假设 timSort 函数声明在这里（通常通过包含头文件）</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">timSort</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查数组是否已排序</span>
bool <span class="token function">isSorted</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> arr<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 打印测试报告</span>
<span class="token keyword">void</span> <span class="token function">printTestReport</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">\*</span> testName<span class="token punctuation">,</span> bool result<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Test Case: %s - %s\n"</span><span class="token punctuation">,</span> testName<span class="token punctuation">,</span> result <span class="token operator">?</span> <span class="token string">"Passed"</span> <span class="token operator">:</span> <span class="token string">"Failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Test Case: %s (Length: %d) - %s\n"</span><span class="token punctuation">,</span> testName<span class="token punctuation">,</span> length<span class="token punctuation">,</span> result <span class="token operator">?</span> <span class="token string">"Passed"</span> <span class="token operator">:</span> <span class="token string">"Failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试用例模板</span>
<span class="token keyword">void</span> <span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">_</span> testName<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">_</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">timSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
bool result <span class="token operator">=</span> <span class="token function">isSorted</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printTestReport</span><span class="token punctuation">(</span>testName<span class="token punctuation">,</span> result<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 释放内存（如果适用）</span>
<span class="token comment">// 注意：在这个框架中，假设传入数组不是动态分配的，因此不需要释放</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testEmptyArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Empty Array"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testSingleElementArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Single Element Array"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testSortedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Sorted Array"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testReverseSortedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Reverse Sorted Array"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testArrayWithDuplicates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Array With Duplicates"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testSpecialValuesArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>INT_MAX<span class="token punctuation">,</span> INT_MIN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">99999</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99999</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Special Values Array"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testLongRandomArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">int</span><span class="token operator">_</span> arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">_</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>length <span class="token operator">\*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Memory allocation failed for length %d\n"</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    <span class="token comment">// 填充随机数</span>
    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100000</span> <span class="token operator">-</span> <span class="token number">50000</span><span class="token punctuation">;</span> <span class="token comment">// 随机数范围 [-50000, 49999]</span>
    <span class="token punctuation">}</span>

    <span class="token function">runTestCase</span><span class="token punctuation">(</span><span class="token string">"Long Random Array"</span><span class="token punctuation">,</span> arr<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 释放内存</span>
    <span class="token function">free</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">testSequentialLengthRandomArrays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> length <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">;</span> length<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">testLongRandomArray</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 运行常规测试用例</span>
<span class="token function">testEmptyArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testSingleElementArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testSortedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testReverseSortedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testArrayWithDuplicates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">testSpecialValuesArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 运行超长随机数组测试用例</span>
    <span class="token function">testLongRandomArray</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">testLongRandomArray</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 运行连续长度随机数组测试用例</span>
    <span class="token function">testSequentialLengthRandomArrays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
<p>
将被测试代码放到 sort.c 中，编写一个脚本用于编译生成可执行文件，然后运行并生成测试覆盖率报告。测试目录内容如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ce86b4806d5346288626569b273adf9f.png">
<br/>
其中 test.sh 的内容如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/424e7ce92740403a883f3d6363625669.png">
<br/>
sort.c 是被测试代码。
</img>
</img>
</p>
<h3>
<a id="34_1_532">
</a>
3.4 第 1 次测试
</h3>
<p>
运行 test.sh 脚本，生成的测试报告如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9e0ede6677a24cdca2582510ccf719e3.png">
<br/>
从测试报告可以看出，在处理长度为 129 的数组时，程序运行发生的错误，在 sort.c 文件中加一些打印信息用于调试，添加过程如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e1b6dfdb841143c0ab7c35424a22da4e.png">
<br/>
然后只测试长度 129 的数组，运行结果如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c1c18603d9574914a0630f7af2ce8701.png">
<br/>
可以看到出错原因是因为运行到这里时，mid 比 right 的值大，而 merge 函数内容如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6c651483712c401a974356263db0ba7a.png">
<br/>
当 mid 大于 right 时，len2 的计算结果为负数，这使得声明数组 R 时出现错误。所以当 mid 大于 right 时，表示不能分成两段进行合并，因此就不需要合并。根据以上分析优化代码如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7ae352e7e7aa4738b7f086e856a9d001.png">
<br/>
再一次测试，测试用例全部通过。
</img>
</img>
</img>
</img>
</img>
</p>
<h3>
<a id="35_2_545">
</a>
3.5 第 2 次测试
</h3>
<p>
在分析第一个问题时发现，merge 函数中声明 L 数组和 R 数组的方式有些问题，代码如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/893afe86971c42f997eb0085ab277e80.png"/>
<br/>
这种方式声明的 L 数组和 R 数组存放在栈空间，栈空间相对较小，当输入的排序数组过大时，可能会出现内存溢出。为了验证是否会出现内存溢出，增加一个 100M 的输入数组用来测试。修改 test.c 内容如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f56d8c05199a4199a5688f0fa22f9a01.png"/>
<br/>
用修改完的 test.c 文件进一步测试，发现果然在处理 100M 大数组时出现程序运行错误，如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/42ea86ccf43e46af9360c42c006746d1.png"/>
<br/>
根据以上分析，决定将 L 和 R 用 malloc 的方式申请内存，使其数据存放到内存较大的堆空间，修改代码如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a6ba5b8175ae41a8934db798daf5f198.png"/>
<br/>
然后再一次测试发现测试用例全部通过，测试结果如下：
</p>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/52bd02c1000e419c8afc5daa12ea54a7.png"/>
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ad7cfa1a3d4f4d9ea789d1ae90f0e024.png"/>
<br/>
这时查看代码运行覆盖率报告，结果如下：
</p>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a097ff8ee07b4ca3b7ea52a2ef8a202f.png"/>
<br/>
可以看到其中有一段代码没有被运行到。
</p>
<h3>
<a id="35__3_562">
</a>
3.5 第 3 次测试
</h3>
<p>
以上所写操作方式并不是第一次就是这么做的，经历过多次的迭代，初期让 ai 生成测试代码时，并没有附加多条要求，这时 ai 生成的测试代码总是有几条无法覆盖。将覆盖率报告反馈给 ai 让其优化测试代码时，ai 指出来一段错误代码，如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f0a9e211c6284d78a79ba0d343ba9935.png"/>
<br/>
原始代码如下：
</p>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c2b67e995a9d46d2a56f12bcac559ede.png"/>
<br/>
前经过前面的代码处理后，这时应该 i=len1、j=len2，所以不会出现(i&gt;j &amp;&amp; len1&lt;len2)的情况。而且前面步骤已经将数据处理完毕，所以 45 行、46 行是错误的代码行。
<br/>
将错误代码删除，修改如下：
</p>
<p>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/53fc68d901724f689814d70e1d332165.png"/>
<br/>
用修改之后的代码再测试，此时测试用例全部通过，并且代码运行覆盖率为 100%，结果如下：
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ffd2fcc6cd224bb69a17c09f6b7b791a.png"/>
<br/>
<img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4be16c72b51949a3baf2810c3bdeb0f5.png"/>
</p>

   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f696e707574412f:61727469636c652f64657461696c732f313435343032393439" class_="artid" style="display:none">
 </p>
</div>
