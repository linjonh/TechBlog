---
layout: post
title: "ffmpeg混音以及音视频混合处理"
date: 2024-12-29 00:23:30 +0800
description: "_ffmpeg video mix"
keywords: "ffmpeg video mix"
categories: ['Node', 'Ffmpeg']
tags: ['Node', 'Ffmpeg']
artid: "86472948"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=86472948
    alt: "ffmpeg混音以及音视频混合处理"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=86472948
featuredImagePreview: https://bing.ee123.net/img/rand?artid=86472948
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ffmpeg混音以及音视频混合处理
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="ffmpeg_0">
     </a>
     ffmpeg混音以及音视频混合处理
    </h2>
    <h3>
     <a id="ffmpeg_1">
     </a>
     ffmpeg的命令
    </h3>
    <p>
     这里是我最近研究的音视频混合处理的一些ffmpeg的命令
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 音频拼接</span>
ffmpeg <span class="token operator">-</span>i <span class="token string">"concat:first.mp3|second.mp3"</span> <span class="token operator">-</span>acodec copy third<span class="token punctuation">.</span><span class="token function">mp3</span> <span class="token punctuation">(</span>third格式和first保持一致<span class="token punctuation">)</span>

<span class="token comment">// 音频拼接</span>
ffmpeg <span class="token operator">-</span>i <span class="token string">"concat:first.mp3|second.mp3"</span> <span class="token operator">-</span>i second<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>acodec copy test<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>map_metadata <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span> <span class="token punctuation">(</span>third格式和second保持一致<span class="token punctuation">)</span>

<span class="token comment">// 音视频混合，不调整音量</span>
ffmpeg <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>demo<span class="token punctuation">.</span>mp4 <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>new1<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>c<span class="token punctuation">:</span>v copy <span class="token operator">-</span>map <span class="token number">0</span><span class="token punctuation">:</span>v<span class="token punctuation">:</span><span class="token number">0</span> <span class="token operator">-</span>filter_complex <span class="token string">"[0:a][1:a]amerge=inputs=2[aout]"</span> <span class="token operator">-</span>map <span class="token string">"[aout]"</span> <span class="token operator">-</span>ac <span class="token number">2</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>mix_amerge<span class="token punctuation">.</span>mp4

<span class="token comment">// 音频混合，调整第1个音频的音量和第2个音频的音量</span>
ffmpeg <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>output<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>new1<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>filter_complex <span class="token string">"[0:a]aformat=sample_fmts=fltp:sample_rates=44100:channel_layouts=stereo,volume=0.5[a0]; [1:a]aformat=sample_fmts=fltp:sample_rates=44100:channel_layouts=stereo,volume=0.9[a1]; [a0][a1]amerge=inputs=2[aout]"</span> <span class="token operator">-</span>map <span class="token string">"[aout]"</span> <span class="token operator">-</span>ac <span class="token number">2</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>mix_v0<span class="token punctuation">.</span><span class="token number">5.</span>mp3

<span class="token comment">// 音频混合，调整第1个音频的音量和第2个音频的音量</span>
ffmpeg <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>output<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>new2<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>filter_complex <span class="token string">"[0:a]aformat=sample_fmts=fltp:channel_layouts=stereo,volume=0.5[a0]; [1:a]aformat=sample_fmts=fltp:channel_layouts=stereo,volume=0.9,adelay=5000|5000|5000,apad[a1]; [a0][a1]amerge=inputs=2[aout]"</span> <span class="token operator">-</span>shortest <span class="token operator">-</span>map <span class="token string">"[aout]"</span> <span class="token operator">-</span>ac <span class="token number">2</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>mix_new1<span class="token punctuation">.</span>mp3
<span class="token comment">// apad  -shortest   是使音频长度为最长</span>
<span class="token comment">// adelay            延时播放时间</span>

<span class="token comment">// 音视频混合，调整第1个音频的音量和第2个音频的音量 </span>
ffmpeg <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>demo<span class="token punctuation">.</span>mp4 <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>new2<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>filter_complex <span class="token string">"[0:a]aformat=sample_fmts=fltp:channel_layouts=stereo,volume=0.4[a0]; [1:a]aformat=sample_fmts=fltp:channel_layouts=stereo,volume=0.9,adelay=5000|5000|5000[a1]; [a0][a1]amix=inputs=2:duration=first[aout]"</span> <span class="token operator">-</span>map <span class="token punctuation">[</span>aout<span class="token punctuation">]</span> <span class="token operator">-</span>ac <span class="token number">2</span> <span class="token operator">-</span>c<span class="token punctuation">:</span>v copy <span class="token operator">-</span>map <span class="token number">0</span><span class="token punctuation">:</span>v<span class="token punctuation">:</span><span class="token number">0</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>mix_amerge3<span class="token punctuation">.</span>mp4
或者
ffmpeg <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>demo<span class="token punctuation">.</span>mp4 <span class="token operator">-</span>i <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>video<span class="token operator">/</span>new2<span class="token punctuation">.</span>mp3 <span class="token operator">-</span>filter_complex <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>a<span class="token punctuation">]</span>aformat<span class="token operator">=</span>sample_fmts<span class="token operator">=</span>fltp<span class="token punctuation">:</span>channel_layouts<span class="token operator">=</span>stereo<span class="token punctuation">,</span>volume<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">[</span>a0<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span>a<span class="token punctuation">]</span>aformat<span class="token operator">=</span>sample_fmts<span class="token operator">=</span>fltp<span class="token punctuation">:</span>channel_layouts<span class="token operator">=</span>stereo<span class="token punctuation">,</span>volume<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>adelay<span class="token operator">=</span><span class="token string">"5000|5000|5000"</span><span class="token punctuation">[</span>a1<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">[</span>a0<span class="token punctuation">]</span><span class="token punctuation">[</span>a1<span class="token punctuation">]</span>amix<span class="token operator">=</span>inputs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">:</span>duration<span class="token operator">=</span>first<span class="token punctuation">[</span>aout<span class="token punctuation">]</span> <span class="token operator">-</span>map <span class="token punctuation">[</span>aout<span class="token punctuation">]</span> <span class="token operator">-</span>ac <span class="token number">2</span> <span class="token operator">-</span>c<span class="token punctuation">:</span>v copy <span class="token operator">-</span>map <span class="token number">0</span><span class="token punctuation">:</span>v<span class="token punctuation">:</span><span class="token number">0</span> <span class="token constant">E</span><span class="token punctuation">:</span>\software\video\outfileName<span class="token punctuation">.</span>mp4 <span class="token constant">E</span><span class="token punctuation">:</span>\software\outfileName<span class="token punctuation">.</span>mp4
</code></pre>
    <h3>
     <a id="nodeffmpeg_26">
     </a>
     node执行ffmpeg命令
    </h3>
    <p>
     只需要把
     <strong>
      ffmpeg.exe放在node执行的目录下
     </strong>
     ，就可以使用node来执行ffmpeg命令。
     <br/>
     实例代码：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span>
child<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"ffmpeg -i "</span>concat<span class="token punctuation">:</span>first<span class="token punctuation">.</span>mp3<span class="token operator">|</span>second<span class="token punctuation">.</span>mp3<span class="token string">" -acodec copy third.mp3"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span>message <span class="token operator">=</span> err<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
        event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>callback<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        info<span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'音频处理保存成功'</span>
        event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>callback<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f71715f3336363037383630:2f61727469636c652f64657461696c732f3836343732393438" class_="artid" style="display:none">
 </p>
</div>


