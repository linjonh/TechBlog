---
layout: post
title: "计算机视觉3D-点云处理黑科技PointNet-原理剖析与实战指南"
date: 2025-03-06 16:09:42 +0800
description: "PointNet++在技术融合与应用扩展方面展现出广阔前景。在技术融合方面，它能够与Transformer结合，利用Transformer处理长距离依赖的能力，提升大规模点云数据的分析效率；同时，与生成对抗网络（GAN）结合，通过GAN实现点云补全和生成，显著增强模型对缺失数据的处理能力。在应用扩展方面，PointNet++展现出多样化的潜力。在医疗领域，它可以分析医学影像中的点云数据，辅助医生识别病变组织，从而提升诊断的准确性。在文物保护领域，通过处理文物扫描的点云数据，PointNet++支持文物的数字"
keywords: "计算机视觉｜3D 点云处理黑科技：PointNet++ 原理剖析与实战指南"
categories: ['计算机视觉', '炼金厂', '深度学习', 'Ai']
tags: ['计算机视觉', '深度学习', 'Pointnet', 'Cnn', '3D云数据', '3D云', '3D']
artid: "146058462"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146058462
    alt: "计算机视觉3D-点云处理黑科技PointNet-原理剖析与实战指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146058462
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146058462
cover: https://bing.ee123.net/img/rand?artid=146058462
image: https://bing.ee123.net/img/rand?artid=146058462
img: https://bing.ee123.net/img/rand?artid=146058462
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     计算机视觉｜3D 点云处理黑科技：PointNet++ 原理剖析与实战指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="font_color311b92_0">
     </a>
     <font color="#311b92">
      一、引言
     </font>
    </h3>
    <p>
     在当今数字化与智能化快速发展的时代，
     <font color="#311b92">
      <strong>
       3D 点云处理技术
      </strong>
     </font>
     在多个前沿领域中发挥着重要作用。特别是在自动驾驶和机器人视觉等领域，这项技术已成为实现智能化的关键支撑。
    </p>
    <p>
     以自动驾驶为例，车辆需要实时感知周围复杂的环境信息，包括行人、车辆、交通标志和路况等。
     <font color="#311b92">
      <strong>
       3D 点云数据
      </strong>
     </font>
     能够提供高精度的三维空间信息，使自动驾驶车辆更准确地识别和定位周围物体，从而做出安全、合理的行驶决策。在城市街道上，自动驾驶车辆通过 3D 点云处理技术，可以清晰地感知周围环境，有效应对复杂路况，提高行车的安全性和效率。
    </p>
    <p>
     在机器人视觉领域，
     <font color="#311b92">
      3D 点云处理技术
     </font>
     同样至关重要。机器人在执行任务时，需要对周围环境进行精确感知和理解，以完成物体抓取、导航避障等操作。3D 点云数据为机器人提供了详细的环境信息，使其能够准确感知物体的形状、位置和姿态，从而实现更智能的操作。例如，在工业生产线上，机器人利用 3D 点云处理技术，可以快速、准确地抓取目标物体，提升生产效率和质量。
    </p>
    <p>
     在 3D 点云处理的技术中，
     <font color="#311b92">
      <strong>
       PointNet++
      </strong>
     </font>
     是一种性能出色的
     <strong>
      3D 卷积网络
     </strong>
     ，受到广泛关注。它在处理 3D 点云数据时表现出色，为解决相关难题提供了有效方案。接下来，我们将深入探讨 PointNet++ 的工作原理及其在 3D 点云处理领域的应用。
    </p>
    <h3>
     <a id="font_color311b92PointNet__10">
     </a>
     <font color="#311b92">
      二、PointNet++ 诞生背景
     </font>
    </h3>
    <h4>
     <a id="font_color311b923D__12">
     </a>
     <font color="#311b92">
      （一）3D 点云数据特点与挑战
     </font>
    </h4>
    <p>
     <font color="#311b92">
      <strong>
       3D 点云数据
      </strong>
     </font>
     是由大量离散的三维坐标点组成的集合，这些点能够准确表示物体或场景的三维几何形状。在自动驾驶中，通过激光雷达获取的周围环境的 3D 点云数据，可以帮助车辆感知周围物体的位置和形状，从而支持行驶决策。但 3D 点云数据具有一些特殊性质，这些性质给传统机器学习和深度学习方法带来了挑战。
    </p>
    <ul>
     <li>
      <p>
       3D 点云数据具有
       <font color="#311b92">
        <strong>
         无序性
        </strong>
       </font>
       。与图像数据中像素点按固定行列顺序排列不同，点云数据中的点没有固定的排列顺序。例如，同一个物体的点云，无论点的顺序如何调整，其代表的形状和语义信息保持不变。这使得传统基于有序数据的处理方法，如卷积神经网络（CNN），难以直接应用于点云数据。因为 CNN 的卷积操作依赖数据的局部空间结构和顺序，而无序的点云数据无法满足这一条件。
      </p>
     </li>
     <li>
      <p>
       3D 点云数据还具有
       <font color="#311b92">
        <strong>
         稀疏性
        </strong>
       </font>
       。点云数据是对三维空间的离散采样，某些区域可能点较多，而其他区域点很少甚至没有点。在室内场景扫描中，由于家具或墙壁的遮挡，部分角落或遮挡区域可能无法获取点云数据。这种稀疏性导致数据分布不均匀，使得模型难以学习到全面的特征。传统深度学习方法在处理稀疏数据时效果较差，因为它们通常假设数据分布均匀。
      </p>
     </li>
     <li>
      <p>
       此外，3D 点云数据是
       <font color="#311b92">
        <strong>
         非结构化
        </strong>
       </font>
       的。与图像数据的规则网格结构不同，点云数据中的点之间没有明确的连接关系和拓扑结构。这增加了提取点云数据局部特征和全局特征的难度。
       <font color="#311b92">
        传统的
        <strong>
         图神经网络
        </strong>
        （GNN）虽然能处理非结构化数据，但在处理大规模点云数据时，由于
        <strong>
         计算复杂度高，效率较低
        </strong>
        。
       </font>
      </p>
     </li>
    </ul>
    <h4>
     <a id="font_color311b92PointNet_font_22">
     </a>
     <font color="#311b92">
      （二）PointNet 的局限性
     </font>
    </h4>
    <p>
     在
     <font color="#311b92">
      <strong>
       PointNet++
      </strong>
     </font>
     出现之前，
     <font color="#311b92">
      <strong>
       PointNet
      </strong>
      是一种创新的点云处理网络，首次实现了直接处理 3D 点云数据
     </font>
     ，无需将其转换为体素或多视图图像等其他格式。它通过对称函数和最大池化操作，解决了点云数据的无序性问题，能够提取点云的全局特征，在 3D 形状分类和目标检测等任务中取得了一定成果。
    </p>
    <p>
     然而，PointNet 存在一些局限性。它无法有效提取
     <font color="#311b92">
      <strong>
       局部特征
      </strong>
     </font>
     。在实际应用中，物体的局部特征对准确识别和理解物体至关重要。例如，在识别汽车时，轮子、车门等局部特征是判断其类别的重要依据。而 PointNet 仅对整个点云进行全局特征提取，忽略了点云数据中的局部结构信息，导致在处理复杂形状或需要精细分类的任务时，性能不足。
    </p>
    <p>
     PointNet 对不同密度点云数据的适应性较差。由于点云数据的采集受多种因素影响，不同场景或设备采集到的点云数据密度可能差异较大。面对密度不一致的点云数据时，PointNet 难以学习到统一的特征表示，影响模型的
     <font color="#311b92">
      <strong>
       泛化能力
      </strong>
      和
      <strong>
       准确性
      </strong>
     </font>
     。
    </p>
    <p>
     此外，PointNet 在处理大规模点云数据时，
     <font color="#311b92">
      <strong>
       计算效率较低
      </strong>
     </font>
     。随着点云数据规模增加，其计算量显著增大，这在对实时性要求较高的场景（如自动驾驶）中成为一个重要问题。这些局限性为 PointNet++ 的发展提供了动力，推动了 3D 点云处理技术的进一步研究和改进。
    </p>
    <h3>
     <a id="font_color311b92PointNet__32">
     </a>
     <font color="#311b92">
      三、PointNet++ 原理剖析
     </font>
    </h3>
    <h4>
     <a id="font_color311b92_34">
     </a>
     <font color="#311b92">
      （一）核心架构与设计理念
     </font>
    </h4>
    <p>
     <font color="#311b92">
      <strong>
       PointNet++
      </strong>
     </font>
     采用层次化的特征学习架构，这是其与 PointNet 的主要区别。它通过在不同尺度上对局部区域进行特征提取和聚合，能够学习到点云数据的局部和全局特征。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c50342561bd54ed1b2505d6c9d848a5c.png"/>
    </p>
    <p>
     其核心模块是
     <font color="#311b92">
      <strong>
       Set Abstraction（SA）模块
      </strong>
     </font>
     ，包含三个关键步骤：
     <font color="#311b92">
      <strong>
       采样
      </strong>
      、
      <strong>
       分组
      </strong>
      和
      <strong>
       PointNet 处理
      </strong>
     </font>
     。
    </p>
    <ul>
     <li>
      <p>
       在
       <font color="#311b92">
        <strong>
         采样阶段
        </strong>
       </font>
       ，通过特定算法从大量点云数据中选取代表性的点，这些点称为质心点，用于后续处理。这一步骤减少数据量，同时保留点云的关键结构信息。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         分组阶段
        </strong>
       </font>
       以质心点为中心，根据规则（如距离阈值或固定数量的最近邻点），将周围的点划分为不同组，每组代表一个局部区域。这样，整个点云数据被分割成多个局部区域，每个区域包含一定范围内的点云信息。
      </p>
     </li>
     <li>
      <p>
       在每个分组内，
       <font color="#311b92">
        <strong>
         PointNet++
        </strong>
        使用
        <strong>
         PointNet
        </strong>
        对局部区域的点云进行特征学习
       </font>
       。PointNet 提取每个局部区域的特征，并通过对称函数（如最大池化）将这些局部特征聚合为一个全局特征，生成每个质心点的特征表示。
      </p>
     </li>
    </ul>
    <p>
     通过多次迭代应用 Set Abstraction 模块，PointNet++ 能够学习到
     <font color="#311b92">
      <strong>
       多级别特征
      </strong>
     </font>
     ，从局部细微特征过渡到全局宏观特征。这种层次化设计使模型能够捕捉点云数据中不同尺度的几何结构信息，并在处理过程中保持旋转不变性和置换不变性。无论点云数据如何旋转或点的顺序如何变化，模型都能提取一致的特征。
    </p>
    <h4>
     <a id="font_color311b92_51">
     </a>
     <font color="#311b92">
      （二）关键技术解析
     </font>
    </h4>
    <h5>
     <a id="font_color311b921FPS_53">
     </a>
     <font color="#311b92">
      1、采样策略：最远点采样（FPS）算法
     </font>
    </h5>
    <p>
     在 PointNet++ 中，采样策略用于从大量点云数据中选取代表性的点，
     <font color="#311b92">
      <strong>
       最远点采样
      </strong>
      （FPS）算法
     </font>
     是实现这一目标的关键技术。FPS 算法基于贪心策略，每次选择距离已采样点最远的点作为下一个采样点，确保采样点在点云空间中分布均匀，保留关键信息。
    </p>
    <p>
     具体过程如下：
    </p>
    <ul>
     <li>
      对于包含 N 个点的点云集合，首先随机选择一个初始采样点。
     </li>
     <li>
      然后，计算其余点到该点的欧氏距离，选择距离最远的点作为第二个采样点。
     </li>
     <li>
      接着，对于每个未采样点，计算其到已采样点集合的最小距离，从中选择最小距离最大的点作为下一个采样点。
     </li>
     <li>
      重复此过程，直到达到预定采样点数。
     </li>
    </ul>
    <p>
     <strong>
      例如
     </strong>
     ，在表示建筑物的点云数据中，FPS 算法可选择角落、边缘等关键位置的点作为采样点，代表整体形状和结构。与随机采样相比，FPS 避免采样点过于集中，降低计算量并提高模型对不同形状点云的适应性。
    </p>
    <h5>
     <a id="font_color311b922Ball_Query__65">
     </a>
     <font color="#311b92">
      2、分组操作：Ball Query 方法
     </font>
    </h5>
    <p>
     分组操作是 PointNet++ 中获取局部区域点云的重要步骤，
     <font color="#311b92">
      <strong>
       Ball Query 方法
      </strong>
     </font>
     是常用手段。
     <font color="#311b92">
      该方法以采样点为中心，根据设定的半径和点数进行分组。
      <strong>
       具体过程为
      </strong>
      ：
     </font>
     以每个采样点为球心，以半径
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        r 
        
       
      
        r
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          r
         </span>
        </span>
       </span>
      </span>
     </span>
     画球，在球内选取距离球心最近的
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        K 
        
       
      
        K
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0715em;">
          K
         </span>
        </span>
       </span>
      </span>
     </span>
     个点（若点数不足
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        K 
        
       
      
        K
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0715em;">
          K
         </span>
        </span>
       </span>
      </span>
     </span>
     ，则全选），这些点与采样点构成一个局部区域。
    </p>
    <p>
     <strong>
      例如
     </strong>
     ，在一个点云数据集中，若设定半径为 0.5 米、点数为 32，则以采样点为中心，在半径 0.5 米的球形区域内选取最近的 32 个点。每个采样点对应一个局部区域，捕捉点云的局部几何结构信息，为后续特征提取提供基础。
    </p>
    <h5>
     <a id="font_color311b923PointNet__71">
     </a>
     <font color="#311b92">
      3、特征学习：PointNet 在每个分组内的应用
     </font>
    </h5>
    <p>
     完成采样和分组后，PointNet++ 在每个分组内利用
     <font color="#311b92">
      <strong>
       PointNet
      </strong>
     </font>
     进行特征学习。PointNet 直接处理点云数据，通过
     <font color="#311b92">
      <strong>
       多层感知机（MLP
      </strong>
      ）
     </font>
     将局部点云的坐标及其他特征（如颜色、法向量）映射到高维空间，提取更有表达能力的特征。
    </p>
    <p>
     <strong>
      例如
     </strong>
     ，在表示汽车点云的分组中，PointNet 输入三维坐标和颜色信息，经过 MLP 的多层变换，输出高维特征向量，包含局部区域的几何形状和颜色分布信息。然后，通过最大池化等对称函数，将分组内所有点的特征聚合为一个全局特征向量，代表该局部区域的特征。这为多尺度特征融合和全局特征提取奠定基础。
    </p>
    <h5>
     <a id="font_color311b924MSG_MRG_77">
     </a>
     <font color="#311b92">
      4、多尺度特征融合：MSG（多尺度分组）和 MRG（多分辨率分组）方法
     </font>
    </h5>
    <p>
     点云数据密度差异给特征提取带来挑战，PointNet++ 提出
     <font color="#311b92">
      <strong>
       MSG
      </strong>
      （多尺度分组）
     </font>
     和
     <font color="#311b92">
      <strong>
       MRG
      </strong>
      （多分辨率分组）
     </font>
     方法，实现多尺度特征融合，提升对复杂场景的适应性。
    </p>
    <ul>
     <li>
      <p>
       <strong>
        MSG 方法
       </strong>
       在同一采样点上使用不同半径进行分组，分别提取特征并融合。例如，对一个采样点，以半径 r1、r2、r3 进行 Ball Query 分组，得到三个尺度的局部区域，利用 PointNet 提取特征后，将三个特征向量拼接，形成包含多尺度信息的特征向量。这使模型能同时捕捉不同尺度特征，适应密度不均匀的点云数据。
      </p>
     </li>
     <li>
      <p>
       <strong>
        MRG 方法
       </strong>
       从不同分辨率角度分组。先将点云划分为高、中、低分辨率子集，在各子集上进行分组和特征提取，最后融合特征。高分辨率子集点多，捕捉细微特征；低分辨率子集点少，提供宏观结构信息。通过融合不同分辨率特征，模型充分利用点云信息，提升复杂场景理解能力。
      </p>
     </li>
    </ul>
    <h4>
     <a id="font_color311b92_3D__84">
     </a>
     <font color="#311b92">
      （三）与其他 3D 卷积网络对比优势
     </font>
    </h4>
    <p>
     与常见的 3D 卷积网络相比，
     <font color="#311b92">
      PointNet++
     </font>
     具有多项优势。特别是在计算效率、特征提取能力以及处理不规则数据的适应性方面，确实展现了PointNet++的独特优势。
    </p>
    <ol>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         计算效率
        </strong>
       </font>
       ：PointNet++避免了传统3D CNN中需要将点云数据转换为体素网格的过程，因此在内存消耗和计算资源方面具有明显优势。尤其在自动驾驶场景中，需要实时处理大量点云数据时，PointNet++能够显著提升计算效率，确保车辆能够迅速作出决策。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         特征提取能力
        </strong>
       </font>
       ：与传统的体素化CNN不同，PointNet++通过其层次化特征学习架构，能够捕捉到点云数据的局部和全局特征。这对于具有复杂几何形状和不规则结构的物体尤其重要，因为传统的体素化处理往往会丢失细节，而PointNet++能保留并精准提取这些细节，提升分类和分割精度。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         适应性与鲁棒性
        </strong>
       </font>
       ：PointNet++通过特殊的采样、分组以及特征学习方法，有效应对点云数据中的无序性和稀疏性。在实际应用中，点云数据的密度不均、噪声以及不规则性常常影响结果，PointNet++的设计使其能够提高对这些挑战的适应性，增强模型的鲁棒性和泛化能力。
      </p>
     </li>
    </ol>
    <p>
     从这几点来看，PointNet++在处理大规模和复杂点云数据时显得更加高效和精确。你有什么想法或想进一步深入探讨的地方吗？
    </p>
    <h3>
     <a id="font_color311b92PointNet_font_95">
     </a>
     <font color="#311b92">
      四、PointNet++ 应用领域
     </font>
    </h3>
    <h4>
     <a id="font_color311b92font_97">
     </a>
     <font color="#311b92">
      （一）应用领域与案例展示
     </font>
    </h4>
    <p>
     <font color="#311b92">
      PointNet++
     </font>
     凭借其强大的点云处理能力，在多个领域展现出重要价值。
    </p>
    <h5>
     <a id="font_color311b921_font_99">
     </a>
     <font color="#311b92">
      1. 自动驾驶领域
     </font>
    </h5>
    <p>
     在自动驾驶中，障碍物检测和场景感知是关键任务。例如，特斯拉的自动驾驶系统利用 PointNet++ 处理激光雷达获取的点云数据。通过实时分析周围环境，PointNet++ 能准确识别车辆、行人、交通标志等障碍物，并估计其位置、速度和运动方向。在复杂的城市道路中，PointNet++ 快速识别潜在危险目标，为自动驾驶决策提供支持，有效避免碰撞，确保行车安全。
    </p>
    <h5>
     <a id="font_color311b922_font_103">
     </a>
     <font color="#311b92">
      2. 机器人视觉领域
     </font>
    </h5>
    <p>
     在机器人视觉中，物体识别和抓取是任务基础。尤其在工业生产线上，机器人需识别不同形状和材质的零部件，进行抓取与组装。借助 PointNet++，机器人分析零部件的点云数据，提取
     <font color="#311b92">
      独特特征
     </font>
     ，实现精确识别和定位。面对多种零部件时，PointNet++ 判断其类别和姿态，引导机器人准确抓取目标，提升生产效率和产品质量。
    </p>
    <h5>
     <a id="font_color311b923_font_107">
     </a>
     <font color="#311b92">
      3. 虚拟现实领域
     </font>
    </h5>
    <p>
     在虚拟现实（VR）中，场景重建是核心技术之一。通过 PointNet++ 处理现实场景的点云数据，可以快速、准确地重建三维场景模型。例如，在虚拟旅游应用中，PointNet++ 处理景区的点云数据后，生成真实的三维场景，用户通过头戴设备浏览世界各地的名胜古迹，实现自由探索。
    </p>
    <h3>
     <a id="font_color311b92font_111">
     </a>
     <font color="#311b92">
      五、代码实战
     </font>
    </h3>
    <p>
     下面以 PyTorch 框架为例，展示 PointNet++ 的基本代码实现，包括模型搭建、训练和测试过程，同时会介绍实践中数据预处理、超参数调整、模型评估等要点。
    </p>
    <h4>
     <a id="font_color311b92font_115">
     </a>
     <font color="#311b92">
      （一）模型搭建
     </font>
    </h4>
    <p>
     首先，需要导入必要的库，如
     <code>
      torch
     </code>
     、
     <code>
      torch.nn
     </code>
     等。然后，根据 PointNet++ 的原理，定义关键的函数和模块，如最远点采样（FPS）、球形邻域查询（Ball Query）、Set Abstraction（SA）模块和 Feature Propagation（FP）模块等。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F

<span class="token keyword">def</span> <span class="token function">squaredistance</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>
    B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> <span class="token operator">=</span> src<span class="token punctuation">.</span>shape
    _<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token operator">=</span> dst<span class="token punctuation">.</span>shape
    dist <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dist <span class="token operator">+=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>src<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span>N<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    dist <span class="token operator">+=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>dst<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>M<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dist

<span class="token keyword">def</span> <span class="token function">farthestpointsample</span><span class="token punctuation">(</span>xyz<span class="token punctuation">,</span> npoint<span class="token punctuation">)</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> xyz<span class="token punctuation">.</span>device
    B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> C <span class="token operator">=</span> xyz<span class="token punctuation">.</span>shape
    centroids <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>B<span class="token punctuation">,</span>npoint<span class="token punctuation">,</span>dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    distance <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>B<span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1e10</span>
    farthest <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>N<span class="token punctuation">,</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    batchindices <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>B<span class="token punctuation">,</span>dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>npoint<span class="token punctuation">)</span><span class="token punctuation">:</span>
        centroids<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> farthest
        centroid <span class="token operator">=</span> xyz<span class="token punctuation">[</span>batchindices<span class="token punctuation">,</span>farthest<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
        dist <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>xyz<span class="token operator">-</span>centroid<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        mask <span class="token operator">=</span> dist <span class="token operator">&lt;</span> distance
        distance<span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">[</span>mask<span class="token punctuation">]</span>
        farthest <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>distance<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> centroids

<span class="token keyword">def</span> <span class="token function">indexpoints</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> points<span class="token punctuation">.</span>device
    B <span class="token operator">=</span> points<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    viewshape <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>idx<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    viewshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>viewshape<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    repeatshape <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>idx<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    repeatshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    batchindices <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>B<span class="token punctuation">,</span>dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>viewshape<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span>repeatshape<span class="token punctuation">)</span>
    <span class="token keyword">return</span> points<span class="token punctuation">[</span>batchindices<span class="token punctuation">,</span>idx<span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">queryballpoint</span><span class="token punctuation">(</span>radius<span class="token punctuation">,</span> nsample<span class="token punctuation">,</span> xyz<span class="token punctuation">,</span> newxyz<span class="token punctuation">)</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> xyz<span class="token punctuation">.</span>device
    B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> C <span class="token operator">=</span> xyz<span class="token punctuation">.</span>shape
    _<span class="token punctuation">,</span> S<span class="token punctuation">,</span> _ <span class="token operator">=</span> newxyz<span class="token punctuation">.</span>shape
    groupidx <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>N<span class="token punctuation">,</span>dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">[</span>B<span class="token punctuation">,</span>S<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    sqrdists <span class="token operator">=</span> squaredistance<span class="token punctuation">(</span>newxyz<span class="token punctuation">,</span> xyz<span class="token punctuation">)</span>
    groupidx<span class="token punctuation">[</span>sqrdists <span class="token operator">&gt;</span> radius<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> N
    groupidx <span class="token operator">=</span> groupidx<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span>nsample<span class="token punctuation">]</span>
    groupfirst <span class="token operator">=</span> groupidx<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span>S<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>nsample<span class="token punctuation">]</span><span class="token punctuation">)</span>
    mask <span class="token operator">=</span> groupidx <span class="token operator">==</span> N
    groupidx<span class="token punctuation">[</span>mask<span class="token punctuation">]</span> <span class="token operator">=</span> groupfirst<span class="token punctuation">[</span>mask<span class="token punctuation">]</span>
    <span class="token keyword">return</span> groupidx

<span class="token keyword">class</span> <span class="token class-name">PointNetSetAbstraction</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> npoint<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> nsample<span class="token punctuation">,</span> inchannel<span class="token punctuation">,</span> mlp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>npoint <span class="token operator">=</span> npoint
        self<span class="token punctuation">.</span>radius <span class="token operator">=</span> radius
        self<span class="token punctuation">.</span>nsample <span class="token operator">=</span> nsample
        layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        lastchannel <span class="token operator">=</span> inchannel <span class="token operator">+</span><span class="token number">3</span>
        <span class="token keyword">for</span> outchannel <span class="token keyword">in</span> mlp<span class="token punctuation">:</span>
            layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>lastchannel<span class="token punctuation">,</span>outchannel<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>outchannel<span class="token punctuation">)</span><span class="token punctuation">)</span>
            layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            lastchannel <span class="token operator">=</span> outchannel
        self<span class="token punctuation">.</span>mlp <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>layers<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> xyz<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        B<span class="token punctuation">,</span> N<span class="token punctuation">,</span> C <span class="token operator">=</span> xyz<span class="token punctuation">.</span>shape
        S <span class="token operator">=</span> self<span class="token punctuation">.</span>npoint
        fpsidx <span class="token operator">=</span> farthestpointsample<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span> S<span class="token punctuation">)</span>
        newxyz <span class="token operator">=</span> indexpoints<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span> fpsidx<span class="token punctuation">)</span>
        idx <span class="token operator">=</span> queryballpoint<span class="token punctuation">(</span>self<span class="token punctuation">.</span>radius<span class="token punctuation">,</span> self<span class="token punctuation">.</span>nsample<span class="token punctuation">,</span> xyz<span class="token punctuation">,</span> newxyz<span class="token punctuation">)</span>
        groupedxyz <span class="token operator">=</span> indexpoints<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">-</span> newxyz<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> points <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            groupedpoints <span class="token operator">=</span> indexpoints<span class="token punctuation">(</span>points<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
            groupedpoints <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>groupedxyz<span class="token punctuation">,</span> groupedpoints<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            groupedpoints <span class="token operator">=</span> groupedxyz
        groupedpoints <span class="token operator">=</span> groupedpoints<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        newpoints <span class="token operator">=</span> self<span class="token punctuation">.</span>mlp<span class="token punctuation">(</span>groupedpoints<span class="token punctuation">)</span>
        newpoints <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>newpoints<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> newxyz<span class="token punctuation">,</span> newpoints

<span class="token keyword">class</span> <span class="token class-name">PointNetFeaturePropagation</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inchannel<span class="token punctuation">,</span> mlp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        lastchannel <span class="token operator">=</span> inchannel
        <span class="token keyword">for</span> outchannel <span class="token keyword">in</span> mlp<span class="token punctuation">:</span>
            layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv1d<span class="token punctuation">(</span>lastchannel<span class="token punctuation">,</span>outchannel<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span>outchannel<span class="token punctuation">)</span><span class="token punctuation">)</span>
            layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            lastchannel <span class="token operator">=</span> outchannel
        self<span class="token punctuation">.</span>mlp <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>layers<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> xyz1<span class="token punctuation">,</span> xyz2<span class="token punctuation">,</span> points1<span class="token punctuation">,</span> points2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> xyz1 <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>mlp<span class="token punctuation">(</span>points2<span class="token punctuation">)</span>
        dists <span class="token operator">=</span> squaredistance<span class="token punctuation">(</span>xyz1<span class="token punctuation">,</span> xyz2<span class="token punctuation">)</span>
        dists<span class="token punctuation">,</span> idx <span class="token operator">=</span> dists<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        dists<span class="token punctuation">,</span> idx <span class="token operator">=</span> dists<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> idx<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
        distrecip <span class="token operator">=</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span>dists <span class="token operator">+</span><span class="token number">1e-8</span><span class="token punctuation">)</span>
        norm <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>distrecip<span class="token punctuation">,</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        weight <span class="token operator">=</span> distrecip<span class="token operator">/</span>norm
        interpolatedpoints <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>indexpoints<span class="token punctuation">(</span>points2<span class="token punctuation">,</span>idx<span class="token punctuation">)</span><span class="token operator">*</span>weight<span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> points1 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            newpoints <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>points1<span class="token punctuation">,</span>interpolatedpoints<span class="token punctuation">]</span><span class="token punctuation">,</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            newpoints <span class="token operator">=</span> interpolatedpoints
        newpoints <span class="token operator">=</span> newpoints<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        newpoints <span class="token operator">=</span> self<span class="token punctuation">.</span>mlp<span class="token punctuation">(</span>newpoints<span class="token punctuation">)</span>
        newpoints <span class="token operator">=</span> newpoints<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> newpoints

<span class="token keyword">class</span> <span class="token class-name">PointNet2Cls</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> numclasses<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sa1 <span class="token operator">=</span> PointNetSetAbstraction<span class="token punctuation">(</span>npoint<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>nsample<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span>inchannel<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>mlp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sa2 <span class="token operator">=</span> PointNetSetAbstraction<span class="token punctuation">(</span>npoint<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span>nsample<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span>inchannel<span class="token operator">=</span><span class="token number">128</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span>mlp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>sa3 <span class="token operator">=</span> PointNetSetAbstraction<span class="token punctuation">(</span>npoint<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>radius<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>nsample<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>inchannel<span class="token operator">=</span><span class="token number">256</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span>mlp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">512</span><span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">512</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>drop1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>drop2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span>numclasses<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> xyz<span class="token punctuation">)</span><span class="token punctuation">:</span>
        xyz <span class="token operator">=</span> xyz<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        l1xyz<span class="token punctuation">,</span> l1points <span class="token operator">=</span> self<span class="token punctuation">.</span>sa1<span class="token punctuation">(</span>xyz<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        l2xyz<span class="token punctuation">,</span> l2points <span class="token operator">=</span> self<span class="token punctuation">.</span>sa2<span class="token punctuation">(</span>l1xyz<span class="token punctuation">,</span> l1points<span class="token punctuation">)</span>
        l3xyz<span class="token punctuation">,</span> l3points <span class="token operator">=</span> self<span class="token punctuation">.</span>sa3<span class="token punctuation">(</span>l2xyz<span class="token punctuation">,</span> l2points<span class="token punctuation">)</span>
        x <span class="token operator">=</span> l3points<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>drop1<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>drop2<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x
</code></pre>
    <h4>
     <a id="font_color311b92_262">
     </a>
     <font color="#311b92">
      （二）数据预处理
     </font>
    </h4>
    <p>
     在训练模型之前，需要对数据进行预处理。这包括数据的读取、归一化、划分训练集和测试集等步骤。以常见的 ModelNet40 数据集为例，数据集中每个样本是一个包含三维坐标的点云文件。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> data

<span class="token keyword">class</span> <span class="token class-name">ModelNet40</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> root<span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'train'</span><span class="token punctuation">,</span> numpoints<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span> transform<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>root <span class="token operator">=</span> root
        self<span class="token punctuation">.</span>split <span class="token operator">=</span> split
        self<span class="token punctuation">.</span>numpoints <span class="token operator">=</span> numpoints
        self<span class="token punctuation">.</span>transform <span class="token operator">=</span> transform
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>catfile <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> <span class="token string">'modelnet40shapenames.txt'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>cat <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>catfile<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>classes <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cat<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>cat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>cat<span class="token punctuation">:</span>
            <span class="token keyword">for</span> fn <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> split <span class="token operator">==</span> <span class="token string">'train'</span> <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>fn<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> split <span class="token operator">==</span> <span class="token string">'test'</span> <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>fn<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pointset <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        label <span class="token operator">=</span> self<span class="token punctuation">.</span>label<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        pointset <span class="token operator">=</span> pointset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
        choice <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>pointset<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>numpoints<span class="token punctuation">,</span> replace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        pointset <span class="token operator">=</span> pointset<span class="token punctuation">[</span>choice<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
        pointset <span class="token operator">-=</span> np<span class="token punctuation">.</span>expanddims<span class="token punctuation">(</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>pointset<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        dist <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>pointset<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        pointset <span class="token operator">/=</span> dist
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transform <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            pointset <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>pointset<span class="token punctuation">)</span>
        pointset <span class="token operator">=</span> torch<span class="token punctuation">.</span>fromnumpy<span class="token punctuation">(</span>pointset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        label <span class="token operator">=</span> torch<span class="token punctuation">.</span>fromnumpy<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> pointset<span class="token punctuation">,</span> label
    
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="font_color311b92_312">
     </a>
     <font color="#311b92">
      （三）训练过程
     </font>
    </h4>
    <p>
     定义好模型和数据预处理函数后，就可以进行模型的训练了。在训练过程中，需要设置损失函数（如交叉熵损失函数）、优化器（如 Adam 优化器），并迭代训练多个 epoch。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> data

<span class="token comment"># 定义设备</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda:0"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>isavailable<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>

<span class="token comment"># 超参数设置</span>
batchsize<span class="token operator">=</span><span class="token number">32</span>
numepochs<span class="token operator">=</span><span class="token number">50</span>
learningrate<span class="token operator">=</span><span class="token number">0.001</span>
numclasses<span class="token operator">=</span><span class="token number">40</span>

<span class="token comment"># 加载数据集</span>
traindataset <span class="token operator">=</span> ModelNet40<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data/modelnet40normalresampled'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'train'</span><span class="token punctuation">)</span>
trainloader <span class="token operator">=</span> data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>traindataset<span class="token punctuation">,</span> batchsize<span class="token operator">=</span>batchsize<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> numworkers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
testdataset <span class="token operator">=</span> ModelNet40<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'data/modelnet40normalresampled'</span><span class="token punctuation">,</span> split<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
testloader <span class="token operator">=</span> data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>testdataset<span class="token punctuation">,</span> batchsize<span class="token operator">=</span>batchsize<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> numworkers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token comment"># 初始化模型、损失函数和优化器</span>
model <span class="token operator">=</span> PointNet2Cls<span class="token punctuation">(</span>numclasses<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learningrate<span class="token punctuation">)</span>

<span class="token comment"># 训练模型</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>numepochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
    runningloss <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>points<span class="token punctuation">,</span> labels<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span><span class="token punctuation">:</span>
        points<span class="token punctuation">,</span> labels <span class="token operator">=</span> points<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 修正：原代码中的zerograd应为zero_grad()</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
        runningloss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Epoch</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>numepochs<span class="token punctuation">}</span></span><span class="token string">,Loss:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>runningloss<span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>trainloader<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)'</span></span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="font_color311b92_360">
     </a>
     <font color="#311b92">
      （四）测试过程
     </font>
    </h4>
    <p>
     训练完成后，需要对模型进行测试，评估其性能。可以使用准确率等指标来衡量模型的表现。
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> torch

<span class="token comment"># 测试模型</span>
model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
correct <span class="token operator">=</span> <span class="token number">0</span>
total <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 修正：nograd→no_grad</span>
    <span class="token keyword">for</span> points<span class="token punctuation">,</span> labels <span class="token keyword">in</span> testloader<span class="token punctuation">:</span>
        points<span class="token punctuation">,</span> labels <span class="token operator">=</span> points<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 移除.data（新版本PyTorch不需要）</span>
        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 移除可能多余的squeeze()</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Accuracy:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token number">100</span><span class="token operator">*</span>correct<span class="token operator">/</span>total<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">%'</span></span><span class="token punctuation">)</span>  <span class="token comment"># 优化输出格式</span>
</code></pre>
    <h4>
     <a id="font_color311b92font_383">
     </a>
     <font color="#311b92">
      （五）实践要点
     </font>
    </h4>
    <p>
     <font color="#311b92">
      <strong>
       1、数据预处理要点
      </strong>
      ：
     </font>
    </p>
    <ul>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         归一化
        </strong>
        ：
       </font>
       对输入点云数据进行归一化处理，将其缩放到一个合适的范围，如 [-1, 1] 或 [0, 1]，有助于提高模型的收敛速度和稳定性。上述代码中，通过减去点云的均值并除以最大距离进行归一化。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         数据增强
        </strong>
        ：
       </font>
       可以采用随机旋转、平移、缩放等数据增强方法，增加数据的多样性，防止模型过拟合。在实际应用中，可以根据具体任务和数据特点选择合适的数据增强策略。
      </p>
     </li>
    </ul>
    <p>
     <font color="#311b92">
      <strong>
       2、超参数调整要点
      </strong>
      ：
     </font>
    </p>
    <ul>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         学习率
        </strong>
        ：
       </font>
       学习率是影响模型训练效果的重要超参数之一。如果学习率过大，模型可能无法收敛，甚至会发散；如果学习率过小，模型训练速度会非常缓慢。可以采用学习率衰减策略，如指数衰减或余弦退火，随着训练的进行逐渐降低学习率。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         批大小
        </strong>
        ：
       </font>
       批大小决定了每次训练时输入模型的数据量。较大的批大小可以加快训练速度，但可能会占用更多的内存；较小的批大小可以减少内存需求，但可能会导致训练过程不稳定。需要根据硬件资源和数据集大小来选择合适的批大小。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         采样点数和半径
        </strong>
        ：
       </font>
       在 Set Abstraction 模块中，采样点数（
       <code>
        npoint
       </code>
       ）和半径（
       <code>
        radius
       </code>
       ）会影响模型对局部特征的提取能力。需要根据点云数据的密度和复杂程度来调整这些参数，以获得更好的特征表示。
      </p>
     </li>
    </ul>
    <p>
     <font color="#311b92">
      <strong>
       3、模型评估要点
      </strong>
      ：
     </font>
    </p>
    <ul>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         准确率
        </strong>
        ：
       </font>
       准确率是最常用的评估指标之一，用于衡量模型预测正确的样本比例。在分类任务中，可以通过计算预测类别与真实类别的匹配程度来得到准确率。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         召回率和 F1 值
        </strong>
        ：
       </font>
       对于类别不均衡的数据集，准确率可能无法全面反映模型的性能。此时，可以使用召回率和 F1 值等指标。召回率表示真实正样本中被正确预测的比例，F1 值是准确率和召回率的调和平均数，综合考虑了模型的准确性和召回能力。
      </p>
     </li>
     <li>
      <p>
       <font color="#311b92">
        <strong>
         混淆矩阵
        </strong>
        ：
       </font>
       混淆矩阵可以直观地展示模型在各个类别上的预测情况，包括正确预测和错误预测的数量。通过分析混淆矩阵，可以了解模型在哪些类别上表现较好，哪些类别上容易出错，从而有针对性地改进模型。
      </p>
     </li>
    </ul>
    <h3>
     <a id="font_color311b92font_407">
     </a>
     <font color="#311b92">
      六、总结与展望
     </font>
    </h3>
    <h4>
     <a id="font_color311b92PointNetfont_409">
     </a>
     <font color="#311b92">
      （一）PointNet++的特点与应用
     </font>
    </h4>
    <p>
     <font color="#311b92">
      <strong>
       PointNet++
      </strong>
     </font>
     是一种用于3D点云处理的深度学习模型，通过其层次化架构和Set Abstraction模块，能够有效提取点云的局部和全局特征。这种设计使其在处理复杂3D场景时表现出色。
    </p>
    <h5>
     <a id="font_color311b921font_413">
     </a>
     <font color="#311b92">
      1、主要特点
     </font>
    </h5>
    <ul>
     <li>
      <font color="#311b92">
       <strong>
        高效特征提取
       </strong>
       ：
      </font>
      PointNet++通过层次化方式捕捉点云的细节和整体信息，适用于多样化场景。
     </li>
     <li>
      <font color="#311b92">
       <strong>
        多尺度特征融合
       </strong>
       ：
      </font>
      采用MSG（多尺度分组）和MRG（多分辨率分组）技术，整合不同尺度的特征，提升模型对噪声、遮挡和密度不均的适应性。
     </li>
     <li>
      <font color="#311b92">
       <strong>
        鲁棒性强
       </strong>
       ：
      </font>
      在数据缺失或不完整的情况下，仍能准确识别物体，适用于室内外复杂环境。
     </li>
    </ul>
    <h5>
     <a id="font_color311b923font_418">
     </a>
     <font color="#311b92">
      3、应用场景
     </font>
    </h5>
    <ul>
     <li>
      <font color="#311b92">
       <strong>
        自动驾驶
       </strong>
       ：
      </font>
      从激光雷达点云中提取车辆、行人、道路等目标特征，支持实时决策，确保安全。
     </li>
     <li>
      <font color="#311b92">
       <strong>
        室内场景理解
       </strong>
       ：
      </font>
      处理遮挡和数据不均的点云，识别物体，实现空间感知。
     </li>
     <li>
      <font color="#311b92">
       <strong>
        技术推动
       </strong>
       ：
      </font>
      为3D深度学习提供新思路，克服传统方法局限，启发后续研究。
     </li>
    </ul>
    <h4>
     <a id="font_color311b92_423">
     </a>
     <font color="#311b92">
      （二）未来发展方向
     </font>
    </h4>
    <p>
     PointNet++在技术融合与应用扩展方面具有显著优势。在技术融合方面，它可以与Transformer结合，利用Transformer处理长距离依赖的能力，
     <font color="#311b92">
      提高大规模点云数据的分析效率
     </font>
     ；同时，与生成对抗网络（GAN）结合，通过GAN实现点云补全和生成，
     <font color="#311b92">
      增强模型对缺失数据的处理能力
     </font>
     。在应用扩展方面，PointNet++具有多种应用可能性。在医疗领域，它可以分析医学影像中的点云数据，辅助医生识别病变组织，
     <font color="#311b92">
      提高诊断准确性
     </font>
     。在文物保护领域，通过处理文物扫描的点云数据，PointNet++支持文物的数字化重建和修复，
     <font color="#311b92">
      为文化遗产保护提供技术支持
     </font>
     。在教育领域，利用点云数据创建3D教学场景，PointNet++能够提供沉浸式、互动式的学习体验，
     <font color="#311b92">
      丰富教学手段
     </font>
     。综上所述，PointNet++通过技术融合提升了点云处理能力，并凭借其灵活性在医疗、文物保护和教育等多个领域展现出广泛的应用前景，有望在未来发挥更大作用。
    </p>
    <hr/>
    <p>
     <font color="#311b92">
      <strong>
       延伸阅读
      </strong>
     </font>
    </p>
    <ul>
     <li>
      <p>
       <a href="https://blog.csdn.net/u013132758/category_12908083.html">
        <font color="#311b92">
         <strong>
          AI Agent 系列文章
         </strong>
        </font>
       </a>
      </p>
      <hr/>
     </li>
     <li>
      <p>
       <a href="https://blog.csdn.net/u013132758/category_12899414.html">
        <font color="#311b92">
         <strong>
          计算机视觉系列文章
         </strong>
        </font>
       </a>
      </p>
      <hr/>
     </li>
     <li>
      <p>
       <a href="https://blog.csdn.net/u013132758/category_12898016.html">
        <font color="#311b92">
         <strong>
          机器学习核心算法系列文章
         </strong>
        </font>
       </a>
      </p>
      <hr/>
     </li>
     <li>
      <p>
       <a href="https://blog.csdn.net/u013132758/category_12898012.html">
        <font color="#311b92">
         <strong>
          深度学习系列文章
         </strong>
        </font>
       </a>
      </p>
     </li>
    </ul>
    <hr/>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031333133323735382f:61727469636c652f64657461696c732f313436303538343632" class_="artid" style="display:none">
 </p>
</div>


