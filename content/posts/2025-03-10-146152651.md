---
layout: post
title: "JavaScript性能优化DOM操作优化实战"
date: 2025-03-10 13:49:31 +0800
description: "JavaScript性能优化是提升Web应用质量的核心要素，直接影响用户体验与业务成果。研究表明，页面加载延迟1秒可能导致转化率下降7%。高效的JavaScript执行能减少主线程阻塞，避免动画卡顿或操作延迟，尤其在移动端低性能设备上更为关键。优化内存管理与减少冗余计算可降低浏览器资源消耗，防止因内存泄漏导致的崩溃，提升应用稳定性。在竞争激烈的互联网环境中，性能优势已成为产品差异化的关键因素，直接影响用户留存与商业价值。因此，性能优化应作为开发全周期的核心实践，而非事后补救措施。"
keywords: "JavaScript性能优化：DOM操作优化实战"
categories: ['Javascript']
tags: ['性能优化', '开发语言', 'Javascript']
artid: "146152651"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146152651
    alt: "JavaScript性能优化DOM操作优化实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146152651
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146152651
cover: https://bing.ee123.net/img/rand?artid=146152651
image: https://bing.ee123.net/img/rand?artid=146152651
img: https://bing.ee123.net/img/rand?artid=146152651
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     JavaScript性能优化：DOM操作优化实战
    </h1>
   </div>
  </div>
 </div>
 <a data-report-click='{"spm":"1001.2101.3001.8632"}' data-report-query="spm=1001.2101.3001.8632" data-report-view='{"spm":"1001.2101.3001.8632"}' href="https://activity.csdn.net/topic?id=10857" id="creatActivityHref" style="display:block;margin-top:16px;font-size:16px;color:#5094d5;font-weight:500" target="_blank">
  #JavaScript性能优化实战#
 </a>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="JavaScriptDOM_0">
     </a>
     <strong>
      JavaScript性能优化：DOM操作优化实战
     </strong>
    </h4>
    <h5>
     <a id="__1">
     </a>
     <strong>
      一 重排与重绘的代价
     </strong>
    </h5>
    <h6>
     <a id="_2">
     </a>
     <strong>
      问题场景
     </strong>
    </h6>
    <p>
     用户点击按钮后，需要动态生成一个包含10,000个选项的下拉列表，但界面出现长达5秒的冻结。
    </p>
    <h6>
     <a id="_5">
     </a>
     <strong>
      错误代码示例
     </strong>
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">createList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"myList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    li<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">;</span>  <span class="token comment">// 触发样式计算</span>
    li<span class="token punctuation">.</span>style<span class="token punctuation">.</span>margin <span class="token operator">=</span> <span class="token string">"2px"</span><span class="token punctuation">;</span> <span class="token comment">// 触发布局</span>
    li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">选项 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 每次循环都导致重排</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="_19">
     </a>
     <strong>
      问题分析
     </strong>
    </h6>
    <ul>
     <li>
      每次循环都修改元素样式 ➔ 触发
      <strong>
       强制同步布局（Forced Synchronous Layout）
      </strong>
     </li>
     <li>
      直接操作真实DOM ➔ 累计触发
      <strong>
       10,000次重排
      </strong>
     </li>
    </ul>
    <h5>
     <a id="_DOM_23">
     </a>
     <strong>
      二 高效DOM操作三板斧
     </strong>
    </h5>
    <h6>
     <a id="1DocumentFragment_24">
     </a>
     <strong>
      优化方案1：文档碎片（DocumentFragment）
     </strong>
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">createListOptimized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"myList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 内存中的虚拟容器</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 先完成所有属性设置</span>
    li<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">选项 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    li<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">"prestyled-item"</span><span class="token punctuation">;</span> <span class="token comment">// 通过CSS类批量设置样式</span>
    
    fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不会触发真实DOM操作</span>
  <span class="token punctuation">}</span>

  ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仅1次重排</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="2_43">
     </a>
     <strong>
      优化方案2：样式批量处理
     </strong>
    </h6>
    <pre><code class="prism language-css"><span class="token comment">/* 将样式集中到CSS类 */</span>
<span class="token selector">.prestyled-item</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="3_52">
     </a>
     <strong>
      优化方案3：读写分离原则
     </strong>
    </h6>
    <pre><code class="prism language-javascript"><span class="token comment">// 错误：交替读写布局属性</span>
element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">"100px"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span> <span class="token comment">// 触发立即计算</span>
element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span>

<span class="token comment">// 正确：先读后写</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span> <span class="token comment">// 集中读取</span>
element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">"100px"</span><span class="token punctuation">;</span>        <span class="token comment">// 集中写入</span>
element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> height <span class="token operator">+</span> <span class="token string">"px"</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="__65">
     </a>
     <strong>
      三 事件监听器的正确姿势
     </strong>
    </h5>
    <h6>
     <a id="_66">
     </a>
     <strong>
      内存泄漏陷阱
     </strong>
    </h6>
    <pre><code class="prism language-javascript"><span class="token comment">// 错误：为每个列表项绑定监听器</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".item"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当需要移除元素时：</span>
container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">// 监听器仍然残留在内存中！</span>
</code></pre>
    <h6>
     <a id="_77">
     </a>
     <strong>
      优化方案：事件委托
     </strong>
    </h6>
    <pre><code class="prism language-javascript"><span class="token comment">// 正确：利用事件冒泡在父级监听</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"container"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"item"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      优势对比
     </strong>
     ：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        方式
       </th>
       <th>
        内存占用（1000个元素）
       </th>
       <th>
        初始化耗时
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        单独绑定
       </td>
       <td>
        1000个监听器
       </td>
       <td>
        120ms
       </td>
      </tr>
      <tr>
       <td>
        事件委托
       </td>
       <td>
        1个监听器
       </td>
       <td>
        15ms
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="_DOM_93">
     </a>
     <strong>
      四 虚拟DOM的启示
     </strong>
    </h5>
    <h6>
     <a id="_94">
     </a>
     <strong>
      核心思想
     </strong>
    </h6>
    <div class="mermaid">
     <svg class="mermaid-svg" height="62" id="mermaid-svg-gTg15j0NYtiNurj1" viewbox="0 0 843.859375 62" width="843.859375" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-gTg15j0NYtiNurj1 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-gTg15j0NYtiNurj1 .error-icon{fill:#552222;}#mermaid-svg-gTg15j0NYtiNurj1 .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-gTg15j0NYtiNurj1 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-gTg15j0NYtiNurj1 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-gTg15j0NYtiNurj1 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-gTg15j0NYtiNurj1 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-gTg15j0NYtiNurj1 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-gTg15j0NYtiNurj1 .marker{fill:#333333;stroke:#333333;}#mermaid-svg-gTg15j0NYtiNurj1 .marker.cross{stroke:#333333;}#mermaid-svg-gTg15j0NYtiNurj1 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-gTg15j0NYtiNurj1 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-gTg15j0NYtiNurj1 .cluster-label text{fill:#333;}#mermaid-svg-gTg15j0NYtiNurj1 .cluster-label span{color:#333;}#mermaid-svg-gTg15j0NYtiNurj1 .label text,#mermaid-svg-gTg15j0NYtiNurj1 span{fill:#333;color:#333;}#mermaid-svg-gTg15j0NYtiNurj1 .node rect,#mermaid-svg-gTg15j0NYtiNurj1 .node circle,#mermaid-svg-gTg15j0NYtiNurj1 .node ellipse,#mermaid-svg-gTg15j0NYtiNurj1 .node polygon,#mermaid-svg-gTg15j0NYtiNurj1 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-gTg15j0NYtiNurj1 .node .label{text-align:center;}#mermaid-svg-gTg15j0NYtiNurj1 .node.clickable{cursor:pointer;}#mermaid-svg-gTg15j0NYtiNurj1 .arrowheadPath{fill:#333333;}#mermaid-svg-gTg15j0NYtiNurj1 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-gTg15j0NYtiNurj1 .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-gTg15j0NYtiNurj1 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-gTg15j0NYtiNurj1 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-gTg15j0NYtiNurj1 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-gTg15j0NYtiNurj1 .cluster text{fill:#333;}#mermaid-svg-gTg15j0NYtiNurj1 .cluster span{color:#333;}#mermaid-svg-gTg15j0NYtiNurj1 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-gTg15j0NYtiNurj1 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M92,31L96.16666666666667,31C100.33333333333333,31,108.66666666666667,31,117,31C125.33333333333333,31,133.66666666666666,31,137.83333333333334,31L142,31" marker-end="url(#arrowhead72)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead72" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M273.953125,31L278.1197916666667,31C282.2864583333333,31,290.6197916666667,31,298.953125,31C307.2864583333333,31,315.6197916666667,31,319.7864583333333,31L323.953125,31" marker-end="url(#arrowhead73)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead73" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;">
          <path class="path" d="M471.90625,31L476.0729166666667,31C480.2395833333333,31,488.5729166666667,31,496.90625,31C505.2395833333333,31,513.5729166666666,31,517.7395833333334,31L521.90625,31" marker-end="url(#arrowhead74)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead74" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M637.90625,31L642.0729166666666,31C646.2395833333334,31,654.5729166666666,31,662.90625,31C671.2395833333334,31,679.5729166666666,31,683.7395833333334,31L687.90625,31" marker-end="url(#arrowhead75)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead75" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-D" id="L-L-C-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-40" style="opacity: 1;" transform="translate(50,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              数据变化
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-41" style="opacity: 1;" transform="translate(207.9765625,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="131.953125" x="-65.9765625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-55.9765625,-13)">
            <foreignobject height="26" width="111.953125">
             <div style="display: inline-block; white-space: nowrap;">
              生成虚拟DOM树
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-43" style="opacity: 1;" transform="translate(397.9296875,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="147.953125" x="-73.9765625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-63.9765625,-13)">
            <foreignobject height="26" width="127.953125">
             <div style="display: inline-block; white-space: nowrap;">
              对比新旧虚拟DOM
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-45" style="opacity: 1;" transform="translate(579.90625,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              计算最小修改
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-47" style="opacity: 1;" transform="translate(761.8828125,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="147.953125" x="-73.9765625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-63.9765625,-13)">
            <foreignobject height="26" width="127.953125">
             <div style="display: inline-block; white-space: nowrap;">
              批量更新真实DOM
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h6>
     <a id="_103">
     </a>
     <strong>
      手动实现简化版
     </strong>
    </h6>
    <pre><code class="prism language-javascript"><span class="token keyword">let</span> vDOM <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 更新函数</span>
<span class="token keyword">function</span> <span class="token function">updateDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> realDOM <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vDOM<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  vDOM<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> child<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
    realDOM<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 批量替换</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceChildren</span><span class="token punctuation">(</span>realDOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加新项时：</span>
vDOM<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'新项目'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateDOM<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在下一次重绘时集中更新</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_127">
     </a>
     <strong>
      本章重点总结
     </strong>
    </h4>
    <ol>
     <li>
      <strong>
       批量操作
      </strong>
      ：使用文档碎片减少DOM操作次数
     </li>
     <li>
      <strong>
       样式管理
      </strong>
      ：用CSS类替代直接样式操作
     </li>
     <li>
      <strong>
       事件优化
      </strong>
      ：委托模式节省内存
     </li>
     <li>
      <strong>
       更新策略
      </strong>
      ：集中修改减少重排次数
     </li>
    </ol>
    <hr/>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34393730373337352f:61727469636c652f64657461696c732f313436313532363531" class_="artid" style="display:none">
 </p>
</div>


