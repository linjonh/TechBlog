---
layout: post
title: "javacv-视频转换"
date: 2015-05-11 10:59:11 +0800
description: "注意：下载了javacv-0.7-bin.zip，还要下载javacv-0.7-cppjars.zi"
keywords: "javacv怎么切换视频"
categories: ['自然图像处理']
tags: ['视频', 'Javacv', 'H', 'Ffmpeg', 'Codec']
artid: "45641691"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=45641691
    alt: "javacv-视频转换"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=45641691
featuredImagePreview: https://bing.ee123.net/img/rand?artid=45641691
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     javacv 视频转换
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     注意：下载了javacv-0.7-bin.zip，还要下载javacv-0.7-cppjars.zip，后者支持ffmpeg的使用
    </p>
    <p>
    </p>
    <p>
     下面是一段opencv转换视频的代码，在我使用中报错
    </p>
    <p>
     import java.io.File;
     <br/>
     <br/>
     import com.googlecode.javacv.FFmpegFrameGrabber;
     <br/>
     import com.googlecode.javacv.FFmpegFrameRecorder;
     <br/>
     import com.googlecode.javacv.Frame;
     <br/>
     import com.googlecode.javacv.cpp.avcodec;
     <br/>
     <br/>
     <br/>
     <br/>
     public class ConvertVideo {
     <!-- -->
     <br/>
     <br/>
     <br/>
     public static String convert(File file) {
     <!-- -->
     <br/>
     <br/>
     FFmpegFrameGrabber frameGrabber = new FFmpegFrameGrabber(file.getAbsolutePath());
     <br/>
     String fileName = null;
     <br/>
     <br/>
     Frame captured_frame = null;
     <br/>
     <br/>
     FFmpegFrameRecorder recorder = null;
     <br/>
     <br/>
     <br/>
     try {
     <!-- -->
     <br/>
     frameGrabber.start();
     <br/>
     fileName = file.getAbsolutePath().replace(".mp4", "_edited.mp4");
     <br/>
     recorder = new FFmpegFrameRecorder(fileName, frameGrabber.getImageWidth(), frameGrabber.getImageHeight(),frameGrabber.getAudioChannels());
     <br/>
     recorder.setVideoCodec(avcodec.AV_CODEC_ID_H264); //avcodec.AV_CODEC_ID_H264  //AV_CODEC_ID_MPEG4
     <br/>
     recorder.setFormat("mp4");
     <br/>
     recorder.setFrameRate(frameGrabber.getFrameRate());
     <br/>
     <span style="color:#ff0000;">
      <strong>
       recorder.setSampleFormat(frameGrabber.getSampleFormat());
      </strong>
     </span>
     //
     <br/>
     recorder.setSampleRate(frameGrabber.getSampleRate());
     <br/>
     <br/>
     //-----recorder.setAudioChannels(frameGrabber.getAudioChannels());
     <br/>
     recorder.setFrameRate(frameGrabber.getFrameRate());
     <br/>
     <br/>
     recorder.start();
     <br/>
     while (true) {
     <!-- -->
     <br/>
     try {
     <!-- -->
     <br/>
     captured_frame = frameGrabber.grabFrame();
     <br/>
     <br/>
     if (captured_frame == null) {
     <!-- -->
     <br/>
     System.out.println("!!! Failed cvQueryFrame");
     <br/>
     break;
     <br/>
     <br/>
     }
     <br/>
     recorder.setTimestamp(frameGrabber.getTimestamp());
     <br/>
     recorder.record(captured_frame);
     <br/>
     <br/>
     } catch (Exception e) {
     <!-- -->
     <br/>
     }
     <br/>
     }
     <br/>
     recorder.stop();
     <br/>
     recorder.release();
     <br/>
     frameGrabber.stop();
     <br/>
     } catch (Exception e) {
     <!-- -->
     <br/>
     e.printStackTrace();
     <br/>
     }
     <br/>
     file.delete();
     <br/>
     return fileName;
     <br/>
     }
     <br/>
     <br/>
     }
    </p>
    <p>
     报错如下， 开始我以为是配置的原因，毕竟提示" Could not open audio codec "，折腾了半天也没解决，后来有人说是record参数问题，此事我看到了错误有sample format..unsurport, 于是把recorder.setSampleFormat(frameGrabber.getSampleFormat()); 一句注释掉，就ok了！
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f67616e6a69616e686f6e6731:2f61727469636c652f64657461696c732f3435363431363931" class_="artid" style="display:none">
 </p>
</div>


