---
layout: post
title: "SpringBoot深入剖析-Spring-Boot-启动过程附源码与实战"
date: 2025-03-09 15:16:55 +0800
description: "我们可以自定义来监听 Spring Boot 启动过程，并记录日志。Spring Boot 启动的核心入口是，它完成环境准备、容器创建、事件发布等步骤。核心组件包括，它们协同完成应用初始化。我们可以自定义，监听 Spring Boot 启动事件，实现日志记录或其他增强功能。Spring Boot 的启动过程是一个标准化的“模板方法模式”实现，每一步都可以通过扩展点进行自定义，极大增强了框架的可扩展性。希望本篇文章能帮助你更好地理解 Spring Boot 的启动原理！📌你学会了吗？"
keywords: "【SpringBoot】深入剖析 Spring Boot 启动过程（附源码与实战）"
categories: ['原理分析', 'Springboot']
tags: ['原理分析', 'Spring', 'Boot']
artid: "146132785"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146132785
    alt: "SpringBoot深入剖析-Spring-Boot-启动过程附源码与实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146132785
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146132785
cover: https://bing.ee123.net/img/rand?artid=146132785
image: https://bing.ee123.net/img/rand?artid=146132785
img: https://bing.ee123.net/img/rand?artid=146132785
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【SpringBoot】深入剖析 Spring Boot 启动过程（附源码与实战）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_Spring_Boot__0">
     </a>
     深入剖析 Spring Boot 启动过程（附源码与实战）
    </h2>
    <p>
     Spring Boot 以其“开箱即用”的特性深受开发者喜爱，然而，Spring Boot 是如何启动的？它如何做到自动化配置？这背后的原理是什么？本篇文章将从源码出发，剖析 Spring Boot 启动的核心流程，并通过代码实战加深理解。
    </p>
    <hr/>
    <h3>
     <a id="1_Spring_Boot__6">
     </a>
     1. Spring Boot 启动的核心流程
    </h3>
    <p>
     Spring Boot 应用的启动通常从
     <code>
      main
     </code>
     方法开始，例如：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     其中
     <code>
      SpringApplication.run()
     </code>
     是启动的关键入口，我们接下来深入分析其核心流程。
    </p>
    <h4>
     <a id="11_SpringApplicationrun__21">
     </a>
     1.1
     <code>
      SpringApplication.run()
     </code>
     过程
    </h4>
    <p>
     源码入口位于
     <code>
      SpringApplication
     </code>
     类的
     <code>
      run()
     </code>
     方法：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> primarySource<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span>primarySource<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     它主要做了如下几件事：
    </p>
    <ol>
     <li>
      <strong>
       创建
       <code>
        SpringApplication
       </code>
       实例
      </strong>
     </li>
     <li>
      <strong>
       调用
       <code>
        run()
       </code>
       方法，执行核心启动逻辑
      </strong>
     </li>
     <li>
      <strong>
       返回
       <code>
        ConfigurableApplicationContext
       </code>
       作为 Spring 容器
      </strong>
     </li>
    </ol>
    <p>
     进一步分析
     <code>
      run()
     </code>
     方法内部逻辑：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. 创建并启动 `SpringApplicationRunListeners`</span>
    <span class="token class-name">SpringApplicationRunListeners</span> listeners <span class="token operator">=</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listeners<span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 构造 `ApplicationArguments`</span>
    <span class="token class-name">ApplicationArguments</span> applicationArguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultApplicationArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. 准备 `Environment`</span>
    <span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span>listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4. 打印 Banner</span>
    <span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. 创建 `ApplicationContext`</span>
    <span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 6. 准备 `ApplicationContext`</span>
    <span class="token function">prepareContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> environment<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 7. 刷新 `ApplicationContext`</span>
    <span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 8. 执行 `ApplicationRunner` 和 `CommandLineRunner`</span>
    <span class="token function">afterRefresh</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 9. 通知所有监听器，启动完成</span>
    listeners<span class="token punctuation">.</span><span class="token function">started</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listeners<span class="token punctuation">.</span><span class="token function">running</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="12__76">
     </a>
     1.2 关键步骤详解
    </h4>
    <h5>
     <a id="1_SpringApplicationRunListeners_78">
     </a>
     1️⃣ SpringApplicationRunListeners
    </h5>
    <p>
     在
     <code>
      getRunListeners(args)
     </code>
     方法中，会加载
     <code>
      META-INF/spring.factories
     </code>
     中的
     <code>
      SpringApplicationRunListener
     </code>
     ，如
     <code>
      EventPublishingRunListener
     </code>
     ，用于发布 Spring Boot 启动相关的事件，如
     <code>
      ApplicationStartedEvent
     </code>
     。
    </p>
    <h5>
     <a id="2_Environment__82">
     </a>
     2️⃣ Environment 准备
    </h5>
    <p>
     <code>
      prepareEnvironment()
     </code>
     方法用于加载
     <code>
      application.properties
     </code>
     或
     <code>
      application.yml
     </code>
     等配置信息，并决定是否启用
     <code>
      DevTools
     </code>
     。
    </p>
    <h5>
     <a id="3__Spring__86">
     </a>
     3️⃣ 创建 Spring 容器
    </h5>
    <p>
     <code>
      createApplicationContext()
     </code>
     通过
     <code>
      SpringFactoriesLoader
     </code>
     加载
     <code>
      SpringApplication
     </code>
     配置的
     <code>
      ApplicationContext
     </code>
     实现类（如
     <code>
      AnnotationConfigServletWebServerApplicationContext
     </code>
     ），然后
     <code>
      prepareContext()
     </code>
     进行配置。
    </p>
    <h5>
     <a id="4__90">
     </a>
     4️⃣ 刷新容器
    </h5>
    <p>
     <code>
      refreshContext()
     </code>
     最终调用
     <code>
      context.refresh()
     </code>
     ，完成 Spring 核心的
     <code>
      refresh()
     </code>
     过程，初始化 BeanFactory，注册 Bean 后处理器，完成 AOP、事务等功能的初始化。
    </p>
    <h5>
     <a id="5__ApplicationRunner__CommandLineRunner_94">
     </a>
     5️⃣ 运行
     <code>
      ApplicationRunner
     </code>
     和
     <code>
      CommandLineRunner
     </code>
    </h5>
    <p>
     Spring Boot 提供
     <code>
      ApplicationRunner
     </code>
     和
     <code>
      CommandLineRunner
     </code>
     接口，在
     <code>
      afterRefresh()
     </code>
     方法中执行，可以在应用启动后运行特定代码：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRunner</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationRunner</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ApplicationRunner 执行，参数："</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">getSourceArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="2__SpringApplicationRunListener_110">
     </a>
     2. 代码实战：自定义
     <code>
      SpringApplicationRunListener
     </code>
    </h3>
    <p>
     我们可以自定义
     <code>
      SpringApplicationRunListener
     </code>
     来监听 Spring Boot 启动过程，并记录日志。
    </p>
    <h4>
     <a id="21__MyApplicationRunListener_114">
     </a>
     2.1 创建
     <code>
      MyApplicationRunListener
     </code>
    </h4>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplicationRunListener</span> <span class="token keyword">implements</span> <span class="token class-name">SpringApplicationRunListener</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">MyApplicationRunListener</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span> application<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Spring Boot 正在启动..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">environmentPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Environment 已准备："</span> <span class="token operator">+</span> environment<span class="token punctuation">.</span><span class="token function">getActiveProfiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; ApplicationContext 已创建..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">started</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Spring Boot 已启动！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">running</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Spring Boot 运行中..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; 启动失败："</span> <span class="token operator">+</span> exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="22__METAINFspringfactories_153">
     </a>
     2.2 配置
     <code>
      META-INF/spring.factories
     </code>
    </h4>
    <p>
     在
     <code>
      resources/META-INF/spring.factories
     </code>
     文件中，添加：
    </p>
    <pre><code>org.springframework.boot.SpringApplicationRunListener=com.example.listener.MyApplicationRunListener
</code></pre>
    <p>
     这样，Spring Boot 启动时，就会自动加载
     <code>
      MyApplicationRunListener
     </code>
     ，输出日志。
    </p>
    <hr/>
    <h3>
     <a id="3__165">
     </a>
     3. 总结
    </h3>
    <ol>
     <li>
      <strong>
       Spring Boot 启动的核心入口是
       <code>
        SpringApplication.run()
       </code>
      </strong>
      ，它完成环境准备、容器创建、事件发布等步骤。
     </li>
     <li>
      <strong>
       核心组件包括
       <code>
        SpringApplicationRunListeners
       </code>
       、
       <code>
        Environment
       </code>
       、
       <code>
        ApplicationContext
       </code>
      </strong>
      ，它们协同完成应用初始化。
     </li>
     <li>
      <strong>
       我们可以自定义
       <code>
        SpringApplicationRunListener
       </code>
       ，监听 Spring Boot 启动事件
      </strong>
      ，实现日志记录或其他增强功能。
     </li>
    </ol>
    <p>
     Spring Boot 的启动过程是一个标准化的“模板方法模式”实现，每一步都可以通过扩展点进行自定义，极大增强了框架的可扩展性。希望本篇文章能帮助你更好地理解 Spring Boot 的启动原理！
    </p>
    <hr/>
    <p>
     📌
     <strong>
      你学会了吗？
     </strong>
     欢迎在评论区留言交流！🚀
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f5072696e63653134303637382f:61727469636c652f64657461696c732f313436313332373835" class_="artid" style="display:none">
 </p>
</div>


