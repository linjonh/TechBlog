---
layout: post
title: "文件解析漏洞练习"
date: 2025-03-13 17:45:00 +0800
description: "(.asp目录中的所有文件都会被当做asp文件执行)1.在iis的网站根目录新建一个名为x.asp的文件2.在x.asp中新建一个jpg文件。内容为<%=now()%> asp代码。3.在外部浏览器中访问windows2003的iis网站中的2.jpg 发现asp代码被执行。"
keywords: "文件解析漏洞练习"
categories: ['未分类']
tags: ['网络', '安全', 'Web']
artid: "146234771"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146234771
    alt: "文件解析漏洞练习"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146234771
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146234771
cover: https://bing.ee123.net/img/rand?artid=146234771
image: https://bing.ee123.net/img/rand?artid=146234771
img: https://bing.ee123.net/img/rand?artid=146234771
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     文件解析漏洞练习
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     iis6的目录解析漏洞
    </h2>
    <p>
     (.asp目录中的所有文件都会被当做asp文件执行)
    </p>
    <div>
    </div>
    <div>
     <span style="color:#262626">
      1.在iis的网站根目录新建一个名为x.asp的文件
     </span>
    </div>
    <div>
     <img alt="" height="100" src="https://i-blog.csdnimg.cn/direct/0dc2ec2b8c1d450ab5ab207cd09cb767.png" width="217">
     </img>
    </div>
    <div>
     <div>
      <span style="color:#262626">
       2.在x.asp中新建一个jpg文件。内容为&lt;%=now()%&gt; asp代码。
      </span>
     </div>
     <div>
      <img alt="" height="295" src="https://i-blog.csdnimg.cn/direct/54979b4dcb524dd8a78bce3924476fba.png" width="565">
      </img>
     </div>
     <div>
     </div>
     <div>
      <span style="color:#262626">
       3.在外部浏览器中访问windows2003的iis网站中的2.jpg 发现asp代码被执行
      </span>
     </div>
     <div>
      <img alt="" height="176" src="https://i-blog.csdnimg.cn/direct/484ca0af6e0d417e802da2e61b29f393.png" width="675">
      </img>
     </div>
    </div>
    <h2>
     iis6的分号截断解析漏洞
    </h2>
    <p>
     (1.asp;jpg 分号起到截断的效果)
    </p>
    <p>
     在网站下创建22.asp;.txt  ；会起到截断的作用
    </p>
    <p>
     <img alt="" height="164" src="https://i-blog.csdnimg.cn/direct/a543ce9cdfde440097237801d1d85333.png" width="514"/>
    </p>
    <p>
     在外部访问网站
    </p>
    <p>
     <img alt="" height="215" src="https://i-blog.csdnimg.cn/direct/48c9d038df564353a1e1481437ef74d1.png" width="635"/>
    </p>
    <h2>
     iis6的畸形后缀解析
    </h2>
    <p>
     (.asa/.cer/.cdx的文件都会被当做asp文件执行)
    </p>
    <p>
     在网站新建223.asp;.txt和2234.asp;.jpg
    </p>
    <p>
     <img alt="" height="359" src="https://i-blog.csdnimg.cn/direct/f8adf467585f49f0938133ebc48a7b3a.png" width="636"/>
    </p>
    <p>
     在外部访问
    </p>
    <p>
     <img alt="" height="206" src="https://i-blog.csdnimg.cn/direct/21938b41b8ad49d8bc027874424456b8.png" width="642"/>
    </p>
    <p>
     <img alt="" height="245" src="https://i-blog.csdnimg.cn/direct/c9612bc792e348ff8664788b54287055.png" width="766"/>
    </p>
    <p>
    </p>
    <h2>
     iis7的phpcgi解析漏洞
    </h2>
    <p>
     (在文件末尾 加上 /.php，文件就会被当做php文件)
    </p>
    <p>
     利用条件
    </p>
    <p>
     1.php.ini里的cgi.fix_pathinfo=1 开启
     <br/>
     2.lIS7在Fast-CGl运行模式下
    </p>
    <div>
     <span style="color:#262626">
      步骤⼀：安装IIS后在安装PHPstudy for IIS
     </span>
    </div>
    <div>
     <span style="color:#262626">
      步骤⼆：配置
     </span>
     <span style="color:#262626">
      php.ini
     </span>
     <span style="color:#262626">
      文件，将
     </span>
     <span style="color:#262626">
      cgi.fix_pathinfo=1 的；
     </span>
     <span style="color:#262626">
      取消掉...并重启
     </span>
    </div>
    <div>
     <span style="color:#262626">
      步骤三：IIS --》 配置网站--》 处理程序映射--》 PHPStudy_FastCGI --》 请求限制 --》取消勾
     </span>
    </div>
    <p>
     <img alt="" height="581" src="https://i-blog.csdnimg.cn/direct/56a6e78c8a7145eda8372449ffae2259.png" width="627"/>
    </p>
    <p>
     在网站下新建文本
    </p>
    <p>
     <img alt="" height="365" src="https://i-blog.csdnimg.cn/direct/75b0829e80f54c83862f73815026fe0c.png" width="851"/>
    </p>
    <p>
     输入php代码
    </p>
    <p>
     <img alt="" height="447" src="https://i-blog.csdnimg.cn/direct/0ab25e6885514368bb3dfb7ca050cf44.png" width="1362"/>
    </p>
    <p>
     在后面加/.php就可以访问
    </p>
    <p>
     <img alt="" height="516" src="https://i-blog.csdnimg.cn/direct/5cdcb940cb1d4f3485fadcc9c8f12db6.png" width="926"/>
    </p>
    <p>
    </p>
    <h2>
     nginx的phpcgi解析漏洞(同上)
    </h2>
    <p>
     利用条件
    </p>
    <p>
     <span style="color:#262626">
      Nginx &lt;=0.8.37
     </span>
    </p>
    <p>
     <span style="color:#262626">
      cgi.fix_pathinfo=1
     </span>
    </p>
    <p>
     在云服务器上
     <span style="color:#262626">
      进入以下Vulhub路径并开启容器
     </span>
    </p>
    <p>
     <img alt="" height="344" src="https://i-blog.csdnimg.cn/direct/d41cebe6c0784e05a11fb131c14668c2.png" width="1112"/>
    </p>
    <p>
     启动容器，发现是80端口映射
    </p>
    <p>
     <img alt="" height="481" src="https://i-blog.csdnimg.cn/direct/0b82b1bbce9849b38f4dc5cc89128ec4.png" width="849"/>
    </p>
    <p>
     访问网址，上传文件
    </p>
    <p>
     <img alt="" height="152" src="https://i-blog.csdnimg.cn/direct/f79f933f57ae428694f7f5d130419b1e.png" width="660"/>
    </p>
    <p>
     得到文件地址
    </p>
    <p>
     <img alt="" height="104" src="https://i-blog.csdnimg.cn/direct/a9ff8358382341b49d33362cd4e36d12.png" width="976"/>
     访问文件
    </p>
    <p>
     <img alt="" height="252" src="https://i-blog.csdnimg.cn/direct/2679c1eab7954371b4a51598c68f24cc.png" width="1107"/>
    </p>
    <p>
     加上xx.php即可绕过
    </p>
    <p>
     <img alt="" height="522" src="https://i-blog.csdnimg.cn/direct/1a0be598959c490e9ab09fc9bd3e6c5e.png" width="1415"/>
    </p>
    <h2>
     nginx的00截断解析漏洞
    </h2>
    <p>
     (上传的时候两个空格，第二个空格20改成00可以起到截断的作用)
    </p>
    <p>
     访问另外的靶场
    </p>
    <p>
     <img alt="" height="195" src="https://i-blog.csdnimg.cn/direct/e1f2898894094990ac97dcdb3cbd6ea3.png" width="687"/>
    </p>
    <p>
     <img alt="" height="325" src="https://i-blog.csdnimg.cn/direct/58717431c2bb47b7a1ce8654102fab2d.png" width="856"/>
    </p>
    <p>
     写入木马文件（gif89a是用来伪装图片，代码用来生成webs hell木马）
    </p>
    <p>
     <img alt="" height="276" src="https://i-blog.csdnimg.cn/direct/6219919c3ea245378ca7f6900603ef8f.png" width="1359"/>
    </p>
    <p>
     开启bp抓包
    </p>
    <p>
     <img alt="" height="679" src="https://i-blog.csdnimg.cn/direct/c32b497533b044668a146fe816a02a94.png" width="1076"/>
    </p>
    <p>
     在文件后面加上 空格空格.php
    </p>
    <p>
     <img alt="" height="95" src="https://i-blog.csdnimg.cn/direct/b5b2b2e7eea64615aa008baffabfbc59.png" width="652"/>
    </p>
    <p>
     把对应的20改成00
    </p>
    <p>
     <img alt="" height="112" src="https://i-blog.csdnimg.cn/direct/696e5d1cb70c4b7ea1024534558e3410.png" width="679"/>
    </p>
    <p>
     放行，得到文件地址
    </p>
    <h2>
     <img alt="" height="164" src="https://i-blog.csdnimg.cn/direct/91b5cc1a27344a4dbe8fe7444f86a82b.png" width="901"/>
    </h2>
    <p>
     访问文件，再次抓包
    </p>
    <p>
     <img alt="" height="159" src="https://i-blog.csdnimg.cn/direct/7afbc6e4b39d400fae34be66e14157f1.png" width="510"/>
    </p>
    <p>
     再次把20改成00
    </p>
    <p>
     <img alt="" height="107" src="https://i-blog.csdnimg.cn/direct/c90b1074e5164219bd4bfd138069bed6.png" width="704"/>
    </p>
    <p>
     访问生成的webshell.php
    </p>
    <p>
     <img alt="" height="371" src="https://i-blog.csdnimg.cn/direct/37cf980b0489428c830e2ef2c18a9f6a.png" width="1200"/>
    </p>
    <p>
     用蚁剑进行连接
    </p>
    <p>
     <img alt="" height="690" src="https://i-blog.csdnimg.cn/direct/6ba15ad7f2cd4b69b6fa719e05813755.png" width="1044"/>
    </p>
    <p>
    </p>
    <h2>
     apache的从右往左解析漏洞
    </h2>
    <p>
     (apache的解析规则是从右往左，右边的不认识会往左递归)
    </p>
    <p>
     <strong>
      访问靶场，如果端口冲突记得更改
     </strong>
    </p>
    <p>
     <img alt="" height="730" src="https://i-blog.csdnimg.cn/direct/dcb6ca2d823b4c04a1e965581ce01626.png" width="965"/>
    </p>
    <h2>
     apache的多后缀解析漏洞
    </h2>
    <p>
     (apache会为不同的后缀执行不同的指令)
    </p>
    <p>
     启动靶场，访问靶场
    </p>
    <p>
     <img alt="" height="309" src="https://i-blog.csdnimg.cn/direct/b0b916e0ab904fe3ab19767848300cc1.png" width="896"/>
    </p>
    <p>
     上传.php.jpg文件（因为apache会为不同的后缀执行不同的指令）
    </p>
    <p>
     <img alt="" height="295" src="https://i-blog.csdnimg.cn/direct/81587d707964463cac1b86c5f22dcc73.png" width="1351"/>
    </p>
    <p>
     访问.php.jpg文件。访问成功后访问
     <span style="color:#262626">
      访问生成的webshell.php
     </span>
    </p>
    <p>
     <img alt="" height="242" src="https://i-blog.csdnimg.cn/direct/813ee031d64347d7b81b01466c997831.png" width="995"/>
    </p>
    <p>
     访问成功说明，木马已经生成，可以用蚁剑链接
    </p>
    <h2>
     apache的0a换行解析漏洞
    </h2>
    <p>
     (在文件末尾加上空格，空格的20改成0a，访问文件的时候加上%0a)
    </p>
    <p>
     同理，访问网址，上传什么类型的文件都行
    </p>
    <p>
     <img alt="" height="399" src="https://i-blog.csdnimg.cn/direct/a46e582cf36d45e09395d0475dcfc28b.png" width="1049"/>
    </p>
    <p>
     用bp抓包，在evil.php后面加上空格，在hex编码里把20改成0a
    </p>
    <p>
     <img alt="" height="107" src="https://i-blog.csdnimg.cn/direct/5f0aa60af2ec4e93a193f8661be0b123.png" width="732"/>
    </p>
    <p>
     访问文件时，加上%0a
    </p>
    <p>
     <img alt="" height="211" src="https://i-blog.csdnimg.cn/direct/3007919f9c65450fb39cd7b167cfe725.png" width="917"/>
    </p>
    <p>
     访问成功就说明生成木马，访问木马，用蚁剑链接
    </p>
    <p>
     <img alt="" height="757" src="https://i-blog.csdnimg.cn/direct/95b596aac1494f82bff9d0ba2644abd8.png" width="897"/>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6c323737323531333730302f:61727469636c652f64657461696c732f313436323334373731" class_="artid" style="display:none">
 </p>
</div>


