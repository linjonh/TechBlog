---
layout: post
title: "微信小程序实时音视频功能简析live-pusher与live-player"
date: 2024-12-24 18:00:43 +0800
description: "使用须知2017年下半年，微信6.5.21版本支持在线音视频功能。开发者可以通过两个音视频组件 和 "
keywords: "live-pusher的mode"
categories: ['微信小程序专栏']
tags: ['小程序']
artid: "105434237"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=105434237
    alt: "微信小程序实时音视频功能简析live-pusher与live-player"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=105434237
featuredImagePreview: https://bing.ee123.net/img/rand?artid=105434237
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序实时音视频功能简析(live-pusher与live-player)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     使用须知
    </h2>
    <p>
     2017年下半年，微信6.5.21版本支持在线音视频功能。开发者可以通过两个音视频组件 和 实现实时地在线直播、视频通话、语音通话等功能。
    </p>
    <p>
     上述功能需要用到两个小程序媒体组件中的两个：
     <code>
      live-pusher
     </code>
     与
     <code>
      live-player
     </code>
     。下文简单介绍两这个组件的基础知识。仅可以带你入门，如果是高手请绕行。
    </p>
    <h3>
     <a id="_5">
     </a>
     注册小程序
    </h3>
    <p>
     注册小程序请单击
     <a href="https://mp.weixin.qq.com/" rel="nofollow">
      微信公众平台
     </a>
     ，完成注册后，在小程序管理页面的【开发】&gt;【基本配置】中记录下小程序 AppID 供后面使用。
    </p>
    <blockquote>
     <p>
      注意： 必须以
      <strong>
       非个人主体
      </strong>
      类型进行注册，否则无法开通 和 这两个标签。
     </p>
    </blockquote>
    <h3>
     <a id="_11">
     </a>
     开通标签使用权限
    </h3>
    <p>
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-pusher.html" rel="nofollow">
      live-pusher
     </a>
     和
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html" rel="nofollow">
      live-player
     </a>
     是小程序内部用于支持音视频上行能力的功能标签
    </p>
    <p>
     出于政策和合规的考虑，微信暂时没有放开所有小程序对
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-pusher.html" rel="nofollow">
      live-pusher
     </a>
     和
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html" rel="nofollow">
      live-player
     </a>
     标签的支持：
    </p>
    <ul>
     <li>
      目前支持这两个标签的类目如下表格所示（只有非个人主体才有以下类目）：
     </li>
    </ul>
    <table>
     <thead>
      <tr>
       <th>
        主类目
       </th>
       <th>
        子类目
       </th>
       <th>
        小程序内容场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        社交
       </td>
       <td>
        直播
       </td>
       <td>
        涉及娱乐性质，如明星直播、生活趣事直播、宠物直播等。选择该类目后首次提交代码审核，需经当地互联网主管机关审核确认，预计审核时长7天左右
       </td>
      </tr>
      <tr>
       <td>
        教育
       </td>
       <td>
        在线视频课程
       </td>
       <td>
        网课、在线培训、讲座等教育类直播
       </td>
      </tr>
      <tr>
       <td>
        医疗
       </td>
       <td>
        互联网医院，公立医院
       </td>
       <td>
        问诊、大型健康讲座等直播
       </td>
      </tr>
      <tr>
       <td>
        金融
       </td>
       <td>
        银行、信托、基金、证券/期货、证券、期货投资咨询、保险、征信业务、新三板信息服务平台、股票信息服务平台（港股/美股）、消费金融
       </td>
       <td>
        金融产品视频客服理赔、金融产品推广直播等
       </td>
      </tr>
      <tr>
       <td>
        汽车
       </td>
       <td>
        汽车预售服务
       </td>
       <td>
        汽车预售、推广直播
       </td>
      </tr>
      <tr>
       <td>
        政府主体帐号
       </td>
       <td>
        -
       </td>
       <td>
        政府相关工作推广直播、领导讲话直播等
       </td>
      </tr>
      <tr>
       <td>
        工具
       </td>
       <td>
        视频客服
       </td>
       <td>
        不涉及以上几类内容的一对一视频客服服务，如企业售后一对一视频服务等
       </td>
      </tr>
     </tbody>
    </table>
    <ul>
     <li>
      符合类目要求的小程序，需要在小程序管理后台的【开发】&gt;【接口设置】中自助开通推拉流标签的使用权限
     </li>
    </ul>
    <p>
     [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Vni239TU-1586502758626)(/Users/mxj/百度云同步盘/学习笔记/前端全栈/微信小程序/img/image-20200409073506475.png)]
    </p>
    <blockquote>
     <p>
      说明：如果以上设置都正确，但小程序依然不能正常工作，可能是微信内部的缓存没更新，请删除小程序并重启微信后，再进行尝试。
     </p>
    </blockquote>
    <h2>
     <a id="liveplayer_35">
     </a>
     live-player
    </h2>
    <p>
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html" rel="nofollow">
      live-player
     </a>
     是小程序内部用于支持音视频下行（播放）能力的功能标签。
    </p>
    <h3>
     <a id="_39">
     </a>
     版本支持
    </h3>
    <ul>
     <li>
      微信 App iOS 最低版本要求：6.5.21 。
     </li>
     <li>
      微信 App Android 最低版本要求：6.5.19。
     </li>
     <li>
      小程序基础库最低版本要求：1.7.0。
     </li>
    </ul>
    <blockquote>
     <p>
      可以通过 wx.getSystemInfo 可以获取当前基础库版本信息。
     </p>
    </blockquote>
    <h3>
     <a id="_47">
     </a>
     属性定义
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        属性名
       </th>
       <th align="left">
        类型
       </th>
       <th align="left">
        默认值
       </th>
       <th align="left">
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        src
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        用于音视频下行的播放 URL，支持 RTMP、FLV 等协议
       </td>
      </tr>
      <tr>
       <td align="left">
        mode
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        live
       </td>
       <td align="left">
        模式。live（直播），RTC（实时通话，该模式时延更低）
       </td>
      </tr>
      <tr>
       <td align="left">
        autoplay
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否自动播放
       </td>
      </tr>
      <tr>
       <td align="left">
        muted
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否静音
       </td>
      </tr>
      <tr>
       <td align="left">
        orientation
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        vertical
       </td>
       <td align="left">
        vertical（垂直），horizontal（水平）
       </td>
      </tr>
      <tr>
       <td align="left">
        object-fit
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        contain
       </td>
       <td align="left">
        填充模式，可选值有
        <code>
         contain（图像长边填满屏幕，短边区域会被填充⿊⾊）
        </code>
        ，
        <code>
         fillCrop（图像铺满屏幕，超出显示区域的部分将被截掉）
        </code>
       </td>
      </tr>
      <tr>
       <td align="left">
        background-mute
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        当微信切到后台时，是否关闭播放声音
       </td>
      </tr>
      <tr>
       <td align="left">
        min-cache
       </td>
       <td align="left">
        Number
       </td>
       <td align="left">
        1
       </td>
       <td align="left">
        最小缓冲延迟， 单位：秒
       </td>
      </tr>
      <tr>
       <td align="left">
        max-cache
       </td>
       <td align="left">
        Number
       </td>
       <td align="left">
        3
       </td>
       <td align="left">
        最大缓冲延迟， 单位：秒
       </td>
      </tr>
      <tr>
       <td align="left">
        sound-mode
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        speaker
       </td>
       <td align="left">
        声音输出方式。speaker（扬声器），ear(听筒)
       </td>
      </tr>
      <tr>
       <td align="left">
        auto-pause-if-navigate
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        true
       </td>
       <td align="left">
        当跳转到本小程序的其他页面时，是否自动暂停本页面的实时音视频播放
       </td>
      </tr>
      <tr>
       <td align="left">
        auto-pause-if-open-native
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        true
       </td>
       <td align="left">
        当跳转到其它微信原生页面时，是否自动暂停本页面的实时音视频播放
       </td>
      </tr>
      <tr>
       <td align="left">
        picture-in-picture-mode
       </td>
       <td align="left">
        string/Array
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        设置小窗模式： push, pop 或通过数组形式设置多种模式（如： [“push”, “pop”]）（不常用）
       </td>
      </tr>
      <tr>
       <td align="left">
        bindstatechange
       </td>
       <td align="left">
        EventHandler
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        用于指定一个 javascript 函数来接受播放器事件.detail = {code}
       </td>
      </tr>
      <tr>
       <td align="left">
        bindfullscreenchange
       </td>
       <td align="left">
        EventHandler
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        用于指定一个 javascript 函数来接受全屏变化事件，detail = {direction, fullScreen}
       </td>
      </tr>
      <tr>
       <td align="left">
        bindnetstatus
       </td>
       <td align="left">
        EventHandler
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        网络状态通知，detail = {info}
       </td>
      </tr>
      <tr>
       <td align="left">
        bindaudiovolumenotify
       </td>
       <td align="left">
        EventHandler
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        播放音量大小通知，detail = {}（不常用）
       </td>
      </tr>
      <tr>
       <td align="left">
        debug
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否开启调试模式
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      示例代码
     </strong>
    </p>
    <pre><code class="prism language-js"><span class="token operator">&lt;</span>view id<span class="token operator">=</span><span class="token string">'video-box'</span><span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span>live<span class="token operator">-</span>player
        wx<span class="token punctuation">:</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"{<!-- -->{player}}"</span>
        id<span class="token operator">=</span><span class="token string">"player_{<!-- -->{index}}"</span>
        mode<span class="token operator">=</span><span class="token string">"RTC"</span>
        object<span class="token operator">-</span>fit<span class="token operator">=</span><span class="token string">"fillCrop"</span>
        src<span class="token operator">=</span><span class="token string">"{<!-- -->{item.playUrl}}"</span> 
        autoplay<span class="token operator">=</span><span class="token string">'true'</span>
        bindstatechange<span class="token operator">=</span><span class="token string">"onPlay"</span><span class="token operator">&gt;</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>live<span class="token operator">-</span>player<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> 
</code></pre>
    <h3>
     <a id="_86">
     </a>
     超低时延
    </h3>
    <p>
     的 RTC 模式支持500ms以内的超低时延链路，可以应用在视频通话和远程遥控等场景中，要使用超低时延播放，需要注意如下几点：
     <br/>
     （1）推流端如果是微信小程序，请使用 的 RTC 模式。
     <br/>
     （2）推流端如果是 iOS 或者 Android SDK，请使用 setVideoQuality 的 MAIN_PUBLISHER 模式。
     <br/>
     （3）推流端如果是 Windows，请不要使用 OBS，延时太高，可以使用我们的
     <a href="https://cloud.tencent.com/document/product/454/7873" rel="nofollow">
      Windows SDK
     </a>
     。
     <br/>
     （4） 的 min-cache 和 max-cache 请不要自行设置，使用默认值。
     <br/>
     （5）播放地址请使用超低延时播放地址，也就是带了防盗链签名的
     <code>
      rtmp://
     </code>
     地址，如下：
    </p>
    <table>
     <thead>
      <tr>
       <th align="left">
        对比项目
       </th>
       <th align="left">
        示例
       </th>
       <th align="left">
        时延
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        普通直播 URL
       </td>
       <td align="left">
        rtmp://3891.liveplay.myqcloud.com/live/3891_test_clock_for_rtmpacc
       </td>
       <td align="left">
        &gt;2s
       </td>
      </tr>
      <tr>
       <td align="left">
        超低延时 URL
       </td>
       <td align="left">
        rtmp://3891.liveplay.myqcloud.com/live/3891_test_clock_for_rtmpacc?bizid=bizid&amp;txTime=5FD4431C&amp;txSerect=20e6d865f462dff61ada209d53c71cf9
       </td>
       <td align="left">
        &lt; 500ms
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_100">
     </a>
     属性详解
    </h3>
    <p>
     <strong>
      src
     </strong>
     <br/>
     用于音视频下行的播放 URL，支持 RTMP 协议（URL 以
     <code>
      rtmp://
     </code>
     打头）和 FLV 协议（URL 以
     <code>
      http://
     </code>
     打头且以
     <code>
      .flv
     </code>
     结尾）
    </p>
    <blockquote>
     <p>
      说明：
     </p>
     <p>
      标签是不支持 HLS（m3u8）协议的，因为 已经支持 HLS（m3u8）播放协议了。但直播观看不推荐使用 HLS（m3u8）协议，延迟要比 RTMP 和 FLV 协议高一个数量级。
     </p>
    </blockquote>
    <p>
     <strong>
      mode
     </strong>
     <br/>
     live 模式主要用于直播类场景，例如赛事直播、在线教育、远程培训等等。该模式下，小程序内部的模块会优先保证观看体验的流畅，通过调整 min-cache 和 max-cache 属性，您可以调节观众（播放）端所感受到的时间延迟的大小，文档下面会详细介绍这两个参数。
    </p>
    <p>
     RTC 则主要用于双向视频通话或多人视频通话场景，例如金融开会、在线客服、车险定损、培训会议等等。在此模式下，对 min-cache 和 max-cache 的设置不会起作用，因为小程序内部会自动将延迟控制在一个很低的水平（500ms左右）。
    </p>
    <p>
     <strong>
      min-cache 和 max-cache
     </strong>
    </p>
    <p>
     这两个参数分别用于指定观看端的最小缓冲时间和最大缓冲时间。所谓
     <strong>
      缓冲时间
     </strong>
     ，是指播放器为了缓解网络波动对观看流畅度的影响而引入的一个“蓄水池”，当来自网络的数据包出现卡顿甚至停滞的时候，“蓄水池”里的紧急用水可以让播放器还能坚持一小段时间，只要在这个短暂的时间内网速恢复正常，播放器就可以源源不断地渲染出流畅而平滑的视频画面。
    </p>
    <p>
     “蓄水池”里的水越多，抗网络波动的能力就越强，但代价就是观众端的延迟就越大，所以要在不同的场景下，使用不同的配置来达到体验上的平衡：
    </p>
    <ul>
     <li>
      码率比较低（1Mbps左右，画面以人物为主）的直播流，min-cache = 1，max-cache = 3 较合适。
     </li>
     <li>
      码率比较高（2Mbps - 3Mbps的高清游戏画面为主）的直播流，min-cache = 3，max-cache = 5 较合适。
     </li>
    </ul>
    <p>
     RTC 模式下这两个参数是无效的。
    </p>
    <p>
     <strong>
      background-mute
     </strong>
     <br/>
     微信切到后台以后是否继续播放声音，用于避免锁屏对于当前小程序正在播放的视频内容的影响。
    </p>
    <p>
     <strong>
      debug
     </strong>
     <br/>
     调试音视频相关功能，如果没有很好的工具会是一个噩梦，所以小程序为 live-pusher 标签支持了 debug 模式，开始 debug 模式之后，原本用于渲染视频画面的窗口上，会显示一个半透明的 log 窗口，用于展示各项音视频指标和事件，降低您调试相关功能的难度，具体使用方法我们在
     <a href="https://cloud.tencent.com/document/product/454/7946" rel="nofollow">
      FAQ
     </a>
     中有详细说明。
    </p>
    <h3>
     <a id="_131">
     </a>
     对象操作
    </h3>
    <p>
     <strong>
      wx.createLivePlayerContext()
     </strong>
     <br/>
     通过 wx.createLivePlayerContext() 可以将 标签和 javascript 对象关联起来，之后即可操作该对象。
    </p>
    <p>
     <strong>
      play
     </strong>
     <br/>
     开始播放，如果 的 autoplay 属性设置为 false（默认值），那么就可以使用 play 来手动启动播放。
    </p>
    <p>
     <strong>
      stop
     </strong>
     <br/>
     停止播放。
    </p>
    <p>
     <strong>
      pause
     </strong>
     <br/>
     暂停播放，停留在最后画面。
    </p>
    <p>
     <strong>
      resume
     </strong>
     <br/>
     继续播放，与 pause 成对使用。
    </p>
    <p>
     <strong>
      mute
     </strong>
     <br/>
     设置静音。
    </p>
    <p>
     <strong>
      requestFullScreen
     </strong>
     <br/>
     进入全屏幕。
    </p>
    <p>
     <strong>
      exitFullScreen
     </strong>
     <br/>
     退出全屏幕。
    </p>
    <p>
     <strong>
      代码实例
     </strong>
    </p>
    <pre><code class="prism language-js"><span class="token keyword">var</span> player <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createLivePlayerContext</span><span class="token punctuation">(</span><span class="token string">'pusher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
player<span class="token punctuation">.</span><span class="token function">requestFullScreen</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'enter full screen mode success!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        fail<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'enter full screen mode failed!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        complete<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'enter full screen mode complete!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_174">
     </a>
     内部事件
    </h3>
    <p>
     通过
     <code>
      live-player
     </code>
     标签的
     <strong>
      bindstatechange
     </strong>
     属性可以绑定一个事件处理函数，该函数可以监听推流模块的内部事件和异常通知。
    </p>
    <h4>
     <a id="_178">
     </a>
     <strong>
      关键事件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th align="left">
        code
       </th>
       <th align="left">
        事件定义
       </th>
       <th align="left">
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        2001
       </td>
       <td align="left">
        PLAY_EVT_CONNECT_SUCC
       </td>
       <td align="left">
        已经连接到云端服务器
       </td>
      </tr>
      <tr>
       <td align="left">
        2002
       </td>
       <td align="left">
        PLAY_EVT_RTMP_STREAM_BEGIN
       </td>
       <td align="left">
        服务器开始传输音视频数据
       </td>
      </tr>
      <tr>
       <td align="left">
        2003
       </td>
       <td align="left">
        PLAY_EVT_RCV_FIRST_I_FRAME
       </td>
       <td align="left">
        网络接收到首段音视频数据
       </td>
      </tr>
      <tr>
       <td align="left">
        2004
       </td>
       <td align="left">
        PLAY_EVT_PLAY_BEGIN
       </td>
       <td align="left">
        视频播放开始，可以在收到此事件之前先用默认图片代表等待状态
       </td>
      </tr>
      <tr>
       <td align="left">
        2006
       </td>
       <td align="left">
        PLAY_EVT_PLAY_END
       </td>
       <td align="left">
        视频播放结束
       </td>
      </tr>
      <tr>
       <td align="left">
        2007
       </td>
       <td align="left">
        PLAY_EVT_PLAY_LOADING
       </td>
       <td align="left">
        进入缓冲中状态，此时播放器在等待或积攒来自服务器的数据
       </td>
      </tr>
      <tr>
       <td align="left">
        -2301
       </td>
       <td align="left">
        PLAY_ERR_NET_DISCONNECT
       </td>
       <td align="left">
        网络连接断开，且重新连接亦不能恢复，播放器已停止播放
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html" rel="nofollow">
      更多详细状态码请查看官方文档
     </a>
    </p>
    <blockquote>
     <p>
      说明：
     </p>
     <p>
      播放 HTTP:// 打头的 FLV 协议地址时，如果观众遇到播放中直播流断开的情况，小程序是不会抛出 PLAY_EVT_PLAY_END 事件的，这是因为 FLV 协议中没有定义停止事件，所以只能通过监听 PLAY_ERR_NET_DISCONNECT 来替代之。
     </p>
    </blockquote>
    <h4>
     <a id="_196">
     </a>
     警告事件
    </h4>
    <p>
     内部警告并非不可恢复的错误，小程序内部的音视频 SDK 会启动相应的恢复措施，警告的目的主要用于提示开发者或者最终用户，例如：
    </p>
    <table>
     <thead>
      <tr>
       <th align="left">
        code
       </th>
       <th align="left">
        事件定义
       </th>
       <th align="left">
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        2101
       </td>
       <td align="left">
        PLAY_WARNING_VIDEO_DECODE_FAIL
       </td>
       <td align="left">
        当前视频帧解码失败
       </td>
      </tr>
      <tr>
       <td align="left">
        2102
       </td>
       <td align="left">
        PLAY_WARNING_AUDIO_DECODE_FAIL
       </td>
       <td align="left">
        当前音频帧解码失败
       </td>
      </tr>
      <tr>
       <td align="left">
        2103
       </td>
       <td align="left">
        PLAY_WARNING_RECONNECT
       </td>
       <td align="left">
        网络断连，已启动自动重连恢复（重连超过三次就直接抛送 PLAY_ERR_NET_DISCONNECT 了）
       </td>
      </tr>
      <tr>
       <td align="left">
        2104
       </td>
       <td align="left">
        PLAY_WARNING_RECV_DATA_LAG
       </td>
       <td align="left">
        视频流不太稳定，可能是观看者当前网速不充裕
       </td>
      </tr>
      <tr>
       <td align="left">
        2105
       </td>
       <td align="left">
        PLAY_WARNING_VIDEO_PLAY_LAG
       </td>
       <td align="left">
        当前视频播放出现卡顿
       </td>
      </tr>
      <tr>
       <td align="left">
        2106
       </td>
       <td align="left">
        PLAY_WARNING_HW_ACCELERATION_FAIL
       </td>
       <td align="left">
        硬解启动失败，采用软解
       </td>
      </tr>
      <tr>
       <td align="left">
        2107
       </td>
       <td align="left">
        PLAY_WARNING_VIDEO_DISCONTINUITY
       </td>
       <td align="left">
        当前视频帧不连续，视频源可能有丢帧，可能会导致画面花屏
       </td>
      </tr>
      <tr>
       <td align="left">
        3001
       </td>
       <td align="left">
        PLAY_WARNING_DNS_FAIL
       </td>
       <td align="left">
        DNS解析失败（仅播放 RTMP:// 地址时会抛送）
       </td>
      </tr>
      <tr>
       <td align="left">
        3002
       </td>
       <td align="left">
        PLAY_WARNING_SEVER_CONN_FAIL
       </td>
       <td align="left">
        服务器连接失败（仅播放 RTMP:// 地址时会抛送）
       </td>
      </tr>
      <tr>
       <td align="left">
        3003
       </td>
       <td align="left">
        PLAY_WARNING_SHAKE_FAIL
       </td>
       <td align="left">
        服务器握手失败（仅播放 RTMP:// 地址时会抛送）
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      代码实例
     </strong>
    </p>
    <pre><code class="prism language-js"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    onPlay<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">2004</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频播放开始'</span><span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/**
     * 生命周期函数--监听页面加载
     */</span>
    onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_232">
     </a>
     网络状态数据
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        键名
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        videoBitrate
       </td>
       <td>
        当前视频编/码器输出的比特率，单位 kbps
       </td>
      </tr>
      <tr>
       <td>
        audioBitrate
       </td>
       <td>
        当前音频编/码器输出的比特率，单位 kbps
       </td>
      </tr>
      <tr>
       <td>
        videoFPS
       </td>
       <td>
        当前视频帧率
       </td>
      </tr>
      <tr>
       <td>
        videoGOP
       </td>
       <td>
        当前视频 GOP,也就是每两个关键帧(I帧)间隔时长，单位 s
       </td>
      </tr>
      <tr>
       <td>
        netSpeed
       </td>
       <td>
        当前的发送/接收速度
       </td>
      </tr>
      <tr>
       <td>
        netJitter
       </td>
       <td>
        网络抖动情况，为 0 时表示没有任何抖动，值越大表明网络抖动越大，网络越不稳定
       </td>
      </tr>
      <tr>
       <td>
        videoWidth
       </td>
       <td>
        视频画面的宽度
       </td>
      </tr>
      <tr>
       <td>
        videoHeight
       </td>
       <td>
        视频画面的高度
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_245">
     </a>
     小窗特性说明
    </h3>
    <p>
     live-player 小窗支持以下三种触发模式（在组件上设置 picture-in-picture-mode 属性）：
    </p>
    <ol>
     <li>
      push 模式，即从当前页跳转至下一页时出现小窗（页面栈push）
     </li>
     <li>
      pop 模式，即离开当页面时触发（页面栈pop）
     </li>
     <li>
      以上两种路由行为均触发小窗
     </li>
    </ol>
    <p>
     此外，小窗还支持以下特性：
    </p>
    <ul>
     <li>
      小窗容器尺寸会根据原组件尺寸自动判断
     </li>
     <li>
      点击小窗，用户会被导航回小窗对应的播放器页面
     </li>
     <li>
      小窗出现后，用户可点击小窗右上角的关闭按钮或调用 context.exitPictureInPicture() 接口关闭小窗
     </li>
    </ul>
    <h3>
     <a id="_259">
     </a>
     特别说明
    </h3>
    <ol>
     <li>
      <p>
       组件是由客户端创建的原生组件，它的层级是最高的，不能通过
       <code>
        z-index
       </code>
       控制层级。可以使用 和 覆盖在上面。
      </p>
     </li>
     <li>
      <p>
       请勿在 ，，， 中使用 组件。
      </p>
     </li>
     <li>
      <p>
       <a href="https://developers.weixin.qq.com/miniprogram/dev/component/live-player.html" rel="nofollow">
        live-player
       </a>
       默认宽度300px、高度225px，可通过wxss设置宽高。
      </p>
     </li>
     <li>
      <p>
       开发者工具上暂不支持。
      </p>
     </li>
     <li>
      <p>
       css 动画对 live-pusher 组件无效。
      </p>
     </li>
    </ol>
    <h3>
     <a id="_269">
     </a>
     常见问题
    </h3>
    <h4>
     <a id="_271">
     </a>
     开发和运行环境要求
    </h4>
    <ul>
     <li>
      微信 App iOS 最低版本要求：6.5.21。
     </li>
     <li>
      微信 App Android 最低版本要求：6.5.19。
     </li>
     <li>
      小程序基础库最低版本要求：1.7.0。
     </li>
     <li>
      由于微信开发者工具不支持原生组件（即 和 标签），需要在真机上进行运行体验。
     </li>
    </ul>
    <h4>
     <a id="_278">
     </a>
     调试时为什么要开启调试模式？
    </h4>
    <p>
     开启调试可以跳过把这些域名加入小程序白名单的工作，否则可能会遇到登录失败，通话无法连接的问题。
    </p>
    <h2>
     <a id="livepusher_282">
     </a>
     live-pusher
    </h2>
    <h3>
     <a id="_284">
     </a>
     属性定义
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        属性名
       </th>
       <th align="left">
        类型
       </th>
       <th align="left">
        默认值
       </th>
       <th align="left">
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        url
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        用于音视频上行的推流 URL
       </td>
      </tr>
      <tr>
       <td align="left">
        mode
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        RTC
       </td>
       <td align="left">
        SD，HD，FHD，RTC
       </td>
      </tr>
      <tr>
       <td align="left">
        autopush
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否自动启动推流
       </td>
      </tr>
      <tr>
       <td align="left">
        muted
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否静音
       </td>
      </tr>
      <tr>
       <td align="left">
        enable-camera
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        true
       </td>
       <td align="left">
        开启\关闭摄像头
       </td>
      </tr>
      <tr>
       <td align="left">
        auto-focus
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        true
       </td>
       <td align="left">
        手动\自动对焦
       </td>
      </tr>
      <tr>
       <td align="left">
        orientation
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        vertical
       </td>
       <td align="left">
        vertical，horizontal
       </td>
      </tr>
      <tr>
       <td align="left">
        beauty
       </td>
       <td align="left">
        Number
       </td>
       <td align="left">
        0
       </td>
       <td align="left">
        美颜指数，取值 0 - 9，数值越大效果越明显
       </td>
      </tr>
      <tr>
       <td align="left">
        whiteness
       </td>
       <td align="left">
        Number
       </td>
       <td align="left">
        0
       </td>
       <td align="left">
        美白指数，取值 0 - 9，数值越大效果越明显
       </td>
      </tr>
      <tr>
       <td align="left">
        aspect
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        9：16
       </td>
       <td align="left">
        3：4，9：16
       </td>
      </tr>
      <tr>
       <td align="left">
        zoom
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否正常焦距，true 表示将摄像头放大
       </td>
      </tr>
      <tr>
       <td align="left">
        device-position
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        front
       </td>
       <td align="left">
        front 前置摄像头，back 后置摄像头
       </td>
      </tr>
      <tr>
       <td align="left">
        min-bitrate
       </td>
       <td align="left">
        Number
       </td>
       <td align="left">
        200
       </td>
       <td align="left">
        最小码率，该数值决定了画面最差的清晰度表现
       </td>
      </tr>
      <tr>
       <td align="left">
        max-bitrate
       </td>
       <td align="left">
        Number
       </td>
       <td align="left">
        1000
       </td>
       <td align="left">
        最大码率，该数值决定了画面最好的清晰度表现
       </td>
      </tr>
      <tr>
       <td align="left">
        audio-quality
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        low
       </td>
       <td align="left">
        low 适合语音通话，high 代表高音质
       </td>
      </tr>
      <tr>
       <td align="left">
        waiting-image
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        当微信切到后台时的垫片图片
       </td>
      </tr>
      <tr>
       <td align="left">
        waiting-image-hash
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        当微信切到后台时的垫片图片的校验值
       </td>
      </tr>
      <tr>
       <td align="left">
        background-mute
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        当微信切到后台时是否禁用声音采集
       </td>
      </tr>
      <tr>
       <td align="left">
        bindstatechange
       </td>
       <td align="left">
        String
       </td>
       <td align="left">
        -
       </td>
       <td align="left">
        用于指定一个 javascript 函数来接收音视频事件
       </td>
      </tr>
      <tr>
       <td align="left">
        debug
       </td>
       <td align="left">
        Boolean
       </td>
       <td align="left">
        false
       </td>
       <td align="left">
        是否开启调试模式
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      示例代码
     </strong>
    </p>
    <pre><code class="prism language-js"><span class="token operator">&lt;</span>view id<span class="token operator">=</span><span class="token string">'video-box'</span><span class="token operator">&gt;</span>  
    <span class="token operator">&lt;</span>live<span class="token operator">-</span>pusher
          id<span class="token operator">=</span><span class="token string">"pusher"</span>
          mode<span class="token operator">=</span><span class="token string">"RTC"</span>
          url<span class="token operator">=</span><span class="token string">"{<!-- -->{pusher.push_url}}"</span> 
          autopush<span class="token operator">=</span><span class="token string">'true'</span>
          bindstatechange<span class="token operator">=</span><span class="token string">"onPush"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>live<span class="token operator">-</span>pusher<span class="token operator">&gt;</span>  
 <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span> 
</code></pre>
    <h3>
     <a id="_323">
     </a>
     属性详解
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        url
       </strong>
       <br/>
       用于音视频上行的推流 URL，以
       <code>
        rtmp://
       </code>
       协议前缀打头，腾讯云推流 URL 的获取方法见
       <a href="https://cloud.tencent.com/document/product/454/7915" rel="nofollow">
        快速获取 URL
       </a>
       文档。
      </p>
      <blockquote>
       <p>
        说明：
       </p>
       <p>
        小程序内部使用的 RTMP 协议是支持 UDP 加速的版本，在同样网络条件下，UDP 版本的 RTMP 会比开源版本的有更好的上行速度和抗抖动能力。
       </p>
      </blockquote>
     </li>
     <li>
      <p>
       <strong>
        mode
       </strong>
       <br/>
       SD、HD 和 FHD 主要用于直播类场景，例如赛事直播、在线教育、远程培训等等。SD、HD 和 FHD 分别对应三种默认的清晰度。该模式下，小程序会更加注重清晰度和观看的流畅性，不会过分强调低延迟，也不会为了延迟牺牲画质和流畅性。
      </p>
      <p>
       RTC 则主要用于双向视频通话或多人视频通话场景，例如金融开会、在线客服、车险定损、培训会议等。该模式下，小程序会更加注重降低点到点的时延，也会优先保证声音的质量，在必要的时候会对画面清晰度和画面的流畅性进行一定的缩水。
      </p>
     </li>
     <li>
      <p>
       <strong>
        orientation 和 aspect
       </strong>
       <br/>
       横屏（horizontal）模式还是竖屏（vertical）模式，默认是竖屏模式，即 home 键朝下。这时，小程序推出的画面的宽高比是3：4或者9：16这两种竖屏宽高比的画面，也就是宽 &lt; 高。如果改成横屏模式，小程序推出的画面宽高比即变为4：3或者16：9这种横屏宽高比的画面，也就是宽 &gt; 高。
      </p>
      <p>
       具体的宽高比是有 aspect 决定的 ，默认是9：16， 也可以支持3：4。 这是在 orientation 的属性值为 vertical 的情况下。如果 orientation 的属性值为 horizontal，那么3：4的效果等价于4：3，9：16的效果等价于16：9。
      </p>
     </li>
     <li>
      <p>
       <strong>
        min-bitrate 和 max-bitrate
       </strong>
       <br/>
       这里首先要科普一个概念 —— 视频码率，指视频编码器每秒钟输出的视频数据的多少。在视频分辨率确定的情况下，视频码率越高，即每秒钟输出的数据越多，相应的画质也就越好。
      </p>
      <p>
       所以 min-bitrate 和 max-bitrate 这两个属性，分别用于决定输出画面的最低清晰度和最高清晰度。这两个数值并非越大越好，因为用户的网络上行不是无限好的。但也不是越小越好，因为实际应用场景中，清晰与否是用户衡量产品体验的一个重要指标。具体的数值设定我们会在**“参数设置”**部分详细介绍。
      </p>
      <p>
       小程序内部会自动处理好分辨率和码率的关系，例如2Mbps的码率，小程序会选择720p的分辨率进行匹配，而300kbps的码率下，小程序则会选择较低的分辨率来提高编码效率。所以您只需要关注 min-bitrate 和 max-bitrate 这一对参数就可以掌控画质了。
      </p>
     </li>
     <li>
      <p>
       <strong>
        waiting-image 和 waiting-image-hash
       </strong>
       <br/>
       出于用户隐私的考虑，在微信切到后台以后，小程序希望停止摄像头的画面采集。但是对于另一端的用户而言，画面会变成黑屏或者冻屏（停留在最后一帧），这种体验是非常差的。为了解决这个问题，我们引入了 waiting-image 属性，您可以设置一张有 “稍候” 含义的图片（waiting-image 是该图片的 URL，waiting-image-hash 则是该图片对应的 md5 校验值）。当微信切到后台以后，小程序会使用该图片作为摄像头画面的替代，以极低的流量占用维持视频流3分钟时间。
      </p>
     </li>
     <li>
      <p>
       <strong>
        debug
       </strong>
       <br/>
       调试音视频相关功能，如果没有很好的工具会是一个噩梦，所以小程序为 live-pusher 标签支持了 debug 模式，开始 debug 模式之后，原本用于渲染视频画面的窗口上，会显示一个半透明的 log 窗口，用于展示各项音视频指标和事件，降低您调试相关功能的难度，具体使用方法我们在
       <a href="https://cloud.tencent.com/document/product/454/7946" rel="nofollow">
        FAQ
       </a>
       中有详细说明。
      </p>
     </li>
    </ul>
    <h3>
     <a id="_355">
     </a>
     参数设置
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        场景
       </th>
       <th align="left">
        mode
       </th>
       <th align="left">
        min-bitrate
       </th>
       <th align="left">
        max-bitrate
       </th>
       <th align="left">
        audio-quality
       </th>
       <th align="left">
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        标清直播
       </td>
       <td align="left">
        SD
       </td>
       <td align="left">
        300kbps
       </td>
       <td align="left">
        800kbps
       </td>
       <td align="left">
        high
       </td>
       <td align="left">
        窄带场景，例如户外或者网络不稳定的情况下适用
       </td>
      </tr>
      <tr>
       <td align="left">
        高清直播
       </td>
       <td align="left">
        HD
       </td>
       <td align="left">
        600kbps
       </td>
       <td align="left">
        1200kbps
       </td>
       <td align="left">
        high
       </td>
       <td align="left">
        目前主流的 App 所采用的参数设定，普通直播场景推荐使用这一档
       </td>
      </tr>
      <tr>
       <td align="left">
        超清直播
       </td>
       <td align="left">
        FHD
       </td>
       <td align="left">
        600kbps
       </td>
       <td align="left">
        1800kbps
       </td>
       <td align="left">
        high
       </td>
       <td align="left">
        对清晰度要求比较苛刻的场景，普通手机观看使用 HD 即可
       </td>
      </tr>
      <tr>
       <td align="left">
        视频客服（用户）
       </td>
       <td align="left">
        RTC
       </td>
       <td align="left">
        200kbps
       </td>
       <td align="left">
        500kbps
       </td>
       <td align="left">
        high
       </td>
       <td align="left">
        这是一种声音为主，画面为辅的场景，所以画质不要设置的太高
       </td>
      </tr>
      <tr>
       <td align="left">
        车险定损（车主）
       </td>
       <td align="left">
        RTC
       </td>
       <td align="left">
        200kbps
       </td>
       <td align="left">
        1200kbps
       </td>
       <td align="left">
        high
       </td>
       <td align="left">
        由于可能要看车况详情，画质上限会设置的高一些
       </td>
      </tr>
      <tr>
       <td align="left">
        多人会议（主讲）
       </td>
       <td align="left">
        RTC
       </td>
       <td align="left">
        200kbps
       </td>
       <td align="left">
        1000kbps
       </td>
       <td align="left">
        high
       </td>
       <td align="left">
        主讲人画质可以适当高一些，参与的质量可以设置的低一些
       </td>
      </tr>
      <tr>
       <td align="left">
        多人会议（参与）
       </td>
       <td align="left">
        RTC
       </td>
       <td align="left">
        150kbps
       </td>
       <td align="left">
        300kbps
       </td>
       <td align="left">
        low
       </td>
       <td align="left">
        作为会议参与者，不需要太高的画质和音质
       </td>
      </tr>
     </tbody>
    </table>
    <blockquote>
     <p>
      如果不是对带宽特别没有信心的应用场景，audio-quality 选项请不要选择 low，其音质和延迟感都要会比 high 模式差很多。
     </p>
    </blockquote>
    <h3>
     <a id="_369">
     </a>
     对象操作
    </h3>
    <ul>
     <li>
      <strong>
       wx.createLivePusherContext()
      </strong>
      <br/>
      通过 wx.createLivePusherContext() 可以将 标签和 javascript 对象关联起来，之后即可操作该对象。
     </li>
     <li>
      <strong>
       start
      </strong>
      <br/>
      开始推流，如果 的 autopush 属性设置为 false（默认值），那么就可以使用 start 来手动开始推流。
     </li>
     <li>
      <strong>
       stop
      </strong>
      <br/>
      停止推流。
     </li>
     <li>
      <strong>
       pause
      </strong>
      <br/>
      暂停推流。
     </li>
     <li>
      <strong>
       resume
      </strong>
      <br/>
      恢复推流，请与 pause 操作配对使用。
     </li>
     <li>
      <strong>
       switchCamera
      </strong>
      <br/>
      切换前后摄像头。
     </li>
     <li>
      <strong>
       snapshot
      </strong>
      <br/>
      推流截图，截图大小跟组件的大小一致。截图成功图片的临时路径为
      <code>
       ret.tempImagePath
      </code>
      。
     </li>
    </ul>
    <p>
     <strong>
      代码实例
     </strong>
    </p>
    <pre><code>var pusher = wx.createLivePusherContext('pusher');
pusher.start({
    success: function(ret){
            console.log('start push success!')
        }
        fail: function(){
            console.log('start push failed!')
        }
        complete: function(){
            console.log('start push complete!')
        }
});
</code></pre>
    <h3>
     <a id="_403">
     </a>
     内部事件
    </h3>
    <p>
     通过 标签的
     <strong>
      bindstatechange
     </strong>
     属性可以绑定一个事件处理函数，该函数可以监听推流模块的内部事件和异常通知。
    </p>
    <h4>
     <a id="_407">
     </a>
     常规事件
    </h4>
    <table>
     <thead>
      <tr>
       <th align="left">
        code
       </th>
       <th align="left">
        事件定义
       </th>
       <th align="left">
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        1001
       </td>
       <td align="left">
        PUSH_EVT_CONNECT_SUCC
       </td>
       <td align="left">
        已经成功连接到云端服务器
       </td>
      </tr>
      <tr>
       <td align="left">
        1002
       </td>
       <td align="left">
        PUSH_EVT_PUSH_BEGIN
       </td>
       <td align="left">
        与服务器握手完毕，一切正常，准备开始上行推流
       </td>
      </tr>
      <tr>
       <td align="left">
        1003
       </td>
       <td align="left">
        PUSH_EVT_OPEN_CAMERA_SUCC
       </td>
       <td align="left">
        已成功启动摄像头，摄像头被占用或者被限制权限的情况下无法打开
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="_415">
     </a>
     严重错误
    </h4>
    <table>
     <thead>
      <tr>
       <th align="left">
        code
       </th>
       <th align="left">
        事件定义
       </th>
       <th align="left">
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        -1301
       </td>
       <td align="left">
        PUSH_ERR_OPEN_CAMERA_FAIL
       </td>
       <td align="left">
        打开摄像头失败
       </td>
      </tr>
      <tr>
       <td align="left">
        -1302
       </td>
       <td align="left">
        PUSH_ERR_OPEN_MIC_FAIL
       </td>
       <td align="left">
        打开麦克风失败
       </td>
      </tr>
      <tr>
       <td align="left">
        -1303
       </td>
       <td align="left">
        PUSH_ERR_VIDEO_ENCODE_FAIL
       </td>
       <td align="left">
        视频编码失败
       </td>
      </tr>
      <tr>
       <td align="left">
        -1304
       </td>
       <td align="left">
        PUSH_ERR_AUDIO_ENCODE_FAIL
       </td>
       <td align="left">
        音频编码失败
       </td>
      </tr>
      <tr>
       <td align="left">
        -1305
       </td>
       <td align="left">
        PUSH_ERR_UNSUPPORTED_RESOLUTION
       </td>
       <td align="left">
        不支持的视频分辨率
       </td>
      </tr>
      <tr>
       <td align="left">
        -1306
       </td>
       <td align="left">
        PUSH_ERR_UNSUPPORTED_SAMPLERATE
       </td>
       <td align="left">
        不支持的音频采样率
       </td>
      </tr>
      <tr>
       <td align="left">
        -1307
       </td>
       <td align="left">
        PUSH_ERR_NET_DISCONNECT
       </td>
       <td align="left">
        网络断连，且经三次重连无效，可以放弃，更多重试请
        <a href="https://cloud.tencent.com/document/product/454/12518#start_push" rel="nofollow">
         自行重启推流
        </a>
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="_427">
     </a>
     警告事件
    </h4>
    <p>
     内部警告并非不可恢复的错误，小程序内部的音视频 SDK 会启动相应的恢复措施，警告的目的主要用于提示开发者或者最终用户，例如：
    </p>
    <ul>
     <li>
      <strong>
       PUSH_WARNING_NET_BUSY
      </strong>
      <br/>
      上行网速不给力，建议提示用户改善当前的网络环境，例如让用户离家里的路由器近一点，或者切到 Wi-Fi 环境下再使用。
     </li>
     <li>
      <strong>
       PUSH_WARNING_SERVER_DISCONNECT
      </strong>
      <br/>
      请求被后台拒绝了，出现这个问题一般是由于 URL 里的 txSecret 计算错了，或者是 URL 被其他人占用了（跟播放不同，一个推流 URL 同时只能有一个用户使用）。
     </li>
     <li>
      <strong>
       PUSH_WARNING_HANDUP_STOP
      </strong>
      <br/>
      当用户单击小程序右上角的圆圈或者返回按钮时，微信会将小程序挂起，此时 会抛出5000这个事件。
     </li>
    </ul>
    <table>
     <thead>
      <tr>
       <th align="left">
        code
       </th>
       <th align="left">
        事件定义
       </th>
       <th align="left">
        含义说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        1101
       </td>
       <td align="left">
        PUSH_WARNING_NET_BUSY
       </td>
       <td align="left">
        上行网速不够用，建议提示用户改善当前的网络环境
       </td>
      </tr>
      <tr>
       <td align="left">
        1102
       </td>
       <td align="left">
        PUSH_WARNING_RECONNECT
       </td>
       <td align="left">
        网络断连，已启动重连流程（重试失败超过三次会放弃）
       </td>
      </tr>
      <tr>
       <td align="left">
        1103
       </td>
       <td align="left">
        PUSH_WARNING_HW_ACCELERATION_FAIL
       </td>
       <td align="left">
        硬编码启动失败，自动切换到软编码
       </td>
      </tr>
      <tr>
       <td align="left">
        1107
       </td>
       <td align="left">
        PUSH_WARNING_SWITCH_SWENC
       </td>
       <td align="left">
        由于机器性能问题，自动切换到硬件编码
       </td>
      </tr>
      <tr>
       <td align="left">
        3001
       </td>
       <td align="left">
        PUSH_WARNING_DNS_FAIL
       </td>
       <td align="left">
        DNS 解析失败，启动重试流程
       </td>
      </tr>
      <tr>
       <td align="left">
        3002
       </td>
       <td align="left">
        PUSH_WARNING_SEVER_CONN_FAIL
       </td>
       <td align="left">
        服务器连接失败，启动重试流程
       </td>
      </tr>
      <tr>
       <td align="left">
        3003
       </td>
       <td align="left">
        PUSH_WARNING_SHAKE_FAIL
       </td>
       <td align="left">
        服务器握手失败，启动重试流程
       </td>
      </tr>
      <tr>
       <td align="left">
        3004
       </td>
       <td align="left">
        PUSH_WARNING_SERVER_DISCONNECT
       </td>
       <td align="left">
        服务器主动断开连接，启动重试流程
       </td>
      </tr>
      <tr>
       <td align="left">
        3005
       </td>
       <td align="left">
        PUSH_WARNING_SERVER_DISCONNECT
       </td>
       <td align="left">
        socket 链路异常断开 ，启动重试流程
       </td>
      </tr>
      <tr>
       <td align="left">
        5000
       </td>
       <td align="left">
        PUSH_WARNING_HANDUP_STOP
       </td>
       <td align="left">
        小程序被用户挂起
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      代码实例
     </strong>
    </p>
    <pre><code class="prism language-js"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    onPush<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">1002</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'推流成功了'</span><span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/**
     * 生命周期函数--监听页面加载
     */</span>
    onLoad<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f73696e61745f33333235353439352f:61727469636c652f64657461696c732f313035343334323337" class_="artid" style="display:none">
 </p>
</div>


