---
layout: post
title: "Ansible命令行模式常用模块使用案例三"
date: 2025-03-14 22:08:30 +0800
description: "在Ansible中，命令行模式（Ad-Hoc 模式）是一种快速执行任务的方式，适合临时任务或简单操作。以下是 Ansible 命令行模式中常用模块的使用案例（第三部分）。"
keywords: "Ansible命令行模式常用模块使用案例（三）"
categories: ['自动化运维技术探索', '技术探索与实践', 'Linux']
tags: ['自动化运维', '模式', 'Linux', 'Hoc', 'Ansible']
artid: "146213614"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146213614
    alt: "Ansible命令行模式常用模块使用案例三"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146213614
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146213614
cover: https://bing.ee123.net/img/rand?artid=146213614
image: https://bing.ee123.net/img/rand?artid=146213614
img: https://bing.ee123.net/img/rand?artid=146213614
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Ansible命令行模式常用模块使用案例（三）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <blockquote>
     <p>
      在Ansible中，命令行模式（Ad-Hoc 模式）是一种快速执行任务的方式，适合临时任务或简单操作。以下是 Ansible 命令行模式中常用模块的使用案例（第三部分）。
     </p>
    </blockquote>
    <h2>
     1
     <strong>
      user
     </strong>
    </h2>
    <blockquote>
     <div style="text-align:left">
      <strong>
       功能特性：
      </strong>
      用于管理用户账户（创建、修改、删除），底层调用useradd、usermod、userdel命令
     </div>
     <div style="text-align:left">
      <strong>
       关键参数：
      </strong>
     </div>
     <div>
      <ul style="margin-left:0; margin-right:0">
       <li style="text-align:left">
        name：用户名（必填）
       </li>
       <li style="text-align:left">
        group：用户的主组（默认与用户名相同）
       </li>
       <li style="text-align:left">
        groups：用户的附加组（多个组用逗号分隔，设为空字符串，groups=表示清空所有组）
       </li>
       <li style="text-align:left">
        shell：用户的默认Shell
       </li>
       <li style="text-align:left">
        state：账户状态，包括present（创建/修改）、absent（删除）
       </li>
       <li style="text-align:left">
        remove：当state=absent时，是否删除用户家目录和邮件文件（类似userdel -r）
       </li>
      </ul>
     </div>
    </blockquote>
    <pre><code>示例1：创建用户并指定主组与附加组
ansible web -m user -a "name=test group=admin groups=sudo,tmp shell=/bin/bash" -b

示例2：删除用户并移除家目录
ansible db -m user -a "name=olduser state=absent remove=yes" -b

示例3：清楚用户附加组
ansible all -m user -a "name=guest groups=" -b</code></pre>
    <h2>
     2
     <strong>
      group模块
     </strong>
    </h2>
    <blockquote>
     <div style="text-align:left">
      <strong>
       功能特性：
      </strong>
      用于管理用户组（创建、修改、删除），底层调用groupadd、groupmod、groupdel命令
     </div>
     <div style="text-align:left">
      <strong>
       关键参数：
      </strong>
     </div>
     <div>
      <ul style="margin-left:0; margin-right:0">
       <li style="text-align:left">
        name：组名（必填）
       </li>
       <li style="text-align:left">
        gid：指定组的 GID（可选）
       </li>
       <li style="text-align:left">
        state：组状态，包括present（创建/修改）、absent（删除）
       </li>
      </ul>
     </div>
    </blockquote>
    <pre><code>示例1：创建组并制定gid
ansible web -m group -a "name=admins gid=2000 state=present" -b

示例2：删除组
ansible db -m group -a "name=oldgroup state=absent" -b</code></pre>
    <h2>
     3
     <strong>
      synchronize模块
     </strong>
    </h2>
    <blockquote>
     <div style="text-align:left">
      <strong>
       功能特性：
      </strong>
      通过调用 rsync实现高性能文件/目录同步 ，支持本地与远程主机之间的双向传输（推送或拉取）
     </div>
     <div style="text-align:left">
      <strong>
       关键参数：
      </strong>
     </div>
     <div>
      <ul style="margin-left:0; margin-right:0">
       <li style="text-align:left">
        src：源路径（本地或远程路径）
       </li>
       <li style="text-align:left">
        dest：目标路径（本地或远程路径）
       </li>
       <li style="text-align:left">
        mode：同步模式：push（本地→远程）、pull（远程→本地）
       </li>
       <li style="text-align:left">
        archive：归档模式（等效 rsync -a，包含递归、权限、时间戳等）
       </li>
       <li style="text-align:left">
        compress：启用压缩传输
       </li>
       <li style="text-align:left">
        checksum：根据文件内容（而非修改时间/大小）判断是否同步
       </li>
       <li style="text-align:left">
        copy_links：复制符号链接文件本身（而非指向的目标）
       </li>
       <li style="text-align:left">
        delete：删除目标路径中源路径不存在的文件
       </li>
       <li style="text-align:left">
        exclude：排除特定文件/目录（支持通配符）
       </li>
       <li style="text-align:left">
        rsync_opts：传递额外的 rsync 参数（如--bwlimit=1000）
       </li>
       <li style="text-align:left">
        dest_port：远程主机的 SSH 端口
       </li>
       <li style="text-align:left">
        set_remote_user：指定远程用户（需与ansible_user一致）
       </li>
      </ul>
     </div>
    </blockquote>
    <pre><code>示例1：推送本地目录到远程主机
ansible web -m synchronize -a "src=/local/tmp/ dest=/tmp/remote/ mode=push archive=yes delete=yes" -b

示例2：从远程主机拉取文件
ansible db -m synchronize -a "src=/remote/backup/ dest=/local/backup/ mode=pull" -b

示例3：排除特定文件
ansible all -m synchronize -a "src=/data/ dest=/backup/ exclude='*.log,*.tmp' compress=no" -b

示例4：使用校验和同步
ansible web -m synchronize -a "src=/code/ dest=/deploy/ checksum=yes" -b</code></pre>
    <h2 id="FT2A-1741781126924" style="text-align:left">
     <strong>
      4 get_url模块
     </strong>
    </h2>
    <blockquote>
     <div style="text-align:left">
      <strong>
       功能特性：
      </strong>
      从 HTTP/HTTPS/FTP 服务器下载文件，支持身份验证、哈希校验、代理配置等高级功能，适用于自动化部署或配置文件拉取
     </div>
     <div style="text-align:left">
      <strong>
       关键参数：
      </strong>
     </div>
     <div>
      <ul style="margin-left:0; margin-right:0">
       <li style="text-align:left">
        url：要下载的文件URL（必填）
       </li>
       <li style="text-align:left">
        dest：本地保存路径（若目录不存在会自动创建）
       </li>
       <li style="text-align:left">
        sha256sum：下载后校验文件的SHA-256哈希值
       </li>
       <li style="text-align:left">
        timeout：下载超时时间（秒）
       </li>
       <li style="text-align:left">
        url_username：用于HTTP Basic认证的用户名
       </li>
       <li style="text-align:left">
        url_password：用于HTTP Basic认证的密码
       </li>
       <li style="text-align:left">
        use_proxy：是否使用代理（依赖环境变量http_proxy/https_proxy）
       </li>
       <li style="text-align:left">
        force：强制重新下载（即使文件已存在）
       </li>
      </ul>
     </div>
     <p>
     </p>
    </blockquote>
    <pre><code>示例1：基础下载
ansible web -m get_url -a "url=https://example.com/file.zip dest=/tmp/file.zip"

示例2：校验文件完整性
ansible db -m get_url -a "url=https://example.com/app.rpm dest=/opt/app.rpm sha256sum=1234abcd..."

示例3：设置超时与强制下载
ansible host -m get_url -a "url=https://slow.example.com/bigfile.tar.gz dest=/data/ timeout=60 force=yes"</code></pre>
    <h2>
     5
     <strong>
      setup模块
     </strong>
    </h2>
    <blockquote>
     <div style="text-align:left">
      <strong>
       功能特性：
      </strong>
      用于收集远程主机信息的核心模块，它能够获取主机的各种信息，如操作系统、网络配置、硬件信息等。这些信息通常被称为 "facts"，在playbooks中可以通过gather_facts参数来控制是否收集这些信息。
     </div>
     <div style="text-align:left">
      <strong>
       关键参数：
      </strong>
     </div>
     <div>
      <ul style="margin-left:0; margin-right:0">
       <li style="text-align:left">
        filter：过滤输出的Facts，支持通配符*
       </li>
       <li style="text-align:left">
        fact_path：自定义Facts脚本路径（Ansible会执行该路径下的脚本并加载返回值）
       </li>
       <li style="text-align:left">
        gather_subset：选择收集的子集（如all,min,hardware,network）
       </li>
      </ul>
     </div>
    </blockquote>
    <pre><code>示例1：收集所有Facts
ansible web -m setup

示例2：过滤特定信息
ansible db -m setup -a "filter=ansible_memory*"

示例3：仅收集网络信息
ansible all -m setup -a "gather_subset=network"</code></pre>
    <p>
     <strong>
      常用Facts变量示例：
     </strong>
    </p>
    <table>
     <tbody>
      <tr>
       <td>
        <p>
         变量名
        </p>
       </td>
       <td>
        <p>
         说明
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p>
         ansible_os_family
        </p>
       </td>
       <td>
        <p>
         操作系统家族
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p>
         ansible_distribution
        </p>
       </td>
       <td>
        <p>
         具体发行版名称
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p>
         ansible_architecture
        </p>
       </td>
       <td>
        <p>
         CPU 架构
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p>
         ansible_memtotal_mb
        </p>
       </td>
       <td>
        <p>
         总内存（MB）
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p>
         ansible_eth0.ipv4.address
        </p>
       </td>
       <td>
        <p>
         主网络接口的 IPv4 地址
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p>
         ansible_processor_cores
        </p>
       </td>
       <td>
        <p>
         CPU 核心数
        </p>
       </td>
      </tr>
     </tbody>
    </table>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34333731353131312f:61727469636c652f64657461696c732f313436323133363134" class_="artid" style="display:none">
 </p>
</div>


