---
layout: post
title: "Cmake-Android音视频ffmpeg3.4音频重采样"
date: 2024-08-04 00:19:33 +0800
description: "[Cmake-Android]音视频总结：\t[Cmake-Android音视频]SDK，NDK基本介"
keywords: "[Cmake-Android音视频]ffmpeg3.4音频重采样"
categories: ['Android']
tags: ['音频重采样', 'Ffmpeg', 'Android']
artid: "92795081"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=92795081
    alt: "Cmake-Android音视频ffmpeg3.4音频重采样"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=92795081
featuredImagePreview: https://bing.ee123.net/img/rand?artid=92795081
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [Cmake-Android音视频]ffmpeg3.4音频重采样
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4>
     [Cmake-Android]音视频总结：
    </h4>
    <ul>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/90315151">
        [Cmake-Android音视频]SDK，NDK基本介绍
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/90384620">
        [Cmake-Android音视频]NDK-r14b编译ffmpeg3.4支持neon,硬解码
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/90477243">
        [Cmake-Android音视频]创建支持ffmpeg3.4的项目
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/90708620">
        [Cmake-Android音视频]ffmpeg3.4实现解封装
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/91348324">
        [Cmake-Android音视频]ffmpeg3.4软硬解码和多线程解码
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/91997478">
        [Cmake-Android音视频]ffmpeg3.4视频格式转换和显示
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/92795081">
        [Cmake-Android音视频]ffmpeg3.4音频重采样
       </a>
      </h4>
     </li>
     <li>
      <h4>
       <a href="https://blog.csdn.net/adolph_lu/article/details/93349809">
        [Cmake-Android音视频]OpenSLES音频播放
       </a>
      </h4>
     </li>
    </ul>
    <h4>
    </h4>
    <h4>
     音频重采样流程图
    </h4>
    <p style="text-align:center;">
     <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/95581adc0b41099ac1c3166de1a190fe.png"/>
    </p>
    <h4>
     函数介绍
    </h4>
    <p>
     <strong>
      swr_alloc()
     </strong>
    </p>
    <p>
     分配音频重采样的上下文
    </p>
    <p>
    </p>
    <p>
     <strong>
      swr_alloc_set_opts(...)
     </strong>
    </p>
    <p>
     设置音频重采样参数，可以通过音频的样本率来改变播放速度，但声音一般会失真
    </p>
    <pre class="has"><code class="language-cpp">struct SwrContext *swr_alloc_set_opts(struct SwrContext *s,
                                    int64_t out_ch_layout, 
                                    enum AVSampleFormat out_sample_fmt, 
                                    int out_sample_rate,
                                    int64_t  in_ch_layout, 
                                    enum AVSampleFormat  in_sample_fmt, 
                                    int  in_sample_rate,
                                    int log_offset, void *log_ctx);</code></pre>
    <p>
     参数说明：
    </p>
    <ul>
     <li>
      参数1：音频重采样上下文
     </li>
     <li>
      参数2：输出的layout, 如：5.1声道…
     </li>
     <li>
      参数3：输出的样本格式。Float, S16, S24，一般选用是s16  绝大部分声卡支持
     </li>
     <li>
      参数4：输出的样本率。可以不变。
     </li>
     <li>
      参数5：输入的layout。
     </li>
     <li>
      参数6：输入的样本格式。
     </li>
     <li>
      参数7：输入的样本率。
     </li>
     <li>
      参数8，参数9，日志，不用管，可直接传0
     </li>
    </ul>
    <p>
    </p>
    <p>
     <strong>
      swr_init(struct SwrContext *s)
     </strong>
    </p>
    <p>
     初始化音频重采样上下文
    </p>
    <p>
    </p>
    <p>
     <strong>
      swr_convert(...)
     </strong>
    </p>
    <p>
     对音频帧进行重采样
    </p>
    <pre class="has"><code class="language-cpp">int swr_convert(struct SwrContext *s, uint8_t **out, int out_count,
                                const uint8_t **in , int in_count);</code></pre>
    <p>
     参数说明：
    </p>
    <ul>
     <li>
      参数1：音频重采样的上下文
     </li>
     <li>
      参数2：输出的指针。传递的输出的数组
     </li>
     <li>
      参数3：输出的样本数量，不是字节数。单通道的样本数量。
     </li>
     <li>
      参数4：输入的数组，AVFrame解码出来的DATA
     </li>
     <li>
      参数5：输入的单通道的样本数量。
     </li>
    </ul>
    <p>
    </p>
    <p>
     <strong>
      swr_free(struct SwrContext **s)
     </strong>
    </p>
    <p>
     释放音频重采样上下文空间
    </p>
    <p>
    </p>
    <h4>
     关键代码参考
    </h4>
    <pre class="has"><code class="language-cpp">//音频重采样上下文初始化
SwrContext *swrContext = swr_alloc();
char *pcm = new char[480000*4*2];
swrContext = swr_alloc_set_opts(swrContext,
                                av_get_default_channel_layout(2),
                                AV_SAMPLE_FMT_S16,
                                ac-&gt;sample_rate,
                                av_get_default_channel_layout(ac-&gt;channels),
                                ac-&gt;sample_fmt,
                                ac-&gt;sample_rate,
                                0, 0);
re = swr_init(swrContext);
if (re != 0)
{
    LOGI("swr_init failed");
} else
{
    LOGI("swr_init success");
}</code></pre>
    <pre class="has"><code>uint8_t *out[2] = {0};
out[0] = (uint8_t *)pcm;

//转换音频帧
int len = swr_convert(swrContext, out, frame-&gt;nb_samples,
                      (const uint8_t **)frame-&gt;data, frame-&gt;nb_samples);</code></pre>
    <p>
    </p>
    <p>
     <strong>
      <span style="color:#f33b45;">
       注意：
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#f33b45;">
       音频重采样的相关函数包含在 libswresample.so 库中
      </span>
     </strong>
    </p>
    <p>
     <strong>
      <span style="color:#f33b45;">
       同时在代码中包含头文件 #include &lt;libswresample/swresample.h&gt;
      </span>
     </strong>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f61646f6c70685f6c75:2f61727469636c652f64657461696c732f3932373935303831" class_="artid" style="display:none">
 </p>
</div>


