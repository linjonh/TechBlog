---
layout: post
title: "Redis系列深入理解缓存穿透缓存击穿缓存雪崩及其解决方案"
date: 2025-03-16 13:25:55 +0800
description: "缓存穿透是指客户端请求的数据根本不存在，即缓存中没有，数据库中也没有。这时每次请求都会直接穿过缓存访问数据库，由于数据不存在，数据库始终返回空，导致缓存失效，数据库可能承受巨大压力，甚至影响系统稳定性。缓存击穿是指某个高热数据刚好过期失效的瞬间，有大量请求同时访问该数据，导致缓存未命中，请求直接进入数据库，引发数据库压力瞬间剧增的情况。缓存雪崩是指缓存中大量数据在同一时间集中失效（过期），导致大量请求瞬间进入数据库，造成数据库压力过大，甚至导致数据库宕机的情况。"
keywords: "Redis系列：深入理解缓存穿透、缓存击穿、缓存雪崩及其解决方案"
categories: ['Redis']
tags: ['缓存', '数据库', 'Redis']
artid: "146294179"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146294179
    alt: "Redis系列深入理解缓存穿透缓存击穿缓存雪崩及其解决方案"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146294179
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146294179
cover: https://bing.ee123.net/img/rand?artid=146294179
image: https://bing.ee123.net/img/rand?artid=146294179
img: https://bing.ee123.net/img/rand?artid=146294179
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redis系列：深入理解缓存穿透、缓存击穿、缓存雪崩及其解决方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     在使用Redis作为缓存系统时，我们经常会遇到“缓存穿透”、“缓存击穿”和“缓存雪崩”等问题，这些问题一旦出现，会严重影响应用性能甚至造成服务不可用。因此，理解这些问题的产生原因和解决方案非常重要。
    </p>
    <p>
     本文将全面讲解缓存穿透、缓存击穿、缓存雪崩的具体概念、产生原因、以及对应的解决策略，帮助开发人员高效、安全地使用Redis。
    </p>
    <hr/>
    <h3>
     一、缓存穿透（Cache Penetration）
    </h3>
    <h4>
     （一）什么是缓存穿透？
    </h4>
    <p>
     缓存穿透是指客户端请求的数据
     <strong>
      根本不存在
     </strong>
     ，即缓存中没有，数据库中也没有。这时每次请求都会直接穿过缓存访问数据库，由于数据不存在，数据库始终返回空，导致缓存失效，数据库可能承受巨大压力，甚至影响系统稳定性。
    </p>
    <h4>
     （二）缓存穿透为何发生？
    </h4>
    <ul>
     <li>
      用户频繁请求不存在的数据（如攻击者故意访问不存在的用户ID）。
     </li>
     <li>
      缓存无法存储空值，导致所有请求都落到数据库上，造成数据库压力过大。
     </li>
    </ul>
    <h4>
     （三）解决缓存穿透的方案：
    </h4>
    <h5>
     1.
     <strong>
      缓存空值
     </strong>
    </h5>
    <ul>
     <li>
      对于数据库中不存在的数据，Redis也缓存一个空值（如空字符串或特殊标识）。
     </li>
     <li>
      设置一个较短的过期时间，防止大量恶意请求对数据库造成压力。
     </li>
    </ul>
    <h5>
     2.
     <strong>
      布隆过滤器（Bloom Filter）
     </strong>
    </h5>
    <ul>
     <li>
      使用布隆过滤器，提前过滤不存在的数据请求。只有可能存在的数据才会去查询数据库。
     </li>
     <li>
      有效避免大量无效请求直接穿透到数据库。
     </li>
    </ul>
    <h5>
     3.
     <strong>
      接口层参数校验
     </strong>
    </h5>
    <ul>
     <li>
      在接口或业务层加强参数的合法性验证，非法或明显异常的数据直接返回，避免进入缓存或数据库。
     </li>
    </ul>
    <h4>
     （四）缓存穿透的优质实践：
    </h4>
    <ul>
     <li>
      优先使用
      <strong>
       缓存空值
      </strong>
      的方案，简单有效，适合绝大多数场景。
     </li>
     <li>
      与
      <strong>
       接口层校验
      </strong>
      配合使用效果更佳。
     </li>
    </ul>
    <hr/>
    <h3>
     二、缓存击穿（Cache Breakdown）
    </h3>
    <h4>
     （一）什么是缓存击穿？
    </h4>
    <p>
     缓存击穿是指某个高热数据
     <strong>
      刚好过期失效
     </strong>
     的瞬间，有大量请求同时访问该数据，导致缓存未命中，请求直接进入数据库，引发数据库压力瞬间剧增的情况。
    </p>
    <h4>
     （二）解决缓存击穿的方案：
    </h4>
    <h5>
     1.
     <strong>
      热点数据不过期
     </strong>
    </h5>
    <ul>
     <li>
      对于高频访问的热点数据，设置为不过期，或使用逻辑过期策略，异步更新。
     </li>
    </ul>
    <h5>
     2.
     <strong>
      使用互斥锁（Mutex锁）
     </strong>
    </h5>
    <ul>
     <li>
      当缓存未命中时，使用互斥锁机制，仅允许一个线程从数据库加载数据并更新缓存，避免多个请求同时查询数据库。
     </li>
     <li>
      其他请求暂时等待，等待缓存更新后再去访问缓存。
     </li>
    </ul>
    <h5>
     3.
     <strong>
      分布式锁控制
     </strong>
    </h5>
    <ul>
     <li>
      使用Redis分布式锁或本地锁保证只有一个请求能访问数据库，其余请求稍后重试或等待锁释放。
     </li>
    </ul>
    <h4>
     （三）缓存击穿优质实践：
    </h4>
    <ul>
     <li>
      热点数据设置为
      <strong>
       不过期
      </strong>
      或使用
      <strong>
       分布式锁
      </strong>
      控制，保护数据库不被瞬间流量冲垮。
     </li>
    </ul>
    <hr/>
    <h3>
     二、缓存雪崩（Cache Avalanche）
    </h3>
    <h4>
     （一）什么是缓存雪崩？
    </h4>
    <p>
     缓存雪崩是指缓存中大量数据在同一时间集中失效（过期），导致大量请求瞬间进入数据库，造成数据库压力过大，甚至导致数据库宕机的情况。
    </p>
    <h4>
     （二）缓存雪崩的常见原因：
    </h4>
    <ul>
     <li>
      大量缓存数据设置了相同或相近的过期时间。
     </li>
     <li>
      缓存服务突然宕机，导致全部缓存瞬间失效。
     </li>
    </ul>
    <h4>
     （三）解决缓存雪崩的方案：
    </h4>
    <h5>
     1.
     <strong>
      随机过期时间
     </strong>
    </h5>
    <ul>
     <li>
      设置缓存数据的过期时间时，加一个随机数，让缓存失效时间错开，避免同一时间失效。
     </li>
    </ul>
    <h5>
     2.
     <strong>
      分级缓存
     </strong>
    </h5>
    <ul>
     <li>
      使用多级缓存机制，例如内存缓存（如Guava、Caffeine）+ Redis缓存，分散压力。
     </li>
    </ul>
    <h5>
     3.
     <strong>
      缓存预热
     </strong>
    </h5>
    <ul>
     <li>
      在系统启动或高峰前，提前加载热点数据到缓存，避免高峰期间缓存同时失效。
     </li>
    </ul>
    <h5>
     4.
     <strong>
      限流与熔断机制
     </strong>
    </h5>
    <ul>
     <li>
      如果缓存大量失效，限流机制可防止数据库瞬间负载过高，避免整体宕机。
     </li>
    </ul>
    <h4>
     （四）缓存雪崩的优质实践：
    </h4>
    <ul>
     <li>
      最推荐的是
      <strong>
       随机化过期时间
      </strong>
      与
      <strong>
       缓存预热
      </strong>
      的组合方案，这能有效分散缓存失效的时间点，降低数据库瞬间压力。
     </li>
    </ul>
    <h3>
     四、Redis的设计为什么要注意这些问题？
    </h3>
    <p>
     Redis本身是为了提升性能而存在，但使用不当时可能会引发上面这些严重的问题。因此，深入理解并避免缓存穿透、击穿和雪崩是Redis缓存设计中的重要考虑因素。
    </p>
    <p>
     Redis做出上述设计的目的是：
    </p>
    <ul>
     <li>
      <strong>
       提高系统稳定性
      </strong>
      ：避免瞬间请求量暴增引起的数据库宕机问题。
     </li>
     <li>
      <strong>
       提升用户体验
      </strong>
      ：通过缓存降低响应时间，避免数据库查询性能瓶颈。
     </li>
     <li>
      <strong>
       增强服务可用性
      </strong>
      ：避免由于缓存失效或攻击造成服务不可用的情况。
     </li>
    </ul>
    <hr/>
    <h3>
     五、Redis缓存使用最佳实践建议：
    </h3>
    <ul>
     <li>
      对于数据库不存在的数据，应设置短暂缓存，防止缓存穿透。
     </li>
     <li>
      对于热点数据，应尽量延长缓存过期时间或设置为永不过期，避免击穿。
     </li>
     <li>
      缓存的失效时间要
      <strong>
       随机化
      </strong>
      ，不要设置统一的过期时间，防止缓存雪崩。
     </li>
     <li>
      利用多级缓存或本地缓存，减少对Redis和数据库的直接压力。
     </li>
     <li>
      对重要数据提前做好
      <strong>
       缓存预热
      </strong>
      ，保证缓存命中率。
     </li>
    </ul>
    <hr/>
    <h3>
     六、总结
    </h3>
    <p>
     缓存技术虽然简单易用，但使用不当同样会造成性能问题。缓存穿透、缓存击穿和缓存雪崩就是常见的性能问题，通过恰当的缓存设计和管理方案，如
     <strong>
      空值缓存
     </strong>
     、
     <strong>
      热点数据不过期
     </strong>
     、
     <strong>
      随机化过期时间
     </strong>
     、
     <strong>
      缓存预热
     </strong>
     等策略，能够有效地避免和缓解这些问题。
    </p>
    <p>
     在实际开发中，只有深入理解了缓存问题产生的原因和相应的解决方案，我们才能更好地利用Redis的性能优势，构建高效、稳定、可靠的Web应用。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35313632363231362f:61727469636c652f64657461696c732f313436323934313739" class_="artid" style="display:none">
 </p>
</div>


