---
layout: post
title: "前端大屏展示可视化-地图的绘制天地图"
date: 2025-03-11 17:12:54 +0800
description: "大屏可视化、天地图、背景色、飞地、多边形联动、信息窗口"
keywords: "前端大屏展示可视化-地图的绘制（天地图）"
categories: ['大屏展示可视化', '地图']
tags: ['天地图', '大屏', '前端', '信息可视化', 'Vue', 'Javascript']
artid: "146182213"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146182213
    alt: "前端大屏展示可视化-地图的绘制天地图"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146182213
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146182213
cover: https://bing.ee123.net/img/rand?artid=146182213
image: https://bing.ee123.net/img/rand?artid=146182213
img: https://bing.ee123.net/img/rand?artid=146182213
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端大屏展示可视化-地图的绘制（天地图）
    </h1>
   </div>
   <div class="article-resource-info-box">
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ded22df47da74cd38b778ea3b7b207a4.png"/>
    </p>
    <h3>
     <a id="1_2">
     </a>
     1、引入
    </h3>
    <p>
     <a href="http://lbs.tianditu.gov.cn/api/js4.0/guide.html" rel="nofollow">
      官方文档
     </a>
     <br/>
     天地图采用CDN方式引入，在引入之后可以直接使用（需要申请密钥，使用大写的T作为命名空间）
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"http://api.tianditu.gov.cn/api?v=4.0&amp;tk=您的密钥"</span> type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre>
    <h3>
     <a id="2_9">
     </a>
     2、使用
    </h3>
    <h4>
     <a id="21_10">
     </a>
     2.1、初始化
    </h4>
    <p>
     注意天地图使用的是CGCS2000坐标系，与其他地图混用时主要要进行转换
    </p>
    <blockquote>
     <p>
      首先要准备一个定宽定高的容器
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"chartMap"</span> style<span class="token operator">=</span><span class="token string">"height: 100%;width: 100%;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre>
    <blockquote>
     <p>
      获取节点并初始化
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token comment">// 地图实例</span>
<span class="token keyword">let</span> TDMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> TDMapMarkers <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> TDMapMarker <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> TDMapInfoWindow <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> TDMapOverLay <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 多边形多环关联表</span>
<span class="token keyword">const</span> ManyTDMapOverLay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 初始化地图对象</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>TDMap<span class="token punctuation">)</span> TDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">"chartMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <blockquote>
     <p>
      设置中心点以及缩放级
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token comment">// 设置显示地图的中心点和级别</span>
TDMap<span class="token punctuation">.</span><span class="token function">centerAndZoom</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>lng<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="3_33">
     </a>
     3、销毁天地图
    </h3>
    <p>
     <a href="https://blog.csdn.net/weixin_46115723/article/details/136300059">
      参考
     </a>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 销毁天地图</span>
<span class="token keyword">const</span> <span class="token function-variable function">destructionTMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>TMap<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    TMap<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 直接将节点给删掉</span>
    <span class="token keyword">const</span> parentEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mainMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cahildrenEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'chartMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>cahildrenEl<span class="token punctuation">)</span> parentEl<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>cahildrenEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 然后再手动将节点加进来</span>
    <span class="token keyword">const</span> newCahildrenEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newCahildrenEl<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'chartMap'</span>
    newCahildrenEl<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">'height: 100%;width: 100%;'</span>
    parentEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCahildrenEl<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="4_53">
     </a>
     4、加入类
    </h3>
    <p>
     <a href="http://lbs.tianditu.gov.cn/api/js4.0/class.html" rel="nofollow">
      官方API文档
     </a>
    </p>
    <blockquote>
     <p>
      geoJSON数据可通过接口获取，或自行
      <a href="https://datav.aliyun.com/portal/school/atlas/area_selector#&amp;lat=31.769817845138945&amp;lng=104.29901249999999&amp;zoom=4" rel="nofollow">
       下载
      </a>
      保存到本地，自行引入，建议通过接口获取
     </p>
    </blockquote>
    <h4>
     <a id="41_56">
     </a>
     4.1、加入多边形
    </h4>
    <blockquote>
     <p>
      参数一为多边形经纬度，参数二为配置项
      <br/>
      new T.Polygon(points, {
      <!-- -->
      <br/>
      color: “blue”, weight: 3, opacity: 1, fillColor: “#FFFFFF”, fillOpacity: 0.3, lineStyle: ‘dashed’
      <br/>
      })
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> onMounted<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> onBeforeUnmount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
  <span class="token comment">// 经纬度转换</span>
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> transformGCJ2WGS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/function/lib/transformGCJ2WGS.js"</span><span class="token punctuation">;</span>
  <span class="token comment">// 生成uuid</span>
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> uuid <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/function/lib"</span>

  <span class="token function">defineOptions</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> geoJSON <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> emits <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'TMapClick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isIncludeSub <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'isIncludeSub'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mapParams <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'mapParams'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 地图实例</span>
  <span class="token keyword">let</span> TDMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> TDMapOverLay <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 多边形多环关联表</span>
  <span class="token keyword">const</span> ManyTDMapOverLay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadGoJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    geoJSON <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">loadTMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 加载天地图</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadTMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>TDMap<span class="token punctuation">)</span> <span class="token function">destructionTMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 中心点，转换坐标</span>
    <span class="token keyword">const</span> centerData <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>geoJSON<span class="token punctuation">.</span>features<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">27.9937307619152</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span>geoJSON<span class="token punctuation">.</span>features<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">120.69941136528779</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lat <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>centerData<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lng <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>centerData<span class="token punctuation">.</span>lon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化地图对象</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>TDMap<span class="token punctuation">)</span> TDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">"chartMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> center <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>lng<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置显示地图的中心点和级别</span>
    TDMap<span class="token punctuation">.</span><span class="token function">centerAndZoom</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个用于渲染地图事件的方法</span>
    <span class="token keyword">let</span> <span class="token function-variable function">drawMapFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">points<span class="token punctuation">,</span> adcode<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建面对象</span>
        TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">fillColor</span><span class="token operator">:</span> <span class="token string">"#FFFFFF"</span><span class="token punctuation">,</span> <span class="token literal-property property">fillOpacity</span><span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token literal-property property">lineStyle</span><span class="token operator">:</span> <span class="token string">'dashed'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 监听面对象移入事件，加入背景色</span>
        TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseover"</span><span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillColor</span><span class="token punctuation">(</span><span class="token string">'rgb(13, 202, 230)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillOpacity</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token comment">// event.target.setFillColor('rgb(13, 202, 230)');</span>
          <span class="token comment">// event.target.setFillOpacity(0.6);</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 监听面对象移出事件，淡化背景色</span>
        TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseout"</span><span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillColor</span><span class="token punctuation">(</span><span class="token string">'#FFFFFF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillOpacity</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 向地图上添加叠加物</span>
        TDMap<span class="token punctuation">.</span><span class="token function">addOverLay</span><span class="token punctuation">(</span>TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 循环遍历geoJson解析子区域</span>
    geoJSON<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">geoItem</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 分析coordinates数据若多个数组则表示有多个环，需要创建多个面对象并关联起来</span>
      <span class="token keyword">let</span> coordinates <span class="token operator">=</span> geoItem<span class="token punctuation">.</span>geometry<span class="token operator">?.</span>coordinates <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> adcode <span class="token punctuation">}</span> <span class="token operator">=</span> geoItem<span class="token punctuation">.</span>properties<span class="token punctuation">;</span>
      ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>adcode<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 多环数据需要将多个面对象关联起来（通过code进行关联）</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>geoItem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'MultiPolygon'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        coordinates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 多边形经纬度转换</span>
          <span class="token keyword">const</span> points <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> latLng <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span>ele<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ele<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>latLng<span class="token punctuation">.</span>lon<span class="token punctuation">,</span> latLng<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">drawMapFn</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> adcode<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 单环数据直接创建面对象</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>geoItem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'Polygon'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 多边形经纬度转换</span>
        <span class="token keyword">const</span> points <span class="token operator">=</span> coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> latLng <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>latLng<span class="token punctuation">.</span>lon<span class="token punctuation">,</span> latLng<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">drawMapFn</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> adcode<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    drawMapFn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 销毁天地图</span>
  <span class="token keyword">const</span> <span class="token function-variable function">destructionTMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">addChildren <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>TDMap<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      TDMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token comment">// 直接将节点给删掉</span>
      <span class="token keyword">const</span> parentEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mainMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> cahildrenEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'chartMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>cahildrenEl<span class="token punctuation">)</span> parentEl<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>cahildrenEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>addChildren<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token comment">// 然后再手动将节点加进来</span>
      <span class="token keyword">const</span> newCahildrenEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newCahildrenEl<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'chartMap'</span>
      newCahildrenEl<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">'height: 100%;width: 100%;'</span>
      parentEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCahildrenEl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">loadGoJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">destructionTMap</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 子组件暴露</span>
  <span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"mainMap"</span> style<span class="token operator">=</span><span class="token string">"height: 100%;width: 100%;"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"chartMap"</span> style<span class="token operator">=</span><span class="token string">"height: 100%;width: 100%;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"less"</span> scoped<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre>
    <h4>
     <a id="42_205">
     </a>
     4.2、加入信息窗口
    </h4>
    <blockquote>
     <p>
      先使用 const TDMapInfoWindow = new T.InfoWindow(); 构建信息窗实例
      <br/>
      而后 TDMapInfoWindow.setLngLat(infoWinCenterLatLng); 确定位置
      <br/>
      而后 TDMapInfoWindow.setContent(‘html节点’); 加载窗口
      <br/>
      最后TDMap.addOverLay(TDMapInfoWindow);加载到天地图上
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> onMounted<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> onBeforeUnmount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> transformGCJ2WGS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/function/lib/transformGCJ2WGS.js"</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> uuid <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/function/lib"</span>

  <span class="token function">defineOptions</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> geoJSON <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> emits <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'TMapClick'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isIncludeSub <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'isIncludeSub'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mapParams <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'mapParams'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 地图实例</span>
  <span class="token keyword">let</span> TDMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> TDMapInfoWindow <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> TDMapOverLay <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 多边形多环关联表</span>
  <span class="token keyword">const</span> ManyTDMapOverLay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadGoJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    geoJSON <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">loadTMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 加载天地图</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadTMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>TDMap<span class="token punctuation">)</span> <span class="token function">destructionTMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 中心点，转换坐标</span>
    <span class="token keyword">const</span> centerData <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>geoJSON<span class="token punctuation">.</span>features<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">27.9937307619152</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Number</span><span class="token punctuation">(</span>geoJSON<span class="token punctuation">.</span>features<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">120.69941136528779</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lat <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>centerData<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lng <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>centerData<span class="token punctuation">.</span>lon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化地图对象</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>TDMap<span class="token punctuation">)</span> TDMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">"chartMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> center <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>lng<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置显示地图的中心点和级别</span>
    TDMap<span class="token punctuation">.</span><span class="token function">centerAndZoom</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> mapParams<span class="token punctuation">.</span>areaCode <span class="token operator">===</span> <span class="token string">'100000'</span> <span class="token operator">?</span> <span class="token number">5</span> <span class="token operator">:</span> <span class="token punctuation">(</span>isIncludeSub<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token number">9</span> <span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建一个用于渲染地图事件的方法</span>
    <span class="token keyword">let</span> <span class="token function-variable function">drawMapFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">geoItem<span class="token punctuation">,</span> points<span class="token punctuation">,</span> name<span class="token punctuation">,</span> adcode<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建面对象</span>
        TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">fillColor</span><span class="token operator">:</span> <span class="token string">"#FFFFFF"</span><span class="token punctuation">,</span> <span class="token literal-property property">fillOpacity</span><span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token literal-property property">lineStyle</span><span class="token operator">:</span> <span class="token string">'dashed'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 监听面对象移入事件，加入背景色以及信息窗口</span>
        TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseover"</span><span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillColor</span><span class="token punctuation">(</span><span class="token string">'rgb(13, 202, 230)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillOpacity</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">getTopmostVertex</span><span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'内蒙古自治区'</span> <span class="token operator">?</span> geoItem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> geoItem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> targetLatLng <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 信息窗口</span>
          <span class="token keyword">const</span> infoWinCenterLatLng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>targetLatLng<span class="token punctuation">.</span>lon<span class="token punctuation">,</span> targetLatLng<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
          TDMapInfoWindow<span class="token punctuation">[</span>adcode<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>InfoWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          TDMapInfoWindow<span class="token punctuation">[</span>adcode<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setLngLat</span><span class="token punctuation">(</span>infoWinCenterLatLng<span class="token punctuation">)</span><span class="token punctuation">;</span>
          TDMapInfoWindow<span class="token punctuation">[</span>adcode<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>
            <span class="token string">'&lt;div style="color: #000;text-align: left;font-size: 18px;line-height: 10px;"&gt;'</span>
            <span class="token operator">+</span> <span class="token string">'&lt;p style="font-weight: bold;line-height: 10px;"&gt;'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'&lt;/p&gt;'</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          TDMap<span class="token punctuation">.</span><span class="token function">addOverLay</span><span class="token punctuation">(</span>TDMapInfoWindow<span class="token punctuation">[</span>adcode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 监听面对象移出事件，淡化背景色以及关闭信息窗口</span>
        TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseout"</span><span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillColor</span><span class="token punctuation">(</span><span class="token string">'#FFFFFF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            TDMapOverLay<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFillOpacity</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          TDMapInfoWindow<span class="token punctuation">[</span>adcode<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">closeInfoWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 向地图上添加叠加物</span>
        TDMap<span class="token punctuation">.</span><span class="token function">addOverLay</span><span class="token punctuation">(</span>TDMapOverLay<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 循环遍历geoJson解析子区域</span>
    geoJSON<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">geoItem</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 分析coordinates数据若多个数组则表示有多个环，需要创建多个面对象并关联起来</span>
      <span class="token keyword">let</span> coordinates <span class="token operator">=</span> geoItem<span class="token punctuation">.</span>geometry<span class="token operator">?.</span>coordinates <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>name<span class="token punctuation">,</span> adcode<span class="token punctuation">}</span> <span class="token operator">=</span> geoItem<span class="token punctuation">.</span>properties<span class="token punctuation">;</span>
      ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>adcode<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 多环数据需要将多个面对象关联起来（通过code进行关联）</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>geoItem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'MultiPolygon'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        coordinates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 多边形经纬度转换</span>
          <span class="token keyword">const</span> points <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> latLng <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span>ele<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ele<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>latLng<span class="token punctuation">.</span>lon<span class="token punctuation">,</span> latLng<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">drawMapFn</span><span class="token punctuation">(</span>geoItem<span class="token punctuation">,</span> points<span class="token punctuation">,</span> name<span class="token punctuation">,</span> adcode<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 单环数据直接创建面对象</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>geoItem<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'Polygon'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ManyTDMapOverLay<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>adcode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 多边形经纬度转换</span>
        <span class="token keyword">const</span> points <span class="token operator">=</span> coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> latLng <span class="token operator">=</span> <span class="token function">transformGCJ2WGS</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">T<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span>latLng<span class="token punctuation">.</span>lon<span class="token punctuation">,</span> latLng<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">drawMapFn</span><span class="token punctuation">(</span>geoItem<span class="token punctuation">,</span> points<span class="token punctuation">,</span> name<span class="token punctuation">,</span> adcode<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    drawMapFn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 计算顶点坐标</span>
  <span class="token keyword">function</span> <span class="token function">getTopmostVertex</span><span class="token punctuation">(</span><span class="token parameter">coordinates</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> topmostVertex <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> maxLatitude <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">Infinity</span><span class="token punctuation">;</span> <span class="token comment">// 初始化最大纬度为负无穷大</span>
    <span class="token comment">// 遍历坐标数组来找到最大纬度值</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> vertex <span class="token keyword">of</span> coordinates<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> latitude <span class="token operator">=</span> vertex<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 纬度是坐标数组的第二个元素</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>latitude <span class="token operator">&gt;</span> maxLatitude<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        maxLatitude <span class="token operator">=</span> latitude<span class="token punctuation">;</span>
        topmostVertex <span class="token operator">=</span> vertex<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> topmostVertex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 销毁天地图</span>
  <span class="token keyword">const</span> <span class="token function-variable function">destructionTMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">addChildren <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>TDMap<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      TDMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token comment">// 直接将节点给删掉</span>
      <span class="token keyword">const</span> parentEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mainMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> cahildrenEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'chartMap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>cahildrenEl<span class="token punctuation">)</span> parentEl<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>cahildrenEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>addChildren<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token comment">// 然后再手动将节点加进来</span>
      <span class="token keyword">const</span> newCahildrenEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      newCahildrenEl<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'chartMap'</span>
      newCahildrenEl<span class="token punctuation">.</span>style <span class="token operator">=</span> <span class="token string">'height: 100%;width: 100%;'</span>
      parentEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newCahildrenEl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">loadGoJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">destructionTMap</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 子组件暴露</span>
  <span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"mainMap"</span> style<span class="token operator">=</span><span class="token string">"height: 100%;width: 100%;"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"chartMap"</span> style<span class="token operator">=</span><span class="token string">"height: 100%;width: 100%;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style lang<span class="token operator">=</span><span class="token string">"less"</span> scoped<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363131353732332f:61727469636c652f64657461696c732f313436313832323133" class_="artid" style="display:none">
 </p>
</div>


