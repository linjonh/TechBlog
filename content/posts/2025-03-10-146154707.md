---
layout: post
title: "pytest-配置"
date: 2025-03-10 16:38:11 +0800
description: "pytest笔记"
keywords: "[pytest] 配置"
categories: ['Python']
tags: ['Python', 'Pytest']
artid: "146154707"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146154707
    alt: "pytest-配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146154707
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146154707
cover: https://bing.ee123.net/img/rand?artid=146154707
image: https://bing.ee123.net/img/rand?artid=146154707
img: https://bing.ee123.net/img/rand?artid=146154707
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [pytest] 配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Pytest_3">
     </a>
     Pytest
    </h2>
    <h3>
     <a id="Init_5">
     </a>
     Init
    </h3>
    <h3>
     <a id="Run_7">
     </a>
     Run
    </h3>
    <ol>
     <li>
      更改配置
      <code>
       pytest.ini
      </code>
      与项目同级
     </li>
    </ol>
    <pre><code class="prism language-ini"># content of pytest.ini
# Example 1: have pytest look for "check" instead of "test"
[pytest]
;更改目录递归
norecursedirs = .svn _build tmp*

;更改命名约定
python_files = check_*.py
python_classes = Check
python_functions = *_check
;可以通过在模式之间添加空格来检查多个 glob 模式
;python_files = test_*.py example_*.py

;将命令行参数解释
;addopts = --tb=short
;addopts = --pyargs
;export PYTEST_ADDOPTS="-v"
addopts = -vv --html-report=report.html
</code></pre>
    <ol>
     <li>
      引进@pytest.mark.parametrize中ids导致编码乱码
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">pytest_collection_modifyitems</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        item<span class="token punctuation">.</span>name <span class="token operator">=</span> item<span class="token punctuation">.</span>name<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'unicode-escape'</span><span class="token punctuation">)</span>
        item<span class="token punctuation">.</span>_nodeid <span class="token operator">=</span> item<span class="token punctuation">.</span>_nodeid<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'unicode-escape'</span><span class="token punctuation">)</span>
</code></pre>
    <ol start="2">
     <li>
      <p>
       定义自己对失败断言的解释 pytest_assertrepr_compare(config, op, left, right)
      </p>
      <ul>
       <li>
        config (Config) – The pytest config object.
       </li>
       <li>
        op (str) – The operator, e.g. “==”, “!=”, “not in”.
       </li>
       <li>
        left (object) – The left operand.
       </li>
       <li>
        right (object) – The right operand.
       </li>
      </ul>
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>
<span class="token keyword">from</span> test_foocompare <span class="token keyword">import</span> Foo


<span class="token keyword">def</span> <span class="token function">pytest_assertrepr_compare</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> Foo<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>right<span class="token punctuation">,</span> Foo<span class="token punctuation">)</span> <span class="token keyword">and</span> op <span class="token operator">==</span> <span class="token string">"=="</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string">"Comparing Foo instances:"</span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"   vals: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>left<span class="token punctuation">.</span>val<span class="token punctuation">}</span></span><span class="token string"> != </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>right<span class="token punctuation">.</span>val<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
</code></pre>
    <pre><code class="prism language-python">

<span class="token comment"># content of test_foocompare.py</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>val <span class="token operator">=</span> val

    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>val <span class="token operator">==</span> other<span class="token punctuation">.</span>val


<span class="token keyword">def</span> <span class="token function">test_compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f1 <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    f2 <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> f1 <span class="token operator">==</span> f2
</code></pre>
    <p>
     <em>
      output
     </em>
    </p>
    <pre><code class="prism language-bash">$ pytest <span class="token parameter variable">-q</span> test_foocompare.py
F                                                                    <span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> FAILURES <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
_______________________________ test_compare _______________________________

    def test_compare<span class="token punctuation">(</span><span class="token punctuation">)</span>:
        f1 <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        f2 <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>       assert f1 <span class="token operator">==</span> f2
E       assert Comparing Foo instances:
E            vals: <span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">2</span>

test_foocompare.py:12: AssertionError
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> short <span class="token builtin class-name">test</span> summary info <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
FAILED test_foocompare.py::test_compare - assert Comparing Foo instances:
<span class="token number">1</span> failed <span class="token keyword">in</span> <span class="token number">0</span>.12s

</code></pre>
    <h4>
     <a id="3__101">
     </a>
     3. 根据命令行选项将不同的值传递给测试函数
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>
<span class="token keyword">import</span> pytest


<span class="token keyword">def</span> <span class="token function">pytest_addoption</span><span class="token punctuation">(</span>parser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    parser<span class="token punctuation">.</span>addoption<span class="token punctuation">(</span>
        <span class="token string">"--cmdopt"</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">"store"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">"type1"</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"my option: type1 or type2"</span>
    <span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">cmdopt</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> request<span class="token punctuation">.</span>config<span class="token punctuation">.</span>getoption<span class="token punctuation">(</span><span class="token string">"--cmdopt"</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># content of test_sample.py</span>
<span class="token keyword">def</span> <span class="token function">test_answer</span><span class="token punctuation">(</span>cmdopt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> cmdopt <span class="token operator">==</span> <span class="token string">"type1"</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> cmdopt <span class="token operator">==</span> <span class="token string">"type2"</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token number">0</span>  <span class="token comment"># to see what was printed</span>
</code></pre>
    <p>
     <em>
      output
     </em>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># ************</span>
<span class="token comment"># 没有提供参数</span>
<span class="token comment"># ************</span>
$ pytest <span class="token parameter variable">-q</span> test_sample.py 
F                                                                    <span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> FAILURES <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
_______________________________ test_answer ________________________________

cmdopt <span class="token operator">=</span> <span class="token string">'type1'</span>

    def test_answer<span class="token punctuation">(</span>cmdopt<span class="token punctuation">)</span>:
        <span class="token keyword">if</span> cmdopt <span class="token operator">==</span> <span class="token string">"type1"</span><span class="token builtin class-name">:</span>
            print<span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> cmdopt <span class="token operator">==</span> <span class="token string">"type2"</span><span class="token builtin class-name">:</span>
            print<span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>       assert <span class="token number">0</span>  <span class="token comment"># to see what was printed</span>
E       assert <span class="token number">0</span>

test_sample.py:6: AssertionError
--------------------------- Captured stdout call ---------------------------
first
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> short <span class="token builtin class-name">test</span> summary info <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
FAILED test_sample.py::test_answer - assert <span class="token number">0</span>
<span class="token number">1</span> failed <span class="token keyword">in</span> <span class="token number">0</span>.12s

<span class="token comment"># ************</span>
<span class="token comment"># 提供参数</span>
<span class="token comment"># ************</span>
$ pytest <span class="token parameter variable">-q</span> <span class="token parameter variable">--cmdopt</span><span class="token operator">=</span>type2
F                                                                    <span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> FAILURES <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
_______________________________ test_answer ________________________________

cmdopt <span class="token operator">=</span> <span class="token string">'type2'</span>

    def test_answer<span class="token punctuation">(</span>cmdopt<span class="token punctuation">)</span>:
        <span class="token keyword">if</span> cmdopt <span class="token operator">==</span> <span class="token string">"type1"</span><span class="token builtin class-name">:</span>
            print<span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> cmdopt <span class="token operator">==</span> <span class="token string">"type2"</span><span class="token builtin class-name">:</span>
            print<span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>       assert <span class="token number">0</span>  <span class="token comment"># to see what was printed</span>
E       assert <span class="token number">0</span>

test_sample.py:6: AssertionError
--------------------------- Captured stdout call ---------------------------
second
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> short <span class="token builtin class-name">test</span> summary info <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
FAILED test_sample.py::test_answer - assert <span class="token number">0</span>
<span class="token number">1</span> failed <span class="token keyword">in</span> <span class="token number">0</span>.12s
</code></pre>
    <ul>
     <li>
      如果需要更详细信息
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>
<span class="token keyword">import</span> pytest


<span class="token keyword">def</span> <span class="token function">type_checker</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> <span class="token string">"cmdopt must specify a numeric type as typeNNN"</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> value<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> pytest<span class="token punctuation">.</span>UsageError<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token builtin">int</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> pytest<span class="token punctuation">.</span>UsageError<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

    <span class="token keyword">return</span> value


<span class="token keyword">def</span> <span class="token function">pytest_addoption</span><span class="token punctuation">(</span>parser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    parser<span class="token punctuation">.</span>addoption<span class="token punctuation">(</span>
        <span class="token string">"--cmdopt"</span><span class="token punctuation">,</span>
        action<span class="token operator">=</span><span class="token string">"store"</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span><span class="token string">"type1"</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"my option: type1 or type2"</span><span class="token punctuation">,</span>
        <span class="token builtin">type</span><span class="token operator">=</span>type_checker<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>


</code></pre>
    <p>
     <em>
      output
     </em>
    </p>
    <pre><code class="prism language-bash">$ pytest <span class="token parameter variable">-q</span> <span class="token parameter variable">--cmdopt</span><span class="token operator">=</span>type3
ERROR: usage: pytest <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>file_or_dir<span class="token punctuation">]</span> <span class="token punctuation">[</span>file_or_dir<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
pytest: error: argument --cmdopt: invalid choice: <span class="token string">'type3'</span> <span class="token punctuation">(</span>choose from <span class="token string">'type1'</span>, <span class="token string">'type2'</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="Report_222">
     </a>
     Report
    </h3>
    <h4>
     <a id="1__224">
     </a>
     1. 向测试报告标题添加信息
    </h4>
    <p>
     1.1
    </p>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>


<span class="token keyword">def</span> <span class="token function">pytest_report_header</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"project deps: mylib-1.1"</span>

</code></pre>
    <p>
     <em>
      output
     </em>
    </p>
    <pre><code class="prism language-bash">$ pytest
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token builtin class-name">test</span> session starts <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
platform linux -- Python <span class="token number">3</span>.x.y, pytest-8.x.y, pluggy-1.x.y
project deps: mylib-1.1
rootdir: /home/sweet/project
collected <span class="token number">0</span> items

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> no tests ran <span class="token keyword">in</span> <span class="token number">0</span>.12s <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</code></pre>
    <p>
     1.2 返回字符串列表，这些字符串将被视为多行信息
    </p>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>


<span class="token keyword">def</span> <span class="token function">pytest_report_header</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> config<span class="token punctuation">.</span>get_verbosity<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">"info1: did you know that ..."</span><span class="token punctuation">,</span> <span class="token string">"did you?"</span><span class="token punctuation">]</span>

</code></pre>
    <p>
     <em>
      output 仅在使用“-v”运行时才会添加信息
     </em>
    </p>
    <pre><code class="prism language-bash">$ pytest <span class="token parameter variable">-v</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token builtin class-name">test</span> session starts <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
platform linux -- Python <span class="token number">3</span>.x.y, pytest-8.x.y, pluggy-1.x.y -- <span class="token variable">$PYTHON_PREFIX</span>/bin/python
cachedir: .pytest_cache
info1: did you know that <span class="token punctuation">..</span>.
did you?
rootdir: /home/sweet/project
collecting <span class="token punctuation">..</span>. collected <span class="token number">0</span> items

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> no tests ran <span class="token keyword">in</span> <span class="token number">0</span>.12s <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</code></pre>
    <h4>
     <a id="2__pytest_durations3_277">
     </a>
     2. 分析测试持续时间
     <code>
      pytest --durations=3
     </code>
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># content of test_some_are_slow.py</span>
<span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">test_funcfast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_funcslow1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_funcslow2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <em>
      output
     </em>
    </p>
    <pre><code class="prism language-bash">$ pytest <span class="token parameter variable">--durations</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token builtin class-name">test</span> session starts <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
platform linux -- Python <span class="token number">3</span>.x.y, pytest-8.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
collected <span class="token number">3</span> items

test_some_are_slow.py <span class="token punctuation">..</span>.                                            <span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> slowest <span class="token number">3</span> durations <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token number">0</span>.30s call     test_some_are_slow.py::test_funcslow2
<span class="token number">0</span>.20s call     test_some_are_slow.py::test_funcslow1
<span class="token number">0</span>.10s call     test_some_are_slow.py::test_funcfast
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token number">3</span> passed <span class="token keyword">in</span> <span class="token number">0</span>.12s <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</code></pre>
    <h4>
     <a id="3____314">
     </a>
     3. 增量测试 - 测试步骤
    </h4>
    <p>
     如果前置步骤其中一个步骤失败，则后续步骤将预期失败。
    </p>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>

<span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Tuple

<span class="token keyword">import</span> pytest

<span class="token comment"># store history of failures per test class name and per index in parametrize (if parametrize used)</span>
_test_failed_incremental<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Dict<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">pytest_runtest_makereport</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> call<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">"incremental"</span> <span class="token keyword">in</span> item<span class="token punctuation">.</span>keywords<span class="token punctuation">:</span>
        <span class="token comment"># incremental marker is used</span>
        <span class="token keyword">if</span> call<span class="token punctuation">.</span>excinfo <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># the test has failed</span>
            <span class="token comment"># retrieve the class name of the test</span>
            cls_name <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>cls<span class="token punctuation">)</span>
            <span class="token comment"># retrieve the index of the test (if parametrize is used in combination with incremental)</span>
            parametrize_index <span class="token operator">=</span> <span class="token punctuation">(</span>
                <span class="token builtin">tuple</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>callspec<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">"callspec"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token comment"># retrieve the name of the test function</span>
            test_name <span class="token operator">=</span> item<span class="token punctuation">.</span>originalname <span class="token keyword">or</span> item<span class="token punctuation">.</span>name
            <span class="token comment"># store in _test_failed_incremental the original name of the failed test</span>
            _test_failed_incremental<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>cls_name<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>
                parametrize_index<span class="token punctuation">,</span> test_name
            <span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">pytest_runtest_setup</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">"incremental"</span> <span class="token keyword">in</span> item<span class="token punctuation">.</span>keywords<span class="token punctuation">:</span>
        <span class="token comment"># retrieve the class name of the test</span>
        cls_name <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>cls<span class="token punctuation">)</span>
        <span class="token comment"># check if a previous test has failed for this class</span>
        <span class="token keyword">if</span> cls_name <span class="token keyword">in</span> _test_failed_incremental<span class="token punctuation">:</span>
            <span class="token comment"># retrieve the index of the test (if parametrize is used in combination with incremental)</span>
            parametrize_index <span class="token operator">=</span> <span class="token punctuation">(</span>
                <span class="token builtin">tuple</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>callspec<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">"callspec"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token comment"># retrieve the name of the first test function to fail for this class name and index</span>
            test_name <span class="token operator">=</span> _test_failed_incremental<span class="token punctuation">[</span>cls_name<span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>parametrize_index<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            <span class="token comment"># if name found, test has failed for the combination of class name &amp; test name</span>
            <span class="token keyword">if</span> test_name <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                pytest<span class="token punctuation">.</span>xfail<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"previous test failed (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>test_name<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-python"><span class="token comment"># content of test_step.py</span>

<span class="token keyword">import</span> pytest


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>incremental</span>
<span class="token keyword">class</span> <span class="token class-name">TestUserHandling</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_login</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">test_modification</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">test_deletion</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>


<span class="token keyword">def</span> <span class="token function">test_normal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre>
    <p>
     <em>
      output
     </em>
    </p>
    <pre><code class="prism language-bash">$ pytest <span class="token parameter variable">-rx</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token builtin class-name">test</span> session starts <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
platform linux -- Python <span class="token number">3</span>.x.y, pytest-8.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
collected <span class="token number">4</span> items

test_step.py .Fx.                                                    <span class="token punctuation">[</span><span class="token number">100</span>%<span class="token punctuation">]</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> FAILURES <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
____________________ TestUserHandling.test_modification ____________________

self <span class="token operator">=</span> <span class="token operator">&lt;</span>test_step.TestUserHandling object at 0xdeadbeef000<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>

    def test_modification<span class="token punctuation">(</span>self<span class="token punctuation">)</span>:
<span class="token operator">&gt;</span>       assert <span class="token number">0</span>
E       assert <span class="token number">0</span>

test_step.py:11: AssertionError
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> short <span class="token builtin class-name">test</span> summary info <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
XFAIL test_step.py::TestUserHandling::test_deletion - reason: previous <span class="token builtin class-name">test</span> failed <span class="token punctuation">(</span>test_modification<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token number">1</span> failed, <span class="token number">2</span> passed, <span class="token number">1</span> xfailed <span class="token keyword">in</span> <span class="token number">0</span>.12s <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre>
    <h4>
     <a id="junitxmlreportxml_417">
     </a>
     –junitxml={report}.xml
    </h4>
    <blockquote>
     <p>
      <a href="https://docs.pytest.org/en/stable/reference/reference.html" rel="nofollow">
       https://docs.pytest.org/en/stable/reference/reference.html
      </a>
      <br/>
      pytest v6.0+ 默认
      <code>
       xunit2
      </code>
      不支持 testcase添加属性
      <br/>
      建议设置
     </p>
     <ul>
      <li>
       <mark>
        pytest.ini
       </mark>
       中配置
       <code>
        junit_family=xunit1
       </code>
      </li>
      <li>
       <code>
        pytest -o junit_family=xunit1
       </code>
      </li>
     </ul>
    </blockquote>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testsuites</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testsuite</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pytest<span class="token punctuation">"</span></span> <span class="token attr-name">errors</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">failures</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">skipped</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">tests</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.113<span class="token punctuation">"</span></span>
               <span class="token attr-name">timestamp</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2025-03-10T14:53:08.040765+08:00<span class="token punctuation">"</span></span> <span class="token attr-name">hostname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ding-Perlis-MP1Y70F1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_classname<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_name<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_case.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>49<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.006<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_classname<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_name<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_case.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>49<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.001<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testsuite</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testsuites</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="1_testsuite_436">
     </a>
     1. testsuite
    </h5>
    <h6>
     <a id="11__record_testsuite_property_438">
     </a>
     1.1 在测试套件级别添加属性节点 record_testsuite_property
    </h6>
    <blockquote>
     <p>
      支持
      <code>
       xunit2
      </code>
     </p>
    </blockquote>
    <pre><code class="prism language-python"><span class="token keyword">import</span> pytest


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"session"</span><span class="token punctuation">,</span> autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">log_global_env_facts</span><span class="token punctuation">(</span>record_testsuite_property<span class="token punctuation">)</span><span class="token punctuation">:</span>
    record_testsuite_property<span class="token punctuation">(</span><span class="token string">"ARCH"</span><span class="token punctuation">,</span> <span class="token string">"PPC"</span><span class="token punctuation">)</span>
    record_testsuite_property<span class="token punctuation">(</span><span class="token string">"STORAGE_TYPE"</span><span class="token punctuation">,</span> <span class="token string">"CEPH"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">TestMe</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_foo</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> <span class="token boolean">True</span>
</code></pre>
    <p>
     <strong>
      output
     </strong>
    </p>
    <pre><code class="prism language-xml">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testsuite</span> <span class="token attr-name">errors</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">failures</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pytest<span class="token punctuation">"</span></span> <span class="token attr-name">skipped</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">tests</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.006<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ARCH<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PPC<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STORAGE_TYPE<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CEPH<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_me.TestMe<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_me.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_foo<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.000243663787842<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testsuite</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="2_testcase_470">
     </a>
     2. testcase
    </h5>
    <h6>
     <a id="21__record_property_472">
     </a>
     2.1 记录测试的其他信息 record_property
    </h6>
    <p>
     <mark>
      请注意，使用此功能将中断对最新JUnitXML架构的架构验证。当与某些CI服务器一起使用时，这可能是一个问题
     </mark>
    </p>
    <ul>
     <li>
      方法一
      <code>
       test_case.py
      </code>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">test_function</span><span class="token punctuation">(</span>record_property<span class="token punctuation">)</span><span class="token punctuation">:</span>
    record_property<span class="token punctuation">(</span><span class="token string">"example_key"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token boolean">True</span>
</code></pre>
    <ul>
     <li>
      方法二
      <code>
       contest.py
      </code>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># content of conftest.py</span>

<span class="token keyword">def</span> <span class="token function">pytest_collection_modifyitems</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> config<span class="token punctuation">,</span> items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">for</span> marker <span class="token keyword">in</span> item<span class="token punctuation">.</span>iter_markers<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"test_id"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            test_id <span class="token operator">=</span> marker<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            item<span class="token punctuation">.</span>user_properties<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"test_id"</span><span class="token punctuation">,</span> test_id<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># content of test_function.py</span>
<span class="token keyword">import</span> pytest


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>test_id</span><span class="token punctuation">(</span><span class="token number">1501</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> <span class="token boolean">True</span>
</code></pre>
    <p>
     <strong>
      output
     </strong>
    </p>
    <pre><code class="prism language-xml">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>templt</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_function<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_function.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_function<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0009<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example_key<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testcase</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_function<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_function.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_function<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0009<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1501<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testcase</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>templt</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h6>
     <a id="22_testcasexml_record_xml_attribute_523">
     </a>
     2.2 向testcase元素添加额外的xml属性 record_xml_attribute
    </h6>
    <p>
     <mark>
      record_xml_attribute 是一个实验性的特性，它的接口在未来的版本中可能会被更强大和通用的东西所取代。然而，功能本身将保持不变
     </mark>
     <br/>
     <mark>
      请注意，使用此功能将中断对最新JUnitXML架构的架构验证。当与某些CI服务器一起使用时，这可能是一个问题
     </mark>
    </p>
    <ul>
     <li>
      方法一
      <code>
       test_case.py
      </code>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> pytest


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize</span><span class="token punctuation">(</span><span class="token string">"case"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"case1"</span><span class="token punctuation">,</span> <span class="token string">"case2"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test_case</span><span class="token punctuation">(</span><span class="token keyword">case</span><span class="token punctuation">,</span> record_xml_attribute<span class="token punctuation">)</span><span class="token punctuation">:</span>
    record_xml_attribute<span class="token punctuation">(</span><span class="token string">'classname'</span><span class="token punctuation">,</span> <span class="token string">'set_classname'</span><span class="token punctuation">)</span>  <span class="token comment"># 重写 value</span>
    record_xml_attribute<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'set_name'</span><span class="token punctuation">)</span>  <span class="token comment"># 重写 value</span>
    record_xml_attribute<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span>  <span class="token comment"># 新增 key, value</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token boolean">True</span>
</code></pre>
    <ul>
     <li>
      方法二
      <code>
       contest.py
      </code>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># edit to contest.py</span>
<span class="token keyword">import</span> pytest


<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>autouse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">record_index</span><span class="token punctuation">(</span>record_xml_attribute<span class="token punctuation">)</span><span class="token punctuation">:</span>
    record_xml_attribute<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span>  <span class="token comment"># 新增 key, value</span>
</code></pre>
    <ul>
     <li>
      <strong>
       output
      </strong>
     </li>
    </ul>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testsuites</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testsuite</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pytest<span class="token punctuation">"</span></span> <span class="token attr-name">errors</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">failures</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">skipped</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">tests</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.113<span class="token punctuation">"</span></span>
               <span class="token attr-name">timestamp</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2025-03-10T14:53:08.040765+08:00<span class="token punctuation">"</span></span> <span class="token attr-name">hostname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Ding-Perlis-MP1Y70F1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_classname<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_name<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_case.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>49<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.006<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system-out</span><span class="token punctuation">&gt;</span></span>
                hello world
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system-out</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testcase</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testcase</span> <span class="token attr-name">classname</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_classname<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set_name<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test_case.py<span class="token punctuation">"</span></span> <span class="token attr-name">line</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>49<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span> <span class="token attr-name">time</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.001<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testsuite</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testsuites</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="Hooks_572">
     </a>
     Hooks
    </h3>
    <h3>
     <a id="other_plugin__574">
     </a>
     other plugin 好玩好用的
    </h3>
    <ul>
     <li>
      <a href="https://github.com/akavbathen/pytest_html_merger">
       pytest_html_merger
      </a>
      https://github.com/akavbathen/pytest_html_merger
      <br/>
      <code>
       pip install pytest_html_merger
      </code>
      合并pytest_html报告
      <pre><code class="prism language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$HOME</span>/.lcoal/bin:<span class="token environment constant">$PATH</span>"</span>
pytest_html_merger <span class="token parameter variable">-i</span> /path/to/your/html/reports <span class="token parameter variable">-o</span> /path/to/output/report/merged.html
</code></pre>
     </li>
     <li>
      <a href="https://github.com/jeffwright13/pytest-tally">
       pytest-tally
      </a>
      https://github.com/jeffwright13/pytest-tally
      <br/>
      <code>
       pip install pytest-tally
      </code>
      可在控制台、应用程序或浏览器中显示测试运行进度
      <pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> project <span class="token comment"># 与main.py同级</span>
python main.py
pytest xxx

<span class="token comment"># tally</span>
tally-rich
tally-flask
tally-tk
</code></pre>
      <img alt="https://github.com/jeffwright13/pytest-tally" src="https://i-blog.csdnimg.cn/direct/77a2db2349bb4d3799a6e0e1e0f5a6ed.png"/>
     </li>
     <li>
      <a href="https://pypi.org/project/pytest-sugar/" rel="nofollow">
       pytest-sugar
      </a>
      https://pypi.org/project/pytest-sugar/
      <br/>
      <code>
       pip install pytest-sugar
      </code>
      改变 pytest 的默认外观（例如进度条、立即显示失败的测试）
      <br/>
      <img alt="https://pypi.org/project/pytest-sugar/" src="https://i-blog.csdnimg.cn/direct/7398867419d147cc8399ce832b52c733.png"/>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33373439373735382f:61727469636c652f64657461696c732f313436313534373037" class_="artid" style="display:none">
 </p>
</div>


