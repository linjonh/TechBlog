---
layout: post
title: "MyBatis-中SQL-映射文件是如何与-Mapper-接口关联起来的-MyBatis-如何知道应该调用哪个-SQL-语句"
date: 2025-03-12 10:14:49 +0800
description: "SQL 映射文件与 Mapper 接口的关联是 MyBatis 的核心机制之一，它使得我们可以通过调用 Mapper 接口的方法来执行 SQL 语句，而无需直接操作。对象，然后执行 SQL 语句，并进行参数绑定和结果映射。当我们在 Java 代码中调用 Mapper 接口的方法时，实际上调用的是 MyBatis 生成的 Mapper 接口代理对象的方法。属性将 Mapper 接口中的方法与 SQL 映射文件中的具体 SQL 语句建立了唯一的对应关系。属性的值必须与 Mapper 接口中对应方法的名称相同。"
keywords: "MyBatis 中SQL 映射文件是如何与 Mapper 接口关联起来的？ MyBatis 如何知道应该调用哪个 SQL 语句？"
categories: ['源码系列', 'Mybatis']
tags: ['Mybatis']
artid: "146101044"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146101044
    alt: "MyBatis-中SQL-映射文件是如何与-Mapper-接口关联起来的-MyBatis-如何知道应该调用哪个-SQL-语句"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146101044
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146101044
cover: https://bing.ee123.net/img/rand?artid=146101044
image: https://bing.ee123.net/img/rand?artid=146101044
img: https://bing.ee123.net/img/rand?artid=146101044
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MyBatis 中SQL 映射文件是如何与 Mapper 接口关联起来的？ MyBatis 如何知道应该调用哪个 SQL 语句？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      1. 命名空间 (Namespace):
     </strong>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        SQL 映射文件 (XML):
       </strong>
       在 SQL 映射文件的
       <code>
        &lt;mapper&gt;
       </code>
       根元素中，有一个
       <code>
        namespace
       </code>
       属性。这个
       <code>
        namespace
       </code>
       属性的值必须是 Mapper 接口的全限定名（包名 + 接口名）。
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- ... SQL 语句 ... --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        作用:
       </strong>
       <code>
        namespace
       </code>
       将 SQL 映射文件与 Mapper 接口建立了唯一的对应关系。MyBatis 通过
       <code>
        namespace
       </code>
       来区分不同的 Mapper 接口和 SQL 映射文件。
      </p>
     </li>
    </ul>
    <p>
     <strong>
      2. 语句 ID (Statement ID):
     </strong>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        SQL 映射文件 (XML):
       </strong>
       在 SQL 映射文件中，每个 SQL 语句（
       <code>
        &lt;select&gt;
       </code>
       ,
       <code>
        &lt;insert&gt;
       </code>
       ,
       <code>
        &lt;update&gt;
       </code>
       ,
       <code>
        &lt;delete&gt;
       </code>
       ）都有一个
       <code>
        id
       </code>
       属性，这个
       <code>
        id
       </code>
       属性的值必须与 Mapper 接口中对应方法的名称相同。
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUserById<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.model.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT id, username, password FROM users WHERE id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        Mapper 接口:
       </strong>
      </p>
      <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> <span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 方法名与 SQL 语句的 id 相同</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        作用:
       </strong>
       <code>
        id
       </code>
       属性将 Mapper 接口中的方法与 SQL 映射文件中的具体 SQL 语句建立了唯一的对应关系。MyBatis 通过方法名（即
       <code>
        id
       </code>
       ）来查找并执行对应的 SQL 语句。
      </p>
     </li>
    </ul>
    <p>
     <strong>
      3. 参数类型 (Parameter Type) 和结果类型 (Result Type):
     </strong>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        SQL 映射文件 (XML):
       </strong>
      </p>
      <ul>
       <li>
        <code>
         parameterType
        </code>
        属性（可选）：指定 SQL 语句的参数类型。MyBatis 可以自动推断参数类型，但在某些情况下（例如，使用复杂类型或自定义类型处理器时），需要显式指定
        <code>
         parameterType
        </code>
        。
       </li>
       <li>
        <code>
         resultType
        </code>
        属性（或
        <code>
         resultMap
        </code>
        属性）：指定 SQL 语句的查询结果类型。
        <code>
         resultType
        </code>
        用于简单的结果映射，
        <code>
         resultMap
        </code>
        用于复杂的关联映射。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        Mapper 接口:
       </strong>
      </p>
      <ul>
       <li>
        方法的参数类型必须与 SQL 语句的
        <code>
         parameterType
        </code>
        匹配（或兼容）。
       </li>
       <li>
        方法的返回值类型必须与 SQL 语句的
        <code>
         resultType
        </code>
        或
        <code>
         resultMap
        </code>
        匹配（或兼容）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        作用:
       </strong>
       参数类型和结果类型确保了 Java 方法的输入输出与 SQL 语句的输入输出一致，MyBatis 会根据这些类型信息进行参数绑定和结果映射。
      </p>
     </li>
    </ul>
    <p>
     <strong>
      MyBatis 如何知道应该调用哪个 SQL 语句 (执行流程):
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        调用 Mapper 接口的方法:
       </strong>
       当我们在 Java 代码中调用 Mapper 接口的方法时，实际上调用的是 MyBatis 生成的 Mapper 接口代理对象的方法。
      </p>
     </li>
     <li>
      <p>
       <strong>
        查找 MappedStatement:
       </strong>
       MyBatis 会根据以下信息查找对应的
       <code>
        MappedStatement
       </code>
       对象：
      </p>
      <ul>
       <li>
        <strong>
         Namespace:
        </strong>
        Mapper 接口的全限定名，用于确定 SQL 映射文件。
       </li>
       <li>
        <strong>
         Statement ID:
        </strong>
        Mapper 接口的方法名，用于确定 SQL 映射文件中的具体 SQL 语句。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        执行 SQL 语句:
       </strong>
       MyBatis 找到
       <code>
        MappedStatement
       </code>
       对象后，会根据
       <code>
        MappedStatement
       </code>
       中的信息（SQL 语句、参数类型、结果类型等）创建
       <code>
        Executor
       </code>
       、
       <code>
        StatementHandler
       </code>
       、
       <code>
        ParameterHandler
       </code>
       、
       <code>
        ResultSetHandler
       </code>
       等对象，并执行 SQL 语句。
      </p>
     </li>
     <li>
      <p>
       <strong>
        参数绑定和结果映射:
       </strong>
       MyBatis 会使用
       <code>
        TypeHandler
       </code>
       将 Java 方法的参数转换为 JDBC 类型，并设置到
       <code>
        PreparedStatement
       </code>
       中；然后执行 SQL 语句；最后，使用
       <code>
        TypeHandler
       </code>
       将
       <code>
        ResultSet
       </code>
       中的数据转换为 Java 对象，并返回给调用者。
      </p>
     </li>
    </ol>
    <p>
     <strong>
      总结:
     </strong>
    </p>
    <p>
     MyBatis 通过以下机制将 SQL 映射文件与 Mapper 接口关联起来：
    </p>
    <ul>
     <li>
      <strong>
       Namespace:
      </strong>
      将 SQL 映射文件与 Mapper 接口建立唯一的对应关系。
     </li>
     <li>
      <strong>
       Statement ID:
      </strong>
      将 Mapper 接口的方法与 SQL 映射文件中的具体 SQL 语句建立唯一的对应关系。
     </li>
     <li>
      <strong>
       Parameter Type 和 Result Type:
      </strong>
      确保 Java 方法的输入输出与 SQL 语句的输入输出一致。
     </li>
    </ul>
    <p>
     MyBatis 在运行时会根据 Mapper 接口的方法调用信息（Namespace + Statement ID）查找对应的
     <code>
      MappedStatement
     </code>
     对象，然后执行 SQL 语句，并进行参数绑定和结果映射。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6e6d736f66746b6c622f:61727469636c652f64657461696c732f313436313031303434" class_="artid" style="display:none">
 </p>
</div>


