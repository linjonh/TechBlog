---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f7a6877313938343937343637362f:61727469636c652f64657461696c732f313436313535303532"
layout: post
title: "Uniappå®ç°å¤šç§æ–‡ä»¶ç±»å‹ä¸Šä¼ "
date: 2025-03-10 15:21:27 +08:00
description: "åœ¨ç§»åŠ¨ç«¯å¼€å‘ä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ æ˜¯å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ã€‚æœ¬æ–‡å°†é€šè¿‡Uniappæ¡†æ¶ï¼Œè¯¦ç»†è®²è§£å¦‚ä½•å®ç°æ”¯æŒå¤šç±»å‹æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰ï¼‰çš„ä¸Šä¼ åŠŸèƒ½ï¼Œå¹¶è§£å†³è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜ğŸ˜„ğŸ˜„ğŸ˜„ã€‚"
keywords: "Uniappå®ç°å¤šç§æ–‡ä»¶ç±»å‹ä¸Šä¼ "
categories: ['Uniapp']
tags: ['Notepad', 'App']
artid: "146155052"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146155052
    alt: "Uniappå®ç°å¤šç§æ–‡ä»¶ç±»å‹ä¸Šä¼ "
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146155052
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146155052
cover: https://bing.ee123.net/img/rand?artid=146155052
image: https://bing.ee123.net/img/rand?artid=146155052
img: https://bing.ee123.net/img/rand?artid=146155052
---

# Uniappå®ç°å¤šç§æ–‡ä»¶ç±»å‹ä¸Šä¼ 

### ä¸€ã€å‰è¨€

åœ¨ç§»åŠ¨ç«¯å¼€å‘ä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ æ˜¯å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ã€‚æœ¬æ–‡å°†é€šè¿‡Uniappæ¡†æ¶ï¼Œè¯¦ç»†è®²è§£å¦‚ä½•å®ç°æ”¯æŒå¤šç±»å‹æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰ï¼‰çš„ä¸Šä¼ åŠŸèƒ½ï¼Œå¹¶è§£å†³è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜ğŸ˜„ğŸ˜„ğŸ˜„ã€‚

---

### äºŒã€æŠ€æœ¯æ–¹æ¡ˆ

#### 2.1 æ ¸å¿ƒAPI

Uniappæä¾›äº†ä»¥ä¸‹å…³é”®APIï¼š

* `uni.chooseFile`
  ï¼šæ–‡ä»¶é€‰æ‹©
* `uni.uploadFile`
  ï¼šæ–‡ä»¶ä¸Šä¼ 
* `uni.getFileInfo`
  ï¼šè·å–æ–‡ä»¶ä¿¡æ¯

#### 2.2 å¹³å°å·®å¼‚å¤„ç†

| å¹³å° | æ–‡ä»¶é€‰æ‹©æ–¹å¼ | é™åˆ¶è¯´æ˜ |
| --- | --- | --- |
| H5 | `<input type="file">` | ä¾èµ–æµè§ˆå™¨å®ç° |
| å¾®ä¿¡å°ç¨‹åº | `wx.chooseMessageFile` | éœ€é…ç½®åˆæ³•åŸŸå |
| App | `plus.io` æ–‡ä»¶ç³»ç»Ÿ | éœ€å¤„ç†æœ¬åœ°æ–‡ä»¶è·¯å¾„ |

---

### ä¸‰ã€å®Œæ•´å®ç°ä»£ç 

#### 3.1 æ–‡ä»¶é€‰æ‹©å™¨å°è£…

```javascript
// å¤šç±»å‹æ–‡ä»¶é€‰æ‹©
function chooseFiles(fileType = 'all') {
  return new Promise((resolve, reject) => {
    const extnameMap = {
      image: ['png', 'jpg', 'jpeg'],
      video: ['mp4', 'mov'],
      document: ['pdf', 'doc', 'docx', 'xls']
    };

    uni.chooseFile({
      count: 5, // æœ€å¤§é€‰æ‹©æ•°é‡
      extension: fileType === 'all' ? [] : extnameMap[fileType],
      success: res => {
        const files = res.tempFiles.map(item => ({
          path: item.path,
          name: item.name,
          size: item.size,
          type: item.type
        }));
        resolve(files);
      },
      fail: err => reject(err)
    });
  });
}

```

#### 3.2 æ–‡ä»¶ä¸Šä¼ æ ¸å¿ƒæ–¹æ³•

```javascript
// ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
async function uploadFile(file) {
  try {
    const formData = {
      userId: '123',
      fileType: file.type
    };

    const res = await uni.uploadFile({
      url: 'https://api.example.com/upload',
      filePath: file.path,
      name: 'file',
      formData,
      header: {
        'Authorization': 'Bearer token'
      }
    });

    return JSON.parse(res[1].data);
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error);
    throw error;
  }
}

```

#### 3.3 è¿›åº¦æ˜¾ç¤ºå®ç°

```javascript
// å¸¦è¿›åº¦ä¸Šä¼ 
function uploadWithProgress(file, onProgress) {
  return new Promise((resolve, reject) => {
    const task = uni.uploadFile({
      url: 'https://api.example.com/upload',
      filePath: file.path,
      name: 'file',
      success: (res) => resolve(JSON.parse(res.data)),
      fail: reject,
      complete: () => task.offProgressUpdate()
    });

    task.onProgressUpdate((res) => {
      onProgress && onProgress({
        progress: res.progress,
        totalBytesSent: res.totalBytesSent,
        totalBytesExpectedToSend: res.totalBytesExpectedToSend
      });
    });
  });
}

```

---

### å››ã€ç•Œé¢å®ç°ç¤ºä¾‹

```html
<template>
  <view class="upload-container">
    <button @click="chooseFiles">é€‰æ‹©æ–‡ä»¶</button>
    <view class="preview-list">
      <view v-for="(file, index) in files" :key="index" class="file-item">
        <image v-if="file.type.startsWith('image/')" :src="file.path" mode="aspectFit"/>
        <video v-else-if="file.type.startsWith('video/')" :src="file.path"/>
        <view v-else class="document-icon">
          <text>{{ getFileExt(file.name) }}</text>
        </view>
        <progress :percent="file.progress" show-info />
      </view>
    </view>
  </view>
</template>

<style>
/* æ–‡ä»¶é¢„è§ˆæ ·å¼ */
.preview-list {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 20px;
}

.file-item {
  position: relative;
  width: 100px;
  height: 100px;
  border: 1px dashed #ddd;
}

.document-icon {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  background: #f0f0f0;
}
</style>

```

---

### äº”ã€æœåŠ¡ç«¯é…åˆå»ºè®®

#### 5.1 æ–‡ä»¶æ¥æ”¶é…ç½®ï¼ˆNode.jsç¤ºä¾‹ï¼‰

```javascript
const multer = require('multer');
const storage = multer.diskStorage({
  destination: 'uploads/',
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname);
    cb(null, `${Date.now()}${ext}`);
  }
});

const upload = multer({
  storage,
  limits: {
    fileSize: 1024 * 1024 * 50 // 50MB
  },
  fileFilter: (req, file, cb) => {
    const allowedTypes = ['image/jpeg', 'image/png', 'video/mp4', 'application/pdf'];
    cb(null, allowedTypes.includes(file.mimetype));
  }
});

router.post('/upload', upload.single('file'), (req, res) => {
  // å¤„ç†ä¸Šä¼ æˆåŠŸé€»è¾‘
});

```

---

### å…­ã€æ³¨æ„äº‹é¡¹ğŸ›

1. **æ–‡ä»¶å¤§å°é™åˆ¶**
   ï¼šéœ€åŒæ—¶åœ¨å‰ç«¯å’ŒæœåŠ¡ç«¯è®¾ç½®
2. **æ ¼å¼éªŒè¯**
   ï¼šä¸èƒ½ä»…ä¾èµ–å‰ç«¯éªŒè¯
3. **å®‰å…¨å¤„ç†**
   ï¼š
   * é‡å‘½åå­˜å‚¨æ–‡ä»¶
   * æ‰«ææ¶æ„æ–‡ä»¶
   * è®¾ç½®è®¿é—®æƒé™
4. **æ€§èƒ½ä¼˜åŒ–**
   ï¼š
   * å›¾ç‰‡å‹ç¼©ï¼ˆå¯ä½¿ç”¨uni.compressImageï¼‰
   * åˆ†ç‰‡ä¸Šä¼ å¤§æ–‡ä»¶
   * æ–­ç‚¹ç»­ä¼ 