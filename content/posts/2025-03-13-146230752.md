---
layout: post
title: "基于CPU使用paddlex-OCR识别图片内容"
date: 2025-03-13 15:08:32 +0800
description: "paddlex CPU版本使用avx指令加速，需要确保系统和CPU支持avx指令（centos 7不支持）。GPU 版本，需显卡驱动程序版本 ≥450.80.02（Linux）或 ≥452.39（Windows）GPU 版本，需显卡驱动程序版本 ≥545.23.06（Linux）或 ≥545.84（Windows）设定安装源、信任安装源、PIL已被Pillow替代。耗时10s，准确率较高，图片分辨率不高也能识别。检查是否支持avx指令。查看 x86还是arm。"
keywords: "基于CPU使用paddlex OCR识别图片内容"
categories: ['Ai']
tags: ['银行回执', '单据提取', 'Python', 'Paddlex', 'Paddlepaddle', 'Ocr', 'Conda']
artid: "146230752"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146230752
    alt: "基于CPU使用paddlex-OCR识别图片内容"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146230752
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146230752
cover: https://bing.ee123.net/img/rand?artid=146230752
image: https://bing.ee123.net/img/rand?artid=146230752
img: https://bing.ee123.net/img/rand?artid=146230752
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     基于CPU使用paddlex OCR识别图片内容
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_Miniconda_Conda_0">
     </a>
     一、安装 Miniconda（轻量版 Conda）​
    </h3>
    <p>
     paddlex CPU版本使用avx指令加速，需要确保系统和CPU支持avx指令（centos 7不支持）。
    </p>
    <p>
     检查是否支持avx指令
    </p>
    <pre><code class="prism language-bash"><span class="token function">dmesg</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> avx
</code></pre>
    <p>
     查看 x86还是arm
    </p>
    <pre><code class="prism language-bash"><span class="token function">uname</span> <span class="token parameter variable">-m</span>
</code></pre>
    <h4>
     <a id="1__Miniconda__15">
     </a>
     1. 下载 Miniconda 安装脚本
    </h4>
    <pre><code class="prism language-bash"> <span class="token function">wget</span> https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
</code></pre>
    <h4>
     <a id="2__22">
     </a>
     2. 运行安装脚本
    </h4>
    <pre><code class="prism language-bash"><span class="token function">bash</span> Miniconda3-latest-Linux-x86_64.sh
</code></pre>
    <pre><code>Miniconda3 will now be installed into this location:
/home/super/miniconda3

[/home/super/miniconda3] &gt;&gt;&gt; 
PREFIX=/home/super/miniconda3
</code></pre>
    <h4>
     <a id="3__Conda_34">
     </a>
     3. 激活 Conda
    </h4>
    <pre><code class="prism language-bash"> <span class="token builtin class-name">source</span> ~/.bashrc  <span class="token comment"># 若使用 Bash</span>
</code></pre>
    <h4>
     <a id="4__41">
     </a>
     4. 验证安装
    </h4>
    <pre><code class="prism language-bash">conda <span class="token parameter variable">--version</span>
</code></pre>
    <h3>
     <a id="_Conda__Python_3100_47">
     </a>
     二、使用 Conda 安装 Python 3.10.0
    </h3>
    <h4>
     <a id="1__48">
     </a>
     1. 创建独立环境（推荐）​
    </h4>
    <pre><code class="prism language-bash">conda create <span class="token parameter variable">-n</span> PaddleImageOcr <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.10</span>.15
</code></pre>
    <h4>
     <a id="2__54">
     </a>
     2. 激活环境
    </h4>
    <pre><code class="prism language-bash">conda activate PaddleImageOcr
</code></pre>
    <h4>
     <a id="3__Python__60">
     </a>
     3. 验证 Python 版本
    </h4>
    <pre><code class="prism language-bash">python <span class="token parameter variable">--version</span>
</code></pre>
    <h3>
     <a id="_Conda__66">
     </a>
     三、配置 Conda 镜像源（国内加速）​
    </h3>
    <h4>
     <a id="1__67">
     </a>
     1. 生成镜像配置文件
    </h4>
    <pre><code class="prism language-bash"> conda config <span class="token parameter variable">--add</span> channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
    conda config <span class="token parameter variable">--add</span> channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
    conda config <span class="token parameter variable">--add</span> channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
    conda config <span class="token parameter variable">--set</span> show_channel_urls <span class="token function">yes</span>
</code></pre>
    <h4>
     <a id="2__77">
     </a>
     2. 查看配置
    </h4>
    <pre><code class="prism language-bash">conda config <span class="token parameter variable">--show</span> channels
</code></pre>
    <h3>
     <a id="_PaddlePaddle_84">
     </a>
     四、安装 PaddlePaddle
    </h3>
    <p>
     临时切换国内源
    </p>
    <pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PIP_INDEX_URL</span><span class="token operator">=</span>https://mirrors.aliyun.com/pypi/simple
</code></pre>
    <p>
     CPU 版本
    </p>
    <pre><code class="prism language-bash">  python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token assign-left variable">paddlepaddle</span><span class="token operator">==</span><span class="token number">3.0</span>.0rc0 <span class="token parameter variable">-i</span> https://www.paddlepaddle.org.cn/packages/stable/cpu/
</code></pre>
    <p>
     GPU 版本，需显卡驱动程序版本 ≥450.80.02（Linux）或 ≥452.39（Windows）
    </p>
    <pre><code class="prism language-bash">  python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> paddlepaddle-gpu<span class="token operator">==</span><span class="token number">3.0</span>.0rc0 <span class="token parameter variable">-i</span> https://www.paddlepaddle.org.cn/packages/stable/cu118/
</code></pre>
    <p>
     GPU 版本，需显卡驱动程序版本 ≥545.23.06（Linux）或 ≥545.84（Windows）
    </p>
    <pre><code class="prism language-bash">  python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> paddlepaddle-gpu<span class="token operator">==</span><span class="token number">3.0</span>.0rc0 <span class="token parameter variable">-i</span> https://www.paddlepaddle.org.cn/packages/stable/cu123/
</code></pre>
    <h3>
     <a id="PaddleX_109">
     </a>
     五、安装PaddleX
    </h3>
    <pre><code class="prism language-bash">  pip <span class="token function">install</span> https://paddle-model-ecology.bj.bcebos.com/paddlex/whl/paddlex-3.0.0rc0-py3-none-any.whl
</code></pre>
    <h3>
     <a id="OCR_115">
     </a>
     六、执行图片OCR
    </h3>
    <pre><code class="prism language-bash">  paddlex <span class="token parameter variable">--pipeline</span> OCR <span class="token parameter variable">--input</span> ./20250306-152918.jpg <span class="token parameter variable">--device</span> cpu
  paddlex <span class="token parameter variable">--pipeline</span> OCR <span class="token parameter variable">--input</span> D:/temp/tess4j/20250306-152918.jpg <span class="token parameter variable">--device</span> cpu
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4433e80bb9f0487bae7ce3b9054fe16d.png"/>
    </p>
    <h4>
     <a id="_124">
     </a>
     输出结果
    </h4>
    <p>
     耗时10s，准确率较高，图片分辨率不高也能识别。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/000efe3fb0a340c5837b5c210ffc4755.png"/>
    </p>
    <h3>
     <a id="Paddle_ServingPython_130">
     </a>
     七、安装Paddle Serving服务端​（需Python环境）：
    </h3>
    <p>
     安装服务化部署插件
    </p>
    <pre><code class="prism language-bash">  paddlex <span class="token parameter variable">--install</span> serving
</code></pre>
    <p>
     启动服务
    </p>
    <pre><code class="prism language-bash"><span class="token function">nohup</span> paddlex <span class="token parameter variable">--serve</span> <span class="token parameter variable">--port</span> <span class="token number">8080</span> <span class="token parameter variable">--pipeline</span> OCR <span class="token parameter variable">--device</span> cpu <span class="token parameter variable">--save_path</span> /tmp/PaddleImageOcr <span class="token operator">&gt;</span> paddleImageOcr.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre>
    <p>
     http请求
    </p>
    <pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token string">'127.0.0.1:8080/ocr'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--data</span> <span class="token string">'{
   "file":"https://oss.xxx.com/image/xxx.jpg"
}'</span>
</code></pre>
    <h3>
     <a id="_153">
     </a>
     问题
    </h3>
    <h4>
     <a id="ERROR_Could_not_find_a_version_that_satisfies_the_requirement_Pillow_from_paddlepaddle_from_versions_none_154">
     </a>
     ERROR: Could not find a version that satisfies the requirement Pillow (from paddlepaddle) (from versions: none)
    </h4>
    <p>
     设定安装源、信任安装源、PIL已被Pillow替代
    </p>
    <pre><code class="prism language-bash"> pip <span class="token function">install</span> Pillow <span class="token parameter variable">-i</span> http://pypi.tuna.tsinghua.edu.cn/simple/ --trusted-host pypi.tuna.tsinghua.edu.cn
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4e465f414c4f4e472f:61727469636c652f64657461696c732f313436323330373532" class_="artid" style="display:none">
 </p>
</div>


