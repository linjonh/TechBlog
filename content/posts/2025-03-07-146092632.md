---
layout: post
title: "electron-vue3-vite-渲染进程到主进程的双向通信"
date: 2025-03-07 12:31:25 +0800
description: "以Electron官方文档给出的”渲染进程触发动作，等待主进程返回内容“为例。Electron的双向通信采用ipcMain.handle(electron主进程内部监听)、ipcRenderer.invoke(包装给前端页面)"
keywords: "electron 双向通信 不用预加载"
categories: ['Forge']
tags: ['前端', 'Javascript', 'Electron']
artid: "146092632"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146092632
    alt: "electron-vue3-vite-渲染进程到主进程的双向通信"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146092632
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146092632
cover: https://bing.ee123.net/img/rand?artid=146092632
image: https://bing.ee123.net/img/rand?artid=146092632
img: https://bing.ee123.net/img/rand?artid=146092632
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     electron + vue3 + vite 渲染进程到主进程的双向通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      用示例讲解下渲染进程到主进程的双向通信
      <br/>
      初始版本项目结构可参考项目：https://github.com/ylpxzx/electron-forge-project/tree/init_project
     </p>
    </blockquote>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/6e09a79e47454ac9803fe0a356f624a1.gif"/>
    </p>
    <h3>
     <a id="_4">
     </a>
     渲染进程到主进程（双向）
    </h3>
    <blockquote>
     <p>
      以Electron官方文档给出的”渲染进程触发动作，等待主进程返回内容“为例。
      <br/>
      Electron的双向通信采用
      <code>
       ipcMain.handle(electron主进程内部监听)、ipcRenderer.invoke(包装给前端页面)
      </code>
      <br/>
      实现整项目示例：https://github.com/ylpxzx/electron-forge-project/tree/render_to_main_two_way
     </p>
    </blockquote>
    <p>
     ipcMain.handle是 Electron 中用于处理异步 IPC（进程间通信）调用的方法。ipcMain.handle(‘dialog:openFile’, handleFileOpen) 的作用是注册一个处理函数 handleFileOpen，当渲染进程（通常是你的 Vue 应用）发送一个名为 dialog:openFile 的异步消息时，这个处理函数会被调用并返回处理结果。
    </p>
    <h4>
     <a id="_11">
     </a>
     通信逻辑
    </h4>
    <ul>
     <li>
      <p>
       src/main.js
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/25d869a8988948989985f1775c0176fa.png">
        <br/>
        完整代码如下：
       </img>
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> app<span class="token punctuation">,</span> BrowserWindow<span class="token punctuation">,</span> ipcMain<span class="token punctuation">,</span> dialog <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'electron'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'node:path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> started <span class="token keyword">from</span> <span class="token string">'electron-squirrel-startup'</span><span class="token punctuation">;</span>

<span class="token comment">// Handle creating/removing shortcuts on Windows when installing/uninstalling.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>started<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleFileOpen</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> canceled<span class="token punctuation">,</span> filePaths <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> dialog<span class="token punctuation">.</span><span class="token function">showOpenDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> filePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">createWindow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// Create the browser window.</span>
  <span class="token keyword">const</span> mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
    <span class="token literal-property property">webPreferences</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">preload</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'preload.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// and load the index.html of the app.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MAIN_WINDOW_VITE_DEV_SERVER_URL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    mainWindow<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token constant">MAIN_WINDOW_VITE_DEV_SERVER_URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    mainWindow<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../renderer/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">MAIN_WINDOW_VITE_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Open the DevTools.</span>
  mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Bidirectional communication between rendering process and main process</span>
  ipcMain<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token string">'dialog:openFile'</span><span class="token punctuation">,</span> handleFileOpen<span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>BrowserWindow<span class="token punctuation">.</span><span class="token function">getAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'window-all-closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">!==</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      <p>
       在这个示例中，当用户在 Vue 应用中触发一个打开文件对话框事件时，渲染进程会发送一个 ‘dialog:openFile’ 消息到主进程，主进程接收到消息后会调用 handleFileOpen 函数来处理这个请求，并返回处理结果。
      </p>
     </li>
     <li>
      <p>
       src/preload.js
       <br/>
       <code>
        preload.js
       </code>
       用于上下文隔离；将确保您的
       <code>
        预加载脚本
       </code>
       和
       <code>
        Electron的内部逻辑
       </code>
       运行在所加载的
       <code>
        webcontent网页
       </code>
       之外的另一个独立的上下文环境里。 有助于阻止网站访问Electron 的内部组件和 预加载脚本可访问的高等级权限的API。简而言之就是提供一个入口给渲染进程(前端页面)使用，避免被攻击者随意调用electron内部API。
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> contextBridge<span class="token punctuation">,</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron/renderer'</span><span class="token punctuation">)</span>

contextBridge<span class="token punctuation">.</span><span class="token function">exposeInMainWorld</span><span class="token punctuation">(</span><span class="token string">'electronAPI'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">openFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ipcRenderer<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'dialog:openFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="_85">
     </a>
     页面示例
    </h4>
    <p>
     通信逻辑实现后，接下来就用一个页面来验证结果
    </p>
    <ul>
     <li>
      <p>
       src/vue-project/pages/renderToMain/TwoWay.vue
      </p>
      <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"button"</span> @click<span class="token operator">=</span><span class="token string">"onClick"</span> id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>Open a File<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      File path<span class="token operator">:</span> <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> inputVal <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> inputVal <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 调用electron对外暴露的openFile API</span>
  <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token keyword">await</span> electronAPI<span class="token punctuation">.</span><span class="token function">openFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  inputVal<span class="token punctuation">.</span>value <span class="token operator">=</span> filePath
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre>
     </li>
     <li>
      <p>
       src/vue-project/router/index.js
      </p>
      <pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createWebHashHistory<span class="token punctuation">,</span> createRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">import</span> HomeView <span class="token keyword">from</span> <span class="token string">'@/vue-project/pages/home/index.vue'</span>
<span class="token keyword">import</span> RenderToMainTwoWay <span class="token keyword">from</span> <span class="token string">'@/vue-project/pages/renderToMain/TwoWay.vue'</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> HomeView <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 注册示例路由</span>
  <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/renderToMainTwoWay'</span><span class="token punctuation">,</span> <span class="token literal-property property">component</span><span class="token operator">:</span> RenderToMainTwoWay <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token function">createWebHashHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       src/vue-project/App.vue
      </p>
      <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>🖥️ Hello World<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Welcome to your Electron application<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>Current route path<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> $route<span class="token punctuation">.</span>fullPath <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>nav<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>RouterLink to<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">&gt;</span>Go to Home<span class="token operator">&lt;</span><span class="token operator">/</span>RouterLink<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>RouterLink to<span class="token operator">=</span><span class="token string">"/renderToMainTwoWay"</span><span class="token operator">&gt;</span>Render<span class="token operator">-</span>Process <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token string">"font-size: 10px;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">--</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> Main<span class="token operator">-</span>Process
      <span class="token operator">&lt;</span><span class="token operator">/</span>RouterLink<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">"margin-top: 20px; border: 1px solid grey; padding: 20px; border-radius: 10px;"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="_158">
     </a>
     项目结构
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ac772ac85f864f87822f39864a649278.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34323237383234302f:61727469636c652f64657461696c732f313436303932363332" class_="artid" style="display:none">
 </p>
</div>


