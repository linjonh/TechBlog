---
layout: post
title: "VSTOCExcel开发3Range对象-处理列宽和行高"
date: 2025-03-08 19:33:01 +0800
description: "VSTO（C#）Excel开发3：Range对象 处理列宽和行高"
keywords: "c# vsto range.address"
categories: ['Vsto', 'Vsix', 'Office']
tags: ['Vsto', 'Vba', 'Excel']
artid: "146119835"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146119835
    alt: "VSTOCExcel开发3Range对象-处理列宽和行高"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146119835
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146119835
cover: https://bing.ee123.net/img/rand?artid=146119835
image: https://bing.ee123.net/img/rand?artid=146119835
img: https://bing.ee123.net/img/rand?artid=146119835
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     VSTO（C#）Excel开发3：Range对象 处理列宽和行高
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <a href="https://blog.csdn.net/2301_77171572/article/details/136553502?spm=1011.2415.3001.5331" title="初级代码游戏的专栏介绍与文章目录-CSDN博客">
      初级代码游戏的专栏介绍与文章目录-CSDN博客
     </a>
    </p>
    <p>
     我的
     <a href="https://so.csdn.net/so/search?q=github&amp;spm=1001.2101.3001.7020" title="github">
      github
     </a>
     ：codetoys，所有代码都将会位于ctfc库中。已经放入库中我会指出在库中的位置。
    </p>
    <p>
     这些代码大部分以Linux为目标但部分代码是纯C++的，可以在任何平台上使用。
    </p>
    <p>
     源码指引：
     <a href="https://blog.csdn.net/2301_77171572/category_12765305.html?spm=1001.2014.3001.5482" title="github源码指引_初级代码游戏的博客-CSDN博客">
      github源码指引_初级代码游戏的博客-CSDN博客
     </a>
    </p>
    <hr/>
    <p>
     前一篇
     <a href="https://blog.csdn.net/2301_77171572/article/details/146116718?spm=1011.2415.3001.5331" title="VSTO（C#）Excel开发2：Excel对象模型和基本操作-CSDN博客">
      VSTO（C#）Excel开发2：Excel对象模型和基本操作-CSDN博客
     </a>
    </p>
    <p>
     前一篇我们已经知道可以获取行和列的集合并得到行和列的个数，但是还没有注意到行和列竟然是Range对象。什么都是Range这一点埋下了很多坑。
    </p>
    <p>
     本篇我们来设置列宽和行高。
    </p>
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
     <img alt="" height="200" src="https://i-blog.csdnimg.cn/direct/3800c7609370459a86c90e4607e3722d.png" width="356"/>
    </p>
    <h2 id="%E4%B8%80%E3%80%81%E7%A1%AE%E8%AE%A4UsedRange" name="%E4%B8%80%E3%80%81%E7%A1%AE%E8%AE%A4UsedRange">
     一、确认UsedRange
    </h2>
    <h3 id="1.1%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81" name="1.1%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81">
     1.1 编写测试代码
    </h3>
    <p>
     我们已经知道UsedRange是用到的范围，但是没有内容的单元格算不算呢？
    </p>
    <p>
     我们来用程序验证一下，就像第一篇的操作一样，先增加一个按钮“button2”：
    </p>
    <p>
     <img alt="" height="414" src="https://i-blog.csdnimg.cn/direct/ef1b7f4cef9245f59eb51157cc067920.png" width="888"/>
    </p>
    <p>
     在设计器双击按钮生成按钮的事件代码，然后添加内容如下：
    </p>
    <pre><code class="language-cs">		private void button2_Click(object sender, RibbonControlEventArgs e)
		{
			string str = "开始操作。。。。。。\n";
			try
			{
				Range usedRange = Globals.ThisAddIn.Application.ActiveSheet.UsedRange;
				str += " UsedRange：" + usedRange.Address + "\n";
				str += " UsedRange.Column：" + usedRange.Column + "\n";
				str += " UsedRange.Columns.Count：" + usedRange.Columns.Count + "\n";
				str += " UsedRange.Row：" + usedRange.Row + "\n";
				str += " UsedRange.Rows.Count：" + usedRange.Rows.Count + "\n";

				str += "操作成功完成\n";
			}
			catch (Exception ex)
			{
				MessageBox.Show(ex.ToString());
			}
			MessageBox.Show(str);
		}
</code></pre>
    <h3 id="2.2%20Range%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B1%9E%E6%80%A7" name="2.2%20Range%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B1%9E%E6%80%A7">
     2.2 Range的几个属性
    </h3>
    <ul>
     <li>
      Address 单元格范围
     </li>
     <li>
      Column 第一个列的编号（从1开始）
     </li>
     <li>
      Columns 列的集合（Range），Columns.Count即列的个数
     </li>
     <li>
      Row 第一个行的编号（从1开始），Rows.Count即行的个数
     </li>
    </ul>
    <h3 id="2.3%20%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95" name="2.3%20%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95">
     2.3 运行测试
    </h3>
    <p>
     编译运行，新建空工作簿，执行button2：
    </p>
    <p>
     <img alt="" height="846" src="https://i-blog.csdnimg.cn/direct/a801317c8df84fde88c8cd72f9bd4008.png" width="929"/>
    </p>
    <p>
     虽然新建空工作簿什么都没有，UsedRange返回的是第一个单元格。
    </p>
    <p>
     然后我们执行一下button1，这个按钮会自动生成一些内容，然后再执行button2：
    </p>
    <p>
     <img alt="" height="780" src="https://i-blog.csdnimg.cn/direct/db72b2caa3a744fc844759011f073d9b.png" width="938"/>
    </p>
    <p>
     现在显示的范围是A1到C10，符合预期。
    </p>
    <p>
     再选中左上角的几个单元格：
    </p>
    <p>
     <img alt="" height="272" src="https://i-blog.csdnimg.cn/direct/ab32d440990d437dac5170e4bbd19bff.png" width="438"/>
    </p>
    <p>
     按一下键盘的“del”键删除，然后再执行buffton2：
    </p>
    <p>
     <img alt="" height="515" src="https://i-blog.csdnimg.cn/direct/576101480cca4496a71a1a419989f923.png" width="837"/>
    </p>
    <p>
     删掉的单元格没有出现在UsedRange里。
    </p>
    <p>
     现在我们给一个空单元格加上边框：
    </p>
    <p>
     <img alt="" height="676" src="https://i-blog.csdnimg.cn/direct/195bfa4915ac42fd91a2c37507129afd.png" width="774"/>
    </p>
    <p>
     再执行button2：
    </p>
    <p>
     <img alt="" height="672" src="https://i-blog.csdnimg.cn/direct/83947658ca4241c5bbe9abd123fc4411.png" width="944">
      现在设置格式的格子也在UsedRange里面了。再改回无边框也没用，还是在UsedRange里面。
     </img>
    </p>
    <p>
     实测拉宽列不会导致列出现在UsedRange里。
    </p>
    <h3 id="%E4%BA%8C%E3%80%81%E8%AE%BE%E7%BD%AE%E5%88%97%E5%AE%BD%E5%92%8C%E8%A1%8C%E9%AB%98" name="%E4%BA%8C%E3%80%81%E8%AE%BE%E7%BD%AE%E5%88%97%E5%AE%BD%E5%92%8C%E8%A1%8C%E9%AB%98">
     二、设置列宽和行高
    </h3>
    <h3 id="2.1%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81" name="2.1%20%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81">
     2.1 编写测试代码
    </h3>
    <p>
     将刚才的代码增加点内容，替换成如下代码：
    </p>
    <pre><code class="language-cs">		private void button2_Click(object sender, RibbonControlEventArgs e)
		{
			string str = "开始操作。。。。。。\n";
			try
			{
				Worksheet worksheet = Globals.ThisAddIn.Application.ActiveSheet;
				Range usedRange = worksheet.UsedRange;
				str += " UsedRange：" + usedRange.Address + "\n";
				str += " UsedRange.Column：" + usedRange.Column + "\n";
				str += " UsedRange.Columns.Count：" + usedRange.Columns.Count + "\n";
				str += " UsedRange.Row：" + usedRange.Row + "\n";
				str += " UsedRange.Rows.Count：" + usedRange.Rows.Count + "\n";

				for (int i = 0; i &lt; usedRange.Columns.Count; ++i)
				{
					Range colum = worksheet.Columns[usedRange.Column + i];
					colum.ColumnWidth = 15;
				}
				for (int i = 0; i &lt; usedRange.Rows.Count; ++i)
				{
					Range row = worksheet.Rows[usedRange.Row + i];
					row.RowHeight = 30;
				}
				str += "操作成功完成\n";
			}
			catch (Exception ex)
			{
				MessageBox.Show(ex.ToString());
			}
			MessageBox.Show(str);
		}
</code></pre>
    <p>
     增加了设置列宽和行高的代码。
    </p>
    <h3 id="2.2%20Range%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B1%9E%E6%80%A7" name="2.2%20Range%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B1%9E%E6%80%A7">
     2.2 Range相关的属性
    </h3>
    <ul>
     <li>
      ColumnWidth 列宽，以标准字符宽度为单位（大概就是英文字符的意思吧），设置时全部设置为同一值，获取时如果不一致返回空（这谁想出来的啊？）
     </li>
     <li>
      RowHeight 行高，以像素为单位（这又是谁想出来的啊，宽和高的单位不一样），坑是一样的，如果多个行的行高不一致返回空
     </li>
    </ul>
    <h3 id="2.3%C2%A0WorkSheet%E8%8E%B7%E5%8F%96%E8%A1%8C%E5%92%8C%E5%88%97" name="2.3%C2%A0WorkSheet%E8%8E%B7%E5%8F%96%E8%A1%8C%E5%92%8C%E5%88%97">
     2.3 WorkSheet获取行和列
    </h3>
    <ul>
     <li>
      Columns[i]，i是基于1的索引
     </li>
     <li>
      Rows[i]，i是基于1的索引
     </li>
    </ul>
    <h3 id="2.4%20%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95" name="2.4%20%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95">
     2.4 运行测试
    </h3>
    <p>
     编译运行，先执行button1再执行button2：
    </p>
    <p>
     <img alt="" height="1128" src="https://i-blog.csdnimg.cn/direct/4503318ca43646408f63729c545d089d.png" width="1161"/>
    </p>
    <p>
     看到有数据的区域的宽和高都修改了。
    </p>
    <h2 id="%E4%B8%89%E3%80%81%E8%87%AA%E5%8A%A8%E8%B0%83%E6%95%B4%E5%88%97%E5%AE%BD%E5%92%8C%E8%A1%8C%E9%AB%98" name="%E4%B8%89%E3%80%81%E8%87%AA%E5%8A%A8%E8%B0%83%E6%95%B4%E5%88%97%E5%AE%BD%E5%92%8C%E8%A1%8C%E9%AB%98">
     三、自动调整列宽和行高
    </h2>
    <p>
     使用Range的AutoFit方法即可，按照官方文档是设置列宽“或”设置行高，我直接替换上面的代码，因此只是对单一列或单一行操作，都是有效的。
    </p>
    <p>
     代码如下：
    </p>
    <pre><code class="language-cs">				for (int i = 0; i &lt; usedRange.Columns.Count; ++i)
				{
					Range colum = worksheet.Columns[usedRange.Column + i];
					colum.ColumnWidth = 15;//被下一句覆盖
					colum.AutoFit();
				}
				for (int i = 0; i &lt; usedRange.Rows.Count; ++i)
				{
					Range row = worksheet.Rows[usedRange.Row + i];
					row.RowHeight = 30;//被下一句覆盖
					row.AutoFit();
				}
</code></pre>
    <p>
     动手拉拉宽度，再执行能更清楚地看到效果。
    </p>
    <hr/>
    <p>
     （这里是文档结束）
    </p>
   </div>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37373137313537322f:61727469636c652f64657461696c732f313436313139383335" class_="artid" style="display:none">
 </p>
</div>


