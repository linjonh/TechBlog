---
layout: post
title: "Blender-MCP服务源码5-BlenderSocket插件安装"
date: 2025-03-15 23:13:13 +0800
description: "上一篇讲述了Blender是基于Socket进行本地和远程进行通讯，现在尝试将BlenderSocket插件安装到Blender中进行功能调试。"
keywords: "blendermcp"
categories: ['Blendermcp', 'Ai']
tags: ['Blender']
artid: "146287132"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146287132
    alt: "Blender-MCP服务源码5-BlenderSocket插件安装"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146287132
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146287132
cover: https://bing.ee123.net/img/rand?artid=146287132
image: https://bing.ee123.net/img/rand?artid=146287132
img: https://bing.ee123.net/img/rand?artid=146287132
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Blender-MCP服务源码5-BlenderSocket插件安装
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="BlenderMCP5BlenderSocket_0">
     </a>
     Blender-MCP服务源码5-BlenderSocket插件安装
    </h2>
    <blockquote>
     <p>
      上一篇讲述了Blender是基于Socket进行本地和远程进行通讯，现在尝试将BlenderSocket插件安装到Blender中进行功能调试
     </p>
    </blockquote>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/a10049b6b6f74d348e2ea6b57f4d523a.jpeg"/>
    </p>
    <hr/>
    <h3>
     <a id="1_6">
     </a>
     1-核心知识点
    </h3>
    <ul>
     <li>
      将开发的BlenderSocket插件安装到Blender中
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2_10">
     </a>
     2-思路整理
    </h3>
    <ul>
     <li>
      1）将SocketServer部署到Blender启动SocketServer
     </li>
     <li>
      2）本地使用SocketClient连接SocketServer尝试发送指令
     </li>
     <li>
      3）验证交互结果-&gt;如果该逻辑通-&gt;后续就可以完善MCP业务指令
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="3_16">
     </a>
     3-参考网址
    </h3>
    <ul>
     <li>
      Blender-MCP-Github地址：https://github.com/ahujasid/blender-mcp
     </li>
     <li>
      B站大佬开源Blender开发框架:https://github.com/xzhuah/BlenderAddonPackageTool
     </li>
     <li>
      <a href="https://www.bilibili.com/video/BV1VBqcY4E6x" rel="nofollow">
       B站大佬开源Blender开发框架教程
      </a>
     </li>
     <li>
      个人实现代码仓库1：https://gitee.com/enzoism/python_blender_socket
     </li>
     <li>
      个人实现代码仓库2：https://gitee.com/enzoism/python_blender_mcp
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="4_24">
     </a>
     4-上手实操
    </h3>
    <h4>
     <a id="1SocketBlender_26">
     </a>
     1-部署Socket到Blender
    </h4>
    <blockquote>
     <p>
      代码地址：https://gitee.com/enzoism/python_blender_mcp
     </p>
    </blockquote>
    <ul>
     <li>
      部署Socket到Blender
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/5e2d7fb317ec44fb896d256a2c7ae169.png"/>
     </li>
     <li>
      本地SocketClient与SocketServer通讯验证
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/direct/d2d8d1fd52cf4370b5fb9a832136adab.png"/>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2_34">
     </a>
     2-本地项目调试
    </h4>
    <blockquote>
     <p>
      运行test.py文件即可
     </p>
    </blockquote>
    <ul>
     <li>
      SocketClient代码
     </li>
    </ul>
    <blockquote>
     <p>
      代码地址：https://gitee.com/enzoism/python_blender_socket
     </p>
    </blockquote>
    <pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> socket

<span class="token keyword">def</span> <span class="token function">send_command</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""发送命令到服务器并接收响应"""</span>
    sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>  <span class="token comment"># 创建TCP套接字</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connecting to server..."</span><span class="token punctuation">)</span>  <span class="token comment"># 连接到服务器</span>
        sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token number">9876</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 连接到本地9876端口的服务器</span>

        <span class="token comment"># 发送命令</span>
        json_command <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment"># 将命令转换为JSON格式并编码为字节</span>
        sock<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>json_command<span class="token punctuation">)</span>  <span class="token comment"># 发送命令</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sent command: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>command<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># 打印发送的命令</span>

        <span class="token comment"># 接收响应</span>
        sock<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 设置超时时间为10秒</span>
        response_data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">65536</span><span class="token punctuation">)</span>  <span class="token comment"># 接收响应数据，最大长度为65536字节</span>
        <span class="token keyword">if</span> response_data<span class="token punctuation">:</span>  <span class="token comment"># 如果接收到数据</span>
            response <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 将响应数据解码为JSON格式</span>
            <span class="token keyword">return</span> response  <span class="token comment"># 返回响应</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token string">"Empty response"</span><span class="token punctuation">}</span>  <span class="token comment"># 如果没有接收到数据，返回错误信息</span>

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>  <span class="token comment"># 捕获所有异常</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token comment"># 返回异常信息</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭套接字</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token comment"># 测试ping命令</span>
    ping_command <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"ping"</span><span class="token punctuation">,</span>
        <span class="token string">"params"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    response <span class="token operator">=</span> send_command<span class="token punctuation">(</span>ping_command<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Server response:"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>  <span class="token comment"># 打印服务器响应</span>

</code></pre>
    <hr/>
    <h4>
     <a id="3_82">
     </a>
     3-代码结构
    </h4>
    <ul>
     <li>
      1）clazz类中业务类-&gt;比如创建一个Person类，有构造方法，有eat方法
     </li>
     <li>
      2）operator中放要clazz类中业务类的操作逻辑
     </li>
     <li>
      3）panels中放看板的点击Operator类-&gt;但是不要在这里也业务逻辑（解耦）
     </li>
     <li>
      4）panels中防止看板的判断属性-&gt;根据状态更换按钮文字和点击事件
     </li>
    </ul>
    <hr/>
    <ul>
     <li>
      1）clazz代码示例
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time


<span class="token comment"># 添加自己的业务Operator</span>
<span class="token keyword">class</span> <span class="token class-name">BlenderMCPServer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9876</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>host <span class="token operator">=</span> host
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>socket <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>server_thread <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>server_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>_run_server<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>server_thread<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>server_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"BlenderMCP server started on </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>host<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>port<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>socket<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>client<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"BlenderMCP server stopped"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_run_server</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span>  <span class="token comment"># Add a timeout for accept</span>

            <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>client<span class="token punctuation">,</span> address <span class="token operator">=</span> self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connected to client: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>address<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

                    <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                        <span class="token keyword">try</span><span class="token punctuation">:</span>
                            <span class="token comment"># Set a timeout for receiving data</span>
                            self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">15.0</span><span class="token punctuation">)</span>
                            data <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
                            <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Empty data received, client may have disconnected"</span><span class="token punctuation">)</span>
                                <span class="token keyword">break</span>

                            <span class="token keyword">try</span><span class="token punctuation">:</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Received data: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                                command <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                response <span class="token operator">=</span> self<span class="token punctuation">.</span>execute_command<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span>
                                    <span class="token string-interpolation"><span class="token string">f"Sending response: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>  <span class="token comment"># Truncate long responses in log</span>
                                self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">:</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Invalid JSON received: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                                self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                                    <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
                                    <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"Invalid JSON format"</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error executing command: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                                <span class="token keyword">import</span> traceback
                                traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                                    <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
                                    <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Socket timeout while waiting for data"</span><span class="token punctuation">)</span>
                            <span class="token keyword">continue</span>
                        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error receiving data: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                            <span class="token keyword">break</span>

                    self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token boolean">None</span>
                <span class="token keyword">except</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
                    <span class="token comment"># This is normal - just continue the loop</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connection error: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>client<span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token boolean">None</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># Prevent busy waiting</span>

        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Server error: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>socket<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">execute_command</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Execute a Blender command received from the MCP server"""</span>
        cmd_type <span class="token operator">=</span> command<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span>
        params <span class="token operator">=</span> command<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"params"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment"># Add a simple ping handler</span>
        <span class="token keyword">if</span> cmd_type <span class="token operator">==</span> <span class="token string">"ping"</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Handling ping command"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"pong"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>
                <span class="token string">"result"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Unknown command type: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>command<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">}</span>



</code></pre>
    <hr/>
    <ul>
     <li>
      2）operator代码示例
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">BlenderMCPOperatorStart</span><span class="token punctuation">(</span>bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Operator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''BlenderMCPOperatorStart'''</span>
    bl_idname <span class="token operator">=</span> <span class="token string">"object.blender_mcp_operator_start"</span>
    bl_label <span class="token operator">=</span> <span class="token string">"Now_Stop_Click_Start"</span>

    <span class="token comment"># 确保在操作之前备份数据，用户撤销操作时可以恢复</span>
    bl_options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'REGISTER'</span><span class="token punctuation">,</span> <span class="token string">'UNDO'</span><span class="token punctuation">}</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">poll</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> context<span class="token punctuation">:</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span>active_object <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">:</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        scene <span class="token operator">=</span> context<span class="token punctuation">.</span>scene

        <span class="token comment"># 创建socket实例</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>bpy<span class="token punctuation">.</span>types<span class="token punctuation">,</span> <span class="token string">"blender_mcp_server"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">not</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>blender_mcp_server<span class="token punctuation">:</span>
            <span class="token comment"># Start the server</span>
            bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>blender_mcp_server <span class="token operator">=</span> BlenderMCPServer<span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">9876</span><span class="token punctuation">)</span>
            bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>blender_mcp_server<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"---------------------Start MCP Server后重置状态"</span><span class="token punctuation">)</span>
            scene<span class="token punctuation">.</span>blender_mcp_server_running <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'FINISHED'</span><span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">BlenderMCPOperatorStop</span><span class="token punctuation">(</span>bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Operator<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''BlenderMCPOperatorStop'''</span>
    bl_idname <span class="token operator">=</span> <span class="token string">"object.blender_mcp_operator_stop"</span>
    bl_label <span class="token operator">=</span> <span class="token string">"Now_Start_Click_Stop"</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">poll</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> context<span class="token punctuation">:</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> context<span class="token punctuation">.</span>active_object <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">:</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        scene <span class="token operator">=</span> context<span class="token punctuation">.</span>scene

        <span class="token comment"># 销毁socket实例</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>bpy<span class="token punctuation">.</span>types<span class="token punctuation">,</span> <span class="token string">"blender_mcp_server"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>blender_mcp_server<span class="token punctuation">:</span>
            bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>blender_mcp_server<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">del</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>blender_mcp_server
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"---------------------Stop MCP Server后重置状态"</span><span class="token punctuation">)</span>
            scene<span class="token punctuation">.</span>blender_mcp_server_running <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">'FINISHED'</span><span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <ul>
     <li>
      3）panels中Operator代码示例
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@reg_order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleAddonPanel2</span><span class="token punctuation">(</span>BasePanel<span class="token punctuation">,</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Panel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    bl_label <span class="token operator">=</span> <span class="token string">"Example Addon Side Bar Panel"</span>
    bl_idname <span class="token operator">=</span> <span class="token string">"SCENE_PT_sample2"</span>

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> context<span class="token punctuation">:</span> bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">:</span>
        layout <span class="token operator">=</span> self<span class="token punctuation">.</span>layout
        layout<span class="token punctuation">.</span>label<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string">"BlenderMCP Panel"</span><span class="token punctuation">)</span>
        <span class="token comment"># 当前只是为了测试常驻按钮的点击测试-点击对图形缩小0.8</span>
        layout<span class="token punctuation">.</span>operator<span class="token punctuation">(</span>StaticButtonOperator<span class="token punctuation">.</span>bl_idname<span class="token punctuation">)</span>
        <span class="token comment"># 测试服务器的装</span>
        scene <span class="token operator">=</span> context<span class="token punctuation">.</span>scene
        <span class="token keyword">if</span> <span class="token keyword">not</span> scene<span class="token punctuation">.</span>blender_mcp_server_running<span class="token punctuation">:</span>
            layout<span class="token punctuation">.</span>operator<span class="token punctuation">(</span>BlenderMCPOperatorStart<span class="token punctuation">.</span>bl_idname<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Start MCP Server"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            layout<span class="token punctuation">.</span>operator<span class="token punctuation">(</span>BlenderMCPOperatorStop<span class="token punctuation">.</span>bl_idname<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Stop MCP Server"</span><span class="token punctuation">)</span>

</code></pre>
    <hr/>
    <ul>
     <li>
      4）panels中属性代码示例
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> bpy

<span class="token comment"># 添加属性到 Scene 类型</span>
bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>blender_mcp_server <span class="token operator">=</span> bpy<span class="token punctuation">.</span>props<span class="token punctuation">.</span>BoolProperty<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"Blender MCP Server Running"</span><span class="token punctuation">,</span>
    default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
    description<span class="token operator">=</span><span class="token string">"Indicates whether the Blender MCP server is running."</span>
<span class="token punctuation">)</span>
bpy<span class="token punctuation">.</span>types<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span>blender_mcp_server_running <span class="token operator">=</span> bpy<span class="token punctuation">.</span>props<span class="token punctuation">.</span>BoolProperty<span class="token punctuation">(</span>
    name<span class="token operator">=</span><span class="token string">"Blender MCP Server Running"</span><span class="token punctuation">,</span>
    default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
    description<span class="token operator">=</span><span class="token string">"Indicates whether the Blender MCP server is running."</span>
<span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37373731373134382f:61727469636c652f64657461696c732f313436323837313332" class_="artid" style="display:none">
 </p>
</div>


