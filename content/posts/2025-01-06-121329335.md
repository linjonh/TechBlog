---
layout: post
title: "Vue前端打包详细流程"
date: 2025-01-06 13:58:48 +0800
description: "前端打包添加打包命令运行打包代码打包指定不同的环境变量打包自定义文件移除三方包gzip压缩打包部署模"
keywords: "前端 打包"
categories: ['Vue']
tags: ['前端', 'Webpack', 'Vue']
artid: "121329335"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=121329335
    alt: "Vue前端打包详细流程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=121329335
featuredImagePreview: https://bing.ee123.net/img/rand?artid=121329335
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Vue前端打包详细流程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      前端打包
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        添加打包命令
       </a>
      </li>
      <li>
       <a href="#_16" rel="nofollow">
        运行打包代码
       </a>
      </li>
      <li>
       <a href="#_32" rel="nofollow">
        打包指定不同的环境变量
       </a>
      </li>
      <li>
       <a href="#_55" rel="nofollow">
        打包自定义文件
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_62" rel="nofollow">
          移除三方包
         </a>
        </li>
        <li>
         <a href="#gzip_91" rel="nofollow">
          gzip压缩
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_132" rel="nofollow">
        打包部署模式
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     添加打包命令
    </h2>
    <blockquote>
     <p>
      package.json中添加配置
      <br/>
      npm run build 发布到线上的代码
      <strong>
       不便于调试
      </strong>
      <br/>
      命令：
      <br/>
      ①npm run build:dev
      <strong>
       开发
      </strong>
      调式环境
      <br/>
      ②npm run build:prod
      <strong>
       线上
      </strong>
      调试环境
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9fdeaf472a025b116720ee7c4dab27c1.png"/>
     </p>
    </blockquote>
    <pre><code class="prism language-javascript">	<span class="token string">"build:dev"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service build --mode dev"</span><span class="token punctuation">,</span>
    <span class="token string">"build:prod"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service build --mode prod"</span>
</code></pre>
    <h2>
     <a id="_16">
     </a>
     运行打包代码
    </h2>
    <blockquote>
     <p>
      不可直接双击dist/index.html
      <br/>
      需要放在http容器中运行：serve tomcat nginx iis
      <br/>
      本次使用
      <strong>
       serve
      </strong>
     </p>
    </blockquote>
    <blockquote>
     <p>
      下载serve：
      <strong>
       npm i -g serve
      </strong>
     </p>
    </blockquote>
    <blockquote>
     <p>
      <strong>
       报错
      </strong>
      ：
      <br/>
      <em>
       Error: EPERM: operation not permitted, mkdir ‘C:\Program Files\nodejs\node global\node_modules.staging’
      </em>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/59f01d5f63a73af71000e5a87ca255fc.png">
       <br/>
       <strong>
        解决
       </strong>
       ： 用户—&gt;个人用户—&gt;删除.npmrc文件
      </img>
     </p>
    </blockquote>
    <blockquote>
     <p>
      启动打包后的目录：
      <strong>
       serve dist
      </strong>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/324bba3af04b194f34199db6a0fa69f4.png"/>
     </p>
    </blockquote>
    <h2>
     <a id="_32">
     </a>
     打包指定不同的环境变量
    </h2>
    <blockquote>
     <p>
      添加环境变量
      <br/>
      ① 开发：在根目录下创建 .
      <strong>
       env
      </strong>
      .
      <strong>
       dev
      </strong>
      文件（与package.json中mode对应）
      <br/>
      ② 线上：在根目录下创建 .
      <strong>
       env
      </strong>
      .
      <strong>
       prod
      </strong>
      文件（与package.json中mode对应）
      <br/>
      在需要动态指定变量的位置使用process.env.NODE_ENV等
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/61696bcf6d08cd05978a52c3a845124c.png"/>
     </p>
    </blockquote>
    <blockquote>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/99c8d09f06a39bd56fb1858bf567bd30.png"/>
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token comment">// .env.dev</span>
##开发环境
<span class="token constant">NODE_ENV</span><span class="token operator">=</span>development
##变量以<span class="token constant">VUE_APP_</span>开头
<span class="token constant">VUE_APP_URL</span><span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>com

<span class="token comment">// .env.prod</span>
##生产环境
<span class="token constant">NODE_ENV</span><span class="token operator">=</span>production
<span class="token constant">VUE_APP_URL</span><span class="token operator">=</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>com
</code></pre>
    <h2>
     <a id="_55">
     </a>
     打包自定义文件
    </h2>
    <blockquote>
     <p>
      vuecli是基于webpack
      <br/>
      vuecli零配置
      <br/>
      不需要零配置可以指定
      <strong>
       vue.config.js
      </strong>
     </p>
    </blockquote>
    <blockquote>
     <p>
      npm run build:prod 少了注释、空行、压缩等
     </p>
    </blockquote>
    <h3>
     <a id="_62">
     </a>
     移除三方包
    </h3>
    <blockquote>
     <p>
      <strong>
       代码细分
      </strong>
      <br/>
      ①三方包：vue elementui axios等
      <br/>
      ②开发代码：自己写的
      <br/>
      <strong>
       移出三方包
      </strong>
      ： 使用三方提供cdn（免费、收费）
      <br/>
      步骤：
      <br/>
      ①找到三方包cdn资源，添加到public/index.html
      <br/>
      ②把之前import导入的删除
      <br/>
      ③在vue.config.js配置排除三方包
     </p>
    </blockquote>
    <pre><code class="prism language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 打开文件访问的相对路径 独立项目 通过项目根目录访问</span>
  publicPath<span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
  <span class="token comment">// 开发时需要 线上不需要 map--&gt;提供代码映射 方便调试代码</span>
  productionSourceMap<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token boolean">true</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 配置webpack</span>
  <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// config---vuecli默认配置</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span>  <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 排除依赖包</span>
      externals<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        vue<span class="token operator">:</span> <span class="token string">'Vue'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="gzip_91">
     </a>
     gzip压缩
    </h3>
    <blockquote>
     <p>
      下载 npm i -D compression-webpack-plugin
     </p>
    </blockquote>
    <blockquote>
     <p>
      <strong>
       打包发生错误：
      </strong>
      <br/>
      <em>
       ERROR TypeError: Cannot read property ‘tapPromise’ of undefined
       <br/>
       TypeError: Cannot read property ‘tapPromise’ of undefined
      </em>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3f2f30328ceceb8852e48d5958c37078.png">
       <br/>
       <strong>
        错误原因
       </strong>
       : 脚手架配置gzip打包不支持这个版本
       <br/>
       <strong>
        解决
       </strong>
       : 使用npm install compression-webpack-plugin@6.1.1 --save-dev
       <br/>
       在vue.config.js配置
      </img>
     </p>
    </blockquote>
    <blockquote>
     <p>
      打包会生成
      <strong>
       gz
      </strong>
      结尾的文件
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7900a78245cb281b8000efcb54863d39.png"/>
     </p>
    </blockquote>
    <pre><code class="prism language-javascript"><span class="token keyword">let</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 压缩方式</span>
        algorithm<span class="token operator">:</span> <span class="token string">'gzip'</span><span class="token punctuation">,</span>
        <span class="token comment">// 匹配压缩文件</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$|\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 对于大于10k压缩</span>
        threshold<span class="token operator">:</span> <span class="token number">10240</span> 
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      config<span class="token punctuation">.</span>mode <span class="token operator">=</span> <span class="token string">"production"</span>
      config<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>config<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> <span class="token operator">...</span>plugins<span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      config<span class="token punctuation">.</span>mode <span class="token operator">=</span> <span class="token string">'development'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

</code></pre>
    <blockquote>
     <p>
      浏览器查看
      <br/>
      请求头：Accept-Encoding: gzip, deflate, br
      <br/>
      响应头：Content-Encoding: gzip
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6143f185e20cedbdcecba2148a55e3f7.png"/>
     </p>
    </blockquote>
    <h2>
     <a id="_132">
     </a>
     打包部署模式
    </h2>
    <blockquote>
     <p>
      hash： 打包后dist直接在http容器中运行 线上一致
     </p>
    </blockquote>
    <blockquote>
     <p>
      history： 打包后脚手架刷新不会404 线上会404
      <br/>
      解决方案：需要前端代码与后端一起部署 由后端负责跳转前端
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343831333431372f:61727469636c652f64657461696c732f313231333239333335" class_="artid" style="display:none">
 </p>
</div>


