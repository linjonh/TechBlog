---
layout: post
title: "vue项目接入e2e自动化测试"
date: 2024-12-16 15:12:14 +0800
description: "文章目录1.安装night-watch2.安装浏览器驱动3.关于Selenium（音译：斯利涅姆） "
keywords: "vue-cli-service test:e2e"
categories: ['Vue']
tags: ['Vue', 'E']
artid: "108185107"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=108185107
    alt: "vue项目接入e2e自动化测试"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=108185107
featuredImagePreview: https://bing.ee123.net/img/rand?artid=108185107
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vue项目接入e2e自动化测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <ul>
          <li>
           <ul>
            <li>
             <a href="#1nightwatch_4" rel="nofollow">
              1.安装night-watch
             </a>
            </li>
            <li>
             <a href="#2_9" rel="nofollow">
              2.安装浏览器驱动
             </a>
            </li>
            <li>
             <a href="#3Selenium_Server_16" rel="nofollow">
              3.关于Selenium（音译：斯利涅姆） Server
             </a>
            </li>
            <li>
             <a href="#4_23" rel="nofollow">
              4.配置文件
             </a>
            </li>
            <li>
             <a href="#5_281" rel="nofollow">
              5.修改配置文件
             </a>
            </li>
            <li>
             <ul>
              <li>
               <a href="#51_chromedriver_285" rel="nofollow">
                5.1 更新默认使用chromedriver
               </a>
              </li>
              <li>
               <a href="#52__312" rel="nofollow">
                5.2 配置测试文件路径
               </a>
              </li>
              <li>
               <a href="#53_runnerjs_357" rel="nofollow">
                5.3 配置runner.js
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <br/>
    项目开发到一定阶段，需要接入自动化测试，调研了一线现有的自动化测试方案，以为vue-cli默认使用的nightwatch的0.9+的版本，其适用的chrome的版本很低，我们自己的浏览器早都80+了，他还适用70多，所以没有采用默认的，同时我们的项目是开始没有采用脚手架的配置，所以是单独安装配置的：
    <br/>
    <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c86fb6bf050d8b05214e360491b541b0.png#pic_center">
     <br/>
     下面开始我们的配置：
     <a href="https://nightwatchjs.org/gettingstarted/installation/" rel="nofollow">
      night watch
     </a>
     <p>
     </p>
     <h5>
      <a id="1nightwatch_4">
      </a>
      1.安装night-watch
     </h5>
     <blockquote>
      <p>
       npm install nightwatch
      </p>
     </blockquote>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/780fffec0c3364f3cef917d7b7bb3464.png#pic_center">
       <br/>
       可以看到最新的1.3.7(官网最新的应该是1.3.8，npm仓库最新的是1.3.7)安装成功
      </img>
     </p>
     <h5>
      <a id="2_9">
      </a>
      2.安装浏览器驱动
     </h5>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e96305a4b808396dbfb2c3026d9bac3d.png#pic_center">
       <br/>
       可以根据需求来进行安装，我这里只安装chrome的内核驱动：
      </img>
     </p>
     <blockquote>
      <p>
       npm install chromedriver --save-dev
      </p>
     </blockquote>
     <p>
      过程会稍微慢点，失败的话可以尝试cnpm
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/321e52663c927c0edd65b98d0a373399.png#pic_center"/>
     </p>
     <h5>
      <a id="3Selenium_Server_16">
      </a>
      3.关于Selenium（音译：斯利涅姆） Server
     </h5>
     <p>
      有点类似与nginx，nightwath 自己不能直接去调起浏览器，特别是当前市场上的很多浏览器，nightwatch通过它来对接各个浏览器，在nightwath1.0以上之后：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/066b1a864a25d0905a177bb0057ab303.png#pic_center"/>
     </p>
     <blockquote>
      <p>
       1.自版本1.0以上之后，如果你只需要一个浏览器调试可以不用安装selenium server，
       <br/>
       2.或者你需要在ie上调试
      </p>
     </blockquote>
     <p>
      因为我们这里只需要一个chrome driver，所以也就不需要了
     </p>
     <h5>
      <a id="4_23">
      </a>
      4.配置文件
     </h5>
     <p>
      然后我们需要在项目的根目录创建一个用于启动nightwatch的配置文件：nightwatch.json或者nightwatch.conf.js
      <br/>
      这里我们偷个懒：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c2e57eb84c39a627f74c63d3ec361fba.png#pic_center">
       <br/>
       在版本1.3之后，如果根目录如果没有配置上面提到的两个文件中的任何一个，那个nightwatch会自动为我们创建一个，反之则不会有任何操作。
      </img>
     </p>
     <blockquote>
      <p>
       nightwatch --help
      </p>
     </blockquote>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1f2350cd5f63264652107ef9394b39dc.png#pic_center">
       <br/>
       可以看到有这么多运行的参数
      </img>
     </p>
     <blockquote>
      <p>
       nightwatch
      </p>
     </blockquote>
     <p>
      直接运行nightwatch，会报错，但是我们可以看到我们的根目录已经默认生成了一个默认的nightwatch配置：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/df16dbe2bc79ca408e71573f01b6ef4f.png#pic_center"/>
     </p>
     <pre><code>// Autogenerated by Nightwatch
// Refer to the online docs for more details: https://nightwatchjs.org/gettingstarted/configuration/
const Services = {}; loadServices();

module.exports = {
  // An array of folders (excluding subfolders) where your tests are located;
  // if this is not specified, the test source must be passed as the second argument to the test runner.
  src_folders: [],

  // See https://nightwatchjs.org/guide/working-with-page-objects/
  page_objects_path: '',

  // See https://nightwatchjs.org/guide/extending-nightwatch/#writing-custom-commands
  custom_commands_path:  '',

  // See https://nightwatchjs.org/guide/extending-nightwatch/#writing-custom-assertions
  custom_assertions_path: '',

  // See https://nightwatchjs.org/guide/#external-globals
  globals_path : '',

  webdriver: {},

  test_settings: {
    default: {
      disable_error_log: false,
      launch_url: 'https://nightwatchjs.org',

      screenshots: {
        enabled: false,
        path: 'screens',
        on_failure: true
      },

      desiredCapabilities: {
        browserName : 'firefox'
      },

      webdriver: {
        start_process: true,
        server_path: (Services.geckodriver ? Services.geckodriver.path : '')
      }
    },

    safari: {
      desiredCapabilities : {
        browserName : 'safari',
        alwaysMatch: {
          acceptInsecureCerts: false
        }
      },
      webdriver: {
        port: 4445,
        start_process: true,
        server_path: '/usr/bin/safaridriver'
      }
    },

    firefox: {
      desiredCapabilities : {
        browserName : 'firefox',
        alwaysMatch: {
          // Enable this if you encounter unexpected SSL certificate errors in Firefox
          // acceptInsecureCerts: true,
          'moz:firefoxOptions': {
            args: [
              // '-headless',
              // '-verbose'
            ],
          }
        }
      },
      webdriver: {
        start_process: true,
        port: 4444,
        server_path: (Services.geckodriver ? Services.geckodriver.path : ''),
        cli_args: [
          // very verbose geckodriver logs
          // '-vv'
        ]
      }
    },

    chrome: {
      desiredCapabilities : {
        browserName : 'chrome',
        chromeOptions : {
          // This tells Chromedriver to run using the legacy JSONWire protocol (not required in Chrome 78)
          // w3c: false,
          // More info on Chromedriver: https://sites.google.com/a/chromium.org/chromedriver/
          args: [
            //'--no-sandbox',
            //'--ignore-certificate-errors',
            //'--allow-insecure-localhost',
            //'--headless'
          ]
        }
      },

      webdriver: {
        start_process: true,
        port: 9515,
        server_path: (Services.chromedriver ? Services.chromedriver.path : ''),
        cli_args: [
          // --verbose
        ]
      }
    },

    //
    // Configuration for when using the browserstack.com cloud service               |
    //                                                                               |
    // Please set the username and access key by setting the environment variables:  |
    // - BROWSERSTACK_USER                                                           |
    // - BROWSERSTACK_KEY                                                            |
    // .env files are supported                                                      |
    //
    browserstack: {
      selenium: {
        host: 'hub-cloud.browserstack.com',
        port: 443
      },
      // More info on configuring capabilities can be found on:
      // https://www.browserstack.com/automate/capabilities?tag=selenium-4
      desiredCapabilities: {
        'bstack:options' : {
          local: 'false',
          userName: '${BROWSERSTACK_USER}',
          accessKey: '${BROWSERSTACK_KEY}',
        }
      },

      disable_error_log: true,
      webdriver: {
        keep_alive: true,
        start_process: false
      }
    },

    'browserstack.chrome': {
      extends: 'browserstack',
      desiredCapabilities: {
        browserName: 'chrome',
        chromeOptions : {
          // This tells Chromedriver to run using the legacy JSONWire protocol
          // More info on Chromedriver: https://sites.google.com/a/chromium.org/chromedriver/
          w3c: false
        }
      }
    },

    'browserstack.firefox': {
      extends: 'browserstack',
      desiredCapabilities: {
        browserName: 'firefox'
      }
    },

    'browserstack.ie': {
      extends: 'browserstack',
      desiredCapabilities: {
        browserName: 'IE',
        browserVersion: '11.0',
        'bstack:options' : {
          os: 'Windows',
          osVersion: '10',
          local: 'false',
          seleniumVersion: '3.5.2',
          resolution: '1366x768'
        }
      }
    },

    //
    // Configuration for when using the Selenium service, either locally or remote,  |
    //  like Selenium Grid                                                           |
    //
    selenium: {
      // Selenium Server is running locally and is managed by Nightwatch
      selenium: {
        start_process: true,
        port: 4444,
        server_path: (Services.seleniumServer ? Services.seleniumServer.path : ''),
        cli_args: {
          'webdriver.gecko.driver': (Services.geckodriver ? Services.geckodriver.path : ''),
          'webdriver.chrome.driver': (Services.chromedriver ? Services.chromedriver.path : '')
        }
      }
    },

    'selenium.chrome': {
      extends: 'selenium',
      desiredCapabilities: {
        browserName: 'chrome',
        chromeOptions : {
          w3c: false
        }
      }
    },

    'selenium.firefox': {
      extends: 'selenium',
      desiredCapabilities: {
        browserName: 'firefox',
        'moz:firefoxOptions': {
          args: [
            // '-headless',
            // '-verbose'
          ]
        }
      }
    }
  }
};

function loadServices() {
  try {
    Services.seleniumServer = require('selenium-server');
  } catch (err) {}

  try {
    Services.chromedriver = require('chromedriver');
  } catch (err) {}

  try {
    Services.geckodriver = require('geckodriver');
  } catch (err) {}
}
</code></pre>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/aef6753f908be3f270e44266941c2ecc.png#pic_center"/>
      <br/>
      因为默认的配置，默认去找firefox的配置，上面我只安装了chrome的配置，所以并没有，因此报错了。
      <br/>
      下面我们来看一下这个配置文件的配置的作用：
     </p>
     <table>
      <thead>
       <tr>
        <th>
         属性
        </th>
        <th>
         类型
        </th>
        <th>
         默认值
        </th>
        <th>
         描述
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td>
         test_settings
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
         定义所有测试环境的一个大对象，需要注意的是，一个defined 环境变量一般是必须的
        </td>
       </tr>
       <tr>
        <td>
         webdriver
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
         顾名思义，配置所有web驱动的地方
        </td>
       </tr>
       <tr>
        <td>
         src_folders
        </td>
        <td>
         string|array
        </td>
        <td>
        </td>
        <td>
         指定测试用例位置，这里如果没有定义，必须在运行时在命令行指定
        </td>
       </tr>
       <tr>
        <td>
         selenium
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
         配置selenuim server的地方
        </td>
       </tr>
       <tr>
        <td>
         custom_commands_path
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
         自定义命令的位置
        </td>
       </tr>
       <tr>
        <td>
         custom_assertions_path
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
         自定义断言的位置
        </td>
       </tr>
       <tr>
        <td>
         page_objects_path
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
        </td>
       </tr>
       <tr>
        <td>
         globals_path
        </td>
        <td>
         object
        </td>
        <td>
        </td>
        <td>
         外部全局模块的位置，该模块将作为属性全局变量在主客户端实例上加载并可供测试使用。全局变量也可以在test_settings环境中定义/覆盖。
        </td>
       </tr>
      </tbody>
     </table>
     <h5>
      <a id="5_281">
      </a>
      5.修改配置文件
     </h5>
     <p>
      因为我只安装了chromedriver，所以报错了，现在我们来修改配置，把项目跑起来吧
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/88742a524a71cb0be5ee12bd572da4ea.png#pic_center"/>
     </p>
     <h6>
      <a id="51_chromedriver_285">
      </a>
      5.1 更新默认使用chromedriver
     </h6>
     <p>
      修改默认的firefox为chrome
     </p>
     <pre><code class="prism language-javascript"><span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      disable_error_log<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      launch_url<span class="token punctuation">:</span> <span class="token string">'https://nightwatchjs.org'</span><span class="token punctuation">,</span>

      screenshots<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> <span class="token string">'screens'</span><span class="token punctuation">,</span>
        on_failure<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      desiredCapabilities<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        browserName <span class="token punctuation">:</span> <span class="token string">'chrome'</span>
        <span class="token comment">// browserName : 'firefox'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      webdriver<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        start_process<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        port<span class="token punctuation">:</span> <span class="token number">9515</span><span class="token punctuation">,</span>
        server_path<span class="token punctuation">:</span> <span class="token punctuation">(</span>Services<span class="token punctuation">.</span>chromedriver <span class="token operator">?</span> Services<span class="token punctuation">.</span>chromedriver<span class="token punctuation">.</span>path <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
     <p>
      再执行nightwatch
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cd4f4dbc55107267b28bdc2d5ce3533e.png#pic_center"/>
     </p>
     <h6>
      <a id="52__312">
      </a>
      5.2 配置测试文件路径
     </h6>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a23a89cc3a8a593641562556d334db9a.png#pic_center"/>
      <br/>
      这是我当前的路径
     </p>
     <blockquote>
      <ol>
       <li>
        在test目录下新建nightwatch文件夹
       </li>
       <li>
        在nightwatch目录下新建spec文件夹
       </li>
       <li>
        在spec下新建一个测试文件 first.js
       </li>
      </ol>
     </blockquote>
     <p>
      first.js
     </p>
     <pre><code class="prism language-javascript"><span class="token comment">// For authoring Nightwatch tests, see</span>
<span class="token comment">// http://nightwatchjs.org/guide#usage</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">'my first tests'</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>browser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    browser
    <span class="token comment">// 这里的url和端口要和vue dev配置的host和port一致</span>
      <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8080'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">waitForElementVisible</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>assert<span class="token punctuation">.</span><span class="token function">elementPresent</span><span class="token punctuation">(</span><span class="token string">'.hello'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>assert<span class="token punctuation">.</span><span class="token function">containsText</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'Welcome to Your Vue.js App'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>assert<span class="token punctuation">.</span><span class="token function">elementCount</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     <p>
      然后修改nightwatch.config.js
     </p>
     <pre><code class="prism language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// An array of folders (excluding subfolders) where your tests are located;</span>
  <span class="token comment">// if this is not specified, the test source must be passed as the second argument to the test runner.</span>
  src_folders<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'test/nightwatch/spec'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// src_folders: [],</span>
</code></pre>
     <p>
      到这里配置完成，开始美美的执行：
     </p>
     <blockquote>
      <p>
       nightwatch
      </p>
     </blockquote>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f494eea7336ba3ed075be7b2be536af6.png#pic_center"/>
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dc13d9654d5da10768b40fbb26204a4c.png#pic_center"/>
      <br/>
      提示是在5000ms之后，没检测到id为app的组件，原因是什么呢，因为vue在没有编译之间，是不能直接被浏览器解析的，所以我们是看不到这个页面，也就没有办法进行测试了
      <br/>
      然后翻nightwatch的文档
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/44fc5d1793e70782a92d5ef5609cd808.png#pic_center"/>
      <br/>
      告诉我们如果不是原生的开发，就需要使用这种进行测试
     </p>
     <h6>
      <a id="53_runnerjs_357">
      </a>
      5.3 配置runner.js
     </h6>
     <p>
      这里我参考了vue-cli生成的runner.js
     </p>
     <pre><code class="prism language-js"><span class="token comment">// 1. start the dev server using production config</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'testing'</span>

<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> DevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-server'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../build/webpack.prod.conf'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> devConfigPromise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../build/webpack.dev.conf'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> server

devConfigPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>devConfig <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> devServerOptions <span class="token operator">=</span> devConfig<span class="token punctuation">.</span>devServer
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span>
  server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DevServer</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> devServerOptions<span class="token punctuation">)</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> devServerOptions<span class="token punctuation">.</span>port
  <span class="token keyword">const</span> host <span class="token operator">=</span> devServerOptions<span class="token punctuation">.</span>host
  <span class="token keyword">return</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 2. run the nightwatch test suite against it</span>
    <span class="token comment">// to run in additional browsers:</span>
    <span class="token comment">//    1. add an entry in test/e2e/nightwatch.conf.js under "test_settings"</span>
    <span class="token comment">//    2. add it to the --env flag below</span>
    <span class="token comment">// or override the environment flag, for example: `npm run e2e -- --env chrome,firefox`</span>
    <span class="token comment">// For more information on Nightwatch's config file, see</span>
    <span class="token comment">// http://nightwatchjs.org/guide#settings-file</span>
    <span class="token keyword">let</span> opts <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'--config'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      opts <span class="token operator">=</span> opts<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'--config'</span><span class="token punctuation">,</span> <span class="token string">'nightwatch.conf.js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'--env'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      opts <span class="token operator">=</span> opts<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'--env'</span><span class="token punctuation">,</span> <span class="token string">'chrome'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cross-spawn'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> runner <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'./node_modules/.bin/nightwatch'</span><span class="token punctuation">,</span> opts<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> stdio<span class="token punctuation">:</span> <span class="token string">'inherit'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>runner<span class="token punctuation">)</span>
    runner<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    runner<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">throw</span> err
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
     <p>
      上面的代码的意思就是启动vue-dev服务之后，再启动nightwatch的测试，这样就能解决上面我们遇到的问题。
     </p>
     <blockquote>
      <p>
       node test/nightwatch/runner.js
      </p>
     </blockquote>
     <p>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a230faf803988b9603d2530564d34e03.png#pic_center"/>
      <br/>
      这里就运行成功啦
     </p>
    </img>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031323433363730342f:61727469636c652f64657461696c732f313038313835313037" class_="artid" style="display:none">
 </p>
</div>


