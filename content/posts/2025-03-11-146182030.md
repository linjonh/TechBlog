---
layout: post
title: "如何在-React-中实现错误边界"
date: 2025-03-11 16:16:37 +0800
description: "错误边界是一个 React 组件，可以捕获其子组件树中发生的 JavaScript 错误。渲染过程中发生的错误生命周期方法中发生的错误在构造函数中抛出的错误事件处理器中的错误异步代码中的错误（如setTimeoutPromise等）服务器端渲染中的错误自身抛出的错误错误边界是 React 中非常重要的一个特性，可以帮助开发者捕获和处理错误，提升用户体验。通过实现错误边界组件，可以优雅地处理子组件中的错误，并提供备用 UI。"
keywords: "如何在 React 中实现错误边界？"
categories: ['未分类']
tags: ['前端框架', '前端', 'React']
artid: "146182030"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146182030
    alt: "如何在-React-中实现错误边界"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146182030
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146182030
cover: https://bing.ee123.net/img/rand?artid=146182030
image: https://bing.ee123.net/img/rand?artid=146182030
img: https://bing.ee123.net/img/rand?artid=146182030
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     如何在 React 中实现错误边界？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_React__0">
     </a>
     在 React 中实现错误边界
    </h2>
    <p>
     错误边界是 React 提供的一种机制，用于捕获子组件树中的 JavaScript 错误，并展示回退 UI。它可以帮助开发者更好地处理错误，提升用户体验。本文将详细介绍如何在 React 中实现错误边界，包括其工作原理、实现步骤、最佳实践以及常见问题。
    </p>
    <h3>
     <a id="1__4">
     </a>
     1. 什么是错误边界？
    </h3>
    <p>
     错误边界是一个 React 组件，可以捕获其子组件树中发生的 JavaScript 错误。错误边界只会捕获以下两种类型的错误：
    </p>
    <ul>
     <li>
      渲染过程中发生的错误
     </li>
     <li>
      生命周期方法中发生的错误
     </li>
     <li>
      在构造函数中抛出的错误
     </li>
    </ul>
    <p>
     需要注意的是，错误边界不会捕获以下类型的错误：
    </p>
    <ul>
     <li>
      事件处理器中的错误
     </li>
     <li>
      异步代码中的错误（如
      <code>
       setTimeout
      </code>
      、
      <code>
       Promise
      </code>
      等）
     </li>
     <li>
      服务器端渲染中的错误
     </li>
     <li>
      自身抛出的错误
     </li>
    </ul>
    <h3>
     <a id="2__19">
     </a>
     2. 错误边界的工作原理
    </h3>
    <p>
     错误边界利用 React 的生命周期方法
     <code>
      componentDidCatch
     </code>
     和
     <code>
      getDerivedStateFromError
     </code>
     来捕获错误并更新组件状态。具体来说：
    </p>
    <ul>
     <li>
      <code>
       getDerivedStateFromError
      </code>
      ：当子组件抛出错误时，React 会调用此方法。你可以在此方法中更新状态以渲染备用 UI。
     </li>
     <li>
      <code>
       componentDidCatch
      </code>
      ：此生命周期方法在错误被捕获后调用，你可以在这里执行一些副作用，比如记录错误信息。
     </li>
    </ul>
    <h3>
     <a id="3__26">
     </a>
     3. 实现错误边界
    </h3>
    <h4>
     <a id="31__28">
     </a>
     3.1 创建错误边界组件
    </h4>
    <p>
     以下是一个简单的错误边界组件的实现：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 更新状态以渲染备用 UI</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 你可以在此处记录错误信息</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error caught by ErrorBoundary: "</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 渲染备用 UI</span>
            <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>出错了！请稍后再试。<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ErrorBoundary<span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="32__64">
     </a>
     3.2 使用错误边界组件
    </h4>
    <p>
     你可以将错误边界组件包裹在你想要监控的子组件周围。示例如下：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ErrorBoundary <span class="token keyword">from</span> <span class="token string">'./ErrorBoundary'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">BuggyComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 故意抛出错误</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"这是一个错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>ErrorBoundary<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>欢迎来到我的应用！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>BuggyComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre>
    <p>
     在这个例子中，当
     <code>
      BuggyComponent
     </code>
     抛出错误时，错误边界会捕获到错误，并渲染备用 UI。
    </p>
    <h3>
     <a id="4__91">
     </a>
     4. 错误边界的最佳实践
    </h3>
    <h4>
     <a id="41__93">
     </a>
     4.1 使用多个错误边界
    </h4>
    <p>
     在大型应用中，可能会有多个地方需要捕获错误。可以在应用中使用多个错误边界，以便更精细地控制错误处理。例如，你可以在某些特定的子树中使用错误边界，而在其他地方使用不同的错误边界。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ErrorBoundary<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ComponentA <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ErrorBoundary<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ComponentB <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="42__112">
     </a>
     4.2 记录错误信息
    </h4>
    <p>
     在
     <code>
      componentDidCatch
     </code>
     方法中，你可以将错误信息记录到外部服务中，例如 Sentry 或 LogRocket。这可以帮助你更好地了解应用中的错误。
    </p>
    <pre><code class="prism language-javascript"><span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 记录错误信息到外部服务</span>
    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="43__123">
     </a>
     4.3 提供用户反馈
    </h4>
    <p>
     在备用 UI 中，你可以提供更有用的信息，例如：
    </p>
    <ul>
     <li>
      提供重试按钮
     </li>
     <li>
      提供导航链接回到安全的页面
     </li>
     <li>
      提供错误报告功能
     </li>
    </ul>
    <pre><code class="prism language-javascript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>出错了！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
                    重试
                <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="5__148">
     </a>
     5. 错误边界的局限性
    </h3>
    <p>
     尽管错误边界非常有用，但它们也有一些局限性：
    </p>
    <h4>
     <a id="51__152">
     </a>
     5.1 不捕获某些错误
    </h4>
    <p>
     错误边界无法捕获事件处理器、异步代码或服务器端渲染中的错误。因此，仍然需要在这些地方做好错误处理。
    </p>
    <h4>
     <a id="52__156">
     </a>
     5.2 组件不应成为错误边界
    </h4>
    <p>
     错误边界应该是高阶组件，通常不应该将它们与业务逻辑混合在一起。为了保持代码的可读性和可维护性，建议将错误边界单独定义。
    </p>
    <h4>
     <a id="53__160">
     </a>
     5.3 状态管理
    </h4>
    <p>
     错误边界的状态管理可能会变得复杂，特别是在有多个错误边界的情况下。建议使用状态管理库（如 Redux 或 Zustand）来集中管理错误状态。
    </p>
    <h3>
     <a id="6__164">
     </a>
     6. 处理网络请求中的错误
    </h3>
    <p>
     在处理网络请求时，可以结合错误边界与其他错误处理机制。通常，可以在组件内部使用
     <code>
      try-catch
     </code>
     块来捕获网络请求的错误。例如：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">DataFetchingComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://api.example.com/data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"网络错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>获取数据失败：<span class="token punctuation">{<!-- --></span>error<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>data <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">"加载中..."</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     在这个例子中，网络请求的错误被捕获并在组件内部处理，而不是通过错误边界。
    </p>
    <h3>
     <a id="7__202">
     </a>
     7. 总结
    </h3>
    <p>
     错误边界是 React 中非常重要的一个特性，可以帮助开发者捕获和处理错误，提升用户体验。通过实现错误边界组件，可以优雅地处理子组件中的错误，并提供备用 UI。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363533383031322f:61727469636c652f64657461696c732f313436313832303330" class_="artid" style="display:none">
 </p>
</div>


