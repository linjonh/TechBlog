---
layout: post
title: "go程序调用k8s-pod副本的名称IP手动赋值给configmap的参数"
date: 2025-03-13 18:36:07 +0800
description: "2、创建deployment，其中包含initContainers和containers两部分。至此go程序通过自己提交ip和服务信息注册到etcd已成功完成。3、启动deployment并登录容器验证结果。查询configmap文本内容。4、登录etcd查看注册情况。1、创建configmap。"
keywords: "go程序调用k8s pod副本的名称IP手动赋值给configmap的参数"
categories: ['Kubernetes', 'K', 'Golang']
tags: ['Kubernetes', 'Golang']
artid: "146239216"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146239216
    alt: "go程序调用k8s-pod副本的名称IP手动赋值给configmap的参数"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146239216
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146239216
cover: https://bing.ee123.net/img/rand?artid=146239216
image: https://bing.ee123.net/img/rand?artid=146239216
img: https://bing.ee123.net/img/rand?artid=146239216
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     go程序调用k8s pod副本的名称IP手动赋值给configmap的参数
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     1、创建configmap
    </p>
    <pre><code class="prism language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">config.yaml</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token punctuation">-</span>
    <span class="token comment"># config.yaml</span>


    <span class="token key atrule">Etcd</span><span class="token punctuation">:</span>
      <span class="token key atrule">Endpoints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"etcd-server:2379"</span>
      <span class="token key atrule">Username</span><span class="token punctuation">:</span> <span class="token string">""</span>
      <span class="token key atrule">Password</span><span class="token punctuation">:</span> <span class="token string">""</span>

    <span class="token key atrule">Exchanges</span><span class="token punctuation">:</span>
      <span class="token comment">#- Name: "Binance"</span>
      <span class="token comment">#  Symbol: "BTCUSDT"</span>
      <span class="token comment">#  WSUrl: "wss://fstream.binance.com/ws"</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"OKX"</span>
        <span class="token key atrule">Symbol</span><span class="token punctuation">:</span> <span class="token string">"BTCUSDT"</span>
        <span class="token key atrule">WSUrl</span><span class="token punctuation">:</span> <span class="token string">"wss://ws.okx.com:8443/ws/v5/public"</span>
      <span class="token comment">#- Name: "Bybit"</span>
      <span class="token comment">#  Symbol: "ETHUSDT"</span>
      <span class="token comment">#  WSUrl: "wss://stream.bybit.com/v5/public/linear"</span>
      <span class="token comment">#- Name: "Bitget"</span>
      <span class="token comment">#  Symbol: "DOGEUSDT"</span>
      <span class="token comment">#  WSUrl: "wss://ws.bitget.com/mix/v1/stream"</span>
      <span class="token comment">#  ContractType: "mc"</span>
      <span class="token comment">#- Name: "Pyth"</span>
      <span class="token comment">#  Symbol: "BTCUSDT"</span>
      <span class="token comment">#  WSUrl: "wss://hermes.pyth.network/ws"</span>
      <span class="token comment">#  PriceId: "e62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43"</span>

    <span class="token key atrule">DatabaseDSN</span><span class="token punctuation">:</span>
    <span class="token string">"abc:defg@tcp(rm-sefdref.mysql.rds.aliyuncs.com:3306)/miniapp"</span>


    <span class="token key atrule">RedisAddr</span><span class="token punctuation">:</span> <span class="token string">"0.0.0.0:6379"</span>

    <span class="token key atrule">RedisPassword</span><span class="token punctuation">:</span> <span class="token string">"S4t#d%dgrdfer3"</span>

    <span class="token key atrule">RedisDB</span><span class="token punctuation">:</span> <span class="token number">1</span>


    <span class="token key atrule">KafkaBrokers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"0.0.0.0:3195"</span>

    <span class="token key atrule">BOT_TOKEN</span><span class="token punctuation">:</span> <span class="token string">"sefefedsfa:AAELY1TwInw46D3Lhpl0LvpQz2v-DoIq5ww"</span>


    <span class="token key atrule">KafkaPriceUpdateTopic</span><span class="token punctuation">:</span> <span class="token string">"price_updates"</span>


    <span class="token key atrule">SupportedCoins</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"BTC"</span>
      <span class="token punctuation">-</span> <span class="token string">"ETH"</span>
    <span class="token comment">#</span>

    <span class="token comment">#Chains:</span>

    <span class="token comment">#  - Name: "ETH"</span>

    <span class="token comment">##    ChainName: "ETH"</span>

    <span class="token comment">##    NodeUrl:</span>
    <span class="token string">"https://crimson-frosty-county.quiknode.pro/serfefwaetwegrteyhtdrtyhfhyjhtf/"</span>

    <span class="token comment">##    ConfirmationNum: 16</span>

    <span class="token comment">#    ExcludedAddresses: "11","22"</span>

    <span class="token comment">##    ScanInterval: 60</span>

    <span class="token comment">#</span>


    <span class="token key atrule">BaseSlippage</span><span class="token punctuation">:</span> <span class="token number">0.005</span>


    <span class="token comment">#Port: "0.0.0.0:8901"</span>


    <span class="token key atrule">LogLevel</span><span class="token punctuation">:</span> <span class="token string">"info"</span>



    <span class="token key atrule">Services</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"api_gateway"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"api-gateway-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"api_gateway"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"spider_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"spider-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"spider_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50051</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"${SERVICE_NAME}"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"${SERVICE_ID}"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"${POD_IP}"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>SERVICE_PORT<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"trading_engine_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"trading-engine-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"trading_engine_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50053</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"auth_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"auth-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"auth_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50054</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"user_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"user-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"user_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50055</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"account_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"account-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"account_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50056</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"wallet_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"wallet-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"wallet_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50057</span>
    <span class="token comment">#    HttpPort : 8091</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"chain_scanner_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"chain-scanner-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"chain_scanner_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50058</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"out_service"</span>
        <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"out-service-1"</span>
        <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"out_service"</span>
        <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50059</span>

    <span class="token key atrule">SlippageTiers</span><span class="token punctuation">:</span>
      <span class="token key atrule">tier1</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">Threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span>
          <span class="token key atrule">Factor</span><span class="token punctuation">:</span> <span class="token number">0.001</span>
        <span class="token punctuation">-</span> <span class="token key atrule">Threshold</span><span class="token punctuation">:</span> <span class="token number">5000</span>
          <span class="token key atrule">Factor</span><span class="token punctuation">:</span> <span class="token number">0.0008</span>
      <span class="token key atrule">tier2</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">Threshold</span><span class="token punctuation">:</span> <span class="token number">10000</span>
          <span class="token key atrule">Factor</span><span class="token punctuation">:</span> <span class="token number">0.0005</span>

    <span class="token key atrule">GameOptions</span><span class="token punctuation">:</span>
      <span class="token key atrule">TenantId</span><span class="token punctuation">:</span> <span class="token number">90026</span>
      <span class="token key atrule">ProductCode</span><span class="token punctuation">:</span> UD_OPTION
      <span class="token key atrule">ExitUrl</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//t.me/abc/Good
      <span class="token key atrule">AccessCode</span><span class="token punctuation">:</span> <span class="token number">15224562686655</span>
      <span class="token key atrule">IvValue</span><span class="token punctuation">:</span> DJIOHFDsaifiajfiwefjqwi63
      <span class="token key atrule">GetUrl</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//abc.pro/saas<span class="token punctuation">-</span>option<span class="token punctuation">-</span>api/open/tenant/getSaasOptionUrl
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> config.yaml
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">'150039730'</span>


</code></pre>
    <p>
     2、创建deployment，其中包含initContainers和containers两部分
    </p>
    <pre><code class="prism language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s.kuboard.cn/displayName</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s.kuboard.cn/name</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
  <span class="token key atrule">name</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">'150036998'</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">progressDeadlineSeconds</span><span class="token punctuation">:</span> <span class="token number">600</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s.kuboard.cn/name</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> 25%
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> 25%
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s.kuboard.cn/name</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVICE_ID
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
          <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'harbor.cuiwjrpcvi.com/bktest/bot_service:test'</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">name</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">50052</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> adwqdw
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
          <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
          <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /telegram/shared/config
              <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>output
      <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
      <span class="token key atrule">hostAliases</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">hostnames</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> etcd<span class="token punctuation">-</span>server
          <span class="token key atrule">ip</span><span class="token punctuation">:</span> 172.16.1.193
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> harbor<span class="token punctuation">-</span>secret
      <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token punctuation">&gt;</span><span class="token punctuation">-</span>
              apk add <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>cache gettext <span class="token important">&amp;&amp;</span> envsubst &lt;
              /config<span class="token punctuation">-</span>template/config.yaml <span class="token punctuation">&gt;</span>
              /telegram/shared/config/config.yaml;
          <span class="token key atrule">command</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> /bin/sh
            <span class="token punctuation">-</span> <span class="token string">'-c'</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVICE_ID
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_IP
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> status.podIP
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVICE_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVICE_PORT
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'50052'</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'alpine:3.17'</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">name</span><span class="token punctuation">:</span> bot<span class="token punctuation">-</span>service<span class="token punctuation">-</span>init
          <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
          <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
          <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /config<span class="token punctuation">-</span>template
              <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>template
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /telegram/shared/config/
              <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>output
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
      <span class="token key atrule">schedulerName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>scheduler
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">420</span>
            <span class="token key atrule">items</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> config.yaml
                <span class="token key atrule">path</span><span class="token punctuation">:</span> config.yaml
            <span class="token key atrule">name</span><span class="token punctuation">:</span> config.yaml
          <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>template
        <span class="token punctuation">-</span> <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>output
</code></pre>
    <p>
     3、启动deployment并登录容器验证结果
     <br/>
     查询configmap文本内容
     <br/>
     节点一
    </p>
    <pre><code class="prism language-yaml">cat shared/config/config.yaml
。。。。。。
  <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"bot-service"</span>
    <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"bot-service-5c7745fff4-c8w6b"</span>
    <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"172.20.250.31"</span>
    <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50052</span>
。。。。。。    
</code></pre>
    <p>
     节点二
    </p>
    <pre><code class="prism language-yaml">cat shared/config/config.yaml
。。。。。。
  <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> <span class="token string">"bot-service"</span>
    <span class="token key atrule">ServiceID</span><span class="token punctuation">:</span> <span class="token string">"bot-service-5c7745fff4-8p72g"</span>
    <span class="token key atrule">ServiceHost</span><span class="token punctuation">:</span> <span class="token string">"172.20.171.3"</span>
    <span class="token key atrule">ServicePort</span><span class="token punctuation">:</span> <span class="token number">50052</span>
。。。。。。    
</code></pre>
    <p>
     4、登录etcd查看注册情况
    </p>
    <pre><code class="prism language-bash">root@iZj6ch896i3lsjbs6cqk2iZ:/data/docker-compose/bot_service<span class="token comment"># docker exec -it etcd-server /bin/bash</span>
I have no name<span class="token operator">!</span>@etcd-server:/opt/bitnami/etcd$ etcdctl get <span class="token parameter variable">--prefix</span> /service
/services/bot/bot-service-5c7745fff4-8p72g
<span class="token number">172.20</span>.171.3:50052
/services/bot/bot-service-5c7745fff4-c8w6b
<span class="token number">172.20</span>.250.31:50052
</code></pre>
    <p>
     至此go程序通过自己提交ip和服务信息注册到etcd已成功完成
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f62616964755f33383433323733322f:61727469636c652f64657461696c732f313436323339323136" class_="artid" style="display:none">
 </p>
</div>


