---
layout: post
title: "SQL查询-设置局部变量PostgreSQLMySQL"
date: 2025-08-25T17:34:53+0800
description: "在工作中编写复杂SQL语句时，经常需要替换查询值进行测试。所以需要用到局部变量设置，可以减轻测试时的压力。"
keywords: "SQL查询-设置局部变量（PostgreSQL、MySQL）"
categories: ['未分类']
tags: ['Sql', 'Postgresql', 'Mysql']
artid: "150762795"
arturl: "https://blog.csdn.net/qq_36782325/article/details/150762795"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150762795
    alt: "SQL查询-设置局部变量PostgreSQLMySQL"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150762795
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150762795
cover: https://bing.ee123.net/img/rand?artid=150762795
image: https://bing.ee123.net/img/rand?artid=150762795
img: https://bing.ee123.net/img/rand?artid=150762795
---



# SQL查询-设置局部变量（PostgreSQL、MySQL）



😋博主在工作中编写复杂SQL语句时，经常需要替换查询值进行测试。所以需要用到局部变量设置，可以减轻测试时的压力。

## 使用场景

🤔在user_info表、user_info_ex表、user_info_in表，三个表中查询工号为’STAF0306’的记录并返回，SQL示例如下。

### 1.常规写法

```javascript
select 
	user_id, user_name, user_code
from user_info
where
	user_code = 'STAF0306'
	
union 

select 
	user_id, user_name, user_code
from user_info_ex
where
	user_code = 'STAF0306'

union 

select 
	user_id, user_name, user_code
from user_info_in
where
	user_code = 'STAF0306'

```

### 2.局部变量写法

如果需要改为查询’STAF0308’的工号时，需要替换三个位置。在简单的语句中替换没有什么影响，但如果在复杂的SQL中，可能会出现漏改的情况😥。

所以，我们可以在顶部显眼位置设置**局部参数**，直接修改所需的入参，可无视复杂的SQL语句👏。

#### （1）PostgreSQL示例

🙆‍♂️使用current_setting(‘parameter_name’) 来获取参数值，并注意设置对应的参数类型

```javascript
SET my.user_code TO 'STAF0308';

select 
	user_id, user_name, user_code
from user_info
where
	user_code = current_setting('my.user_code')::VARCHAR
	
union 

select 
	user_id, user_name, user_code
from user_info_external
where
	user_code = current_setting('my.user_code')::VARCHAR

```

##### 注意事项

```
1）SET LOCAL 需要在事务块中使用（BEGIN...COMMIT）
2）使用 SET 可以在事务外使用
3）参数值总是字符串，需要根据需要进行类型转换

```

#### （2）MySQL示例

🙆‍♀️用户变量以 @ 开头，在会话内有效，注意大小写。

```javascript

SET @user_code = 'STAF0308';

select 
	user_id, user_name, user_code
from user_info
where
	user_code = @user_code
	
union 

select 
	user_id, user_name, user_code
from user_info_external
where
	user_code = @user_code

union 

select 
	user_id, user_name, user_code
from user_info_in
where
	user_code = @user_code

```

##### 注意事项

```
1）用户变量以 @ 开头，在会话内有效
2）局部变量在存储过程内使用 DECLARE 定义，不以 @ 开头
3）变量名区分大小写
4）用户变量会在会话结束后自动清除

```

## 结语

🎈以上博主仅列出了两种较为简单的设置局部变量方式，还有许多其他的设置方式就不做扩展说明了，感谢阅读。



