---
layout: post
title: "MyBatis-SqlSession-的作用,以及如何使用-SqlSession-执行-SQL-语句"
date: 2025-03-10 09:26:17 +0800
description: "对于保证 MyBatis 应用程序的正确性和性能至关重要。推荐使用 Mapper 接口的方式来执行 SQL 语句，这种方式更加简洁、类型安全，并且易于维护。是 MyBatis 中执行 SQL 语句、管理事务和获取 Mapper 接口实例的核心接口。是 MyBatis 中非常重要的一个接口，它代表了与数据库的一次会话（session）。在应用程序的生命周期内只需要创建一个实例（单例模式）。对象加上一系列操作数据库的方法。方法关闭会话，释放资源。，以确保资源被正确释放。），需要手动提交事务（"
keywords: "sqlsession.select 怎么使用"
categories: ['源码系列', 'Mybatis']
tags: ['Sql', 'Mybatis']
artid: "146100297"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146100297
    alt: "MyBatis-SqlSession-的作用,以及如何使用-SqlSession-执行-SQL-语句"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146100297
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146100297
cover: https://bing.ee123.net/img/rand?artid=146100297
image: https://bing.ee123.net/img/rand?artid=146100297
img: https://bing.ee123.net/img/rand?artid=146100297
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MyBatis SqlSession 的作用，以及如何使用 SqlSession 执行 SQL 语句
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <code>
      SqlSession
     </code>
     是 MyBatis 中非常重要的一个接口，它代表了与数据库的一次会话（session）。 可以将
     <code>
      SqlSession
     </code>
     理解为 JDBC 中的
     <code>
      Connection
     </code>
     对象加上一系列操作数据库的方法。 它负责：
    </p>
    <p>
     <strong>
      SqlSession 的作用：
     </strong>
    </p>
    <ol>
     <li>
      <strong>
       执行 SQL 语句:
      </strong>
      <code>
       SqlSession
      </code>
      提供了执行 SQL 语句的方法，包括
      <code>
       select
      </code>
      、
      <code>
       insert
      </code>
      、
      <code>
       update
      </code>
      和
      <code>
       delete
      </code>
      操作。
     </li>
     <li>
      <strong>
       获取 Mapper 接口的实例:
      </strong>
      <code>
       SqlSession
      </code>
      可以获取 Mapper 接口的代理对象，从而通过 Mapper 接口来执行 SQL 语句 (这是推荐的方式)。
     </li>
     <li>
      <strong>
       管理事务:
      </strong>
      <code>
       SqlSession
      </code>
      可以控制事务的提交（commit）和回滚（rollback）。
     </li>
     <li>
      <strong>
       维护数据库连接:
      </strong>
      <code>
       SqlSession
      </code>
      内部持有数据库连接（
      <code>
       Connection
      </code>
      ），并在会话结束时负责关闭连接（除非使用了外部事务管理器，如 Spring 的事务管理）。
     </li>
     <li>
      <strong>
       缓存管理(一级缓存):
      </strong>
      <code>
       SqlSession
      </code>
      拥有一个本地缓存（一级缓存），可以缓存查询结果，减少数据库访问次数（默认开启）。
     </li>
    </ol>
    <p>
     <strong>
      如何使用 SqlSession 执行 SQL 语句：
     </strong>
    </p>
    <p>
     <code>
      SqlSession
     </code>
     的使用通常遵循以下步骤：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        获取
        <code>
         SqlSessionFactory
        </code>
        :
       </strong>
       <code>
        SqlSessionFactory
       </code>
       是
       <code>
        SqlSession
       </code>
       的工厂，负责创建
       <code>
        SqlSession
       </code>
       对象。通常情况下，
       <code>
        SqlSessionFactory
       </code>
       在应用程序的生命周期内只需要创建一个实例（单例模式）。
       <code>
        SqlSessionFactory
       </code>
       可以通过 XML 配置文件或 Java 代码来创建。
      </p>
     </li>
     <li>
      <p>
       <strong>
        通过
        <code>
         SqlSessionFactory
        </code>
        打开
        <code>
         SqlSession
        </code>
        :
       </strong>
       使用
       <code>
        SqlSessionFactory
       </code>
       的
       <code>
        openSession()
       </code>
       方法打开一个新的
       <code>
        SqlSession
       </code>
       。
      </p>
     </li>
     <li>
      <p>
       <strong>
        执行 SQL 语句:
       </strong>
      </p>
      <ul>
       <li>
        <strong>
         直接使用
         <code>
          SqlSession
         </code>
         的 API (不推荐):
        </strong>
        使用
        <code>
         SqlSession
        </code>
        的
        <code>
         selectOne()
        </code>
        、
        <code>
         selectList()
        </code>
        、
        <code>
         insert()
        </code>
        、
        <code>
         update()
        </code>
        、
        <code>
         delete()
        </code>
        等方法直接执行 SQL 语句。 这种方式需要传入 SQL 语句的 ID（在 XML 映射文件中定义）和参数。
       </li>
       <li>
        <strong>
         获取 Mapper 接口的代理对象 (推荐):
        </strong>
        使用
        <code>
         SqlSession
        </code>
        的
        <code>
         getMapper()
        </code>
        方法获取 Mapper 接口的代理对象，然后调用 Mapper 接口的方法来执行 SQL 语句。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        提交或回滚事务 (如果需要):
       </strong>
       如果进行了数据库修改操作（
       <code>
        insert
       </code>
       、
       <code>
        update
       </code>
       、
       <code>
        delete
       </code>
       ），需要手动提交事务（
       <code>
        commit()
       </code>
       ）或回滚事务（
       <code>
        rollback()
       </code>
       ）。 如果只进行了查询操作（
       <code>
        select
       </code>
       ），则不需要。
      </p>
     </li>
     <li>
      <p>
       <strong>
        关闭
        <code>
         SqlSession
        </code>
        :
       </strong>
       使用
       <code>
        SqlSession
       </code>
       的
       <code>
        close()
       </code>
       方法关闭会话，释放资源。 务必在
       <code>
        finally
       </code>
       块中关闭
       <code>
        SqlSession
       </code>
       ，以确保资源被正确释放。
      </p>
     </li>
    </ol>
    <p>
     <strong>
      代码示例 (两种方式):
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resources</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSession</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">SqlSessionFactoryBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span></span><span class="token punctuation">;</span> <span class="token comment">// 假设的 Mapper 接口</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span> <span class="token comment">// 假设的 User 实体类</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisExample</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 获取 SqlSessionFactory</span>
        <span class="token class-name">String</span> resource <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span> <span class="token comment">// MyBatis 配置文件路径</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 方式一：直接使用 SqlSession 的 API (不推荐)</span>
        <span class="token class-name">SqlSession</span> session1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            session1 <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 执行查询</span>
            <span class="token class-name">User</span> user1 <span class="token operator">=</span> session1<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span><span class="token string">"com.example.mapper.UserMapper.selectUserById"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// namespace + id</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方式一 (selectOne): "</span> <span class="token operator">+</span> user1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 执行插入</span>
            <span class="token class-name">User</span> newUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"testuser"</span><span class="token punctuation">,</span> <span class="token string">"testpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> rowsAffected <span class="token operator">=</span> session1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"com.example.mapper.UserMapper.insertUser"</span><span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方式一 (insert): 插入了 "</span> <span class="token operator">+</span> rowsAffected <span class="token operator">+</span> <span class="token string">" 行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 执行更新</span>
             newUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"newpassword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            session1<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"com.example.mapper.UserMapper.updateUser"</span><span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//需要手动提交</span>
            session1<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>session1 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                session1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 方式二：获取 Mapper 接口的代理对象 (推荐)</span>
        <span class="token class-name">SqlSession</span> session2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            session2 <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取 Mapper 接口的实例</span>
            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> session2<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 执行查询</span>
            <span class="token class-name">User</span> user2 <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方式二 (Mapper 接口): "</span> <span class="token operator">+</span> user2<span class="token punctuation">)</span><span class="token punctuation">;</span>

             <span class="token comment">// 执行查询</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUsersByName</span><span class="token punctuation">(</span><span class="token string">"%test%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//假设定义了一个getUsersByName的方法</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方式二 (Mapper 接口, List): "</span> <span class="token operator">+</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">// 执行插入</span>
            <span class="token class-name">User</span> newUser2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"testuser2"</span><span class="token punctuation">,</span> <span class="token string">"testpassword2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> rowsAffected2 <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>newUser2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方式二 (Mapper 接口, insert): 插入了 "</span> <span class="token operator">+</span> rowsAffected2 <span class="token operator">+</span> <span class="token string">" 行, 新用户 ID: "</span> <span class="token operator">+</span> newUser2<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//假设使用了自增主键</span>

            <span class="token comment">//执行删除</span>
            userMapper<span class="token punctuation">.</span><span class="token function">deleteUserById</span><span class="token punctuation">(</span>newUser2<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//假设定义了一个deleteUserById方法</span>
            
            <span class="token comment">// 提交事务</span>
            session2<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//出现异常回滚</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>session2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                session2<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>session2 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                session2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      重要说明:
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       线程安全:
      </strong>
      <code>
       SqlSession
      </code>
      对象不是线程安全的，每个线程应该拥有自己的
      <code>
       SqlSession
      </code>
      实例。 不要将
      <code>
       SqlSession
      </code>
      实例作为类的成员变量或静态变量，否则会导致并发问题。 应该在方法内部创建和使用
      <code>
       SqlSession
      </code>
      。
     </li>
     <li>
      <strong>
       事务管理:
      </strong>
      <code>
       openSession()
      </code>
      方法有多个重载版本：
      <ul>
       <li>
        <code>
         openSession()
        </code>
        : 默认不自动提交事务。
       </li>
       <li>
        <code>
         openSession(true)
        </code>
        : 自动提交事务（一般不推荐，除非你确定每次操作都立即提交）。
       </li>
       <li>
        <code>
         openSession(ExecutorType executorType)
        </code>
        : 指定执行器类型（
        <code>
         SIMPLE
        </code>
        、
        <code>
         REUSE
        </code>
        、
        <code>
         BATCH
        </code>
        ）。
       </li>
       <li>
        <code>
         openSession(Connection connection)
        </code>
        : 使用外部提供的数据库连接。
       </li>
       <li>
        <code>
         openSession(TransactionIsolationLevel level)
        </code>
        : 设置事务隔离级别。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       与 Spring 集成:
      </strong>
      在 Spring 项目中，通常不需要手动创建和关闭
      <code>
       SqlSession
      </code>
      ，Spring 会通过
      <code>
       SqlSessionTemplate
      </code>
      或
      <code>
       MapperFactoryBean
      </code>
      来管理
      <code>
       SqlSession
      </code>
      的生命周期，并自动处理事务。
     </li>
     <li>
      <strong>
       一级缓存:
      </strong>
      默认情况下，MyBatis 会为每个
      <code>
       SqlSession
      </code>
      开启一级缓存。在同一个
      <code>
       SqlSession
      </code>
      中，如果执行相同的 SQL 查询（相同的 SQL 语句和参数），MyBatis 会直接从缓存中获取结果，而不会再次访问数据库。 一级缓存的范围是
      <code>
       SqlSession
      </code>
      级别的。 可以通过
      <code>
       session.clearCache()
      </code>
      方法清除一级缓存。
     </li>
    </ul>
    <p>
     总而言之，
     <code>
      SqlSession
     </code>
     是 MyBatis 中执行 SQL 语句、管理事务和获取 Mapper 接口实例的核心接口。推荐使用 Mapper 接口的方式来执行 SQL 语句，这种方式更加简洁、类型安全，并且易于维护。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6e6d736f66746b6c622f:61727469636c652f64657461696c732f313436313030323937" class_="artid" style="display:none">
 </p>
</div>


