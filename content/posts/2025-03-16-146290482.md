---
layout: post
title: "使用Node.js和Express搭建图片缓存服务或应用服务器"
date: 2025-03-16 08:40:31 +0800
description: "【代码】使用Node.js和Express搭建图片缓存服务或应用服务器。"
keywords: "使用Node.js和Express搭建图片缓存服务或应用服务器"
categories: ['Nodejs']
tags: ['Node', 'Express']
artid: "146290482"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146290482
    alt: "使用Node.js和Express搭建图片缓存服务或应用服务器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146290482
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146290482
cover: https://bing.ee123.net/img/rand?artid=146290482
image: https://bing.ee123.net/img/rand?artid=146290482
img: https://bing.ee123.net/img/rand?artid=146290482
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用Node.js和Express搭建图片缓存服务或应用服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h5>
     使用Node.js和Express生成缩略图：
    </h5>
    <pre><code class="hljs">const express = require('express');
const sharp = require('sharp');
const app = express();
const port = 3000;
 
app.get('/thumbnail/:filename', async (req, res) =&gt; {
    const filename = req.params.filename;
    const imagePath = `/path/to/images/${filename}`;
    sharp(imagePath)
        .resize(100, 100) // 设置缩略图尺寸
        .toBuffer()
        .then(data =&gt; {
            res.type('jpeg'); // 根据需要设置正确的MIME类型
            res.send(data);
        })
        .catch(err =&gt; {
            console.error(err);
            res.status(500).send('Error generating thumbnail');
        });
});
 
app.listen(port, () =&gt; {
    console.log(`Thumbnail server running at http://localhost:${port}`);
});</code></pre>
    <p>
     <strong>
      配置nginx反向代理
     </strong>
     ：
    </p>
    <pre><code class="hljs">location /thumbnail/ {
    proxy_pass http://localhost:3000/; # Node.js应用地址
    proxy_set_header Host $host; # 传递主机头信息到后端服务器
    proxy_set_header X-Real-IP $remote_addr; # 传递客户端IP地址到后端服务器
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 传递X
}</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f7477696e73333532302f:61727469636c652f64657461696c732f313436323930343832" class_="artid" style="display:none">
 </p>
</div>


