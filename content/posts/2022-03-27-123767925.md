---
layout: post
title: "入住阿里云MQTT物联网平台"
date: 2022-03-27 15:44:11 +0800
description: "注册阿里云平台账号，创建产品和设备，设置“云产品流转”，为连接上阿里云物联网平台做准备。_阿里物联网"
keywords: "阿里物联网 是先订阅还是先发布"
categories: ['未分类']
tags: ['大数据']
artid: "123767925"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=123767925
  alt: "入住阿里云MQTT物联网平台"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123767925
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123767925
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     入住阿里云MQTT物联网平台
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <ul>
     <li style="text-align:justify;">
      注册阿里云：
     </li>
    </ul>
    <p style="margin-left:.0001pt;text-align:justify;">
     网址：
     <a href="https://www.aliyun.com/" rel="nofollow" title="阿里云-上云就上阿里云">
      阿里云-上云就上阿里云
     </a>
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     进入阿里云平台主页，点右上角“立即注册”，你可以选择“扫码快速注册”或“账号密码注册”两种方式进行注册。我用的是第一种方式，打开支付宝，扫码进入服务授权页，点“确认授权”，然后进入“身份验证”，使用绑定手机进行验证，余下步骤按提示操作就是了。
    </p>
    <ul>
     <li style="text-align:justify;">
      登陆，开通企业版实例免费试用。
     </li>
    </ul>
    <p style="margin-left:.0001pt;text-align:justify;">
     使用前面注册的账号进行登陆，可以直接支付宝扫码登陆，也可以下载安装阿里APP扫码登陆，效果一样。点右上角“控制台”，进入后点左边的“物联网平台”，在左上角“工作台”旁边有一个类似“华东2（上海）”的选项，你可以在这里选择使用哪一个主站服务器。接下来的操作都是针对该站进行操作，以后使用产品实例连接也是这个站点。点“购买企业版实例”里面的那个“快速入门”，在接下来的入门介绍页面点“物联网平台试用中心”，在下面“优选试用产品0元起体验”中选择“企业物联网平台”下面的“立即试用”。之后你就可以开始构建自己的企业产品实例了。
    </p>
    <ul>
     <li style="text-align:justify;">
      构建企业版公共产品实例，获得设备三元组。
     </li>
    </ul>
    <p style="margin-left:.0001pt;text-align:justify;">
     按第二步:登陆à控制台à物联网平台à你会在设备概览页看到“公共实例”“已开通”字样。点击“公共实例”，接下来“设备管理”à“产品”à“创建产品”，进入新建产品（设备模型）页。“产品名称”随意，可以使用中文，“所属品类”选择“自定义品类”，节点类型选择“直连设备”，连网方式选择默认的“Wi-Fi”，“数据格式”选“ICA标准数据模式（AlinkJSON）”，最后点击“确认”按钮。系统提示创建产品成功，你可以点“添加设备”下面的“前往添加”进入添加设备页面。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     你也可以点左边的“设备管理”项下面的“产品”查看刚刚建立的产品列表，其右边“操作”项下有一个“管理设备”按钮，点击也可以进入设备管理页。在“设备列表”下面有一个“添加设备”按钮，点击后进入添加设备对话框。“产品”项选择刚建立的产品，“DeviceName”项填设备名称，请使用英文字母，下面的备注名称可以使用中文。点“确认”，系统提示添加设备成功，点“完成”回到设备查看页，你会看到刚刚建立的设备，显示为“未激活”状态。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     点左边“设备管理”下面的“产品”，在我们建立的产品列表后面有一个“查看”按钮，点击它，在接下来的页面中右上角有一个蓝色的“发布”按钮，点击该按钮，在出现的对话框里将“第一步”“第二步”“第三步”后面的“请确认”全部打上勾，点击“发布”，到这里就算是彻底完成了产品和设备的创建工作了。最后，找到你刚刚建立的设备，点“查看”，接下来的页面中你会看到设备密钥项“DeviceSecret”后面有几个星星，再后面有个“查看”按钮，点击它，在弹出的对话框里，你可以看到设备三元组信息。其中Productkey表示产品名，DeviceName表示设备名，DeviceSecret表示设备密钥，保存这些信息，以备连接使用。
    </p>
    <ul>
     <li style="text-align:justify;">
      完善产品物模型功能，保持与实际硬件功能一致。
     </li>
    </ul>
    <p style="margin-left:.0001pt;text-align:justify;">
     这里还需要做两件事：一、添加自定义属性。二、添加自定义消息发布和订阅主题Topic。点左边“设备管理”下面的“产品”，点刚建立的产品右边的“查看”，点右上角的“撤消发布”（必须撤消发布，修改后再发布上线）接下来点“功能定义”à“编辑草稿”à“添加自定义功能”，在对话框里根据自己功能需要填入相应选项。如要添加一个LED控制功能，则“功能类型”项选择“属性”，“功能名称”填“LED灯”，“标识符”填“LED”，“数据类型”选“bool（布尔型）”，下面的“布尔值”0后面填“关”，1后面填“开”。点“确认”完成自定义功能添加。你可依次添加其他功能。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     接下来添加自定义发布和订阅主题。点“Topic类列表”à“自定义Topic”à“定义Topic类”，在接下来的对话框里，“设备操作权限”选择“发布”，“Topic类”下面框里填“post”，“描述”里填“属性上报”。点“确认”完成。再次点“定义Topic类”，在接下来的对话框里，“设备操作权限”选择“订阅”，“Topic类”下面框里填“set”，“描述”里填“属性下发”。点“确认”完成。至此我们完成了自定义发布和订阅主题Topic创建工作。最后别忘了将产品重新发布上线。
    </p>
    <ul>
     <li style="text-align:justify;">
      关于消息发布和订阅的特别说明。
     </li>
    </ul>
    <p style="margin-left:.0001pt;text-align:justify;">
     阿里云物联网平台MQTT终端设备只能发布和订阅产品自身定义的主题，是不能订阅其他设备的主题的。要想实现设备两两互通，必须做“云产品流转”。其基本原理就是将一个设备发布的主题流转到另一个设备订阅的主题，并将后者发布的主题流转到前者订阅的主题。这样就实现了消息互通。也就是设备间的消息必须在平台服务器上做对应转发设定。所有消息都必须先发给平台服务器，服务器再根据流转设置转发到另一个设备订阅的主题Topic上。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     “云产品流转”设置步骤：
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     点左边栏“规则引擎”à“云产品流转”à“创建规则”，接下来的对话框中填入规则名称，“数据格式”选择默认的“JSON”，填入规则描述，点“确认”。进入规则编辑页面，“处理数据”栏里点“编写SQL”，接下来的对话框中，“字段”里填“*”，表示所有字段，“Topic”下面选“自定义”，再下面选“产品名称”，再下面选“设备名称”，再下面选“user/post”就是我们自定义的属性上报Topic。点“确认”，完成数据处理设置。接下来在下面的“转发数据”项里，点右边的“添加操作”，“选择操作”里选择“发布到另一个Topic”。“Topic”选“自定义”，然后选择产品，设备，Topic（user/set）,与处理数据步骤类似。点击“确认”完成设置。回到“云产品流转”查看页，在刚建立的规则后面有“查看”“启动”“删除”按钮，点“启动”生效。至此做到了一个设备向另一个设备发消息的功能，要做到互通，还必须如此反向再添加一条规则就OK了。也就是将A发布转给B订阅，再将B发布转给A订阅。两条规则都生效，A和B就可以互相通信了。工作的时候，A和B都订阅自己自定义的订阅主题Topic，发布消息也是发布到自己自定义的主题Topic，经平台一流转，消息就流转到对方去了。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     每个产品都有一些基础通信Topic、物模型通信Topic，这些Topic可以实现平台上的在线调试、NTP时间同步、消息广播等功能，有兴趣的可以自己查查百度。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     总结：要使用阿里云MQTT物联网平台，你必须做两件事：一是创建产品及设备，获取设备三元组信息；二是创建“云产品流转”规则，使设备间能互相通信。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     后续我们将使用ESP32模块连接到阿里云物联网平台，使用在线调试功能开关板载LED。然后我们再做个android应用APP，实现真正的MQTT远程通信控制功能。
    </p>
    <p style="margin-left:.0001pt;text-align:justify;">
     如果看官迫不及待，可去我的空间下个资源先行试验：
     <a href="https://download.csdn.net/download/liyong_sbcel/85041380?spm=1001.2014.3001.5503" title="ESP32连接阿里云MQTT物联网平台的Arduino支持库及示例代码。-C++文档类资源-CSDN下载">
      ESP32连接阿里云MQTT物联网平台的Arduino支持库及示例代码。-C++文档类资源-CSDN下载
     </a>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c69796f6e675f736263656c2f:61727469636c652f64657461696c732f313233373637393235" class_="artid" style="display:none">
 </p>
</div>
