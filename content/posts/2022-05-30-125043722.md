---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363338393036302f:61727469636c652f64657461696c732f313235303433373232"
layout: post
title: "区块链的认识与总结"
date: 2022-05-30 11:38:51 +0800
description: "1 区块链基础概念中心化服务器  ==》 分布式系统 （点对点网络） ==》 区块链网络1.1 区块"
keywords: "区块链的总结"
categories: ['区块链']
tags: ['区块链']
artid: "125043722"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=125043722
    alt: "区块链的认识与总结"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=125043722
featuredImagePreview: https://bing.ee123.net/img/rand?artid=125043722
---

# 区块链的认识与总结

## 1 区块链基础概念

中心化服务器 ==》 分布式系统 （点对点网络） ==》 区块链网络

### 1.1 区块链的由来

> **区块链系统的分类**

* 公链系统：无准入限制的去中心化分布式区块链系统，对地域无限制， 节点可以随进随出，属于单链区块链系统。
* 联盟链系统：
  **`具有严格准入限制`**
  的弱中心化分布式区块链系统，地域相对固定，节点需要审核进入，属于多链系统，一个通道表示一条链，联 盟链系统一般支持多通道。
* 私有链：纯中心化区块链系统，除了具备链式数据结构以外，本质上与 现在传统的互联网业务系统没什么区别。

> **演进过程：比特币 ==》以太坊 ==》超级账本**

* 比特币 ==》点对点的电子现金系统（去第三方+可信执行）
* 以太坊 ==》去中心化的区块链操作系统
* 超级账本 ==》准入许可
  + 比特币和以太坊都是公链，超级账本是联盟链

联盟链和公链的区别就是
**`网络准入是否有限制`**

> **为什么要用区块链？它的特性是什么？**

* **透明**
  ：人人记账保证人人获取完整信息，从而实现信息透明；
* **可信**
  ：节点间决策过程共同参与，共识保证可信；
* **防篡改**
  ：数据一旦写在全网范围内经过验证写入区块链中，则很难被修改或者抹除；
* **可追溯**
  ：发生的任意一笔交易都有完整记录，可以针对某一状态在区块链上追查与其相关的全部历史信息；
* **隐私保护**
  ：单一节点包含了完整的区块校验逻辑，无需依赖其他节点，因此不需公开身份，提供了隐私保护前提。

> **什么情况适合使用区块链？**

* 什么样子的数据适合上链：
  **需要共享的、需要具备可信度的、不能被篡改的且需要追溯的**
* 是否多方协同写入：
  **只有一个写入者的区块链是毫无意义的，参与的各方都可以具备写入权限，相互制约**
* 多方是否相互信任：
  **如果多方可以相互信任，那么中心化的系统将是最好的解决方案**
* TTP（Trusted Third Party-可信任第三方）是否可以解决问题？（同上）

### 1.2 区块的数据结构

不管是公链还是联盟链，区块的构成都是由区块头+区块体 的方式构成。区块中都包含一些共同的属性：

* 区块头中包 括但不限于：版本号、父区块 hash、交易 merkle root、时间戳等等；
* 而区块体则都是交易列表。
    
  ![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ff574508a6fc56a425d872f0e268d65d.png)
    
  ![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e2295f3fca87366ece84415d5523a380.png)
    
  prevBlockHash：父区块 hash；
* timestamp：创建区块的时间戳；
* version：区块的版本号；
* merkelroot：区块所打包交易的 merkel tree 的 root。

最重要的是父区块 hash 和 merkle root 两个基础属性，它们是打包交易并延长成区块链的最基本的必须的属性字段。

* 父区块 hash 是区块间链接的 桥梁；
* merkle root 是实现交易的聚合校验与快速校验的技术手段，同时也是确 保已打包交易不可篡改的一个技术手段

> **MerkRoot是如何保证交易不被篡改呢？**

我们可以看到merkleRoot是由每个交易分别做hash，然后再两两递归做hash，最终得到merkleRoot。那么一个交易被篡改，则MerkleRoot的值就一定会发生变化。
  
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e9fe080d65aa00f11a9870e40ec77784.png)
  

**综合来看：**

**区块链是一个不可篡改的数据操作集合**

注意：这里的不可篡改指的是改的难度非常大，因为只要修改一个区块，那么后续的区块都需要修改

> **世界状态**

世界状态是系统当前时间点所有状态的集合，交易是具体的某一个操作，世界状态在操作的驱动下发生改变，转化为下一个状态。

### 1.3 交易的数据结构

不管是公链系统，还是联盟链系统，交易都是以集合的方式存放在区块体中 的。在 Bitcoin 中是以 vector 的方式进行存储，在 NewSpiral 中是以
**`list`**
的方式进行存储。

### 1.4 区块链的数据结构

区块链是一个链式的数据结构，它是由
**`经过共识`**
的
**`区块`**
按照
**`时序的顺序`**
进行链接而成的一条链式结构，通过区块 头中的父区块 hash 进行链接。
  
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/1af59f4828b1bc25b0a898a1ba495bb2.png)

### 1.5 区块链的数据存储

不管是公链系统，还是联盟链系统，全节点的存储都是全量冗余存储的。即 每个节点都存储了全量的重复的区块和交易信息。当系统中的某个节点出现异常时，其他节点还能够不受影响，并且当节点恢复时可以随时再同步数据。

> **节点与网络**

所有 节点 的 服务 和 数据库 都是一样的，数据的同步通过
**`共识`**
和
**`同步`**
来实现

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/a4f53362eb69ce1bb49eb3665741b4b4.png)

应用往一个节点存数据，那么这个节点就会广播，通过共识算法，如果其他节点认可这个数据，那么就会进行数据同步。
  
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/ca710016d3c3efa870e44f55be03da65.png)
  
注意：图中应用系统只连接了两个节点，实际上它是可以连接任何一个节点的。

**区块链的每个节点都存储的是全量数据，因此如果存储数据过大也会有性能问题。**

这里的应用系统服务器不是去中心化的存在，联盟链才是去中心化。

> **数据同步**

数据同步有两种情况：

* 如果节点正常，那么就通过不断通过共识来同步数据；
* 如果节点宕机一段时间后重启，则会通过
  **`批量同步`**
  来读取其他节点上的数据。

**`批量同步比共识快`**
，以上图为例因为共识需要向其余三个节点进行广播。

共识是基于消息通信来确保数据的同步，它的效率取决于两方面：

* 网络通信
* 采取的共识算法的效率

### 1.6 涉及到的概念

#### 1.6.1 通道

通道主要有两个作用：
**`网络分片`**
和
**`数据范围控制`**
，数据的共识只在一个通道内进行。

如下图所示，1，3，4，6四个节点在一个通道内，他们之间会进行数据同步（共识）。同时1，6还与2，5在一个通道内，他们之间也会进行数据同步。
  
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/e7376196d983ba464f3b91fc603bc378.png)

#### 1.6.2 共识算法

共识的本质就是
**分布式系统的数据一致性**

BFT类共识算法：定期选举处出一个领导者（Leader），由其接收并排序区块链
**`交易`**
，领导者
**`产生区块`**
递交给所有其他节点（follower）进行验证，并“举手” 表决，通过“投票”+“协商”推翻不合格的领导者。

> **流程**

* 步骤1：投票挑选Leader（O(n^2)）
    
  ![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/945db4e7c58e115974c4d95db16169ea.png)
* 步骤2：Leader收集交易进行提案
* 步骤3：Replica投票（由leader收集，O(n)）
    
  ![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/822758c787e2d2139b204032caeae326.png)
* 步骤4：收集投票形成共识证明

#### 1.6.3 智能合约

* 业务上：业务规则定义
* 技术上：可执行代码

> **执行流程**

* 第一步：应用 调用 节点服务；
* 第二步：节点生成一笔交易，交易中会声明你想要调用哪个智能合约（
  **`tx的本质就是调用只能合约`**
  ）；
* 第三步：调用本地具体的只能合约；
* 第四步：返回智能合约的执行结果。
    
  ![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/d629ebbd26858ab73cba51087fb99da9.png)

> **注意事项说明**

* **区块链中的每个节点都会执行一遍智能合约，也就是所说的 共识**
  ，这一点和传统的分布式不同。
* 共识完成之后，应用才能查询结果

> **合约和交易的区别与联系**

* 合约是交易的规范，交易是合约的实体。
* 合约定义了功能的边界，交易则用来具体触发功能。

### 1.7 数据上链过程

* 步骤1：上链前处理阶段：业务数据处理 ==》进行数字签名 ==》转化为待上链数据
* 步骤2：上链处理阶段：广播 ==》区块共识（步骤2执行完就已经上链完成）
* 步骤3：智能合约处理阶段：合约逻辑处理 ==》修改默克尔数状态

![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/7e3552307ce53a8f26bff0885f73664a.png)

> 预言机（Oracles）

作用：提供第三方可信的外部数据

### 1.8 区块链如何实现防篡改 & 可信追溯

区块链系统的存储内容中可以分为
**不可篡改存储**
和
**可修改存储**
两部分内容。

* **`不可篡改存`**
  储用于存储交易历史（即区块）；
* **`可修改存储`**
  用于存储可变数据，包括以世界状态为主体的业务数据和通道信息、参数信息、 节点信息等管理数据。

> **防篡改的数据，指的是已完成共识，并延长到区块链上并持久化了的 历史区块数据(历史交易数据)**

这些数据是不能通过直接进行修改的，它只能通过发起新的交易，去申请修改这些数据的最新状态。

> **共识算法**

另外，区块链系统的节点都是全量且冗余的方式进行区块数据存储的；所以， 单个甚至多个节点对数据库的修改仍然无法影响其他节点的数据库，因为好的节点数据总是正确一致的，它们能够最终保持正确的区块数据在正确的区块链上持 续延长。
**`除非能控制整个网络中超过共识算法要求的安全阈值（POW 中是 51%， 大部分 PBFT 的系列算法是 1/3）的节点同时修改，但这几乎不可能发生(也确实 没发生过)`**
。

> **链式结构**

在区块链中，每个区块都包含上一个区块所有数据包的
**`数据指纹 (哈希值)`**
，计算当前区块的数据指纹(哈希值)时，同时包含了上一个区 块的数据指纹(哈希值)，形成链接关系。所以，一旦任何一个区块发生了变动， 后面相连的所有区块数据指纹(哈希值)都会有所变动，所有人都能看见和发现数 据被篡改，并且所有人都会不认可这种无效的数据。区块链中的所有节点分布式 的，节点都做了全量冗余的数据存储。区块链数据是会实时同步给所有节点记录 的，所有节点都知道区块的正确顺序，和对应的内容，也能查阅到相关数据，这就是区块链防伪、防篡改的特性，这就保证了区块链中区块数据的不可篡改。

> **简而言之，区块链实现防篡改与可信追溯，是基于全量的分布式冗余区块数据存储+共识算法机制+密码学来保证的。**

### 1.8 区块链技术栈 & 区块链技术产品

> **区块链技术栈**

* 共识算法——CFT、BFT、POW
* P2P通信——RPC、MQ
* 数据存储——FS、MySQL、LevelDB
* 智能合约——
  **虚拟机（JVM、EVM）**
* 密码学算法——哈希运算、数字签名
* 账户模型——世界状态模型、UTXO模型

> **区块链技术产品**

* NewSpiral
* HyperLedger Fabric
* BitCoin