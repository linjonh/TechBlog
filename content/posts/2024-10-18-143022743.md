---
layout: post
title: "uni-app-开发微信小程序,实现图片预览和保存"
date: 2024-10-18 15:07:15 +0800
description: "uni-app 开发微信小程序，实现图片预览和保存_uniapp 图片预览"
keywords: "uniapp 图片预览"
categories: ['App']
tags: ['微信小程序', 'App']
artid: "143022743"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=143022743
    alt: "uni-app-开发微信小程序,实现图片预览和保存"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=143022743
featuredImagePreview: https://bing.ee123.net/img/rand?artid=143022743
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     uni-app 开发微信小程序，实现图片预览和保存
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     1.使用
     <span style="color:#fe2c24;">
      uni.previewImage()
     </span>
     预览图片
    </h2>
    <h3>
     1.1 图片列表
    </h3>
    <p>
     <img alt="" height="833" src="https://i-blog.csdnimg.cn/direct/84a19e21a29b47a486342b0a0b47aa88.png" width="398"/>
    </p>
    <h3>
     1.2 预览
    </h3>
    <h4>
     1.2.1
     <span style="color:#fe2c24;">
      样式无法调整
     </span>
    </h4>
    <p>
     <img alt="" height="838" src="https://i-blog.csdnimg.cn/direct/61e63c05ec624c68a1277f4751b4645d.png" width="408"/>
    </p>
    <h4>
     1.2.2 微信小程序
     <span style="color:#fe2c24;">
      不支持预览本地文件路径图片
     </span>
     （图片上传到小程序的临时文件存储或云服务存储）
    </h4>
    <p>
     <img alt="" height="825" src="https://i-blog.csdnimg.cn/direct/1c4abe513ec043e786f48526b69fd88b.png" width="406"/>
    </p>
    <h3 style="background-color:transparent;">
     1.3 无法绑定 @longpress="saveImage(item)"
     <span style="color:#fe2c24;">
      长按保存图片事件
     </span>
    </h3>
    <h3>
     1.4 前端代码
    </h3>
    <p>
     <img alt="" height="210" src="https://i-blog.csdnimg.cn/direct/90565af0935a4ac0b53633a23f194c74.png" width="955"/>
    </p>
    <pre><code class="language-html">&lt;template&gt;
	&lt;view class="container"&gt;
		&lt;view class="tabs"&gt;
			&lt;uni-segmented-control
				:current="current"
				:values="tabList"
				@clickItem="onClickItem"
				styleType="button"
				activeColor="#27BA9B"
			/&gt;
		&lt;/view&gt;
		
		&lt;view class="content"&gt;
			&lt;view v-show="current === 0"&gt;
				&lt;view class="video"&gt;
					&lt;video
						style="width: 100%;"
						src="https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/2minute-demo.mp4"
						enable-play-gesture
						v-for="item in 3"
					/&gt;
				&lt;/view&gt;
			&lt;/view&gt;
			
			&lt;view v-show="current === 1"&gt;
				&lt;scroll-view&gt;
						&lt;view class="image-box" v-for="(item,index) in images"&gt;
							&lt;view class="navigator" &gt;
                                &lt;!-- @tap:点击事件, @longpress:长按事件 --&gt;
								&lt;image class="image" :src="item" @tap="previewImage(index)" @longpress="saveImage(item)" /&gt;
							&lt;/view&gt;
						&lt;/view&gt;
				&lt;/scroll-view&gt;
			&lt;/view&gt;
			
			&lt;view v-show="current === 2"&gt;
				&lt;scroll-view&gt;
					&lt;uni-card v-for="item in 10"&gt;
						&lt;text&gt;这是一个基础卡片示例，内容较少，此示例展示了一个没有任何属性不带阴影的卡片。&lt;/text&gt;
					&lt;/uni-card&gt;
				&lt;/scroll-view&gt;
			&lt;/view&gt;
		&lt;/view&gt;
	&lt;/view&gt;
&lt;/template&gt;

&lt;script setup&gt;
	import { ref,computed } from 'vue'
	
	const tabList=['视频', '图片', '文案']
	
	// 选中tab的下标
	const current = ref(0)
	
	// 选中的图片index
	const activeIndex = ref(0)

	// 切换tab
	const onClickItem= (e)=&gt;{
		current.value = e.currentIndex
	}

	// 图片列表
	// 微信小程序 uni.previewImage() 不支持使用本地文件路径预览图片，可上传到小程序的临时文件存储或云服务存储
	const images = ref([
		"https://ww2.sinaimg.cn/mw690/008a4fzDgy1hrc5rdztg7j30zk24ykfc.jpg", // 云服务存储
		"https://ww4.sinaimg.cn/mw690/005QiJkMgy1hrpsfxno4rj30zu25odq0.jpg", // 云服务存储
		"https://wx1.sinaimg.cn/mw690/005UJ76vgy1hrh4zt0k1ij30v91votw9.jpg", // 云服务存储
		"https://wx1.sinaimg.cn/mw690/60ed0cf7ly1hs8msnz6e6j20zu25o16d.jpg", // 云服务存储
		"/static/images/beauty1.jpg", // 本地文件存储
	])
	
	// uni.previewImage() 图片预览
	const previewImage= (index)=&gt;{
		uni.previewImage({
			urls: images.value,
			current: images.value[index], // 当前显示图片的链接
		});
	}
	
	// 保存图片
	const saveImage= (url)=&gt; {
		// 确认框
		uni.showModal({
			content: '下载该图片？',
			confirmColor: '#27BA9B',
			success: async(res) =&gt; {
				if (res.confirm) {
					try {
						let filePath;
						if (url.startsWith('/')) {
							filePath = url; // 本地图片路径，可直接保存
						} else {
							const result = await uni.downloadFile({ url }); // 云服务图片地址，要先下载
							filePath = result.tempFilePath;  // 本地临时存储路径
						}
						await uni.saveImageToPhotosAlbum({ filePath });
						uni.showToast({ title: '保存成功', icon: 'success', duration: 2000 });
					} catch (err) {
						console.error('保存失败:', err);
					}
				}
			},
		})
	}
&lt;/script&gt;

&lt;style lang="less" scoped&gt;
.container{
	display: flex;
	flex-direction: column;
	height: 100vh;
	background-color: #fff;
	
	.tabs{
		padding: 10px;
	}
	
	.content{
		flex: 1;
		overflow-y: auto;
		
		.video{
			margin: 10px;
		}

		.image-box{
			display: inline-flex; // 使用 flex 布局，并且作为行内元素
			margin: 0 5px;
			width: 30%;
			
			.navigator{
				display: flex;
				width: 100%;
			}
		}
	}
}
&lt;/style&gt;</code></pre>
    <h2>
     2.使用
     <span style="color:#fe2c24;">
      自定义组件
     </span>
     预览图片
    </h2>
    <h3 style="background-color:transparent;">
     2.1 图片列表
    </h3>
    <p>
     <img alt="" height="836" src="https://i-blog.csdnimg.cn/direct/8308340de4e848a596a3e4bb41c53fa5.png" width="393"/>
    </p>
    <h3>
     2.2 预览（可预览
     <span style="color:#fe2c24;">
      云服务存储和本地存储的图片
     </span>
     ）
    </h3>
    <p>
     <img alt="" height="831" src="https://i-blog.csdnimg.cn/direct/2987cf349e6f4685bd900a584aae3808.png" width="394"/>
    </p>
    <h3>
     2.3 长按保存
    </h3>
    <p>
     <img alt="" height="834" src="https://i-blog.csdnimg.cn/direct/945a8b813cdf466fbb5d1ccf4ae95461.png" width="398"/>
    </p>
    <h3>
     2.4 前端代码
    </h3>
    <h4 style="background-color:transparent;">
     2.4.1 自定义预览组件&lt;Preview /&gt;
    </h4>
    <pre><code class="language-html">&lt;!-- 图片预览组件 --&gt;
&lt;template&gt;
  &lt;view class="container"&gt;
    &lt;view class="fullscreen" &gt;
      &lt;swiper class="fullscreen-swiper" :current="activeIndexValue" @change="handleSwiperChange" circular&gt;
        &lt;swiper-item class="swiper-item" v-for="(item, index) in imageListValue" :key="index"&gt;
          &lt;image :src="item" @longpress="saveImage(item)" mode="scaleToFill" style="width: 100vw; height: 100vh;"  /&gt;
        &lt;/swiper-item&gt;
      &lt;/swiper&gt;
			&lt;view class="number"&gt;{<!-- -->{ activeIndexValue+1 }}/{<!-- -->{ imageListValue.length }}&lt;/view&gt;
      &lt;button class="btn" type="default" @tap="emit('close')"&gt;退出全屏&lt;/button&gt;
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/template&gt;

&lt;script setup&gt;
	import { ref, onMounted } from 'vue';
	import { onLoad } from '@dcloudio/uni-app'
	
	// 子调父，退出预览模式
	const emit = defineEmits()

	// 获取父组件的参数，activeIndex：选中的索引，imageList：图片url列表
	let query = defineProps(["activeIndex","imageList"])
	let activeIndexValue = ref(query.activeIndex)
	let imageListValue = ref(query.imageList)
	
	// 要保存图片的url
	const url = ref('');

	// 获取屏幕边界到安全区域距离
	const { safeAreaInsets } = uni.getSystemInfoSync()

	// 处理 swiper change 事件
	const handleSwiperChange = (event) =&gt; {
		activeIndexValue.value = event.detail.current;
		url.value = imageListValue.value[activeIndexValue.value];
	};

	// 保存图片
	const saveImage= (url)=&gt; {
		// 确认框
		uni.showModal({
			content: '下载该图片？',
			confirmColor: '#27BA9B',
			success: async(res) =&gt; {
				if (res.confirm) {
					try {
						let filePath;
						if (url.startsWith('/')) {
							filePath = url; // 本地图片路径，可直接保存
						} else {
							const result = await uni.downloadFile({ url }); // 云服务图片地址，要先下载
							filePath = result.tempFilePath;  // 本地临时存储路径
						}
						await uni.saveImageToPhotosAlbum({ filePath });
						uni.showToast({ title: '保存成功', icon: 'success', duration: 2000 });
					} catch (err) {
						console.error('保存失败:', err);
					}
				}
			},
		})
	}
&lt;/script&gt;

&lt;style lang="less" scoped&gt;
.container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: #f4f4f4;
}

.swiper {
  height: 100%;
  width: 100%;
  border: 1px solid #ccc;
  overflow: hidden;
}

.swiper-item {
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  background-color: rgba(0, 0, 0, 0.8);
}

.fullscreen-swiper {
  width: 100%;
  height: 100%;
}

.number{
	position: absolute;
	top: 20px;
	left: 50%;
	transform: translateX(-50%);
	color: #fff;
	background-color: rgba(0, 0, 0, 0.2);
	padding: 5px 10px;
	border-radius: 20px;
}

.btn {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: #ccc;
  background-color: rgba(0, 0, 0, 0.2);
}
&lt;/style&gt;</code></pre>
    <h4>
     2.4.2 使用自定义预览组件&lt;Preview /&gt;
    </h4>
    <p>
     <img alt="" height="56" src="https://i-blog.csdnimg.cn/direct/bf99de2fcc2246e2b0227213596fb522.png" width="1010"/>
    </p>
    <pre><code class="language-html">&lt;template&gt;
	&lt;view class="container"&gt;
		&lt;view class="tabs"&gt;
			&lt;uni-segmented-control
				:current="current"
				:values="tabList"
				@clickItem="onClickItem"
				styleType="button"
				activeColor="#27BA9B"
			/&gt;
		&lt;/view&gt;
		
		&lt;view class="content"&gt;
			&lt;view v-show="current === 0"&gt;
				&lt;view class="video"&gt;
					&lt;video
						style="width: 100%;"
						src="https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/2minute-demo.mp4"
						enable-play-gesture
						v-for="item in 3"
					/&gt;
				&lt;/view&gt;
			&lt;/view&gt;
			
			&lt;view v-show="current === 1"&gt;
				&lt;scroll-view&gt;
						&lt;view class="image-box" v-for="(item,index) in images"&gt;
							&lt;!-- @tap:点击事件, @longpress:长按事件 --&gt;
							&lt;view class="navigator" @tap="preview(index)" &gt;
								&lt;image class="image" :src="item" @longpress="saveImage(item)" /&gt;
							&lt;/view&gt;
						&lt;/view&gt;
				&lt;/scroll-view&gt;
			&lt;/view&gt;
			
			&lt;view v-show="current === 2"&gt;
				&lt;scroll-view&gt;
					&lt;uni-card v-for="item in 10"&gt;
						&lt;text&gt;这是一个基础卡片示例，内容较少，此示例展示了一个没有任何属性不带阴影的卡片。&lt;/text&gt;
					&lt;/uni-card&gt;
				&lt;/scroll-view&gt;
			&lt;/view&gt;
		&lt;/view&gt;
	&lt;/view&gt;

	&lt;!-- 自定义预览组件 --&gt;
	&lt;Preview class="container" v-if="previewFlag" :activeIndex="activeIndex" :imageList="images" @close="close" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
	import { ref,computed } from 'vue'
	
	const tabList=['视频', '图片', '文案']
	
	// 选中tab的下标
	const current = ref(0)
	
	// 是否是预览模式
	let previewFlag = ref(false);
	
	// 选中的图片index
	const activeIndex = ref(0)
	
	// 子组件调用父组件的关闭预览
	const close = ()=&gt;{
		previewFlag.value = false
	}
	
	// 点击开启预览模式
	const preview= (index)=&gt;{
		previewFlag.value = true
		activeIndex.value = index
	}
	
	// 切换tab
	const onClickItem= (e)=&gt;{
		current.value = e.currentIndex
	}

	// 图片列表
	// 微信小程序 uni.previewImage() 不支持使用本地文件路径预览图片，可上传到小程序的临时文件存储或云服务存储
	const images = ref([
		"https://ww2.sinaimg.cn/mw690/008a4fzDgy1hrc5rdztg7j30zk24ykfc.jpg", // 云服务存储
		"https://ww4.sinaimg.cn/mw690/005QiJkMgy1hrpsfxno4rj30zu25odq0.jpg", // 云服务存储
		"https://wx1.sinaimg.cn/mw690/005UJ76vgy1hrh4zt0k1ij30v91votw9.jpg", // 云服务存储
		"https://wx1.sinaimg.cn/mw690/60ed0cf7ly1hs8msnz6e6j20zu25o16d.jpg", // 云服务存储
		"/static/images/beauty1.jpg", // 本地文件存储
	])
	
	// 保存图片
	const saveImage= (url)=&gt; {
		// 确认框
		uni.showModal({
			content: '下载该图片？',
			confirmColor: '#27BA9B',
			success: async(res) =&gt; {
				if (res.confirm) {
					try {
						let filePath;
						if (url.startsWith('/')) {
							filePath = url; // 本地图片路径，可直接保存
						} else {
							const result = await uni.downloadFile({ url }); // 云服务图片地址，要先下载
							filePath = result.tempFilePath;  // 本地临时存储路径
						}
						await uni.saveImageToPhotosAlbum({ filePath });
						uni.showToast({ title: '保存成功', icon: 'success', duration: 2000 });
					} catch (err) {
						console.error('保存失败:', err);
					}
				}
			},
		})
	}
&lt;/script&gt;

&lt;style lang="less" scoped&gt;
.container{
	display: flex;
	flex-direction: column;
	height: 100vh;
	background-color: #fff;
	
	.tabs{
		padding: 10px;
	}
	
	.content{
		flex: 1;
		overflow-y: auto;
		
		.video{
			margin: 10px;
		}

		.image-box{
			display: inline-flex; // 使用 flex 布局，并且作为行内元素
			margin: 0 5px;
			width: 30%;
			
			.navigator{
				display: flex;
				width: 100%;
			}
		}
	}
}
&lt;/style&gt;
</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35383135393530362f:61727469636c652f64657461696c732f313433303232373433" class_="artid" style="display:none">
 </p>
</div>


