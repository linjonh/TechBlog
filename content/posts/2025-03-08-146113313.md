---
layout: post
title: "Spring-Boot-自动装配原理详解"
date: 2025-03-08 11:28:19 +0800
description: "自动装配是 Spring Boot 根据项目类路径（classpath）中的依赖和当前环境，动态配置 Spring 应用程序所需 Bean 的过程。它通过注解实现，通常被包含在中。核心功能：根据引入的依赖，自动加载和配置相关组件。典型场景：添加后，Spring Boot 自动配置 Tomcat 和 Spring MVC。// 文件: org.springframework.boot.autoconfigure.EnableAutoConfiguration。"
keywords: "Spring Boot 自动装配原理详解"
categories: ['未分类']
tags: ['后端', 'Spring', 'Java', 'Boot']
artid: "146113313"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146113313
    alt: "Spring-Boot-自动装配原理详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146113313
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146113313
cover: https://bing.ee123.net/img/rand?artid=146113313
image: https://bing.ee123.net/img/rand?artid=146113313
img: https://bing.ee123.net/img/rand?artid=146113313
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring Boot 自动装配原理详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Spring_Boot__1">
     </a>
     Spring Boot 自动装配原理详解
    </h2>
    <p>
     Spring Boot 的自动装配（Auto-Configuration）是其核心特性之一，它极大地简化了开发者在搭建应用时的配置工作。通过引入特定的依赖（如
     <code>
      spring-boot-starter-web
     </code>
     ），Spring Boot 能够自动配置嵌入式服务器、数据库连接等功能，而无需手动编写繁琐的配置代码。本文将深入剖析 Spring Boot 自动装配的原理，结合源码和详细注释，帮助您理解其背后的实现机制。
    </p>
    <hr/>
    <h3>
     <a id="1__7">
     </a>
     1. 什么是自动装配？
    </h3>
    <p>
     自动装配是 Spring Boot 根据项目类路径（classpath）中的依赖和当前环境，动态配置 Spring 应用程序所需 Bean 的过程。它通过注解
     <code>
      @EnableAutoConfiguration
     </code>
     实现，通常被包含在
     <code>
      @SpringBootApplication
     </code>
     中。
    </p>
    <ul>
     <li>
      <strong>
       核心功能
      </strong>
      ：根据引入的依赖，自动加载和配置相关组件。
     </li>
     <li>
      <strong>
       典型场景
      </strong>
      ：添加
      <code>
       spring-boot-starter-web
      </code>
      后，Spring Boot 自动配置 Tomcat 和 Spring MVC。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2_EnableAutoConfiguration_16">
     </a>
     2. 自动装配的核心注解：
     <code>
      @EnableAutoConfiguration
     </code>
    </h3>
    <p>
     让我们从
     <code>
      @EnableAutoConfiguration
     </code>
     的定义开始，逐步揭开自动装配的面纱。
    </p>
    <h4>
     <a id="21__20">
     </a>
     2.1 注解定义
    </h4>
    <pre><code class="prism language-java"><span class="token comment">// 文件: org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>
<span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Import</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">SpringFactoriesLoader</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span> <span class="token comment">// 作用于类级别</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span> <span class="token comment">// 运行时生效</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span> <span class="token comment">// 自动扫描配置包</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 导入自动配置选择器</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> <span class="token constant">ENABLED_OVERRIDE_PROPERTY</span> <span class="token operator">=</span> <span class="token string">"spring.boot.enableautoconfiguration"</span><span class="token punctuation">;</span>

    <span class="token comment">// 指定要排除的自动配置类</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 指定要排除的自动配置类名称</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键点
      </strong>
      ：
      <ul>
       <li>
        <code>
         @Import(AutoConfigurationImportSelector.class)
        </code>
        是自动装配的入口，它导入了
        <code>
         AutoConfigurationImportSelector
        </code>
        ，负责加载所有自动配置类。
       </li>
       <li>
        <code>
         exclude
        </code>
        和
        <code>
         excludeName
        </code>
        提供了排除特定自动配置的灵活性。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="3__54">
     </a>
     3. 自动装配的工作原理
    </h3>
    <p>
     自动装配依赖于以下机制：
    </p>
    <ol>
     <li>
      <strong>
       SPI 机制
      </strong>
      ：通过
      <code>
       META-INF/spring.factories
      </code>
      文件列出所有可能的自动配置类。
     </li>
     <li>
      <strong>
       条件化配置
      </strong>
      ：利用
      <code>
       @Conditional
      </code>
      注解（如
      <code>
       @ConditionalOnClass
      </code>
      ）判断是否加载某个配置类。
     </li>
     <li>
      <strong>
       Bean 注册
      </strong>
      ：将符合条件的配置类中的 Bean 注入 Spring 容器。
     </li>
    </ol>
    <p>
     以下是详细的执行流程：
    </p>
    <hr/>
    <h3>
     <a id="4__65">
     </a>
     4. 源码分析
    </h3>
    <h4>
     <a id="41_AutoConfigurationImportSelector_67">
     </a>
     4.1
     <code>
      AutoConfigurationImportSelector
     </code>
     ：自动配置的“大脑”
    </h4>
    <p>
     <code>
      AutoConfigurationImportSelector
     </code>
     是自动装配的核心类，它实现了
     <code>
      DeferredImportSelector
     </code>
     接口，负责动态加载配置类。
    </p>
    <pre><code class="prism language-java"><span class="token comment">// 文件: org.springframework.boot.autoconfigure.AutoConfigurationImportSelector</span>
<span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Order</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>type<span class="token punctuation">.</span></span><span class="token class-name">AnnotationMetadata</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MultiValueMap</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoConfigurationImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">DeferredImportSelector</span><span class="token punctuation">,</span> <span class="token class-name">BeanClassLoaderAware</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// Spring 在解析注解时调用此方法，返回需要导入的配置类名称数组</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 检查自动配置是否启用</span>
            <span class="token keyword">return</span> <span class="token constant">NO_IMPORTS</span><span class="token punctuation">;</span> <span class="token comment">// 未启用则返回空数组</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 加载自动配置的元数据（如条件信息）</span>
        <span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata <span class="token operator">=</span> <span class="token class-name">AutoConfigurationMetadataLoader</span>
                <span class="token punctuation">.</span><span class="token function">loadMetadata</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取自动配置的核心方法</span>
        <span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span>
                autoConfigurationMetadata<span class="token punctuation">,</span> annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>autoConfigurationEntry<span class="token punctuation">.</span><span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取自动配置条目，包含配置类和排除项</span>
    <span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span>
            <span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取 @EnableAutoConfiguration 的属性（如 exclude）</span>
        <span class="token class-name">AnnotationAttributes</span> attributes <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 从 spring.factories 中加载所有候选配置类</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 去重</span>
        configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理排除的配置类</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions <span class="token operator">=</span> <span class="token function">getExclusions</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        configurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据条件过滤配置类</span>
        configurations <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 触发自动配置导入事件，便于调试</span>
        <span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从 spring.factories 获取候选配置类</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> 
            <span class="token class-name">AnnotationAttributes</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用 SpringFactoriesLoader 加载 EnableAutoConfiguration 对应的类</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span>
                <span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> configurations<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 指定加载的工厂类为 EnableAutoConfiguration</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">EnableAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键方法解析
      </strong>
      ：
      <ul>
       <li>
        <code>
         selectImports
        </code>
        ：Spring 在解析注解时调用，返回需要导入的配置类。
       </li>
       <li>
        <code>
         getCandidateConfigurations
        </code>
        ：通过
        <code>
         SpringFactoriesLoader
        </code>
        从
        <code>
         spring.factories
        </code>
        中读取配置类。
       </li>
       <li>
        <code>
         filter
        </code>
        ：根据条件（如
        <code>
         @ConditionalOnClass
        </code>
        ）过滤掉不满足条件的配置。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="42_springfactories_140">
     </a>
     4.2
     <code>
      spring.factories
     </code>
     ：自动配置的“清单”
    </h4>
    <p>
     <code>
      spring.factories
     </code>
     文件位于依赖 JAR 的
     <code>
      META-INF
     </code>
     目录下，定义了所有可能的自动配置类。例如：
    </p>
    <pre><code># 文件: META-INF/spring.factories
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration,\
org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\
org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration
</code></pre>
    <ul>
     <li>
      <strong>
       作用
      </strong>
      ：Spring Boot 读取此文件，获取候选配置类列表。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="43_DataSourceAutoConfiguration_156">
     </a>
     4.3 示例：
     <code>
      DataSourceAutoConfiguration
     </code>
    </h4>
    <p>
     以数据库自动配置为例，看看具体配置类的实现：
    </p>
    <pre><code class="prism language-java"><span class="token comment">// 文件: org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</span>
<span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnClass</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnMissingBean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 定义为配置类</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 只有当 DataSource 类存在时才生效</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// 启用数据源配置属性</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span> <span class="token comment">// 定义一个 Bean</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span> <span class="token comment">// 如果容器中没有 DataSource，则创建</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 根据配置文件（如 application.yml）创建数据源</span>
        <span class="token keyword">return</span> properties<span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键点
      </strong>
      ：
      <ul>
       <li>
        <code>
         @ConditionalOnClass
        </code>
        ：确保类路径中有
        <code>
         DataSource
        </code>
        ，否则跳过。
       </li>
       <li>
        <code>
         @ConditionalOnMissingBean
        </code>
        ：避免与手动定义的 Bean 冲突。
       </li>
       <li>
        <code>
         properties
        </code>
        ：从
        <code>
         application.properties
        </code>
        中读取配置（如
        <code>
         spring.datasource.url
        </code>
        ）。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5__191">
     </a>
     5. 自动装配的执行流程
    </h3>
    <ol>
     <li>
      <strong>
       应用启动
      </strong>
      ：
      <code>
       @SpringBootApplication
      </code>
      包含
      <code>
       @EnableAutoConfiguration
      </code>
      ，触发自动装配。
     </li>
     <li>
      <strong>
       加载候选配置
      </strong>
      ：
      <code>
       AutoConfigurationImportSelector
      </code>
      从
      <code>
       spring.factories
      </code>
      中读取配置类。
     </li>
     <li>
      <strong>
       条件过滤
      </strong>
      ：根据
      <code>
       @Conditional
      </code>
      注解判断哪些配置类生效。
     </li>
     <li>
      <strong>
       注册 Bean
      </strong>
      ：将生效的配置类中的 Bean 注入 Spring 容器。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="6__200">
     </a>
     6. 实际应用示例
    </h3>
    <p>
     假设你在
     <code>
      pom.xml
     </code>
     中添加了以下依赖：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       结果
      </strong>
      ：
      <code>
       @EnableAutoConfiguration
      </code>
      加载
      <code>
       WebMvcAutoConfiguration
      </code>
      ，自动配置 Tomcat 和 Spring MVC。
     </li>
     <li>
      <strong>
       效果
      </strong>
      ：无需手动配置即可启动 Web 服务。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="7__216">
     </a>
     7. 自定义与调试
    </h3>
    <h4>
     <a id="71__218">
     </a>
     7.1 排除自动配置
    </h4>
    <p>
     如果不需要某些自动配置，可以使用
     <code>
      exclude
     </code>
     ：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="72__231">
     </a>
     7.2 调试自动配置
    </h4>
    <p>
     在
     <code>
      application.properties
     </code>
     中启用调试：
    </p>
    <pre><code>debug=true
</code></pre>
    <p>
     Spring Boot 会输出自动配置的详细日志，方便排查问题。
    </p>
    <hr/>
    <h3>
     <a id="8__243">
     </a>
     8. 总结
    </h3>
    <p>
     Spring Boot 的自动装配通过
     <code>
      @EnableAutoConfiguration
     </code>
     和
     <code>
      AutoConfigurationImportSelector
     </code>
     实现了高度灵活的配置机制。它利用 SPI 和条件化配置，动态加载必要的 Bean，极大地提高了开发效率。希望本文的源码分析和注释能帮助您深入理解这一特性，并在实践中灵活运用。
    </p>
    <p>
     如果您有更多疑问，欢迎留言讨论！
    </p>
    <hr/>
    <p>
     这篇博客从概念到源码，层层递进，适合初学者和进阶开发者阅读。如果需要调整语气或补充内容.
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6572726f725f6c6f67372f:61727469636c652f64657461696c732f313436313133333133" class_="artid" style="display:none">
 </p>
</div>


