---
layout: post
title: "Spring-Boot-3.x-中-NotNull-与-NonNull-的深度解析"
date: 2025-03-13 07:00:00 +0800
description: "在 Java 开发领域，尤其是在 Spring Boot 生态系统中，空指针异常（NPEs）始终是一个顽固的挑战。这些运行时错误可能导致应用程序崩溃、数据不一致以及糟糕的用户体验。为了应对这一问题，Java 社区开发了各种空安全机制，其中注解扮演着至关重要的角色。本文将深入探讨 Spring Boot 3.x 与 Jakarta 中用于空安全的两个关键注解：@NotNull和@NonNull。..."
keywords: "Spring Boot 3.x 中 @NotNull 与 @NonNull 的深度解析"
categories: ['未分类']
tags: ['后端', 'Spring', 'Spring', 'Java', 'Boot']
artid: "146247531"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146247531
    alt: "Spring-Boot-3.x-中-NotNull-与-NonNull-的深度解析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146247531
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146247531
cover: https://bing.ee123.net/img/rand?artid=146247531
image: https://bing.ee123.net/img/rand?artid=146247531
img: https://bing.ee123.net/img/rand?artid=146247531
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring Boot 3.x 中 @NotNull 与 @NonNull 的深度解析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div id="js_content">
     <p style="text-align:justify;">
      在 Java 开发领域，尤其是在 Spring Boot 生态系统中，空指针异常（NPEs）始终是一个顽固的挑战。这些运行时错误可能导致应用程序崩溃、数据不一致以及糟糕的用户体验。为了应对这一问题，Java 社区开发了各种空安全机制，其中注解扮演着至关重要的角色。
     </p>
     <p style="text-align:justify;">
      本文将深入探讨 Spring Boot 3.x 与 Jakarta 中用于空安全的两个关键注解：
      <code>
       @NotNull
      </code>
      和
      <code>
       @NonNull
      </code>
      。我们将探索它们的起源、用途和实际应用，为您提供编写更健壮和防错代码的知识。
     </p>
     <h4>
      空安全概览
     </h4>
     <p style="text-align:justify;">
      在深入了解具体细节之前，让我们先了解一下背景：
     </p>
     <ul>
      <li>
       <p>
        •
        <strong>
         空引用
        </strong>
        ：由 Tony Hoare 于 1965 年引入，他后来称之为他的“价值十亿美元的错误”。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         Java 的方法
        </strong>
        ：与一些具有内置空安全的现代语言不同，Java 依赖于注解和静态分析工具。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         Spring Boot 3.2
        </strong>
        ：拥抱 Jakarta EE 9+，带来了包名更改和增强的空安全特性。
       </p>
      </li>
     </ul>
     <h4>
      注解深度解析
     </h4>
     <h5>
      <code>
       @NotNull
      </code>
     </h5>
     <ul>
      <li>
       <p>
        •
        <strong>
         起源
        </strong>
        ：Jakarta Bean Validation API
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         包
        </strong>
        ：
        <code>
         jakarta.validation.constraints.NotNull
        </code>
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         用途
        </strong>
        ：运行时验证，确保值不为 null
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         行为
        </strong>
        ：与验证器一起使用时，在运行时触发验证
       </p>
      </li>
     </ul>
     <h5>
      <code>
       @NonNull
      </code>
     </h5>
     <ul>
      <li>
       <p>
        •
        <strong>
         起源
        </strong>
        ：Spring Framework
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         包
        </strong>
        ：
        <code>
         org.springframework.lang.NonNull
        </code>
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         用途
        </strong>
        ：静态分析和空安全文档
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         行为
        </strong>
        ：供 IDE 和静态分析工具使用；无运行时影响
       </p>
      </li>
     </ul>
     <h4>
      对比分析
     </h4>
     <p style="text-align:justify;">
      让我们分解关键差异：
     </p>
     <ul>
      <li>
       <p>
        •
        <strong>
         验证机制
        </strong>
        ：
       </p>
       <ul>
        <li>
         <p>
          •
          <code>
           @NotNull
          </code>
          ：主动运行时检查
         </p>
        </li>
        <li>
         <p>
          •
          <code>
           @NonNull
          </code>
          ：被动编译时提示
         </p>
        </li>
       </ul>
      </li>
      <li>
       <p>
        •
        <strong>
         框架集成
        </strong>
        ：
       </p>
       <ul>
        <li>
         <p>
          •
          <code>
           @NotNull
          </code>
          ：广泛认可（Jakarta EE、Spring、Hibernate）
         </p>
        </li>
        <li>
         <p>
          •
          <code>
           @NonNull
          </code>
          ：Spring 特有，但受许多 IDE 尊重
         </p>
        </li>
       </ul>
      </li>
      <li>
       <p>
        •
        <strong>
         性能影响
        </strong>
        ：
       </p>
       <ul>
        <li>
         <p>
          •
          <code>
           @NotNull
          </code>
          ：由于验证，运行时开销略有增加
         </p>
        </li>
        <li>
         <p>
          •
          <code>
           @NonNull
          </code>
          ：无运行时影响
         </p>
        </li>
       </ul>
      </li>
      <li>
       <p>
        •
        <strong>
         用例
        </strong>
        ：
       </p>
       <ul>
        <li>
         <p>
          •
          <code>
           @NotNull
          </code>
          ：输入验证，尤其是外部数据
         </p>
        </li>
        <li>
         <p>
          •
          <code>
           @NonNull
          </code>
          ：内部代码约定和 API 文档
         </p>
        </li>
       </ul>
      </li>
      <li>
       <p>
        •
        <strong>
         失败行为
        </strong>
        ：
       </p>
       <ul>
        <li>
         <p>
          •
          <code>
           @NotNull
          </code>
          ：可能抛出
          <code>
           ConstraintViolationException
          </code>
         </p>
        </li>
        <li>
         <p>
          •
          <code>
           @NonNull
          </code>
          ：依赖于代码中的正确 null 检查
         </p>
        </li>
       </ul>
      </li>
     </ul>
     <h4>
      综合示例
     </h4>
     <p style="text-align:justify;">
      让我们在 Spring Boot 中使用这两个注解探索一个实际场景。
     </p>
     <pre class="has"><code class="language-go">import jakarta.validation.constraints.NotNull;
import jakarta.validation.Valid;
import org.springframework.lang.NonNull;
import org.springframework.stereotype.Service;
import org.springframework.validation.annotation.Validated;
import java.util.List;
import java.util.Optional;

@Service
@Validated
publicclassProductService {

    privatefinal ProductRepository productRepository;
    privatefinal PricingService pricingService;

    publicProductService(@NotNull ProductRepository productRepository,
                          @NotNull PricingService pricingService) {
        this.productRepository = productRepository;
        this.pricingService = pricingService;
    }

    @NonNull
    public Product createProduct(@Valid @NotNull ProductDTO productDTO) {
        Productproduct=newProduct(productDTO.getName(), productDTO.getDescription());
        product.setPrice(pricingService.calculateInitialPrice(productDTO.getCategory()));
        return productRepository.save(product);
    }

    @NonNull
    public Optional&lt;Product&gt; getProductById(@NonNull Long id) {
        return productRepository.findById(id);
    }

    publicvoidupdateProductStock(@NonNull Long id, @NotNull Integer quantity) {
        productRepository.findById(id).ifPresent(product -&gt; {
            product.setStockQuantity(quantity);
            productRepository.save(product);
        });
    }

    @NonNull
    public List&lt;Product&gt; searchProducts(@NonNull String keyword) {
        return productRepository.searchByNameOrDescription(keyword);
    }
}

publicclassProductDTO {
    @NotNull
    private String name;

    @NotNull
    private String description;

    @NotNull
    private String category;

    // getters and setters
}

publicclassProduct {
    private Long id;
    private String name;
    private String description;
    private Double price;
    private Integer stockQuantity;

    // constructor, getters, and setters
}</code></pre>
     <h4>
      代码解析
     </h4>
     <ol>
      <li>
       <p>
        1.
        <strong>
         构造函数参数
        </strong>
        ：
       </p>
       <pre class="has"><code class="language-go">public ProductService(@NotNull ProductRepository productRepository,
                      @NotNull PricingService pricingService)</code></pre>
       <code>
        @NotNull
       </code>
       确保 Spring 的依赖注入提供非 null 的依赖项。在 bean 创建期间发生运行时验证。
      </li>
      <li>
       <p>
        2.
        <strong>
         方法返回类型
        </strong>
        ：
       </p>
       <pre class="has"><code class="language-go">@NonNull
public Product createProduct(@Valid @NotNull ProductDTO productDTO)</code></pre>
       返回类型上的
       <code>
        @NonNull
       </code>
       向调用者表明此方法永远不会返回 null。静态分析工具可以警告潜在的 null 解引用。
      </li>
      <li>
       <p>
        3.
        <strong>
         方法参数
        </strong>
        ：
       </p>
       <pre class="has"><code class="language-go">public void updateProductStock(@NonNull Long id, @NotNull Integer quantity)</code></pre>
       <code>
        id
       </code>
       上的
       <code>
        @NonNull
       </code>
       用于静态分析。
       <code>
        quantity
       </code>
       上的
       <code>
        @NotNull
       </code>
       将在运行时验证。
      </li>
      <li>
       <p>
        4.
        <strong>
         DTO 字段
        </strong>
        ：
       </p>
       <pre class="has"><code class="language-go">public class ProductDTO {
    @NotNull
    private String name;
    // ...
}</code></pre>
       DTO 字段上的
       <code>
        @NotNull
       </code>
       确保在使用
       <code>
        @Valid
       </code>
       时对其进行验证。
      </li>
      <li>
       <p>
        5.
        <strong>
         Optional 的使用
        </strong>
        ：
       </p>
       <pre class="has"><code class="language-go">@NonNull
public Optional&lt;Product&gt; getProductById(@NonNull Long id)</code></pre>
       返回
       <code>
        Optional&lt;Product&gt;
       </code>
       是 Java 8+ 处理潜在缺失值的方法。
       <code>
        Optional
       </code>
       返回类型上的
       <code>
        @NonNull
       </code>
       确保
       <code>
        Optional
       </code>
       本身永远不为 null。
      </li>
     </ol>
     <h4>
      最佳实践和专业提示
     </h4>
     <ul>
      <li>
       <p>
        •
        <strong>
         一致使用
        </strong>
        ：在 DTO 和实体中，在所有非 null 字段和参数上一致应用
        <code>
         @NotNull
        </code>
        。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         验证组
        </strong>
        ：使用 Jakarta Bean Validation 组在不同上下文中应用不同的验证规则。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         自定义约束
        </strong>
        ：为复杂的验证规则创建自定义约束注解。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         IDE 中的 Null 分析
        </strong>
        ：配置您的 IDE（例如，IntelliJ IDEA）以遵循 Spring 的 null 安全注解。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         测试
        </strong>
        ：编写单元测试以验证
        <code>
         @NotNull
        </code>
        约束是否强制执行。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         文档
        </strong>
        ：在公共 API 中使用
        <code>
         @NonNull
        </code>
        ，以清晰地向其他开发人员传达 null 安全约定。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         性能考虑
        </strong>
        ：注意关键路径中过度运行时验证的性能影响。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         与其他注解结合使用
        </strong>
        ：将
        <code>
         @NotNull
        </code>
        与其他约束（如
        <code>
         @Size
        </code>
        或
        <code>
         @Pattern
        </code>
        ）结合使用，以进行全面验证。
       </p>
      </li>
     </ul>
     <h4>
      高级场景
     </h4>
     <ul>
      <li>
       <p>
        •
        <strong>
         泛型方法中的 Null 安全
        </strong>
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         响应式编程中的 Null 安全
        </strong>
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         接口中 Null 性的处理
        </strong>
       </p>
      </li>
     </ul>
     <pre class="has"><code class="language-go">// 泛型方法中的 Null 安全
@NonNull
public &lt;T&gt; List&lt;T&gt; processItems(@NonNull List&lt;@NotNull T&gt; items) {
    // 处理逻辑
}

// 响应式编程中的 Null 安全
@NonNull
public Mono&lt;Product&gt; reactiveCreateProduct(@Valid @NotNull ProductDTO productDTO) {
    // 响应式创建逻辑
}

// 接口中 Null 性的处理
publicinterfaceUserService {
    @NonNull User findUser(@NonNull String username);
}</code></pre>
     <h4>
      为什么在接口中使用 @NonNull？
     </h4>
     <p style="text-align:justify;">
      在我们的接口示例中，我们使用了来自 Spring Framework 的
      <code>
       @NonNull
      </code>
      （org.springframework.lang.NonNull），而不是来自 Jakarta Bean Validation 的
      <code>
       @NotNull
      </code>
      （jakarta.validation.constraints.NotNull）。这种选择是经过深思熟虑的，基于几个重要因素：
     </p>
     <ul>
      <li>
       <p>
        •
        <strong>
         语义含义
        </strong>
        ：
        <code>
         @NonNull
        </code>
        主要用于静态分析和文档。它在不强制运行时行为的情况下传达设计意图。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         运行时影响
        </strong>
        ：
        <code>
         @NotNull
        </code>
        设计用于运行时验证，可能具有性能影响。接口定义约定，而不是实现，因此运行时检查通常不适合此级别。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         框架一致性
        </strong>
        ：Spring Framework 专门为 API 和约定提供了
        <code>
         @NonNull
        </code>
        。在基于 Spring 的应用程序中使用 Spring 的注解可以保持一致性。
       </p>
      </li>
      <li>
       <p>
        •
        <strong>
         编译时检查
        </strong>
        ：许多 IDE 和静态分析工具都认可
        <code>
         @NonNull
        </code>
        ，以便在开发期间进行 null 安全检查。这有助于在开发过程的早期捕获潜在的 null 相关问题。
       </p>
      </li>
     </ul>
     <h4>
      结论
     </h4>
     <p style="text-align:justify;">
      掌握 Spring Boot 3.2 与 Jakarta 中的
      <code>
       @NotNull
      </code>
      和
      <code>
       @NonNull
      </code>
      注解对于开发健壮、null 安全的应用程序至关重要。虽然
      <code>
       @NotNull
      </code>
      提供运行时验证，但
      <code>
       @NonNull
      </code>
      增强了静态分析和文档。通过明智地应用这些注解，您可以创建强大的防御机制来抵御空指针异常
     </p>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f64616e64616e64657368616e676e692f:61727469636c652f64657461696c732f313436323437353331" class_="artid" style="display:none">
 </p>
</div>


