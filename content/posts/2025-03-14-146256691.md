---
layout: post
title: "React19源码系列之FiberRoot节点和Fiber节点"
date: 2025-03-14 14:40:20 +0800
description: "fiberRoot节点和fiber节点结构"
keywords: "React19源码系列之FiberRoot节点和Fiber节点"
categories: ['React']
tags: ['前端', 'React', 'Javascript']
artid: "146256691"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146256691
    alt: "React19源码系列之FiberRoot节点和Fiber节点"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146256691
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146256691
cover: https://bing.ee123.net/img/rand?artid=146256691
image: https://bing.ee123.net/img/rand?artid=146256691
img: https://bing.ee123.net/img/rand?artid=146256691
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     React19源码系列之FiberRoot节点和Fiber节点
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在上一篇文章，看了
     <code>
      createRoot
     </code>
     函数的大致流程。
    </p>
    <ul>
     <li>
      <code>
       createContainer
      </code>
      函数创建并返回了
      <code>
       FiberRoot
      </code>
      。
     </li>
     <li>
      <code>
       FiberRoot
      </code>
      是由
      <code>
       createFiberRoot
      </code>
      函数创建，
      <code>
       createFiberRoot
      </code>
      函数还将
      <code>
       FiberRoot
      </code>
      和
      <code>
       根Fiber
      </code>
      通过
      <code>
       current
      </code>
      属性建立起了联系。
     </li>
     <li>
      将
      <code>
       FiberRoot
      </code>
      作为参数传给
      <code>
       ReactDOMRoot
      </code>
      构造函数，返回带有
      <code>
       _internalRoot
      </code>
      属性（其实就是参数
      <code>
       FiberRoot
      </code>
      ），
      <code>
       render
      </code>
      和
      <code>
       unmount
      </code>
      方法的
      <code>
       ReactDOMRoot实例对象
      </code>
      。
     </li>
    </ul>
    <p>
     下面就继续来看一下
     <code>
      FiberRoot
     </code>
     和
     <code>
      Fiber
     </code>
     是如何创建以及他们的各自的属性都具体什么含义。
    </p>
    <h2>
     <a id="FiberRootNode__8">
     </a>
     FiberRootNode 构造函数
    </h2>
    <p>
     <code>
      FiberRootNode
     </code>
     用于创建一个
     <code>
      FiberRootNode
     </code>
     实例，这个实例包含了与整个 React 应用渲染过程相关的各种状态和信息，如挂载的 DOM 容器、当前的
     <code>
      Fiber
     </code>
     树、优先级管理、错误处理回调、表单状态等，为 React 协调器管理和调度整个应用的渲染工作提供了基础。
    </p>
    <blockquote>
     <p>
      函数参数含义：
      <br/>
      ●
      <code>
       containerInfo
      </code>
      ：表示挂载 React 应用的 DOM 容器的信息，通常是一个 DOM 元素，如 document.getElementById(‘root’) 返回的元素。
      <br/>
      ●
      <code>
       tag
      </code>
      ：用于标识 React 应用的启动模式，可能是并发模式或传统模式。
      <br/>
      ●
      <code>
       hydrate
      </code>
      ：与服务端渲染的水合（hydration）相关的参数，用于指示是否进行水合操作。
      <br/>
      ●
      <code>
       identifierPrefix
      </code>
      ：标识符前缀，可能用于生成唯一的标识符。
      <br/>
      ●
      <code>
       onUncaughtError
      </code>
      ：未捕获错误的回调函数，当应用中出现未捕获的错误时会调用该函数。
      <br/>
      ●
      <code>
       onCaughtError
      </code>
      ：捕获错误的回调函数，用于处理已捕获的错误。
      <br/>
      ●
      <code>
       onRecoverableError
      </code>
      ：可恢复错误的回调函数，用于处理可以恢复的错误。
      <br/>
      ●
      <code>
       formState
      </code>
      ：表单状态，可能包含表单的输入值、验证状态等信息。
     </p>
    </blockquote>
    <pre><code class="prism language-ts"><span class="token keyword">function</span> <span class="token function">FiberRootNode</span><span class="token punctuation">(</span>
  <span class="token keyword">this</span><span class="token operator">:</span> $FlowFixMe<span class="token punctuation">,</span>
  containerInfo<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  <span class="token comment">// $FlowFixMe[missing-local-annot]</span>
  tag<span class="token punctuation">,</span>
  hydrate<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  identifierPrefix<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  onUncaughtError<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  onCaughtError<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  onRecoverableError<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  formState<span class="token operator">:</span> ReactFormState<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 启动模式和容器</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> disableLegacyMode <span class="token operator">?</span> ConcurrentRoot <span class="token operator">:</span> tag<span class="token punctuation">;</span><span class="token comment">//启动模式: 1并发模式，0传统模式</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>containerInfo <span class="token operator">=</span> containerInfo<span class="token punctuation">;</span><span class="token comment">// 挂载DOM容器的信息</span>

  <span class="token comment">// fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingChildren <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 指向下一个 Fiber 节点树的指针，通常在更新过程中用于存储待处理的子节点。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//指向当前 Fiber 节点的指针，代表当前正在渲染的 Fiber 树。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pingCache <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 用于缓存 FiberNode 的引用，以便快速访问。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>finishedWork <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//存储完成的 Fiber 节点，通常在渲染完成后更新。</span>

  <span class="token comment">// 超时和取消</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>timeoutHandle <span class="token operator">=</span> noTimeout<span class="token punctuation">;</span><span class="token comment">// 处理超时的句柄，初始值为 noTimeout，用于管理渲染过程中的超时情况。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cancelPendingCommit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 用于取消挂起的提交操作的函数，初始值为 null。</span>

  <span class="token comment">//上下文</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 当前的上下文对象，用于在组件树中传递数据。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingContext <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 当前挂起的上下文，在上下文更新时使用。</span>
  
  <span class="token comment">// 链表</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 指向下一个 FiberRootNode 对象的指针，用于构建链表结构。</span>

  <span class="token comment">// 回调</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callbackNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 指向回调函数的 Fiber 节点的指针，用于管理回调函数的执行。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callbackPriority <span class="token operator">=</span> NoLane<span class="token punctuation">;</span><span class="token comment">// 回调优先级</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>expirationTimes <span class="token operator">=</span> <span class="token function">createLaneMap</span><span class="token punctuation">(</span>NoTimestamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 一个存储各个 Lane 过期时间的映射，通过 createLaneMap 函数创建，初始值为 NoTimestamp。</span>

  <span class="token comment">//优先级</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span> <span class="token comment">// 代表待处理的车道集合。NoLanes 表明目前没有待处理的更新任务。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>suspendedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span> <span class="token comment">// 表示被挂起的车道集合。在某些情形下，更新任务可能会因为数据未就绪等原因而被挂起。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pingedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span><span class="token comment">//指需要处理的车道集合。当某个车道被标记为需要处理时，会被添加到这个集合中。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>warmLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span><span class="token comment">// 与预热渲染相关的车道集合。预热渲染一般用于提前准备数据或进行一些预计算。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>expiredLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span> <span class="token comment">// 代表已过期的车道集合。若某个更新任务的优先级较低，且等待时间过长，就可能会过期。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>finishedLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span> <span class="token comment">// 表示已完成的车道集合。当某个更新任务成功完成后，对应的车道会被添加到这个集合中。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>errorRecoveryDisabledLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span><span class="token comment">// 表示禁用错误恢复的车道集合。在某些情况下，可能会禁用某些车道的错误恢复机制。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>shellSuspendCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 挂起计数器</span>
  

  <span class="token keyword">this</span><span class="token punctuation">.</span>entangledLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span><span class="token comment">// 相关联的 Lane</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>entanglements <span class="token operator">=</span> <span class="token function">createLaneMap</span><span class="token punctuation">(</span>NoLanes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 相关联的 Lane 的映射</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>hiddenUpdates <span class="token operator">=</span> <span class="token function">createLaneMap</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 隐藏更新的 Lane 的映射</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>identifierPrefix <span class="token operator">=</span> identifierPrefix<span class="token punctuation">;</span>  <span class="token comment">// 标识符前缀</span>

  <span class="token comment">// 回调</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onUncaughtError <span class="token operator">=</span> onUncaughtError<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onCaughtError <span class="token operator">=</span> onCaughtError<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onRecoverableError <span class="token operator">=</span> onRecoverableError<span class="token punctuation">;</span><span class="token comment">// 可恢复错误的回调函数</span>

  <span class="token comment">// 如果 enableCache 为 true，则初始化缓存相关的属性，包括缓存的 FiberNode 和缓存的 Lane。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enableCache<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pooledCache <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 缓存的 FiberNode</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pooledCacheLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span><span class="token comment">// 缓存的 Lane</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果 enableSuspenseCallback 为 true，则初始化水合回调函数相关的属性。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enableSuspenseCallback<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hydrationCallbacks <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 用于注水的回调函数</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>formState <span class="token operator">=</span> formState<span class="token punctuation">;</span> <span class="token comment">// 表单状态</span>

  <span class="token comment">// 一个 Map 对象，用于存储未完成的过渡信息。</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>incompleteTransitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 未完成的过渡的映射</span>

  <span class="token comment">// 如果 enableTransitionTracing 为 true，则初始化过渡回调函数和过渡 Lane 映射。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enableTransitionTracing<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>transitionCallbacks <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> transitionLanesMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>transitionLanes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> TotalLanes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      transitionLanesMap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果 enableProfilerTimer 和 enableProfilerCommitHooks 都为 true，则初始化性能分析相关的属性，用于记录副作用和被动副作用的持续时间。</span>
 <span class="token comment">// if (enableProfilerTimer &amp;&amp; enableProfilerCommitHooks) {<!-- --></span>
 <span class="token comment">//   this.effectDuration = -0;</span>
 <span class="token comment">//   this.passiveEffectDuration = -0;</span>
<span class="token comment">//  }</span>

  <span class="token comment">// 如果 enableUpdaterTracking 为 true，则初始化更新跟踪相关的属性，包括存储已记忆的更新器和每个 Lane 的待处理更新器集合。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enableUpdaterTracking<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedUpdaters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> pendingUpdatersLaneMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pendingUpdatersLaneMap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> TotalLanes<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      pendingUpdatersLaneMap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d3f88402db5045a5ac919af432a5570e.png"/>
    </p>
    <h2>
     <a id="createFiber__126">
     </a>
     createFiber 函数
    </h2>
    <p>
     <code>
      createFiber
     </code>
     函数，根据组件类型调用不同的函数，默认
     <code>
      enableObjectFiber
     </code>
     为
     <code>
      true
     </code>
     ，调用
     <code>
      createFiberImplObject
     </code>
     函数，否则调用
     <code>
      createFiberImplClass
     </code>
     函数。
    </p>
    <pre><code class="prism language-ts"><span class="token keyword">const</span> createFiber <span class="token operator">=</span> enableObjectFiber
  <span class="token operator">?</span> createFiberImplObject
  <span class="token operator">:</span> createFiberImplClass<span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="createFiberImplObject_135">
     </a>
     createFiberImplObject
    </h2>
    <p>
     <code>
      createFiberImplObject
     </code>
     函数是用于创建一个
     <code>
      Fiber
     </code>
     对象的具体实现，
     <code>
      Fiber
     </code>
     对象是
     <code>
      React Fiber
     </code>
     架构中的核心数据结构，代表了一个 React 元素或组件的工作单元。该函数根据传入的参数初始化
     <code>
      Fiber
     </code>
     对象的各种属性，这些属性用于描述组件的状态、结构以及在渲染过程中的相关信息。
    </p>
    <blockquote>
     <p>
      函数参数含义：
      <br/>
      ●
      <code>
       tag
      </code>
      ：类型为 WorkTag，表示 Fiber 节点的类型，例如 HostComponent、FunctionComponent 等，不同的类型决定了 Fiber 节点在渲染过程中的不同处理方式。
      <br/>
      ●
      <code>
       pendingProps
      </code>
      ：类型为 mixed，表示即将传递给组件的属性，这些属性可能会在后续的渲染过程中被使用。
      <br/>
      ●
      <code>
       key
      </code>
      ：类型为 null 或 string，用于唯一标识 Fiber 节点，在 React 进行列表渲染时，key 可以帮助 React 更高效地进行元素的更新和重排。
      <br/>
      ●
      <code>
       mode
      </code>
      ：类型为 TypeOfMode，表示 Fiber 节点的模式，例如并发模式、严格模式等，不同的模式会影响 React 的渲染行为。
     </p>
    </blockquote>
    <pre><code class="prism language-ts"><span class="token keyword">function</span> <span class="token function">createFiberImplObject</span><span class="token punctuation">(</span>
  tag<span class="token operator">:</span> WorkTag<span class="token punctuation">,</span><span class="token comment">// 3代表根节点</span>
  pendingProps<span class="token operator">:</span> mixed<span class="token punctuation">,</span><span class="token comment">// 即将传递给组件的属性。 </span>
  key<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> TypeOfMode<span class="token punctuation">,</span><span class="token comment">// 渲染模式 并发模式或者传统模式</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token punctuation">{<!-- --></span>

  <span class="token comment">// 初始化 Fiber 对象</span>
  <span class="token keyword">const</span> fiber<span class="token operator">:</span> Fiber <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Instance</span>
    <span class="token comment">// tag, key - defined at the bottom as dynamic properties</span>
    elementType<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 通常存储 React 元素的类型，如函数组件、类组件或 DOM 元素类型，初始化为 null。</span>
    type<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 与 elementType 类似，但在某些情况下可能会有不同的含义，初始化为 null。</span>
    stateNode<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 存储与 Fiber 节点关联的实际 DOM 节点或组件实例，初始化为 null。</span>

    <span class="token comment">// Fiber</span>
    <span class="token keyword">return</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 指向父 Fiber 节点，用于在渲染完成后返回上一级。</span>
    child<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 指向第一个子 Fiber 节点。</span>
    sibling<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 指向下一个兄弟 Fiber 节点。</span>
    index<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">// 表示当前 Fiber 节点在兄弟节点中的索引位置，初始化为 0。</span>

    ref<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 用于存储 ref 对象，方便获取组件或 DOM 节点的引用。</span>
    refCleanup<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 用于清理 ref 相关的资源，初始化为 null。</span>

    <span class="token comment">// pendingProps - defined at the bottom as dynamic properties</span>
    memoizedProps<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 上一次渲染时使用的属性，初始化为 null。</span>
    updateQueue<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 存储组件的更新队列，初始化为 null。</span>
    memoizedState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 存储组件的状态，初始化为 null。</span>
    dependencies<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 存储组件的依赖项，初始化为 null。</span>

    <span class="token comment">// Effects</span>
    flags<span class="token operator">:</span> NoFlags<span class="token punctuation">,</span><span class="token comment">// 表示 Fiber 节点的副作用标记，初始化为 NoFlags，表示没有副作用。</span>
    subtreeFlags<span class="token operator">:</span> NoFlags<span class="token punctuation">,</span><span class="token comment">// 表示子树的副作用标记，初始化为 NoFlags。</span>
    deletions<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 存储需要删除的子 Fiber 节点，初始化为 null。</span>

    lanes<span class="token operator">:</span> NoLanes<span class="token punctuation">,</span><span class="token comment">// 表示当前 Fiber 节点的优先级车道，初始化为 NoLanes。</span>
    childLanes<span class="token operator">:</span> NoLanes<span class="token punctuation">,</span><span class="token comment">// 表示子 Fiber 节点的优先级车道，初始化为 NoLanes。</span>

    alternate<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">// 双缓存，指向的另一个版本的fiber</span>

    <span class="token comment">// dynamic properties at the end for more efficient hermes bytecode</span>
    tag<span class="token punctuation">,</span><span class="token comment">// fiber类型</span>
    key<span class="token punctuation">,</span><span class="token comment">// 用于唯一标识 Fiber 节点</span>
    pendingProps<span class="token punctuation">,</span><span class="token comment">// 即将传递给组件的属性。 </span>
    mode<span class="token punctuation">,</span><span class="token comment">//  Fiber 节点的模式，例如并发模式、严格模式等</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 启用了性能分析器</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enableProfilerTimer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fiber<span class="token punctuation">.</span>actualDuration <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 表示 Fiber 节点实际渲染所花费的时间</span>
    fiber<span class="token punctuation">.</span>actualStartTime <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">;</span><span class="token comment">// 表示 Fiber 节点开始渲染的时间</span>
    fiber<span class="token punctuation">.</span>selfBaseDuration <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 表示 Fiber 节点自身的基本渲染时间</span>
    fiber<span class="token punctuation">.</span>treeBaseDuration <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 表示 Fiber 节点及其子树的基本渲染时间</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 返回 Fiber 对象</span>
  <span class="token keyword">return</span> fiber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="createFiberImplClass_205">
     </a>
     createFiberImplClass
    </h2>
    <p>
     <code>
      createFiberImplClass
     </code>
     函数是用于创建
     <code>
      Fiber
     </code>
     节点的另一种实现方式，它通过实例化
     <code>
      FiberNode
     </code>
     类来创建一个 Fiber 对象。
    </p>
    <pre><code class="prism language-ts"><span class="token keyword">function</span> <span class="token function">createFiberImplClass</span><span class="token punctuation">(</span>
  tag<span class="token operator">:</span> WorkTag<span class="token punctuation">,</span>
  pendingProps<span class="token operator">:</span> mixed<span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> TypeOfMode<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// $FlowFixMe[invalid-constructor]: the shapes are exact here but Flow doesn't like constructors</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FiberNode</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> pendingProps<span class="token punctuation">,</span> key<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="FiberNode__221">
     </a>
     FiberNode 构造函数
    </h2>
    <p>
     <code>
      FiberNode
     </code>
     是一个构造函数，用于创建 React 的
     <code>
      Fiber
     </code>
     节点。
    </p>
    <blockquote>
     <p>
      函数参数含义：
      <br/>
      ●
      <code>
       tag
      </code>
      : WorkTag：tag 是一个 WorkTag 类型的值，用于标识 Fiber 节点的类型，例如是函数组件、类组件、原生 DOM 元素等。不同的 tag 值对应不同的处理逻辑。
      <br/>
      ●
      <code>
       pendingProps
      </code>
      : mixed：pendingProps 表示当前节点的待处理属性，是一个任意类型的值。这些属性是从父组件传递过来的，在节点的处理过程中可能会被更新。
      <br/>
      ●
      <code>
       key
      </code>
      : null | string：key 是一个可选的字符串，用于帮助 React 识别哪些元素发生了变化，提高列表渲染的性能。如果没有提供 key，则为 null。
      <br/>
      ●
      <code>
       mode
      </code>
      : TypeOfMode：mode 表示节点的模式，它定义了节点的一些行为和特性，例如是否处于严格模式等。
     </p>
    </blockquote>
    <pre><code class="prism language-ts"><span class="token keyword">function</span> <span class="token function">FiberNode</span><span class="token punctuation">(</span>
  <span class="token keyword">this</span><span class="token operator">:</span> $FlowFixMe<span class="token punctuation">,</span>
  tag<span class="token operator">:</span> WorkTag<span class="token punctuation">,</span>
  pendingProps<span class="token operator">:</span> mixed<span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> TypeOfMode<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// Instance</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>elementType <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>stateNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 存储与该 Fiber 节点对应的实际 DOM 节点或组件实例，初始化为 null。</span>

  <span class="token comment">// Fiber</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>return <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sibling <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>ref <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>refCleanup <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingProps <span class="token operator">=</span> pendingProps<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedProps <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>memoizedState <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> mode<span class="token punctuation">;</span>

  <span class="token comment">// Effects</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>flags <span class="token operator">=</span> NoFlags<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subtreeFlags <span class="token operator">=</span> NoFlags<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>deletions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>lanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>childLanes <span class="token operator">=</span> NoLanes<span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>alternate <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

 <span class="token comment">// if (enableProfilerTimer) {<!-- --></span>
  <span class="token comment">//  this.actualDuration = -0;</span>
  <span class="token comment">//  this.actualStartTime = -1.1;</span>
  <span class="token comment">//  this.selfBaseDuration = -0;</span>
   <span class="token comment">// this.treeBaseDuration = -0;</span>
<span class="token comment">//  }</span>

<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34303131393431322f:61727469636c652f64657461696c732f313436323536363931" class_="artid" style="display:none">
 </p>
</div>


