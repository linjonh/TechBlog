---
layout: post
title: "图像标注与OCR工具分析"
date: 2025-03-06 10:52:52 +0800
description: "加载图像并显示在界面上。允许用户在图像上绘制矩形框，以标注感兴趣的区域。在标注区域内执行OCR识别，并显示识别的文本。将OCR识别结果保存为Excel文件。保存和加载用户的标注数据（JSON格式）。提供裁剪、清除标注、重置图像等功能。"
keywords: "图像标注与OCR工具分析"
categories: ['未分类']
tags: ['遍历', '裁剪', '框选', '标示', '位置', 'Ocr']
artid: "146062412"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146062412
    alt: "图像标注与OCR工具分析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146062412
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146062412
cover: https://bing.ee123.net/img/rand?artid=146062412
image: https://bing.ee123.net/img/rand?artid=146062412
img: https://bing.ee123.net/img/rand?artid=146062412
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     图像标注与OCR工具分析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     图像标注和OCR（光学字符识别）工具的代码进行详细分析。该工具允许用户在图像上进行矩形标注，使用 OCR 对标注区域进行文本识别，并将结果保存为 Excel 文件。同时，用户可以保存和加载标注，清除标注，以及裁剪图像等。
     <br/>
     C:\pythoncode\new\scipgetpersoninfofromphoto.py
    </p>
    <h5>
     <a id="_2">
     </a>
     项目简介
    </h5>
    <p>
     这个图像标注和OCR工具的功能主要包括：
    </p>
    <ol>
     <li>
      加载图像并显示在界面上。
     </li>
     <li>
      允许用户在图像上绘制矩形框，以标注感兴趣的区域。
     </li>
     <li>
      在标注区域内执行OCR识别，并显示识别的文本。
     </li>
     <li>
      将OCR识别结果保存为Excel文件。
     </li>
     <li>
      保存和加载用户的标注数据（JSON格式）。
     </li>
     <li>
      提供裁剪、清除标注、重置图像等功能。
     </li>
    </ol>
    <h5>
     <a id="1__12">
     </a>
     1. 图像加载与显示
    </h5>
    <p>
     首先，程序会扫描指定文件夹中的图像文件（支持的格式包括
     <code>
      .png
     </code>
     ,
     <code>
      .jpg
     </code>
     ,
     <code>
      .jpeg
     </code>
     ,
     <code>
      .bmp
     </code>
     ,
     <code>
      .tiff
     </code>
     ），并显示在界面的图像面板中。
    </p>
    <pre><code class="prism language-python">self<span class="token punctuation">.</span>image_files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span> 
                    <span class="token keyword">if</span> f<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'.png'</span><span class="token punctuation">,</span> <span class="token string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string">'.jpeg'</span><span class="token punctuation">,</span> <span class="token string">'.bmp'</span><span class="token punctuation">,</span> <span class="token string">'.tiff'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
    <p>
     通过
     <code>
      wx.ListBox
     </code>
     组件显示图像文件的列表，用户可以点击选择一个文件，然后加载并显示它：
    </p>
    <pre><code class="prism language-python">file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>folder_path<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>original_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imdecode<span class="token punctuation">(</span>np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>original_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>original_image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
</code></pre>
    <p>
     这段代码使用 OpenCV 读取图像，并转换颜色空间以适应
     <code>
      wxPython
     </code>
     显示。
    </p>
    <h5>
     <a id="2__31">
     </a>
     2. 矩形标注
    </h5>
    <p>
     用户可以在图像上绘制矩形框，标记感兴趣的区域。程序通过鼠标事件（按下、移动、松开）来绘制和更新矩形框：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">on_mouse_down</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""鼠标按下开始绘制矩形"""</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>displayed_image <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>start_point <span class="token operator">=</span> event<span class="token punctuation">.</span>GetPosition<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>drawing <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">on_mouse_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""鼠标移动时更新矩形"""</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>drawing <span class="token keyword">and</span> self<span class="token punctuation">.</span>displayed_image <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>image_panel<span class="token punctuation">.</span>Refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">on_mouse_up</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""鼠标松开完成矩形绘制"""</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>drawing <span class="token keyword">and</span> self<span class="token punctuation">.</span>displayed_image <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        end_point <span class="token operator">=</span> event<span class="token punctuation">.</span>GetPosition<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 确保矩形方向正确</span>
        x1 <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> end_point<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        y1 <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_point<span class="token punctuation">.</span>y<span class="token punctuation">,</span> end_point<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_point<span class="token punctuation">.</span>x<span class="token punctuation">,</span> end_point<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        y2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_point<span class="token punctuation">.</span>y<span class="token punctuation">,</span> end_point<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        orig_rect <span class="token operator">=</span> self<span class="token punctuation">.</span>convert_to_original_coords<span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rectangles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>orig_rect<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>drawing <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>image_panel<span class="token punctuation">.</span>Refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     在
     <code>
      on_mouse_down
     </code>
     中，用户点击图像开始绘制矩形框，
     <code>
      on_mouse_move
     </code>
     用于实时更新矩形的形状，
     <code>
      on_mouse_up
     </code>
     在用户松开鼠标时完成矩形的绘制。
    </p>
    <h5>
     <a id="3_OCR_64">
     </a>
     3. OCR识别
    </h5>
    <p>
     标注完成后，用户可以点击“识别”按钮，程序会对标注区域进行OCR识别。OCR处理通过
     <code>
      pytesseract
     </code>
     库实现：
    </p>
    <pre><code class="prism language-python">text <span class="token operator">=</span> pytesseract<span class="token punctuation">.</span>image_to_string<span class="token punctuation">(</span>
    pil_image<span class="token punctuation">,</span> 
    lang<span class="token operator">=</span><span class="token string">'chi_sim'</span><span class="token punctuation">,</span>  <span class="token comment"># 中文简体</span>
    config<span class="token operator">=</span><span class="token string">'--psm 6 --oem 3'</span>  <span class="token comment"># 更精确的文本块处理</span>
<span class="token punctuation">)</span>
</code></pre>
    <p>
     识别结果会显示在文本框中，并且可以将识别的结果保存为Excel文件：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">if</span> ocr_results<span class="token punctuation">:</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'识别区域'</span><span class="token punctuation">:</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ocr_results<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'识别文本'</span><span class="token punctuation">:</span> ocr_results<span class="token punctuation">}</span><span class="token punctuation">)</span>
    output_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>folder_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>current_filename<span class="token punctuation">}</span></span><span class="token string">_ocr_results.xlsx'</span></span><span class="token punctuation">)</span>
    df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'openpyxl'</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     使用
     <code>
      pandas
     </code>
     库将识别结果保存为Excel文件，方便后续查看和处理。
    </p>
    <h5>
     <a id="4__87">
     </a>
     4. 标注的保存与加载
    </h5>
    <p>
     程序还允许用户将标注区域保存为 JSON 格式，以便下次加载时使用。这是通过以下方式实现的：
    </p>
    <pre><code class="prism language-python">annotations_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'filename'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>current_filename<span class="token punctuation">,</span>
    <span class="token string">'rectangles'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>rectangles
<span class="token punctuation">}</span>
json_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>folder_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>current_filename<span class="token punctuation">}</span></span><span class="token string">_annotations.json'</span></span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>annotations_data<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
</code></pre>
    <p>
     标注文件会根据图像的文件名命名，以便与图像文件对应。加载标注时，程序会读取 JSON 文件并恢复之前的标注状态：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    annotations_data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">if</span> annotations_data<span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>current_filename<span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>rectangles <span class="token operator">=</span> annotations_data<span class="token punctuation">[</span><span class="token string">'rectangles'</span><span class="token punctuation">]</span>
</code></pre>
    <h5>
     <a id="5__110">
     </a>
     5. 裁剪与重置图像
    </h5>
    <p>
     裁剪功能允许用户裁剪图像的选定区域。用户完成矩形绘制后，点击“裁剪”按钮，程序会根据最后一个矩形进行图像裁剪：
    </p>
    <pre><code class="prism language-python">cropped <span class="token operator">=</span> self<span class="token punctuation">.</span>current_image<span class="token punctuation">[</span>y1<span class="token punctuation">:</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">:</span>x2<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     如果需要重置图像，用户可以点击“重置图像”按钮，程序将恢复到原始图像状态。
    </p>
    <h5>
     <a id="6_UI_120">
     </a>
     6. UI组件与布局
    </h5>
    <p>
     <code>
      wxPython
     </code>
     的布局管理使得界面整洁易用。主界面分为文件列表、图像显示区域和操作按钮区域三个部分。文件列表用于选择图像，图像显示区域展示图像并允许标注，按钮区域提供裁剪、标注、OCR识别等操作。
    </p>
    <pre><code class="prism language-python">file_list_sizer <span class="token operator">=</span> wx<span class="token punctuation">.</span>BoxSizer<span class="token punctuation">(</span>wx<span class="token punctuation">.</span>VERTICAL<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>file_listbox <span class="token operator">=</span> wx<span class="token punctuation">.</span>ListBox<span class="token punctuation">(</span>panel<span class="token punctuation">,</span> choices<span class="token operator">=</span>self<span class="token punctuation">.</span>image_files<span class="token punctuation">,</span> style<span class="token operator">=</span>wx<span class="token punctuation">.</span>LB_SINGLE<span class="token punctuation">)</span>
file_list_sizer<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>self<span class="token punctuation">.</span>file_listbox<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> wx<span class="token punctuation">.</span>EXPAND <span class="token operator">|</span> wx<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     通过
     <code>
      BoxSizer
     </code>
     管理不同控件的布局，使得界面更加模块化和灵活。
    </p>
    <h5>
     <a id="_132">
     </a>
     运行结果
    </h5>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4afd4b890e0b4191ad707381a3313f69.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f77696e6e69657a68616e672f:61727469636c652f64657461696c732f313436303632343132" class_="artid" style="display:none">
 </p>
</div>


