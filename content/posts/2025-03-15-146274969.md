---
layout: post
title: "FPGA中级项目2硬核-or-软核与FIFO的配置"
date: 2025-03-15 11:13:32 +0800
description: "关于IP核中为什么是硬核？为什么是软核？他们的区别如何？以及在vivado中对FIFO模块IP核的讲解与相关配置，包含详细原理与源代码！"
keywords: "FPGA中级项目2——硬核 or 软核与FIFO的配置"
categories: ['未分类']
tags: ['集成学习', '经验分享', '学习方法', 'Ip', 'Fpga']
artid: "146274969"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146274969
    alt: "FPGA中级项目2硬核-or-软核与FIFO的配置"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146274969
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146274969
cover: https://bing.ee123.net/img/rand?artid=146274969
image: https://bing.ee123.net/img/rand?artid=146274969
img: https://bing.ee123.net/img/rand?artid=146274969
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     FPGA中级项目2——硬核 or 软核与FIFO的配置
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 style="text-align:center">
     FPGA中级项目2——硬核 or 软核与FIFO的配置
    </h2>
    <p>
    </p>
    <p>
     在上一个项目中提到关于IP核 ROM与RAM 的配置，需要指出的是：
     <span style="color:#ad720d">
      <strong>
       我们配置为分布式时是软核（即只需要占用小型的存贮资源），而配置BRAM为硬核（占用较大的资源）
      </strong>
     </span>
    </p>
    <hr/>
    <h3>
     <strong>
      那问题来了：硬核不是在FPGA芯片制造时已经固定好的吗？怎么还能对其配置呢？
     </strong>
    </h3>
    <p>
     <br/>
     这就要区分硬核的
     <strong>
      “固定性” 与 “可配置性”
     </strong>
     <br/>
     硬核的物理结构固定：硬核是芯片制造时已固化的物理电路模块（如 BRAM、DSP 单元等），其内部逻辑和晶体管布局无法被用户修改。
     <br/>
     但是，
     <strong>
      配置≠修改硬件结构
     </strong>
     ：用户通过工具（如 Vivado）对硬核进行的 “配置”，本质是选择硬核的使用方式，而非改变其物理结构。
    </p>
    <p>
     <strong>
      例如：
     </strong>
     <br/>
     <strong>
      BRAM 的配置：
     </strong>
     设置数据宽度、深度、读写模式等参数，但 BRAM 的存储单元数量和基本架构不变。
     <br/>
     <strong>
      硬核 IP 核：
     </strong>
     如 PCIe 硬核，用户可配置接口速率、地址空间等，但底层物理层协议已固化
    </p>
    <h3>
     <br/>
     <strong>
      新的问题来了：怎么知道自己配置的是软核还是硬核？
     </strong>
    </h3>
    <h4>
     <br/>
     <strong>
      配置为软核的情况
     </strong>
    </h4>
    <p>
     <br/>
     <strong>
      1. 基于可编程逻辑资源实现
     </strong>
     <br/>
     原理：当使用 Vivado 配置 ROM 和 RAM 时，如果没有使用 FPGA 内部特定的硬核存储资源，而是利用可编程逻辑资源（如查找表 LUT 和触发器）来实现存储功能，那么它们就是软核。
     <br/>
     特点
     <br/>
     高度可配置：用户可以根据需求灵活调整存储容量、数据宽度等参数。例如，可以轻松改变 ROM 的初始化数据内容，或者调整 RAM 的读写端口数量和读写模式。
     <br/>
     资源灵活分配：在不同的 FPGA 器件上，只要有足够的可编程逻辑资源，就可以实现相应的 ROM 和 RAM 功能，并且可以根据资源情况进行合理的布局布线。
     <br/>
     可移植性强：由于是基于硬件描述语言实现的逻辑结构，所以可以在不同工艺和型号的 FPGA 之间进行移植，只需对部分参数进行适当调整。
     <br/>
     <strong>
      2. 使用分布式 RAM 实现
     </strong>
     <br/>
     原理：分布式 RAM 是利用 FPGA 中的查找表（LUT）来实现的一种存储方式。在 Vivado 中配置时，用户可以选择使用分布式 RAM 来构建较小容量的 RAM。
     <br/>
     特点
     <br/>
     软核特性明显：它本质上是由可编程逻辑资源构成，配置过程中可以根据需求进行定制，例如选择不同的寻址方式和数据宽度。
     <br/>
     适合小规模存储：由于 LUT 资源相对有限，分布式 RAM 通常适用于存储容量较小的场景，如存储一些常量数据或小规模的临时数据。
    </p>
    <h4>
     <strong>
      可能配置为硬核的情况
     </strong>
    </h4>
    <p>
     <br/>
     <strong>
      1. 使用块 RAM（BRAM）硬核资源
     </strong>
     <br/>
     原理：大多数 FPGA 芯片都集成了块 RAM 硬核，这是一种预先设计好的、高性能的存储模块。在 Vivado 配置 ROM 或 RAM 时，如果选择使用块 RAM 资源，就相当于使用了 FPGA 的硬核。
     <br/>
     特点
     <br/>
     高性能：块 RAM 具有较高的读写速度和带宽，能够满足对存储性能要求较高的应用场景，如高速数据缓存。
     <br/>
     资源固定性：块 RAM 的结构和功能是固定的，虽然在配置时可以对一些参数（如数据宽度、深度）进行调整，但基本的存储结构是由芯片制造商预先设计好的，用户无法对其内部结构进行修改。
     <br/>
     资源限制：使用块 RAM 时会受到芯片中块 RAM 资源数量和大小的限制，如果需求超过了芯片提供的块 RAM 资源，就需要采用其他方式（如分布式 RAM）进行补充。
    </p>
    <p>
    </p>
    <h3>
     硬核与软核的配置差异
    </h3>
    <p>
     <img alt="" height="453" src="https://i-blog.csdnimg.cn/direct/d14f8e25c8504458bd290ba65f1eed24.png" width="1426"/>
    </p>
    <hr/>
    <p>
    </p>
    <p>
     <span style="color:#ad720d">
      <strong>
       今天我们所要配置的即为软核IP之一-----FIFO
      </strong>
     </span>
     <br/>
     FIFO 是一种逻辑功能，可通过用户编程实现，而非 FPGA 芯片上的预定义固定模块。虽然 FIFO 本身不固定，但部分 FPGA 的 BRAM、时钟管理单元（CMU）等固定硬件可辅助优化 FIFO 性能
    </p>
    <hr/>
    <h3>
     FIFO简介
    </h3>
    <p>
     <br/>
     <strong>
      在 FPGA（现场可编程门阵列）中，FIFO（First-In-First-Out，先进先出队列）是一种常用的时序逻辑模块，主要用于数据缓冲、跨时钟域数据传输或速率匹配。
     </strong>
     <br/>
    </p>
    <p class="img-center">
     <img alt="" height="370" src="https://i-blog.csdnimg.cn/direct/7af9b910cc5d43dfb5fa161a89d62fee.png" width="533"/>
    </p>
    <h4>
     1. FIFO 的基本功能
    </h4>
    <p>
     <br/>
     数据缓冲：临时存储数据，缓解不同模块之间的数据速率差异。
     <br/>
     跨时钟域处理：允许数据在不同时钟域的模块间安全传输，避免亚稳态问题。
     <br/>
     突发数据管理：应对突发数据的输入或输出，确保系统稳定性
    </p>
    <h4>
     2. FIFO 的核心结构
    </h4>
    <p>
     <br/>
     存储单元：由 RAM 或寄存器组成，用于存储数据。
     <br/>
     读写指针：跟踪数据写入和读取的位置（通常使用计数器或移位寄存器实现）。
     <br/>
     控制逻辑：
     <br/>
     空 / 满状态：指示 FIFO 是否为空或满，防止下溢（读空）或溢出（写满）。
     <br/>
     读写使能：控制数据的写入和读取操作。
     <br/>
     状态信号：如剩余空间、当前存储量等。
    </p>
    <h4>
     3. FIFO 的关键参数
    </h4>
    <p>
     <br/>
     数据宽度：单次读写的数据位数（如 32 位、64 位）。
     <br/>
     深度：可存储的数据单元数量（如 1024 字）。
     <br/>
     读写速率：受时钟频率和逻辑延迟限制。
     <br/>
     延迟：数据从写入到读出的周期数（通常为固定值）。
    </p>
    <h4>
     <br/>
     4. FIFO 的应用场景
    </h4>
    <p>
     <br/>
     跨时钟域通信：如 AXI 接口与本地时钟模块之间的数据交互。
     <br/>
     数据速率匹配：例如高速 ADC 与低速处理器之间的数据缓冲。
     <br/>
     突发数据处理：存储突发传输的数据，避免丢包。
     <br/>
     流水线设计：在多级流水线中缓冲中间结果。
    </p>
    <hr/>
    <h3>
     问题分析
    </h3>
    <p>
     <strong>
      1.
     </strong>
     首先在对FIFO配置时，要明确其特点。
     <strong>
      其一：先入先出；其二：有写入侧和读出侧位宽可能不同的要求。
     </strong>
     下图为对FIFO基础页面的配置，其中fifo implementation 是FIFO的实现方式，可以选择时钟与输入输出端口的不同来进行配置。
    </p>
    <p>
     <img alt="" height="1131" src="https://i-blog.csdnimg.cn/direct/8542ffcc3e464634a555ab9cbf4474c2.png" width="1787"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      2.
     </strong>
     这里来假设设置写入与读出的位宽不一样的情况。
     <strong>
      read mode 设置为FWFT（First Word Fall-Through）模式，也称为 “首字直通” 模式。
     </strong>
     在传统的 FIFO 模式下，当发出读使能信号后，数据需要一个时钟周期才能从 FIFO 输出。而在 FWFT 模式下，FIFO 的输出端会始终呈现 FIFO 中第一个数据（即即将被读出的数据），一旦读使能信号有效，这个数据会立即被输出，无需额外的时钟周期等待，实现了数据的 “直通” 输出。
    </p>
    <p>
     <img alt="" height="1163" src="https://i-blog.csdnimg.cn/direct/2985da0dd73c4b4bbe412382d7433abd.png" width="2060"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      3.
     </strong>
     在以下的状态标志页面中，有optional flags 可配置为
     <strong>
      几乎全满和几乎全空模式
     </strong>
     。还有相应的握手选项（handshaking options）用来表示。在 FIFO（先进先出队列）中，
     <strong>
      overflow（溢出）和underflow（下溢）
     </strong>
     是两种关键的错误状态，分别对应数据写入和读取过程中的异常情况。可选择是否配置来标志信号。
    </p>
    <p>
     overflow（溢出）：当 FIFO 已被数据填满（即达到最大存储容量），但仍有新数据试图写入时，会发生
     <strong>
      溢出
     </strong>
     。此时新数据无法被存储，导致数据丢失。
    </p>
    <p>
     underflow（下溢）：当 FIFO 已为空（无数据可读取），但仍有读取操作被触发时，会发生
     <strong>
      下溢
     </strong>
     。此时读取到的数据可能是无效值或未定义数据。
    </p>
    <p>
     <img alt="" height="1277" src="https://i-blog.csdnimg.cn/direct/dcdfe3ff747742aabfedee0ae662ffa5.png" width="2078"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      4.
     </strong>
     在数据计数端口进行配置时，有
     <strong>
      more accurate data counts 选项可勾选。若勾选，wr_data_count 的位宽会多一位。
     </strong>
     该选项的主要作用是
     <span style="color:#ad720d">
      <strong>
       提供更精确的 FIFO 内数据数量
      </strong>
     </span>
     的统计信息。在 FIFO 的常规操作中，需要知道当前 FIFO 中存储了多少数据，这对于控制数据的读写操作非常关键。例如，在决定是否继续写入数据（要避免溢出）或者是否还有数据可供读取（防止下溢）时，数据计数是重要的判断依据。开启 “more accurate data counts” 选项后，能让这个计数更加精准，减少因计数误差导致的读写异常。但是需根据 FIFO 深度、时钟域数量及资源限制决定是否启用此选项。
     <strong>
      若资源紧张且对精度要求不高，可关闭该选项以节省硬件成本。
     </strong>
    </p>
    <p>
     <img alt="" height="841" src="https://i-blog.csdnimg.cn/direct/419af697bfab4cd8b976ca884723d55b.png" width="2085"/>
    </p>
    <p>
    </p>
    <p>
     5. 最后便是FIFO IP核配置的总结页面，可根据实际项目结合芯片手册选择性修改
    </p>
    <p>
     <img alt="" height="948" src="https://i-blog.csdnimg.cn/direct/fa1c9fb838d749b4b1bbdc8d8069a36e.png" width="2074"/>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36373430303137362f:61727469636c652f64657461696c732f313436323734393639" class_="artid" style="display:none">
 </p>
</div>


