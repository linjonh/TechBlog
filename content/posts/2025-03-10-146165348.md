---
layout: post
title: "Nest.js全栈开发终极实践TypeORM微服务Docker构建高可用企业级应用"
date: 2025-03-10 22:54:27 +0800
description: "从环境搭建到性能优化，10章完整项目驱动教学，快速掌握现代后端开发核心技能"
keywords: "Nest.js全栈开发终极实践：TypeORM+微服务+Docker构建高可用企业级应用"
categories: ['未分类']
tags: ['微服务', 'Javascript', 'Docker']
artid: "146165348"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146165348
    alt: "Nest.js全栈开发终极实践TypeORM微服务Docker构建高可用企业级应用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146165348
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146165348
cover: https://bing.ee123.net/img/rand?artid=146165348
image: https://bing.ee123.net/img/rand?artid=146165348
img: https://bing.ee123.net/img/rand?artid=146165348
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Nest.js全栈开发终极实践：TypeORM+微服务+Docker构建高可用企业级应用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h4>
     <a id="Nestjs_1">
     </a>
     <strong>
      第一部分：认识Nest.js与基础环境搭建
     </strong>
    </h4>
    <h5>
     <a id="11_Nestjs_3">
     </a>
     <strong>
      1.1 什么是Nest.js？
     </strong>
    </h5>
    <ul>
     <li>
      Node.js后端框架（类似Express/Koa但更结构化）
     </li>
     <li>
      使用TypeScript构建（也支持JavaScript）
     </li>
     <li>
      结合了面向对象编程（OOP）+ 函数式编程（FP）
     </li>
     <li>
      内置依赖注入、模块化架构
     </li>
     <li>
      适合构建高效、可靠且易维护的服务端应用
     </li>
    </ul>
    <h5>
     <a id="12__10">
     </a>
     <strong>
      1.2 环境准备
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：安装Node.js
     </strong>
    </p>
    <ul>
     <li>
      前往
      <a href="https://nodejs.org/" rel="nofollow">
       官网
      </a>
      下载LTS版本（建议v18+）
     </li>
     <li>
      安装完成后验证：
      <pre><code class="prism language-bash"><span class="token function">node</span> <span class="token parameter variable">-v</span>  <span class="token comment"># 显示版本号</span>
<span class="token function">npm</span> <span class="token parameter variable">-v</span>   <span class="token comment"># 显示版本号</span>
</code></pre>
     </li>
    </ul>
    <p>
     <strong>
      步骤2：安装Nest CLI
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @nestjs/cli
</code></pre>
    <h5>
     <a id="13__24">
     </a>
     <strong>
      1.3 创建第一个项目
     </strong>
    </h5>
    <pre><code class="prism language-bash">nest new my-first-project
</code></pre>
    <p>
     选择包管理器（推荐使用npm或yarn）
    </p>
    <p>
     <strong>
      目录结构说明
     </strong>
     ：
    </p>
    <pre><code>my-first-project/
├── src/
│   ├── app.controller.ts    # 控制器（处理HTTP请求）
│   ├── app.service.ts       # 服务（业务逻辑）
│   ├── app.module.ts        # 根模块（组织应用结构）
│   └── main.ts              # 应用入口文件
</code></pre>
    <h5>
     <a id="14__40">
     </a>
     <strong>
      1.4 启动开发服务器
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> my-first-project
<span class="token function">npm</span> run start:dev
</code></pre>
    <p>
     访问 http://localhost:3000 看到"Hello World!"
    </p>
    <h5>
     <a id="15__47">
     </a>
     <strong>
      1.5 核心文件解读
     </strong>
    </h5>
    <p>
     <strong>
      main.ts
     </strong>
     （应用入口）：
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建应用实例</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听端口</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      app.controller.ts
     </strong>
     （示例控制器）：
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> AppService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 控制器装饰器</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> appService<span class="token operator">:</span> AppService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">// 依赖注入</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 处理GET请求</span>
  <span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appService<span class="token punctuation">.</span><span class="token function">getHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_78">
     </a>
     <strong>
      第二部分：基础控制器与路由
     </strong>
    </h4>
    <h5>
     <a id="21__80">
     </a>
     <strong>
      2.1 控制器的作用
     </strong>
    </h5>
    <ul>
     <li>
      负责处理客户端请求
     </li>
     <li>
      通过装饰器定义路由路径
     </li>
     <li>
      调用服务层处理业务逻辑
     </li>
     <li>
      返回HTTP响应
     </li>
    </ul>
    <h5>
     <a id="22__86">
     </a>
     <strong>
      2.2 创建自定义控制器
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：生成新控制器
     </strong>
    </p>
    <pre><code class="prism language-bash">nest generate controller user
<span class="token comment"># 或简写 nest g co user</span>
</code></pre>
    <p>
     生成文件
     <code>
      src/user/user.controller.ts
     </code>
    </p>
    <p>
     <strong>
      步骤2：基础路由示例
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// user.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span> <span class="token comment">// 定义路由前缀 /users</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 处理 /users 的GET请求</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string">'All users'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'profile'</span><span class="token punctuation">)</span> <span class="token comment">// 处理 /users/profile 的GET请求</span>
  <span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string">'User profile'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="23__113">
     </a>
     <strong>
      2.3 路由参数处理
     </strong>
    </h5>
    <p>
     <strong>
      示例1：路径参数
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span> <span class="token comment">// 匹配 /users/123 形式的请求</span>
<span class="token function">findOne</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      示例2：查询参数
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">)</span>
<span class="token function">search</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Searching for: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      示例3：POST请求体
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> userData<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Created user: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="24__138">
     </a>
     <strong>
      2.4 状态码处理
     </strong>
    </h5>
    <ul>
     <li>
      默认GET返回200，POST返回201
     </li>
     <li>
      手动指定状态码：
     </li>
    </ul>
    <pre><code class="prism language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">HttpCode</span></span><span class="token punctuation">(</span><span class="token number">202</span><span class="token punctuation">)</span> <span class="token comment">// 自定义状态码</span>
<span class="token function">createWithStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string">'Created with custom status'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="25__149">
     </a>
     <strong>
      2.5 完整示例
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Param<span class="token punctuation">,</span> Query<span class="token punctuation">,</span> Body<span class="token punctuation">,</span> HttpCode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string">'User list'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> user<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Created user: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">)</span>
  <span class="token function">search</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Query</span></span><span class="token punctuation">(</span><span class="token string">'keyword'</span><span class="token punctuation">)</span> keyword<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Search keyword: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>keyword<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="26_API_177">
     </a>
     <strong>
      2.6 测试你的API
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       使用Postman或curl测试：
      </p>
      <pre><code class="prism language-bash"><span class="token comment"># GET请求示例</span>
<span class="token function">curl</span> http://localhost:3000/users
<span class="token function">curl</span> http://localhost:3000/users/123
<span class="token function">curl</span> http://localhost:3000/users/search?keyword<span class="token operator">=</span>john

<span class="token comment"># POST请求示例</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token parameter variable">-d</span> <span class="token string">'{"name":"Alice"}'</span> http://localhost:3000/users
</code></pre>
     </li>
     <li>
      <p>
       观察返回结果是否符合预期
      </p>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_193">
     </a>
     <strong>
      关键概念总结
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        装饰器
       </th>
       <th>
        作用
       </th>
       <th>
        示例
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         @Controller
        </code>
       </td>
       <td>
        定义控制器类并设置路由前缀
       </td>
       <td>
        <code>
         @Controller('users')
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @Get
        </code>
       </td>
       <td>
        处理GET请求
       </td>
       <td>
        <code>
         @Get(':id')
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @Post
        </code>
       </td>
       <td>
        处理POST请求
       </td>
       <td>
        <code>
         @Post()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @Param
        </code>
       </td>
       <td>
        获取路径参数
       </td>
       <td>
        <code>
         @Param('id')
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @Query
        </code>
       </td>
       <td>
        获取查询参数
       </td>
       <td>
        <code>
         @Query('page')
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @Body
        </code>
       </td>
       <td>
        获取请求体数据
       </td>
       <td>
        <code>
         @Body() userData
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @HttpCode
        </code>
       </td>
       <td>
        设置响应状态码
       </td>
       <td>
        <code>
         @HttpCode(204)
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="_206">
     </a>
     <strong>
      第三部分：服务层与依赖注入
     </strong>
    </h4>
    <h5>
     <a id="31__208">
     </a>
     <strong>
      3.1 为什么需要服务层？
     </strong>
    </h5>
    <ul>
     <li>
      遵循单一职责原则（控制器只处理请求/响应）
     </li>
     <li>
      集中存放业务逻辑
     </li>
     <li>
      方便代码复用和测试
     </li>
     <li>
      通过依赖注入实现解耦
     </li>
    </ul>
    <h5>
     <a id="32__214">
     </a>
     <strong>
      3.2 创建第一个服务
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：生成服务文件
     </strong>
    </p>
    <pre><code class="prism language-bash">nest generate <span class="token function">service</span> user
<span class="token comment"># 或简写 nest g s user</span>
</code></pre>
    <p>
     生成文件：
    </p>
    <ul>
     <li>
      <code>
       src/user/user.service.ts
      </code>
      （服务类）
     </li>
     <li>
      <code>
       src/user/user.service.spec.ts
      </code>
      （测试文件）
     </li>
    </ul>
    <p>
     <strong>
      步骤2：基础服务示例
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// user.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 标记为可注入的类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">private</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">getAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">createUser</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> newUser <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newUser<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="33__248">
     </a>
     <strong>
      3.3 依赖注入实战
     </strong>
    </h5>
    <p>
     <strong>
      改造控制器（user.controller.ts）：
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Body <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">// 依赖注入</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">getAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="34_Module_270">
     </a>
     <strong>
      3.4 模块（Module）的作用
     </strong>
    </h5>
    <p>
     <strong>
      查看自动生成的 user.module.ts：
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.controller'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>UserController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>UserService<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 注册服务</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserModule</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      关键点：
     </strong>
    </p>
    <ul>
     <li>
      模块是Nest的组织单元
     </li>
     <li>
      <code>
       providers
      </code>
      数组注册可注入的类
     </li>
     <li>
      通过
      <code>
       @Global()
      </code>
      可以创建全局模块
     </li>
    </ul>
    <h5>
     <a id="35__289">
     </a>
     <strong>
      3.5 完整流程测试
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       通过Postman发送请求：
      </p>
      <pre><code class="prism language-http">GET http://localhost:3000/users
POST http://localhost:3000/users
Body: { "name": "Bob" }
</code></pre>
     </li>
     <li>
      <p>
       观察响应结果：
      </p>
      <pre><code class="prism language-json"><span class="token comment">// GET 响应</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"John"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"Alice"</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// POST 响应</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1625641654845</span><span class="token punctuation">,</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"Bob"</span> <span class="token punctuation">}</span>
</code></pre>
     </li>
    </ol>
    <h5>
     <a id="36__309">
     </a>
     <strong>
      3.6 依赖注入原理图解
     </strong>
    </h5>
    <pre><code>+---------------+
|   Controller  |
|---------------|          +---------------+
|  constructor( |&lt;--------|   UserService  |
|  userService) |          +---------------+
+---------------+
       ▲
       | 通过@Module装饰器的providers数组注册
+---------------+
|    Module     |
|---------------|
| providers: [  |
|  UserService  |
| ]             |
+---------------+
</code></pre>
    <hr/>
    <h4>
     <a id="_330">
     </a>
     <strong>
      核心概念对比
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        组件
       </th>
       <th>
        职责
       </th>
       <th>
        关键装饰器
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        控制器（Controller）
       </td>
       <td>
        处理HTTP请求/响应
       </td>
       <td>
        <code>
         @Controller
        </code>
       </td>
      </tr>
      <tr>
       <td>
        服务（Service）
       </td>
       <td>
        实现业务逻辑
       </td>
       <td>
        <code>
         @Injectable
        </code>
       </td>
      </tr>
      <tr>
       <td>
        模块（Module）
       </td>
       <td>
        组织应用结构，管理依赖关系
       </td>
       <td>
        <code>
         @Module
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     接下来计划讲解：
     <br/>
     <strong>
      第四部分：数据库集成（TypeORM + PostgreSQL）
     </strong>
     <br/>
     包括：
    </p>
    <ul>
     <li>
      TypeORM基本配置
     </li>
     <li>
      实体（Entity）创建
     </li>
     <li>
      CRUD操作实现
     </li>
     <li>
      数据验证与DTO
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="TypeORM__PostgreSQL_347">
     </a>
     <strong>
      第四部分：数据库集成（TypeORM + PostgreSQL）
     </strong>
    </h4>
    <h5>
     <a id="41__349">
     </a>
     <strong>
      4.1 准备工作
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       安装所需依赖：
      </p>
      <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/typeorm typeorm pg
</code></pre>
      <ul>
       <li>
        <code>
         @nestjs/typeorm
        </code>
        : Nest的TypeORM集成包
       </li>
       <li>
        <code>
         typeorm
        </code>
        : ORM框架
       </li>
       <li>
        <code>
         pg
        </code>
        : PostgreSQL驱动
       </li>
      </ul>
     </li>
     <li>
      <p>
       确保已安装PostgreSQL数据库（本地或使用云服务）
      </p>
     </li>
    </ol>
    <h5>
     <a id="42__360">
     </a>
     <strong>
      4.2 配置数据库连接
     </strong>
    </h5>
    <p>
     <strong>
      修改
      <code>
       app.module.ts
      </code>
      ：
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      type<span class="token operator">:</span> <span class="token string">'postgres'</span><span class="token punctuation">,</span>
      host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>      <span class="token comment">// 数据库地址</span>
      port<span class="token operator">:</span> <span class="token number">5432</span><span class="token punctuation">,</span>            <span class="token comment">// 数据库端口</span>
      username<span class="token operator">:</span> <span class="token string">'postgres'</span><span class="token punctuation">,</span>   <span class="token comment">// 数据库用户名</span>
      password<span class="token operator">:</span> <span class="token string">'your_password'</span><span class="token punctuation">,</span> <span class="token comment">// 数据库密码</span>
      database<span class="token operator">:</span> <span class="token string">'nestdemo'</span><span class="token punctuation">,</span>   <span class="token comment">// 数据库名称</span>
      entities<span class="token operator">:</span> <span class="token punctuation">[</span>__dirname <span class="token operator">+</span> <span class="token string">'/**/*.entity{.ts,.js}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 自动扫描实体文件</span>
      synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token comment">// 开发环境自动同步数据库结构（生产环境禁用！）</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    UserModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="43_Entity_383">
     </a>
     <strong>
      4.3 创建第一个实体（Entity）
     </strong>
    </h5>
    <p>
     <strong>
      新建
      <code>
       src/user/user.entity.ts
      </code>
      ：
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Entity<span class="token punctuation">,</span> PrimaryGeneratedColumn<span class="token punctuation">,</span> Column <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 标记为数据库实体</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">PrimaryGeneratedColumn</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 自增主键</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> length<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 字符串列，长度限制50</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 唯一约束</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'CURRENT_TIMESTAMP'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 默认值</span>
  createdAt<span class="token operator">:</span> Date<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="44__404">
     </a>
     <strong>
      4.4 修改服务层操作数据库
     </strong>
    </h5>
    <p>
     <strong>
      更新
      <code>
       user.service.ts
      </code>
      ：
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> InjectRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Repository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.entity'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">InjectRepository</span></span><span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token comment">// 注入用户实体仓库</span>
    <span class="token keyword">private</span> userRepository<span class="token operator">:</span> Repository<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>userData<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> newUser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> where<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="45__438">
     </a>
     <strong>
      4.5 修改用户模块
     </strong>
    </h5>
    <p>
     <strong>
      更新
      <code>
       user.module.ts
      </code>
      ：
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.entity'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.controller'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>TypeOrmModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 注册实体到模块</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>UserController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>UserService<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserModule</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="46_DTO_455">
     </a>
     <strong>
      4.6 数据验证（DTO）
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       安装验证库：
      </p>
      <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> class-validator class-transformer
</code></pre>
     </li>
     <li>
      <p>
       创建
       <code>
        src/user/dto/create-user.dto.ts
       </code>
       ：
      </p>
      <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> IsString<span class="token punctuation">,</span> IsEmail<span class="token punctuation">,</span> Length <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'class-validator'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateUserDto</span> <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsString</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Length</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsEmail</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       更新控制器：
      </p>
      <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Body<span class="token punctuation">,</span> ValidationPipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">,</span> <span class="token comment">// 自动验证</span>
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ol>
    <h5>
     <a id="47_API_487">
     </a>
     <strong>
      4.7 完整API测试
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 创建用户</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token string">'{"name":"Lisa","email":"lisa@example.com"}'</span> <span class="token punctuation">\</span>
http://localhost:3000/users

<span class="token comment"># 获取所有用户</span>
<span class="token function">curl</span> http://localhost:3000/users

<span class="token comment"># 获取单个用户</span>
<span class="token function">curl</span> http://localhost:3000/users/1

<span class="token comment"># 删除用户</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> DELETE http://localhost:3000/users/1
</code></pre>
    <h5>
     <a id="48__504">
     </a>
     <strong>
      4.8 错误处理示例
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// 在控制器中处理查找异常</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NotFoundException</span><span class="token punctuation">(</span><span class="token string">'User not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动返回404</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="API_519">
     </a>
     <strong>
      数据库操作关键API
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        方法
       </th>
       <th>
        作用
       </th>
       <th>
        示例
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         repository.find()
        </code>
       </td>
       <td>
        获取所有记录
       </td>
       <td>
        <code>
         userRepository.find()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         repository.findOne()
        </code>
       </td>
       <td>
        获取单条记录
       </td>
       <td>
        <code>
         findOne({ where: { id } })
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         repository.save()
        </code>
       </td>
       <td>
        创建/更新记录
       </td>
       <td>
        <code>
         save(user)
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         repository.delete()
        </code>
       </td>
       <td>
        删除记录
       </td>
       <td>
        <code>
         delete(id)
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     接下来计划讲解：
     <br/>
     <strong>
      第五部分：身份认证（JWT策略）
     </strong>
     <br/>
     包括：
    </p>
    <ul>
     <li>
      用户注册/登录实现
     </li>
     <li>
      Passport.js集成
     </li>
     <li>
      JWT签发与验证
     </li>
     <li>
      路由守卫使用
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="JWT_537">
     </a>
     <strong>
      第五部分：身份认证（JWT策略）
     </strong>
    </h4>
    <h5>
     <a id="51__539">
     </a>
     <strong>
      5.1 认证方案概述
     </strong>
    </h5>
    <div class="mermaid">
     <svg class="mermaid-svg" height="216.5" id="mermaid-svg-oXwqmVfd0hYp6Mhy" viewbox="0 0 553.03125 216.5" width="553.03125" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-oXwqmVfd0hYp6Mhy {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .error-icon{fill:#552222;}#mermaid-svg-oXwqmVfd0hYp6Mhy .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-oXwqmVfd0hYp6Mhy .marker{fill:#333333;stroke:#333333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .marker.cross{stroke:#333333;}#mermaid-svg-oXwqmVfd0hYp6Mhy svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-oXwqmVfd0hYp6Mhy .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .cluster-label text{fill:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .cluster-label span{color:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .label text,#mermaid-svg-oXwqmVfd0hYp6Mhy span{fill:#333;color:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .node rect,#mermaid-svg-oXwqmVfd0hYp6Mhy .node circle,#mermaid-svg-oXwqmVfd0hYp6Mhy .node ellipse,#mermaid-svg-oXwqmVfd0hYp6Mhy .node polygon,#mermaid-svg-oXwqmVfd0hYp6Mhy .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-oXwqmVfd0hYp6Mhy .node .label{text-align:center;}#mermaid-svg-oXwqmVfd0hYp6Mhy .node.clickable{cursor:pointer;}#mermaid-svg-oXwqmVfd0hYp6Mhy .arrowheadPath{fill:#333333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-oXwqmVfd0hYp6Mhy .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-oXwqmVfd0hYp6Mhy .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-oXwqmVfd0hYp6Mhy .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-oXwqmVfd0hYp6Mhy .cluster text{fill:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy .cluster span{color:#333;}#mermaid-svg-oXwqmVfd0hYp6Mhy div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-oXwqmVfd0hYp6Mhy :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M76,79.0658353744526L87.87630208333333,71.05486281204384C99.75260416666667,63.04389024963507,123.50520833333333,47.021945124817535,148.59114583333334,39.01097256240877C173.67708333333334,31,200.09635416666666,31,213.30598958333334,31L226.515625,31" marker-end="url(#arrowhead1524)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1524" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M310.515625,31L323.7252604166667,31C336.9348958333333,31,363.3541666666667,31,388.5611979166667,34.760513669494834C413.7682291666667,38.521027338989676,437.7630208333333,46.042054677979344,449.7604166666667,49.80256834747419L461.7578125,53.56308201696903" marker-end="url(#arrowhead1525)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1525" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-A" id="L-C-A" style="opacity: 1;">
          <path class="path" d="M461.7578125,79.43691798303097L449.7604166666667,83.19743165252581C437.7630208333333,86.95794532202065,413.7682291666667,94.47897266101033,381.5611979166667,98.23948633050516C349.3541666666667,102,308.9348958333333,102,268.515625,102C228.09635416666666,102,187.67708333333334,102,155.59114583333334,102C123.50520833333333,102,99.75260416666667,102,87.87630208333333,102L76,102" marker-end="url(#arrowhead1526)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1526" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-D" id="L-A-D" style="opacity: 1;">
          <path class="path" d="M70.99316991017965,125L83.7039436751497,135.08333333333334C96.41471744011976,145.16666666666666,121.83626497005987,165.33333333333334,146.42334081836327,175.41666666666666C171.01041666666666,185.5,194.76302083333334,185.5,206.63932291666666,185.5L218.515625,185.5" marker-end="url(#arrowhead1527)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1527" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M318.515625,185.5L330.3919270833333,185.5C342.2682291666667,185.5,366.0208333333333,185.5,389.7734375,185.5C413.5260416666667,185.5,437.2786458333333,185.5,449.1549479166667,185.5L461.03125,185.5" marker-end="url(#arrowhead1528)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1528" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="translate(147.2578125,31)">
          <g class="label" transform="translate(-41.546875,-13)">
           <rect height="26" rx="0" ry="0" width="83.09375">
           </rect>
           <foreignobject height="26" width="83.09375">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
              1. 提交凭证
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(389.7734375,31)">
          <g class="label" transform="translate(-41.546875,-13)">
           <rect height="26" rx="0" ry="0" width="83.09375">
           </rect>
           <foreignobject height="26" width="83.09375">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
              2. 验证成功
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(268.515625,102)">
          <g class="label" transform="translate(-46.2578125,-13)">
           <rect height="26" rx="0" ry="0" width="92.515625">
           </rect>
           <foreignobject height="26" width="92.515625">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-A" id="L-L-C-A">
              3. 返回Token
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(147.2578125,185.5)">
          <g class="label" transform="translate(-46.2578125,-13)">
           <rect height="26" rx="0" ry="0" width="92.515625">
           </rect>
           <foreignobject height="26" width="92.515625">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-D" id="L-L-A-D">
              4. 携带Token
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(389.7734375,185.5)">
          <g class="label" transform="translate(-46.2578125,-13)">
           <rect height="26" rx="0" ry="0" width="92.515625">
           </rect>
           <foreignobject height="26" width="92.515625">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
              5. 验证Token
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-1310" style="opacity: 1;" transform="translate(42,102)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              客户端
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-1311" style="opacity: 1;" transform="translate(268.515625,31)">
          <rect class="label-container" height="46" rx="5" ry="5" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              登录接口
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-1313" style="opacity: 1;" transform="translate(503.03125,66.5)">
          <rect class="label-container" height="46" rx="0" ry="0" width="82.546875" x="-41.2734375" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-31.2734375,-13)">
            <foreignobject height="26" width="62.546875">
             <div style="display: inline-block; white-space: nowrap;">
              签发JWT
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-1317" style="opacity: 1;" transform="translate(268.515625,185.5)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              受保护资源
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-1319" style="opacity: 1;" transform="translate(503.03125,185.5)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              返回数据
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h5>
     <a id="52__549">
     </a>
     <strong>
      5.2 安装必要依赖
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/passport passport passport-jwt @nestjs/jwt bcrypt
<span class="token function">npm</span> <span class="token function">install</span> @types/passport-jwt @types/bcrypt --save-dev
</code></pre>
    <h5>
     <a id="53__555">
     </a>
     <strong>
      5.3 用户实体增强
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// user.entity.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> BeforeInsert <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Entity</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...其他字段</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Column</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">BeforeInsert</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 自动加密密码</span>
  <span class="token keyword">async</span> <span class="token function">hashPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token keyword">await</span> bcrypt<span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="54_JWT_574">
     </a>
     <strong>
      5.4 配置JWT模块
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// auth.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> JwtModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/jwt'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    JwtModule<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      global<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      secret<span class="token operator">:</span> <span class="token string">'your-secret-key'</span><span class="token punctuation">,</span> <span class="token comment">// 生产环境应使用环境变量</span>
      signOptions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> expiresIn<span class="token operator">:</span> <span class="token string">'1h'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthModule</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="55__592">
     </a>
     <strong>
      5.5 实现认证服务
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// auth.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> compare <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bcrypt'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthService</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">InjectRepository</span></span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
    <span class="token keyword">private</span> usersRepository<span class="token operator">:</span> Repository<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> jwtService<span class="token operator">:</span> JwtService<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">validateUser</span><span class="token punctuation">(</span>email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> pass<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usersRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> where<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> email <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> <span class="token keyword">await</span> <span class="token function">compare</span><span class="token punctuation">(</span>pass<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> password<span class="token punctuation">,</span> <span class="token operator">...</span>result <span class="token punctuation">}</span> <span class="token operator">=</span> user<span class="token punctuation">;</span> <span class="token comment">// 移除密码字段</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> email<span class="token operator">:</span> user<span class="token punctuation">.</span>email<span class="token punctuation">,</span> sub<span class="token operator">:</span> user<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      access_token<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jwtService<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="56__623">
     </a>
     <strong>
      5.6 创建策略守卫
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// jwt.strategy.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ExtractJwt<span class="token punctuation">,</span> Strategy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'passport-jwt'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JwtStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">PassportStrategy</span><span class="token punctuation">(</span>Strategy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      jwtFromRequest<span class="token operator">:</span> ExtractJwt<span class="token punctuation">.</span><span class="token function">fromAuthHeaderAsBearerToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      ignoreExpiration<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      secretOrKey<span class="token operator">:</span> <span class="token string">'your-secret-key'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">validate</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> userId<span class="token operator">:</span> payload<span class="token punctuation">.</span>sub<span class="token punctuation">,</span> email<span class="token operator">:</span> payload<span class="token punctuation">.</span>email <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="57__644">
     </a>
     <strong>
      5.7 实现认证控制器
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// auth.controller.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> authService<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> loginDto<span class="token operator">:</span> LoginDto<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">validateUser</span><span class="token punctuation">(</span>
      loginDto<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
      loginDto<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnauthorizedException</span><span class="token punctuation">(</span><span class="token string">'Invalid credentials'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Body</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="58__670">
     </a>
     <strong>
      5.8 保护路由
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// user.controller.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'profile'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseGuards</span></span><span class="token punctuation">(</span><span class="token function">AuthGuard</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 添加守卫</span>
<span class="token keyword">async</span> <span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Request</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> req<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> req<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="59__680">
     </a>
     <strong>
      5.9 测试认证流程
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 注册用户</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token string">'{"name":"test","email":"test@example.com","password":"123456"}'</span> <span class="token punctuation">\</span>
http://localhost:3000/auth/register

<span class="token comment"># 登录获取Token</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token string">'{"email":"test@example.com","password":"123456"}'</span> <span class="token punctuation">\</span>
http://localhost:3000/auth/login

<span class="token comment"># 访问受保护资源</span>
<span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"Authorization: Bearer your-token"</span> <span class="token punctuation">\</span>
http://localhost:3000/users/profile
</code></pre>
    <h5>
     <a id="510__697">
     </a>
     <strong>
      5.10 安全增强建议
     </strong>
    </h5>
    <ol>
     <li>
      使用环境变量存储密钥
     </li>
     <li>
      实现密码强度验证
     </li>
     <li>
      添加刷新令牌机制
     </li>
     <li>
      设置合理的令牌有效期
     </li>
     <li>
      记录认证日志
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_706">
     </a>
     <strong>
      认证核心组件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        组件
       </th>
       <th>
        作用
       </th>
       <th>
        关键方法/装饰器
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         JwtModule
        </code>
       </td>
       <td>
        JWT配置模块
       </td>
       <td>
        <code>
         register()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         JwtStrategy
        </code>
       </td>
       <td>
        验证请求携带的JWT
       </td>
       <td>
        <code>
         validate()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         AuthGuard
        </code>
       </td>
       <td>
        路由守卫
       </td>
       <td>
        <code>
         @UseGuards(AuthGuard())
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         bcrypt
        </code>
       </td>
       <td>
        密码哈希处理
       </td>
       <td>
        <code>
         hash()
        </code>
        ,
        <code>
         compare()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         @nestjs/jwt
        </code>
       </td>
       <td>
        JWT签发与验证
       </td>
       <td>
        <code>
         sign()
        </code>
        ,
        <code>
         verify()
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="_717">
     </a>
     <strong>
      第六部分：异常处理与日志
     </strong>
    </h4>
    <h5>
     <a id="61__719">
     </a>
     <strong>
      6.1 异常处理的重要性
     </strong>
    </h5>
    <div class="mermaid">
     <svg class="mermaid-svg" height="472" id="mermaid-svg-BQsuqPeXmtf5E8gT" viewbox="0 0 266 472" width="266" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-BQsuqPeXmtf5E8gT {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT .error-icon{fill:#552222;}#mermaid-svg-BQsuqPeXmtf5E8gT .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-BQsuqPeXmtf5E8gT .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-BQsuqPeXmtf5E8gT .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-BQsuqPeXmtf5E8gT .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-BQsuqPeXmtf5E8gT .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-BQsuqPeXmtf5E8gT .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-BQsuqPeXmtf5E8gT .marker{fill:#333333;stroke:#333333;}#mermaid-svg-BQsuqPeXmtf5E8gT .marker.cross{stroke:#333333;}#mermaid-svg-BQsuqPeXmtf5E8gT svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-BQsuqPeXmtf5E8gT .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT .cluster-label text{fill:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT .cluster-label span{color:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT .label text,#mermaid-svg-BQsuqPeXmtf5E8gT span{fill:#333;color:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT .node rect,#mermaid-svg-BQsuqPeXmtf5E8gT .node circle,#mermaid-svg-BQsuqPeXmtf5E8gT .node ellipse,#mermaid-svg-BQsuqPeXmtf5E8gT .node polygon,#mermaid-svg-BQsuqPeXmtf5E8gT .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-BQsuqPeXmtf5E8gT .node .label{text-align:center;}#mermaid-svg-BQsuqPeXmtf5E8gT .node.clickable{cursor:pointer;}#mermaid-svg-BQsuqPeXmtf5E8gT .arrowheadPath{fill:#333333;}#mermaid-svg-BQsuqPeXmtf5E8gT .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-BQsuqPeXmtf5E8gT .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-BQsuqPeXmtf5E8gT .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-BQsuqPeXmtf5E8gT .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-BQsuqPeXmtf5E8gT .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-BQsuqPeXmtf5E8gT .cluster text{fill:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT .cluster span{color:#333;}#mermaid-svg-BQsuqPeXmtf5E8gT div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-BQsuqPeXmtf5E8gT :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M121,54L121,58.166666666666664C121,62.333333333333336,121,70.66666666666667,121,79C121,87.33333333333333,121,95.66666666666667,121,99.83333333333333L121,104" marker-end="url(#arrowhead1553)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1553" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M94.22950819672131,150L86.85792349726778,156.33333333333334C79.48633879781421,162.66666666666666,64.74316939890711,175.33333333333334,57.37158469945356,188C50,200.66666666666666,50,213.33333333333334,50,219.66666666666666L50,226" marker-end="url(#arrowhead1554)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1554" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-D" id="L-B-D" style="opacity: 1;">
          <path class="path" d="M147.77049180327867,150L155.14207650273224,156.33333333333334C162.51366120218577,162.66666666666666,177.2568306010929,175.33333333333334,184.62841530054644,188C192,200.66666666666666,192,213.33333333333334,192,219.66666666666666L192,226" marker-end="url(#arrowhead1555)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1555" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M192,272L192,276.1666666666667C192,280.3333333333333,192,288.6666666666667,192,297C192,305.3333333333333,192,313.6666666666667,192,317.8333333333333L192,322" marker-end="url(#arrowhead1556)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1556" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-E LE-F" id="L-E-F" style="opacity: 1;">
          <path class="path" d="M192,368L192,372.1666666666667C192,376.3333333333333,192,384.6666666666667,192,393C192,401.3333333333333,192,409.6666666666667,192,413.8333333333333L192,418" marker-end="url(#arrowhead1557)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1557" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(50,188)">
          <g class="label" transform="translate(-16,-13)">
           <rect height="26" rx="0" ry="0" width="32">
           </rect>
           <foreignobject height="26" width="32">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
              成功
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(192,188)">
          <g class="label" transform="translate(-16,-13)">
           <rect height="26" rx="0" ry="0" width="32">
           </rect>
           <foreignobject height="26" width="32">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-D" id="L-L-B-D">
              失败
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-E' L-LE-F" id="L-L-E-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-1330" style="opacity: 1;" transform="translate(121,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              客户端请求
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-1331" style="opacity: 1;" transform="translate(121,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              应用处理
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-1333" style="opacity: 1;" transform="translate(50,249)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              返回数据
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-1335" style="opacity: 1;" transform="translate(192,249)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              异常过滤器
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-1337" style="opacity: 1;" transform="translate(192,345)">
          <rect class="label-container" height="46" rx="0" ry="0" width="132" x="-66" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-56,-13)">
            <foreignobject height="26" width="112">
             <div style="display: inline-block; white-space: nowrap;">
              格式化错误响应
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-1339" style="opacity: 1;" transform="translate(192,441)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              客户端接收
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h5>
     <a id="62__729">
     </a>
     <strong>
      6.2 创建自定义异常过滤器
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：生成过滤器
     </strong>
    </p>
    <pre><code class="prism language-bash">nest generate filter common/exceptions/http-exception
</code></pre>
    <p>
     <strong>
      步骤2：实现过滤器逻辑
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// http-exception.filter.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>
  ExceptionFilter<span class="token punctuation">,</span>
  Catch<span class="token punctuation">,</span>
  ArgumentsHost<span class="token punctuation">,</span>
  HttpException<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Catch</span></span><span class="token punctuation">(</span>HttpException<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HttpExceptionFilter</span> <span class="token keyword">implements</span> <span class="token class-name">ExceptionFilter</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> HttpException<span class="token punctuation">,</span> host<span class="token operator">:</span> ArgumentsHost<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getResponse</span><span class="token generic class-name"><span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getRequest</span><span class="token generic class-name"><span class="token operator">&lt;</span>Request<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      statusCode<span class="token operator">:</span> status<span class="token punctuation">,</span>
      timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
      message<span class="token operator">:</span> exception<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token string">'Unknown error'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="63__764">
     </a>
     <strong>
      6.3 全局注册过滤器
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// main.ts</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalFilters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册全局过滤器</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="64_HTTP_774">
     </a>
     <strong>
      6.4 使用内置HTTP异常
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// user.controller.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NotFoundException</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">User </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not found</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="65__787">
     </a>
     <strong>
      6.5 日志记录配置
     </strong>
    </h5>
    <p>
     <strong>
      启用默认日志
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// main.ts</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  logger<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'warn'</span><span class="token punctuation">,</span> <span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token string">'verbose'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      自定义日志服务
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// logger.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> LoggerService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MyLogger</span> <span class="token keyword">implements</span> <span class="token class-name">LoggerService</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[LOG] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> trace<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[ERROR] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> trace<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">warn</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[WARN] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.ts</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  logger<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">MyLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="66_Winston_821">
     </a>
     <strong>
      6.6 集成Winston日志
     </strong>
    </h5>
    <ol>
     <li>
      安装依赖：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> winston @types/winston
</code></pre>
    <ol start="2">
     <li>
      创建日志配置文件：
     </li>
    </ol>
    <pre><code class="prism language-typescript"><span class="token comment">// logger/logger.config.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createLogger<span class="token punctuation">,</span> format<span class="token punctuation">,</span> transports <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'winston'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> winstonConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  level<span class="token operator">:</span> <span class="token string">'info'</span><span class="token punctuation">,</span>
  format<span class="token operator">:</span> format<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>
    format<span class="token punctuation">.</span><span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    format<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> timestamp<span class="token punctuation">,</span> level<span class="token punctuation">,</span> message <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  transports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">transports</span><span class="token punctuation">.</span><span class="token function">Console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">transports</span><span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> filename<span class="token operator">:</span> <span class="token string">'logs/error.log'</span><span class="token punctuation">,</span> level<span class="token operator">:</span> <span class="token string">'error'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">transports</span><span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> filename<span class="token operator">:</span> <span class="token string">'logs/combined.log'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="3">
     <li>
      创建NestJS适配器：
     </li>
    </ol>
    <pre><code class="prism language-typescript"><span class="token comment">// logger/winston.logger.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> LoggerService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createLogger<span class="token punctuation">,</span> Logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'winston'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> winstonConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./logger.config'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WinstonLogger</span> <span class="token keyword">implements</span> <span class="token class-name">LoggerService</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">private</span> logger<span class="token operator">:</span> Logger<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token function">createLogger</span><span class="token punctuation">(</span>winstonConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> trace<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>trace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">warn</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">debug</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">verbose</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">verbose</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="67__884">
     </a>
     <strong>
      6.7 请求日志中间件
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// logger/request.logger.middleware.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Injectable<span class="token punctuation">,</span> NestMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RequestLoggerMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">NestMiddleware</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">use</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> method<span class="token punctuation">,</span> originalUrl <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> statusCode <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>originalUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>statusCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// app.module.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">consumer</span>
      <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>RequestLoggerMiddleware<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="68_Sentry_918">
     </a>
     <strong>
      6.8 错误追踪集成（Sentry示例）
     </strong>
    </h5>
    <ol>
     <li>
      安装依赖：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @sentry/node @sentry/tracing
</code></pre>
    <ol start="2">
     <li>
      配置Sentry：
     </li>
    </ol>
    <pre><code class="prism language-typescript"><span class="token comment">// sentry.config.ts</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Sentry <span class="token keyword">from</span> <span class="token string">'@sentry/node'</span><span class="token punctuation">;</span>

Sentry<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  dsn<span class="token operator">:</span> <span class="token string">'your-dsn-here'</span><span class="token punctuation">,</span>
  tracesSampleRate<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="3">
     <li>
      集成到异常过滤器：
     </li>
    </ol>
    <pre><code class="prism language-typescript"><span class="token comment">// http-exception.filter.ts</span>
<span class="token keyword">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> HttpException<span class="token punctuation">,</span> host<span class="token operator">:</span> ArgumentsHost<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getRequest</span><span class="token generic class-name"><span class="token operator">&lt;</span>Request<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  Sentry<span class="token punctuation">.</span><span class="token function">captureException</span><span class="token punctuation">(</span>exception<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    extra<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      path<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
      method<span class="token operator">:</span> request<span class="token punctuation">.</span>method<span class="token punctuation">,</span>
      body<span class="token operator">:</span> request<span class="token punctuation">.</span>body<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...原有处理逻辑</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="69__954">
     </a>
     <strong>
      6.9 测试验证
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 触发404错误</span>
<span class="token function">curl</span> http://localhost:3000/nonexistent

<span class="token comment"># 查看日志文件</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> logs/error.log

<span class="token comment"># 预期输出示例</span>
<span class="token number">2023</span>-08-20T10:00:00.000Z <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token number">404</span> - Cannot GET /nonexistent
</code></pre>
    <h5>
     <a id="610__966">
     </a>
     <strong>
      6.10 最佳实践建议
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       使用不同日志级别：
      </p>
      <ul>
       <li>
        <code>
         verbose
        </code>
        : 详细调试信息
       </li>
       <li>
        <code>
         debug
        </code>
        : 调试信息
       </li>
       <li>
        <code>
         log
        </code>
        : 常规日志
       </li>
       <li>
        <code>
         warn
        </code>
        : 警告信息
       </li>
       <li>
        <code>
         error
        </code>
        : 错误信息
       </li>
      </ul>
     </li>
     <li>
      <p>
       日志文件管理：
      </p>
      <ul>
       <li>
        使用logrotate进行日志轮换
       </li>
       <li>
        敏感信息过滤
       </li>
       <li>
        按日期分割日志文件
       </li>
      </ul>
     </li>
     <li>
      <p>
       生产环境注意事项：
      </p>
      <ul>
       <li>
        禁用
        <code>
         synchronize
        </code>
        选项
       </li>
       <li>
        设置适当的日志级别
       </li>
       <li>
        使用集中式日志系统（ELK/Splunk）
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_986">
     </a>
     <strong>
      异常处理核心机制
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        组件
       </th>
       <th>
        作用
       </th>
       <th>
        关键方法/装饰器
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         ExceptionFilter
        </code>
       </td>
       <td>
        捕获并处理异常
       </td>
       <td>
        <code>
         @Catch()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         HttpException
        </code>
       </td>
       <td>
        预定义的HTTP异常
       </td>
       <td>
        <code>
         new BadRequestException()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         LoggerService
        </code>
       </td>
       <td>
        日志接口
       </td>
       <td>
        <code>
         log()
        </code>
        ,
        <code>
         error()
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         Middleware
        </code>
       </td>
       <td>
        记录请求信息
       </td>
       <td>
        <code>
         implements NestMiddleware
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="E2E_996">
     </a>
     <strong>
      第七部分：单元测试与E2E测试
     </strong>
    </h4>
    <h5>
     <a id="71__998">
     </a>
     <strong>
      7.1 测试金字塔模型
     </strong>
    </h5>
    <div class="mermaid">
     <svg class="mermaid-svg" height="450" id="mermaid-svg-GHatQrOmM6iHPPTF" style="max-width: 500px;" viewbox="0 0 500 450" width="100%" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-GHatQrOmM6iHPPTF {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-GHatQrOmM6iHPPTF .error-icon{fill:#552222;}#mermaid-svg-GHatQrOmM6iHPPTF .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-GHatQrOmM6iHPPTF .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-GHatQrOmM6iHPPTF .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-GHatQrOmM6iHPPTF .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-GHatQrOmM6iHPPTF .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-GHatQrOmM6iHPPTF .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-GHatQrOmM6iHPPTF .marker{fill:#333333;stroke:#333333;}#mermaid-svg-GHatQrOmM6iHPPTF .marker.cross{stroke:#333333;}#mermaid-svg-GHatQrOmM6iHPPTF svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-GHatQrOmM6iHPPTF .pieCircle{stroke:black;stroke-width:2px;opacity:0.7;}#mermaid-svg-GHatQrOmM6iHPPTF .pieTitleText{text-anchor:middle;font-size:25px;fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-GHatQrOmM6iHPPTF .slice{font-family:"trebuchet ms",verdana,arial,sans-serif;fill:#333;font-size:17px;}#mermaid-svg-GHatQrOmM6iHPPTF .legend text{fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:17px;}#mermaid-svg-GHatQrOmM6iHPPTF :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
      </g>
      <g transform="translate(250,225)">
       <path class="pieCircle" d="M1.1327982892113017e-14,-185A185,185,0,1,1,-175.9454555146034,57.16814395936529L0,0Z" fill="#ECECFF">
       </path>
       <path class="pieCircle" d="M-175.9454555146034,57.16814395936529A185,185,0,0,1,-108.74027167410755,-149.66814395936527L0,0Z" fill="#ffffde">
       </path>
       <path class="pieCircle" d="M-108.74027167410755,-149.66814395936527A185,185,0,0,1,-3.398394867633905e-14,-185L0,0Z" fill="hsl(80, 100%, 56.2745098039%)">
       </path>
       <text class="slice" style="text-anchor: middle;" transform="translate(74.83407197968263,54.370135837053766)">
        70%
       </text>
       <text class="slice" style="text-anchor: middle;" transform="translate(-87.97272775730171,-28.584071979682623)">
        20%
       </text>
       <text class="slice" style="text-anchor: middle;" transform="translate(-28.58407197968265,-87.9727277573017)">
        10%
       </text>
       <text class="pieTitleText" x="0" y="-200">
        测试类型分布
       </text>
       <g class="legend" transform="translate(216,-33)">
        <rect height="18" style="fill: rgb(236, 236, 255); stroke: rgb(236, 236, 255);" width="18">
        </rect>
        <text x="22" y="14">
         单元测试
        </text>
       </g>
       <g class="legend" transform="translate(216,-11)">
        <rect height="18" style="fill: rgb(255, 255, 222); stroke: rgb(255, 255, 222);" width="18">
        </rect>
        <text x="22" y="14">
         集成测试
        </text>
       </g>
       <g class="legend" transform="translate(216,11)">
        <rect height="18" style="fill: rgb(181, 255, 32); stroke: rgb(181, 255, 32);" width="18">
        </rect>
        <text x="22" y="14">
         E2E测试
        </text>
       </g>
      </g>
     </svg>
    </div>
    <h5>
     <a id="72__1007">
     </a>
     <strong>
      7.2 初始化测试环境
     </strong>
    </h5>
    <p>
     <strong>
      项目已内置测试配置
     </strong>
     ：
    </p>
    <ul>
     <li>
      <code>
       test/
      </code>
      目录：存放测试相关配置
     </li>
     <li>
      <code>
       jest.config.js
      </code>
      ：Jest测试框架配置
     </li>
     <li>
      <code>
       package.json
      </code>
      脚本：
      <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"jest"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"test:watch"</span><span class="token operator">:</span> <span class="token string">"jest --watch"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"test:cov"</span><span class="token operator">:</span> <span class="token string">"jest --coverage"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ul>
    <h5>
     <a id="73__1022">
     </a>
     <strong>
      7.3 服务层单元测试
     </strong>
    </h5>
    <p>
     <strong>
      测试目标：
      <code>
       UserService
      </code>
     </strong>
     <br/>
     <strong>
      创建测试文件：
      <code>
       user.service.spec.ts
      </code>
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Test<span class="token punctuation">,</span> TestingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/testing'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getRepositoryToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.entity'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

<span class="token comment">// 模拟Repository</span>
<span class="token keyword">const</span> mockRepository <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  find<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  findOne<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  save<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">delete</span><span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'UserService'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> service<span class="token operator">:</span> UserService<span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> module<span class="token operator">:</span> TestingModule <span class="token operator">=</span> <span class="token keyword">await</span> Test<span class="token punctuation">.</span><span class="token function">createTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        UserService<span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span>
          provide<span class="token operator">:</span> <span class="token function">getRepositoryToken</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">,</span>
          useValue<span class="token operator">:</span> mockRepository<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    service <span class="token operator">=</span> module<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserService<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>UserService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    jest<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'findAll'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'应返回用户数组'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> mockUsers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Test'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      mockRepository<span class="token punctuation">.</span>find<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span>mockUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>mockUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">.</span>find<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'应成功创建用户'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> newUser <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> name<span class="token operator">:</span> <span class="token string">'New'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      mockRepository<span class="token punctuation">.</span>save<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>newUser <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>mockRepository<span class="token punctuation">.</span>save<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="74__1084">
     </a>
     <strong>
      7.4 控制器层测试
     </strong>
    </h5>
    <p>
     <strong>
      测试目标：
      <code>
       UserController
      </code>
     </strong>
     <br/>
     <strong>
      创建测试文件：
      <code>
       user.controller.spec.ts
      </code>
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Test<span class="token punctuation">,</span> TestingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/testing'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'UserController'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> controller<span class="token operator">:</span> UserController<span class="token punctuation">;</span>
  <span class="token keyword">const</span> mockUserService <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    findAll<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    create<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">...</span>dto <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> module<span class="token operator">:</span> TestingModule <span class="token operator">=</span> <span class="token keyword">await</span> Test<span class="token punctuation">.</span><span class="token function">createTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      controllers<span class="token operator">:</span> <span class="token punctuation">[</span>UserController<span class="token punctuation">]</span><span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          provide<span class="token operator">:</span> UserService<span class="token punctuation">,</span>
          useValue<span class="token operator">:</span> mockUserService<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    controller <span class="token operator">=</span> module<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserController<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>UserController<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'GET /users 应返回用户列表'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>controller<span class="token punctuation">.</span><span class="token function">getAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockUserService<span class="token punctuation">.</span>findAll<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'POST /users 应创建新用户'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> dto <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> name<span class="token operator">:</span> <span class="token string">'Test'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>controller<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>dto<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockUserService<span class="token punctuation">.</span>create<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>dto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="75_E2E_1129">
     </a>
     <strong>
      7.5 端到端测试（E2E）
     </strong>
    </h5>
    <p>
     <strong>
      创建测试文件：
      <code>
       app.e2e-spec.ts
      </code>
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Test<span class="token punctuation">,</span> TestingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/testing'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> INestApplication <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> request <span class="token keyword">from</span> <span class="token string">'supertest'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> AppModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../src/app.module'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'AppController (e2e)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> app<span class="token operator">:</span> INestApplication<span class="token punctuation">;</span>

  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> moduleFixture<span class="token operator">:</span> TestingModule <span class="token operator">=</span> <span class="token keyword">await</span> Test<span class="token punctuation">.</span><span class="token function">createTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>AppModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app <span class="token operator">=</span> moduleFixture<span class="token punctuation">.</span><span class="token function">createNestApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'/ (GET)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'用户模块'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'GET /users 应返回空数组'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'POST /users 应创建用户'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getHttpServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/users'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> name<span class="token operator">:</span> <span class="token string">'E2E Test'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveProperty</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'E2E Test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="76__1181">
     </a>
     <strong>
      7.6 运行与解读测试
     </strong>
    </h5>
    <p>
     <strong>
      执行测试命令
     </strong>
     ：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 运行全部测试</span>
<span class="token function">npm</span> run <span class="token builtin class-name">test</span>

<span class="token comment"># 开发时监听模式</span>
<span class="token function">npm</span> run test:watch

<span class="token comment"># 生成覆盖率报告</span>
<span class="token function">npm</span> run test:cov
</code></pre>
    <p>
     <strong>
      覆盖率报告示例
     </strong>
     ：
    </p>
    <pre><code>----------------|---------|----------|---------|---------|-------------------
File            | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------------|---------|----------|---------|---------|-------------------
All files       |     92  |     85   |    90   |    92   |                   
 user.service   |    100  |    100   |   100   |    100  |                   
 user.controller|     95  |     80   |    90   |     95  | 32                
----------------|---------|----------|---------|---------|-------------------
</code></pre>
    <h5>
     <a id="77__1205">
     </a>
     <strong>
      7.7 测试最佳实践
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        测试命名规范
       </strong>
       ：
      </p>
      <pre><code class="prism language-typescript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'场景描述'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'应完成特定行为'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 测试逻辑</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        测试三部曲
       </strong>
       ：
      </p>
      <ul>
       <li>
        <strong>
         准备（Arrange）
        </strong>
        ：设置测试数据和模拟
       </li>
       <li>
        <strong>
         执行（Act）
        </strong>
        ：调用被测试方法
       </li>
       <li>
        <strong>
         断言（Assert）
        </strong>
        ：验证结果
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        测试隔离原则
       </strong>
       ：
      </p>
      <ul>
       <li>
        每个测试用例独立运行
       </li>
       <li>
        使用
        <code>
         beforeEach/afterEach
        </code>
        重置状态
       </li>
       <li>
        避免测试间的依赖关系
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        测试数据库策略
       </strong>
       ：
      </p>
      <pre><code class="prism language-typescript"><span class="token comment">// 使用测试专用数据库</span>
TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  database<span class="token operator">:</span> <span class="token string">'test_db'</span><span class="token punctuation">,</span>
  synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_1236">
     </a>
     <strong>
      测试类型对比
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        测试类型
       </th>
       <th>
        测试范围
       </th>
       <th>
        执行速度
       </th>
       <th>
        维护成本
       </th>
       <th>
        适合场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        单元测试
       </td>
       <td>
        单个类/方法
       </td>
       <td>
        快
       </td>
       <td>
        低
       </td>
       <td>
        核心业务逻辑验证
       </td>
      </tr>
      <tr>
       <td>
        集成测试
       </td>
       <td>
        模块间交互
       </td>
       <td>
        中
       </td>
       <td>
        中
       </td>
       <td>
        服务层与数据库交互
       </td>
      </tr>
      <tr>
       <td>
        E2E测试
       </td>
       <td>
        完整系统流程
       </td>
       <td>
        慢
       </td>
       <td>
        高
       </td>
       <td>
        用户操作流程验证
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="_1245">
     </a>
     <strong>
      第八部分：部署与生产环境优化
     </strong>
    </h4>
    <h5>
     <a id="81_Docker_1247">
     </a>
     <strong>
      8.1 Docker容器化部署
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：创建Dockerfile
     </strong>
    </p>
    <pre><code class="prism language-dockerfile"># 使用Node.js官方镜像
FROM node:18-alpine

# 设置工作目录
WORKDIR /app

# 复制依赖文件
COPY package*.json ./

# 安装依赖（生产环境不装devDependencies）
RUN npm install --only=production

# 复制项目文件
COPY . .

# 构建项目（如果需要编译TypeScript）
RUN npm run build

# 暴露端口
EXPOSE 3000

# 启动命令
CMD ["npm", "run", "start:prod"]
</code></pre>
    <p>
     <strong>
      步骤2：创建docker-compose.yml
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"3000:3000"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> NODE_ENV=production
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres<span class="token punctuation">:</span><span class="token number">15</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">POSTGRES_USER</span><span class="token punctuation">:</span> postgres
      <span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation">:</span> yoursecurepassword
      <span class="token key atrule">POSTGRES_DB</span><span class="token punctuation">:</span> nestprod
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> pgdata<span class="token punctuation">:</span>/var/lib/postgresql/data
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5432:5432"</span>

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">pgdata</span><span class="token punctuation">:</span>
</code></pre>
    <p>
     <strong>
      步骤3：构建并启动容器
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> <span class="token parameter variable">--build</span>
</code></pre>
    <h5>
     <a id="82__1309">
     </a>
     <strong>
      8.2 环境变量配置
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：安装配置模块
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/config
</code></pre>
    <p>
     <strong>
      步骤2：创建.env文件
     </strong>
    </p>
    <pre><code class="prism language-env"># .env.production
DATABASE_HOST=db
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=yoursecurepassword
DATABASE_NAME=nestprod
JWT_SECRET=prod_secret_key
</code></pre>
    <p>
     <strong>
      步骤3：更新app.module.ts
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ConfigModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/config'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    ConfigModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      envFilePath<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.env.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      isGlobal<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRootAsync</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> ConfigService<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        type<span class="token operator">:</span> <span class="token string">'postgres'</span><span class="token punctuation">,</span>
        host<span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'DATABASE_HOST'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'DATABASE_PORT'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        username<span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'DATABASE_USER'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'DATABASE_PASSWORD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        database<span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'DATABASE_NAME'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        entities<span class="token operator">:</span> <span class="token punctuation">[</span>__dirname <span class="token operator">+</span> <span class="token string">'/**/*.entity{.ts,.js}'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        synchronize<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 生产环境必须关闭！</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token punctuation">[</span>ConfigService<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="83__1354">
     </a>
     <strong>
      8.3 性能优化策略
     </strong>
    </h5>
    <p>
     <strong>
      1. 启用压缩
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> compression <span class="token keyword">from</span> <span class="token string">'compression'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">compression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加GZIP压缩</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      2. 集群模式（利用多核CPU）
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> clusterize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/clusterize'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">await</span> <span class="token function">clusterize</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    workers<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'max'</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token function-variable function">bootstrap</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      3. 缓存策略
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// 安装缓存模块</span>
npm install cache<span class="token operator">-</span>manager <span class="token decorator"><span class="token at operator">@</span><span class="token function">nestjs</span></span><span class="token operator">/</span>cache<span class="token operator">-</span>manager

<span class="token comment">// app.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> CacheModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/cache-manager'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CacheModule<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      ttl<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 缓存时间（秒）</span>
      max<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 最大缓存数</span>
      isGlobal<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="84__1401">
     </a>
     <strong>
      8.4 健康检查与监控
     </strong>
    </h5>
    <p>
     <strong>
      1. 添加终止信号处理
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// main.ts</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 优雅关闭</span>
  process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    app<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Application closed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      2. 集成健康检查
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/terminus
</code></pre>
    <pre><code class="prism language-typescript"><span class="token comment">// health.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> HealthCheckService<span class="token punctuation">,</span> HealthCheck <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/terminus'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">'health'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HealthController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> health<span class="token operator">:</span> HealthCheckService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">HealthCheck</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>health<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      3. Prometheus监控（可选）
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/metrics prom-client
</code></pre>
    <pre><code class="prism language-typescript"><span class="token comment">// metrics.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> PrometheusModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/metrics'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>PrometheusModule<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MetricsModule</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="85__1456">
     </a>
     <strong>
      8.5 日志收集方案
     </strong>
    </h5>
    <p>
     <strong>
      1. 生产环境日志配置
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// winston.config.prod.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> winstonConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  transports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">transports</span><span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> 
      filename<span class="token operator">:</span> <span class="token string">'logs/error.log'</span><span class="token punctuation">,</span> 
      level<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
      maxsize<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 10MB</span>
      maxFiles<span class="token operator">:</span> <span class="token number">7</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">transports</span><span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      filename<span class="token operator">:</span> <span class="token string">'logs/combined.log'</span><span class="token punctuation">,</span>
      maxsize<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token comment">// 50MB</span>
      maxFiles<span class="token operator">:</span> <span class="token number">14</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      2. 日志查询命令
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 查看实时日志</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> logs/combined.log

<span class="token comment"># 根据时间过滤日志</span>
<span class="token function">grep</span> <span class="token string">'2023-08-20T10'</span> logs/error.log
</code></pre>
    <h5>
     <a id="86__1486">
     </a>
     <strong>
      8.6 部署验证
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 检查容器状态</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>

<span class="token comment"># 查看应用日志</span>
<span class="token function">docker</span> logs <span class="token operator">&lt;</span>container_id<span class="token operator">&gt;</span>

<span class="token comment"># 测试健康检查端点</span>
<span class="token function">curl</span> http://localhost:3000/health

<span class="token comment"># 压力测试（安装wrk）</span>
wrk <span class="token parameter variable">-t12</span> <span class="token parameter variable">-c400</span> <span class="token parameter variable">-d30s</span> http://localhost:3000/users
</code></pre>
    <h5>
     <a id="87__1501">
     </a>
     <strong>
      8.7 生产环境检查清单
     </strong>
    </h5>
    <ol>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      禁用
      <code>
       synchronize: true
      </code>
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      使用HTTPS加密通信
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      配置防火墙规则
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      设置自动备份策略
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      实施速率限制
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      定期安全扫描
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      监控CPU/内存使用
     </li>
     <li class="task-list-item">
      <input class="task-list-item-checkbox" disabled="disabled" type="checkbox"/>
      设置报警阈值
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_1513">
     </a>
     <strong>
      部署架构示意图
     </strong>
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="484.4034729003906" id="mermaid-svg-aJgjblI880zN9xvZ" viewbox="0 0 313.171875 484.4034729003906" width="313.171875" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-aJgjblI880zN9xvZ {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-aJgjblI880zN9xvZ .error-icon{fill:#552222;}#mermaid-svg-aJgjblI880zN9xvZ .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-aJgjblI880zN9xvZ .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-aJgjblI880zN9xvZ .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-aJgjblI880zN9xvZ .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-aJgjblI880zN9xvZ .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-aJgjblI880zN9xvZ .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-aJgjblI880zN9xvZ .marker{fill:#333333;stroke:#333333;}#mermaid-svg-aJgjblI880zN9xvZ .marker.cross{stroke:#333333;}#mermaid-svg-aJgjblI880zN9xvZ svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-aJgjblI880zN9xvZ .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-aJgjblI880zN9xvZ .cluster-label text{fill:#333;}#mermaid-svg-aJgjblI880zN9xvZ .cluster-label span{color:#333;}#mermaid-svg-aJgjblI880zN9xvZ .label text,#mermaid-svg-aJgjblI880zN9xvZ span{fill:#333;color:#333;}#mermaid-svg-aJgjblI880zN9xvZ .node rect,#mermaid-svg-aJgjblI880zN9xvZ .node circle,#mermaid-svg-aJgjblI880zN9xvZ .node ellipse,#mermaid-svg-aJgjblI880zN9xvZ .node polygon,#mermaid-svg-aJgjblI880zN9xvZ .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-aJgjblI880zN9xvZ .node .label{text-align:center;}#mermaid-svg-aJgjblI880zN9xvZ .node.clickable{cursor:pointer;}#mermaid-svg-aJgjblI880zN9xvZ .arrowheadPath{fill:#333333;}#mermaid-svg-aJgjblI880zN9xvZ .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-aJgjblI880zN9xvZ .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-aJgjblI880zN9xvZ .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-aJgjblI880zN9xvZ .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-aJgjblI880zN9xvZ .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-aJgjblI880zN9xvZ .cluster text{fill:#333;}#mermaid-svg-aJgjblI880zN9xvZ .cluster span{color:#333;}#mermaid-svg-aJgjblI880zN9xvZ div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-aJgjblI880zN9xvZ :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M160.37890625,54L160.37890625,58.166666666666664C160.37890625,62.333333333333336,160.37890625,70.66666666666667,160.37890625,79C160.37890625,87.33333333333333,160.37890625,95.66666666666667,160.37890625,99.83333333333333L160.37890625,104" marker-end="url(#arrowhead1584)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1584" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M123.582275390625,150L116.91621907552083,154.16666666666666C110.25016276041667,158.33333333333334,96.91805013020833,166.66666666666666,90.25199381510417,175C83.5859375,183.33333333333334,83.5859375,191.66666666666666,83.5859375,195.83333333333334L83.5859375,200" marker-end="url(#arrowhead1585)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1585" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-D" id="L-B-D" style="opacity: 1;">
          <path class="path" d="M197.175537109375,150L203.84159342447916,154.16666666666666C210.50764973958334,158.33333333333334,223.83976236979166,166.66666666666666,230.50581868489584,175C237.171875,183.33333333333334,237.171875,191.66666666666666,237.171875,195.83333333333334L237.171875,200" marker-end="url(#arrowhead1586)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1586" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-E" id="L-C-E" style="opacity: 1;">
          <path class="path" d="M74.00260416666667,246L72.26649305555556,250.16666666666666C70.53038194444444,254.33333333333334,67.05815972222223,262.6666666666667,65.94207223702358,271.0098026864728C64.82598475182493,279.35293870627896,66.06603200364988,287.7058774125579,66.68605562956235,291.8823467656974L67.30607925547481,296.0588161188369" marker-end="url(#arrowhead1587)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1587" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M195.58357747395834,246L188.04946560329861,250.16666666666666C180.5153537326389,254.33333333333334,165.44712999131946,262.6666666666667,153.15167262776393,271.6875307908977C140.85621526420843,280.7083949151288,131.33352427841683,290.41678983025764,126.57217878552103,295.27098728782204L121.81083329262523,300.12518474538643" marker-end="url(#arrowhead1588)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1588" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-E LE-F" id="L-E-F" style="opacity: 1;">
          <path class="path" d="M73.5859375,380.40348052978516L73.5859375,384.57014719645184C73.5859375,388.73681386311847,73.5859375,397.07014719645184,73.5859375,405.40348052978516C73.5859375,413.73681386311847,73.5859375,422.07014719645184,73.5859375,426.23681386311847L73.5859375,430.40348052978516" marker-end="url(#arrowhead1589)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1589" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-G" id="L-C-G" style="opacity: 1;">
          <path class="path" d="M125.17423502604166,246L132.70834689670139,250.16666666666666C140.24245876736111,254.33333333333334,155.31068250868054,262.6666666666667,171.26318465087616,274.20029004414874C187.21568679307174,285.73391342163086,204.05246733614345,300.4678268432617,212.47085760767933,307.83478355407715L220.88924787921522,315.2017402648926" marker-end="url(#arrowhead1590)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1590" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-G" id="L-D-G" style="opacity: 1;">
          <path class="path" d="M246.75520833333334,246L248.49131944444446,250.16666666666666C250.22743055555557,254.33333333333334,253.6996527777778,262.6666666666667,254.3395189580617,274.20029004414874C254.9793851383456,285.73391342163086,252.7868952766912,300.4678268432617,251.69065034586401,307.83478355407715L250.59440541503682,315.2017402648926" marker-end="url(#arrowhead1591)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1591" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-G LE-H" id="L-G-H" style="opacity: 1;">
          <path class="path" d="M247.171875,361.2017402648926L247.171875,368.568696975708C247.171875,375.93565368652344,247.171875,390.6695671081543,247.171875,402.2031904856364C247.171875,413.73681386311847,247.171875,422.07014719645184,247.171875,426.23681386311847L247.171875,430.40348052978516" marker-end="url(#arrowhead1592)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1592" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-D" id="L-L-B-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-E" id="L-L-C-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-E' L-LE-F" id="L-L-E-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-G" id="L-L-C-G">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-G" id="L-L-D-G">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-G' L-LE-H" id="L-L-G-H">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-1358" style="opacity: 1;" transform="translate(160.37890625,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              客户端
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-1359" style="opacity: 1;" transform="translate(160.37890625,127)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              负载均衡器
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-1361" style="opacity: 1;" transform="translate(83.5859375,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="92.390625" x="-46.1953125" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-36.1953125,-13)">
            <foreignobject height="26" width="72.390625">
             <div style="display: inline-block; white-space: nowrap;">
              容器实例1
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-1363" style="opacity: 1;" transform="translate(237.171875,223)">
          <rect class="label-container" height="46" rx="0" ry="0" width="92.390625" x="-46.1953125" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-36.1953125,-13)">
            <foreignobject height="26" width="72.390625">
             <div style="display: inline-block; white-space: nowrap;">
              容器实例2
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-1365" style="opacity: 1;" transform="translate(73.5859375,338.2017402648926)">
          <path class="label-container" d="M 0,12.80115888990546 a 65.5859375,12.80115888990546 0,0,0 131.171875 0 a 65.5859375,12.80115888990546 0,0,0 -131.171875 0 l 0,58.80115888990546 a 65.5859375,12.80115888990546 0,0,0 131.171875 0 l 0,-58.80115888990546" transform="translate(-65.5859375,-42.20173833485819)">
          </path>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-55.5859375,-13)">
            <foreignobject height="26" width="111.171875">
             <div style="display: inline-block; white-space: nowrap;">
              PostgreSQL集群
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-1369" style="opacity: 1;" transform="translate(73.5859375,453.40348052978516)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              备份存储
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-G-1371" style="opacity: 1;" transform="translate(247.171875,338.2017402648926)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              日志收集系统
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-H-1375" style="opacity: 1;" transform="translate(247.171875,453.40348052978516)">
          <rect class="label-container" height="46" rx="0" ry="0" width="100" x="-50" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              监控仪表盘
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <hr/>
    <h4>
     <a id="_1528">
     </a>
     <strong>
      第九部分：微服务架构进阶
     </strong>
    </h4>
    <h5>
     <a id="91__1530">
     </a>
     <strong>
      9.1 微服务核心概念
     </strong>
    </h5>
    <div class="mermaid">
     <svg class="mermaid-svg" height="354.0000305175781" id="mermaid-svg-jvXy0v6hmyJCnJwd" viewbox="0 0 492.8125 354.0000305175781" width="492.8125" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-jvXy0v6hmyJCnJwd {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd .error-icon{fill:#552222;}#mermaid-svg-jvXy0v6hmyJCnJwd .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-jvXy0v6hmyJCnJwd .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-jvXy0v6hmyJCnJwd .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-jvXy0v6hmyJCnJwd .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-jvXy0v6hmyJCnJwd .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-jvXy0v6hmyJCnJwd .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-jvXy0v6hmyJCnJwd .marker{fill:#333333;stroke:#333333;}#mermaid-svg-jvXy0v6hmyJCnJwd .marker.cross{stroke:#333333;}#mermaid-svg-jvXy0v6hmyJCnJwd svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-jvXy0v6hmyJCnJwd .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd .cluster-label text{fill:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd .cluster-label span{color:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd .label text,#mermaid-svg-jvXy0v6hmyJCnJwd span{fill:#333;color:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd .node rect,#mermaid-svg-jvXy0v6hmyJCnJwd .node circle,#mermaid-svg-jvXy0v6hmyJCnJwd .node ellipse,#mermaid-svg-jvXy0v6hmyJCnJwd .node polygon,#mermaid-svg-jvXy0v6hmyJCnJwd .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-jvXy0v6hmyJCnJwd .node .label{text-align:center;}#mermaid-svg-jvXy0v6hmyJCnJwd .node.clickable{cursor:pointer;}#mermaid-svg-jvXy0v6hmyJCnJwd .arrowheadPath{fill:#333333;}#mermaid-svg-jvXy0v6hmyJCnJwd .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-jvXy0v6hmyJCnJwd .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-jvXy0v6hmyJCnJwd .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-jvXy0v6hmyJCnJwd .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-jvXy0v6hmyJCnJwd .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-jvXy0v6hmyJCnJwd .cluster text{fill:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd .cluster span{color:#333;}#mermaid-svg-jvXy0v6hmyJCnJwd div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-jvXy0v6hmyJCnJwd :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M76,177.00000381469727L80.16666666666667,177.00000381469727C84.33333333333333,177.00000381469727,92.66666666666667,177.00000381469727,101,177.00000381469727C109.33333333333333,177.00000381469727,117.66666666666667,177.00000381469727,121.83333333333333,177.00000381469727L126,177.00000381469727" marker-end="url(#arrowhead1613)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1613" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M174.50426846734237,154.00000381469727L183.05564038945195,136.27778116861978C191.6070123115616,118.55555852254231,208.7097561557808,83.11111323038737,221.42779474455708,65.38889058430989C234.14583333333334,47.66666793823242,242.47916666666666,47.66666793823242,246.64583333333334,47.66666793823242L250.8125,47.66666793823242" marker-end="url(#arrowhead1614)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1614" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-D" id="L-B-D" style="opacity: 1;">
          <path class="path" d="M200.8125,177.00000381469727L204.97916666666666,177.00000381469727C209.14583333333334,177.00000381469727,217.47916666666666,177.00000381469727,225.8125,177.00000381469727C234.14583333333334,177.00000381469727,242.47916666666666,177.00000381469727,246.64583333333334,177.00000381469727L250.8125,177.00000381469727" marker-end="url(#arrowhead1615)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1615" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-E" id="L-B-E" style="opacity: 1;">
          <path class="path" d="M174.50426846734237,200.00000381469727L183.05564038945195,217.72222646077475C191.6070123115616,235.4444491068522,208.7097561557808,270.88889439900714,221.42779474455708,288.61111704508465C234.14583333333334,306.3333396911621,242.47916666666666,306.3333396911621,246.64583333333334,306.3333396911621L250.8125,306.3333396911621" marker-end="url(#arrowhead1616)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1616" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-F" id="L-C-F" style="opacity: 1;">
          <path class="path" d="M334.8125,47.66666793823242L338.9791666666667,47.66666793823242C343.1458333333333,47.66666793823242,351.4791666666667,47.66666793823242,359.8125,47.66666793823242C368.1458333333333,47.66666793823242,376.4791666666667,47.66666793823242,380.6458333333333,47.66666793823242L384.8125,47.66666793823242" marker-end="url(#arrowhead1617)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1617" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-G" id="L-D-G" style="opacity: 1;">
          <path class="path" d="M334.8125,177.00000381469727L338.9791666666667,177.00000381469727C343.1458333333333,177.00000381469727,351.4791666666667,177.00000381469727,359.8125,177.00000381469727C368.1458333333333,177.00000381469727,376.4791666666667,177.00000381469727,380.6458333333333,177.00000381469727L384.8125,177.00000381469727" marker-end="url(#arrowhead1618)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1618" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-E LE-H" id="L-E-H" style="opacity: 1;">
          <path class="path" d="M334.8125,306.3333396911621L338.9791666666667,306.3333396911621C343.1458333333333,306.3333396911621,351.4791666666667,306.3333396911621,359.8125,306.3333396911621C368.1458333333333,306.3333396911621,376.4791666666667,306.3333396911621,380.6458333333333,306.3333396911621L384.8125,306.3333396911621" marker-end="url(#arrowhead1619)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead1619" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-D" id="L-L-B-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-E" id="L-L-B-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-F" id="L-L-C-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-G" id="L-L-D-G">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-E' L-LE-H" id="L-L-E-H">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-1390" style="opacity: 1;" transform="translate(42,177.00000381469727)">
          <rect class="label-container" height="46" rx="0" ry="0" width="68" x="-34" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-24,-13)">
            <foreignobject height="26" width="48">
             <div style="display: inline-block; white-space: nowrap;">
              客户端
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-1391" style="opacity: 1;" transform="translate(163.40625,177.00000381469727)">
          <rect class="label-container" height="46" rx="5" ry="5" width="74.8125" x="-37.40625" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-27.40625,-13)">
            <foreignobject height="26" width="54.8125">
             <div style="display: inline-block; white-space: nowrap;">
              API网关
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-1393" style="opacity: 1;" transform="translate(292.8125,47.66666793823242)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              用户服务
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-1395" style="opacity: 1;" transform="translate(292.8125,177.00000381469727)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              订单服务
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-1397" style="opacity: 1;" transform="translate(292.8125,306.3333396911621)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              支付服务
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-1399" style="opacity: 1;" transform="translate(434.8125,47.66666793823242)">
          <path class="label-container" d="M 0,11.11111111111111 a 50,11.11111111111111 0,0,0 100 0 a 50,11.11111111111111 0,0,0 -100 0 l 0,57.111111111111114 a 50,11.11111111111111 0,0,0 100 0 l 0,-57.111111111111114" transform="translate(-50,-39.66666666666667)">
          </path>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              用户数据库
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-G-1401" style="opacity: 1;" transform="translate(434.8125,177.00000381469727)">
          <path class="label-container" d="M 0,11.11111111111111 a 50,11.11111111111111 0,0,0 100 0 a 50,11.11111111111111 0,0,0 -100 0 l 0,57.111111111111114 a 50,11.11111111111111 0,0,0 100 0 l 0,-57.111111111111114" transform="translate(-50,-39.66666666666667)">
          </path>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              订单数据库
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-H-1403" style="opacity: 1;" transform="translate(434.8125,306.3333396911621)">
          <path class="label-container" d="M 0,11.11111111111111 a 50,11.11111111111111 0,0,0 100 0 a 50,11.11111111111111 0,0,0 -100 0 l 0,57.111111111111114 a 50,11.11111111111111 0,0,0 100 0 l 0,-57.111111111111114" transform="translate(-50,-39.66666666666667)">
          </path>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-40,-13)">
            <foreignobject height="26" width="80">
             <div style="display: inline-block; white-space: nowrap;">
              支付数据库
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h5>
     <a id="92__1542">
     </a>
     <strong>
      9.2 创建基础微服务
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：安装依赖
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/microservices
</code></pre>
    <p>
     <strong>
      步骤2：创建用户服务（TCP通信）
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// user-service/src/main.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> NestFactory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> MicroserviceOptions<span class="token punctuation">,</span> Transport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/microservices'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> UserModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.module'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createMicroservice</span><span class="token generic class-name"><span class="token operator">&lt;</span>MicroserviceOptions<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
    UserModule<span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">TCP</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">3001</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      步骤3：定义用户服务接口
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// shared/user.interface.ts</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">FindUserRequest</span> <span class="token punctuation">{<!-- --></span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CreateUserRequest</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="93_gRPC_1588">
     </a>
     <strong>
      9.3 实现gRPC通信
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：定义proto文件
     </strong>
    </p>
    <pre><code class="prism language-protobuf">// proto/user.proto
syntax = "proto3";

package user;

service UserService {
  rpc FindUser (FindUserRequest) returns (User) {}
  rpc CreateUser (CreateUserRequest) returns (User) {}
}

message FindUserRequest {
  int32 id = 1;
}

message CreateUserRequest {
  string name = 1;
}

message User {
  int32 id = 1;
  string name = 2;
}
</code></pre>
    <p>
     <strong>
      步骤2：配置gRPC服务端
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// user-service/src/main.ts</span>
<span class="token punctuation">{<!-- --></span>
  transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">GRPC</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    protoPath<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'proto/user.proto'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">'localhost:50051'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤3：实现gRPC客户端
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// api-gateway/src/user.client.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Client</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">GRPC</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    protoPath<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'proto/user.proto'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">'localhost:50051'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
client<span class="token operator">:</span> ClientGrpc<span class="token punctuation">;</span>

<span class="token keyword">private</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">;</span>

<span class="token function">onModuleInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>userService <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getService</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserService<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'UserService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'users/:id'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findUser</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findUser</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="94_RabbitMQ_1653">
     </a>
     <strong>
      9.4 RabbitMQ消息队列集成
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：安装依赖
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/microservices amqplib amqp-connection-manager
</code></pre>
    <p>
     <strong>
      步骤2：配置消息生产者
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// order-service/src/order.service.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">Inject</span></span><span class="token punctuation">(</span><span class="token string">'RABBITMQ_CLIENT'</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> client<span class="token operator">:</span> ClientProxy<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">createOrder</span><span class="token punctuation">(</span>orderData<span class="token operator">:</span> CreateOrderDto<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 发送创建订单事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'order_created'</span><span class="token punctuation">,</span> orderData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> status<span class="token operator">:</span> <span class="token string">'processing'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤3：配置消息消费者
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// payment-service/src/payment.consumer.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">EventPattern</span></span><span class="token punctuation">(</span><span class="token string">'order_created'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">handleOrderCreated</span><span class="token punctuation">(</span>data<span class="token operator">:</span> CreateOrderDto<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 处理支付逻辑</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Processing payment for order:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送支付完成事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'payment_processed'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
      orderId<span class="token operator">:</span> data<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      status<span class="token operator">:</span> <span class="token string">'paid'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="95_Saga_1694">
     </a>
     <strong>
      9.5 分布式事务处理（Saga模式示例）
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// 订单创建Saga流程</span>
<span class="token keyword">async</span> <span class="token function">createOrderSaga</span><span class="token punctuation">(</span>orderData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 创建订单（Pending状态）</span>
    <span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">createPendingOrder</span><span class="token punctuation">(</span>orderData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. 扣减库存</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inventoryService<span class="token punctuation">.</span><span class="token function">reserveStock</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. 处理支付</span>
    <span class="token keyword">const</span> payment <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paymentService<span class="token punctuation">.</span><span class="token function">processPayment</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4. 确认订单</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">confirmOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> order<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 补偿操作</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">cancelOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inventoryService<span class="token punctuation">.</span><span class="token function">releaseStock</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="96__1721">
     </a>
     <strong>
      9.6 微服务通信模式对比
     </strong>
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        模式
       </th>
       <th>
        协议
       </th>
       <th>
        适用场景
       </th>
       <th>
        优点
       </th>
       <th>
        缺点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        请求-响应
       </td>
       <td>
        HTTP/REST
       </td>
       <td>
        简单查询操作
       </td>
       <td>
        简单易用
       </td>
       <td>
        同步阻塞
       </td>
      </tr>
      <tr>
       <td>
        gRPC
       </td>
       <td>
        HTTP/2
       </td>
       <td>
        高性能内部通信
       </td>
       <td>
        高效、强类型
       </td>
       <td>
        需要proto定义
       </td>
      </tr>
      <tr>
       <td>
        消息队列
       </td>
       <td>
        AMQP
       </td>
       <td>
        异步任务处理
       </td>
       <td>
        解耦、可靠
       </td>
       <td>
        架构复杂度增加
       </td>
      </tr>
      <tr>
       <td>
        事件驱动
       </td>
       <td>
        Pub/Sub
       </td>
       <td>
        实时数据更新
       </td>
       <td>
        实时性高
       </td>
       <td>
        消息顺序需处理
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="97__1729">
     </a>
     <strong>
      9.7 服务发现与负载均衡
     </strong>
    </h5>
    <p>
     <strong>
      使用Consul示例配置
     </strong>
     ：
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// 服务注册</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ConsulService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/consul'</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Module</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      provide<span class="token operator">:</span> <span class="token string">'CONSUL_CLIENT'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConsulService</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          host<span class="token operator">:</span> <span class="token string">'consul-server'</span><span class="token punctuation">,</span>
          port<span class="token operator">:</span> <span class="token string">'8500'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      客户端负载均衡
     </strong>
     ：
    </p>
    <pre><code class="prism language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Client</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  transport<span class="token operator">:</span> Transport<span class="token punctuation">.</span><span class="token constant">TCP</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    serviceName<span class="token operator">:</span> <span class="token string">'user-service'</span><span class="token punctuation">,</span>
    loadBalancer<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RoundRobinLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    discoverer<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ConsulDiscoverer</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      host<span class="token operator">:</span> <span class="token string">'consul-server'</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span> <span class="token number">8500</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="98__1765">
     </a>
     <strong>
      9.8 测试微服务通信
     </strong>
    </h5>
    <pre><code class="prism language-typescript"><span class="token comment">// 测试gRPC服务</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'UserService (gRPC)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> client<span class="token operator">:</span> UserServiceClient<span class="token punctuation">;</span>

  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> packageDefinition <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadPackageDefinition</span><span class="token punctuation">(</span>
      <span class="token function">loadSync</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'proto/user.proto'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> proto <span class="token operator">=</span> packageDefinition<span class="token punctuation">.</span>user <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">proto</span><span class="token punctuation">.</span><span class="token function">UserService</span><span class="token punctuation">(</span>
      <span class="token string">'localhost:50051'</span><span class="token punctuation">,</span>
      credentials<span class="token punctuation">.</span><span class="token function">createInsecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should return user details'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    client<span class="token punctuation">.</span><span class="token function">findUser</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">expect</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Test User'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="99__1791">
     </a>
     <strong>
      9.9 生产环境注意事项
     </strong>
    </h5>
    <ol>
     <li>
      <p>
       <strong>
        服务监控
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用Prometheus + Grafana监控服务指标
       </li>
       <li>
        实现健康检查端点
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        容错处理
       </strong>
       ：
      </p>
      <pre><code class="prism language-typescript"><span class="token comment">// 断路器模式</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">'users/:id'</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">UseFilters</span></span><span class="token punctuation">(</span>CircuitBreakerFilter<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Param</span></span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        日志追踪
       </strong>
       ：
      </p>
      <ul>
       <li>
        集成OpenTelemetry实现分布式追踪
       </li>
       <li>
        使用唯一请求ID串联日志
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        安全策略
       </strong>
       ：
      </p>
      <ul>
       <li>
        服务间TLS加密通信
       </li>
       <li>
        JWT认证传递
       </li>
       <li>
        速率限制
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_1817">
     </a>
     <strong>
      微服务架构核心组件
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        组件
       </th>
       <th>
        作用
       </th>
       <th>
        常用工具
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        API网关
       </td>
       <td>
        请求路由、聚合、认证
       </td>
       <td>
        Kong, NestJS网关
       </td>
      </tr>
      <tr>
       <td>
        服务注册中心
       </td>
       <td>
        服务发现与管理
       </td>
       <td>
        Consul, etcd, Zookeeper
       </td>
      </tr>
      <tr>
       <td>
        配置中心
       </td>
       <td>
        统一管理配置
       </td>
       <td>
        Spring Cloud Config
       </td>
      </tr>
      <tr>
       <td>
        消息中间件
       </td>
       <td>
        异步通信
       </td>
       <td>
        RabbitMQ, Kafka
       </td>
      </tr>
      <tr>
       <td>
        分布式追踪系统
       </td>
       <td>
        请求链路追踪
       </td>
       <td>
        Jaeger, Zipkin
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="_1829">
     </a>
     <strong>
      第十部分：前端集成与全栈实践
     </strong>
    </h4>
    <h5>
     <a id="101_Swagger_API_1831">
     </a>
     <strong>
      10.1 Swagger API文档集成
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：安装依赖
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> @nestjs/swagger swagger-ui-express
</code></pre>
    <p>
     <strong>
      步骤2：配置Swagger模块
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> SwaggerModule<span class="token punctuation">,</span> DocumentBuilder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/swagger'</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DocumentBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">'NestJS API'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">'全栈开发接口文档'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setVersion</span><span class="token punctuation">(</span><span class="token string">'1.0'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">addBearerAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 启用JWT认证</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> document <span class="token operator">=</span> SwaggerModule<span class="token punctuation">.</span><span class="token function">createDocument</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
  SwaggerModule<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token string">'api-docs'</span><span class="token punctuation">,</span> app<span class="token punctuation">,</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤3：添加接口注释
     </strong>
    </p>
    <pre><code class="prism language-typescript"><span class="token comment">// user.controller.ts</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiOperation</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> summary<span class="token operator">:</span> <span class="token string">'获取用户列表'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiResponse</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">'返回用户数组'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">getAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// create-user.dto.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateUserDto</span> <span class="token punctuation">{<!-- --></span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ApiProperty</span></span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> example<span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">'用户姓名'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">IsString</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      访问文档
     </strong>
     ：http://localhost:3000/api-docs
    </p>
    <hr/>
    <h5>
     <a id="102_React_1881">
     </a>
     <strong>
      10.2 前端项目配置（以React为例）
     </strong>
    </h5>
    <p>
     <strong>
      步骤1：创建React应用
     </strong>
    </p>
    <pre><code class="prism language-bash">npx create-react-app nest-client
<span class="token builtin class-name">cd</span> nest-client
</code></pre>
    <p>
     <strong>
      步骤2：配置代理（解决跨域）
     </strong>
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// package.json</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"proxy"</span><span class="token operator">:</span> <span class="token string">"http://localhost:3000"</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      步骤3：安装axios
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> axios
</code></pre>
    <hr/>
    <h5>
     <a id="103__1903">
     </a>
     <strong>
      10.3 实现登录认证流程
     </strong>
    </h5>
    <pre><code class="prism language-javascript"><span class="token comment">// src/api/auth.js</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">credentials</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/auth/login'</span><span class="token punctuation">,</span> credentials<span class="token punctuation">)</span><span class="token punctuation">;</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getProfile</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users/profile'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="104_React_1925">
     </a>
     <strong>
      10.4 前端路由保护（React示例）
     </strong>
    </h5>
    <pre><code class="prism language-javascript"><span class="token comment">// src/components/PrivateRoute.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Navigate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">PrivateRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> isAuthenticated <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> isAuthenticated <span class="token operator">?</span> children <span class="token operator">:</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/login"</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="105__1939">
     </a>
     <strong>
      10.5 全栈调试技巧
     </strong>
    </h5>
    <p>
     <strong>
      调试工具组合
     </strong>
     ：
    </p>
    <div class="mermaid">
     <svg class="mermaid-svg" height="450" id="mermaid-svg-s3mTXcXoPouYxfcg" style="max-width: 500px;" viewbox="0 0 500 450" width="100%" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-s3mTXcXoPouYxfcg {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-s3mTXcXoPouYxfcg .error-icon{fill:#552222;}#mermaid-svg-s3mTXcXoPouYxfcg .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-s3mTXcXoPouYxfcg .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-s3mTXcXoPouYxfcg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-s3mTXcXoPouYxfcg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-s3mTXcXoPouYxfcg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-s3mTXcXoPouYxfcg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-s3mTXcXoPouYxfcg .marker{fill:#333333;stroke:#333333;}#mermaid-svg-s3mTXcXoPouYxfcg .marker.cross{stroke:#333333;}#mermaid-svg-s3mTXcXoPouYxfcg svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-s3mTXcXoPouYxfcg .pieCircle{stroke:black;stroke-width:2px;opacity:0.7;}#mermaid-svg-s3mTXcXoPouYxfcg .pieTitleText{text-anchor:middle;font-size:25px;fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-s3mTXcXoPouYxfcg .slice{font-family:"trebuchet ms",verdana,arial,sans-serif;fill:#333;font-size:17px;}#mermaid-svg-s3mTXcXoPouYxfcg .legend text{fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:17px;}#mermaid-svg-s3mTXcXoPouYxfcg :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
      </g>
      <g transform="translate(250,225)">
       <path class="pieCircle" d="M1.1327982892113017e-14,-185A185,185,0,0,1,57.16814395936521,175.94545551460342L0,0Z" fill="#ECECFF">
       </path>
       <path class="pieCircle" d="M57.16814395936521,175.94545551460342A185,185,0,0,1,-185,-1.4165704186029714e-13L0,0Z" fill="#ffffde">
       </path>
       <path class="pieCircle" d="M-185,-1.4165704186029714e-13A185,185,0,0,1,-57.168143959365146,-175.94545551460345L0,0Z" fill="hsl(80, 100%, 56.2745098039%)">
       </path>
       <path class="pieCircle" d="M-57.168143959365146,-175.94545551460345A185,185,0,0,1,1.303290589681841e-13,-185L0,0Z" fill="hsl(240, 100%, 86.2745098039%)">
       </path>
       <text class="slice" style="text-anchor: middle;" transform="translate(91.36117150505024,-14.470188016221336)">
        45%
       </text>
       <text class="slice" style="text-anchor: middle;" transform="translate(-54.37013583705383,74.8340719796826)">
        30%
       </text>
       <text class="slice" style="text-anchor: middle;" transform="translate(-74.8340719796826,-54.370135837053816)">
        20%
       </text>
       <text class="slice" style="text-anchor: middle;" transform="translate(-14.470188016221291,-91.36117150505025)">
        5%
       </text>
       <text class="pieTitleText" x="0" y="-200">
        调试工具使用率
       </text>
       <g class="legend" transform="translate(216,-44)">
        <rect height="18" style="fill: rgb(236, 236, 255); stroke: rgb(236, 236, 255);" width="18">
        </rect>
        <text x="22" y="14">
         浏览器开发者工具
        </text>
       </g>
       <g class="legend" transform="translate(216,-22)">
        <rect height="18" style="fill: rgb(255, 255, 222); stroke: rgb(255, 255, 222);" width="18">
        </rect>
        <text x="22" y="14">
         Postman
        </text>
       </g>
       <g class="legend" transform="translate(216,0)">
        <rect height="18" style="fill: rgb(181, 255, 32); stroke: rgb(181, 255, 32);" width="18">
        </rect>
        <text x="22" y="14">
         VS Code调试器
        </text>
       </g>
       <g class="legend" transform="translate(216,22)">
        <rect height="18" style="fill: rgb(185, 185, 255); stroke: rgb(185, 185, 255);" width="18">
        </rect>
        <text x="22" y="14">
         其他
        </text>
       </g>
      </g>
     </svg>
    </div>
    <p>
     <strong>
      常见问题排查
     </strong>
     ：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        跨域问题
       </strong>
       ：
      </p>
      <pre><code class="prism language-typescript"><span class="token comment">// 后端启用CORS</span>
app<span class="token punctuation">.</span><span class="token function">enableCors</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  origin<span class="token operator">:</span> <span class="token string">'http://localhost:3001'</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token string">'GET,HEAD,PUT,PATCH,POST,DELETE'</span><span class="token punctuation">,</span>
  credentials<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        认证失效处理
       </strong>
       ：
      </p>
      <pre><code class="prism language-javascript"><span class="token comment">// 前端axios拦截器</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'/login'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ol>
    <hr/>
    <h5>
     <a id="106__1977">
     </a>
     <strong>
      10.6 部署联调配置
     </strong>
    </h5>
    <p>
     <strong>
      生产环境配置示例
     </strong>
     ：
    </p>
    <pre><code class="prism language-nginx"># nginx配置
server {
    listen 80;
    server_name yourdomain.com;

    location /api {
        proxy_pass http://backend:3000;
        proxy_set_header Host $host;
    }

    location / {
        root /var/www/client;
        try_files $uri $uri/ /index.html;
    }
}
</code></pre>
    <hr/>
    <h4>
     <a id="_1999">
     </a>
     <strong>
      全栈开发关键点总结
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        层级
       </th>
       <th>
        技术栈
       </th>
       <th>
        关注重点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        前端
       </td>
       <td>
        React/Vue + Axios
       </td>
       <td>
        状态管理、路由守卫
       </td>
      </tr>
      <tr>
       <td>
        网关层
       </td>
       <td>
        Nginx
       </td>
       <td>
        负载均衡、HTTPS配置
       </td>
      </tr>
      <tr>
       <td>
        后端
       </td>
       <td>
        NestJS + TypeORM
       </td>
       <td>
        业务逻辑、数据库优化
       </td>
      </tr>
      <tr>
       <td>
        基础设施
       </td>
       <td>
        Docker + PostgreSQL
       </td>
       <td>
        容器编排、备份策略
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <a id="_2009">
     </a>
     <strong>
      项目完整工作流
     </strong>
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="467" id="mermaid-svg-YhVU1KNEysE9XWUz" style="max-width: 850px;" viewbox="-50 -10 850 467" width="100%" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-YhVU1KNEysE9XWUz {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-YhVU1KNEysE9XWUz .error-icon{fill:#552222;}#mermaid-svg-YhVU1KNEysE9XWUz .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-YhVU1KNEysE9XWUz .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-YhVU1KNEysE9XWUz .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-YhVU1KNEysE9XWUz .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-YhVU1KNEysE9XWUz .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-YhVU1KNEysE9XWUz .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-YhVU1KNEysE9XWUz .marker{fill:#333333;stroke:#333333;}#mermaid-svg-YhVU1KNEysE9XWUz .marker.cross{stroke:#333333;}#mermaid-svg-YhVU1KNEysE9XWUz svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-YhVU1KNEysE9XWUz .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-svg-YhVU1KNEysE9XWUz text.actor&gt;tspan{fill:black;stroke:none;}#mermaid-svg-YhVU1KNEysE9XWUz .actor-line{stroke:grey;}#mermaid-svg-YhVU1KNEysE9XWUz .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-YhVU1KNEysE9XWUz .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-YhVU1KNEysE9XWUz #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-YhVU1KNEysE9XWUz .sequenceNumber{fill:white;}#mermaid-svg-YhVU1KNEysE9XWUz #sequencenumber{fill:#333;}#mermaid-svg-YhVU1KNEysE9XWUz #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-YhVU1KNEysE9XWUz .messageText{fill:#333;stroke:#333;}#mermaid-svg-YhVU1KNEysE9XWUz .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-svg-YhVU1KNEysE9XWUz .labelText,#mermaid-svg-YhVU1KNEysE9XWUz .labelText&gt;tspan{fill:black;stroke:none;}#mermaid-svg-YhVU1KNEysE9XWUz .loopText,#mermaid-svg-YhVU1KNEysE9XWUz .loopText&gt;tspan{fill:black;stroke:none;}#mermaid-svg-YhVU1KNEysE9XWUz .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-svg-YhVU1KNEysE9XWUz .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-svg-YhVU1KNEysE9XWUz .noteText,#mermaid-svg-YhVU1KNEysE9XWUz .noteText&gt;tspan{fill:black;stroke:none;}#mermaid-svg-YhVU1KNEysE9XWUz .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-YhVU1KNEysE9XWUz .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-YhVU1KNEysE9XWUz .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-YhVU1KNEysE9XWUz .actorPopupMenu{position:absolute;}#mermaid-svg-YhVU1KNEysE9XWUz .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-svg-YhVU1KNEysE9XWUz .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-svg-YhVU1KNEysE9XWUz .actor-man circle,#mermaid-svg-YhVU1KNEysE9XWUz line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaid-svg-YhVU1KNEysE9XWUz :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
      </g>
      <defs>
       <symbol height="24" id="computer" width="24">
        <path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)">
        </path>
       </symbol>
      </defs>
      <defs>
       <symbol fill-rule="evenodd" id="database">
        <path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)">
        </path>
       </symbol>
      </defs>
      <defs>
       <symbol height="24" id="clock" width="24">
        <path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)">
        </path>
       </symbol>
      </defs>
      <g>
       <line class="200" id="actor36" stroke="#999" stroke-width="0.5px" x1="75" x2="75" y1="5" y2="401">
       </line>
       <g id="root-36">
        <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="0" y="0">
        </rect>
        <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="75" y="32.5">
         <tspan dy="0" x="75">
          用户
         </tspan>
        </text>
       </g>
      </g>
      <g>
       <line class="200" id="actor37" stroke="#999" stroke-width="0.5px" x1="275" x2="275" y1="5" y2="401">
       </line>
       <g id="root-37">
        <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="200" y="0">
        </rect>
        <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="275" y="32.5">
         <tspan dy="0" x="275">
          前端
         </tspan>
        </text>
       </g>
      </g>
      <g>
       <line class="200" id="actor38" stroke="#999" stroke-width="0.5px" x1="475" x2="475" y1="5" y2="401">
       </line>
       <g id="root-38">
        <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="400" y="0">
        </rect>
        <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="475" y="32.5">
         <tspan dy="0" x="475">
          后端
         </tspan>
        </text>
       </g>
      </g>
      <g>
       <line class="200" id="actor39" stroke="#999" stroke-width="0.5px" x1="675" x2="675" y1="5" y2="401">
       </line>
       <g id="root-39">
        <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="600" y="0">
        </rect>
        <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="675" y="32.5">
         <tspan dy="0" x="675">
          数据库
         </tspan>
        </text>
       </g>
      </g>
      <defs>
       <marker id="arrowhead" markerheight="12" markerunits="userSpaceOnUse" markerwidth="12" orient="auto" refx="9" refy="5">
        <path d="M 0 0 L 10 5 L 0 10 z">
        </path>
       </marker>
      </defs>
      <defs>
       <marker id="crosshead" markerheight="8" markerwidth="15" orient="auto" refx="16" refy="4">
        <path d="M 9,2 V 6 L16,4 Z" fill="black" stroke="#000000" stroke-width="1px" style="stroke-dasharray: 0, 0;">
        </path>
        <path d="M 0,1 L 6,7 M 6,1 L 0,7" fill="none" stroke="#000000" stroke-width="1px" style="stroke-dasharray: 0, 0;">
        </path>
       </marker>
      </defs>
      <defs>
       <marker id="filled-head" markerheight="28" markerwidth="20" orient="auto" refx="18" refy="7">
        <path d="M 18,7 L9,13 L14,7 L9,1 Z">
        </path>
       </marker>
      </defs>
      <defs>
       <marker id="sequencenumber" markerheight="40" markerwidth="60" orient="auto" refx="15" refy="15">
        <circle cx="15" cy="15" r="6">
        </circle>
       </marker>
      </defs>
      <text alignment-baseline="middle" class="messageText" dominant-baseline="middle" dy="1em" style='font-family: "trebuchet ms", verdana, arial, sans-serif; font-size: 16px; font-weight: 400;' text-anchor="middle" x="175" y="80">
       发起请求
      </text>
      <line class="messageLine0" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" style="fill: none;" x1="75" x2="275" y1="113" y2="113">
      </line>
      <text alignment-baseline="middle" class="messageText" dominant-baseline="middle" dy="1em" style='font-family: "trebuchet ms", verdana, arial, sans-serif; font-size: 16px; font-weight: 400;' text-anchor="middle" x="375" y="128">
       API调用
      </text>
      <line class="messageLine0" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" style="fill: none;" x1="275" x2="475" y1="165" y2="165">
      </line>
      <text alignment-baseline="middle" class="messageText" dominant-baseline="middle" dy="1em" style='font-family: "trebuchet ms", verdana, arial, sans-serif; font-size: 16px; font-weight: 400;' text-anchor="middle" x="575" y="180">
       查询数据
      </text>
      <line class="messageLine0" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" style="fill: none;" x1="475" x2="675" y1="213" y2="213">
      </line>
      <text alignment-baseline="middle" class="messageText" dominant-baseline="middle" dy="1em" style='font-family: "trebuchet ms", verdana, arial, sans-serif; font-size: 16px; font-weight: 400;' text-anchor="middle" x="575" y="228">
       返回数据
      </text>
      <line class="messageLine1" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" style="stroke-dasharray: 3, 3; fill: none;" x1="675" x2="475" y1="261" y2="261">
      </line>
      <text alignment-baseline="middle" class="messageText" dominant-baseline="middle" dy="1em" style='font-family: "trebuchet ms", verdana, arial, sans-serif; font-size: 16px; font-weight: 400;' text-anchor="middle" x="375" y="276">
       JSON响应
      </text>
      <line class="messageLine1" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" style="stroke-dasharray: 3, 3; fill: none;" x1="475" x2="275" y1="313" y2="313">
      </line>
      <text alignment-baseline="middle" class="messageText" dominant-baseline="middle" dy="1em" style='font-family: "trebuchet ms", verdana, arial, sans-serif; font-size: 16px; font-weight: 400;' text-anchor="middle" x="175" y="328">
       渲染界面
      </text>
      <line class="messageLine0" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" style="fill: none;" x1="275" x2="75" y1="361" y2="361">
      </line>
      <g>
       <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="0" y="381">
       </rect>
       <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="75" y="413.5">
        <tspan dy="0" x="75">
         用户
        </tspan>
       </text>
      </g>
      <g>
       <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="200" y="381">
       </rect>
       <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="275" y="413.5">
        <tspan dy="0" x="275">
         前端
        </tspan>
       </text>
      </g>
      <g>
       <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="400" y="381">
       </rect>
       <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="475" y="413.5">
        <tspan dy="0" x="475">
         后端
        </tspan>
       </text>
      </g>
      <g>
       <rect class="actor" fill="#eaeaea" height="65" rx="3" ry="3" stroke="#666" width="150" x="600" y="381">
       </rect>
       <text alignment-baseline="central" class="actor" dominant-baseline="central" style='text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, "sans-serif";' x="675" y="413.5">
        <tspan dy="0" x="675">
         数据库
        </tspan>
       </text>
      </g>
     </svg>
    </div>
    <hr/>
    <p>
     至此，Nest.js全栈开发系列教程已全部完成！建议学习者通过以下方式巩固知识：
    </p>
    <ol>
     <li>
      开发一个完整博客系统（包含用户/文章/评论模块）
     </li>
     <li>
      尝试部署到云平台（AWS/Aliyun）
     </li>
     <li>
      参与开源Nest.js项目
     </li>
     <li>
      探索NestJS官方高级特性（CLI插件、自定义装饰器等）
     </li>
    </ol>
    <hr/>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34393730373337352f:61727469636c652f64657461696c732f313436313635333438" class_="artid" style="display:none">
 </p>
</div>


