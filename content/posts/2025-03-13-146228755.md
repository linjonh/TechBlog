---
layout: post
title: "记第一次跟踪seatunnel的任务运行过程四getJobConfigParser.parse的动作"
date: 2025-03-13 14:48:31 +0800
description: "将source和transform的connector jar包资源合并去重，然后分别创建“source与transform共用的classLoader”以及“sink使用的classLoader”。从MultipleTableJobConfigParser的类名刻制，这是支持多表配置文件解析的，所以在解析source、transform、sink时都有循环便利的代码存在。所以对parse()方法的调用，实际就是由MultipleTableJobConfigParser的parse方法的承担执行的。"
keywords: "记第一次跟踪seatunnel的任务运行过程四——getJobConfigParser().parse()的动作"
categories: ['日常记录', 'Seatunnel']
tags: ['Seatunnel']
artid: "146228755"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146228755
    alt: "记第一次跟踪seatunnel的任务运行过程四getJobConfigParser.parse的动作"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146228755
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146228755
cover: https://bing.ee123.net/img/rand?artid=146228755
image: https://bing.ee123.net/img/rand?artid=146228755
img: https://bing.ee123.net/img/rand?artid=146228755
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     记第一次跟踪seatunnel的任务运行过程四——getJobConfigParser().parse()的动作
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前绪
    </h2>
    <p>
     <a href="https://blog.csdn.net/u011924665/article/details/146224236">
      记第一次跟踪seatunnel的任务运行过程三——解析配置的具体方法getLogicalDag
     </a>
    </p>
    <h2>
     <a id="_3">
     </a>
     正文
    </h2>
    <h3>
     <a id="_4">
     </a>
     书接上文
    </h3>
    <pre><code class="prism language-java"><span class="token class-name">ImmutablePair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Action</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> immutablePair <span class="token operator">=</span> <span class="token function">getJobConfigParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     在前一篇文章中说到getLogicDag()方法的第一行（如上），执行了一个解析方法获得了action和jar包资源对，这一步就是由parse()方法来执行的。本片文章就是对parse()方法的源码探索。
    </p>
    <h4>
     <a id="_10">
     </a>
     任务配置文件
    </h4>
    <p>
     先回顾一下执行seatunnel.sh时命令中‘ --config ’指定的任务配置文件的结构：
    </p>
    <pre><code class="prism language-json">env<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
source<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
transform<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
sink<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
    <p>
     主要有以上四部分
    </p>
    <h3>
     <a id="_20">
     </a>
     获得任务配置解析器
    </h3>
    <p>
     getJobConfigParser()方法也org.apache.seatunnel.engine.client.job.ClientJobExecutionEnvironment中的一个受保护的方法，在这个方法中直接返回了一个MultipleTableJobConfigParser（多表任务配置解析器）对象。这也与Seatunnel官网宣传的支持耽搁文件中同时同步多张表的数据相一致。
     <br/>
     所以对parse()方法的调用，实际就是由MultipleTableJobConfigParser的parse方法的承担执行的。
     <br/>
     在getJobConfigParser()方法方法中，有对‘从保存的检查点开始任务’的支持。但是从执行的代码路径上来看，创建ClientJobExecutionEnvironment对象的时候，其中isStartWithSavePoint参数给的是false，所以并没有启用。
     <br/>
     确实我们的探索是从一个全新的任务开始并不是从一个save point开始。
    </p>
    <h3>
     <a id="jobClientenv_26">
     </a>
     填充jobClient对象（解析env）
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fillJobConfigAndCommonJars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     获取‘ --config ’指定的配置文件中的env部分的内容：
    </p>
    <ul>
     <li>
      提取任务模式（jobModel），是stream流式的任务，还是batch批任务；
     </li>
     <li>
      提取任务命名；
     </li>
     <li>
      提取其他env部分的配置；
     </li>
     <li>
      提取env部分指定的第三方jar包的uri，并且封装为commonPluginJars（公共插件jar包）；
     </li>
    </ul>
    <h3>
     <a id="sourcetranformsink_38">
     </a>
     解析source、tranform、sink
    </h3>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Config</span><span class="token punctuation">&gt;</span></span> sourceConfigs <span class="token operator">=</span> <span class="token class-name">TypesafeConfigUtils</span><span class="token punctuation">.</span><span class="token function">getConfigList</span><span class="token punctuation">(</span>seaTunnelJobConfig<span class="token punctuation">,</span> <span class="token string">"source"</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Config</span><span class="token punctuation">&gt;</span></span> transformConfigs <span class="token operator">=</span> <span class="token class-name">TypesafeConfigUtils</span><span class="token punctuation">.</span><span class="token function">getConfigList</span><span class="token punctuation">(</span>seaTunnelJobConfig<span class="token punctuation">,</span> <span class="token string">"transform"</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Config</span><span class="token punctuation">&gt;</span></span> sinkConfigs <span class="token operator">=</span>  <span class="token class-name">TypesafeConfigUtils</span><span class="token punctuation">.</span><span class="token function">getConfigList</span><span class="token punctuation">(</span>seaTunnelJobConfig<span class="token punctuation">,</span> <span class="token string">"sink"</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     解析source、transform、sink部分的内容，获取各部分的配置信息。
    </p>
    <h3>
     <a id="connector_47">
     </a>
     解析connector
    </h3>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> sourceConnectorJars <span class="token operator">=</span> <span class="token function">getConnectorJarList</span><span class="token punctuation">(</span>sourceConfigs<span class="token punctuation">,</span> <span class="token class-name">PluginType</span><span class="token punctuation">.</span><span class="token constant">SOURCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> transformConnectorJars <span class="token operator">=</span> <span class="token function">getConnectorJarList</span><span class="token punctuation">(</span>transformConfigs<span class="token punctuation">,</span> <span class="token class-name">PluginType</span><span class="token punctuation">.</span><span class="token constant">TRANSFORM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> sinkConnectorJars <span class="token operator">=</span> <span class="token function">getConnectorJarList</span><span class="token punctuation">(</span>sinkConfigs<span class="token punctuation">,</span> <span class="token class-name">PluginType</span><span class="token punctuation">.</span><span class="token constant">SINK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     获得source、transform、sink三部分的使用的connector信息。
    </p>
    <h3>
     <a id="seatunnelclassLoader_55">
     </a>
     换用seatunnel自己的classLoader
    </h3>
    <pre><code class="prism language-java"><span class="token class-name">ClassLoader</span> parentClassLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     将当前使用中的classLoader暂存。
    </p>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> sourceJars <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>sourceConnectorJars<span class="token punctuation">,</span> transformConnectorJars<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ClassLoader</span> sourceAndTransformClassLoader <span class="token operator">=</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span>classLoaderService<span class="token punctuation">,</span> parentClassLoader<span class="token punctuation">,</span> sourceJars<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ClassLoader</span> sinkClassLoader <span class="token operator">=</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span>classLoaderService<span class="token punctuation">,</span> parentClassLoader<span class="token punctuation">,</span> sinkConnectorJars<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     将source和transform的connector jar包资源合并去重，然后分别创建“source与transform共用的classLoader”以及“sink使用的classLoader”。
    </p>
    <pre><code class="prism language-java"><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContextClassLoader</span><span class="token punctuation">(</span>sourceAndTransformClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     先使用“source与transform共用的classLoader”进行处理
    </p>
    <h3>
     <a id="DAG_75">
     </a>
     检查配置文件是否可有构建成DAG
    </h3>
    <pre><code class="prism language-java"><span class="token class-name">ConfigParserUtil</span><span class="token punctuation">.</span><span class="token function">checkGraph</span><span class="token punctuation">(</span>sourceConfigs<span class="token punctuation">,</span> transformConfigs<span class="token punctuation">,</span> sinkConfigs<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     检查source、sink、transform（如有）能否组成一个DAG。
    </p>
    <h4>
     <a id="checkGraph_82">
     </a>
     checkGraph方法中
    </h4>
    <pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>sinks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JobDefineCheckException</span><span class="token punctuation">(</span><span class="token string">"Source And Sink can not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     如果缺少source或sink直接报错，source和sink作为执行任务的必备元素，不可或缺。
    </p>
    <pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSimpleGraph</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> transforms<span class="token punctuation">,</span> sinks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">checkSimpleGraph</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> transforms<span class="token punctuation">,</span> sinks<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token function">checkComplexGraph</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> transforms<span class="token punctuation">,</span> sinks<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     如果是简单的图（graph）则执行简单查询，执行完直接返回，否则就执行复杂检查。
    </p>
    <h5>
     <a id="isSimpleGraphsources_transforms_sinks_98">
     </a>
     是否是简单图：isSimpleGraph(sources, transforms, sinks)
    </h5>
    <pre><code class="prism language-java">sources<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> sinks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>transforms<span class="token punctuation">)</span> <span class="token operator">||</span> transforms<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     如果source下只有一个内容，并且sink下也只有一个内容，并且没有transform或只有一个transform，则认为是简单图。
     <br/>
     <strong>
      这也是最常用的两种配置模式
     </strong>
    </p>
    <ol>
     <li>
      单source+单sink
     </li>
     <li>
      单source+单transform+单sink
     </li>
    </ol>
    <h5>
     <a id="checkSimpleGraphsources_transforms_sinks_107">
     </a>
     执行简单检查：checkSimpleGraph(sources, transforms, sinks)
    </h5>
    <pre><code class="prism language-java"><span class="token class-name">ReadonlyConfig</span> source <span class="token operator">=</span> <span class="token class-name">ReadonlyConfig</span><span class="token punctuation">.</span><span class="token function">fromConfig</span><span class="token punctuation">(</span>sources<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ReadonlyConfig</span> sink <span class="token operator">=</span> <span class="token class-name">ReadonlyConfig</span><span class="token punctuation">.</span><span class="token function">fromConfig</span><span class="token punctuation">(</span>sinks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>transforms<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">checkEdge</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> sink<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ReadonlyConfig</span> transform <span class="token operator">=</span> <span class="token class-name">ReadonlyConfig</span><span class="token punctuation">.</span><span class="token function">fromConfig</span><span class="token punctuation">(</span>transforms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkEdge</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkEdge</span><span class="token punctuation">(</span>transform<span class="token punctuation">,</span> sink<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      如果没有transform，就检查source的plugin_output（之前版本是result_table_name）和sink的plugin_input（之前版本是source_table_name）是否匹配。
     </li>
     <li>
      如果有transform，就检查source的plugin_output（之前版本是result_table_name）和transform的plugin_input（之前版本是source_table_name）是否匹配；以及就检查transform的plugin_output（之前版本是result_table_name）和sink的plugin_input（之前版本是source_table_name）是否匹配。
      <br/>
      在此过程中，若配置文件中没有配置plugin_input和plugin_output，则使用默认的名称default-identifier代替。
     </li>
    </ul>
    <h3>
     <a id="sourcetransformsink_123">
     </a>
     解析source、transform、sink配置内容
    </h3>
    <pre><code class="prism language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> configIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> configIndex <span class="token operator">&lt;</span> sourceConfigs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> configIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Config</span> sourceConfig <span class="token operator">=</span> sourceConfigs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>configIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Tuple2</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Tuple2</span><span class="token punctuation">&lt;</span><span class="token class-name">CatalogTable</span><span class="token punctuation">,</span> <span class="token class-name">Action</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> tuple2 <span class="token operator">=</span>
                        <span class="token function">parseSource</span><span class="token punctuation">(</span>configIndex<span class="token punctuation">,</span> sourceConfig<span class="token punctuation">,</span> sourceAndTransformClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
                tableWithActionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>tuple2<span class="token punctuation">.</span><span class="token function">_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tuple2<span class="token punctuation">.</span><span class="token function">_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"start generating all transforms."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">parseTransforms</span><span class="token punctuation">(</span>transformConfigs<span class="token punctuation">,</span> sourceAndTransformClassLoader<span class="token punctuation">,</span> tableWithActionMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContextClassLoader</span><span class="token punctuation">(</span>sinkClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"start generating all sinks."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Action</span><span class="token punctuation">&gt;</span></span> sinkActions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> configIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> configIndex <span class="token operator">&lt;</span> sinkConfigs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> configIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Config</span> sinkConfig <span class="token operator">=</span> sinkConfigs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>configIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                sinkActions<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>
                        <span class="token function">parseSink</span><span class="token punctuation">(</span>configIndex<span class="token punctuation">,</span> sinkConfig<span class="token punctuation">,</span> sinkClassLoader<span class="token punctuation">,</span> tableWithActionMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> factoryUrls <span class="token operator">=</span> <span class="token function">getUsedFactoryUrls</span><span class="token punctuation">(</span>sinkActions<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ImmutablePair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>sinkActions<span class="token punctuation">,</span> factoryUrls<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     逐步解析source、transform、sink的配置内容，最终组装成action返回。
     <br/>
     从MultipleTableJobConfigParser的类名刻制，这是支持多表配置文件解析的，所以在解析source、transform、sink时都有循环便利的代码存在。
    </p>
    <h3>
     <a id="_149">
     </a>
     结束
    </h3>
    <pre><code class="prism language-java"> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContextClassLoader</span><span class="token punctuation">(</span>parentClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>classLoaderService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                classLoaderService<span class="token punctuation">.</span><span class="token function">releaseClassLoader</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>jobConfig<span class="token punctuation">.</span><span class="token function">getJobContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sourceJars<span class="token punctuation">)</span><span class="token punctuation">;</span>
                classLoaderService<span class="token punctuation">.</span><span class="token function">releaseClassLoader</span><span class="token punctuation">(</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>jobConfig<span class="token punctuation">.</span><span class="token function">getJobContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJobId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sinkConnectorJars<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre>
    <p>
     换回默认的类加载器，并释放“source与transform共用的classLoader”以及“sink使用的classLoader”资源。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031313932343636352f:61727469636c652f64657461696c732f313436323238373535" class_="artid" style="display:none">
 </p>
</div>


