---
layout: post
title: "pagehelper适配国产数据库"
date: 2023-05-19 10:46:24 +0800
description: "本文介绍了如何适配国产数据库，特别是人大金仓数据库，由于其山寨特性，适配过程相对简单。文章分析了Pa"
keywords: "pagehelper 5.1.2添加registerdialectalias"
categories: ['国产化数据库适配']
tags: ['数据库', 'Sql']
artid: "130761244"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=130761244
    alt: "pagehelper适配国产数据库"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=130761244
featuredImagePreview: https://bing.ee123.net/img/rand?artid=130761244
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     pagehelper适配国产数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     一.国产数据库介绍
    </h3>
    <p>
     国产数据库基本上都是山寨版的数据库，例如人大金仓数据库，山寨postgresql数据库，有些则山寨mysql、oracle等数据库。所以在适配过程中，只要了解到使用的国产数据库是山寨的那一种数据库，则遇到的问题就迎刃而解。
    </p>
    <h3>
     一.分页插件源码分析
    </h3>
    <p>
     分页插件在未指定方言的情况下，会通过数据库的URL取其数据库类型做自动方言匹配。如下图：
    </p>
    <p>
     <img alt="b0289506182442338a789e20fdac6a27.png" src="https://i-blog.csdnimg.cn/blog_migrate/cf3913b8038803f4fb4acef2f7e9d8de.png"/>
    </p>
    <p>
     分页插件数据库方言自动匹配源码如下：
    </p>
    <p>
     静态块会在类加载时，注册数据库方言的分页处理类。注册的别名则与上图数据库url红框圈中部分匹配（配置文件未设置方言时）。
    </p>
    <pre><code class="language-java">public class PageAutoDialect {

    private static Map&lt;String, Class&lt;? extends Dialect&gt;&gt; dialectAliasMap = new HashMap&lt;String, Class&lt;? extends Dialect&gt;&gt;();

    public static void registerDialectAlias(String alias, Class&lt;? extends Dialect&gt; dialectClass){
        dialectAliasMap.put(alias, dialectClass);
    }

    static {
        //注册别名
        registerDialectAlias("hsqldb", HsqldbDialect.class);
        registerDialectAlias("h2", HsqldbDialect.class);
        registerDialectAlias("postgresql", HsqldbDialect.class);
        registerDialectAlias("phoenix", HsqldbDialect.class);

        registerDialectAlias("mysql", MySqlDialect.class);
        registerDialectAlias("mariadb", MySqlDialect.class);
        registerDialectAlias("sqlite", MySqlDialect.class);

        registerDialectAlias("oracle", OracleDialect.class);
        registerDialectAlias("db2", Db2Dialect.class);
        registerDialectAlias("informix", InformixDialect.class);
        //解决 informix-sqli #129，仍然保留上面的
        registerDialectAlias("informix-sqli", InformixDialect.class);

        registerDialectAlias("sqlserver", SqlServerDialect.class);
        registerDialectAlias("sqlserver2012", SqlServer2012Dialect.class);

        registerDialectAlias("derby", SqlServer2012Dialect.class);
        //达梦数据库,https://github.com/mybatis-book/book/issues/43
        registerDialectAlias("dm", OracleDialect.class);
    }</code></pre>
    <h3>
     三.解决方案
    </h3>
    <p>
     从注册的数据中可看出，人大金仓数据库并未注册，所以需要我们手动添加。以下为我的代码处理，由于人大金仓数据库为postgresql的山寨版，按照以上代码中postgresql的注册代码“
    </p>
    <pre>registerDialectAlias("postgresql", HsqldbDialect.class);</pre>
    <p>
     ”，将key值改为人大金仓，在springboot的config配置中，注册一下即可
    </p>
    <pre><code class="language-java">
@Configuration
public class MybatisDialectConfig {

    @Bean
    public void MyBatisDialectBean()
    {
        PageAutoDialect.registerDialectAlias("kingbase8", HsqldbDialect.class);
    }

}</code></pre>
    <p>
     注释掉配置文件中分页插件配置的“helperDialect”属性，可自动匹配数据库。
    </p>
    <p>
     <img alt="6b6a7b8d0a6d492496c1a69668a0aec0.png" src="https://i-blog.csdnimg.cn/blog_migrate/a4801df8d87b4723f31add09f26bd1d4.png"/>
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35343533333638362f:61727469636c652f64657461696c732f313330373631323434" class_="artid" style="display:none">
 </p>
</div>


