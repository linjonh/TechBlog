---
layout: post
title: "SSMä»å…¥é—¨åˆ°å®æˆ˜2.5-SQLæ˜ å°„æ–‡ä»¶ä¸åŠ¨æ€SQL"
date: 2025-08-22T14:00:00+0800
description: "æœ¬æ–‡æ˜¯MyBatisè¿›é˜¶ç¯‡ï¼Œé‡ç‚¹è®²è§£SQLæ˜ å°„æ–‡ä»¶ä¸åŠ¨æ€SQLçš„æ ¸å¿ƒæŠ€æœ¯ã€‚SQLæ˜ å°„æ–‡ä»¶æ˜¯MyBatisçš„æ ¸å¿ƒï¼ŒåŒ…å«mapperã€resultMapã€sqlã€selectç­‰ä¸»è¦å…ƒç´ ï¼Œå®šä¹‰äº†SQLä¸Javaå¯¹è±¡çš„æ˜ å°„å…³ç³»ã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†ç»“æœæ˜ å°„ï¼ˆResultMapï¼‰çš„é«˜çº§ç”¨æ³•ï¼ŒåŒ…æ‹¬åŸºç¡€æ˜ å°„ã€å¤æ‚ç±»å‹æ˜ å°„ã€ç»§æ‰¿æ˜ å°„å’Œè‡ªåŠ¨æ˜ å°„é…ç½®ã€‚åŠ¨æ€SQLéƒ¨åˆ†æ·±å…¥è§£æäº†ifã€chooseã€whereã€setã€foreachç­‰æ ‡ç­¾çš„ä½¿ç”¨æŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…ç¼–å†™çµæ´»é«˜æ•ˆçš„SQLè¯­å¥ã€‚é€šè¿‡ç¤ºä¾‹ä»£ç å’Œæœ€ä½³å®è·µï¼Œè¯»è€…å¯ä»¥æŒæ¡MyBatisä¸­"
keywords: "SSMä»å…¥é—¨åˆ°å®æˆ˜ï¼š2.5 SQLæ˜ å°„æ–‡ä»¶ä¸åŠ¨æ€SQL"
categories: ['Ssm']
tags: ['æ•°æ®åº“', 'åŠ¨æ€Sql', 'Sql', 'Sql']
artid: "150601485"
arturl: "https://blog.csdn.net/2403_87009791/article/details/150601485"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150601485
    alt: "SSMä»å…¥é—¨åˆ°å®æˆ˜2.5-SQLæ˜ å°„æ–‡ä»¶ä¸åŠ¨æ€SQL"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150601485
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150601485
cover: https://bing.ee123.net/img/rand?artid=150601485
image: https://bing.ee123.net/img/rand?artid=150601485
img: https://bing.ee123.net/img/rand?artid=150601485
---



# SSMä»å…¥é—¨åˆ°å®æˆ˜ï¼š2.5 SQLæ˜ å°„æ–‡ä»¶ä¸åŠ¨æ€SQL



ğŸ‘‹ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ `é˜¿é—®å­¦é•¿`ï¼ä¸“æ³¨äºåˆ†äº«ä¼˜è´¨`å¼€æºé¡¹ç›®`è§£æã€`æ¯•ä¸šè®¾è®¡é¡¹ç›®æŒ‡å¯¼`æ”¯æŒã€`å¹¼å°åˆé«˜`çš„`æ•™è¾…èµ„æ–™`æ¨èç­‰ï¼Œæ¬¢è¿å…³æ³¨äº¤æµï¼ğŸš€

## 12-SQLæ˜ å°„æ–‡ä»¶ä¸åŠ¨æ€SQL

### ğŸ“– æœ¬æ–‡æ¦‚è¿°

æœ¬æ–‡æ˜¯SSMæ¡†æ¶ç³»åˆ—MyBatisè¿›é˜¶ç¯‡çš„ç¬¬äºŒç¯‡ï¼Œå°†æ·±å…¥æ¢è®¨SQLæ˜ å°„æ–‡ä»¶çš„ç¼–å†™æŠ€å·§å’ŒåŠ¨æ€SQLçš„ä½¿ç”¨æ–¹æ³•ã€‚é€šè¿‡ä¸°å¯Œçš„ç¤ºä¾‹å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ©è¯»è€…æŒæ¡MyBatisä¸­æœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ã€‚

### ğŸ¯ å­¦ä¹ ç›®æ ‡

* æ·±å…¥ç†è§£SQLæ˜ å°„æ–‡ä»¶çš„ç»“æ„å’Œå…ƒç´ 
* æŒæ¡ç»“æœæ˜ å°„ï¼ˆResultMapï¼‰çš„é«˜çº§ç”¨æ³•
* å­¦ä¼šç¼–å†™å„ç§ç±»å‹çš„åŠ¨æ€SQL
* äº†è§£SQLç‰‡æ®µçš„å¤ç”¨æŠ€å·§
* æŒæ¡å¤æ‚æŸ¥è¯¢å’Œå…³è”æ˜ å°„çš„å®ç°

### 1. SQLæ˜ å°„æ–‡ä»¶æ¦‚è¿°

#### 1.1 æ˜ å°„æ–‡ä»¶çš„åŸºæœ¬ç»“æ„

SQLæ˜ å°„æ–‡ä»¶æ˜¯MyBatisçš„æ ¸å¿ƒï¼Œå®ƒå®šä¹‰äº†SQLè¯­å¥å’ŒJavaå¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- ç»“æœæ˜ å°„ -->
    <resultMap id="BaseResultMap" type="User">
        <!-- ä¸»é”®æ˜ å°„ -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <!-- æ™®é€šå­—æ®µæ˜ å°„ -->
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
    </resultMap>
    
    <!-- SQLç‰‡æ®µ -->
    <sql id="Base_Column_List">
        id, username, email, password, age, create_time, update_time
    </sql>
    
    <!-- æŸ¥è¯¢è¯­å¥ -->
    <select id="findById" parameterType="long" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM users
        WHERE id = #{id}
    </select>
    
    <!-- æ’å…¥è¯­å¥ -->
    <insert id="insert" parameterType="User">
        INSERT INTO users (username, email, password, age)
        VALUES (#{username}, #{email}, #{password}, #{age})
    </insert>
    
    <!-- æ›´æ–°è¯­å¥ -->
    <update id="update" parameterType="User">
        UPDATE users
        SET username = #{username}, email = #{email}
        WHERE id = #{id}
    </update>
    
    <!-- åˆ é™¤è¯­å¥ -->
    <delete id="deleteById" parameterType="long">
        DELETE FROM users WHERE id = #{id}
    </delete>
    
</mapper>

```

#### 1.2 æ˜ å°„æ–‡ä»¶çš„ä¸»è¦å…ƒç´ 

* **mapper**ï¼šæ ¹å…ƒç´ ï¼ŒåŒ…å«namespaceå±æ€§
* **resultMap**ï¼šç»“æœæ˜ å°„ï¼Œå®šä¹‰å¦‚ä½•å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°Javaå¯¹è±¡
* **sql**ï¼šå¯é‡ç”¨çš„SQLç‰‡æ®µ
* **select**ï¼šæŸ¥è¯¢è¯­å¥
* **insert**ï¼šæ’å…¥è¯­å¥
* **update**ï¼šæ›´æ–°è¯­å¥
* **delete**ï¼šåˆ é™¤è¯­å¥

### 2. ç»“æœæ˜ å°„ï¼ˆResultMapï¼‰è¯¦è§£

#### 2.1 åŸºç¡€ç»“æœæ˜ å°„

```xml
<!-- åŸºç¡€ç»“æœæ˜ å°„ -->
<resultMap id="UserResultMap" type="com.example.entity.User">
    <!-- idå…ƒç´ ï¼šä¸»é”®å­—æ®µæ˜ å°„ -->
    <id column="user_id" property="id" jdbcType="BIGINT"/>
    
    <!-- resultå…ƒç´ ï¼šæ™®é€šå­—æ®µæ˜ å°„ -->
    <result column="user_name" property="username" jdbcType="VARCHAR"/>
    <result column="user_email" property="email" jdbcType="VARCHAR"/>
    <result column="user_age" property="age" jdbcType="INTEGER"/>
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
</resultMap>

```

#### 2.2 å¤æ‚ç±»å‹æ˜ å°„

```xml
<!-- åŒ…å«å¤æ‚ç±»å‹çš„ç»“æœæ˜ å°„ -->
<resultMap id="UserWithProfileResultMap" type="User">
    <id column="id" property="id"/>
    <result column="username" property="username"/>
    <result column="email" property="email"/>
    
    <!-- associationï¼šä¸€å¯¹ä¸€å…³è”æ˜ å°„ -->
    <association property="profile" javaType="UserProfile">
        <id column="profile_id" property="id"/>
        <result column="real_name" property="realName"/>
        <result column="phone" property="phone"/>
        <result column="address" property="address"/>
    </association>
    
    <!-- collectionï¼šä¸€å¯¹å¤šå…³è”æ˜ å°„ -->
    <collection property="roles" ofType="Role">
        <id column="role_id" property="id"/>
        <result column="role_name" property="roleName"/>
        <result column="role_description" property="description"/>
    </collection>
</resultMap>

```

#### 2.3 ç»§æ‰¿ç»“æœæ˜ å°„

```xml
<!-- åŸºç¡€ç»“æœæ˜ å°„ -->
<resultMap id="BaseUserResultMap" type="User">
    <id column="id" property="id"/>
    <result column="username" property="username"/>
    <result column="email" property="email"/>
    <result column="create_time" property="createTime"/>
</resultMap>

<!-- ç»§æ‰¿åŸºç¡€æ˜ å°„å¹¶æ‰©å±• -->
<resultMap id="ExtendedUserResultMap" type="User" extends="BaseUserResultMap">
    <result column="last_login_time" property="lastLoginTime"/>
    <result column="login_count" property="loginCount"/>
    
    <!-- æ·»åŠ å…³è”æ˜ å°„ -->
    <association property="profile" javaType="UserProfile">
        <id column="profile_id" property="id"/>
        <result column="real_name" property="realName"/>
    </association>
</resultMap>

```

#### 2.4 è‡ªåŠ¨æ˜ å°„é…ç½®

```xml
<!-- å¼€å¯è‡ªåŠ¨æ˜ å°„ -->
<resultMap id="AutoMappingResultMap" type="User" autoMapping="true">
    <!-- åªéœ€è¦é…ç½®ç‰¹æ®Šçš„æ˜ å°„å…³ç³» -->
    <id column="user_id" property="id"/>
    <!-- å…¶ä»–å­—æ®µä¼šè‡ªåŠ¨æ˜ å°„ï¼ˆå¦‚æœå­—æ®µåå’Œå±æ€§ååŒ¹é…ï¼‰ -->
</resultMap>

```

### 3. åŠ¨æ€SQLè¯¦è§£

#### 3.1 ifæ ‡ç­¾

ifæ ‡ç­¾æ˜¯æœ€å¸¸ç”¨çš„åŠ¨æ€SQLæ ‡ç­¾ï¼Œç”¨äºæ¡ä»¶åˆ¤æ–­ã€‚

```xml
<!-- åŸºç¡€ifç”¨æ³• -->
<select id="findUsersByCondition" parameterType="User" resultMap="BaseResultMap">
    SELECT * FROM users
    WHERE 1=1
    <if test="username != null and username != ''">
        AND username = #{username}
    </if>
    <if test="email != null and email != ''">
        AND email = #{email}
    </if>
    <if test="age != null">
        AND age = #{age}
    </if>
    <if test="createTime != null">
        AND create_time >= #{createTime}
    </if>
</select>

<!-- å¤æ‚æ¡ä»¶åˆ¤æ–­ -->
<select id="findUsersWithComplexCondition" parameterType="map" resultMap="BaseResultMap">
    SELECT * FROM users
    WHERE 1=1
    <if test="keyword != null and keyword != ''">
        AND (username LIKE CONCAT('%', #{keyword}, '%') 
             OR email LIKE CONCAT('%', #{keyword}, '%'))
    </if>
    <if test="ageRange != null">
        <if test="ageRange.min != null">
            AND age >= #{ageRange.min}
        </if>
        <if test="ageRange.max != null">
            AND age <= #{ageRange.max}
        </if>
    </if>
    <if test="roles != null and roles.size() > 0">
        AND id IN (
            SELECT user_id FROM user_roles 
            WHERE role_id IN
            <foreach collection="roles" item="roleId" open="(" separator="," close=")">
                #{roleId}
            </foreach>
        )
    </if>
</select>

```

#### 3.2 whereæ ‡ç­¾

whereæ ‡ç­¾å¯ä»¥æ™ºèƒ½åœ°å¤„ç†WHEREå­å¥ï¼Œè‡ªåŠ¨å»é™¤å¤šä½™çš„ANDæˆ–ORã€‚

```xml
<select id="findUsersByConditionWithWhere" parameterType="User" resultMap="BaseResultMap">
    SELECT * FROM users
    <where>
        <if test="username != null and username != ''">
            AND username = #{username}
        </if>
        <if test="email != null and email != ''">
            AND email = #{email}
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
    </where>
    ORDER BY create_time DESC
</select>

```

#### 3.3 setæ ‡ç­¾

setæ ‡ç­¾ç”¨äºåŠ¨æ€æ›´æ–°è¯­å¥ï¼Œè‡ªåŠ¨å¤„ç†é€—å·åˆ†éš”ç¬¦ã€‚

```xml
<update id="updateUserSelective" parameterType="User">
    UPDATE users
    <set>
        <if test="username != null and username != ''">
            username = #{username},
        </if>
        <if test="email != null and email != ''">
            email = #{email},
        </if>
        <if test="password != null and password != ''">
            password = #{password},
        </if>
        <if test="age != null">
            age = #{age},
        </if>
        <if test="status != null">
            status = #{status},
        </if>
        update_time = CURRENT_TIMESTAMP
    </set>
    WHERE id = #{id}
</update>

```

#### 3.4 chooseã€whenã€otherwiseæ ‡ç­¾

ç±»ä¼¼äºJavaä¸­çš„switchè¯­å¥ï¼Œç”¨äºå¤šåˆ†æ”¯æ¡ä»¶åˆ¤æ–­ã€‚

```xml
<select id="findUsersByType" parameterType="map" resultMap="BaseResultMap">
    SELECT * FROM users
    WHERE 1=1
    <choose>
        <when test="type == 'active'">
            AND status = 'ACTIVE' AND last_login_time > DATE_SUB(NOW(), INTERVAL 30 DAY)
        </when>
        <when test="type == 'inactive'">
            AND status = 'ACTIVE' AND last_login_time <= DATE_SUB(NOW(), INTERVAL 30 DAY)
        </when>
        <when test="type == 'disabled'">
            AND status = 'DISABLED'
        </when>
        <otherwise>
            AND status = 'ACTIVE'
        </otherwise>
    </choose>
    <if test="orderBy != null">
        <choose>
            <when test="orderBy == 'username'">
                ORDER BY username
            </when>
            <when test="orderBy == 'createTime'">
                ORDER BY create_time DESC
            </when>
            <when test="orderBy == 'lastLogin'">
                ORDER BY last_login_time DESC
            </when>
            <otherwise>
                ORDER BY id
            </otherwise>
        </choose>
    </if>
</select>

```

#### 3.5 foreachæ ‡ç­¾

foreachæ ‡ç­¾ç”¨äºéå†é›†åˆï¼Œå¸¸ç”¨äºINæŸ¥è¯¢å’Œæ‰¹é‡æ“ä½œã€‚

```xml
<!-- INæŸ¥è¯¢ -->
<select id="findUsersByIds" parameterType="list" resultMap="BaseResultMap">
    SELECT * FROM users
    WHERE id IN
    <foreach collection="list" item="id" open="(" separator="," close=")">
        #{id}
    </foreach>
</select>

<!-- æ‰¹é‡æ’å…¥ -->
<insert id="batchInsertUsers" parameterType="list">
    INSERT INTO users (username, email, password, age)
    VALUES
    <foreach collection="list" item="user" separator=",">
        (#{user.username}, #{user.email}, #{user.password}, #{user.age})
    </foreach>
</insert>

<!-- æ‰¹é‡æ›´æ–°ï¼ˆMySQLç‰¹æœ‰è¯­æ³•ï¼‰ -->
<update id="batchUpdateUsers" parameterType="list">
    <foreach collection="list" item="user" separator=";">
        UPDATE users
        SET username = #{user.username}, email = #{user.email}
        WHERE id = #{user.id}
    </foreach>
</update>

<!-- å¤æ‚çš„foreachç”¨æ³• -->
<select id="findUsersByMultipleConditions" parameterType="map" resultMap="BaseResultMap">
    SELECT * FROM users
    WHERE 1=1
    <if test="userIds != null and userIds.size() > 0">
        AND id IN
        <foreach collection="userIds" item="userId" open="(" separator="," close=")">
            #{userId}
        </foreach>
    </if>
    <if test="conditions != null and conditions.size() > 0">
        AND (
        <foreach collection="conditions" item="condition" separator=" OR ">
            (username LIKE CONCAT('%', #{condition.keyword}, '%') 
             AND age BETWEEN #{condition.minAge} AND #{condition.maxAge})
        </foreach>
        )
    </if>
</select>

```

#### 3.6 trimæ ‡ç­¾

trimæ ‡ç­¾æ˜¯æ›´é€šç”¨çš„æ ‡ç­¾ï¼Œå¯ä»¥è‡ªå®šä¹‰å‰ç¼€ã€åç¼€å’Œåˆ†éš”ç¬¦çš„å¤„ç†ã€‚

```xml
<!-- ä½¿ç”¨trimå®ç°whereåŠŸèƒ½ -->
<select id="findUsersWithTrim" parameterType="User" resultMap="BaseResultMap">
    SELECT * FROM users
    <trim prefix="WHERE" prefixOverrides="AND |OR ">
        <if test="username != null">
            AND username = #{username}
        </if>
        <if test="email != null">
            AND email = #{email}
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
    </trim>
</select>

<!-- ä½¿ç”¨trimå®ç°setåŠŸèƒ½ -->
<update id="updateUserWithTrim" parameterType="User">
    UPDATE users
    <trim prefix="SET" suffixOverrides=",">
        <if test="username != null">
            username = #{username},
        </if>
        <if test="email != null">
            email = #{email},
        </if>
        <if test="age != null">
            age = #{age},
        </if>
    </trim>
    WHERE id = #{id}
</update>

<!-- å¤æ‚çš„trimç”¨æ³• -->
<insert id="insertUserWithTrim" parameterType="User">
    INSERT INTO users
    <trim prefix="(" suffix=")" suffixOverrides=",">
        <if test="username != null">
            username,
        </if>
        <if test="email != null">
            email,
        </if>
        <if test="password != null">
            password,
        </if>
        <if test="age != null">
            age,
        </if>
    </trim>
    <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
        <if test="username != null">
            #{username},
        </if>
        <if test="email != null">
            #{email},
        </if>
        <if test="password != null">
            #{password},
        </if>
        <if test="age != null">
            #{age},
        </if>
    </trim>
</insert>

```

### 4. SQLç‰‡æ®µå¤ç”¨

#### 4.1 åŸºç¡€SQLç‰‡æ®µ

```xml
<!-- å®šä¹‰å¯é‡ç”¨çš„SQLç‰‡æ®µ -->
<sql id="Base_Column_List">
    id, username, email, password, age, create_time, update_time
</sql>

<sql id="User_Where_Clause">
    <where>
        <if test="username != null and username != ''">
            AND username = #{username}
        </if>
        <if test="email != null and email != ''">
            AND email = #{email}
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
    </where>
</sql>

<!-- ä½¿ç”¨SQLç‰‡æ®µ -->
<select id="findUsers" parameterType="User" resultMap="BaseResultMap">
    SELECT <include refid="Base_Column_List"/>
    FROM users
    <include refid="User_Where_Clause"/>
    ORDER BY create_time DESC
</select>

<select id="countUsers" parameterType="User" resultType="long">
    SELECT COUNT(*)
    FROM users
    <include refid="User_Where_Clause"/>
</select>

```

#### 4.2 å¸¦å‚æ•°çš„SQLç‰‡æ®µ

```xml
<!-- å¸¦å‚æ•°çš„SQLç‰‡æ®µ -->
<sql id="orderByClause">
    <if test="${orderBy} != null and ${orderBy} != ''">
        ORDER BY ${orderBy}
        <if test="${orderDirection} != null and ${orderDirection} != ''">
            ${orderDirection}
        </if>
    </if>
</sql>

<!-- ä½¿ç”¨å¸¦å‚æ•°çš„SQLç‰‡æ®µ -->
<select id="findUsersWithOrder" parameterType="map" resultMap="BaseResultMap">
    SELECT <include refid="Base_Column_List"/>
    FROM users
    <include refid="User_Where_Clause"/>
    <include refid="orderByClause">
        <property name="orderBy" value="orderBy"/>
        <property name="orderDirection" value="orderDirection"/>
    </include>
</select>

```

#### 4.3 å¤æ‚SQLç‰‡æ®µç»„åˆ

```xml
<!-- åˆ†é¡µæŸ¥è¯¢ç‰‡æ®µ -->
<sql id="limitClause">
    <if test="offset != null and limit != null">
        LIMIT #{offset}, #{limit}
    </if>
</sql>

<!-- è¿æ¥æŸ¥è¯¢ç‰‡æ®µ -->
<sql id="userRoleJoin">
    LEFT JOIN user_roles ur ON u.id = ur.user_id
    LEFT JOIN roles r ON ur.role_id = r.id
</sql>

<!-- å¤æ‚æŸ¥è¯¢ç»„åˆ -->
<select id="findUsersWithRolesAndPaging" parameterType="map" resultMap="UserWithRolesResultMap">
    SELECT 
        u.id, u.username, u.email, u.create_time,
        r.id as role_id, r.role_name, r.description as role_description
    FROM users u
    <include refid="userRoleJoin"/>
    <where>
        <if test="username != null and username != ''">
            AND u.username LIKE CONCAT('%', #{username}, '%')
        </if>
        <if test="roleName != null and roleName != ''">
            AND r.role_name = #{roleName}
        </if>
        <if test="startDate != null">
            AND u.create_time >= #{startDate}
        </if>
        <if test="endDate != null">
            AND u.create_time <= #{endDate}
        </if>
    </where>
    ORDER BY u.create_time DESC
    <include refid="limitClause"/>
</select>

```

### 5. é«˜çº§æ˜ å°„æŠ€å·§

#### 5.1 åµŒå¥—æŸ¥è¯¢

```xml
<!-- ç”¨æˆ·ç»“æœæ˜ å°„ï¼ŒåŒ…å«å»¶è¿ŸåŠ è½½çš„è§’è‰²ä¿¡æ¯ -->
<resultMap id="UserWithLazyRolesResultMap" type="User">
    <id column="id" property="id"/>
    <result column="username" property="username"/>
    <result column="email" property="email"/>
    
    <!-- åµŒå¥—æŸ¥è¯¢ï¼Œå»¶è¿ŸåŠ è½½è§’è‰²ä¿¡æ¯ -->
    <collection property="roles" 
                ofType="Role" 
                select="findRolesByUserId" 
                column="id"
                fetchType="lazy"/>
</resultMap>

<!-- æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰² -->
<select id="findRolesByUserId" parameterType="long" resultType="Role">
    SELECT r.id, r.role_name as roleName, r.description
    FROM roles r
    INNER JOIN user_roles ur ON r.id = ur.role_id
    WHERE ur.user_id = #{userId}
</select>

<!-- æŸ¥è¯¢ç”¨æˆ·ï¼ˆè§’è‰²ä¿¡æ¯ä¼šå»¶è¿ŸåŠ è½½ï¼‰ -->
<select id="findUserWithLazyRoles" parameterType="long" resultMap="UserWithLazyRolesResultMap">
    SELECT id, username, email, create_time
    FROM users
    WHERE id = #{id}
</select>

```

#### 5.2 åµŒå¥—ç»“æœæ˜ å°„

```xml
<!-- åµŒå¥—ç»“æœæ˜ å°„ï¼Œä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰æ•°æ® -->
<resultMap id="UserWithRolesNestedResultMap" type="User">
    <id column="user_id" property="id"/>
    <result column="username" property="username"/>
    <result column="email" property="email"/>
    <result column="create_time" property="createTime"/>
    
    <!-- åµŒå¥—ç»“æœæ˜ å°„ -->
    <collection property="roles" ofType="Role">
        <id column="role_id" property="id"/>
        <result column="role_name" property="roleName"/>
        <result column="role_description" property="description"/>
        <result column="role_create_time" property="createTime"/>
    </collection>
</resultMap>

<!-- ä¸€æ¬¡æŸ¥è¯¢è·å–ç”¨æˆ·å’Œè§’è‰²ä¿¡æ¯ -->
<select id="findUserWithRolesNested" parameterType="long" resultMap="UserWithRolesNestedResultMap">
    SELECT 
        u.id as user_id,
        u.username,
        u.email,
        u.create_time,
        r.id as role_id,
        r.role_name,
        r.description as role_description,
        r.create_time as role_create_time
    FROM users u
    LEFT JOIN user_roles ur ON u.id = ur.user_id
    LEFT JOIN roles r ON ur.role_id = r.id
    WHERE u.id = #{id}
</select>

```

### 6. å°ç»“

æœ¬æ–‡æ·±å…¥ä»‹ç»äº†MyBatis SQLæ˜ å°„æ–‡ä»¶å’ŒåŠ¨æ€SQLçš„æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **ç»“æœæ˜ å°„**ï¼šåŸºç¡€æ˜ å°„ã€å¤æ‚ç±»å‹æ˜ å°„ã€ç»§æ‰¿æ˜ å°„
2. **åŠ¨æ€SQLæ ‡ç­¾**ï¼šifã€whereã€setã€chooseã€foreachã€trim
3. **SQLç‰‡æ®µå¤ç”¨**ï¼šæé«˜ä»£ç å¤ç”¨æ€§å’Œç»´æŠ¤æ€§
4. **é«˜çº§æ˜ å°„**ï¼šåµŒå¥—æŸ¥è¯¢å’ŒåµŒå¥—ç»“æœæ˜ å°„

æŒæ¡è¿™äº›æŠ€èƒ½å¯ä»¥ï¼š

* ç¼–å†™çµæ´»çš„åŠ¨æ€SQLè¯­å¥
* å¤„ç†å¤æ‚çš„æŸ¥è¯¢éœ€æ±‚
* ä¼˜åŒ–SQLæ€§èƒ½å’Œä»£ç ç»“æ„
* å®ç°é«˜æ•ˆçš„å¯¹è±¡å…³ç³»æ˜ å°„

### ğŸ”— ä¸‹ä¸€ç¯‡é¢„å‘Š

ä¸‹ä¸€ç¯‡æ–‡ç« å°†æ¢è®¨**MyBatisç¼“å­˜æœºåˆ¶ä¸æ€§èƒ½ä¼˜åŒ–**ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨MyBatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜æ¥æå‡åº”ç”¨æ€§èƒ½ã€‚

---

**ç›¸å…³æ–‡ç« ï¼š**

* [ä¸Šä¸€ç¯‡ï¼šMyBatisé…ç½®æ–‡ä»¶è¯¦è§£](./MyBatis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3.md)
* [ä¸‹ä¸€ç¯‡ï¼šMyBatisç¼“å­˜æœºåˆ¶ä¸æ€§èƒ½ä¼˜åŒ–](./MyBatis%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E4%B8%8E%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.md)
* [è¿”å›ç›®å½•](../../README.md)



