---
layout: post
title: "Docker-commit-å‘½ä»¤å®¹å™¨å¿«ç…§çš„è‰ºæœ¯"
date: 2025-08-12T11:30:00+0800
description: "Docker commitå‘½ä»¤ï¼šå¿«é€Ÿåˆ›å»ºå®¹å™¨å¿«ç…§æŒ‡å— Docker commitå‘½ä»¤æ˜¯ä¿å­˜å®¹å™¨å½“å‰çŠ¶æ€ä¸ºé•œåƒçš„æœ‰æ•ˆå·¥å…·ï¼Œé€‚åˆå¿«é€Ÿåˆ›å»ºè‡ªå®šä¹‰é•œåƒã€‚"
keywords: "Docker commit å‘½ä»¤ï¼šå®¹å™¨å¿«ç…§çš„è‰ºæœ¯"
categories: ['ä»å…¥é—¨åˆ°ç²¾é€š', 'Docker']
tags: ['è¿ç»´', 'æœåŠ¡å™¨', 'å®¹å™¨', 'äº‘åŸç”Ÿ', 'Docker']
artid: "149044082"
arturl: "https://blog.csdn.net/qq_41840843/article/details/149044082"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=149044082
    alt: "Docker-commit-å‘½ä»¤å®¹å™¨å¿«ç…§çš„è‰ºæœ¯"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=149044082
featuredImagePreview: https://bing.ee123.net/img/rand?artid=149044082
cover: https://bing.ee123.net/img/rand?artid=149044082
image: https://bing.ee123.net/img/rand?artid=149044082
img: https://bing.ee123.net/img/rand?artid=149044082
---



# Docker commit å‘½ä»¤ï¼šå®¹å™¨å¿«ç…§çš„è‰ºæœ¯



|  |
| --- |
| *ğŸŒºThe BeginğŸŒºç‚¹ç‚¹å…³æ³¨ï¼Œæ”¶è—ä¸è¿·è·¯ğŸŒº* |

### 1. å‘½ä»¤æ¦‚è¿°

`docker commit` æ˜¯ Docker ä¸­ç”¨äºå°†**è¿è¡Œä¸­æˆ–å·²åœæ­¢çš„å®¹å™¨çŠ¶æ€**æŒä¹…åŒ–ä¸ºæ–°é•œåƒçš„å‘½ä»¤ã€‚å®ƒç›¸å½“äºä¸ºå®¹å™¨å½“å‰çŠ¶æ€æ‹æ‘„ä¸€å¼ "å¿«ç…§"ï¼Œæ˜¯å¿«é€Ÿåˆ›å»ºè‡ªå®šä¹‰é•œåƒçš„æœ‰æ•ˆæ–¹å¼ã€‚

### 2. å‘½ä»¤è¯­æ³•

```bash
docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]

```

### 3. æ ¸å¿ƒå‚æ•°è¯¦è§£

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/73ff82c0daad455b81e16c453974efab.png#pic_center)

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
| --- | --- | --- |
| `-a`, `--author` | æŒ‡å®šé•œåƒä½œè€… | `-a "devops@company.com"` |
| `-m`, `--message` | æ·»åŠ æäº¤ä¿¡æ¯ | `-m "æ·»åŠ äº†NginxæœåŠ¡"` |
| `-c`, `--change` | åº”ç”¨DockerfileæŒ‡ä»¤ | `--change "ENV DEBUG=true"` |
| `-p`, `--pause` | æäº¤æ—¶æš‚åœå®¹å™¨(é»˜è®¤true) | `--pause=false` |

### 4. æ¶æ„ä¸æ•°æ®æµ

å®¹å™¨çŠ¶æ€

























































1. æš‚åœ--å¯é€‰






2. åˆ›å»ºé•œåƒå±‚






3. ç”Ÿæˆé•œåƒ






4. å­˜å‚¨








æ–‡ä»¶ç³»ç»Ÿå˜æ›´







é…ç½®å˜æ›´







è¿è¡Œä¸­çš„å®¹å™¨







commitæ“ä½œ







æ–°é•œåƒå±‚







æ–°é•œåƒ







é•œåƒä»“åº“

### 5. å®Œæ•´å·¥ä½œæµç¨‹

User






Docker_Engine






Container






Image_Store






















docker commit -a "dev" -m "update" container_id


æš‚åœå®¹å™¨(å¯é€‰)


æ•è·æ–‡ä»¶ç³»ç»Ÿå¿«ç…§


åº”ç”¨--changeæŒ‡ä»¤


åˆ›å»ºæ–°é•œåƒå±‚


æ¢å¤å®¹å™¨(å¦‚æš‚åœ)


è¿”å›æ–°é•œåƒID





User




Docker_Engine




Container




Image_Store

### 6. å®æˆ˜æ¡ˆä¾‹é›†

#### 6.1 åŸºç¡€æäº¤ç¤ºä¾‹

```bash
# å¯åŠ¨ä¸´æ—¶å®¹å™¨
docker run -it --name temp_cont ubuntu bash

# åœ¨å®¹å™¨å†…å®‰è£…è½¯ä»¶
apt-get update && apt-get install -y curl

# æäº¤ä¸ºæ–°é•œåƒ
docker commit \
  -a "Dev Team" \
  -m "Added curl tool" \
  temp_cont \
  my_ubuntu:curl-v1

```

#### 6.2 é«˜çº§æäº¤ç¤ºä¾‹

```bash
# æäº¤æ—¶æ·»åŠ ç¯å¢ƒå˜é‡å’Œæ ‡ç­¾
docker commit \
  --change "ENV APP_VERSION=1.0" \
  --change "LABEL maintainer=devops" \
  --pause=false \
  running_app \
  company/app:1.0

```

#### 6.3 æ‰¹é‡æäº¤è„šæœ¬

```bash
#!/bin/bash
# æ‰¹é‡æäº¤æ‰€æœ‰å·²ä¿®æ”¹çš„å®¹å™¨
for cont in $(docker ps -aq); do
  name=$(docker inspect -f '{{.Name}}' $cont | sed 's/\///')
  if [ $(docker diff $cont | wc -l) -gt 0 ]; then
    echo "æäº¤å®¹å™¨: $name"
    docker commit -m "è‡ªåŠ¨æäº¤ $(date)" $cont ${name}_snapshot
  fi
done

```

### 7. ä¸Dockerfileå¯¹æ¯”

ä¼˜ç‚¹






ä¼˜ç‚¹






ç¼ºç‚¹






ç¼ºç‚¹






ä¼˜ç‚¹






ä¼˜ç‚¹






ç¼ºç‚¹








commit







å¿«é€Ÿåˆ›å»º







ä¿å­˜å½“å‰çŠ¶æ€







ä¸é€æ˜







éš¾ä»¥ç‰ˆæœ¬æ§åˆ¶







Dockerfile







å¯é‡å¤







å¯å®¡è®¡







éœ€è¦é‡å»º

**æœ€ä½³å®è·µå»ºè®®**ï¼š

* å¼€å‘è°ƒè¯•é˜¶æ®µå¯ä½¿ç”¨`commit`å¿«é€Ÿä¿å­˜çŠ¶æ€
* ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨`Dockerfile`æ„å»ºé•œåƒ
* é‡è¦å˜æ›´åº”åŒæ—¶æ›´æ–°Dockerfile

### 8. é•œåƒå±‚çº§åˆ†æ

```bash
# æŸ¥çœ‹é•œåƒå†å²
docker history my_custom_image

# è¾“å‡ºç¤ºä¾‹
IMAGE          CREATED         CREATED BY                                      SIZE
a1b2c3d4e5f6   2 minutes ago   bash                                            125MB
<missing>      2 weeks ago     /bin/sh -c #(nop)  CMD ["bash"]                 0B
<missing>      2 weeks ago     /bin/sh -c #(nop) ADD file:abc123...in /       72.8MB

```

### 9. ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

1. **å®‰å…¨é£é™©**ï¼š

   * æäº¤çš„é•œåƒå¯èƒ½åŒ…å«æ•æ„Ÿæ•°æ®
   * å»ºè®®æäº¤å‰æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶

   ```bash
   docker exec my_container apt-get clean
   docker commit my_container clean_image

   ```
2. **å­˜å‚¨ä¼˜åŒ–**ï¼š

   * ä½¿ç”¨`--change "WORKDIR /app"`è§„èŒƒå·¥ä½œç›®å½•
   * åˆå¹¶å¤šä¸ªå˜æ›´åä¸€æ¬¡æ€§æäº¤
3. **ç‰ˆæœ¬æ§åˆ¶**ï¼š

   1.0-base







   1.1-featureA







   1.2-featureB







   1.3-production

### 10. å¸¸è§é—®é¢˜æ’æŸ¥

#### 10.1 æäº¤å¤±è´¥åˆ†æ

æ˜¯






å¦






æ˜¯






å¦






å¦








æäº¤å¤±è´¥







å®¹å™¨æ˜¯å¦å­˜åœ¨







å­˜å‚¨ç©ºé—´æ˜¯å¦è¶³å¤Ÿ







å®¹å™¨å·²åˆ é™¤







æƒé™æ˜¯å¦è¶³å¤Ÿ







æ¸…ç†ç£ç›˜ç©ºé—´







ä½¿ç”¨sudo

#### 10.2 é•œåƒè¿‡å¤§å¤„ç†

```bash
# 1. åˆ†æå¤§æ–‡ä»¶
docker run -it --rm my_image du -h --max-depth=1 /

# 2. ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
docker commit \
  --change "RUN rm -rf /var/lib/apt/lists/*" \
  large_container \
  optimized_image

```

### 11. é«˜çº§åº”ç”¨åœºæ™¯

#### 11.1 ç¾éš¾æ¢å¤å¿«ç…§

```bash
# å…³é”®æœåŠ¡å®šæœŸå¿«ç…§
0 * * * * docker commit -m "æ¯å°æ—¶å¿«ç…§ $(date)" prod_db db_snapshot:$(date +%Y%m%d-%H%M)

```

#### 11.2 å¼€å‘ç¯å¢ƒä¿å­˜

commit












commit








å¼€å‘å®¹å™¨







å¿«ç…§v1







ä¿®æ”¹ä»£ç 







å¿«ç…§v2







å‡ºç°é—®é¢˜å›æ»š







ç»§ç»­å¼€å‘

#### 11.3 æ•™å­¦æ¼”ç¤º

```bash
# æ¼”ç¤ºå‰å‡†å¤‡å¹²å‡€ç¯å¢ƒ
docker run -it --name demo python:3.9

# æ¼”ç¤ºè¿‡ç¨‹ä¸­åˆ†æ­¥æäº¤
docker commit -m "å®‰è£…ä¾èµ–" demo demo:step1
docker commit -m "æ·»åŠ æºç " demo demo:step2

```

### 12. æ€»ç»“

`docker commit` çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

1. **å¿«é€Ÿä¿å­˜**ï¼šå³æ—¶ä¿å­˜å®¹å™¨å½“å‰çŠ¶æ€
2. **çµæ´»åˆ›å»º**ï¼šæ”¯æŒæ·»åŠ å…ƒæ•°æ®å’Œä¿®æ”¹é…ç½®
3. **å¼€å‘å‹å¥½**ï¼šé€‚åˆè°ƒè¯•å’Œå®éªŒæ€§å·¥ä½œ

**æœ€ä½³å®è·µå»ºè®®**ï¼š

* ä¸ºæ¯ä¸ªæäº¤æ·»åŠ æœ‰æ„ä¹‰çš„æ³¨é‡Š
* é…åˆæ ‡ç­¾(tag)è¿›è¡Œç‰ˆæœ¬ç®¡ç†
* å®šæœŸæ¸…ç†ä¸å¿…è¦çš„ä¸´æ—¶é•œåƒ
* é‡è¦ç¯å¢ƒå˜æ›´åº”è®°å½•åˆ°Dockerfile

è®°ä½ï¼š`docker commit` è™½æ–¹ä¾¿ï¼Œä½†ä¸åº”å®Œå…¨æ›¿ä»£Dockerfileã€‚ä¸¤è€…ç»“åˆä½¿ç”¨ï¼Œæ‰èƒ½å®ç°é«˜æ•ˆçš„å®¹å™¨é•œåƒç®¡ç†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/2d66846c0fbf4e1181e67009633c918c.png#pic_center)

  

|  |
| --- |
| *ğŸŒºThe EndğŸŒºç‚¹ç‚¹å…³æ³¨ï¼Œæ”¶è—ä¸è¿·è·¯ğŸŒº* |



