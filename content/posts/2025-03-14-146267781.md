---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35393334343132372f:61727469636c652f64657461696c732f313436323637373831"
layout: post
title: "åç«¯djangoæŠ›å¼ƒ-Django-è‡ªå¸¦ç”¨æˆ·ç®¡ç†å,èƒ½å¦ä½¿ç”¨-simple-jwt"
date: 2025-03-14 21:32:44 +0800
description: "å¦‚æœå®Œå…¨æŠ›å¼ƒ Django ç”¨æˆ·ç®¡ç†ï¼Œä½ å¯ä»¥ã€‚Django çš„ç”¨æˆ·ç®¡ç†ï¼ˆå¦‚ä¸ç»§æ‰¿ã€‚ï¼‰æ¥è¿›è¡Œ JWT è®¤è¯ã€‚å¦‚æœä½ ä¸ä½¿ç”¨ Django é»˜è®¤çš„ã€‚èƒ½è¯†åˆ«å’Œå¤„ç†ä½ çš„è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ã€‚é»˜è®¤ä½¿ç”¨ Django è‡ªå¸¦çš„ã€‚ç”±äº Django é»˜è®¤çš„ã€‚"
keywords: "ã€åç«¯ã€‘ã€djangoã€‘æŠ›å¼ƒ Django è‡ªå¸¦ç”¨æˆ·ç®¡ç†åï¼Œèƒ½å¦ä½¿ç”¨ `simple-jwt`ï¼Ÿ"
categories: ['Django']
tags: ['æ•°æ®åº“', 'Sqlite', 'Django']
artid: "146267781"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146267781
    alt: "åç«¯djangoæŠ›å¼ƒ-Django-è‡ªå¸¦ç”¨æˆ·ç®¡ç†å,èƒ½å¦ä½¿ç”¨-simple-jwt"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146267781
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146267781
cover: https://bing.ee123.net/img/rand?artid=146267781
image: https://bing.ee123.net/img/rand?artid=146267781
img: https://bing.ee123.net/img/rand?artid=146267781
---

# ã€åç«¯ã€‘ã€djangoã€‘æŠ›å¼ƒ Django è‡ªå¸¦ç”¨æˆ·ç®¡ç†åï¼Œèƒ½å¦ä½¿ç”¨ `simple-jwt`ï¼Ÿ

### **æŠ›å¼ƒ Django è‡ªå¸¦ç”¨æˆ·ç®¡ç†åï¼Œèƒ½å¦ä½¿ç”¨ `simple-jwt` ï¼Ÿ**

#### **ä¸€ã€ç»“è®º**

æ˜¯çš„ï¼Œ
**å³ä½¿æŠ›å¼ƒäº† Django è‡ªå¸¦çš„ç”¨æˆ·ç®¡ç†**
ï¼ˆ
`AbstractUser`
æˆ–
`AbstractBaseUser`
ï¼‰ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨
`django-rest-framework-simplejwt`
ï¼ˆç®€ç§°
`simple-jwt`
ï¼‰æ¥è¿›è¡Œ JWT è®¤è¯ã€‚ä½†éœ€è¦è¿›è¡Œ
**é¢å¤–é…ç½®**
ï¼Œç¡®ä¿
`simple-jwt`
èƒ½è¯†åˆ«å’Œå¤„ç†ä½ çš„è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ã€‚

---

#### **äºŒã€Django ç”¨æˆ·ç®¡ç†çš„ä½œç”¨**

Django è‡ªå¸¦çš„ç”¨æˆ·ç®¡ç†æä¾›ï¼š

1. **`AbstractUser`
   /
   `AbstractBaseUser`**
   ä½œä¸ºé»˜è®¤ç”¨æˆ·æ¨¡å‹ã€‚
2. **`django.contrib.auth`
   è®¤è¯ç³»ç»Ÿ**
   ï¼Œå¦‚
   `authenticate()`
   ã€
   `login()`
   ã€
   `logout()`
   ã€‚
3. **é»˜è®¤çš„
   `User`
   æ¨¡å‹**
   ï¼Œç”¨äºç®¡ç†æƒé™ã€ç»„ç­‰ã€‚

å¦‚æœä½ 
**å®Œå…¨æŠ›å¼ƒ**
Django çš„ç”¨æˆ·ç®¡ç†ï¼ˆå¦‚ä¸ç»§æ‰¿
`AbstractUser`
ï¼‰ï¼Œä½ éœ€è¦ï¼š

* **è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹**
* **è‡ªå®šä¹‰
  `simple-jwt`
  çš„ç”¨æˆ·è§£æé€»è¾‘**
* **æ‰‹åŠ¨å®ç°
  `authenticate()`
  é€»è¾‘**

---

#### **ä¸‰ã€å¦‚ä½•è‡ªå®šä¹‰ JWT è®¤è¯**

##### **1. å®‰è£… `djangorestframework-simplejwt`**

```bash
pip install djangorestframework-simplejwt

```

##### **2. åœ¨ `settings.py` è¿›è¡ŒåŸºç¡€é…ç½®**

```python
INSTALLED_APPS += ["rest_framework_simplejwt"]

REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": (
        "rest_framework_simplejwt.authentication.JWTAuthentication",
    )
}

```

##### **3. è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹**

å¦‚æœä½ ä¸ä½¿ç”¨ Django é»˜è®¤çš„
`User`
ï¼Œå¯ä»¥åˆ›å»ºè‡ªå·±çš„
`CustomUser`
æ¨¡å‹ï¼š

```python
from django.db import models

class CustomUser(models.Model):
    id = models.AutoField(primary_key=True)
    username = models.CharField(max_length=255, unique=True)
    email = models.EmailField(unique=True)
    password = models.CharField(max_length=255)
    is_active = models.BooleanField(default=True)

    def __str__(self):
        return self.username

```

##### **4. è‡ªå®šä¹‰ `get_user_model()`**

ç”±äº Django é»˜è®¤çš„
`get_user_model()`
ä¾èµ–
`AbstractUser`
ï¼Œå¦‚æœå®Œå…¨æŠ›å¼ƒ Django ç”¨æˆ·ç®¡ç†ï¼Œä½ å¯ä»¥
**æ‰‹åŠ¨æŒ‡å®šç”¨æˆ·æ¨¡å‹**
ï¼š

```python
from myapp.models import CustomUser

def get_custom_user(identifier):
    """æ”¯æŒä½¿ç”¨ç”¨æˆ·åæˆ–é‚®ç®±è·å–ç”¨æˆ·"""
    try:
        return CustomUser.objects.get(username=identifier)
    except CustomUser.DoesNotExist:
        try:
            return CustomUser.objects.get(email=identifier)
        except CustomUser.DoesNotExist:
            return None

```

##### **5. è‡ªå®šä¹‰ `JWTAuthentication`**

å› ä¸º
`simple-jwt`
é»˜è®¤ä½¿ç”¨ Django è‡ªå¸¦çš„
`User`
ï¼Œä½ éœ€è¦è‡ªå®šä¹‰
`JWTAuthentication`
æ¥é€‚é…
`CustomUser`
ï¼š

```python
from rest_framework_simplejwt.authentication import JWTAuthentication

class CustomJWTAuthentication(JWTAuthentication):
    def get_user(self, validated_token):
        try:
            user_id = validated_token.get("user_id")
            return CustomUser.objects.get(id=user_id)
        except CustomUser.DoesNotExist:
            return None

```

ç„¶ååœ¨
`settings.py`
æ›¿æ¢
`DEFAULT_AUTHENTICATION_CLASSES`
ï¼š

```python
REST_FRAMEWORK = {
    "DEFAULT_AUTHENTICATION_CLASSES": (
        "path.to.CustomJWTAuthentication",
    )
}

```

##### **6. è‡ªå®šä¹‰ Token ç”Ÿæˆè§†å›¾**

ç”±äº
`simple-jwt`
é»˜è®¤ä½¿ç”¨
`User`
è¿›è¡Œè®¤è¯ï¼Œä½ éœ€è¦
**è‡ªå®šä¹‰ Token ç”Ÿæˆé€»è¾‘**
ï¼š

```python
from rest_framework_simplejwt.views import TokenObtainPairView
from rest_framework_simplejwt.serializers import TokenObtainPairSerializer
from django.contrib.auth.hashers import check_password

class CustomTokenObtainPairSerializer(TokenObtainPairSerializer):
    def validate(self, attrs):
        username = attrs.get("username")
        password = attrs.get("password")

        user = get_custom_user(username)
        if not user or not check_password(password, user.password):
            raise serializers.ValidationError("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")

        data = super().validate(attrs)
        return data

class CustomTokenObtainPairView(TokenObtainPairView):
    serializer_class = CustomTokenObtainPairSerializer

```

ç„¶ååœ¨
`urls.py`
é‡Œæ³¨å†Œï¼š

```python
from django.urls import path
from path.to.views import CustomTokenObtainPairView
from rest_framework_simplejwt.views import TokenRefreshView

urlpatterns = [
    path("api/token/", CustomTokenObtainPairView.as_view(), name="token_obtain_pair"),
    path("api/token/refresh/", TokenRefreshView.as_view(), name="token_refresh"),
]

```

---

#### **å››ã€æ€»ç»“**

| æ–¹æ¡ˆ | éœ€è¦ä¿®æ”¹ |
| --- | --- |
| ç›´æ¥ä½¿ç”¨ Django `User` | **æ— éœ€ä¿®æ”¹ï¼Œé»˜è®¤æ”¯æŒ `simple-jwt`** |
| ç»§æ‰¿ `AbstractUser` | **æ”¯æŒ `simple-jwt` ï¼Œåªéœ€ `settings.AUTH_USER_MODEL`** |
| **å®Œå…¨è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹** | **éœ€è¦æ‰‹åŠ¨é€‚é… `JWTAuthentication` ï¼Œé‡å†™ `TokenObtainPairSerializer`** |

##### **æ¨èæ–¹æ¡ˆ**

* **å¦‚æœåªæ˜¯è°ƒæ•´
  `User`
  å­—æ®µï¼Œå»ºè®®ç»§æ‰¿
  `AbstractUser`
  ï¼Œè¿™æ ·
  `simple-jwt`
  ä»ç„¶å¯ç”¨**
* **å¦‚æœå®Œå…¨è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ï¼Œå¿…é¡»æ‰‹åŠ¨é€‚é…
  `simple-jwt`**

æ€»ä¹‹ï¼Œ
**æŠ›å¼ƒ Django çš„
`User`
ä»ç„¶å¯ä»¥ä½¿ç”¨
`simple-jwt`
ï¼Œä½†éœ€è¦é¢å¤–å¼€å‘
`JWTAuthentication`
é€»è¾‘**
ã€‚ğŸš€