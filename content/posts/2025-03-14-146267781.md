---
layout: post
title: "后端django抛弃-Django-自带用户管理后,能否使用-simple-jwt"
date: 2025-03-14 21:32:44 +0800
description: "如果完全抛弃 Django 用户管理，你可以。Django 的用户管理（如不继承。）来进行 JWT 认证。如果你不使用 Django 默认的。能识别和处理你的自定义用户模型。默认使用 Django 自带的。由于 Django 默认的。"
keywords: "【后端】【django】抛弃 Django 自带用户管理后，能否使用 `simple-jwt`？"
categories: ['Django']
tags: ['数据库', 'Sqlite', 'Django']
artid: "146267781"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146267781
    alt: "后端django抛弃-Django-自带用户管理后,能否使用-simple-jwt"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146267781
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146267781
cover: https://bing.ee123.net/img/rand?artid=146267781
image: https://bing.ee123.net/img/rand?artid=146267781
img: https://bing.ee123.net/img/rand?artid=146267781
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【后端】【django】抛弃 Django 自带用户管理后，能否使用 `simple-jwt`？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_Django__simplejwt_0">
     </a>
     <strong>
      抛弃 Django 自带用户管理后，能否使用
      <code>
       simple-jwt
      </code>
      ？
     </strong>
    </h3>
    <h4>
     <a id="_2">
     </a>
     <strong>
      一、结论
     </strong>
    </h4>
    <p>
     是的，
     <strong>
      即使抛弃了 Django 自带的用户管理
     </strong>
     （
     <code>
      AbstractUser
     </code>
     或
     <code>
      AbstractBaseUser
     </code>
     ），仍然可以使用
     <code>
      django-rest-framework-simplejwt
     </code>
     （简称
     <code>
      simple-jwt
     </code>
     ）来进行 JWT 认证。但需要进行
     <strong>
      额外配置
     </strong>
     ，确保
     <code>
      simple-jwt
     </code>
     能识别和处理你的自定义用户模型。
    </p>
    <hr/>
    <h4>
     <a id="Django__7">
     </a>
     <strong>
      二、Django 用户管理的作用
     </strong>
    </h4>
    <p>
     Django 自带的用户管理提供：
    </p>
    <ol>
     <li>
      <strong>
       <code>
        AbstractUser
       </code>
       /
       <code>
        AbstractBaseUser
       </code>
      </strong>
      作为默认用户模型。
     </li>
     <li>
      <strong>
       <code>
        django.contrib.auth
       </code>
       认证系统
      </strong>
      ，如
      <code>
       authenticate()
      </code>
      、
      <code>
       login()
      </code>
      、
      <code>
       logout()
      </code>
      。
     </li>
     <li>
      <strong>
       默认的
       <code>
        User
       </code>
       模型
      </strong>
      ，用于管理权限、组等。
     </li>
    </ol>
    <p>
     如果你
     <strong>
      完全抛弃
     </strong>
     Django 的用户管理（如不继承
     <code>
      AbstractUser
     </code>
     ），你需要：
    </p>
    <ul>
     <li>
      <strong>
       自定义用户模型
      </strong>
     </li>
     <li>
      <strong>
       自定义
       <code>
        simple-jwt
       </code>
       的用户解析逻辑
      </strong>
     </li>
     <li>
      <strong>
       手动实现
       <code>
        authenticate()
       </code>
       逻辑
      </strong>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_JWT__20">
     </a>
     <strong>
      三、如何自定义 JWT 认证
     </strong>
    </h4>
    <h5>
     <a id="1__djangorestframeworksimplejwt_21">
     </a>
     <strong>
      1. 安装
      <code>
       djangorestframework-simplejwt
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> djangorestframework-simplejwt
</code></pre>
    <h5>
     <a id="2__settingspy__26">
     </a>
     <strong>
      2. 在
      <code>
       settings.py
      </code>
      进行基础配置
     </strong>
    </h5>
    <pre><code class="prism language-python">INSTALLED_APPS <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">"rest_framework_simplejwt"</span><span class="token punctuation">]</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"DEFAULT_AUTHENTICATION_CLASSES"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">"rest_framework_simplejwt.authentication.JWTAuthentication"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="3__37">
     </a>
     <strong>
      3. 自定义用户模型
     </strong>
    </h5>
    <p>
     如果你不使用 Django 默认的
     <code>
      User
     </code>
     ，可以创建自己的
     <code>
      CustomUser
     </code>
     模型：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">CustomUser</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    is_active <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>username
</code></pre>
    <h5>
     <a id="4__get_user_model_53">
     </a>
     <strong>
      4. 自定义
      <code>
       get_user_model()
      </code>
     </strong>
    </h5>
    <p>
     由于 Django 默认的
     <code>
      get_user_model()
     </code>
     依赖
     <code>
      AbstractUser
     </code>
     ，如果完全抛弃 Django 用户管理，你可以
     <strong>
      手动指定用户模型
     </strong>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> myapp<span class="token punctuation">.</span>models <span class="token keyword">import</span> CustomUser

<span class="token keyword">def</span> <span class="token function">get_custom_user</span><span class="token punctuation">(</span>identifier<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""支持使用用户名或邮箱获取用户"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> CustomUser<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span>identifier<span class="token punctuation">)</span>
    <span class="token keyword">except</span> CustomUser<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> CustomUser<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>email<span class="token operator">=</span>identifier<span class="token punctuation">)</span>
        <span class="token keyword">except</span> CustomUser<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre>
    <h5>
     <a id="5__JWTAuthentication_69">
     </a>
     <strong>
      5. 自定义
      <code>
       JWTAuthentication
      </code>
     </strong>
    </h5>
    <p>
     因为
     <code>
      simple-jwt
     </code>
     默认使用 Django 自带的
     <code>
      User
     </code>
     ，你需要自定义
     <code>
      JWTAuthentication
     </code>
     来适配
     <code>
      CustomUser
     </code>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> JWTAuthentication

<span class="token keyword">class</span> <span class="token class-name">CustomJWTAuthentication</span><span class="token punctuation">(</span>JWTAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_token<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            user_id <span class="token operator">=</span> validated_token<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user_id"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> CustomUser<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_id<span class="token punctuation">)</span>
        <span class="token keyword">except</span> CustomUser<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre>
    <p>
     然后在
     <code>
      settings.py
     </code>
     替换
     <code>
      DEFAULT_AUTHENTICATION_CLASSES
     </code>
     ：
    </p>
    <pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"DEFAULT_AUTHENTICATION_CLASSES"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">"path.to.CustomJWTAuthentication"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="6__Token__92">
     </a>
     <strong>
      6. 自定义 Token 生成视图
     </strong>
    </h5>
    <p>
     由于
     <code>
      simple-jwt
     </code>
     默认使用
     <code>
      User
     </code>
     进行认证，你需要
     <strong>
      自定义 Token 生成逻辑
     </strong>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> TokenObtainPairView
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> TokenObtainPairSerializer
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>hashers <span class="token keyword">import</span> check_password

<span class="token keyword">class</span> <span class="token class-name">CustomTokenObtainPairSerializer</span><span class="token punctuation">(</span>TokenObtainPairSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>

        user <span class="token operator">=</span> get_custom_user<span class="token punctuation">(</span>username<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> user <span class="token keyword">or</span> <span class="token keyword">not</span> check_password<span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">"用户名或密码错误"</span><span class="token punctuation">)</span>

        data <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validate<span class="token punctuation">(</span>attrs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> data

<span class="token keyword">class</span> <span class="token class-name">CustomTokenObtainPairView</span><span class="token punctuation">(</span>TokenObtainPairView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer_class <span class="token operator">=</span> CustomTokenObtainPairSerializer
</code></pre>
    <p>
     然后在
     <code>
      urls.py
     </code>
     里注册：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> path<span class="token punctuation">.</span>to<span class="token punctuation">.</span>views <span class="token keyword">import</span> CustomTokenObtainPairView
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> TokenRefreshView

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">"api/token/"</span><span class="token punctuation">,</span> CustomTokenObtainPairView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"token_obtain_pair"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">"api/token/refresh/"</span><span class="token punctuation">,</span> TokenRefreshView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"token_refresh"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_129">
     </a>
     <strong>
      四、总结
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        方案
       </th>
       <th>
        需要修改
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        直接使用 Django
        <code>
         User
        </code>
       </td>
       <td>
        <strong>
         无需修改，默认支持
         <code>
          simple-jwt
         </code>
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        继承
        <code>
         AbstractUser
        </code>
       </td>
       <td>
        <strong>
         支持
         <code>
          simple-jwt
         </code>
         ，只需
         <code>
          settings.AUTH_USER_MODEL
         </code>
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         完全自定义用户模型
        </strong>
       </td>
       <td>
        <strong>
         需要手动适配
         <code>
          JWTAuthentication
         </code>
         ，重写
         <code>
          TokenObtainPairSerializer
         </code>
        </strong>
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="_136">
     </a>
     <strong>
      推荐方案
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       如果只是调整
       <code>
        User
       </code>
       字段，建议继承
       <code>
        AbstractUser
       </code>
       ，这样
       <code>
        simple-jwt
       </code>
       仍然可用
      </strong>
     </li>
     <li>
      <strong>
       如果完全自定义用户模型，必须手动适配
       <code>
        simple-jwt
       </code>
      </strong>
     </li>
    </ul>
    <p>
     总之，
     <strong>
      抛弃 Django 的
      <code>
       User
      </code>
      仍然可以使用
      <code>
       simple-jwt
      </code>
      ，但需要额外开发
      <code>
       JWTAuthentication
      </code>
      逻辑
     </strong>
     。🚀
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35393334343132372f:61727469636c652f64657461696c732f313436323637373831" class_="artid" style="display:none">
 </p>
</div>


