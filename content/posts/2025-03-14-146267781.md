---
layout: post
title: "åç«¯djangoæŠ›å¼ƒ-Django-è‡ªå¸¦ç”¨æˆ·ç®¡ç†å,èƒ½å¦ä½¿ç”¨-simple-jwt"
date: 2025-03-14 21:32:44 +0800
description: "å¦‚æœå®Œå…¨æŠ›å¼ƒ Django ç”¨æˆ·ç®¡ç†ï¼Œä½ å¯ä»¥ã€‚Django çš„ç”¨æˆ·ç®¡ç†ï¼ˆå¦‚ä¸ç»§æ‰¿ã€‚ï¼‰æ¥è¿›è¡Œ JWT è®¤è¯ã€‚å¦‚æœä½ ä¸ä½¿ç”¨ Django é»˜è®¤çš„ã€‚èƒ½è¯†åˆ«å’Œå¤„ç†ä½ çš„è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ã€‚é»˜è®¤ä½¿ç”¨ Django è‡ªå¸¦çš„ã€‚ç”±äº Django é»˜è®¤çš„ã€‚"
keywords: "ã€åç«¯ã€‘ã€djangoã€‘æŠ›å¼ƒ Django è‡ªå¸¦ç”¨æˆ·ç®¡ç†åï¼Œèƒ½å¦ä½¿ç”¨ `simple-jwt`ï¼Ÿ"
categories: ['Django']
tags: ['æ•°æ®åº“', 'Sqlite', 'Django']
artid: "146267781"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146267781
    alt: "åç«¯djangoæŠ›å¼ƒ-Django-è‡ªå¸¦ç”¨æˆ·ç®¡ç†å,èƒ½å¦ä½¿ç”¨-simple-jwt"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146267781
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146267781
cover: https://bing.ee123.net/img/rand?artid=146267781
image: https://bing.ee123.net/img/rand?artid=146267781
img: https://bing.ee123.net/img/rand?artid=146267781
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ã€åç«¯ã€‘ã€djangoã€‘æŠ›å¼ƒ Django è‡ªå¸¦ç”¨æˆ·ç®¡ç†åï¼Œèƒ½å¦ä½¿ç”¨ `simple-jwt`ï¼Ÿ
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_Django__simplejwt_0">
     </a>
     <strong>
      æŠ›å¼ƒ Django è‡ªå¸¦ç”¨æˆ·ç®¡ç†åï¼Œèƒ½å¦ä½¿ç”¨
      <code>
       simple-jwt
      </code>
      ï¼Ÿ
     </strong>
    </h3>
    <h4>
     <a id="_2">
     </a>
     <strong>
      ä¸€ã€ç»“è®º
     </strong>
    </h4>
    <p>
     æ˜¯çš„ï¼Œ
     <strong>
      å³ä½¿æŠ›å¼ƒäº† Django è‡ªå¸¦çš„ç”¨æˆ·ç®¡ç†
     </strong>
     ï¼ˆ
     <code>
      AbstractUser
     </code>
     æˆ–
     <code>
      AbstractBaseUser
     </code>
     ï¼‰ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨
     <code>
      django-rest-framework-simplejwt
     </code>
     ï¼ˆç®€ç§°
     <code>
      simple-jwt
     </code>
     ï¼‰æ¥è¿›è¡Œ JWT è®¤è¯ã€‚ä½†éœ€è¦è¿›è¡Œ
     <strong>
      é¢å¤–é…ç½®
     </strong>
     ï¼Œç¡®ä¿
     <code>
      simple-jwt
     </code>
     èƒ½è¯†åˆ«å’Œå¤„ç†ä½ çš„è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ã€‚
    </p>
    <hr/>
    <h4>
     <a id="Django__7">
     </a>
     <strong>
      äºŒã€Django ç”¨æˆ·ç®¡ç†çš„ä½œç”¨
     </strong>
    </h4>
    <p>
     Django è‡ªå¸¦çš„ç”¨æˆ·ç®¡ç†æä¾›ï¼š
    </p>
    <ol>
     <li>
      <strong>
       <code>
        AbstractUser
       </code>
       /
       <code>
        AbstractBaseUser
       </code>
      </strong>
      ä½œä¸ºé»˜è®¤ç”¨æˆ·æ¨¡å‹ã€‚
     </li>
     <li>
      <strong>
       <code>
        django.contrib.auth
       </code>
       è®¤è¯ç³»ç»Ÿ
      </strong>
      ï¼Œå¦‚
      <code>
       authenticate()
      </code>
      ã€
      <code>
       login()
      </code>
      ã€
      <code>
       logout()
      </code>
      ã€‚
     </li>
     <li>
      <strong>
       é»˜è®¤çš„
       <code>
        User
       </code>
       æ¨¡å‹
      </strong>
      ï¼Œç”¨äºç®¡ç†æƒé™ã€ç»„ç­‰ã€‚
     </li>
    </ol>
    <p>
     å¦‚æœä½ 
     <strong>
      å®Œå…¨æŠ›å¼ƒ
     </strong>
     Django çš„ç”¨æˆ·ç®¡ç†ï¼ˆå¦‚ä¸ç»§æ‰¿
     <code>
      AbstractUser
     </code>
     ï¼‰ï¼Œä½ éœ€è¦ï¼š
    </p>
    <ul>
     <li>
      <strong>
       è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹
      </strong>
     </li>
     <li>
      <strong>
       è‡ªå®šä¹‰
       <code>
        simple-jwt
       </code>
       çš„ç”¨æˆ·è§£æé€»è¾‘
      </strong>
     </li>
     <li>
      <strong>
       æ‰‹åŠ¨å®ç°
       <code>
        authenticate()
       </code>
       é€»è¾‘
      </strong>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_JWT__20">
     </a>
     <strong>
      ä¸‰ã€å¦‚ä½•è‡ªå®šä¹‰ JWT è®¤è¯
     </strong>
    </h4>
    <h5>
     <a id="1__djangorestframeworksimplejwt_21">
     </a>
     <strong>
      1. å®‰è£…
      <code>
       djangorestframework-simplejwt
      </code>
     </strong>
    </h5>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> djangorestframework-simplejwt
</code></pre>
    <h5>
     <a id="2__settingspy__26">
     </a>
     <strong>
      2. åœ¨
      <code>
       settings.py
      </code>
      è¿›è¡ŒåŸºç¡€é…ç½®
     </strong>
    </h5>
    <pre><code class="prism language-python">INSTALLED_APPS <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">"rest_framework_simplejwt"</span><span class="token punctuation">]</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"DEFAULT_AUTHENTICATION_CLASSES"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">"rest_framework_simplejwt.authentication.JWTAuthentication"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="3__37">
     </a>
     <strong>
      3. è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹
     </strong>
    </h5>
    <p>
     å¦‚æœä½ ä¸ä½¿ç”¨ Django é»˜è®¤çš„
     <code>
      User
     </code>
     ï¼Œå¯ä»¥åˆ›å»ºè‡ªå·±çš„
     <code>
      CustomUser
     </code>
     æ¨¡å‹ï¼š
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">CustomUser</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    is_active <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>username
</code></pre>
    <h5>
     <a id="4__get_user_model_53">
     </a>
     <strong>
      4. è‡ªå®šä¹‰
      <code>
       get_user_model()
      </code>
     </strong>
    </h5>
    <p>
     ç”±äº Django é»˜è®¤çš„
     <code>
      get_user_model()
     </code>
     ä¾èµ–
     <code>
      AbstractUser
     </code>
     ï¼Œå¦‚æœå®Œå…¨æŠ›å¼ƒ Django ç”¨æˆ·ç®¡ç†ï¼Œä½ å¯ä»¥
     <strong>
      æ‰‹åŠ¨æŒ‡å®šç”¨æˆ·æ¨¡å‹
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> myapp<span class="token punctuation">.</span>models <span class="token keyword">import</span> CustomUser

<span class="token keyword">def</span> <span class="token function">get_custom_user</span><span class="token punctuation">(</span>identifier<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""æ”¯æŒä½¿ç”¨ç”¨æˆ·åæˆ–é‚®ç®±è·å–ç”¨æˆ·"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> CustomUser<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span>identifier<span class="token punctuation">)</span>
    <span class="token keyword">except</span> CustomUser<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> CustomUser<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>email<span class="token operator">=</span>identifier<span class="token punctuation">)</span>
        <span class="token keyword">except</span> CustomUser<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre>
    <h5>
     <a id="5__JWTAuthentication_69">
     </a>
     <strong>
      5. è‡ªå®šä¹‰
      <code>
       JWTAuthentication
      </code>
     </strong>
    </h5>
    <p>
     å› ä¸º
     <code>
      simple-jwt
     </code>
     é»˜è®¤ä½¿ç”¨ Django è‡ªå¸¦çš„
     <code>
      User
     </code>
     ï¼Œä½ éœ€è¦è‡ªå®šä¹‰
     <code>
      JWTAuthentication
     </code>
     æ¥é€‚é…
     <code>
      CustomUser
     </code>
     ï¼š
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> JWTAuthentication

<span class="token keyword">class</span> <span class="token class-name">CustomJWTAuthentication</span><span class="token punctuation">(</span>JWTAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_token<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            user_id <span class="token operator">=</span> validated_token<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user_id"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> CustomUser<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>user_id<span class="token punctuation">)</span>
        <span class="token keyword">except</span> CustomUser<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre>
    <p>
     ç„¶ååœ¨
     <code>
      settings.py
     </code>
     æ›¿æ¢
     <code>
      DEFAULT_AUTHENTICATION_CLASSES
     </code>
     ï¼š
    </p>
    <pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"DEFAULT_AUTHENTICATION_CLASSES"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">"path.to.CustomJWTAuthentication"</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="6__Token__92">
     </a>
     <strong>
      6. è‡ªå®šä¹‰ Token ç”Ÿæˆè§†å›¾
     </strong>
    </h5>
    <p>
     ç”±äº
     <code>
      simple-jwt
     </code>
     é»˜è®¤ä½¿ç”¨
     <code>
      User
     </code>
     è¿›è¡Œè®¤è¯ï¼Œä½ éœ€è¦
     <strong>
      è‡ªå®šä¹‰ Token ç”Ÿæˆé€»è¾‘
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> TokenObtainPairView
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> TokenObtainPairSerializer
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>hashers <span class="token keyword">import</span> check_password

<span class="token keyword">class</span> <span class="token class-name">CustomTokenObtainPairSerializer</span><span class="token punctuation">(</span>TokenObtainPairSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>

        user <span class="token operator">=</span> get_custom_user<span class="token punctuation">(</span>username<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> user <span class="token keyword">or</span> <span class="token keyword">not</span> check_password<span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> serializers<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span><span class="token punctuation">)</span>

        data <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validate<span class="token punctuation">(</span>attrs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> data

<span class="token keyword">class</span> <span class="token class-name">CustomTokenObtainPairView</span><span class="token punctuation">(</span>TokenObtainPairView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer_class <span class="token operator">=</span> CustomTokenObtainPairSerializer
</code></pre>
    <p>
     ç„¶ååœ¨
     <code>
      urls.py
     </code>
     é‡Œæ³¨å†Œï¼š
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> path<span class="token punctuation">.</span>to<span class="token punctuation">.</span>views <span class="token keyword">import</span> CustomTokenObtainPairView
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> TokenRefreshView

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">"api/token/"</span><span class="token punctuation">,</span> CustomTokenObtainPairView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"token_obtain_pair"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">"api/token/refresh/"</span><span class="token punctuation">,</span> TokenRefreshView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"token_refresh"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_129">
     </a>
     <strong>
      å››ã€æ€»ç»“
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        æ–¹æ¡ˆ
       </th>
       <th>
        éœ€è¦ä¿®æ”¹
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        ç›´æ¥ä½¿ç”¨ Django
        <code>
         User
        </code>
       </td>
       <td>
        <strong>
         æ— éœ€ä¿®æ”¹ï¼Œé»˜è®¤æ”¯æŒ
         <code>
          simple-jwt
         </code>
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        ç»§æ‰¿
        <code>
         AbstractUser
        </code>
       </td>
       <td>
        <strong>
         æ”¯æŒ
         <code>
          simple-jwt
         </code>
         ï¼Œåªéœ€
         <code>
          settings.AUTH_USER_MODEL
         </code>
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         å®Œå…¨è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹
        </strong>
       </td>
       <td>
        <strong>
         éœ€è¦æ‰‹åŠ¨é€‚é…
         <code>
          JWTAuthentication
         </code>
         ï¼Œé‡å†™
         <code>
          TokenObtainPairSerializer
         </code>
        </strong>
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="_136">
     </a>
     <strong>
      æ¨èæ–¹æ¡ˆ
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       å¦‚æœåªæ˜¯è°ƒæ•´
       <code>
        User
       </code>
       å­—æ®µï¼Œå»ºè®®ç»§æ‰¿
       <code>
        AbstractUser
       </code>
       ï¼Œè¿™æ ·
       <code>
        simple-jwt
       </code>
       ä»ç„¶å¯ç”¨
      </strong>
     </li>
     <li>
      <strong>
       å¦‚æœå®Œå…¨è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ï¼Œå¿…é¡»æ‰‹åŠ¨é€‚é…
       <code>
        simple-jwt
       </code>
      </strong>
     </li>
    </ul>
    <p>
     æ€»ä¹‹ï¼Œ
     <strong>
      æŠ›å¼ƒ Django çš„
      <code>
       User
      </code>
      ä»ç„¶å¯ä»¥ä½¿ç”¨
      <code>
       simple-jwt
      </code>
      ï¼Œä½†éœ€è¦é¢å¤–å¼€å‘
      <code>
       JWTAuthentication
      </code>
      é€»è¾‘
     </strong>
     ã€‚ğŸš€
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35393334343132372f:61727469636c652f64657461696c732f313436323637373831" class_="artid" style="display:none">
 </p>
</div>


