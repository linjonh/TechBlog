---
layout: post
title: "Opencv之掩码实现图片抠图"
date: 2025-03-14 21:11:47 +0800
description: "Opencv之掩码实现图片抠图"
keywords: "Opencv之掩码实现图片抠图"
categories: ['Python', 'Opencv']
tags: ['计算机视觉', '图片识别', '人工智能', 'Python', 'Opencv']
artid: "146257401"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146257401
    alt: "Opencv之掩码实现图片抠图"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146257401
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146257401
cover: https://bing.ee123.net/img/rand?artid=146257401
image: https://bing.ee123.net/img/rand?artid=146257401
img: https://bing.ee123.net/img/rand?artid=146257401
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Opencv之掩码实现图片抠图
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     掩码实现图片抠图
    </h2>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="1__3">
     </a>
     1 掩码
    </h3>
    <hr/>
    <h4>
     <a id="11__5">
     </a>
     1.1 概念
    </h4>
    <p>
     掩码（Mask）是一种用于
     <strong>
      指定图像处理操作区域的工具
     </strong>
     。
     <strong>
      掩码通常是一个与图像尺寸相同的二值图像
     </strong>
     ，其中像素值为0表示不处理，像素值为255（或1）表示处理。掩码可以用于多种操作，如图像滤波、图像合成、图像分割等。掩码的尺寸必须与图像的尺寸相同。掩码的像素值通常为0或255（或1），但也可以是其他值，具体取决于应用场景。通过使用掩码，可以更精确地控制图像处理操作的范围，从而实现更复杂的效果。
    </p>
    <h4>
     <a id="12__7">
     </a>
     1.2 创建掩码
    </h4>
    <ul>
     <li>
      mask =
      <strong>
       np.zeros((height, width), dtype=np.uint8)，创建一个全黑的掩码
      </strong>
      <ul>
       <li>
        <strong>
         (height, width), 高宽
        </strong>
       </li>
       <li>
        <strong>
         dtype=np.uint8 ，数据类型
        </strong>
       </li>
      </ul>
     </li>
     <li>
      <strong>
       cv2.rectangle(mask, (x1, y1), (x2, y2), 255, -1)，在掩码上绘制矩形
      </strong>
      <ul>
       <li>
        <strong>
         (x1, y1), (x2, y2)起点和对角线坐标 ，
        </strong>
       </li>
       <li>
        <strong>
         255颜色， -1表全填充
        </strong>
       </li>
      </ul>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment"># 创建一个全黑的掩码</span>
mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment"># 在掩码上绘制一个白色矩形</span>
cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'mask'</span><span class="token punctuation">,</span>mask<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     运行如下
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/65c33ea595f747c7a01e7e4e977ba0f4.png"/>
    </p>
    <h4>
     <a id="13_27">
     </a>
     1.3抠图思路
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        图像读取与预处理
       </strong>
       <br/>
       读取图像并转换为
       <strong>
        灰度图
       </strong>
       ，进行
       <strong>
        高斯滤波
       </strong>
       以减少噪声。
      </p>
     </li>
     <li>
      <p>
       <strong>
        边缘检测
       </strong>
       <br/>
       使用Canny算法检测图像中的边缘。
      </p>
     </li>
     <li>
      <p>
       <strong>
        轮廓检测与排序
       </strong>
       <br/>
       查找图像中的轮廓，并
       <strong>
        根据面积进行排序
       </strong>
       。
      </p>
     </li>
     <li>
      <p>
       <strong>
        二值化处理
       </strong>
       <br/>
       对灰度图进行二值化处理，确定阈值。
      </p>
     </li>
     <li>
      <p>
       <strong>
        轮廓筛选
       </strong>
       <br/>
       根据轮廓的
       <strong>
        宽度、高度和宽高比筛选
       </strong>
       出符合条件的轮廓。
      </p>
     </li>
     <li>
      <p>
       <strong>
        掩码操作
       </strong>
       <br/>
       在掩码上绘制筛选后的轮廓，并对原图像和掩码进行与操作，以提取区域。
      </p>
     </li>
    </ul>
    <h3>
     <a id="2__42">
     </a>
     2 代码测试
    </h3>
    <p>
     原图
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/99ed06f8cfa04ffca18579c287d00a8e.png"/>
    </p>
    <p>
     代码展示：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2

<span class="token comment"># 定义一个函数用于显示图像，并等待用户按下任意键关闭窗口</span>
<span class="token keyword">def</span> <span class="token function">cv_chow</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>name<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 定义一个函数用于对四个点进行排序，返回一个有序的矩形顶点列表</span>
<span class="token keyword">def</span> <span class="token function">order_points</span><span class="token punctuation">(</span>pts<span class="token punctuation">)</span><span class="token punctuation">:</span>
    rect <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"float32"</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> pts<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 计算每个点的x和y坐标之和</span>
    rect<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> pts<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 最小的和为左上角</span>
    rect<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> pts<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 最大的和为右下角</span>
    diff <span class="token operator">=</span> np<span class="token punctuation">.</span>diff<span class="token punctuation">(</span>pts<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 计算每个点的x和y坐标之差</span>
    rect<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> pts<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 最小的差为右上角</span>
    rect<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> pts<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 最大的差为左下角</span>
    <span class="token keyword">return</span> rect

<span class="token comment"># 定义一个函数用于对轮廓进行排序，支持从左到右、从右到左、从上到下、从下到上四种排序方式</span>
<span class="token keyword">def</span> <span class="token function">sort_contours</span><span class="token punctuation">(</span>cons<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'left-to-right'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    reverse <span class="token operator">=</span> <span class="token boolean">False</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token string">'right-to-left'</span> <span class="token keyword">or</span> method <span class="token operator">==</span> <span class="token string">'bottom-to-top'</span><span class="token punctuation">:</span>
        reverse <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token string">'top-to-bottom'</span> <span class="token keyword">or</span> method <span class="token operator">==</span> <span class="token string">'bottom-to-top'</span><span class="token punctuation">:</span>
        i <span class="token operator">=</span> <span class="token number">1</span>
    boundingBoxes <span class="token operator">=</span> <span class="token punctuation">[</span>cv2<span class="token punctuation">.</span>boundingRect<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> cons<span class="token punctuation">]</span>  <span class="token comment"># 获取每个轮廓的边界框</span>
    <span class="token punctuation">(</span>cons<span class="token punctuation">,</span> boundingBoxes<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>cons<span class="token punctuation">,</span> boundingBoxes<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                       key<span class="token operator">=</span><span class="token keyword">lambda</span> b<span class="token punctuation">:</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span>reverse<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cons<span class="token punctuation">,</span> boundingBoxes

<span class="token comment"># 读取图像</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'img_3.png'</span><span class="token punctuation">)</span>

<span class="token comment"># 复制图像用于绘制轮廓</span>
cont_img <span class="token operator">=</span> img<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将图像转换为灰度图</span>
gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>

<span class="token comment"># 对灰度图进行高斯滤波，以减少噪声</span>
blurred <span class="token operator">=</span> cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
cv_chow<span class="token punctuation">(</span><span class="token string">'blurred'</span><span class="token punctuation">,</span> blurred<span class="token punctuation">)</span>

<span class="token comment"># 使用Canny边缘检测算法检测图像中的边缘</span>
edg <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>blurred<span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
cv_chow<span class="token punctuation">(</span><span class="token string">'edg'</span><span class="token punctuation">,</span> edg<span class="token punctuation">)</span>

<span class="token comment"># 查找图像中的轮廓</span>
cnts <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>edg<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>

<span class="token comment"># 在图像上绘制所有轮廓</span>
cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>cont_img<span class="token punctuation">,</span> cnts<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
cv_chow<span class="token punctuation">(</span><span class="token string">'cont_img'</span><span class="token punctuation">,</span> cont_img<span class="token punctuation">)</span>

<span class="token comment"># 根据轮廓面积对轮廓进行排序，从大到小</span>
cnts <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>cnts<span class="token punctuation">,</span> key<span class="token operator">=</span>cv2<span class="token punctuation">.</span>contourArea<span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 对灰度图进行二值化处理，使用Otsu's方法自动确定阈值</span>
thresh <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY_INV <span class="token operator">|</span> cv2<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
cv_chow<span class="token punctuation">(</span><span class="token string">'thresh'</span><span class="token punctuation">,</span> thresh<span class="token punctuation">)</span>

<span class="token comment"># 在二值化图像中查找轮廓</span>
thresh_cnt <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findContours<span class="token punctuation">(</span>thresh<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># 初始化一个列表用于存储符合条件的轮廓</span>
qus_cnts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 初始化一个列表用于存储所有的掩码</span>
mask_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 创建一个与二值化图像大小相同的黑色掩码</span>
mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>thresh<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'uint8'</span><span class="token punctuation">)</span>

<span class="token comment"># 遍历所有轮廓，筛选出符合条件的轮廓</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> thresh_cnt<span class="token punctuation">:</span>
    <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boundingRect<span class="token punctuation">(</span>c<span class="token punctuation">)</span>  <span class="token comment"># 获取轮廓的边界框</span>
    ar <span class="token operator">=</span> w <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>  <span class="token comment"># 计算边界框的宽高比</span>
    <span class="token keyword">if</span> w <span class="token operator">&gt;=</span> <span class="token number">8</span> <span class="token keyword">and</span> h <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token keyword">and</span> <span class="token number">0.5</span> <span class="token operator">&lt;=</span> ar <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">:</span>  <span class="token comment"># 根据宽度、高度和宽高比筛选轮廓</span>
        qus_cnts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token comment"># 遍历筛选后的轮廓，绘制掩码并进行与操作</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> qus_cnts<span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 在掩码上绘制轮廓</span>
    cv_chow<span class="token punctuation">(</span><span class="token string">'mask'</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span>
    img_mask_and <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img<span class="token punctuation">,</span> img<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span>  <span class="token comment"># 对原图像和掩码进行与操作</span>
    cv_chow<span class="token punctuation">(</span><span class="token string">'img_mask_and'</span><span class="token punctuation">,</span> img_mask_and<span class="token punctuation">)</span>
</code></pre>
    <p>
     运行结果：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/308d60fcd19c4a19b1b75380f74b0147.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36343538383133352f:61727469636c652f64657461696c732f313436323537343031" class_="artid" style="display:none">
 </p>
</div>


