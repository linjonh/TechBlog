---
layout: post
title: "Kubernetes教程七了解集群标签Pod和Deployment"
date: 2025-03-12 20:04:03 +0800
description: "K8s的知识体系真的是太庞大了，本篇暂时写到这里，本篇涉及到的Pod和Deployment也只是真正相关知识的九牛一毛而已。但是学习一门新技术，不能按部就班地一个一个章节死磕每个知识点。要先对整体有个大概了解，着重看最主要最常用的功能，之后再反复的看书实践，提取知识点。"
keywords: "Kubernetes教程（七）了解集群、标签、Pod和Deployment"
categories: ['Kubernetes']
tags: ['容器', '云原生', 'Kubernetes']
artid: "146196361"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146196361
    alt: "Kubernetes教程七了解集群标签Pod和Deployment"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146196361
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146196361
cover: https://bing.ee123.net/img/rand?artid=146196361
image: https://bing.ee123.net/img/rand?artid=146196361
img: https://bing.ee123.net/img/rand?artid=146196361
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Kubernetes教程（七）了解集群、标签、Pod和Deployment
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <br/>
    Kubernetes的知识真的特别庞大，知识点多，还特别看重实践操作。我从
    <code>
     Kubernetes
    </code>
    这个单词怎么拼写到在搭建好K8s集群并运行一个Nginx，花了一周的时间。我现在也是超级菜鸟一个，连入门都不算，只能边学边记录，我看的书籍是下面2本：
    <p>
    </p>
    <ul>
     <li>
      <code>
       《Kubernetes权威指南》
      </code>
      第6版，知识点全面，对概念和原理讲的深入
     </li>
     <li>
      <code>
       《Kubernetes企业级云原生运维实战》
      </code>
      李振良编写，更偏向实战操作，以便🐮🐴们能用上K8s为老板打工
     </li>
     <li>
      个人建议先看
      <code>
       《Kubernetes企业级云原生运维实战》
      </code>
      ，不然
      <code>
       《Kubernetes权威指南》
      </code>
      的第一章（共47页）都根本看不懂💀
     </li>
    </ul>
    <h2>
     <a id="K8s_5">
     </a>
     一、K8s
     <code>
      资源对象
     </code>
    </h2>
    <p>
     K8s中的基础概念和术语大多围绕
     <code>
      资源对象
     </code>
     来说的，资源对象可分如下几类：
    </p>
    <ul>
     <li>
      基础资源对象：节点（Node）、容器组（Pod）、服务（Service）、存储卷（Volume）
     </li>
     <li>
      基础资源对象相关的事务与控制器：标签（Label）、注解（Annotation）、命名空间（Namespace）、水平扩容、配置（ConfigMap、Secret）、持久化存储（PersistentVolume、PersistentVolumeClaim、StorageClass）、工作负载控制器（Deployment、StatefulSet、DeamonSet、Job、CronJob）
     </li>
     <li>
      资源管控和权限相关：资源限制、资源配额、角色、角色绑定
     </li>
     <li>
      网络相关 ：Ingress、网络策略（NetworkPolicy）等
     </li>
    </ul>
    <p>
     K8s中
     <code>
      资源对象
     </code>
     包括几个公共属性：版本（Version）、类别（Kind）、名称（Name）、标签、注解。我们可以用
     <code>
      YAML
     </code>
     或
     <code>
      JSON
     </code>
     格式声明一个K8s
     <code>
      资源对象
     </code>
     ，每个资源对象都有自己特定的结构定义，比如
     <code>
      Pod
     </code>
     和
     <code>
      Service
     </code>
     的YAML文件的格式是不同的。定义好的资源对象会保存在
     <code>
      etcd
     </code>
     这非关系型数据库中，以便快速读写。
    </p>
    <h2>
     <a id="K8s_14">
     </a>
     二、K8s
     <code>
      集群
     </code>
    </h2>
    <p>
     K8s集群（Cluster）是由
     <code>
      Master
     </code>
     和
     <code>
      Node
     </code>
     组成的。
    </p>
    <h3>
     <a id="1_Master_16">
     </a>
     1. Master
    </h3>
    <p>
     <code>
      Master
     </code>
     是控制节点，负责管理和控制整个集群，相当于集群的大脑，在每个K8s集群中都需要一个或一组
     <code>
      Master
     </code>
     。在
     <code>
      Master
     </code>
     上运行一下关键进程：
    </p>
    <ul>
     <li>
      <code>
       kube-apiserver
      </code>
      ：提供RESTful API接口，是对资源进行增删改查的唯一入口，也是集群控制的入口
     </li>
     <li>
      <code>
       kube-controller-manager
      </code>
      ：所有资源对象的自动化控制中心，相当于“大总管”
     </li>
     <li>
      <code>
       kube-scheduler
      </code>
      ：负责资源调度（Pod调度）
     </li>
    </ul>
    <h3>
     <a id="2_Node_21">
     </a>
     2. Node
    </h3>
    <p>
     <code>
      Node
     </code>
     是集群中的工作负载节点，是真正干活的打工人。
     <code>
      Master
     </code>
     会把工作负载分配给
     <code>
      Node
     </code>
     ，当某个
     <code>
      Node
     </code>
     宕机，其上的工作负载会被
     <code>
      Master
     </code>
     转移到其他
     <code>
      Node
     </code>
     上。在每个
     <code>
      Node
     </code>
     上运行着以下关键进程：
    </p>
    <ul>
     <li>
      <code>
       kubelet
      </code>
      ：负责
      <code>
       Pod
      </code>
      对应容器的创建、启停等任务，听
      <code>
       Mater
      </code>
      的指挥，实现集群管理的基本功能
     </li>
     <li>
      <code>
       kube-proxy
      </code>
      ：实现K8s
      <code>
       Service
      </code>
      通信与负载均衡机制
     </li>
     <li>
      <code>
       容器运行时（如Docker）
      </code>
      ：负责本机容器的创建和管理
     </li>
    </ul>
    <pre><code class="prism language-bash">查看集群有多少节点
kubectl get nodes

查看某个Noded的信息
kubectl describe <span class="token function">node</span> <span class="token operator">&lt;</span>node_name<span class="token operator">&gt;</span>
</code></pre>
    <h2>
     <a id="Namespace_34">
     </a>
     三、Namespace（命名空间）
    </h2>
    <p>
     在K8s集群中还有一个重要概念-命名空间（Namespace），在大多情况下用于多租户的资源隔离，典型的思路是给每个租户分配一个命名空间。每个命名空间都是相互独立的，不同命名空间的资源对象是
     <code>
      逻辑上
     </code>
     相互隔离。K8s安装运行后，默认会有2个Namespace：
    </p>
    <ul>
     <li>
      <code>
       default
      </code>
      ：给用户用的，用户创建资源对象时，如不指定命名空间，会放到default命名空间
     </li>
     <li>
      <code>
       kube-system
      </code>
      ：存放
      <strong>
       系统相关
      </strong>
      的资源对象如网络组件、DNS组件、监控类组件
     </li>
    </ul>
    <pre><code class="prism language-bash">若不指定namespace，查看的是default命名空间内的资源对象
kubectl get pods

通过参数查看指定命名空间<span class="token string">"dev"</span>的资源对象
kubectl get pods <span class="token parameter variable">--namespace</span><span class="token operator">=</span>dev
</code></pre>
    <h2>
     <a id="Label_46">
     </a>
     四、Label（标签）
    </h2>
    <p>
     <code>
      Label
     </code>
     （标签）是K8s一个核心概念，它就是一个
     <code>
      key=value
     </code>
     的键值对，其中
     <code>
      key
     </code>
     和
     <code>
      value
     </code>
     都是用户自定义。
     <code>
      Lable
     </code>
     可以被附加到
     <code>
      Node
     </code>
     、
     <code>
      Pod
     </code>
     、
     <code>
      Deployment
     </code>
     、
     <code>
      Service
     </code>
     、
     <code>
      Volume
     </code>
     等资源对象上，并且 一个资源对象可以有多个标签。 在实际生产环境中，
     <code>
      Pod
     </code>
     应该都是有标签的，下面看个例子，就知道标签的重要性了。
    </p>
    <ul>
     <li>
      下面是个定义
      <code>
       Service
      </code>
      的yaml文件，最后的
      <code>
       selector
      </code>
      就是指关联有
      <code>
       app=nginx
      </code>
      标签的
      <code>
       Pod
      </code>
     </li>
    </ul>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1        <span class="token comment"># API版本</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service         <span class="token comment"># 资源类型</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>             <span class="token comment"># 资源元数据</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx         <span class="token comment"># 资源名称</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>                 <span class="token comment"># 资源规格</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>              <span class="token comment"># 端口映射列表</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span>             <span class="token comment"># 端口名称</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>          <span class="token comment"># 公开端口</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP     <span class="token comment"># 端口协议，支持TCP、UDP和SCTP，默认TCP</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>    <span class="token comment"># 目标端口，即容器内应用程序监听的端口</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>           <span class="token comment"># 标签选择器</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx        <span class="token comment"># Pod标签</span>
</code></pre>
    <p>
     打上
     <code>
      Label
     </code>
     后的资源对象，之后就可以通过
     <code>
      Lable Selector
     </code>
     （标签选择器）查询和筛选，介绍下
     <code>
      Lable Selector
     </code>
     的一些例子：
    </p>
    <ul>
     <li>
      yaml中配置
      <code>
       release : stable
      </code>
      标签，这个标签的值就是
      <code>
       release=stable
      </code>
     </li>
     <li>
      <code>
       release = stable
      </code>
      ，匹配具有
      <code>
       release=stable
      </code>
      标签的资源对象
     </li>
     <li>
      <code>
       release != stable
      </code>
      ，匹配不具有
      <code>
       release=stable
      </code>
      标签的资源对象
     </li>
     <li>
      <code>
       release in (stable, dev)
      </code>
      匹配具有
      <code>
       release=stable
      </code>
      或
      <code>
       release=dev
      </code>
      标签的资源对象
     </li>
     <li>
      <code>
       release notin (stable, dev)
      </code>
      匹配不具有
      <code>
       release=stable
      </code>
      和
      <code>
       release=dev
      </code>
      标签的资源对象
     </li>
    </ul>
    <h2>
     <a id="Pod_72">
     </a>
     五、Pod
    </h2>
    <p>
     <code>
      Pod
     </code>
     （容器组）是K8s中最重要的概念之一，
     <code>
      Pod
     </code>
     是K8s中最小的调度单元，每一个
     <code>
      Pod
     </code>
     包含一个特殊的
     <code>
      Pause容器
     </code>
     （由K8s创建）和一个或多个密切相关的用户
     <code>
      业务容器
     </code>
     。
    </p>
    <ul>
     <li>
      <code>
       Pod
      </code>
      中多个
      <code>
       业务容器
      </code>
      是密切相关的，将
      <code>
       Pod
      </code>
      作为最小单位，让
      <code>
       Pod
      </code>
      内多个应用一起有效地调度和伸缩。
     </li>
     <li>
      <code>
       Pod
      </code>
      中的多个
      <code>
       业务容器
      </code>
      共享
      <code>
       Pause容器
      </code>
      的IP，简化了密切相关容器之间的通信。
     </li>
     <li>
      <code>
       Pod
      </code>
      中的多个
      <code>
       业务容器
      </code>
      共享Volume挂载，简化了密切相关容器之间的文件共享问题。
     </li>
     <li>
      <code>
       Pod
      </code>
      都有一个唯一的
      <code>
       Pod IP
      </code>
      地址，一个
      <code>
       Pod
      </code>
      中多个容器共享
      <code>
       Pod IP
      </code>
      地址。
     </li>
     <li>
      集群中任意两个
      <code>
       Pod
      </code>
      之间都可以支持TCP/IP直接通信。
     </li>
    </ul>
    <h3>
     <a id="1__79">
     </a>
     1. 共享网络命名空间
    </h3>
    <p>
     假设一个场景：有2个
     <code>
      业务容器
     </code>
     ，一个是Nginx，一个是指标采集程序（负责采集Nginx性能指标）。这2个
     <code>
      业务容器
     </code>
     关系是密切相关的。指标采集容器能通过
     <code>
      http://127.0.0.1/nginx_status
     </code>
     直接访问Nginx容器吗？答案是不能，因为它们2个容器的网络命名空间是隔离的。但是在Pod中，这个2个容器可以共享网络命名空间，在创建一个
     <code>
      Pod
     </code>
     时，K8s会先创建一个
     <code>
      Pause容器
     </code>
     ，然后
     <code>
      业务容器
     </code>
     会接着被创建并加入到
     <code>
      Pause容器
     </code>
     的网络命名空间，这样
     <code>
      Pod
     </code>
     中的所有容器都在同一个网络命名空间中，可以通过
     <code>
      127.0.0.1
     </code>
     访问彼此了。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9465c29eb3a84067b6e24d69d8d348f6.png#pic_left"/>
    </p>
    <p>
     假设有个collect指标采集程序的镜像，在定义
     <code>
      Pod
     </code>
     的
     <code>
      yaml文件
     </code>
     可以这样写。
    </p>
    <ul>
     <li>
      <code>
       kind
      </code>
      属性的值为
      <code>
       Pod
      </code>
      ，表明是一个定义
      <code>
       Pod
      </code>
      的文件
     </li>
     <li>
      <code>
       metadata.name
      </code>
      是Pod名称
     </li>
     <li>
      <code>
       metadata.namespace
      </code>
      是命名空间
     </li>
     <li>
      <code>
       metadata.labels
      </code>
      是标签，标签的
      <code>
       key
      </code>
      和
      <code>
       value
      </code>
      都是自定义，所以这个标签值就是
      <code>
       "app=pod-network"
      </code>
     </li>
     <li>
      <code>
       spec.containers
      </code>
      是用户容器列表，可以添加一个或多个容器
     </li>
    </ul>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1              <span class="token comment"># API版本</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod                   <span class="token comment"># 资源类型</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>                   <span class="token comment"># 资源元数据</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>network         <span class="token comment"># Pod名称</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default        <span class="token comment"># 指定命名空间</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>                   <span class="token comment"># Pod标签</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>network        <span class="token comment"># 标签的key和value都是自定义，这个标签值就是"app=pod-network"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>               <span class="token comment"># Pod中容器列表</span>
  <span class="token comment"># 第一个容器（主应用容器）</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.23</span>       <span class="token comment"># 容器镜像地址</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> web               <span class="token comment"># 容器名称</span>
  <span class="token comment"># 第二个容器</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> collect<span class="token punctuation">:</span><span class="token number">1.0</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> collect
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"while true; do sleep 1; done"</span><span class="token punctuation">]</span> <span class="token comment"># 容器执行的命令</span>
</code></pre>
    <h3>
     <a id="2__107">
     </a>
     2. 共享数据
    </h3>
    <p>
     还是上面那个场景：一个是Nginx，一个是指标采集程序（负责采集Nginx性能指标），指标采集程序要如何读取到Nginx的访问日志文件呢？我们所熟悉的
     <code>
      Docker Volume
     </code>
     在K8s中也有对应的概念–
     <code>
      Pod Volume
     </code>
     ，它被定义在
     <code>
      Pod
     </code>
     中，然后被
     <code>
      Pod
     </code>
     中各个容器挂载到自己的文件系统中。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/77d4032dec714ed893bc84c312f7a531.png#pic_left"/>
    </p>
    <ul>
     <li>
      在
      <code>
       Pod
      </code>
      所在节点的文件系统创建一个空目录，然后挂载到2个业务容器的日志目录
     </li>
     <li>
      Nginx容器的
      <code>
       /var/log/nginx
      </code>
      写入文件后，指标采集容器的
      <code>
       /var/log/nginx
      </code>
      也能使用Nginx的日志文件
     </li>
     <li>
      卷定义的
      <code>
       volumes.name
      </code>
      和容器挂载的
      <code>
       volumeMounts.name
      </code>
      要一致，这里都叫"log"
     </li>
    </ul>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>volume
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>volume
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token comment"># 第一个容器（应用容器）</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.23</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> web
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>                <span class="token comment"># 卷挂载</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> log                  <span class="token comment"># 挂载的卷名称</span>
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/nginx  <span class="token comment"># 卷挂载到容器中路径</span>
  <span class="token comment"># 第二个容器（日志采集容器）</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> cooect<span class="token punctuation">:</span><span class="token number">1.0</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> collect
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"while true; do sleep 1; done"</span><span class="token punctuation">]</span>
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>                <span class="token comment"># 卷挂载</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> log                  <span class="token comment"># 挂载的卷名称</span>
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/nginx  <span class="token comment"># 卷挂载到容器中的路径</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                  <span class="token comment"># 定义卷</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> log               <span class="token comment"># 卷名称</span>
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>            <span class="token comment"># 卷类型：emptyDir是临时存储，与Pod生命周期一致</span>
</code></pre>
    <p>
     在实际生产环境中，不会直接用
     <code>
      kind : Pod
     </code>
     这类型的Pod定义文件，一般都会用
     <code>
      kind: Deployment
     </code>
     类型的
     <code>
      工作负载
     </code>
     ，所以一定要好好学习下面的
     <code>
      工作负载
     </code>
     。
    </p>
    <h2>
     <a id="_142">
     </a>
     六、工作负载
    </h2>
    <p>
     通常情况下，每个
     <code>
      Service
     </code>
     对应的
     <code>
      Pod
     </code>
     副本数量都是固定的，如果一个一个手动创建
     <code>
      Pod
     </code>
     副本那也太麻烦了。如果有一个Pod模板，在Pod模板里指定Pod副本数量，然后再根据Pod模板创建多个Pod。从这个Pod模板就引出了K8s中的一个抽象概念：
     <code>
      工作负载
     </code>
     。
    </p>
    <ul>
     <li>
      <code>
       工作负载
      </code>
      用于更高层次地
      <strong>
       创建和管理
      </strong>
      <code>
       Pod
      </code>
      ，它可以定义
      <code>
       Pod
      </code>
      的副本数量、运行规格、调度策略等
     </li>
     <li>
      K8s可以自动处理
      <code>
       Pod
      </code>
      的创建、更新和删除等操作，简化了用户对
      <code>
       Pod
      </code>
      生命周期的操作
     </li>
     <li>
      <code>
       工作负载
      </code>
      有4种类型，其中最常用的是
      <code>
       Deployment
      </code>
      ，支持副本管理、副本数扩缩、滚动更新、版本回滚等操作
     </li>
    </ul>
    <h3>
     <a id="1__148">
     </a>
     1. 设置副本数
    </h3>
    <p>
     下面看下一个
     <code>
      Deployment
     </code>
     的例子：
    </p>
    <ul>
     <li>
      <p>
       <code>
        spec.replicas
       </code>
       ：Pod的副本数量
      </p>
     </li>
     <li>
      <p>
       <code>
        spec.template
       </code>
       ：用于自动创建新Pod副本的模板
      </p>
     </li>
     <li>
      <p>
       <code>
        spec.selector
       </code>
       ：用于指定 Deployment 所管理的 Pod 的标签，这个选择器决定了哪些 Pod 是由这个 Deployment 管理的
      </p>
     </li>
     <li>
      <p>
       <code>
        spec.template.metadata.lables
       </code>
       ：定义了 Pod 的标签，这些标签需要与上面的
       <code>
        spec.selector
       </code>
       中的选择器匹配，以确保 Deployment 能够识别和管理这些 Pod。
      </p>
     </li>
    </ul>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1    <span class="token comment"># API版本</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment       <span class="token comment"># 资源类型</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>              <span class="token comment"># 资源元数据</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> deploy<span class="token punctuation">-</span>user<span class="token punctuation">-</span>service   <span class="token comment"># 资源名称</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>space      <span class="token comment"># 指定命名空间</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>                  <span class="token comment"># 资源规格</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>          <span class="token comment"># Pod副本数</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>            <span class="token comment"># 标签选择器</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>       <span class="token comment"># 匹配标签</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> user        
  <span class="token key atrule">template</span><span class="token punctuation">:</span>            <span class="token comment"># Pod模板</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>          <span class="token comment"># Pod元数据</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>          <span class="token comment"># Pod标签</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> user
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>              <span class="token comment"># Pod规格</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>      <span class="token comment"># Pod容器配置</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>srvice<span class="token punctuation">:</span>v3
        <span class="token key atrule">name</span><span class="token punctuation">:</span> web      <span class="token comment"># 容器名称</span>
</code></pre>
    <h3>
     <a id="2__176">
     </a>
     2. 应用升级
    </h3>
    <p>
     当源代码需要升级时，需要重新构建镜像并上传到K8s集群中，以下有2中常见的升级方法：
    </p>
    <ul>
     <li>
      修改资源文件，将
      <code>
       Deployment
      </code>
      资源中的
      <code>
       image
      </code>
      字段修改为新的镜像地址，然后使用
      <code>
       kubectl apply -f &lt;资源文件&gt;
      </code>
      命令。
     </li>
     <li>
      使用
      <code>
       kubectl set image &lt;资源类型&gt;/资源名称 &lt;容器名称&gt;=&lt;镜像地址&gt;
      </code>
      命令更新
      <code>
       Deployment
      </code>
      资源的镜像地址。
     </li>
    </ul>
    <pre><code class="prism language-bash">kubectl <span class="token builtin class-name">set</span> image deployment/deploy-user-service <span class="token assign-left variable">web</span><span class="token operator">=</span>user-srvice:v4 <span class="token parameter variable">-n</span> my-space
</code></pre>
    <h2>
     <a id="_184">
     </a>
     结语
    </h2>
    <p>
     K8s的知识体系真的是太庞大了，本篇暂时写到这里，本篇涉及到的
     <code>
      Pod
     </code>
     和
     <code>
      Deployment
     </code>
     也只是真正相关知识的九牛一毛而已。但是学习一门新技术，不能按部就班地一个一个章节死磕每个知识点。要先对整体有个大概了解，着重看最主要最常用的功能，之后再反复的看书实践，提取知识点。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f77696e7465726b696e67332f:61727469636c652f64657461696c732f313436313936333631" class_="artid" style="display:none">
 </p>
</div>


