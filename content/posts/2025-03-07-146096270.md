---
layout: post
title: "前端下载文件"
date: 2025-03-07 15:14:59 +0800
description: "通常情况下，获取文件信息和获取这个文件本身是分开的。也就是说，你在页面上看到的文件名是一个接口拿到的，而这个接口中并不包含这个文件的内容，但会包含这个文件的id。之后在根据文件id再用另一个接口拿到这个文件的本体，这个过程没有什么不对，但会存在的问题就是，文件的本体可能并没有这个文件的文件名信息，所以你下载时需要给一个逻辑文件名（自己随便起），或者最简单的保证文件名不变的方法（我能想到的）就是直接传对象，用一个map关联。"
keywords: "前端下载文件"
categories: ['未分类']
tags: ['前端', 'Javascript']
artid: "146096270"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146096270
    alt: "前端下载文件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146096270
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146096270
cover: https://bing.ee123.net/img/rand?artid=146096270
image: https://bing.ee123.net/img/rand?artid=146096270
img: https://bing.ee123.net/img/rand?artid=146096270
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端下载文件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="_0">
     </a>
     前端下载文件时，需要注意的坑
    </h4>
    <p>
     通常情况下，获取文件信息和获取这个文件本身是分开的。也就是说，你在页面上看到的文件名是一个接口拿到的，而这个接口中并不包含这个文件的内容，但会包含这个文件的id。之后在根据文件id再用另一个接口拿到这个文件的本体，这个过程没有什么不对，但会存在的问题就是，文件的本体可能并没有这个文件的文件名信息，所以你下载时需要给一个逻辑文件名（自己随便起），或者最简单的保证文件名不变的方法（我能想到的）就是直接传对象，用一个map关联
    </p>
    <pre><code class="prism language-ts"><span class="token keyword">const</span> fileMap <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> checkedFile <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 被选择的文件id</span>

<span class="token keyword">const</span> <span class="token function-variable function">getFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> 你的获取文件的操作

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      fileMap<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>file_id<span class="token punctuation">,</span> item<span class="token punctuation">.</span>customize_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">...</span> 其他操作
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 先给map填一遍数据</span>

<span class="token keyword">const</span> <span class="token function-variable function">downloadFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"下载文件"</span><span class="token punctuation">,</span> checkedFile<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> checkedFile<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getYourDownloadPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> item<span class="token punctuation">;</span> <span class="token comment">// 你的获取文件内容的接口</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
      axios
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
          headers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            Authorization<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 你的token（可选）</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          responseType<span class="token operator">:</span> <span class="token string">"blob"</span><span class="token punctuation">,</span> <span class="token comment">// 设置响应类型为blob，之后要构建下载链接</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建下载链接 start</span>
          <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>res<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> downloadUrl <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          link<span class="token punctuation">.</span>href <span class="token operator">=</span> downloadUrl<span class="token punctuation">;</span>
          link<span class="token punctuation">.</span>download <span class="token operator">=</span> fileMap<span class="token punctuation">.</span>value<span class="token operator">?.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span> <span class="token comment">// map查找对应</span>
          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
          link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
          window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>downloadUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 创建下载链接 end</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      message<span class="token punctuation">.</span><span class="token function">openMessage</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token constant">TYPE</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37393832323937352f:61727469636c652f64657461696c732f313436303936323730" class_="artid" style="display:none">
 </p>
</div>


