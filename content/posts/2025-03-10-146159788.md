---
layout: post
title: "MongoDB-自动化部署"
date: 2025-03-10 17:43:56 +0800
description: "这个参数可以自动创建指定的目录，注意确保docker 用户在这个目录存在权限。部署在容器中，并且自动创建所需用户和权限等。运行容器后的初始化流程。"
keywords: "MongoDB 自动化部署"
categories: ['数据库', 'Mongodb']
tags: ['自动化', '数据库', 'Mongodb']
artid: "146159788"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146159788
    alt: "MongoDB-自动化部署"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146159788
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146159788
cover: https://bing.ee123.net/img/rand?artid=146159788
image: https://bing.ee123.net/img/rand?artid=146159788
img: https://bing.ee123.net/img/rand?artid=146159788
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MongoDB 自动化部署
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <blockquote>
     <p>
      部署在容器中，并且自动创建所需用户和权限等
     </p>
    </blockquote>
    <pre><code class="language-bash"># 启动 mongoDB
  sudo docker run -dit --name china_fish_mongo \
-p 27017:27017 \
-v /data/project1/db/mongo/config/mongod.conf:/etc/mongod.conf \
-v /data/project1/db/mongo/data:/data/db \
-v /data/project1/db/mongo/logs:/var/log/mongodb \
-v /Scripts/init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro \
-e MONGO_INITDB_ROOT_USERNAME=admin \
-e MONGO_INITDB_ROOT_PASSWORD=password_str\
--restart=always  \
mongo:6.0.2

# 启动 redis
sudo docker run -d --restart unless-stopped \
--name china_fish_redis -p 6379:6379 \
-v /dorothy/data/fish_server/redis/:/data \
redis:5 redis-server --save 60 1 "--requirepass password_str"</code></pre>
    <p>
     -v
    </p>
    <blockquote>
     <p>
      这个参数可以自动创建指定的目录，注意确保docker 用户在这个目录存在权限
     </p>
    </blockquote>
    <p>
     docker-entrypoint-initdb.d 容器第一次启动执行的脚本目录
    </p>
    <blockquote>
     <p>
      The
      <code>
       /docker-entrypoint-initdb.d
      </code>
      directory is a special initialization directory used by several popular database Docker images to automatically execute scripts when a container is first started. This feature allows you to initialize your database with custom schemas, data, or configuration upon container creation.
     </p>
    </blockquote>
    <p>
     参考
     <a href="https://hub.docker.com/_/mongo" rel="nofollow" title="mongo - Official Image | Docker Hub">
      mongo - Official Image | Docker Hub
     </a>
    </p>
    <p>
     /Scripts/init-mongo.js
    </p>
    <blockquote>
     <p>
      运行容器后的初始化流程
     </p>
    </blockquote>
    <pre><code class="language-javascript"># 数据库
db = db.getSiblingDB('admin');

# 创建用户
db.createUser({
  user: 'wod',
  pwd: 'ds0nxCM7fc65uM',
  roles: [
    { role: 'readWrite', db: 'xxx1' },
    { role: 'readWrite', db: 'xxx2' },
  ]
});

# 提前创建一些必要索引等</code></pre>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363739303037342f:61727469636c652f64657461696c732f313436313539373838" class_="artid" style="display:none">
 </p>
</div>


