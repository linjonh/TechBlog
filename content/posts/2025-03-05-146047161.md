---
layout: post
title: "聊天室Python脚本ChatGPT,好用"
date: 2025-03-05 16:49:05 +0800
description: "不用安装第三方软件，简单方便，某些情况下很好用"
keywords: "聊天室Python脚本——ChatGPT，好用"
categories: ['未分类']
tags: ['开发语言', 'Python', 'Chatgpt']
artid: "146047161"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146047161
    alt: "聊天室Python脚本ChatGPT,好用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146047161
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146047161
cover: https://bing.ee123.net/img/rand?artid=146047161
image: https://bing.ee123.net/img/rand?artid=146047161
img: https://bing.ee123.net/img/rand?artid=146047161
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     聊天室Python脚本——ChatGPT，好用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     下面提供两个 Python 脚本，一个作为服务器端（chat_server.py），一个作为客户端（chat_client.py）。你可以在一台电脑上运行服务器脚本，然后在不同电脑上运行客户端脚本（连接时指定服务器的 IP 地址），实现多台电脑之间互相发送消息聊天。
    </p>
    <hr/>
    <h3>
     <a id="chat_serverpy_4">
     </a>
     服务器端代码（chat_server.py）
    </h3>
    <p>
     该脚本实现了以下功能：
    </p>
    <ul>
     <li>
      监听所有网络接口的指定端口（例如 12345）。
     </li>
     <li>
      接受客户端连接，并为每个连接启动一个线程进行处理。
     </li>
     <li>
      每当收到客户端发送的消息，就将该消息广播给其他所有已连接的客户端。
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading

<span class="token comment"># 保存所有客户端连接的列表，使用锁保证线程安全</span>
clients <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">broadcast</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> sender_socket<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> lock<span class="token punctuation">:</span>
        <span class="token keyword">for</span> client <span class="token keyword">in</span> clients<span class="token punctuation">:</span>
            <span class="token keyword">if</span> client <span class="token operator">!=</span> sender_socket<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"发送消息错误："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handle_client</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"新连接：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>addr<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            message <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> message<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>addr<span class="token punctuation">}</span></span><span class="token string"> 断开连接"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"收到来自 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>addr<span class="token punctuation">}</span></span><span class="token string"> 的消息：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>message<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            broadcast<span class="token punctuation">(</span>message<span class="token punctuation">,</span> client_socket<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"处理 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>addr<span class="token punctuation">}</span></span><span class="token string"> 时发生错误：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">with</span> lock<span class="token punctuation">:</span>
        <span class="token keyword">if</span> client_socket <span class="token keyword">in</span> clients<span class="token punctuation">:</span>
            clients<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>client_socket<span class="token punctuation">)</span>
    client_socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    server_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
    host <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span>  <span class="token comment"># 绑定所有可用的网络接口</span>
    port <span class="token operator">=</span> <span class="token number">12345</span>
    server_socket<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
    server_socket<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"服务器启动，监听端口 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>port<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        client_socket<span class="token punctuation">,</span> addr <span class="token operator">=</span> server_socket<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> lock<span class="token punctuation">:</span>
            clients<span class="token punctuation">.</span>append<span class="token punctuation">(</span>client_socket<span class="token punctuation">)</span>
        thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>handle_client<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="chat_clientpy_67">
     </a>
     客户端代码（chat_client.py）
    </h3>
    <p>
     该脚本实现了以下功能：
    </p>
    <ul>
     <li>
      连接到指定服务器（需要输入服务器的 IP 地址）和端口（与服务器一致）。
     </li>
     <li>
      启动一个线程不断接收服务器转发的消息，并打印在屏幕上。
     </li>
     <li>
      主线程读取用户输入，并将消息发送到服务器（输入 “exit” 即可退出）。
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">receive_messages</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            message <span class="token operator">=</span> client_socket<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> message<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"服务器关闭了连接。"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"收到消息："</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"接收消息错误："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            <span class="token keyword">break</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    client_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
    server_ip <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入服务器 IP 地址："</span><span class="token punctuation">)</span>
    port <span class="token operator">=</span> <span class="token number">12345</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        client_socket<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>server_ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"连接服务器失败："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"成功连接到聊天服务器。你可以开始发送消息了（输入 'exit' 退出）。"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 启动接收消息的线程</span>
    thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>receive_messages<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    thread<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>
    thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        message <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> message<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"exit"</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            client_socket<span class="token punctuation">.</span>send<span class="token punctuation">(</span>message<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"发送消息错误："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            <span class="token keyword">break</span>

    client_socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_126">
     </a>
     运行说明
    </h3>
    <ol>
     <li>
      <p>
       <strong>
        服务器端
       </strong>
       <br/>
       在一台电脑上运行服务器脚本：
      </p>
      <pre><code class="prism language-bash">python3 chat_server.py
</code></pre>
      <p>
       服务器将监听本机所有网络接口的 12345 端口。
      </p>
     </li>
     <li>
      <p>
       <strong>
        客户端
       </strong>
       <br/>
       在其他电脑上运行客户端脚本：
      </p>
      <pre><code class="prism language-bash">python3 chat_client.py
</code></pre>
      <p>
       按提示输入服务器的 IP 地址（服务器所在电脑的局域网 IP 或公网 IP），连接成功后即可相互聊天。
      </p>
     </li>
    </ol>
    <p>
     这种简单实现仅适用于基础演示，实际使用时可能需要增加错误处理、安全认证等机制。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f4d63517565656e5f4c542f:61727469636c652f64657461696c732f313436303437313631" class_="artid" style="display:none">
 </p>
</div>


