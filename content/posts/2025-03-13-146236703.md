---
layout: post
title: "linux系统安全"
date: 2025-03-13 17:07:46 +0800
description: "未用 sudo 的情况SIOCSIFADDR:不允许的操作 SIOCSIFFLAGS:不允许的操作 SIOCSIFNETMASK:不允许的操作 [jerry@localhost ~]$ sudo /sbin/ifconfig ens33:0 192.168.1.11/24//在CentoS7操作系统中，执行“cat/etcinittab”命令可知 Ctrl+Alt+De组合键功能由/usr/lib/systemd/system/ctrl-alt-del.target 文件进行设置。"
keywords: "linux系统安全"
categories: ['Linux']
tags: ['运维', '系统安全', 'Linux']
artid: "146236703"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146236703
    alt: "linux系统安全"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146236703
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146236703
cover: https://bing.ee123.net/img/rand?artid=146236703
image: https://bing.ee123.net/img/rand?artid=146236703
img: https://bing.ee123.net/img/rand?artid=146236703
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     linux系统安全
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     管理终端登录
    </h3>
    <p>
     [root@localhost ~]# grep "/sbin/nologin$" /etc/passwd
    </p>
    <p>
     表示禁止终端登录，应确保不被人改动
    </p>
    <p>
     输出结果：
    </p>
    <p>
     bin：x:1:1:bin:/bin:/sbin/nologin
    </p>
    <p>
     daemon：x:2:2:daemon:/sbin:/sbin/nologin
    </p>
    <p>
     adm：x:3:4:adm:/var/adm:/sbin/nologin
    </p>
    <p>
     lp：x:4:7:lp:/var/spool/lpd:/sbin/nologin
    </p>
    <p>
     mail：x:8:12:mail:/var/spool/mail:/sbin/nologin
    </p>
    <p>
     operator：x:11:0:operator:/root:/sbin/nologin
    </p>
    <p>
     games：x:12：100:games:/usr/games:/sbin/nologin
    </p>
    <p>
     ftp：x:14:50:FTP User:/var/ftp:/sbin/nologin
    </p>
    <p>
     nobody：x:99:99:Nobody:/:/sbin/nologin
    </p>
    <p>
     systemd-network：x:192:192:systemd Network Management:/:/sbin/nologin
    </p>
    <p>
     dbus：x:81:81:System message bus:/:/sbin/nologin
    </p>
    <p>
     polkitd：x:999:998:User for polkitd:/:/sbin/nologin
    </p>
    <p>
     libstoragemgmt：x:998:995:daemon account for libstoragemgmt:/var/run/lsm:/sbin/nologin
    </p>
    <p>
     colord：x:997:994:User for colord:/var/lib/colord:/sbin/nologin
    </p>
    <p>
     rpc：x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin
    </p>
    <p>
     saned：x:996:993:SANE scanner daemon user:/usr/share/sane:/sbin/nologin
    </p>
    <p>
     gluster：x:995:992:GlusterFS daemons:/run/gluster:/sbin/nologin
    </p>
    <p>
     saslauth：x:994:76:Saslauthd user:/run/saslauthd:/sbin/nologin
    </p>
    <p>
     abrt：x:173:173::/etc/abrt:/sbin/nologin setroubleshoot:：:993:990::/var/lib/setroubleshoot:/sbin/nologin
    </p>
    <p>
     rtkit：x:172:172:RealtimeKit:/proc:/sbin/nologin
    </p>
    <p>
     pulse：x:171:171:PulseAudio System Daemon:/var/run/pulse:/sbin/nologin
    </p>
    <p>
     radvd：x:75:75:radvd user:/:/sbin/nologin
    </p>
    <p>
     chrony：x:992:987::/var/lib/chrony:/sbin/nologin
    </p>
    <p>
     unbound：x:991:986:Unbound DNS resolver:/etc/unbound:/sbin/nologin
    </p>
    <p>
     qemu：x:107:107:qemu user:/:/sbin/nologin
    </p>
    <p>
     tss：x:59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin
    </p>
    <p>
     sssd：x:990:984:User for sssd:/:/sbin/nologin usbmuxd：x:113:113:usbmuxd user:/:/sbin/nologin
    </p>
    <p>
     geoclue：x:989:983:User for geoclue:/var/lib/geoclue:/sbin/nologin
    </p>
    <p>
     ntp：x:38:38::/etc/ntp:/sbin/nologin gdm：x:42:42::/var/lib/gdm:/sbin/nologin
    </p>
    <p>
     rpcuser：x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin nfsnobody：x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin
    </p>
    <p>
     gnome-initial-setup：x:988:982::/run/gnome-initial-setup/:/sbin/nologin
    </p>
    <p>
     sshd：x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
    </p>
    <p>
     avahi：x:70:70:Avahi mDNS/DNS-SD Stack:/var/run/avahi-daemon:/sbin/nologin
    </p>
    <p>
     postfix：x:89:89::/var/spool/postfix:/sbin/nologin tcpdump：x:72:72::/:/sbin/nologin
    </p>
    <p>
    </p>
    <h3>
     账号管理
    </h3>
    <p>
    </p>
    <p>
     [root@localhost ~]# usermod -L chen
    </p>
    <p>
     -L表示：锁定账号
    </p>
    <p>
     [root@localhost ~]# passwd -S chen
    </p>
    <p>
     -S表示：查看账号状态
    </p>
    <p>
     输出结果：
    </p>
    <p>
     chen LK 2025-02-27 0 99999 7 -1 (Password locked.) [root@localhost ~]# usermod -U chen
    </p>
    <p>
     -U表示：解锁账号
    </p>
    <p>
     [root@localhost ~]# passwd -S chen
    </p>
    <p>
     输出结果：
    </p>
    <p>
     chen PS 2025-02-27 0 99999 7 -1 (Password set, SHA256 crypt.)
    </p>
    <p>
    </p>
    <p>
     文件管理
    </p>
    <p>
     +i表示：锁定状态
    </p>
    <p>
     [root@localhost ~]# chattr +i /etc/passwd /etc/shadow
    </p>
    <p>
     查看文件状态
    </p>
    <p>
     [root@localhost ~]# lsattr /etc/passwd /etc/shadow ----i----------- /etc/passwd ----i----------- /etc/shadow
    </p>
    <p>
     -i表示：解锁状态
    </p>
    <p>
     [root@localhost ~]# chattr -i /etc/passwd /etc/shadow
    </p>
    <p>
     查看文件状态
    </p>
    <p>
     [root@localhost ~]# lsattr /etc/passwd /etc/shadow ---------------- /etc/passwd ---------------- /etc/shadow
    </p>
    <p>
    </p>
    <p>
     锁定文件 （锁定文件后无法打开文件）
    </p>
    <p>
     [root@localhost ~]# chattr +i /etc/passwd /etc/shadow
    </p>
    <p>
     查看文件
    </p>
    <p>
     [r 结果：
    </p>
    <p>
     useradd: cannot open /etc/passwd
    </p>
    <h3>
    </h3>
    <h3>
     密码安全控制
    </h3>
    <p>
     通过更改文件，改变密码期限
    </p>
    <p>
     [root@localhost ~]# vi /etc/login.defs （适用于新建的用户）
    </p>
    <p>
     删除前面的#，将days 后改为30
    </p>
    <p>
     PASS_MAX_DAYS 30 (用户密码有效期30天)
    </p>
    <p>
     用命令对已创建的lisi用户，改变命令期限
    </p>
    <p>
     [root@localhost ~]# chage -M 30 lisi
    </p>
    <p>
    </p>
    <p>
     设置用户下次登录就要修改密码：
    </p>
    <p>
     [root@localhost ~]# chage -d 0 lisi
    </p>
    <p>
    </p>
    <p>
     将历史命令改为存储上限为200
    </p>
    <p>
     [root@localhost ~]# vi /etc/profile
    </p>
    <p>
     [root@localhost ~]#export HISTSIZE=200
    </p>
    <p>
    </p>
    <p>
     当用户退出已登录bash环境，
    </p>
    <p>
     [root@localhost ~]# vi ~/.bash_logout
    </p>
    <p>
     #~/.bash_logout
    </p>
    <p>
     histoy -c clear
    </p>
    <p>
     ：x （保存cat 查看~/.bash_logout文件）
    </p>
    <p>
    </p>
    <p>
     [root@localhost ~]# vi /etc/profile
    </p>
    <p>
     ......//省略部分内容
    </p>
    <p>
     export TMOUT=600 （编辑/etc/profile文件）
    </p>
    <p>
     [root@localhost ~]# export TMOUT=600
    </p>
    <p>
     闲置600s自动账户注销，
    </p>
    <p>
    </p>
    <h3>
     切换用户
    </h3>
    <p>
     su命令
    </p>
    <p>
     [jerry@localhost ~]s su - root //输入用户 root的口令
    </p>
    <p>
     密码: [root@localhost ~]# //验证成功后获得 root权限
    </p>
    <p>
     添加到组
    </p>
    <p>
     [root@localhost ~]# gpasswd -a tsengyia wheel
    </p>
    <p>
     正在将用户"tsengyia"加入"wheel"组中 //添加授权用户 tsengyia
    </p>
    <p>
     [root@localhost ~]# grep wheel /etc/group //确认 wheel 组成员
    </p>
    <p>
     wheel：x:10:tsengyia
    </p>
    <p>
     [root@localhost~]# vi /etc/pam.d/su
    </p>
    <p>
     启用 pam_wheel 认证以后，未加入 wheel 组内的其他用户将无法使用“su”命令，尝试进行切换时会提示“拒绝权限”，将切换用户的权限控制在最小
    </p>
    <p>
    </p>
    <p>
     [jerry@localhost ~]$su-root //尝试切换为 root 密码: su:拒绝权限
    </p>
    <p>
     在/cic/sudoens 配置文件中，授权记录的
    </p>
    <p>
     基本配置格式如下: user MACHINE=COMMANDS
    </p>
    <p>
     注：
    </p>
    <p>
     用户(user):直接授权指定的用户名，或采用“%组名”的形式授权一个组的所有用户，
    </p>
    <p>
     主机(MACHINE):使用此配置文件的主机名称。此部分主要是方便在多个主机间共用同份 sudoers 文件，一般设为 localhost 或实际的主机名即可。
    </p>
    <p>
     命令(COMMANDS):允许授权的用户通过sudo方式执行的特权命令，需填写命令程产完整路径，多个命令之间以逗号“”进行分隔。
    </p>
    <p>
    </p>
    <p>
     能够执行“ifconfg”命令来修改IP地址，而 whecl组的用户无须验证密码即可执行任何命令,可以执行以下命令。 [root@localhost~]# visudo//省略部分内容 Jerry localhost=/sbin/ifconfig &amp;wheel ALL=NOPASSWD:ALL
    </p>
    <p>
    </p>
    <p>
     当使用相同授权的用户较多，或者授权的命令较多时，可以采用集中定义的别名。用户，主机命令部分都可以定义为别名[必须为大写]，分别通过关键字User_Alias、Host_Alias、Cmmd进行设置。
    </p>
    <p>
     例如，执行以下命令通过别名方式来添加授权记录，允许用户jemy、tom、tsengsmtp、pop 中执行“rpm”和“yum”命令。 [root@localhost )# visudo
    </p>
    <p>
    </p>
    <p>
     sudo配置记录的命令部分允许使用通配符“*”，取反符号“!”，它们常被用于授权某个目录下的所有命令或取消其中个别命令。例如，若要授权用户syimner可以执行sbin/目录下除ifconfg.route外的其他所有命令程序，那么可以执行以下命令。 [root@localhost ~]# visudo
    </p>
    <p>
     默认情况下，通过 sudo 方式执行的操作并不记录。
    </p>
    <p>
     若要启用 sudo 日志记录以备管理员查看，那么应在/etc/sudoers 文件中增加“Defaults logfle”设置。 [root@localhost ~]# visudo //查找 Defaults,在前面添加一行内容
    </p>
    <p>
     //省略部分内容
    </p>
    <p>
    </p>
    <p>
     对于已获得授权的用户，通过sudo 方式执行特权命令时，只需将正常的命令作为“sudo”命令的参数即可。由于特权命令程序通常位于/sbin、/usr/sbin 等目录下，所以普通用户执行时应使用绝对路径。以下命令验证了使用 sudo 方式执行命令的过程。
    </p>
    <p>
     [jerry@localhost ~]s/sbin/ifconfig ens33:0 192.168.1.11/24//
    </p>
    <p>
     未用 sudo 的情况SIOCSIFADDR:不允许的操作 SIOCSIFFLAGS:不允许的操作 SIOCSIFNETMASK:不允许的操作 [jerry@localhost ~]$ sudo /sbin/ifconfig ens33:0 192.168.1.11/24//
    </p>
    <p>
     查询结果 [sudo] password for jerry:
    </p>
    <p>
     [jerry@localhost ~]$/sbin/ifconfig ens33:0 ……//省略部分内容 //验证 jerry 的密码//查看执行结果
    </p>
    <p>
    </p>
    <p>
     若要查看用户自己获得了哪些 sudo 授权，那么可以执行“sudo -1”命令进行查看。（未授权的用)将会得到“may notrun sudo”的提示，
    </p>
    <p>
     已授权的用户则可以看到自己的 sudo 配置。 [syrianer@localhost ~]$ sudo -l
    </p>
    <p>
    </p>
    <h3>
     开关机安全控制
    </h3>
    <p>
     调整 BIOS引导设置 (1)将第一优先引导设备(First BootDevice)设为当前操作系统所在磁盘。 (2)禁止从其他设备(如光盘、U盘、网络等)引导操作系统，对应的项设为“Disabled”
    </p>
    <p>
     (3)将 BIOS 的安全级别改为“setup”，并设置好管理密码，以防范未授权的修改。
    </p>
    <p>
     禁止 Ctrl+Alt+ Del 组合键重启
    </p>
    <p>
     组合键重启功能为服务器的本地维护提供了便利，但对于多终端登录的Linux 服务器而言，禁用此功能是比较安全的
    </p>
    <p>
     在CentoS7操作系统中，执行“cat/etcinittab”命令可知 Ctrl+Alt+De组合键功能由/usr/lib/systemd/system/ctrl-alt-del.target 文件进行设置。
    </p>
    <p>
     查看/usr/lib/systemd/systemlctlalt-del.target 文件发现，
    </p>
    <p>
     cirl-alt-del.target是reboot,target 文件的软链接文件。
    </p>
    <p>
     [root@localhost]# cat /etc/inittab
    </p>
    <p>
    </p>
    <p>
     在不影响 reboot.target 文件的前提下执行以下命令即可禁用 Cu+AH+DeL组合键功能, [rootelocalhost~]#systemctl mask ctrl-alt-del.target
    </p>
    <p>
     //注销ctr1-alt-de1 服务
    </p>
    <p>
     服务created symlink from /etc/systemd/system/ctrl-alt-del.target to /dev/null.
    </p>
    <p>
     [root@localhost~]# systemctl daemon-reload //重新加载 systemd 配置
    </p>
    <p>
     小结：
    </p>
    <p>
     systemctl mask命令用于注销指定服务，例如，systemctlmask cpu.service命令用于注销 CPU务,取消注销则使用systemctl umask命令。因此，若想重新开启 Ctl+Alt+Del 组合键功能,则需执行systemctlunmask ctrl-alt-del.target命令，然后刷新配置即可。
    </p>
    <p>
     为 GRUB 菜单设置的密码建议采用
    </p>
    <p>
     “grub2-mkpasswd-pbkdf2”命令生成。生成密码后，在/etc/grub.d/00 header 配置文件中添加对应的用户密码等配置，具体添加内容如下：
    </p>
    <p>
     [root@localhost~]# grub2-mkpasswd-pbkdf2
    </p>
    <p>
     Enter password: //根据提示设置密码 Reenter password:
    </p>
    <p>
     //经过加密的密码字符串
    </p>
    <p>
     [root@localhost ~]#cp /boot/grub2/grub.cfg /boot/grub2/grub.cfg.bak
    </p>
    <p>
     [root@localhost ~]# cp /etc/grub.d/00 header /ete/grub.d/00 header .bak
    </p>
    <p>
     [root@localhost ~]# vim /etc/grub.d/00 header
    </p>
    <p>
     //将下面的内容添加到文件最后 …//省略部分内容
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f7869616f6368656e7368656e79752f:61727469636c652f64657461696c732f313436323336373033" class_="artid" style="display:none">
 </p>
</div>


