---
layout: post
title: "ElasticSearch学习笔记"
date: 2025-03-15 23:23:32 +0800
description: "segment是一个具备完整搜索功能的最小单元。多个segment组成了一个单机文本检索库lucene。"
keywords: "【ElasticSearch】学习笔记"
categories: ['未分类']
tags: ['笔记', '学习']
artid: "146286842"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146286842
    alt: "ElasticSearch学习笔记"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146286842
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146286842
cover: https://bing.ee123.net/img/rand?artid=146286842
image: https://bing.ee123.net/img/rand?artid=146286842
img: https://bing.ee123.net/img/rand?artid=146286842
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【ElasticSearch】学习笔记
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、lucene的组成
    </h2>
    <p>
     <strong>
      segment是一个具备完整搜索功能的最小单元。
     </strong>
    </p>
    <p>
     <strong>
      多个segment组成了一个单机文本检索库lucene。
     </strong>
    </p>
    <p>
     <img alt="" height="1079" src="https://i-blog.csdnimg.cn/direct/6de2ab9e99a74cc4b614759252f65151.png" width="909"/>
    </p>
    <ul>
     <li>
      <strong>
       inverted index:
      </strong>
      倒排索引，用于快速根据关键词找到对应的文章
     </li>
     <li>
      <strong>
       term index:
      </strong>
      构建出关键词的目录树，解决了
      <strong>
       term dictionary
      </strong>
      数据量过大，无法加入到内存的问题，通过term index加载到内存中，提高了查询效率
     </li>
     <li>
      <strong>
       Stored Fields
      </strong>
      :将数据内容持久化到磁盘中。
     </li>
     <li>
      <strong>
       ​Doc Values：
      </strong>
      基于某种数据（时间、价格）提前排序，用于快速排序查找和聚合。
     </li>
    </ul>
    <h2>
     二、ElasticSearch
    </h2>
    <h3>
     1、高性能
    </h3>
    <ul>
     <li>
      一个index name对应一个lucene避免过多的资源争抢
     </li>
     <li>
      单个index name拆分为shard分片，每个shard分片作为一个独立的Lucene库
     </li>
    </ul>
    <h3>
     2、高扩展
    </h3>
    <ul>
     <li>
      将分片部署在多个机器上，缓解单机压力
     </li>
    </ul>
    <h3>
     3、高可用
    </h3>
    <ul>
     <li>
      存在副本分片，主副封片读写分离，若主分片宕机，副本自动晋升为主分片。
     </li>
     <li>
      node角色分化，各司其职（处理用户请求、处理数据、处理节点管理）。
     </li>
     <li>
      每个节点存在raft模块，同步各个结点的信息数据，所以node看到的集群状态一致。
     </li>
    </ul>
    <h2>
     三、ElasticSearch的写流程
    </h2>
    <ol>
     <li>
      用户发送请求到协调节点，协调节点根据哈希路由找到请求对应的node中的分片
     </li>
     <li>
      写入到对应分片的lucene库里的segment类的inverted index、term index、sorted field、doc value里面
     </li>
     <li>
      主分片将数据同步到副本
     </li>
     <li>
      副本携入完成相应主节点发送Ack确认到协调节点，写入操作完成
     </li>
    </ol>
    <h2>
     四、ElasticSearch的读流程
    </h2>
    <h3>
     1、Query阶段
    </h3>
    <ol>
     <li>
      用户发送请求到协调节点，协调节点根据index name查询到分片信息将请求转发到数据节点的
     </li>
     <li>
      分片上的lucene并发搜索多个segment
     </li>
     <li>
      返回找到的文档ID和聚合结果
     </li>
     <li>
      返回查询结果
     </li>
    </ol>
    <h3>
     2、Fetch阶段
    </h3>
    <ol>
     <li>
      用户使用拿到的文档ID再次请求拿去数据
     </li>
     <li>
      协调节点分发到对应Node的Shard分片，读取segment中的sorted fields
     </li>
     <li>
      返回文档原始信息到用户
     </li>
    </ol>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37333830393036342f:61727469636c652f64657461696c732f313436323836383432" class_="artid" style="display:none">
 </p>
</div>


