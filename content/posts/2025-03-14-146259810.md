---
layout: post
title: "GPT入门第20课-langchain的function-calling-初步体验"
date: 2025-03-14 16:09:32 +08:00
description: "query = “3 加 4的和 的 5 倍是多少？”  这个会调用两次函数。query = \" 4的 5 倍是多少？"
keywords: "【GPT入门】第20课 langchain的function calling 初步体验"
categories: ['大模型']
tags: ['Python', 'Langchain', 'Gpt']
artid: "146259810"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146259810
    alt: "GPT入门第20课-langchain的function-calling-初步体验"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146259810
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146259810
cover: https://bing.ee123.net/img/rand?artid=146259810
image: https://bing.ee123.net/img/rand?artid=146259810
img: https://bing.ee123.net/img/rand?artid=146259810
---

# 【GPT入门】第20课 langchain的function calling 初步体验
## 1\. langchain的function calling 非常简洁
1. 在方法名说明方法用途和参数作用
2. 增加@tool 标签
3. langchain方法自动把@tool转为方法定义，后续方法调用都很简洁
下面代码用支持单函数与多函数调用，自己体验一下
query = “3 加 4的和 的 5 倍是多少？” 这个会调用两次函数
query = " 4的 5 倍是多少？"
## 2\. 代码
from langchain\_core.messages import HumanMessage
from langchain\_core.tools import tool
from langchain\_openai import ChatOpenAI
@tool
def add(a: int, b: int) -> int:
"""Add two integers together.
Args:
a: The first integer.
b: The second integer.
"""
return a + b
@tool
def multiply(a: int, b: int) -> int:
"""Multiply two integers together.
Args:
a: The first integer.
b: The second integer.
"""
return a \* b
import json
# model\_name = 'gpt-4o-mini'
# model\_name = 'gpt-4'
# llm = ChatOpenAI(model\_name=model\_name)
llm = ChatOpenAI()
llm\_with\_tools = llm.bind\_tools([add, multiply])
query = "3 加 4的和 的 5 倍是多少？"
# query = " 4的 5 倍是多少？"
messages = [HumanMessage(content=query)]
output = llm\_with\_tools.invoke(messages)
print(output)
print("------------tool\_calls:")
print(json.dumps(output.tool\_calls, indent=4))
messages.append(output)
avaliable\_tools = {"add":add, "multiply": multiply}
for tool\_call in output.tool\_calls:
selected\_tools = avaliable\_tools[tool\_call["name"].lower()] # tool\_call就是一个字典
tool\_msg = selected\_tools.invoke(tool\_call)
messages.append(tool\_msg)
print("tool\_msg:, type:", type(tool\_msg)) # 
print(tool\_msg)
# content='20' name='multiply' tool\_call\_id='call\_e5EY7klNZlBD8W68y7X0BcYD'
new\_output = llm\_with\_tools.invoke(messages)
for message in messages:
print("message.dump:")
print(json.dumps(message.model\_dump(), indent=4, ensure\_ascii=False))
print(new\_output.content)
## 3\. 执行结果：
C:\ProgramData\anaconda3\envs\gptLearning\python.exe E:\workspace\gptLearning\gptLearning\ls10\functionCalling\ls01\_tools.py
content='' additional\_kwargs={'tool\_calls': [{'id': 'call\_0HGpTdeo2zm9G6zZPbewVi8g', 'function': {'arguments': '{"a": 3, "b": 4}', 'name': 'add'}, 'type': 'function'}, {'id': 'call\_m6Uc0OfQ9ea0uTyFNbwEWIBq', 'function': {'arguments': '{"a": 7, "b": 5}', 'name': 'multiply'}, 'type': 'function'}], 'refusal': None} response\_metadata={'token\_usage': {'completion\_tokens': 49, 'prompt\_tokens': 121, 'total\_tokens': 170, 'completion\_tokens\_details': None, 'prompt\_tokens\_details': None}, 'model\_name': 'gpt-3.5-turbo-0125', 'system\_fingerprint': 'fp\_0165350fbb', 'finish\_reason': 'tool\_calls', 'logprobs': None} id='run-e83caecd-ca6f-4851-b35e-b5ea8f2804a2-0' tool\_calls=[{'name': 'add', 'args': {'a': 3, 'b': 4}, 'id': 'call\_0HGpTdeo2zm9G6zZPbewVi8g', 'type': 'tool\_call'}, {'name': 'multiply', 'args': {'a': 7, 'b': 5}, 'id': 'call\_m6Uc0OfQ9ea0uTyFNbwEWIBq', 'type': 'tool\_call'}] usage\_metadata={'input\_tokens': 121, 'output\_tokens': 49, 'total\_tokens': 170, 'input\_token\_details': {}, 'output\_token\_details': {}}
------------tool\_calls:
[
{
"name": "add",
"args": {
"a": 3,
"b": 4
},
"id": "call\_0HGpTdeo2zm9G6zZPbewVi8g",
"type": "tool\_call"
},
{
"name": "multiply",
"args": {
"a": 7,
"b": 5
},
"id": "call\_m6Uc0OfQ9ea0uTyFNbwEWIBq",
"type": "tool\_call"
}
]
tool\_msg:, type: 
content='7' name='add' tool\_call\_id='call\_0HGpTdeo2zm9G6zZPbewVi8g'
tool\_msg:, type: 
content='35' name='multiply' tool\_call\_id='call\_m6Uc0OfQ9ea0uTyFNbwEWIBq'
message.dump:
{
"content": "3 加 4的和 的 5 倍是多少？",
"additional\_kwargs": {},
"response\_metadata": {},
"type": "human",
"name": null,
"id": null,
"example": false
}
message.dump:
{
"content": "",
"additional\_kwargs": {
"tool\_calls": [
{
"id": "call\_0HGpTdeo2zm9G6zZPbewVi8g",
"function": {
"arguments": "{\"a\": 3, \"b\": 4}",
"name": "add"
},
"type": "function"
},
{
"id": "call\_m6Uc0OfQ9ea0uTyFNbwEWIBq",
"function": {
"arguments": "{\"a\": 7, \"b\": 5}",
"name": "multiply"
},
"type": "function"
}
],
"refusal": null
},
"response\_metadata": {
"token\_usage": {
"completion\_tokens": 49,
"prompt\_tokens": 121,
"total\_tokens": 170,
"completion\_tokens\_details": null,
"prompt\_tokens\_details": null
},
"model\_name": "gpt-3.5-turbo-0125",
"system\_fingerprint": "fp\_0165350fbb",
"finish\_reason": "tool\_calls",
"logprobs": null
},
"type": "ai",
"name": null,
"id": "run-e83caecd-ca6f-4851-b35e-b5ea8f2804a2-0",
"example": false,
"tool\_calls": [
{
"name": "add",
"args": {
"a": 3,
"b": 4
},
"id": "call\_0HGpTdeo2zm9G6zZPbewVi8g",
"type": "tool\_call"
},
{
"name": "multiply",
"args": {
"a": 7,
"b": 5
},
"id": "call\_m6Uc0OfQ9ea0uTyFNbwEWIBq",
"type": "tool\_call"
}
],
"invalid\_tool\_calls": [],
"usage\_metadata": {
"input\_tokens": 121,
"output\_tokens": 49,
"total\_tokens": 170,
"input\_token\_details": {},
"output\_token\_details": {}
}
}
message.dump:
{
"content": "7",
"additional\_kwargs": {},
"response\_metadata": {},
"type": "tool",
"name": "add",
"id": null,
"tool\_call\_id": "call\_0HGpTdeo2zm9G6zZPbewVi8g",
"artifact": null,
"status": "success"
}
message.dump:
{
"content": "35",
"additional\_kwargs": {},
"response\_metadata": {},
"type": "tool",
"name": "multiply",
"id": null,
"tool\_call\_id": "call\_m6Uc0OfQ9ea0uTyFNbwEWIBq",
"artifact": null,
"status": "success"
}
3 加 4 的和是 7，7 的 5 倍是 35。
Process finished with exit code 0
``