---
layout: post
title: "Windows控制台函数标准输入输出流交互函数GetStdHandle"
date: 2025-03-09 11:59:08 +0800
description: "想象你在用 C++ 写程序时，经常用 std::cout 来输出文字到屏幕上，对吧？return 0;这里 std::cout 是一个“工具”，它负责把文字送到屏幕上。但在 Windows 系统中，如果你不用 C++ 的标准库，而是直接跟操作系统“对话”，就需要用到 Windows 提供的一些函数，其中 GetStdHandle 就是帮你拿到类似 std::cout 这样的“工具”的。"
keywords: "控制台使用windows.h中的函数"
categories: ['控制台函数', 'Windows', 'Api']
tags: ['交互']
artid: "146129799"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146129799
    alt: "Windows控制台函数标准输入输出流交互函数GetStdHandle"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146129799
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146129799
cover: https://bing.ee123.net/img/rand?artid=146129799
image: https://bing.ee123.net/img/rand?artid=146129799
img: https://bing.ee123.net/img/rand?artid=146129799
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Windows控制台函数：标准输入输出流交互函数GetStdHandle（）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     GetStdHandle 是一个 Windows API 函数，用于获取标准输入、标准输出或标准错误设备的句柄。它定义在 Windows 的核心头文件 &lt;windows.h&gt; 中，通常用于控制台应用程序中，以便与标准输入输出流（如键盘输入或控制台输出）进行交互。
    </p>
    <h3 id="%E4%BB%80%E4%B9%88%E6%98%AF%20GetStdHandle%EF%BC%9F" name="%E4%BB%80%E4%B9%88%E6%98%AF%20GetStdHandle%EF%BC%9F">
     什么是 GetStdHandle？
    </h3>
    <p>
     <code>
      GetStdHandle
     </code>
     函数的全称是
     <strong>
      "Get Standard Handle"
     </strong>
     。
    </p>
    <ul>
     <li>
      <p>
       <strong>
        Get"
       </strong>
       ：表示这是一个获取操作。
      </p>
     </li>
     <li>
      <p>
       <strong>
        "Std"
       </strong>
       ：是
       <strong>
        Standard
       </strong>
       （标准）的缩写，指的是标准输入、输出或错误流。
      </p>
     </li>
     <li>
      <p>
       <strong>
        "Handle"
       </strong>
       ：指的是一个句柄（handle），在 Windows 中，句柄通常是对系统资源（如文件、窗口、输入输出流等）的一种引用或标识。
      </p>
     </li>
    </ul>
    <p>
     想象你在用 C++ 写程序时，经常用 std::cout 来输出文字到屏幕上，对吧？比如：
    </p>
    <pre><code class="language-cpp">#include &lt;iostream&gt;
int main() {
    std::cout &lt;&lt; "Hello, world!" &lt;&lt; std::endl;
    return 0;
}</code></pre>
    <p>
     这里 std::cout 是一个“工具”，它负责把文字送到屏幕上。但在 Windows 系统中，如果你不用 C++ 的标准库，而是直接跟操作系统“对话”，就需要用到 Windows 提供的一些函数，其中 GetStdHandle 就是帮你拿到类似 std::cout 这样的“工具”的。
    </p>
    <p>
     简单来说，GetStdHandle 是 Windows 给你的一个函数，它能让你拿到控制台的“钥匙”（专业术语叫“句柄”），有了这个钥匙，你就可以直接跟屏幕（或键盘）互动了。
    </p>
    <h3 id="%E5%AE%83%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%EF%BC%9F" name="%E5%AE%83%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%EF%BC%9F">
     它长什么样？
    </h3>
    <p>
     在 C++ 代码里，GetStdHandle 的样子是这样的：
    </p>
    <pre><code class="language-cpp">HANDLE GetStdHandle(DWORD nStdHandle);</code></pre>
    <ul>
     <li>
      <p>
       <strong>
        HANDLE:
       </strong>
       这是“钥匙”的类型，类似于一个指针，但具体是什么暂时不用管，只要知道它代表某个东西就行。
      </p>
     </li>
     <li>
      <p>
       <strong>
        DWORD:
       </strong>
       这是 Windows 定义的一个数字类型，相当于 unsigned int，用来告诉函数你想要哪把“钥匙”。
      </p>
     </li>
     <li>
      <p>
       <strong>
        nStdHandle:
       </strong>
       你传给函数的参数，告诉它“我想要屏幕的钥匙”还是“键盘的钥匙”。
      </p>
     </li>
    </ul>
    <p>
     常见的选项有：
    </p>
    <ul>
     <li>
      <p>
       STD_OUTPUT_HANDLE（写成 -11）：给我屏幕的钥匙，我想输出东西。（就是用来让程序
       <strong>
        往屏幕上打印
       </strong>
       内容）
      </p>
     </li>
     <li>
      <p>
       STD_INPUT_HANDLE（写成 -10）：给我键盘的钥匙，我想读输入。（就是用来让程序
       <strong>
        从键盘读取
       </strong>
       用户的输入）
      </p>
     </li>
     <li>
      <p>
       STD_ERROR_HANDLE（写成 -12）：给我错误输出的钥匙（也是屏幕，但可以单独用）。
      </p>
     </li>
    </ul>
    <h3 id="%E6%80%8E%E4%B9%88%E7%94%A8%E5%AE%83%EF%BC%9F" name="%E6%80%8E%E4%B9%88%E7%94%A8%E5%AE%83%EF%BC%9F">
     怎么用它？
    </h3>
    <p>
     假设你想用 GetStdHandle 在屏幕上写“Hello, Windows!”，我们可以这样写：
    </p>
    <pre><code class="language-cpp">#include &lt;windows.h&gt; // 必须包含这个头文件，里面有 Windows 的工具
#include &lt;cstring&gt;

int main() {
    // 1. 拿到屏幕的“钥匙”
    HANDLE screen = GetStdHandle(STD_OUTPUT_HANDLE);

    // 2. 检查钥匙是不是拿到了
    if (screen == INVALID_HANDLE_VALUE) { // 如果钥匙是“坏的”
        return 1; // 出错了，退出程序
    }

    // 3. 用这个钥匙写东西到屏幕上
    const char* message = "Hello, Windows!\n";
    DWORD written; // 用来记录写了多少个字符
    WriteConsoleA(screen, message, strlen(message), &amp;written, NULL);

    return 0;
}</code></pre>
    <p>
     一步步解释：
    </p>
    <ol>
     <li>
      <p>
       拿到钥匙：
      </p>
      <ul>
       <li>
        <p>
         GetStdHandle(STD_OUTPUT_HANDLE) 就像去问 Windows：“给我屏幕的钥匙吧！” 返回的 screen 是一个 HANDLE，你可以把它想象成一个工具的“ID”。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       检查钥匙：
      </p>
      <ul>
       <li>
        <p>
         如果程序没有屏幕（比如你关了控制台窗口），Windows 会给你一个“坏钥匙”（INVALID_HANDLE_VALUE），所以要检查一下。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       用钥匙做事：
      </p>
      <ul>
       <li>
        <p>
         WriteConsoleA 是另一个 Windows 函数，专门用这个“钥匙”在屏幕上写东西。
        </p>
       </li>
       <li>
        <p>
         它需要：
        </p>
        <ul>
         <li>
          <p>
           screen: 你刚拿到的钥匙。
          </p>
         </li>
         <li>
          <p>
           message: 你想写什么。
          </p>
         </li>
         <li>
          <p>
           strlen(message): 写多少个字符。
          </p>
         </li>
         <li>
          <p>
           &amp;written: 记录实际写了多少（类似 C++ 的传引用）。
          </p>
         </li>
         <li>
          <p>
           NULL: 最后一个参数先不用管，写 NULL 就好。
          </p>
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ol>
    <p>
     运行这个程序，你会在黑色的控制台窗口看到“Hello, Windows!”。
    </p>
    <h3 id="%E5%AE%83%E8%B7%9F%20std%3A%3Acout%20%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9F" name="%E5%AE%83%E8%B7%9F%20std%3A%3Acout%20%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9F">
     它跟 std::cout 有什么不一样？
    </h3>
    <ul>
     <li>
      <p>
       std::cout 是 C++ 标准库提供的，简单好用，但它藏了很多细节，你不知道它是怎么跟屏幕沟通的。
      </p>
     </li>
     <li>
      <p>
       GetStdHandle + WriteConsoleA 是直接跟 Windows 操作系统打交道，给你更多控制权。比如，你可以用它改变文字颜色，或者直接读键盘按键，而 std::cout 做不到这些。
      </p>
     </li>
    </ul>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430325f38383034373637322f:61727469636c652f64657461696c732f313436313239373939" class_="artid" style="display:none">
 </p>
</div>


