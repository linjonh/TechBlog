---
layout: post
title: "操作系统之陷阱,中断和异常"
date: 2024-10-06 21:45:28 +0800
description: "本文详细阐述了操作系统中的陷阱、陷阱，也称为访管指令，中断通常是外部事"
keywords: "中断、陷阱和异常"
categories: ['笔记']
tags: ['Linux']
artid: "122270290"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122270290
    alt: "操作系统之陷阱,中断和异常"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122270290
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122270290
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     操作系统之陷阱，中断和异常
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在操作系统中，陷阱，中断和异常是常见的术语，它们贯穿操作系统学习的始终，这篇文章主要区分它们之间的不同。
    </p>
    <h5>
     <a id="_2">
     </a>
     陷阱
    </h5>
    <p>
     计算机有两种运行模式：用户态， 内核态。 其中操作系统运行在内核态，在内核态中，操作系统具有对所有硬件的完全访问权限，可以使机器运行任何指令；相反，用户程序运行在用户态，在用户态下，软件只能使用少数指令，它们并不具备直接访问硬件的权限。这就出现了问题，假如软件需要访问硬件或者需要调用内核中的函数该怎么办呢，这就是陷阱的作用了。陷阱指令可以使执行流程从用户态陷入内核（这也就是为什么叫做陷阱，而不是捕猎的陷阱）并把控制权转移给操作系统，使得用户程序可以调用内核函数和使用硬件从而获得操作系统所提供的服务，比如用视频软件放一个电影，视频软件就发出陷阱使用显示器和声卡从而访问硬件。
    </p>
    <p>
     操作系统有很多系统调用接口供用程序调用。陷阱的发生时间是固定的，比如第一次用视频软件时，在加载视频时软件会向操作系统发送陷阱指令，第二次播放时，软件仍然会在同样的时刻发送陷阱指令。这一点是和中断的明显的差别之一。
     <br/>
     陷阱指令又叫访管指令，我们知道，用户程序只能在目态下运行，并且不能使用特权指令。因而就存在这么一个问题：如果用户程序想要启动外设，或者要完成在目态下无法完成的工作，该怎么办？要解决这一问题必须有三个条件：
     <br/>
     （1）需要有一条指令，能使处理机从目态进入管态，并向操作系统提交要代为完成的工作；
     <br/>
     （2）在管态下由操作系统完成用户程序的请求；
     <br/>
     （3）操作系统完成所做工作后能返回到用户程序，即从管态回到原来的目态。
     <br/>
     解决这个问题要靠访管指令。访管指令本身不是特权指令，其基本功能是让程序拥有“自愿进管”的手段，从而引起访管中断。
    </p>
    <h5>
     <a id="_13">
     </a>
     中断
    </h5>
    <p>
     <strong>
      这里是指外中断。
     </strong>
     <br/>
     中断是由外部事件导致并且它发生的时间是不可预测的，这一点和陷阱不同。外部事件主要是指时钟中断，硬件中断等。由于CPU一次只能运行一条指令，所以在一个时刻只能有一个程序运行，但我们感觉在我们的计算机中明明可以同时运行很多程序啊，这是由于CPU在多个进程之间快速切换所导致的伪并行。如果某一个程序运行了足够长用完了分配给它的时间片，CPU决定切换到另一个进程运行，就会产生一个时钟中断，切换到下一个进程运行。
    </p>
    <p>
     硬件中断顾名思义就是由硬件引起的中断，比如一个程序需要用户输入一个数据，但用户一直没有输入，操作系统决定是一直等待用户输入还是转而运行别的进程，一般情况是转而运行别的进程，如果用户的输入到来了，那么键盘驱动器会产生一个中断通知操作系统，操作系统保存正在运行的程序的状态，从而切换到原来的进程处理到来的数据。
    </p>
    <p>
     所以中断发生是随机的且主要作用是完成进程间切换，从而支持CPU和设备之间的并行。
     <br/>
     中断和异常的另一个重要差别是，CPU处理中断的过程中会屏蔽中断，不接受新的中断直到此次中断处理结束。而陷阱的发生并不屏蔽中断，可以接受新的中断。
    </p>
    <h5>
     <a id="_22">
     </a>
     异常
    </h5>
    <p>
     <strong>
      异常就是内中断。
     </strong>
     <br/>
     异常就是程序执行过程中的异常行为。比如除零异常，缓冲区溢出异常等。不同的操作系统定义了不同种类和数量的异常并且每个异常都有一个唯一的异常号，异常会扰乱程序的正常执行流程，所以异常是在CPU执行指令时本身出现的问题，比如除数为零而出现的除零异常。异常的产生表示程序设计不合理，所以在编程的时候要尽量避免异常的产生。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333933323034302f:61727469636c652f64657461696c732f313232323730323930" class_="artid" style="display:none">
 </p>
</div>


