---
layout: post
title: "微信小程序-背景音乐BackgroundAudioManager"
date: 2025-01-22 22:16:55 +0800
description: "BackgroundAudioManager背景音频1. 属性说明（1）BackgroundAudi"
keywords: "backgroundaudiomanager"
categories: ['微信小程序开发']
tags: ['背景音乐', '微信小程序', '小程序开发', '小程序Api']
artid: "103346112"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=103346112
    alt: "微信小程序-背景音乐BackgroundAudioManager"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=103346112
featuredImagePreview: https://bing.ee123.net/img/rand?artid=103346112
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序 背景音乐BackgroundAudioManager
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h4 style="margin-left:0cm;">
     BackgroundAudioManager背景音频
    </h4>
    <p>
     1. 属性说明
    </p>
    <p style="margin-left:0cm;">
     （1）BackgroundAudioManager类属性
    </p>
    <p style="margin-left:0cm;">
     BackgroundAudioManager类为
     <strong>
      全局唯一
     </strong>
     的背景音频管理器。可通过API函数wx.getBackgroundAudioManager获取，当小程序切入后台时，如果音频处于播放状态，可以继续播放。但是后台状态不能通过调用API操纵音频的播放状态。
    </p>
    <p style="margin-left:0cm;">
     <span style="color:#000000;">
      注意：从微信客户端
     </span>
     <span style="color:#000000;">
      6.7.2
     </span>
     <span style="color:#000000;">
      版本开始，若需要在小程序切后台后继续播放音频，需要在
     </span>
     <span style="color:#000000;">
      <a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html" rel="nofollow">
       app.json
      </a>
     </span>
     <span style="color:#000000;">
      中配置
     </span>
     <code>
      <span style="color:#000000;">
       requiredBackgroundModes
      </span>
     </code>
     <span style="color:#000000;">
      属性。开发版和体验版上可以直接生效，正式版还需通过审核。
     </span>
    </p>
    <p style="margin-left:0cm;">
     表【】BackgroundAudioManager类属性名
    </p>
    <table align="center" border="1" cellspacing="0" style="width:439.2pt;">
     <tbody>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <strong>
          <span style="color:#000000;">
           属性名
          </span>
         </strong>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <strong>
          <span style="color:#000000;">
           类型
          </span>
         </strong>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <strong>
          <span style="color:#000000;">
           说明
          </span>
         </strong>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          src
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          音频的数据源（
         </span>
         <span style="color:#000000;">
          2.2.3
         </span>
         <span style="color:#000000;">
          开始支持云文件
         </span>
         <span style="color:#000000;">
          ID
         </span>
         <span style="color:#000000;">
          ）。默认为空字符串，当设置了新的
         </span>
         <span style="color:#000000;">
          src
         </span>
         <span style="color:#000000;">
          时，会自动开始播放，目前支持的格式有
         </span>
         <span style="color:#000000;">
          m4a, aac, mp3, wav
         </span>
         <span style="color:#000000;">
          。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          startTime
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          number
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          音频开始播放的位置（单位：
         </span>
         <span style="color:#000000;">
          s
         </span>
         <span style="color:#000000;">
          ）。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          title
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          音频标题，用于原生音频播放器音频标题（必填）。原生音频播放器中的分享功能，分享出去的卡片标题，也将使用该值。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          epname
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          专辑名，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          singer
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          歌手名，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          coverImgUrl
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          封面图
         </span>
         <span style="color:#000000;">
          URL
         </span>
         <span style="color:#000000;">
          ，用于做原生音频播放器背景图。原生音频播放器中的分享功能，分享出去的卡片配图及背景也将使用该图。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          webUrl
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          页面链接，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          protocol
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          string
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          音频协议。默认值为
         </span>
         <span style="color:#000000;">
          'http'
         </span>
         <span style="color:#000000;">
          ，设置
         </span>
         <span style="color:#000000;">
          'hls'
         </span>
         <span style="color:#000000;">
          可以支持播放
         </span>
         <span style="color:#000000;">
          HLS
         </span>
         <span style="color:#000000;">
          协议的直播音频。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          duration
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          number
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          当前音频的长度（单位：
         </span>
         <span style="color:#000000;">
          s
         </span>
         <span style="color:#000000;">
          ），只有在有合法
         </span>
         <span style="color:#000000;">
          src
         </span>
         <span style="color:#000000;">
          时返回。（只读）
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          currentTime
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          number
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          当前音频的播放位置（单位：
         </span>
         <span style="color:#000000;">
          s
         </span>
         <span style="color:#000000;">
          ），只有在有合法
         </span>
         <span style="color:#000000;">
          src
         </span>
         <span style="color:#000000;">
          时返回。（只读）
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          paused
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          boolean
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          当前是否暂停或停止。（只读）
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:67.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          buffered
         </span>
        </p>
       </td>
       <td style="width:45.65pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          number
         </span>
        </p>
       </td>
       <td style="width:325.9pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          音频已缓冲的时间，仅保证当前播放时间点到此时间点内容已缓冲。（只读）
         </span>
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p style="margin-left:0cm;">
    </p>
    <p style="margin-left:0cm;">
     （2）BackgroundAudioManager类方法
    </p>
    <p style="margin-left:0cm;">
     BackgroundAudioManager所有类方法如表【】所示。
    </p>
    <p style="margin-left:0cm;">
     表【】BackgroundAudioManager类方法说明
    </p>
    <table align="center" border="1" cellspacing="0" style="width:432.1pt;">
     <tbody>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <strong>
          <span style="color:#000000;">
           方法名
          </span>
         </strong>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <strong>
          <span style="color:#000000;">
           说明
          </span>
         </strong>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.play()
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          播放音乐
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.pause()
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          暂停音乐
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.seek(number currentTime)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          跳转到指定位置
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.stop()
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          停止音乐
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onCanplay(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频进入可播放状态事件。
         </span>
         <span style="color:#000000;">
          但不保证后面可以流畅播放
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onWaiting(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听音频加载中事件。当音频因为数据不足，需要停下来加载时会触发
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onError(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频播放错误事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onPlay(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频播放事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onPause(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频暂停事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onSeeking(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频开始跳转操作事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onSeeked(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频完成跳转操作事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onEnded(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频自然播放结束事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onStop(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频停止事件
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onTimeUpdate(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听背景音频播放进度更新事件，只有小程序在前台时会回调。
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onNext(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听用户在系统音乐播放面板点击下一曲事件（仅
         </span>
         <span style="color:#000000;">
          iOS
         </span>
         <span style="color:#000000;">
          ）
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:243.5pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          BackgroundAudioManager.onPrev(function callback)
         </span>
        </p>
       </td>
       <td style="width:188.6pt;">
        <p style="margin-left:0cm;">
         <span style="color:#000000;">
          监听用户在系统音乐播放面板点击上一曲事件（仅
         </span>
         <span style="color:#000000;">
          iOS
         </span>
         <span style="color:#000000;">
          ）
         </span>
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     2. 编码测试
    </p>
    <p style="margin-left:0cm;">
     新建backgroundAudio页面，在WXML中添加如下代码：
    </p>
    <pre class="has"><code>&lt;!-- demo3.9 backgroundAudio页面 backgroundAudio.wxml--&gt;
&lt;view class='container'&gt;
  &lt;view class='page-body'&gt;
    &lt; text class='h1'&gt;背景音频BackgroundAudioManager编码测试&lt;/ text &gt;
    &lt;view class='demo-box'&gt;
      &lt;view class="btn-area"&gt;
        &lt;view class="title"&gt;点击下方switch开启或关闭背景音乐&lt;/view&gt;
          &lt;view class="tc"&gt;注意：离开当前页面后背景音乐将保持播放，只有完全关闭小程序才停止（点击右上角胶囊按钮的关闭仍然播放）&lt;/view&gt;
          设置音乐
          &lt;text wx:if="{<!-- -->{switchStatus}}"&gt;开启&lt;/text&gt;
          &lt;text wx:else&gt;关闭&lt;/text&gt;
          &lt;switch bindchange="switchChange" checked /&gt;
           &lt;/view&gt;
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/view&gt;</code></pre>
    <p style="margin-left:0cm;">
     页面的逻辑处理JS代码如下：
    </p>
    <pre class="has"><code>// demo3.9 backgroundAudio页面 backgroundAudio.js
const backgroundAudioManager = wx.getBackgroundAudioManager() //获取背景音频实例
backgroundAudioManager.title = '欢快的背景'
backgroundAudioManager.singer = 'toky'
backgroundAudioManager.coverImgUrl = '' //封面图 URL
// 设置了 src 之后会自动播放（src为云开发中云存储空间文件的链接）
backgroundAudioManager.src = 'https://6465-demo-p9hhp-1300526081.tcb.qcloud.la/toky/
             backgroundmusic.mp3?sign=db2895a2030cea0242a274d23354cf04&amp;t=1575194113'
var that = backgroundAudioManager
// 背景音乐循环的方法
// 1、onEnded监听播放自然结束
backgroundAudioManager.onEnded(function() {
  // 2、必须重新设置src才能循环之后会自动播放
  backgroundAudioManager.src = 'https://6465-demo-p9hhp-1300526081.tcb.qcloud.la/toky/
             backgroundmusic.mp3?sign=db2895a2030cea0242a274d23354cf04&amp;t=1575194113'
})
Page({
  data: { switchStatus: true },
  switchChange: function(e) {
    let switchStatus = e.detail.value//获取switch开关状态
      this.setData({
      switchStatus: switchStatus
    })
    if (switchStatus) {
      backgroundAudioManager.play()//播放
    } else {
      backgroundAudioManager.pause()//暂停
    }
  }
})
</code></pre>
    <p style="margin-left:0cm;">
     当然，仅仅使用以上代码这时开发工具中还会提示一个错误，如图【】所示。
    </p>
    <p style="margin-left:0cm;">
    </p>
    <p style="margin-left:0cm;">
     <img alt="" class="has" height="184" src="https://i-blog.csdnimg.cn/blog_migrate/e46ee93a49e05ac09710bedd0b30f56b.png" width="505"/>
    </p>
    <p style="margin-left:0cm;">
     图【】开发工具提示需在app.json中进行权限配置
    </p>
    <p style="margin-left:0cm;">
     app.json中的requiredBackgroundModes属性是用于配置小程序的后台权限的，其属性值是一个String类型的数组，在app.json中添加如下代码：
    </p>
    <pre class="has"><code>"requiredBackgroundModes": [
    "audio",
    "location"
  ],
</code></pre>
    <p style="margin-left:0cm;">
     通过真机调试可以看到运行效果如图【】所示。
    </p>
    <p style="margin-left:0cm;">
     <img alt="" class="has" height="469" src="https://i-blog.csdnimg.cn/blog_migrate/75a0ce71956488cd2e3d259bc0f481b2.jpeg" width="222">
      <img alt="" class="has" height="469" src="https://i-blog.csdnimg.cn/blog_migrate/e375cc9cbc83437650a033fccc069e78.jpeg" width="222">
       <img alt="" class="has" height="469" src="https://i-blog.csdnimg.cn/blog_migrate/432f3dc1eb75bd33b7f2eace04842acd.jpeg" width="222">
        <img alt="" class="has" height="468" src="https://i-blog.csdnimg.cn/blog_migrate/004377bed7b7f8b1f1385b08655d4dff.png" width="222"/>
       </img>
      </img>
     </img>
    </p>
    <p style="margin-left:0cm;">
     （a）进入页面默认播放  （b）点开悬浮窗  （c）关闭switch暂停播放 （d）后台播放
    </p>
    <p style="margin-left:0cm;">
     图【】BackgroundAudioManager背景音频编码测试
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f546f6b795f6d696e2f:61727469636c652f64657461696c732f313033333436313132" class_="artid" style="display:none">
 </p>
</div>


