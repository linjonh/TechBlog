---
arturl_encode: "68747470733a:2f2f626c6f672e6373646e2e6e65742f6179756e6e6e6e6e2f:61727469636c652f64657461696c732f313436313439353738"
layout: post
title: "Ubuntu22.04ä¿®æ”¹rootç”¨æˆ·å¹¶å®‰è£…cuda"
date: 2025-03-10 11:50:47 +08:00
description: "ç”±äºæœ¬äººå·¥ä½œåŸå› ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦ç»™ubuntuæ‰“æ˜¾å¡é©±åŠ¨çš„é—®é¢˜ï¼Œè™½ç„¶è¯´ä¸éš¾å§ï¼Œä½†æ˜¯è€ä¸ä½æœºå™¨å¤šï¼Œé‡å¤å¤šæ¬¡ä¹Ÿå°±çƒ¦äº†ï¼Œäºæ˜¯æŠ½å‡ºäº†ä¸€ç‚¹æ—¶é—´ï¼Œå¹¶ä¸”åœ¨deepseekçš„å¸®åŠ©ä¹‹ä¸‹ï¼Œå†™äº†ä¸€ä¸ªè‡ªåŠ¨å®‰è£…é©±åŠ¨çš„è„šæœ¬ï¼Œè„šæœ¬ä¸­é™¤äº†è‡ªåŠ¨å…³é—­nouveauçš„è¿™ä¸€æ­¥æ²¡æœ‰è¿›è¡Œç¡®è®¤ï¼Œå…¶ä»–æƒ…å†µä¸‹ï¼ˆå³nouveaué»˜è®¤ç¦ç”¨çš„æƒ…å†µä¸‹ï¼‰å¯æ­£å¸¸è¿è¡Œã€‚é™„ä¸Šè„šæœ¬ï¼Œå¯ä»¥è¿›è¡Œå¾®è°ƒã€‚"
keywords: "Ubuntu22.04ä¿®æ”¹rootç”¨æˆ·å¹¶å®‰è£…cuda"
categories: ['æœªåˆ†ç±»']
tags: ['æœåŠ¡å™¨', 'Linux']
artid: "146149578"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146149578
    alt: "Ubuntu22.04ä¿®æ”¹rootç”¨æˆ·å¹¶å®‰è£…cuda"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146149578
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146149578
cover: https://bing.ee123.net/img/rand?artid=146149578
image: https://bing.ee123.net/img/rand?artid=146149578
img: https://bing.ee123.net/img/rand?artid=146149578
---

# Ubuntu22.04ä¿®æ”¹rootç”¨æˆ·å¹¶å®‰è£…cuda

ç”±äºæœ¬äººå·¥ä½œåŸå› ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦ç»™ubuntuæ‰“æ˜¾å¡é©±åŠ¨çš„é—®é¢˜ï¼Œè™½ç„¶è¯´ä¸éš¾å§ï¼Œä½†æ˜¯è€ä¸ä½æœºå™¨å¤šï¼Œé‡å¤å¤šæ¬¡ä¹Ÿå°±çƒ¦äº†ï¼Œäºæ˜¯æŠ½å‡ºäº†ä¸€ç‚¹æ—¶é—´ï¼Œå¹¶ä¸”åœ¨deepseekçš„å¸®åŠ©ä¹‹ä¸‹ï¼Œå†™äº†ä¸€ä¸ªè‡ªåŠ¨å®‰è£…é©±åŠ¨çš„è„šæœ¬ï¼Œè„šæœ¬ä¸­é™¤äº†è‡ªåŠ¨å…³é—­nouveauçš„è¿™ä¸€æ­¥æ²¡æœ‰è¿›è¡Œç¡®è®¤ï¼Œå…¶ä»–æƒ…å†µä¸‹ï¼ˆå³nouveaué»˜è®¤ç¦ç”¨çš„æƒ…å†µä¸‹ï¼‰å¯æ­£å¸¸è¿è¡Œã€‚

```
#ä¸Šä¼ install_cuda.sh

chmod +x install_cuda.sh
sudo ./install_cuda.sh

#æŸ¥çœ‹æ˜¯å¦å®‰è£…å®Œæˆ
nvidia-smi
nvcc -V
```

é™„ä¸Šè„šæœ¬ï¼Œå¯ä»¥è¿›è¡Œå¾®è°ƒ

```
#!/bin/bash
# -----------------------------------------------------------------------------
# è„šæœ¬åç§°: install_cuda.sh
# ç‰ˆæœ¬: 2.0.0
# ä½œè€…: ä¸€ä¸ªä¸çŸ¥åçš„è‹¦é€¼æ‰“å·¥äºº
# ç›®æ ‡ï¼šåœ¨ Ubuntu 22.04 ä¸Šå®‰è£… NVIDIA CUDA 12.8ï¼Œå¹¶ä¿®æ”¹ root å¯†ç 
# -----------------------------------------------------------------------------
echo "ğŸ”§ äº”ç§’åå¼€å§‹æ‰§è¡Œè„šæœ¬"
sleep 5

# è®°å½•è„šæœ¬å¼€å§‹æ—¶é—´
start_time=$(date +%s)

# ç¡®ä¿ä»¥ root æƒé™è¿è¡Œ
if [[ $EUID -ne 0 ]]; then
    echo "âŒ é”™è¯¯ï¼šæ­¤è„šæœ¬å¿…é¡»ä»¥ root æƒé™æ‰§è¡Œã€‚" >&2
    sleep 1
    echo "ç”¨æ³•ï¼šsudo bash $0"
    sleep 1
    exit 1
fi

# **ä¿®æ”¹ root å¯†ç **
ROOT_PASSWORD="1!P@ssw0rd"
echo "ğŸ”‘ æ­£åœ¨ä¿®æ”¹ root å¯†ç ..."
sleep 1
echo "root:$ROOT_PASSWORD" | sudo chpasswd
echo "âœ… root å¯†ç å·²ä¿®æ”¹ä¸º '1!P@ssw0rd'ï¼"
sleep 1

# **å…è®¸ root é€šè¿‡ SSH ç™»å½•**
echo "ğŸ”§ å…è®¸ root é€šè¿‡ SSH ç™»å½•..."
sleep 1
sudo sed -i 's/^#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
sudo sed -i 's/^PermitRootLogin no/PermitRootLogin yes/' /etc/ssh/sshd_config

# **é‡å¯ SSH æœåŠ¡ï¼ˆä½¿ä¿®æ”¹ç”Ÿæ•ˆï¼‰**
sudo systemctl restart sshd
echo "âœ… SSH å…è®¸ root ç™»å½•å·²å¯ç”¨ï¼"
sleep 1

# **åˆ‡æ¢åˆ° root è´¦æˆ·**
# echo "ğŸ”„ åˆ‡æ¢åˆ° root è´¦æˆ·..."
# exec su - root  
# -----------------------------------------------------------------------------
# **ä»¥ä¸‹å¼€å§‹æ‰§è¡Œ CUDA 12.8 å®‰è£…**
# -----------------------------------------------------------------------------

echo "ğŸ”§ å®šä¹‰ CUDA ç›¸å…³å˜é‡..."
sleep 1
CUDA_VERSION="12.8.0"
CUDA_DRIVER_VERSION="570.86.10"
CUDA_MAJOR_VERSION=$(echo "$CUDA_VERSION" | cut -d. -f1-2)
CUDA_URL="https://developer.download.nvidia.com/compute/cuda/${CUDA_VERSION}/local_installers/cuda_${CUDA_VERSION}_${CUDA_DRIVER_VERSION}_linux.run"
CUDA_PKG="/root/cuda_${CUDA_VERSION}_${CUDA_DRIVER_VERSION}_linux.run"

echo "âœ… CUDA ç‰ˆæœ¬: $CUDA_VERSION"
sleep 1
echo "âœ… CUDA é©±åŠ¨ç‰ˆæœ¬: $CUDA_DRIVER_VERSION"
sleep 1
echo "âœ… CUDA ä¸»ç‰ˆæœ¬: $CUDA_MAJOR_VERSION"
sleep 1
echo "âœ… CUDA ä¸‹è½½é“¾æ¥: $CUDA_URL"
sleep 1
echo "âœ… CUDA å®‰è£…åŒ…è·¯å¾„: $CUDA_PKG"
sleep 1

echo "ğŸ”§ å°† CUDA ç›¸å…³å˜é‡å†™å…¥ /etc/profile..."
sleep 1

# æ£€æŸ¥å¹¶æ·»åŠ  CUDA_VERSION
if ! grep -q "export CUDA_VERSION=" /etc/profile; then
    echo "export CUDA_VERSION=\"$CUDA_VERSION\"" >> /etc/profile
    echo "âœ… å·²å†™å…¥ CUDA_VERSION"
    sleep 1
else
    echo "âš ï¸ CUDA_VERSION å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥"
    sleep 1
fi

# æ£€æŸ¥å¹¶æ·»åŠ  CUDA_DRIVER_VERSION
if ! grep -q "export CUDA_DRIVER_VERSION=" /etc/profile; then
    echo "export CUDA_DRIVER_VERSION=\"$CUDA_DRIVER_VERSION\"" >> /etc/profile
    echo "âœ… å·²å†™å…¥ CUDA_DRIVER_VERSION"
    sleep 1
else
    echo "âš ï¸ CUDA_DRIVER_VERSION å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥"
    sleep 1
fi

# æ£€æŸ¥å¹¶æ·»åŠ  CUDA_MAJOR_VERSION
if ! grep -q "export CUDA_MAJOR_VERSION=" /etc/profile; then
    echo "export CUDA_MAJOR_VERSION=\"$CUDA_MAJOR_VERSION\"" >> /etc/profile
    echo "âœ… å·²å†™å…¥ CUDA_MAJOR_VERSION"
    sleep 1
else
    echo "âš ï¸ CUDA_MAJOR_VERSION å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥"
    sleep 1
fi

# æ£€æŸ¥å¹¶æ·»åŠ  CUDA_URL
if ! grep -q "export CUDA_URL=" /etc/profile; then
    echo "export CUDA_URL=\"$CUDA_URL\"" >> /etc/profile
    echo "âœ… å·²å†™å…¥ CUDA_URL"
    sleep 1
else
    echo "âš ï¸ CUDA_URL å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥"
    sleep 1
fi

# æ£€æŸ¥å¹¶æ·»åŠ  CUDA_PKG
if ! grep -q "export CUDA_PKG=" /etc/profile; then
    echo "export CUDA_PKG=\"$CUDA_PKG\"" >> /etc/profile
    echo "âœ… å·²å†™å…¥ CUDA_PKG"
    sleep 1
else
    echo "âš ï¸ CUDA_PKG å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥"
    sleep 1
fi

echo "ğŸ”§ ä½¿ç¯å¢ƒå˜é‡é…ç½®ç«‹å³ç”Ÿæ•ˆ..."
sleep 1
source /etc/profile
echo "âœ… ç¯å¢ƒå˜é‡é…ç½®å·²ç”Ÿæ•ˆ"
sleep 1

echo "ğŸ‰ CUDA ç›¸å…³å˜é‡å·²æˆåŠŸå†™å…¥ç¯å¢ƒå˜é‡å¹¶ç”Ÿæ•ˆï¼"
sleep 1

# å¤‡ä»½ sources.list
echo "ğŸ“‚ å¤‡ä»½åŸå§‹çš„ sources.list..."
sleep 1
cp /etc/apt/sources.list /etc/apt/sources.list.bak && echo "âœ… å¤‡ä»½æˆåŠŸ: /etc/apt/sources.list.bak" || { echo "âŒ å¤‡ä»½å¤±è´¥"; sleep 1; exit 1; }

# é…ç½®é˜¿é‡Œæº
echo "âš™ï¸ é…ç½®é˜¿é‡Œæº..."
sleep 1
cat > /etc/apt/sources.list << EOF
deb https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse

# deb https://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse
# deb-src https://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
EOF

# æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…å¿…è¦å·¥å…·
echo "ğŸ”„ æ›´æ–°è½¯ä»¶åŒ…..."
sleep 1
export DEBIAN_FRONTEND=noninteractive
apt update && apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·ï¼ˆç¡®ä¿ `nvcc -V` å¯ç”¨ï¼‰
echo "ğŸ“¦ å®‰è£…å¿…è¦å·¥å…· (gcc, make, vim,, nvidia-cuda-toolkit)..."
sleep 1
apt install -y gcc make vim  nvidia-cuda-toolkit || { echo "âŒ å·¥å…·å®‰è£…å¤±è´¥"; sleep 1; exit 1; }

# ä¸‹è½½ CUDA 12.8 å®‰è£…åŒ…
echo "â¬‡ï¸ æ­£åœ¨ä¸‹è½½ CUDA $CUDA_MAJOR_VERSION å®‰è£…åŒ…..."
sleep 1
wget -O "$CUDA_PKG" --progress=dot:giga "$CUDA_URL" || { echo "âŒ CUDA ä¸‹è½½å¤±è´¥"; sleep 1; exit 1; }
echo "âœ… CUDA ä¸‹è½½å®Œæˆ: $CUDA_PKG"
sleep 1

# ç¦ç”¨ Nouveau é©±åŠ¨
echo "ğŸš« ç¦ç”¨ Nouveau é©±åŠ¨..."
sleep 1
cat > /etc/modprobe.d/blacklist-nouveau.conf << EOF
blacklist nouveau
options nouveau modeset=0
EOF

# é‡æ–°ç”Ÿæˆ initramfs å¹¶å°è¯•å¸è½½ nouveau
update-initramfs -u
sleep 3
if lsmod | grep -q nouveau; then
    echo "âš ï¸ Nouveau ä»åœ¨è¿è¡Œï¼Œå°è¯•ç§»é™¤..."
    sleep 1
    rmmod nouveau || echo "âš ï¸ æ— æ³•å¸è½½ Nouveauï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ£€æŸ¥"
    sleep 1
else
    echo "âœ… Nouveau ç¦ç”¨æˆåŠŸã€‚"
    sleep 1
fi

# èµ‹äºˆ CUDA å®‰è£…åŒ…æ‰§è¡Œæƒé™
chmod +x "$CUDA_PKG"

# å®‰è£… CUDA
echo "ğŸ“¦ å¼€å§‹å®‰è£… NVIDIA CUDA $CUDA_MAJOR_VERSION..."
sleep 1
if bash "$CUDA_PKG" --silent --driver --toolkit --no-drm  ; then
    echo "âœ… CUDA å®‰è£…å®Œæˆã€‚"
    sleep 1
else
    echo "âŒ CUDA å®‰è£…å¤±è´¥ï¼Œé€€å‡ºè„šæœ¬ã€‚" >&2
    sleep 1
    exit 1
fi

# æ›´æ–°ç¯å¢ƒå˜é‡
echo "ğŸ”§ é…ç½®ç¯å¢ƒå˜é‡..."
sleep 1
if ! grep -q "/usr/local/cuda-$CUDA_MAJOR_VERSION/bin" /etc/profile; then
    echo "export PATH=/usr/local/cuda-$CUDA_MAJOR_VERSION/bin:\$PATH" >> /etc/profile
fi
if ! grep -q "/usr/local/cuda-$CUDA_MAJOR_VERSION/lib64" /etc/profile; then
    echo "export LD_LIBRARY_PATH=/usr/local/cuda-$CUDA_MAJOR_VERSION/lib64:\$LD_LIBRARY_PATH" >> /etc/profile
fi

# ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆ
source /etc/profile
source ~/.bashrc

# é…ç½® NVIDIA æŒä¹…æ¨¡å¼ systemd æœåŠ¡
echo "ğŸ› ï¸ åˆ›å»º NVIDIA æŒä¹…æ¨¡å¼ systemd æœåŠ¡ï¼ˆDeshine-NVIDIA-Persistence-M-Onï¼‰..."
sleep 1
cat > /etc/systemd/system/Deshine-NVIDIA-Persistence-M-On.service << EOF
[Unit]
Description=Enable NVIDIA Persistence Mode (Deshine)
After=multi-user.target

[Service]
ExecStart=/usr/bin/nvidia-smi -pm 1
RemainAfterExit=yes
Type=oneshot

[Install]
WantedBy=multi-user.target
EOF

# é‡æ–°åŠ è½½ systemd å¹¶å¯ç”¨æœåŠ¡
systemctl daemon-reload
systemctl enable Deshine-NVIDIA-Persistence-M-On.service
systemctl start Deshine-NVIDIA-Persistence-M-On.service

# åˆ é™¤ CUDA å®‰è£…åŒ…
echo "ğŸ—‘ï¸ æ¸…ç†æ— ç”¨çš„å®‰è£…æ–‡ä»¶..."
sleep 1
rm -f "$CUDA_PKG"

# éªŒè¯ CUDA æ˜¯å¦å®‰è£…æˆåŠŸ
echo "ğŸ” æ£€æŸ¥ CUDA $CUDA_MAJOR_VERSION å®‰è£…çŠ¶æ€..."
sleep 1
if command -v nvcc &> /dev/null; then
    echo "ğŸ‰ CUDA å®‰è£…æˆåŠŸï¼ç‰ˆæœ¬ä¿¡æ¯ï¼š"
    sleep 1
    nvcc -V
else
    echo "âš ï¸ CUDA å¯èƒ½æœªæ­£ç¡®å®‰è£…ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ï¼"
    sleep 1
fi

# è®°å½•è„šæœ¬ç»“æŸæ—¶é—´å¹¶è®¡ç®—æ‰§è¡Œæ—¶é—´
end_time=$(date +%s)
execution_time=$((end_time - start_time))
echo "ğŸ•’ è„šæœ¬æ‰§è¡Œå®Œæˆï¼Œæ€»è€—æ—¶: ${execution_time} ç§’"
sleep 1

# **è‡ªåŠ¨åˆ é™¤è‡ªèº«**
echo "ğŸ—‘ï¸ è‡ªåŠ¨åˆ é™¤å®‰è£…è„šæœ¬..."
sleep 1
rm -- "$0"

# è¯¢é—®æ˜¯å¦é‡å¯ç³»ç»Ÿ
read -p "CUDA $CUDA_MAJOR_VERSION é…ç½®å®Œæˆï¼Œæ˜¯å¦ç«‹å³é‡å¯ç³»ç»Ÿ? (y/n) " confirm
if [[ "$confirm" =~ ^[Yy]$ ]]; then
    echo "ğŸ”„ ç³»ç»Ÿå°†åœ¨ 10 ç§’åé‡å¯..."
    sleep 10
    echo "ğŸ”„ å³å°†é‡å¯ç³»ç»Ÿ..."
    sudo reboot
else
    echo "âœ… è¯·æ‰‹åŠ¨é‡å¯ç³»ç»Ÿä»¥å®Œæˆ CUDA é…ç½®ã€‚"
    sleep 1
fi


```