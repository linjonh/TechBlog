---
layout: post
title: "netsh实现TCP端口转发"
date: 2025-03-14 09:28:59 +0800
description: "服务器：192.168.31.9 端口：56000客户端：192.168.31.2 端口：5600客户端（本地端口5600）通过TCP连接服务器的56000端口PC：192.168.31.5，PC实现客户端和服务器之间56000端口转发。"
keywords: "netsh实现TCP端口转发"
categories: ['Pc']
tags: ['网络协议', '网络', 'Tcp']
artid: "146248933"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146248933
    alt: "netsh实现TCP端口转发"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146248933
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146248933
cover: https://bing.ee123.net/img/rand?artid=146248933
image: https://bing.ee123.net/img/rand?artid=146248933
img: https://bing.ee123.net/img/rand?artid=146248933
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     netsh实现TCP端口转发
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     服务器：192.168.31.9 端口：56000
     <br/>
     客户端：192.168.31.2 端口：5600
     <br/>
     客户端（本地端口5600）通过TCP连接服务器的56000端口
     <br/>
     PC：192.168.31.5，PC实现客户端和服务器之间56000端口转发
    </p>
    <h4>
     <a id="1__4">
     </a>
     1. 添加端口转发规则
    </h4>
    <p>
     添加
    </p>
    <pre><code class="prism language-bash">netsh interface portproxy <span class="token function">add</span> v4tov4 <span class="token assign-left variable">listenport</span><span class="token operator">=</span><span class="token number">56000</span> <span class="token assign-left variable">listenaddress</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token assign-left variable">connectport</span><span class="token operator">=</span><span class="token number">56000</span> <span class="token assign-left variable">connectaddress</span><span class="token operator">=</span><span class="token number">192.168</span>.31.9
</code></pre>
    <p>
     查看
    </p>
    <pre><code class="prism language-bash">netsh interface portproxy show all
</code></pre>
    <pre><code class="prism language-bash">侦听 ipv4:                 连接到 ipv4:

地址            端口        地址            端口
--------------- ----------  --------------- ----------
<span class="token number">0.0</span>.0.0         <span class="token number">56000</span>       <span class="token number">192.168</span>.31.9    <span class="token number">56000</span>
</code></pre>
    <p>
     查看TCP建立情况
    </p>
    <pre><code class="prism language-bash"><span class="token function">netstat</span> <span class="token parameter variable">-ano</span> <span class="token operator">|</span> findstr <span class="token string">":56000"</span>
  TCP    <span class="token number">0.0</span>.0.0:56000          <span class="token number">0.0</span>.0.0:0              LISTENING       <span class="token number">4332</span>
  TCP    <span class="token number">192.168</span>.9.5:56000     <span class="token number">192.168</span>.31.2:5600      ESTABLISHED     <span class="token number">4332</span>
  TCP    <span class="token number">192.168</span>.9.5:60562     <span class="token number">192.168</span>.31.9:56000     ESTABLISHED     <span class="token number">4332</span>
</code></pre>
    <p>
     查看进程
    </p>
    <pre><code class="prism language-bash">tasklist <span class="token operator">|</span> findstr <span class="token string">"4332"</span>
</code></pre>
    <p>
     删除端口转发：
    </p>
    <pre><code class="prism language-bash">netsh interface portproxy delete v4tov4 <span class="token assign-left variable">listenport</span><span class="token operator">=</span><span class="token number">56000</span> <span class="token assign-left variable">listenaddress</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0
</code></pre>
    <p>
     上述关闭后，netstat -ano | findstr “:56000” 查看还有ESTABLISHED，则使用下面命令
    </p>
    <pre><code class="prism language-bash">taskkill /PID <span class="token number">16680</span> /F
</code></pre>
    <h4>
     <a id="2__48">
     </a>
     2. 允许防火墙入站连接
    </h4>
    <p>
     为什么要加防火墙入站规则
     <br/>
     当使用 ‌netsh 端口转发‌时，如果防火墙未放行对应端口，外部发起的 TCP 连接请求（SYN 包）会被防火墙拦截，导致 ‌TCP ACK 不会回复‌，表现为连接超时或拒绝。
    </p>
    <pre><code class="prism language-bash">netsh advfirewall firewall <span class="token function">add</span> rule <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"TCP 56000 Forward"</span> <span class="token assign-left variable">dir</span><span class="token operator">=</span>in <span class="token assign-left variable">action</span><span class="token operator">=</span>allow <span class="token assign-left variable">protocol</span><span class="token operator">=</span>TCP <span class="token assign-left variable">localport</span><span class="token operator">=</span><span class="token number">56000</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4c305a4f518b4d879e1ca42aa4633dc5.png"/>
    </p>
    <p>
     无需额外出站规则‌：端口转发仅需保证入站流量可达，转发到目标地址的过程默认允许出站（除非目标端口被其他规则限制）‌
    </p>
    <p>
     查看防火墙规则
    </p>
    <pre><code class="prism language-bash">netsh advfirewall firewall show rule <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"TCP 56000 Forward"</span>
</code></pre>
    <p>
     删除
    </p>
    <pre><code class="prism language-bash">netsh advfirewall firewall delete rule <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"TCP 56000 Forward"</span>
</code></pre>
    <p>
     验证删除结果
    </p>
    <pre><code class="prism language-bash">netsh advfirewall firewall show rule <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"TCP 56000 Forward"</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6c6c6a7373313938302f:61727469636c652f64657461696c732f313436323438393333" class_="artid" style="display:none">
 </p>
</div>


