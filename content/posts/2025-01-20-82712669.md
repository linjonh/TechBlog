---
layout: post
title: "自己做量化交易软件2-通通量化python跨版本环境设置和使用"
date: 2025-01-20 14:33:11 +0800
description: "python跨版本环境设置和使用众所周知python的版本分为python2和python3,这两个"
keywords: "开发量化策略用哪个版本的python"
categories: ['量化软件', '软件开发', '源代码', 'Python', 'Python']
tags: ['量化软件', '股票K线', 'Python', 'Macd', 'Kdj']
artid: "82712669"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=82712669
    alt: "自己做量化交易软件2-通通量化python跨版本环境设置和使用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=82712669
featuredImagePreview: https://bing.ee123.net/img/rand?artid=82712669
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     自己做量化交易软件(2) 通通量化python跨版本环境设置和使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2 id="通通量化-python跨版本环境设置和使用">
     通通量化 python跨版本环境设置和使用
    </h2>
    <p>
     众所周知python的版本分为python2和python3,这两个版本有一些差异。另外他们的支持包也不同，因此用户要根据自己需求选择
    </p>
    <p>
     合适的版本。
     <br/>
     通通量化交易软件要适合python2和python3的平台运行，因此要做一些兼容性改变。
     <br/>
     一、首先要能正确获取python所在的操作系统。
     <br/>
     UseOS( )返回1=windows,2=Linux,3=MacOS
    </p>
    <pre class="prettyprint"><code class="hljs python"> <span class="hljs-comment">#操作系统类型</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">UseOS</span><span class="hljs-params">( )</span>:</span>
    <span class="hljs-keyword">import</span> platform
    sysstr = platform.system()
    <span class="hljs-keyword">if</span>(sysstr ==<span class="hljs-string">"Windows"</span> <span class="hljs-keyword">or</span> sysstr ==<span class="hljs-string">"windows"</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">elif</span>(sysstr == <span class="hljs-string">"Linux"</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span></code></pre>
    <p>
     二、获取python版本号
     <br/>
     我们只关注大版本号是什么，保存到变量G_pyver中，供以后使用。
     <br/>
     G_pyver=2 #是2=python2, 3=python3
    </p>
    <pre class="prettyprint"><code class="hljs java">    <span class="hljs-keyword">import</span> platform
    G_pyver=<span class="hljs-keyword">int</span>(platform.python_version()[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>])</code></pre>
    <p>
     三、python2和python3的版本差异
     <br/>
     python3 和 python2 是不兼容的，而且差异比较大。好在python2.7以上版本，支持python3以上的部分语法，但又不是全部支持
    </p>
    <p>
     和兼容。因此我们尽量使用同时支持python2.7和python3.6的语法命令。
     <br/>
     实在没法同时兼容的语法命令，我们就用参考如下方法来做兼容功能函数。
    </p>
    <pre class="prettyprint"><code class="hljs python"><span class="hljs-comment">#通用平均线计算        </span>
 <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">G_MA</span><span class="hljs-params">(Series,n)</span>:</span>
    G_pyver=int(platform.python_version()[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>])
    G_ma=<span class="hljs-keyword">None</span>
    <span class="hljs-keyword">if</span> G_pyver==<span class="hljs-number">2</span>:
        G_MAstr=<span class="hljs-string">'pd.rolling_mean(Series,n)'</span>
        G_ma=eval(G_MAstr)
    <span class="hljs-keyword">else</span> :
        G_MAstr=<span class="hljs-string">'Series.rolling(window=n,center=False).mean()'</span>
        G_ma=eval(G_MAstr)
    <span class="hljs-keyword">return</span> G_ma</code></pre>
    <p>
     四、python2和python3的兼容性设计技巧
     <br/>
     python是解释型语言，对于window和MacOS,Linux等系统的命令都不同，引用的包也是不同的。
     <br/>
     1、在MacOS系统的python上引入window上面的包，以及使用命令都会出错。
     <br/>
     2、在python2上使用了python3的包和命令，也会出现错误。
     <br/>
     因此在python2中绝对不能出现python3的任何包引入和命令。
     <br/>
     例如我们常用的tkinter,在python2上的包名为Tkinter，在python3的包名为tkinter。
     <br/>
     为了解决兼容性命令，我们采用下面方法HP_init()来做兼容性设置，其他兼容性命令，我们都只需在这里来设置解决。
    </p>
    <pre class="prettyprint"><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">HP_init</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-comment">#软件名称</span>
    G_tk=<span class="hljs-string">'import tkinter as tk'</span>
    G_tk1=<span class="hljs-string">'from tkinter import *'</span>
    G_tk2=<span class="hljs-string">'from tkinter import ttk'</span>
    G_pyver=int(platform.python_version()[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>])
    G_os=UseOS( )
    <span class="hljs-keyword">if</span> G_pyver==<span class="hljs-number">3</span>:这里写代码片
        G_tk=<span class="hljs-string">'import tkinter as tk'</span>
        G_tk1=<span class="hljs-string">'from tkinter import *'</span>
        G_tk2=<span class="hljs-string">'from tkinter import ttk'</span>
    <span class="hljs-keyword">else</span>:
        G_tk=<span class="hljs-string">'import Tkinter as tk'</span>
        G_tk1=<span class="hljs-string">'from Tkinter import *'</span>
        G_tk2=<span class="hljs-string">'from Tkinter import ttk'</span></code></pre>
    <p>
     五、在程序使用兼容性方法
     <br/>
     我们以tkinter绘图为例，量化软件需要绘制各种图形，我们只需在 def
     <strong>
      init
     </strong>
     (self, master=None): 方法中做必要初始化
    </p>
    <p>
     就可以了。tkinter打多数绘图命令在python2和python3上没有区别。即使使用到有区别的命令，我们也可以按类似方式来解决。
     <br/>
     初始化代码如下：
    </p>
    <pre class="prettyprint"><code class="hljs python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, master=None)</span>:</span>  
        HP_init()
        exec(G_tk)
        exec(G_tk1)
        self.w = <span class="hljs-number">300</span>
        self.h = <span class="hljs-number">180</span>
        self.root = master <span class="hljs-comment">#定义内部变量root  </span>
        self.staIco = G_ico
        self.root.geometry(<span class="hljs-string">'%dx%d'</span> % (self.w, self.h )) <span class="hljs-comment">#设置窗口大小  </span>
        self.username = StringVar()  
        self.password = StringVar()  
        self.createPage()  
        self.loop()</code></pre>
    <p>
     六、完整量化软件演示
     <br/>
     我通过边学习边尝试，做出了简单的股票历史行情和指标的显示框架。后面的工作将从量化分析，操作策略，历史回测及图形显示等方面，逐步开设设计。
    </p>
    <p>
     <img alt="通通量化框架" src="https://i-blog.csdnimg.cn/blog_migrate/d0fc95176e7a6f5d5f5aaf28e2d85c95.jpeg" title="">
      <br/>
      完整代码下载，在我上传的资源中下载。
      <br/>
      <a href="https://download.csdn.net/download/hepu8/10668509">
       https://download.csdn.net/download/hepu8/10668509
      </a>
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874:7470733a2f2f626c6f672e6373646e2e6e65742f6865707538:2f61727469636c652f64657461696c732f3832373132363639" class_="artid" style="display:none">
 </p>
</div>


