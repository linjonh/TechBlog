---
layout: post
title: "python-struct.pack用法转"
date: 2024-11-27 20:06:12 +0800
description: "1、 struct.pack struct.pack用于将Python的值根据格式符，转换为字符串（"
keywords: "python struct.pack"
categories: ['Python']
tags: ['无标签']
artid: "88392592"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=88392592
    alt: "python-struct.pack用法转"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=88392592
featuredImagePreview: https://bing.ee123.net/img/rand?artid=88392592
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     python struct.pack用法(转)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <div class="article_content clearfix csdn-tracking-statistics" id="article_content">
     <div class="markdown_views" id="content_views">
      <svg xmlns="http://www.w3.org/2000/svg">
       <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round">
       </path>
      </svg>
      <p>
       1、 struct.pack
       <br/>
       struct.pack用于将Python的值根据格式符，转换为字符串（因为Python中没有字节(Byte)类型，可以把这里的字符串理解为字节流，或字节数组）。其函数原型为：struct.pack(fmt, v1, v2, …)，参数fmt是格式字符串，关于格式字符串的相关信息在下面有所介绍。v1, v2, …表示要转换的python值。下面的例子将两个整数转换为字符串（字节流）:
      </p>
     </div>
    </div>
    <pre class="prettyprint"><code class="language-python hljs has-numbering"><span class="hljs-comment">#!/usr/bin/env python  </span>
<span class="hljs-comment">#encoding: utf8  </span>

<span class="hljs-keyword">import</span> sys  
reload(sys)  
sys.setdefaultencoding(<span class="hljs-string">"utf-8"</span>)  

<span class="hljs-keyword">import</span> struct  

a = <span class="hljs-number">20</span>  
b = <span class="hljs-number">400</span>   
str = struct.pack(<span class="hljs-string">"ii"</span>, a, b)  
<span class="hljs-keyword">print</span> <span class="hljs-string">'length: '</span>, len(str)          <span class="hljs-comment"># length:  8  </span>
<span class="hljs-keyword">print</span> str                           <span class="hljs-comment"># 乱码：   </span>
<span class="hljs-keyword">print</span> repr(str)                     <span class="hljs-comment"># '\x14\x00\x00\x00\x90\x01\x00\x00' </span></code>
 
 <ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li></ul></pre>
    <p>
     格式符”i”表示转换为int，’ii’表示有两个int变量。
     <br/>
     进行转换后的结果长度为8个字节（int类型占用4个字节，两个int为8个字节）
     <br/>
     可以看到输出的结果是乱码，因为结果是二进制数据，所以显示为乱码。
     <br/>
     可以使用python的内置函数repr来获取可识别的字符串，其中十六进制的0x00000014, 0x00001009分别表示20和400。
    </p>
    <p>
     2、 struct.unpack
     <br/>
     struct.unpack做的工作刚好与struct.pack相反，用于将字节流转换成python数据类型。它的函数原型为：struct.unpack(fmt, string)，该函数返回一个元组。
     <br/>
     下面是一个简单的例子：
    </p>
    <pre class="prettyprint"><code class="language-python hljs has-numbering">[python] view plain copy
<span class="hljs-comment">#!/usr/bin/env python  </span>
<span class="hljs-comment">#encoding: utf8  </span>

<span class="hljs-keyword">import</span> sys  
reload(sys)  
sys.setdefaultencoding(<span class="hljs-string">"utf-8"</span>)  

<span class="hljs-keyword">import</span> struct  

a = <span class="hljs-number">20</span>  
b = <span class="hljs-number">400</span>   

<span class="hljs-comment"># pack  </span>
str = struct.pack(<span class="hljs-string">"ii"</span>, a, b)  
<span class="hljs-keyword">print</span> <span class="hljs-string">'length: '</span>, len(str)          <span class="hljs-comment"># length:  8  </span>
<span class="hljs-keyword">print</span> str                           <span class="hljs-comment"># 乱码：   </span>
<span class="hljs-keyword">print</span> repr(str)                     <span class="hljs-comment"># '\x14\x00\x00\x00\x90\x01\x00\x00'  </span>

<span class="hljs-comment"># unpack  </span>
str2 = struct.unpack(<span class="hljs-string">"ii"</span>, str)  
<span class="hljs-keyword">print</span> <span class="hljs-string">'length: '</span>, len(str2)          <span class="hljs-comment"># length:  2  </span>
<span class="hljs-keyword">print</span> str2                           <span class="hljs-comment"># (20, 400)  </span>
<span class="hljs-keyword">print</span> repr(str2)                     <span class="hljs-comment"># (20, 400)  </span></code>
 
 <ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li><li>24</li></ul></pre>
    <p>
     3、 struct.calcsize
     <br/>
     struct.calcsize用于计算格式字符串所对应的结果的长度，如：struct.calcsize(‘ii’)，返回8。因为两个int类型所占用的长度是8个字节。
    </p>
    <pre class="prettyprint"><code class="language-python hljs has-numbering">[python] view plain copy
<span class="hljs-keyword">import</span> struct  
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'i'</span>)       <span class="hljs-comment"># len:  4  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'ii'</span>)      <span class="hljs-comment"># len:  8  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'f'</span>)       <span class="hljs-comment"># len:  4  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'ff'</span>)      <span class="hljs-comment"># len:  8  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'s'</span>)       <span class="hljs-comment"># len:  1  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'ss'</span>)      <span class="hljs-comment"># len:  2  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'d'</span>)       <span class="hljs-comment"># len:  8  </span>
<span class="hljs-keyword">print</span> <span class="hljs-string">"len: "</span>, struct.calcsize(<span class="hljs-string">'dd'</span>)      <span class="hljs-comment"># len:  16  </span></code>
 
 <ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li></ul></pre>
    <p>
     4、 struct.pack_into、 struct.unpack_from
     <br/>
     这两个函数在Python手册中有所介绍，但没有给出如何使用的例子。其实它们在实际应用中用的并不多。Google了很久，才找到一个例子，贴出来共享一下：
    </p>
    <pre class="prettyprint"><code class="language-python hljs has-numbering">[python] view plain copy
<span class="hljs-comment">#!/usr/bin/env python  </span>
<span class="hljs-comment">#encoding: utf8  </span>

<span class="hljs-keyword">import</span> sys  
reload(sys)  
sys.setdefaultencoding(<span class="hljs-string">"utf-8"</span>)  

<span class="hljs-keyword">import</span> struct  
<span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> create_string_buffer  

buf = create_string_buffer(<span class="hljs-number">12</span>)  
<span class="hljs-keyword">print</span> repr(buf.raw)     <span class="hljs-comment"># '\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'  </span>

struct.pack_into(<span class="hljs-string">"iii"</span>, buf, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)  
<span class="hljs-keyword">print</span> repr(buf.raw)     <span class="hljs-comment"># '\x01\x00\x00\x00\x02\x00\x00\x00\xff\xff\xff\xff'  </span>

<span class="hljs-keyword">print</span> struct.unpack_from(<span class="hljs-string">"iii"</span>, buf, <span class="hljs-number">0</span>)     <span class="hljs-comment"># (1, 2, -1)  </span>
具体内容请参考Python手册 struct 模块
Python手册 struct 模块：http://docs.python.org/library/struct.html<span class="hljs-comment">#module-struct</span></code>
 
 <ul class="pre-numbering"><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li></ul></pre>
    <p>
     struct 类型表
    </p>
    <div class="table-box">
     <table border="1" cellpadding="5" class="docutils" width="800">
      <thead>
       <tr>
        <th class="head">
         Format
        </th>
        <th class="head">
         C Type
        </th>
        <th class="head">
         Python type
        </th>
        <th class="head">
         Standard size
        </th>
        <th class="head">
         Notes
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           x
          </span>
         </tt>
        </td>
        <td>
         pad byte
        </td>
        <td>
         no value
        </td>
        <td>
        </td>
        <td>
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           c
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           char
          </span>
         </tt>
        </td>
        <td>
         string of length 1
        </td>
        <td>
         1
        </td>
        <td>
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           b
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           signed
          </span>
          <span class="pre">
           char
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         1
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           B
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           unsigned
          </span>
          <span class="pre">
           char
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         1
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           ?
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           _Bool
          </span>
         </tt>
        </td>
        <td>
         bool
        </td>
        <td>
         1
        </td>
        <td>
         (1)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           h
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           short
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         2
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           H
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           unsigned
          </span>
          <span class="pre">
           short
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         2
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           i
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           int
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         4
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           I
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           unsigned
          </span>
          <span class="pre">
           int
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         4
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           l
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           long
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         4
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           L
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           unsigned
          </span>
          <span class="pre">
           long
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         4
        </td>
        <td>
         (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           q
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           long
          </span>
          <span class="pre">
           long
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         8
        </td>
        <td>
         (2), (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           Q
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           unsigned
          </span>
          <span class="pre">
           long
          </span>
          <span class="pre">
           long
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
         8
        </td>
        <td>
         (2), (3)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           f
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           float
          </span>
         </tt>
        </td>
        <td>
         float
        </td>
        <td>
         4
        </td>
        <td>
         (4)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           d
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           double
          </span>
         </tt>
        </td>
        <td>
         float
        </td>
        <td>
         8
        </td>
        <td>
         (4)
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           s
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           char[]
          </span>
         </tt>
        </td>
        <td>
         string
        </td>
        <td>
         1
        </td>
        <td>
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           p
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           char[]
          </span>
         </tt>
        </td>
        <td>
         string
        </td>
        <td>
        </td>
        <td>
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          <span class="pre">
           P
          </span>
         </tt>
        </td>
        <td>
         <tt class="xref docutils literal">
          <span class="pre">
           void
          </span>
          <span class="pre">
           *
          </span>
         </tt>
        </td>
        <td>
         integer
        </td>
        <td>
        </td>
        <td>
         (5), (3)
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f796f75726e657665726d6f7265:2f61727469636c652f64657461696c732f3838333932353932" class_="artid" style="display:none">
 </p>
</div>


