---
layout: post
title: "再聊-Flutter-Riverpod-,注解模式下的-Riverpod-有什么特别之处,还有发展方向"
date: 2025-03-10 06:43:07 +0800
description: "在此之前，我们需要先回忆一下，riverpod  最明显的特点是将转换成WidgetRef抽象，从而让状态管理不直接依赖实现，共享实例的顶层存在，提供一个全局共享：用于管理和保存各种 “Provider” 的 State ，并且支持 override 一些特殊 “Provider” 的行为，还有常见的  read\\watch\\refeshRef：提供 riverpod 内的  “Provider” 交互接口，是 riverpod 内 ProviderElementBase 的抽象。"
keywords: "再聊 Flutter Riverpod ，注解模式下的 Riverpod 有什么特别之处，还有发展方向"
categories: ['Android']
tags: ['前端', 'Ios', 'Flutter', 'Android']
artid: "146142983"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146142983
    alt: "再聊-Flutter-Riverpod-,注解模式下的-Riverpod-有什么特别之处,还有发展方向"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146142983
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146142983
cover: https://bing.ee123.net/img/rand?artid=146142983
image: https://bing.ee123.net/img/rand?artid=146142983
img: https://bing.ee123.net/img/rand?artid=146142983
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     再聊 Flutter Riverpod ，注解模式下的 Riverpod 有什么特别之处，还有发展方向
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     三年前我们通过
     <a href="https://blog.csdn.net/ZuoYueLiang/article/details/122871775">
      《Flutter Riverpod 全面深入解析》
     </a>
     深入理解了 riverpod 的内部实现，而时隔三年之后，如今Riverpod 的主流模式已经是注解，那今天就让我们来聊聊 riverpod 的注解有什么特殊之处。
    </p>
    <h2>
     <a id="_3">
     </a>
     前言
    </h2>
    <p>
     在此之前，我们需要先回忆一下，
     <strong>
      riverpod 最明显的特点是将
      <code>
       BuildContext
      </code>
      转换成
      <code>
       WidgetRef
      </code>
      抽象
     </strong>
     ，从而让状态管理不直接依赖
     <code>
      BuildContext
     </code>
     ，所以对应的 Provider 可以按需写成全局对象，而在 riverpod 里，主要的核心对象有：
    </p>
    <ul>
     <li>
      <strong>
       ProviderScope
      </strong>
      ：
      <code>
       InheritedWidget
      </code>
      实现，共享实例的顶层存在，提供一个
      <code>
       ProviderContainer
      </code>
      全局共享
     </li>
     <li>
      <strong>
       ProviderContainer
      </strong>
      ：用于管理和保存各种 “Provider” 的 State ，并且支持 override 一些特殊 “Provider” 的行为，还有常见的 read\watch\refesh
     </li>
     <li>
      <strong>
       Ref
      </strong>
      ：提供 riverpod 内的 “Provider” 交互接口，是 riverpod 内 ProviderElementBase 的抽象
     </li>
     <li>
      <strong>
       ProviderElementBase
      </strong>
      ： Ref 的实现，每个 “Provider” 都会有自己的 “Element” ，而构建 “Provider” 时是传入的
      <code>
       Create
      </code>
      函数会在 “Element” 内通过 “
      <code>
       setState
      </code>
      ” 调用执行，比如
      <code>
       StateProvider((ref)=&gt; 0)
      </code>
      这里的 ref ，就是内部在 ”Element“ 里通过
      <code>
       setState(_provider.create(this));
      </code>
      " 的时候传入的 this
     </li>
     <li>
      <strong>
       WidgetRef
      </strong>
      ：替代 Flutter
      <code>
       BuildContext
      </code>
      的抽象，内部通过继承
      <code>
       StatefulWidget
      </code>
      实现，作为 BuildContext 的对外替代
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/822f332b26a1e93bcaccc27931b422d0.png"/>
    </p>
    <blockquote>
     <p>
      所以 “Provider” 里的
      <code>
       Ref
      </code>
      和 “Consumer” 的
      <code>
       WidgetRef
      </code>
      严格来说是两个不同的东西，只是它们内部都可以获取到
      <code>
       ProviderContainer
      </code>
      ，从而支持对应 read\watch\refesh 等功能，这也是为什么你在外部直接通过
      <code>
       ProviderContainer
      </code>
      也可以全局直接访问到 read\watch\refesh 的原因。
     </p>
    </blockquote>
    <p>
     另外，
     <strong>
      riverpod 内部定义了自己的 「Element」 和 「setState」实现，它们并不是 Flutter 里的 Element 和 setState
     </strong>
     ，所以上面都加了 “”，甚至 riverpod 里的 “Provider” 和 Provider 状态管理库也没有关系， 这么设计是为了贴合 Flutter 本身的 「Element」 和 「setState」概念，所以这也是为什么说 riverpod 是专为 Flutter 而存在的设计。
    </p>
    <h2>
     <a id="_19">
     </a>
     注解模式
    </h2>
    <p>
     现在 riverpod 更多提倡使用注解模式，
     <strong>
      注解模式可以让 riverpod 使用起来更方便且规范，从一定程度也降低了使用难度
     </strong>
     ，但是也对初学者屏蔽了不少过去的手写实现，导致在出现问题时新手也可能会相对更蒙。
    </p>
    <h3>
     <a id="_23">
     </a>
     简单函数注解
    </h3>
    <p>
     首先我们看这个简单的代码，我们在
     <code>
      main.dart
     </code>
     里添加了了一个
     <code>
      @riverpod
     </code>
     给
     <code>
      helloWorld
     </code>
     ，然后运行
     <code>
      flutter pub run build_runner build --delete-conflicting-outputs
     </code>
     ，可以看到此时生成了对应的
     <code>
      main.g.dart
     </code>
     文件：
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter_riverpod/flutter_riverpod.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:riverpod_annotation/riverpod_annotation.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string-literal"><span class="token string">'main.g.dart'</span></span><span class="token punctuation">;</span>

<span class="token metadata function">@riverpod</span>
<span class="token class-name">String</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token class-name">Ref</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">ConsumerWidget</span> <span class="token punctuation">{<!-- --></span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">WidgetRef</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> value <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>helloWorldProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
      home<span class="token punctuation">:</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Example'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
          child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     我们看
     <code>
      main.g.dart
     </code>
     文件，可以看到，根据
     <code>
      @riverpod
     </code>
     的规则，
     <code>
      helloWorld
     </code>
     会生成一个
     <code>
      helloWorldProvider
     </code>
     实例让我们在使用时 read/watch/refresh ：
    </p>
    <pre><code class="prism language-dart"><span class="token comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span>

<span class="token keyword">part</span> of <span class="token string-literal"><span class="token string">'main.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">// **************************************************************************</span>
<span class="token comment">// RiverpodGenerator</span>
<span class="token comment">// **************************************************************************</span>

<span class="token class-name">String</span> _$<span class="token function">helloWorldHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string-literal"><span class="token string">r'9abaa5ab530c55186861f2debdaa218aceacb7eb'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// See also [helloWorld].</span>
<span class="token metadata function">@ProviderFor</span><span class="token punctuation">(</span>helloWorld<span class="token punctuation">)</span>
<span class="token keyword">final</span> helloWorldProvider <span class="token operator">=</span> <span class="token class-name">AutoDisposeProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token function">internal</span><span class="token punctuation">(</span>
  helloWorld<span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">r'helloWorldProvider'</span></span><span class="token punctuation">,</span>
  debugGetCreateSourceHash<span class="token punctuation">:</span>
      <span class="token keyword">const</span> bool<span class="token punctuation">.</span><span class="token function">fromEnvironment</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'dart.vm.product'</span></span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _$helloWorldHash<span class="token punctuation">,</span>
  dependencies<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  allTransitiveDependencies<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token metadata function">@Deprecated</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Will be removed in 3.0. Use Ref instead'</span></span><span class="token punctuation">)</span>
<span class="token comment">// ignore: unused_element</span>
<span class="token keyword">typedef</span> <span class="token class-name">HelloWorldRef</span> <span class="token operator">=</span> <span class="token class-name">AutoDisposeProviderRef</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token comment">// ignore_for_file: type=lint</span>
<span class="token comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member, deprecated_member_use_from_same_package</span>

</code></pre>
    <p>
     通过生成的代码，我们可以看到：
    </p>
    <ul>
     <li>
      <code>
       _$helloWorldHash()
      </code>
      ：它主要是用于提供一个唯一标识，用于追踪 Provider 的来源和状态，它是被
      <code>
       debugGetCreateSourceHash
      </code>
      所使用，例如在 Debug 模式下 hotload 时，riverpod 会用这个值来判断当前 provider 是否需要重建，比如当你重新生成的时候 hash 值就会出现变化。
     </li>
     <li>
      <code>
       helloWorldProvider
      </code>
      ：
      <code>
       AutoDisposeProvider
      </code>
      的实例，也就是默认情况下
      <code>
       @riverpod
      </code>
      生成的都是自动销毁的 Provider ，
     </li>
    </ul>
    <blockquote>
     <p>
      这里默认使用
      <code>
       AutoDisposeProvider
      </code>
      ，也是为了更好的释放内存和避免不必需要的内存泄漏等场景，
      <code>
       AutoDisposeProvider
      </code>
      内部，在每次
      <code>
       read
      </code>
      、
      <code>
       invalidate
      </code>
      、页面退出、
      <code>
       ProviderContainer
      </code>
      销毁等场景会自动调用 dispose 。
     </p>
    </blockquote>
    <h3>
     <a id="_94">
     </a>
     异步函数注解
    </h3>
    <p>
     接着，如果给
     <code>
      helloWorld
     </code>
     增加 async ，那么我们得到一个
     <code>
      AutoDisposeFutureProvider
     </code>
     ，同理，如果是
     <code>
      async*
     </code>
     就会生成一个
     <code>
      AutoDisposeStreamProvider
     </code>
     ：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@riverpod</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token class-name">Ref</span> ref<span class="token punctuation">)</span> <span class="token keyword">async</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>GENERATED CODE<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>

<span class="token metadata function">@ProviderFor</span><span class="token punctuation">(</span>helloWorld<span class="token punctuation">)</span>
<span class="token keyword">final</span> helloWorldProvider <span class="token operator">=</span> <span class="token class-name">AutoDisposeFutureProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token function">internal</span><span class="token punctuation">(</span>
  helloWorld<span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">r'helloWorldProvider'</span></span><span class="token punctuation">,</span>
  debugGetCreateSourceHash<span class="token punctuation">:</span>
      <span class="token keyword">const</span> bool<span class="token punctuation">.</span><span class="token function">fromEnvironment</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'dart.vm.product'</span></span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _$helloWorldHash<span class="token punctuation">,</span>
  dependencies<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  allTransitiveDependencies<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     当然，在返回结果使用上会有些差别， 异步的 Provider 会返回一个
     <code>
      AsyncValue
     </code>
     ，或者需要
     <code>
      .value
     </code>
     获取一个非空安全的对象：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@override</span>
<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">WidgetRef</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">final</span> <span class="token class-name">AsyncValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> asyncValue <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>helloWorldProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token operator">?</span> value <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>helloWorldProvider<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
    home<span class="token punctuation">:</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
      appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Example'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>asyncValue<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>
            data<span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">,</span>
            error<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string-literal"><span class="token string">"error"</span></span><span class="token punctuation">,</span>
            loading<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string-literal"><span class="token string">"loading"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_138">
     </a>
     函数注解带参数
    </h3>
    <p>
     当你需要给
     <code>
      helloWorld
     </code>
     增加参数的时候，此时的
     <code>
      helloWorldProvider
     </code>
     就不再是一个
     <code>
      AutoDisposeFutureProvider
     </code>
     实例，它将变成
     <code>
      HelloWorldFamily
     </code>
     ，它是一个
     <code>
      Family
     </code>
     的实现：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@riverpod</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token class-name">Ref</span> ref<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">value</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">type</span></span><span class="token string">'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token metadata function">@override</span>
<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">WidgetRef</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">final</span> <span class="token class-name">AsyncValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> asyncValue <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token function">helloWorldProvider</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token operator">?</span> value <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token function">helloWorldProvider</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>GENERATED CODE<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>

<span class="token comment">/// See also [helloWorld].</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorldFamily</span> <span class="token keyword">extends</span> <span class="token class-name">Family</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AsyncValue</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/// See also [helloWorld].</span>
  <span class="token keyword">const</span> <span class="token class-name">HelloWorldFamily</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// See also [helloWorld].</span>
  <span class="token class-name">HelloWorldProvider</span> <span class="token function">call</span><span class="token punctuation">(</span>
    <span class="token class-name">String</span> value<span class="token punctuation">,</span>
    <span class="token class-name">String</span> type<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">HelloWorldProvider</span><span class="token punctuation">(</span>
      value<span class="token punctuation">,</span>
      type<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">HelloWorldProvider</span> <span class="token function">getProviderOverride</span><span class="token punctuation">(</span>
    <span class="token keyword">covariant</span> <span class="token class-name">HelloWorldProvider</span> provider<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">call</span><span class="token punctuation">(</span>
      provider<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      provider<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProviderOrFamily</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> _dependencies <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProviderOrFamily</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> <span class="token keyword">get</span> dependencies <span class="token operator">=</span><span class="token operator">&gt;</span> _dependencies<span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProviderOrFamily</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> _allTransitiveDependencies <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProviderOrFamily</span><span class="token punctuation">&gt;</span></span><span class="token operator">?</span> <span class="token keyword">get</span> allTransitiveDependencies <span class="token operator">=</span><span class="token operator">&gt;</span>
      _allTransitiveDependencies<span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">String</span><span class="token operator">?</span> <span class="token keyword">get</span> name <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string-literal"><span class="token string">r'helloWorldProvider'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <blockquote>
     <p>
      在 Dart 中，call 方法是一个特殊的方法，它可以让一个类的实例像函数一样调用。
     </p>
    </blockquote>
    <p>
     说到
     <code>
      Family
     </code>
     ， 它的作用是主要就是支持
     <strong>
      使用额外的参数构建 Provider
     </strong>
     ，因为前面
     <code>
      helloWorld
     </code>
     需要传递参数，所以
     <code>
      HelloWorldFamily
     </code>
     的主要作用，就是提供创建和覆盖需要参数的 Provider，例如前面的：
    </p>
    <pre><code class="prism language-dart">  <span class="token keyword">final</span> <span class="token class-name">AsyncValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> asyncValue <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token function">helloWorldProvider</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token operator">?</span> value <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token function">helloWorldProvider</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"1"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"2"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
</code></pre>
    <p>
     当然，这里你需要注意，不同与前面的
     <code>
      helloWorldProvider
     </code>
     实例，需要参数的 Provider 需要你每次使用时通过参数构建，而此时你每次调用如
     <code>
      helloWorldProvider("1", "2")
     </code>
     都是创建了一个全新实例，如果你需要同一个数据源下 read/watch ，那么你应该在调用时共用一个全局
     <code>
      helloWorldProvider("1", "2")
     </code>
     实例。
    </p>
    <p>
     如果是不同 Provider 实例，那么你获取到的参数其实是不一样的，因为内部 map 登记的映射关系就是基于 Provider 实例为 key ：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/f24bb3080396aafc56b6bb8e953862d1.png"/>
    </p>
    <p>
     不过对比之下，过去你使用
     <code>
      FutureProvider.family
     </code>
     只能覆带一个
     <code>
      Arg
     </code>
     参数，虽然可以通过语法糖传递多个参数，但是终究还是比注解生成的麻烦：
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">final</span> helloWorldFamily <span class="token operator">=</span>
    <span class="token class-name">FutureProvider</span><span class="token punctuation">.</span>family<span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">value</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">type</span></span><span class="token string">'</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     另外，注解生成时，还会动态生成一个对应的 “Element” ，让 Element 支持获取 Provider 的参数，并实现对应
     <code>
      build
     </code>
     方法，也就是通过 ref 可以获取到相关参数：
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">mixin</span> <span class="token class-name">HelloWorldRef</span> <span class="token keyword">on</span> <span class="token class-name">AutoDisposeFutureProviderRef</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/// The parameter `value` of this provider.</span>
  <span class="token class-name">String</span> <span class="token keyword">get</span> value<span class="token punctuation">;</span>

  <span class="token comment">/// The parameter `type` of this provider.</span>
  <span class="token class-name">String</span> <span class="token keyword">get</span> type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HelloWorldProviderElement
    <span class="token keyword">extends</span> <span class="token class-name">AutoDisposeFutureProviderElement</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">with</span> <span class="token class-name">HelloWorldRef</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">_HelloWorldProviderElement</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">String</span> <span class="token keyword">get</span> value <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>origin <span class="token operator">as</span> <span class="token class-name">HelloWorldProvider</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">String</span> <span class="token keyword">get</span> type <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>origin <span class="token operator">as</span> <span class="token class-name">HelloWorldProvider</span><span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     最后，带参数之后，生成的
     <code>
      _SystemHash
     </code>
     也会根据参数动态变化，从而支持 hotload 等场景：
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">class</span> _SystemHash <span class="token punctuation">{<!-- --></span>
  _SystemHash<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> int <span class="token function">combine</span><span class="token punctuation">(</span>int hash<span class="token punctuation">,</span> int value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ignore: parameter_assignments</span>
    hash <span class="token operator">=</span> <span class="token number">0x1fffffff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>hash <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ignore: parameter_assignments</span>
    hash <span class="token operator">=</span> <span class="token number">0x1fffffff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x0007ffff</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> hash <span class="token operator">^</span> <span class="token punctuation">(</span>hash <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> int <span class="token function">finish</span><span class="token punctuation">(</span>int hash<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ignore: parameter_assignments</span>
    hash <span class="token operator">=</span> <span class="token number">0x1fffffff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x03ffffff</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ignore: parameter_assignments</span>
    hash <span class="token operator">=</span> hash <span class="token operator">^</span> <span class="token punctuation">(</span>hash <span class="token operator">&gt;&gt;</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0x1fffffff</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x00003fff</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_269">
     </a>
     类注解
    </h3>
    <p>
     接着，我们看
     <code>
      @riverpod
     </code>
     除了可以注解函数之后，还可以直接注解 class ，只是 class 需要继承
     <code>
      _$***
     </code>
     一个子类：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@riverpod</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> _$<span class="token class-name">HelloWorld</span> <span class="token punctuation">{<!-- --></span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">String</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world'</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    state <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token metadata function">@override</span>
<span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">WidgetRef</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">final</span> <span class="token class-name">String</span> asyncValue <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>helloWorldProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ref<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>helloWorldProvider<span class="token punctuation">.</span>notifier<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"next"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过生成代码可以看到，此时生成的是
     <code>
      AutoDisposeNotifierProvider
     </code>
     ，也就是在读取时，可以通过
     <code>
      read(****Provider.notifier)
     </code>
     去改变状态：
    </p>
    <pre><code class="prism language-dart"><span class="token class-name">String</span> _$<span class="token function">helloWorldHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string-literal"><span class="token string">r'52966cfeefb6334e736061e19443e4c8b94160d8'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// See also [HelloWorld].</span>
<span class="token metadata function">@ProviderFor</span><span class="token punctuation">(</span><span class="token class-name">HelloWorld</span><span class="token punctuation">)</span>
<span class="token keyword">final</span> helloWorldProvider <span class="token operator">=</span>
    <span class="token class-name">AutoDisposeNotifierProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HelloWorld</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token function">internal</span><span class="token punctuation">(</span>
  <span class="token class-name">HelloWorld</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">r'helloWorldProvider'</span></span><span class="token punctuation">,</span>
  debugGetCreateSourceHash<span class="token punctuation">:</span>
      <span class="token keyword">const</span> bool<span class="token punctuation">.</span><span class="token function">fromEnvironment</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'dart.vm.product'</span></span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _$helloWorldHash<span class="token punctuation">,</span>
  dependencies<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  allTransitiveDependencies<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> _$<span class="token class-name">HelloWorld</span> <span class="token operator">=</span> <span class="token class-name">AutoDisposeNotifier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
</code></pre>
    <p>
     也就是，
     <strong>
      通过
      <code>
       @riverpod
      </code>
      注解的 class ，是带有 state 状态的 NotifierProvider ，这是对比注解函数最明显的差异
     </strong>
     。
    </p>
    <p>
     而如果注解 class 需要携带参数，那么可以在
     <code>
      build
     </code>
     上添加需要的参数，最终同样和函数一样会生成一个对应的
     <code>
      HelloWorldFamily
     </code>
     ：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@riverpod</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> _$<span class="token class-name">HelloWorld</span> <span class="token punctuation">{<!-- --></span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">String</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world'</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    state <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     同理，如果你给 build 增加了 async，那么就会生成一个
     <code>
      AutoDisposeAsyncNotifierProviderImpl
     </code>
     的相关实现：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@riverpod</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> _$<span class="token class-name">HelloWorld</span> <span class="token punctuation">{<!-- --></span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">'Hello world'</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> currentValue <span class="token operator">=</span> state<span class="token punctuation">.</span>valueOrNull <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">;</span>
    state <span class="token operator">=</span> <span class="token class-name">AsyncData</span><span class="token punctuation">(</span>currentValue <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">removeString</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> currentValue <span class="token operator">=</span> state<span class="token punctuation">.</span>valueOrNull <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">;</span>
    state <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">copyWithPrevious</span><span class="token punctuation">(</span><span class="token class-name">AsyncData</span><span class="token punctuation">(</span>currentValue<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     可以看到，
     <strong>
      在注解 class 下可操作空间是在 build ，并且需要注意的是，当你调用
      <code>
       refresh
      </code>
      的时候，State 是会被清空，并且重新调用 build
     </strong>
     。
    </p>
    <h3>
     <a id="KeepAlive_354">
     </a>
     KeepAlive
    </h3>
    <p>
     那么我们前面说的都是 AutoDispose ，如果我不想他被释放呢？那就是需要用到大写字母开头的
     <code>
      @Riverpod
     </code>
     ，给参数配置上
     <code>
      keepAlive: true
     </code>
     ：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@Riverpod</span><span class="token punctuation">(</span>keepAlive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> _$<span class="token class-name">HelloWorld</span> 
</code></pre>
    <p>
     然后再看输出文件，你就会看到此时
     <code>
      HelloWorldProvider
     </code>
     继承的是
     <code>
      AsyncNotifierProviderImpl
     </code>
     而不是
     <code>
      AutoDispose
     </code>
     了：
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">class</span> <span class="token class-name">HelloWorldProvider</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncNotifierProviderImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HelloWorld</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/// See also [HelloWorld].</span>
  <span class="token class-name">HelloWorldProvider</span><span class="token punctuation">(</span>
    <span class="token class-name">String</span> value<span class="token punctuation">,</span>
    <span class="token class-name">String</span> type<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_internal</span><span class="token punctuation">(</span>
</code></pre>
    <h3>
     <a id="dependencies_374">
     </a>
     dependencies
    </h3>
    <p>
     另外
     <code>
      @Riverpod
     </code>
     还有另外一个可配置参数
     <code>
      dependencies
     </code>
     ，从名字上理解起来是依赖的意思，但是其实它更多用于「作用域」相关的处理。
    </p>
    <p>
     在 riverpod 里，框架的设计是支持多个 ProviderContainer 的场景，并且每个容器可以覆盖（override）某些 Provider 的数据，例如我只是添加了一个
     <code>
      dependencies: []
     </code>
     ，
     <strong>
      此时无论列表是否为空，它都可以被认为是一个具有作用域支持的 Provider，从而实现根据上下文进行数据隔离，另外不为空时还可以看作声明 Provider 在作用域内的依赖关系
     </strong>
     。
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@Riverpod</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      但是，不是你加了 dependencies 它就自动产生作用域隔离了，不为空时也不会自动追加依赖
     </strong>
     ，它只是一个声明作用，后续还是需要代码配合。
    </p>
    <p>
     如下代码所示，这里简单的声明了一个带有
     <code>
      dependencies
     </code>
     的
     <code>
      Counter
     </code>
     ，然后：
    </p>
    <ul>
     <li>
      在页面通过
      <code>
       ref.watch(counterProvider)
      </code>
      监听了 Counter
     </li>
     <li>
      在新的 dialog 也通过
      <code>
       ref2.watch(counterProvider)
      </code>
      监听了 Counter
     </li>
    </ul>
    <pre><code class="prism language-dart"><span class="token metadata function">@Riverpod</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> _$<span class="token class-name">Counter</span> <span class="token punctuation">{<!-- --></span>
  <span class="token metadata function">@override</span>
  int <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>int count<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    state <span class="token operator">=</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{<!-- --></span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">ProviderScope</span><span class="token punctuation">(</span>
      child<span class="token punctuation">:</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
        home<span class="token punctuation">:</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">final</span> count <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>counterProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>
              mainAxisAlignment<span class="token punctuation">:</span> <span class="token class-name">MainAxisAlignment</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Counter: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">count</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">ElevatedButton</span><span class="token punctuation">(</span>
                  onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">showDialog</span><span class="token punctuation">(</span>
                      context<span class="token punctuation">:</span> ctx<span class="token punctuation">,</span>
                      builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">AlertDialog</span><span class="token punctuation">(</span>
                          title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Dialog'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          content<span class="token punctuation">:</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> ref2<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">final</span> count2 <span class="token operator">=</span> ref2<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>counterProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> <span class="token class-name">InkWell</span><span class="token punctuation">(</span>
                              onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                ref2
                                    <span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>counterProvider<span class="token punctuation">.</span>notifier<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>count2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                              <span class="token punctuation">}</span><span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Dialog Counter: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">count2</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">;</span>
                          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Open Dialog'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            floatingActionButton<span class="token punctuation">:</span> <span class="token class-name">FloatingActionButton</span><span class="token punctuation">(</span>onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              ref<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>counterProvider<span class="token punctuation">.</span>notifier<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     结果最后运行发现，Dialog 和主页的 Counter 其实还是共享的，
     <code>
      dependencies
     </code>
     并没有起到作用：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/290a83f61ad060f1e38007e6d79a8d9f.gif"/>
    </p>
    <p>
     之所以这样，原因在于没有增加新的
     <code>
      ProviderScope
     </code>
     ，如下代码所示，只要将上面的
     <code>
      showDialog
     </code>
     部分修改为如下代码所示：
    </p>
    <ul>
     <li>
      新增一个 的
      <code>
       ProviderScope
      </code>
     </li>
     <li>
      通过
      <code>
       overrides
      </code>
      指定对应
      <code>
       counterProvider
      </code>
     </li>
    </ul>
    <pre><code class="prism language-dart"><span class="token function">showDialog</span><span class="token punctuation">(</span>
  context<span class="token punctuation">:</span> ctx<span class="token punctuation">,</span>
  builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">ProviderScope</span><span class="token punctuation">(</span>
    overrides<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      counterProvider，
      <span class="token comment">///你还可以 overrideWith 覆盖修改</span>
      <span class="token comment">//counterProvider.overrideWith(()=&gt;Counter())</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    child<span class="token punctuation">:</span> <span class="token class-name">AlertDialog</span><span class="token punctuation">(</span>
        title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Dialog'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        content<span class="token punctuation">:</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> ref2<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">final</span> count2 <span class="token operator">=</span> ref2<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>counterProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">InkWell</span><span class="token punctuation">(</span>
            onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              ref2
                  <span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>counterProvider<span class="token punctuation">.</span>notifier<span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>count2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'Dialog Counter: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">count2</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     以上条件缺一不可以，运行后如下图所示，可以看到此时
     <code>
      counterProvider
     </code>
     在主页和 Dialog 之间被有效分割开：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5eaa170cc4d7f48ca50d4ee984e85bae.gif"/>
    </p>
    <p>
     其实原因从源码里也可以看出来，在
     <code>
      ProviderContainer
     </code>
     内部源码我们可以看到，要产生一个独立的作用域，你需要：
    </p>
    <ul>
     <li>
      root 不为空，也就是有一个上级
      <code>
       ProviderContainer
      </code>
     </li>
     <li>
      其次存在
      <code>
       dependencies
      </code>
      且
      <code>
       ProviderContainer
      </code>
      的 override 不为空，也就是
      <code>
       dependencies
      </code>
      不为 null 就行，但是 override 必须有 Provider
     </li>
     <li>
      最后才是返回全新的
      <code>
       _StateReader
      </code>
      用于提供状态数据
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/35bdfcdf42e55d8a1d3de64879d5cc33.png"/>
    </p>
    <p>
     所以，从这里就可以看出，
     <strong>
      <code>
       dependencies
      </code>
      只是一个先置条件，具体它是不是局部作用域，还得是你用的时候怎么用
     </strong>
     。
    </p>
    <p>
     同理依赖也是，比如你写了一个
     <code>
      @Riverpod(dependencies: [maxCountProvider])
     </code>
     ，但是你还是需要对应写上
     <code>
      ref.watch(maxCountProvider)
     </code>
     ，不然它也并不起作用：
    </p>
    <pre><code class="prism language-dart"><span class="token metadata function">@Riverpod</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span>maxCountProvider<span class="token punctuation">]</span><span class="token punctuation">)</span>
int <span class="token function">limitedCounter</span><span class="token punctuation">(</span><span class="token class-name">LimitedCounterRef</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">final</span> max <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>maxCountProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听 </span>
  <span class="token keyword">return</span> <span class="token number">0.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      PS ，如果你只是正常监听，不需要作用域的场景，其实直接写
      <code>
       ref.watch
      </code>
      而不需要
      <code>
       dependencies: [maxCountProvider]
      </code>
      也是可以的。
     </p>
    </blockquote>
    <p>
     如果我们从输出端看，可以看到有没有
     <code>
      dependencies
     </code>
     ，主要就是
     <code>
      _dependencies
     </code>
     和
     <code>
      _allTransitiveDependencies
     </code>
     是否为空的区别：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6e17419e14d199a2811a703c86224880.png"/>
    </p>
    <h3>
     <a id="_515">
     </a>
     注意事项
    </h3>
    <p>
     最后也有一些注意事项，例如：
    </p>
    <ul>
     <li>
      <p>
       通过注解生成的 Provider 好不要依赖非生成的 Provider，比如这里的
       <code>
        example
       </code>
       是注解，它监听了一个非注解生成的
       <code>
        depProvider
       </code>
       ，这样并不规范：
      </p>
      <pre><code class="prism language-dart"><span class="token keyword">final</span> depProvider <span class="token operator">=</span> <span class="token class-name">Provider</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token metadata function">@riverpod</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token class-name">Ref</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// Generated providers should not depend on non-generated providers</span>
  ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>depProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       有作用域时，如果监听了某个 Provider ，那么 dependencies 里必须写上依赖 Provider，以下写法就不合规：
      </p>
      <pre><code class="prism language-dart"><span class="token metadata function">@Riverpod</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token class-name">Ref</span> ref<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// scopedProvider is used but not present in the list of dependencies</span>
  ref<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>scopedProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
     <li>
      <p>
       Provider 里不应该接收
       <code>
        BuildContext
       </code>
       ：
      </p>
      <pre><code class="prism language-dart"><span class="token comment">// Providers should not receive a BuildContext as a parameter.</span>
<span class="token metadata function">@riverpod</span>
int <span class="token function">fn</span><span class="token punctuation">(</span><span class="token class-name">Ref</span> ref<span class="token punctuation">,</span> <span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token metadata function">@riverpod</span>
<span class="token keyword">class</span> <span class="token class-name">MyNotifier</span> <span class="token keyword">extends</span> _$<span class="token class-name">MyNotifier</span> <span class="token punctuation">{<!-- --></span>
  int <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// Notifiers should not have methods that receive a BuildContext as a parameter.</span>
  <span class="token keyword">void</span> <span class="token function">event</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ul>
    <p>
     其实类型的注意事项在
     <a href="https://github.com/rrousselGit/riverpod/tree/master/packages/riverpod_lint#provider_dependencies-riverpod_generator-only">
      riverpod_lint
     </a>
     里都声明了，只是 Custom lint rules 不会直接展示在 dart analyze ，所以需要用户在添加完
     <a href="https://github.com/rrousselGit/riverpod/tree/master/packages/riverpod_lint#provider_dependencies-riverpod_generator-only">
      riverpod_lint
     </a>
     后，执行对应的
     <code>
      dart run custom_lint
     </code>
     ：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/d2be5a2344176f230cb883c0f26c00a4.png"/>
    </p>
    <h2>
     <a id="_567">
     </a>
     最后
    </h2>
    <p>
     可以看到，通过注解模式，riverpod 可以让开发者少些很多代码，在整体设计理念没有变化的情况下，模版生成的代码会更规范，并且在上层屏蔽了许多复杂度和工作量。
    </p>
    <p>
     另外通过
     <code>
      dependencies
     </code>
     我们可以可以看到 riverpod
     <strong>
      在存储管理上它是统一的，但是在组合上它是分散的
     </strong>
     的设计理念。
    </p>
    <p>
     而 Flutter 状态管理一直以来也是「是非之地」，比如近期就出现说 riverpod 在基准性能测试表示不如 signals 的情况，但是作者也回应了该测试属于「春秋笔法」之流：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/fe5207a54a71dbb868fcd7316695bffa.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9ebe06610cf522b799d4f77f20d1ef66.png"/>
    </p>
    <p>
     另外，由于
     <a href="https://juejin.cn/post/7464998185485877311" rel="nofollow">
      Dart 宏功能推进暂停
     </a>
     ，而 build runner 与数据类的优化还没落地，作者也在探索没有 codegen 下如何也可以便捷使用 riverpod ，比如让 family 支持多个参数：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/aa0297953b6d43103badb9b166c8943f.png"/>
    </p>
    <p>
     当然，从作者的维护体验上看，貌似作者又有停滞 codegen 的倾向，看起来左右摇摆的状态还会持续一段时间：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/96efce121a1f30e90a5e05a594a542b8.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/131af2292120c77e48a3f71a791ff8d4.png"/>
    </p>
    <p>
     <strong>
      那么， 2025 年 riverpod 还是你状态管理的首选吗
     </strong>
     ？
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f5a756f5975654c69616e672f:61727469636c652f64657461696c732f313436313432393833" class_="artid" style="display:none">
 </p>
</div>


