---
layout: post
title: "Python-智能机房签到系统高效管理课堂考勤"
date: 2025-03-06 13:22:03 +0800
description: "图形界面库开发的客户端软件，旨在帮助学生快速完成课堂签到，并实时反馈签到状态。通过该系统，学生可以快速完成签到，教师端也能高效获取签到数据，从而提高课堂管理的效率和智能化水平。等多项智能特性，旨在提供一个高效、便捷的签到体验，提高课堂考勤的智能化管理水平。为核心，提供了一个稳定、易用的课堂签到方案。"
keywords: "Python 智能机房签到系统：高效管理课堂考勤"
categories: ['Python']
tags: ['签到', '机房', '心跳包', '局域网', 'Tcp', 'Python']
artid: "146066004"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146066004
    alt: "Python-智能机房签到系统高效管理课堂考勤"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146066004
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146066004
cover: https://bing.ee123.net/img/rand?artid=146066004
image: https://bing.ee123.net/img/rand?artid=146066004
img: https://bing.ee123.net/img/rand?artid=146066004
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Python 智能机房签到系统：高效管理课堂考勤
    </h1>
   </div>
   <div class="article-resource-info-box">
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     <strong>
      智能机房签到系统：高效管理课堂考勤
     </strong>
    </h2>
    <blockquote>
     <p>
      相关资源文件已经打包成EXE文件，可双击直接运行程序，且文章末尾已附上相关源码，以供大家学习交流，博主主页还有更多Python相关程序案例，秉着开源精神的想法，望大家喜欢，点个关注不迷路！！！
     </p>
    </blockquote>
    <h3>
     <a id="_3">
     </a>
     <strong>
      一、概述
     </strong>
    </h3>
    <p>
     本机房签到系统（学生端）是一个基于
     <strong>
      Python
     </strong>
     和
     <strong>
      Tkinter
     </strong>
     图形界面库开发的客户端软件，旨在帮助学生快速完成课堂签到，并实时反馈签到状态。该软件通过网络通信与教师端服务器保持连接，确保签到数据的可靠性和实时性。
    </p>
    <p>
     本系统具备
     <strong>
      自动检测服务器IP
     </strong>
     、
     <strong>
      网络状态实时监测
     </strong>
     、
     <strong>
      心跳检测
     </strong>
     以及
     <strong>
      签到重试机制
     </strong>
     等多项智能特性，旨在提供一个高效、便捷的签到体验，提高课堂考勤的智能化管理水平。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/3eff41a54021499c9cc5cfaa974f367a.png"/>
    </p>
    <hr/>
    <h3>
     <a id="_11">
     </a>
     <strong>
      二、功能使用
     </strong>
    </h3>
    <h4>
     <a id="1__13">
     </a>
     <strong>
      1. 界面设计
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       窗口布局
      </strong>
      ：
      <ul>
       <li>
        采用
        <strong>
         Tkinter + ttk
        </strong>
        组件构建，界面简洁直观。
       </li>
       <li>
        窗口大小
        <strong>
         420x320
        </strong>
        ，不可调整大小，确保界面美观统一。
       </li>
       <li>
        <strong>
         居中显示
        </strong>
        ，提高用户体验。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       输入框
      </strong>
      ：
      <ul>
       <li>
        <strong>
         教师端IP输入
        </strong>
        ：自动填充本机推测的教师端IP，可手动修改。
       </li>
       <li>
        <strong>
         班级选择
        </strong>
        ：提供
        <strong>
         “七（1）班”~“七（6）班”
        </strong>
        可选项，采用
        <strong>
         下拉框
        </strong>
        。
       </li>
       <li>
        <strong>
         姓名输入
        </strong>
        ：限制
        <strong>
         2-10 位中文字符
        </strong>
        ，保证格式规范。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       状态指示灯
      </strong>
      ：
      <ul>
       <li>
        连接成功
        <strong>
         （绿灯）
        </strong>
        ，未连接
        <strong>
         （红灯）
        </strong>
        ，直观显示连接状态。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       任务栏信息
      </strong>
      ：
      <ul>
       <li>
        <strong>
         教师端连接状态
        </strong>
        显示，颜色区分状态（绿色=已连接，红色=未连接）。
       </li>
       <li>
        <strong>
         当前时间
        </strong>
        ，每秒更新一次，提升用户体验。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2__30">
     </a>
     <strong>
      2. 网络通信
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       服务器IP检测
      </strong>
      ：
      <ul>
       <li>
        <strong>
         自动检测本地IP
        </strong>
        ，推测教师端IP，减少学生输入错误可能性。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       网络状态监测
      </strong>
      ：
      <ul>
       <li>
        采用
        <strong>
         双重检测机制
        </strong>
        避免误判，每 1.5-3 秒进行一次检测。
       </li>
       <li>
        状态变更时，界面
        <strong>
         实时更新
        </strong>
        ，确保学生随时掌握教师端连接情况。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       心跳机制
      </strong>
      ：
      <ul>
       <li>
        每
        <strong>
         30 秒
        </strong>
        发送一次
        <strong>
         “heartbeat”
        </strong>
        ，保持与教师端的在线状态。
       </li>
       <li>
        如果断开连接，尝试快速重连。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3__42">
     </a>
     <strong>
      3. 签到功能
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       签到流程
      </strong>
      ：
      <ul>
       <li>
        点击
        <strong>
         “立即签到”
        </strong>
        按钮，软件会执行
        <strong>
         服务器连接检测
        </strong>
        ，确保教师端可用。
       </li>
       <li>
        检查
        <strong>
         IP 地址合法性
        </strong>
        、
        <strong>
         姓名输入格式
        </strong>
        ，确保数据有效性。
       </li>
       <li>
        采用
        <strong>
         多线程
        </strong>
        进行签到，防止界面卡顿。
       </li>
       <li>
        <strong>
         签到请求失败时，最多重试 5 次
        </strong>
        ，逐步增加延迟（指数退避）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       服务器响应
      </strong>
      ：
      <ul>
       <li>
        成功返回
        <strong>
         签到成功
        </strong>
        ，弹窗提示，并自动关闭窗口。
       </li>
       <li>
        失败时，显示
        <strong>
         错误信息
        </strong>
        ，提示用户检查网络或联系教师。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_53">
     </a>
     <strong>
      三、效果展示
     </strong>
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c4affda3c3484aaa9c00c970f72af723.png"/>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/74071e138eb64120a6bd38d14a4b11f8.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/db78a656d6b94d5fa6c62635e543afc5.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2434ca40d7244a9787ef52273adaed2d.png"/>
      </img>
     </img>
    </p>
    <hr/>
    <h3>
     <a id="_64">
     </a>
     <strong>
      四、总结
     </strong>
    </h3>
    <p>
     本机房签到系统（学生端）以
     <strong>
      简洁美观的界面
     </strong>
     、
     <strong>
      高效的网络管理
     </strong>
     和
     <strong>
      智能化签到机制
     </strong>
     为核心，提供了一个稳定、易用的课堂签到方案。其主要特点包括：
     <br/>
     ✅
     <strong>
      自动检测服务器IP，降低手动输入成本
     </strong>
     <br/>
     ✅
     <strong>
      实时网络监测，确保签到状态可视化
     </strong>
     <br/>
     ✅
     <strong>
      心跳机制保持在线，提高签到稳定性
     </strong>
     <br/>
     ✅
     <strong>
      高效的重试机制，减少签到失败影响
     </strong>
    </p>
    <p>
     通过该系统，学生可以快速完成签到，教师端也能高效获取签到数据，从而提高课堂管理的效率和智能化水平。
    </p>
    <hr/>
    <h3>
     <a id="_74">
     </a>
     <strong>
      五、源码展示：
     </strong>
    </h3>
    <blockquote>
     <p>
      教师服务端源码：
     </p>
    </blockquote>
    <pre><code class="prism language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> queue
<span class="token keyword">import</span> struct
<span class="token keyword">from</span> tkinter <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> tkinter <span class="token keyword">import</span> ttk<span class="token punctuation">,</span> messagebox<span class="token punctuation">,</span> filedialog
<span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> Workbook
 
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
    level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span><span class="token punctuation">,</span>
    filename<span class="token operator">=</span><span class="token string">'server.log'</span><span class="token punctuation">,</span>
    filemode<span class="token operator">=</span><span class="token string">'a'</span>
<span class="token punctuation">)</span>
 
<span class="token keyword">def</span> <span class="token function">is_port_in_use</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
        s<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> s<span class="token punctuation">.</span>connect_ex<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
 
<span class="token keyword">class</span> <span class="token class-name">ServerGUI</span><span class="token punctuation">:</span>
    PORT <span class="token operator">=</span> <span class="token number">8888</span>
    HEARTBEAT_TIMEOUT <span class="token operator">=</span> <span class="token number">60</span>
    HEARTBEAT_CHECK_INTERVAL <span class="token operator">=</span> <span class="token number">15</span>
 
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>window <span class="token operator">=</span> Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"机房签到-教师端"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string">"1024x768"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>protocol<span class="token punctuation">(</span><span class="token string">"WM_DELETE_WINDOW"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>on_close<span class="token punctuation">)</span>
 
        <span class="token comment"># 状态管理</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>clients <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment"># {(computer, ip): tree_item}</span>
        self<span class="token punctuation">.</span>last_activity <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>client_sockets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>server <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>socket_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        <span class="token comment"># 初始化组件</span>
        self<span class="token punctuation">.</span>_init_styles<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_create_menu_bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_create_auto_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_create_taskbar<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        <span class="token comment"># 网络初始化</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_init_network<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
 
        <span class="token comment"># 启动线程</span>
        self<span class="token punctuation">.</span>accept_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>accept_clients<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>heartbeat_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>heartbeat_checker<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>accept_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>heartbeat_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        <span class="token comment"># GUI定时任务</span>
        self<span class="token punctuation">.</span>update_time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>process_update_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>center_window<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_init_styles</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>style <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Style<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>style<span class="token punctuation">.</span>theme_use<span class="token punctuation">(</span><span class="token string">'clam'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>style<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">"Treeview"</span><span class="token punctuation">,</span>
                            background<span class="token operator">=</span><span class="token string">"#F5F5F5"</span><span class="token punctuation">,</span>
                            fieldbackground<span class="token operator">=</span><span class="token string">"#F5F5F5"</span><span class="token punctuation">,</span>
                            rowheight<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span>
                            font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'微软雅黑'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token string">"Treeview"</span><span class="token punctuation">,</span> background<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">,</span> <span class="token string">'#4A90E2'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_create_menu_bar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        menubar <span class="token operator">=</span> Menu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">)</span>
        file_menu <span class="token operator">=</span> Menu<span class="token punctuation">(</span>menubar<span class="token punctuation">,</span> tearoff<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        file_menu<span class="token punctuation">.</span>add_command<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"导出Excel"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>save_to_excel<span class="token punctuation">)</span>
        file_menu<span class="token punctuation">.</span>add_separator<span class="token punctuation">(</span><span class="token punctuation">)</span>
        file_menu<span class="token punctuation">.</span>add_command<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"退出"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>on_close<span class="token punctuation">)</span>
        help_menu <span class="token operator">=</span> Menu<span class="token punctuation">(</span>menubar<span class="token punctuation">,</span> tearoff<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        help_menu<span class="token punctuation">.</span>add_command<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"关于"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>_show_about<span class="token punctuation">)</span>
        menubar<span class="token punctuation">.</span>add_cascade<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"文件"</span><span class="token punctuation">,</span> menu<span class="token operator">=</span>file_menu<span class="token punctuation">)</span>
        menubar<span class="token punctuation">.</span>add_cascade<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">"帮助"</span><span class="token punctuation">,</span> menu<span class="token operator">=</span>help_menu<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>config<span class="token punctuation">(</span>menu<span class="token operator">=</span>menubar<span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_create_auto_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        container <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">)</span>
        container<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>BOTH<span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
 
        columns <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"computer"</span><span class="token punctuation">,</span> <span class="token string">"ip"</span><span class="token punctuation">,</span> <span class="token string">"checkin_class"</span><span class="token punctuation">,</span> <span class="token string">"checkin_student"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tree <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Treeview<span class="token punctuation">(</span>
            container<span class="token punctuation">,</span>
            columns<span class="token operator">=</span>columns<span class="token punctuation">,</span>
            show<span class="token operator">=</span><span class="token string">"headings"</span><span class="token punctuation">,</span>
            selectmode<span class="token operator">=</span><span class="token string">"browse"</span>
        <span class="token punctuation">)</span>
 
        headers <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">"computer"</span><span class="token punctuation">,</span> <span class="token string">"计算机名"</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span> <span class="token string">"IP地址"</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"checkin_class"</span><span class="token punctuation">,</span> <span class="token string">"签到班级"</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token string">"checkin_student"</span><span class="token punctuation">,</span> <span class="token string">"签到学生"</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
 
        <span class="token keyword">for</span> col_id<span class="token punctuation">,</span> col_text<span class="token punctuation">,</span> min_width <span class="token keyword">in</span> headers<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>heading<span class="token punctuation">(</span>col_id<span class="token punctuation">,</span> text<span class="token operator">=</span>col_text<span class="token punctuation">,</span> anchor<span class="token operator">=</span>CENTER<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>column<span class="token punctuation">(</span>col_id<span class="token punctuation">,</span> width<span class="token operator">=</span>min_width<span class="token punctuation">,</span> anchor<span class="token operator">=</span>CENTER<span class="token punctuation">)</span>
 
        vsb <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Scrollbar<span class="token punctuation">(</span>container<span class="token punctuation">,</span> orient<span class="token operator">=</span><span class="token string">"vertical"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>yview<span class="token punctuation">)</span>
        hsb <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Scrollbar<span class="token punctuation">(</span>container<span class="token punctuation">,</span> orient<span class="token operator">=</span><span class="token string">"horizontal"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>xview<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>yscrollcommand<span class="token operator">=</span>vsb<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">,</span> xscrollcommand<span class="token operator">=</span>hsb<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">)</span>
 
        self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">"nsew"</span><span class="token punctuation">)</span>
        vsb<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">"ns"</span><span class="token punctuation">)</span>
        hsb<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">"ew"</span><span class="token punctuation">)</span>
 
        container<span class="token punctuation">.</span>grid_rowconfigure<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        container<span class="token punctuation">.</span>grid_columnconfigure<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> weight<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_create_taskbar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        taskbar <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">)</span>
        taskbar<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>X<span class="token punctuation">,</span> side<span class="token operator">=</span>BOTTOM<span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
 
        self<span class="token punctuation">.</span>checkin_count <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>taskbar<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"已签到: 0"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>checkin_count<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
 
        self<span class="token punctuation">.</span>time_label <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>taskbar<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>time_label<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>RIGHT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_init_network</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> is_port_in_use<span class="token punctuation">(</span>self<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span><span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"端口 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>PORT<span class="token punctuation">}</span></span><span class="token string"> 已被占用"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
 
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>server <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
            logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"服务器启动成功"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"服务启动失败: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
 
    <span class="token keyword">def</span> <span class="token function">accept_clients</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                client<span class="token punctuation">,</span> addr <span class="token operator">=</span> self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
                client<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_LINGER<span class="token punctuation">,</span>
                                struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'ii'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">with</span> self<span class="token punctuation">.</span>socket_lock<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>client_sockets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
                threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>
                    target<span class="token operator">=</span>self<span class="token punctuation">.</span>handle_client<span class="token punctuation">,</span>
                    args<span class="token operator">=</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    daemon<span class="token operator">=</span><span class="token boolean">True</span>
                <span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
                logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"新连接: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>addr<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"接受连接异常: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
 
    <span class="token keyword">def</span> <span class="token function">handle_client</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token string">b''</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>
                        <span class="token keyword">break</span>
                    <span class="token builtin">buffer</span> <span class="token operator">+=</span> data
 
                    <span class="token comment"># 处理PING请求</span>
                    <span class="token keyword">if</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'PING'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        client<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'PONG\n'</span><span class="token punctuation">)</span>
                        <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
                        <span class="token keyword">continue</span>
 
                    <span class="token keyword">while</span> <span class="token string">b'\n'</span> <span class="token keyword">in</span> <span class="token builtin">buffer</span><span class="token punctuation">:</span>
                        line<span class="token punctuation">,</span> <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                        <span class="token keyword">try</span><span class="token punctuation">:</span>
                            info <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            self<span class="token punctuation">.</span>validate_client_info<span class="token punctuation">(</span>info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
 
                            <span class="token keyword">if</span> info<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'checkin'</span><span class="token punctuation">:</span>
                                self<span class="token punctuation">.</span>process_checkin<span class="token punctuation">(</span>info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
                            <span class="token keyword">elif</span> info<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'init'</span><span class="token punctuation">:</span>
                                self<span class="token punctuation">.</span>process_init<span class="token punctuation">(</span>info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
                            <span class="token keyword">elif</span> info<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'heartbeat'</span><span class="token punctuation">:</span>
                                self<span class="token punctuation">.</span>process_heartbeat<span class="token punctuation">(</span>info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
 
                            response <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span>
                            client<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
 
                        <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                            truncated <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">b'...'</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">50</span> <span class="token keyword">else</span> line
                            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"无效JSON数据: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>truncated<span class="token punctuation">}</span></span><span class="token string"> 错误: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据处理失败: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
 
                <span class="token keyword">except</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>timeout<span class="token punctuation">,</span> ConnectionResetError<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"客户端处理异常: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> self<span class="token punctuation">.</span>socket_lock<span class="token punctuation">:</span>
                <span class="token keyword">if</span> client <span class="token keyword">in</span> self<span class="token punctuation">.</span>client_sockets<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>client_sockets<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
            client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">validate_client_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        required_fields <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'init'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'computer_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'checkin'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'computer_name'</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'heartbeat'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'computer_name'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        msg_type <span class="token operator">=</span> info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> msg_type <span class="token keyword">not</span> <span class="token keyword">in</span> required_fields<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"未知消息类型: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>msg_type<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> field <span class="token keyword">in</span> required_fields<span class="token punctuation">[</span>msg_type<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> field <span class="token keyword">not</span> <span class="token keyword">in</span> info<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"缺失字段 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>field<span class="token punctuation">}</span></span><span class="token string">，来自 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>addr<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">process_init</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        key <span class="token operator">=</span> <span class="token punctuation">(</span>info<span class="token punctuation">[</span><span class="token string">'computer_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_add_tree_item<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_update_activity<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_add_tree_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"end"</span><span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>clients<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> item
 
    <span class="token keyword">def</span> <span class="token function">process_checkin</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        key <span class="token operator">=</span> <span class="token punctuation">(</span>info<span class="token punctuation">[</span><span class="token string">'computer_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>process_init<span class="token punctuation">(</span>info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span>
        values <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> info<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> info<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_update_tree_item<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_update_activity<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_update_tree_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>item<span class="token punctuation">(</span>self<span class="token punctuation">.</span>clients<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token operator">=</span>values<span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_update_activity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>last_activity<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_checkin_count<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">process_heartbeat</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> info<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        key <span class="token operator">=</span> <span class="token punctuation">(</span>info<span class="token punctuation">[</span><span class="token string">'computer_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>last_activity<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>last_activity<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">heartbeat_checker</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            current_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            expired <span class="token operator">=</span> <span class="token punctuation">[</span>k <span class="token keyword">for</span> k<span class="token punctuation">,</span> t <span class="token keyword">in</span> self<span class="token punctuation">.</span>last_activity<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token keyword">if</span> current_time <span class="token operator">-</span> t <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>HEARTBEAT_TIMEOUT<span class="token punctuation">]</span>
            <span class="token keyword">if</span> expired<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>remove_clients<span class="token punctuation">,</span> <span class="token punctuation">(</span>expired<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>HEARTBEAT_CHECK_INTERVAL<span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">remove_clients</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> keys<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> key <span class="token keyword">in</span> keys<span class="token punctuation">:</span>
            <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>self<span class="token punctuation">.</span>clients<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">del</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
            <span class="token keyword">if</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>last_activity<span class="token punctuation">:</span>
                <span class="token keyword">del</span> self<span class="token punctuation">.</span>last_activity<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>update_checkin_count<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">update_checkin_count</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token punctuation">[</span>k <span class="token keyword">for</span> k <span class="token keyword">in</span> self<span class="token punctuation">.</span>clients
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>item<span class="token punctuation">(</span>self<span class="token punctuation">.</span>clients<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'values'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>checkin_count<span class="token punctuation">.</span>config<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"已签到: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>count<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">update_time</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>time_label<span class="token punctuation">.</span>config<span class="token punctuation">(</span>text<span class="token operator">=</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>update_time<span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">save_to_excel</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showwarning<span class="token punctuation">(</span><span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"当前没有可导出的签到数据"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
 
        path <span class="token operator">=</span> filedialog<span class="token punctuation">.</span>asksaveasfilename<span class="token punctuation">(</span>
            defaultextension<span class="token operator">=</span><span class="token string">".xlsx"</span><span class="token punctuation">,</span>
            filetypes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"Excel文件"</span><span class="token punctuation">,</span> <span class="token string">"*.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> path<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
 
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            wb <span class="token operator">=</span> Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
            ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
            ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"计算机名"</span><span class="token punctuation">,</span> <span class="token string">"IP地址"</span><span class="token punctuation">,</span> <span class="token string">"班级"</span><span class="token punctuation">,</span> <span class="token string">"姓名"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> key <span class="token keyword">in</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">:</span>
                values <span class="token operator">=</span> self<span class="token punctuation">.</span>tree<span class="token punctuation">.</span>item<span class="token punctuation">(</span>self<span class="token punctuation">.</span>clients<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'values'</span><span class="token punctuation">]</span>
                ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
            messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">,</span> <span class="token string">"数据已保存"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"保存失败: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">on_close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"正在关闭服务器..."</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">False</span>
 
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>accept_thread<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>accept_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>heartbeat_thread<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>heartbeat_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
 
        self<span class="token punctuation">.</span>close_network_connections<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">close_network_connections</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> self<span class="token punctuation">.</span>socket_lock<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"关闭客户端连接..."</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> client <span class="token keyword">in</span> self<span class="token punctuation">.</span>client_sockets<span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    client<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_LINGER<span class="token punctuation">,</span>
                                    struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'ii'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    client<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SHUT_RDWR<span class="token punctuation">)</span>
                    client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"关闭连接出错: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>client_sockets<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>server<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"关闭服务器出错: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">center_window</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>update_idletasks<span class="token punctuation">(</span><span class="token punctuation">)</span>
        w <span class="token operator">=</span> self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_width<span class="token punctuation">(</span><span class="token punctuation">)</span>
        h <span class="token operator">=</span> self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_height<span class="token punctuation">(</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_screenwidth<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> w<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        y <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_screenheight<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> h<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>w<span class="token punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>h<span class="token punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">_show_about</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span><span class="token string">"关于"</span><span class="token punctuation">,</span> <span class="token string">"机房签到系统教师端\n版本: 3.2"</span><span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">process_update_queue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            func<span class="token punctuation">,</span> args <span class="token operator">=</span> self<span class="token punctuation">.</span>update_queue<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
                    func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"队列处理异常: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>process_update_queue<span class="token punctuation">)</span>
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    ServerGUI<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <blockquote>
     <p>
      学生端代码：
     </p>
    </blockquote>
    <pre><code class="prism language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> json
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> time
<span class="token keyword">import</span> re
<span class="token keyword">from</span> tkinter <span class="token keyword">import</span> ttk<span class="token punctuation">,</span> messagebox<span class="token punctuation">,</span> Tk<span class="token punctuation">,</span> Canvas<span class="token punctuation">,</span> StringVar<span class="token punctuation">,</span> LEFT<span class="token punctuation">,</span> X<span class="token punctuation">,</span> BOTTOM<span class="token punctuation">,</span> RIGHT<span class="token punctuation">,</span> DISABLED<span class="token punctuation">,</span> NORMAL<span class="token punctuation">,</span> TclError

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
    level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">,</span>
    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span><span class="token punctuation">,</span>
    filename<span class="token operator">=</span><span class="token string">'client.log'</span><span class="token punctuation">,</span>
    filemode<span class="token operator">=</span><span class="token string">'a'</span>
<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">EnhancedClientGUI</span><span class="token punctuation">:</span>
    PORT <span class="token operator">=</span> <span class="token number">8888</span>
    HEARTBEAT_INTERVAL <span class="token operator">=</span> <span class="token number">30</span>
    CONNECT_TIMEOUT <span class="token operator">=</span> <span class="token number">5</span>
    MAX_RETRIES <span class="token operator">=</span> <span class="token number">5</span>
    RETRY_DELAY_BASE <span class="token operator">=</span> <span class="token number">2</span>
    STATUS_CHECK_INTERVAL <span class="token operator">=</span> <span class="token number">3</span>
    FAST_CHECK_INTERVAL <span class="token operator">=</span> <span class="token number">1.5</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>window <span class="token operator">=</span> Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"机房签到-学生端"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string">"420x320"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>resizable<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>protocol<span class="token punctuation">(</span><span class="token string">"WM_DELETE_WINDOW"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>disable_close<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>computer_name <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostname<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>stop_event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>checkin_thread <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_current_socket <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token comment"># 初始化界面组件</span>
        self<span class="token punctuation">.</span>create_ui<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>create_taskbar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>center_window<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 设置初始状态为未连接</span>
        self<span class="token punctuation">.</span>update_status_ui<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

        <span class="token comment"># 启动后台服务</span>
        self<span class="token punctuation">.</span>start_network_monitor<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>start_heartbeat<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_ui</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建主界面组件"""</span>
        main_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
        main_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>X<span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token comment"># IP地址输入部分</span>
        ip_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>main_frame<span class="token punctuation">)</span>
        ip_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>X<span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>ip_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"教师端IP"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ip_entry <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Entry<span class="token punctuation">(</span>ip_frame<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ip_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>detect_server_ip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ip_entry<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">,</span> fill<span class="token operator">=</span>X<span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

        <span class="token comment"># 状态指示灯（初始红色）</span>
        self<span class="token punctuation">.</span>status_light <span class="token operator">=</span> Canvas<span class="token punctuation">(</span>ip_frame<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">'white'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>light_id <span class="token operator">=</span> self<span class="token punctuation">.</span>status_light<span class="token punctuation">.</span>create_oval<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>status_light<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>RIGHT<span class="token punctuation">)</span>

        <span class="token comment"># 班级选择</span>
        class_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>main_frame<span class="token punctuation">)</span>
        class_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>X<span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>class_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"选择班级"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>class_var <span class="token operator">=</span> StringVar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>class_combobox <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Combobox<span class="token punctuation">(</span>
            class_frame<span class="token punctuation">,</span>
            textvariable<span class="token operator">=</span>self<span class="token punctuation">.</span>class_var<span class="token punctuation">,</span>
            values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'七（1）班'</span><span class="token punctuation">,</span> <span class="token string">'七（2）班'</span><span class="token punctuation">,</span> <span class="token string">'七（3）班'</span><span class="token punctuation">,</span> <span class="token string">'七（4）班'</span><span class="token punctuation">,</span> <span class="token string">'七（5）班'</span><span class="token punctuation">,</span> <span class="token string">'七（6）班'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            state<span class="token operator">=</span><span class="token string">"readonly"</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>class_combobox<span class="token punctuation">.</span>current<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>class_combobox<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">,</span> fill<span class="token operator">=</span>X<span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

        <span class="token comment"># 姓名输入</span>
        name_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>main_frame<span class="token punctuation">)</span>
        name_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>fill<span class="token operator">=</span>X<span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>name_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"学生姓名"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name_entry <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Entry<span class="token punctuation">(</span>name_frame<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>name_entry<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">,</span> fill<span class="token operator">=</span>X<span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

        <span class="token comment"># 签到按钮</span>
        self<span class="token punctuation">.</span>btn_submit <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>
            main_frame<span class="token punctuation">,</span>
            text<span class="token operator">=</span><span class="token string">"立即签到"</span><span class="token punctuation">,</span>
            command<span class="token operator">=</span>self<span class="token punctuation">.</span>start_checkin<span class="token punctuation">,</span>
            width<span class="token operator">=</span><span class="token number">15</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_submit<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>pady<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_taskbar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""创建底部状态栏"""</span>
        taskbar <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        taskbar<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>BOTTOM<span class="token punctuation">,</span> fill<span class="token operator">=</span>X<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>conn_status <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>
            taskbar<span class="token punctuation">,</span>
            text<span class="token operator">=</span><span class="token string">"教师端状态未连接"</span><span class="token punctuation">,</span>
            font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Microsoft YaHei'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            foreground<span class="token operator">=</span><span class="token string">"#F44336"</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conn_status<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>time_label <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>
            taskbar<span class="token punctuation">,</span>
            font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Microsoft YaHei'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            foreground<span class="token operator">=</span><span class="token string">"#666"</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>time_label<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>RIGHT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">detect_server_ip</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""自动检测服务器IP"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
                s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"8.8.8.8"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                local_ip <span class="token operator">=</span> s<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                base_ip <span class="token operator">=</span> local_ip<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>base_ip<span class="token punctuation">}</span></span><span class="token string">.100"</span></span> <span class="token keyword">if</span> base_ip<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token string">"192.168.6.100"</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"192.168.6.100"</span>

    <span class="token keyword">def</span> <span class="token function">start_network_monitor</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""可靠的网络监测线程"""</span>
        <span class="token keyword">def</span> <span class="token function">monitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            last_status <span class="token operator">=</span> <span class="token boolean">False</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>  <span class="token comment"># 等待界面初始化完成</span>

            <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token comment"># 双重检测机制</span>
                    status1 <span class="token operator">=</span> self<span class="token punctuation">.</span>check_server_reachable<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
                    status2 <span class="token operator">=</span> self<span class="token punctuation">.</span>check_server_reachable<span class="token punctuation">(</span><span class="token punctuation">)</span>

                    current_status <span class="token operator">=</span> status1 <span class="token keyword">and</span> status2
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"检测异常 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    current_status <span class="token operator">=</span> <span class="token boolean">False</span>

                <span class="token keyword">if</span> current_status <span class="token operator">!=</span> last_status<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>safe_gui_update<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>update_status_ui<span class="token punctuation">(</span>current_status<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    last_status <span class="token operator">=</span> current_status

                interval <span class="token operator">=</span> self<span class="token punctuation">.</span>FAST_CHECK_INTERVAL <span class="token keyword">if</span> <span class="token keyword">not</span> current_status <span class="token keyword">else</span> self<span class="token punctuation">.</span>STATUS_CHECK_INTERVAL
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>interval<span class="token punctuation">)</span>

        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>monitor<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">check_server_reachable</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""精确检测服务器可达性"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> s<span class="token punctuation">:</span>
                s<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span>
                s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>

                <span class="token comment"># 服务级验证</span>
                s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span><span class="token string">b'PING\n'</span><span class="token punctuation">)</span>
                response <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> response <span class="token operator">==</span> <span class="token string">'PONG'</span>
        <span class="token keyword">except</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>timeout<span class="token punctuation">,</span> ConnectionRefusedError<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"连接异常 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">update_status_ui</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> connected<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""更新状态指示"""</span>
        target_color <span class="token operator">=</span> <span class="token string">"green"</span> <span class="token keyword">if</span> connected <span class="token keyword">else</span> <span class="token string">"red"</span>
        status_text <span class="token operator">=</span> <span class="token string">"已连接"</span> <span class="token keyword">if</span> connected <span class="token keyword">else</span> <span class="token string">"未连接"</span>
        status_color <span class="token operator">=</span> <span class="token string">"#4CAF50"</span> <span class="token keyword">if</span> connected <span class="token keyword">else</span> <span class="token string">"#F44336"</span>

        <span class="token comment"># 更新指示灯</span>
        self<span class="token punctuation">.</span>status_light<span class="token punctuation">.</span>itemconfig<span class="token punctuation">(</span>self<span class="token punctuation">.</span>light_id<span class="token punctuation">,</span> fill<span class="token operator">=</span>target_color<span class="token punctuation">)</span>

        <span class="token comment"># 更新任务栏状态</span>
        self<span class="token punctuation">.</span>conn_status<span class="token punctuation">.</span>config<span class="token punctuation">(</span>
            text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"教师端状态 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>status_text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            foreground<span class="token operator">=</span>status_color
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start_heartbeat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""心跳线程"""</span>
        <span class="token keyword">def</span> <span class="token function">heartbeat_loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>stop_event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>check_server_reachable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>send_heartbeat<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>HEARTBEAT_INTERVAL<span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"心跳异常 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>FAST_CHECK_INTERVAL<span class="token punctuation">)</span>

        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>heartbeat_loop<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">send_heartbeat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""发送心跳包"""</span>
        data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"heartbeat"</span><span class="token punctuation">,</span>
            <span class="token string">"computer_name"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>computer_name
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>send_request<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start_checkin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""开始签到流程"""</span>
        current_status <span class="token operator">=</span> self<span class="token punctuation">.</span>check_server_reachable<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_status_ui<span class="token punctuation">(</span>current_status<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> current_status<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>show_error<span class="token punctuation">(</span><span class="token string">"教师端不可达，请检查IP地址"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>validate_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>checkin_thread <span class="token keyword">and</span> self<span class="token punctuation">.</span>checkin_thread<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showwarning<span class="token punctuation">(</span><span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"已有签到请求在处理中"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>

        self<span class="token punctuation">.</span>btn_submit<span class="token punctuation">.</span>config<span class="token punctuation">(</span>state<span class="token operator">=</span>DISABLED<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"提交中..."</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>checkin_thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>process_checkin<span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>checkin_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_checkin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理签到逻辑"""</span>
        checkin_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"checkin"</span><span class="token punctuation">,</span>
            <span class="token string">"computer_name"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>computer_name<span class="token punctuation">,</span>
            <span class="token string">"class"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>class_var<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"name"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>name_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        success <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">for</span> attempt <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>MAX_RETRIES <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>send_request<span class="token punctuation">(</span>checkin_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    success <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token keyword">break</span>
                logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"第</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>attempt<span class="token punctuation">}</span></span><span class="token string">次尝试失败"</span></span><span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>self<span class="token punctuation">.</span>RETRY_DELAY_BASE <span class="token operator">*</span> attempt<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"请求异常 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>safe_gui_update<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>handle_checkin_result<span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">send_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""发送网络请求"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_current_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>create_connection<span class="token punctuation">(</span>
                <span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                timeout<span class="token operator">=</span>self<span class="token punctuation">.</span>CONNECT_TIMEOUT
            <span class="token punctuation">)</span>
            <span class="token keyword">with</span> self<span class="token punctuation">.</span>_current_socket <span class="token keyword">as</span> sock<span class="token punctuation">:</span>
                sock<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\n'</span><span class="token punctuation">)</span>
                response <span class="token operator">=</span> self<span class="token punctuation">.</span>receive_response<span class="token punctuation">(</span>sock<span class="token punctuation">)</span>
                <span class="token keyword">return</span> response <span class="token keyword">and</span> response<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"success"</span>
        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"连接超时"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">except</span> ConnectionRefusedError<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"连接被拒绝"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"网络错误 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_current_socket <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">receive_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sock<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""接收服务器响应"""</span>
        <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token string">b''</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            sock<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                part <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> part<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token builtin">buffer</span> <span class="token operator">+=</span> part
                <span class="token keyword">if</span> <span class="token string">b'\n'</span> <span class="token keyword">in</span> <span class="token builtin">buffer</span><span class="token punctuation">:</span>
                    response_line<span class="token punctuation">,</span> <span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token keyword">try</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response_line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">:</span>
                        logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"无效的JSON响应"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">None</span>
        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"响应接收超时"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">validate_input</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""验证输入有效性"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            socket<span class="token punctuation">.</span>inet_aton<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ip_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>show_error<span class="token punctuation">(</span><span class="token string">"无效的IP地址格式"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

        name <span class="token operator">=</span> self<span class="token punctuation">.</span>name_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^[\u4e00-\u9fa5]{2,10}$'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>show_error<span class="token punctuation">(</span><span class="token string">"请输入2-10位中文姓名"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">handle_checkin_result</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> success<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""处理签到结果"""</span>
        self<span class="token punctuation">.</span>btn_submit<span class="token punctuation">.</span>config<span class="token punctuation">(</span>state<span class="token operator">=</span>NORMAL<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"立即签到"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> success<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">,</span> <span class="token string">"签到成功!"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>safe_destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">,</span> <span class="token string">"签到失败，请检查网络连接后重试"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update_time</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""更新时间显示"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            current_time <span class="token operator">=</span> time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>time_label<span class="token punctuation">.</span>config<span class="token punctuation">(</span>text<span class="token operator">=</span>current_time<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>update_time<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">safe_gui_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""线程安全的GUI更新"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>running <span class="token keyword">and</span> self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>after<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> func<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show_error</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""显示错误提示"""</span>
        self<span class="token punctuation">.</span>safe_gui_update<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">disable_close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""阻止直接关闭窗口"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>running<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showinfo<span class="token punctuation">(</span><span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"请先完成签到操作"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">safe_destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""安全关闭程序"""</span>
        self<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>stop_event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_current_socket<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_current_socket<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"关闭连接异常 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>checkin_thread <span class="token keyword">and</span> self<span class="token punctuation">.</span>checkin_thread<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>checkin_thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> TclError<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">center_window</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""窗口居中显示"""</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>update_idletasks<span class="token punctuation">(</span><span class="token punctuation">)</span>
        width <span class="token operator">=</span> self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_width<span class="token punctuation">(</span><span class="token punctuation">)</span>
        height <span class="token operator">=</span> self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_height<span class="token punctuation">(</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_screenwidth<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> width<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        y <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>winfo_screenheight<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> height<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        self<span class="token punctuation">.</span>window<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>width<span class="token punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>height<span class="token punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>y<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    EnhancedClientGUI<span class="token punctuation">(</span><span class="token punctuation">)</span>


</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f436c61795f4b2f:61727469636c652f64657461696c732f313436303636303034" class_="artid" style="display:none">
 </p>
</div>


