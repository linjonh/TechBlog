---
arturl_encode: "68747470733a:2f2f626c6f672e6373646e2e6e65742f66657965686f6e672f:61727469636c652f64657461696c732f313139383132333734"
layout: post
title: "æ–‡ä»¶ä¸‹è½½-æ™®é€šæ–‡ä»¶ä¸‹è½½-å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½"
date: 2021-08-19 22:19:08 +08:00
description: "â¹æ–‡ä»¶ä¸‹è½½ æ™®é€šæ–‡ä»¶ä¸‹è½½ + å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½_å‰ç«¯æ¥æ”¶æ–‡ä»¶æµ"
keywords: "å‰ç«¯æ¥æ”¶æ–‡ä»¶æµ"
categories: ['å‰ç«¯', 'Java']
tags: ['æ–‡ä»¶ä¸‹è½½', 'Ajax']
artid: "119812374"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=119812374
    alt: "æ–‡ä»¶ä¸‹è½½-æ™®é€šæ–‡ä»¶ä¸‹è½½-å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=119812374
featuredImagePreview: https://bing.ee123.net/img/rand?artid=119812374
---

# æ–‡ä»¶ä¸‹è½½ æ™®é€šæ–‡ä»¶ä¸‹è½½ + å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½

**å‚è€ƒèµ„æ–™**

1. [å‰ç«¯æ¥å—åç«¯æ–‡ä»¶æµå¹¶ä¸‹è½½çš„å‡ ç§æ–¹æ³•](https://blog.csdn.net/cpongo5/article/details/88577883)
2. [ajax è¯·æ±‚äºŒè¿›åˆ¶æµ å›¾ç‰‡ æ–‡ä»¶ XMLHttpRequest è¯·æ±‚å¹¶å¤„ç†äºŒè¿›åˆ¶æµæ•°æ® ä¹‹æœ€ä½³å®è·µ](https://www.cnblogs.com/cdemo/p/5225848.html)
3. [ajaxè¯·æ±‚äºŒè¿›åˆ¶æµè¿›è¡Œå¤„ç†ï¼ˆajaxå¼‚æ­¥ä¸‹è½½æ–‡ä»¶ï¼‰](https://blog.csdn.net/weixin_33860722/article/details/91920467)
4. [response.setHeader()çš„ç”¨æ³•](https://blog.csdn.net/ccmm_/article/details/80885094)
5. [response.setContentType()çš„ä½œç”¨åŠå‚æ•°](https://blog.csdn.net/qq_42108192/article/details/81938674)

---

#### ç›®å½•

* [ä¸€. æ™®é€šæ–‡ä»¶ä¸‹è½½](#__19)
* + [1.1 åŸç”Ÿservletçš„HttpServletResponseæ–¹å¼ä¸‹è½½](#11_servletHttpServletResponse_23)
  + [1.2 Springçš„ResponseEntityæ–¹å¼ä¸‹è½½](#12_SpringResponseEntity_75)
* [äºŒ. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹XMLHttpRequest](#_ajaxXMLHttpRequest_153)
* [ä¸‰. æ–‡ä»¶æµä¸‹è½½-jQueryçš„Ajax](#_jQueryAjax_245)
* [å››. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹fetch](#_ajaxfetch_405)

---

è¦ç‚¹

1. `response.setContentType("application/octet-stream");`
   æŒ‡æ˜è¦è¿”å›çš„å†…å®¹ä¸ºäºŒè¿›åˆ¶çš„æµ
2. `response.setHeader("Content-Disposition", "attachment;filename=" + URLEncoder.encode(æ–‡ä»¶å.åç¼€, "UTF-8"));`
   æŒ‡æ˜ä¸‹è½½çš„æ–‡ä»¶åç§°
     
   **Content-Disposition**
   æ˜¯Content-Typeçš„æ‰©å±•ï¼Œå‘Šè¯‰æµè§ˆå™¨å¼¹çª—ä¸‹è½½æ¡†ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨é‡Œå±•ç¤ºæ–‡ä»¶ã€‚å› ä¸ºä¸€èˆ¬æµè§ˆå™¨å¯¹äºå®ƒèƒ½å¤Ÿå¤„ç†çš„æ–‡ä»¶ç±»å‹ï¼Œå¦‚txtï¼Œpdf ç­‰ï¼Œå®ƒéƒ½æ˜¯ç›´æ¥æ‰“å¼€å±•ç¤ºï¼Œè€Œä¸æ˜¯å¼¹çª—ä¸‹è½½æ¡†ã€‚

---

## ä¸€. æ™®é€šæ–‡ä»¶ä¸‹è½½

* æ™®é€šæ–‡ä»¶ä¸‹è½½åªèƒ½ç›´æ¥è§¦å‘urlè¿›è¡Œä¸‹è½½ï¼Œä¸èƒ½ä½¿ç”¨Ajax

### 1.1 åŸç”Ÿservletçš„HttpServletResponseæ–¹å¼ä¸‹è½½

â¹
**å‰ç«¯**

```html
<a href="/test15/fileDownLoad">ä¸‹è½½æ–‡ä»¶</a>

```

â¹
**åç«¯**

```java
import org.springframework.http.MediaType;
import org.springframework.stereotype.Controller;
import org.springframework.util.FileCopyUtils;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletResponse;
import java.io.*;
import java.net.URLEncoder;

@Controller
@RequestMapping("/test15")
public class Test15Controller {

    @Resource
    private HttpServletResponse response;

    @GetMapping("/fileDownLoad")
    public void fileDownload() throws IOException {

        // ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸­çš„æ–‡ä»¶
        File file = new File("C:\\Users\\ç”¨æˆ·å\\Desktop\\hexoå®‰è£….txt");

        /*
        	â¹1. response.setContentTypeçš„ä½œç”¨æ˜¯ä½¿å®¢æˆ·ç«¯æµè§ˆå™¨ï¼ŒåŒºåˆ†ä¸åŒç§ç±»çš„æ•°æ®
        	å¹¶æ ¹æ®ä¸åŒçš„MIMEè°ƒç”¨æµè§ˆå™¨å†…ä¸åŒçš„ç¨‹åºåµŒå…¥æ¨¡å—æ¥å¤„ç†ç›¸åº”çš„æ•°æ®ã€‚
			â¹2. application/octet-streamè¡¨ç¤ºè¿”å›äºŒè¿›åˆ¶æµï¼Œè¡¨ç¤ºä¸çŸ¥é“ä¸‹è½½æ–‡ä»¶ç±»å‹ï¼Œå…·æœ‰é€šç”¨æ€§
		*/ 
        response.setContentType(MediaType.APPLICATION_OCTET_STREAM_VALUE);
        /*
        	Content-Disposition çš„ä½œç”¨:
        		æ–‡ä»¶ä¸‹è½½æ—¶ä¼šå‘Šè¯‰æµè§ˆå™¨è¦ä¸‹è½½çš„æ–‡ä»¶åç§°å’Œç±»å‹
        	URLEncoder.encode çš„ä½œç”¨æ˜¯ä¸ºäº†é˜²æ­¢ä¸­æ–‡æ–‡ä»¶åä¹±ç 
		*/
        response.setHeader("Content-Disposition", "attachment;filename=" + URLEncoder.encode(file.getName(), "UTF-8"));
		
		// ä½¿ç”¨å·¥å…·ç±»ç›´æ¥å°†æ–‡ä»¶çš„å­—èŠ‚å¤åˆ¶åˆ°å“åº”è¾“å‡ºæµä¸­
        FileCopyUtils.copy(new FileInputStream(file), response.getOutputStream());
    }
}

```

### 1.2 Springçš„ResponseEntityæ–¹å¼ä¸‹è½½

â¹
**å‰ç«¯**

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div>
    <a id="downloadFile" th:href="@{/test19/testResponseEntity1}">æ–‡ä»¶ä¸‹è½½-æ™®é€šçš„æ–¹å¼</a>
</div>
</body>
</html>

```

â¹
**åç«¯**

* é€šè¿‡æ„é€ springframeworkçš„ResponseEntityç±»çš„æ–¹å¼è¿”å›æ•°æ®
* å¯ä»¥æŒ‡å®šå­—èŠ‚ç çš„è¿”å›å€¼ï¼Œå“åº”å€¼ï¼ŒçŠ¶æ€ç 

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/80e3c9b476f31bced548c92e3006d095.png)

```java
import org.springframework.core.io.ClassPathResource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;

import java.io.*;
import java.net.URLEncoder;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

@Controller
@RequestMapping("/test19")
public class Test19Controller {

    @GetMapping("/testResponseEntity1")
    public ResponseEntity<byte[]> testResponseEntity1() throws Exception {

        // ğŸ§ğŸ§ğŸ§è¯»å–æœ¬åœ°çš„æ–‡ä»¶
        String filePath = "/temp/A110120119/æµ‹è¯•æ–‡ä»¶.text";
        ClassPathResource readFile = new ClassPathResource(filePath);

        // ğŸ³ğŸ³ğŸ³è®¾ç½®å“åº”å¤´,æŠŠæ–‡ä»¶åç§°æ”¾å…¥å“åº”å¤´ä¸­,ç¡®ä¿æ–‡ä»¶å¯ä¸‹è½½
        HttpHeaders headers = new HttpHeaders();
        headers.set("Content-Disposition", "attachment;filename=" + URLEncoder.encode(readFile.getFilename(), "UTF-8"));
        // ğŸ³ğŸ³ğŸ³è®¾ç½®å†…å®¹ç±»å‹ä¸ºã€Œapplication/octet-streamã€äºŒè¿›åˆ¶æµ
        headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);

        // è·å–Fileå¯¹è±¡
        File file = readFile.getFile();
        Path path = Paths.get(file.toURI());
        // è·å–Fileå¯¹è±¡çš„å­—èŠ‚ç æ–‡ä»¶
        byte[] bytes = Files.readAllBytes(path);

        /*
         * ğŸ’ªğŸ’ªğŸ’ªè¡¨ç¤ºè¿”å›ä¸€ä¸ªå­—èŠ‚ç ç±»å‹çš„å“åº”
         * åŒæ—¶è®¾ç½®äº†å“åº”å¤´å’ŒçŠ¶æ€ç 
         * */
        return new ResponseEntity<>(bytes, headers, HttpStatus.OK);
        
		// ğŸ‘ğŸ‘ğŸ‘è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§é“¾å¼è°ƒç”¨çš„æ–¹å¼
		// return ResponseEntity.ok().headers(headers).body(bytes);
    }
}

```

ä¸‹è½½æˆåŠŸåï¼Œå¯ä»¥åœ¨
`Response Headers`
å“åº”å¤´ä¸­çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„
`Content-Disposition`
å’Œ
`Content-Type`

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/9b34c3f40eb48f06490c0254678e5340.png)

## äºŒ. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹XMLHttpRequest

**å‰ç«¯**

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <button id="btn">ä¸‹è½½æœ¬åœ°çš„æ–‡æœ¬</button>
</body>
<script th:src="@{js/jquery.min.js}"></script>
<script>
	// ç‚¹å‡»æŒ‰é’®ä¸‹è½½,å°†æœ¬åœ°çš„æ–‡ä»¶ä»¥æµçš„å½¢å¼è¿”å›å‰ç«¯,ç„¶åè¿›è¡Œä¸‹è½½
    $("#btn").on("click", function() {
    	
        // æ„é€ XMLHttpRequestå¯¹è±¡
        var xmlRequest = new XMLHttpRequest();
        // å‘é€getè¯·æ±‚
        xmlRequest.open("GET", "/test15/fileDownLoad", true);
        // è®¾ç½®å“åº”ç±»å‹
        xmlRequest.responseType = "blob";
        // å‘é€è¯·æ±‚
        xmlRequest.send([]);
        
        // è¯·æ±‚è·å¾—å“åº”ä¹‹å,è§¦å‘ä¸‹é¢çš„å›è°ƒå‡½æ•°
        xmlRequest.onload = function(oEvent) {
            // å½“æ—¶æ»¡è¶³ä¸‹é¢çš„çŠ¶æ€ç çš„æ—¶å€™,è§†ä¸ºä¸‹è½½æˆåŠŸ
            if ((xmlRequest.status >= 200 && xmlRequest.status < 300) || xmlRequest.status === 304) {

                // ä»xmlRequestå¯¹è±¡ä¸­è·å–å“åº”çš„å†…å®¹
                var content = xmlRequest.response;

                /*
                	ä»xmlRequestçš„å“åº”å¤´ä¸­è·å–æ–‡ä»¶åå­—ç¬¦ä¸²
                	å› ä¸ºæˆ‘ä»¬å°†æ–‡ä»¶ä»¥æµçš„å½¢å¼è¿”å›å‰ç«¯,è¿”å›çš„æ–‡ä»¶æ²¡æœ‰æ–‡ä»¶å
                	å› æ­¤åœ¨åç«¯å¤„ç†çš„æ—¶å€™,æˆ‘ä»¬å°†æ–‡ä»¶åæ”¾åˆ°å“åº”å¤´ä¸­
                	ç„¶ååœ¨å‰ç«¯ä»å“åº”å¤´ä¸­è·å–æ–‡ä»¶å
				*/ 
                var dispositionStr = xmlRequest.getResponseHeader('content-disposition');
                if (dispositionStr == null || dispositionStr === "") {
                    alert("ä¸‹è½½å¤±è´¥!");
                    return;
                } 
                
				// è·å–æ–‡ä»¶å
                let dispositionArr = dispositionStr.split("=");
                // æˆ‘ä»¬çš„æ–‡ä»¶åå¯èƒ½å«æœ‰æ±‰å­—,å› æ­¤åœ¨åç«¯è¿›è¡Œäº†UTF-8ç¼–ç å¤„ç†,æ­¤å¤„è¿›è¡Œè§£ç 
                let fileName = decodeURIComponent(dispositionArr[1]);

                // åˆ©ç”¨responseçš„å“åº”å†…å®¹æ„é€ ä¸€ä¸ªBlobå¯¹è±¡(é€šè¿‡Blobå¯¹è±¡è¿›è¡Œä¸‹è½½)
                var blob = new Blob([content]);

                // åˆ›å»ºä¸€ä¸ªéšè—çš„ç”¨æ¥ä¸‹è½½æ–‡ä»¶çš„aæ ‡ç­¾
                var elink = document.createElement('a');
                elink.download = fileName;
                elink.style.display = 'none';

                /*
                	å°†blobæ–‡ä»¶å¯¹è±¡è½¬æ¢ä¸ºå†…å­˜ä¸­å¯¹è±¡,å¹¶å°†ç”Ÿæˆçš„å¯¹è±¡èµ‹ç»™éšè—çš„aæ ‡ç­¾
                	bolbå¯¹è±¡ä¼šæš‚æ—¶å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„å†…å­˜ä¸­,
                	ä½¿ç”¨URL.createObjectURL()æ–¹æ³•å¯ä»¥åˆ›å»ºæŒ‡å‘å†…å­˜æ–‡ä»¶å¯¹è±¡çš„ä¸´æ—¶url
                	ä½¿ç”¨createObjectURLå¯ä»¥èŠ‚çœæ€§èƒ½å¹¶æ›´å¿«é€Ÿ,åªä¸è¿‡éœ€è¦åœ¨ä¸ä½¿ç”¨çš„æƒ…å†µä¸‹æ‰‹åŠ¨é‡Šæ”¾å†…å­˜
                	FileReader.readAsDataURLè¿”å›æ–‡ä»¶çš„base64å­—ç¬¦ä¸²ï¼Œæ¯”blob urlæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œä½†æ˜¯åœ¨ä¸ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨ä»å†…å­˜ä¸­æ¸…é™¤ï¼ˆé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶ï¼‰
				*/ 
                const src = URL.createObjectURL(blob);
                elink.href = src;
                document.body.appendChild(elink);

                // æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½äº‹ä»¶,è¿›è¡Œä¸‹è½½
                elink.click();
                
                // ç‚¹å‡»ä¹‹å,ç§»é™¤æˆ‘ä»¬å®šä¹‰çš„éšè—aæ ‡ç­¾
                document.body.removeChild(elink);

                // ç§»é™¤æ–‡ä»¶å¯¹è±¡
                URL.revokeObjectURL(src)
            }
        }
    });
</script>
</html>

```

**åç«¯**

* å‚ç…§æ™®é€šæ–‡ä»¶ä¸‹è½½çš„åç«¯

---

## ä¸‰. æ–‡ä»¶æµä¸‹è½½-jQueryçš„Ajax

â­•åå°-
`controller`

> æ·»åŠ 
> `@ResponseBodyæ³¨è§£`
> ,é˜²æ­¢
> **java.lang.IllegalStateException: getOutputStream() has already been called for this response**
> å¼‚å¸¸.å¦‚æœä½¿ç”¨@Autowiredçš„æ–¹å¼æ³¨å…¥
> `HttpServletResponse`
> å¯¹è±¡,ä½†æ˜¯ä¸æ·»åŠ @ResponseBodyæ³¨è§£è¯,å°±ä¼šå‡ºç°è¯¥å¼‚å¸¸.

```java
@Controller
@RequestMapping("/test2")
public class Test2Controller {

    @Autowired
    private Test2Service service;

    @GetMapping("/init")
    public ModelAndView init() {

        ModelAndView modelAndView = new ModelAndView();
        modelAndView.setViewName("test2");
        return  modelAndView;
    }

    @PostMapping("/fileDownload")
    @ResponseBody
    public void fileDownload(@RequestBody Test2Form form) throws Exception {

        service.fileDownload(form);
    }
}

```

â­•åå°-
`service`

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.Resource;
import org.springframework.core.io.ResourceLoader;
import org.springframework.stereotype.Service;
import org.springframework.util.FileCopyUtils;

import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileInputStream;
import java.net.URLEncoder;
import java.text.MessageFormat;

@Service
public class Test2Service {

    @Autowired
    private ResourceLoader resourceLoader;

    @Autowired
    private HttpServletResponse response;

    public void fileDownload(Test2Form form) throws Exception {

        String fileId = form.getFileId();
        String fileName = form.getFileName();

        // æ ¼å¼åŒ–æ‹¼æ¥èµ„æºçš„ç›¸å¯¹è·¯å¾„
        String filePath = MessageFormat.format("classpath:temp/{0}/{1}", fileId, fileName);
        // ä½¿ç”¨ResourceLoaderè·å–é¡¹ç›®ä¸­çš„èµ„æº,é˜²æ­¢é¡¹ç›®æ‰“åŒ…ä¹‹åæ‰¾ä¸åˆ°èµ„æº
        Resource resource = resourceLoader.getResource(filePath);

        if (!resource.exists()) {
            // æŠ›å‡ºå¼‚å¸¸,å‰å°Ajaxåœ¨erroræ–¹æ³•ä¸­å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†,è·å–å“åº”å¤´ä¸­çš„å¼‚å¸¸ä¿¡æ¯
            response.setHeader("errorInfo", URLEncoder.encode(fileName + "ä¸å­˜åœ¨!", "UTF-8"));
            throw new RuntimeException();
        }

        // è·å–èµ„æº,æŒ‡å®šç›¸åº”ä¿¡æ¯
        File file = resource.getFile();
        response.setContentType("application/octet-stream");
        response.setHeader("Content-Disposition", "attachment; filename*=\"" + URLEncoder.encode(fileName, "UTF-8") + "\"");
        response.setContentLength((int) file.length());

        // è¦ä¸‹è½½çš„æ–‡ä»¶ä¸å¤§çš„è¯,ç›´æ¥ä½¿ç”¨å·¥å…·ç±»å°†æ–‡ä»¶æ‹·è´åˆ°å“åº”æµä¸­å³å¯
        FileCopyUtils.copy(new FileInputStream(file), response.getOutputStream());
    }
}

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/8c1e9d6188f9c99a1965bae3b5d3c34d.png)

â­•å‰å°

> ãŠ™å…³é”®åœ¨äºdataTypeå’ŒxhrFieldsçš„å±æ€§æŒ‡å®šä¸Š,æŒ‡å®šå¯¹å±æ€§æ‰èƒ½è¿”å›blobæ–‡ä»¶æµ

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button id="btn">ç‚¹å‡»ä¸‹è½½æ–‡ä»¶</button>
</body>
<script src="/js/public/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">

    function doAjax_FileDownload(url, param, callback) {

        $.ajax({
            url: url,
            type: "post",
            data: JSON.stringify(param),
            // å‘æœåŠ¡å™¨å‘é€çš„æ•°æ®ç±»å‹
            contentType: 'application/json;charset=utf-8',
            // ğŸ’¢ğŸ’¢ğŸ’¢æŒ‡å®šæœåŠ¡å™¨è¿”å›çš„ç±»å‹,å› ä¸ºæˆ‘ä»¬è¦è¿”å›æ–‡ä»¶æµ,æ‰€ä»¥ç±»å‹ä¸ºäºŒè¿›åˆ¶æ•°æ®
            dataType: "binary",
            // ğŸ’¢ğŸ’¢ğŸ’¢åŸç”Ÿ XMLHttpRequest çš„å±æ€§,è®¾ç½®å“åº”ç±»å‹ä¸ºblob,æ¥æ”¶æ–‡ä»¶æµ
            xhrFields: {
                'responseType': 'blob'
            },
            success: function (result, status, xhr) {

                // å¯é€šè¿‡XMLHttpRequestå¯¹è±¡,è·å–å“åº”å¤´
                console.log(xhr);

                // æµè§ˆå™¨å…¼å®¹
                const download_URL = (window.URL || window.webkitURL).createObjectURL(result);

                // åˆ›å»ºaæ ‡ç­¾,æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½
                const a_link = document.createElement('a');
                a_link.href = download_URL;
                // åˆ©ç”¨äº†aæ ‡ç­¾çš„downloadå±æ€§,æŒ‡å®šæ–‡ä»¶åç§°
                a_link.download = param.fileName;
                document.body.appendChild(a_link);
                a_link.click();

                setTimeout(function () {
                    // ç§»é™¤å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„å’Œä¸ºä¸‹è½½è€Œåˆ›å»ºçš„aæ ‡ç­¾
                    URL.revokeObjectURL(download_URL);
                    a_link.remove();
                }, 10000);
            },
            error: function (xhr, textStatus, errorMessage) {

                // ä»å“åº”å¤´ä¸­è·å–å¼‚å¸¸ä¿¡æ¯,å¦‚æœåŒ…å«ä¸­æ–‡çš„è¯ä¼šä¹±ç å› æ­¤ åå°URLEncoder.encode() + å‰å°decodeURIComponent() é˜²æ­¢ä¹±ç 
                const errorInfo = decodeURIComponent(xhr.getResponseHeader("errorInfo"));

                // å¯¹é”™è¯¯ä¿¡æ¯è¿›è¡Œå±•ç¤º
                alert(errorInfo);
            }
        });
    }

    $("#btn").click(() => {

        const url = "http://localhost:8080/test2/fileDownload";
        const fileInfo = {
            fileName: 'æµ‹è¯•æ–‡ä»¶.text',
            fileId: 'A110120119'
        };
        doAjax_FileDownload(url, fileInfo, function () {});
    });
</script>
</html>

```

**æ•ˆæœ**
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/a11af886efa7c928471e961dae338705.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/e00e3270315545d00fe4941a621f68cd.png)

## å››. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹fetch

> é‡è¦ä»£ç ä¸º
> `await response.blob()`

è¯¦æƒ…å¯å‚è€ƒè¿™ç¯‡åšå®¢
  
https://blog.csdn.net/feyehong/article/details/124974601