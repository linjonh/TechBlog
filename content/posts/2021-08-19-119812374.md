---
layout: post
title: "æ–‡ä»¶ä¸‹è½½-æ™®é€šæ–‡ä»¶ä¸‹è½½-å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½"
date: 2021-08-19 22:19:08 +0800
description: "â¹æ–‡ä»¶ä¸‹è½½ æ™®é€šæ–‡ä»¶ä¸‹è½½ + å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½_å‰ç«¯æ¥æ”¶æ–‡ä»¶æµ"
keywords: "å‰ç«¯æ¥æ”¶æ–‡ä»¶æµ"
categories: ['å‰ç«¯', 'Java']
tags: ['æ–‡ä»¶ä¸‹è½½', 'Ajax']
artid: "119812374"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=119812374
    alt: "æ–‡ä»¶ä¸‹è½½-æ™®é€šæ–‡ä»¶ä¸‹è½½-å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=119812374
featuredImagePreview: https://bing.ee123.net/img/rand?artid=119812374
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     æ–‡ä»¶ä¸‹è½½ æ™®é€šæ–‡ä»¶ä¸‹è½½ + å‰ç«¯è·å–åç«¯è¿”å›çš„æ–‡ä»¶æµå¹¶ä¸‹è½½
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      å‚è€ƒèµ„æ–™
     </strong>
    </p>
    <ol>
     <li>
      <a href="https://blog.csdn.net/cpongo5/article/details/88577883">
       å‰ç«¯æ¥å—åç«¯æ–‡ä»¶æµå¹¶ä¸‹è½½çš„å‡ ç§æ–¹æ³•
      </a>
     </li>
     <li>
      <a href="https://www.cnblogs.com/cdemo/p/5225848.html" rel="nofollow">
       ajax è¯·æ±‚äºŒè¿›åˆ¶æµ å›¾ç‰‡ æ–‡ä»¶ XMLHttpRequest è¯·æ±‚å¹¶å¤„ç†äºŒè¿›åˆ¶æµæ•°æ® ä¹‹æœ€ä½³å®è·µ
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/weixin_33860722/article/details/91920467">
       ajaxè¯·æ±‚äºŒè¿›åˆ¶æµè¿›è¡Œå¤„ç†ï¼ˆajaxå¼‚æ­¥ä¸‹è½½æ–‡ä»¶ï¼‰
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/ccmm_/article/details/80885094">
       response.setHeader()çš„ç”¨æ³•
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/qq_42108192/article/details/81938674">
       response.setContentType()çš„ä½œç”¨åŠå‚æ•°
      </a>
     </li>
    </ol>
    <hr/>
    <p>
    </p>
    <div class="toc">
     <h4>
      ç›®å½•
     </h4>
     <ul>
      <li>
       <a href="#__19" rel="nofollow">
        ä¸€. æ™®é€šæ–‡ä»¶ä¸‹è½½
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#11_servletHttpServletResponse_23" rel="nofollow">
          1.1 åŸç”Ÿservletçš„HttpServletResponseæ–¹å¼ä¸‹è½½
         </a>
        </li>
        <li>
         <a href="#12_SpringResponseEntity_75" rel="nofollow">
          1.2 Springçš„ResponseEntityæ–¹å¼ä¸‹è½½
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_ajaxXMLHttpRequest_153" rel="nofollow">
        äºŒ. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹XMLHttpRequest
       </a>
      </li>
      <li>
       <a href="#_jQueryAjax_245" rel="nofollow">
        ä¸‰. æ–‡ä»¶æµä¸‹è½½-jQueryçš„Ajax
       </a>
      </li>
      <li>
       <a href="#_ajaxfetch_405" rel="nofollow">
        å››. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹fetch
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <p>
     <mark>
      è¦ç‚¹
     </mark>
    </p>
    <ol>
     <li>
      <code>
       response.setContentType("application/octet-stream");
      </code>
      æŒ‡æ˜è¦è¿”å›çš„å†…å®¹ä¸ºäºŒè¿›åˆ¶çš„æµ
     </li>
     <li>
      <code>
       response.setHeader("Content-Disposition", "attachment;filename=" + URLEncoder.encode(æ–‡ä»¶å.åç¼€, "UTF-8"));
      </code>
      æŒ‡æ˜ä¸‹è½½çš„æ–‡ä»¶åç§°
      <br/>
      <strong>
       Content-Disposition
      </strong>
      æ˜¯Content-Typeçš„æ‰©å±•ï¼Œå‘Šè¯‰æµè§ˆå™¨å¼¹çª—ä¸‹è½½æ¡†ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨é‡Œå±•ç¤ºæ–‡ä»¶ã€‚å› ä¸ºä¸€èˆ¬æµè§ˆå™¨å¯¹äºå®ƒèƒ½å¤Ÿå¤„ç†çš„æ–‡ä»¶ç±»å‹ï¼Œå¦‚txtï¼Œpdf ç­‰ï¼Œå®ƒéƒ½æ˜¯ç›´æ¥æ‰“å¼€å±•ç¤ºï¼Œè€Œä¸æ˜¯å¼¹çª—ä¸‹è½½æ¡†ã€‚
     </li>
    </ol>
    <hr/>
    <h2>
     <a id="__19">
     </a>
     ä¸€. æ™®é€šæ–‡ä»¶ä¸‹è½½
    </h2>
    <ul>
     <li>
      æ™®é€šæ–‡ä»¶ä¸‹è½½åªèƒ½ç›´æ¥è§¦å‘urlè¿›è¡Œä¸‹è½½ï¼Œä¸èƒ½ä½¿ç”¨Ajax
     </li>
    </ul>
    <h3>
     <a id="11_servletHttpServletResponse_23">
     </a>
     1.1 åŸç”Ÿservletçš„HttpServletResponseæ–¹å¼ä¸‹è½½
    </h3>
    <p>
     â¹
     <strong>
      å‰ç«¯
     </strong>
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/test15/fileDownLoad<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>ä¸‹è½½æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     â¹
     <strong>
      åç«¯
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">FileCopyUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test15"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test15Controller</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/fileDownLoad"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fileDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸­çš„æ–‡ä»¶</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\ç”¨æˆ·å\\Desktop\\hexoå®‰è£….txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
        	â¹1. response.setContentTypeçš„ä½œç”¨æ˜¯ä½¿å®¢æˆ·ç«¯æµè§ˆå™¨ï¼ŒåŒºåˆ†ä¸åŒç§ç±»çš„æ•°æ®
        	å¹¶æ ¹æ®ä¸åŒçš„MIMEè°ƒç”¨æµè§ˆå™¨å†…ä¸åŒçš„ç¨‹åºåµŒå…¥æ¨¡å—æ¥å¤„ç†ç›¸åº”çš„æ•°æ®ã€‚
			â¹2. application/octet-streamè¡¨ç¤ºè¿”å›äºŒè¿›åˆ¶æµï¼Œè¡¨ç¤ºä¸çŸ¥é“ä¸‹è½½æ–‡ä»¶ç±»å‹ï¼Œå…·æœ‰é€šç”¨æ€§
		*/</span> 
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
        	Content-Disposition çš„ä½œç”¨:
        		æ–‡ä»¶ä¸‹è½½æ—¶ä¼šå‘Šè¯‰æµè§ˆå™¨è¦ä¸‹è½½çš„æ–‡ä»¶åç§°å’Œç±»å‹
        	URLEncoder.encode çš„ä½œç”¨æ˜¯ä¸ºäº†é˜²æ­¢ä¸­æ–‡æ–‡ä»¶åä¹±ç 
		*/</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// ä½¿ç”¨å·¥å…·ç±»ç›´æ¥å°†æ–‡ä»¶çš„å­—èŠ‚å¤åˆ¶åˆ°å“åº”è¾“å‡ºæµä¸­</span>
        <span class="token class-name">FileCopyUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="12_SpringResponseEntity_75">
     </a>
     1.2 Springçš„ResponseEntityæ–¹å¼ä¸‹è½½
    </h3>
    <p>
     â¹
     <strong>
      å‰ç«¯
     </strong>
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>downloadFile<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{/test19/testResponseEntity1}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>æ–‡ä»¶ä¸‹è½½-æ™®é€šçš„æ–¹å¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     â¹
     <strong>
      åç«¯
     </strong>
    </p>
    <ul>
     <li>
      é€šè¿‡æ„é€ springframeworkçš„ResponseEntityç±»çš„æ–¹å¼è¿”å›æ•°æ®
     </li>
     <li>
      å¯ä»¥æŒ‡å®šå­—èŠ‚ç çš„è¿”å›å€¼ï¼Œå“åº”å€¼ï¼ŒçŠ¶æ€ç 
     </li>
    </ul>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/80e3c9b476f31bced548c92e3006d095.png"/>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ClassPathResource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Files</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Path</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test19"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test19Controller</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/testResponseEntity1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">testResponseEntity1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// ğŸ§ğŸ§ğŸ§è¯»å–æœ¬åœ°çš„æ–‡ä»¶</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"/temp/A110120119/æµ‹è¯•æ–‡ä»¶.text"</span><span class="token punctuation">;</span>
        <span class="token class-name">ClassPathResource</span> readFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ğŸ³ğŸ³ğŸ³è®¾ç½®å“åº”å¤´,æŠŠæ–‡ä»¶åç§°æ”¾å…¥å“åº”å¤´ä¸­,ç¡®ä¿æ–‡ä»¶å¯ä¸‹è½½</span>
        <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>readFile<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ğŸ³ğŸ³ğŸ³è®¾ç½®å†…å®¹ç±»å‹ä¸ºã€Œapplication/octet-streamã€äºŒè¿›åˆ¶æµ</span>
        headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–Fileå¯¹è±¡</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> readFile<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–Fileå¯¹è±¡çš„å­—èŠ‚ç æ–‡ä»¶</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllBytes</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
         * ğŸ’ªğŸ’ªğŸ’ªè¡¨ç¤ºè¿”å›ä¸€ä¸ªå­—èŠ‚ç ç±»å‹çš„å“åº”
         * åŒæ—¶è®¾ç½®äº†å“åº”å¤´å’ŒçŠ¶æ€ç 
         * */</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
		<span class="token comment">// ğŸ‘ğŸ‘ğŸ‘è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§é“¾å¼è°ƒç”¨çš„æ–¹å¼</span>
		<span class="token comment">// return ResponseEntity.ok().headers(headers).body(bytes);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ä¸‹è½½æˆåŠŸåï¼Œå¯ä»¥åœ¨
     <code>
      Response Headers
     </code>
     å“åº”å¤´ä¸­çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„
     <code>
      Content-Disposition
     </code>
     å’Œ
     <code>
      Content-Type
     </code>
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/9b34c3f40eb48f06490c0254678e5340.png"/>
    </p>
    <h2>
     <a id="_ajaxXMLHttpRequest_153">
     </a>
     äºŒ. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹XMLHttpRequest
    </h2>
    <p>
     <strong>
      å‰ç«¯
     </strong>
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>ä¸‹è½½æœ¬åœ°çš„æ–‡æœ¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{js/jquery.min.js}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token comment">// ç‚¹å‡»æŒ‰é’®ä¸‹è½½,å°†æœ¬åœ°çš„æ–‡ä»¶ä»¥æµçš„å½¢å¼è¿”å›å‰ç«¯,ç„¶åè¿›è¡Œä¸‹è½½</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#btn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	
        <span class="token comment">// æ„é€ XMLHttpRequestå¯¹è±¡</span>
        <span class="token keyword">var</span> xmlRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘é€getè¯·æ±‚</span>
        xmlRequest<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"/test15/fileDownLoad"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®å“åº”ç±»å‹</span>
        xmlRequest<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">"blob"</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘é€è¯·æ±‚</span>
        xmlRequest<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// è¯·æ±‚è·å¾—å“åº”ä¹‹å,è§¦å‘ä¸‹é¢çš„å›è°ƒå‡½æ•°</span>
        xmlRequest<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">oEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// å½“æ—¶æ»¡è¶³ä¸‹é¢çš„çŠ¶æ€ç çš„æ—¶å€™,è§†ä¸ºä¸‹è½½æˆåŠŸ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xmlRequest<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xmlRequest<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xmlRequest<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                <span class="token comment">// ä»xmlRequestå¯¹è±¡ä¸­è·å–å“åº”çš„å†…å®¹</span>
                <span class="token keyword">var</span> content <span class="token operator">=</span> xmlRequest<span class="token punctuation">.</span>response<span class="token punctuation">;</span>

                <span class="token comment">/*
                	ä»xmlRequestçš„å“åº”å¤´ä¸­è·å–æ–‡ä»¶åå­—ç¬¦ä¸²
                	å› ä¸ºæˆ‘ä»¬å°†æ–‡ä»¶ä»¥æµçš„å½¢å¼è¿”å›å‰ç«¯,è¿”å›çš„æ–‡ä»¶æ²¡æœ‰æ–‡ä»¶å
                	å› æ­¤åœ¨åç«¯å¤„ç†çš„æ—¶å€™,æˆ‘ä»¬å°†æ–‡ä»¶åæ”¾åˆ°å“åº”å¤´ä¸­
                	ç„¶ååœ¨å‰ç«¯ä»å“åº”å¤´ä¸­è·å–æ–‡ä»¶å
				*/</span> 
                <span class="token keyword">var</span> dispositionStr <span class="token operator">=</span> xmlRequest<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">'content-disposition'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dispositionStr <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> dispositionStr <span class="token operator">===</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"ä¸‹è½½å¤±è´¥!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> 
                
				<span class="token comment">// è·å–æ–‡ä»¶å</span>
                <span class="token keyword">let</span> dispositionArr <span class="token operator">=</span> dispositionStr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// æˆ‘ä»¬çš„æ–‡ä»¶åå¯èƒ½å«æœ‰æ±‰å­—,å› æ­¤åœ¨åç«¯è¿›è¡Œäº†UTF-8ç¼–ç å¤„ç†,æ­¤å¤„è¿›è¡Œè§£ç </span>
                <span class="token keyword">let</span> fileName <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>dispositionArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// åˆ©ç”¨responseçš„å“åº”å†…å®¹æ„é€ ä¸€ä¸ªBlobå¯¹è±¡(é€šè¿‡Blobå¯¹è±¡è¿›è¡Œä¸‹è½½)</span>
                <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// åˆ›å»ºä¸€ä¸ªéšè—çš„ç”¨æ¥ä¸‹è½½æ–‡ä»¶çš„aæ ‡ç­¾</span>
                <span class="token keyword">var</span> elink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                elink<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
                elink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>

                <span class="token comment">/*
                	å°†blobæ–‡ä»¶å¯¹è±¡è½¬æ¢ä¸ºå†…å­˜ä¸­å¯¹è±¡,å¹¶å°†ç”Ÿæˆçš„å¯¹è±¡èµ‹ç»™éšè—çš„aæ ‡ç­¾
                	bolbå¯¹è±¡ä¼šæš‚æ—¶å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„å†…å­˜ä¸­,
                	ä½¿ç”¨URL.createObjectURL()æ–¹æ³•å¯ä»¥åˆ›å»ºæŒ‡å‘å†…å­˜æ–‡ä»¶å¯¹è±¡çš„ä¸´æ—¶url
                	ä½¿ç”¨createObjectURLå¯ä»¥èŠ‚çœæ€§èƒ½å¹¶æ›´å¿«é€Ÿ,åªä¸è¿‡éœ€è¦åœ¨ä¸ä½¿ç”¨çš„æƒ…å†µä¸‹æ‰‹åŠ¨é‡Šæ”¾å†…å­˜
                	FileReader.readAsDataURLè¿”å›æ–‡ä»¶çš„base64å­—ç¬¦ä¸²ï¼Œæ¯”blob urlæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œä½†æ˜¯åœ¨ä¸ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨ä»å†…å­˜ä¸­æ¸…é™¤ï¼ˆé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶ï¼‰
				*/</span> 
                <span class="token keyword">const</span> src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
                elink<span class="token punctuation">.</span>href <span class="token operator">=</span> src<span class="token punctuation">;</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½äº‹ä»¶,è¿›è¡Œä¸‹è½½</span>
                elink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// ç‚¹å‡»ä¹‹å,ç§»é™¤æˆ‘ä»¬å®šä¹‰çš„éšè—aæ ‡ç­¾</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// ç§»é™¤æ–‡ä»¶å¯¹è±¡</span>
                <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      åç«¯
     </strong>
    </p>
    <ul>
     <li>
      å‚ç…§æ™®é€šæ–‡ä»¶ä¸‹è½½çš„åç«¯
     </li>
    </ul>
    <hr/>
    <h2>
     <a id="_jQueryAjax_245">
     </a>
     ä¸‰. æ–‡ä»¶æµä¸‹è½½-jQueryçš„Ajax
    </h2>
    <p>
     â­•åå°-
     <code>
      controller
     </code>
    </p>
    <blockquote>
     <p>
      æ·»åŠ 
      <code>
       @ResponseBodyæ³¨è§£
      </code>
      ,é˜²æ­¢
      <strong>
       java.lang.IllegalStateException: getOutputStream() has already been called for this response
      </strong>
      å¼‚å¸¸.å¦‚æœä½¿ç”¨@Autowiredçš„æ–¹å¼æ³¨å…¥
      <code>
       HttpServletResponse
      </code>
      å¯¹è±¡,ä½†æ˜¯ä¸æ·»åŠ @ResponseBodyæ³¨è§£è¯,å°±ä¼šå‡ºç°è¯¥å¼‚å¸¸.
     </p>
    </blockquote>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test2"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2Controller</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Test2Service</span> service<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/init"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"test2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  modelAndView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/fileDownload"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fileDownload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Test2Form</span> form<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        service<span class="token punctuation">.</span><span class="token function">fileDownload</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     â­•åå°-
     <code>
      service
     </code>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ResourceLoader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">FileCopyUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">MessageFormat</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2Service</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fileDownload</span><span class="token punctuation">(</span><span class="token class-name">Test2Form</span> form<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">String</span> fileId <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¼å¼åŒ–æ‹¼æ¥èµ„æºçš„ç›¸å¯¹è·¯å¾„</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token class-name">MessageFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"classpath:temp/{0}/{1}"</span><span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä½¿ç”¨ResourceLoaderè·å–é¡¹ç›®ä¸­çš„èµ„æº,é˜²æ­¢é¡¹ç›®æ‰“åŒ…ä¹‹åæ‰¾ä¸åˆ°èµ„æº</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// æŠ›å‡ºå¼‚å¸¸,å‰å°Ajaxåœ¨erroræ–¹æ³•ä¸­å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†,è·å–å“åº”å¤´ä¸­çš„å¼‚å¸¸ä¿¡æ¯</span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"errorInfo"</span><span class="token punctuation">,</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName <span class="token operator">+</span> <span class="token string">"ä¸å­˜åœ¨!"</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è·å–èµ„æº,æŒ‡å®šç›¸åº”ä¿¡æ¯</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment; filename*=\""</span> <span class="token operator">+</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setContentLength</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¦ä¸‹è½½çš„æ–‡ä»¶ä¸å¤§çš„è¯,ç›´æ¥ä½¿ç”¨å·¥å…·ç±»å°†æ–‡ä»¶æ‹·è´åˆ°å“åº”æµä¸­å³å¯</span>
        <span class="token class-name">FileCopyUtils</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/8c1e9d6188f9c99a1965bae3b5d3c34d.png"/>
    </p>
    <p>
     â­•å‰å°
    </p>
    <blockquote>
     <p>
      ãŠ™å…³é”®åœ¨äºdataTypeå’ŒxhrFieldsçš„å±æ€§æŒ‡å®šä¸Š,æŒ‡å®šå¯¹å±æ€§æ‰èƒ½è¿”å›blobæ–‡ä»¶æµ
     </p>
    </blockquote>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»ä¸‹è½½æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/public/jquery-3.6.0.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">th:</span>inline</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

    <span class="token keyword">function</span> <span class="token function">doAjax_FileDownload</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> param<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// å‘æœåŠ¡å™¨å‘é€çš„æ•°æ®ç±»å‹</span>
            <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">,</span>
            <span class="token comment">// ğŸ’¢ğŸ’¢ğŸ’¢æŒ‡å®šæœåŠ¡å™¨è¿”å›çš„ç±»å‹,å› ä¸ºæˆ‘ä»¬è¦è¿”å›æ–‡ä»¶æµ,æ‰€ä»¥ç±»å‹ä¸ºäºŒè¿›åˆ¶æ•°æ®</span>
            <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">"binary"</span><span class="token punctuation">,</span>
            <span class="token comment">// ğŸ’¢ğŸ’¢ğŸ’¢åŸç”Ÿ XMLHttpRequest çš„å±æ€§,è®¾ç½®å“åº”ç±»å‹ä¸ºblob,æ¥æ”¶æ–‡ä»¶æµ</span>
            <span class="token literal-property property">xhrFields</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">'responseType'</span><span class="token operator">:</span> <span class="token string">'blob'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> status<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                <span class="token comment">// å¯é€šè¿‡XMLHttpRequestå¯¹è±¡,è·å–å“åº”å¤´</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// æµè§ˆå™¨å…¼å®¹</span>
                <span class="token keyword">const</span> download_URL <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// åˆ›å»ºaæ ‡ç­¾,æ¨¡æ‹Ÿç‚¹å‡»ä¸‹è½½</span>
                <span class="token keyword">const</span> a_link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                a_link<span class="token punctuation">.</span>href <span class="token operator">=</span> download_URL<span class="token punctuation">;</span>
                <span class="token comment">// åˆ©ç”¨äº†aæ ‡ç­¾çš„downloadå±æ€§,æŒ‡å®šæ–‡ä»¶åç§°</span>
                a_link<span class="token punctuation">.</span>download <span class="token operator">=</span> param<span class="token punctuation">.</span>fileName<span class="token punctuation">;</span>
                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a_link<span class="token punctuation">)</span><span class="token punctuation">;</span>
                a_link<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// ç§»é™¤å†…å­˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„å’Œä¸ºä¸‹è½½è€Œåˆ›å»ºçš„aæ ‡ç­¾</span>
                    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>download_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    a_link<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span> textStatus<span class="token punctuation">,</span> errorMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                <span class="token comment">// ä»å“åº”å¤´ä¸­è·å–å¼‚å¸¸ä¿¡æ¯,å¦‚æœåŒ…å«ä¸­æ–‡çš„è¯ä¼šä¹±ç å› æ­¤ åå°URLEncoder.encode() + å‰å°decodeURIComponent() é˜²æ­¢ä¹±ç </span>
                <span class="token keyword">const</span> errorInfo <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">"errorInfo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// å¯¹é”™è¯¯ä¿¡æ¯è¿›è¡Œå±•ç¤º</span>
                <span class="token function">alert</span><span class="token punctuation">(</span>errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#btn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"http://localhost:8080/test2/fileDownload"</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> fileInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">'æµ‹è¯•æ–‡ä»¶.text'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">fileId</span><span class="token operator">:</span> <span class="token string">'A110120119'</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">doAjax_FileDownload</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> fileInfo<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      æ•ˆæœ
     </strong>
     <br/>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/a11af886efa7c928471e961dae338705.png">
      <br/>
      <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/blog_migrate/e00e3270315545d00fe4941a621f68cd.png"/>
     </img>
    </p>
    <h2>
     <a id="_ajaxfetch_405">
     </a>
     å››. æ–‡ä»¶æµä¸‹è½½-åŸç”Ÿajaxä¹‹fetch
    </h2>
    <blockquote>
     <p>
      é‡è¦ä»£ç ä¸º
      <code>
       await response.blob()
      </code>
     </p>
    </blockquote>
    <p>
     è¯¦æƒ…å¯å‚è€ƒè¿™ç¯‡åšå®¢
     <br/>
     https://blog.csdn.net/feyehong/article/details/124974601
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f66657965686f6e672f:61727469636c652f64657461696c732f313139383132333734" class_="artid" style="display:none">
 </p>
</div>


