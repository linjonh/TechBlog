---
layout: post
title: "路径查询组件优化记录数据处理与显示逻辑重构"
date: 2025-03-12 16:20:31 +0800
description: "修正线路名称显示：确保连接线显示正确的线路信息，提高了用户体验重构数据处理逻辑：通过引入专门的数据处理函数，实现了\"一处修改\"原则通过前后代码对比，可以清晰地看到重构后的代码结构更加清晰、职责划分更加明确，维护成本显著降低。特别是在面对字段变更、数据格式调整等常见需求时，新的代码结构可以大大减少修改点，降低出错风险。虽然等辅助函数看起来很简单，但它们是整个数据处理架构的重要组成部分，为代码的长期维护奠定了基础。"
keywords: "【路径查询组件优化记录：数据处理与显示逻辑重构】"
categories: ['重构优化', 'Vue']
tags: ['重构', '前端', 'Javascript']
artid: "146208155"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146208155
    alt: "路径查询组件优化记录数据处理与显示逻辑重构"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146208155
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146208155
cover: https://bing.ee123.net/img/rand?artid=146208155
image: https://bing.ee123.net/img/rand?artid=146208155
img: https://bing.ee123.net/img/rand?artid=146208155
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【路径查询组件优化记录：数据处理与显示逻辑重构】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     路径查询组件优化记录：数据处理与显示逻辑重构
    </h2>
    <h3>
     <a id="_3">
     </a>
     一、优化背景与目标
    </h3>
    <p>
     在路径查询系统中，
     <code>
      station-display.vue
     </code>
     组件负责展示查询结果，包括线路名称、站点信息和换乘方案等关键信息。通过代码审查，发现了两个需要优化的问题：
    </p>
    <ol>
     <li>
      <strong>
       线路名称显示错误
      </strong>
      ：连接线上显示的线路名称取自下一个站点而非当前站点
     </li>
     <li>
      <strong>
       数据处理分散
      </strong>
      ：数据字段处理逻辑分散在多处，导致维护困难
     </li>
    </ol>
    <p>
     优化目标是在不影响现有功能的前提下，修正显示错误并提高代码的可维护性。
    </p>
    <h3>
     <a id="_12">
     </a>
     二、具体改动点与前后对比
    </h3>
    <h4>
     <a id="1__14">
     </a>
     1. 线路名称显示逻辑修正
    </h4>
    <p>
     <strong>
      问题
     </strong>
     ：在站点连接线上，线路名称错误地显示了下一个站点的线路，而非当前站点的线路。
    </p>
    <p>
     <strong>
      修改前代码
     </strong>
     ：
    </p>
    <pre><code class="prism language-vue">&lt;template v-for="(station, idx) in path.stations" :key="'conn-' + idx"&gt;
    &lt;div v-if="idx &lt; path.stations.length - 1" class="station-connection" :style="{
        left: `calc(${(idx + 0.5) * 100 / (path.stations.length - 1)}%)`,
        transform: 'translateX(-50%)'
    }"&gt;
        &lt;span class="line-station-info"&gt;
            {<!-- -->{ path.stations[idx + 1].lineName ? path.stations[idx + 1].lineName.replace('地铁', '') : '' }}/{<!-- -->{
                path.stations[idx + 1].stationNum || 0 }}站
        &lt;/span&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
    <p>
     <strong>
      修改后代码
     </strong>
     ：
    </p>
    <pre><code class="prism language-vue">&lt;template v-for="(station, idx) in path.stations" :key="'conn-' + idx"&gt;
    &lt;div v-if="idx &lt; path.stations.length - 1" class="station-connection" :style="{
        left: `calc(${(idx + 0.5) * 100 / (path.stations.length - 1)}%)`,
        transform: 'translateX(-50%)'
    }"&gt;
        &lt;span class="line-station-info"&gt;
            {<!-- -->{ path.stations[idx].lineName ? path.stations[idx].lineName.replace('地铁', '') : '' }}/{<!-- -->{
                path.stations[idx + 1].stationNum || 0 }}站
        &lt;/span&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
    <p>
     <strong>
      效果对比
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       修改前
      </strong>
      ：连接线显示的是下一个站点的线路名称，例如从1号线到2号线的连接线会显示"2号线/3站"
     </li>
     <li>
      <strong>
       修改后
      </strong>
      ：连接线显示的是当前站点的线路名称，例如从1号线到2号线的连接线会显示"1号线/3站"
     </li>
    </ul>
    <p>
     <strong>
      视觉变化
     </strong>
     ：
     <br/>
     用户现在能看到正确的线路信息，特别是在换乘点，能清晰地知道当前所在的线路，而不是错误地显示即将换乘的线路。
    </p>
    <h4>
     <a id="2__55">
     </a>
     2. 数据处理逻辑集中化
    </h4>
    <h5>
     <a id="a__57">
     </a>
     a. 总站数显示字段统一
    </h5>
    <p>
     <strong>
      修改前代码
     </strong>
     ：
    </p>
    <pre><code class="prism language-vue">&lt;div class="line-time-station"&gt;
    &lt;span class="line-name"&gt;{<!-- -->{ path.lineName || '暂无线路名称' }}&lt;/span&gt;
    &lt;span class="time-station" v-if="path.duration"&gt;{<!-- -->{
        secondToMinute(path.duration) }}分钟/{<!-- -->{ path.allNum || 0
        }}站&lt;/span&gt;
&lt;/div&gt;
</code></pre>
    <p>
     <strong>
      修改后代码
     </strong>
     ：
    </p>
    <pre><code class="prism language-vue">&lt;div class="line-time-station"&gt;
    &lt;span class="line-name"&gt;{<!-- -->{ path.lineName || '暂无线路名称' }}&lt;/span&gt;
    &lt;span class="time-station" v-if="path.duration"&gt;{<!-- -->{
        secondToMinute(path.duration) }}分钟/{<!-- -->{ path.totalStations || 0
        }}站&lt;/span&gt;
&lt;/div&gt;
</code></pre>
    <p>
     <strong>
      效果对比
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       修改前
      </strong>
      ：直接使用API返回的
      <code>
       allNum
      </code>
      字段
     </li>
     <li>
      <strong>
       修改后
      </strong>
      ：使用统一处理后的
      <code>
       totalStations
      </code>
      字段，但值仍来自API的
      <code>
       allNum
      </code>
     </li>
    </ul>
    <h5>
     <a id="b__83">
     </a>
     b. 数据处理函数重构
    </h5>
    <p>
     <strong>
      修改前代码
     </strong>
     ：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 处理站点数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">processStations</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> stations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>schedulesList <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 添加起始站</span>
        stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">stationType</span><span class="token operator">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>originStationName <span class="token operator">||</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>stationName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">lineName</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>lineId <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationNum</span><span class="token operator">:</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>stationNum <span class="token operator">||</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加中间站/换乘站</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> station <span class="token operator">=</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> isLastStation <span class="token operator">=</span> i <span class="token operator">===</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

            stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">stationType</span><span class="token operator">:</span> isLastStation <span class="token operator">?</span> <span class="token string">'1'</span> <span class="token operator">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stationName</span><span class="token operator">:</span> isLastStation <span class="token operator">?</span>
                    <span class="token punctuation">(</span>path<span class="token punctuation">.</span>destStationName <span class="token operator">||</span> station<span class="token punctuation">.</span>stationName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                    <span class="token punctuation">(</span>station<span class="token punctuation">.</span>stationName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">lineName</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>station<span class="token punctuation">.</span>lineId <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">stationNum</span><span class="token operator">:</span> station<span class="token punctuation">.</span>stationNum <span class="token operator">||</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>originStationName <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>destStationName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 只有起终点信息的情况</span>
        stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">stationType</span><span class="token operator">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>originStationName<span class="token punctuation">,</span>
            <span class="token literal-property property">lineName</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span>originLineId <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationNum</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">stationType</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>destStationName<span class="token punctuation">,</span>
            <span class="token literal-property property">lineName</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span>endLineId <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationNum</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> stations<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 查询按钮点击处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleQuery</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... 验证代码 ...</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 调用API查询路径</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">findOdPath</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>response <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pathResults<span class="token punctuation">.</span>value <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">path</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">programmeType</span><span class="token operator">:</span> path<span class="token punctuation">.</span>simpleType <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">programmeIndex</span><span class="token operator">:</span> path<span class="token punctuation">.</span>programmeIndex <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token literal-property property">lineName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>lineName <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span>endLineId <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线 (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span>originStationName <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>path<span class="token punctuation">.</span>destStationName <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">duration</span><span class="token operator">:</span> path<span class="token punctuation">.</span>travelTime <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stationNum</span><span class="token operator">:</span> path<span class="token punctuation">.</span>stopList<span class="token operator">?.</span>length <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">transferNum</span><span class="token operator">:</span> path<span class="token punctuation">.</span>transferNum <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stations</span><span class="token operator">:</span> <span class="token function">processStations</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">nameScope</span><span class="token operator">:</span> path<span class="token punctuation">.</span>nameScope <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">simpleType</span><span class="token operator">:</span> path<span class="token punctuation">.</span>simpleType <span class="token operator">||</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">schedulesList</span><span class="token operator">:</span> path<span class="token punctuation">.</span>schedulesList <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">allNum</span><span class="token operator">:</span> path<span class="token punctuation">.</span>allNum <span class="token operator">||</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ... 选择路径代码 ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ... 错误处理 ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// watch中的数据处理</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>selectedPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... 其他代码 ...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ... 线路和站点处理代码 ...</span>
            <span class="token comment">// 更新路径结果</span>
            pathResults<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">programmeType</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>programmeType <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">programmeIndex</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>programmeIndex <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token literal-property property">lineName</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>lineName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">duration</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>duration <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stationNum</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>stationNum <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">transferNum</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>transferNum <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stations</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>stations <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">nameScope</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>nameScope <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">simpleType</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>simpleType <span class="token operator">||</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">schedulesList</span><span class="token operator">:</span> newPath<span class="token punctuation">.</span>schedulesList <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            selectedPathIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ... 错误处理 ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      修改后代码
     </strong>
     ：
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 数据处理工具函数</span>
<span class="token comment">/**
 * 处理路径数据，统一数据格式
 * @param {Object} rawPath - 原始路径数据
 * @returns {Object} - 处理后的路径数据
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">processPathData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">rawPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 处理站点数据</span>
    <span class="token keyword">const</span> stations <span class="token operator">=</span> <span class="token function">processStations</span><span class="token punctuation">(</span>rawPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">programmeType</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>simpleType <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">programmeIndex</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>programmeIndex <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">lineName</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>lineName <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>rawPath<span class="token punctuation">.</span>endLineId <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线 (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>rawPath<span class="token punctuation">.</span>originStationName <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>rawPath<span class="token punctuation">.</span>destStationName <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">duration</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>travelTime <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">stationNum</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>stopList<span class="token operator">?.</span>length <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transferNum</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>transferNum <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">stations</span><span class="token operator">:</span> stations<span class="token punctuation">,</span>
        <span class="token literal-property property">nameScope</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>nameScope <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">simpleType</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>simpleType <span class="token operator">||</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">schedulesList</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>schedulesList <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">totalStations</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>allNum <span class="token operator">||</span> <span class="token number">0</span> <span class="token comment">// 直接使用接口返回的allNum</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 处理站点数据，统一数据格式
 * @param {Object} path - 路径数据
 * @returns {Array} - 处理后的站点数组
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">processStations</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> stations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>schedulesList <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 添加起始站</span>
        stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createStationData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">stationType</span><span class="token operator">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>originStationName <span class="token operator">||</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>stationName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">lineId</span><span class="token operator">:</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>lineId <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationNum</span><span class="token operator">:</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>stationNum <span class="token operator">||</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加中间站/换乘站</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> station <span class="token operator">=</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> isLastStation <span class="token operator">=</span> i <span class="token operator">===</span> path<span class="token punctuation">.</span>schedulesList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

            stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createStationData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">stationType</span><span class="token operator">:</span> isLastStation <span class="token operator">?</span> <span class="token string">'1'</span> <span class="token operator">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stationName</span><span class="token operator">:</span> isLastStation <span class="token operator">?</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>destStationName <span class="token operator">||</span> station<span class="token punctuation">.</span>stationName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>station<span class="token punctuation">.</span>stationName <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">lineId</span><span class="token operator">:</span> station<span class="token punctuation">.</span>lineId <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">stationNum</span><span class="token operator">:</span> station<span class="token punctuation">.</span>stationNum <span class="token operator">||</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>originStationName <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>destStationName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 只有起终点信息的情况</span>
        stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createStationData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">stationType</span><span class="token operator">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>originStationName<span class="token punctuation">,</span>
            <span class="token literal-property property">lineId</span><span class="token operator">:</span> path<span class="token punctuation">.</span>originLineId <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationNum</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        stations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createStationData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">stationType</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationName</span><span class="token operator">:</span> path<span class="token punctuation">.</span>destStationName<span class="token punctuation">,</span>
            <span class="token literal-property property">lineId</span><span class="token operator">:</span> path<span class="token punctuation">.</span>endLineId <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">stationNum</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> stations<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 创建标准化的站点数据对象
 * @param {Object} data - 站点原始数据
 * @returns {Object} - 标准化的站点数据
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">createStationData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> stationType<span class="token punctuation">,</span> stationName<span class="token punctuation">,</span> lineId<span class="token punctuation">,</span> stationNum <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    stationType<span class="token punctuation">,</span>
    stationName<span class="token punctuation">,</span>
    <span class="token literal-property property">lineName</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">号线</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    stationNum
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 查询按钮点击处理</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleQuery</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... 验证代码 ...</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">findOdPath</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>response <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 使用processPathData处理每条路径数据</span>
            pathResults<span class="token punctuation">.</span>value <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>processPathData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ... 选择路径代码 ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ... 错误处理 ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// watch中的数据处理</span>
<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>selectedPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... 其他代码 ...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPath<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ... 线路和站点处理代码 ...</span>
            <span class="token comment">// 使用processPathData处理路径数据</span>
            pathResults<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">processPathData</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            selectedPathIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ... 错误处理 ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      代码结构对比
     </strong>
     ：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        修改前
       </strong>
       ：
      </p>
      <ul>
       <li>
        数据处理逻辑分散在多处
       </li>
       <li>
        相同的数据转换逻辑在不同地方重复
       </li>
       <li>
        缺乏统一的数据处理入口
       </li>
       <li>
        字段名称不统一（有些地方用
        <code>
         allNum
        </code>
        ，有些地方没有）
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        修改后
       </strong>
       ：
      </p>
      <ul>
       <li>
        引入了集中的数据处理函数
        <code>
         processPathData
        </code>
       </li>
       <li>
        添加了辅助函数
        <code>
         createStationData
        </code>
        标准化站点数据
       </li>
       <li>
        统一了字段命名（使用
        <code>
         totalStations
        </code>
        ）
       </li>
       <li>
        添加了详细的函数注释
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      维护性对比
     </strong>
     ：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        修改前
       </strong>
       ：
      </p>
      <ul>
       <li>
        修改字段名需要在多处搜索和替换
       </li>
       <li>
        添加新字段需要修改多个地方
       </li>
       <li>
        数据格式转换逻辑分散，难以统一修改
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        修改后
       </strong>
       ：
      </p>
      <ul>
       <li>
        修改字段名只需在
        <code>
         processPathData
        </code>
        函数中更新
       </li>
       <li>
        添加新字段只需在
        <code>
         processPathData
        </code>
        和接口定义中添加
       </li>
       <li>
        数据格式转换集中在专门的函数中，便于统一修改
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="_333">
     </a>
     三、"一处修改"原则的实现与验证
    </h3>
    <p>
     为了验证"一处修改"原则的实现效果，可以通过几个常见的变更场景来对比：
    </p>
    <h4>
     <a id="1_337">
     </a>
     场景1：修改字段名
    </h4>
    <p>
     <strong>
      需求
     </strong>
     ：将总站数的字段名从
     <code>
      allNum
     </code>
     改为
     <code>
      stationTotal
     </code>
    </p>
    <p>
     <strong>
      修改前需要的操作
     </strong>
     ：
    </p>
    <ol>
     <li>
      搜索所有使用
      <code>
       allNum
      </code>
      的地方（至少2处：handleQuery和模板）
     </li>
     <li>
      修改每个地方的字段名
     </li>
     <li>
      确保没有遗漏任何使用点
     </li>
    </ol>
    <p>
     <strong>
      修改后只需的操作
     </strong>
     ：
    </p>
    <ol>
     <li>
      在
      <code>
       processPathData
      </code>
      函数中修改：
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...其他字段</span>
    <span class="token literal-property property">totalStations</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>stationTotal <span class="token operator">||</span> <span class="token number">0</span> <span class="token comment">// 从allNum改为stationTotal</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      所有使用
      <code>
       totalStations
      </code>
      的地方自动使用新的数据来源
     </li>
    </ol>
    <h4>
     <a id="2_356">
     </a>
     场景2：添加新字段
    </h4>
    <p>
     <strong>
      需求
     </strong>
     ：添加一个新字段
     <code>
      estimatedArrivalTime
     </code>
     （预计到达时间）
    </p>
    <p>
     <strong>
      修改前需要的操作
     </strong>
     ：
    </p>
    <ol>
     <li>
      在handleQuery中添加字段
     </li>
     <li>
      在watch处理中添加字段
     </li>
     <li>
      在接口定义中添加字段
     </li>
    </ol>
    <p>
     <strong>
      修改后只需的操作
     </strong>
     ：
    </p>
    <ol>
     <li>
      在
      <code>
       processPathData
      </code>
      函数中添加：
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...其他字段</span>
    <span class="token literal-property property">estimatedArrivalTime</span><span class="token operator">:</span> rawPath<span class="token punctuation">.</span>estimatedArrivalTime <span class="token operator">||</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      在
      <code>
       PathResult
      </code>
      接口中添加：
     </li>
    </ol>
    <pre><code class="prism language-typescript"><span class="token keyword">interface</span> <span class="token class-name">PathResult</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...其他字段</span>
    estimatedArrivalTime<span class="token operator">?</span><span class="token operator">:</span> Date <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="3_381">
     </a>
     场景3：修改线路名称格式
    </h4>
    <p>
     <strong>
      需求
     </strong>
     ：将线路名称格式从"X号线"改为"Line X"
    </p>
    <p>
     <strong>
      修改前需要的操作
     </strong>
     ：
    </p>
    <ol>
     <li>
      搜索所有创建lineName的地方（至少6处）
     </li>
     <li>
      修改每个地方的格式转换逻辑
     </li>
    </ol>
    <p>
     <strong>
      修改后只需的操作
     </strong>
     ：
    </p>
    <ol>
     <li>
      只需修改
      <code>
       createStationData
      </code>
      函数：
     </li>
    </ol>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">createStationData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> stationType<span class="token punctuation">,</span> stationName<span class="token punctuation">,</span> lineId<span class="token punctuation">,</span> stationNum <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    stationType<span class="token punctuation">,</span>
    stationName<span class="token punctuation">,</span>
    <span class="token literal-property property">lineName</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Line </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>lineId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 从"X号线"改为"Line X"</span>
    stationNum
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_400">
     </a>
     四、优化收益分析
    </h3>
    <h4>
     <a id="1__402">
     </a>
     1. 功能正确性提升
    </h4>
    <ul>
     <li>
      <strong>
       线路名称显示正确
      </strong>
      ：用户现在能看到正确的线路名称，提高了信息准确性
     </li>
     <li>
      <strong>
       数据一致性
      </strong>
      ：统一使用接口返回的
      <code>
       allNum
      </code>
      值，确保与后端数据一致
     </li>
    </ul>
    <h4>
     <a id="2__406">
     </a>
     2. 代码可维护性提升
    </h4>
    <ul>
     <li>
      <strong>
       集中的数据处理
      </strong>
      ：所有数据转换逻辑都集中在几个相关函数中
     </li>
     <li>
      <strong>
       单一修改点
      </strong>
      ：修改字段名或添加新字段只需在一处修改
     </li>
     <li>
      <strong>
       清晰的职责划分
      </strong>
      ：每个函数都有明确的职责和注释
     </li>
    </ul>
    <h4>
     <a id="3__411">
     </a>
     3. 开发效率提升
    </h4>
    <ul>
     <li>
      <strong>
       降低维护成本
      </strong>
      ：后续需求变更时，只需修改相应的处理函数
     </li>
     <li>
      <strong>
       减少错误风险
      </strong>
      ：标准化的数据处理减少了手动处理的错误可能性
     </li>
     <li>
      <strong>
       提高代码可读性
      </strong>
      ：函数命名和结构更加清晰，新开发者更容易理解
     </li>
    </ul>
    <h4>
     <a id="4__416">
     </a>
     4. 代码量对比
    </h4>
    <ul>
     <li>
      <strong>
       修改前
      </strong>
      ：数据处理逻辑约120行代码，分散在多处
     </li>
     <li>
      <strong>
       修改后
      </strong>
      ：数据处理逻辑约100行代码，集中在专门的函数中
     </li>
    </ul>
    <h3>
     <a id="_420">
     </a>
     五、潜在风险与影响面
    </h3>
    <h4>
     <a id="1__422">
     </a>
     1. 风险点
    </h4>
    <ul>
     <li>
      <strong>
       数据依赖性
      </strong>
      ：现在完全依赖接口返回的
      <code>
       allNum
      </code>
      值，如果接口不返回该字段，将显示为0
     </li>
     <li>
      <strong>
       渲染一致性
      </strong>
      ：如果其他组件直接使用
      <code>
       allNum
      </code>
      而非
      <code>
       totalStations
      </code>
      ，可能导致显示不一致
     </li>
    </ul>
    <h4>
     <a id="2__426">
     </a>
     2. 影响范围
    </h4>
    <ul>
     <li>
      <strong>
       直接影响
      </strong>
      ：
      <code>
       station-display.vue
      </code>
      组件中的路径显示
     </li>
     <li>
      <strong>
       间接影响
      </strong>
      ：任何依赖此组件输出数据的父组件
     </li>
     <li>
      <strong>
       用户影响
      </strong>
      ：用户将看到更准确的线路名称和站点信息
     </li>
    </ul>
    <h3>
     <a id="_431">
     </a>
     六、总结
    </h3>
    <p>
     此次优化通过两个关键改动点解决了显示问题并提高了代码质量：
    </p>
    <ol>
     <li>
      <strong>
       修正线路名称显示
      </strong>
      ：确保连接线显示正确的线路信息，提高了用户体验
     </li>
     <li>
      <strong>
       重构数据处理逻辑
      </strong>
      ：通过引入专门的数据处理函数，实现了"一处修改"原则
     </li>
    </ol>
    <p>
     通过前后代码对比，可以清晰地看到重构后的代码结构更加清晰、职责划分更加明确，维护成本显著降低。特别是在面对字段变更、数据格式调整等常见需求时，新的代码结构可以大大减少修改点，降低出错风险。
    </p>
    <p>
     虽然
     <code>
      createStationData
     </code>
     等辅助函数看起来很简单，但它们是整个数据处理架构的重要组成部分，为代码的长期维护奠定了基础。这种渐进式的重构方法在不影响现有功能的前提下，有效提升了代码质量，为后续的功能迭代和维护创造了更好的条件。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33373334323634372f:61727469636c652f64657461696c732f313436323038313535" class_="artid" style="display:none">
 </p>
</div>


