---
layout: post
title: "Android-浮动搜索框SearchManager"
date: 2021-05-26 21:21:37 +0800
description: "浮动搜索框的使用其实并不难，而是在于它的配置非常之繁琐，对于它的使用主要是方便开发者"
keywords: "searchmanager onnewintent"
categories: ['Android']
tags: ['无标签']
artid: "20553249"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=20553249
    alt: "Android-浮动搜索框SearchManager"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=20553249
featuredImagePreview: https://bing.ee123.net/img/rand?artid=20553249
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android---浮动搜索框（SearchManager）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     浮动搜索框的使用其实并不难，而是在于它的配置非常之繁琐，对于它的使用主要是方便开发者对于程序中有搜索业务时，更好的设计UI
    </p>
    <p>
     SearchManager具体使用步骤如下：
    </p>
    <p>
     （1）配置search bar的相关信息，新建一个位于res/xml下的一个searchable.xml的配置文件，如默认值、是否有搜索建议或者语音搜索。
    </p>
    <div class="cnblogs_code" style="width:727px; height:417px">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_7c01734f-1b07-4166-954e-c8bbed261f76" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif">
      <span class="cnblogs_code_collapse">
       代码
      </span>
      <div id="cnblogs_code_open_7c01734f-1b07-4166-954e-c8bbed261f76">
       <pre>   
   <div>
    
    <span style="color:#0000ff">&lt;</span>
    
    <span style="color:#800000">searchable </span>
    
    <span style="color:#ff0000">xmlns:android</span>
    
    <span style="color:#0000ff">=<a href="http://schemas.android.com/apk/res/android" rel="nofollow noopener noreferrer" target="_blank">http://schemas.android.com/apk/res/android</a></span>
   
   </div>
   
   <div>
    
    <span style="color:#0000ff"> </span>
    
    <span style="color:#ff0000">　　<span style="color:#0000ff">&lt;!-- label为搜索框上方的文本，hint搜索框里面的提示文本，显示label --&gt;</span>
    android:label</span>
    
    <span style="color:#0000ff">="@string/search_label"</span>
    
    <span style="color:#ff0000">
    android:hint</span>
    
    <span style="color:#0000ff">="@string/search_hint"</span>
    
    <span style="color:#ff0000"> 
    android:searchMode</span>
    
    <span style="color:#0000ff">="showSearchLabelAsBadge"</span>
    
    <span style="color:#ff0000">
    </span>
   
   </div>
   
   <div>
    
    <span style="color:#ff0000">　　<span style="color:#0000ff">&lt;!-- 语音搜索配置 --&gt;</span>
    android:voiceSearchMode</span>
    
    <span style="color:#0000ff">="showVoiceSearchButton|launchRecognizer"</span>
    
    <span style="color:#ff0000">
    android:voiceLanguageModel</span>
    
    <span style="color:#0000ff">="free_form"</span>
    
    <span style="color:#ff0000">
    android:voicePromptText</span>
    
    <span style="color:#0000ff">="@string/search_invoke"</span>
   
   </div>
   
   <div>
    
    <span style="color:#0000ff"> </span>
   
   </div>
   
   <div>
    
    <span style="color:#0000ff">    &lt;!-- 配置搜索建议，配置错误将不会显示，这里的searchSuggestAuthority的值必须是</span>
   
   </div>
   
   <div>
    
    <span style="color:#0000ff">    继承自<span style="font-family:Courier New; background-color:#f5f5f5">SearchRecentSuggestionsProvider的完整路径名</span> --&gt;</span>
   
   </div>
   
   <div>
    
    <span style="color:#0000ff"> </span>
    
    <span style="color:#ff0000">　　 android:searchSuggestAuthority</span>
    
    <span style="color:#0000ff">="<span style="font-family:Courier New; background-color:#f5f5f5">com.android.cbin.SearchSuggestionSampleProvider</span>"</span>
    
    <span style="color:#ff0000">
    android:searchSuggestSelection</span>
    
    <span style="color:#0000ff">=" ? "</span>
    
    <span style="color:#ff0000">
</span>
    
    <span style="color:#0000ff">/&gt;</span>
   
   </div></pre>
      </div>
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy">
        <a target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
        </a>
       </span>
      </div>
     </img>
    </div>
    <p>
     （2） manifest.xml配置，搜索结果处理的Activity将出现两种情况，一种是从其他Activity中的search bar打开一个Activtiy
    </p>
    <p>
     专门处理搜索结果，第二种是就在当前Activity就是处理结果的Activity，先介绍第一种配置：
    </p>
    <div class="cnblogs_code" style="width:712px; height:295px">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_ddddfcb4-ef1c-4267-b690-8125a15e3162" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif">
      <span class="cnblogs_code_collapse">
       代码
      </span>
      <div id="cnblogs_code_open_ddddfcb4-ef1c-4267-b690-8125a15e3162">
       <pre>   
   <div>
    
    <span style="color:#000000">    </span>
    
    <span style="color:#0000ff">&lt;</span>
    
    <span style="color:#800000">activity </span>
    
    <span style="color:#ff0000">android:name</span>
    
    <span style="color:#0000ff">="SearchResultActivity"</span>
    
    <span style="color:#0000ff">&gt;</span>
    
    <span style="color:#000000">
    
        </span>
    
    <span style="color:#0000ff">&lt;</span>
    
    <span style="color:#800000">intent-filter</span>
    
    <span style="color:#0000ff">&gt;</span>
    
    <span style="color:#000000">
            </span>
    
    <span style="color:#0000ff">&lt;</span>
    
    <span style="color:#800000">action </span>
    
    <span style="color:#ff0000">android:name</span>
    
    <span style="color:#0000ff">="android.intent.action.SEARCH"</span>
    
    <span style="color:#0000ff">&gt;&lt;/</span>
    
    <span style="color:#800000">action</span>
    
    <span style="color:#0000ff">&gt;</span>
    
    <span style="color:#000000">
        </span>
    
    <span style="color:#0000ff">&lt;/</span>
    
    <span style="color:#800000">intent-filter</span>
    
    <span style="color:#0000ff">&gt;</span>
   
   </div><span style="color:#0000ff"> </span><span style="color:#000000"></span>
   
   <div>
    
    　　　　　
   
   </div>
   
   <div>
    
    　　　　 &lt;!-- 指定上面的searchable.xml文件 --&gt;
   
   </div>
   
   <div>
    
    <span style="color:#0000ff"> </span>
    
    <span style="color:#ff0000">　　　<span style="color:#0000ff">&lt;</span><span style="color:#800000">meta-data </span><span style="color:#ff0000">android:resource</span><span style="color:#0000ff">="@xml/searchable"</span></span>
   
   </div>
   
   <div>
    
    <span style="color:#ff0000"><span style="color:#0000ff"> </span>　　　　　　　　 android:name</span>
    
    <span style="color:#0000ff">="android.app.searchable"</span>
    
    <span style="color:#0000ff">&gt;&lt;/</span>
    
    <span style="color:#800000">meta-data</span>
    
    <span style="color:#0000ff">&gt;</span>
    
    <span style="color:#000000">
</span>
    
    <span style="color:#000000">
    </span>
    
    <span style="color:#0000ff">&lt;/</span>
    
    <span style="color:#800000">activity</span>
    
    <span style="color:#0000ff">&gt;</span>
   
   </div></pre>
      </div>
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy">
        <a target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
        </a>
       </span>
      </div>
     </img>
    </div>
    <p>
    </p>
    <div class="cnblogs_code">
     <pre>&lt;!-- 为了使每一个Activity都能使用search bar,一定要将这个标签放到启动Activity中，里面的<span style="color:#ff0000">value</span>指定</pre>
     <pre> 的是前面的搜索结果Activity--&gt;</pre>
     <pre><span style="color:#000000"> </span><span style="color:#0000ff">&lt;</span><span style="color:#800000">meta-data </span><span style="color:#ff0000">android:name</span><span style="color:#0000ff">="android.app.default_searchable"</span><span style="color:#ff0000">
                       android:value</span><span style="color:#0000ff">=".SearchResultActivity"</span><span style="color:#ff0000"> </span><span style="color:#0000ff">/&gt;</span></pre>
    </div>
    <p>
     （3）搜索建议在manifest.xml中相关的配置
    </p>
    <div class="cnblogs_code">
     <pre>  
  <div>
   
   <span style="color:#000000">&lt;!--之前searchable.xml中有一个<span style="color:#ff0000">searchSuggestAuthority</span>的值其实和这里的</span>
  
  </div>
  
  <div>
   
   <span style="color:#ff0000">authorities</span>
   
   <span style="color:#000000">指向的</span>
   
   <span style="color:#000000">都是<span style="color:#ff0000">name</span>中所关联的SearchSuggestionSampleProvider，他是一个</span>
  
  </div>
  
  <div>
   
   <span style="color:#000000"><span style="font-family:Courier New; background-color:#f5f5f5">SearchRecentSuggestionsProvider的子类</span>--&gt;</span>
  
  </div>
  
  <div>
   
   <span style="color:#000000"> </span>
   
   <span style="color:#0000ff">&lt;</span>
   
   <span style="color:#800000">provider </span>
   
   <span style="color:#ff0000">android:name</span>
   
   <span style="color:#0000ff">="SearchSuggestionSampleProvider"</span>
  
  </div>
  
  <div>
   
   <span style="color:#0000ff"> </span>
   
   <span style="color:#ff0000"> android:authorities</span>
   
   <span style="color:#0000ff">="com.android.cbin.SearchSuggestionSampleProvider"</span>
   
   <span style="color:#0000ff">&gt;&lt;/</span>
   
   <span style="color:#800000">provider</span>
   
   <span style="color:#0000ff">&gt;</span>
  
  </div></pre>
    </div>
    <p>
    </p>
    <div>
     <span style="color:#ff0000">
      <span style="color:#000000">
       上面
      </span>
      authorities
     </span>
     <span style="color:#000000">
      指向的
     </span>
     <span style="color:#000000">
      都是
      <span style="color:#ff0000">
       name
      </span>
      中所关联的SearchSuggestionSampleProvider，他是一个
     </span>
    </div>
    <div>
     <span style="color:#000000">
      <span style="font-family:Courier New; background-color:#f5f5f5">
       SearchRecentSuggestionsProvider的子类
      </span>
     </span>
    </div>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_d51d9517-f581-4c6a-a10b-9beb14b90d02" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif">
      <span class="cnblogs_code_collapse">
       代码
      </span>
      <div id="cnblogs_code_open_d51d9517-f581-4c6a-a10b-9beb14b90d02">
       <pre>   
   <div>
    
    <span style="color:#0000ff">public</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">class</span>
    
    <span style="color:#000000"> SearchSuggestionSampleProvider </span>
    
    <span style="color:#0000ff">extends</span>
    
    <span style="color:#000000">
        SearchRecentSuggestionsProvider {

    </span>
    
    <span style="color:#0000ff">final</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">static</span>
    
    <span style="color:#000000"> String AUTHORITY</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">com.android.cbin.SearchSuggestionSampleProvider</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">;
    </span>
    
    <span style="color:#0000ff">final</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">static</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">int</span>
    
    <span style="color:#000000"> MODE</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">DATABASE_MODE_QUERIES;
    
    </span>
    
    <span style="color:#0000ff">public</span>
    
    <span style="color:#000000"> SearchSuggestionSampleProvider(){
        </span>
    
    <span style="color:#0000ff">super</span>
    
    <span style="color:#000000">();
        setupSuggestions(AUTHORITY, MODE);
    }
}</span>
   
   </div></pre>
      </div>
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy">
        <a target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
        </a>
       </span>
      </div>
     </img>
    </div>
    <p>
    </p>
    <p>
    </p>
    <p>
     （4）为了能够使用search bar 我们必须重写Activity的onSearchRequested的方法，在界面上启动一个search bar
    </p>
    <p>
     但是这个动作不会自动触发，必须通过一个按钮或者菜单的点击事件触发；
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_5c4f6dd6-f4ff-4af8-a9be-297dbbda3ea0" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif"/>
     <span class="cnblogs_code_collapse">
      代码
     </span>
     <div id="cnblogs_code_open_5c4f6dd6-f4ff-4af8-a9be-297dbbda3ea0">
      <pre>   
   <div>
    
    <span style="color:#000000">    @Override
    </span>
    
    <span style="color:#0000ff">public</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">boolean</span>
    
    <span style="color:#000000"> onSearchRequested(){
        
        String text</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">etdata.getText().toString();
        Bundle bundle</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#0000ff">new</span>
    
    <span style="color:#000000"> Bundle();
        bundle.putString(</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">data</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">, text);
        
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">打开浮动搜索框（第一个参数默认添加到搜索框的值）
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">bundle为传递的数据</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">        startSearch(</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">mm</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">, </span>
    
    <span style="color:#0000ff">false</span>
    
    <span style="color:#000000">, bundle, </span>
    
    <span style="color:#0000ff">false</span>
    
    <span style="color:#000000">);
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">这个地方一定要返回真 如果只是super.onSearchRequested方法</span>
    
    <span style="color:#008000">不但</span>
   
   </div>
   
   <div>
    
    <span style="color:#008000">　　　　 //onSearchRequested（搜索框默认值）无法添加到搜索框中,</span>
    
    <span style="color:#008000">bundle也无法传递出去</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">        </span>
    
    <span style="color:#0000ff">return</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">true</span>
    
    <span style="color:#000000">;
    }</span>
   
   </div></pre>
     </div>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
    </div>
    <p>
     （5）接收query和bundle、保存query值（即搜索建议的列表值）
    </p>
    <div class="cnblogs_code">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_81555c9f-4d20-4507-8d90-a4eab3a64875" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif"/>
     <span class="cnblogs_code_collapse">
      代码
     </span>
     <div id="cnblogs_code_open_81555c9f-4d20-4507-8d90-a4eab3a64875">
      <pre>   
   <div>
    
    <span style="color:#000000">    </span>
    
    <span style="color:#0000ff">public</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">void</span>
    
    <span style="color:#000000"> doSearchQuery(){
        </span>
    
    <span style="color:#0000ff">final</span>
    
    <span style="color:#000000"> Intent intent </span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000"> getIntent();
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">获得搜索框里值</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">        String query</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">intent.getStringExtra(SearchManager.QUERY);
        tvquery.setText(query);
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">保存搜索记录</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">        SearchRecentSuggestions suggestions</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#0000ff">new</span>
    
    <span style="color:#000000"> SearchRecentSuggestions(</span>
    
    <span style="color:#0000ff">this</span>
    
    <span style="color:#000000">,
                SearchSuggestionSampleProvider.AUTHORITY, SearchSuggestionSampleProvider.MODE);
        suggestions.saveRecentQuery(query, </span>
    
    <span style="color:#0000ff">null</span>
    
    <span style="color:#000000">);
        </span>
    
    <span style="color:#0000ff">if</span>
    
    <span style="color:#000000">(Intent.ACTION_SEARCH.equals(intent.getAction())){
            </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">获取传递的数据</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">            Bundle bundled</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">intent.getBundleExtra(SearchManager.APP_DATA);
            </span>
    
    <span style="color:#0000ff">if</span>
    
    <span style="color:#000000">(bundled</span>
    
    <span style="color:#000000">!=</span>
    
    <span style="color:#0000ff">null</span>
    
    <span style="color:#000000">){
                String ttdata</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">bundled.getString(</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">data</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">);
                tvdata.setText(ttdata);

            }</span>
    
    <span style="color:#0000ff">else</span>
    
    <span style="color:#000000">{
                tvdata.setText(</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">no data</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">);
            }
        }
    }</span>
   
   </div></pre>
     </div>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
    </div>
    <p>
     之前说到了处理结果的Activity将可能出现的两种情况的两种，现在就处理第二种状况，就是假如invoke search bar的
    </p>
    <p>
     Activity同时也是处理搜索结果的Activity，如果按照之前的方式处理则会出现一种情况，搜索一次就实例化一次Activity,当按返回
    </p>
    <p>
     键的时候会发现老是同一个Activity,其实为了使它只有一个实例化对象，只需简单的配置和代码就能实现
    </p>
    <p>
     第一:在处理搜索结果Activity的manifest.xml中添加android:launchMode="singleTop"属性
    </p>
    <p>
     第二:重写Activity的onNewIntent(Intent intent)
    </p>
    <div class="cnblogs_code" style="width:724px; height:543px">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_0e6e081f-c590-4442-bd70-f548103f0acf" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif" style=""/>
     <div class="cnblogs_code_hide" id="cnblogs_code_open_0e6e081f-c590-4442-bd70-f548103f0acf" style="display:block">
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy">
        <a target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
        </a>
       </span>
      </div>
      <pre>   
   <div>
    
    <span style="color:#000000">    @Override
    </span>
    
    <span style="color:#0000ff">public</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">void</span>
    
    <span style="color:#000000"> onNewIntent(Intent intent){
        </span>
    
    <span style="color:#0000ff">super</span>
    
    <span style="color:#000000">.onNewIntent(intent);
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">获得搜索框里值</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">        String query</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">intent.getStringExtra(SearchManager.QUERY);
        tvquery.setText(query);
        </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">保存搜索记录</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">        SearchRecentSuggestions suggestions</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#0000ff">new</span>
    
    <span style="color:#000000"> SearchRecentSuggestions(</span>
    
    <span style="color:#0000ff">this</span>
    
    <span style="color:#000000">,
                SearchSuggestionSampleProvider.AUTHORITY, SearchSuggestionSampleProvider.MODE);
        suggestions.saveRecentQuery(query, </span>
    
    <span style="color:#0000ff">null</span>
    
    <span style="color:#000000">);
        </span>
    
    <span style="color:#0000ff">if</span>
    
    <span style="color:#000000">(Intent.ACTION_SEARCH.equals(intent.getAction())){
            </span>
    
    <span style="color:#008000">//</span>
    
    <span style="color:#008000">获取传递的数据</span>
    
    <span style="color:#008000">
</span>
    
    <span style="color:#000000">            Bundle bundled</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">intent.getBundleExtra(SearchManager.APP_DATA);
            </span>
    
    <span style="color:#0000ff">if</span>
    
    <span style="color:#000000">(bundled</span>
    
    <span style="color:#000000">!=</span>
    
    <span style="color:#0000ff">null</span>
    
    <span style="color:#000000">){
                String ttdata</span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000">bundled.getString(</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">data</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">);
                tvdata.setText(ttdata);

            }</span>
    
    <span style="color:#0000ff">else</span>
    
    <span style="color:#000000">{
                tvdata.setText(</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">no data</span>
    
    <span style="color:#000000">"</span>
    
    <span style="color:#000000">);
            }
        }
    }</span>
   
   </div></pre>
      <div class="cnblogs_code_toolbar">
       <span class="cnblogs_code_copy">
        <a target="_blank" title="复制代码">
         <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
        </a>
       </span>
      </div>
     </div>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
    </div>
    <p>
     相关知识：上面讲到了将最近的搜索值添加到搜索建议中，但却没有提到如果清理搜索建议中的值，与保存相似，SearchRecentSuggestion对象提供了一个clearHistory()方法
    </p>
    <p>
    </p>
    <div class="cnblogs_code" style="width:712px; height:207px">
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
     <img alt="" class="code_img_opened" id="code_img_opened_20d9b3d1-2dd2-4c28-989a-07d566826d53" src="https://i-blog.csdnimg.cn/blog_migrate/81178cc93a2a3bb5048d90d76e7ec935.gif"/>
     <span class="cnblogs_code_collapse">
      代码
     </span>
     <div id="cnblogs_code_open_20d9b3d1-2dd2-4c28-989a-07d566826d53">
      <pre>   
   <div>
    
    <span style="color:#000000">    </span>
    
    <span style="color:#0000ff">private</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">void</span>
    
    <span style="color:#000000"> clearSearchHistory() {
        SearchRecentSuggestions suggestions </span>
    
    <span style="color:#000000">=</span>
    
    <span style="color:#000000"> </span>
    
    <span style="color:#0000ff">new</span>
    
    <span style="color:#000000"> SearchRecentSuggestions(</span>
    
    <span style="color:#0000ff">this</span>
    
    <span style="color:#000000">, 
                SearchSuggestionSampleProvider.AUTHORITY, SearchSuggestionSampleProvider.MODE);
        suggestions.clearHistory();
    }</span>
   
   </div></pre>
     </div>
     <div class="cnblogs_code_toolbar">
      <span class="cnblogs_code_copy">
       <a target="_blank" title="复制代码">
        <img alt="复制代码" src="https://i-blog.csdnimg.cn/blog_migrate/69c5a8ac3fa60e0848d784a6dd461da6.gif"/>
       </a>
      </span>
     </div>
    </div>
    <p>
     接下来的介绍更加详细一些：
    </p>
    <p>
     当您需要在您的应用程序中提供
     <span class="t_tag">
      搜索
     </span>
     服务时，您第一个想到的是您的搜索框要放哪呢？通过使用
     <span class="t_tag">
      Android
     </span>
     的搜索
     <span class="t_tag">
      框架
     </span>
     ，应用程序将显示一个自定义搜索对话框来处理用户的搜索请求。通过一个简单的搜索按钮或从您的应用程序中调用
     <span class="t_tag">
      API
     </span>
     ，搜索对话框就会显示在屏幕的顶部，并会自动显示您的应用程序图标。如下图所示：
     <br/>
     <br/>
     <img alt="如何使用Android的搜索框架_28091" src="http://www.pin5i.com/upload/2010/08/28/237/164536193112827.jpg" style=""/>
     <br/>
     <br/>
     本文将教你如何为你的应用程序提供一个自定义搜索对话框。这样做，给您的用户提供一个标准化的搜索体验，并能增加如语音搜索和搜索建议等功能。
     <br/>
     <br/>
     <span style="font-size:18px">
      <strong>
       基础知识
      </strong>
     </span>
     <br/>
     <br/>
     Android的搜索框架将代您管理的搜索对话框，您不需要自己去开发一个搜索框，不需要担心要把搜索框放什么位置，也不需要担心搜索框影响您当前的界面。所有的这些工作都由SearchManager类来为您处理（以下简称“搜索管理器”），它管理的Android搜索对话框的整个生命周期，并执行您的应用程序将发送的搜索请求，返回相应的搜索关键字。
     <br/>
     <br/>
     当用户执行一个搜索，搜索管理器将使用一个专门的Intent把搜索查询的关键字传给您在
     <span class="t_tag">
      配置
     </span>
     文件中配置的处理搜索结果的Activity。从本质上讲，所有你需要的就是一个Activity来接收Intent，然后执行搜索，并给出结果。具体来说，你需要的做的事就包括以下内容：
     <br/>
     <br/>
     <strong>
      一个搜索配置
     </strong>
     <br/>
     我们用个XML配置文件来对搜索对话框进行配置，包括一些功能的配置，如文本框，设置语音搜索和搜索建议中显示的提示文字等。
     <br/>
     <br/>
     <strong>
      一个用来处理搜索请求的Activity
     </strong>
     <br/>
     这个Activity用来接收搜索查询的内容，然后搜索您的数据并显示搜索结果。
     <br/>
     <br/>
     <strong>
      一种用户执行搜索的途径
     </strong>
     <br/>
     默认情况下，一旦你配置了一个可搜索的Activity，设备搜索键（如果有）将调用搜索对话框。然而，你应该始终提供另一种手段，让用户可以调用搜索对话框，如在选项
     <span class="t_tag">
      菜单
     </span>
     中的搜索按钮或其他用户界面上的按钮，因为不是所有的设备提供一个专门的搜索键。
    </p>
    <p>
     <br/>
    </p>
    <p>
     <span style="font-size:18px">
      <strong>
       创建一个搜索对话框配置文件
      </strong>
     </span>
     <br/>
     <br/>
     搜索框配置文件是一个用来配置您的应用程序中搜索框的设置的XML文件，这个文件一般命名为searchable.xml，并且必须保存在项目的res/xml/目录下。
     <br/>
     <br/>
     配置文件的根节点必须为，可以有一个或多个属性。如下所示：
    </p>
    <div class="blockcode">
     <div id="code70348_-1">
      <ol>
       <li>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        <br/>
       </li>
       <li>
        &lt;searchable xmlns:android="http://schemas.android.com/apk/res/android"
        <br/>
       </li>
       <li>
        android:label="@string/searchLabel" android:hint="@string/searchHint"&gt;
        <br/>
       </li>
       <li>
        &lt;/searchable&gt;
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    上面的配置文件中，除android:hint属性外，其它都是一个搜索对话框必须的配置项，android:label是一个必须的属性，它的值为一个string资源引用，不能直接用字符串，通常会是应用程序的名称（尽管它是一个必须的属性，但通常情况下是不显示出来的，除非你开启了搜索建议功能）。android:hint是配置搜索框的输入提示信息，也必须引用string.xml中配置的字符串资源，不能直接使用字符串。
    <br/>
    <br/>
    可以配置很多的属性，但大部分属性都只是在使用搜索建议和语音搜索时进行配置，尽管如此，我们建议你一定要配置android:hint,用于提示用户需要输入的信息。
    <br/>
    <br/>
    接下来，你需要把这个配置文件放到你的应用程序中。
    <br/>
    <br/>
    <span style="font-size:18px">
     <strong>
      创建一个可用于搜索的Activity
     </strong>
    </span>
    <br/>
    <br/>
    当用户从一个搜索框执行搜索时，搜索管理器（Search Manager）会通过ACTION_SEARCH Intent 把要搜索的内容（关键字）发送到一个可执行搜索的Activity。这个Acitivity查询数据并显示结果。
    <br/>
    <br/>
    <strong>
     定义一个可搜索的Activity
    </strong>
    <br/>
    <br/>
    如果你还没有准备好，那么就创建一个用来执行搜索的Activity，声明它可以响应ACTION_SEARCH Intent ，并且增加搜索框配置信息。为此，你需要添加一个元素和一个元素在你的manifest文件中的节点。如下所示：
    <div class="blockcode">
     <div id="code70348_0">
      <ol>
       <li>
        &lt;application ... &gt;
        <br/>
       </li>
       <li>
        &lt;activity android:name=".MySearchableActivity" &gt;
        <br/>
       </li>
       <li>
        &lt;intent-filter&gt;
        <br/>
       </li>
       <li>
        &lt;action android:name="android.intent.action.SEARCH" /&gt;
        <br/>
       </li>
       <li>
        &lt;/intent-filter&gt;
        <br/>
       </li>
       <li>
        &lt;meta-data android:name="android.app.searchable"
        <br/>
       </li>
       <li>
        android:resource="@xml/searchable"/&gt;
        <br/>
       </li>
       <li>
        &lt;/activity&gt;
        <br/>
       </li>
       <li>
        ...
        <br/>
       </li>
       <li>
        &lt;/application&gt;
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    中的android:name属性值必须为”android.app.searchable”，android:resource属性值必须引用上面提到的res/xml/目录下的搜索配置文件（本例中的res/xml/searchable.xml）。
    <br/>
    <br/>
    请注意，只有配置了上面的meta-data节点的Activity的节点才能执行搜索，如果想在整个应用程序中都可以调用搜索框，可以进行如下配置：
    <div class="blockcode">
     <div id="code70348_1">
      <ol>
       <li>
        &lt;application ... &gt;
        <br/>
       </li>
       <li>
        &lt;activity android:name=".MySearchableActivity" &gt;
        <br/>
       </li>
       <li>
        &lt;intent-filter&gt;
        <br/>
       </li>
       <li>
        &lt;action android:name="android.intent.action.SEARCH" /&gt;
        <br/>
       </li>
       <li>
        &lt;/intent-filter&gt;
        <br/>
       </li>
       <li>
        &lt;meta-data android:name="android.app.searchable"
        <br/>
       </li>
       <li>
        android:resource="@xml/searchable"/&gt;
        <br/>
       </li>
       <li>
        &lt;/activity&gt;
        <br/>
       </li>
       <li>
        &lt;activity android:name=".AnotherActivity" ... &gt;
        <br/>
       </li>
       <li>
        &lt;/activity&gt;
        <br/>
       </li>
       <li>
        &lt;!—这个配置就可以让你在整个应用程序中调用搜索框 --&gt;
        <br/>
       </li>
       <li>
        &lt;meta-data android:name="android.app.default_searchable"
        <br/>
       </li>
       <li>
        android:value=".MySearchableActivity" /&gt;
        <br/>
       </li>
       <li>
        ...
        <br/>
       </li>
       <li>
        &lt;/application&gt;
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    上面代码中android:name=”android.app.default_searchable” 定义一个响应搜索框搜索请求的名称，android:value指定是由哪个Activity响应并执行搜索。当我们在应用程序中的 OtherAcitivity中执行搜索请求时，MySearchableActivity将会被加载用于执行搜索并显示搜索结果。
    <p>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <span style="font-size:18px">
      <strong>
       执行一个搜索
      </strong>
     </span>
     <br/>
     <br/>
     当一个Activity声明为可搜索时，执行实际的搜索包括三个步骤：接收查询，检索你的数据，并提交结果。
     <br/>
     <br/>
     通常情况下，你的搜索结果需要在一个ListView中展现，所以你用于执行搜索的Acitivity要继承ListActivity，这样，可以方便的访问ListView的Api。
     <br/>
     <br/>
     <strong>
      接收搜索查询
     </strong>
     <br/>
     <br/>
     当从搜索对话框执行搜索时，刚才配置的可用于搜索的Acitivity将会被Intent激活，同时带着一些搜索相关的参数，你需要检查Intent并做出搜索响应，如下所示：
    </p>
    <div class="blockcode">
     <div id="code70349_-1">
      <ol>
       <li>
        @Override
        <br/>
       </li>
       <li>
        public void onCreate(Bundle savedInstanceState) {
        <!-- -->
        <br/>
       </li>
       <li>
        super.onCreate(savedInstanceState);
        <br/>
       </li>
       <li>
        setContentView(R.layout.search);
        <br/>
       </li>
       <li>
        <br/>
       </li>
       <li>
        Intent intent = getIntent();
        <br/>
       </li>
       <li>
        //判断是否是搜索请求
        <br/>
       </li>
       <li>
        if (Intent.ACTION_SEARCH.equals(intent.getAction())) {
        <!-- -->
        <br/>
       </li>
       <li>
        //获取搜索的查询内容（关键字）
        <br/>
       </li>
       <li>
        String query = intent.getStringExtra(SearchManager.QUERY);
        <br/>
       </li>
       <li>
        //执行相应的查询动作
        <br/>
       </li>
       <li>
        doMySearch(query);
        <br/>
       </li>
       <li>
        }
        <br/>
       </li>
       <li>
        }
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    doMySearch()方法将根据关键字查询数据库，或从网络上查询数据，如果是耗时的搜索，你还需要使用进度条，来告诉用户搜索正在进行，最后返回结果后，可以调用ListView的setAdapter()方法将结果显示在ListView中。
    <br/>
    <br/>
    <strong>
     调用搜索对话框
    </strong>
    <br/>
    <br/>
    你可以从应用程序中的任何一个地方调用onSearchRequested()方法激活搜索框，比如从菜单中或者一个按钮等。你也要以在 onCreate()方法中调用setDefaultKeyMode(DEFAULT_KEYS_SEARCH_LOCAL)，这样，当用户按下键盘上的按键时，将会自动激活搜索框。
    <br/>
    <br/>
    搜索框和普通对话框一样，浮动在屏幕的最上方，它不会改变任何Activity堆栈状态，没有任何Activity生命周期中的方法会被调用，只是当搜索框出现就，正在运行的Activity会失去输入焦点。
    <br/>
    <br/>
    如果你要在执行搜索时，进行别的操作，可以重写onSearchRequested()方法，如下所示：
    <div class="blockcode">
     <div id="code70349_0">
      <ol>
       <li>
        @Override
        <br/>
       </li>
       <li>
        public boolean onSearchRequested() {
        <!-- -->
        <br/>
       </li>
       <li>
        //这个方法中干你想干的事，比如做一些被始化工作
        <br/>
       </li>
       <li>
        pauseSomeStuff();
        <br/>
       </li>
       <li>
        return super.onSearchRequested();
        <br/>
       </li>
       <li>
        }
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    如果当前的Activity就是响应搜索请求的Activity时，会有以下两种情况：
    <br/>
    <br/>
    默认情况下，ACTION_SEARCH Intent将会创建一个新的Activity，并调用onCreate()方法，这个新的Activity会显示在最前面，你将同时有两个 Activity实例。当你按“返回”键里，会回到没有执行搜索前的一个Activity。
    <br/>
    <br/>
    另一种情况是配置了android:launchMode=”singleTop”的Activity，这时，我们需要在 onNewIntent(Intent)方法中处理搜索请求，如下所示：
    <ol>
     <li>
      @Override
      <br/>
     </li>
     <li>
      public void onCreate(Bundle savedInstanceState) {
      <!-- -->
      <br/>
     </li>
     <li>
      super.onCreate(savedInstanceState);
      <br/>
     </li>
     <li>
      setContentView(R.layout.search);
      <br/>
     </li>
     <li>
      handleIntent(getIntent());
      <br/>
     </li>
     <li>
      }
      <br/>
     </li>
     <li>
      <br/>
     </li>
     <li>
      @Override
      <br/>
     </li>
     <li>
      protected void onNewIntent(Intent intent) {
      <!-- -->
      <br/>
     </li>
     <li>
      setIntent(intent);
      <br/>
     </li>
     <li>
      handleIntent(intent);
      <br/>
     </li>
     <li>
      }
      <br/>
     </li>
     <li>
      <br/>
     </li>
     <li>
      private void handleIntent(Intent intent) {
      <!-- -->
      <br/>
     </li>
     <li>
      if (Intent.ACTION_SEARCH.equals(intent.getAction())) {
      <!-- -->
      <br/>
     </li>
     <li>
      String query = intent.getStringExtra(SearchManager.QUERY);
      <br/>
     </li>
     <li>
      doMySearch(query);
      <br/>
     </li>
     <li>
      }
      <br/>
     </li>
     <li>
      }
     </li>
    </ol>
    <p>
    </p>
    <p>
     <br/>
    </p>
    <p>
     相应的Activity配置如下
    </p>
    <div class="blockcode">
     <div id="code70350_-1">
      <ol>
       <li>
        &lt;activity android:name=".MySearchableActivity"
        <br/>
       </li>
       <li>
        android:launchMode="singleTop" &gt;
        <br/>
       </li>
       <li>
        &lt;intent-filter&gt;
        <br/>
       </li>
       <li>
        &lt;action android:name="android.intent.action.SEARCH" /&gt;
        <br/>
       </li>
       <li>
        &lt;/intent-filter&gt;
        <br/>
       </li>
       <li>
        &lt;meta-data android:name="android.app.searchable"
        <br/>
       </li>
       <li>
        android:resource="@xml/searchable"/&gt;
        <br/>
       </li>
       <li>
        &lt;/activity&gt;
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    <span style="font-size:18px">
     <strong>
      如何给搜索框增加参数
     </strong>
    </span>
    <br/>
    <br/>
    要给搜索框传递参数，我们需要重写onSearchRequested()方法，如下所示：
    <div class="blockcode">
     <div id="code70350_0">
      <ol>
       <li>
        @Override
        <br/>
       </li>
       <li>
        public boolean onSearchRequested() {
        <!-- -->
        <br/>
       </li>
       <li>
        Bundle appData = new Bundle();
        <br/>
       </li>
       <li>
        appData.putBoolean(MySearchableActivity.JARGON, true);
        <br/>
       </li>
       <li>
        startSearch(null, false, appData, false);
        <br/>
       </li>
       <li>
        return true;
        <br/>
       </li>
       <li>
        }
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    我们的Activity在收到搜索框的搜索请求时，通过如下方法获取参数：
    <div class="blockcode">
     <div id="code70350_1">
      <ol>
       <li>
        Bundle appData = getIntent().getBundleExtra(SearchManager.APP_DATA);
        <br/>
       </li>
       <li>
        if (appData != null) {
        <!-- -->
        <br/>
       </li>
       <li>
        boolean jargon = appData.getBoolean(MySearchableActivity.JARGON);
        <br/>
       </li>
       <li>
        }
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    <strong>
     最后我们来看看如何使用android的语音搜索：
    </strong>
    <br/>
    <br/>
    只需要对我们的搜索配置文件做如下改动，你的搜索就支持语音搜索了，配置文件如下所示：
    <div class="blockcode">
     <div id="code70350_2">
      <ol>
       <li>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        <br/>
       </li>
       <li>
        &lt;searchable xmlns:android="http://schemas.android.com/apk/res/android"
        <br/>
       </li>
       <li>
        android:label="@string/searchLabel"
        <br/>
       </li>
       <li>
        android:hint="@string/searchHint"
        <br/>
       </li>
       <li>
        android:voiceSearchMode="showVoiceSearchButton|launchRecognizer"&gt;
        <br/>
       </li>
       <li>
        &lt;/searchable&gt;
        <br/>
       </li>
      </ol>
     </div>
     <em>
      复制代码
     </em>
    </div>
    好了，今天就到这儿，自己动手练习去吧！以后还会详细讲解如何增加搜索建议，语音搜索等内容。
    <br/>
    <br/>
    <strong>
     关于搜索建议的智能提示
    </strong>
    <br/>
    <br/>
    可参考：
    <a href="http://www.ideasandroid.com/android/sdk/docs/guide/topics/search/adding-custom-suggestions.html" rel="nofollow noopener noreferrer" target="_blank">
     Adding Custom Suggestions
    </a>
    <br/>
    <img alt="_28093" src="http://www.pin5i.com/upload/2010/08/28/237/164564249327228.png" style=""/>
    <p>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
    <p>
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f6f707a6f6f6e7a68757a68656e676b65:2f61727469636c652f64657461696c732f3230353533323439" class_="artid" style="display:none">
 </p>
</div>


