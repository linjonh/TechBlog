---
layout: post
title: "每周一篇PLGPromtailLokiGrafana轻量日志方案"
date: 2025-03-10 10:25:16 +0800
description: "PLG完整部署方案，Loki-Grafana已改好报表可抄"
keywords: "每周一篇——PLG(Promtail+Loki+Grafana)轻量日志方案"
categories: ['未分类']
tags: ['Promtail', 'Plg', 'Loki', 'Grafana']
artid: "145782904"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145782904
    alt: "每周一篇PLGPromtailLokiGrafana轻量日志方案"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145782904
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145782904
cover: https://bing.ee123.net/img/rand?artid=145782904
image: https://bing.ee123.net/img/rand?artid=145782904
img: https://bing.ee123.net/img/rand?artid=145782904
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     每周一篇——PLG(Promtail+Loki+Grafana)轻量日志方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="PLGPromtailGrafana_0">
     </a>
     每周一篇——PLG轻量日志方案（Promtail+Grafana已改好可抄）
    </h3>
    <table>
     <thead>
      <tr>
       <th>
       </th>
       <th>
       </th>
       <th>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         组件
        </strong>
       </td>
       <td>
        <strong>
         作用
        </strong>
       </td>
       <td>
        <strong>
         备注
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        Loki
       </td>
       <td>
        日志存储
       </td>
       <td>
        替代ES - 全文搜索会比ES慢 - CPU、内存、存储开销会比ES小
       </td>
      </tr>
      <tr>
       <td>
        Promtail
       </td>
       <td>
        收集日志agent
       </td>
       <td>
        替代filebeat
       </td>
      </tr>
      <tr>
       <td>
        Grafana
       </td>
       <td>
        日志查询
       </td>
       <td>
        替代Kibana
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4191f7fd63b54669905e9711c86abe63.png"/>
    </p>
    <h2>
     <a id="Loki_httpsiblogcsdnimgcndirect98a2a9f7e1ee4818b2e091cf39334535pnghttpsiblogcsdnimgcndirect9e4856c290c94d6b9505c589ef46bf48png_10">
     </a>
     Loki 存储结构
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/98a2a9f7e1ee4818b2e091cf39334535.png">
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9e4856c290c94d6b9505c589ef46bf48.png"/>
     </img>
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b829d95a65da4ea4b730933a6a37cce9.png"/>
    </p>
    <h2>
     <a id="Grafana_13">
     </a>
     Grafana展示
    </h2>
    <p>
     id: 16970，基于这个进行二次开发
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"annotations"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"list"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"builtIn"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"datasource"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"grafana"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"enable"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"iconColor"</span><span class="token builtin class-name">:</span> <span class="token string">"rgba(0, 211, 255, 1)"</span>,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Annotations &amp; Alerts"</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"dashboard"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"Container/Pod Log Quick Search(Loki as DataSource)"</span>,
  <span class="token string">"editable"</span><span class="token builtin class-name">:</span> true,
  <span class="token string">"fiscalYearStartMonth"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"gnetId"</span><span class="token builtin class-name">:</span> <span class="token number">16970</span>,
  <span class="token string">"graphTooltip"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">38</span>,
  <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
  <span class="token string">"liveNow"</span><span class="token builtin class-name">:</span> false,
  <span class="token string">"panels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
        <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"fieldConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"defaults"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"color"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"palette-classic"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"custom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"axisCenteredZero"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"axisColorMode"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,
            <span class="token string">"axisLabel"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"axisPlacement"</span><span class="token builtin class-name">:</span> <span class="token string">"left"</span>,
            <span class="token string">"barAlignment"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"drawStyle"</span><span class="token builtin class-name">:</span> <span class="token string">"bars"</span>,
            <span class="token string">"fillOpacity"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>,
            <span class="token string">"gradientMode"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>,
            <span class="token string">"hideFrom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"legend"</span><span class="token builtin class-name">:</span> false,
              <span class="token string">"tooltip"</span><span class="token builtin class-name">:</span> false,
              <span class="token string">"viz"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"insertNulls"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"lineInterpolation"</span><span class="token builtin class-name">:</span> <span class="token string">"linear"</span>,
            <span class="token string">"lineWidth"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
            <span class="token string">"pointSize"</span><span class="token builtin class-name">:</span> <span class="token number">5</span>,
            <span class="token string">"scaleDistribution"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"linear"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"showPoints"</span><span class="token builtin class-name">:</span> <span class="token string">"never"</span>,
            <span class="token string">"spanNulls"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"stacking"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"group"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>,
              <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"thresholdsStyle"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"off"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
          <span class="token string">"mappings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
          <span class="token string">"thresholds"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"absolute"</span>,
            <span class="token string">"steps"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{<!-- --></span>
                <span class="token string">"color"</span><span class="token builtin class-name">:</span> <span class="token string">"green"</span>,
                <span class="token string">"value"</span><span class="token builtin class-name">:</span> null
              <span class="token punctuation">}</span>,
              <span class="token punctuation">{<!-- --></span>
                <span class="token string">"color"</span><span class="token builtin class-name">:</span> <span class="token string">"red"</span>,
                <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">80</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"unit"</span><span class="token builtin class-name">:</span> <span class="token string">"short"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"overrides"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"gridPos"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"h"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">"w"</span><span class="token builtin class-name">:</span> <span class="token number">24</span>,
        <span class="token string">"x"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"y"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
      <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"legend"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"calcs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
          <span class="token string">"displayMode"</span><span class="token builtin class-name">:</span> <span class="token string">"list"</span>,
          <span class="token string">"placement"</span><span class="token builtin class-name">:</span> <span class="token string">"bottom"</span>,
          <span class="token string">"showLegend"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"tooltip"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"multi"</span>,
          <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"pluginVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"10.1.5"</span>,
      <span class="token string">"targets"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
            <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"editorMode"</span><span class="token builtin class-name">:</span> <span class="token string">"code"</span>,
          <span class="token string">"expr"</span><span class="token builtin class-name">:</span> <span class="token string">"sum(count_over_time({namespace=<span class="token entity" title='\"'>\"</span><span class="token variable">$namespace</span><span class="token entity" title='\"'>\"</span>, pod=~<span class="token entity" title='\"'>\"</span><span class="token variable">$pod</span><span class="token entity" title='\"'>\"</span>} |= <span class="token entity" title='\"'>\"</span><span class="token variable">$searchable_pattern</span><span class="token entity" title='\"'>\"</span> [<span class="token variable">$__interval</span>]))"</span>,
          <span class="token string">"legendFormat"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
          <span class="token string">"queryType"</span><span class="token builtin class-name">:</span> <span class="token string">"range"</span>,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"transparent"</span><span class="token builtin class-name">:</span> true,
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"timeseries"</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>,
      <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
      <span class="token string">"gridPos"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"h"</span><span class="token builtin class-name">:</span> <span class="token number">24</span>,
        <span class="token string">"w"</span><span class="token builtin class-name">:</span> <span class="token number">24</span>,
        <span class="token string">"x"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"y"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
      <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"dedupStrategy"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>,
        <span class="token string">"enableLogDetails"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"prettifyLogMessage"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"showCommonLabels"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"showLabels"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"showTime"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"sortOrder"</span><span class="token builtin class-name">:</span> <span class="token string">"Descending"</span>,
        <span class="token string">"wrapLogMessage"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"targets"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"0"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"1"</span><span class="token builtin class-name">:</span> <span class="token string">"0"</span>,
            <span class="token string">"2"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"3"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"4"</span><span class="token builtin class-name">:</span> <span class="token string">"7"</span>,
            <span class="token string">"5"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"6"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"7"</span><span class="token builtin class-name">:</span> <span class="token string">"8"</span>,
            <span class="token string">"8"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"9"</span><span class="token builtin class-name">:</span> <span class="token string">"8"</span>,
            <span class="token string">"10"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>,
            <span class="token string">"11"</span><span class="token builtin class-name">:</span> <span class="token string">"b"</span>,
            <span class="token string">"12"</span><span class="token builtin class-name">:</span> <span class="token string">"9"</span>,
            <span class="token string">"13"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"14"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"15"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"16"</span><span class="token builtin class-name">:</span> <span class="token string">"f"</span>,
            <span class="token string">"17"</span><span class="token builtin class-name">:</span> <span class="token string">"f"</span>,
            <span class="token string">"18"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"19"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"20"</span><span class="token builtin class-name">:</span> <span class="token string">"0"</span>,
            <span class="token string">"21"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"22"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"23"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"24"</span><span class="token builtin class-name">:</span> <span class="token string">"c"</span>,
            <span class="token string">"25"</span><span class="token builtin class-name">:</span> <span class="token string">"1"</span>,
            <span class="token string">"26"</span><span class="token builtin class-name">:</span> <span class="token string">"5"</span>,
            <span class="token string">"27"</span><span class="token builtin class-name">:</span> <span class="token string">"2"</span>,
            <span class="token string">"28"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"29"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>,
            <span class="token string">"30"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"31"</span><span class="token builtin class-name">:</span> <span class="token string">"2"</span>,
            <span class="token string">"32"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"33"</span><span class="token builtin class-name">:</span> <span class="token string">"f"</span>,
            <span class="token string">"34"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>,
            <span class="token string">"35"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"expr"</span><span class="token builtin class-name">:</span> <span class="token string">"{namespace=<span class="token entity" title='\"'>\"</span><span class="token variable">$namespace</span><span class="token entity" title='\"'>\"</span>, pod=~<span class="token entity" title='\"'>\"</span><span class="token variable">$pod</span><span class="token entity" title='\"'>\"</span>} |~ <span class="token entity" title='\"'>\"</span>(?i)<span class="token variable">$searchable_pattern</span><span class="token entity" title='\"'>\"</span> "</span>,
          <span class="token string">"hide"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"Search Result"</span>,
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"logs"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token string">"1m"</span>,
  <span class="token string">"schemaVersion"</span><span class="token builtin class-name">:</span> <span class="token number">38</span>,
  <span class="token string">"style"</span><span class="token builtin class-name">:</span> <span class="token string">"dark"</span>,
  <span class="token string">"tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">"Loki"</span>,
    <span class="token string">"logging"</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"templating"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"list"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"allValue"</span><span class="token builtin class-name">:</span> <span class="token string">".*"</span>,
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"fogcloud"</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"fogcloud"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"definition"</span><span class="token builtin class-name">:</span> <span class="token string">"label_values({namespace=~<span class="token entity" title='\"'>\"</span>.+<span class="token entity" title='\"'>\"</span>}, namespace)"</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"includeAll"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"Namespace"</span>,
        <span class="token string">"multi"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"namespace"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"label_values({namespace=~<span class="token entity" title='\"'>\"</span>.+<span class="token entity" title='\"'>\"</span>}, namespace)"</span>,
        <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
        <span class="token string">"regex"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"tagValuesQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"tagsQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"query"</span>,
        <span class="token string">"useTags"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"allValue"</span><span class="token builtin class-name">:</span> <span class="token string">".*"</span>,
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"All"</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"<span class="token variable">$__all</span>"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"definition"</span><span class="token builtin class-name">:</span> <span class="token string">"label_values({namespace=<span class="token entity" title='\"'>\"</span><span class="token variable">$namespace</span><span class="token entity" title='\"'>\"</span>}, pod)"</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"includeAll"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"Pod"</span>,
        <span class="token string">"multi"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"pod"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"label_values({namespace=<span class="token entity" title='\"'>\"</span><span class="token variable">$namespace</span><span class="token entity" title='\"'>\"</span>}, pod)"</span>,
        <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
        <span class="token string">"regex"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"tagValuesQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"tagsQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"query"</span>,
        <span class="token string">"useTags"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> true,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"Search (case insensitive)"</span>,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"searchable_pattern"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string">"selected"</span><span class="token builtin class-name">:</span> true,
            <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"textbox"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"time"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token string">"now-1h"</span>,
    <span class="token string">"to"</span><span class="token builtin class-name">:</span> <span class="token string">"now"</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"timepicker"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"refresh_intervals"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token string">"5s"</span>,
      <span class="token string">"10s"</span>,
      <span class="token string">"30s"</span>,
      <span class="token string">"1m"</span>,
      <span class="token string">"5m"</span>,
      <span class="token string">"15m"</span>,
      <span class="token string">"30m"</span>,
      <span class="token string">"1h"</span>,
      <span class="token string">"2h"</span>,
      <span class="token string">"1d"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"timezone"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
  <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"K8s-应用日志"</span>,
  <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"7ecZpUkRk"</span>,
  <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token number">7</span>,
  <span class="token string">"weekStart"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="K8s_322">
     </a>
     K8s报表
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/91b18bf61405490cbed33bb413ad9fea.png"/>
    </p>
    <h3>
     <a id="Linuxhttpsiblogcsdnimgcndirect1e1cbab46aa24a638aebd703ca160595png_324">
     </a>
     Linux报表
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1e1cbab46aa24a638aebd703ca160595.png"/>
    </h3>
    <pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"annotations"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"list"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"builtIn"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"datasource"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"grafana"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"enable"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"iconColor"</span><span class="token builtin class-name">:</span> <span class="token string">"rgba(0, 211, 255, 1)"</span>,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Annotations &amp; Alerts"</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"dashboard"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"Container/Pod Log Quick Search(Loki as DataSource)"</span>,
  <span class="token string">"editable"</span><span class="token builtin class-name">:</span> true,
  <span class="token string">"fiscalYearStartMonth"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"gnetId"</span><span class="token builtin class-name">:</span> <span class="token number">16970</span>,
  <span class="token string">"graphTooltip"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">40</span>,
  <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
  <span class="token string">"liveNow"</span><span class="token builtin class-name">:</span> false,
  <span class="token string">"panels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
        <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"fieldConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"defaults"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"color"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"palette-classic"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"custom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"axisCenteredZero"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"axisColorMode"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,
            <span class="token string">"axisLabel"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"axisPlacement"</span><span class="token builtin class-name">:</span> <span class="token string">"left"</span>,
            <span class="token string">"barAlignment"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"drawStyle"</span><span class="token builtin class-name">:</span> <span class="token string">"bars"</span>,
            <span class="token string">"fillOpacity"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>,
            <span class="token string">"gradientMode"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>,
            <span class="token string">"hideFrom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"legend"</span><span class="token builtin class-name">:</span> false,
              <span class="token string">"tooltip"</span><span class="token builtin class-name">:</span> false,
              <span class="token string">"viz"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"insertNulls"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"lineInterpolation"</span><span class="token builtin class-name">:</span> <span class="token string">"linear"</span>,
            <span class="token string">"lineWidth"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
            <span class="token string">"pointSize"</span><span class="token builtin class-name">:</span> <span class="token number">5</span>,
            <span class="token string">"scaleDistribution"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"linear"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"showPoints"</span><span class="token builtin class-name">:</span> <span class="token string">"never"</span>,
            <span class="token string">"spanNulls"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"stacking"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"group"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>,
              <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"thresholdsStyle"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"off"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
          <span class="token string">"mappings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
          <span class="token string">"thresholds"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"absolute"</span>,
            <span class="token string">"steps"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{<!-- --></span>
                <span class="token string">"color"</span><span class="token builtin class-name">:</span> <span class="token string">"green"</span>,
                <span class="token string">"value"</span><span class="token builtin class-name">:</span> null
              <span class="token punctuation">}</span>,
              <span class="token punctuation">{<!-- --></span>
                <span class="token string">"color"</span><span class="token builtin class-name">:</span> <span class="token string">"red"</span>,
                <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token number">80</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"unit"</span><span class="token builtin class-name">:</span> <span class="token string">"short"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"overrides"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"gridPos"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"h"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
        <span class="token string">"w"</span><span class="token builtin class-name">:</span> <span class="token number">24</span>,
        <span class="token string">"x"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"y"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
      <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"legend"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"calcs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
          <span class="token string">"displayMode"</span><span class="token builtin class-name">:</span> <span class="token string">"list"</span>,
          <span class="token string">"placement"</span><span class="token builtin class-name">:</span> <span class="token string">"bottom"</span>,
          <span class="token string">"showLegend"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"tooltip"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"multi"</span>,
          <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"pluginVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"10.1.5"</span>,
      <span class="token string">"targets"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
            <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"editorMode"</span><span class="token builtin class-name">:</span> <span class="token string">"code"</span>,
          <span class="token string">"expr"</span><span class="token builtin class-name">:</span> <span class="token string">"sum(count_over_time({app=~<span class="token entity" title='\"'>\"</span><span class="token variable">$app</span><span class="token entity" title='\"'>\"</span>,filename=~<span class="token entity" title='\"'>\"</span><span class="token variable">$Filename</span><span class="token entity" title='\"'>\"</span>, environment=<span class="token entity" title='\"'>\"</span><span class="token variable">$environment</span><span class="token entity" title='\"'>\"</span>} |= <span class="token entity" title='\"'>\"</span><span class="token variable">$searchable_pattern</span><span class="token entity" title='\"'>\"</span> [<span class="token variable">$__interval</span>]))"</span>,
          <span class="token string">"legendFormat"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
          <span class="token string">"queryType"</span><span class="token builtin class-name">:</span> <span class="token string">"range"</span>,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"transparent"</span><span class="token builtin class-name">:</span> true,
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"timeseries"</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
        <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
      <span class="token string">"gridPos"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"h"</span><span class="token builtin class-name">:</span> <span class="token number">24</span>,
        <span class="token string">"w"</span><span class="token builtin class-name">:</span> <span class="token number">24</span>,
        <span class="token string">"x"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"y"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
      <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"dedupStrategy"</span><span class="token builtin class-name">:</span> <span class="token string">"none"</span>,
        <span class="token string">"enableLogDetails"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"prettifyLogMessage"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"showCommonLabels"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"showLabels"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"showTime"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"sortOrder"</span><span class="token builtin class-name">:</span> <span class="token string">"Descending"</span>,
        <span class="token string">"wrapLogMessage"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"targets"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"0"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"1"</span><span class="token builtin class-name">:</span> <span class="token string">"0"</span>,
            <span class="token string">"2"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"3"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"4"</span><span class="token builtin class-name">:</span> <span class="token string">"7"</span>,
            <span class="token string">"5"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"6"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"7"</span><span class="token builtin class-name">:</span> <span class="token string">"8"</span>,
            <span class="token string">"8"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"9"</span><span class="token builtin class-name">:</span> <span class="token string">"8"</span>,
            <span class="token string">"10"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>,
            <span class="token string">"11"</span><span class="token builtin class-name">:</span> <span class="token string">"b"</span>,
            <span class="token string">"12"</span><span class="token builtin class-name">:</span> <span class="token string">"9"</span>,
            <span class="token string">"13"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"14"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"15"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"16"</span><span class="token builtin class-name">:</span> <span class="token string">"f"</span>,
            <span class="token string">"17"</span><span class="token builtin class-name">:</span> <span class="token string">"f"</span>,
            <span class="token string">"18"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"19"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"20"</span><span class="token builtin class-name">:</span> <span class="token string">"0"</span>,
            <span class="token string">"21"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"22"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"23"</span><span class="token builtin class-name">:</span> <span class="token string">"-"</span>,
            <span class="token string">"24"</span><span class="token builtin class-name">:</span> <span class="token string">"c"</span>,
            <span class="token string">"25"</span><span class="token builtin class-name">:</span> <span class="token string">"1"</span>,
            <span class="token string">"26"</span><span class="token builtin class-name">:</span> <span class="token string">"5"</span>,
            <span class="token string">"27"</span><span class="token builtin class-name">:</span> <span class="token string">"2"</span>,
            <span class="token string">"28"</span><span class="token builtin class-name">:</span> <span class="token string">"4"</span>,
            <span class="token string">"29"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>,
            <span class="token string">"30"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"31"</span><span class="token builtin class-name">:</span> <span class="token string">"2"</span>,
            <span class="token string">"32"</span><span class="token builtin class-name">:</span> <span class="token string">"a"</span>,
            <span class="token string">"33"</span><span class="token builtin class-name">:</span> <span class="token string">"f"</span>,
            <span class="token string">"34"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>,
            <span class="token string">"35"</span><span class="token builtin class-name">:</span> <span class="token string">"d"</span>
          <span class="token punctuation">}</span>,
          <span class="token string">"editorMode"</span><span class="token builtin class-name">:</span> <span class="token string">"code"</span>,
          <span class="token string">"expr"</span><span class="token builtin class-name">:</span> <span class="token string">"{app=<span class="token entity" title='\"'>\"</span><span class="token variable">$app</span><span class="token entity" title='\"'>\"</span>, filename=~<span class="token entity" title='\"'>\"</span><span class="token variable">$Filename</span><span class="token entity" title='\"'>\"</span>, environment=<span class="token entity" title='\"'>\"</span><span class="token variable">$environment</span><span class="token entity" title='\"'>\"</span>} |~ <span class="token entity" title='\"'>\"</span>(?i)<span class="token variable">$searchable_pattern</span><span class="token entity" title='\"'>\"</span> "</span>,
          <span class="token string">"hide"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"range"</span><span class="token builtin class-name">:</span> true,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"A"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"Search Result"</span>,
      <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"logs"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token string">"1m"</span>,
  <span class="token string">"schemaVersion"</span><span class="token builtin class-name">:</span> <span class="token number">38</span>,
  <span class="token string">"style"</span><span class="token builtin class-name">:</span> <span class="token string">"dark"</span>,
  <span class="token string">"tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">"Loki"</span>,
    <span class="token string">"logging"</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"templating"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"list"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"dev"</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"dev"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"definition"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"includeAll"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"Env"</span>,
        <span class="token string">"multi"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"environment"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"environment"</span>,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"LokiVariableQueryEditor-VariableQuery"</span>,
          <span class="token string">"stream"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">"regex"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"query"</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"allValue"</span><span class="token builtin class-name">:</span> <span class="token string">".*"</span>,
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"deye-app"</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"deye-app"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"definition"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"includeAll"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"App"</span>,
        <span class="token string">"multi"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"app"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"app"</span>,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"LokiVariableQueryEditor-VariableQuery"</span>,
          <span class="token string">"stream"</span><span class="token builtin class-name">:</span> <span class="token string">"{app=~<span class="token entity" title='\"'>\"</span>.+<span class="token entity" title='\"'>\"</span>}"</span>,
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
        <span class="token string">"regex"</span><span class="token builtin class-name">:</span> <span class="token string">"deye-app"</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"tagValuesQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"tagsQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"query"</span>,
        <span class="token string">"useTags"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"allValue"</span><span class="token builtin class-name">:</span> <span class="token string">".*"</span>,
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> false,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"/data/logs/auth-rpc/auth-rpc.log"</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"/data/logs/auth-rpc/auth-rpc.log"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"datasource"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"loki"</span>,
          <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"a04a74a8-8db9-4aff-a0a4-c1524da2afdd"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"definition"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"includeAll"</span><span class="token builtin class-name">:</span> true,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"Filename"</span>,
        <span class="token string">"multi"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"Filename"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"filename"</span>,
          <span class="token string">"refId"</span><span class="token builtin class-name">:</span> <span class="token string">"LokiVariableQueryEditor-VariableQuery"</span>,
          <span class="token string">"stream"</span><span class="token builtin class-name">:</span> <span class="token string">"{app=~<span class="token entity" title='\"'>\"</span>.+<span class="token entity" title='\"'>\"</span>}"</span>,
          <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"refresh"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
        <span class="token string">"regex"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"tagValuesQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"tagsQuery"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"query"</span>,
        <span class="token string">"useTags"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>,
      <span class="token punctuation">{<!-- --></span>
        <span class="token string">"current"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"selected"</span><span class="token builtin class-name">:</span> true,
          <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"hide"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">"label"</span><span class="token builtin class-name">:</span> <span class="token string">"Search (case insensitive)"</span>,
        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"searchable_pattern"</span>,
        <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span>
            <span class="token string">"selected"</span><span class="token builtin class-name">:</span> true,
            <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
        <span class="token string">"skipUrlSync"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"textbox"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"time"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token string">"now-15m"</span>,
    <span class="token string">"to"</span><span class="token builtin class-name">:</span> <span class="token string">"now"</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"timepicker"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"refresh_intervals"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token string">"5s"</span>,
      <span class="token string">"10s"</span>,
      <span class="token string">"30s"</span>,
      <span class="token string">"1m"</span>,
      <span class="token string">"5m"</span>,
      <span class="token string">"15m"</span>,
      <span class="token string">"30m"</span>,
      <span class="token string">"1h"</span>,
      <span class="token string">"2h"</span>,
      <span class="token string">"1d"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"timezone"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
  <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"Linux-应用日志"</span>,
  <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"7ecZpUkRk1"</span>,
  <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token number">15</span>,
  <span class="token string">"weekStart"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_675">
     </a>
     部署
    </h3>
    <p>
     整套PLG的部署可以参考，
     <a href="https://cloud.tencent.com/developer/article/1915207" rel="nofollow">
      https://cloud.tencent.com/developer/article/1915207
     </a>
    </p>
    <p>
     注意loki的数据盘 需要做持久化存储，线下可以选nfs、ceph、线上可以s3、nas之类的
    </p>
    <h5>
     <a id="loki_685">
     </a>
     loki存储配置
    </h5>
    <pre><code class="prism language-YAML">auth_enabled: false
chunk_store_config:
  max_look_back_period: 0s
compactor:
  shared_store: filesystem
  working_directory: /data/loki/boltdb-shipper-compactor
ingester:
  chunk_block_size: 262144
  chunk_idle_period: 3m
  chunk_retain_period: 1m
  lifecycler:
    ring:
      replication_factor: 1
  max_transfer_retries: 0
  wal:
    dir: /data/loki/wal
limits_config:
  enforce_metric_name: false
  max_entries_limit_per_query: 5000
  reject_old_samples: true
  reject_old_samples_max_age: 168h # 保存7天数据
memberlist:
  join_members:
  - 'loki-memberlist'
schema_config:
  configs:
  - from: "2020-10-24"
    index:
      period: 24h
      prefix: index_
    object_store: filesystem
    schema: v11
    store: boltdb-shipper
server:
  grpc_listen_port: 9095
  http_listen_port: 3100
storage_config:
  boltdb_shipper:
    active_index_directory: /data/loki/boltdb-shipper-active
    cache_location: /data/loki/boltdb-shipper-cache
    cache_ttl: 24h
    shared_store: filesystem
  filesystem:
    directory: /data/loki/chunks
table_manager:
  retention_deletes_enabled: true
  retention_period: 0s
</code></pre>
    <h5>
     <a id="promtailK8sdaemonset_739">
     </a>
     promtail-配置K8s(daemonset)
    </h5>
    <pre><code class="prism language-YAML">server:
  log_level: info
  log_format: logfmt
  http_listen_port: 3101
  http_server_write_timeout: 60s
  http_server_read_timeout: 60s
  
querier:
  query_timeout: 30s
  engine:
    timeout: 30s

clients:
  - url: http://loki:3100/loki/api/v1/push

positions:
  filename: /run/promtail/positions.yaml

scrape_configs:
  # See also https://github.com/grafana/loki/blob/master/production/ksonnet/promtail/scrape_config.libsonnet for reference
  - job_name: kubernetes-pods
    pipeline_stages:
      - cri: {}
      - multiline:
          firstline: '^\d{4}-\d{2}-\d{2}'
          max_lines: 128
          max_wait_time: 3s
      - replace:
          expression: (\n\n)
          replace: "\n"
      - regex:
          expression: "^(INFO|WARN|ERROR).*" # 正则表达式匹配日志级别开头的行并提取出级别
          source: stream
          target: log_level
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels:
          - __meta_kubernetes_pod_controller_name
        regex: ([0-9a-z-.]+?)(-[0-9a-f]{8,10})?
        action: replace
        target_label: __tmp_controller_name
      - source_labels:
          - __meta_kubernetes_pod_label_app_kubernetes_io_name
          - __meta_kubernetes_pod_label_app
          - __tmp_controller_name
          - __meta_kubernetes_pod_name
        regex: ^;*([^;]+)(;.*)?$
        action: replace
        target_label: app
      - source_labels:
          - __meta_kubernetes_pod_label_app_kubernetes_io_instance
          - __meta_kubernetes_pod_label_instance
        regex: ^;*([^;]+)(;.*)?$
        action: replace
        target_label: instance
      - source_labels:
          - __meta_kubernetes_pod_label_app_kubernetes_io_component
          - __meta_kubernetes_pod_label_component
        regex: ^;*([^;]+)(;.*)?$
        action: replace
        target_label: component
      - action: replace
        source_labels:
        - __meta_kubernetes_pod_node_name
        target_label: node_name
      - action: replace
        source_labels:
        - __meta_kubernetes_namespace
        target_label: namespace
      - action: replace
        replacement: $1
        separator: /
        source_labels:
        - namespace
        - app
        target_label: job
      - action: replace
        source_labels:
        - __meta_kubernetes_pod_name
        target_label: pod
      - action: replace
        source_labels:
        - __meta_kubernetes_pod_container_name
        target_label: container
      - action: replace
        replacement: /var/log/pods/*$1/*.log
        separator: /
        source_labels:
        - __meta_kubernetes_pod_uid
        - __meta_kubernetes_pod_container_name
        target_label: __path__
      - action: replace
        regex: true/(.*)
        replacement: /var/log/pods/*$1/*.log
        separator: /
        source_labels:
        - __meta_kubernetes_pod_annotationpresent_kubernetes_io_config_hash
        - __meta_kubernetes_pod_annotation_kubernetes_io_config_hash
        - __meta_kubernetes_pod_container_name
        target_label: __path__
  
  

limits_config:
  

tracing:
  enabled: false

</code></pre>
    <h5>
     <a id="promtaillinux_856">
     </a>
     promtail-配置linux
    </h5>
    <pre><code class="prism language-YAML">[root@deye-app-test-001 ~]$ cat /data/promtail/config.yaml 
server:
  http_listen_port: 9080
  grpc_listen_port: 0
positions:
  filename: /data/promtail/positions.yaml

clients:
  - url: http://10.180.200.16:38727/loki/api/v1/push #loki地址

scrape_configs:
 - job_name: system
   pipeline_stages:
   #日志换行，匹配开头
      - multiline:
          firstline: '^\d{4}-\d{2}-\d{2}'
          max_lines: 128
          max_wait_time: 3s   
   #静态配置
   static_configs:
   - targets:
      - localhost
     labels:
      job: linux-promtail-agent
      host_name: deye-app-test-001 # 主机名，各主机不一样
      environment: dev # 这个环境标签 -&gt; {app="$app", filename=~"$Filename", environment="$environment"} |~ "(?i)$searchable_pattern" 
      app: deye-app # 此处名称设置为统一，配置上方便，搜索上需要过滤
      __path__: /data/logs/*/*.log
</code></pre>
    <h4>
     <a id="Ansible_promtail_893">
     </a>
     Ansible 批量安装promtail
    </h4>
    <pre><code class="prism language-YAML">---
  - name: Copy and execute
    hosts: "ems-web-001"
    tasks:
      - name: Execute
        shell:
          cmd: mkdir -p /data/promtail/

      - name: Copy
        copy:
          src: ./file/config.yaml
          dest: /data/promtail/config.yaml
          mode: 0644

      - name: Copy
        copy:
          src: ./file/promtail
          dest: /usr/bin/promtail
          mode: 0755

      - name: Copy
        copy:
          src: ./file/promtail.service
          dest: /usr/lib/systemd/system/promtail.service
          mode: 0644

      - name: Execute
        shell:
          cmd: systemctl enable promtail
</code></pre>
    <pre><code class="prism language-YAML">server:
  http_listen_port: 9080
  grpc_listen_port: 0
positions:
  filename: /data/promtail/positions.yaml

clients:
  - url: http://10.180.200.16:38727/loki/api/v1/push

scrape_configs:
 - job_name: system
   pipeline_stages:
   #日志换行，匹配开头
      - multiline:
          firstline: '^\d{4}-\d{2}-\d{2}'
          max_lines: 128
          max_wait_time: 3s   
   #静态配置
   static_configs:
   - targets:
      - localhost
     labels:
      job: linux-promtail-agent
      host_name: ems-web-001
      environment: test
      app: nginx-gateway
      __path__: /data/logs/openresty/*.log
</code></pre>
    <pre><code class="prism language-Markdown">[Unit]
Descriptinotallow=promtail
Documentatinotallow=https://github.com/grafana/loki/tree/master
After=network.target
 
[Service]
Type=simple
User=root
ExecStart=/usr/bin/promtail -config.file=/data/promtail/config.yaml
Restart=on-failure
 
[Install]
WantedBy=multi-user.target
</code></pre>
    <p>
     还有二进制promtail 可执行文件，file/promtail
    </p>
    <pre><code class="prism language-Bash">ansible-playbook deploy.yml
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343731313733372f:61727469636c652f64657461696c732f313435373832393034" class_="artid" style="display:none">
 </p>
</div>


