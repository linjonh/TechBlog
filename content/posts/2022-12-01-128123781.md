---
layout: post
title: "python实现http服务调用"
date: 2022-12-01 09:07:45 +0800
description: "python实现http client调用"
keywords: "python实现http服务调用"
categories: ['Python']
tags: ['Python', 'Http']
artid: "128123781"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=128123781
    alt: "python实现http服务调用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=128123781
featuredImagePreview: https://bing.ee123.net/img/rand?artid=128123781
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     python实现http服务调用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Python_0">
     </a>
     系列Python开发
    </h2>
    <hr/>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#Python_0" rel="nofollow">
        系列Python开发
       </a>
      </li>
      <li>
       <a href="#_8" rel="nofollow">
        前言
       </a>
      </li>
      <li>
       <a href="#pythonhttp_12" rel="nofollow">
        一、python实现http服务调用
       </a>
      </li>
      <li>
       <a href="#_14" rel="nofollow">
        二、代码实现
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_http_token_15" rel="nofollow">
          1. http 申请token代码
         </a>
        </li>
        <li>
         <a href="#2__73" rel="nofollow">
          2. 结果如下：
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_89" rel="nofollow">
        三、打包代码实现
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#httpsiblogcsdnimgcndirect82fc146b53464839a4e01a7447adc27epng_102" rel="nofollow">
          生成可执行文件
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_105" rel="nofollow">
        总结
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_8">
     </a>
     前言
    </h2>
    <hr/>
    <h2>
     <a id="pythonhttp_12">
     </a>
     一、python实现http服务调用
    </h2>
    <p>
     服务端开发后通常需要做功能测试、性能测试，通常postman、curl等作功能测试使用，长跑服务性能postman并不太适合，如用c++实现http client，开发效率太低效，本文介绍一种用python来实现http server的测试。
    </p>
    <h2>
     <a id="_14">
     </a>
     二、代码实现
    </h2>
    <h3>
     <a id="1_http_token_15">
     </a>
     1. http 申请token代码
    </h3>
    <pre><code class="prism language-c">import json
import requests
import time
import threading
import time
from threading import Thread
import sys                                                                  
import signal
#<span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> UTF<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
requests<span class="token punctuation">.</span>packages<span class="token punctuation">.</span>urllib3<span class="token punctuation">.</span><span class="token function">disable_warnings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

username<span class="token operator">=</span><span class="token string">"admin"</span>
password<span class="token operator">=</span><span class="token string">"admin123"</span>

sever_ip<span class="token operator">=</span><span class="token string">"10.20.40.80"</span>
my_token<span class="token operator">=</span><span class="token string">""</span>

def <span class="token function">allocToken</span><span class="token punctuation">(</span>platform_ip<span class="token punctuation">)</span><span class="token operator">:</span>
    url<span class="token operator">=</span><span class="token string">'http://%s/user/allocToken'</span> <span class="token operator">%</span><span class="token punctuation">(</span>platform_ip<span class="token punctuation">)</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">"validateMethod"</span><span class="token operator">:</span><span class="token string">"name+password"</span><span class="token punctuation">,</span>
        <span class="token string">"username"</span><span class="token operator">:</span><span class="token function">str</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"userpassword"</span><span class="token operator">:</span><span class="token function">str</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"refreshInterval"</span><span class="token operator">:</span><span class="token number">3600</span><span class="token punctuation">,</span>        
        <span class="token string">"requestid"</span><span class="token operator">:</span><span class="token string">"1"</span>       
        <span class="token punctuation">}</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> verify<span class="token operator">=</span>False<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span><span class="token function">dumps</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    resp <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">loads</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"token: "</span><span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>resp<span class="token punctuation">[</span><span class="token string">"token"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp<span class="token punctuation">[</span><span class="token string">"token"</span><span class="token punctuation">]</span>



def <span class="token function">ConcurrencyAllocToken</span><span class="token punctuation">(</span>sequence<span class="token punctuation">,</span>platform_ip<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">while</span> True<span class="token operator">:</span>
        try<span class="token operator">:</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            my_token<span class="token operator">=</span><span class="token function">allocToken</span><span class="token punctuation">(</span>platform_ip<span class="token punctuation">)</span>
            t_exec <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>sequence<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" call alloc token used: "</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>t_exec<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        except<span class="token operator">:</span>
            <span class="token keyword">break</span>        


<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token operator">:</span>  
    cpucores <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span>cpucores<span class="token punctuation">)</span><span class="token operator">:</span>
        thread <span class="token operator">=</span> <span class="token function">Thread</span><span class="token punctuation">(</span>target<span class="token operator">=</span>ConcurrencyAllocToken<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>sever_ip<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="2__73">
     </a>
     2. 结果如下：
    </h3>
    <pre><code class="prism language-clike"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"requestid"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token string">"resultDesc"</span><span class="token punctuation">:</span> <span class="token string">"成功"</span><span class="token punctuation">,</span>
    <span class="token string">"resultcode"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">"token"</span><span class="token punctuation">:</span> <span class="token string">"BA680401-92D5-535A-38D4-633C8456ED9E"</span><span class="token punctuation">,</span>
    <span class="token string">"userInfo"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"userid"</span><span class="token punctuation">:</span> <span class="token string">"5aa2d40b-87f6-4a82-abf3-212df0677309"</span><span class="token punctuation">,</span>
        <span class="token string">"loginName"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>
        <span class="token string">"userName"</span><span class="token punctuation">:</span> <span class="token string">"admin123"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_89">
     </a>
     三、打包代码实现
    </h2>
    <p>
     基于pycharm软件，安装打包软件
    </p>
    <pre><code class="prism language-clike">pip install pyinstaller
pyinstaller <span class="token operator">--</span>onefile main<span class="token punctuation">.</span>py
pyinstaller <span class="token operator">--</span>onefile <span class="token operator">--</span>distpath dist <span class="token operator">--</span>out my_application<span class="token punctuation">.</span>exe your_script<span class="token punctuation">.</span>py

<span class="token operator">--</span>onefile 表示创建一个独立的文件。
<span class="token operator">--</span>distpath dist 指定输出目录为 dist。
<span class="token operator">--</span>out my_application 指定输出的文件名为 my_application<span class="token punctuation">.</span>exe。
your_script<span class="token punctuation">.</span>py 是你想要打包的 Python 脚本。
</code></pre>
    <h3>
     <a id="httpsiblogcsdnimgcndirect82fc146b53464839a4e01a7447adc27epng_102">
     </a>
     <img alt="生成可执行文件" src="https://i-blog.csdnimg.cn/direct/82fc146b53464839a4e01a7447adc27e.png"/>
    </h3>
    <h2>
     <a id="_105">
     </a>
     总结
    </h2>
    <p>
     本文实现了最简单的http申请token的流程，可以做其他的扩展使用。
    </p>
    <p>
     授之以鱼不如授之以渔，如果喜欢，请点赞收藏。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343833343535342f:61727469636c652f64657461696c732f313238313233373831" class_="artid" style="display:none">
 </p>
</div>


