---
layout: post
title: "Node.js学习分享下"
date: 2025-03-12 20:25:54 +0800
description: "Node.js的Express框架，使用express搭建基本的Web服务器，中间件、CORS跨域资源共享、Session认证件机制、JWT认证机制"
keywords: "node.js中的accept"
categories: ['未分类']
tags: ['学习', '前端', 'Node']
artid: "146213687"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146213687
    alt: "Node.js学习分享下"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146213687
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146213687
cover: https://bing.ee123.net/img/rand?artid=146213687
image: https://bing.ee123.net/img/rand?artid=146213687
img: https://bing.ee123.net/img/rand?artid=146213687
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Node.js学习分享（下）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Express_1">
     </a>
     Express
    </h2>
    <h3>
     <a id="express_2">
     </a>
     express的基本用法
    </h3>
    <h4>
     <a id="web_3">
     </a>
     创建基本的web服务器
    </h4>
    <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span> <span class="token comment">//导入express模块</span>
<span class="token comment">//创建服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="GET_13">
     </a>
     监听GET请求
    </h4>
    <ul>
     <li>
      通过app.get()方法，可以监听客户端的GET请求
     </li>
     <li>
      语法格式：
     </li>
    </ul>
    <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"请求URL"</span><span class="token function">，</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="POST_19">
     </a>
     监听POST请求
    </h4>
    <ul>
     <li>
      通过app.post()方法，可以监听客户端的POST请求
     </li>
     <li>
      语法格式：
     </li>
    </ul>
    <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"请求URL"</span><span class="token function">，</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_25">
     </a>
     把内容响应给客户端
    </h4>
    <ul>
     <li>
      通过res.send()方法，可以把处理好的内容发送给客户端
      <br/>
      //使用res.send()方法，向客户端响应一个JSON对象
     </li>
    </ul>
    <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"zhengbo"</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token literal-property property">hobby</span><span class="token operator">:</span><span class="token string">"badminton"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="URL_33">
     </a>
     获取URL中携带的查询参数
    </h4>
    <ul>
     <li>
      通过req.query对象，可以访问到客户端通过查询字符串的形式，发送到服务器的参数
     </li>
    </ul>
    <h4>
     <a id="URL_35">
     </a>
     获取URL中的动态参数
    </h4>
    <ul>
     <li>
      通过req.params对象，可以访问到URL中，通过:匹配到的动态参数
     </li>
    </ul>
    <h3>
     <a id="_38">
     </a>
     托管静态资源
    </h3>
    <h4>
     <a id="expressstatic_39">
     </a>
     express.static()
    </h4>
    <ul>
     <li>
      通过express.static()，我们可以非常方便地创建一个静态资源管理器
     </li>
    </ul>
    <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">"文件名"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_44">
     </a>
     托管多个静态资源目录
    </h4>
    <ul>
     <li>
      多次调用express.static()函数
     </li>
    </ul>
    <h4>
     <a id="_46">
     </a>
     挂载路径前缀
    </h4>
    <ul>
     <li>
      如果希望在托管的静态资源路径之前，挂载路径前缀，可以使用下面的方式
     </li>
    </ul>
    <pre><code class="prism language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'路径前缀'</span><span class="token punctuation">,</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'文件名'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="Express_51">
     </a>
     Express路由
    </h3>
    <ul>
     <li>
      广义上来讲，路由就是映射关系
     </li>
     <li>
      在express中，路由指的是客户端请求与服务器处理函数之间的映射关系
     </li>
     <li>
      express中路由分为三部分：
      <ul>
       <li>
        请求的类型
       </li>
       <li>
        请求的URL地址
       </li>
       <li>
        处理函数
        <br/>
        app.method(“path”,“Handler”)
        <br/>
        路由的使用
       </li>
      </ul>
     </li>
     <li>
      在express中使用路由最简单的方法，就是把路由挂载到app上
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//挂载路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello,World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server running at http://127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_74">
     </a>
     路由模块化
    </h4>
    <ol>
     <li>
      创建路由模块对应的js文件
     </li>
     <li>
      调用express.Router()函数创建路由对象
     </li>
     <li>
      向路由对象上挂载具体的路由
     </li>
     <li>
      使用module_exports向外共享路由对象
     </li>
     <li>
      使用app.use()函数注册路由模块
      <br/>
      app.use()函数的作用，就是来注册全局中间件
     </li>
    </ol>
    <h3>
     <a id="Express_82">
     </a>
     Express中间件
    </h3>
    <h4>
     <a id="Express_83">
     </a>
     Express中间件的调用流程
    </h4>
    <ul>
     <li>
      当一个请求到达Express服务器之后，可以连续调用多个中间件，从而对这次请求进行预处理
     </li>
    </ul>
    <h4>
     <a id="Express_85">
     </a>
     Express中间件的格式
    </h4>
    <ul>
     <li>
      Express的中间件，本质上就是一个function处理函数。
     </li>
     <li>
      注意：中间件函数的形参列表中，必须包含next参数。而路由处理函数中只包含req和res
     </li>
    </ul>
    <h5>
     <a id="next_88">
     </a>
     next函数的作用
    </h5>
    <ul>
     <li>
      next函数是实现多个中间件连续调用的关键，它表示把流转关系转交给下一个中间件或路由
      <br/>
      定义一个最简单的中间件函数
      <br/>
      //定义一个中间件函数
      <br/>
      const middleFun = (req,res,next)=&gt;{
      <!-- -->
      <br/>
      console.log(“这是一个中间件函数”);
      <br/>
      //把流转关系，转交给下一个中间件或者路由
      <br/>
      next()
      <br/>
      }
     </li>
    </ul>
    <h4>
     <a id="_97">
     </a>
     全局生效的中间件
    </h4>
    <ul>
     <li>
      客户端发起的任何请求，到达服务器之后，都会触发的中间件，叫做全局生效的中间件
     </li>
     <li>
      通过调用app.use(中间件函数)，即可定义一个全局生效的中间件
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//全局生效的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleFun<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_104">
     </a>
     中间件的作用
    </h4>
    <ul>
     <li>
      多个中间件之间，共享同一份req和res。基于这样的特性，我们可以在上游的中间件中，统一为req和res对象添加自定义的属性和方法，供下游的中间件或者路由进行使用
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//全局生效的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> time <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    req<span class="token punctuation">.</span>startTime <span class="token operator">=</span> time
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_114">
     </a>
     局部生效的中间件
    </h4>
    <ul>
     <li>
      不使用app.use()定义的中间件，叫做局部生效的中间件
     </li>
     <li>
      在路由参数URL和Handler中间加上该中间件函数即可局部生效
     </li>
    </ul>
    <h4>
     <a id="_117">
     </a>
     中间件的注意事项
    </h4>
    <ol>
     <li>
      一定要在路由之前注册中间件
     </li>
     <li>
      客户端发送过来的请求，可以连续调用多个中间件进行处理
     </li>
     <li>
      执行完中间件的业务代码之后，不要忘记调用next()函数
     </li>
     <li>
      为了防止代码逻辑混乱，调用next函数之后不要再写额外的代码
     </li>
     <li>
      连续调用多个中间件时，多个中间件之间，共享req和res对象
     </li>
    </ol>
    <h3>
     <a id="_124">
     </a>
     中间件的分类
    </h3>
    <h4>
     <a id="_125">
     </a>
     应用级别的中间件
    </h4>
    <ul>
     <li>
      通过app.use()或者app.get()等，绑定到app实例上的中间件，叫做应用级别的中间件
      <br/>
      路由级别的中间件
     </li>
     <li>
      绑定到express.Router()实例上的中间件，叫做路由级别的中间件
     </li>
    </ul>
    <h4>
     <a id="_129">
     </a>
     错误级别的中间件
    </h4>
    <ul>
     <li>
      作用：专门用来捕获整个项目中发生的异常错误，从而防止项目异常崩溃的问题
     </li>
     <li>
      必须有四个形参，分别是(err,req,res,next)
      <br/>
      注意：错误级别的中间件，必须注册在所有路由之后
      <br/>
      Express内置的中间件
     </li>
     <li>
      express.static()
     </li>
     <li>
      express.json解析JSON格式的请求体数据（有兼容性）
     </li>
     <li>
      express.urlencoded解析URL-encoded格式的请求体数据（有兼容性）
     </li>
    </ul>
    <h4>
     <a id="_137">
     </a>
     第三方中间件
    </h4>
    <ol>
     <li>
      安装中间件：npm install + 中间件
     </li>
     <li>
      使用require导入中间件
     </li>
     <li>
      调用app.use注册并使用中间件
      <br/>
      注意：如果没有配置任何的解析表单数据的中间件，则req.body默认为undefined
     </li>
    </ol>
    <h4>
     <a id="_142">
     </a>
     自定义中间件
    </h4>
    <ul>
     <li>
      手动模拟一个类似于express.urlencoded这样的中间件，来解析POST提交到服务器的
     </li>
     <li>
      实现步骤：
     </li>
    </ul>
    <ol>
     <li>
      定义中间件
     </li>
     <li>
      监听req的data事件
     </li>
     <li>
      监听req的end事件
     </li>
     <li>
      使用querystring模块解析请求体数据
     </li>
     <li>
      将解析出来的数据挂载为req.body
     </li>
     <li>
      将自定义中间件封装为模块
     </li>
    </ol>
    <pre><code class="prism language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

<span class="token comment">//解析表单数据的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义一个字符串，专门存储客户端发送过来的请求体数据</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token comment">//监听req的data事件</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        str<span class="token operator">+=</span>chunk
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//监听req的end事件</span>
    req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//将字符串解析为对象格式</span>
        <span class="token keyword">const</span> body <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
        req<span class="token punctuation">.</span>body <span class="token operator">=</span> body
         <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
   
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//在POST请求接口中返回上面中间件挂载到req.body的数据</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at http://127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="Express_184">
     </a>
     使用Express写接口
    </h3>
    <h4>
     <a id="GET_185">
     </a>
     编写GET接口
    </h4>
    <pre><code class="prism language-js"><span class="token comment">//GET接口</span>
apirouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/get'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取客户端通过查询字符串发送到服务器的数据</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token comment">//向客户端响应数据</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'GET请求成功'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>query
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="POST_199">
     </a>
     编写POST接口
    </h4>
    <pre><code class="prism language-js"><span class="token comment">//POST接口</span>
apirouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'POST请求成功'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>body
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="CORS_212">
     </a>
     CORS跨域资源共享
    </h3>
    <h4>
     <a id="_213">
     </a>
     解决跨域问题的两种方案
    </h4>
    <ol>
     <li>
      CORS：主流的解决方案，推荐使用
     </li>
     <li>
      JSONP：有缺陷，只支持GET请求
     </li>
    </ol>
    <h4>
     <a id="cors_216">
     </a>
     cors中间件解决跨域问题
    </h4>
    <ul>
     <li>
      cors是Express的一个第三方中间件，通过它可以很方便的解决跨域问题
      <br/>
      使用步骤：
      <br/>
      1.
      <code>
       npm install cors
      </code>
     </li>
    </ul>
    <ol start="2">
     <li>
      <code>
       const cors = require("cors")
      </code>
      ，导入中间件
     </li>
     <li>
      在路由之前调用
      <code>
       app.use(cors())
      </code>
      配置中间件
     </li>
    </ol>
    <h4>
     <a id="CORS_222">
     </a>
     什么是CORS
    </h4>
    <ul>
     <li>
      CORS（跨域资源共享）由一系列http响应头组成，这些http响应头决定浏览器是否组织前端JS代码跨域获取资源
     </li>
     <li>
      浏览器的同源安全策略默认会阻止网页跨域获得资源。但如果接口服务器配置了CORS相关的http响应头，就可以解决浏览器端的跨域访问限制
     </li>
    </ul>
    <h4>
     <a id="CORS_225">
     </a>
     CORS响应头部
    </h4>
    <ul>
     <li>
      <p>
       <code>
        Access-Control-Allow-Origin: &lt;origin&gt; | *
       </code>
      </p>
     </li>
     <li>
      <p>
       origin参数的值指定了允许访问该资源的外域URL
      </p>
     </li>
     <li>
      <p>
       <code>
        Access-Control-Allow-Headers
       </code>
      </p>
     </li>
     <li>
      <p>
       如果客户端向服务端发送了额外的请求头，则需要通过该请求头对额外的请求头进行声明
      </p>
     </li>
     <li>
      <p>
       <code>
        Access-Control-Allow-Methods
       </code>
      </p>
     </li>
     <li>
      <p>
       默认情况下，CORS仅支持客户端发起GET、POST、Head请求
      </p>
     </li>
     <li>
      <p>
       如果需要别的请求方式，则需要通过该请求头来指明实际请求所允许使用的http方法
      </p>
     </li>
    </ul>
    <h3>
     <a id="CORS_236">
     </a>
     CORS请求的分类
    </h3>
    <ul>
     <li>
      根据请求方式和请求头的不同，可以把CORS请求分为两类
     </li>
     <li>
      简单请求和预检请求
     </li>
    </ul>
    <h4>
     <a id="_239">
     </a>
     简单请求
    </h4>
    <ul>
     <li>
      同时满足以下两大条件的请求
     </li>
    </ul>
    <ol>
     <li>
      请求方式：GET 、POST、HEAD三者之一
     </li>
     <li>
      HTTP 头部信息不超过以下几种字段：无自定义头部宇段、
      <code>
       Accept. Accept-Language、Content-Language、DPR、Downlink、 Save-Data, Viewport-Width、Width、Content-Type
      </code>
     </li>
    </ol>
    <h4>
     <a id="_243">
     </a>
     预检请求
    </h4>
    <ul>
     <li>
      不是简单请求的请求就是预检请求
      <br/>
      简单请求和预检请求的区别
     </li>
     <li>
      简单请求特点：客户端与服务器之间只会发生一次请求
     </li>
     <li>
      预检请求特点：客户端与服务器之间会发生两次请求，OPTION预检请求成功之后，才会发起真正的请求
     </li>
    </ul>
    <h2>
     <a id="web_249">
     </a>
     web开发模式
    </h2>
    <h3>
     <a id="web_250">
     </a>
     服务端渲染的web开发模式
    </h3>
    <ul>
     <li>
      服务器发送给客户端的HTML页面，是在服务器通过字符串的拼接，动态生成的。因此，客户端不需要使用Ajax这样的技术额外请求页面的数据
     </li>
    </ul>
    <h4>
     <a id="_252">
     </a>
     优缺点：
    </h4>
    <p>
     优点：
    </p>
    <ol>
     <li>
      前端耗时少
     </li>
     <li>
      有利于SEO
     </li>
    </ol>
    <p>
     缺点：
    </p>
    <ol>
     <li>
      占用服务器端资源
     </li>
     <li>
      不利于前后端分离，开发效率低
     </li>
    </ol>
    <h3>
     <a id="web_261">
     </a>
     前后端分离的web开发模式
    </h3>
    <ul>
     <li>
      后端只负责提供API接口，前端使用Ajax调用接口
     </li>
    </ul>
    <h4>
     <a id="_263">
     </a>
     优缺点：
    </h4>
    <p>
     优点：
    </p>
    <ol>
     <li>
      开发体验好
     </li>
     <li>
      用户体验好
     </li>
     <li>
      减轻了服务器端的渲染压力
     </li>
    </ol>
    <p>
     缺点：
    </p>
    <ol>
     <li>
      不利于SEO
     </li>
    </ol>
    <h2>
     <a id="session_272">
     </a>
     session认证机制
    </h2>
    <h3>
     <a id="http_273">
     </a>
     http协议的无状态性
    </h3>
    <ul>
     <li>
      指的是客户端的每次http请求都是独立的，连续多个请求之间没有直接的关系，服务器不会主动保留每次http的状态
     </li>
    </ul>
    <h3>
     <a id="Cookie_275">
     </a>
     Cookie
    </h3>
    <h4>
     <a id="cookie_276">
     </a>
     什么是cookie
    </h4>
    <ul>
     <li>
      cookie是存储在用户浏览器中的一段不超过4KB的字符串。它由一个名称、一个值和其他几个用于控制cooker有效期、安全性、使用范围的可选属性组成
     </li>
     <li>
      不同域名下的cookie各自独立，每当客户端发起请求时，会自动把当前域名下所有未过期的cookie一同发送到服务器
     </li>
    </ul>
    <h4>
     <a id="cookie_279">
     </a>
     cookie的四大特性
    </h4>
    <ol>
     <li>
      自动发送
     </li>
     <li>
      域名独立
     </li>
     <li>
      过期时限
     </li>
     <li>
      4KB限制
     </li>
    </ol>
    <h4>
     <a id="cookie_284">
     </a>
     cookie不具有安全性
    </h4>
    <ul>
     <li>
      由于cookie是存储在浏览器中的，而且浏览器也提供了读写cookie的API，因此cookie很容易被伪造，不具有安全性。因此不建议服务器将重要的隐私数据，通过cookie的形式发送给浏览器。
     </li>
    </ul>
    <h3>
     <a id="session_286">
     </a>
     session的工作原理
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/77b75d50322443649cda97795790076c.png"/>
    </p>
    <h3>
     <a id="session_289">
     </a>
     向session中存储数据
    </h3>
    <ul>
     <li>
      当express-session中间件配置成功后，即可通过req.session来访问和使用session对象，从而存储用户的关键信息
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//登录的api接口</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">'admin'</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">!==</span> <span class="token string">'000000'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'登录失败'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//将登录成功后的用户信息，存储到session中</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> req<span class="token punctuation">.</span>body <span class="token comment">//用户信息</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>islogin <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//用户的登录状态</span>

    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'登录成功'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="session_305">
     </a>
     从session中取数据
    </h4>
    <ul>
     <li>
      可以直接从req.session对象上获取之前存储的数据
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//获取用户用户名的接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/username'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>islogin<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'fail'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'success'</span><span class="token punctuation">,</span><span class="token literal-property property">username</span><span class="token operator">:</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="session_316">
     </a>
     清空session
    </h4>
    <ul>
     <li>
      调用req.session.destroy()函数，即可清空服务器保存的session信息
     </li>
    </ul>
    <pre><code class="prism language-js"><span class="token comment">//退出登录的接口</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/loginout'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//清空当前客户端对应的session信息</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'退出登录成功'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h2>
     <a id="JWT_329">
     </a>
     JWT认证机制
    </h2>
    <ul>
     <li>
      session认证机制需要配合cookie才能实现，由于cookie默认不支持跨域访问，所以当涉及前端跨域访问后端接口时，所以需要做很多额外的配置，才能实现跨域session认证
     </li>
     <li>
      当前端请求后端接口不存在跨域问题时，推荐使用session身份认证机制
     </li>
    </ul>
    <h3>
     <a id="JWT_332">
     </a>
     什么是JWT
    </h3>
    <ul>
     <li>
      <p>
       JSON Web Token 是目前最流行的跨域认证解决方案
       <br/>
       JWT的工作机制
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/77d0d86c805d4373a1c2b1eb38b495c1.png"/>
      </p>
     </li>
     <li>
      <p>
       用户的信息通过token字符串的形式，保存在客户端浏览器中。服务器通过还原token字符串的形式来认证用户的身份
      </p>
     </li>
    </ul>
    <h4>
     <a id="JWT_338">
     </a>
     JWT的组成
    </h4>
    <ul>
     <li>
      JWT通常由三部分组成，分别是
      <code>
       Header（头部），Payload（有效荷载），Signature（签名）
      </code>
     </li>
     <li>
      Payload部分才是真正的用户信息，它是用户信息经过加密之后生成的字符串
     </li>
     <li>
      Header和Signature是安全性相关的部分，只是为了保证token的安全性
     </li>
    </ul>
    <h4>
     <a id="JWT_342">
     </a>
     JWT的使用方式
    </h4>
    <ul>
     <li>
      推荐的做法是把JWT放在HTTP请求头的Authorization字段中
     </li>
    </ul>
    <h2>
     <a id="ExpressJWT_345">
     </a>
     在Express中使用JWT
    </h2>
    <h3>
     <a id="JWT_346">
     </a>
     安装JWT相关的包
    </h3>
    <p>
     <code>
      npm install jsonwebtoken express-jwt
     </code>
    </p>
    <ul>
     <li>
      jsonwebtoken：用于生成JWT字符串
     </li>
     <li>
      Express-jwt：用于将JWT字符串解析还原成JSON对象
      <br/>
      导入包
     </li>
     <li>
      使用require函数
      <br/>
      const jwt = require(‘jsonwebtoken’)
      <br/>
      const expressJWT = require(‘express-jwt’)
      <br/>
      定义secret密钥
     </li>
     <li>
      保证JWT字符串的安全性
      <br/>
      const secretKey = ‘yaoyao No1’
      <br/>
      再登录成功后生成JWT字符串
     </li>
     <li>
      调用jsonwebtoken包提供的sign()方法，将用户的信息加密成JWT字符串，响应给客户端
     </li>
    </ul>
    <h3>
     <a id="JWTJSON_360">
     </a>
     将JWT字符串还原为JSON对象
    </h3>
    <ul>
     <li>
      服务器可以通过express-jwt这个中间件，自动将客户端发送过来的token解析成JSON对象
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6c67c1f440634610aceec6d04bf686a4.png"/>
     </li>
    </ul>
    <blockquote>
     <p>
      注意：只要配置好了express-jwt这个中间件，就可以把解析出来的用户信息，挂载到req.user属性上
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f73616d726f6f6d2f:61727469636c652f64657461696c732f313436323133363837" class_="artid" style="display:none">
 </p>
</div>


