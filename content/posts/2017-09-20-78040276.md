---
layout: post
title: "iOS-音视频播放的简单实现"
date: 2017-09-20 14:15:42 +0800
description: "iOS开发中，音视频的播放有很多种，目前系统的自带的都属于 AVFoundation 框架，更加接近"
keywords: "ios 短视频"
categories: ['流媒体', 'Swift', 'Ios']
tags: ['音视频', '视频', 'Avplayer']
artid: "78040276"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78040276
    alt: "iOS-音视频播放的简单实现"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=78040276
featuredImagePreview: https://bing.ee123.net/img/rand?artid=78040276
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     iOS-音视频播放的简单实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      iOS开发中，音视频的播放有很多种，目前系统的自带的都属于 AVFoundation 框架，更加接近于底层，所以灵活性很强，更加方便自定义
     </strong>
    </p>
    <p>
     <strong>
      还有就是第三方音视频视频播放，特点是功能强大，实现简单，支持流媒体
     </strong>
    </p>
    <hr/>
    <h4 id="播放系统音效或者短音效">
     播放系统音效或者短音效
    </h4>
    <h5 id="注意">
     注意：
    </h5>
    <ul>
     <li>
      这里的资源长度最多30秒
     </li>
     <li>
      资源必须在
      <code>
       Target --&gt; Build Phases --&gt; Copy Bundle Resources
      </code>
      引入资源文件，否则获取不到文件
     </li>
    </ul>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> soundURL = Bundle.main.url(forResource: <span class="hljs-string">"sourceName"</span>, withExtension: <span class="hljs-string">"wav"</span>) {
    <span class="hljs-keyword">var</span> mySound: SystemSoundID = <span class="hljs-number">0</span>
    AudioServicesCreateSystemSoundID(soundURL <span class="hljs-keyword">as</span> CFURL, &amp;mySound)
    <span class="hljs-comment">// Play</span>
    AudioServicesPlaySystemSound(mySound);
}</code></pre>
    <hr/>
    <h4 id="播放音乐-avaudioplayer">
     播放音乐 - AVAudioPlayer
    </h4>
    <ul>
     <li>
      资源必须在
      <code>
       Target --&gt; Build Phases --&gt; Copy Bundle Resources
      </code>
      引入资源文件，否则获取不到文件
     </li>
     <li>
      支持多种音频格式，而且能够进行进度、音量、播放速度等控制。
     </li>
    </ul>
    <h5 id="定义一个播放器属性">
     定义一个播放器属性
    </h5>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">// 定义一个播放器属性</span>
fileprivate <span class="hljs-keyword">var</span> player: AVAudioPlayer?
</code></pre>
    <h5 id="初始化并开始播放音乐">
     初始化并开始播放音乐
    </h5>
    <pre class="prettyprint"><code class="hljs cs">func playMusic() {

    <span class="hljs-comment">// 2.获取对应音乐资源</span>
    guard <span class="hljs-keyword">let</span> fileUrl = Bundle.main.url(forResource: <span class="hljs-string">"309769"</span>, withExtension: <span class="hljs-string">"mp3"</span>) <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> }
    <span class="hljs-comment">// 3.创建对应的播放器</span>
    <span class="hljs-keyword">do</span> {
        player = <span class="hljs-keyword">try</span> AVAudioPlayer(contentsOf: fileUrl)
    } <span class="hljs-keyword">catch</span> {
        print(error)
    }

    <span class="hljs-comment">// 设置代理监听播放完成</span>
    player?.<span class="hljs-keyword">delegate</span> = self

    <span class="hljs-comment">// 4.准备播放</span>
    player?.prepareToPlay()

    <span class="hljs-comment">// 5.播放音乐</span>
    player?.play()
}</code></pre>
    <h5 id="停止暂停">
     停止、暂停
    </h5>
    <pre class="prettyprint"><code class="hljs cs"><span class="hljs-comment">// 停止、暂停</span>
player?.stop()</code></pre>
    <h5 id="监听-avaudioplayer-播放完成">
     监听 AVAudioPlayer 播放完成
    </h5>
    <pre class="prettyprint"><code class="hljs go"><span class="hljs-comment">// MARK: - AVAudioPlayerDelegate</span>
extension ViewController: AVAudioPlayerDelegate {
    <span class="hljs-comment">/// 完成播放</span>
    <span class="hljs-keyword">func</span> audioPlayerDidFinishPlaying(_ player: AVAudioPlayer, successfully flag: Bool) {
        <span class="hljs-keyword">if</span> flag {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"播放完成"</span>)
        }
    }
}

</code></pre>
    <hr/>
    <h4 id="使用-avplayer-进行视频的播放">
     使用 AVPlayer 进行视频的播放
    </h4>
    <blockquote>
     <p>
      AVPlayer的对象要设置为全局的，否则会播放不成功
     </p>
     <p>
      AVPlayer存在于AVFoundation中，可以播放音乐、本地音频和流媒体播放
     </p>
     <p>
      但是它对视屏有很高自由度的控制，而且能够自定义视屏播放界面
     </p>
     <p>
      通过通知监听播放的进度及相关参数
     </p>
    </blockquote>
    <h5 id="avplayer三要素">
     AVPlayer三要素
    </h5>
    <ul>
     <li>
      <p>
       AVPlayerItem(提供数据,设置数据源)
      </p>
     </li>
     <li>
      <p>
       AVPlayer(负责控制播放,暂停、播放、指定时间播放等)
      </p>
     </li>
     <li>
      <p>
       AVPlayerLayer(负责显示如果缺少就只有声音没有视频)
      </p>
     </li>
    </ul>
    <pre class="prettyprint"><code class="hljs cs">func playVideo() {
    <span class="hljs-comment">// 1.创建AVPlayer</span>
    guard <span class="hljs-keyword">let</span> url = URL(<span class="hljs-keyword">string</span>: <span class="hljs-string">"http://baobab.wdjcdn.com/14559682994064.mp4"</span>) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }

    <span class="hljs-comment">// 2.创建播放器</span>
    <span class="hljs-comment">// 提供数据,设置数据源</span>
    <span class="hljs-keyword">let</span> item = AVPlayerItem(url: url)
    <span class="hljs-comment">// 负责控制播放,暂停、播放、指定时间播放等</span>
    <span class="hljs-keyword">let</span> player = AVPlayer(playerItem: item)

    <span class="hljs-comment">// 3.创建图层,负责显示</span>
    <span class="hljs-keyword">let</span> layer = AVPlayerLayer(player: player)
    layer.frame = playerView.bounds
    playerView.layer.addSublayer(layer)

    <span class="hljs-comment">// 4.播放视频</span>
    player.play()
}</code></pre>
    <hr/>
    <h4 id="使用-ijkmediaframework-进行视频的播放">
     使用 IJKMediaFramework 进行视频的播放
    </h4>
    <blockquote>
     <p>
      ijkPLayer是Bilibili基于ffmpeg开发并开源的轻量级视频播放器,支持播放本地网络视频,也支持流媒体播放
     </p>
     <p>
      功能很强大，支持视频的软解码和硬解码
     </p>
    </blockquote>
    <h5 id="手动导入-ijkmediaframeworkframework-sdk-添加-libztbd依赖">
     手动导入
     <code>
      IJKMediaFramework.framework
     </code>
     SDK, 添加
     <code>
      libz.tbd
     </code>
     依赖
    </h5>
    <pre class="prettyprint"><code class="hljs java"><span class="hljs-keyword">import</span> IJKMediaFramework</code></pre>
    <h5 id="初始化播放器并进行播放">
     初始化播放器并进行播放
    </h5>
    <pre class="prettyprint"><code class="hljs fsharp">func playVideoByIJKPlayer() {

    <span class="hljs-comment">// 1.设置配置，打开硬解码</span>
    <span class="hljs-keyword">let</span> options = IJKFFOptions.byDefault()
    options?.setOptionIntValue(<span class="hljs-number">1</span>, forKey: <span class="hljs-string">"videotoolbox"</span>, <span class="hljs-keyword">of</span>: kIJKFFOptionCategoryPlayer)

    <span class="hljs-comment">// 2.初始化播放器</span>
    guard <span class="hljs-keyword">let</span> ijkPlayer = IJKFFMoviePlayerController(contentURLString: <span class="hljs-string">"http://baobab.wdjcdn.com/14559682994064.mp4"</span>, <span class="hljs-keyword">with</span>: options) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
    ijkPlayer.view.frame = playerView.bounds
    playerView.addSubview(ijkPlayer.view)

    <span class="hljs-comment">// 3.开始进行播放</span>
    ijkPlayer.prepareToPlay()
}</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f4d617a795f6d61:2f61727469636c652f64657461696c732f3738303430323736" class_="artid" style="display:none">
 </p>
</div>


