---
layout: post
title: "达梦数据库在Linux,信创云-安装,备份,还原"
date: 2025-03-07 11:05:22 +0800
description: "1操作系统：确认使用的是国产麒麟操作系统，检查系统版本是否兼容达梦数据库 V8。切换到root用进入dmdba用户根目录下，配置相对应环境变量，DM_HOME会在数据库安装完成之后自动导入。注册服务需要使用root用户注册，使用root用户进入数据库的安装目录的 /script/root下。将新建的路径目录权限的用户修改为 dmdba，用户组修改为 dinstall。配置的路径中的DAMENG就是第三步配置的名称，检查第三步所配置的是否一致。前言：系统环境检查，官网找对应版本处理器，操作系统的iso包。"
keywords: "达梦数据库安装信创版本"
categories: ['未分类']
tags: ['运维', '数据库', 'Linux']
artid: "146090615"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146090615
    alt: "达梦数据库在Linux,信创云-安装,备份,还原"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146090615
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146090615
cover: https://bing.ee123.net/img/rand?artid=146090615
image: https://bing.ee123.net/img/rand?artid=146090615
img: https://bing.ee123.net/img/rand?artid=146090615
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     达梦数据库在Linux，信创云 安装，备份，还原
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     （一）系统环境检查
     <br/>
     1操作系统：确认使用的是国产麒麟操作系统，检查系统版本是否兼容达梦数据库 V8。可以通过以下命令查看系统版本：
     <br/>
     cat /etc/os-release
    </p>
    <p>
     2硬件资源：确保服务器具备足够的硬件资源，建议最低配置为：
     <br/>
     CPU：2 核及以上
     <br/>
     内存：4GB 及以上
     <br/>
     磁盘空间：安装目录至少需要 2GB 可用空间，数据存储目录根据实际需求预留足够空间。
    </p>
    <p>
     <br/>
     命令
     <br/>
     （一）挂载资源cd /opt 切换到 opt 目录：把对应安装包放入上去
     <br/>
     安装包拖拽到 opt
     <br/>
     安装前必须创建 dmdba 用户，禁止使用 root 用户安装数据库
     <br/>
     （二）创建用户和用户组
     <br/>
     为了安全和管理方便，创建专门的用户和用户组来安装和运行达梦数据库。
     <br/>
     1.创建用户所在的组，命令如下：
     <br/>
     groupadd dinstall -g 2001
    </p>
    <p>
     2.创建用户，命令如下：
     <br/>
     useradd  -G dinstall -m -d /home/dmdba -s /bin/bash -u 2001 dmdba
    </p>
    <p>
     3.修改用户密码，命令如下：
     <br/>
     passwd dmdba
     <br/>
     passwd Dameng123
    </p>
    <p>
     （三）、修改文件打开最大数
     <br/>
     1.limits.conf追加参数 使用 root 用户
    </p>
    <p>
     vi /etc/security/limits.conf
    </p>
    <p>
     # 追加
     <br/>
     dmdba  soft      nice       0
     <br/>
     dmdba  hard      nice       0
     <br/>
     dmdba  soft      as         unlimited
     <br/>
     dmdba  hard      as         unlimited
     <br/>
     dmdba  soft      fsize      unlimited
     <br/>
     dmdba  hard      fsize      unlimited
     <br/>
     dmdba  soft      nproc      65536
     <br/>
     dmdba  hard      nproc      65536
     <br/>
     dmdba  soft      nofile     65536
     <br/>
     dmdba  hard      nofile     65536
     <br/>
     dmdba  soft      core       unlimited
     <br/>
     dmdba  hard      core       unlimited
     <br/>
     dmdba  soft      data       unlimited
     <br/>
     dmdba  hard      data       unlimited
    </p>
    <p>
     <br/>
     修改配置文件后重启服务器生效
    </p>
    <p>
     切换到 dmdba 用户，查看是否生效
     <br/>
     su - dmdba
     <br/>
     ulimit -a
     <br/>
     看到上面的65536对应上了就好
    </p>
    <p>
     <br/>
     （四）目录
     <br/>
     默认配置 DM 数据库安装在 /home/dmdba 文件夹下
     <br/>
     ##实例保存目录
     <br/>
     mkdir -p /dmdata/data
     <br/>
     ##归档保存目录
     <br/>
     mkdir -p /dmdata/arch
     <br/>
     ##备份保存目录
     <br/>
     mkdir -p /dmdata/dmbak
    </p>
    <p>
     4.1修改目录权限
     <br/>
     将新建的路径目录权限的用户修改为 dmdba，用户组修改为 dinstall。命令如下：
    </p>
    <p>
     chown -R dmdba:dinstall /dmdata/data
     <br/>
     chown -R dmdba:dinstall /dmdata/arch
     <br/>
     chown -R dmdba:dinstall /dmdata/dmbak
    </p>
    <p>
     给路径下的文件设置 755 权限。命令如下：
     <br/>
     chmod -R 755 /dmdata/data
     <br/>
     chmod -R 755 /dmdata/arch
     <br/>
     chmod -R 755 /dmdata/dmbak
    </p>
    <p>
     4.进行安装（opt是上传的路径，mnt是解压包安装路径）
     <br/>
     切换到 root 用户，将 DM 数据库的 iso 安装包保存在任意位置，例如 /opt 目录下，执行如下命令挂载镜像：
     <br/>
     cd  /opt
     <br/>
     mount -o loop dm8_20240116_x86_rh7_64.iso /mnt
    </p>
    <p>
     切换至 dmdba 用户
     <br/>
     su - dmdba
     <br/>
     cd /mnt
    </p>
    <p>
     执行安装命令：
     <br/>
     ./DMInstall.bin -i
    </p>
    <p>
     回答
     <br/>
     1 y y 21 1 y
    </p>
    <p>
     <br/>
     从这里开始都是用root用户进行操作
     <br/>
     su - root
    </p>
    <p>
     创建 DmAPService，否则会影响数据库备份
     <br/>
     /home/dmdba/dmdbms/script/root/root_installer.sh
    </p>
    <p>
     <br/>
     5.配置环境变量
     <br/>
     切换到root用进入dmdba用户根目录下，配置相对应环境变量，DM_HOME会在数据库安装完成之后自动导入
     <br/>
     cd /home/dmdba/
     <br/>
     vi .bash_profile
    </p>
    <p>
     <br/>
     su - dmdba
     <br/>
     source .bash_profile
    </p>
    <p>
     <br/>
     三、配置实例
     <br/>
     cd /home/dmdba/dmdbms/bin
    </p>
    <p>
     开始配置实例，初始化实例参数
     <br/>
     ./dminit path=/dmdata/data PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=N
     <br/>
     CHARSET=1 DB_NAME=DMTEST INSTANCE_NAME=DBSERVER PORT_NUM=5237 BUFFER=2048
     <br/>
     SYSDBA_PWD=MyDb@2025Pass SYSAUDITOR_PWD=Audit@2025Secure
    </p>
    <p>
     <br/>
     四、注册成服务
     <br/>
     注册服务需要使用root用户注册，使用root用户进入数据库的安装目录的 /script/root下
     <br/>
     cd /home/dmdba/dmdbms/script/root/
     <br/>
     注意：
     <br/>
     配置的路径中的DAMENG就是第三步配置的名称，检查第三步所配置的是否一致
     <br/>
     DMSERVER是即将被注册成服务的服务名
    </p>
    <p>
     ./dm_service_installer.sh -t dmserver -dm_ini /dmdata/data/DMTEST/dm.ini -p DMTEST
    </p>
    <p>
     备注（安装路径）
     <br/>
     cd /home/dmdba/dmdbms/bin
    </p>
    <p>
     五、启动、停止、重启数据库
     <br/>
     自动开机开启服务
     <br/>
     systemctl enable DmServiceDMTEST.service
    </p>
    <p>
     systemctl start DmServiceDMTEST.service
     <br/>
     systemctl stop  DmServiceDMTEST.service
     <br/>
     systemctl status DmServiceDMTEST.service
    </p>
    <p>
     或者目录启动
     <br/>
     cd /home/dmdba/dmdbms/bin
     <br/>
     ./DmServiceDMTEST stop
    </p>
    <p>
     <br/>
     查看是否打开防火墙，如果打开了，需要放开端口，不然不能访问
     <br/>
     firewall-cmd --zone=public --add-port=5237/tcp --permanent (permanent永久生效，没有此参数重启后失效)
     <br/>
     sudo firewall-cmd --reload
     <br/>
     sudo firewall-cmd --list-all
    </p>
    <p>
     测试访问
    </p>
    <p>
     页面设置定时备份：一周一个全量，一天一个增量
    </p>
    <p>
     删除30天前的数据代理脚本
     <br/>
     call SF_BAKSET_BACKUP_DIR_ADD('DISK', '/data/dmdata/dmbak');
     <br/>
     CALL SP_DB_BAKSET_REMOVE_BATCH('DISK', NOW()-30);
    </p>
    <p>
     查找
     <br/>
     find / -name "dm.ini" 2&gt;/dev/null
     <br/>
     find / -name "dmdbms" 2&gt;/dev/null
    </p>
    <p>
     文件查找/ n是下一个， sheft+n是上一个
    </p>
    <p>
     <br/>
     --修改最大访问数MAX_SESSIONS
     <br/>
     vi /dmdbms/data/DAMENG/dm.ini
    </p>
    <p>
     --设置账号密码
     <br/>
     ./dminit path=/dmdata/data PAGE_SIZE=32 EXTENT_SIZE=32 CASE_SENSITIVE=y CHARSET=1 DB_NAME=DMTEST INSTANCE_NAME=DBSERVER PORT_NUM=5237 SYSDBA_PWD=MyDb@2025Pass SYSAUDITOR_PWD=Audit@2025Secure
    </p>
    <p>
     1恢复全量数据命令
     <br/>
     CHECK BACKUPSET '/opt/DB_CDMZHD_FULL_2025_03_01_23_00_42.bak';
     <br/>
     RESTORE DATABASE '/dmdata/data/DMTEST/dm.ini' FROM BACKUPSET '/opt/DB_CDMZHD_FULL_2025_03_01_23_00_42';
    </p>
    <p>
     2恢复增量数据命令
     <br/>
     RECOVER DATABASE '/dmdata/data/DMTEST/dm.ini' FROM BACKUPSET '/opt/DB_CDMZHD_FULL_2025_03_01_23_00_42';
    </p>
    <p>
     3更新数据库
     <br/>
     RECOVER DATABASE '/dmdata/data/DMTEST/dm.ini' UPDATE DB_MAGIC;
     <br/>
    </p>
    <p>
    </p>
    <p>
     <span style="color:#fe2c24">
      注意！这里的是文件夹目录（依据备份产生的数据来）
     </span>
    </p>
    <p>
     里面的数据是全部要复制到指定目录里面去的
    </p>
    <p>
     <img alt="" height="353" src="https://i-blog.csdnimg.cn/direct/c9057a459fa14c639991e58ee25d53c4.png" width="1425"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <br/>
     --查看最大会话数
     <br/>
     SELECT SF_GET_PARA_VALUE(2, 'MAX_SESSIONS');
    </p>
    <p>
     <br/>
     -- 获取INI文件中的配置参数值
     <br/>
     SELECT SF_GET_PARA_VALUE(1, 'MAX_SESSIONS') FROM DUAL;
    </p>
    <p>
     -- 获取内存中的配置参数值
     <br/>
     SELECT SF_GET_PARA_VALUE(2, 'MAX_SESSIONS') FROM DUAL;
    </p>
    <p>
     --查看所有参数
     <br/>
     SELECT * FROM V$DM_INI;
    </p>
    <p>
     --获取CPU核心数
     <br/>
     SELECT N_CPU FROM V$SYSTEMINFO;
    </p>
    <p>
     --获取物理内存大小(GB)
     <br/>
     SELECT TOTAL_PHY_SIZE/1024/1024/1024 AS TOTAL_MEMORY_MB FROM V$SYSTEMINFO;
    </p>
    <p>
     <br/>
     DECLARE
     <br/>
     v_cpus INT;
     <br/>
     v_mem_mb INT;
     <br/>
     BEGIN
     <br/>
     -- 获取CPU核心数
     <br/>
     SELECT N_CPU INTO v_cpus FROM V$SYSTEMINFO;
    </p>
    <p>
     -- 获取物理内存大小（GB）
     <br/>
     SELECT TOTAL_PHY_SIZE/1024/1024/1024 INTO v_mem_mb FROM V$SYSTEMINFO;
    </p>
    <p>
     -- 输出结果
     <br/>
     PRINT 'CPU Cores: ' || v_cpus;
     <br/>
     PRINT 'Total Memory (GB): ' || v_mem_mb;
     <br/>
     END;
    </p>
    <p>
     <br/>
     SELECT * FROM V$PARAMETER WHERE NAME LIKE '%SVR_LOG%';
     <br/>
     SP_REFRESH_SVR_LOG_CONFIG();
     <br/>
     sp_set_para_value(1,'SVR_LOG',1);
    </p>
    <p>
     select * from v$parameter where name like 'SVR_LOG';
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37333634373731332f:61727469636c652f64657461696c732f313436303930363135" class_="artid" style="display:none">
 </p>
</div>


