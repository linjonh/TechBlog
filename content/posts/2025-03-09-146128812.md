---
layout: post
title: "动手学习深度学习12.权重衰退"
date: 2025-03-09 12:06:44 +0800
description: "权重衰退"
keywords: "[动手学习深度学习]12.权重衰退"
categories: ['深度学习']
tags: ['深度学习', '学习', '人工智能']
artid: "146128812"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146128812
    alt: "动手学习深度学习12.权重衰退"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146128812
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146128812
cover: https://bing.ee123.net/img/rand?artid=146128812
image: https://bing.ee123.net/img/rand?artid=146128812
img: https://bing.ee123.net/img/rand?artid=146128812
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [动手学习深度学习]12.权重衰退
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="1_0">
     </a>
     1.介绍
    </h2>
    <p>
     权重衰退是常见的处理过拟合的方法
    </p>
    <ul>
     <li>
      控制模型容量方法
      <ol>
       <li>
        把模型控制的比较小，即里面参数比较少
       </li>
       <li>
        使参数选择范围小
       </li>
      </ol>
     </li>
     <li>
      约束就是正则项
      <br/>
      每个特征的权重都大会导致模型复杂，从而导致过拟合。
      <br/>
      控制权重矩阵范数可以使得减少一些特征的权重，甚至使他们权重为0，从而导致模型简单，减轻过拟合
     </li>
    </ul>
    <h3>
     <a id="_8">
     </a>
     使用均方范数作为硬性限制
    </h3>
    <p>
     权重衰退即是通过控制参数选择范围来控制模型容量的
    </p>
    <ul>
     <li>
      公式表达：
      <br/>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         m 
         
        
          i 
         
        
          n 
         
        
            
         
        
          l 
         
        
          ( 
         
        
          w 
         
        
          , 
         
        
          b 
         
        
          ) 
         
        
             
         
        
          s 
         
        
          u 
         
        
          b 
         
        
          j 
         
        
          e 
         
        
          c 
         
        
          t 
         
        
            
         
        
          t 
         
        
          o 
         
        
          ∣ 
         
        
          ∣ 
         
        
          w 
         
        
          ∣ 
         
         
         
           ∣ 
          
         
           2 
          
         
        
          ≤ 
         
        
          θ 
         
        
       
         min\ l(w,b)\ \ subject\ to ||w||^2 ≤ \theta
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.0641em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           min
          </span>
          <span class="mspace">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0197em;">
           l
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal">
           b
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace">
          </span>
          <span class="mspace">
          </span>
          <span class="mord mathnormal">
           s
          </span>
          <span class="mord mathnormal">
           u
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0572em;">
           bj
          </span>
          <span class="mord mathnormal">
           ec
          </span>
          <span class="mord mathnormal">
           t
          </span>
          <span class="mspace">
          </span>
          <span class="mord mathnormal">
           t
          </span>
          <span class="mord mathnormal">
           o
          </span>
          <span class="mord">
           ∣∣
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
          <span class="mord">
           ∣
          </span>
          <span class="mord">
           <span class="mord">
            ∣
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           ≤
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           θ
          </span>
         </span>
        </span>
       </span>
      </span>
      <br/>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         l 
         
        
       
         l
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0197em;">
           l
          </span>
         </span>
        </span>
       </span>
      </span>
      ：损失函数
      <br/>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         w 
         
        
       
         w
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.4306em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
         </span>
        </span>
       </span>
      </span>
      ：参数
      <br/>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         b 
         
        
       
         b
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal">
           b
          </span>
         </span>
        </span>
       </span>
      </span>
      ：偏移
      <br/>
      在最小化损失函数时加上限制，使参数的平方和小于一个特定的值，也就说明每个参数的值要小于
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         θ 
         
        
       
         \theta
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           θ
          </span>
         </span>
        </span>
       </span>
      </span>
      开根
      <br/>
      通常不限制偏移b
      <br/>
      小的
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         θ 
         
        
       
         \theta
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           θ
          </span>
         </span>
        </span>
       </span>
      </span>
      意味着更强的正则项
     </li>
    </ul>
    <h3>
     <a id="_19">
     </a>
     使用均方范数作为柔性限制
    </h3>
    <ul>
     <li>
      Df：对每个
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         θ 
         
        
       
         \theta
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           θ
          </span>
         </span>
        </span>
       </span>
      </span>
      ，都可以找到
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         λ 
         
        
       
         \lambda
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal">
           λ
          </span>
         </span>
        </span>
       </span>
      </span>
      使得之前的目标函数等价于下面：
      <br/>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         m 
         
        
          i 
         
        
          n 
         
        
            
         
        
          l 
         
        
          ( 
         
        
          w 
         
        
          , 
         
        
          b 
         
        
          ) 
         
        
          + 
         
         
         
           λ 
          
         
           2 
          
         
        
          ∣ 
         
        
          ∣ 
         
        
          w 
         
        
          ∣ 
         
         
         
           ∣ 
          
         
           2 
          
         
        
       
         min \ l(w,b)+\frac{\lambda}{2} || w||^2
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal">
           min
          </span>
          <span class="mspace">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0197em;">
           l
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal">
           b
          </span>
          <span class="mclose">
           )
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           +
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.2251em; vertical-align: -0.345em;">
          </span>
          <span class="mord">
           <span class="mopen nulldelimiter">
           </span>
           <span class="mfrac">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8801em;">
               <span class="" style="top: -2.655em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.23em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="frac-line" style="border-bottom-width: 0.04em;">
                </span>
               </span>
               <span class="" style="top: -3.394em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   λ
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.345em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose nulldelimiter">
           </span>
          </span>
          <span class="mord">
           ∣∣
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0269em;">
           w
          </span>
          <span class="mord">
           ∣
          </span>
          <span class="mord">
           <span class="mord">
            ∣
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      <br/>
      （可以通过拉格朗日乘子来证明）
     </li>
     <li>
      超参数
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         λ 
         
        
       
         \lambda
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal">
           λ
          </span>
         </span>
        </span>
       </span>
      </span>
      控制了正则项的重要程度
      <ul>
       <li>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           λ 
           
          
            = 
           
          
            0 
           
          
         
           \lambda=0
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord mathnormal">
             λ
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.6444em;">
            </span>
            <span class="mord">
             0
            </span>
           </span>
          </span>
         </span>
        </span>
        ：无作用（当
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           λ 
           
          
            = 
           
          
            0 
           
          
         
           \lambda=0
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord mathnormal">
             λ
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.6444em;">
            </span>
            <span class="mord">
             0
            </span>
           </span>
          </span>
         </span>
        </span>
        时，即没有后面的限制，相当于上一个公式里
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           θ 
           
          
            = 
           
          
            ∞ 
           
          
         
           \theta=\infty
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0278em;">
             θ
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.4306em;">
            </span>
            <span class="mord">
             ∞
            </span>
           </span>
          </span>
         </span>
        </span>
        ）
       </li>
       <li>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           λ 
           
          
            → 
           
          
            ∞ 
           
          
            , 
           
           
           
             w 
            
           
             ∗ 
            
           
          
            → 
           
          
            0 
           
          
         
           \lambda \rightarrow \infty, w^* \rightarrow0
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord mathnormal">
             λ
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             →
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.8831em; vertical-align: -0.1944em;">
            </span>
            <span class="mord">
             ∞
            </span>
            <span class="mpunct">
             ,
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0269em;">
              w
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.6887em;">
                 <span class="" style="top: -3.063em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mbin mtight">
                    ∗
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             →
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.6444em;">
            </span>
            <span class="mord">
             0
            </span>
           </span>
          </span>
         </span>
        </span>
        ：相当于上面
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           θ 
           
          
            → 
           
          
            0 
           
          
         
           \theta \rightarrow0
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0278em;">
             θ
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             →
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.6444em;">
            </span>
            <span class="mord">
             0
            </span>
           </span>
          </span>
         </span>
        </span>
        ，也就使
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           w 
            
           
             ∗ 
            
           
          
            → 
           
          
            0 
           
          
         
           w^* \rightarrow0
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 0.6887em;">
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0269em;">
              w
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.6887em;">
                 <span class="" style="top: -3.063em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mbin mtight">
                    ∗
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             →
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.6444em;">
            </span>
            <span class="mord">
             0
            </span>
           </span>
          </span>
         </span>
        </span>
       </li>
      </ul>
     </li>
    </ul>
    <blockquote>
     <p>
      想通过控制模型参数使模型不要太复杂时，可以通过增加
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         λ 
         
        
       
         \lambda
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal">
           λ
          </span>
         </span>
        </span>
       </span>
      </span>
      来满足需求（这里
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         λ 
         
        
       
         \lambda
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6944em;">
          </span>
          <span class="mord mathnormal">
           λ
          </span>
         </span>
        </span>
       </span>
      </span>
      是一个平滑的，不像以前的硬性限制）
     </p>
    </blockquote>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/bb345392462e42f1bebc27ac06c4154b.png"/>
    </p>
    <ul>
     <li>
      这里可以理解拉格朗日乘子法：
      <ul>
       <li>
        拉格朗日乘子法原本是用于解决约束条件下的多元函数极值问题。举例，求f(x,y)的最小值，但是有约束C(x,y) = 0。乘子法给的一般思路是，构造一个新的函数g(x,y,λ) = f(x,y) +λC(x,y)，当同时满足g’x = g’y = 0时，函数取到最小值。这件结论的几何含义是，当f(x,y)与C(x,y)的等高线相切时，取到最小值。
       </li>
       <li>
        具体到机器学习这里，
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           C 
           
          
            ( 
           
          
            x 
           
          
            , 
           
          
            y 
           
          
            ) 
           
          
            = 
           
           
           
             w 
            
           
             2 
            
           
          
            − 
           
          
            θ 
           
          
         
           C(x,y) = w^2 -θ
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0715em;">
             C
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mord mathnormal">
             x
            </span>
            <span class="mpunct">
             ,
            </span>
            <span class="mspace" style="margin-right: 0.1667em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0359em;">
             y
            </span>
            <span class="mclose">
             )
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
            <span class="mrel">
             =
            </span>
            <span class="mspace" style="margin-right: 0.2778em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.8974em; vertical-align: -0.0833em;">
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0269em;">
              w
             </span>
             <span class="msupsub">
              <span class="vlist-t">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.8141em;">
                 <span class="" style="top: -3.063em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mtight">
                    2
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
            <span class="mbin">
             −
            </span>
            <span class="mspace" style="margin-right: 0.2222em;">
            </span>
           </span>
           <span class="base">
            <span class="strut" style="height: 0.6944em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0278em;">
             θ
            </span>
           </span>
          </span>
         </span>
        </span>
        。所以视频中的黄色圆圈，代表不同θ下的约束条件。θ越小，则最终的parameter离原点越近。
       </li>
      </ul>
     </li>
     <li>
      绿色的线就是原始损失函数l的等高线，优化损失函数l的最优解（波浪号即最优解）在中心位置
     </li>
     <li>
      当原始损失加入
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         λ 
          
         
           2 
          
         
        
       
         \frac{\lambda}{2}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.2251em; vertical-align: -0.345em;">
          </span>
          <span class="mord">
           <span class="mopen nulldelimiter">
           </span>
           <span class="mfrac">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8801em;">
               <span class="" style="top: -2.655em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mtight">
                   2
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.23em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="frac-line" style="border-bottom-width: 0.04em;">
                </span>
               </span>
               <span class="" style="top: -3.394em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   λ
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.345em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose nulldelimiter">
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      项之后，这个项是一个二次项，假如w就两个值，x1（横轴）x2（纵轴），则在图上这个二次项的损失以原点为中心的等高线为橙色的图所示。所以合并后的损失为绿色和黄色的线加一起的损失
     </li>
     <li>
      当加上损失项后，可知原来最优解对应的二次项的损失特别大，因此原来的最优解不是加上二次项后的公式的最优解了。若沿着橙色的方向走，原有l损失值会大一些，但是二次项罚的损失会变小，当拉到平衡点以内时，惩罚项减少的值不足以原有l损失增大的值，这样w*就是惩罚项后的最优解
     </li>
     <li>
      损失函数加上正则项成为目标函数，目标函数最优解不是损失函数最优解。
      <br/>
      正则项就是防止达到损失函数最优导致过拟合，把损失函数最优点往外拉一拉。 鼓励权重分散，将所有特征运用起来，而不是依赖其中的少数特征，并且权重分散的话他的内积就小一点
     </li>
     <li>
      l2正则项会对大叔之的权值进行惩罚
     </li>
    </ul>
    <p>
     回顾平方损失：
     <br/>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/b9fe594299bc4c71a7b5a31fa140adb7.png">
      <br/>
      相对原来的权重更新，再减去一个值后，使得这个权重更进一步减小，这样会导致这个权重所占的比例进一步减小
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/5e8ff4fff1fd4edd95d08eb888624aae.png"/>
     </img>
    </p>
    <h3>
     <a id="_43">
     </a>
     参数更新法则
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ac7eb31cb4684b6a8509b45ed489b570.png">
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/direct/bd9ef1ef3637437c91cfa9ffb25fcc6f.png"/>
     </img>
    </p>
    <h2>
     <a id="2__46">
     </a>
     2. 代码实现（手动实现）
    </h2>
    <pre><code class="prism language-python"><span class="token operator">%</span>matplotlib inline
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">from</span> d2l <span class="token keyword">import</span> torch <span class="token keyword">as</span> d2l
</code></pre>
    <p>
     像以前一样生成一些人工数据：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c46bd57f469744a8b8c8149388f522c9.png"/>
    </p>
    <pre><code class="prism language-python">n_train<span class="token punctuation">,</span> n_test<span class="token punctuation">,</span> num_inputs<span class="token punctuation">,</span> batch_size <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">5</span>
<span class="token comment"># 数据越简单，模型越复杂，越容易过拟合。</span>
<span class="token comment"># num_inputs：特征维度</span>

true_w<span class="token punctuation">,</span> true_b <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.05</span>
train_data <span class="token operator">=</span> d2l<span class="token punctuation">.</span>synthetic_data<span class="token punctuation">(</span>true_w<span class="token punctuation">,</span> true_b<span class="token punctuation">,</span> n_train<span class="token punctuation">)</span> <span class="token comment"># 生成人工数据集</span>
train_iter <span class="token operator">=</span> d2l<span class="token punctuation">.</span>load_array<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span>
test_data <span class="token operator">=</span> d2l<span class="token punctuation">.</span>synthetic_data<span class="token punctuation">(</span>true_w<span class="token punctuation">,</span> true_b<span class="token punctuation">,</span> n_test<span class="token punctuation">)</span>
test_iter <span class="token operator">=</span> d2l<span class="token punctuation">.</span>load_array<span class="token punctuation">(</span>test_data<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> is_train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># 初始化模型参数</span>
<span class="token keyword">def</span> <span class="token function">init_params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    w<span class="token operator">=</span>torch<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>size<span class="token operator">=</span><span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment"># 均值为0，方差为1，长度时num_inputs*1的向量，需要梯度</span>
    b<span class="token operator">=</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment"># b：为全0的标量</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span>b<span class="token punctuation">]</span>

<span class="token comment"># 定义L2范数惩罚项（核心）</span>
<span class="token keyword">def</span> <span class="token function">l2_penalty</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token comment"># 注意不要把lambda写进去，因为要写在外面</span>

<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>lambd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    w<span class="token punctuation">,</span> b <span class="token operator">=</span> init_params<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 初始化模型参数</span>
    net<span class="token punctuation">,</span> loss <span class="token operator">=</span> <span class="token keyword">lambda</span> X<span class="token punctuation">:</span>d2l<span class="token punctuation">.</span>linreg<span class="token punctuation">(</span>X<span class="token punctuation">,</span>w<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>squared_loss
    <span class="token comment"># net做了个很简单的线性回归</span>
    <span class="token comment"># 损失函数用平方损失</span>
    num_epochs<span class="token punctuation">,</span> lr <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0.003</span> <span class="token comment"># 因为数据量很小，所以可以多训练几次</span>
    animator <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Animator<span class="token punctuation">(</span>xlabel<span class="token operator">=</span><span class="token string">'epochs'</span><span class="token punctuation">,</span> ylabel<span class="token operator">=</span><span class="token string">'loss'</span><span class="token punctuation">,</span> yscale<span class="token operator">=</span><span class="token string">'log'</span><span class="token punctuation">,</span> xlim<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span>num_epochs<span class="token punctuation">]</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 实现动画效果</span>
    
    <span class="token comment"># 标准训练过程</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> X<span class="token punctuation">,</span>y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>
            <span class="token comment"># with torch.enable_grad():</span>
            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> lambd<span class="token operator">*</span>l2_penalty<span class="token punctuation">(</span>w<span class="token punctuation">)</span>  <span class="token comment"># L2范数惩罚项</span>
            l<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            d2l<span class="token punctuation">.</span>sgd<span class="token punctuation">(</span><span class="token punctuation">[</span>w<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span> <span class="token comment"># 使用小批量随机梯度下降迭代模型参数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">5</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            animator<span class="token punctuation">.</span>add<span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> 
                         <span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>evaluate_loss<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">,</span> 
                          d2l<span class="token punctuation">.</span>evaluate_loss<span class="token punctuation">(</span>net<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'w的L2范数是：'</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/66c4253a83d24202b146957c115618b4.png">
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/21ae7a6bc1de47188f984bda06dfb66e.png"/>
     </img>
    </p>
    <h2>
     <a id="3_105">
     </a>
     3.简单实现（使用框架）
    </h2>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">train_concise</span><span class="token punctuation">(</span>wd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    net<span class="token operator">=</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        param<span class="token punctuation">.</span>data<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
    num_epoch<span class="token punctuation">,</span> lr <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">0.003</span>
    trainer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"params"</span><span class="token punctuation">:</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">,</span><span class="token string">"weight_decay"</span><span class="token punctuation">:</span>wd<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'params'</span><span class="token punctuation">:</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
        lr<span class="token operator">=</span>lr<span class="token punctuation">)</span>
    <span class="token comment"># 惩罚项既可以写在目标函数里，也可以写在训练算法里，每一次更新之前把当前的w乘以衰退因子weight_decay</span>

    animator<span class="token operator">=</span>d2l<span class="token punctuation">.</span>Animator<span class="token punctuation">(</span>xlabel<span class="token operator">=</span><span class="token string">'epochs'</span><span class="token punctuation">,</span>ylabel<span class="token operator">=</span><span class="token string">'loss'</span><span class="token punctuation">,</span>yscale<span class="token operator">=</span><span class="token string">'log'</span><span class="token punctuation">,</span>xlim<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> num_epoch<span class="token punctuation">]</span><span class="token punctuation">,</span>legend<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> X<span class="token punctuation">,</span>y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>
            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>enable_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                trainer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
                l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span>
            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            trainer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                animator<span class="token punctuation">.</span>add<span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>evaluate_loss<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>evaluate_loss<span class="token punctuation">(</span>net<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'w的L2范数是：'</span><span class="token punctuation">,</span> net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7143e6f3c17140bf8a4f3f9f79ca9fd1.png"/>
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f79757269353135312f:61727469636c652f64657461696c732f313436313238383132" class_="artid" style="display:none">
 </p>
</div>


