---
layout: post
title: "Qt不同窗口类的控件信号和槽绑定"
date: 2025-03-11 14:03:02 +0800
description: "思来想去，我想了一个解决办法，我们需要的是控件的指针，那么不妨直接用一个类管理这些指针，就可以最小化暴露指针成员。具体的思路是这样的：使用一个哈希表，键自己定，值是一个控件的指针，为了所有的控件都可以放入哈希表，哈希表的值设置为void*，取出来的时候用户再自己进行强转。这样就统一管理的需要的控件，所有的connect都可以在mainWindow进行，相当于树的根节点，表除了可以插入信号控件的指针，也可以插入槽控件的指针，写起来就比较舒服了。"
keywords: "Qt不同窗口类的控件信号和槽绑定"
categories: ['Qt']
tags: ['Qt']
artid: "146177121"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146177121
    alt: "Qt不同窗口类的控件信号和槽绑定"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146177121
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146177121
cover: https://bing.ee123.net/img/rand?artid=146177121
image: https://bing.ee123.net/img/rand?artid=146177121
img: https://bing.ee123.net/img/rand?artid=146177121
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Qt不同窗口类的控件信号和槽绑定
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     做项目的时候我使用了Qt，不同的界面使用了不同的ui的类进行解耦，但是信号和槽绑定的时候可能是不同界面的控件互相进行通讯连接，然而ui指针对于各个界面类是私有成员，无法直接跳过访问，在网上看了一些参考资料，感觉都不太好，以下是几种可行的方案：
    </p>
    <ol>
     <li>
      把ui成员变成一个public成员，但这样不仅破坏了封装性，而且把所有的ui成员全部暴露出去了。
     </li>
     <li>
      使用一个static指针来将当前的界面指针传到外面，但是如果多个界面都要这样设计指针满天飞感觉非常的凌乱。
     </li>
     <li>
      使用类似职责链模式将信号和槽进行一层层传递，但是要写很多层，太麻烦了。
     </li>
    </ol>
    <p>
     思来想去，我想了一个解决办法，我们需要的是控件的指针，那么不妨直接用一个类管理这些指针，就可以最小化暴露指针成员。具体的思路是这样的：使用一个哈希表，键自己定，值是一个控件的指针，为了所有的控件都可以放入哈希表，哈希表的值设置为void*，取出来的时候用户再自己进行强转。
    </p>
    <ul>
     <li>
      SignalSlotObjectMap.h
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SIGNAL_SLOT_OBJECT_MAP_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SIGNAL_SLOT_OBJECT_MAP_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QString&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMap&gt;</span></span>
<span class="token keyword">class</span> <span class="token class-name">SignalSlotObjectMap</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">InsertSignalObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">InsertSlotObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">FindSignalObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">FindSlotObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">DebugPrintMap</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> QMap<span class="token operator">&lt;</span>QString<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">&gt;</span> s_signalObjectMap<span class="token punctuation">;</span>
    <span class="token keyword">static</span> QMap<span class="token operator">&lt;</span>QString<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">&gt;</span> s_slotObjectMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// SIGNAL_SLOT_OBJECT_MAP_H</span></span>
</code></pre>
    <ul>
     <li>
      SignalSlotObjectMap.cpp
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SignalSlotObjectMap.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token comment">// 初始化静态成员变量</span>
QMap<span class="token operator">&lt;</span>QString<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">&gt;</span> SignalSlotObjectMap<span class="token double-colon punctuation">::</span>s_signalObjectMap <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
QMap<span class="token operator">&lt;</span>QString<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">&gt;</span> SignalSlotObjectMap<span class="token double-colon punctuation">::</span>s_slotObjectMap <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">InsertSignalObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> it <span class="token operator">=</span> s_signalObjectMap<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> s_signalObjectMap<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    s_signalObjectMap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">InsertSlotObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> it <span class="token operator">=</span> s_slotObjectMap<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> s_slotObjectMap<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    s_slotObjectMap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">FindSignalObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> it <span class="token operator">=</span> s_signalObjectMap<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> s_signalObjectMap<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">FindSlotObjectMap</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> it <span class="token operator">=</span> s_slotObjectMap<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> s_slotObjectMap<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">DebugPrintMap</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"s_signalObjectMap:"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> s_signalObjectMap<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> s_signalObjectMap<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"key:"</span> <span class="token operator">&lt;&lt;</span> it<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">",value:"</span> <span class="token operator">&lt;&lt;</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"s_slotObjectMap:"</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> s_slotObjectMap<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> s_slotObjectMap<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"key:"</span> <span class="token operator">&lt;&lt;</span> it<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">",value:"</span> <span class="token operator">&lt;&lt;</span> it<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在我的场景里我想将mainWindow的OpenGLWidget发送的【
     <strong>
      信号
     </strong>
     】连接到mainWindow的tabView（我自己定义的一个继承自QWidget的类）的SimSettingWidget（也是我自己定义的一个继承自QWidget的类）的一个lineEdit_Fps控件【
     <strong>
      槽
     </strong>
     】显示我的帧率，首先先统一插入到静态的Slot哈希表，这写在SimSettingWidget的构造函数里
    </p>
    <pre><code class="prism language-cpp"><span class="token class-name">SimSettingWidget</span><span class="token double-colon punctuation">::</span><span class="token function">SimSettingWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                      <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token double-colon punctuation">::</span>SimSettingWidget<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">InsertSlotObjectMap</span><span class="token punctuation">(</span><span class="token string">"lineEditFps"</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>lineEdit_Fps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这样mainWindow里把这个指针取出来就行了：
    </p>
    <pre><code class="prism language-cpp">
<span class="token class-name">MainWindow</span><span class="token double-colon punctuation">::</span><span class="token function">MainWindow</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">QMainWindow</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token double-colon punctuation">::</span>MainWindow<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 其他程序</span>
    QLineEdit <span class="token operator">*</span>lineEditFps <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>QLineEdit <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">SignalSlotObjectMap</span><span class="token double-colon punctuation">::</span><span class="token function">FindSlotObjectMap</span><span class="token punctuation">(</span><span class="token string">"lineEditFps"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>widget_robotSim<span class="token punctuation">,</span> <span class="token operator">&amp;</span>RobotView<span class="token double-colon punctuation">::</span>sendFPS<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>lineEditFps<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">float</span> currentFPS<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span> lineEditFps<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>currentFPS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这样就统一管理的需要的控件，所有的connect都可以在mainWindow进行，相当于树的根节点，表除了可以插入信号控件的指针，也可以插入槽控件的指针，写起来就比较舒服了。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f7375627469746c655f2f:61727469636c652f64657461696c732f313436313737313231" class_="artid" style="display:none">
 </p>
</div>


