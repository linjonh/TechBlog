---
layout: post
title: "搭建基于flask的web应用框架"
date: 2025-03-14 21:27:22 +0800
description: "它可以自动生成迁移脚本，并将数据库模式的变化（如新增字段、修改字段类型）应用到数据库中。允许你将应用程序拆分为多个模块或组件，每个组件可以定义自己的路由、模板、静态文件等。如果后续要修改数据库里表的字段，修改完之后要在控制台运行以下命令才能进行同步。在models模块包下创建user.py，此文件描述用户相关的表。这个时候访问对应的路由，数据库里就能看到对应的操作结果了。文件，创建核心对象的类里调用函数。文件里导入核心对象，并运行。文件里创建类，并读取配置。文件，用于对用户的相关操作。"
keywords: "搭建基于flask的web应用框架"
categories: ['项目', 'Python']
tags: ['Python', 'Flask']
artid: "146267551"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146267551
    alt: "搭建基于flask的web应用框架"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146267551
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146267551
cover: https://bing.ee123.net/img/rand?artid=146267551
image: https://bing.ee123.net/img/rand?artid=146267551
img: https://bing.ee123.net/img/rand?artid=146267551
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     搭建基于flask的web应用框架
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="flaskweb_1">
     </a>
     搭建基于flask的web应用框架
    </h2>
    <h3>
     <a id="_2">
     </a>
     一、创建项目
    </h3>
    <p>
     具体看另一篇文章：
     <br/>
     <a href="https://blog.csdn.net/qq_45742976/article/details/132028753">
      https://blog.csdn.net/qq_45742976/article/details/132028753
     </a>
    </p>
    <p>
     我之后要创建的的文件，大致如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ff2094ed4b80421c8c7ee132bdc832d1.png"/>
    </p>
    <h3>
     <a id="_9">
     </a>
     二、项目依赖包
    </h3>
    <p>
     创建一个
     <code>
      requirements.txt
     </code>
     文件
    </p>
    <pre><code>flask
flask_cors
requests
flask_sqlalchemy
pymysql
flask_migrate
flask_mail
Flask-Caching
PyJWT
bcrypt==4.1.1
cryptography==41.0.2
</code></pre>
    <p>
     在控制台一键安装这些包
    </p>
    <pre><code>pip install -r requirements.txt
</code></pre>
    <h3>
     <a id="_29">
     </a>
     三、项目总体配置文件
    </h3>
    <ol>
     <li>
      创建一个
      <code>
       config
      </code>
      目录，目录下创建一个
      <code>
       settings.py
      </code>
      文件
     </li>
     <li>
      写下总体配置
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token comment"># 配置  </span>
<span class="token comment"># 全为大写：from_object的硬性判断  </span>
<span class="token comment"># DEBUG开启调试模式，应用程序会提供详细的错误信息和日志  </span>
DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>  
HOST <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>  
PORT <span class="token operator">=</span> <span class="token number">8000</span>  
  
<span class="token comment"># 这里可以保存全局变量，作为配置  </span>

</code></pre>
    <h3>
     <a id="_44">
     </a>
     四、创建核心对象
    </h3>
    <p>
     在
     <code>
      app.py
     </code>
     文件里创建类，并读取配置
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 核心对象的设置和创建  </span>
<span class="token comment"># 把配置读入app.config：从config.settings里读，从系统环境变量flask_conf里读取配置  </span>
<span class="token keyword">import</span> os  
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask  
  
<span class="token keyword">def</span> <span class="token function">create_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 创建核心对象,一个 Flask 应用程序实例  </span>
    tz_app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>  
  
	<span class="token comment"># 从Python模块加载配置  </span>
	tz_app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span><span class="token string">'config.settings'</span><span class="token punctuation">)</span>  
	<span class="token keyword">if</span> <span class="token string">'FLASK_CONF'</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">:</span>  
	    <span class="token comment"># 从环境变量指定的文件加载配置  </span>
	    tz_app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_envvar<span class="token punctuation">(</span><span class="token string">'FLASK_CONF'</span><span class="token punctuation">)</span>
	
	<span class="token comment"># 可以先写一个路由</span>
    <span class="token decorator annotation punctuation">@tz_app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>  
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token keyword">return</span> <span class="token string">"index"</span>  
  
    <span class="token keyword">return</span> tz_app
</code></pre>
    <h3>
     <a id="_70">
     </a>
     五、启动文件
    </h3>
    <p>
     在
     <code>
      server.py
     </code>
     文件里导入核心对象，并运行
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 启动文件，程序入口  </span>
<span class="token keyword">from</span> app <span class="token keyword">import</span> create_app  
  
<span class="token comment"># 创建flask应用程序的实例  </span>
tz_app <span class="token operator">=</span> create_app<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>  
    <span class="token comment"># 使用内置小型服务器启动app应用  </span>
    tz_app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span>tz_app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'HOST'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
                port<span class="token operator">=</span>tz_app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'PORT'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
                debug<span class="token operator">=</span>tz_app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'DEBUG'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     运行之后就可以在页面
     <a href="http://127.0.0.1:8000" rel="nofollow">
      http://127.0.0.1:8000
     </a>
     看见“index”了
    </p>
    <h3>
     <a id="_87">
     </a>
     六、引入蓝图
    </h3>
    <p>
     允许你将应用程序拆分为多个模块或组件，每个组件可以定义自己的路由、模板、静态文件等。
     <br/>
     蓝图的主要目的是让大型应用程序更易于维护和扩展。
    </p>
    <ol>
     <li>
      创建一个
      <code>
       route
      </code>
      模块包
     </li>
     <li>
      在
      <code>
       route
      </code>
      目录下创建一个
      <code>
       user
      </code>
      模块包，用于用户管理
     </li>
     <li>
      在
      <code>
       user
      </code>
      下自带的
      <code>
       __init__.py
      </code>
      文件中创建蓝图对象
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token comment"># user_bp用户管理  </span>
  
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint  
  
<span class="token comment"># 创建蓝图对象  </span>
<span class="token comment"># Blueprint("蓝图名称", 模块名称, url_prefix="为蓝图中的所有路由添加前缀")  </span>
user_bp <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">"user_bp"</span><span class="token punctuation">,</span> __name__<span class="token punctuation">,</span> url_prefix<span class="token operator">=</span><span class="token string">"/v1/user"</span><span class="token punctuation">)</span>  
</code></pre>
    <p>
     <code>
      route
     </code>
     目录下自带的
     <code>
      init
     </code>
     文件中定义一个函数，注册这个蓝图
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>user <span class="token keyword">import</span> user_bp  
  
<span class="token keyword">def</span> <span class="token function">route_tz_app</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 在需要时注册蓝图  </span>
    app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>user_bp<span class="token punctuation">)</span>
</code></pre>
    <p>
     在
     <code>
      app.py
     </code>
     文件，创建核心对象的类里调用函数
    </p>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 创建核心对象，一个Flask应用程序实例</span>
    tz_app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>  
  
    <span class="token comment"># 从Python模块加载配置  </span>
    tz_app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span><span class="token string">'config.settings'</span><span class="token punctuation">)</span>  
    <span class="token keyword">if</span> <span class="token string">'FLASK_CONF'</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">:</span>  
        <span class="token comment"># 从环境变量指定的文件加载配置  </span>
        tz_app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_envvar<span class="token punctuation">(</span><span class="token string">'FLASK_CONF'</span><span class="token punctuation">)</span>  
  
    <span class="token decorator annotation punctuation">@tz_app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>  
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token keyword">return</span> <span class="token string">"index"</span>  
  
    <span class="token comment"># 调用函数，将蓝图注册到应用程序（绑定路由与app）  </span>
    <span class="token keyword">import</span> route  
    route<span class="token punctuation">.</span>route_tz_app<span class="token punctuation">(</span>tz_app<span class="token punctuation">)</span>  
  
    <span class="token keyword">return</span> tz_app
</code></pre>
    <p>
     现在可以在
     <code>
      user
     </code>
     模块包下创建一个
     <code>
      user_routes.py
     </code>
     文件，写路由了
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 导入蓝图  </span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> user_bp  
  
<span class="token comment"># 使用蓝图定义路由  </span>
<span class="token decorator annotation punctuation">@user_bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>  
<span class="token keyword">def</span> <span class="token function">user_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">return</span> <span class="token string">"user_list"</span>
</code></pre>
    <p>
     记得在
     <code>
      roure/user/__init__.py
     </code>
     文件里导入路由文件
    </p>
    <pre><code class="prism language-python"><span class="token comment"># user_bp用户管理  </span>
  
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint  
  
<span class="token comment"># 创建蓝图对象  </span>
<span class="token comment"># Blueprint("蓝图名称", 模块名称, url_prefix="为蓝图中的所有路由添加前缀")  </span>
user_bp <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">"user_bp"</span><span class="token punctuation">,</span> __name__<span class="token punctuation">,</span> url_prefix<span class="token operator">=</span><span class="token string">"/user"</span><span class="token punctuation">)</span>  
  
<span class="token comment"># 只有在路由文件被导入时，装饰器才会生效，路由函数才会被注册到蓝图中</span>
<span class="token comment"># 如果没有导入，访问时会返回404，路由函数不会被调用</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> user_routes
</code></pre>
    <p>
     现在在页面上访问
     <code>
      /user/list
     </code>
     ，将展示“user_list”
    </p>
    <h3>
     <a id="_160">
     </a>
     七、连接数据库
    </h3>
    <p>
     在
     <code>
      settings.py
     </code>
     文件写下数据库配置
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 配置  </span>
<span class="token comment"># 全为大写：from_object的硬性判断  </span>
<span class="token comment"># DEBUG开启调试模式，应用程序会提供详细的错误信息和日志  </span>
DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>  
HOST <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>  
PORT <span class="token operator">=</span> <span class="token number">8000</span>  
  
<span class="token comment"># 这里可以保存全局变量，作为配置  </span>
  
<span class="token comment"># orm数据库连接设置  </span>
<span class="token comment"># 使用pymysql连接  </span>
<span class="token comment"># mysql://username:password@ip:port/database  </span>
<span class="token comment"># 将 # 编码为 %23</span>
SQLALCHEMY_DATABASE_URI <span class="token operator">=</span> <span class="token string">"mysql+pymysql://root:Chen%23123@192.168.190.110:3306/tz"</span>
</code></pre>
    <p>
     创建
     <code>
      models
     </code>
     模块包，在自带的
     <code>
      __init__.py
     </code>
     文件里写下：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 这是models模块的初始化文件，用于定义和初始化 SQLAlchemy 对象。</span>
<span class="token comment"># ORM 对象关系映射  </span>
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy  
  
<span class="token comment"># 创建一个SQLAlchemy对象db，用于管理数据库操作 </span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
<span class="token comment"># 绑定app，db就可以在应用程序中使用</span>
<span class="token keyword">def</span> <span class="token function">init_db</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
</code></pre>
    <p>
     在
     <code>
      app.py
     </code>
     里调用
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> os  
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask  
  
<span class="token keyword">def</span> <span class="token function">create_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 创建核心对象，一个Flask应用程序实例  </span>
    tz_app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>  
  
    <span class="token comment"># 从Python模块加载配置  </span>
    tz_app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span><span class="token string">'config.settings'</span><span class="token punctuation">)</span>  
    <span class="token keyword">if</span> <span class="token string">'FLASK_CONF'</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">:</span>  
        <span class="token comment"># 从环境变量指定的文件加载配置  </span>
        tz_app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_envvar<span class="token punctuation">(</span><span class="token string">'FLASK_CONF'</span><span class="token punctuation">)</span>  
  
    <span class="token decorator annotation punctuation">@tz_app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>  
    <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        <span class="token keyword">return</span> <span class="token string">"index"</span>  
  
    <span class="token comment"># 调用函数，将蓝图注册到应用程序（绑定路由与app）  </span>
    <span class="token keyword">import</span> route  
    route<span class="token punctuation">.</span>route_tz_app<span class="token punctuation">(</span>tz_app<span class="token punctuation">)</span>  
  
    <span class="token comment"># 将db对象绑定到应用程序  </span>
    <span class="token keyword">import</span> models  
    models<span class="token punctuation">.</span>init_db<span class="token punctuation">(</span>tz_app<span class="token punctuation">)</span>  
  
    <span class="token comment"># 在应用程序上下文中，自动创建和更新数据库表  </span>
    <span class="token keyword">from</span> models <span class="token keyword">import</span> db  
    <span class="token keyword">with</span> tz_app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
        db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
    <span class="token keyword">return</span> tz_app
</code></pre>
    <p>
     在
     <code>
      server.py
     </code>
     文件里
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 启动文件，程序入口  </span>
<span class="token keyword">from</span> app <span class="token keyword">import</span> create_app  
  
<span class="token comment"># 创建flask应用程序的实例  </span>
tz_app <span class="token operator">=</span> create_app<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
<span class="token keyword">from</span> flask_migrate <span class="token keyword">import</span> Migrate  
<span class="token keyword">from</span> models <span class="token keyword">import</span> db  
<span class="token comment"># 创建一个迁移对象，将应用程序tz_app与数据库db关联  </span>
migrate <span class="token operator">=</span> Migrate<span class="token punctuation">(</span>tz_app<span class="token punctuation">,</span> db<span class="token punctuation">)</span>  
  
  
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>  
    <span class="token comment"># 使用内置小型服务器启动app应用  </span>
    tz_app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span>tz_app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'HOST'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
                port<span class="token operator">=</span>tz_app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'PORT'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
                debug<span class="token operator">=</span>tz_app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'DEBUG'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     打开控制台，输入以下命令
    </p>
    <pre><code># 将server.py作为程序的入口文件
set FLASK_APP=server.py

# 初始化迁移环境
flask db init
# 初始化之后，会出现migrations目录

# 生成迁移脚本，记录数据库模型的变更
flask db migrate

# 应用迁移脚本，更新数据库表结构
flask db upgrade
</code></pre>
    <p>
     如果后续要修改数据库里表的字段，修改完之后要在控制台运行以下命令才能进行同步
    </p>
    <pre><code>flask db migrate
flask db upgrade
</code></pre>
    <blockquote>
     <p>
      Flask-Migrate 是一个 Flask 扩展，用于处理数据库迁移。它可以自动生成迁移脚本，并将数据库模式的变化（如新增字段、修改字段类型）应用到数据库中。
     </p>
     <ul>
      <li>
       迁移脚本记录了数据库模式的变化历史，便于回滚和版本控制。
      </li>
      <li>
       回滚到上一个迁移版本：
       <code>
        flask db downgrade
       </code>
      </li>
     </ul>
    </blockquote>
    <h3>
     <a id="ORM_271">
     </a>
     八、数据库操作（ORM）
    </h3>
    <h4>
     <a id="_272">
     </a>
     创建表
    </h4>
    <p>
     在models模块包下创建user.py，此文件描述用户相关的表
    </p>
    <pre><code class="prism language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> db  
  
<span class="token comment"># User类继承自db.Model，表示这是一个数据库模型类  </span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 定义表名  </span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"user"</span>  
    <span class="token comment"># 定义关键字  </span>
    <span class="token comment"># 关键字=db.Column(数据类型(长度)，primary_key是否主键，autoincrement是否自增，nullable是否可以为空)  </span>
    user_id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
    password <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  
    email <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
    avatar <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'https://books.toscrape.com/static/oscar/favicon.ico'</span><span class="token punctuation">)</span>```
记得在init文件里导入一下
```python
<span class="token comment"># ORM 对象关系映射  </span>
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy  
  
<span class="token comment"># 生成对象关系映射  </span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
<span class="token comment"># 绑定app  </span>
<span class="token keyword">def</span> <span class="token function">init_db</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>  
  
<span class="token comment"># 导入user模块，确保User模型被注册到db对象中  </span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> user
</code></pre>
    <p>
     这个时候运行程序，就能看到库里有user表了
    </p>
    <h4>
     <a id="_306">
     </a>
     操作表数据
    </h4>
    <p>
     <code>
      route/user/user_routes.py
     </code>
     文件，用于对用户的相关操作
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 导入蓝图  </span>
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> user_bp  
<span class="token keyword">from</span> models<span class="token punctuation">.</span>user <span class="token keyword">import</span> User  
<span class="token keyword">from</span> models <span class="token keyword">import</span> db  
<span class="token comment"># 数据以json格式返回</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> jsonify  
  
<span class="token comment"># 使用蓝图定义路由  </span>
<span class="token decorator annotation punctuation">@user_bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>  
<span class="token keyword">def</span> <span class="token function">user_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># get查找  </span>
    <span class="token comment"># user = User.query.get(1)  </span>
    <span class="token comment"># print(user.username)    </span>
    <span class="token comment"># filter_by查找。filter_by根据条件查询  </span>
    <span class="token comment"># users = User.query.filter_by(username="test")  </span>
    <span class="token comment"># for user in users:  </span>
    <span class="token comment">#     print(user.username) </span>
    <span class="token comment"># 查询所有用户  </span>
    users <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token comment"># 结果以json格式返回  </span>
    user_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>  
        <span class="token string">"id"</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span>  
        <span class="token string">"username"</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>username  
    <span class="token punctuation">}</span> <span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">]</span>  
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>user_list<span class="token punctuation">)</span>  
  
<span class="token decorator annotation punctuation">@user_bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">)</span>  
<span class="token keyword">def</span> <span class="token function">user_register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token comment"># 1. 创建ORM对象  </span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"test1"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"t1"</span><span class="token punctuation">)</span>  
    <span class="token comment"># 2. 将ORM对象添加到db.session数据库会话中  </span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  
    <span class="token comment"># 提交会话，将db.session中的改变同步到数据库  </span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token keyword">return</span> <span class="token string">"用户创建成功"</span>  
  
<span class="token decorator annotation punctuation">@user_bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>  
<span class="token keyword">def</span> <span class="token function">user_update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    user<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">"22"</span>  
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token keyword">return</span> <span class="token string">"修改成功"</span>  
  
<span class="token decorator annotation punctuation">@user_bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>  
<span class="token keyword">def</span> <span class="token function">user_delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token keyword">return</span> <span class="token string">"删除成功"</span>
</code></pre>
    <p>
     这个时候访问对应的路由，数据库里就能看到对应的操作结果了
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34353734323937362f:61727469636c652f64657461696c732f313436323637353531" class_="artid" style="display:none">
 </p>
</div>


