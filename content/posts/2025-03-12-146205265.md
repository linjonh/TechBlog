---
layout: post
title: "通过-DeepSeek-辅助生成接口测试用例"
date: 2025-03-12 14:50:10 +0800
description: "assert actual_response.get(key) == value, f\"响应字段 {key} 校验失败，期望: {value}，实际: {actual_response.get(key)}\"\"prompt\": f\"根据以下接口文档生成接口测试用例（包含正常场景、异常场景和边界值）：\\n\\n{api_doc}\"- **语义理解**：自动提取接口文档中的参数、方法、请求示例和响应示例。- **用例生成**：生成包括正常、异常、边界值等场景的接口测试用例。"
keywords: "通过 **DeepSeek** 辅助生成接口测试用例"
categories: ['未分类']
tags: ['运维', '服务器']
artid: "146205265"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146205265
    alt: "通过-DeepSeek-辅助生成接口测试用例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146205265
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146205265
cover: https://bing.ee123.net/img/rand?artid=146205265
image: https://bing.ee123.net/img/rand?artid=146205265
img: https://bing.ee123.net/img/rand?artid=146205265
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     通过 **DeepSeek** 辅助生成接口测试用例
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      在接口测试中，测试工程师通常需要根据开发提供的接口文档手动编写测试用例。这种方式不仅耗时，还容易遗漏边界场景。通过 **DeepSeek** 模型的语义理解能力，可以自动从接口文档中生成详细的接口测试用例，并结合 pytest 和 YAML 测试框架，打造一套高效、易于维护、可扩展的接口测试解决方案。
     </strong>
    </p>
    <p>
    </p>
    <p>
     <strong>
      目标
     </strong>
    </p>
    <p>
    </p>
    <p>
     1. **快速生成接口测试用例**：
    </p>
    <p>
     - 根据开发提供的接口文档，自动生成接口测试用例，覆盖正常场景、异常场景和边界值。
    </p>
    <p>
     2. **构建 pytest + YAML 测试框架**：
    </p>
    <p>
     - 通过 YAML 文件定义测试数据，实现测试数据与代码分离。
    </p>
    <p>
     3. **具备实战价值**：
    </p>
    <p>
     - 支持动态用例生成，易扩展，适合不同项目场景。
    </p>
    <p>
     4. **实现自动化测试**：
    </p>
    <p>
     - 自动调用接口并校验返回值，生成详细的测试报告。
    </p>
    <p>
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <p>
     <strong>
      方案设计
     </strong>
    </p>
    <p>
    </p>
    <p>
     ### **1. DeepSeek 的作用**
    </p>
    <p>
     通过本地部署的 DeepSeek 模型，解析输入的接口文档，生成接口测试用例。DeepSeek 的具体作用包括：
    </p>
    <p>
     - **语义理解**：自动提取接口文档中的参数、方法、请求示例和响应示例。
    </p>
    <p>
     - **用例生成**：生成包括正常、异常、边界值等场景的接口测试用例。
    </p>
    <p>
    </p>
    <p>
     ### **2. pytest + YAML 测试框架**
    </p>
    <p>
     - **测试数据驱动**：测试用例和测试数据存储在 YAML 文件中，代码只需读取并执行，降低维护成本。
    </p>
    <p>
     - **高复用性**：通过 pytest 的参数化功能，动态加载 YAML 文件中的用例。
    </p>
    <p>
     - **易扩展**：支持多接口、多用例的管理和执行。
    </p>
    <p>
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <p>
     ## **接口文档示例**
    </p>
    <p>
    </p>
    <p>
     以下是开发提供的接口文档示例（`api_doc.md`）：
    </p>
    <p>
    </p>
    <p>
     markdown
    </p>
    <p>
     ### 接口：用户登录
    </p>
    <p>
     - URL: `/api/v1/login`
    </p>
    <p>
     - 方法: `POST`
    </p>
    <p>
     - 请求参数:
    </p>
    <p>
     - `username` (string): 用户名，必填
    </p>
    <p>
     - `password` (string): 密码，必填
    </p>
    <p>
     - 响应示例:
    </p>
    <p>
     ```json
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     "status": "success",
    </p>
    <p>
     "data": {
     <!-- -->
    </p>
    <p>
     "user_id": 12345,
    </p>
    <p>
     "token": "abc123"
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     ```
    </p>
    <p>
    </p>
    <p>
     ### 接口：获取用户信息
    </p>
    <p>
     - URL: `/api/v1/user`
    </p>
    <p>
     - 方法: `GET`
    </p>
    <p>
     - 请求参数:
    </p>
    <p>
     - `user_id` (integer): 用户 ID，必填
    </p>
    <p>
     - `token` (string): 访问令牌，必填
    </p>
    <p>
     - 响应示例:
    </p>
    <p>
     ```json
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     "status": "success",
    </p>
    <p>
     "data": {
     <!-- -->
    </p>
    <p>
     "user_id": 12345,
    </p>
    <p>
     "username": "test_user",
    </p>
    <p>
     "email": "test_user@example.com"
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <p>
     <strong>
      通过 DeepSeek 生成接口测试用例**
     </strong>
    </p>
    <p>
    </p>
    <p>
     ### **调用 DeepSeek 推理服务**
    </p>
    <p>
    </p>
    <p>
     以下代码使用 DeepSeek 模型解析接口文档并生成接口测试用例。
    </p>
    <p>
     import requests
    </p>
    <p>
    </p>
    <p>
     # 本地 Ollama DeepSeek 推理服务地址
    </p>
    <p>
     DEESEEK_API_URL = "http://localhost:11434/api/generate"
    </p>
    <p>
    </p>
    <p>
     def generate_test_cases_from_docs(api_doc_path):
    </p>
    <p>
     """
    </p>
    <p>
     调用 DeepSeek，根据接口文档生成测试用例
    </p>
    <p>
     """
    </p>
    <p>
     with open(api_doc_path, "r", encoding="utf-8") as f:
    </p>
    <p>
     api_doc = f.read()
    </p>
    <p>
    </p>
    <p>
     # 构造 DeepSeek 请求
    </p>
    <p>
     payload = {
     <!-- -->
    </p>
    <p>
     "model": "deepseek-r1:1.5b",
    </p>
    <p>
     "prompt": f"根据以下接口文档生成接口测试用例（包含正常场景、异常场景和边界值）：\n\n{api_doc}"
    </p>
    <p>
     }
    </p>
    <p>
     headers = {"Content-Type": "application/json"}
    </p>
    <p>
    </p>
    <p>
     try:
    </p>
    <p>
     # 调用 DeepSeek API
    </p>
    <p>
     response = requests.post(DEESEEK_API_URL, json=payload, headers=headers)
    </p>
    <p>
     response.raise_for_status()
    </p>
    <p>
     result = response.json()
    </p>
    <p>
     return result.get("response", "")
    </p>
    <p>
     except requests.exceptions.RequestException as e:
    </p>
    <p>
     print(f"调用 DeepSeek API 失败: {e}")
    </p>
    <p>
     return None
    </p>
    <p>
    </p>
    <p>
     # 示例接口文档路径
    </p>
    <p>
     api_doc_path = "api_doc.md"
    </p>
    <p>
     generated_test_cases = generate_test_cases_from_docs(api_doc_path)
    </p>
    <p>
    </p>
    <p>
     # 保存生成的测试用例到 YAML 文件
    </p>
    <p>
     if generated_test_cases:
    </p>
    <p>
     with open("test_cases.yml", "w", encoding="utf-8") as f:
    </p>
    <p>
     f.write(generated_test_cases)
    </p>
    <p>
     print("测试用例已生成并保存到 test_cases.yml")
    </p>
    <p>
     else:
    </p>
    <p>
     print("未能生成测试用例，请检查 DeepSeek 服务状态或输入文档格式。")
    </p>
    <p>
    </p>
    <p>
     生成的 YAML 测试用例**
    </p>
    <p>
    </p>
    <p>
     DeepSeek 生成的 `test_cases.yml` 文件示例如下：
    </p>
    <p>
    </p>
    <p>
     ```yaml
    </p>
    <p>
     - api: /api/v1/login
    </p>
    <p>
     method: POST
    </p>
    <p>
     test_cases:
    </p>
    <p>
     - name: 正常登录
    </p>
    <p>
     request:
    </p>
    <p>
     username: test_user
    </p>
    <p>
     password: test_password
    </p>
    <p>
     expected_response:
    </p>
    <p>
     status: success
    </p>
    <p>
     - name: 用户名为空
    </p>
    <p>
     request:
    </p>
    <p>
     username: ""
    </p>
    <p>
     password: test_password
    </p>
    <p>
     expected_response:
    </p>
    <p>
     status: error
    </p>
    <p>
     error_message: "用户名不能为空"
    </p>
    <p>
     - name: 密码为空
    </p>
    <p>
     request:
    </p>
    <p>
     username: test_user
    </p>
    <p>
     password: ""
    </p>
    <p>
     expected_response:
    </p>
    <p>
     status: error
    </p>
    <p>
     error_message: "密码不能为空"
    </p>
    <p>
    </p>
    <p>
     - api: /api/v1/user
    </p>
    <p>
     method: GET
    </p>
    <p>
     test_cases:
    </p>
    <p>
     - name: 正常获取用户信息
    </p>
    <p>
     request:
    </p>
    <p>
     user_id: 12345
    </p>
    <p>
     token: valid_token
    </p>
    <p>
     expected_response:
    </p>
    <p>
     status: success
    </p>
    <p>
     data:
    </p>
    <p>
     user_id: 12345
    </p>
    <p>
     username: test_user
    </p>
    <p>
     email: test_user@example.com
    </p>
    <p>
     - name: 用户 ID 无效
    </p>
    <p>
     request:
    </p>
    <p>
     user_id: -1
    </p>
    <p>
     token: valid_token
    </p>
    <p>
     expected_response:
    </p>
    <p>
     status: error
    </p>
    <p>
     error_message: "用户 ID 无效"
    </p>
    <p>
     - name: Token 无效
    </p>
    <p>
     request:
    </p>
    <p>
     user_id: 12345
    </p>
    <p>
     token: invalid_token
    </p>
    <p>
     expected_response:
    </p>
    <p>
     status: error
    </p>
    <p>
     error_message: "Token 无效"
    </p>
    <p>
     ```
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <p>
     基于 pytest + YAML 实现测试框架**
    </p>
    <p>
    </p>
    <p>
     ### **1. 测试框架代码**
    </p>
    <p>
    </p>
    <p>
     以下是基于 pytest 和 YAML 的接口测试框架代码：
    </p>
    <p>
    </p>
    <p>
     ```python
    </p>
    <p>
     import pytest
    </p>
    <p>
     import requests
    </p>
    <p>
     import yaml
    </p>
    <p>
    </p>
    <p>
     # 加载 YAML 测试用例
    </p>
    <p>
     def load_test_cases(file_path):
    </p>
    <p>
     with open(file_path, "r", encoding="utf-8") as f:
    </p>
    <p>
     return yaml.safe_load(f)
    </p>
    <p>
    </p>
    <p>
     # 测试数据驱动
    </p>
    <p>
     test_cases = load_test_cases("test_cases.yml")
    </p>
    <p>
    </p>
    <p>
     @pytest.mark.parametrize("api_test", test_cases)
    </p>
    <p>
     def test_api(api_test):
    </p>
    <p>
     """
    </p>
    <p>
     使用 pytest 执行接口测试
    </p>
    <p>
     """
    </p>
    <p>
     base_url = "http://localhost:8000" # 替换为实际的接口服务地址
    </p>
    <p>
    </p>
    <p>
     # 遍历接口的测试用例
    </p>
    <p>
     for case in api_test["test_cases"]:
    </p>
    <p>
     name = case["name"] # 测试用例名称
    </p>
    <p>
     request_data = case["request"] # 请求数据
    </p>
    <p>
     expected_response = case["expected_response"] # 期望响应
    </p>
    <p>
    </p>
    <p>
     # 打印测试用例名称
    </p>
    <p>
     print(f"执行测试用例: {name}")
    </p>
    <p>
    </p>
    <p>
     # 根据方法调用接口
    </p>
    <p>
     if api_test["method"] == "POST":
    </p>
    <p>
     response = requests.post(base_url + api_test["api"], json=request_data)
    </p>
    <p>
     elif api_test["method"] == "GET":
    </p>
    <p>
     response = requests.get(base_url + api_test["api"], params=request_data)
    </p>
    <p>
     else:
    </p>
    <p>
     pytest.fail(f"未支持的 HTTP 方法: {api_test['method']}")
    </p>
    <p>
    </p>
    <p>
     # 验证响应
    </p>
    <p>
     assert response.status_code == 200, f"HTTP 状态码错误: {response.status_code}"
    </p>
    <p>
     actual_response = response.json()
    </p>
    <p>
     for key, value in expected_response.items():
    </p>
    <p>
     assert actual_response.get(key) == value, f"响应字段 {key} 校验失败，期望: {value}，实际: {actual_response.get(key)}"
    </p>
    <p>
     ```
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     ### **2. 运行测试**
    </p>
    <p>
    </p>
    <p>
     运行以下命令执行测试：
    </p>
    <p>
     pytest -v test_api.py
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <p>
     ## **框架优势与扩展性**
    </p>
    <p>
    </p>
    <p>
     1. **测试数据驱动**：
    </p>
    <p>
     - 测试数据存储在 YAML 文件中，便于维护和扩展。
    </p>
    <p>
     - 修改测试用例无需修改代码，降低维护成本。
    </p>
    <p>
    </p>
    <p>
     2. **支持多接口多用例**：
    </p>
    <p>
     - YAML 文件可以包含多个接口的测试用例，框架会自动加载并执行。
    </p>
    <p>
    </p>
    <p>
     3. **易于扩展**：
    </p>
    <p>
     - 可以扩展支持更多 HTTP 方法（如 PUT、DELETE）。
    </p>
    <p>
     - 集成到 CI/CD 流程中，实现自动化接口测试。
    </p>
    <p>
    </p>
    <p>
     4. **异常场景覆盖**：
    </p>
    <p>
     - 通过 DeepSeek 自动生成异常场景测试用例，覆盖更多边界值。
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6b6674313331342f:61727469636c652f64657461696c732f313436323035323635" class_="artid" style="display:none">
 </p>
</div>


