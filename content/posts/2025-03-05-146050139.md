---
layout: post
title: "python之爬虫入门实例"
date: 2025-03-05 18:37:55 +0800
description: "【代码】python之爬虫入门实例。"
keywords: "python之爬虫入门实例"
categories: ['Python']
tags: ['爬虫', '开发语言', 'Python']
artid: "146050139"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146050139
    alt: "python之爬虫入门实例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146050139
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146050139
cover: https://bing.ee123.net/img/rand?artid=146050139
image: https://bing.ee123.net/img/rand?artid=146050139
img: https://bing.ee123.net/img/rand?artid=146050139
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     python之爬虫入门实例
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Excel_0">
     </a>
     链家二手房数据抓取与Excel存储
    </h2>
    <h3>
     <a id="_1">
     </a>
     目录
    </h3>
    <ol>
     <li>
      开发环境准备
     </li>
     <li>
      爬虫流程分析
     </li>
     <li>
      核心代码实现
     </li>
     <li>
      关键命令详解
     </li>
     <li>
      进阶优化方案
     </li>
     <li>
      注意事项与扩展
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_11">
     </a>
     一、开发环境准备
    </h3>
    <h4>
     <a id="11__12">
     </a>
     1.1 必要组件安装
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># 安装核心库</span>
pip <span class="token function">install</span> requests beautifulsoup4 openpyxl pandas

<span class="token comment"># 各库作用说明：</span>
- requests：网络请求库（版本≥2.25.1）
- beautifulsoup4：HTML解析库（版本≥4.11.2）
- openpyxl：Excel文件操作库（版本≥3.1.2）
- pandas：数据分析库（版本≥2.0.3）
</code></pre>
    <h4>
     <a id="12__24">
     </a>
     1.2 开发环境验证
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"所有库加载成功！"</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_35">
     </a>
     二、爬虫流程分析
    </h3>
    <h4>
     <a id="21__36">
     </a>
     2.1 技术路线图
    </h4>
    <div class="mermaid">
     <svg class="mermaid-svg" height="542.0000610351562" id="mermaid-svg-dSFbzOPD0BoTsUuj" viewbox="0.000003814697265625 0.0000019073486328125 143.3303680419922 542.0000610351562" width="143.3303680419922" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-dSFbzOPD0BoTsUuj {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj .error-icon{fill:#552222;}#mermaid-svg-dSFbzOPD0BoTsUuj .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-dSFbzOPD0BoTsUuj .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-dSFbzOPD0BoTsUuj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-dSFbzOPD0BoTsUuj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-dSFbzOPD0BoTsUuj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-dSFbzOPD0BoTsUuj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-dSFbzOPD0BoTsUuj .marker{fill:#333333;stroke:#333333;}#mermaid-svg-dSFbzOPD0BoTsUuj .marker.cross{stroke:#333333;}#mermaid-svg-dSFbzOPD0BoTsUuj svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-dSFbzOPD0BoTsUuj .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj .cluster-label text{fill:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj .cluster-label span{color:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj .label text,#mermaid-svg-dSFbzOPD0BoTsUuj span{fill:#333;color:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj .node rect,#mermaid-svg-dSFbzOPD0BoTsUuj .node circle,#mermaid-svg-dSFbzOPD0BoTsUuj .node ellipse,#mermaid-svg-dSFbzOPD0BoTsUuj .node polygon,#mermaid-svg-dSFbzOPD0BoTsUuj .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-dSFbzOPD0BoTsUuj .node .label{text-align:center;}#mermaid-svg-dSFbzOPD0BoTsUuj .node.clickable{cursor:pointer;}#mermaid-svg-dSFbzOPD0BoTsUuj .arrowheadPath{fill:#333333;}#mermaid-svg-dSFbzOPD0BoTsUuj .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-dSFbzOPD0BoTsUuj .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-dSFbzOPD0BoTsUuj .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-dSFbzOPD0BoTsUuj .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-dSFbzOPD0BoTsUuj .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-dSFbzOPD0BoTsUuj .cluster text{fill:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj .cluster span{color:#333;}#mermaid-svg-dSFbzOPD0BoTsUuj div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-dSFbzOPD0BoTsUuj :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M71.66518020629883,54.000003814697266L71.66518020629883,58.16667048136393C71.66518020629883,62.3333371480306,71.66518020629883,70.66667048136394,71.66518020629883,79.00000381469727C71.66518020629883,87.3333371480306,71.66518020629883,95.66667048136394,71.66518020629883,99.8333371480306L71.66518020629883,104.00000381469727" marker-end="url(#arrowhead58)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead58" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M71.66518020629883,150.00000762939453L71.66518020629883,154.1666742960612C71.66518020629883,158.33334096272787,71.66518020629883,166.6666742960612,71.66518020629883,175.00000762939453C71.66518020629883,183.33334096272787,71.66518020629883,191.6666742960612,71.66518020629883,195.83334096272787L71.66518020629883,200.00000762939453" marker-end="url(#arrowhead59)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead59" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-D" id="L-C-D" style="opacity: 1;">
          <path class="path" d="M71.66518020629883,246.0000114440918L71.66518020629883,250.16667811075845C71.66518020629883,254.33334477742514,71.66518020629883,262.6666781107585,71.66518020629883,271.0000114440918C71.66518020629883,279.3333447774251,71.66518020629883,287.6666781107585,71.66518020629883,291.8333447774251L71.66518020629883,296.0000114440918" marker-end="url(#arrowhead60)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead60" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M71.66518020629883,342.00001525878906L71.66518020629883,346.16668192545575C71.66518020629883,350.3333485921224,71.66518020629883,358.66668192545575,71.66518020629883,367.00001525878906C71.66518020629883,375.3333485921224,71.66518020629883,383.66668192545575,71.66518020629883,387.8333485921224L71.66518020629883,392.00001525878906" marker-end="url(#arrowhead61)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead61" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-E LE-F" id="L-E-F" style="opacity: 1;">
          <path class="path" d="M71.66518020629883,438.0000190734863L71.66518020629883,442.166685740153C71.66518020629883,446.33335240681964,71.66518020629883,454.666685740153,71.66518020629883,463.0000190734863C71.66518020629883,471.33335240681964,71.66518020629883,479.666685740153,71.66518020629883,483.83335240681964L71.66518020629883,488.0000190734863" marker-end="url(#arrowhead62)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead62" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-D" id="L-L-C-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-E' L-LE-F" id="L-L-E-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-30" style="opacity: 1;" transform="translate(71.66518020629883,31.000001907348633)">
          <rect class="label-container" height="46.000003814697266" rx="0" ry="0" width="125.96876525878906" x="-62.98438262939453" y="-23.000001907348633">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-52.98438262939453,-13.000001907348633)">
            <foreignobject height="26.000001907348633" width="105.96875762939453">
             <div style="display: inline-block; white-space: nowrap;">
              发送HTTP请求
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-31" style="opacity: 1;" transform="translate(71.66518020629883,127.0000057220459)">
          <rect class="label-container" height="46.000003814697266" rx="0" ry="0" width="127.33036041259766" x="-63.66518020629883" y="-23.000001907348633">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-53.66518020629883,-13.000001907348633)">
            <foreignobject height="26.000001907348633" width="107.33036041259766">
             <div style="display: inline-block; white-space: nowrap;">
              获取HTML源码
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-33" style="opacity: 1;" transform="translate(71.66518020629883,223.00000953674316)">
          <rect class="label-container" height="46.000003814697266" rx="0" ry="0" width="116.00001525878906" x="-58.00000762939453" y="-23.000001907348633">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48.00000762939453,-13.000001907348633)">
            <foreignobject height="26.000001907348633" width="96.00000762939453">
             <div style="display: inline-block; white-space: nowrap;">
              解析房源列表
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-35" style="opacity: 1;" transform="translate(71.66518020629883,319.00001335144043)">
          <rect class="label-container" height="46.000003814697266" rx="0" ry="0" width="116.00001525878906" x="-58.00000762939453" y="-23.000001907348633">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48.00000762939453,-13.000001907348633)">
            <foreignobject height="26.000001907348633" width="96.00000762939453">
             <div style="display: inline-block; white-space: nowrap;">
              提取字段数据
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-37" style="opacity: 1;" transform="translate(71.66518020629883,415.0000171661377)">
          <rect class="label-container" height="46.000003814697266" rx="0" ry="0" width="84" x="-42" y="-23.000001907348633">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13.000001907348633)">
            <foreignobject height="26.000001907348633" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              数据清洗
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-39" style="opacity: 1;" transform="translate(71.66518020629883,511.00002098083496)">
          <rect class="label-container" height="46.000003814697266" rx="0" ry="0" width="92.77232360839844" x="-46.38616180419922" y="-23.000001907348633">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-36.38616180419922,-13.000001907348633)">
            <foreignobject height="26.000001907348633" width="72.77232360839844">
             <div style="display: inline-block; white-space: nowrap;">
              存储Excel
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <h4>
     <a id="22__46">
     </a>
     2.2 目标页面结构
    </h4>
    <pre><code class="prism language-plain">https://cq.lianjia.com/ershoufang/
├── div.leftContent
│   └── ul.sellListContent
│       └── li[data-houseid]  # 单个房源
│           ├── div.title &gt; a  # 标题
│           ├── div.flood &gt; div  # 地址
│           ├── div.priceInfo &gt; div.totalPrice  # 总价
│           └── div.followInfo  # 关注量
</code></pre>
    <hr/>
    <h3>
     <a id="_60">
     </a>
     三、核心代码实现
    </h3>
    <h4>
     <a id="31__61">
     </a>
     3.1 完整代码（带详细注释）
    </h4>
    <pre><code class="prism language-python"><span class="token triple-quoted-string string">"""
链家二手房数据采集器
版本：1.2
"""</span>

<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

<span class="token comment"># 配置请求头（模拟浏览器访问）</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">get_house_data</span><span class="token punctuation">(</span>max_page<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取链家二手房数据
    参数：
        max_page: 最大爬取页数（默认5页）
    返回：
        pandas.DataFrame格式的清洗后数据
    """</span>
    all_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_page<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 构造分页URL</span>
        url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://cq.lianjia.com/ershoufang/pg</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>page<span class="token punctuation">}</span></span><span class="token string">/"</span></span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 发送HTTP请求（加入延迟防止封IP）</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
            response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 检测HTTP状态码</span>
            sleep<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span>  <span class="token comment"># 请求间隔</span>
            
            <span class="token comment"># 解析HTML文档</span>
            soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 定位房源列表</span>
            house_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'ul.sellListContent &gt; li[data-houseid]'</span><span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> house <span class="token keyword">in</span> house_list<span class="token punctuation">:</span>
                <span class="token comment"># 数据提取（带异常处理）</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    title <span class="token operator">=</span> house<span class="token punctuation">.</span>select_one<span class="token punctuation">(</span><span class="token string">'div.title a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    address <span class="token operator">=</span> house<span class="token punctuation">.</span>select_one<span class="token punctuation">(</span><span class="token string">'div.flood &gt; div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    total_price <span class="token operator">=</span> house<span class="token punctuation">.</span>select_one<span class="token punctuation">(</span><span class="token string">'div.totalPrice'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    unit_price <span class="token operator">=</span> house<span class="token punctuation">.</span>select_one<span class="token punctuation">(</span><span class="token string">'div.unitPrice'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    follow <span class="token operator">=</span> house<span class="token punctuation">.</span>select_one<span class="token punctuation">(</span><span class="token string">'div.followInfo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># 数据清洗</span>
                    cleaned_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string">'标题'</span><span class="token punctuation">:</span> title<span class="token punctuation">,</span>
                        <span class="token string">'地址'</span><span class="token punctuation">:</span> address<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'总价(万)'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>total_price<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'单价(元/㎡)'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>unit_price<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'元/㎡'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'关注量'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>follow<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'人关注'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    all_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cleaned_data<span class="token punctuation">)</span>
                
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据解析异常：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>
        
        <span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"网络请求失败：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
    
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>all_data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">save_to_excel</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">'house_data.xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将数据保存为Excel文件
    参数：
        df: pandas.DataFrame数据框
        filename: 输出文件名
    """</span>
    <span class="token comment"># 配置Excel写入参数</span>
    writer <span class="token operator">=</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span>
        filename<span class="token punctuation">,</span>
        engine<span class="token operator">=</span><span class="token string">'openpyxl'</span><span class="token punctuation">,</span>
        datetime_format<span class="token operator">=</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">,</span>
        options<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'strings_to_numbers'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    
    df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>
        writer<span class="token punctuation">,</span>
        index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        sheet_name<span class="token operator">=</span><span class="token string">'链家数据'</span><span class="token punctuation">,</span>
        float_format<span class="token operator">=</span><span class="token string">"%.2f"</span><span class="token punctuation">,</span>
        freeze_panes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment"># 保存并优化列宽</span>
    writer<span class="token punctuation">.</span>book<span class="token punctuation">.</span>save<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据已保存至 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>filename<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 执行数据采集</span>
    house_df <span class="token operator">=</span> get_house_data<span class="token punctuation">(</span>max_page<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 数据保存</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> house_df<span class="token punctuation">.</span>empty<span class="token punctuation">:</span>
        save_to_excel<span class="token punctuation">(</span>house_df<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"成功采集 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>house_df<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> 条数据"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"未获取到有效数据"</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_175">
     </a>
     四、关键命令详解
    </h3>
    <h4>
     <a id="41__176">
     </a>
     4.1 核心方法说明
    </h4>
    <h5>
     <a id="411_pandasto_excel_177">
     </a>
     4.1.1 pandas.to_excel参数解析
    </h5>
    <pre><code class="prism language-python">df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>
    excel_writer<span class="token punctuation">,</span>       <span class="token comment"># Excel写入器对象</span>
    sheet_name<span class="token operator">=</span><span class="token string">'Sheet1'</span><span class="token punctuation">,</span><span class="token comment"># 工作表名称</span>
    na_rep<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>          <span class="token comment"># 缺失值填充</span>
    float_format<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>  <span class="token comment"># 浮点数格式化</span>
    columns<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>       <span class="token comment"># 指定输出列</span>
    header<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        <span class="token comment"># 是否包含列名</span>
    index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>         <span class="token comment"># 是否保留索引</span>
    index_label<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>   <span class="token comment"># 索引列标题</span>
    startrow<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment"># 起始行</span>
    startcol<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment"># 起始列</span>
    engine<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>        <span class="token comment"># 写入引擎</span>
    merge_cells<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>   <span class="token comment"># 合并单元格</span>
    encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>      <span class="token comment"># 文件编码</span>
    inf_rep<span class="token operator">=</span><span class="token string">'inf'</span>       <span class="token comment"># 无穷大表示</span>
<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="42__197">
     </a>
     4.2 防反爬策略
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 1. 请求头伪装</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64)'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span> <span class="token string">'gzip, deflate, br'</span><span class="token punctuation">,</span>
    <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://cq.lianjia.com/'</span>
<span class="token punctuation">}</span>

<span class="token comment"># 2. IP代理池示例</span>
proxies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'http://10.10.1.10:3128'</span><span class="token punctuation">,</span>
    <span class="token string">'https'</span><span class="token punctuation">:</span> <span class="token string">'http://10.10.1.10:1080'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># 3. 请求速率控制</span>
<span class="token keyword">import</span> random
sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_219">
     </a>
     五、进阶优化方案
    </h3>
    <h4>
     <a id="51__220">
     </a>
     5.1 数据存储优化
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 多Sheet存储</span>
<span class="token keyword">with</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string">'output.xlsx'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> writer<span class="token punctuation">:</span>
    df1<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'重庆'</span><span class="token punctuation">)</span>
    df2<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'北京'</span><span class="token punctuation">)</span>

<span class="token comment"># 追加模式写入</span>
<span class="token keyword">def</span> <span class="token function">append_to_excel</span><span class="token punctuation">(</span>df<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook
    book <span class="token operator">=</span> load_workbook<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    writer <span class="token operator">=</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> engine<span class="token operator">=</span><span class="token string">'openpyxl'</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>book <span class="token operator">=</span> book
    df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> startrow<span class="token operator">=</span>writer<span class="token punctuation">.</span>sheets<span class="token punctuation">[</span><span class="token string">'Sheet1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max_row<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="52__237">
     </a>
     5.2 异常监控体系
    </h4>
    <pre><code class="prism language-python"><span class="token comment"># 错误日志记录</span>
<span class="token keyword">import</span> logging
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>
    filename<span class="token operator">=</span><span class="token string">'spider.log'</span><span class="token punctuation">,</span>
    level<span class="token operator">=</span>logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">,</span>
    <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%(asctime)s - %(levelname)s - %(message)s'</span>
<span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 爬虫代码</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    logging<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"严重错误：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> exc_info<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_255">
     </a>
     六、注意事项
    </h3>
    <ol>
     <li>
      <strong>
       法律合规
      </strong>
      <br/>
      严格遵守《网络安全法》和网站Robots协议，控制采集频率
     </li>
     <li>
      <strong>
       数据清洗
      </strong>
      <br/>
      建议增加字段校验：
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">validate_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">&lt;</span> price <span class="token operator">&lt;</span> <span class="token number">2000</span>  <span class="token comment"># 重庆房价合理范围校验</span>
</code></pre>
    <ol start="3">
     <li>
      <strong>
       性能调优
      </strong>
      <ul>
       <li>
        启用多线程采集（需控制并发数）
       </li>
       <li>
        使用lxml解析器替代html.parser
       </li>
       <li>
        禁用BeautifulSoup的格式化功能
       </li>
      </ul>
     </li>
     <li>
      <strong>
       存储扩展
      </strong>
     </li>
    </ol>
    <table>
     <thead>
      <tr>
       <th>
        存储方式
       </th>
       <th>
        优点
       </th>
       <th>
        缺点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Excel
       </td>
       <td>
        查看方便
       </td>
       <td>
        大数据性能差
       </td>
      </tr>
      <tr>
       <td>
        CSV
       </td>
       <td>
        通用格式
       </td>
       <td>
        无多Sheet支持
       </td>
      </tr>
      <tr>
       <td>
        SQLite
       </td>
       <td>
        轻量级数据库
       </td>
       <td>
        需要SQL知识
       </td>
      </tr>
      <tr>
       <td>
        MySQL
       </td>
       <td>
        适合大规模存储
       </td>
       <td>
        需要部署数据库
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <pre><code class="prism language-markdown"># 快速使用指南

1. 安装依赖库：
```bash
pip install -r requirements.txt
</code></pre>
    <ol start="2">
     <li>
      运行爬虫：
     </li>
    </ol>
    <pre><code class="prism language-bash">python lianjia_spider.py
</code></pre>
    <ol start="3">
     <li>
      输出文件：
     </li>
    </ol>
    <ul>
     <li>
      <code>
       house_data.xlsx
      </code>
      ：清洗后的完整数据
     </li>
     <li>
      <code>
       spider.log
      </code>
      ：错误日志记录
     </li>
    </ul>
    <pre><code class="prism language-plain">
通过本方案可实现日均10万级数据的稳定采集，建议根据实际需求调整采集频率和存储方案。请务必遵守相关法律法规，合理使用爬虫技术。
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f7869616f79753037303332312f:61727469636c652f64657461696c732f313436303530313339" class_="artid" style="display:none">
 </p>
</div>


