---
layout: post
title: "tcp协议"
date: 2025-03-13 23:34:42 +0800
description: "客户端动作：发送ACK包（`ack=k+1`），标志位`ACK=1`，进入`Established`状态；- 服务器动作：收到SYN包后，发送`SYN+ACK`包（`seq=k`，`ack=j+1`），标志位`SYN=1`和`ACK=1`，进入`SYNRecv`状态。- 客户端动作：发送SYN包（`seq=j`），标志位`SYN=1`，进入`SYNSent`状态，等待服务器响应。- 客户端需验证服务器的`seq=k`和`ack=j+1`的合法性，防止旧连接残留数据干扰。"
keywords: "tcp协议"
categories: ['计算机网络']
tags: ['网络', '服务器', 'Tcp']
artid: "146244992"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146244992
    alt: "tcp协议"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146244992
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146244992
cover: https://bing.ee123.net/img/rand?artid=146244992
image: https://bing.ee123.net/img/rand?artid=146244992
img: https://bing.ee123.net/img/rand?artid=146244992
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     tcp协议
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     第一次握手：建立连接时，客户端发送syn包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认，第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），（syn=k），即SYN+ACK包，第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。
    </p>
    <p>
    </p>
    <h5>
     扩展
    </h5>
    <p>
     <br/>
     TCP三次握手是建立可靠连接的核心机制，确保通信双方同步序列号、确认网络可达性并协商传输参数。以下是详细过程及技术细节：
     <br/>
     一、三次握手的具体步骤
     <br/>
     1. 第一次握手（SYN包）
     <br/>
     - 客户端动作：发送SYN包（`seq=j`），标志位`SYN=1`，进入`SYNSent`状态，等待服务器响应。
     <br/>
     - 技术细节：SYN包不携带数据，但消耗一个序列号，因此初始序号`j`由客户端随机生成，用于后续数据同步。
     <br/>
     - 目的：向服务器发起连接请求，并传递初始序列号及支持的TCP选项（如MSS、窗口大小）。
     <br/>
     2. 第二次握手（SYN+ACK包）
     <br/>
     - 服务器动作：收到SYN包后，发送`SYN+ACK`包（`seq=k`，`ack=j+1`），标志位`SYN=1`和`ACK=1`，进入`SYNRecv`状态。
     <br/>
     - 技术细节：
     <br/>
     - 服务器需分配半连接队列条目，记录客户端信息并设置超时重传机制。
     <br/>
     - 确认号`ack=j+1`表示已正确接收客户端的初始序列号。
     <br/>
     - 异常处理：若服务器队列已满或检测到SYN洪水攻击，可能丢弃请求或使用SYN Cookie机制防御。
     <br/>
     3. 第三次握手（ACK包）
     <br/>
     - 客户端动作：发送ACK包（`ack=k+1`），标志位`ACK=1`，进入`Established`状态；服务器收到后也进入`Established`状态，连接建立完成。
     <br/>
     - 技术细节：
     <br/>
     - 客户端需验证服务器的`seq=k`和`ack=j+1`的合法性，防止旧连接残留数据干扰。
     <br/>
     - 若使用时间戳选项，还需检查时间戳是否在有效区间内。
     <br/>
     - 数据传输准备：双方已同步初始序列号（`j`和`k`）、窗口大小及MSS，可开始可靠传输。
     <br/>
     ---
     <br/>
     二、三次握手的必要性与设计考量
     <br/>
     1. 双向通信验证
     <br/>
     三次握手确保客户端与服务器均具备双向通信能力，避免单向可达性问题。例如，若仅两次握手，服务器无法确认客户端的ACK是否可达。
     <br/>
     2. 防止历史连接干扰
     <br/>
     若仅两次握手，可能因旧连接的延迟SYN包导致新连接误判。第三次握手通过客户端确认服务器的最新状态，彻底排除此类风险。
     <br/>
     3. 半连接队列管理
     <br/>
     服务器维护半连接队列（`SYNRecv`状态），记录未完成握手的请求。若超时未收到客户端ACK，队列条目将被清除，防止资源泄漏。
     <br/>
     ---
     <br/>
     三、异常场景与优化机制
     <br/>
     1. 半开连接
     <br/>
     若客户端未收到服务器的SYN+ACK（如网络丢包），会触发重传机制；若重传次数超限（通常3-5次），则终止连接。
     <br/>
     2. 延迟确认
     <br/>
     客户端可能在收到数据时才发送ACK，而非立即响应，以减少网络开销。但第三次握手的ACK必须及时发送，确保连接快速建立。
     <br/>
     3. 性能优化
     <br/>
     - SYN Cookie：在服务器队列满时，通过加密算法生成临时Cookie，避免SYN洪水攻击。
     <br/>
     - 快速打开（TFO）：允许在三次握手中直接传输数据，减少RTT延迟。
     <br/>
     ---
     <br/>
     四、总结
     <br/>
     三次握手通过严格的序列号同步和双向确认机制，实现了TCP连接的可靠性与安全性。其设计不仅考虑了基本通信需求，还通过半连接队列、超时重传等机制应对网络不确定性。理解这一过程对网络调试、性能优化及协议安全防护具有重要意义。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35353737323930372f:61727469636c652f64657461696c732f313436323434393932" class_="artid" style="display:none">
 </p>
</div>


