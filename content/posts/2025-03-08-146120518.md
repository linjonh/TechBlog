---
layout: post
title: "Yashan-DB-实例"
date: 2025-03-08 18:51:50 +0800
description: "记录数据库服务运行的轨迹信息、调试信息、状态变迁、潜在问题和错误信息。"
keywords: "Yashan DB 实例"
categories: ['后端开发', 'Yashandb']
tags: ['数据库', 'Oracle', 'Dba']
artid: "146120518"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146120518
    alt: "Yashan-DB-实例"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146120518
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146120518
cover: https://bing.ee123.net/img/rand?artid=146120518
image: https://bing.ee123.net/img/rand?artid=146120518
img: https://bing.ee123.net/img/rand?artid=146120518
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Yashan DB 实例
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
    </p>
    <h2>
     一、实例启停机制
    </h2>
    <p>
    </p>
    <h3>
     1. **启动阶段**
    </h3>
    <p>
     <br/>
     - **NOMOUNT**
     <br/>
     - 启动实例，但不加载数据库。
     <br/>
     - 可以重建控制文件（如控制文件损坏）。
     <br/>
     - 启动命令：`$ yasboot cluster start -c yashandb -m nomount`
     <br/>
     - 查询状态：`SQL&gt; SELECT status FROM V$INSTANCE;`，状态值为`STARTED`。
     <br/>
     - **MOUNT**
     <br/>
     - 实例已启动，数据库完成加载，但数据库仍处于关闭状态。
     <br/>
     - 可以恢复数据库。
     <br/>
     - 启动命令：
     <br/>
     - `$ yasboot cluster start -c yashandb -m mount`
     <br/>
     - `SQL&gt; ALTER DATABASE MOUNT;`（前提：实例已启动到NOMOUNT状态）
     <br/>
     - 查询状态：`SQL&gt; SELECT status FROM V$INSTANCE;`，状态值为`MOUNTED`。
     <br/>
     - **OPEN**
     <br/>
     - 实例已启动，数据库已处于打开状态。
     <br/>
     - 可以读写数据库。
     <br/>
     - 启动命令：
     <br/>
     - `$ yasboot cluster start -c yashandb -m open`
     <br/>
     - `SQL&gt; ALTER DATABASE OPEN;`（前提：实例已启动到NOMOUNT/MOUNT状态）
     <br/>
     - 查询状态：`SQL&gt; SELECT status FROM V$INSTANCE;`，状态值为`OPEN`。
     <br/>
     - **打开模式**
     <br/>
     - 数据库在OPEN状态下可以配置不同的打开模式：
     <br/>
     - **READWRITE**：默认模式，适用于生产环境。
     <br/>
     - **RESETLOGS**：用于数据库故障时，重新设置日志号并进行不完全恢复。
     <br/>
     - **UPGRADE**：用于数据库升级。
     <br/>
     - 配置命令：`SQL&gt; ALTER DATABASE OPEN [READWRITE|RESETLOGS|UPGRADE]`。
    </p>
    <h3>
     2. **关闭实例**
    </h3>
    <p>
     <br/>
     - **关闭命令**
     <br/>
     - `$ yasboot cluster stop -c yashandb`
     <br/>
     - `SQL&gt; SHUTDOWN [NORMAL|IMMEDIATE|ABORT]`
     <br/>
     - **关闭模式**
     <br/>
     - **SHUTDOWN NORMAL**：等待所有事务正常结束后关闭。
     <br/>
     - **SHUTDOWN IMMEDIATE**：立即中断用户连接，终止事务并关闭数据库（推荐）。
     <br/>
     - **SHUTDOWN ABORT**：强制中断所有操作并关闭数据库，需实例恢复（不推荐）。
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <h2>
     二、实例配置参数
    </h2>
    <h3>
     <br/>
     1. **参数文件**
    </h3>
    <p>
     <br/>
     - 参数文件名为`yasdb.ini`，存放在`$YASDB_DATA/config`路径下。
     <br/>
     - 安装时指定的初始配置参数保存在此文件中，运行时的非内存修改也会持久化到此文件。
    </p>
    <h3>
     2. **查看参数**
    </h3>
    <p>
     <br/>
     - 使用SQL命令：
    </p>
    <pre><code class="hljs">SQL&gt; SHOW PARAMETER parameter_name;</code></pre>
    <h3>
     3. **修改参数**
    </h3>
    <p>
     <br/>
     - **方式一：使用SQL命令修改（推荐）**
     <br/>
     - 命令格式：
    </p>
    <pre><code class="hljs">ALTER SYSTEM|SESSION SET parameter_name = parameter_value [SCOPE = spfile|memory|both];</code></pre>
    <p>
     <br/>
     - 示例：
    </p>
    <pre><code class="hljs">SQL&gt; ALTER SYSTEM SET data_buffer_size=256M SCOPE=spfile;</code></pre>
    <p>
     <br/>
     - `SCOPE`选项：
     <br/>
     - `spfile`：写入参数文件，需重启生效。
     <br/>
     - `memory`：写入内存，立即生效但重启后失效。
     <br/>
     - `both`：同时写入内存和参数文件，立即生效且重启后生效。
     <br/>
     - **方式二：编辑`yasdb.ini`文件修改（不推荐）**
     <br/>
     - 需要重启数据库才能生效。
     <br/>
     - 适用于因内存不足报错时调整参数。
     <br/>
     - 修改前建议备份参数文件。
     <br/>
     - 操作命令：
     <br/>
     <br/>
    </p>
    <pre><code class="hljs">$ cd $YASDB_DATA/config
$ vi yasdb.ini</code></pre>
    <p>
     <br/>
    </p>
    <p>
     ---
    </p>
    <p>
    </p>
    <h2>
     三、运行日志
    </h2>
    <h3>
     <br/>
     1. **日志概述**
    </h3>
    <p>
     <br/>
     - 记录数据库服务运行的轨迹信息、调试信息、状态变迁、潜在问题和错误信息。
    </p>
    <h3>
     2. **日志文件路径**
    </h3>
    <p>
     <br/>
     - 默认路径：`$YASDB_HOME/log/yashandb/db-1-1/run/run.log`
     <br/>
     - 路径受参数`RUN_LOG_FILE_PATH`控制。
     <br/>
     - 文件名`run.log`不可修改。
    </p>
    <h3>
     3. **日志级别**
    </h3>
    <p>
     <br/>
     - 从上到下日志等级依次增高：
     <br/>
     - **OFF**：关闭日志。
     <br/>
     - **FATAL**：致命错误日志。
     <br/>
     - **ERROR**：一般错误日志。
     <br/>
     - **WARN**：告警类错误日志。
     <br/>
     - **INFO**：正常运行日志（默认级别）。
     <br/>
     - **DEBUG**：调试日志。
     <br/>
     - **TRACE**：追踪日志。
     <br/>
     - **ALL**：所有日志。
    </p>
    <h3>
     4. **日志内容示例**
    </h3>
    <p>
     <br/>
     ```
     <br/>
     2024-06-27 16:35:07.9054092 [INFO] [DB] start kernel
     <br/>
     2024-06-27 16:35:07.9054092 [INFO] [DB] database kernel version is 0.2.59
     <br/>
     2024-06-27 16:35:08.0764092 [INFO] [PARAM] the number of synchronous standby in QUORUM_SYNC_STANDBYS and REQUIRED_SYNC_STANDBYS is 0 and 0
     <br/>
     ...
     <br/>
     ```
    </p>
    <p>
     ---
    </p>
    <h2>
     四、小结
    </h2>
    <h3>
     <br/>
     1. **实例启停机制**
    </h3>
    <p>
     <br/>
     - YashanDB实例启动分为三个阶段：NOMOUNT、MOUNT和OPEN。
     <br/>
     - 不同阶段支持不同的操作，如重建控制文件、恢复数据库和读写操作。
     <br/>
     - 提供多种启动和关闭命令，推荐使用`SHUTDOWN IMMEDIATE`关闭数据库。
    </p>
    <h3>
     2. **实例配置参数**
    </h3>
    <p>
     <br/>
     - 参数文件为`yasdb.ini`，位于`$YASDB_DATA/config`路径下。
     <br/>
     - 可通过SQL命令或直接编辑文件修改参数，推荐使用SQL命令。
     <br/>
     - 参数修改可通过`SCOPE`选项控制生效范围。
    </p>
    <h3>
     3. **运行日志**
    </h3>
    <p>
     <br/>
     - 日志记录数据库运行的详细信息，路径默认为`$YASDB_HOME/log/yashandb/db-1-1/run/run.log`。
     <br/>
     - 支持多种日志级别，可根据需要配置。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38383838353134392f:61727469636c652f64657461696c732f313436313230353138" class_="artid" style="display:none">
 </p>
</div>


