---
layout: post
title: "java读写文件,读超大文件"
date: 2024-12-17 15:32:05 +0800
description: "一直在处理爬虫，经常能遇到读写文件的操作，很多时候都是读写超大文件，记录如下：一、读文件    im"
keywords: "java大文件读写"
categories: ['Java']
tags: ['String', 'Null', 'Java', 'Import', 'File']
artid: "7856814"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=7856814
    alt: "java读写文件,读超大文件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=7856814
featuredImagePreview: https://bing.ee123.net/img/rand?artid=7856814
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     java读写文件，读超大文件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     一直在处理爬虫，经常能遇到读写文件的操作，很多时候都是读写超大文件，记录如下：
    </p>
    <p>
     一、读文件
    </p>
    <p>
     import java.io.BufferedOutputStream;
    </p>
    <p>
     import  java.io.BufferedReader;
    </p>
    <p>
     import java.io.File;
    </p>
    <p>
     import java.io.FileOutputStream;
    </p>
    <p>
     import java.io.FileReader;
    </p>
    <p>
     import java.io.FileWriter;
    </p>
    <p>
     import java.io.IOException;
    </p>
    <p>
     import java.io.OutputStreamWriter;
    </p>
    <p>
     <br/>
    </p>
    <p>
     public void ReadFile(String filename) {
     <!-- -->
    </p>
    <p>
     File file=new File(filename);
    </p>
    <p>
     BufferedReader reader=null;
    </p>
    <p>
     try{
     <!-- -->
    </p>
    <p>
     reader=new BufferedReader(new FileReader(file));   //如果是读大文件  则  new BufferedReader(new FileReader(file),5*1024*1024);  即，设置缓存
    </p>
    <p>
     String tempString=null;
    </p>
    <p>
     while((tempString=reader.readLine())!=null)
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     //进行操作.....
    </p>
    <p>
     }
    </p>
    <p>
     reader.close();
    </p>
    <p>
     }catch(IOException e){
     <!-- -->
    </p>
    <p>
     e.printStackTrace();
    </p>
    <p>
     }finally{
     <!-- -->
    </p>
    <p>
     if(reader!=null)
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     try{
     <!-- -->
    </p>
    <p>
     reader.close();
    </p>
    <p>
     }catch(IOException e)
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     e.printStackTrace();
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     二、写文件
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     import java.io.BufferedOutputStream;
    </p>
    <p>
     import  java.io.BufferedReader;
    </p>
    <p>
     import  java.io.BufferedWriter;
    </p>
    <p>
     import java.io.File;
    </p>
    <p>
     import java.io.FileOutputStream;
    </p>
    <p>
     import java.io.FileReader;
    </p>
    <p>
     import java.io.FileWriter;
    </p>
    <p>
     import java.io.IOException;
    </p>
    <p>
     import java.io.OutputStreamWriter;
    </p>
    <p>
    </p>
    <br/>
    <p>
     public void method1(String file,String content){
     <!-- -->
    </p>
    <p>
     BufferedWriter out=null;
    </p>
    <p>
     try{
     <!-- -->
    </p>
    <p>
     out=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file,true)));  //追加的方法
    </p>
    <p>
     out.write(content);
    </p>
    <p>
     out.write("\r\n");
    </p>
    <p>
     }catch(IOException e){
     <!-- -->
    </p>
    <p>
     e.printStackTrace();
    </p>
    <p>
     }finally{
     <!-- -->
    </p>
    <p>
     try{
     <!-- -->
    </p>
    <p>
     out.close();
    </p>
    <p>
     }catch(IOException e){
     <!-- -->
    </p>
    <p>
     e.printStackTrace();
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
     <br/>
    </p>
    <p>
     public void main(String[] args)
    </p>
    <p>
     {
     <!-- -->
    </p>
    <p>
     String filename="D:\a.txt";
    </p>
    <p>
     File f=new File(filename);
    </p>
    <p>
     if(f.exists()){
     <!-- -->
    </p>
    <p>
     f.delete();
    </p>
    <p>
     }
    </p>
    <p>
     f.createNewFile();
    </p>
    <p>
     String ss="sssssss";
    </p>
    <p>
     method1(filename,ss);
    </p>
    <p>
     }
    </p>
    <p>
     <br/>
    </p>
    <p>
     ===========================华丽丽的分隔符=============================
    </p>
    <p>
     在实践中发现上面的方法最多也就能处理10M以内的数据，从而编辑此文章。
    </p>
    <p>
     想要真正处理上百M，甚至上G的文件，那就要用到java的nio包：
    </p>
    <p>
     下面的代码转自【http://www.oschina.net/code/snippet_54100_7938】
    </p>
    <p>
     import java.io.BufferedReader;
     <br/>
     import java.io.File;
     <br/>
     import java.io.FileInputStream;
     <br/>
     import java.io.IOException;
     <br/>
     import java.io.RandomAccessFile;
     <br/>
     import java.nio.ByteBuffer;
     <br/>
     import java.nio.channels.FileChannel;
     <br/>
     <br/>
     <br/>
     public class TestNio {
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     public static void main(String args[]) throws Exception{
     <br/>
     <span style="white-space:pre">
     </span>
     int bufSize = 100;
     <br/>
     <span style="white-space:pre">
     </span>
     File fin = new File("D:\\workspace\\test\\usagetracking.log");
     <br/>
     <span style="white-space:pre">
     </span>
     File fout = new File("D:\\workspace\\test\\usagetracking2.log");
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     FileChannel fcin = new RandomAccessFile(fin, "r").getChannel();
     <br/>
     <span style="white-space:pre">
     </span>
     ByteBuffer rBuffer = ByteBuffer.allocate(bufSize);
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     FileChannel fcout = new RandomAccessFile(fout, "rws").getChannel();
     <br/>
     <span style="white-space:pre">
     </span>
     ByteBuffer wBuffer = ByteBuffer.allocateDirect(bufSize);
     <br/>
     <br/>
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     readFileByLine(bufSize, fcin, rBuffer, fcout, wBuffer);
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     System.out.print("OK!!!");
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <br/>
     /*读文件同时写文件*/
     <br/>
     <span style="white-space:pre">
     </span>
     public static void readFileByLine(int bufSize, FileChannel fcin, ByteBuffer rBuffer, FileChannel fcout, ByteBuffer wBuffer){
     <br/>
     <span style="white-space:pre">
     </span>
     String enterStr = "\n";
     <br/>
     <span style="white-space:pre">
     </span>
     try{
     <br/>
     <span style="white-space:pre">
     </span>
     byte[] bs = new byte[bufSize];
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     int size = 0;
     <br/>
     <span style="white-space:pre">
     </span>
     StringBuffer strBuf = new StringBuffer("");
     <br/>
     <span style="white-space:pre">
     </span>
     //while((size = fcin.read(buffer)) != -1){
     <br/>
     <span style="white-space:pre">
     </span>
     while(fcin.read(rBuffer) != -1){
     <br/>
     <span style="white-space:pre">
     </span>
     int rSize = rBuffer.position();
     <br/>
     <span style="white-space:pre">
     </span>
     rBuffer.rewind();
     <br/>
     <span style="white-space:pre">
     </span>
     rBuffer.get(bs);
     <br/>
     <span style="white-space:pre">
     </span>
     rBuffer.clear();
     <br/>
     <span style="white-space:pre">
     </span>
     String tempString = new String(bs, 0, rSize);
     <br/>
     <span style="white-space:pre">
     </span>
     //System.out.print(tempString);
     <br/>
     <span style="white-space:pre">
     </span>
     //System.out.print("&lt;200&gt;");
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     int fromIndex = 0;
     <br/>
     <span style="white-space:pre">
     </span>
     int endIndex = 0;
     <br/>
     <span style="white-space:pre">
     </span>
     while((endIndex = tempString.indexOf(enterStr, fromIndex)) != -1){
     <br/>
     <span style="white-space:pre">
     </span>
     String line = tempString.substring(fromIndex, endIndex);
     <br/>
     <span style="white-space:pre">
     </span>
     line = new String(strBuf.toString() + line);
     <br/>
     <span style="white-space:pre">
     </span>
     //System.out.print(line);
     <br/>
     <span style="white-space:pre">
     </span>
     //System.out.print("&lt;/over/&gt;");
     <br/>
     <span style="white-space:pre">
     </span>
     //write to anthone file
     <br/>
     <span style="white-space:pre">
     </span>
     writeFileByLine(fcout, wBuffer, line);
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     <br/>
     <span style="white-space:pre">
     </span>
     strBuf.delete(0, strBuf.length());
     <br/>
     <span style="white-space:pre">
     </span>
     fromIndex = endIndex + 1;
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <span style="white-space:pre">
     </span>
     if(rSize &gt; tempString.length()){
     <br/>
     <span style="white-space:pre">
     </span>
     strBuf.append(tempString.substring(fromIndex, tempString.length()));
     <br/>
     <span style="white-space:pre">
     </span>
     }else{
     <br/>
     <span style="white-space:pre">
     </span>
     strBuf.append(tempString.substring(fromIndex, rSize));
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <span style="white-space:pre">
     </span>
     } catch (IOException e) {
     <br/>
     <span style="white-space:pre">
     </span>
     // TODO Auto-generated catch block
     <br/>
     <span style="white-space:pre">
     </span>
     e.printStackTrace();
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <br/>
     /*写文件*/
     <br/>
     <span style="white-space:pre">
     </span>
     public static void writeFileByLine(FileChannel fcout, ByteBuffer wBuffer, String line){
     <br/>
     <span style="white-space:pre">
     </span>
     try {
     <br/>
     <span style="white-space:pre">
     </span>
     //write on file head
     <br/>
     <span style="white-space:pre">
     </span>
     //fcout.write(wBuffer.wrap(line.getBytes()));
     <br/>
     <span style="white-space:pre">
     </span>
     //wirte append file on foot
     <br/>
     <span style="white-space:pre">
     </span>
     fcout.write(wBuffer.wrap(line.getBytes()), fcout.size());
     <br/>
     <br/>
     <br/>
     <span style="white-space:pre">
     </span>
     } catch (IOException e) {
     <br/>
     <span style="white-space:pre">
     </span>
     // TODO Auto-generated catch block
     <br/>
     <span style="white-space:pre">
     </span>
     e.printStackTrace();
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <span style="white-space:pre">
     </span>
     }
     <br/>
     <br/>
     <br/>
     }
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f64656e677169616f6465:792f61727469636c652f64657461696c732f37383536383134" class_="artid" style="display:none">
 </p>
</div>


