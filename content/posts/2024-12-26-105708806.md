---
layout: post
title: "大数据量插入数据库"
date: 2024-12-26 15:47:51 +0800
description: "大数据量下，提高插入速度的方法。1、Java代码方面，使用多线程插入，并且使用批处理提交。2、数据库"
keywords: "响应的数据量太大要怎样插入到数据库"
categories: ['数据库']
tags: ['数据库', 'Mysql']
artid: "105708806"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=105708806
    alt: "大数据量插入数据库"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=105708806
featuredImagePreview: https://bing.ee123.net/img/rand?artid=105708806
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     大数据量插入数据库
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      大数据量下，提高插入速度的方法。
     </strong>
    </p>
    <p>
     1、Java代码方面，使用多线程插入，并且使用批处理提交。
    </p>
    <p>
     2、数据库方面，表结构建立时不要使用索引，要不然插入过程过还要维护索引B+树；修改存储引擎，一般默认是InnoDB.
     <br/>
     3、合并数据+事务的方法在较小数据量时，性能提高是很明显的，数据量较大时（1千万以上），性能会急剧下降，这是由于此时数据量超过了innodb_buffer的容量，每次定位索引涉及较多的磁盘读写操作，性能下降较快。而使用合并数据+事务+有序数据的方式在数据量达到千万级以上表现依旧是良好，在数据量较大时，有序数据索引定位较为方便，不需要频繁对磁盘进行读写操作，所以可以维持较高的性能。
     <br/>
     <strong>
      注意事项：
     </strong>
     <br/>
     1、SQL语句是有长度限制，在进行数据合并在同一SQL中务必不能超过SQL长度限制，通过max_allowed_packet配置可以修改，默认是1M，测试时修改为8M。
     <br/>
     2、事务需要控制大小，事务太大可能会影响执行的效率。MySQL有innodb_log_buffer_size配置项，超过这个值会把innodb的数据刷到磁盘中，这时，效率会有所下降。所以比较好的做法是，在数据达到这个这个值前进行事务提交。
    </p>
    <p>
     <strong>
      ###下面方法适用于大量（百万级别的List数据），插入到Oracle表中
     </strong>
    </p>
    <p>
     private static final int OPENID_PHONE_NUM = 800; //经实践，800一批插入相对较快，这个可以随便定义
    </p>
    <p>
     private void insertPMeSendToPhoneInfo(List phoneList){
     <!-- -->
    </p>
    <pre><code>int listSize=phoneList.size();
int toIndex=OPENID_PHONE_NUM;
for(int i = 0;i&lt;phoneList.size();i+=OPENID_PHONE_NUM){
    if(i+OPENID_PHONE_NUM&gt;listSize){//作用为toIndex最后没有800条数据则剩余几条newList中就装几条
        toIndex=listSize-i;
    }
    List&lt;PMeSendToPhone&gt; newPMeSendToPhoneInfo = phoneList.subList(i,i+toIndex);
    //批量插入
    pMeSendToPhoneMapper.batchInsertPMePhoneData(newPMeSendToPhoneInfo);
}
</code></pre>
    <p>
     }
    </p>
    <p>
     /** 接口方法定义
     <br/>
     *批量插入
    </p>
    <ul>
     <li>
      @param newPMeSendToPhoneInfo
     </li>
     <li>
      @return
      <br/>
      */
      <br/>
      int batchInsertPMePhoneData(@Param(value = “list”) List newPMeSendToPhoneInfo);
      <br/>
      mybits配置文件定义方法
     </li>
    </ul>
    begin insert into P_ME_SEND_TO_PHONE (PHONEID, PHONE, OPENID, EXTEND_1,EXTEND_2, EXTEND_3) values( SEQ_P_ME_SEND_TO_PHONE.nextval, #{item.phone,jdbcType=VARCHAR}, #{item.openid,jdbcType=VARCHAR}, #{item.extend1,jdbcType=VARCHAR}, #{item.extend2,jdbcType=VARCHAR}, #{item.extend3,jdbcType=VARCHAR} ); end;
    <p>
     <strong>
      表优化方面：
     </strong>
     <br/>
     <a href="https://mp.weixin.qq.com/s/kqICy2hH0Fc8iAmy4BaC9g" rel="nofollow">
      如何优化MySQL千万级表
     </a>
    </p>
    <p>
     参考：
     <br/>
     <a href="https://www.cnblogs.com/sharpest/p/9932924.html" rel="nofollow">
      MySQL批量千万级数据SQL插入性能优化&lt;细读&gt;
     </a>
     <br/>
     <a href="https://www.jb51.net/article/168549.htm" rel="nofollow">
      MySql 快速插入千万级大数据的方法示例
     </a>
     <br/>
     <a href="https://blog.csdn.net/java_peak_zlf/article/details/88189807?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2">
      大量List数据批量插入数据库很高效的方法
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6c69756d696e677a6865312f:61727469636c652f64657461696c732f313035373038383036" class_="artid" style="display:none">
 </p>
</div>


