---
layout: post
title: "C-MySQL-常用接口基于-MySQL-ConnectorC"
date: 2025-03-08 15:15:49 +0800
description: "即使程序崩溃，数据也已经修改了。用于创建 MySQL 连接对象。创建一个 SQL 语句执行对象。如果希望多个 SQL 语句。获取查询结果，并读取列值。释放资源，避免内存泄漏。MySQL 默认启用。指定要操作的数据库。"
keywords: "C++ MySQL 常用接口（基于 MySQL Connector/C++）"
categories: ['未分类']
tags: ['开发语言', 'Mysql', 'C']
artid: "146116673"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146116673
    alt: "C-MySQL-常用接口基于-MySQL-ConnectorC"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146116673
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146116673
cover: https://bing.ee123.net/img/rand?artid=146116673
image: https://bing.ee123.net/img/rand?artid=146116673
img: https://bing.ee123.net/img/rand?artid=146116673
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C++ MySQL 常用接口（基于 MySQL Connector/C++）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h4>
     <a id="C_MySQL__MySQL_ConnectorC_1">
     </a>
     C++ MySQL 常用接口（基于 MySQL Connector/C++）
    </h4>
    <h5>
     <a id="1__3">
     </a>
     1.
     <strong>
      数据库连接
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>mysql<span class="token double-colon punctuation">::</span>MySQL_Driver <span class="token operator">*</span>driver<span class="token punctuation">;</span>
sql<span class="token double-colon punctuation">::</span>Connection <span class="token operator">*</span>con<span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
     <br/>
     用于创建 MySQL 连接对象。
    </p>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp">driver <span class="token operator">=</span> sql<span class="token double-colon punctuation">::</span>mysql<span class="token double-colon punctuation">::</span><span class="token function">get_mysql_driver_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
con <span class="token operator">=</span> driver<span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"tcp://127.0.0.1:3306"</span><span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      释放资源：
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">delete</span> con<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="2__24">
     </a>
     2.
     <strong>
      选择数据库
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">con<span class="token operator">-&gt;</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">"database_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
     <br/>
     指定要操作的数据库。
    </p>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp">con<span class="token operator">-&gt;</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">"test_db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="3__SQL__39">
     </a>
     3.
     <strong>
      创建 SQL 语句对象
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>Statement <span class="token operator">*</span>stmt<span class="token punctuation">;</span>
stmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
     <br/>
     创建一个 SQL 语句执行对象。
    </p>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp">stmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"CREATE TABLE IF NOT EXISTS users (id INT, name VARCHAR(50))"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> stmt<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="4__SQL__57">
     </a>
     4.
     <strong>
      执行 SQL 语句
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">stmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"SQL语句"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">"SQL查询语句"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">"SQL更新语句"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
    </p>
    <ul>
     <li>
      <code>
       execute()
      </code>
      用于执行不返回结果集的 SQL 语句（如
      <code>
       CREATE TABLE
      </code>
      ）。
     </li>
     <li>
      <code>
       executeQuery()
      </code>
      用于执行
      <code>
       SELECT
      </code>
      查询，返回
      <code>
       ResultSet
      </code>
      结果集。
     </li>
     <li>
      <code>
       executeUpdate()
      </code>
      用于
      <code>
       INSERT
      </code>
      、
      <code>
       UPDATE
      </code>
      、
      <code>
       DELETE
      </code>
      ，返回影响的行数。
     </li>
    </ul>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp">stmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users (id, name) VALUES (1, 'Tom')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sql<span class="token double-colon punctuation">::</span>ResultSet <span class="token operator">*</span>res <span class="token operator">=</span> stmt<span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> rows <span class="token operator">=</span> stmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">"UPDATE users SET name='Jerry' WHERE id=1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">delete</span> res<span class="token punctuation">;</span>
<span class="token keyword">delete</span> stmt<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="5__82">
     </a>
     5.
     <strong>
      获取查询结果
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>ResultSet <span class="token operator">*</span>res<span class="token punctuation">;</span>
res<span class="token operator">-&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token operator">-&gt;</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"column_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token operator">-&gt;</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"column_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
     <br/>
     获取查询结果，并读取列值。
    </p>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>ResultSet <span class="token operator">*</span>res <span class="token operator">=</span> stmt<span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>res<span class="token operator">-&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ID: "</span> <span class="token operator">&lt;&lt;</span> res<span class="token operator">-&gt;</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", Name: "</span> <span class="token operator">&lt;&lt;</span> res<span class="token operator">-&gt;</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">delete</span> res<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="6__104">
     </a>
     6.
     <strong>
      使用预处理语句
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>PreparedStatement <span class="token operator">*</span>pstmt<span class="token punctuation">;</span>
pstmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"SQL语句"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">setInt</span><span class="token punctuation">(</span>参数索引<span class="token punctuation">,</span> 整数值<span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">setString</span><span class="token punctuation">(</span>参数索引<span class="token punctuation">,</span> 字符串值<span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
    </p>
    <ul>
     <li>
      <code>
       prepareStatement()
      </code>
      预编译 SQL，提高执行效率并防止 SQL 注入。
     </li>
     <li>
      <code>
       setInt()
      </code>
      /
      <code>
       setString()
      </code>
      设置 SQL 语句中的参数值。
     </li>
    </ul>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>PreparedStatement <span class="token operator">*</span>pstmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users (id, name) VALUES (?, ?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pstmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h5>
     <a id="7__130">
     </a>
     7.
     <strong>
      事务处理
     </strong>
    </h5>
    <h6>
     <a id="Auto_Commit_131">
     </a>
     <strong>
      自动提交（Auto Commit）
     </strong>
    </h6>
    <p>
     MySQL 默认启用
     <strong>
      Auto Commit
     </strong>
     ，每条
     <code>
      INSERT
     </code>
     、
     <code>
      UPDATE
     </code>
     、
     <code>
      DELETE
     </code>
     语句都会
     <strong>
      立即生效
     </strong>
     ，即使程序崩溃，数据也已经修改了。
    </p>
    <p>
     <strong>
      示例（默认自动提交）
     </strong>
    </p>
    <pre><code class="prism language-cpp">sql<span class="token double-colon punctuation">::</span>Statement <span class="token operator">*</span>stmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance - 100 WHERE id = 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> stmt<span class="token punctuation">;</span>  <span class="token comment">// 即使程序崩溃，数据库的修改依然有效</span>
</code></pre>
    <h6>
     <a id="_141">
     </a>
     <strong>
      手动事务（关闭自动提交）
     </strong>
    </h6>
    <p>
     如果希望多个 SQL 语句
     <strong>
      全部成功或全部失败
     </strong>
     ，需要
     <strong>
      关闭自动提交
     </strong>
     并手动
     <code>
      COMMIT
     </code>
     或
     <code>
      ROLLBACK
     </code>
     。
    </p>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp">con<span class="token operator">-&gt;</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
con<span class="token operator">-&gt;</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
con<span class="token operator">-&gt;</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
    </p>
    <ul>
     <li>
      <code>
       setAutoCommit(false)
      </code>
      ：关闭自动提交，进入事务模式。
     </li>
     <li>
      <code>
       commit()
      </code>
      ：提交事务，所有 SQL 语句的更改生效。
     </li>
     <li>
      <code>
       rollback()
      </code>
      ：回滚事务，撤销所有未提交的更改。
     </li>
    </ul>
    <p>
     <strong>
      示例（手动控制事务）
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    con<span class="token operator">-&gt;</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭自动提交，开启事务模式</span>

    sql<span class="token double-colon punctuation">::</span>PreparedStatement <span class="token operator">*</span>pstmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance - ? WHERE id = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">setDouble</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>

    pstmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"UPDATE accounts SET balance = balance + ? WHERE id = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">setDouble</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>

    con<span class="token operator">-&gt;</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// **手动提交事务，所有修改一起生效**</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>sql<span class="token double-colon punctuation">::</span>SQLException <span class="token operator">&amp;</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    con<span class="token operator">-&gt;</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// **出错时回滚，保证数据一致性**</span>
    std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"Transaction failed: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h6>
     <a id="_179">
     </a>
     <strong>
      事务的使用场景
     </strong>
    </h6>
    <p>
     适用于需要保证
     <strong>
      数据一致性
     </strong>
     的情况：
    </p>
    <ul>
     <li>
      <strong>
       银行转账
      </strong>
      （A 账户扣钱，B 账户加钱，必须同时成功）
     </li>
     <li>
      <strong>
       库存管理
      </strong>
      （购买商品时，需要同时更新库存和订单信息）
     </li>
     <li>
      <strong>
       订单处理
      </strong>
      （下单时，必须同时修改多个表的数据）
     </li>
    </ul>
    <p>
     <strong>
      总结
     </strong>
    </p>
    <ul>
     <li>
      MySQL 默认
      <code>
       Auto Commit = true
      </code>
      ，每条 SQL 语句都会立即提交。
     </li>
     <li>
      关闭
      <code>
       Auto Commit
      </code>
      后，可以
      <strong>
       手动提交或回滚
      </strong>
      ，确保数据一致性。
     </li>
     <li>
      使用
      <code>
       commit()
      </code>
      确保更改生效，使用
      <code>
       rollback()
      </code>
      处理失败情况。
     </li>
    </ul>
    <hr/>
    <h5>
     <a id="8__192">
     </a>
     8.
     <strong>
      关闭连接
     </strong>
    </h5>
    <p>
     <strong>
      接口：
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">delete</span> res<span class="token punctuation">;</span>
<span class="token keyword">delete</span> stmt<span class="token punctuation">;</span>
<span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>
<span class="token keyword">delete</span> con<span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      作用：
     </strong>
     <br/>
     释放资源，避免内存泄漏。
    </p>
    <p>
     <strong>
      示例：
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">delete</span> res<span class="token punctuation">;</span>
<span class="token keyword">delete</span> stmt<span class="token punctuation">;</span>
<span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>
<span class="token keyword">delete</span> con<span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_213">
     </a>
     <strong>
      总结
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         类别
        </strong>
       </th>
       <th>
        <strong>
         接口
        </strong>
       </th>
       <th>
        <strong>
         作用
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         数据库连接
        </strong>
       </td>
       <td>
        <code>
         sql::mysql::MySQL_Driver *driver;
        </code>
        <br/>
        <code>
         sql::Connection *con;
        </code>
        <br/>
        <code>
         driver = sql::mysql::get_mysql_driver_instance();
        </code>
        <br/>
        <code>
         con = driver-&gt;connect(...);
        </code>
       </td>
       <td>
        连接 MySQL 数据库
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         选择数据库
        </strong>
       </td>
       <td>
        <code>
         con-&gt;setSchema("database_name");
        </code>
       </td>
       <td>
        选择数据库
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         执行 SQL
        </strong>
       </td>
       <td>
        <code>
         stmt-&gt;execute("SQL语句");
        </code>
        <br/>
        <code>
         stmt-&gt;executeQuery("SQL查询语句");
        </code>
        <br/>
        <code>
         stmt-&gt;executeUpdate("SQL更新语句");
        </code>
       </td>
       <td>
        执行 SQL 语句
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         获取查询结果
        </strong>
       </td>
       <td>
        <code>
         res-&gt;next();
        </code>
        <br/>
        <code>
         res-&gt;getInt("column_name");
        </code>
        <br/>
        <code>
         res-&gt;getString("column_name");
        </code>
       </td>
       <td>
        获取查询结果
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         预处理语句
        </strong>
       </td>
       <td>
        <code>
         pstmt = con-&gt;prepareStatement("SQL语句");
        </code>
        <br/>
        <code>
         pstmt-&gt;setInt(1, value);
        </code>
        <br/>
        <code>
         pstmt-&gt;setString(2, "value");
        </code>
        <br/>
        <code>
         pstmt-&gt;executeUpdate();
        </code>
       </td>
       <td>
        预编译 SQL，防止 SQL 注入
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         事务管理
        </strong>
       </td>
       <td>
        <code>
         con-&gt;setAutoCommit(false);
        </code>
        <br/>
        <code>
         con-&gt;commit();
        </code>
        <br/>
        <code>
         con-&gt;rollback();
        </code>
       </td>
       <td>
        控制事务提交和回滚
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         释放资源
        </strong>
       </td>
       <td>
        <code>
         delete res;
        </code>
        <br/>
        <code>
         delete stmt;
        </code>
        <br/>
        <code>
         delete pstmt;
        </code>
        <br/>
        <code>
         delete con;
        </code>
       </td>
       <td>
        释放内存，避免泄漏
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_224">
     </a>
     代码示例
    </h3>
    <pre><code class="prism language-cpp"><span class="token comment">/* Copyright 2008, 2010, Oracle and/or its affiliates.

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; version 2 of the License.

There are special exceptions to the terms and conditions of the GPL
as it is applied to this software. View the full text of the
exception in file EXCEPTIONS-CONNECTOR-C++ in the directory of this
software distribution.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
*/</span>

<span class="token comment">/* Standard C++ includes */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token comment">/*
  Include directly the different
  headers from cppconn/ and mysql_driver.h + mysql_util.h
  (and mysql_connection.h). This will reduce your build time!
*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mysql_connection.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cppconn/driver.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cppconn/exception.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cppconn/resultset.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cppconn/statement.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cppconn/prepared_statement.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Let's have MySQL count from 10 to 1..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
  sql<span class="token double-colon punctuation">::</span>Driver <span class="token operator">*</span>driver<span class="token punctuation">;</span>
  sql<span class="token double-colon punctuation">::</span>Connection <span class="token operator">*</span>con<span class="token punctuation">;</span>
  sql<span class="token double-colon punctuation">::</span>Statement <span class="token operator">*</span>stmt<span class="token punctuation">;</span>
  sql<span class="token double-colon punctuation">::</span>ResultSet <span class="token operator">*</span>res<span class="token punctuation">;</span>
  sql<span class="token double-colon punctuation">::</span>PreparedStatement <span class="token operator">*</span>pstmt<span class="token punctuation">;</span>

  <span class="token comment">/* Create a connection */</span>
  driver <span class="token operator">=</span> <span class="token function">get_driver_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  con <span class="token operator">=</span> driver<span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"tcp://127.0.0.1:3306"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* Connect to the MySQL test database */</span>
  con<span class="token operator">-&gt;</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  stmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"DROP TABLE IF EXISTS test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stmt<span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"CREATE TABLE test(id INT)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span> stmt<span class="token punctuation">;</span>

  <span class="token comment">/* '?' is the supported placeholder syntax */</span>
  pstmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO test(id) VALUES (?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token operator">-&gt;</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>

  <span class="token comment">/* Select in ascending order */</span>
  pstmt <span class="token operator">=</span> con<span class="token operator">-&gt;</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"SELECT id FROM test ORDER BY id ASC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res <span class="token operator">=</span> pstmt<span class="token operator">-&gt;</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Fetch in reverse = descending order! */</span>
  res<span class="token operator">-&gt;</span><span class="token function">afterLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>res<span class="token operator">-&gt;</span><span class="token function">previous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\t... MySQL counts: "</span> <span class="token operator">&lt;&lt;</span> res<span class="token operator">-&gt;</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> res<span class="token punctuation">;</span>

  <span class="token keyword">delete</span> pstmt<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> con<span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>sql<span class="token double-colon punctuation">::</span>SQLException <span class="token operator">&amp;</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"# ERR: SQLException in "</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> __FUNCTION__ <span class="token operator">&lt;&lt;</span> <span class="token string">") on line "</span> »
     <span class="token operator">&lt;&lt;</span> <span class="token constant">__LINE__</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"# ERR: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">" (MySQL error code: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cout <span class="token operator">&lt;&lt;</span> <span class="token string">", SQLState: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">getSQLState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> »
     <span class="token string">" )"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

<span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f547375616e5331332f:61727469636c652f64657461696c732f313436313136363733" class_="artid" style="display:none">
 </p>
</div>


