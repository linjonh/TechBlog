---
layout: post
title: "电商项目-秒杀系统四秒杀异步下单防止重复秒杀"
date: 2025-03-07 10:25:47 +0800
description: "防止恶意刷单，防止重复秒杀。电商项目，秒杀异步下单"
keywords: "电商项目-秒杀系统(四)秒杀异步下单防止重复秒杀"
categories: ['项目功能', '电商项目']
tags: ['防止重复秒杀', '防止恶意刷单', '秒杀异步下单', '电商项目']
artid: "146087271"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146087271
    alt: "电商项目-秒杀系统四秒杀异步下单防止重复秒杀"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146087271
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146087271
cover: https://bing.ee123.net/img/rand?artid=146087271
image: https://bing.ee123.net/img/rand?artid=146087271
img: https://bing.ee123.net/img/rand?artid=146087271
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     电商项目-秒杀系统(四)秒杀异步下单防止重复秒杀
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="__0">
     </a>
     一、 防止恶意刷单解决
    </h3>
    <p>
     在生产场景下，可能会有一些人会恶意访问当前网站，来进行恶意的刷单。这样会造成当前系统出现一些业务上的业务混乱，出现脏数据，或者造成后端访问压力大等问题。
    </p>
    <p>
     一般要解决这个问题的话，前端可以进行控制，如点一次立即抢购后，置灰立即抢购按钮。同时对于后端来说也需要进行控制。后端实现可以通过Redis incrde 原子性递增来进行解决。
    </p>
    <p>
     <strong>
      实现思路：
     </strong>
     <br/>
     获取登录人名称和商品ID，自定义RedisKey，用户第一次访问放行，并对当前Key设置一个5分钟的有效期，用户在 5分钟内不能重复访问。
    </p>
    <p>
     步骤一： 更新秒杀服务下单方法
     <br/>
     更新秒杀服务下单方法，防止恶意刷单。
    </p>
    <p>
     步骤二： 防重方法实现
    </p>
    <pre><code class="prism language-java"><span class="token comment">//防止重复提交</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">preventRepeatCommit</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
​
    <span class="token class-name">String</span> redisKey <span class="token operator">=</span> <span class="token string">"seckill_user_"</span> <span class="token operator">+</span> username<span class="token operator">+</span><span class="token string">"_id_"</span><span class="token operator">+</span>id<span class="token punctuation">;</span>
    <span class="token keyword">long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//设置有效期五分钟</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
​
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"fail"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
​
    <span class="token keyword">return</span> <span class="token string">"fail"</span><span class="token punctuation">;</span>
​
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="__36">
     </a>
     二、 防止相同商品重复秒杀
    </h3>
    <p>
     防止同一个人，对于相同商品的重复秒杀。项目的需求是：同一个人对于相同的商品只能买一次。并且每次只能买一个。
    </p>
    <p>
     <strong>
      实现思路：
     </strong>
    </p>
    <p>
     当用户购买完商品之后，会在秒杀订单表中产生一条记录，这条记录里包含当前购买的商品ID，以及当前的用户名称。现在明确了每一个
     <br/>
     订单中都有这两个信息的话，我们需要完成防止同一个人对于同一个商品的重复秒杀。只需要根据秒杀ID和秒杀商品ID来查询秒杀订单表
     <br/>
     ，如果里面有相关数据的话，代表用户下过单，就不让用户下单了，如果没有的话再来完成下单流程。
    </p>
    <p>
     步骤一： 修改下单业务层实现
     <br/>
     判断用户是否已经购买过该商品。
    </p>
    <p>
     步骤二： dao层新增查询方法
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SeckillOrderMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillOrder</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
​
    <span class="token comment">/**
     * 查询秒杀订单信息
     * @param username
     * @param id
     * @return
     */</span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from tb_seckill_order where user_id=#{username} and seckill_id=#{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">SeckillOrder</span> <span class="token function">getSecKillOrderByUserNameAndGoodsId</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6b6f6e67373930363932382f:61727469636c652f64657461696c732f313436303837323731" class_="artid" style="display:none">
 </p>
</div>


