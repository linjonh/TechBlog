---
layout: post
title: "微信小程序联调后台接口获取用户的openid"
date: 2025-01-15 15:23:13 +0800
description: "微信小程序获取用户的openid     我们在开发微信小程序的过程中会经常遇到需要获取到用户详细个"
keywords: "success(resp)"
categories: ['未分类']
tags: ['详细信息', '获取微信小程序Openid', '获取微信个人信息', '微信小程序']
artid: "87287608"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=87287608
  alt: "微信小程序联调后台接口获取用户的openid"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=87287608
featuredImagePreview: https://bing.ee123.net/img/rand?artid=87287608
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序联调后台接口获取用户的openid
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      微信小程序获取用户的openid
     </strong>
    </p>
    <p>
     我们在开发微信小程序的过程中会经常遇到需要获取到用户详细个人信息的数据微信小程序官方提供的内置方法只能获取到用户头像，昵称…一类的信息，获取不到openid一类的数据。这些数据都是通过微信小程序加密之后的存放在iv与encryptedData中，我们需要对iv进行解密才能获取到用户个人的openid一类的隐私信息，而iv与encryptedData需要通过后台解密进行获取
    </p>
    <p>
     1.wx.login()方法先获取到验证用户信息的code，
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 首先获取到获取用户信息的code，微信小程序官方说明code码的有效期只有5-10分钟左右</span>
	
	 wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      success<span class="token punctuation">:</span> res <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取到code后，发送 res.code 到后台换取 openId</span>
        <span class="token keyword">let</span> code <span class="token operator">=</span> res<span class="token punctuation">.</span>code
        that<span class="token punctuation">.</span><span class="token function">codeGetOpenid</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     2.将code发送到后台，由后台给我们返回token等的信息
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 使用code换取openid</span>
<span class="token function">codeGetOpenid</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 请求地址</span>
    url<span class="token punctuation">:</span> <span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span><span class="token comment">//这里写公司内服务器的域名</span>
    <span class="token comment">// 将code发送到后台</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      code
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 请求方式 </span>
    method<span class="token punctuation">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
    <span class="token comment">// 请求头</span>
    header<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span> <span class="token comment">// 默认值</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 成功回调</span>
    <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> ret <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>object
        <span class="token comment">// 通过openid请求数据,这里的openid不是用户的openid,而是后台返回给我们的openid</span>
        that<span class="token punctuation">.</span><span class="token function">authSetting</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>openId<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     3.获取用户加密数据传递给后台进行解密
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// An highlighted block</span>
  <span class="token comment">// 获取用户加密数据</span>
  <span class="token function">authSetting</span><span class="token punctuation">(</span>openid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userInfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 已经授权，可以直接调用 getUserInfo 获取头像昵称</span>
          wx<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">success</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token comment">// 通过openid请求用户详细数据</span>
              that<span class="token punctuation">.</span><span class="token function">getuserData</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">,</span> openid<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
    <p>
     4.将IV与openId(后台返的)以及encryptedData传到后台,后台进IV和encryptedData进行解密处理,返回用户详细数据
    </p>
    <pre><code>// 获取用户详细信息
  getuserData(userinfo, id) {
    let that = this
    wx.request({
      url: 'https://www.baidu.com',//这里填写服务端的接口
      //将数据发送到后
      data: {
        iv: userinfo.iv,
        openId: id,
        encryptedData: userinfo.encryptedData
      },
      method: "POST",
      header: {
        'content-type': 'application/x-www-form-urlencoded' // 默认值
      },
      success(resp) {
        if (resp.data.code) {
        //这里的ret就是用户解密后的信息
          let ret = resp.data.object
          
        } 
      }
    })
  }
</code></pre>
    <p>
     这样下来就能成功的获取到用户的详细信息的了，虽然有点麻烦，但回头想想这样设计也对，毕竟用户的个人信息不能随便获取，必须经用户授权才能获取到。
    </p>
    <p>
     版权声明：文章原创，转载请标明出处。谢谢https://blog.csdn.net/qq_40146638/article/details/87287608
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f71715f3430313436363338:2f61727469636c652f64657461696c732f3837323837363038" class_="artid" style="display:none">
 </p>
</div>
