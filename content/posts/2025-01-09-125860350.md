---
layout: post
title: "移远-EC200xEC600xEG912Y-4G-系列模组-AT-命令-MQTT-接入-ThingsCloud-云平台"
date: 2025-01-09 15:35:03 +0800
description: "移远 4G 系列模组的 AT 命令支持 MQTT，请参考以下步骤，只需几分钟就可以接入云平台并上报数"
keywords: "ec600m连接 本地mqtt流程"
categories: ['未分类']
tags: ['物联网', '单片机', '云计算', 'Iot']
artid: "125860350"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=125860350
  alt: "移远-EC200xEC600xEG912Y-4G-系列模组-AT-命令-MQTT-接入-ThingsCloud-云平台"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=125860350
featuredImagePreview: https://bing.ee123.net/img/rand?artid=125860350
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     移远 EC200x/EC600x/EG912Y 4G 系列模组 AT 命令 MQTT 接入 ThingsCloud 云平台
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_4G__AT__MQTT__0">
     </a>
     移远 4G 系列模组 AT 命令 MQTT 接入
    </h2>
    <p>
     移远 4G 系列模组的 AT 命令支持 MQTT，请参考以下步骤，只需几分钟就可以接入云平台并上报数据，还可以从云平台下发命令实现远程实时控制。
    </p>
    <p>
     如果您还不了解云平台的 MQTT 接入协议，可以点击
     <a href="https://docs.thingscloud.xyz/guide/connect-device/mqtt.html" rel="nofollow">
      设备 MQTT 接入
     </a>
     详细了解。
    </p>
    <h4>
     <a id="_7">
     </a>
     支持模组
    </h4>
    <p>
     使用官方 AT 固件，支持以下模组型号。
    </p>
    <ul>
     <li>
      EC200x：EC200T 系列、EC200S 系列、EC200N-CN
     </li>
     <li>
      EC600x：EC600S-CN、EC600N-CN
     </li>
     <li>
      EG912Y：EG912Y 系列
     </li>
    </ul>
    <h4>
     <a id="_15">
     </a>
     检查网络
    </h4>
    <p>
     查询卡状态
    </p>
    <pre><code>AT+CPIN?

+CPIN: READY

OK
</code></pre>
<p>
查询网络注册情况
</p>
<pre><code>AT+CREG?

+CREG: 0,1

OK
</code></pre>
<p>
以上 AT 命令均返回
<code>
OK
</code>
，表示网络正常。
</p>
<h4>
<a id="_37">
</a>
参数配置
</h4>
<p>
配置 MQTT 接收模式
</p>
<pre><code>AT+QMTCFG="recv/mode",0,0,1
</code></pre>
<h4>
<a id="_TCP__44">
</a>
建立 TCP 连接
</h4>
<p>
在设备详情页的【连接】选项中，找到当前可用区的 MQTT 服务器域名和端口，例如：
</p>
<pre><code>mqtt://&lt;domain&gt;:&lt;port&gt;
</code></pre>
<p>
然后发送以下 AT 命令：
</p>
<pre><code>AT+QMTOPEN=0,&lt;domain&gt;,&lt;port&gt;
OK

+QMTOPEN: 0,0
</code></pre>
<p>
以上 AT 命令的第一个参数
<code>
0
</code>
，表示 MQTT 客户端标识符，取值范围是 0~5。
</p>
<p>
需要特别注意的是，此时模组和云平台成功建立了 TCP 连接，但还没有完成 MQTT 身份验证，此时服务器会等待 5 秒，如果 5 秒内没有发送下边的 AT 指令，云平台将会自动断开 TCP 连接。
</p>
<p>
如果收到云平台关闭连接的消息，请再次发送上边的 AT 命令。
</p>
<h4>
<a id="_MQTT__66">
</a>
完成 MQTT 身份验证
</h4>
<p>
在设备详情页的【连接】选项中找到设备证书标识
<code>
&lt;AccessToken&gt;
</code>
和
<code>
&lt;ProjectKey&gt;
</code>
。
</p>
<p>
发送以下 AT 命令，完成 MQTT 身份验证，成功完成 MQTT 连接。
</p>
<pre><code>AT+QMTCONN=0,"thingscloud","&lt;AccessToken&gt;","&lt;ProjectKey&gt;"
OK

+QMTCONN: 0,0
</code></pre>
<h4>
<a id="_78">
</a>
上报属性
</h4>
<p>
至此，模组和云平台已建立 MQTT 连接，我们可以向云平台发布消息或订阅消息。
</p>
<p>
<a href="https://docs.thingscloud.xyz/guide/connect-device/mqtt.html#mqtt-%E4%B8%BB%E9%A2%98%E4%B8%80%E8%A7%88" rel="nofollow">
点此了解 MQTT 主题一览
</a>
</p>
<p>
我们先来发送一个简单的属性上报，消息内容为符合属性上报协议的
<code>
JSON
</code>
结构，如下：
</p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"temperature"</span><span class="token operator">:</span> <span class="token number">31.6</span>
<span class="token punctuation">}</span>
</code></pre>
<p>
实际传输中，
<code>
JSON
</code>
是
<code>
ASCII
</code>
字符串形式，过滤调换行和缩进，如下：
</p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span><span class="token string-property property">"temperature"</span><span class="token operator">:</span><span class="token number">31.6</span><span class="token punctuation">}</span>
</code></pre>
<p>
接下来，使用以下 AT 命令，发送这个属性结构到云平台。
</p>
<p>
发送前，需要先计算消息字符串的长度，这里是 20 个字节。
</p>
<pre><code>AT+QMTPUBEX=0,0,0,0,attributes,20
&gt;
</code></pre>
<p>
该 AT 命令告诉模块将要发送一条 20 字节的消息，收到返回的
<code>
&gt;
</code>
后，继续向模组串口发送字符串即可。若实际发送的长度超过了 20 个字节，多出来的字节会被删除。
</p>
<p>
发送成功后，模组会返回以下消息：
</p>
<pre><code>OK

+QMTPUBEX: 0,0,0
</code></pre>
<p>
此时，在云平台的设备详情页，可以看到出现了名为
<code>
temperature
</code>
的属性和值。
</p>
<p>
通过在属性
<code>
JSON
</code>
结构中放置更多属性，您可以将设备上更多数据上传到云平台。
</p>
<h4>
<a id="_123">
</a>
订阅属性下发
</h4>
<p>
如果希望设备能够实时接收云平台下发的属性数据，模组发送以下 AT 命令：
</p>
<pre><code>AT+QMTSUB=0,0
,attributes/push,0
OK

+QMTSUB: 0,0,0
</code></pre>
<h4>
<a id="_135">
</a>
订阅命令下发
</h4>
<p>
如果希望设备能够实时接收云平台下发的命令消息，模组发送以下 AT 命令：
</p>
<pre><code>AT+QMTSUB=0,0
,command/send/+,0
OK

+QMTSUB: 0,0,0
</code></pre>
<h4>
<a id="_147">
</a>
接收订阅数据下发
</h4>
<p>
通过上边的主题订阅，一旦云平台有相应的消息下发，模组便会将消息透传到使用 AT 的串口。
</p>
<pre><code>AT+QMTRECV=0
</code></pre>
<p>
例如，当云平台下发了命令消息后，模组立即收到以下消息：
</p>
<pre><code>+QMTRECV: 0,0,command/send/1000,{"method":"restart","params":{"timeout":10},"id":1000}

OK
</code></pre>
<p>
收到的命令消息结构如下：
</p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"method"</span><span class="token operator">:</span> <span class="token string">"restart"</span><span class="token punctuation">,</span>
<span class="token string-property property">"params"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"timeout"</span><span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>
<a id="_MQTT__175">
</a>
关闭 MQTT 连接
</h4>
<pre><code>AT+QMTDISC=0
OK

+QMTDISC: 0,0
</code></pre>
<h4>
<a id="_TCP__184">
</a>
关闭 TCP 连接
</h4>
<pre><code>AT+QMTCLOSE=0
OK

+QMTCLOSE: 0,0
</code></pre>

   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f7468696e6773636c6f75642f:61727469636c652f64657461696c732f313235383630333530" class_="artid" style="display:none">
 </p>
</div>
