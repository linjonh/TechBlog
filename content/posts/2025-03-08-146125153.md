---
layout: post
title: "yoloV5训练visDrone2019-Det无人机视觉下目标检测"
date: 2025-03-08 23:55:34 +0800
description: "visDrone2019数据集是无人机视角下最具挑战性的目标检测基准数据集之一，由天津大学机器学习与数据挖掘实验室联合其他研究机构共同构建。该数据集采集自中国14个不同城市，覆盖复杂城市场景、交通枢纽、密集人群等多种环境。"
keywords: "visdrone中目标尺寸"
categories: ['目标检测']
tags: ['计算机视觉', '目标检测', '人工智能', 'Yolo']
artid: "146125153"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146125153
    alt: "yoloV5训练visDrone2019-Det无人机视觉下目标检测"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146125153
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146125153
cover: https://bing.ee123.net/img/rand?artid=146125153
image: https://bing.ee123.net/img/rand?artid=146125153
img: https://bing.ee123.net/img/rand?artid=146125153
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     yoloV5训练visDrone2019-Det无人机视觉下目标检测
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="visDrone2019_0">
     </a>
     一、visDrone2019数据集详解
    </h2>
    <p>
     visDrone2019数据集是无人机视角下最具挑战性的目标检测基准数据集之一，由天津大学机器学习与数据挖掘实验室联合其他研究机构共同构建。该数据集采集自中国14个不同城市，覆盖复杂城市场景、交通枢纽、密集人群等多种环境。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/91082dba6fe14302a86052bafc64ccd5.jpeg#pic_center"/>
    </p>
    <p>
     <strong>
      数据集构成：
     </strong>
    </p>
    <ul>
     <li>
      训练集：6,471张图像（含6471个标注文件）
     </li>
     <li>
      验证集：548张图像
     </li>
     <li>
      测试集：3,190张图像
     </li>
     <li>
      标注类别：10个主要目标类别
      <br/>
      pedestrian（行人）、people（人群）、bicycle（自行车）、car（轿车）、van（厢式货车）、truck（卡车）、tricycle（三轮车）、awning-tricycle（带篷三轮车）、bus（公交车）、motor（摩托车）
     </li>
    </ul>
    <p>
     <strong>
      标注格式特点：
     </strong>
     <br/>
     每个图像对应.txt标注文件包含多行数据，每行格式为：
     <br/>
     <code>
      &lt;bbox_left&gt;,&lt;bbox_top&gt;,&lt;bbox_width&gt;,&lt;bbox_height&gt;,&lt;score&gt;,&lt;category&gt;,&lt;truncation&gt;,&lt;occlusion&gt;
     </code>
     <br/>
     其中关键参数说明：
    </p>
    <ul>
     <li>
      bbox_left：边界框左上角x坐标
     </li>
     <li>
      bbox_top：边界框左上角y坐标
     </li>
     <li>
      category：目标类别（1-10对应上述类别）
     </li>
     <li>
      occlusion：遮挡程度（0=完全可见，1=部分遮挡，2=严重遮挡）
     </li>
    </ul>
    <h2>
     <a id="_20">
     </a>
     二、数据预处理与标签格式转换
    </h2>
    <p>
     YOLOv5要求标签格式为归一化的中心坐标+宽高形式：
     <br/>
     <code>
      &lt;class_id&gt; &lt;x_center&gt; &lt;y_center&gt; &lt;width&gt; &lt;height&gt;
     </code>
    </p>
    <p>
     <strong>
      转换步骤详解：
     </strong>
    </p>
    <ol>
     <li>
      <strong>
       类别说明
      </strong>
      （visdrone.names）：
     </li>
    </ol>
    <pre><code>0 pedestrian
1 people
2 bicycle
3 car
4 van
5 truck
6 tricycle
7 awning-tricycle
8 bus
9 motor
</code></pre>
    <ol start="2">
     <li>
      <strong>
       Python转换脚本
      </strong>
      ：
     </li>
    </ol>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">visdrone2yolo</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
      <span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm

      <span class="token keyword">def</span> <span class="token function">convert_box</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token punctuation">:</span>
          <span class="token comment"># Convert VisDrone box to YOLO xywh box</span>
          dw <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
          dh <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> dw<span class="token punctuation">,</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> dh<span class="token punctuation">,</span> box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> dw<span class="token punctuation">,</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> dh

      <span class="token punctuation">(</span><span class="token builtin">dir</span> <span class="token operator">/</span> <span class="token string">'labels'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># make labels directory</span>
      pbar <span class="token operator">=</span> tqdm<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">dir</span> <span class="token operator">/</span> <span class="token string">'annotations'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'Converting </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">dir</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> f <span class="token keyword">in</span> pbar<span class="token punctuation">:</span>
          img_size <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">dir</span> <span class="token operator">/</span> <span class="token string">'images'</span> <span class="token operator">/</span> f<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>with_suffix<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size
          lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>  <span class="token comment"># read annotation.txt</span>
              <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token punctuation">[</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                  <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">:</span>  <span class="token comment"># VisDrone 'ignored regions' class 0</span>
                      <span class="token keyword">continue</span>
                  cls <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
                  box <span class="token operator">=</span> convert_box<span class="token punctuation">(</span>img_size<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>cls<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">:</span><span class="token format-spec">.6f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> box<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                  <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>os<span class="token punctuation">.</span>sep <span class="token operator">+</span> <span class="token string">'annotations'</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>sep<span class="token punctuation">,</span> os<span class="token punctuation">.</span>sep <span class="token operator">+</span> <span class="token string">'labels'</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>sep<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fl<span class="token punctuation">:</span>
                      fl<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>lines<span class="token punctuation">)</span>  <span class="token comment"># write label.txt</span>


  <span class="token comment"># Download</span>
  <span class="token builtin">dir</span> <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 修改为你保存VisDrone数据的目录</span>
  <span class="token comment"># Convert</span>
  <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token string">'VisDrone2019-DET-train'</span><span class="token punctuation">,</span> <span class="token string">'VisDrone2019-DET-val'</span><span class="token punctuation">,</span> <span class="token string">'VisDrone2019-DET-test-dev'</span><span class="token punctuation">:</span>
      visdrone2yolo<span class="token punctuation">(</span><span class="token builtin">dir</span> <span class="token operator">/</span> d<span class="token punctuation">)</span>  <span class="token comment"># convert VisDrone annotations to YOLO labels</span>
</code></pre>
    <p>
     <strong>
      关键注意事项：
     </strong>
    </p>
    <ol>
     <li>
      处理遮挡标注：建议保留occlusion&lt;2的样本（过滤严重遮挡目标）
     </li>
     <li>
      小目标处理：无人机图像普遍存在小目标问题，需保持原始分辨率
     </li>
     <li>
      类别平衡：分析各类别分布，必要时进行过采样/欠采样
     </li>
    </ol>
    <h2>
     <a id="YOLOv5_79">
     </a>
     三、YOLOv5参数设置
    </h2>
    <p>
     <strong>
      1. 数据配置文件（visdrone.yaml）
     </strong>
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">path</span><span class="token punctuation">:</span> ../datasets/VisDrone  <span class="token comment"># dataset root dir</span>
<span class="token key atrule">train</span><span class="token punctuation">:</span> VisDrone2019<span class="token punctuation">-</span>DET<span class="token punctuation">-</span>train/images  <span class="token comment"># train images (relative to 'path')  6471 images</span>
<span class="token key atrule">val</span><span class="token punctuation">:</span> VisDrone2019<span class="token punctuation">-</span>DET<span class="token punctuation">-</span>val/images  <span class="token comment"># val images (relative to 'path')  548 images</span>
<span class="token key atrule">test</span><span class="token punctuation">:</span> VisDrone2019<span class="token punctuation">-</span>DET<span class="token punctuation">-</span>test<span class="token punctuation">-</span>dev/images  <span class="token comment"># test images (optional)  1610 images</span>

<span class="token comment"># Classes</span>
<span class="token key atrule">names</span><span class="token punctuation">:</span>
  <span class="token key atrule">0</span><span class="token punctuation">:</span> pedestrian
  <span class="token key atrule">1</span><span class="token punctuation">:</span> people
  <span class="token key atrule">2</span><span class="token punctuation">:</span> bicycle
  <span class="token key atrule">3</span><span class="token punctuation">:</span> car
  <span class="token key atrule">4</span><span class="token punctuation">:</span> van
  <span class="token key atrule">5</span><span class="token punctuation">:</span> truck
  <span class="token key atrule">6</span><span class="token punctuation">:</span> tricycle
  <span class="token key atrule">7</span><span class="token punctuation">:</span> awning<span class="token punctuation">-</span>tricycle
  <span class="token key atrule">8</span><span class="token punctuation">:</span> bus
  <span class="token key atrule">9</span><span class="token punctuation">:</span> motor
</code></pre>
    <p>
     <strong>
      2. 关键训练参数解析
     </strong>
    </p>
    <ul>
     <li>
      预训练模型：
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token operator">-</span><span class="token operator">-</span>weights yolov5s<span class="token punctuation">.</span>pt
</code></pre>
    <ul>
     <li>
      训练超参选择
      <code>
       hyp.scratch-low.yaml
      </code>
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token operator">-</span><span class="token operator">-</span>hyp scratch<span class="token operator">-</span>low<span class="token punctuation">.</span>yaml
</code></pre>
    <p>
     yp.scratch-low.yaml 参数基本说明
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">lr0</span><span class="token punctuation">:</span> <span class="token number">0.01</span>        <span class="token comment"># 初始学习率</span>
<span class="token key atrule">lrf</span><span class="token punctuation">:</span> <span class="token number">0.1</span>         <span class="token comment"># 最终学习率系数</span>
<span class="token key atrule">momentum</span><span class="token punctuation">:</span> <span class="token number">0.937</span>  <span class="token comment"># SGD动量</span>
<span class="token key atrule">weight_decay</span><span class="token punctuation">:</span> <span class="token number">0.0005</span>  <span class="token comment"># 权重衰减</span>
<span class="token key atrule">warmup_epochs</span><span class="token punctuation">:</span> <span class="token number">3.0</span>    <span class="token comment"># 学习率预热</span>
<span class="token key atrule">warmup_momentum</span><span class="token punctuation">:</span> <span class="token number">0.8</span>  
<span class="token key atrule">warmup_bias_lr</span><span class="token punctuation">:</span> <span class="token number">0.1</span>   
<span class="token key atrule">box</span><span class="token punctuation">:</span> <span class="token number">0.05</span>        <span class="token comment"># 边界框损失权重</span>
<span class="token key atrule">cls</span><span class="token punctuation">:</span> <span class="token number">0.3</span>         <span class="token comment"># 分类损失权重</span>
<span class="token key atrule">cls_pw</span><span class="token punctuation">:</span> <span class="token number">1.0</span>      <span class="token comment"># 分类正样本权重</span>
<span class="token key atrule">obj</span><span class="token punctuation">:</span> <span class="token number">0.7</span>         <span class="token comment"># 目标存在损失权重</span>
<span class="token key atrule">obj_pw</span><span class="token punctuation">:</span> <span class="token number">1.0</span>      <span class="token comment"># 目标存在正样本权重</span>
<span class="token key atrule">iou_t</span><span class="token punctuation">:</span> <span class="token number">0.20</span>      <span class="token comment"># IoU训练阈值</span>
<span class="token key atrule">anchor_t</span><span class="token punctuation">:</span> <span class="token number">4.0</span>    <span class="token comment"># anchor阈值</span>
<span class="token key atrule">fl_gamma</span><span class="token punctuation">:</span> <span class="token number">0.0</span>    <span class="token comment"># Focal loss gamma</span>
</code></pre>
    <h2>
     <a id="_130">
     </a>
     四、小结
    </h2>
    <ul>
     <li>
      在训练启动的过程中，提示默认的anchors值不是最优的配置，并给出了重新聚类后的anchors。
     </li>
     <li>
      VisDrone2019存在大量的极小目标，使用640*640的训练尺寸，会导致在训练时，大量的小目标，被缩放为一个点目标，这对训练会起到副作用，所以，这个问题得去优化。
     </li>
     <li>
      VisDrone2019存在inogre区域（有目标，但是未标注），应该进行抹黑处理，并出现标注不完整的情况。
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/334693fd8b7a4678a852001604778ba3.jpeg#pic_center"/>
     </li>
    </ul>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f65766d5f646f632f:61727469636c652f64657461696c732f313436313235313533" class_="artid" style="display:none">
 </p>
</div>


