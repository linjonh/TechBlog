---
layout: post
title: "Spring-Web-å¼‚æ­¥å“åº”å®æˆ˜ä»-CompletableFuture-åˆ°-ResponseBodyEmitter-çš„å…¨é“¾è·¯ä¼˜åŒ–"
date: 2025-09-09T15:38:52+0800
description: "æœ¬æ–‡å¯¹æ¯”åˆ†æäº†Springä¸­ä¸¤ç§å¼‚æ­¥å“åº”æœºåˆ¶ï¼šCompletableFutureé€‚ç”¨äºä¸€æ¬¡æ€§å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€è¿œç¨‹è°ƒç”¨ï¼‰ï¼Œé€šè¿‡@Asyncæ³¨è§£å®ç°éé˜»å¡å¤„ç†ï¼›ResponseBodyEmitteråˆ™é€‚åˆæµå¼æ¨é€åœºæ™¯ï¼ˆå¦‚ä»»åŠ¡è¿›åº¦ã€æ—¥å¿—æµï¼‰ï¼Œæ”¯æŒåˆ†å—ä¼ è¾“æ•°æ®ã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†ä¸¤ç§æ–¹å¼çš„å®ç°ä»£ç ã€Nginxé…ç½®åŠå‰ç«¯æ¥æ”¶æ–¹æ³•ï¼Œå¹¶æä¾›äº†åœºæ™¯é€‰æ‹©å»ºè®®ï¼šä¸€æ¬¡æ€§ç»“æœç”¨CompletableFutureï¼Œå®æ—¶æ¨é€ç”¨ResponseBodyEmitterã€‚åŒæ—¶å¼ºè°ƒäº†è¿æ¥ç®¡ç†å’Œçº¿ç¨‹æ± é…ç½®çš„é‡è¦æ€§ã€‚"
keywords: "spring è¯·æ±‚completablefutureæŒ‚èµ·å¼‚æ­¥å“åº”"
categories: ['æœªåˆ†ç±»']
tags: ['æ¥å£ä¼˜åŒ–', 'å¼‚æ­¥', 'åç«¯', 'å‰ç«¯', 'Springboot', 'Java']
artid: "151361288"
arturl: "https://blog.csdn.net/lssjzmn/article/details/151361288"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151361288
    alt: "Spring-Web-å¼‚æ­¥å“åº”å®æˆ˜ä»-CompletableFuture-åˆ°-ResponseBodyEmitter-çš„å…¨é“¾è·¯ä¼˜åŒ–"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151361288
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151361288
cover: https://bing.ee123.net/img/rand?artid=151361288
image: https://bing.ee123.net/img/rand?artid=151361288
img: https://bing.ee123.net/img/rand?artid=151361288
---



# Spring Web å¼‚æ­¥å“åº”å®æˆ˜ï¼šä» CompletableFuture åˆ° ResponseBodyEmitter çš„å…¨é“¾è·¯ä¼˜åŒ–

### å¼•è¨€

Â Â Â Â Â Â Â Â ä¸Šä¸€ç¯‡å’±ä»¬è®¨è®ºäº†[ã€Šæ€§èƒ½é£™å‡ï¼Springå¼‚æ­¥æµå¼å“åº”ç»ˆææŒ‡å—ï¼šResponseBodyEmitterå®æˆ˜ä¸æ¶æ„æ€è€ƒã€‹](https://blog.csdn.net/lssjzmn/article/details/151313557?spm=1011.2124.3001.6209 "ã€Šæ€§èƒ½é£™å‡ï¼Springå¼‚æ­¥æµå¼å“åº”ç»ˆææŒ‡å—ï¼šResponseBodyEmitterå®æˆ˜ä¸æ¶æ„æ€è€ƒã€‹")ï¼Œè¿™ä¸€æ¬¡ï¼Œå’±ä»¬æ¥è¿›ä¸€æ­¥ä¼˜åŒ–å’Œå¯¹æ¯”ã€‚

Â Â Â Â Â Â Â Â åœ¨æ„å»ºé«˜æ€§èƒ½ Web åº”ç”¨æ—¶ï¼Œå¼‚æ­¥å“åº”æœºåˆ¶æ˜¯æå‡ç³»ç»Ÿååé‡å’Œç”¨æˆ·ä½“éªŒçš„å…³é”®ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Spring Web ä¸­ä¸¤ç§å¸¸ç”¨çš„å¼‚æ­¥å“åº”æ–¹å¼ï¼š`CompletableFuture`Â å’ŒÂ `ResponseBodyEmitter`ï¼Œå¹¶ç»“åˆå‰åç«¯äº¤äº’ã€Nginx é…ç½®ã€è¿æ¥ç®¡ç†ä¼˜åŒ–ç­‰æ–¹é¢ï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„å®æˆ˜æŒ‡å—ã€‚

### ğŸ§©ä¸€ã€ä½¿ç”¨ CompletableFuture å®ç°å¼‚æ­¥æ¥å£

#### âœ…æ§åˆ¶å™¨ä»£ç ï¼š

```
@RestController
public class AsyncController {

    @Autowired
    private AsyncService asyncService;

    @GetMapping("/async")
    public CompletableFuture<String> async() {
        return asyncService.doAsyncTask();
    }
}

```

#### âœ…æœåŠ¡å±‚ä»£ç ï¼š

```
@Service
public class AsyncService {

    @Async
    public CompletableFuture<String> doAsyncTask() {
        try {
            Thread.sleep(3000); // æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        return CompletableFuture.completedFuture("ä»»åŠ¡å®Œæˆï¼");
    }
}

```

#### âœ…é…ç½®ç±»å¯ç”¨å¼‚æ­¥æ”¯æŒï¼š

```
@Configuration
@EnableAsync
public class AsyncConfig {
    @Bean
    public Executor taskExecutor() {
        return Executors.newCachedThreadPool();
    }
}

```

#### âœ…è§£é‡Šï¼š

* `@Async`ï¼šè¡¨ç¤ºè¯¥æ–¹æ³•å°†åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œã€‚
* `CompletableFuture`ï¼šè¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡çš„ç»“æœå®¹å™¨ï¼ŒSpring ä¼šæŒ‚èµ·è¯·æ±‚ç›´åˆ°ä»»åŠ¡å®Œæˆã€‚
* `@EnableAsync`ï¼šå¯ç”¨ Spring çš„å¼‚æ­¥æ–¹æ³•æ”¯æŒã€‚
* `taskExecutor()`ï¼šå®šä¹‰çº¿ç¨‹æ± ï¼Œé¿å…æ¯æ¬¡éƒ½åˆ›å»ºæ–°çº¿ç¨‹ã€‚

#### âœ…Spring MVC ä¸­Â `CompletableFuture`Â çš„å“åº”è¡Œä¸ºè¯¦è§£

##### æœåŠ¡ç«¯å¤„ç†æµç¨‹ï¼š

1. **å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚**ï¼š

   * è¯·æ±‚åˆ°è¾¾ Spring MVC çš„ DispatcherServletã€‚
2. **æ§åˆ¶å™¨è¿”å›Â `CompletableFuture`**ï¼š

   * Spring æ£€æµ‹åˆ°è¿”å›ç±»å‹æ˜¯Â `CompletableFuture`ï¼Œä¼šå°†è¯·æ±‚æŒ‚èµ·ï¼ˆéé˜»å¡ï¼‰ï¼Œç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆã€‚
3. **å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸­**ï¼š

   * é€šå¸¸ç”±çº¿ç¨‹æ± ï¼ˆå¦‚Â `@Async`Â é…ç½®çš„Â `TaskExecutor`ï¼‰æ‰§è¡Œä»»åŠ¡ã€‚
4. **ä»»åŠ¡å®Œæˆå**ï¼š

   * Spring ä¼šè‡ªåŠ¨å°†Â `CompletableFuture`Â çš„ç»“æœä½œä¸ºå“åº”ä½“åºåˆ—åŒ–ä¸º JSON æˆ–æ–‡æœ¬ï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚
5. **è¿æ¥å…³é—­**ï¼š

   * å“åº”å‘é€å®Œæ¯•åï¼ŒHTTP è¿æ¥å…³é—­ã€‚

---

##### å®¢æˆ·ç«¯ä½“éªŒï¼š

è™½ç„¶æœåŠ¡ç«¯æ˜¯å¼‚æ­¥å¤„ç†ï¼Œä½†å®¢æˆ·ç«¯å¹¶ä¸éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚å®ƒåªä¼šæ„Ÿå—åˆ°å“åº”æ—¶é—´ç¨é•¿ï¼Œä½†æœ€ç»ˆä»æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ HTTP å“åº”ã€‚

##### ç¤ºä¾‹ï¼šæµè§ˆå™¨æˆ–å‰ç«¯æ¡†æ¶ä¸­çš„è¡Œä¸º

```
fetch('/async')
  .then(response => response.text()) // æˆ– .json() å–å†³äºè¿”å›ç±»å‹
  .then(data => {
    console.log("æ”¶åˆ°å“åº”:", data);
  });

```

* **æ— éœ€è½®è¯¢**ï¼šå®¢æˆ·ç«¯åªéœ€ç­‰å¾…å“åº”å³å¯ã€‚
* **æ— éœ€ç‰¹æ®Šåè®®**ï¼šä¸åƒ WebSocket æˆ– SSEï¼Œä¸éœ€è¦å»ºç«‹ç‰¹æ®Šè¿æ¥ã€‚
* **é€‚åˆä¸€æ¬¡æ€§ç»“æœ**ï¼šæ¯”å¦‚å¼‚æ­¥è®¡ç®—ã€è¿œç¨‹è°ƒç”¨ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚

#### âœ…ä½¿ç”¨Â `CompletableFuture`Â çš„å¥½å¤„

##### 1.Â **æå‡ç³»ç»Ÿååé‡ä¸å¹¶å‘èƒ½åŠ›**

* æ¥å£è¿”å›Â `CompletableFuture`Â åï¼ŒSpring ä¼šå°†è¯·æ±‚æŒ‚èµ·ï¼Œä¸å ç”¨å½“å‰çº¿ç¨‹ã€‚
* åç«¯ä»»åŠ¡å¯ä»¥åœ¨ç‹¬ç«‹çº¿ç¨‹æ± ä¸­å¼‚æ­¥æ‰§è¡Œï¼Œé‡Šæ”¾ Web å®¹å™¨çº¿ç¨‹èµ„æºã€‚
* æ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼Œå¦‚ API ç½‘å…³ã€å¾®æœåŠ¡èšåˆæ¥å£ã€‚

##### 2.Â **éé˜»å¡å¼ç¼–ç¨‹æ¨¡å‹**

* é¿å…ä¼ ç»ŸåŒæ­¥è°ƒç”¨ä¸­çš„çº¿ç¨‹é˜»å¡ã€‚
* æ”¯æŒé“¾å¼è°ƒç”¨ï¼ˆå¦‚Â `.thenApply()`,Â `.thenCompose()`ï¼‰ï¼Œæ›´æ˜“äºæ„å»ºå¤æ‚å¼‚æ­¥é€»è¾‘ã€‚

##### 3.Â **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**

* è™½ç„¶æœåŠ¡ç«¯å¼‚æ­¥å¤„ç†ï¼Œä½†å®¢æˆ·ç«¯ä»ç„¶æ˜¯æ ‡å‡† HTTP è¯·æ±‚ï¼Œä½¿ç”¨ä½“éªŒä¸€è‡´ã€‚
* å“åº”æ—¶é—´æ›´çŸ­ï¼Œå°¤å…¶åœ¨å¤šä¸ªå­ä»»åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ã€‚

##### 4.Â **ä¸Â `@Async`Â é…åˆä½¿ç”¨ï¼Œè§£è€¦ä¸šåŠ¡é€»è¾‘**

* å¯ä»¥å°†è€—æ—¶ä»»åŠ¡å°è£…åœ¨Â `@Async`Â çš„ Service å±‚ä¸­ï¼Œæ§åˆ¶å™¨å±‚ä¿æŒç®€æ´ã€‚
* æ˜“äºæµ‹è¯•å’Œç»´æŠ¤ï¼Œé€»è¾‘æ¸…æ™°ã€‚

##### 5.Â **æ”¯æŒå¼‚å¸¸å¤„ç†ä¸è¶…æ—¶æ§åˆ¶**

```
return asyncService.doAsyncTask()
    .orTimeout(5, TimeUnit.SECONDS)
    .exceptionally(ex -> "ä»»åŠ¡å¤±è´¥ï¼š" + ex.getMessage());

```

* å¯ä»¥ä¼˜é›…åœ°å¤„ç†ä»»åŠ¡å¤±è´¥ã€è¶…æ—¶ç­‰æƒ…å†µï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ã€‚

---

##### 6.é€‚ç”¨åœºæ™¯å»ºè®®

| åœºæ™¯ | æ˜¯å¦æ¨èä½¿ç”¨ `CompletableFuture` |
| --- | --- |
| å¾®æœåŠ¡èšåˆè°ƒç”¨ | âœ… éå¸¸é€‚åˆ |
| å¼‚æ­¥æ•°æ®åº“æˆ–è¿œç¨‹è°ƒç”¨ | âœ… æ¨è |
| æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ | âŒ ä¸æ¨èï¼ˆä½¿ç”¨ `StreamingResponseBody` æ›´åˆé€‚ï¼‰ |
| å®æ—¶æ¨é€ | âŒ ä¸æ¨èï¼ˆä½¿ç”¨ `SseEmitter` æˆ– `WebSocket` æ›´åˆé€‚ï¼‰ |
| ä»»åŠ¡è¿›åº¦åé¦ˆ | âœ… å¯ç”¨ï¼Œä½† `ResponseBodyEmitter` æ›´çµæ´» |

#### âœ…åº•å±‚æœºåˆ¶è¡¥å……ï¼ˆSpring 5+ï¼‰

Spring 5 å¼•å…¥äº†å¯¹å“åº”å¼ç¼–ç¨‹çš„æ”¯æŒï¼ˆå¦‚Â `Mono`Â å’ŒÂ `Flux`ï¼‰ï¼Œä½†Â `CompletableFuture`Â ä»ç„¶æ˜¯éå¸¸å¸¸ç”¨çš„å¼‚æ­¥è¿”å›ç±»å‹ï¼Œå°¤å…¶åœ¨éå“åº”å¼é¡¹ç›®ä¸­ã€‚

Spring ä¼šé€šè¿‡Â `DeferredResult`Â æˆ–Â `WebAsyncTask`Â ç­‰æœºåˆ¶å°†Â `CompletableFuture`Â åŒ…è£…æˆå¼‚æ­¥å“åº”å¯¹è±¡ï¼ŒæŒ‚èµ·è¯·æ±‚ç›´åˆ°ä»»åŠ¡å®Œæˆã€‚

### ğŸ§©äºŒã€ä½¿ç”¨ ResponseBodyEmitter å®ç°æµå¼æ¨é€

`ResponseBodyEmitter`Â æ˜¯ Spring MVC æä¾›çš„ä¸€ç§å¼‚æ­¥å“åº”æœºåˆ¶ï¼Œå…è®¸æœåŠ¡ç«¯åœ¨ä¸€ä¸ª HTTP è¯·æ±‚ä¸­åˆ†æ®µå‘é€æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›å®Œæ•´å“åº”ã€‚å®ƒé€‚ç”¨äºéœ€è¦é•¿è¿æ¥æˆ–å®æ—¶æ¨é€çš„åœºæ™¯ã€‚

#### âœ…æ§åˆ¶å™¨ä»£ç ï¼š

```
@RestController
public class StreamController {

    @Autowired
    private EmitterManager emitterManager;

    @GetMapping("/stream/{id}")
    public ResponseBodyEmitter stream(@PathVariable String id) {
        ResponseBodyEmitter emitter = new ResponseBodyEmitter();
        emitterManager.register(id, emitter);

        Executors.newSingleThreadExecutor().submit(() -> {
            try {
                for (int i = 0; i < 10; i++) {
                    if (emitterManager.shouldStop(id)) {
                        break;
                    }
                    emitter.send("è¿›åº¦ï¼š" + i * 10 + "%\n", MediaType.TEXT_PLAIN);
                    Thread.sleep(1000);
                }
                emitter.complete();
            } catch (Exception e) {
                emitter.completeWithError(e);
            }
        });

        return emitter;
    }

    @PostMapping("/stop/{id}")
    public ResponseEntity<Void> stop(@PathVariable String id) {
        emitterManager.stop(id);
        return ResponseEntity.ok().build();
    }
}

```

#### âœ…è§£é‡Šï¼š

* `ResponseBodyEmitter`ï¼šå…è®¸æœåŠ¡ç«¯åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å¤šæ¬¡å‘é€æ•°æ®ã€‚
* `emitter.send()`ï¼šæ¯æ¬¡å‘é€ä¸€æ®µæ•°æ®ï¼Œå®¢æˆ·ç«¯å¯å®æ—¶æ¥æ”¶ã€‚
* `emitter.complete()`ï¼šè¡¨ç¤ºæ•°æ®å‘é€å®Œæ¯•ï¼Œå…³é—­è¿æ¥ã€‚
* `emitter.completeWithError()`ï¼šå‘é€å¼‚å¸¸æ—¶å…³é—­è¿æ¥ã€‚
* `EmitterManager`ï¼šç”¨äºç®¡ç†è¿æ¥çŠ¶æ€ï¼Œæ”¯æŒå¤–éƒ¨åœæ­¢ã€‚

#### âœ…æ³¨æ„äº‹é¡¹ï¼š

* `ResponseBodyEmitter`Â é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 30 ç§’ï¼Œå¯é€šè¿‡æ„é€ å‡½æ•°è®¾ç½®ã€‚
* å¼‚æ­¥çº¿ç¨‹å¿…é¡»æ‰‹åŠ¨è°ƒç”¨Â `complete()`Â æˆ–Â `completeWithError()`ã€‚

#### âœ…æ ¸å¿ƒç‰¹æ€§ï¼š

* éé˜»å¡å¼‚æ­¥å“åº”
* æ”¯æŒå¤šæ¬¡å†™å…¥æ•°æ®
* ä¸ Servlet 3.0+ å¼‚æ­¥å¤„ç†å…¼å®¹
* å¯ä¸Â `@ResponseBody`Â æˆ–Â `@RestController`Â ä¸€èµ·ä½¿ç”¨

#### âœ…å‰ç«¯æ¥æ”¶æ–¹å¼

###### ä½¿ç”¨Â `fetch`Â +Â `ReadableStream`ï¼š

```
fetch('/progress/stream')
  .then(response => {
    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    function read() {
      reader.read().then(({ done, value }) => {
        if (done) return;
        console.log(decoder.decode(value));
        read();
      });
    }

    read();
  });

```

è§£é‡Šï¼š

* `response.body.getReader()`ï¼šè·å–å“åº”æµçš„è¯»å–å™¨ã€‚
* `TextDecoder`ï¼šå°†å­—èŠ‚æµè§£ç ä¸ºå­—ç¬¦ä¸²ã€‚
* `read()`ï¼šé€’å½’è¯»å–æ•°æ®ç›´åˆ°è¿æ¥å…³é—­ã€‚

###### ä½¿ç”¨Â `EventSource`ï¼ˆé€‚ç”¨äºÂ `text/event-stream`ï¼‰ï¼š

```
const source = new EventSource('/sse/stream');
source.onmessage = function(event) {
  console.log("Received:", event.data);
};

```

#### âœ…Nginx é…ç½®

```
location /stream {
    proxy_pass http://localhost:8080;
    proxy_buffering off;         # ç¦ç”¨ç¼“å†²ï¼Œç¡®ä¿å®æ—¶æ¨é€
    proxy_read_timeout 3600s;    # è®¾ç½®é•¿è¿æ¥è¶…æ—¶æ—¶é—´
    chunked_transfer_encoding on;# å¯ç”¨åˆ†å—ä¼ è¾“
}

```

è§£é‡Šï¼š

* `proxy_buffering off`ï¼šé˜²æ­¢ Nginx ç¼“å†²å“åº”ï¼Œç¡®ä¿å®¢æˆ·ç«¯å®æ—¶æ¥æ”¶ã€‚
* `proxy_read_timeout`ï¼šé¿å…è¿æ¥è¢« Nginx æå‰å…³é—­ã€‚
* `chunked_transfer_encoding on`ï¼šå…è®¸åˆ†å—ä¼ è¾“æ•°æ®ã€‚

#### âœ…`EmitterManagerå’Œ` EmitterSession

```
@Component
public class EmitterManager {

    // å­˜å‚¨æ‰€æœ‰æ´»è·ƒçš„ emitter ä¼šè¯
    private final Map<String, EmitterSession> sessions = new ConcurrentHashMap<>();

    /**
     * æ³¨å†Œä¸€ä¸ªæ–°çš„ emitter ä¼šè¯
     */
    public void register(String id, ResponseBodyEmitter emitter) {
        EmitterSession session = new EmitterSession(id, emitter);
        sessions.put(id, session);

        // æ·»åŠ è¿æ¥å…³é—­æˆ–å¼‚å¸¸çš„ç›‘å¬å™¨
        emitter.onCompletion(() -> cleanup(id));
        emitter.onTimeout(() -> cleanup(id));
        emitter.onError((Throwable t) -> cleanup(id));
    }

    /**
     * å¤–éƒ¨è§¦å‘åœæ­¢æ¨é€
     */
    public void stop(String id) {
        EmitterSession session = sessions.get(id);
        if (session != null) {
            session.getStopFlag().set(true);
            session.getEmitter().complete();
            cleanup(id);
        }
    }

    /**
     * åˆ¤æ–­æ˜¯å¦åº”è¯¥åœæ­¢å‘é€
     */
    public boolean shouldStop(String id) {
        EmitterSession session = sessions.get(id);
        return session != null && session.getStopFlag().get();
    }

    /**
     * è·å– emitter å®ä¾‹
     */
    public ResponseBodyEmitter getEmitter(String id) {
        EmitterSession session = sessions.get(id);
        return session != null ? session.getEmitter() : null;
    }

    /**
     * æ¸…ç†èµ„æº
     */
    private void cleanup(String id) {
        sessions.remove(id);
    }

    /**
     * è·å–å½“å‰æ´»è·ƒè¿æ¥æ•°
     */
    public int activeCount() {
        return sessions.size();
    }
}

```

```
public class EmitterSession {
    private final String id;
    private final ResponseBodyEmitter emitter;
    private final AtomicBoolean stopFlag;
    private final Instant connectedAt;

    public EmitterSession(String id, ResponseBodyEmitter emitter) {
        this.id = id;
        this.emitter = emitter;
        this.stopFlag = new AtomicBoolean(false);
        this.connectedAt = Instant.now();
    }

    public String getId() {
        return id;
    }

    public ResponseBodyEmitter getEmitter() {
        return emitter;
    }

    public AtomicBoolean getStopFlag() {
        return stopFlag;
    }

    public Instant getConnectedAt() {
        return connectedAt;
    }
}

```

### ğŸ§©ä¸‰ã€ä½¿ç”¨åœºæ™¯å¯¹æ¯”ï¼šCompletableFuture vs ResponseBodyEmitter

| ç»´åº¦ | CompletableFuture | ResponseBodyEmitter |
| --- | --- | --- |
| **å“åº”æ–¹å¼** | ä¸€æ¬¡æ€§è¿”å›ç»“æœ | å¤šæ¬¡æ¨é€æ•°æ® |
| **æ˜¯å¦é˜»å¡å®¹å™¨çº¿ç¨‹** | å¦ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰ | å¦ï¼ˆå¼‚æ­¥æ¨é€ï¼‰ |
| **å®¢æˆ·ç«¯å¤„ç†æ–¹å¼** | æ™®é€š HTTP è¯·æ±‚ | éœ€å¤„ç†æµå¼æ•°æ®ï¼ˆå¦‚ `ReadableStream`ï¼‰ |
| **é€‚åˆåœºæ™¯** | å¼‚æ­¥è®¡ç®—ã€è¿œç¨‹è°ƒç”¨ã€å¾®æœåŠ¡èšåˆ | å®æ—¶æ¨é€ã€ä»»åŠ¡è¿›åº¦åé¦ˆã€æ—¥å¿—æµ |
| **æœåŠ¡ç«¯æ§åˆ¶** | è‡ªåŠ¨å®Œæˆ | æ‰‹åŠ¨æ§åˆ¶å‘é€ä¸ç»“æŸ |
| **è¿æ¥ç”Ÿå‘½å‘¨æœŸ** | è¯·æ±‚å®Œæˆå³å…³é—­ | å¯é•¿æ—¶é—´ä¿æŒè¿æ¥ |
| **èµ„æºç®¡ç†å¤æ‚åº¦** | ä½ | é«˜ï¼ˆéœ€ç®¡ç†è¿æ¥çŠ¶æ€ï¼‰ |
| **æ‰©å±•æ€§** | æ”¯æŒä»»åŠ¡ç»„åˆã€å¼‚å¸¸å¤„ç† | æ”¯æŒè¿æ¥æ§åˆ¶ã€åˆ†ç»„æ¨é€ |
| **éƒ¨ç½²å…¼å®¹æ€§** | ä¸ä¼ ç»Ÿ HTTP å®Œå…¨å…¼å®¹ | éœ€é…ç½® Nginx æ”¯æŒæµå¼ä¼ è¾“ |

#### âœ…ä½¿ç”¨å»ºè®®æ€»ç»“

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ |
| --- | --- |
| å¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢ | âœ… CompletableFuture |
| å¾®æœåŠ¡èšåˆè°ƒç”¨ | âœ… CompletableFuture |
| å®æ—¶ä»»åŠ¡è¿›åº¦åé¦ˆ | âœ… ResponseBodyEmitter |
| æ—¥å¿—æµæ¨é€ | âœ… ResponseBodyEmitter |
| æ–‡ä»¶ä¸‹è½½ | âŒ ä½¿ç”¨ StreamingResponseBody æ›´åˆé€‚ |
| èŠå¤©ã€ååŒç¼–è¾‘ | âŒ ä½¿ç”¨ WebSocket æ›´åˆé€‚ |



