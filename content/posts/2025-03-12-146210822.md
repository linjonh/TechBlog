---
layout: post
title: "一文说清docker及docker-compose的应用和部署"
date: 2025-03-12 17:45:01 +0800
description: "本期教程将介绍Docker和Docker compose的基础应用，通过实际应用来讲解具体使用方法和两者的区别。"
keywords: "一文说清docker及docker compose的应用和部署"
categories: ['日常运维问题合集']
tags: ['运维', '容器', 'Docker']
artid: "146210822"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146210822
    alt: "一文说清docker及docker-compose的应用和部署"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146210822
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146210822
cover: https://bing.ee123.net/img/rand?artid=146210822
image: https://bing.ee123.net/img/rand?artid=146210822
img: https://bing.ee123.net/img/rand?artid=146210822
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     一文说清docker及docker compose的应用和部署
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前言
    </h2>
    <p>
     本文视频版教程：一个视频说清docker及docker compose的应用和部署（
     <a href="https://cloud.tencent.com/developer/video/82177" rel="nofollow">
      https://cloud.tencent.com/developer/video/82177
     </a>
     ）
    </p>
    <p>
     本期教程将介绍Docker和Docker compose的基础应用，通过实际应用来讲解具体使用方法和两者的区别。
    </p>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/842a10b61b70b195a087686d75922038.png"/>
    </p>
    <p>
     假设现在服务器上需要部署三个项目，项目ABC，他们的web服务都是nginx，但是PHP版本不同，mysql数据库的版本也不相同，在传统模式下，尽管PHP可以多版本互存，但是数据库的多版本互存，相对来说就困难一些，在这种情况下，docker就是一种很好的解决方案。
    </p>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/424820d3d53d07a8dca2fe8e8e071a28.png"/>
    </p>
    <p>
     docker主要由镜像和容器两部分组成，镜像可以理解成是一个模板，那么容器就是根据镜像，创建的不同的可执行的实例，那么这些实例之间是相互独立的。
    </p>
    <h2>
     <a id="Docker__14">
     </a>
     一、Docker 的安装
    </h2>
    <h3>
     <a id="11__docker_16">
     </a>
     1.1 安装 docker
    </h3>
    <p>
     安装过程可能会因为网络的问题而造成中断，如果中断了，只需重新执行下该命令就可以继续安装，安装成功后可以查看对应的版本，显示版本信息就证明安装已经完成了。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 安装 Docker 所需的依赖</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2

<span class="token comment"># 添加 Docker 的 yum 源</span>
yum-config-manager --add-repo https://mirrors.cloud.tencent.com/docker-ce/linux/centos/docker-ce.repo

<span class="token comment"># yum 安装 Docker</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce docker-ce-cli containerd.io

<span class="token comment"># 查看 Docker 版本</span>
<span class="token function">docker</span> version
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/74b1db89e136d62ec06096beaf23a2aa.gif"/>
    </p>
    <h3>
     <a id="12__docker_36">
     </a>
     1.2 启动 docker
    </h3>
    <p>
     启动docker并将docker设置为开机自启动，查看运行状态，当出现
     <code>
      active (running)
     </code>
     的时候就表示正在运行之中。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 执行以下命令启动 Docker</span>
systemctl start <span class="token function">docker</span>

<span class="token comment"># 然后将 Docker 设置为开机启动</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>

<span class="token comment"># 查看 Docker 运行状态</span>
<span class="token function">service</span> <span class="token function">docker</span> status

<span class="token comment"># 可能返回以下内容，看到 active (running) 表示正在运行中</span>
Redirecting to /bin/systemctl status docker.service
● docker.service - Docker Application Container Engine
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/docker.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Fri <span class="token number">2023</span>-12-22 <span class="token number">10</span>:00:56 CST<span class="token punctuation">;</span> 11s ago
     Docs: https://docs.docker.com
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/6f17d636c9469914a8dd3f9767a465ba.gif"/>
    </p>
    <h3>
     <a id="13__docker__60">
     </a>
     1.3 配置 docker 镜像加速
    </h3>
    <p>
     因为docker的镜像都是在海外，所以说访问会比较慢，这时候可以设置成国内的加速镜像，这里选择的是腾讯云的，完成之后重启相关服务。
    </p>
    <p>
     <strong>
      方法一：
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 创建 Docker 配置目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/docker

<span class="token comment"># 配置 Docker 镜像加速源</span>
<span class="token function">vim</span> /etc/docker/daemon.json

<span class="token comment"># 输入以下内容后保存退出</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"https://mirror.ccs.tencentyun.com"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment"># 重启守护进程并重启 Docker</span>
systemctl daemon-reload <span class="token operator">&amp;&amp;</span> systemctl restart <span class="token function">docker</span>
</code></pre>
    <p>
     <strong>
      方法二：
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">su</span> -
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span> <span class="token string">EOF
{
  "registry-mirrors": ["https://mirror.ccs.tencentyun.com"]
}
EOF</span>

systemctl daemon-reload <span class="token operator">&amp;&amp;</span> systemctl restart <span class="token function">docker</span>
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/bdfc7bf4aaded36990cf33b5357e3097.gif"/>
    </p>
    <h3>
     <a id="14__docker_97">
     </a>
     1.4 体验 docker
    </h3>
    <p>
     设置完成之后就可以进行体验，通过简单的命令，就可以完成镜像的拉取和容器的创建，这里是拉取了nginx镜像创建的容器，创建完成之后就可以直接运行，此时通过IP，就可以访问nginx的默认页面，说明nginx已经成功部署完毕。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 拉取最新的 nginx 镜像</span>
<span class="token function">docker</span> pull nginx

<span class="token comment"># 运行容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> nginx <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 nginx

<span class="token comment"># 查看容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>

<span class="token comment"># 显示结果</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                               NAMES
cc5b9ffeb31d   nginx     <span class="token string">"/docker-entrypoint.…"</span>   <span class="token number">6</span> seconds ago   Up <span class="token number">5</span> seconds   <span class="token number">0.0</span>.0.0:80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::80-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   nginx
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/da91195f88ffbb7de87875c9a8defac7.gif"/>
    </p>
    <h2>
     <a id="Docker__118">
     </a>
     二、Docker 的镜像与容器
    </h2>
    <p>
     <strong>
      Docker 镜像
     </strong>
     是
     <strong>
      只读的模板
     </strong>
     。
    </p>
    <p>
     <strong>
      Docker 容器
     </strong>
     是基于镜像创的
     <strong>
      运行的实例
     </strong>
     。
    </p>
    <p>
     1个镜像可以创建多个容器，容器互相独立。
    </p>
    <p>
     <strong>
      镜像与容器
     </strong>
     是docker的核心概念，通过刚才的操作拉取了nginx的镜像，这是一个只读的模板，基于这个镜像，创建了一个可以运行的nginx的实例。
    </p>
    <h2>
     <a id="Docker__128">
     </a>
     三、Docker 容器的独立性
    </h2>
    <table>
     <thead>
      <tr>
       <th align="left">
        项目
       </th>
       <th align="left">
        web服务
       </th>
       <th align="left">
        php版本
       </th>
       <th align="left">
        mysql版本
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        项目A
       </td>
       <td align="left">
        nginx
       </td>
       <td align="left">
        php7.4
       </td>
       <td align="left">
        mysql5.7
       </td>
      </tr>
      <tr>
       <td align="left">
        项目B
       </td>
       <td align="left">
        nginx
       </td>
       <td align="left">
        php8.0
       </td>
       <td align="left">
        mysql8.0
       </td>
      </tr>
      <tr>
       <td align="left">
        项目C
       </td>
       <td align="left">
        nginx
       </td>
       <td align="left">
        php7.4
       </td>
       <td align="left">
        mysql8.0
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     由于docker的独立性，在面对表格这样的复杂的部署环境时，就可以通过拉取不同的镜像，比如说nginx、PHP的不同版本，和mysql数据库的不同版本，分别创建对应的容器。
    </p>
    <h2>
     <a id="_139">
     </a>
     四、操作示例
    </h2>
    <h3>
     <a id="41__141">
     </a>
     4.1 部署思路
    </h3>
    <p>
     部署思路：分别拉取nginx、php7.4、php8.0、mysql5.7、mysql8.0的镜像，再创建不同的容器。
    </p>
    <p>
     LNMP_a:nginx + php7.4 + mysql5.7
    </p>
    <p>
     LNMP_b:nginx + php8.0 + mysql8.0
    </p>
    <h3>
     <a id="42__149">
     </a>
     4.2 拉取镜像
    </h3>
    <p>
     为了演示分别搭建两套环境，第一套环境是nginx+PHP 7.4+mysql 5.7，首先将所需要的镜像全部拉取下来，其次查看当前所有已拉取的镜像。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 拉取镜像</span>

<span class="token function">docker</span> pull nginx

<span class="token function">docker</span> pull php:7.4-fpm
<span class="token function">docker</span> pull php:8.0-fpm

<span class="token function">docker</span> pull mysql:5.7
<span class="token function">docker</span> pull mysql:8.0


<span class="token comment"># 查看镜像</span>
<span class="token function">docker</span> images
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/f0861560f5513903236dd88d58042190.gif"/>
    </p>
    <h3>
     <a id="43_LNMP_a_171">
     </a>
     4.3 部署LNMP_a
    </h3>
    <p>
     LNMP_a:nginx + php7.4 + mysql5.7的环境要求，按照命令逐次执行，会依次创建数据库，PHP以及nginx的容器，并完成相关的配置。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 建立 lnma_a 项目的各功能目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/lnmp_a/<span class="token punctuation">{<!-- --></span>www,nginx,mysql<span class="token punctuation">}</span>

<span class="token comment"># 建立网络</span>
<span class="token function">docker</span> network create network_a

<span class="token comment"># mysql 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> mysql57_a <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">33061</span>:3306 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_a/mysql:/var/lib/mysql <span class="token punctuation">\</span>
  <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root_password <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_a <span class="token punctuation">\</span>
  mysql:5.7

<span class="token comment"># php 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> php74_a <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_a/www:/var/www/html <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_a <span class="token punctuation">\</span>
  php:7.4-fpm

<span class="token comment"># nginx conf 配置文件</span>
<span class="token function">vim</span> ~/lnmp_a/nginx/default.conf

<span class="token comment">########## 将下方内容复制至配置文件内 ##########</span>
server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>
    root /var/www/html<span class="token punctuation">;</span>

    location / <span class="token punctuation">{<!-- --></span>
        index index.php index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{<!-- --></span>
        fastcgi_pass php74_a:9000<span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">########## 将上方内容复制至配置文件内 ##########</span>

<span class="token comment"># nginx 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> nginx_a <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">8081</span>:80 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_a/www:/var/www/html <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_a/nginx/default.conf:/etc/nginx/conf.d/default.conf <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_a <span class="token punctuation">\</span>
  nginx:latest
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/a2f9549202ab4aabdb803bc3f6c90976.gif"/>
    </p>
    <h4>
     <a id="431__228">
     </a>
     4.3.1 镜像容器说明
    </h4>
    <p>
     输入
     <code>
      docker ps -a
     </code>
     命令查看容器，第一个nginx是体验的时候创建的，而后面含有下划线杠_a的名字是创建的第一个项目所包含的三个容器。这三个容器的数据是独立的，并且这个nginx与最开始的nginx也是互不干扰的。
    </p>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/d0552a81a8261ab960338185232c6c6a.gif"/>
    </p>
    <h4>
     <a id="432__234">
     </a>
     4.3.2 测试文件说明
    </h4>
    <p>
     创建一个静态的文件和一个动态的PHP文件，分别测试一下容器是否能够正常使用。
    </p>
    <p>
     当访问静态文件的时候，会出现hello lnmp_a，这表明静态文件也能够正常解析。
    </p>
    <p>
     当对PHP文件进行访问的时候，可以看到已经有一个phpinfo，它能够显示出当前PHP的信息，说明PHP的动态解析也能够实现了。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 建立网站静态文件</span>
<span class="token function">vim</span> ~/lnmp_a/www/index.html

<span class="token comment"># 内容</span>
hello lnmp_a


<span class="token comment"># 建立网站 php 文件</span>
<span class="token function">vim</span> ~/lnmp_a/www/index.php

<span class="token comment"># 内容</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/e131c44401d1db1afef73212cca5fd77.gif"/>
    </p>
    <h4>
     <a id="433__260">
     </a>
     4.3.3 数据库测试说明
    </h4>
    <p>
     同时也对数据库进行测试，建立一个新的数据库，测试一下数据库能否正常建立，并且在文件夹中，能否显示对应的数据库文件。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 创建数据库</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql57_a mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot_password</span>

CREATE DATABASE IF NOT EXISTS docker_mysql57_db<span class="token punctuation">;</span>
SHOW DATABASES<span class="token punctuation">;</span>
<span class="token builtin class-name">exit</span><span class="token punctuation">;</span>

<span class="token comment"># 查看数据库文件</span>
<span class="token function">ls</span> ~/lnmp_a/mysql/
</code></pre>
    <h3>
     <a id="44_LNMP_b_276">
     </a>
     4.4 部署LNMP_b
    </h3>
    <p>
     LNMP_b:nginx + php8.0 + mysql8.0
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 建立 lnma_a 项目的各功能目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/lnmp_b/<span class="token punctuation">{<!-- --></span>www,nginx,mysql<span class="token punctuation">}</span>

<span class="token comment"># 建立网络</span>
<span class="token function">docker</span> network create network_b

<span class="token comment"># mysql 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> mysql80_b <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">33062</span>:3306 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/mysql:/var/lib/mysql <span class="token punctuation">\</span>
  <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root_password <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_b <span class="token punctuation">\</span>
  mysql:8.0
  
<span class="token comment"># php 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> php80_b <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/www:/var/www/html <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_b <span class="token punctuation">\</span>
  php:8.0-fpm

<span class="token comment"># nginx conf 配置文件</span>
<span class="token function">vim</span> ~/lnmp_b/nginx/default.conf

<span class="token comment">########## 将下方内容复制至配置文件内 ##########</span>
server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>
    root /var/www/html<span class="token punctuation">;</span>

    location / <span class="token punctuation">{<!-- --></span>
        index index.php index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{<!-- --></span>
        fastcgi_pass php80_b:9000<span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">########## 将上方内容复制至配置文件内 ##########</span>

<span class="token comment"># nginx 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> nginx_b <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">8082</span>:80 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/www:/var/www/html <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/nginx/default.conf:/etc/nginx/conf.d/default.conf <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_b <span class="token punctuation">\</span>
  nginx:latest

<span class="token comment"># 建立网站静态文件</span>
<span class="token function">vim</span> ~/lnmp_b/www/index.html

<span class="token comment"># 内容</span>
hello lnmp_b


<span class="token comment"># 建立网站 php 文件</span>
<span class="token function">vim</span> ~/lnmp_b/www/index.php

<span class="token comment"># 内容</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 创建数据库</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql80_b mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot_password</span>

CREATE DATABASE IF NOT EXISTS docker_mysql80_db<span class="token punctuation">;</span>
SHOW DATABASES<span class="token punctuation">;</span>
<span class="token builtin class-name">exit</span><span class="token punctuation">;</span>

<span class="token comment"># 查看数据库文件</span>
<span class="token function">ls</span> ~/lnmp_b/mysql/
</code></pre>
    <h4>
     <a id="441__355">
     </a>
     4.4.1 创建过程及测试说明
    </h4>
    <p>
     以同样的方式，建立第二个项目所需要的各种环境的容器，并且对第二个项目也进行，静态文件和PHP动态文件的访问，以及数据库的测试。
    </p>
    <h4>
     <a id="442__359">
     </a>
     4.4.2 镜像与容器说明
    </h4>
    <p>
     通过命令查看当前服务器已建立好的容器，会发现主要分为3组。
    </p>
    <ul>
     <li>
      第一组只有一个nginx，是我们最开始体验的那个nginx。
     </li>
     <li>
      第二组为下划线杠_a的，是第一个项目的3个容器。
     </li>
     <li>
      第三组是下划线杠_b的，是第二个项目的3个容器。
     </li>
    </ul>
    <p>
     这些容器之间都是相互独立，互不干扰，使用8081的端口访问第一个项目的页面，使用8082的端口访问第二个项目的页面，这样在同一个服务器上，就可以创建很多个容器。
    </p>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/9fa7bbb183fd51d83e95e6f89cf757c9.gif"/>
    </p>
    <h3>
     <a id="45__371">
     </a>
     4.5 主要命令功能说明
    </h3>
    <h4>
     <a id="451__373">
     </a>
     4.5.1 建立功能模块目录
    </h4>
    <p>
     第一个命令，主要是建立各功能模块的目录，其中www是放置程序和网页文件的，nginx目录是放置nginx配置文件的，mysql目录则是放置数据库文件的。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 建立 lnma_a 项目的各功能目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/lnmp_b/<span class="token punctuation">{<!-- --></span>www,nginx,mysql<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="452__382">
     </a>
     4.5.2 建立网络
    </h4>
    <p>
     第二个命令主要是用来建立一个网络，用于容器内部进行互相连接。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 建立网络</span>
<span class="token function">docker</span> network create network_b
</code></pre>
    <h4>
     <a id="453__391">
     </a>
     4.5.3 创建数据库容器
    </h4>
    <p>
     接下来创建数据库的容器，-d参数表示是后台运行，-name参数用于给容器起一个名字，-p参数是进行端口映射，是将宿主主机的端口映射到容器之中，也就是将33061映射到3306，-v参数则是用于挂载，将主机目录挂载到容器之中，-e参数用于设置环境变量，此处设计的是数据库root账号的密码。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># mysql 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> mysql80_b <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">33062</span>:3306 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/mysql:/var/lib/mysql <span class="token punctuation">\</span>
  <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root_password <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_b <span class="token punctuation">\</span>
  mysql:8.0
</code></pre>
    <h4>
     <a id="454_PHP_405">
     </a>
     4.5.4 创建PHP容器
    </h4>
    <p>
     接下来是创建PHP的容器，这里只需注意一个-v参数。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># php 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> php80_b <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/www:/var/www/html <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_b <span class="token punctuation">\</span>
  php:8.0-fpm
</code></pre>
    <h4>
     <a id="455_nginx_conf_417">
     </a>
     4.5.5 创建nginx conf配置文件
    </h4>
    <p>
     然后创建nginx conf的配置文件，将内容复制至配置文件内，这里主要是实现nginx能够正常解析PHP文件，所以要将PHP容器的名称填写在这里。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># nginx conf 配置文件</span>
<span class="token function">vim</span> ~/lnmp_b/nginx/default.conf

<span class="token comment">########## 将下方内容复制至配置文件内 ##########</span>
server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>
    root /var/www/html<span class="token punctuation">;</span>

    location / <span class="token punctuation">{<!-- --></span>
        index index.php index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{<!-- --></span>
        fastcgi_pass php80_b:9000<span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">########## 将上方内容复制至配置文件内 ##########</span>
</code></pre>
    <h4>
     <a id="456_nginx_444">
     </a>
     4.5.6 创建nginx容器
    </h4>
    <p>
     接下来就是创建nginx容器，-p参数端口映射，将8081映射到80，也就是说，这个容器可以通过8081的方式进行访问，-v参数将网站的目录映射到主机内就是www，第二个-v参数则是conf文件的映射。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># nginx 容器</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> nginx_b <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">8082</span>:80 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/www:/var/www/html <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> ~/lnmp_b/nginx/default.conf:/etc/nginx/conf.d/default.conf <span class="token punctuation">\</span>
  <span class="token parameter variable">--network</span> network_b <span class="token punctuation">\</span>
  nginx:latest
</code></pre>
    <h4>
     <a id="457__458">
     </a>
     4.5.7 创建静态和动态文件
    </h4>
    <p>
     接下来就是创建静态的html文件，和动态的PHP文件，进行测试，看能不能正常解析。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 建立网站静态文件</span>
<span class="token function">vim</span> ~/lnmp_b/www/index.html

<span class="token comment"># 内容</span>
hello lnmp_b


<span class="token comment"># 建立网站 php 文件</span>
<span class="token function">vim</span> ~/lnmp_b/www/index.php

<span class="token comment"># 内容</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="458__478">
     </a>
     4.5.8 数据库容器测试
    </h4>
    <p>
     这里是通过新建终端的方式，连接到容器内部，该容器为数据库容器，通过命令行的方式创建一个数据库，然后进行测试，使用命令，查看刚才创建的数据库是否存在，以及在文件夹中是否存在。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 创建数据库</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql80_b mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot_password</span>

CREATE DATABASE IF NOT EXISTS docker_mysql80_db<span class="token punctuation">;</span>
SHOW DATABASES<span class="token punctuation">;</span>
<span class="token builtin class-name">exit</span><span class="token punctuation">;</span>

<span class="token comment"># 查看数据库文件</span>
<span class="token function">ls</span> ~/lnmp_b/mysql/
</code></pre>
    <h2>
     <a id="Docker_Compose_494">
     </a>
     五、Docker Compose
    </h2>
    <p>
     通过上述方法确实能够创建很多互不干扰的容器，也能够搭建不同的项目使用不同的环境，但是命令过于繁琐，需要的配置太多，导致非常不利于维护，也不利于迁移。
    </p>
    <p>
     在面对这种情况下通常使用另外一种解决方案
     <strong>
      docker compose
     </strong>
     。
    </p>
    <h3>
     <a id="51_Docker_Compose_500">
     </a>
     5.1 安装Docker Compose
    </h3>
    <p>
     按照文档中的命令进行安装，安装完成后可以查看版本号信息，有正确的信息返回，说明安装成功。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 安装编译 Python 包所需的基础工具和 bcrypt 的依赖：</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gcc openssl-devel bzip2-devel libffi-devel python3-devel <span class="token function">make</span>

<span class="token comment"># 升级 pip 和 setuptools</span>
<span class="token function">sudo</span> pip3 <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip setuptools wheel

<span class="token comment"># 安装 docker-compos</span>
<span class="token function">sudo</span> pip3 <span class="token function">install</span> <span class="token function">docker-compose</span>

<span class="token comment"># 查看版本</span>
<span class="token function">docker-compose</span> <span class="token parameter variable">--version</span>
</code></pre>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/2f7d84ae16335edb36bd1bb0587c099f.gif"/>
    </p>
    <h3>
     <a id="52__520">
     </a>
     5.2 建立目录及核心配置文件
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># 建立 lnma_a 项目的各功能目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/lnmp_c/<span class="token punctuation">{<!-- --></span>www,nginx,mysql<span class="token punctuation">}</span>

<span class="token comment"># 建立 docker-compose.yml 文件</span>
<span class="token function">vim</span> ~/lnmp_c/docker-compose.yml
</code></pre>
    <h3>
     <a id="53_dockercomposeyml_530">
     </a>
     5.3 编写docker-compose.yml
    </h3>
    <p>
     docker-compose.yml是核心配置文件，它可以将多个关联的容器，定义在一个文件之中，避免手动输入复杂的命令，确保开发、测试、生产环境的一致性，能够自动处理容器间的依赖关系，以及快速启动和销毁整个应用。
    </p>
    <pre><code class="prism language-bash">version: <span class="token string">"3"</span>

services:
  nginx:
    image: nginx
    container_name: nginx_c
    restart: always
    ports:
      - <span class="token number">8083</span>:80
      - <span class="token number">4433</span>:443      
    volumes:
      - ~/lnmp_c/nginx/default.conf:/etc/nginx/conf.d/default.conf
      - ~/lnmp_c/www:/var/www/html

  php:
    image: php:7.4-fpm
    container_name: php74_c
    restart: always
    volumes:
      - ~/lnmp_c/www:/var/www/html

  mysql:
    image: mysql:8.0
    container_name: mysql80_c
    restart: always
    ports:
      - <span class="token number">33063</span>:3306
    volumes:
      - ~/lnmp_c/mysql:/var/lib/mysql
    environment:
      - <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root_password
      - <span class="token assign-left variable">MYSQL_DATABASE</span><span class="token operator">=</span>lnmp_c
      - <span class="token assign-left variable">MYSQL_USER</span><span class="token operator">=</span>lnmp_c_user
      - <span class="token assign-left variable">MYSQL_PASSWORD</span><span class="token operator">=</span>lnmp_c_password
      
</code></pre>
    <h3>
     <a id="54_nginx__conf_572">
     </a>
     5.4 编写nginx conf配置
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># nginx conf 配置文件</span>
<span class="token function">vim</span> ~/lnmp_c/nginx/default.conf

<span class="token comment">########## 将下方内容复制至配置文件内 ##########</span>
server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>
    root /var/www/html<span class="token punctuation">;</span>

    location / <span class="token punctuation">{<!-- --></span>
        index index.php index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{<!-- --></span>
        fastcgi_pass php74_c:9000<span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">########## 将上方内容复制至配置文件内 ##########</span>
</code></pre>
    <h3>
     <a id="55__597">
     </a>
     5.5 启动服务
    </h3>
    <p>
     通过已经编写好的docker-compose.yml配置文件，使用命令自动创建相关容器。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 进入目录</span>
<span class="token builtin class-name">cd</span> lnmp_c

<span class="token comment"># 启动容器</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>


<span class="token comment"># 建立网站静态文件</span>
<span class="token function">vim</span> ~/lnmp_c/www/index.html

<span class="token comment"># 内容</span>
hello lnmp_c


<span class="token comment"># 建立网站 php 文件</span>
<span class="token function">vim</span> ~/lnmp_c/www/index.php

<span class="token comment"># 内容</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 查看数据库文件</span>
<span class="token function">ls</span> ~/lnmp_c/mysql/
</code></pre>
    <h3>
     <a id="56__627">
     </a>
     5.6 建立静态及动态测试文件
    </h3>
    <p>
     建立静态的html文件和动态的PHP文件，看看创建好的容器能否正常的解析。
    </p>
    <h3>
     <a id="57__631">
     </a>
     5.7 查看数据库文件
    </h3>
    <p>
     因为在配置文件之中已经创建好了一个数据库，通过命令在文件系统中，也确实能够查看对应的数据库，说明数据库的建立也是正确的。
    </p>
    <h3>
     <a id="58_dockercomposeyml_635">
     </a>
     5.8 docker-compose.yml文件介绍
    </h3>
    <p>
     这里是配置文件三个核心部分的介绍，重点关注的就是类似于-v、-p、-e参数，也就是端口映射，文件映射和环境变量的设置。
    </p>
    <h3>
     <a id="59_dockercompose_639">
     </a>
     5.9 docker-compose的启动与重启
    </h3>
    <p>
     通过这种方式建立的容器，也可以很方便地重启，重启可以分为相对路径重启，和绝对路径重启。
    </p>
    <p>
     <strong>
      方法一：相对路径写法
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 停止并删除所有由 Compose 管理的容器</span>
<span class="token function">docker-compose</span> down

<span class="token comment"># 启动容器</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre>
    <p>
     <strong>
      方法二：绝对路径写法
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 停止并删除所有由 Compose 管理的容器</span>
<span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> ~/lnmp_c/docker-compose.yml down

<span class="token comment"># 启动容器</span>
<span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> ~/lnmp_c/docker-compose.yml up <span class="token parameter variable">-d</span>
</code></pre>
    <h2>
     <a id="_663">
     </a>
     六、迁移测试
    </h2>
    <h3>
     <a id="61__665">
     </a>
     6.1 迁移说明
    </h3>
    <p>
     只需将当前服务器上项目lnmp_c的目录复制到其他服务器，进入指定目录重新执行
     <code>
      docker-compose up -d
     </code>
     ，即可一键拉取、创建项目lnmp_c所需要的容器。
    </p>
    <p>
     并且因为将目录也打包过去了，那么网站的文件和数据库的数据都依然存在。
    </p>
    <h3>
     <a id="61__671">
     </a>
     6.1 迁移前数据库准备
    </h3>
    <p>
     为了能够更好的测试数据迁移的完整性，通过终端的方式，先给项目c的数据库创建一些表和添加一些记录，然后迁移过去来查看数据是否完整。
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql80_c mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-proot_password</span>

SHOW DATABASES<span class="token punctuation">;</span>

use lnmp_c<span class="token punctuation">;</span>

CREATE TABLE <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">test</span><span class="token variable">`</span></span> <span class="token punctuation">(</span>
  <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span> int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL,
  <span class="token variable"><span class="token variable">`</span>title<span class="token variable">`</span></span> varchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> COLLATE utf8mb4_unicode_ci NOT NULL
<span class="token punctuation">)</span> <span class="token assign-left variable">ENGINE</span><span class="token operator">=</span>InnoDB DEFAULT <span class="token assign-left variable">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token assign-left variable">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci<span class="token punctuation">;</span>

INSERT INTO <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">test</span><span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span>, <span class="token variable"><span class="token variable">`</span>title<span class="token variable">`</span></span><span class="token punctuation">)</span> VALUES
<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">'title'</span><span class="token punctuation">)</span>,
<span class="token punctuation">(</span><span class="token number">2</span>, <span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ALTER TABLE <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">test</span><span class="token variable">`</span></span>
  ADD PRIMARY KEY <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ALTER TABLE <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">test</span><span class="token variable">`</span></span>
  MODIFY <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span> int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL AUTO_INCREMENT, <span class="token assign-left variable">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
  
SELECT * FROM <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">test</span><span class="token variable">`</span></span><span class="token punctuation">;</span>

<span class="token builtin class-name">exit</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="63__702">
     </a>
     6.3 迁移过程说明
    </h3>
    <p>
     打开的是一台新的测试服务器，通过命令可以查看到已经将项目c的文件复制过来了，并且当前服务器上，并没有安装任何的镜像和容器，通过命令启动docker compose文件，可以看到，服务器已经自动开始拉取所需的镜像，自动创建所需的容器。
    </p>
    <p>
     在创建好之后，我们可以通过IP加端口的方式，访问静态页面和动态页面，然后通过终端的方式，进入到数据库容器中，也能够看到，数据库表和记录，都完整地保留了过来，通过这样的迁移方式，能够保证新旧服务器程序，数据库所运行和环境完全一致。
    </p>
    <p>
     <img alt="请在此添加图片描述" src="https://i-blog.csdnimg.cn/img_convert/6301154461585468d6ba7d485e98df29.gif"/>
    </p>
    <h2>
     <a id="_710">
     </a>
     总结
    </h2>
    <p>
     本期教程到此结束，通过对比Docker的两种使用方法，可以看出Docker compose的使用更为灵活方便，在日常使用中，推荐使用Docker compose的方法来进行部署。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34323236303734382f:61727469636c652f64657461696c732f313436323130383232" class_="artid" style="display:none">
 </p>
</div>


