---
layout: post
title: "ä»0åˆ°180,STM32ç©è½¬MG996Rèˆµæœº"
date: 2025-09-10T23:50:13+0800
description: "MG996Rèˆµæœºå¦‚ä½•ç”¨STM32é©±åŠ¨ï¼Ÿæœ¬æ–‡ä»èˆµæœºå‚æ•°ã€æ¥çº¿æ–¹å¼åˆ°PWMåŸç†ï¼Œå†åˆ°STM32ä»£ç é©±åŠ¨ã€‚"
keywords: "ä»0Â°åˆ°180Â°ï¼ŒSTM32ç©è½¬MG996Rèˆµæœº"
categories: ['æœªåˆ†ç±»']
tags: ['æ•°æ®åº“', 'åµŒå…¥å¼ç¡¬ä»¶', 'å•ç‰‡æœº', 'Stm', 'Mongodb', 'Mcu', 'C']
artid: "151456719"
arturl: "https://blog.csdn.net/m0_73231851/article/details/151456719"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151456719
    alt: "ä»0åˆ°180,STM32ç©è½¬MG996Rèˆµæœº"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151456719
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151456719
cover: https://bing.ee123.net/img/rand?artid=151456719
image: https://bing.ee123.net/img/rand?artid=151456719
img: https://bing.ee123.net/img/rand?artid=151456719
---



# ä»0Â°åˆ°180Â°ï¼ŒSTM32ç©è½¬MG996Rèˆµæœº



## 1.MG996Rèˆµæœºçš„æ€§èƒ½å‚æ•°

| å‚æ•° | æ•°å€¼ |
| --- | --- |
| äº§å“å‹å· | MG995/MG996R |
| äº§å“é‡é‡ | 55 g |
| å·¥ä½œæ‰­çŸ© | 13 kgÂ·cm |
| ååº”é€Ÿåº¦ | 53-62 R/M |
| ä½¿ç”¨æ¸©åº¦ | -30Â°C ~ +55Â°C |
| æ­»åŒºè®¾ç½® | 4 å¾®ç§’ |
| æ’å¤´ç±»å‹ | JRã€FUTABA é€šç”¨ |
| è½¬åŠ¨è§’åº¦ | 180Â°ï¼ˆå·¦90Â°ï¼Œå³90Â°ï¼‰ |
| èˆµæœºç±»å‹ | æ•°ç èˆµæœº |
| ä½¿ç”¨ç”µå‹ | 3.0 - 7.2 V |
| å·¥ä½œç”µæµ | 100 mA |
| ç»“æ„æè´¨ | éƒ¨åˆ†é“œé½¿ã€ç©ºå¿ƒæ¯ç”µæœº |
| çº¿é•¿ | â‰ˆ 25 cm |
| é€‚ç”¨èŒƒå›´ | åŒè¶³æœºå™¨äººã€æœºæ¢°æ‰‹ã€é¥æ§èˆ¹ã€é€‚åˆ 50-90 çº§ç”²é†‡å›ºå®šç¿¼é£æœºã€26-50 CC æ±½æ²¹å›ºå®šç¿¼é£æœºç­‰æ¨¡å‹ |

### 2.MG996R æ¥çº¿æ–¹å¼

#### 2.1å®ç‰©å›¾

![](https://i-blog.csdnimg.cn/img_convert/c5c8ac0a90b1d0f293c923adf4c42977.png)

#### 2.2æ¥çº¿æ–¹å¼

* æ©™è‰²çº¿â€”â€”ä¿¡å·çº¿
* é»‘è‰²çº¿â€”â€”GND
* çº¢è‰²çº¿â€”â€”VCC(ä¸€èˆ¬æ¥5V)

### 3. å•ç‰‡æœºé©±åŠ¨ MG996R èˆµæœºåŸç†

MG996R èˆµæœºæ˜¯ä¸€ç§å¸¸è§çš„ **æ•°å­—èˆµæœº**ï¼Œå®ƒçš„è½¬åŠ¨è§’åº¦æ˜¯é€šè¿‡ **PWMï¼ˆè„‰å®½è°ƒåˆ¶ä¿¡å·ï¼‰** æ¥æ§åˆ¶çš„ã€‚å•ç‰‡æœºï¼ˆæ¯”å¦‚ STM32ï¼‰åªè¦èƒ½è¾“å‡ºç¬¦åˆè¦æ±‚çš„ PWM ä¿¡å·ï¼Œå°±å¯ä»¥ç²¾ç¡®æ§åˆ¶èˆµæœºè½¬åŠ¨åˆ°æŒ‡å®šè§’åº¦ã€‚

#### 3.1 ä»€ä¹ˆæ˜¯ PWM ä¿¡å·ï¼Ÿ

* **PWM** å…¨ç§° **Pulse Width Modulation**ï¼ˆè„‰å®½è°ƒåˆ¶ï¼‰ã€‚
* ç®€å•ç†è§£ï¼šå°±æ˜¯è¾“å‡ºä¸€ä¸ªâ€œé«˜ä½ç”µå¹³äº¤æ›¿â€çš„æ–¹æ³¢ä¿¡å·ã€‚
* æ§åˆ¶èˆµæœºçš„å…³é”®ç‚¹åœ¨äºï¼š**è„‰å®½çš„é•¿çŸ­å†³å®šèˆµæœºè½¬çš„è§’åº¦**ã€‚

#### 3.2 èˆµæœºå¯¹ PWM çš„åŸºæœ¬è¦æ±‚

MG996R ä½¿ç”¨ **æ ‡å‡† PWM æ§åˆ¶**ï¼Œä¸»è¦å‚æ•°å¦‚ä¸‹ï¼š

* **å‘¨æœŸï¼ˆPeriodï¼‰**ï¼š20 msï¼ˆä¹Ÿå°±æ˜¯ 50 Hz çš„é¢‘ç‡ï¼‰ã€‚ ğŸ‘‰ æ¯éš” 20 msï¼Œèˆµæœºä¼šâ€œè¯»ä¸€æ¬¡â€ä¿¡å·ï¼Œæ›´æ–°è‡ªå·±è¦åˆ°çš„è§’åº¦ã€‚
* **å ç©ºæ¯”ï¼ˆDuty Cycleï¼‰**ï¼šåœ¨ 20 ms çš„å‘¨æœŸé‡Œï¼Œé«˜ç”µå¹³çš„æŒç»­æ—¶é—´ä¸åŒï¼Œèˆµæœºè§’åº¦ä¹Ÿä¸åŒã€‚

| è„‰å®½ (é«˜ç”µå¹³æŒç»­æ—¶é—´) | å¯¹åº”è§’åº¦ |
| --- | --- |
| 0.5 ms | 0Â° |
| 1.0 ms | 45Â° |
| 1.5 ms | 90Â° |
| 2.0 ms | 135Â° |
| 2.5 ms | 180Â° |

ä¹Ÿå°±æ˜¯è¯´ï¼š

* å½“ PWM é«˜ç”µå¹³åªæœ‰ **0.5ms**ï¼Œèˆµæœºä¼šè½¬åˆ°æœ€å·¦è¾¹ï¼ˆ0Â°ï¼‰ï¼›
* å½“ PWM é«˜ç”µå¹³æ˜¯ **1.5ms**ï¼Œèˆµæœºä¼šæ­£ä¸­é—´ï¼ˆ90Â°ï¼‰ï¼›
* å½“ PWM é«˜ç”µå¹³åˆ° **2.5ms**ï¼Œèˆµæœºä¼šè½¬åˆ°æœ€å³è¾¹ï¼ˆ180Â°ï¼‰ã€‚

#### 3.3 STM32 æ§åˆ¶èˆµæœºçš„åŸç†

STM32 å•ç‰‡æœºå†…éƒ¨çš„ **å®šæ—¶å™¨ï¼ˆTimerï¼‰** å¯ä»¥äº§ç”Ÿ PWM ä¿¡å·ã€‚ä½¿ç”¨ HAL åº“é…ç½®æ—¶ï¼Œå…³é”®æ­¥éª¤æ˜¯ï¼š

1. **è®¾ç½®å®šæ—¶å™¨æ—¶é’Ÿ** ç¡®ä¿èƒ½äº§ç”Ÿç²¾ç¡®çš„ 20 ms å‘¨æœŸã€‚
2. **é…ç½® PWM æ¨¡å¼** æŠŠå®šæ—¶å™¨çš„æŸä¸ªé€šé“è®¾ä¸º **PWM è¾“å‡º**ï¼Œå¹¶æŠŠå¼•è„šæ˜ å°„åˆ°å¤–éƒ¨ï¼ˆæ¯”å¦‚ PA5ã€PB0 ç­‰ï¼‰ã€‚
3. **æ”¹å˜å ç©ºæ¯”** é€šè¿‡ä¿®æ”¹å®šæ—¶å™¨çš„æ¯”è¾ƒå¯„å­˜å™¨ï¼ˆCCR å€¼ï¼‰ï¼Œå°±èƒ½è°ƒæ•´ PWM è„‰å®½ï¼Œä»è€Œæ§åˆ¶èˆµæœºè§’åº¦ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

* CCR = 500 â†’ è„‰å®½çº¦ 0.5 ms â†’ èˆµæœºè½¬åˆ° 0Â°
* CCR = 1500 â†’ è„‰å®½çº¦ 1.5 ms â†’ èˆµæœºè½¬åˆ° 90Â°
* CCR = 2500 â†’ è„‰å®½çº¦ 2.5 ms â†’ èˆµæœºè½¬åˆ° 180Â°

### 4.STM32 HALåº“é©±åŠ¨MG996Rèˆµæœº

#### 4.1STM32CUBEMXåˆå§‹åŒ–

##### HAL åº“ä¸‹ PWM åˆå§‹åŒ–æ­¥éª¤

â‘ ç¡®å®šå®šæ—¶å™¨æ—¶åŸº

å‡è®¾ä½¿ç”¨ **84 MHz ä¸»é¢‘**ï¼Œå¸Œæœ›å¾—åˆ° 20 ms å‘¨æœŸï¼ˆ50 Hzï¼‰ï¼š

```

// 84 MHz / (Prescaler+1) / (Period+1) = 50 Hz
Prescaler = 84-1; Â  // 72 MHz / (71+1) = 1 MHz
Period Â  Â = 20000-1; // 1 MHz / (19999+1) = 50 Hz
```

**æ³¨ï¼šè¿™é‡Œæˆ‘ç”¨åˆ°çš„æ˜¯ STM32F407VET6 çš„ TIM12ã€TIM13 å’Œ TIM14ã€‚å®ƒä»¬éƒ½æŒ‚åœ¨ APB1 æ€»çº¿ä¸Šã€‚åœ¨ä¸»é¢‘ 168 MHz çš„æƒ…å†µä¸‹ï¼ŒAPB1 æ—¶é’Ÿæ˜¯ 84 MHzï¼Œæ‰€ä»¥å®šæ—¶å™¨ç›¸å…³çš„è®¡ç®—å°±ä»¥ 84 MHz ä¸ºåŸºå‡†ã€‚**

â‘¡CubeMX åˆå§‹åŒ–å®šæ—¶å™¨ æ‰“å¼€ CubeMX â†’ Pinout & Configuration â†’ Timers â†’ é€‰æ‹©ä¸€ä¸ªæ”¯æŒ PWM çš„å®šæ—¶å™¨ã€‚

```

Clock Sourceé…ç½®ä¸ºIntenal Clock
â€‹
è®¾å®šï¼š
```

* Prescaler = 84-1
* Counter Period = 20000-1
* Channel æ¨¡å¼è®¾ä¸º PWM Generation CHx
* æŠŠå¯¹åº”å¼•è„šè®¾ç½®ä¸º PWM è¾“å‡ºã€‚

![](https://i-blog.csdnimg.cn/img_convert/c5c1caadf9c1335fcf68b80280fdcecb.png)

#### 4.2æ ¸å¿ƒä»£ç 

**1.servo_app.cä»£ç **

```

#include "servo_app.h"
â€‹
// ================== èˆµæœºå‚æ•° ==================
// MG996R æ˜¯å¸¸ç”¨çš„èˆµæœºï¼Œå®ƒé€šè¿‡ PWM è„‰å®½æ¥æ§åˆ¶è§’åº¦ã€‚
// ä¸€èˆ¬æ¥è¯´ï¼š
// Â  0.5ms è„‰å®½ = 0Â°
// Â  1.5ms è„‰å®½ = 90Â°
// Â  2.5ms è„‰å®½ = 180Â°
// æ‰€ä»¥æˆ‘ä»¬å…ˆå®šä¹‰æœ€å°/æœ€å¤§è„‰å®½å€¼ï¼Œåç»­è§’åº¦è®¡ç®—ä¼šç”¨åˆ°ã€‚
#define SERVO_DEFAULT_MIN_PULSE 500 Â  // å¯¹åº” 0Â° æ—¶çš„è„‰å®½ (å•ä½: usï¼Œå¯¹åº”0.5ms)
#define SERVO_DEFAULT_MAX_PULSE 2500 Â // å¯¹åº” 180Â° æ—¶çš„è„‰å®½ (å•ä½: usï¼Œå¯¹åº”2.5ms)
â€‹
// å®šä¹‰å››ä¸ªèˆµæœºå¯¹è±¡ï¼ˆå·¦å³ä¸¤è¾¹å„ä¸¤ä¸ªï¼‰
Servo_MG996R_t MG996R_LEFT1;
Servo_MG996R_t MG996R_LEFT2;
Servo_MG996R_t MG996R_RIGHT1;
Servo_MG996R_t MG996R_RIGHT2;
â€‹
â€‹
// ================== èˆµæœºåˆå§‹åŒ– ==================
void Servo_Init(Servo_MG996R_t* servo, TIM_HandleTypeDef* htim, uint32_t channel)
{
 Â  Â // ä¿å­˜å®šæ—¶å™¨å’Œé€šé“ä¿¡æ¯
 Â  Â servo->htim = htim;
 Â  Â servo->channel = channel;
 Â  Â servo->min_pulse = SERVO_DEFAULT_MIN_PULSE;
 Â  Â servo->max_pulse = SERVO_DEFAULT_MAX_PULSE;
 Â  Â 
 Â  Â // å¯åŠ¨å¯¹åº”å®šæ—¶å™¨é€šé“çš„ PWM è¾“å‡º
 Â  Â HAL_TIM_PWM_Start(servo->htim, servo->channel);
}
â€‹
â€‹
// ================== è®¾ç½®èˆµæœºè§’åº¦ ==================
void Servo_SetAngle(Servo_MG996R_t* servo, float angle)
{
 Â  Â // 1. é™åˆ¶è§’åº¦èŒƒå›´åœ¨ [0Â°, 180Â°] ä¹‹é—´
 Â  Â if (angle < 0) angle = 0;
 Â  Â if (angle > 180) angle = 180;
 Â  Â 
 Â  Â // 2. æ ¹æ®è§’åº¦ -> æ¢ç®—ä¸ºè„‰å®½
 Â  Â // Â  è§’åº¦ 0Â° = min_pulse
 Â  Â // Â  è§’åº¦ 180Â° = max_pulse
 Â  Â uint16_t pulse = servo->min_pulse + (uint16_t)((servo->max_pulse - servo->min_pulse) * angle / 180.0f);
 Â  Â 
 Â  Â // 3. æŠŠæ¢ç®—å‡ºæ¥çš„è„‰å®½å€¼ï¼Œäº¤ç»™ PWM è¾“å‡º
 Â  Â Servo_SetPulse(servo, pulse);
}
â€‹
â€‹
// ================== è®¾ç½®èˆµæœº PWM è„‰å®½ ==================
void Servo_SetPulse(Servo_MG996R_t* servo, uint16_t pulse)
{
 Â  Â // 1. é™åˆ¶è„‰å®½åœ¨ [min_pulse, max_pulse] èŒƒå›´
 Â  Â if (pulse < servo->min_pulse) pulse = servo->min_pulse;
 Â  Â if (pulse > servo->max_pulse) pulse = servo->max_pulse;
 Â  Â 
 Â  Â // 2. ç›´æ¥å†™å…¥å®šæ—¶å™¨çš„æ¯”è¾ƒå¯„å­˜å™¨ (CCR)
 Â  Â // Â   è¿™ä¼šæ”¹å˜ PWM å ç©ºæ¯”ï¼Œä»è€Œæ”¹å˜èˆµæœºè§’åº¦
 Â  Â __HAL_TIM_SET_COMPARE(servo->htim, servo->channel, pulse);
}
â€‹
â€‹
// ================== æ ¡å‡†èˆµæœºè„‰å®½èŒƒå›´ ==================
void Servo_Calibrate(Servo_MG996R_t* servo, uint16_t min_pulse, uint16_t max_pulse)
{
 Â  Â // ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±èˆµæœºçš„å®é™…æƒ…å†µè°ƒæ•´
 Â  Â servo->min_pulse = min_pulse;
 Â  Â servo->max_pulse = max_pulse;
}
â€‹
â€‹
// ================== åˆå§‹åŒ–æ‰€æœ‰èˆµæœº ==================
void Servo_Init_All(void)
{
    // å·¦è¾¹ä¸¤ä¸ªèˆµæœºæŒ‚åœ¨ TIM12 (CH1, CH2)
    Servo_Init(&MG996R_LEFT1, &htim12, TIM_CHANNEL_1);
    Servo_Init(&MG996R_LEFT2, &htim12, TIM_CHANNEL_2);
    
    // å³è¾¹ä¸¤ä¸ªèˆµæœºæŒ‚åœ¨ TIM13 (CH1) å’Œ TIM14 (CH1)
    Servo_Init(&MG996R_RIGHT1, &htim13, TIM_CHANNEL_1);
    Servo_Init(&MG996R_RIGHT2, &htim14, TIM_CHANNEL_1);
}
â€‹
â€‹
// ================== æ¼”ç¤ºä»»åŠ¡ï¼šè®©èˆµæœºè½¬åˆ°ä¸åŒè§’åº¦ ==================
void Servo_Task(void)
{
    // å·¦1 = 0Â°
    Servo_SetAngle(&MG996R_LEFT1, 0);
    
    // å·¦2 = 45Â°
    Servo_SetAngle(&MG996R_LEFT2, 45);
    
    // å³1 = 90Â°
    Servo_SetAngle(&MG996R_RIGHT1, 90);
    
    // å³2 = 135Â°
    Servo_SetAngle(&MG996R_RIGHT2, 135);
}
â€‹
```

**2.servo_app.hä»£ç **

```

#ifndef __SERVO_APP_H__
#define __SERVO_APP_H__
â€‹
#include "MyDefine.h"
typedef struct {
 Â  Â TIM_HandleTypeDef* htim; Â // å®šæ—¶å™¨å¥æŸ„
 Â  Â uint32_t channel; Â  Â  Â  Â  // å®šæ—¶å™¨é€šé“
 Â  Â uint16_t min_pulse; Â  Â  Â  // æœ€å°è„‰å®½(0åº¦ä½ç½®)
 Â  Â uint16_t max_pulse; Â  Â  Â  // æœ€å¤§è„‰å®½(180åº¦ä½ç½®)
} Servo_MG996R_t;
â€‹
// åˆå§‹åŒ–èˆµæœº
void Servo_Init(Servo_MG996R_t* servo, TIM_HandleTypeDef* htim, uint32_t channel);
â€‹
// è®¾ç½®èˆµæœºè§’åº¦ (0-180åº¦)
void Servo_SetAngle(Servo_MG996R_t* servo, float angle);
â€‹
// è®¾ç½®èˆµæœºåŸå§‹è„‰å®½å€¼
void Servo_SetPulse(Servo_MG996R_t* servo, uint16_t pulse);
â€‹
// æ ¡å‡†èˆµæœºæœ€å°å’Œæœ€å¤§è„‰å®½
void Servo_Calibrate(Servo_MG996R_t* servo, uint16_t min_pulse, uint16_t max_pulse);
â€‹
void Servo_Init_All(void);
void Servo_Task(void);
â€‹
â€‹
#endif
â€‹
```

**3.main.c ç¤ºä¾‹ä»£ç **

```

/* USER CODE BEGIN Includes */
#include "servo_app.h" Â  // å¼•å…¥ä½ å†™çš„èˆµæœºé©±åŠ¨å¤´æ–‡ä»¶
/* USER CODE END Includes */
â€‹
int main(void)
{
 Â /* MCU Configuration--------------------------------------------------------*/
â€‹
 Â /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
 Â HAL_Init();
â€‹
 Â /* Configure the system clock */
 Â SystemClock_Config();
â€‹
 Â /* Initialize all configured peripherals */
 Â MX_GPIO_Init();
 Â MX_TIM12_Init(); Â  // é…ç½® TIM12
 Â MX_TIM13_Init(); Â  // é…ç½® TIM13
 Â MX_TIM14_Init(); Â  // é…ç½® TIM14
â€‹
 Â /* USER CODE BEGIN 2 */
 Â // === åˆå§‹åŒ–æ‰€æœ‰èˆµæœº ===
 Â Servo_Init_All();
 Â /* USER CODE END 2 */
â€‹
 Â /* Infinite loop */
 Â /* USER CODE BEGIN WHILE */
 Â while (1)
  {
 Â  Â // === æ¼”ç¤ºèˆµæœºåŠ¨ä½œ ===
 Â  Â Servo_Task(); Â  // è®¾ç½® 0Â°ã€45Â°ã€90Â°ã€135Â°
 Â  Â HAL_Delay(2000); // åœ 2 ç§’ï¼Œæ–¹ä¾¿è§‚å¯ŸåŠ¨ä½œ
 Â  Â 
 Â  Â // ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®æŸä¸ªèˆµæœºçš„è§’åº¦ï¼Œä¾‹å¦‚ï¼š
 Â  Â Servo_SetAngle(&MG996R_LEFT1, 180); Â // å·¦1è½¬åˆ° 180Â°
 Â  Â HAL_Delay(1000);
â€‹
 Â  Â Servo_SetAngle(&MG996R_LEFT1, 90); Â  // å·¦1è½¬å› 90Â°
 Â  Â HAL_Delay(1000);
 Â  Â 
  }
 Â /* USER CODE END WHILE */
}
â€‹
```



