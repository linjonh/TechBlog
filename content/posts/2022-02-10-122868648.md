---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34313939393733312f:61727469636c652f64657461696c732f313232383638363438"
layout: post
title: "文章2多功能智能跟随行李箱控制系统设计-本科毕业设计-论文终稿"
date: 2022-02-10 21:05:59 +08:00
description: "毕 业 设 计 [论 文]题 目： 多功能智能跟随行李箱控制系统设计摘要科技产品不断融入人们的生活，"
keywords: "自动跟随,UWB定位,智能行李箱"
categories: ['多功能智能跟随行李箱']
tags: ['程序设计', '物联网', '智能传感器']
artid: "122868648"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122868648
    alt: "文章2多功能智能跟随行李箱控制系统设计-本科毕业设计-论文终稿"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122868648
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122868648
---

# 文章2：多功能智能跟随行李箱控制系统设计 | 本科毕业设计 - 【论文终稿】

先简单介绍一下👇 下文有“长篇大论”

---

**全文字数：**
2.7万；
**图片：**
68张；
**页数(A4)：**
80页；
**有原理图、程序流程图、程序源码等**

**【关键词】：**
自动跟随；UWB定位；智能行李箱；分布式硬件；指纹解锁；智能称重；超距离报警；USB快充

**【创新点】：**
1. 在自动跟随系统的设计中，对定位技术和定位跟随方法进行了对比分析，建立了行李箱运动的数学模型，设计出了一套自动跟随方法；2. 在智能跟随行李箱功能的设计中，增加了指纹解锁、自动称重、超距离报警、USB双向快充四大功能；3. 提出了分布式控制系统硬件结构方案，以提高系统的实时性和可靠性。

**【实现功能】：**
1. 定位跟随：首先通过定位技术，确定行李箱与用户之间的相对位置，进而通过自动跟随算法，驱动箱体底部的动力电机，最终达到跟随效果。2. 自动避障：利用超声波、激光雷达等测距传感器识别障碍物，进而做出躲避抉择，通过驱动箱体底部的动力电机，最终达到避障效果。3. 指纹解锁：通过光电式或电容式指纹传感器进行指纹信息的采集和识别，以指纹解锁的方式提高行李箱的安全性能。4. 自动称重：通过设计在行李箱侧面的称重传感器，自动测量行李箱及箱内物品的整体重量。5. 超距离报警：以定位技术为前提，识别到行李箱距离用户超过预定的距离值后，自动产生报警信号，用以提高行李箱的安全性能。超距离报警分两个距离段，当行李箱距离用户超过1.5m时，产生一小段报警声；当距离超过2.5m时，不断产生报警声，直至距离恢复至1.5m以内。

---

## 题 目： 多功能智能跟随行李箱控制系统设计

## 摘要

科技产品不断融入人们的生活，给人们带来了便利。近年来，与人们出行相关的智能跟随行李箱产品不断涌入市场，其丰富的功能和自动跟随特性，在解放了人们双手的同时，也满足了人们在旅途中的需求，提高了人们的旅行体验。

本文针对市场上智能跟随行李箱在功能及自动跟随性能上的不足，并结合人们的需求，进行了多功能智能跟随行李箱控制系统设计。在自动跟随系统的设计中，对定位技术和定位跟随方法进行了对比分析，建立了行李箱运动的数学模型，设计出了一套自动跟随方法。其中，定位模块基于UWB超宽带定位技术，实现了行李箱对用户的精准定位，具有较高抗多径干扰能力；TOF+AOA定位方法通过降低基站数量进而降低了硬件成本，同时也保证了定位精度；工业级的超声波模块能够准确感知环境中的障碍物。另外，本文对行李箱驱动系统进行了分析和计算，以满足行李箱的动力需求。

在智能跟随行李箱功能的设计中，增加了指纹解锁、自动称重、超距离报警、USB双向快充四大功能，并分别根据行李箱的使用环境进行了器件选型及电路设计。在控制系统硬件设计中，提出了分布式控制系统硬件结构方案，以提高系统的实时性和可靠性。同时对控制系统中自动跟随、指纹解锁、智能称重三大系统进行了软件设计。最后，搭建多功能智能跟随行李箱实验测试平台，对系统中各模块的硬件电路及软件程序进行测试。

**关键词：**
自动跟随；UWB定位；智能行李箱；分布式硬件；指纹解锁

## ABSTRACT

Science and technology products continue to integrate into people’s lives and bring convenience to people. In recent years, intelligent following luggage products related to people’s travel have been pouring into the market. Its rich functions and automatic following features not only liberate people’s hands, but also meet people’s needs in the journey and improve people’s travel experience.

In this paper, aiming at the deficiency of the function and automatic following performance of the intelligent following luggage in the market, and combined with people’s needs, a multi-functional intelligent following luggage control system is designed. In the design of automatic following system, the positioning technology and positioning following method are compared and analyzed, the mathematical model of trunk movement is established, and a set of automatic following method is designed. Among them, the positioning module is based on UWB positioning technology, which realizes the accurate positioning of the trunk to the user and has high anti multipath interference ability; By reducing the number of base stations, TOF + AOA can reduce the hardware cost and ensure the positioning accuracy; The industrial ultrasonic module can accurately sense the obstacles in the environment. In addition, this paper analyzes and calculates the trunk drive system to meet the power demand of the trunk.

In the design of intelligent following trunk function, four functions are added, including fingerprint unlocking, automatic weighing, over distance alarm and USB two-way fast charging. The device selection and circuit design are carried out according to the use environment of the trunk. In the hardware design of the control system, the hardware structure of the distributed control system is proposed to improve the real-time performance and reliability of the system. At the same time, the software of automatic following, fingerprint unlocking and intelligent weighing system is designed. Finally, a multi-functional intelligent test platform is built to test the hardware circuit and software program of each module in the system.

**Key words:**
automatic following, UWB positioning, intelligent luggage, distributed hardware，fingerprint lock

***目 录***
  
（请使用CSDN左侧快捷目录）

## 1.绪论

### 1.1引言

科技不断地改变着我们的生活。行李箱是人们旅途中的好帮手，最早的行李箱可追溯到20世纪20年代的木制手提箱，随着航空业的发展，轮式行李箱于1972年在美国问世[1]。直至1987年才出现了装上了轮子和拉杆的立式拉杆箱，解决了乘务人员到处跑的困难，逐渐普及到全球市场。行李箱极大地方便了人们的出行，如今的行李箱不只是设计的更美观更人性化，万向轮的使用也让拖行更加方便。在当今的移动互联时代，各种智能化设备一步步融入人们日常生活的各个领域，智能行李箱也不例外。定位防盗、自动跟随、智能称重、USB充电等功能通过智能硬件都可以集成在行李箱上，尤其是自动跟随功能，能让你解放双手、边走边玩，智能行李箱的问世是行李箱发展史上的一次重大突破。但是智能行李箱的发展才刚刚开始，市场上的智能行李箱有稳定性不佳、性价比不高的缺点。本文设计的多功能智能跟随行李箱亦为一种自动跟随行李箱，而且有指纹解锁、USB充电、超距报警、智能称重等实用功能。
  
![在这里插入图片描述](https://i-blog.csdnimg.cn/blog_migrate/cb296f6fca59bf5d73ac26894f1d18f1.png)

图1.1 1980年的行李箱(左) 图1.2 2020年的智能跟随行李箱(右)

### 1.2研究背景及意义

我国正处于科技创新发展关键时期，经济发展也进入了新常态，经济增长由高速转变为中高速。基于此，党的十九届五中全会明确提出要强化国家科技力量、提升企业科技创新水平，以创新驱动、高质量供给创造新需求，打造经济发展新动能[2]。科技发展至今，沉淀下来的智能器件、模块数不胜数，而且有着完善的技术支持，在不断的迭代中，这些智能器件和技术不断升级优化，为科研机构、高校、企业等场所提供源源不断的研发支持。丰富多样的科技产品不断涌进人们的生活，给人们的生活带来了显著的变化，产品的智能化程度也越来越高，越来越多的智能化产品逐步取代人工操作，极大地提高了人们的工作效率也不断地解放着人力。智能跟随行李箱就是众多科技产品之一。

在人们的生活中，行李箱是必不可少的，如果出远门，那一定离不开行李箱。行李箱的发展经过了近一个世纪的发展，从木制的手提箱发展至现在的轮式拉杆箱，随着人们对其不断改进，不管是从形态上还是实用型都发生了很大的变化，万向轮的应用也让人们在使用中更加方便、省立，机械密码锁的设计也让行李箱更安全。但即使是这样，人们的需求仍在不断增长，行李箱拖动时间长了会使人感觉很累、拖动行李箱时一只手会被占用、称重时需要自己搬到体重秤上很不方便、存在遗忘或者被盗窃的风险等等，而智能跟随行李箱的研究就是为了解决以上问题[17]。早在2011年就出现了人们对智能行李箱研究的迹象，能实现物品在行李箱中的自动称重，随后的几年里，指纹解锁、超距报警、远程定位、自动跟随等更多的智能化功能被赋予在行李箱上。2016年以后以自动跟随为主的多功能智能跟随行李箱产品出现的世界各地的市场中。时至今日，很多智能跟随行李箱研发企业根据人们的使用发聩和机构对自家产品的测试以及对智能行李箱功能的优化升级，都迭代了数个产品，当今的产品功能更丰富、稳定性也更强，更符合人们的需求[3]。

传统行李箱一般都是用拖或者推的方式，会比较累，而且腾不出手拿其他物品，虽能满足装行李的需求，但体验感不是很强。智能跟随行李箱是近几年才发展出来的新产品，它将近距离定位技术、无人驾驶技术等智能化技术集中应用到了传统拉杆行李箱，能够实现行李箱自动跟随用户行走，同时属于行李箱和自动跟随机器人相关类别的产品。

其丰富的功能带给人们各种使用体验：其自动跟随功能，能让人们可以一手打电话或者发消息，再一手提着一些物品，解放用户双手，给使用者更多自由的空间，减轻了人们路途中的负担；其追踪定位和超距离报警功能，能让行李箱具有更高的安全性能；其指纹解锁、手机APP解锁等电子解锁方式，在提高行李箱安全性能的同时，能更快速、更方便打开自己的行李箱；其可拆卸便携式移动电源赋予行李箱的USB充电功能，能让人们给手机等电子设备应急充电，解决人们的不时之需。

新事物发展到成熟都需要经历一个漫长的过程，市场上的智能跟随行李箱产品普遍存在着各种不同的问题，如稳定性不足、跟随效果不好、功能缺乏、价格过高等影响用户使用体验的问题[5]。

本文研究的多功能自动跟随行李箱控制系统，是为了解决自动跟随稳定性和精确性问题，并赋予行李箱指纹解锁、智能称重、超距报警等更丰富的功能。旨在根据稳定的控制系统更好地改善用户旅行体验和生活水平，方便人们出行。另外智能跟随行李箱的发展对国家民生科技与战略新兴产业的发展具有重要推动作用。

### 1.3国内外研究现状

#### 1.3.1国外智能跟随行李箱研究现状

国外智能跟随行李箱的发展相对较早，在2015年4月，以色列AI Robotics公司曾向公众发布了一款机器人旅行箱产品的概念模型，箱子内置摄像头和动力驱动装置，可以通过蓝牙与用户手机连接，具有自主跟随用户行走并与用户进行互动交流的功能，而且箱子可以自动检测内部物品的重量，让用户在旅途中快速了解行李是否超重，同时具有防盗报警器功能，超过预定的安全距离就会报警，除此之外还能通过内置充电系统为手机和其他电子设备充电。但AI Robotics公司众筹200万美元之后，至今尚未将产品交付给消费者，目前在做无人飞行器产品[3]。

2016年，美国的Blue smart公司向公众推出了第一代智能旅行箱产品Blue smart One，相比以色列AI Robotics公司的机器人旅行箱概念模型，Blue smart One多出了使用手机app对箱子进行GPS定位追踪、手机操控上锁解锁、记录飞行距离和降落机场等更加丰富的功能。它的出现使得旅行箱进入到智能物联网时代，试图让行李箱成为人们旅途中的有力助手。在Blue smart之后，国内外多家科技型创业公司相继推出了类似的产品，其中甚至包括美国新秀丽、德国RIMOWA(日默瓦)等国际知名箱包大牌企业，但功能水平参差不齐，存在着稳定性不高、实用性欠佳、性价比不高等诸多问题。

#### 1.3.2国内智能跟随行李箱研究现状

国内行李箱的发展可以追溯到2016年，安徽的一家机器人初创公司酷哇机器人，在2016年4月展示了一款名叫“COWROBOTR1”的智能行李箱概念模型，并开始众筹。它能够实现自动跟随及自主避障，行李箱的外观和普通行李箱相差无几，最大的创新点是其驱动轮放置在了行李箱底部的中间位置且能够自动升降，应用了飞机起落架原理。在使用中，用户能够随时切换自动跟随与手动模式。与众多国外产品一样，COWROBOTR1有GPS定位系统、距离感应系统、可拆卸的便携式移动电源USB供电等功能。30天的总共筹得58345美金，2018年产品做出后售价一度高达万元，后来公司对功能减配来降低成本，最终公司对产品实际效果和市场并不满意，目前酷哇机器人公司已经停止对智能行李箱的研究，现专注于城市复杂场景下智能驾驶和智能网联技术的研发及应用[3]。

继COWROBOTR1之后，国内曾出现过多家研发和销售智能跟随行李箱的企业，包括上海润米科技有限公司、北京灵动科技有限公司、常州爱尔威智能科技有限公司、深圳市爱途仕智能科技有限公司等。目前除了上海润米科技发布了90FUN自平衡智能跟随行李箱后没有继续研发新品的相关媒体报道外，其余三家公司仍在继续研发和销售智能跟随行李箱，其中做的最好的是灵动科技的OVIS智能跟随行李箱，有着较强的自主跟随稳定性和丰富的人性化功能。

![](https://i-blog.csdnimg.cn/blog_migrate/5b836367bab7d5e774086c78172621d8.png)

图1.3 国内四款行李箱，从左到右依次为:爱途仕、酷哇、爱尔威、灵动科技

智能行李箱产品发展至今，虽相对于初代产品有了很大的改进和优化，但在功能跟上、性价比上仍有很大缺陷，部分品牌行李箱还存在着控制效果不好的情况。如：酷哇智能跟随行李箱是采用激光雷达与摄像头的技术，扫描距离箱子最近的一个人，很容易跟错人；爱途仕使用蓝牙信号定位跟踪，但存在配对麻烦、动力不线性、容易跟丢、手动时只能纵向推动等严重影响用户使用体验。

### 1.4本文主要研究内容

本文通过分析市场上已存在的多功能智能跟随行李箱产品的稳定性、可靠性、功能的丰富性以及是否符合人性化的设计，针对行李箱的定位跟随系统进行了优化设计，保证了行李箱自动跟随的稳定可靠。在人性化设计方面，增加了指纹解锁、自动称重、超距离报警、USB双向快充四大功能，充分解决了用户的使用需求。

本文的研究重点是自动跟随，行李箱自动跟随用户的实现是基于定位技术、动力驱动和定位跟随算法的，本文通过分析GPS、机器视觉、UWB等七种主要的定位技术和TOA、TOF、AOA等五种定位跟随方法，对比选择出适合室外定位且具有精准度高、稳定性高、抗干扰能力强的技术方法。并针对行李箱的自动跟随功能，建立了行李箱运动模型，以便自动跟随软件编程的实现。在动力驱动设计中，利用简化理想模型对动力电机的扭矩和转速进行了计算，以便行李箱的动力满足用户正常的行走速度。

在控制方案的选择中，基于较高的实时性和可靠性需求，选择多处理器分布式控制，同时便于控制系统的升级与维护。在其他功能的实现上，通过对相关参考文献的研读，分析了各功能实现的相关技术原理，然后进行硬、软件设计。硬件设计包括模块选型和电路设计，模块选型时，本设计基于小体积、小重量、低功耗、较高的抗干扰能力和防水能力、较高的集成能力等原则，选择出适合安装于行李箱中的模块器件。在电路设计中根据自身的知识储备以及相关硬件的用户手册、数据手册，设计出合理了的硬件方案。软件设计包括自动跟随系统软件设计、指纹解锁软件设计、智能称重软件设计三大部分，软件设计中基于硬件电路和控制器对各功能部分进行了设计。最后，对系统各功能部分进行了测试分析，在功能模块单独测试无误条件下，综合各部分模块进行联调联试，分析多功能智能跟随行李箱的综合性能。

## 2.系统总体设计与原理分析

本章主要对智能跟随行李箱控制系统进行总体设计规划，提出了功能需求，并分析、对比了定位与跟随技术相关的理论基础与实现方法，最后对行李箱的材质、尺寸、外观等方面进行了说明，提出了控制系统的被控对象。

### 2.1总体功能需求分析

根据对市场上智能跟随行李箱的调查研究以及用户的反馈，本设计的主要内容包括对定位跟随、自动避障、指纹解锁、自动称重、超距离报警、USB双向快充功能的设计。其中定位跟随与自动避障功能需达到精确定位和稳定跟随，是主要的研究对象。

**定位跟随：**
首先通过定位技术，确定行李箱与用户之间的相对位置，进而通过自动跟随算法，驱动箱体底部的动力电机，最终达到跟随效果。

**自动避障：**
利用超声波、激光雷达等测距传感器识别障碍物，进而做出躲避抉择，通过驱动箱体底部的动力电机，最终达到避障效果。

**指纹解锁：**
通过光电式或电容式指纹传感器进行指纹信息的采集和识别，以指纹解锁的方式提高行李箱的安全性能。

**自动称重：**
通过设计在行李箱侧面的称重传感器，自动测量行李箱及箱内物品的整体重量。

**超距离报警：**
以定位技术为前提，识别到行李箱距离用户超过预定的距离值后，自动产生报警信号，用以提高行李箱的安全性能。超距离报警分两个距离段，当行李箱距离用户超过1.5m时，产生一小段报警声；当距离超过2.5m时，不断产生报警声，直至距离恢复至1.5m以内。

**USB双向快充：**
采用USB双向快充技术，通过便携式可拆卸的电源，实现为行李箱工供电的同时，可为用户的智能设备应急供电。其中快充技术的实现能够极大节省用户充电的等待时间。

通过以上的功能，旨在将现代科技带入到人们的日常生活中，为智能跟随行李箱用户更好的使用体验。对于以上功能的具体原理及技术分析，将在本章后半部分叙述。

### 2.2定位技术与定位方法原理分析

定位技术有很多种，但总体上分为两大类：视觉定位和非视觉定位[13]。视觉定位技术是通过视觉系统，依据图像识别的算法提取目标位置信息。非视觉定位技术主要是依靠具有能量和传播方向的信号大面积覆盖，根据信号传播时间、能量衰减、相位、角度等关系计算机器人和移动目标之间的位置关系，如超声波、激光、蓝牙、WiFi、UWB超宽带。

#### 2.2.1定位技术分析

自动跟随系统实现的前提是定位技术，下面对主要的定位技术进行分析:

**（1）视觉定位技术**

借助视觉传感器完成，机器人借助单目、双目摄像头、深度摄像机、视频信号数字化设备或基于DSP的快速信号处理器等其他外部设备获取图像，

**优点：**
能够识别用户体态特征，运用灵活，不用携带信号源或者遥控器。

**缺点：**
视觉控制系统和图像处理算法较为复杂，开发难度大；由于图像处理量巨大，一般计算机无法完成运算；实时性较差且受光线条件限制较大，无法在黑暗环境中工作；成本很高；识别人的背后，人多的时候穿插走动容易误判跟丢。

**（2）GPS定位技术**

GPS全球卫星定位导航系统，是利用导航卫星进行测时、测距，通过地球上的接收机接收卫星发出的电磁波并进行解析，进而测算出地面点的三维坐标值，是目前市场上应用最为广泛的室外定位技术，它可以为地球表面绝大部分地区（98%）提供准确的定位。

**优点：**
技术成熟稳定，卫星有效覆盖范围大，不易受任何天气的影响，且定位导航信号免费。

**缺点：**
GPS信号受建筑物的影响较大，且定位精度较低，因此室内定位并不适用。

**（3）蓝牙定位技术**

蓝牙定位技术是基于RSSI（Received Signal Strength
  
Indication，信号场强指示）定位原理。通过测量不同基站下的RSSI值，再通过定位算法计算出目标的具体位置。

**优点：**
受环境干扰较小，功耗低。

**缺点：**
传统的蓝牙定位技术作用距离短，定位精度低，不便于整合到其它系统中。

需要说明的是：蓝牙国际标准组织（SIG，Bluetooth Special Interest Group）在2018年1月28日发布的蓝牙规范实现5.1版本，通过蓝牙5.1AOA定位技术，不仅可以检测到特定对象的距离，还可以检测它所处的方向，可用以实现厘米级定位精度。

**（4）红外线定位技术**

通过给固定空间安放的多个红外传感器测量信号源的距离或角度，从而计算出对象所在的位置。

**优点：**
具有相对较高的室内定位精度。

**缺点：**
不适用于室外。功耗较大，且常常受到室内墙体或物体的阻隔，受热源、灯光等干扰会造成定位精度和准确度下降。实用性较差。

**（5）超声波定位技术**

通过适当布置传感器的位置，利用超声波测距的原理，经过计算后可以得到主体在二维或三维空间的位置。

**优点：**
精度可达厘米级，精度比较高，成本低，

**缺点：**
容易受天气、周围环境等以及障碍物阴影，表面粗糙等外界环境的影响，在空气中的传播距离比较短，适用范围较小，测距距离较短，采集速度慢，导航精度差；在传输过程中衰减明显，从而影响其定位有效范围，而且周围不能持续有同频的超声波干扰。

**（6）UWB超宽带定位技术**

超宽带(UWB技术)是一种无线电技术，通过标签、基站之间相互发送电磁波进行通信，进而准确地测量无线电信号的飞行时间，从而实现厘米精度的距离、位置测量。

**优点：**
实时性好、系统复杂度低、定位精度高、抗多能力强。

**缺点：**
模块成本高。

**（7）RFID定位技术**

与蓝牙定位技术相似，是基于RSSI定位原理。通过测量不同基站下的RSSI值，再通过定位算法计算出目标的具体位置。

**优点：**
成本很低，标签体积很小，可制作成薄片的形状。

**缺点：**
定位误差大，系统部署复杂，容易受到环境影响。

对于以上定位技术，蓝牙、RFID、UWB超宽带实现定位的方法属于信标定位和三角测量法，需要在环境内铺设信标或者信号基站，其中UWB超宽带定位成本较高。GPS卫星导航定位只能用于室外无遮挡环境，且民用GPS定位精度低，误差超过1m，而红外线定位技术则只能应用于可大面积布置信号发射源的室内[4]。

蓝牙AOA发展较晚，虽然得到了业界的积极响应和支持，但目前市场上公开的蓝牙5.1定位测向技术极少，而且蓝牙信号的多径反射问题也在一定程度上影响了行李箱定位的精度[4]。UWB在国内发展有十多年了，其应用广，市场较大，定位精度高，运行稳定。综合考虑后，本设计采用UWB定位技术实现行李箱的自动跟随与超距离报警功能。

#### 2.2.2定位算法分析

目前的基站定位方法主要有：TOA、TDOA、TOF、RSS、AOA，下面对五种定位方法原理进行对比分析。

**TOA(Time ofArrival)**
是一种到达时间定位法。它是基于电磁波的传播时间，并在已知环境下布置的三个基站来协助定位的，其原理是通过3个到达时间计算出设备到三个基站的距离，然后根据几何关系求解得到目标点的相对坐标，即可得到目标点的距离和方向。TOA完全依赖于时间，对系统的时间同步要求很高，很小的时间误差都会被放大很多倍，尤其要考虑信号的多径反射问题引起的误差。

![](https://i-blog.csdnimg.cn/blog_migrate/15b6656710993052b0e4211ac76c8953.png)

图2.1 TOA定位原理示意图

图中BS1、BS2、BS3是三个基站的位置，MS是标签的位置。设基站坐标分别为(x1，y1)、(x2，y2)、(x3，y3)，标签为未知坐标(x，y)，测得三个基站到MS的距离分别为r1、r2、r3。通过三边定位法计算出基站位置，在基站和标签时钟完全同步情况下，可根据以下方程计算出标签的相对坐标。

![](https://i-blog.csdnimg.cn/blog_migrate/8261f98bb87abafb4e413f5c3ca17dbe.jpeg)

**TDOA（Time Difference ofArrival）**
是一种到达时间差定位法，同样需要三个已知坐标的基站，通过3个到达时间的时间差得到目标点的位置坐标，TDOA巧妙设计的求差过程可降低时间误差引起的定位误差。

如图2.2，设基站坐标分别为(x1，y1)、(x2，y2)、(x3，y3)，标签为未知坐标(x，y)，基站接收到标签发出的信号的时间为t1、t2、t3，t1、t2之间的时间差为t1,2，t2、t3之间的时间差为t1,3。记MS与BS1、BS2的距离差为r1,2，MS与BS1、BS3的距离差为r1,3，MS与BS2、BS3的距离差为r2,3。根据双曲线定义，可以得到一条以BS1、BS2为焦点，以r1,2为焦距的双曲线，如上图蓝色双曲线，同理可得另外两对双曲线，三对双曲线的交点即为标签位置，进而通过计算双曲线的交点即可确定MS的坐标，可列出如下方程组：

![](https://i-blog.csdnimg.cn/blog_migrate/7da2e74444978f1be8afe31dbeabde90.jpeg)

由式(2.2)可得双曲线方程组：

![](https://i-blog.csdnimg.cn/blog_migrate/f6b07e67d760d7219fb5558788eccfb1.jpeg)

解方程组得到的坐标即为MS的坐标。

![](https://i-blog.csdnimg.cn/blog_migrate/d426745cbf6527e8f14d08726251861d.png)

图2.2 TDOA定位原理示意图

**TOF（Time offlight）**
属于双向测距定位技术，它主要利用信号在两个异步收发机之间往返的飞行时间来测量节点间的距离，同TOA和TDOA相似，如果要得到目标点的距离和方向，也需要三个基站。

记基站发出信号到基站接收到回应信号的时间间隔为Tt，标签接收到信号到标签发出回应信号的时间间隔为Tr，则可得到信号在空中单向飞行的时间Tf = (Tt-Tr)/2，根据d =c*Tf即可计算出基站与标签之间的距离，其中c表示电磁波传播速度。坐标计算公式与TOA相似。

![](https://i-blog.csdnimg.cn/blog_migrate/abc6dad21ded876ba6ee89edeaa6d9ff.png)

图2.3 TOF定位原理示意图

**RSS定位法**
是一种根据接收信号的强度来实现定位的方法。同样需要三个已知坐标的基站，通过测量3个基站的信号强度，估算出三个距离值，进而得到目标点的相对坐标。RSS定位易受信道和噪声影响，误差较大。

基站与标签之间的距离可以表示为：

![](https://i-blog.csdnimg.cn/blog_migrate/007bd0590fbc2feb93048c2b7b2ba118.jpeg)

其中，d为拟合得到的估计距离，RSSI为信号强度，a为基站与标签相隔一米时的信号强度，n为环境衰减因子。坐标计算公式与TOA相似。

**AOA(Angle ofArrival)**
即到达角度定位法。是一种两基站定位方法，基于信号的入射角度进行定位。其通过两直线相交确定位置。

![](https://i-blog.csdnimg.cn/blog_migrate/815bfd15657b56ad6d80cf1b33a1e1b7.png)

图2.4 AOA定位原理示意图

其中信号的入射角可以利用TDOA或TOA或TOF法获取标签到两基站的距离，再通过几何关系计算出信号到达角度，利用相对角度从基站位置画出两条直线，两条直线的交点就是标签的位置，而且基站的位置是固定的，因此基站坐标已知。同样设基站BS1、BS2坐标分别为(x1，y1)、(x2，y2)，标签为(x，y)，BS1、BS2到MS的信号角度分别为α1和α2，通过角度关系可得到以下方程组，求解基站MS坐标。

![](https://i-blog.csdnimg.cn/blog_migrate/0eda64ddc1a86d1b4908f5ff4d71b376.jpeg)

以上方法均能实现对行李箱的定位，但分析其优缺点和使用场合，只有AOA定位方法适合UWB定位。TOA定位方法模型简单，但定位精度非常不稳定；TODA定位精度稍高，但仍不满足行李箱的使用环境；RSSI信号极易受到干扰，还有很大的定位误差，且单独使用TOA、TODA、TOF、RSS定位方法均须多个基站。综合考虑后，本设计选择TOF+AOA两基站定位方法。

### 2.3自动跟随及避障技术分析

要实现自动跟随功能，一共需要两个步骤：知道目标在哪、能跟着目标运动；在自动跟随的过程中，还需要躲避障碍物，避障也需要两个步骤：识别障碍物、躲避障碍。使用定位模块能实现“知道目标在哪”；通过超声波传感器和激光雷达“能识别障碍物”；“跟着目标运动”和“躲避障碍”需要进行动态路径规划并通过动力驱动模块驱动行李箱运动。本设计采用中间两轮驱动方式来驱动行李箱（驱动方式分析详见"3.4.1动力轮的设计"），通过差速控制实现转向。

#### 2.3.1行李箱运动模型

设计如下行李箱运动模型：

![](https://i-blog.csdnimg.cn/blog_migrate/787aec2403b6219f39c8d54e30256ad1.png)

图2.5 行李运动模型坐标系

如图，以行李箱所在平面中的一点O为原点，建立直角坐标系O-xy，以某时间间隔很短的相邻两个时刻行李箱的位置为研究对象。其中R是行李箱的转弯半径，L是行李箱两个驱动轮的中心间距，
*υ*
L和
*υ*
R分别是行李箱左、右驱动轮的速度，
*θ*
1是行李箱在相邻的两个时刻的转弯角度，
*θ*
2是行李箱在相邻两时刻航向角的变化量，
*θ*
3是辅助角，与
*θ*
1相同。设行李箱的速度为
*υ*
，角速度为
*ω*
。

由图中的几何关系可得到:

![](https://i-blog.csdnimg.cn/blog_migrate/0a09ba0d159234abc9b6f7cb9a98893b.jpeg)

记相邻时间间隔为Δt，由于Δt很小，其自身姿态航向角变化量
*θ*
2很小，故可得近似公式：

![](https://i-blog.csdnimg.cn/blog_migrate/12ca72ac8febb2cf5cbdbb20494a65b3.jpeg)

行李箱的角速度为：

![](https://i-blog.csdnimg.cn/blog_migrate/d22be383e23a0c2d32619b4b44f3e1a5.jpeg)

行李箱前进速度为左右驱动轮的平均速度：

![](https://i-blog.csdnimg.cn/blog_migrate/5ded18523794e70492912d1d8f021179.jpeg)

行李箱的转弯半径可表示为：

![](https://i-blog.csdnimg.cn/blog_migrate/f89c6c1ae91c90d9228999713216065f.jpeg)

行李箱运动的控制主要是控制行李箱左右驱动轮的速度来实现对行李箱前进速度、转向角速度和转弯半径等参数的控制，故以三维向量作为行李箱的控制向量。

#### 2.3.2自动跟随方法

行李箱对目标的跟随主要分为两种控制模式：普通跟随和避障跟随。在普通跟随模式下，前方检测到障碍物时，行李箱自动切换为避障跟随模式。设计如下行李箱跟随模型：

以行李箱所在地平面中的一点O为原点建立空间坐标系O-xyz，如图2.6。其中X轴Y轴分别与行李箱前侧面和左侧面平行，矩形ABCD为行李箱在地面的投影，点P为用户所在行李箱前方一段距离的位置，点tag为用户所佩戴的标签设备,其坐标可由定位模块测得。设P点坐标为(x0,y0，0)，Tag的坐标为(x0,y0，z0)，OP与Y轴的夹角为
*θ*
。则根据三角关系得：

![](https://i-blog.csdnimg.cn/blog_migrate/87c7fc3243e6c82cd6cfac7544e427c9.jpeg)

普通跟随模式下，行李箱将以固定距离d跟随目标，可以根据OP和d的差值控制此时行李箱的速度v；转向时根据
*θ*
控制此时行李箱的角速度*ω，*根据两个驱动轮的中心间距的一半为转弯半径，绕坐标原点O进行转向。通过求解式(2.7)、式(2.8)即可得到两驱动轮的速度。

避障跟随模式下，通过避障传感器测得前方障碍物距离为d1，则控制两驱动轮以dl为转弯半径，绕坐标原点O进行转向，线速度与角速度与上一时刻相同，通过式(2.9)可计算出避障跟随模式下两驱动轮的速度。避障完成后，行李箱自动切换为普通跟随模式。

![](https://i-blog.csdnimg.cn/blog_migrate/2609dc1588b35d559a25b87784144405.png)

图2.6 行李箱跟随模型空间坐标系

### 2.4控制系统总体框架

根据功能需求和技术原理，行李箱控制系统由控制器、电源模块、定位模块、动力驱动模块、避障模块、指纹解锁模块、智能称重模块、超距离报警模块、USB快充模块，九大部分构成。

电源对七大功能模块和控制器进行供电，控制器之间以及模块与控制器之间通过总线传输数据。控制系统总体框架图见附录A，各模块硬件电路设计在第三章详细介绍。

### 2.5行李箱结构设计

#### 2.5.1行李箱的尺寸说明

行李箱的的尺寸关系到用户能装多少的行李，目前市场上行李箱的尺寸主要有18英寸、20英寸、22英寸、24英寸、26英寸、28英寸，考虑到20英寸以内的行李箱可以直接携带登机、24寸以内行李箱可以免费托运[3]。本设计采用20英寸的行李箱的作为模型，因此底盘的尺寸是24cm*36cm。

考虑到多功能智能跟随行李箱的动力驱动模块和其他的硬件模块会占用一部分行李箱的单体重量和容量，而对于用户来说，旅行中行李箱每多一公斤的重量都可能会产生额外的托运费，因此需要将行李箱控制系统各模块合理设计以缩小占用空间，在器件选型上也需要优先选择迷你版。本设计将大部分控制系统集中设计到行李箱底盘以缩小占用空间，降低了行李箱的重心，提高了行李箱行驶的稳定性，也便于布线。

#### 2.5.2行李箱主体材质

碳纤维材质是一种超高性能材质，重量轻、强度高、弹性好、耐磨、耐冲击，很适合作为行李箱箱体材料，但是价格过高。PC塑料具有重量较轻、强度较高、耐用、美观等优点，市面上行李箱也普遍采用PC塑料作为箱体材料，再考虑到本设计是为了提高性价比，因此选择了PC塑料作为箱体材质。

#### 2.5.3行李箱外观说明

智能跟随行李箱外观设计可参考新秀丽、法国大使、日默瓦等世界知名品牌的商务旅行箱系列的设计风格，可以把黑色、灰色、银色作为主色调并以LED指示灯作为点缀，以彰显行李箱的科技感[3]。

本设计的研究重点是行李箱的“控制系统设计”，对于行李箱的外观并不做过多讨论。只对行李箱的底盘部分做粗略模型，用于作为控制系统驱动部分的研究控制对象，并不做底盘受力分析。实验过程中可以在底盘上放置重物以模拟真实行李箱的重量。行李箱底盘模型示意图如图2.7。

![](https://i-blog.csdnimg.cn/blog_migrate/8b37d44175af045201338f933018f9bc.png)

图2.7 行李箱底盘模型示意图

## 3.控制系统硬件设计

多功能智能跟随行李箱硬件部分包括控制器、电源、定位、动力驱动、避障、指纹解锁、自动称重、超距离报警、USB双向快充等多个部分。其中定位、动力驱动、避障三大模块构成智能跟随系统，指纹解锁、自动称重、超距离报警、USB双向快充等构成了多功能行李箱系统。本章对各功能系统进行硬件设计，涉及到复杂类型传感器的部分将进行对比选型。

### 3.1控制器模块

#### 3.1.1控制方案的选择

多功能智能跟随行李箱最核心的功能是自动跟随，而实现自动跟随的前提是定位技术。定位技术对系统的实时性要求非常高，尤其是超宽带UWB定位技术与AOA定位方法。UWB技术是通过近距离高速数据传输，基站和标签之间不断的进行数据传输，而AOA定位方法是基于标签的广播信号到达不同基站时间，来计算角度和距离的，微小的时间误差可能造成较大的角度偏差。

因此，本设计基于较高的实时性和可靠性需求，选择多处理器分布式控制，将定位信号数据处理部分与传感器的环境感知及其他功能的数据处理分离进行，多处理器之间通过总线技术进行通讯[13]。另外，分布式的硬件控制系统，可以非常方便的升级与维护。

#### 3.1.2主副控制器的选择

综合考虑系统综合性能要求和成本要求，主控制器MCU使用AVR -ATmega
  
2560芯片，兼容Arduino
  
mega2560的开源硬件原理图及核心库，并且有丰富的第三方硬件、外设、类库等支持，在数据采集和控制上，简单轻量，非常有利于系统的后期升级与维，大大短了开发的周期。副控制器MCU采用ARMSTM32F407ZET6芯片。该芯片是ST公司推出的32位ARM架构微处理器，采用Cortex-M4内核，有丰富的外设和通讯接口。主副控制器规格参数表如下。

表3.1 主控制器规格参数表

| 微控制器核心 | ATmega2560-16AU |
| --- | --- |
| 工作电压 | DC+5V |
| 输出电压 | DC+5V／+3.3V |
| 数字信号I/O接口数 | 54（其中14个PWM输出接口） |
| 模拟信号输入接口数 | 16 |
| I/O接口电流 | 40mA |
| 存储资源 | 256KB的Flash 8KB的SRAM |
| EEPROM存储容量 | 4KB |
| 时钟频率 | 16MHz |

表3.2 副控制器规格参数表

| 微控制器核心 | STM32F407ZET6 |
| --- | --- |
| 工作电压 | 1.8V~3.6V |
| 输出电压 | DC+5V／+3.3V |
| 数字信号I/O接口数 | 114（7组，每组16个；另外加两个PH0、PH1） |
| 输入模式 | 浮空输入、上拉输入 下拉输入、模拟输入 |
| 输出模式 | 开漏输出、复用开漏输出 推挽输出、复用推挽输出 |
| 接口类型 | 2个CAN接口、3个I2C接口、2个UART接口、3个SPI、3个USART |
| 存储资源 | 1MB的FLASH 196KB的SRAM |
| 时钟频率 | 168MHz |

#### 3.1.3控制系统电路设计

主控制器最小系统电路主要包括供电电路、复位电路、时钟电路以及串口调试接口电路。

![](https://i-blog.csdnimg.cn/blog_migrate/0f8c7ea933103d463a4cb5027f9b52b4.jpeg)

图3.1 复位电路、时钟电路

复位电路采用RC电路，可以对该芯片上电复位，同时按钮S1可以手动复位；时钟电路采用16MHz的晶体震荡器。

![](https://i-blog.csdnimg.cn/blog_migrate/f397bbd0c0e6e15a0ee9c81b16b8f8d4.jpeg)

图3.2 供电电路设计图

供电电路采用SPX1117M3-5芯片将3.8V-7.2V电源转换为5V。图中U2即为SPX1117M3-5芯片，属于三端线性稳压器，可做固定输出。C14和C10是输出滤波电容，用于抑制自激振荡，C11是输入电容，对于交流电压整流输入。稳压电源为ATmega2560芯片供电。

![](https://i-blog.csdnimg.cn/blog_migrate/bfd49b35d04ddc36ed5f53e44efa0991.jpeg)

图3.3 USB转串口调试接口电路

串口调试电路可以方便从计算机端下载程序到单片机，而且能够通过串口通讯进行数据传输。TXD为串行数据输出口，RXD为串行数据输入口。CH340内置了上电复位电路，但需要在OSCI引脚上提供12MHz的时钟信号，如图Y3为12MHz晶振，C25、C26为负载电容。

为了方便调试，副控制器最小系统设计中增加了一个JTAG/SWD调试接口，如图3.4所示。其他部分的设计与设计与主控制器相似。

![](https://i-blog.csdnimg.cn/blog_migrate/8b05eb64d0eb3b6f017de91b5e404f6b.jpeg)

图3.4 JTAG/SWD调试接口电路原理图

### 3.2电源模块

自动跟随行李箱为独立行走系统，因此控制器、电机、传感器等器件都需要行李箱自身携带的电源供电。本设计采用了18650锂电池组作为系统的总电源。硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/b79638ef0a0a0b2ee92d183025bbd023.jpeg)

图3.5 电源模块硬件框架设计图

如图，18650锂电池组与USB双向快充模块组成系统总电源，总电源需使用支持PD快充的充电器为电池组充电，同时可通过USB-C接口向控制系统供电，还可通过USB-A或USB-C接口作为移动电源使用。其中USB双向快充模块的设计在“3.9蓄电池与USB双向快充模块”中单独说明。

#### 3.2.1系统电源需求分析

本系统中电源模块的功能是设计不同的降压稳压电路，为系统各个模块稳定供电。多功能智能跟随行李箱控制系统所需的电源包括：12V的电机动力驱动模块和超距离报警模块；5V的智能称重模块、避障模块、主控制器、舵机；3.3V的指纹传感器模块、副控制器、定位模块。其中动力驱动模块的额定功率是9.6W，其他模块均为超低功耗。

系统具体电源分配如图所示。

![](https://i-blog.csdnimg.cn/blog_migrate/fefd9af3a098c78a1fe10c74a0e0cbe6.jpeg)

图3.6 系统各模块电源分配图

其中12V的电机电机驱动模块和超距离报警模块由系统总电源直接供电，5V和3.3V相关模块由降压稳压电路供电。系统总电源可供最高18W的负载使用，而负载中动力驱动模块额定功率为9.6W，其他模块均为低功耗器件，电源功率上满足要求。

#### 3.2.2降压稳压电路设计

本设计基于AMS1117降压稳压芯片设计加稳压电路，AMS1117具有更大的输出电流，可供系统中多个模块使用。AMS1117有多种型号规格，包括可变输出和固定输出两大类型，其中固定输出类的芯片可输出1.2V，1.5V，1.8V，2.5V，2.85V，3.0V，3.3V，和5.0V等多种电压，其内部集成有过热保护和限流保护电路，具有1%的精度。本设计采用AMS1117-3.3和AMS1117-5两种固定输出降压稳压芯片。其具体技术数据如下表。

表3.3 AMS1117技术数据表

| 温度范围 | -40~125°C |
| --- | --- |
| 输入电压 | 7-12V |
| 封装类型 | SOT-223 |

AMS1117实物图与引脚对应关系图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/41c5d9e6aa767ad59cbbe673a4358a2c.png)

图3.7 AMS1117实物图与引脚对应关系图

其中，引脚1接地，引脚2为输出电压端，提供稳定的输出电压，引脚3为输入电压端，提供给芯片输入电压。

![](https://i-blog.csdnimg.cn/blog_migrate/e2a255446442b6b350ba4c5ebaa1e99d.jpeg)

图3.8 3.3V降压稳压电路原理图

上图为3.3V降压稳压电路，采用AMS1117-3.3芯片和若干电容组成。其中C25、C27为输入电容，作用是防止断电后出现电压倒置，C26、C28为输出滤波电容，作用是抑制自激振荡和稳定输出电压。5V降压稳压电路采用AMS1117-5芯片，电路设计与3.3V相同。

### 3.3定位模块

定位模块对行李箱自动跟随功能十分重要，硬件设计的优良决定了测距和定位的准确性，硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/a06be7acb090fcb16828dbd71922bd2d.jpeg)

图3.9 UWB模块硬件框架设计图

#### 3.3.1 UWB定位模块介绍

UWB定位需使用DecaWave公司开发的DW1000定位芯片，DW1000是一款完全集成的低功耗单芯片CMOS射频收发器集成电路，它成了天线及所有的射频电路、电源管理和时钟电路，符合IEEE802.15.4-2011超宽带（UWB）标准。主要用于实时定位系统（RTLS）和无线传感网络的开发，定位精度能小于10cm，并且该模块支持高达6.8Mbps的数据传输率，其具体技术数据如下表。

表3.4 DW1000芯片技术数据表

| 带宽 | 支持从3.5GHz到6.5GHz的4个射频波段 |
| --- | --- |
| 供电 | 2.8V~3.6V |
| 数据传输 | 110kbps，850kbps，6.8Mbps三种模式 |
| 通讯接口 | SPI |
| 封装 | 6mmx6mm的48引脚QFN封装 |

![](https://i-blog.csdnimg.cn/blog_migrate/a0509e6f588015a7d16dd40413cb82c0.jpeg)

图3.10 DW1000芯片实物图

#### 3.3.2 DW1000电路设计

![](https://i-blog.csdnimg.cn/blog_migrate/32d0e726071cab7ba7fd927f8280445a.png)

图3.11 DW1000应用电路

如图为DW1000最小系统，由电源电路、晶振电路、射频滤波电路天线等部分组成。DW1000芯片包含大量电源引脚VDDMS、VDDIF、VDDCLK等，每个电源引脚需接到0.1uF去耦电容[#A2]，以滤除电源高频干扰，保证芯片稳定可靠工作；RF_P(PIN:16)、RF_N(PIN:17)两引脚接到增压/降压变压器(T1)，用以匹配UWB射频收发天线，工作频率为3~8GHz；SPICSN(24)、SPIMOSI(39)、SPIMISO(40)、SPICLK(41)为SPI通讯接口，DW1000可通过此接口与STM32进行数据传输；WAKEUP(23)引脚为芯片睡眠模式控制引脚，低电平有效；RSTn(27)为芯片复位引脚，高电平有效[5]。

UWB定位系统包括标签、基站和终端三部分，标签是要定位的目标点，自身能够产生脉冲信号而且能够反射基站发出的脉冲信号；基站是固定于已知环境的信号探测器，坐标已知，能够产生、接收脉冲信号；终端是指对基站传输过来的数据进行处理分析的微处理器[34]。

### 3.4动力驱动模块

动力驱动模块需要先对动力驱动方式进行选择，接着对驱动电机选型，并设计驱动控制电路。硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/34f8ce40ab5150391ab6ddcb3a101989.jpeg)

图3.12 动控制电路硬件框架设计图

#### 3.4.1动力轮的设计

目前市面上自动跟随行李箱的动力驱动方式主要有三种：双轮驱动轮自平衡方式、前向/后向双轮驱动方式、中间双轮驱动方式。三种驱动方式案例如下图。

![](https://i-blog.csdnimg.cn/blog_migrate/fb8e9a1f5207e06a5cdae586dfa375c1.png)

图3.13 从左到右依次为双轮驱动轮自平衡式、后向双轮驱动式、中间双轮驱动式

双轮驱动轮自平衡方式只有两个轮胎，类似双轮平衡车，其优点是运动灵活，但双轮驱动需要提供更强的驱动力和稳定性，因此动力轮设计很大，导致占用很大空间，且耗电量较高；前向双轮驱动方式由两个万向轮和两个动力轮组成，运动方式简单，但其结构限制了用户手动拉动行李箱的方式；中间双轮驱动方式采用四个万向轮和两个驱动轮，动力轮采用可升降方式，在自动跟随状态降至地面，在手动状态自动上升进入箱体，因此用户可以自由切换自动跟随和手动两种方式。对比以上三种方式后，本设计采用中间双轮驱动方式，以提高行李箱易用性。

![](https://i-blog.csdnimg.cn/blog_migrate/1e936aa98062447221c315301e40367b.jpeg)

图3.14 中间双轮驱动方式结构图

如图为中间双轮驱动方式结构图，驱动轮采用可升降式，由舵机控制驱动轮的升降。

#### 3.4.2动力驱动需求分析

行李箱的驱动力来自驱动电机的扭矩，驱动电机将驱动轮与路面的附着力转化为地面对车辆的牵引力，行李箱运动时，驱动电机将驱动转矩Mk传到驱动轮上，产生路面作用于驱动轮边缘上向前的牵引力Ft，牵引力Ft通过行李箱底盘传到行李箱整个箱体，用来克服作用于汽车上空气阻力、地面摩擦阻力和坡道阻力。

这里采用简化理想模型对动力电机所需力矩进行计算：

根据人们的正常行走速和慢跑速度，行李箱最大速度需达到2m/s，行李箱的总体重量最高为25Kg，驱动轮轮胎直径D为6.8cm。另外通过实验测得25KG行李箱匀速行驶时的摩擦力Ff约为：8.6N，据此计算所需推动力。

根据滑动摩擦力Ff和轮胎半径r计算行李箱匀速行驶时电机所需扭矩：：

Mk==Ff*r=Ff*d/2=8.6*(6.8*10^-2)/2=0.2924(N*m) ——式(3.1)

将扭矩分配到单个驱动轮，计算单个电机扭矩：

Mk1=0.5*Mk=0.1462(N*m)=1.462(kg*cm) ——式(3.2)

根据最大速度和驱动轮半径r计算电机额定转速n：

n=v/2Πr=2/2*3.14*(6.8*10^-2)/2=9.37(r/s)=562(r/min) ——式(3.3)

根据电机扭矩和电机转速，选用合适的驱动电机。

#### 3.4.3驱动电机选型

考虑到自动跟随行李箱对调速性能要求比较高，并且电机需要提供较大的转矩，因此选用直流电机作为驱动电机。本设计采用的是自带霍尔编码器的永磁直流有刷电机。

![](https://i-blog.csdnimg.cn/blog_migrate/9c58a04244ba27786a85cd04c4f3c540.jpeg)

图3.15 自带霍尔编码器的永磁直流有刷电机

电机参数如下表：

表3.5 电机参数表

| 额定电压 | 12V |
| --- | --- |
| 额定功率 | 4.8W |
| 额定电流 | 360mA |
| 堵转电流 | 2.8A |
| 堵转转矩 | 5kg*cm |
| 原始转速 | 11000rpm |
| 转速比 | 1:18(定制) |
| 类型 | AB相增量式霍尔编码器 |
| 线速 | 390 |
| 供电电压 | 5.0V |

#### 3.4.4动力驱动电路设计

驱动电机的控制一般需要搭配驱动电路，通过对驱动电路输入PWM波形实现对占空比的控制，最终实现对电机转速的控制以及正反转的控制。本设计采用TB6612FNG电机驱动模块，此模块相对于传统的L298N，体积大幅度减少，发热量更少，因此效率更高。

![](https://i-blog.csdnimg.cn/blog_migrate/5b60379aadc211b87fee353b725e6613.jpeg)

图3.16 TB6612FNG电机驱动模块

TB6612FNG芯片能驱动两个电机，其原理图如下：

![](https://i-blog.csdnimg.cn/blog_migrate/c58bd9e9231ed68fce3fdf155d213873.jpeg)

图3.17 TB6612FNG原理图

VM接12V以内电源，VCC接5V电源，GND接电源负极，A01和AO2与B01和BO2接电机的两个脚，PWMA、PWMB接单片机的PWM口，控制电机转速，STBY接单片机的IO口，低电平时电机全部停止，通过AIN1，AIN2，BIN1，BIN2控制电机正反转。逻辑真值表如下：

表3.6 TB6612FNG控制逻辑真值表

| 输入 | 输出 |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |
| IN1 | IN2 | PWM | STBY | 01 | 02 | 模式 |
| H | H | HL | H | L | L | 制动 |
| L | H | H | H | L | H | 反转 |
| L | H | L | H | L | L | 制动 |
| H | L | H | H | L | L | 正转 |
| H | L | L | H | H | L | 制动 |
| L | L | H | H | OFF | 停止 |  |
| HL | HL | HL | L | OFF | 待机 |  |

### 3.5避障模块

自动跟随行李箱采用超声波测距原理进行避障，避障模块硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/b635b5c68f1c913d3ba81e8983a0c429.jpeg)

图3.18 避障模块硬件框架设计图

#### 3.5.1行李箱避障方案设计

行李箱在未知环境下实现自动跟随需要进行避障，避障需要传感器获取周围环境信息，包括碍物的尺寸、形状和位置等信息。行李箱的避障只需要在行李箱周围大约2.5m的区域识障碍物即可，因此避障系统相对简单。超声波传感器具有性价比高、硬件实施简单的优点，检测范围也可达到2.5m，方向性较好，尤其是能检测到玻璃、镜面等特殊物体。

本设计采用深圳信德电子生产的JSN-SR04T-V3.0超声波模块，给模块可提供21cm-600cm的非接触式距离感测功能，测量精度可达高到3mm，模块采用工业级一体化超声波探头设计，防水效果好，性能稳定，探测盲区小，体积小，使用便捷非常适合作装配到自动跟随行李箱使用。

![](https://i-blog.csdnimg.cn/blog_migrate/1d6d4c9bda6ddeff5922ae056673fba4.png)

图3.19 一体化超声波探头与JSN-SR04T驱动模块

#### 3.5.2避障模块电路设计

一体化超声波探头通过JSN-SR04T驱动模块采集环境信息，JSN-SR04T驱动模块采用IO口TRIG触发测距，首先IO口输出10us的高电平信号，触发模块自动发送8个40khz的方波，检测到信号返回后，通过IO口ECHO输出一个高电平，高电平持续的时间就是超声波从发射到返回的时间。超声波探测的时序图如下：

![](https://i-blog.csdnimg.cn/blog_migrate/b225762bb77dc685ded55e22c3fe2252.jpeg)

图3.20 超声波探测时序图

模块与MCU之间通过串口通讯，模块RX、TX分别需要接到MCU的TX、RX。当模块被触发测距后，若因超过测量范围接收不到回波，ECHO口会在60ms后自动变为低电平，标志着此次测量结束。JSN-SR04T驱动模块具体参数如下表。

表3.7 JSN-SR04T驱动模块参数表

| 工作电压 | DC3.0-5.5V |
| --- | --- |
| 探头频率 | 40kHz |
| 最远射程 | 600cm |
| 最近射程 | 21cm |
| 远距精度 | ±1cm |
| 分辨率 | 1mm |
| 测量角度 | 75度 |
| 输入触发信号 | 10us以上的TTL脉冲信号或串口发送指令0X55 |
| 输出回响信号 | 输出脉宽电平信号或TTL |

### 3.6指纹解锁模块

指纹验证技术是最早的计算机信息认证方法，同时也是应用最广泛的生物认证技术。本设计应用指纹解锁技术主要考虑其安全性和快捷性，提高人们出行效率。指纹解锁技术是根据手指指纹“人各不同，终生不变”的特点，利用指纹传感器检测人体指纹特征，再将这些特征信号转换成数字信号输入到控制器，通过控制器对比指纹特征并控制执行器的动作执行，达到指纹解锁的目的。指纹解锁模块硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/e89301a4c8817de1c272ba7c557bb166.jpeg)

图3.21 指纹解锁模块硬件框架图

#### 3.6.1指纹传感器硬件选型

目前的指纹传感器主要分为光学指纹传感器、电容式指纹传感器、超声波指纹传感器。其中，光学指纹传感器应用最早也最广泛，其原理是通过光的全反射（FTIR）采集指纹表层纹理图像。光学指纹识别技术就是扫描皮肤表层，获取纹路投影然后记录并对比指纹库。优点是价格便宜、不易磨损、不受静电影响；缺点则是采集头尺寸较大、相对半导体指纹识别的识别率较低。

电容式指纹传感器是一种半导体指纹传感器，其原理是利用硅晶圆在和皮肤上电解液接触的时候后形成电场，通过识别深层指纹，而深层指纹在微观上是高低不平的，它有着生物识别的无可复制性，安全性更高。因此，电容指纹传感器相对光学指纹识别率高、识别速度更快、不容易被复制、尺寸较薄小，但缺点则是造价高、容易受损。

超声波指纹传感器是通过发射超声波到手指上，再将返回的声波声纹对比。对手指表面的清洁程度没有太多要求，无需按压、可以实现湿手解锁，有着诸多优点，但是目前市场上还未将超声波指纹传感器单独产品化。

综合考虑到行李箱的使用环境、需要较快的识别速度和较高的识别率以及较小的空间占有率，最终选择电容式指纹传感器。

![](https://i-blog.csdnimg.cn/blog_migrate/2a31c6dc7c052167ab6d2b7aca1b6978.png)

图3.22 光学指纹传感器模块（左）与电容指纹传感器模块（右）

本设计采用MR608半导体电容式指纹模块，具有很高的性价比。MR608是集成了半导体传感器和指纹算法芯片为一体化指纹处理模块，具有体积小、功耗低、接口简单等特点，模块可靠性高、干湿手指适应性好，指纹搜索速度快。指纹图像读取时，对干湿手指都有灵敏的反应和判断。且具备自学习功能，内部算法能对比并补充每次使用是的指纹特点，在使用过程中越用越好用。MR608模块还具备感应手指功能，当手指按压到指纹采集面时，模块Touch脚输出高电平。另外，该模块具有可调节的等级功能、指纹特征数据的读/写功能。

#### 3.6.2指纹解锁电路设计

MR608模块提供板载串口，MCU通过串口与MR608进行通讯和控制。如图，模块对外的接口采用单排插座，插座内接口从右到左序号为从1到6。接口具体定义如下表：

表3.8 MR608模块接口定义

| 引脚号 | 名称 | 类型 | 功能描述 |
| --- | --- | --- | --- |
| 1 | VADD | In | 触摸感应电源输入端，+3.3V |
| 2 | Touch | Out | 感应信号输出，默认高电平有效 |
| 3 | VDD | In | 模块电源正输入端，+3.3V。 |
| 4 | TX | Out | 串行数据输出。TTL逻辑电平。 |
| 5 | RX | In | 串行数据输入。TTL逻辑电平。 |
| 6 | GND | － | 信号地。内部与电源地连接。 |

![](https://i-blog.csdnimg.cn/blog_migrate/312802e486d20b28c64ffa4db7877287.jpeg)

图3.23 MR608背面接口序号图

上位机是MCU时，MCU可提供3.3V电压，模块可直接通过UART-TD和UART-RD与MUC连接，进行数据通讯。考虑到整体电路的功耗，指纹模块只有工作状态和不工作两种状态，由于电容式指纹模块采用低功耗模式，触摸感应信号在VDD（指纹电源）接通后无效。本设计采用的接法为接上VADD（触摸感应电源），触摸感应输出端接MOS管来控制VDD（指纹电源）。无指纹按压时VDD自动断电，达到省电目的。

### 3.7自动称重模块

行李箱的重量一般不超过30kg，所需的称重传感器属于小量程的压力传感器。市面上的称重传感器种类繁多，但小型传感器一般只有应变片式压力传感器（工业级除外）。自动称重模块硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/16f8481da44ad1febaeda3c28f8eebfe.jpeg)

图3.24自动称重模块硬件框架设计图

自动称重模块在行李箱中的安装位置设计如下图所示：

![](https://i-blog.csdnimg.cn/blog_migrate/9aa3be9c43c945303801dede621f509f.png)

图3.25 自动称重模块在实际行李箱中的安装方式

如图，四个称重传感器安装于行李箱后侧面四个角的位置，当行李箱平方在地上放入物品的时候，将会自动显示出行李箱实时重量信息。

#### 3.7.1应变片压力传感器原理

金属导体电阻值随机械形变而改变的现象称为“应变效应”，利用金属电阻应变效应可制成应变片，进而制成电阻式压力传感器，在连接上形成桥式电路后，通过应变片的阻值变化，即可测量物体所受压力的压力值。其中，应变片阻值的变化，通过桥式电路可成倍提高其灵敏度，并使输入和输出呈线性关系，并获得相应的毫伏级电势输出，用毫伏计或其他记录仪表显示出被测压力，从而组成应变片式压力传感器。

根据直流电桥平衡条件，欲使电桥达到平衡，其相邻两臂的电阻比值应该相等，电桥平衡时其输出电压为零。根据应变电阻的数量及所在桥臂的位置，可分为单臂电桥、双臂电桥、全桥，其输出的电压与电阻的变化量成近似的线性变化，这样通过求压力就可以测量出压力的大小。

另外，双臂电桥、全桥电路可以利用两个应变电阻互相作为温度补偿，提高抗干扰性能，双臂电桥的灵敏度为单臂的2倍，全臂电桥的灵敏度为单臂的4倍。

![](https://i-blog.csdnimg.cn/blog_migrate/3af2295ceffef9d09af6c9108b695945.png)

图3.26 单臂电桥工作电路、双臂电桥工作电路、全桥工作电路

#### 3.7.2称重传感器与AD转换模块选型

目前市面上适用于行李箱称重的传感器有两种类型，分别常用的电子秤常用的长方体块状全臂应变片压力传感器和体重秤常用的E字形双臂电桥应变片压力传感器。

长方体块状全桥应变压力传感器测量精度高、量程类型丰富，但体积大、重量大、价格也高，一个量程为40kg的传感器长130mm、宽30mm、厚度为22mm、重量为180g。

单个E字形半桥应变压力传感器测量精度较低，但体积小、价格低、只有50kg量程的产品，传感器长宽均为30mm、厚度仅为5mm。而且多个半桥传感器可组成全桥传感器，弥补精度上的缺陷。

对比以上两种传感器，最终采用E字形双臂电桥应变片压力传感器，使用四个传感器分别放置到行李箱侧面的四个支撑角，并组成全桥电路。

本设计最终采用了深圳市维芯科技有限公司的E字形双臂电桥应变片压力传感器，内部为1000欧半桥应变片，量程为50kg。测量时，外侧边正确施加外力，E字形传感器的应变梁部分（即中间贴应变片的,有白色覆胶的梁臂）和外侧边要形成一个方向相反的剪切力，即中间的应变梁在受力下必需可以发生弯曲变化，应变梁受力面另一侧不可有阻挡物。四只传感器组成全桥测量量程为四只传感器的量程之和，即为200kg。

![](https://i-blog.csdnimg.cn/blog_migrate/280f12b73e6ad59b036938a87598b120.png)

图3.27 E字形半桥应变压力传感器（左）与长方体块状全桥应变压力传感器（右）

使用HX711AD转换模块作为压力传感器的信号转换模块，HX711采用了海芯科技集成电路专利技术，是一款专为高精度电子秤而设计的24位A/D转换器芯片。与同类型其它芯片相比，该芯片集成了包括稳压电源、片内时钟振荡器等其它同类型芯片所需要的外围电路，具有集成度高、响应速度快、抗干扰性强等优点。降低了整机成本，提高了称重的性能和可靠性。

HX711具体参数如下：

表3.9 HX711模块参数表

| 工作电压范围 | 2.6~5.5V |
| --- | --- |
| 通讯接口 | 串口 |
| 输出频率 | 可选择10Hz或80Hz的输出数据速率 |
| 工作电流 | <1.6mA, |
| 断电电流 | <1µA |
| 工作温度范围 | -40~+85℃ |
| 封装类型 | SOP-16 |

#### 3.7.4自动称重硬件电路设计

首先，对四只半桥应变压力传感器进行设计，组成一个全桥电路。半桥应变压力传感器内部结构如下。

![](https://i-blog.csdnimg.cn/blog_migrate/152ac7dce494fafd2d4bf61e6c68766c.png)

图3.28 半桥应变压力传感器内部电路

图中R1为正应变电阻，R2为负应变电阻，将4个相同的传感器连接得到全桥应变电路，连接过程如图所示。

![](https://i-blog.csdnimg.cn/blog_migrate/c5e8531b869fab9742e0c6faba6b2bc6.png)

图3.29 四个半桥应变传感器组成的全桥应变电路

图中，串联后的E+、E-、D+、D-分别为供电正负极与电压信号输出正负极，可将其接入HX711的E+、E-、A+、A-。HX711模块原理图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/2a8c1f6b9ce56bca0b284866d4327584.png)

图3.30 HX711原理图

HX711与MCU通过串口通讯，通讯引脚为SCK(11)与DOUT(12)，通过串口可以控制选择输入通道和增益类型；管脚XI(14)接地，使用芯片内部时钟振荡器，并关闭外部时钟输入，输出数据速率固定为80Hz；管脚PD_SCK(11)输入用来控制HX711的断电，当PD_SCK为低电平时，芯片处于正常工作状态；另外，通电时，芯片内的上电自动复位电路会使芯片自动复位，无需设计复位电路。

### 3.8超距离报警模块

超距离报警技术是基于定位技术实现的，定位系统检测到行李箱距离用户超过0.8m时，产生一小段报警声，当距离超过2m时，不断产生报警声，直至距离恢复至0.5m以内。报警信号可由喇叭、蜂鸣器等器件产生，本设计采用蜂鸣器报警。超距离报警模块硬件框架图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/3acb364a7e457cc5096e6d8dc9d39b92.png)

图3.31 超距离报警模块硬件框架设计图

#### 3.8.1蜂鸣器选型

根据蜂鸣器的发声原理可将蜂鸣器分为压电式蜂鸣器和电磁式蜂鸣器两种类型，压电式蜂鸣器主要由多谐振荡器、压电蜂鸣片、阻抗匹配器及共鸣箱、外壳等组成。其中多谐振荡器由晶体管或集成电路构成，当接通1.5~15V直流工作电压后，多谐振荡器起振，输出100~500HZ的音频信号，阻抗匹配器推动压电蜂鸣片发声。而电磁式蜂鸣器由振荡器、电磁线圈、磁铁、振动膜片及外壳等组成，接通电源后，振荡器产生的音频信号电流通过电磁线圈，使电磁线圈产生磁场，振动膜片在电磁线圈和磁铁的相互作用下，周期性地振动发声。蜂鸣器的发声原理据决定了电磁式蜂鸣器音色相对较好。

根据蜂鸣器是否有震荡源又可分为有源蜂鸣器和无源蜂鸣器两种类型，无源蜂鸣器需要输入方波信号驱动蜂鸣器发声，输入不同频率的方波可以驱动蜂鸣器发出不同类型的音调。而有源蜂鸣器则是输入直流电源即可发声，但发声频率固定。

压电式无源蜂鸣器价格便宜，且声音频率可控，其次考虑到行李箱的使用环境包括了车站、公路等噪音较高的地方，因此本设计使用维芯科技生产的SHD4216高分贝报警器，其声压可达100dB。

SHD4216具体参数如下：

表3.10 SHD4216模块参数表

| 额定电压 | 12V |
| --- | --- |
| 电压范围 | 3~24V |
| 额定电流 | 12mA |
| 声压 | 100dB |
| 谐振频率 | 3.0±0.5 |
| 工作温度 | -20~+45℃ |
| 尺寸 | 最大直径60mm、厚度16.2mm |

![](https://i-blog.csdnimg.cn/blog_migrate/1da928c00a6467f972046f445dc2269a.jpeg)

图3.32 SHD4216高分贝报警器

#### 3.8.2报警模块电路设计

蜂鸣器需要驱动电路才能正常工作，电路设计如下。

![](https://i-blog.csdnimg.cn/blog_migrate/5d5cf9d7df833a53c21d73e4d82143ce.png)

图3.33 蜂鸣器驱动电路

首先，控制MCU输出PWM波形到驱动电路，可驱动蜂鸣器发声；二极管D1可以提供续流；电容C1的主要作用是滤波；三极管起开关作用，其基极的高电平使三极管饱和导通，使蜂鸣器发声;，而基极低电平则使三极管关闭，蜂鸣器停止发声。

### 3.9蓄电池与USB双向快充模块

USB_IF协会推出的USBPD协议支持100W最大功率，并统一使用Type-C接口，提高了易用性，快充技术是解决续航问题的关键技术之一。本设计采用快充技术来实现行李箱电源的快速充电，同时行李箱电源设计为双向快充，即可以作为用户的应急充电宝，给用户的智能设备进行快充，快充技术在目前已经比较成熟，本系统直接使用市场上现有的快充模块，不进行电路设计。

#### 3.9.1 USB快充技术的原理

电池充电实质是电荷转移的过程，充电功率的大小决定着电池充电速度的快慢，功率的计算公式如下：

![](https://i-blog.csdnimg.cn/blog_migrate/acf9468b4b1420fd2dba03fd27c50d42.png)

其中，Ｐ为功率，Ｃ为充电电压，Ｉ为充电电流。根据以上式，实现快充的方法主要有三种：提高充电电流，提高充电电压，或者两者同时提高。目前使用最广泛的充电模式是三阶段充模式：先恒流充电以迅速补充能量，然后一定程度后转化为恒压充电，当电压达到充电器充电终止电压值时，改为涓流充电[6]。

#### 3.9.2蓄电池的选型

蓄电池是智能跟随行李箱的动力来源，是行李箱心脏，决定着行李箱的续航能力。锂离子电池具有容量大、能量高、体积小、很低的自放电率、几乎没有“记忆效应”以及不含有毒物质等优点，18650锂电池和软包装锂聚合物电池是最长用的两种锂电池，18650锂电池体积固定（直径18mm、高为65mm、圆柱体电池，并采用钢外壳封装），而软包装锂聚合物电池体积、形状一般可以随意定制。

![](https://i-blog.csdnimg.cn/blog_migrate/2d1aa4dff79ff6fcef138125235887e9.png)

图3.34 18650锂电池（左）和软包装锂聚合物电池（右）

18650成本相对较低，寿命相对较长，性价比高。因此选用18650电池拼装为电池组，为行李箱控制系统及驱动部分进行供电。

其次，根据中国民航局规定，“在乘坐民航飞机时，个人自用的内含锂或锂离子电池芯或电池的电子消费品设备及备用电池可与行李一起携带登机，但锂金属电池的锂含量不得超过2克，锂离子电池的额定能量值不得超过100Wh(瓦特小时)”。因此蓄电池额定能量值应小于100Wh。

另外，为了满足持续工作电流、瞬间启动电流，本设计采用由18节18650电池，电压设计为12V，可持续工作电流为12A，总容量为16800mAh的电池组。

#### 3.9.3 USB快充模块的选型

本设计采用了集成了IP5328P芯片的USB双向快充电路模块，IP5328P可同时支持多个USB口，并且均支持多种快充协议（QC2.0/QC3.0、FCP/AFC输入输出快充协议、SFCP输出快充协议、MTKPE+1.1&2.0输出快充协议、USBC/PD2.0/PD3.0输入输出协议、USBCPD3.0PPS输出协议），集成双向PD功能，且支持多种电压电池，涵盖市面上所有锂电池，充电电流5A，支持18W输出，可同时支持USBA，USBB，USBC三个USB口，单独使用任何一个USB口都可以支持快充，同时使用两个输出口时，只支持5V。同时内置电量计功能，内置功率管，外围元件数量少。

![](https://i-blog.csdnimg.cn/blog_migrate/62b058d2ed5e2ffc01559a9ac95c9010.png)

图3.35 IP5328P快充模块

IP5328P双向快充模块的性能参数如下：

表3.11IP5328P双向快充模块参数表

| USB口 | 2个USB-A输出口、1个USB-A输入口 1个USB-C输入/输出口 |
| --- | --- |
| 快充规格 | QC2.0/QC3.0输出快充协议 USB-C/DRP/PD2.0/PD3.0输入/输出快充协议 |
| 充电规格 | 电池端充电电流最高可达5.0A、自适应充电电流调节 USB-C输入/输出口PD18W快充 |
| 放电规格 | 5V-3.1A、9V-2.0A、12V-1.5A |

## 4.控制系统软件设计

控制系统通过各个传感器模块获取环境信息，通过控制器进行控制决策。本章将介绍多功能智能跟随行李箱软件系统的功能程序设计，为了开发的代码结构简单、可移植性强，在设计中仍采用模块化的方式进行，系统的软件开发平台为ArduinoIDE和Keil5。

### 4.1软件框架总体设计

在多功能智能跟随行李箱系统中，首先根据用户佩戴的标签设备进行定位信息的采集。若用户距离行李箱位置较近，则启动静止模式，静止模式下，指纹解锁和自动称重两个模块处于工作状态，若用户距离行李箱较远，在启动运动模式，运动模式下，根据超声波传感器获取的环境信息选择正常跟随模式和避障跟随模式，正常跟随模式下，只进行定位信息采集，用于控制量驱动轮的转速，达到行李箱跟随用户效果，避障跟随模式下，需要同时采集环境中障碍物的信息以及定位信息，达到避障跟随效果。软件框架结构如下图所示。

![](https://i-blog.csdnimg.cn/blog_migrate/a30864be0e4916ed3931167bb8b216e7.png)

图4.1 软件框架结构图

图中自动跟随、指纹解锁、自动称重为智能跟随行李箱三大系统功能。其中，自动跟随系统是基于UWB定位、超声波探测技术进行驱动控制实现的，自动跟随系统包括跟随、避障、超距离报警三个功能。

### 4.2自动跟随系统软件设计

#### 4.2.1 UWB定位模块软件设计

UWB定位模块软件设计主要包括，行李箱上固定的UWB基站模块和用户所携带的标签模块两部分。根据UWB模块的用户手册，设计基站模块和标签模块的程序流程图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/d23f1114b025584a584a0605add3eaa3.png)

图4.2 UWB标签程序流程图 图4.3 UWB基站程序流程图

UWB基站流程图中的距离值是指基站到标签的距离值，也即用户与行李箱之间的距离值，此距离值是根据信号飞行时间（TOF）计算的。利用TOF+AOA定位方法即可实现UWB定位。

#### 4.2.2避障模块软件设计

行李箱避障方式采用超声波避障，两个超声波传感器探头安装于行李箱前面两侧位置，实时监测行李箱前方的障碍物信息，避障模块程序流程图如下。

![](https://i-blog.csdnimg.cn/blog_migrate/fff0725ca205fd84fb6e74849da02193.png)

图4.4 避障模块程序流程图

根据程序流程图，避障模块首先检测障碍物信息进行跟随模式选择，在避障跟随模式下，根据行李箱与障碍物之间的距离调整转弯半径，控制两驱动轮进行差速运动，进而使行李箱转弯，达到躲避障碍的效果。

#### 4.2.3自动跟随软件设计

自动跟随模式分为避障跟随和正常跟随，由
  
“2.3.2自动跟随方法”中的分析可知，两种跟随模式的区别在于转弯半径和线速度的不同，因此针对两种跟随模式设计如下自动跟随程序流程图。

![](https://i-blog.csdnimg.cn/blog_migrate/cb7a6c24d80b7687f8fa1c3fc2f9e59b.png)

图4.5 避障跟随模式程序流程图 图4.6 正常跟随模式程序流程图

根据程序流程图，避障跟随模式下行李箱行驶的线速度上一时刻的线速度，驱动电机的转速控制也与上一时刻相同；避障时，需要从避障模块获取障碍物信息，进而计算出转弯半径，控制左、右驱动电机差速旋转，进行转向。

正常跟随模式下，行李箱行驶的线速度受到行李箱与用户之间的距离控制，距离越大，左右驱动电机的转速就越大，行李箱行驶的线速度就越大；其次，行李箱的转向受到行李箱与用户之间的偏转角度控制，转向时，以两驱动轮中心间距的一半为半径，控制左、右驱动电机差速旋转，进行转向。

#### 4.2.4超距离报警模块软件设计

根据“2.1总体功能需求分析”，超距离报警分两个距离段，分别是1.5m~2.5m和2.5m以上。超距离报警程序流程图如图4.7。

![](https://i-blog.csdnimg.cn/blog_migrate/6bac425b0f64a0e5f70d4bac540ac3df.png)

图4.7 超距离报警程序流程图

根据程序流程图，行李箱与用户之间的距离信号由UWB定位模块提供，当行李箱距离用户超过1.5m时，产生报警信号2；当距离超过2.5m时，报警信号1，直至距离恢复至1.5m以内。一级报警信号的强度大于二级报警信号。

### 4.3指纹解锁软件设计

指纹解锁软件设计主要包括OLED显示、按键扫描、指纹检测、指纹录入、指纹删除、指纹搜索对比、舵机控制等多个部分。指纹解锁程序流程图如图4.8。

![](https://i-blog.csdnimg.cn/blog_migrate/202b61a7a7b3ec4225c64e67d948177a.png)

图4.8 指纹解锁程序流程图

指纹传感器与MCU之间通过串口通讯，OLED屏与MCU之间采用了IIC通讯。指纹模块程序运行首先进行指纹模块、OLED屏等外设的初始化以及必要的宏定义、按键输入口的配置等；指纹模块主程序包括“显示主页(HOME)”、“指纹检测”、“调用指纹解锁函数1”、“按键扫描”，在无任何输入的情况下，程序将无线循环以上五部分，同时OLED显示系统主页面。

如果指纹传感器接触到指纹输入，则立即通过“指纹解锁函数1”子程序控制舵机开锁，进而打开行李箱，之后程序返回到上述五部分的循环。

如果检测到“K1”按键被按下，程序调用“显示菜单(MENU)”子程序，OLED显示菜单页面，菜单页面包括“指纹解锁*菜单”、“K1-录入指纹”、“K3-删除指纹”、“K5-指纹解锁”四部分，接着调用“按键扫描”子程序。

如果按键扫描子程序检测到“K1”被按下，则通过流程图中的四个部分完成录入指纹操作；如果检测到“K3”被按下，则完成删除指纹操作；如果检测到“K5”被按下进行指纹解锁。同时，每个操作都有对应的多个内容在OLED上显示。

### 4.4智能称重软件设计

本设计采用LCD1602显示屏来显示行李箱重量信息。智能称重软件设计主要包括称重传感器自动校准等、获取行李箱重量、LCD显示等，智能称重主程序流程图和称重传感器初始化子程序流程图如下。
  
指纹解锁软件设计主要包括OLED显示、按键扫描、指纹检测、指纹录入、指纹删除、指纹搜索对比、舵机控制等多个部分。指纹解锁程序流程图如图4.8。

![](https://i-blog.csdnimg.cn/blog_migrate/6f781a96d426e4767cd5974ad7ef8b39.png)

图4.9 智能称重主程序流程图 4.10称重传感器初始化子程序流程图

主程序主要用来获取和显示重量，程序中用到了“LiquidCrystal”函数库可以方便显示字符信息，重量值则是通过“HX711”函数库获取。称重传感器初始化较为复杂，设计中为了使行李箱更智能，用程序代替了“去皮”和“校准”两个过程，“去皮”过程是将重量值归零，程序从传感器获得重量值后，将首次获得的重量值作为皮重值保存到一个宏定义的变量，之后给次获得的重量值都减去这个变量值；“校准”过程涉及到一个校准系数，首先需要放置一个一直重量的“砝码”，通过调整过校准系数，使得重量值和“砝码”重量相等。具体校准流程如下图。

![](https://i-blog.csdnimg.cn/blog_migrate/5fff4c2fe593abd1ac3ed5e59c59a295.png)

图4.11 称重校准子程序流程图

其中，行李箱重量m0即为上文“砝码”重量，由于行李箱在设计完成之后，重量是固定的，因此m0为已知，通过比较m0和重量值示数m1来调增校准系数，即可完成校准过程。

## 5.系统功能测试分析

根据前文硬件、软件部分的设计，首先搭建底盘模型和各部分硬件电路、编写各模块程序，然后对各部分模块进行功能测试，最后综合各部分模块进行联调联试，分析多功能智能跟随行李箱的综合性能。

### 5.1多功能智能跟随行李箱控制系统实验平台搭建

多功能智能跟随行李箱控制系统实验平台实物图如下所示，平台按照20寸行李箱的长和宽搭建，高度进行了缩减。其中，超声波传感器安装于平台正面两侧，称重传感器安装于平台后侧面四个角，UWB模块安装于平台顶面两侧位置，控制系统电路和USB双向快充模块均位于平台箱体内部，指纹传感器模块、OLED和按键安装于平台顶面以便操作。

![](https://i-blog.csdnimg.cn/blog_migrate/7ed375d20678ced1d434dff116180c6b.png)

图5.1 多功能智能跟随行李箱控制系统实验平台实物图

试验过程中，需要使用计算机进行程序调试以及串口数据监视。下图为控制系统电路设计实物图。

![](https://i-blog.csdnimg.cn/blog_migrate/325acc67e8cd7cab3cbe1e8cad6a968c.png)

图5.2 控制系统电路测试实物图

图中，下层电路为电源模块电路，中层为MCU，上层从左到右依次为超声波模块电路、指纹解锁模块电路、智能称重模块电路。

### 5.2各功能模块测试

#### 5.2.1指纹解锁模块测试

指纹模块前期调试需要用到PC上位机，将指纹模块通过USB转串口模块与计算机相连。通过计算机可以设置模块的安全等级、数据包大小、波特率等，还可查看模块参数，最主要的是进行模块调试。上位机与指纹模块通讯成功页面如下图：

![](https://i-blog.csdnimg.cn/blog_migrate/2d3b27128c7bfabdfd28694b2423c158.png)

图5.3 指纹模块与上位机通讯成功页面

模块调试顺序是：

（1）用上位机与指纹模块通讯，在上位机上设置波特率，通过上位机检测模块识别和对比指纹图像功能是否正常；

（2）连接模块硬件电路，包括指纹传感器模块、MCU、OLED、按键，测量电路中是否由短路、短路、接触不良等问题；

（3）编译、下载程序，检查OLED显示、按键、指纹录入、指纹删除、指纹解锁功能是否正常。

测试前期发现计算机串口经常出现无法检查到设备的情况，PC上位机或MCU与指纹模块之间无法进行通讯。PC上位机与模块之间出现通讯异常的情况较少，MCU与模块之间经常通讯失败。经过研究和查阅资料发现，PC与模块通讯时需要断开计算机其他串口设备才能通讯成功；MCU与模块通讯时，需要上电后等待一段时间（10s左右），模块才能启动完成，如果过早运行程序，将会导致通讯失败，此时应将模块复位，稍等片刻重新运行程序即可通讯成功。程序运行正常，调试中优化了OLED显示界面。

![]()

图5.4 从左到右依次为OLED首页、指纹解锁菜单页、保存指纹选项、删除指纹选项

#### 5.2.2智能称重模块测试

智能称重模块调试顺序是：

（1）将四个半桥应变传感器连接成一个全桥应变电路，对传感器施加外力，用万用表检测全桥电路的正负应变电阻的变化是否正常，排除线路问题；

（2）连接模块硬件电路，包括全桥应变电路、LCD1602液晶屏、HX711AD转换模块，测量电路中是否由短路、短路、接触不良等问题；

（3）编译、下载程序，检查LCD显示的重量信息是否正常，是否能够自动去除皮重和自动校准。

测试中发现有轻微的零点漂移现象，由于全桥电路具有温度补偿功能，因此分析是外部电路电压不稳定导致的示数跳动，替换稳压电源、将杜邦线改为铜导线直接连接后，零点漂移现象有所改善，在程序中将重量由克改为千克，保留一位小数时，OLED显示的重量值基本稳定，不会跳动。另外，在硬件中增加了OLED对比度调节电位器，让OLED显示更适应环境。

![](https://i-blog.csdnimg.cn/blog_migrate/a0faefe08050d02d23326594408c974d.png)

图5.5 称重显示结果

## 6.总结与展望

### 6.1本文工作总结

科技的发展改变了我们生活的方方面面，给我们提供了许多便利，创新与发展一直是科技进步的重点。本文通过对UWB定位、指纹解锁、自动称重、USB快充、智能避障等相关技术的研究，完成了对多功能智能跟随行李箱控制系统的设计，为多功能智能跟随行李箱提供了方案。以下是本次设计所作的主要工作。

首先，通过对互联网上现有产品进行分析，大量搜索相关产品的论坛讨论情况和口碑情况，了解人们的需求和现有产品的优缺点，结合毕业设计任务书，最终确定多功能智能跟随行李箱所要实现的功能。

其次，通过查阅大量的文献资料，对设计中的所需要的各种功能进行理论分析，尤其是对定位技术进行分析讨论，决定出最合适的定位模式。

然后，基于设计中涉及到的相关技术，结合自身所学知识，进行补充性学习。深入学习了Arduino与Stm32的编程与运行调试，结合互联网中的大量学习资料、例程，掌握了相关模块的软件编程技巧和调试技巧。

在硬件电路设计中，首先通过硬件选型，对比各类型的硬件的优缺点和适应环境，选择出性价比高而且稳定的最适合的硬件。然后，通过前期阅读文献积累的技术资源，并参考网络中的相关技术资料和购买模块所配送的相关资料，设计最优的硬件电路，使系统中各个模块稳定可靠运行。

在软件设计中，以模块化的方式进行编程，依次对自动跟随系统、指纹解锁、智能称重部分进行了软件设计，并在调试中不断优化程序。

在搭建的实验平台上，可以观察系统运行状态，分析行李箱避障和跟随时的行为，在实验中直观的展现出行李箱的各部分功能的实际效果。

### 6.2未来工作展望

本文的研究初步实现了行李箱的自动跟随功能，比较完善的实现了行李箱的多功能系统。但是这对于一个成熟的产品还远远不够，人们需要的是更稳定的跟随、更智能的跟随、更丰富的人性化功能设计等等。本设计还存在可以改进的部分，详述如下:

第一，本文实现自动跟随是建立在于UWB技术基础上的，UWB信号会受到环境干扰，影响跟随效果。在理论上可以通过滤波算法，或者结合现有的视频识别定位技术等其他技术，使跟随更加稳定可靠。

第二，UWB定位芯片，在目前的市场仍未普及，芯片价格昂贵，大大提高了产品的开发成本。考虑到蓝牙5.1的精准定位技术和超低的成本，以及蓝牙技术的广泛适用范围，蓝牙5.1AOA定位可能成为未来行李箱自动跟随系统中最适合的定位方式，这不只是降低了开发成本，而且免去了穿戴性的设备，人们携带手机即可实现自动跟随。

第三，本设计没有实现行李箱与手机的连接，后续可以增加开发手机APP，包括在APP上监控行李箱的位置，进行指纹的录入与管理，在手机上自动显示行李箱的重量尺寸等相关信息。通过更丰富的功能和更人性化的设计，以改进人民的使用体验。

第四，本设计中的驱动轮还需使用私服电机或舵机进行升降控制，才能达到理想中的效果。在自动跟随模式下，驱动轮自动下落以驱动行李箱行驶；在手动模式下，驱动轮自动上升至行李箱底盘内部，以免妨碍行李箱人工拖拉的自由度。

最后，本次设计中涉及到的自动跟随功能仅在理论上得以实现，真正达到流畅的跟随效果以及可商业化的应用，仍需要长时间的研究、设计、优化和制作。

## 致谢

时光飞逝，大学四年的生活即将结束，在这四年中，我学到了大量的学科知识，实践能力也在科创团队中得到很大程度的锻炼，同时也有许多老师、朋友、同学给予我学习上的帮助，获益良多。在这里，我要向一直陪着我的室友、朋友、同学和对我耐心指导的老师表示我内心深处的感谢。

首先我要感谢我的第一指导老师孙炳海教授，从大一加入实验室科创团队起，孙老师就一直在我的学习上进行指导，在项目实践上带领我们做实际的项目，并指导我们参加学科竞赛，对我的创新、创业、管理、实践能力都有很大程度的提高，在我的学业生涯中产生了深远的影响。

感谢我的毕业设计导师葛广军老师在我的毕业设计各个阶段给予我学术上的支持和帮助，本文自始至终都是在葛老师的指导下与严格要求下完成的，老师敏锐的学术洞察力、崇高的学识简介及平易近人的为人风格，都将在我今后的学习、工作中产生深远影响。感谢我的学业导师任琦梅老师在我学业上的指导和帮助。

感谢电控科创团队的孙老师、邢老师、宋老师、刘老师、李老师以及吴鹏辉、林楫等各位学长，在实践项目中对我的悉心指导。感谢吴洁以及我的舍友在我学习生活中的照顾和陪伴。

还要感谢我的父母和家人给予我精神上和生活上源源不断的支持，是你们的一路陪伴才使我顺利完成学业。

最后，我要感谢河南城建学院大学四年来对我的培养！我将铭记这四年的经历，用自己的努力回报母校，回报社会！

## 参考文献

1. Sadow B D . ROLLING LUGGAGE: US, US3653474 A[P]. 1972.
2. 徐越倩,李拓,陆利丽.科技金融结合试点政策对地区经济增长影响研究——基于科技创新与产业结构合理化的视角[J/OL].重庆大学学报(社会科学版):1-14[2021-05-22].
3. 张汪阳.智能跟随旅行箱创业项目商业计划书[D].兰州大学,2018.
4. 邹俊.智能机器人跟随系统研发[D].华中科技大学,2018.
5. 刘珂.基于UWB的跟随行李箱研究与设计[D].武汉理工大学,2019.
6. 苗伟根.智能快充技术的研究及电路设计[D].杭州电子科技大学,2019.
7. 张文达.智能跟随行李箱研究与设计[D].合肥工业大学,2019.
8. Dotlic I , Connell A , Hang M , et al. Angle of Arrival Estimation Using
     
   Decawave DW1000 Integrated Circuits[C]// 2017 14th Workshop on Positioning,
     
   Navigation and Communications (WPNC). IEEE, 2018.
9. Yan Z A , Ld B . A phase-difference-of-arrival assisted ultra-wideband
     
   positioning method for elderly care - ScienceDirect[J]. Measurement, 2020.
10. Bonnin-Pascual F , Ortiz A . UWB-Based Self-Localization Strategies: A Novel
      
    ICP-Based Method and a Comparative Assessment for Noisy-Ranges-Prone
      
    Environments[J]. Sensors, 2020, 20(19).
11. 乔怡豪.自动跟随小车控制系统的研究[D].辽宁科技大学,2019.
12. 刘伟丽.自动跟随小车控制系统[D].长春理工大学,2013.
13. 吴晓峰.基于Kinect的跟随机器人控制系统设计[D].华南理工大学,2016.
14. 张丰,李顺霖,陈仁,谢印忠.基于自动跟随系统的智能行李箱[J].智能计算机与应用,2019,9(03):156-158.
15. 陈小芳.一种智能称重行李箱[P].广东：CN206213467U,2017-06-06.
16. 杨进生.可身份识别的智能称重行李箱[P].江西：CN207678990U,2018-08-03.
17. 赵云霞,易育智,魏新,王靖.一种具有音响、防丢报警、称重功能的智能行李箱[P].广东：CN205696222U,2016-11-23.
18. 叶飞,丁演,顾肖红.一种智能称重行李箱[P].江苏：CN104705965A,2015-06-17.
19. 卢群,何东升,周春欣,薛玉利,刁广强,洪亭轩.基于单片机的多功能智能行李箱设计[J].物联网技术,2020,10(03):99-100+104.
20. 申耀武,吴进程,徐亦昌,林健斌.基于单片机控制的智能行李箱设计研究[J].机电工程技术,2019,48(07):114-116.
21. 熊颖,乌泽.基于嵌入式的智能可跟随移动机器人[J].科技经济导刊,2020,28(08):41.
22. 唐佐侠,刘婷,孙春志.基于STM32的智能跟随平衡车设计[J].中原工学院学报,2020,31(02):36-40.
23. 刘涛,王佳琦.智能跟随行李箱定位控制研究[J].计算机产品与流通,2020(09):186.
24. 夏梦琴,陈煜,周毛毛,张纪,赵玉荣.基于单片机的智能跟随箱包设计[J].现代信息科技,2020,4(14):160-162.
25. 彭秋洁,刘凯磊,康绍鹏,向承金,刘佳帅,况明鑫,王海斌.基于Arduino的多功能自动跟随行李箱设计[J].物联网技术,2020,10(08):63-65+70.
26. 孙艺铭,宫成,王浩,张前进.基于视觉导引的智能车跟随控制方法[J].电子制作,2020(17):34-35+17.
27. 马楠.行李箱产业现状及前景趋势分析[J].中国纤检,2020(09):104-108.
28. 吴文滔,邓政,陈敏,徐贝,杨玉龙.基于OpenCV的智能跟随行李箱控制系统设计[J].农家参谋,2020(23):167.
29. 叶思言,张永宁,李锦,张炼科,周玉,郑美芳,张松.基于UWB定位和OpenMV识别的智能跟随行李箱设计[J].成都工业学院学报,2020,23(03):29-33.
30. 张长虹,吴伟伟,李肖锋,朱素娜.基于嵌入式行李箱的智能锁设计[J].电脑知识与技术,2020,16(24):78-80.
31. 谭虹.一种智能指纹密码锁系统的设计与实现[J].软件工程,2020,23(11):34-36+20.
32. 郭阳光.基于单片机的指纹识别电子密码锁设计[J].电子测试,2020(23):29-30+53.
33. 陈珍妮.智能消费品用户购买及扩散行为研究[D].上海外国语大学,2020.
34. 刘关迪,赵璐.基于UWB技术的室内智能跟随系统的实现与优化[J].计算机应用与软件,2020,37(12):95-100.
35. 黄锦阳,刘童金,杨炳旺.基于Arduino单片机的智能购物车系统的研究[J].电子世界,2016(09):129.
36. 邹淳皓.基于Arduino和Pixy2的自动跟随机器人的研究[J].数码世界,2018(10):106-107.
37. “蓝牙行李箱”可跟随主人自行移动[J].新科幻(科学阅读版),2012(12):34.
38. 秦伟,田浩澄.基于物联网的智能定位跟随行李箱[J].计算机产品与流通,2020(01):127.
39. 王铖,刘中姐,袁新枚,史书恒,李柏毅.智能车辆自动跟随控制的目标跟踪算法研究[J].汽车技术,2020(07):1-6.
40. 王恺.基于超声波定位的跟随式移动平台的设计与实现[D].重庆理工大学,2020.
41. 耿丽娟,刘青,袁培燕.基于Arduino的智能防盗系统设计[J].计算机技术与发展,2020,30(05):175-179+184.
42. 张丰,李顺霖,陈仁,谢印忠.基于自动跟随系统的智能行李箱[J].智能计算机与应用,2019,9(03):156-158.
43. 张园,江民欢,阚辉昂,冒书梅,王学刚.基于Arduino控制器的校园智能垃圾桶设计[J].智能城市,2019,5(06):15-16.
44. 王景夏,成意.自动跟随行李箱的设计[J].轻工科技,2013,29(04):70+93.
45. 赵艳妮,马顺,张书源,刘大伟,金城凯.基于视觉传感器的自动跟随行李箱设计[J].智能城市,2017,3(08):23-24.

## 附录A

![](https://i-blog.csdnimg.cn/blog_migrate/774d4d92a868cd995c6cd2a3d66dcb3d.png)

图A.1 控制系统总体框架

## 附录B

![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/8038f511798cf5717bafd548ed58fdb9.png)

![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/c96f616fd68e1a6ce665ded4d1729bf1.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/d16dc694d5ace15a1ce105ee409a9bb1.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/bdce8cdc1dd607f51cc23da5d9335938.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/a1382d74246c614c6c13021bb0565ea2.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/907a97a996fde499e672ffae54186ef8.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/cd382af4d87930dc2410dfcbacd3f454.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/26ce3881b7176ea8b5672c020dbf0529.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/adbffd65809c5c7865a068c56632f042.png)
  
![请添加图片描述](https://i-blog.csdnimg.cn/blog_migrate/a986a7c5d3379f976c49a3f80ae93825.png)