---
layout: post
title: "android报错java.lang.IllegalStateException-Not-allowed-to-start-service-Intent"
date: 2025-01-21 23:45:00 +0800
description: "android报错：java.lang.IllegalStateException: Not all"
keywords: "java.lang.illegalstateexception: not allowed to start service intent"
categories: ['Android']
tags: ['Service', 'Android']
artid: "90181285"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=90181285
    alt: "android报错java.lang.IllegalStateException-Not-allowed-to-start-service-Intent"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=90181285
featuredImagePreview: https://bing.ee123.net/img/rand?artid=90181285
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     android报错：java.lang.IllegalStateException: Not allowed to start service Intent
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      android报错：java.lang.IllegalStateException: Not allowed to start service Intent
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        错误
       </a>
      </li>
      <li>
       <a href="#_14" rel="nofollow">
        解决方法
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#1_15" rel="nofollow">
          1
         </a>
        </li>
        <li>
         <a href="#2_27" rel="nofollow">
          2
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_58" rel="nofollow">
        完事
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     错误
    </h2>
    <p>
     今天测试扔我一条崩溃信息：
    </p>
    <pre><code class="prism language-java">Caused by<span class="token operator">:</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>IllegalStateException<span class="token operator">:</span> Not allowed to start service Intent <span class="token punctuation">{<!-- --></span> cmp<span class="token operator">=</span>xxx <span class="token punctuation">}</span><span class="token operator">:</span> app is in background uid UidRecord<span class="token punctuation">{<!-- --></span>xxx u0a136 CEM idle procs<span class="token operator">:</span><span class="token number">1</span> <span class="token function">seq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre>
    <p>
     这能难得倒我吗？
     <br/>
     一看就知道是后台服务启动错误，把服务放置前台就可以了，easy
    </p>
    <blockquote>
     <p>
      其实谷歌了一下下。。。。
      <br/>
      <a href="https://stackoverflow.com/questions/46445265/android-8-0-java-lang-illegalstateexception-not-allowed-to-start-service-inten" rel="nofollow">
       https://stackoverflow.com/questions/46445265/android-8-0-java-lang-illegalstateexception-not-allowed-to-start-service-inten
      </a>
      <br/>
      问题是Android8.0以上不允许创建后台服务。
     </p>
    </blockquote>
    <h2>
     <a id="_14">
     </a>
     解决方法
    </h2>
    <h3>
     <a id="1_15">
     </a>
     1
    </h3>
    <p>
     最简单就是直接开启前台服务
     <br/>
     在你的服务类的onCreate里将服务设置到前台就可以了
    </p>
    <pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token function">startForeground</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
    <p>
     当然了这种方法会在Android5.0和6.0的手机的状态栏上显示啥啥啥正在运行。
     <br/>
     有些人可能不想要。
     <br/>
     那就参考下面这个方法
    </p>
    <h3>
     <a id="2_27">
     </a>
     2
    </h3>
    <p>
     来源于这里的方法
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b28a79fe06a41944406078b85f2b2a0c.png">
      <br/>
      先是修改你的manifest文件里的Service配置
     </img>
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span>service android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">".YourService"</span>
         android<span class="token operator">:</span>permission<span class="token operator">=</span><span class="token string">"android.permission.BIND_JOB_SERVICE"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
    <p>
     然后将你的service类的修改继承，改成
     <code>
      extends JobIntentService
     </code>
     <br/>
     然后添加以下代码
    </p>
    <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> JOB_ID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">enqueueWork</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> Intent work<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">enqueueWork</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> YourService<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> JOB_ID<span class="token punctuation">,</span> work<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onHandleWork</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> Intent intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// your code</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     而启动服务就修改成如下方法。
    </p>
    <pre><code class="prism language-java">YourService<span class="token punctuation">.</span><span class="token function">enqueueWork</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     不过我测试了下，在onStartCommand()里的内容不执行。还没找到什么原因。
     <br/>
     希望知道的朋友可以帮忙解析下。
    </p>
    <h2>
     <a id="_58">
     </a>
     完事
    </h2>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f73696e61745f3338313834373438:2f61727469636c652f64657461696c732f3930313831323835" class_="artid" style="display:none">
 </p>
</div>


