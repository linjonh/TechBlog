---
layout: post
title: "Android-实现登录功能的思路"
date: 2025-03-11 22:31:17 +0800
description: "Android 如何实现登录功能？思路讲解~~~"
keywords: "Android :实现登录功能的思路"
categories: ['未分类']
tags: ['Android']
artid: "146169263"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146169263
    alt: "Android-实现登录功能的思路"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146169263
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146169263
cover: https://bing.ee123.net/img/rand?artid=146169263
image: https://bing.ee123.net/img/rand?artid=146169263
img: https://bing.ee123.net/img/rand?artid=146169263
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android :实现登录功能的思路
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     android的登录功能和前端一样，需要保存登录的用户信息。
    </p>
    <ol>
     <li>
      创建一个工具类
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token comment">// 用户工具类，用于管理用户登录状态和用户信息</span>
<span class="token keyword">object</span> AppUserUtil <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 常量定义</span>
    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> LOGGED_FLAG <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"logged_flag"</span></span> <span class="token comment">// 登录状态的键名</span>
    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> USER_INFO <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"user_info"</span></span>     <span class="token comment">// 用户信息的键名</span>
    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> TAG <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"AppUserUtil"</span></span>         <span class="token comment">// 日志标签</span>

    <span class="token comment">// 登录状态属性</span>
    <span class="token keyword">var</span> isLogged<span class="token operator">:</span> Boolean
        <span class="token comment">// 获取登录状态，默认值为 false</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> DataStoreUtils<span class="token punctuation">.</span><span class="token function">readBooleanData</span><span class="token punctuation">(</span>LOGGED_FLAG<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置登录状态，并同步保存到 DataStore</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=</span> DataStoreUtils<span class="token punctuation">.</span><span class="token function">saveSyncBooleanData</span><span class="token punctuation">(</span>LOGGED_FLAG<span class="token punctuation">,</span> value <span class="token operator">=</span> value<span class="token punctuation">)</span>

    <span class="token comment">// 用户信息属性</span>
    <span class="token keyword">var</span> userInfo<span class="token operator">:</span> UserInfo<span class="token operator">?</span>
        <span class="token comment">// 获取用户信息，从 DataStore 中读取并反序列化为 UserInfo 对象</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> DataStoreUtils<span class="token punctuation">.</span><span class="token function">readStringData</span><span class="token punctuation">(</span>USER_INFO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置用户信息，并同步保存到 DataStore</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=</span> DataStoreUtils<span class="token punctuation">.</span><span class="token function">saveSyncStringData</span><span class="token punctuation">(</span>USER_INFO<span class="token punctuation">,</span> value <span class="token operator">=</span> value<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span>

    <span class="token comment">// 登录方法</span>
    <span class="token keyword">fun</span> <span class="token function">onLogin</span><span class="token punctuation">(</span>userInfo<span class="token operator">:</span> UserInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        isLogged <span class="token operator">=</span> <span class="token boolean">true</span>               <span class="token comment">// 设置登录状态为 true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> userInfo      <span class="token comment">// 保存用户信息</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onLogin: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">userInfo</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token comment">// 打印登录日志</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 登出方法</span>
    <span class="token keyword">fun</span> <span class="token function">onLogOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        isLogged <span class="token operator">=</span> <span class="token boolean">false</span>              <span class="token comment">// 设置登录状态为 false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token keyword">null</span>          <span class="token comment">// 清空用户信息</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      发起登录请求，登录成功，则调用工具类的onLgoin方法
     </li>
    </ol>
    <pre><code class="prism language-kotlin"> <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        viewModelScope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{<!-- --></span>
            flow <span class="token punctuation">{<!-- --></span>
                <span class="token function">emit</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>viewStates<span class="token punctuation">.</span>account<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> viewStates<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>errorCode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        HttpResult<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>data<span class="token operator">!!</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">throw</span> <span class="token function">Exception</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"the result of remote's request is null"</span></span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">throw</span> <span class="token function">Exception</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>errorMsg<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onEach</span> <span class="token punctuation">{<!-- --></span>
                AppUserUtil<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
                _viewEvents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>LoginViewEvent<span class="token punctuation">.</span>PopBack<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">{<!-- --></span>
                _viewEvents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>LoginViewEvent<span class="token punctuation">.</span><span class="token function">ErrorMessage</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>message <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
    <ol start="3">
     <li>
      一些页面，如果未登录，是不能使用的，这个时候我们可以取出isLogged 属性进行判断。
     </li>
    </ol>
    <pre><code class="prism language-kotlin">
<span class="token annotation builtin">@ExperimentalFoundationApi</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">CollectPage</span><span class="token punctuation">(</span>
    navCtrl<span class="token operator">:</span> NavHostController<span class="token punctuation">,</span>
    scaffoldState<span class="token operator">:</span> ScaffoldState<span class="token punctuation">,</span>
    viewModel<span class="token operator">:</span> CollectViewModel <span class="token operator">=</span> <span class="token function">hiltViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> viewStates <span class="token operator">=</span> viewModel<span class="token punctuation">.</span>viewStates
    <span class="token keyword">val</span> collectPaging <span class="token operator">=</span> viewStates<span class="token punctuation">.</span>pagingData<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">collectAsLazyPagingItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> webUrls <span class="token operator">=</span> viewStates<span class="token punctuation">.</span>urlList
    <span class="token keyword">val</span> titles <span class="token operator">=</span> viewStates<span class="token punctuation">.</span>titles
    <span class="token keyword">val</span> isRefreshing <span class="token operator">=</span> viewStates<span class="token punctuation">.</span>isRefreshing
    <span class="token keyword">val</span> listState <span class="token operator">=</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>collectPaging<span class="token operator">?</span><span class="token punctuation">.</span>itemCount <span class="token operator">?:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> viewStates<span class="token punctuation">.</span>listState <span class="token keyword">else</span> <span class="token function">LazyListState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">DisposableEffect</span><span class="token punctuation">(</span>Unit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Log<span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"debug"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onStart"</span></span><span class="token punctuation">)</span>
        viewModel<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>CollectViewAction<span class="token punctuation">.</span>OnStart<span class="token punctuation">)</span>
        onDispose <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">Column</span><span class="token punctuation">(</span>
        modifier <span class="token operator">=</span> Modifier
            <span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>bottom <span class="token operator">=</span> BottomNavBarHeight<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">AppToolsBar</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"我的收藏"</span></span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AppUserUtil<span class="token punctuation">.</span>isLogged<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">EmptyView</span><span class="token punctuation">(</span>
                tips <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"点击登录"</span></span><span class="token punctuation">,</span>
                imageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Face
            <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                RouteUtils<span class="token punctuation">.</span><span class="token function">navTo</span><span class="token punctuation">(</span>navCtrl<span class="token punctuation">,</span> RouteName<span class="token punctuation">.</span>LOGIN<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            collectPaging<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">RefreshList</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> listState <span class="token operator">=</span> listState<span class="token punctuation">,</span> isRefreshing <span class="token operator">=</span> isRefreshing<span class="token punctuation">,</span> onRefresh <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                    viewModel<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>CollectViewAction<span class="token punctuation">.</span>Refresh<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>webUrls<span class="token punctuation">.</span><span class="token function">isNullOrEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        stickyHeader <span class="token punctuation">{<!-- --></span>
                            <span class="token function">ListTitle</span><span class="token punctuation">(</span>title <span class="token operator">=</span> titles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                        item <span class="token punctuation">{<!-- --></span>
                            <span class="token function">FlowRow</span><span class="token punctuation">(</span>
                                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                            <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                webUrls<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">forEachIndexed</span> <span class="token punctuation">{<!-- --></span> index<span class="token punctuation">,</span> website <span class="token operator">-&gt;</span>
                                    <span class="token function">LabelTextButton</span><span class="token punctuation">(</span>
                                        text <span class="token operator">=</span> website<span class="token punctuation">.</span>name <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">"标签"</span></span><span class="token punctuation">,</span>
                                        modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span>end <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span> bottom <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                        onClick <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                                            RouteUtils<span class="token punctuation">.</span><span class="token function">navTo</span><span class="token punctuation">(</span>
                                                navCtrl<span class="token punctuation">,</span>
                                                RouteName<span class="token punctuation">.</span>WEB_VIEW<span class="token punctuation">,</span>
                                                <span class="token function">WebData</span><span class="token punctuation">(</span>website<span class="token punctuation">.</span>name<span class="token punctuation">,</span> website<span class="token punctuation">.</span>link<span class="token operator">!!</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">)</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">)</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    stickyHeader <span class="token punctuation">{<!-- --></span>
                        <span class="token function">ListTitle</span><span class="token punctuation">(</span>title <span class="token operator">=</span> titles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>collectPaging<span class="token punctuation">.</span>itemCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">items</span><span class="token punctuation">(</span>collectPaging<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> collectItem <span class="token operator">-&gt;</span>
                            <span class="token function">CollectListItemView</span><span class="token punctuation">(</span>
                                collectItem<span class="token operator">!!</span><span class="token punctuation">,</span>
                                onClick <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                                    RouteUtils<span class="token punctuation">.</span><span class="token function">navTo</span><span class="token punctuation">(</span>
                                        navCtrl<span class="token punctuation">,</span>
                                        RouteName<span class="token punctuation">.</span>WEB_VIEW<span class="token punctuation">,</span>
                                        <span class="token function">WebData</span><span class="token punctuation">(</span>collectItem<span class="token punctuation">.</span>title<span class="token punctuation">,</span> collectItem<span class="token punctuation">.</span>link<span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     参考资料：
    </p>
    <ol>
     <li>
      https://github.com/RicardoJiang/wanandroid-compose
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34303835333931392f:61727469636c652f64657461696c732f313436313639323633" class_="artid" style="display:none">
 </p>
</div>


