---
layout: post
title: "Centos时间同步"
date: 2025-03-12 14:01:11 +0800
description: "一、安装NTP服务systemctlenabled此外，如果系统中安装了chrony服务，它可能会与ntp服务冲突，导致ntp服务开机自启失败。可以执行查看chrony服务状态，若处于运行状态，执行停止该服务，并执行禁止其开机自启7。[root@从你执行的命令和得到的输出结果来看，你已经成功停止并禁用了chronyd服务。这条信息表明系统已经移除了chronyd服务在目录下的符号链接，也就意味着chronyd服务不会在开机时自动启动了。接下来你可以继续按照之前的步骤操作，确保ntpd。"
keywords: "Centos时间同步"
categories: ['未分类']
tags: ['运维', 'Linux', 'Centos']
artid: "146203307"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146203307
    alt: "Centos时间同步"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146203307
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146203307
cover: https://bing.ee123.net/img/rand?artid=146203307
image: https://bing.ee123.net/img/rand?artid=146203307
img: https://bing.ee123.net/img/rand?artid=146203307
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Centos时间同步
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     一、安装NTP服务
    </p>
    <ol>
     <li>
      <strong>
       安装并配置 NTP 服务
      </strong>
      ：
      <ul>
       <li>
        安装 NTP 客户端，执行命令
        <code>
         yum install -y ntp
        </code>
        。
       </li>
       <li>
        编辑 NTP 配置文件
        <code>
         /etc/ntp.conf
        </code>
        ，添加或修改 NTP 服务器，例如使用国内常用的 NTP 服务器
        <code>
         cn.pool.ntp.org
        </code>
        ，在文件中添加一行
        <code>
         server cn.pool.ntp.org
        </code>
        。也可以使用全球 NTP 服务器池
        <code>
         pool.ntp.org
        </code>
        ，即添加
        <code>
         server pool.ntp.org
        </code>
        。
       </li>
       <li>
        重启 NTP 服务，让配置生效，命令为
        <code>
         systemctl restart ntpd
        </code>
        。
       </li>
       <li>
        可以设置 NTP 服务开机自启，执行
        <code>
         systemctl enable ntpd
        </code>
        。
       </li>
       <li>
        <p>
         在 CentOS 系统中，让 NTP 服务开机自启可以按照以下步骤进行：
        </p>
       </li>
       <li>
        <strong>
         确保 NTP 服务已安装
        </strong>
        ：执行命令
        <code>
         rpm -qa | grep ntp
        </code>
        ，检查 NTP 是否已经安装。如果没有安装，可以使用
        <code>
         yum install -y ntp
        </code>
        命令进行安装5。
       </li>
       <li>
        <strong>
         设置开机自启
        </strong>
        ：使用
        <code>
         systemctl
        </code>
        命令设置 NTP 服务开机自启，执行
        <code>
         systemctl enable ntpd
        </code>
        。执行命令后，系统会将 NTP 服务设置为开机自启状态123。
       </li>
       <li>
        <strong>
         检查自启设置是否成功
        </strong>
        ：执行
        <code>
         systemctl is-enabled ntpd
        </code>
        命令，如果输出为
        <code>
         enabled
        </code>
        ，则表示 NTP 服务开机自启设置成功1。
       </li>
       <li>
        <p>
         此外，如果系统中安装了
         <code>
          chrony
         </code>
         服务，它可能会与
         <code>
          ntp
         </code>
         服务冲突，导致
         <code>
          ntp
         </code>
         服务开机自启失败。可以执行
         <code>
          systemctl status chronyd
         </code>
         查看
         <code>
          chrony
         </code>
         服务状态，若处于运行状态，执行
         <code>
          systemctl stop chronyd
         </code>
         停止该服务，并执行
         <code>
          systemctl disable chronyd
         </code>
         禁止其开机自启7。
        </p>
       </li>
       <li>
        <p>
         [root@
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         ~]# systemctl stop chronyd [root@
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         ~]# systemctl disable chronyd Removed symlink /etc/systemd/system/multi-user.target.wants/chronyd.service.
        </p>
        <p>
         从你执行的命令和得到的输出结果来看，你已经成功停止并禁用了
         <code>
          chronyd
         </code>
         服务。
         <code>
          Removed symlink /etc/systemd/system/multi-user.target.wants/chronyd.service.
         </code>
         这条信息表明系统已经移除了
         <code>
          chronyd
         </code>
         服务在
         <code>
          multi-user.target.wants
         </code>
         目录下的符号链接，也就意味着
         <code>
          chronyd
         </code>
         服务不会在开机时自动启动了。
        </p>
        <p>
         接下来你可以继续按照之前的步骤操作，确保
         <code>
          ntpd
         </code>
         服务正常运行并设置为开机自启，以便让系统时间能够通过 NTP 服务器进行同步。
        </p>
        <p>
        </p>
       </li>
       <li>
        确保
        <code>
         ntpd
        </code>
        服务已启动：
        <br/>
        执行
        <code>
         systemctl start ntpd
        </code>
        命令来启动
        <code>
         ntpd
        </code>
        服务。
       </li>
       <li>
        检查
        <code>
         ntpd
        </code>
        服务状态：
        <br/>
        使用
        <code>
         systemctl status ntpd
        </code>
        命令查看
        <code>
         ntpd
        </code>
        服务是否成功启动并运行正常。
       </li>
       <li>
        手动同步时间：
        <br/>
        安装
        <code>
         ntpdate
        </code>
        工具（如果未安装，执行
        <code>
         yum install -y ntpdate
        </code>
        ），然后使用
        <code>
         ntpdate 时间服务器地址
        </code>
        来手动同步时间，例如
        <code>
         ntpdate cn.pool.ntp.org
        </code>
        。
       </li>
       <li>
        <p>
        </p>
        <p>
         如果一切顺利，你的系统时间应该能够正确同步并在后续保持更新了。
        </p>
       </li>
       <li>
        检查时间同步状态：
        <br/>
        再次执行
        <code>
         timedatectl
        </code>
        命令，查看
        <code>
         NTP synchronized
        </code>
        状态是否变为
        <code>
         yes
        </code>
        ，确认时间是否能正常自动更新。
       </li>
       <li>
        <p>
         systemctl status ntpd ● ntpd.service - Network Time Service Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled) Active: active (running) since 三 2025-03-12 13:21:24 CST; 3s ago Process: 21387 ExecStart=/usr/sbin/ntpd -u ntp:ntp $OPTIONS (code=exited, status=0/SUCCESS) Main PID: 21388 (ntpd) Tasks: 1 Memory: 1.4M CGroup: /system.slice/ntpd.service └─21388 /usr/sbin/ntpd -u ntp:ntp -g 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listen normally on 9 ens33 fe80::9fd:4449:eb46:c7c6 UDP 123 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listen normally on 10 vethd1f3e94 fe80::9457:1dff:fea7:b6f8 UDP 123 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listen normally on 11 vethcc55d74 fe80::3493:18ff:fe20:1387 UDP 123 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listen normally on 12 vethb0d2b1e fe80::3c38:96ff:fe8b:d3f UDP 123 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listen normally on 13 veth2c0f7ac fe80::d0be:53ff:fe0d:1aac UDP 123 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listen normally on 14 br-8e7438411b24 fe80::42:efff:fe02:c759 UDP 123 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: Listening on routing socket on fd #31 for interface updates 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: 0.0.0.0 c016 06 restart 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: 0.0.0.0 c012 02 freq_set kernel 0.000 PPM 3月 12 13:21:24
         <a href="https://localhost/" rel="nofollow" title="localhost">
          localhost
         </a>
         .nnhh ntpd[21388]: 0.0.0.0 c011 01 freq_not_set
        </p>
        <p>
         从
         <code>
          systemctl status ntpd
         </code>
         的输出结果来看，
         <code>
          ntpd
         </code>
         服务已经成功启动并正在运行（
         <code>
          Active: active (running)
         </code>
         ）。这是一个好的进展，接下来你可以进一步确认时间是否已经成功同步：
        </p>
        <p>
        </p>
       </li>
       <li>
        <p>
         <strong>
          查看 NTP 同步状态
         </strong>
         ：
         <br/>
         执行
         <code>
          timedatectl
         </code>
         命令，查看
         <code>
          NTP synchronized
         </code>
         字段的值。如果显示为
         <code>
          yes
         </code>
         ，说明系统已经成功通过 NTP 服务器同步了时间。如果显示为
         <code>
          no
         </code>
         ，可以继续执行下一步手动同步时间。
        </p>
       </li>
       <li>
        <p>
         <strong>
          手动同步时间
         </strong>
         ：
         <br/>
         安装
         <code>
          ntpdate
         </code>
         工具（如果还未安装，执行
         <code>
          yum install -y ntpdate
         </code>
         ），然后使用
         <code>
          ntpdate
         </code>
         命令手动同步时间。例如：
        </p>
       </li>
       <li>
        <p>
        </p>
        <p>
         bash
        </p>
        <pre><code>ntpdate cn.pool.ntp.org
</code></pre>
        <p>
        </p>
        <p>
         或者使用其他可用的 NTP 服务器地址，如
         <code>
          pool.ntp.org
         </code>
         等。
        </p>
        <p>
        </p>
       </li>
       <li>
        <p>
         <strong>
          再次检查时间和 NTP 同步状态
         </strong>
         ：
         <br/>
         手动同步时间后，再次执行
         <code>
          date
         </code>
         命令查看当前系统时间是否正确，以及执行
         <code>
          timedatectl
         </code>
         命令查看
         <code>
          NTP synchronized
         </code>
         字段是否变为
         <code>
          yes
         </code>
         。
        </p>
       </li>
       <li>
        <p>
         <strong>
          等待自动同步（如果手动同步成功）
         </strong>
         ：
         <br/>
         如果手动同步时间成功且
         <code>
          NTP synchronized
         </code>
         变为
         <code>
          yes
         </code>
         ，那么
         <code>
          ntpd
         </code>
         服务会在后续按照其默认的时间间隔自动与 NTP 服务器进行时间同步。你可以等待一段时间后再次检查时间是否仍然准确。
        </p>
       </li>
       <li>
        <p>
        </p>
        <p>
         如果在上述步骤中遇到任何问题，比如手动同步时间失败或
         <code>
          NTP synchronized
         </code>
         始终无法变为
         <code>
          yes
         </code>
         ，可以继续检查
         <code>
          ntpd
         </code>
         的配置文件（
         <code>
          /etc/ntp.conf
         </code>
         ）中 NTP 服务器的设置是否正确，以及网络连接是否正常等情况。
        </p>
       </li>
       <li>
        <p>
         <strong>
          <code>
           ntp.conf文件配置
          </code>
         </strong>
        </p>
       </li>
       <li>
        <p>
         # For more information about this file, see the man pages
         <br/>
         # ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5).
        </p>
        <p>
         driftfile /var/lib/ntp/drift
        </p>
        <p>
         # Permit time synchronization with our time source, but do not
         <br/>
         # permit the source to query or modify the service on this system.
         <br/>
         restrict default nomodify notrap nopeer noquery
        </p>
        <p>
         # Permit all access over the loopback interface.  This could
         <br/>
         # be tightened as well, but to do so would effect some of
         <br/>
         # the administrative functions.
         <br/>
         restrict 127.0.0.1
         <br/>
         restrict ::1
        </p>
        <p>
         # Hosts on local network are less restricted.
         <br/>
         restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap
        </p>
        <p>
         # Use public servers from the pool.ntp.org project.
         <br/>
         # Please consider joining the pool (http://www.pool.ntp.org/join.html).
         <br/>
         server 0.centos.pool.ntp.org iburst
         <br/>
         server 1.centos.pool.ntp.org iburst
         <br/>
         server 2.centos.pool.ntp.org iburst
         <br/>
         server 3.centos.pool.ntp.org iburst
         <br/>
         server cn.pool.ntp.org iburst
         <br/>
         server time.nist.gov.cn iburst
         <br/>
         #broadcast 192.168.1.255 autokey        # broadcast server
         <br/>
         #broadcastclient                        # broadcast client
         <br/>
         #broadcast 224.0.1.1 autokey            # multicast server
        </p>
        <p>
        </p>
       </li>
      </ul>
     </li>
     <li>
      <strong>
       手动同步时间并更新硬件时钟
      </strong>
      ：
      <ul>
       <li>
        若不想使用 NTP 服务，也可以手动同步时间。先安装
        <code>
         ntpdate
        </code>
        ，执行
        <code>
         yum install -y ntpdate
        </code>
        。
       </li>
       <li>
        然后使用
        <code>
         ntpdate 时间服务器地址
        </code>
        来同步时间，如
        <code>
         ntpdate time.nist.gov
        </code>
        ，若该服务器同步不了，可尝试
        <code>
         0.asia.pool.ntp.org
        </code>
        、
        <code>
         1.asia.pool.ntp.org
        </code>
        等。
       </li>
       <li>
        同步完系统时间后，将系统时间写入硬件时钟，执行
        <code>
         hwclock --systohc
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       检查虚拟机设置（如果是虚拟机环境）
      </strong>
      ：
      <ul>
       <li>
        部分虚拟机软件（如 VMware），有与宿主机时间同步的选项。以 VMware 为例，选中虚拟机，点击 “虚拟机” 菜单，选择 “设置”，在弹出窗口中找到 “选项”，点击 “时间”，勾选 “与主机时间同步” 。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       检查硬件时钟电池（较少见情况）
      </strong>
      ：如果是物理机，系统时间不准确可能是硬件时钟（RTC）电池电量不足或损坏导致。打开机箱，找到主板上的纽扣电池，更换为同型号新电池，然后进入 BIOS 设置界面，将时间设置为正确值 。
     </li>
    </ol>
    <h4>
    </h4>
    <p>
     <strong>
      二、检查时区
     </strong>
    </p>
    <h4>
     1.查看当前时区
    </h4>
    <p>
     执行命令
     <code>
      timedatectl
     </code>
     ，在输出信息中找到
     <code>
      Timezone
     </code>
     对应的内容，这就是当前系统时区。比如输出中可能有类似
     <code>
      Timezone: Asia/Shanghai
     </code>
     这样的信息，就表示当前时区是上海时区。
    </p>
    <h4>
     设置时区
    </h4>
    <p>
     如果当前时区不对，使用以下命令设置：
    </p>
    <ol>
     <li>
      <strong>
       使用
       <code>
        timedatectl
       </code>
       命令
      </strong>
      ：
      <br/>
      比如要设置为上海时区，命令是
      <code>
       timedatectl set-timezone Asia/Shanghai
      </code>
      。
     </li>
     <li>
      <strong>
       通过复制时区文件设置
      </strong>
      ：
      <br/>
      可以直接复制相应的时区文件到
      <code>
       /etc/localtime
      </code>
      来设置时区。例如设置为上海时区，执行命令
      <code>
       cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
      </code>
      。
     </li>
    </ol>
    <p>
     设置完时区后，可以再次使用
     <code>
      timedatectl
     </code>
     命令确认时区是否设置正确，也可以用
     <code>
      date
     </code>
     命令查看时间显示是否符合预期。
    </p>
    <p>
     [root@
     <a href="https://localhost/" rel="nofollow" title="localhost">
      localhost
     </a>
     ~]# timedatectl Local time: 三 2025-03-12 13:16:02 CST Universal time: 三 2025-03-12 05:16:02 UTC RTC time: 三 2025-03-12 05:31:21 Time zone: Asia/Shanghai (CST, +0800) NTP enabled: yes NTP synchronized: no RTC in local TZ: no DST active: n/a
    </p>
    <p>
     <code>
      NTP synchronized
     </code>
     （NTP 同步状态）显示为
     <code>
      no
     </code>
     ，即没有成功通过网络时间协议（NTP）同步时间，这可能是时间无法自动更新的原因。
    </p>
    <p>
    </p>
    <h4>
     1. 检查 NTP 服务状态
    </h4>
    <p>
     执行命令
     <code>
      systemctl status ntpd
     </code>
     （若系统未安装 NTP，先执行
     <code>
      yum install -y ntp
     </code>
     进行安装），查看 NTP 服务是否已启动且运行正常。如果服务未启动，执行
     <code>
      systemctl start ntpd
     </code>
     启动服务；如果服务状态异常，可以尝试重启 NTP 服务，命令是
     <code>
      systemctl restart ntpd
     </code>
     。
    </p>
    <h4>
     2. 手动同步 NTP 时间
    </h4>
    <p>
     安装
     <code>
      ntpdate
     </code>
     工具（如果未安装，执行
     <code>
      yum install -y ntpdate
     </code>
     ），然后使用
     <code>
      ntpdate 时间服务器地址
     </code>
     来手动同步时间。例如：
    </p>
    <ul>
     <li>
      使用中国国家授时中心的服务器同步时间，命令为
      <code>
       ntpdate time.nist.gov.cn
      </code>
      。
     </li>
     <li>
      也可以使用全球 NTP 服务器池，如
      <code>
       ntpdate pool.ntp.org
      </code>
      。
     </li>
    </ul>
    <h4>
     3. 设置 NTP 自动同步
    </h4>
    <p>
     确保 NTP 服务开机自启，执行命令
     <code>
      systemctl enable ntpd
     </code>
     ，这样系统每次开机时会自动启动 NTP 服务并尝试同步时间。
    </p>
    <h4>
     4. 检查防火墙设置
    </h4>
    <p>
     如果 NTP 服务还是无法同步时间，可能是防火墙阻挡了 NTP 协议的端口（UDP 123 端口）。检查防火墙规则，若使用的是
     <code>
      firewalld
     </code>
     ，执行
     <code>
      firewall-cmd --list-ports
     </code>
     查看已开放的端口列表，若没有 123/UDP 端口，执行
     <code>
      firewall-cmd --permanent --add-port=123/UDP
     </code>
     开放端口，然后重启防火墙
     <code>
      firewall-cmd --reload
     </code>
     。
    </p>
    <p>
     完成上述操作后，等待一段时间，再次执行
     <code>
      timedatectl
     </code>
     命令查看
     <code>
      NTP synchronized
     </code>
     状态是否变为
     <code>
      yes
     </code>
     ，确认时间是否能正常自动更新。
    </p>
    <p>
     [root@
     <a href="https://localhost/" rel="nofollow" title="localhost">
      localhost
     </a>
     ~]# systemctl status ntpd ● ntpd.service - Network Time Service Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled) Active: inactive (dead) [root@
     <a href="https://localhost/" rel="nofollow" title="localhost">
      localhost
     </a>
     ~]#
    </p>
    <p>
     分享
    </p>
    <p>
     从输出结果可知，NTP 服务处于未激活（
     <code>
      inactive (dead)
     </code>
     ）状态，这就是时间无法通过 NTP 同步的原因。
    </p>
    <ol>
    </ol>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37313437323336302f:61727469636c652f64657461696c732f313436323033333037" class_="artid" style="display:none">
 </p>
</div>


