---
layout: post
title: "20241124-Typecho-视频插入插件"
date: 2024-11-24 23:08:53 +0800
description: "博文免不了涉及到视频插入这些,网上的插件都或多或少的比较重,和Typecho的风格不搭配。后面就有了DPlay插件精简而来的VideoInsertion插件。"
keywords: "typecho播放视频插件"
categories: ['未分类']
tags: ['开发语言', 'Typecho', 'Php']
artid: "144016081"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=144016081
    alt: "20241124-Typecho-视频插入插件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=144016081
featuredImagePreview: https://bing.ee123.net/img/rand?artid=144016081
cover: https://bing.ee123.net/img/rand?artid=144016081
image: https://bing.ee123.net/img/rand?artid=144016081
img: https://bing.ee123.net/img/rand?artid=144016081
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     20241124 Typecho 视频插入插件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     博文免不了涉及到视频插入这些,网上的插件都或多或少的比较重,和Typecho的风格不搭配
     <br/>
     后面就有了DPlay插件精简而来的VideoInsertion插件
    </p>
    <p>
     <a href="https://gitee.com/tangzhi1996/video-insertion" rel="nofollow" title="VideoInsertion: Typecho 视频插入插件">
      VideoInsertion: Typecho 视频插入插件
     </a>
    </p>
    <p>
     <br/>
     <img alt="" height="664" src="https://i-blog.csdnimg.cn/direct/8777d509919f42d4a4a612798df31c22.png" width="1200"/>
    </p>
    <p>
     <img alt="" height="1073" src="https://i-blog.csdnimg.cn/direct/7843e80531d84c1da2f95479c84a32b3.png" width="1200"/>
    </p>
    <p>
     <br/>
     目录结构
    </p>
    <p>
     rock@hinlink-ht2:/var/www/html/typecho/usr/plugins/VideoInsertion$ tree -h
     <br/>
     [4.0K]  .
     <br/>
     ├── [4.0K]  assets
     <br/>
     │   └── [3.5K]  editor.js
     <br/>
     ├── [1.3K]  Plugin.php
     <br/>
     └── [ 873]  README.md
    </p>
    <p>
     Plugin.php
    </p>
    <pre><code class="language-php">&lt;?php
if (!defined('__TYPECHO_ROOT_DIR__')) exit;

/**
 * 视频插入插件
 *
 * @package VideoInsertion
 * @author player
 * @version 1.0.0
 * @link 
 */
class VideoInsertion_Plugin implements Typecho_Plugin_Interface
{

    /**
     * 激活插件方法,如果激活失败,直接抛出异常
     *
     * @access public
     * @return void
     */
    public static function activate()
    {
        Typecho_Plugin::factory('admin/write-post.php')-&gt;bottom = ['VideoInsertion_Plugin', 'addEditorButton'];
        Typecho_Plugin::factory('admin/write-page.php')-&gt;bottom = ['VideoInsertion_Plugin', 'addEditorButton'];
    }

    /**
     * 禁用插件方法,如果禁用失败,直接抛出异常
     *
     * @static
     * @access public
     * @return void
     */
    public static function deactivate()
    {
    }
/**
 * 给编辑页面新增插入视频按钮
 */

    public static function addEditorButton()
    {
        $dir = Helper::options()-&gt;pluginUrl . '/VideoInsertion/assets/editor.js';
        echo "&lt;script type=\"text/javascript\" src=\"{$dir}\"&gt;&lt;/script&gt;";
    }

    public static function config(Typecho_Widget_Helper_Form $form)
    {

    }
/**
 * 配置页面
 *
 * @param Typecho_Widget_Helper_Form $form
 * @return void
 */
    public static function personalConfig(Typecho_Widget_Helper_Form $form)
    {
    }
}
</code></pre>
    <p>
     editor.js
    </p>
    <pre><code class="language-javascript">    $(function () {
        if ($('#wmd-button-row').length &gt; 0) {
            $('#wmd-button-row').append('&lt;li class="wmd-button" id="wmd-player-button" style="" title="插入视频"&gt;&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABGUlEQVQ4T6XTvyuFURgH8M9lkTKYlMGiRDKIxSQDkcFgYVAmi8WPwY+Uxa8FhWQmWdgMiAxmf4BYpFAGSRkY6K1z6tJ1vTdnfc/zOU/P830z/nkyoX4GIyjHHKrQjyXUoh3raEQT9nGDjQQowjk6cYcBnOIJHbjCY4DecYtK7KIrAUqwiNHweh16sRa+DWEbD5jAIS5QgekIJB0cB3kwgNXowTLq0YpNNKMB92iLwALGCpznSnYHP4EyvP4B5gX6wlaGcfkL9Cewh0/sYDIMMdtKBcSCN4xjK0tIDXyE6c/ipVAg2Xmynescc/jWQQxSvNeCUpzl2cQqpmKUj0JsC4nCSRL/+DMl66rBcwqhGN04wHwEUtTlvvIFs5ZDZeiythMAAAAASUVORK5CYII="/&gt;&lt;/li&gt;');
        }
    
        $(document).on('click', '#wmd-player-button', function () {
            $('body').append(
                '&lt;div id="DPlayer-Panel"&gt;' +
                '&lt;div class="wmd-prompt-background" style="position: absolute; top: 0; z-index: 1000; opacity: 0.5; height: 875px; left: 0; width: 100%;"&gt;&lt;/div&gt;' +
                '&lt;div class="wmd-prompt-dialog"&gt;' +
                '&lt;div&gt;' +
                '&lt;p&gt;&lt;b&gt;插入视频&lt;/b&gt;&lt;/p&gt;' +
                '&lt;p&gt;在下方输入参数&lt;/p&gt;' +
                '&lt;p&gt;&lt;input type="text" id="DP-url" value="" placeholder="链接"/&gt;&lt;/p&gt;' +
                '&lt;p&gt;&lt;input type="text" id="DP-pic" value="" placeholder="封面图"/&gt;&lt;/p&gt;' +
                '&lt;p&gt;&lt;input type="text" id="width" value="" placeholder="视频宽度"/&gt;&lt;/p&gt;' +
                '&lt;p&gt;&lt;input type="checkbox" id="controls" checked&gt;开启控件&lt;/input&gt;&lt;/p&gt;' +
                '&lt;p&gt;&lt;input type="checkbox" id="DP-autoplay"&gt;自动播放&lt;/input&gt;&lt;/p&gt;' +
                '&lt;/div&gt;' +
                '&lt;form&gt;' +
                '&lt;button type="button" class="btn btn-s primary" id="ok"&gt;确定&lt;/button&gt;' +
                '&lt;button type="button" class="btn btn-s" id="cancel"&gt;取消&lt;/button&gt;' +
                '&lt;/form&gt;' +
                '&lt;/div&gt;' +
                '&lt;/div&gt;');
        });
        //cancel
        $(document).on('click', '#cancel', function () {
            $('#DPlayer-Panel').remove();
            $('textarea').focus();
        });
        //ok
        $(document).on('click', '#ok', function () {
            var url = document.getElementById('DP-url').value,
                pic = document.getElementById('DP-pic').value,
                width = document.getElementById('width').value,
                controls = !!document.getElementById('controls').checked,
                autoplay = !!document.getElementById('DP-autoplay').checked;
            var tag = '&lt;video src="' + url+ '" ';
            if(pic) tag +=  'pic="' + pic + '" ';
            if (controls) tag += 'controls="' + controls + '" ';
            if(width) tag += 'width="' + width + '" ';
            if (autoplay) tag += 'autoplay="' + autoplay + '" ';
            tag += '&gt; &lt;/video&gt;\n';
            
            var editor = document.getElementById('text');
    
            if (document.selection) {
                editor.focus();
                sel = document.selection.createRange();
                sel.text = tag;
                editor.focus();
            }
            else if (editor.selectionStart || editor.selectionStart === '0') {
                var startPos = editor.selectionStart;
                var endPos = editor.selectionEnd;
                var cursorPos = startPos;
                editor.value = editor.value.substring(0, startPos)
                    + tag
                    + editor.value.substring(endPos, editor.textLength);
                cursorPos += tag.length;
                editor.focus();
                editor.selectionStart = cursorPos;
                editor.selectionEnd = cursorPos;
            }
            else {
                editor.value += tag;
                editor.focus();
            }
    
            $('#DPlayer-Panel').remove();
        })
    });</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031333833333437322f:61727469636c652f64657461696c732f313434303136303831" class_="artid" style="display:none">
 </p>
</div>


