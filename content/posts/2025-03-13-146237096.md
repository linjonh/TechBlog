---
layout: post
title: "ardunio-R4-WiFi连接实战"
date: 2025-03-13 17:17:07 +0800
description: "ardunio R4 WiFi 开发板有着不错的性能和板载内存，本机自带 WiFi 连接模块，可以完成简单的网络服务。对于这个小东西我情有独钟，也总希望能够用它来做些什么，所以先从 WiFi 连接开始学起，未来考虑一步一步为它接入大模型服务，做出一个小的桌面显示小玩具"
keywords: "ardunio R4 WiFi连接实战"
categories: ['Arduino']
tags: ['开发语言', '嵌入式硬件', 'Iot', 'C']
artid: "146237096"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146237096
    alt: "ardunio-R4-WiFi连接实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146237096
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146237096
cover: https://bing.ee123.net/img/rand?artid=146237096
image: https://bing.ee123.net/img/rand?artid=146237096
img: https://bing.ee123.net/img/rand?artid=146237096
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ardunio R4 WiFi连接实战
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="ardunio_WiFi_0">
     </a>
     ardunio WiFi连接模板
    </h2>
    <p>
     ardunio R4 WiFi 开发板有着不错的性能和板载内存，本机自带 WiFi 连接模块，可以完成简单的网络服务。对于这个小东西我情有独钟，也总希望能够用它来做些什么，所以先从 WiFi 连接开始学起，未来考虑一步一步为它接入大模型服务，做出一个小的桌面显示小玩具。
    </p>
    <h3>
     <a id="WiFiClient_http_3">
     </a>
     <code>
      WiFiClient
     </code>
     只能访问简单的http链接
    </h3>
    <p>
     ardunio R4 WiFi开发板依赖
     <code>
      WiFiS3.h
     </code>
     库进行网络连接。同时，最好新建一个保存密钥的头文件保存WiFi名称和密码。
    </p>
    <p>
     使用
     <code>
      WiFiClient
     </code>
     声明
     <code>
      client
     </code>
     对象，用于表示一个TCP/IP客户端（类似于网络套接字）。并声明WiFi连接状态
     <code>
      status
     </code>
     ，初始化为
     <code>
      WL_IDLE_STATUS
     </code>
     。
     <code>
      WifiS3
     </code>
     库内置如下几种WiFi连接状态：
    </p>
    <ul>
     <li>
      <code>
       WL_NO_SHIELD
      </code>
      ** / **
      <code>
       WL_NO_MODULE
      </code>
      ：没有检测到WiFi模块。
     </li>
     <li>
      <code>
       WL_IDLE_STATUS
      </code>
      ：WiFi模块处于空闲状态。
     </li>
     <li>
      <code>
       WL_NO_SSID_AVAIL
      </code>
      ：没有可用的SSID。
     </li>
     <li>
      <code>
       WL_SCAN_COMPLETED
      </code>
      ：WiFi扫描完成。
     </li>
     <li>
      <code>
       WL_CONNECTED
      </code>
      ：成功连接到WiFi网络。
     </li>
     <li>
      <code>
       WL_CONNECT_FAILED
      </code>
      ：连接失败。
     </li>
     <li>
      <code>
       WL_CONNECTION_LOST
      </code>
      ：连接丢失。
     </li>
     <li>
      <code>
       WL_DISCONNECTED
      </code>
      ：断开连接。
     </li>
     <li>
      <code>
       WL_AP_LISTENING
      </code>
      ：WiFi模块作为接入点监听中。
     </li>
     <li>
      <code>
       WL_AP_CONNECTED
      </code>
      ：设备已连接到WiFi模块作为接入点。
     </li>
     <li>
      <code>
       WL_AP_FAILED
      </code>
      ：接入点模式启动失败。
     </li>
    </ul>
    <pre><code class="prism language-cpp">WiFiClient client<span class="token punctuation">;</span>
<span class="token keyword">int</span> status <span class="token operator">=</span> WL_IDLE_STATUS<span class="token punctuation">;</span>
</code></pre>
    <p>
     之后在
     <code>
      setup
     </code>
     中配置网络连接初始化：声明波特率 → WiFi连接 → 尝试连接直到成功 → 打印IP。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connecting to WiFi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    WiFi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> pass<span class="token punctuation">)</span><span class="token punctuation">;</span>                          <span class="token comment">//WifiS3库已经内置WiFi全局变量，可以直接使用</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connected to WiFi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"IP Address: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">localIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="WiFiSSLClient_https_47">
     </a>
     <code>
      WiFiSSLClient
     </code>
     可以访问https安全链接
    </h3>
    <p>
     <code>
      WiFiClient
     </code>
     只能访问基础的http连接，想要允许 Arduino 设备通过 WiFi 网络与支持 SSL/TLS 加密的服务器建立安全连接，从而安全地发送和接收数据需要使用
     <code>
      WiFiSSLClient
     </code>
     类。它的使用方法和
     <code>
      WiFiClient
     </code>
     相似，只需改为声明
     <code>
      WiFiSSLClient client;
     </code>
     。
    </p>
    <p>
     为了向服务器发送请求，我们使用如下方式添加请求内容：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"connected to server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"GET / HTTP/1.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Host: www.google.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection: close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <code>
      client.connect(server, 443)
     </code>
     这行代码尝试通过TCP/IP协议连接到目标服务器的443端口（HTTPS默认端口）。如果连接成功，说明Arduino已经与网页服务器建立了通信通道。
    </p>
    <p>
     <code>
      client.println()
     </code>
     是用来向服务器发送HTTP请求，
     <code>
      GET / HTTP/1.1
     </code>
     <strong>
      表示请求根路径（
     </strong>
     <code>
      /
     </code>
     ）的内容，使用HTTP 1.1协议；**
     <code>
      Host: www.google.com
     </code>
     <strong>
      指定目标主机名；
     </strong>
     <code>
      Connection: close
     </code>
     **告诉服务器在响应完成后关闭连接。
    </p>
    <p>
     请求完成，我们可以使用如下方式查看服务器响应内容：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">read_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint32_t</span> received_data_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/* actual data reception */</span>
        <span class="token keyword">char</span> c <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* print data to serial port */</span>
        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* wrap data to 80 columns*/</span>
        received_data_num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>received_data_num <span class="token operator">%</span> <span class="token number">80</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     参考完整示例，访问少数派文章
     <a href="https://sspai.com/post/97248" rel="nofollow">
      为Claude桌面端集成tavily搜索 - 少数派
     </a>
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">/*
  TLS WiFi Web client - 访问少数派文章
  
  Board CA Root certificate bundle is embedded inside WiFi firmware:
  https://github.com/arduino/uno-r4-wifi-usb-bridge/blob/main/certificates/cacrt_all.pem
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"WiFiS3.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"WiFiSSLClient.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IPAddress.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"secret.h"</span></span>

<span class="token comment">///please enter your sensitive data in the Secret tab/arduino_secrets.h</span>
<span class="token keyword">char</span> ssid<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET_SSID<span class="token punctuation">;</span>        <span class="token comment">// your network SSID (name)</span>
<span class="token keyword">char</span> pass<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET_PASS<span class="token punctuation">;</span>        <span class="token comment">// your network password (use for WPA, or use as key for WEP)</span>

<span class="token keyword">int</span> status <span class="token operator">=</span> WL_IDLE_STATUS<span class="token punctuation">;</span>
<span class="token comment">// 修改为少数派网站</span>
<span class="token keyword">char</span> server<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"sspai.com"</span><span class="token punctuation">;</span>    <span class="token comment">// 少数派网站域名</span>

<span class="token comment">// Initialize the SSL client</span>
WiFiSSLClient client<span class="token punctuation">;</span>

<span class="token comment">/* -------------------------------------------------------------------------- */</span>
<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">/* -------------------------------------------------------------------------- */</span>
  <span class="token comment">//Initialize serial and wait for port to open:</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>Serial<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">;</span> <span class="token comment">// wait for serial port to connect. Needed for native USB port only</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// check for the WiFi module:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> WL_NO_MODULE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Communication with WiFi module failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// don't continue</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  String fv <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">firmwareVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fv <span class="token operator">&lt;</span> WIFI_FIRMWARE_LATEST_VERSION<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Please upgrade the firmware"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// attempt to connect to WiFi network:</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Attempting to connect to SSID: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ssid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Connect to WPA/WPA2 network.</span>
    status <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> pass<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// wait 10 seconds for connection:</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">printWifiStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\nStarting connection to sspai.com..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// if you get a connection, report back via serial:</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"connected to server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Make a HTTP request for the specific article:</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"GET /post/97248 HTTP/1.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Host: sspai.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"User-Agent: Mozilla/5.0 (compatible; Arduino/1.0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加更友好的User-Agent</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Accept: text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// 接受HTML内容</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection: close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection to server failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* just wrap the received data up to 80 columns in the serial print*/</span>
<span class="token comment">/* -------------------------------------------------------------------------- */</span>
<span class="token keyword">void</span> <span class="token function">read_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">/* -------------------------------------------------------------------------- */</span>
  <span class="token keyword">uint32_t</span> received_data_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* actual data reception */</span>
    <span class="token keyword">char</span> c <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* print data to serial port */</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* wrap data to 80 columns*/</span>
    received_data_num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>received_data_num <span class="token operator">%</span> <span class="token number">80</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* -------------------------------------------------------------------------- */</span>
<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">/* -------------------------------------------------------------------------- */</span>
  <span class="token function">read_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// if the server's disconnected, stop the client:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>client<span class="token punctuation">.</span><span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"disconnecting from server."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// do nothing forevermore:</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* -------------------------------------------------------------------------- */</span>
<span class="token keyword">void</span> <span class="token function">printWifiStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">/* -------------------------------------------------------------------------- */</span>
  <span class="token comment">// print the SSID of the network you're attached to:</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"SSID: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">SSID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// print your board's IP address:</span>
  IPAddress ip <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">localIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"IP Address: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// print the received signal strength:</span>
  <span class="token keyword">long</span> rssi <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">RSSI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"signal strength (RSSI):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>rssi<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dBm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     串口打印示例：
    </p>
    <pre><code class="prism language-plain">14:11:22.536 -&gt; SSID: ZTE_2AED09
14:11:22.536 -&gt; IP Address: 192.168.0.5
14:11:22.578 -&gt; signal strength (RSSI):-51 dBm
14:11:22.578 -&gt; 
14:11:22.578 -&gt; Starting connection to sspai.com...
14:11:23.804 -&gt; connected to server
14:11:24.536 -&gt; HTTP/1.1 200 OK
14:11:24.536 -&gt; Date: Thu, 13 Mar 2025 06:11:22 GMT
14:11:24.536 -&gt; Content-Type: text/html; c
14:11:24.536 -&gt; harset=utf-8
14:11:24.536 -&gt; Content-Length: 119824
14:11:24.536 -&gt; Connection: close
14:11:24.536 -&gt; Vary: Accept-Encoding
14:11:24.536 -&gt; 
14:11:24.536 -&gt; Cache-Control: no-store
14:11:24.536 -&gt; 
14:11:24.536 -&gt; &lt;!DOCTYPE html&gt;
14:11:24.536 -&gt; &lt;html lang="zh-CN" id="html"&gt;
14:11:24.536 -&gt; &lt;head&gt;
14:11:24.536 -&gt; 
14:11:24.536 -&gt;   &lt;meta charset="utf-8"&gt;
14:11:24.536 -&gt;   &lt;meta name="viewport" content="width=device-width, us
14:11:24.536 -&gt; er-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewpor
14:11:24.568 -&gt; t-fit=cover"&gt;
14:11:24.568 -&gt;   &lt;meta name="theme-color" content="" /&gt;
14:11:24.568 -&gt;   &lt;meta
14:11:24.568 -&gt;     http-equiv="C
14:11:24.568 -&gt; ontent-Security-Policy"
14:11:24.568 -&gt;     content="frame-src https://sspai.com https://*.sspai
14:11:24.568 -&gt; .com https://*.bilibili.com https://bilibili.com https://v.qq.com https://embed.
14:11:24.568 -&gt; music.apple.com https://jinshuju.net https://share.newsroom.apple;"
14:11:24.607 -&gt;   &gt;
14:11:24.607 -&gt;   &lt;meta 
14:11:24.607 -&gt; name="fragment" content="!"&gt;
14:11:24.607 -&gt;   &lt;link rel="shortcut icon" href="https://cdn-stati
14:11:24.607 -&gt; c.sspai.com/favicon/sspai.ico" type="image/x-icon" /&gt;
14:11:24.607 -&gt;   &lt;link rel="icon" href="h

...

14:11:48.951 -&gt;     var _hmt = _hmt || []
14:11:48.951 -&gt; ;
14:11:48.951 -&gt;     (function () {
14:11:48.951 -&gt;       var hm = document.createElement("script");
14:11:48.951 -&gt;       hm.s
14:11:48.951 -&gt; rc = "//hm.baidu.com/hm.js?92174dab8163cf598817a93d11d5c588";
14:11:48.984 -&gt;       var s = docu
14:11:48.984 -&gt; ment.getElementsByTagName("script")[0];
14:11:48.984 -&gt;       s.parentNode.insertBefore(hm, s);
14:11:48.984 -&gt; 
14:11:48.984 -&gt;     })();
14:11:48.984 -&gt; 
14:11:48.984 -&gt;   &lt;/script&gt;
14:11:48.984 -&gt;   &lt;!-- Baidu Push --&gt;
14:11:48.984 -&gt;   &lt;script&gt;
14:11:48.984 -&gt;     (function () {
14:11:48.984 -&gt;      
14:11:48.984 -&gt;  var bp = document.createElement('script');
14:11:48.984 -&gt;       var curProtocol = window.locat
14:11:48.984 -&gt; ion.protocol.split(':')[0];
14:11:48.984 -&gt;       if (curProtocol === 'https') {
14:11:48.984 -&gt;         bp.src 
14:11:48.984 -&gt; = 'https://zz.bdstatic.com/linksubmit/push.js';
14:11:48.984 -&gt;       } else {
14:11:49.025 -&gt;         bp.src = 
14:11:49.025 -&gt; 'http://push.zhanzhang.baidu.com/push.js';
14:11:49.025 -&gt;       }
14:11:49.025 -&gt;       var s = document.getEle
14:11:49.025 -&gt; mentsByTagName("script")[0];
14:11:49.058 -&gt;       s.parentNode.insertBefore(bp, s);
14:11:49.058 -&gt;     })();
14:11:49.058 -&gt;  
14:11:49.058 -&gt;  &lt;/script&gt;
14:11:49.058 -&gt; &lt;/body&gt;
14:11:49.058 -&gt; &lt;/html&gt;
14:11:49.058 -&gt; 
14:11:49.058 -&gt; disconnecting from server.
</code></pre>
    <h3>
     <a id="WiFiServerardunio_299">
     </a>
     <code>
      WiFiServer
     </code>
     把ardunio作为服务器
    </h3>
    <p>
     ardunio同样可以作为服务器使用，提供浏览器以http访问IP的能力。它的交互过层如下：
    </p>
    <ol>
     <li>
      浏览器（客户端）连接到Arduino的IP地址
     </li>
     <li>
      浏览器发送HTTP请求
     </li>
     <li>
      Arduino处理请求并返回网页内容
     </li>
     <li>
      浏览器接收内容并断开连接
     </li>
     <li>
      Arduino在串口打印“客户端断开连接”
     </li>
    </ol>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/68bbf80da815bbc7f572cb5a9ccc9bb3.jpeg"/>
    </p>
    <p>
     通过声明
     <code>
      WiFiServer server(80);
     </code>
     来定义服务器。之后，使用
     <code>
      server.begin();
     </code>
     启动服务器。主循环参考如下：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 检查是否有新的客户端连接</span>
    WiFiClient client <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"新客户连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// 用于存储当前读取的HTTP请求行</span>

        <span class="token comment">// 当客户端保持连接时持续处理</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 检查是否有数据可读</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 逐字符读取HTTP请求</span>
                <span class="token keyword">char</span> c <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Serial<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 将读取的字符输出到串口监视器</span>

                <span class="token comment">// 处理换行符</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 空行标志着HTTP请求头的结束</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentLine<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">sendHttpResponse</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送HTTP响应</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>                     <span class="token comment">// 退出处理循环</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>         <span class="token comment">// 重置当前行，准备读取下一行</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'\r'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>      <span class="token comment">// 忽略回车符</span>
                    currentLine <span class="token operator">+=</span> c<span class="token punctuation">;</span>           <span class="token comment">// 将字符添加到当前行</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 短暂延时确保数据传输完成</span>
        client<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 关闭客户端连接</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"客户端断开连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     当浏览器向ardunio发送请求时，ardunio服务器会向客户端发送HTTP响应，通过自定义的
     <code>
      sendHttpResponse
     </code>
     函数封装了这个响应，它具体如下：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">sendHttpResponse</span><span class="token punctuation">(</span>WiFiClient <span class="token operator">&amp;</span>client<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 发送HTTP头</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HTTP/1.1 200 OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Content-Type: text/html; charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection: close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 发送HTML内容</span>
    client<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>HTML_HEADER<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 可以在这里处理动态内容替换</span>
    String content <span class="token operator">=</span> HTML_CONTENT<span class="token punctuation">;</span>
    content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"%SERVER_TIME%"</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    client<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>HTML_FOOTER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       client.println("HTTP/1.1 200 OK");
      </code>
      ：这行代码发送HTTP状态行。 HTTP/1.1 表示使用的HTTP协议版本， 200 是状态码，代表请求已成功处理， OK 是状态码对应的文本描述。客户端收到这个状态行后，就知道请求已经成功处理。
     </li>
     <li>
      <code>
       client.println("Content-Type: text/html; charset=UTF-8");
      </code>
      ：这行代码发送 Content-Type 头部。它告诉客户端响应内容的类型是HTML，并且使用的字符编码是UTF - 8。这样客户端就能正确解析和显示响应内容。
     </li>
     <li>
      <code>
       client.println("Connection: close");
      </code>
      ：这行代码发送 Connection 头部。 close 表示在响应完成后，服务器会关闭与客户端的连接。这是一种常见的做法，特别是在处理简单的HTTP请求时。
     </li>
     <li>
      <code>
       client.println();
      </code>
      ：这行代码发送一个空行。在HTTP协议中，空行用于分隔头部和主体。发送空行后，后续发送的内容就是响应的主体部分了。
     </li>
    </ul>
    <p>
     服务器完整示例如下
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"WiFiS3.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IPAddress.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"secret.h"</span> <span class="token comment">// 确保创建此文件</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"html_content.h"</span></span>

<span class="token comment">// 在arduino_secrets.h中定义您的网络凭据</span>
<span class="token comment">// #define SECRET_SSID "ZTE_2AED09" </span>
<span class="token comment">// #define SECRET_PASS "您的密码"</span>
<span class="token keyword">char</span> ssid<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET_SSID<span class="token punctuation">;</span>
<span class="token keyword">char</span> pass<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET_PASS<span class="token punctuation">;</span>

<span class="token keyword">int</span> status <span class="token operator">=</span> WL_IDLE_STATUS<span class="token punctuation">;</span>
WiFiServer <span class="token function">server</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化串口通信</span>
    Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>Serial<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">;</span> <span class="token comment">// 等待串口连接</span>
    <span class="token punctuation">}</span>

    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Arduino Web Server启动"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 检查WiFi模块</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> WL_NO_MODULE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WiFi模块通信失败!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不继续</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 检查固件版本</span>
    String fv <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">firmwareVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"WiFi固件版本: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fv <span class="token operator">&lt;</span> WIFI_FIRMWARE_LATEST_VERSION<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"请升级固件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 连接到WiFi网络</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"尝试连接到SSID: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ssid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 连接到WPA/WPA2网络</span>
        status <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> pass<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 等待10秒连接</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 打印WiFi状态</span>
    <span class="token function">printWifiStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 启动服务器</span>
    server<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"服务器已启动"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 检查是否有新的客户端连接</span>
    WiFiClient client <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"新客户连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// 用于存储当前读取的HTTP请求行</span>

        <span class="token comment">// 当客户端保持连接时持续处理</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 检查是否有数据可读</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 逐字符读取HTTP请求</span>
                <span class="token keyword">char</span> c <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Serial<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 将读取的字符输出到串口监视器</span>

                <span class="token comment">// 处理换行符</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 空行标志着HTTP请求头的结束</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentLine<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">sendHttpResponse</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送HTTP响应</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>                     <span class="token comment">// 退出处理循环</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>         <span class="token comment">// 重置当前行，准备读取下一行</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'\r'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>      <span class="token comment">// 忽略回车符</span>
                    currentLine <span class="token operator">+=</span> c<span class="token punctuation">;</span>           <span class="token comment">// 将字符添加到当前行</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 短暂延时确保数据传输完成</span>
        client<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 关闭客户端连接</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"客户端断开连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">sendHttpResponse</span><span class="token punctuation">(</span>WiFiClient <span class="token operator">&amp;</span>client<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 发送HTTP头</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HTTP/1.1 200 OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Content-Type: text/html; charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection: close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 发送HTML内容</span>
    client<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>HTML_HEADER<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 可以在这里处理动态内容替换</span>
    String content <span class="token operator">=</span> HTML_CONTENT<span class="token punctuation">;</span>
    content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"%SERVER_TIME%"</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    client<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>HTML_FOOTER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">printWifiStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 打印SSID</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"SSID: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">SSID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印IP地址</span>
    IPAddress ip <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">localIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"IP Address: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印信号强度</span>
    <span class="token keyword">long</span> rssi <span class="token operator">=</span> WiFi<span class="token punctuation">.</span><span class="token function">RSSI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"signal strength (RSSI):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>rssi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" dBm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 显示访问链接</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"在浏览器中访问 http://"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     http网页
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">HTML_CONTENT_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HTML_CONTENT_H</span></span>

<span class="token comment">// HTML头部</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> HTML_HEADER<span class="token punctuation">[</span><span class="token punctuation">]</span> PROGMEM <span class="token operator">=</span> <span class="token raw-string string">R"rawliteral(
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Arduino Web服务器&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
      background-color: #f0f0f0;
    }
    h1 {
      color: #0066cc;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="container"&gt;
)rawliteral"</span><span class="token punctuation">;</span>

<span class="token comment">// 主要内容</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> HTML_CONTENT<span class="token punctuation">[</span><span class="token punctuation">]</span> PROGMEM <span class="token operator">=</span> <span class="token raw-string string">R"rawliteral(
    &lt;h1&gt;Arduino Web服务器&lt;/h1&gt;
    &lt;p&gt;欢迎访问Arduino UNO R4 WiFi服务器!&lt;/p&gt;
    &lt;p&gt;服务器运行正常&lt;/p&gt;
    &lt;p&gt;当前时间: &lt;span id="server-time"&gt;%SERVER_TIME%&lt;/span&gt;&lt;/p&gt;
)rawliteral"</span><span class="token punctuation">;</span>

<span class="token comment">// 底部</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> HTML_FOOTER<span class="token punctuation">[</span><span class="token punctuation">]</span> PROGMEM <span class="token operator">=</span> <span class="token raw-string string">R"rawliteral(
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
)rawliteral"</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre>
    <p>
     串口打印
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a4f6355244bcbea04c667c3790ffba29.jpeg"/>
    </p>
    <p>
     打开浏览器，访问
     <a href="http://192.168.0.5" rel="nofollow">
      http://192.168.0.5
     </a>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b8719b6a2dd3d7c4ca4267906b47b616.jpeg"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353033383339372f:61727469636c652f64657461696c732f313436323337303936" class_="artid" style="display:none">
 </p>
</div>


