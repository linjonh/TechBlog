---
layout: post
title: "GoGo-MongoDB-快速入门"
date: 2025-03-13 18:30:39 +0800
description: "详细介绍了如何使用Go驱动程序操作MongoDB数据库，包括基本的增删改查操作以及使用and、or、in操作符进行高阶查询"
keywords: "【Go】Go MongoDB 快速入门"
categories: ['Golang']
tags: ['开发语言', 'Mongodb', 'Golang']
artid: "146239323"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146239323
    alt: "GoGo-MongoDB-快速入门"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146239323
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146239323
cover: https://bing.ee123.net/img/rand?artid=146239323
image: https://bing.ee123.net/img/rand?artid=146239323
img: https://bing.ee123.net/img/rand?artid=146239323
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Go】Go MongoDB 快速入门
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1_MongoDB__0">
     </a>
     1. MongoDB 简介
    </h3>
    <h4>
     <a id="11_MongoDB__1">
     </a>
     1.1 MongoDB 介绍
    </h4>
    <p>
     由于我们时常需要存储一些大文本数据（比如文章内容），存储到一些关系型数据库可能不是最好的选择，这个时候就需要引入一些 NoSQL（Not Only SQL），比如 MongoDB 等数据库，NoSQL 主要用于解决大规模数据集合、多种数据格式等大数据相关问题，在实践中可以理解为用关系型数据库不好解决的就可以考虑使用 NoSQL
    </p>
    <blockquote>
     <p>
      ⭐ MongoDB 官方文档：
      <a href="https://www.mongodb.com/zh-cn/docs/" rel="nofollow">
       https://www.mongodb.com/zh-cn/docs/
      </a>
     </p>
    </blockquote>
    <h4>
     <a id="12_MongoDB__7">
     </a>
     1.2 MongoDB 基本特性
    </h4>
    <p>
     MongoDB 主要有以下几点特性：
    </p>
    <ul>
     <li>
      <strong>
       面向集合存储
      </strong>
      ：一个集合可以近似理解为 MySQL 当中的表；集合中存储了很多文档，可以近似理解为 MySQL 当中的数据行
     </li>
     <li>
      <strong>
       模式自由
      </strong>
      ：MongoDB 采用无模式结构存储数据，意味着可以不用像 MySQL 那样预先定义表结构
     </li>
     <li>
      <strong>
       扩展性强
      </strong>
      ：MongoDB 内部支持分片功能，便于进行横向扩展
     </li>
    </ul>
    <p>
     总结下来，为什么我们在技术选型的时候考虑使用 MongoDB，主要是以下两方面原因：
    </p>
    <ol>
     <li>
      <strong>
       灵活的文档模型
      </strong>
      ：不需要预先定义文档结构，即可插入数据
     </li>
     <li>
      <strong>
       便于横向扩展
      </strong>
      ：可以通过增加 MongoDB 实例来应对数据增长
     </li>
    </ol>
    <h3>
     <a id="2_MongoDB__19">
     </a>
     2. MongoDB 安装
    </h3>
    <p>
     本次我们通过使用 Docker 的方式来启动 MongoDB，在项目中编写如下
     <code>
      docker-compose.yaml
     </code>
     文件
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">:</span><span class="token number">6.0</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MONGO_INITDB_ROOT_USERNAME</span><span class="token punctuation">:</span> root
      <span class="token key atrule">MONGO_INITDB_ROOT_PASSWORD</span><span class="token punctuation">:</span> example
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 27017<span class="token punctuation">:</span><span class="token number">27017</span>
</code></pre>
    <p>
     然后在命令行中输入
     <code>
      docker compose up
     </code>
     即可启动
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a0da1dbd414b3eb10a43d02a6fcbe7f4.png"/>
    </p>
    <p>
     看到如上图所示内容证明 MongoDB 启动成功！
    </p>
    <h3>
     <a id="3_MongoDB__40">
     </a>
     3. MongoDB 快速入门
    </h3>
    <h4>
     <a id="31__41">
     </a>
     3.1 初始化客户端
    </h4>
    <p>
     初始化客户端主要分为以下步骤：
    </p>
    <ol>
     <li>
      创建配置对象：使用
      <code>
       options.Client().ApplyURI()
      </code>
      并传入连接地址字符串
     </li>
     <li>
      创建客户端连接：使用
      <code>
       mongo.Connect
      </code>
      方法并传入配置对象
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"context"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/v2/event"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/v2/mongo"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/v2/mongo/options"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 准备命令监视器</span>
    monitor <span class="token operator">:=</span> <span class="token operator">&amp;</span>event<span class="token punctuation">.</span>CommandMonitor<span class="token punctuation">{<!-- --></span>
        Started<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> startedEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandStartedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 输出查询命令</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>startedEvent<span class="token punctuation">.</span>Command<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Succeeded<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> succeededEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandSucceededEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        Failed<span class="token punctuation">:</span>    <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> errEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandFailedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. 设置连接地址</span>
    opts <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ApplyURI</span><span class="token punctuation">(</span><span class="token string">"mongodb://root:example@127.0.0.1:27017"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetMonitor</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span>
    client<span class="token punctuation">,</span> err <span class="token operator">:=</span> mongo<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 创建database和collection</span>
    col <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">"webook"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span><span class="token string">"articles"</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="32__80">
     </a>
     3.2 插入文档
    </h4>
    <p>
     在上一小节初始化客户端的基础上，我们就可以使用得到的客户端client对象来操作 MongoDB 了：
    </p>
    <p>
     插入文档的 API 为：
     <code>
      col.InsertOne()
     </code>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 1. 准备命令监视器</span>
	monitor <span class="token operator">:=</span> <span class="token operator">&amp;</span>event<span class="token punctuation">.</span>CommandMonitor<span class="token punctuation">{<!-- --></span>
		Started<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> startedEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandStartedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 输出查询命令</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>startedEvent<span class="token punctuation">.</span>Command<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		Succeeded<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> succeededEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandSucceededEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		Failed<span class="token punctuation">:</span>    <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> errEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandFailedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 2. 设置连接地址</span>
	opts <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ApplyURI</span><span class="token punctuation">(</span><span class="token string">"mongodb://root:example@127.0.0.1:27017"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetMonitor</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span>
	client<span class="token punctuation">,</span> err <span class="token operator">:=</span> mongo<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 3. 创建database和collection</span>
	col <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">"webook"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span><span class="token string">"articles"</span><span class="token punctuation">)</span>
	<span class="token comment">// 4. 插入文档</span>
	ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	result<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span>       <span class="token number">1</span><span class="token punctuation">,</span>
		Title<span class="token punctuation">:</span>    <span class="token string">"我的标题"</span><span class="token punctuation">,</span>
		Content<span class="token punctuation">:</span>  <span class="token string">"我的内容"</span><span class="token punctuation">,</span>
		AuthorId<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		Status<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
		Ctime<span class="token punctuation">:</span>    <span class="token number">123</span><span class="token punctuation">,</span>
		Utime<span class="token punctuation">:</span>    <span class="token number">456</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 这里的InsertedID为文档ID</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>InsertedID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Article 文章结构体</span>
<span class="token keyword">type</span> Article <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Id       <span class="token builtin">int64</span>
	Title    <span class="token builtin">string</span>
	Content  <span class="token builtin">string</span>
	AuthorId <span class="token builtin">int64</span>
	Status   <span class="token builtin">uint8</span>
	Ctime    <span class="token builtin">int64</span>
	Utime    <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     程序运行结果如下：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b4a408366c6c8a6cbf9cd984716a7660.png"/>
    </p>
    <blockquote>
     <p>
      💡 温馨提示：但是 MongoDB 没有自增主键的概念，因此 InsertedID 是文档ID对应的字符串
     </p>
    </blockquote>
    <h4>
     <a id="33__141">
     </a>
     3.3 查询文档
    </h4>
    <p>
     插入文档的 API 有如下两种方式：
    </p>
    <ol>
     <li>
      通过
      <code>
       bson
      </code>
      结构来构造查询条件：
     </li>
     <li>
      通过结构体对象进行查询（需要小心零值问题）
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... 省略前面代码</span>
	<span class="token comment">// 5.1 通过bson查询文档</span>
	filter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token keyword">var</span> art Article
	err <span class="token operator">=</span> col<span class="token punctuation">.</span><span class="token function">FindOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>art<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>art<span class="token punctuation">)</span>
	<span class="token comment">// 5.2 通过结构体查询文档</span>
	<span class="token keyword">var</span> art2 Article
	err <span class="token operator">=</span> col<span class="token punctuation">.</span><span class="token function">FindOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>art2<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">==</span> mongo<span class="token punctuation">.</span>ErrNoDocuments <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"文档未找到! %w"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>art2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Article 文章结构体</span>
<span class="token keyword">type</span> Article <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Id       <span class="token builtin">int64</span>  <span class="token string">`bson:"id,omitempty"`</span>
	Title    <span class="token builtin">string</span> <span class="token string">`bson:"title,omitempty"`</span>
	Content  <span class="token builtin">string</span> <span class="token string">`bson:"content,omitempty"`</span>
	AuthorId <span class="token builtin">int64</span>  <span class="token string">`bson:"author_id,omitempty"`</span>
	Status   <span class="token builtin">uint8</span>  <span class="token string">`bson:"status,omitempty"`</span>
	Ctime    <span class="token builtin">int64</span>  <span class="token string">`bson:"ctime,omitempty"`</span>
	Utime    <span class="token builtin">int64</span>  <span class="token string">`bson:"utime,omitempty"`</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     程序运行结果如下：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e13eb9b285189e6762977a0c205aa3f0.png"/>
    </p>
    <blockquote>
     <p>
      💡 温馨提示：如果使用 结构体对象作为查询条件，则需要在结构体标签处加上
      <code>
       omitempty
      </code>
      参数，表示如果为零值不参与到过滤条件中
     </p>
    </blockquote>
    <h4>
     <a id="34__189">
     </a>
     3.4 修改文档
    </h4>
    <p>
     修改文档的 API 也跟查询一样有如下两种方式：
    </p>
    <p>
     case1：构造过滤查询条件
    </p>
    <p>
     case2：构造更新对象
    </p>
    <pre><code>1. 通过`bson`结构来构造修改条件：
2. 通过结构体对象进行修改（需要小心零值问题）
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 省略上述代码</span>
	<span class="token comment">// 6. 修改文档</span>
	upDoc <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$set"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> Article<span class="token punctuation">{<!-- --></span>
		Title<span class="token punctuation">:</span>   <span class="token string">"新的标题"</span><span class="token punctuation">,</span>
		Content<span class="token punctuation">:</span> <span class="token string">"新的内容"</span><span class="token punctuation">,</span>
		Utime<span class="token punctuation">:</span>   <span class="token number">789</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">UpdateOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> filter<span class="token punctuation">,</span> upDoc<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>ModifiedCount<span class="token punctuation">)</span> <span class="token comment">// 修改数量</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      💡 温馨提示：这里的"$set"是 MongoDB 独有的操作符
     </p>
    </blockquote>
    <h4>
     <a id="35__219">
     </a>
     3.5 删除文档
    </h4>
    <p>
     删除文档的方式和查找是一样的，只需要定义过滤条件即可：
    </p>
    <p>
     这里直接贴代码：
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 省略上述代码</span>
	<span class="token comment">// 7. 删除文档</span>
	delFilter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	delResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">DeleteOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> delFilter<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>delResult<span class="token punctuation">.</span>DeletedCount<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     程序运行结果：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9587d1a5e20ce2198dcc918274c18a7d.png"/>
    </p>
    <h3>
     <a id="4_MongoDB__241">
     </a>
     4. MongoDB 进阶查询
    </h3>
    <h4>
     <a id="41_or_242">
     </a>
     4.1 构造or查询条件
    </h4>
    <p>
     首先我个人的一个结论就是：在使用 MongoDB 构造查询结构体时，最外层一定是 bson.D 的结构
    </p>
    <p>
     下面为使用 or 查询的方式（对于初学者而言不需要关心如何构造，跟着抄就行）
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 省略上述代码</span>
	ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 插入id=1,2,3的记录</span>
	col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 构造or查询条件</span>
	filter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>A<span class="token punctuation">{<!-- --></span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 查询id为1或者2的记录</span>
	find<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$or"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> filter<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> articles <span class="token punctuation">[</span><span class="token punctuation">]</span>Article
	err <span class="token operator">=</span> find<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     程序运行结果：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/ca8f94228c8fb2e3b9ffb20556484847.png"/>
    </p>
    <h4>
     <a id="42_and_281">
     </a>
     4.2 构造and查询条件
    </h4>
    <p>
     下面为使用 and 查询的方式（对于初学者而言不需要关心如何构造，跟着抄就行）
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 构造and查询条件</span>
	andFilter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>A<span class="token punctuation">{<!-- --></span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"title"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token string">"我的标题"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$and"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> andFilter<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	err <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     程序运行结果：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/74cfa8d49aefb32d872490fe84c7a2bb.png"/>
    </p>
    <h4>
     <a id="43_in_307">
     </a>
     4.3 构造in查询条件
    </h4>
    <p>
     下面为使用 in 查询的方式（对于初学者而言不需要关心如何构造，跟着抄就行）
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 省略上述代码</span>
	<span class="token keyword">var</span> articles <span class="token punctuation">[</span><span class="token punctuation">]</span>Article
	<span class="token comment">// 构造in查询条件</span>
	inFilter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>
		bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>
			Key<span class="token punctuation">:</span>   <span class="token string">"id"</span><span class="token punctuation">,</span>
			Value<span class="token punctuation">:</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$in"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> inFilter<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	err <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     程序运行结果：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0367f072d7f2ead754e265eadbe0f9e8.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36323533333230312f:61727469636c652f64657461696c732f313436323339333233" class_="artid" style="display:none">
 </p>
</div>


