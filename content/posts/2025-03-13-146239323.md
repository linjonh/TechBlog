---
layout: post
title: "GoGo-MongoDB-å¿«é€Ÿå…¥é—¨"
date: 2025-03-13 18:30:39 +0800
description: "è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Goé©±åŠ¨ç¨‹åºæ“ä½œMongoDBæ•°æ®åº“ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ“ä½œä»¥åŠä½¿ç”¨andã€orã€inæ“ä½œç¬¦è¿›è¡Œé«˜é˜¶æŸ¥è¯¢"
keywords: "ã€Goã€‘Go MongoDB å¿«é€Ÿå…¥é—¨"
categories: ['Golang']
tags: ['å¼€å‘è¯­è¨€', 'Mongodb', 'Golang']
artid: "146239323"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146239323
    alt: "GoGo-MongoDB-å¿«é€Ÿå…¥é—¨"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146239323
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146239323
cover: https://bing.ee123.net/img/rand?artid=146239323
image: https://bing.ee123.net/img/rand?artid=146239323
img: https://bing.ee123.net/img/rand?artid=146239323
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ã€Goã€‘Go MongoDB å¿«é€Ÿå…¥é—¨
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="1_MongoDB__0">
     </a>
     1. MongoDB ç®€ä»‹
    </h3>
    <h4>
     <a id="11_MongoDB__1">
     </a>
     1.1 MongoDB ä»‹ç»
    </h4>
    <p>
     ç”±äºæˆ‘ä»¬æ—¶å¸¸éœ€è¦å­˜å‚¨ä¸€äº›å¤§æ–‡æœ¬æ•°æ®ï¼ˆæ¯”å¦‚æ–‡ç« å†…å®¹ï¼‰ï¼Œå­˜å‚¨åˆ°ä¸€äº›å…³ç³»å‹æ•°æ®åº“å¯èƒ½ä¸æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•å…¥ä¸€äº› NoSQLï¼ˆNot Only SQLï¼‰ï¼Œæ¯”å¦‚ MongoDB ç­‰æ•°æ®åº“ï¼ŒNoSQL ä¸»è¦ç”¨äºè§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆã€å¤šç§æ•°æ®æ ¼å¼ç­‰å¤§æ•°æ®ç›¸å…³é—®é¢˜ï¼Œåœ¨å®è·µä¸­å¯ä»¥ç†è§£ä¸ºç”¨å…³ç³»å‹æ•°æ®åº“ä¸å¥½è§£å†³çš„å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ NoSQL
    </p>
    <blockquote>
     <p>
      â­ MongoDB å®˜æ–¹æ–‡æ¡£ï¼š
      <a href="https://www.mongodb.com/zh-cn/docs/" rel="nofollow">
       https://www.mongodb.com/zh-cn/docs/
      </a>
     </p>
    </blockquote>
    <h4>
     <a id="12_MongoDB__7">
     </a>
     1.2 MongoDB åŸºæœ¬ç‰¹æ€§
    </h4>
    <p>
     MongoDB ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š
    </p>
    <ul>
     <li>
      <strong>
       é¢å‘é›†åˆå­˜å‚¨
      </strong>
      ï¼šä¸€ä¸ªé›†åˆå¯ä»¥è¿‘ä¼¼ç†è§£ä¸º MySQL å½“ä¸­çš„è¡¨ï¼›é›†åˆä¸­å­˜å‚¨äº†å¾ˆå¤šæ–‡æ¡£ï¼Œå¯ä»¥è¿‘ä¼¼ç†è§£ä¸º MySQL å½“ä¸­çš„æ•°æ®è¡Œ
     </li>
     <li>
      <strong>
       æ¨¡å¼è‡ªç”±
      </strong>
      ï¼šMongoDB é‡‡ç”¨æ— æ¨¡å¼ç»“æ„å­˜å‚¨æ•°æ®ï¼Œæ„å‘³ç€å¯ä»¥ä¸ç”¨åƒ MySQL é‚£æ ·é¢„å…ˆå®šä¹‰è¡¨ç»“æ„
     </li>
     <li>
      <strong>
       æ‰©å±•æ€§å¼º
      </strong>
      ï¼šMongoDB å†…éƒ¨æ”¯æŒåˆ†ç‰‡åŠŸèƒ½ï¼Œä¾¿äºè¿›è¡Œæ¨ªå‘æ‰©å±•
     </li>
    </ul>
    <p>
     æ€»ç»“ä¸‹æ¥ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æŠ€æœ¯é€‰å‹çš„æ—¶å€™è€ƒè™‘ä½¿ç”¨ MongoDBï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤æ–¹é¢åŸå› ï¼š
    </p>
    <ol>
     <li>
      <strong>
       çµæ´»çš„æ–‡æ¡£æ¨¡å‹
      </strong>
      ï¼šä¸éœ€è¦é¢„å…ˆå®šä¹‰æ–‡æ¡£ç»“æ„ï¼Œå³å¯æ’å…¥æ•°æ®
     </li>
     <li>
      <strong>
       ä¾¿äºæ¨ªå‘æ‰©å±•
      </strong>
      ï¼šå¯ä»¥é€šè¿‡å¢åŠ  MongoDB å®ä¾‹æ¥åº”å¯¹æ•°æ®å¢é•¿
     </li>
    </ol>
    <h3>
     <a id="2_MongoDB__19">
     </a>
     2. MongoDB å®‰è£…
    </h3>
    <p>
     æœ¬æ¬¡æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ Docker çš„æ–¹å¼æ¥å¯åŠ¨ MongoDBï¼Œåœ¨é¡¹ç›®ä¸­ç¼–å†™å¦‚ä¸‹
     <code>
      docker-compose.yaml
     </code>
     æ–‡ä»¶
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">:</span><span class="token number">6.0</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MONGO_INITDB_ROOT_USERNAME</span><span class="token punctuation">:</span> root
      <span class="token key atrule">MONGO_INITDB_ROOT_PASSWORD</span><span class="token punctuation">:</span> example
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 27017<span class="token punctuation">:</span><span class="token number">27017</span>
</code></pre>
    <p>
     ç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥
     <code>
      docker compose up
     </code>
     å³å¯å¯åŠ¨
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a0da1dbd414b3eb10a43d02a6fcbe7f4.png"/>
    </p>
    <p>
     çœ‹åˆ°å¦‚ä¸Šå›¾æ‰€ç¤ºå†…å®¹è¯æ˜ MongoDB å¯åŠ¨æˆåŠŸï¼
    </p>
    <h3>
     <a id="3_MongoDB__40">
     </a>
     3. MongoDB å¿«é€Ÿå…¥é—¨
    </h3>
    <h4>
     <a id="31__41">
     </a>
     3.1 åˆå§‹åŒ–å®¢æˆ·ç«¯
    </h4>
    <p>
     åˆå§‹åŒ–å®¢æˆ·ç«¯ä¸»è¦åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š
    </p>
    <ol>
     <li>
      åˆ›å»ºé…ç½®å¯¹è±¡ï¼šä½¿ç”¨
      <code>
       options.Client().ApplyURI()
      </code>
      å¹¶ä¼ å…¥è¿æ¥åœ°å€å­—ç¬¦ä¸²
     </li>
     <li>
      åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥ï¼šä½¿ç”¨
      <code>
       mongo.Connect
      </code>
      æ–¹æ³•å¹¶ä¼ å…¥é…ç½®å¯¹è±¡
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"context"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/v2/event"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/v2/mongo"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/v2/mongo/options"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. å‡†å¤‡å‘½ä»¤ç›‘è§†å™¨</span>
    monitor <span class="token operator">:=</span> <span class="token operator">&amp;</span>event<span class="token punctuation">.</span>CommandMonitor<span class="token punctuation">{<!-- --></span>
        Started<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> startedEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandStartedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// è¾“å‡ºæŸ¥è¯¢å‘½ä»¤</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>startedEvent<span class="token punctuation">.</span>Command<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Succeeded<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> succeededEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandSucceededEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        Failed<span class="token punctuation">:</span>    <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> errEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandFailedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2. è®¾ç½®è¿æ¥åœ°å€</span>
    opts <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ApplyURI</span><span class="token punctuation">(</span><span class="token string">"mongodb://root:example@127.0.0.1:27017"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetMonitor</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span>
    client<span class="token punctuation">,</span> err <span class="token operator">:=</span> mongo<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. åˆ›å»ºdatabaseå’Œcollection</span>
    col <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">"webook"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span><span class="token string">"articles"</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="32__80">
     </a>
     3.2 æ’å…¥æ–‡æ¡£
    </h4>
    <p>
     åœ¨ä¸Šä¸€å°èŠ‚åˆå§‹åŒ–å®¢æˆ·ç«¯çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¾—åˆ°çš„å®¢æˆ·ç«¯clientå¯¹è±¡æ¥æ“ä½œ MongoDB äº†ï¼š
    </p>
    <p>
     æ’å…¥æ–‡æ¡£çš„ API ä¸ºï¼š
     <code>
      col.InsertOne()
     </code>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 1. å‡†å¤‡å‘½ä»¤ç›‘è§†å™¨</span>
	monitor <span class="token operator">:=</span> <span class="token operator">&amp;</span>event<span class="token punctuation">.</span>CommandMonitor<span class="token punctuation">{<!-- --></span>
		Started<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> startedEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandStartedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// è¾“å‡ºæŸ¥è¯¢å‘½ä»¤</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>startedEvent<span class="token punctuation">.</span>Command<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		Succeeded<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> succeededEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandSucceededEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		Failed<span class="token punctuation">:</span>    <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> errEvent <span class="token operator">*</span>event<span class="token punctuation">.</span>CommandFailedEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 2. è®¾ç½®è¿æ¥åœ°å€</span>
	opts <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ApplyURI</span><span class="token punctuation">(</span><span class="token string">"mongodb://root:example@127.0.0.1:27017"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetMonitor</span><span class="token punctuation">(</span>monitor<span class="token punctuation">)</span>
	client<span class="token punctuation">,</span> err <span class="token operator">:=</span> mongo<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 3. åˆ›å»ºdatabaseå’Œcollection</span>
	col <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Database</span><span class="token punctuation">(</span><span class="token string">"webook"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span><span class="token string">"articles"</span><span class="token punctuation">)</span>
	<span class="token comment">// 4. æ’å…¥æ–‡æ¡£</span>
	ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	result<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span>       <span class="token number">1</span><span class="token punctuation">,</span>
		Title<span class="token punctuation">:</span>    <span class="token string">"æˆ‘çš„æ ‡é¢˜"</span><span class="token punctuation">,</span>
		Content<span class="token punctuation">:</span>  <span class="token string">"æˆ‘çš„å†…å®¹"</span><span class="token punctuation">,</span>
		AuthorId<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
		Status<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
		Ctime<span class="token punctuation">:</span>    <span class="token number">123</span><span class="token punctuation">,</span>
		Utime<span class="token punctuation">:</span>    <span class="token number">456</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// è¿™é‡Œçš„InsertedIDä¸ºæ–‡æ¡£ID</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>InsertedID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Article æ–‡ç« ç»“æ„ä½“</span>
<span class="token keyword">type</span> Article <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Id       <span class="token builtin">int64</span>
	Title    <span class="token builtin">string</span>
	Content  <span class="token builtin">string</span>
	AuthorId <span class="token builtin">int64</span>
	Status   <span class="token builtin">uint8</span>
	Ctime    <span class="token builtin">int64</span>
	Utime    <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b4a408366c6c8a6cbf9cd984716a7660.png"/>
    </p>
    <blockquote>
     <p>
      ğŸ’¡ æ¸©é¦¨æç¤ºï¼šä½†æ˜¯ MongoDB æ²¡æœ‰è‡ªå¢ä¸»é”®çš„æ¦‚å¿µï¼Œå› æ­¤ InsertedID æ˜¯æ–‡æ¡£IDå¯¹åº”çš„å­—ç¬¦ä¸²
     </p>
    </blockquote>
    <h4>
     <a id="33__141">
     </a>
     3.3 æŸ¥è¯¢æ–‡æ¡£
    </h4>
    <p>
     æ’å…¥æ–‡æ¡£çš„ API æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š
    </p>
    <ol>
     <li>
      é€šè¿‡
      <code>
       bson
      </code>
      ç»“æ„æ¥æ„é€ æŸ¥è¯¢æ¡ä»¶ï¼š
     </li>
     <li>
      é€šè¿‡ç»“æ„ä½“å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ï¼ˆéœ€è¦å°å¿ƒé›¶å€¼é—®é¢˜ï¼‰
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ... çœç•¥å‰é¢ä»£ç </span>
	<span class="token comment">// 5.1 é€šè¿‡bsonæŸ¥è¯¢æ–‡æ¡£</span>
	filter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token keyword">var</span> art Article
	err <span class="token operator">=</span> col<span class="token punctuation">.</span><span class="token function">FindOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>art<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>art<span class="token punctuation">)</span>
	<span class="token comment">// 5.2 é€šè¿‡ç»“æ„ä½“æŸ¥è¯¢æ–‡æ¡£</span>
	<span class="token keyword">var</span> art2 Article
	err <span class="token operator">=</span> col<span class="token punctuation">.</span><span class="token function">FindOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>art2<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">==</span> mongo<span class="token punctuation">.</span>ErrNoDocuments <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æ–‡æ¡£æœªæ‰¾åˆ°! %w"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>art2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Article æ–‡ç« ç»“æ„ä½“</span>
<span class="token keyword">type</span> Article <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Id       <span class="token builtin">int64</span>  <span class="token string">`bson:"id,omitempty"`</span>
	Title    <span class="token builtin">string</span> <span class="token string">`bson:"title,omitempty"`</span>
	Content  <span class="token builtin">string</span> <span class="token string">`bson:"content,omitempty"`</span>
	AuthorId <span class="token builtin">int64</span>  <span class="token string">`bson:"author_id,omitempty"`</span>
	Status   <span class="token builtin">uint8</span>  <span class="token string">`bson:"status,omitempty"`</span>
	Ctime    <span class="token builtin">int64</span>  <span class="token string">`bson:"ctime,omitempty"`</span>
	Utime    <span class="token builtin">int64</span>  <span class="token string">`bson:"utime,omitempty"`</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e13eb9b285189e6762977a0c205aa3f0.png"/>
    </p>
    <blockquote>
     <p>
      ğŸ’¡ æ¸©é¦¨æç¤ºï¼šå¦‚æœä½¿ç”¨ ç»“æ„ä½“å¯¹è±¡ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œåˆ™éœ€è¦åœ¨ç»“æ„ä½“æ ‡ç­¾å¤„åŠ ä¸Š
      <code>
       omitempty
      </code>
      å‚æ•°ï¼Œè¡¨ç¤ºå¦‚æœä¸ºé›¶å€¼ä¸å‚ä¸åˆ°è¿‡æ»¤æ¡ä»¶ä¸­
     </p>
    </blockquote>
    <h4>
     <a id="34__189">
     </a>
     3.4 ä¿®æ”¹æ–‡æ¡£
    </h4>
    <p>
     ä¿®æ”¹æ–‡æ¡£çš„ API ä¹Ÿè·ŸæŸ¥è¯¢ä¸€æ ·æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š
    </p>
    <p>
     case1ï¼šæ„é€ è¿‡æ»¤æŸ¥è¯¢æ¡ä»¶
    </p>
    <p>
     case2ï¼šæ„é€ æ›´æ–°å¯¹è±¡
    </p>
    <pre><code>1. é€šè¿‡`bson`ç»“æ„æ¥æ„é€ ä¿®æ”¹æ¡ä»¶ï¼š
2. é€šè¿‡ç»“æ„ä½“å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼ˆéœ€è¦å°å¿ƒé›¶å€¼é—®é¢˜ï¼‰
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// çœç•¥ä¸Šè¿°ä»£ç </span>
	<span class="token comment">// 6. ä¿®æ”¹æ–‡æ¡£</span>
	upDoc <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$set"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> Article<span class="token punctuation">{<!-- --></span>
		Title<span class="token punctuation">:</span>   <span class="token string">"æ–°çš„æ ‡é¢˜"</span><span class="token punctuation">,</span>
		Content<span class="token punctuation">:</span> <span class="token string">"æ–°çš„å†…å®¹"</span><span class="token punctuation">,</span>
		Utime<span class="token punctuation">:</span>   <span class="token number">789</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">UpdateOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> filter<span class="token punctuation">,</span> upDoc<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>ModifiedCount<span class="token punctuation">)</span> <span class="token comment">// ä¿®æ”¹æ•°é‡</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      ğŸ’¡ æ¸©é¦¨æç¤ºï¼šè¿™é‡Œçš„"$set"æ˜¯ MongoDB ç‹¬æœ‰çš„æ“ä½œç¬¦
     </p>
    </blockquote>
    <h4>
     <a id="35__219">
     </a>
     3.5 åˆ é™¤æ–‡æ¡£
    </h4>
    <p>
     åˆ é™¤æ–‡æ¡£çš„æ–¹å¼å’ŒæŸ¥æ‰¾æ˜¯ä¸€æ ·çš„ï¼Œåªéœ€è¦å®šä¹‰è¿‡æ»¤æ¡ä»¶å³å¯ï¼š
    </p>
    <p>
     è¿™é‡Œç›´æ¥è´´ä»£ç ï¼š
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// çœç•¥ä¸Šè¿°ä»£ç </span>
	<span class="token comment">// 7. åˆ é™¤æ–‡æ¡£</span>
	delFilter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	delResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">DeleteOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> delFilter<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>delResult<span class="token punctuation">.</span>DeletedCount<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç¨‹åºè¿è¡Œç»“æœï¼š
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9587d1a5e20ce2198dcc918274c18a7d.png"/>
    </p>
    <h3>
     <a id="4_MongoDB__241">
     </a>
     4. MongoDB è¿›é˜¶æŸ¥è¯¢
    </h3>
    <h4>
     <a id="41_or_242">
     </a>
     4.1 æ„é€ oræŸ¥è¯¢æ¡ä»¶
    </h4>
    <p>
     é¦–å…ˆæˆ‘ä¸ªäººçš„ä¸€ä¸ªç»“è®ºå°±æ˜¯ï¼šåœ¨ä½¿ç”¨ MongoDB æ„é€ æŸ¥è¯¢ç»“æ„ä½“æ—¶ï¼Œæœ€å¤–å±‚ä¸€å®šæ˜¯ bson.D çš„ç»“æ„
    </p>
    <p>
     ä¸‹é¢ä¸ºä½¿ç”¨ or æŸ¥è¯¢çš„æ–¹å¼ï¼ˆå¯¹äºåˆå­¦è€…è€Œè¨€ä¸éœ€è¦å…³å¿ƒå¦‚ä½•æ„é€ ï¼Œè·Ÿç€æŠ„å°±è¡Œï¼‰
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// çœç•¥ä¸Šè¿°ä»£ç </span>
	ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// æ’å…¥id=1,2,3çš„è®°å½•</span>
	col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	col<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> Article<span class="token punctuation">{<!-- --></span>
		Id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// æ„é€ oræŸ¥è¯¢æ¡ä»¶</span>
	filter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>A<span class="token punctuation">{<!-- --></span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// æŸ¥è¯¢idä¸º1æˆ–è€…2çš„è®°å½•</span>
	find<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$or"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> filter<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> articles <span class="token punctuation">[</span><span class="token punctuation">]</span>Article
	err <span class="token operator">=</span> find<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç¨‹åºè¿è¡Œç»“æœï¼š
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/ca8f94228c8fb2e3b9ffb20556484847.png"/>
    </p>
    <h4>
     <a id="42_and_281">
     </a>
     4.2 æ„é€ andæŸ¥è¯¢æ¡ä»¶
    </h4>
    <p>
     ä¸‹é¢ä¸ºä½¿ç”¨ and æŸ¥è¯¢çš„æ–¹å¼ï¼ˆå¯¹äºåˆå­¦è€…è€Œè¨€ä¸éœ€è¦å…³å¿ƒå¦‚ä½•æ„é€ ï¼Œè·Ÿç€æŠ„å°±è¡Œï¼‰
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// æ„é€ andæŸ¥è¯¢æ¡ä»¶</span>
	andFilter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>A<span class="token punctuation">{<!-- --></span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"title"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token string">"æˆ‘çš„æ ‡é¢˜"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$and"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> andFilter<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	err <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç¨‹åºè¿è¡Œç»“æœï¼š
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/74cfa8d49aefb32d872490fe84c7a2bb.png"/>
    </p>
    <h4>
     <a id="43_in_307">
     </a>
     4.3 æ„é€ inæŸ¥è¯¢æ¡ä»¶
    </h4>
    <p>
     ä¸‹é¢ä¸ºä½¿ç”¨ in æŸ¥è¯¢çš„æ–¹å¼ï¼ˆå¯¹äºåˆå­¦è€…è€Œè¨€ä¸éœ€è¦å…³å¿ƒå¦‚ä½•æ„é€ ï¼Œè·Ÿç€æŠ„å°±è¡Œï¼‰
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// çœç•¥ä¸Šè¿°ä»£ç </span>
	<span class="token keyword">var</span> articles <span class="token punctuation">[</span><span class="token punctuation">]</span>Article
	<span class="token comment">// æ„é€ inæŸ¥è¯¢æ¡ä»¶</span>
	inFilter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>
		bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>
			Key<span class="token punctuation">:</span>   <span class="token string">"id"</span><span class="token punctuation">,</span>
			Value<span class="token punctuation">:</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>bson<span class="token punctuation">.</span>E<span class="token punctuation">{<!-- --></span>Key<span class="token punctuation">:</span> <span class="token string">"$in"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	res<span class="token punctuation">,</span> err <span class="token operator">:=</span> col<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> inFilter<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	err <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>articles<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     ç¨‹åºè¿è¡Œç»“æœï¼š
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0367f072d7f2ead754e265eadbe0f9e8.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36323533333230312f:61727469636c652f64657461696c732f313436323339333233" class_="artid" style="display:none">
 </p>
</div>


