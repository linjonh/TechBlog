---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f7778647a756973686175692f:61727469636c652f64657461696c732f313436313930393632"
layout: post
title: "Java-é›†åˆæ¡†æ¶å¤§å¸ˆè¯¾é›†åˆæ¡†æ¶æºç è§£å‰–å®¤äº”"
date: 2025-03-11 22:37:55 +0800
description: "ğŸ’£ è­¦å‘Šï¼šæœ¬ç« åŒ…å«å¤§é‡ï¼Œå»ºè®®æ­é…å’–å•¡å› é¥®æ–™é˜…è¯»ï¼â˜•ï¸ã€‚"
keywords: "Java é›†åˆæ¡†æ¶å¤§å¸ˆè¯¾ï¼šé›†åˆæ¡†æ¶æºç è§£å‰–å®¤ï¼ˆäº”ï¼‰"
categories: ['Java']
tags: ['å¼€å‘è¯­è¨€', 'Java']
artid: "146190962"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146190962
    alt: "Java-é›†åˆæ¡†æ¶å¤§å¸ˆè¯¾é›†åˆæ¡†æ¶æºç è§£å‰–å®¤äº”"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146190962
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146190962
cover: https://bing.ee123.net/img/rand?artid=146190962
image: https://bing.ee123.net/img/rand?artid=146190962
img: https://bing.ee123.net/img/rand?artid=146190962
---

# Java é›†åˆæ¡†æ¶å¤§å¸ˆè¯¾ï¼šé›†åˆæ¡†æ¶æºç è§£å‰–å®¤ï¼ˆäº”ï¼‰

## ğŸ”¥Java é›†åˆæ¡†æ¶å¤§å¸ˆè¯¾ï¼šé›†åˆæ¡†æ¶æºç è§£å‰–å®¤ï¼ˆäº”ï¼‰

> ğŸ’£ è­¦å‘Šï¼šæœ¬ç« åŒ…å«å¤§é‡
> **è£¸ç çº§ç¡¬æ ¸åˆ†æ**
> ï¼Œå»ºè®®æ­é…å’–å•¡å› é¥®æ–™é˜…è¯»ï¼â˜•ï¸

---

### ç¬¬ä¸€ç«  ArrayList çš„æ‰©å®¹ç„å­¦

#### 1.1 åŠ¨æ€æ‰©å®¹æ ¸å¿ƒä»£ç å¤§å¸å…«å—

```java
// ç¥–å¸ˆçˆ·ã®æ‰©å®¹é­”æ³• âœ¨
private Object[] grow(int minCapacity) {
    int oldCapacity = elementData.length;
    // 1.5å€å¢é•¿å…¬å¼ï¼ˆæš—è—æ•°å­¦ä¹‹ç¾ï¼‰
    int newCapacity = oldCapacity + (oldCapacity >> 1); 
    return elementData = Arrays.copyOf(elementData, newCapacity);
}

```

ğŸ“Œ
**çµé­‚æ‹·é—®è¡¨**
ï¼š

| ç°è±¡ | æ•°å­¦åŸç† | æ€§èƒ½å½±å“ |
| --- | --- | --- |
| åˆå§‹å®¹é‡10 | 2çš„å€æ•°+2ï¼ŸğŸ¤” | å°æ•°æ®é›†çœå†…å­˜ |
| 1.5å€å¢é•¿ | æ–æ³¢é‚£å¥‘æ•°åˆ—é€¼è¿‘ ğŸŒŠ | å¹³è¡¡å†…å­˜ä¸æ‰©å®¹æ¬¡æ•° |
| Arrays.copyOf | å†…å­˜è¿ç»­åˆ†é… ğŸ“ | è¶…å¤§æ•°ç»„æ‰©å®¹å¡é¡¿é£é™© |

#### 1.2 æ‰©å®¹æµç¨‹å¯è§†åŒ–

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/14499dc8c9e64684adbfdb24d3ac9aba.png)

---

### ç¬¬äºŒç«  HashMap çš„å“ˆå¸Œæˆ˜äº‰

#### 2.1 æ‰°åŠ¨å‡½æ•°ã®é»‘ç§‘æŠ€

```java
static final int hash(Object key) {
    int h;
    // è®©é«˜ä½å‚ä¸å“ˆå¸Œè¿ç®—ï¼Œå‡å°‘ç¢°æ’ ğŸ’¥
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}

```

ğŸ¯
**å“ˆå¸Œç¢°æ’å¤„ç†æ–¹æ¡ˆå¯¹æ¯”**
ï¼š

| æ–¹æ¡ˆ | æ•°æ®ç»“æ„ | æ—¶é—´å¤æ‚åº¦ | JDKç‰ˆæœ¬ |
| --- | --- | --- | --- |
| é“¾è¡¨æ³• | å•å‘é“¾è¡¨ ğŸš‚ | O(n) | <8 |
| çº¢é»‘æ ‘ | å¹³è¡¡äºŒå‰æ ‘ ğŸŒ³ | O(logn) | â‰¥8 |
| å¼€æ”¾å¯»å€ | çº¿æ€§æ¢æµ‹ ğŸ” | O(1)~O(n) | å…¶ä»–å®ç° |

#### 2.2 æ ‘åŒ–é˜ˆå€¼èƒŒåçš„åšå¼ˆ

```java
// é“¾è¡¨è½¬çº¢é»‘æ ‘çš„ä¸´ç•Œç‚¹
static final int TREEIFY_THRESHOLD = 8;

// ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿç»Ÿè®¡å­¦ã®é­”æ³• ğŸ²
/*
* ç†æƒ³å“ˆå¸Œä¸‹é“¾è¡¨é•¿åº¦å‡ºç°8çš„æ¦‚ç‡ï¼š0.00000006
* æ­¤æ—¶æ ‘åŒ–çš„æ”¶ç›Šè¶…è¿‡ç»´æŠ¤æˆæœ¬
*/

```

---

### ç¬¬ä¸‰ç«  LinkedList çš„åŒå‘æš—æ‹

#### 3.1 èŠ‚ç‚¹ç»“æ„è§£å‰–å›¾

```java
private static class Node<E> {
    E item;          // å½“å‰å…ƒç´  ğŸ
    Node<E> next;    // ä¸‹ä¸ªèŠ‚ç‚¹ ğŸ‘‰
    Node<E> prev;    // ä¸Šä¸ªèŠ‚ç‚¹ ğŸ‘ˆ
}

```

ğŸ“Š
**å¢åˆ æ“ä½œæ€§èƒ½çœŸç›¸**
ï¼š

| æ“ä½œ | ArrayList | LinkedList | çœŸç›¸å¤§ç™½ ğŸ˜ |
| --- | --- | --- | --- |
| å¤´éƒ¨æ’å…¥ | O(n) | O(1) | LinkedListèƒœ |
| éšæœºåˆ é™¤ | O(n) | O(1) | ä½†éœ€è¦å…ˆéå†æ‰¾èŠ‚ç‚¹ï¼ğŸ˜± |
| å°¾éƒ¨è¿½åŠ  | O(1) | O(1) | å¹³æ‰‹ ğŸ‘¯ |

#### 3.2 è¿­ä»£å™¨é™·é˜±æ¼”ç¤º

```java
LinkedList<Integer> list = new LinkedList<>();
list.addAll(Arrays.asList(1,3,5,7,9));

// é”™è¯¯ç¤ºèŒƒï¼šç”¨forå¾ªç¯éšæœºè®¿é—®
for(int i=0; i<list.size(); i++){
    list.get(i); // O(n^2) è­¦å‘Šï¼ğŸ’£
}

// æ­£ç¡®å§¿åŠ¿ï¼šè¿­ä»£å™¨è®¿é—®
Iterator<Integer> it = list.iterator();
while(it.hasNext()){
    it.next(); // O(n) ä¸æ»‘è®¿é—® ğŸ›·
}

```

---

### ç¬¬å››ç«  ConcurrentHashMap çš„çº¿ç¨‹å®‰å…¨ç§˜ç±

#### 4.1 ğŸ“Œ **é”æœºåˆ¶å¯¹æ¯”è¡¨** ï¼š

| ç‰ˆæœ¬ | æ•°æ®ç»“æ„ | é”ç²’åº¦ | ååé‡æå‡ |
| --- | --- | --- | --- |
| JDK7 | Segment æ•°ç»„ | 16ä¸ªç‹¬ç«‹åˆ†åŒº ğŸ”’ | 4~6å€ |
| JDK8 | Node+CAS | å•ä¸ªé“¾è¡¨å¤´ ğŸ”“ | 10å€+ |
| JDK19 | åç¨‹+æ— é” | æ— é”è®¿é—® ğŸš€ | å®éªŒé˜¶æ®µ |

#### 4.2 size() æ–¹æ³•ã®ç»Ÿè®¡å­¦é­”æœ¯

```java
// é«˜å¹¶å‘ä¸‹çš„sizeè®¡ç®—ç­–ç•¥
public int size() {
    long n = sumCount();
    return ((n < 0L) ? 0 : (n > (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n);
}

// åˆ†ç‰‡è®¡æ•°å‡å°‘ç«äº‰ ğŸ¯
final long sumCount() {
    CounterCell[] as = counterCells; 
    long sum = baseCount;
    if (as != null) {
        for (CounterCell a : as)
            if (a != null)
                sum += a.value;
    }
    return sum;
}

```

#### 4.3 putVal() æ–¹æ³•æºç æ‹†è§£

```java
final V putVal(K key, V value, boolean onlyIfAbsent) {
    // å“ˆå¸Œæ‰°åŠ¨åŠ å¼ºç‰ˆ ğŸŒªï¸
    int hash = spread(key.hashCode());
    int binCount = 0;
  
    for (Node<K,V>[] tab = table;;) {
        Node<K,V> f; int n, i, fh;
        if (tab == null || (n = tab.length) == 0)
            tab = initTable(); // å»¶è¿Ÿåˆå§‹åŒ–
        else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {
            if (casTabAt(tab, i, null, new Node<>(hash, key, value)))
                break; // CAS æ— é”æ’å…¥æˆåŠŸï¼
        }
        else if ((fh = f.hash) == MOVED)
            tab = helpTransfer(tab, f); // ååŠ©æ‰©å®¹
        else {
            // çœŸæ­£çš„é”ç«äº‰åŒº ğŸ’¥
            synchronized (f) {
                if (tabAt(tab, i) == f) {
                    // é“¾è¡¨/çº¢é»‘æ ‘æ’å…¥é€»è¾‘...
                }
            }
        }
    }
    addCount(1L, binCount);
    return null;
}

```

ğŸ¯
**å…³é”®æ“ä½œæµç¨‹å›¾**
ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/56b570b2c2e94df7ac79a6e2091fd6dd.png)

---

### ğŸ”¥ æ€§èƒ½è°ƒä¼˜é»„é‡‘æ³•åˆ™

```java
// ArrayList æœ€ä½³å®è·µ
List<String> list = new ArrayList<>(100_0000); // é¢„åˆ†é…å®¹é‡ ğŸš€

// HashMap é˜²å‘æŒ‡å—
Map<String,Object> map = new HashMap<>(32, 0.75f); // æ§åˆ¶è´Ÿè½½å› å­ âš–ï¸

// LinkedList ä½¿ç”¨ç¦åŒº
if(éœ€è¦éšæœºè®¿é—®) {
    throw new IllegalArgumentException("åˆ«ç”¨æˆ‘ï¼"); ğŸ’£
}

```

---

### ç¬¬äº”ç«  LinkedHashMap çš„æ—¶ç©ºç©¿æ¢­æœ¯

#### 5.1 åŒå‘é“¾è¡¨ç»“æ„å¤§æ›å…‰

```java
// ç»§æ‰¿è‡ª HashMap.Node çš„è¶…çº§èŠ‚ç‚¹ ğŸ¦¸
static class Entry<K,V> extends HashMap.Node<K,V> {
    Entry<K,V> before, after; // æ—¶ç©ºéš§é“å…¥å£ ğŸ•³ï¸
    Entry(int hash, K key, V value, Node<K,V> next) {
        super(hash, key, value, next);
    }
}

// ç»´æŠ¤è®¿é—®é¡ºåºçš„æ ¸å¿ƒä»£ç  ğŸ”—
void afterNodeAccess(Node<K,V> e) {
    Entry<K,V> last;
    if (accessOrder && (last = tail) != e) {
        // æŠŠæœ€è¿‘è®¿é—®çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨
        Entry<K,V> p = (Entry<K,V>)e, b = p.before, a = p.after;
        p.after = null;
        if (b == null)
            head = a;
        else
            b.after = a;
        if (a != null)
            a.before = b;
        else
            last = b;
        if (last == null)
            head = p;
        else {
            p.before = last;
            last.after = p;
        }
        tail = p;
        ++modCount;
    }
}

```

#### 5.2 LRU ç¼“å­˜å®ç°åŸç†

```java
// å®ç°ç®€æ˜“ LRU ç¼“å­˜ ğŸ—‚ï¸
public class LRUCache<K,V> extends LinkedHashMap<K,V> {
    private final int maxCapacity;
  
    public LRUCache(int maxCapacity) {
        super(maxCapacity, 0.75f, true);
        this.maxCapacity = maxCapacity;
    }
  
    @Override
    protected boolean removeEldestEntry(Map.Entry<K,V> eldest) {
        return size() > maxCapacity; // è‡ªåŠ¨æ·˜æ±°æœ€æ—§å…ƒç´  ğŸ—‘ï¸
    }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼š
LRUCache<String, User> cache = new LRUCache<>(1000);
cache.put("user_9527", user); // æ’å…¥æ–°æ•°æ®
cache.get("user_1234");       // è®¿é—®æ•°æ®ä¼šæå‡æ–°é²œåº¦

```

---

### ç¬¬å…­ç«  PriorityQueue çš„å †æ’åºé­”æ³•

#### 6.1 æœ€å°å †å®ç°åŸç†

```java
// ä¼˜å…ˆé˜Ÿåˆ—çš„éª¨æ¶æ•°ç»„ç»“æ„ ğŸ¦´
transient Object[] queue; 

// å…ƒç´ æ’å…¥æ—¶çš„ä¸Šæµ®æ“ä½œ ğŸŒŠ
private void siftUp(int k, E x) {
    if (comparator != null)
        siftUpUsingComparator(k, x);
    else
        siftUpComparable(k, x);
}

private void siftUpComparable(int k, E x) {
    Comparable<? super E> key = (Comparable<? super E>) x;
    while (k > 0) {
        int parent = (k - 1) >>> 1; // æ‰¾çˆ¶èŠ‚ç‚¹ä½ç½®
        Object e = queue[parent];
        if (key.compareTo((E) e) >= 0)
            break;
        queue[k] = e; // çˆ¶èŠ‚ç‚¹ä¸‹æ²‰
        k = parent;
    }
    queue[k] = key;
}

```

ğŸ“Š
**å †æ“ä½œå¤æ‚åº¦è¡¨**
ï¼š

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | åŸç†è¯´æ˜ |
| --- | --- | --- |
| æ’å…¥å…ƒç´  | O(logn) | ä¸Šæµ®æ“ä½œè°ƒæ•´å †ç»“æ„ ğŸŒŠ |
| å–å‡ºé˜Ÿé¦– | O(logn) | ä¸‹æ²‰æ“ä½œé‡å»ºå †ç»“æ„ âš“ |
| æŸ¥çœ‹é˜Ÿé¦– | O(1) | ç›´æ¥è¿”å›å †é¡¶å…ƒç´  ğŸ”ï¸ |
| æ‰¹é‡å»ºå † | O(n) | Floyd ç®—æ³•ä¼˜åŒ– ğŸš€ |

#### 6.2 å †ç»“æ„å¯è§†åŒ–

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/395187d1a01e4c41bd567143f7465250.png)

---

### ğŸ› ï¸ æ‰‹æ’•æºç æŒ‘æˆ˜èµ›

#### æŒ‘æˆ˜ä¸€ï¼šConcurrentHashMap æ‰©å®¹è§¦å‘å™¨

```java
// æ‰¾å‡ºè§¦å‘æ‰©å®¹çš„éšè—æ¡ä»¶
private final void addCount(long x, int check) {
    // å½“ counterCells ä¸ä¸ºç©ºæ—¶...
    if (check >= 0) {
        Node<K,V>[] tab, nt; int n, sc;
        while (s >= (long)(sc = sizeCtl) && (tab = table) != null &&
               (n = tab.length) < MAXIMUM_CAPACITY) {
            // ç¥ç§˜æ‰©å®¹ä¿¡å· ğŸš¨
            int rs = resizeStamp(n);
            if (sc < 0) {
                if ((sc >>> RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||
                    sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||
                    transferIndex <= 0)
                    break;
                if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))
                    transfer(tab, nt);
            }
            // å°è¯•å‘èµ·æ‰©å®¹çš„çº¿ç¨‹ä¼šèµ°åˆ°è¿™é‡Œ ğŸ’ª
            else if (U.compareAndSwapInt(this, SIZECTL, sc,
                                         (rs << RESIZE_STAMP_SHIFT) + 2))
                transfer(tab, null);
            s = sumCount();
        }
    }
}

```

#### æŒ‘æˆ˜äºŒï¼šPriorityQueue å †æ’åºç¼ºé™·

```java
// å±é™©æ“ä½œï¼šç›´æ¥ä¿®æ”¹é˜Ÿåˆ—å…ƒç´ 
PriorityQueue<Student> queue = new PriorityQueue<>();
queue.add(new Student("Alice", 90));
queue.add(new Student("Bob", 80));

// ä½œæ­»ä¿®æ”¹åˆ†æ•°å¯¼è‡´å †ç»“æ„ç ´å ğŸ’£
queue.peek().score = 100; 
System.out.println(queue.poll()); // è¾“å‡ºç»“æœå¯èƒ½ä¸ç¬¦åˆé¢„æœŸï¼

// æ­£ç¡®åšæ³•ï¼šåˆ é™¤åé‡æ–°æ’å…¥
Student s = queue.poll();
s.score = 100;
queue.offer(s);

```

---

#### ğŸ§˜â™‚ï¸ ä¸‹æœŸé¢„å‘Šï¼šã€Šé›†åˆæ¡†æ¶çš„æš—é»‘æ–™ç†â€”â€”å¼±å¼•ç”¨ä¸å¹½çµé˜Ÿåˆ—ã€‹ğŸ‘»

```markdown
// å½©è›‹ä»£ç ï¼šHashMap çš„éšè—è¿­ä»£å™¨
final class KeyIterator extends HashIterator 
    implements Iterator<K>, Spliterator<K> {
    public final K next() { return nextNode().key; }
}
// å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰æœºåˆ¶çš„å®ç°ç§˜å¯† ğŸ”

```

> ğŸŒŸ
> **ç»ˆæé¢†æ‚Ÿ**
> ï¼šè¯»æºç å°±åƒç ´æ¡ˆï¼Œæ¯ä¸ªè®¾è®¡éƒ½æ˜¯æƒè¡¡çš„è‰ºæœ¯ï¼ä¸‹æ¬¡é¢è¯•è¢«é—®HashMapåŸç†æ—¶ï¼Œè¯·ä¼˜é›…åœ°ç”©å‡ºçº¢é»‘æ ‘é˜ˆå€¼è®¡ç®—å…¬å¼ ğŸŒˆ

```java
// å½©è›‹ï¼šHashMap æ ‘åŒ–é˜ˆå€¼è®¡ç®—å…¬å¼
static final int TREEIFY_THRESHOLD = 8;
// ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿå› ä¸º log8 = 3, åœ¨O(logn)å’ŒO(n)ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ âš–ï¸

```