---
layout: post
title: "设计模式Python版-模板方法模式上"
date: 2025-03-12 17:51:01 +0800
description: "介绍了GOF设计模式中的模板方法模式，以及用Python实现模板方法模式的示例。"
keywords: "设计模式Python版 模板方法模式（上）"
categories: ['设计模式Python版']
tags: ['设计模式', '模板方法模式', 'Python']
artid: "146210946"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146210946
    alt: "设计模式Python版-模板方法模式上"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146210946
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146210946
cover: https://bing.ee123.net/img/rand?artid=146210946
image: https://bing.ee123.net/img/rand?artid=146210946
img: https://bing.ee123.net/img/rand?artid=146210946
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     设计模式Python版 模板方法模式（上）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_4">
     </a>
     前言
    </h2>
    <p>
     GOF设计模式分三大类：
    </p>
    <ul>
     <li>
      <strong>
       创建型模式
      </strong>
      ：关注对象的创建过程，包括单例模式、简单工厂模式、工厂方法模式、抽象工厂模式、原型模式和建造者模式。
     </li>
     <li>
      <strong>
       结构型模式
      </strong>
      ：关注类和对象之间的组合，包括适配器模式、桥接模式、组合模式、装饰模式、外观模式、享元模式和代理模式。
     </li>
     <li>
      <strong>
       行为型模式
      </strong>
      ：关注对象之间的交互，包括职责链模式、命令模式、解释器模式、迭代器模式、中介者模式、备忘录模式、观察者模式、状态模式、策略模式、模板方法模式和访问者模式。
     </li>
    </ul>
    <h2>
     <a id="_12">
     </a>
     一、模板方法模式
    </h2>
    <p>
     模板方法模式（Template Method Pattern）
    </p>
    <ul>
     <li>
      <p>
       定义：定义一个操作中算法的框架，而将一些步骤延迟到子类中。模板方法模式使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。
      </p>
     </li>
     <li>
      <p>
       解决问题：如何为一个复杂算法的某些步骤提供多种实现方式？
      </p>
     </li>
     <li>
      <p>
       使用场景：
      </p>
      <ul>
       <li>
        对一些复杂的算法进行分割，将其算法中固定不变的部分设计为模板方法和父类具体方法，而一些可以改变的细节由其子类来实现。即一次性地实现一个算法的不变部分，并将可变的行为留给子类来实现。
       </li>
       <li>
        各子类中公共的行为应被提取出来并集中到一个公共父类中以避免代码重复。
       </li>
       <li>
        需要通过子类来决定父类算法中某个步骤是否执行，实现子类对父类的反向控制。
       </li>
      </ul>
     </li>
     <li>
      <p>
       组成：
      </p>
      <ul>
       <li>
        AbstractClass（抽象类）：在抽象类中定义了一系列基本操作（Primitive Operations），这些基本操作可以是具体的，也可以是抽象的。每个基本操作对应算法的一个步骤，在其子类中可以重定义或实现这些步骤。同时，在抽象类中实现了一个模板方法（Template Method），用于定义一个算法的框架。模板方法不仅可以调用在抽象类中实现的基本方法，也可以调用在抽象类的子类中实现的基本方法，还可以调用其他对象中的方法。
       </li>
       <li>
        ConcreteClass（具体子类）：它是抽象类的子类，用于实现在父类中声明的抽象基本操作以完成子类特定算法的步骤，也可以覆盖在父类中已经实现的具体基本操作。
       </li>
      </ul>
     </li>
     <li>
      <p>
       补充说明：
      </p>
      <ul>
       <li>
        通过使用模板方法模式，可以将一些复杂流程的实现步骤封装在一系列基本方法中。
       </li>
       <li>
        模板方法模式是一种基于继承的代码复用基本技术。
       </li>
       <li>
        在抽象父类中提供一个称之为模板方法的方法来定义这些基本方法的执行次序，而通过其子类来覆盖某些步骤，从而使得相同的算法框架可以有不同的执行结果。
       </li>
       <li>
        模板方法模式广泛应用于框架设计（例如Spring等）中，以确保通过父类来控制处理流程的逻辑顺序（例如框架的初始化、测试流程的设置等）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       优点：
      </p>
      <ul>
       <li>
        模板方法模式在父类中形式化地定义一个算法，而由它的子类来实现细节的处理。
       </li>
       <li>
        模板方法模式是一种代码复用技术，它在类库设计中尤为重要。
       </li>
       <li>
        模板方法模式可实现一种反向控制结构。
       </li>
       <li>
        符合单一职责原则和开闭原则。
       </li>
      </ul>
     </li>
     <li>
      <p>
       缺点：
      </p>
      <ul>
       <li>
        类的个数增加
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8e0af231bdab4a458347f4dbc598e1e8.png"/>
    </p>
    <h2>
     <a id="_45">
     </a>
     二、模板方法模式示例
    </h2>
    <p>
     使用模板方法模式设计银行利息计算模块
    </p>
    <ul>
     <li>
      利息计算流程如下：
      <ul>
       <li>
        （1）系统根据账号和密码验证用户信息，如果用户信息错误，系统显示出错提示。
       </li>
       <li>
        （2）如果用户信息正确，则根据用户类型的不同使用不同的利息计算公式计算利息（例如活期账户和定期账户具有不同的利息计算公式）。
       </li>
       <li>
        （3）系统显示利息。
       </li>
      </ul>
     </li>
     <li>
      Account充当抽象类角色，CurrentAccount和SavingAccount充当具体子类角色。
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token triple-quoted-string string">"""模板方法模式"""</span>

<span class="token comment">### 抽象类</span>


<span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""账户"""</span>

    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""基本，具体方法"""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"账号：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>account<span class="token punctuation">}</span></span><span class="token string">，密码：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>password<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> account <span class="token operator">==</span> <span class="token string">"张三"</span> <span class="token keyword">and</span> password <span class="token operator">==</span> <span class="token string">"123456"</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">calculate_interest</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""基本，抽象方法"""</span>
        <span class="token keyword">raise</span> NotImplementedError

    <span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""基本，具体方法"""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"显示利息！"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""模板方法"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>validate<span class="token punctuation">(</span>account<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>calculate_interest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>display<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"账号或密码错误！"</span><span class="token punctuation">)</span>


<span class="token comment">### 具体子类</span>


<span class="token keyword">class</span> <span class="token class-name">CurrentAccount</span><span class="token punctuation">(</span>Account<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""活期账户"""</span>

    <span class="token keyword">def</span> <span class="token function">calculate_interest</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""重写抽象方法"""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"按活期利率计算利息！"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">SavingAccount</span><span class="token punctuation">(</span>Account<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""定期账户"""</span>

    <span class="token keyword">def</span> <span class="token function">calculate_interest</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""重写抽象方法"""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"按定期利率计算利息！"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      具体子类的类名存储在配置文件 template_method_conf.json
     </li>
    </ul>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"class_name"</span><span class="token operator">:</span> <span class="token string">"SavingAccount"</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      使用工具类
      <code>
       JsonUtil
      </code>
      来读取配置文件
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token comment"># 模块 utils.py</span>
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">import</span> json


<span class="token keyword">class</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">get_value</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"class_name"</span><span class="token punctuation">,</span> conf_file<span class="token operator">=</span><span class="token string">"template_method_conf.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""读取配置文件，返回配置文件中的配置"""</span>
        path <span class="token operator">=</span> Path<span class="token punctuation">(</span>conf_file<span class="token punctuation">)</span>
        contents <span class="token operator">=</span> path<span class="token punctuation">.</span>read_text<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
        conf <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>contents<span class="token punctuation">)</span>
        <span class="token keyword">return</span> conf<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      客户端代码
     </li>
    </ul>
    <pre><code class="prism language-python"><span class="token triple-quoted-string string">"""模板方法模式：客户端代码"""</span>

<span class="token keyword">from</span> utils <span class="token keyword">import</span> JsonUtil
<span class="token keyword">from</span> template_method <span class="token keyword">import</span> Account

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    account_type <span class="token operator">=</span> JsonUtil<span class="token punctuation">.</span>get_value<span class="token punctuation">(</span>conf_file<span class="token operator">=</span><span class="token string">"template_method_conf.json"</span><span class="token punctuation">)</span>
    account<span class="token punctuation">:</span> Account <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">"template_method"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> account_type<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    account<span class="token punctuation">.</span>handle<span class="token punctuation">(</span>account<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      输出结果
     </li>
    </ul>
    <pre><code class="prism language-python">账号：张三，密码：<span class="token number">123456</span>
按定期利率计算利息！
显示利息！
</code></pre>
    <hr/>
    <p>
     您正在阅读的是《
     <strong>
      设计模式Python版
     </strong>
     》专栏！关注不迷路~
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f7a6c6a677a772f:61727469636c652f64657461696c732f313436323130393436" class_="artid" style="display:none">
 </p>
</div>


