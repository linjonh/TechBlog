---
layout: post
title: "路由器与防火墙配置命令"
date: 2025-03-14 15:08:46 +0800
description: "路由器配置命令"
keywords: "路由器与防火墙配置命令"
categories: ['网络']
tags: ['网络']
artid: "146258129"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146258129
    alt: "路由器与防火墙配置命令"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146258129
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146258129
cover: https://bing.ee123.net/img/rand?artid=146258129
image: https://bing.ee123.net/img/rand?artid=146258129
img: https://bing.ee123.net/img/rand?artid=146258129
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     路由器与防火墙配置命令
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     路由器与防火墙配置命令
    </h2>
    <p>
     小明啊，你不是学计算机的嘛，叔叔家的路由器坏了，可以过来帮叔叔看看吗
    </p>
    <p>
     命令可以用缩写，造就一堆容易造成歧义的缩写，比如
     <code>
      add
     </code>
     是
     <code>
      address
     </code>
     的缩写，
     <code>
      sh
     </code>
     是
     <code>
      shutdown
     </code>
     的缩写。
    </p>
    <p>
     默认为Cisco路由器和Cisco防火墙
    </p>
    <h3>
     <a id="_11">
     </a>
     视图模式介绍
    </h3>
    <pre><code class="prism language-bash">普通视图 router<span class="token operator">&gt;</span>
特权视图 router<span class="token comment">#     #在普通模式下输入enable</span>
全局视图 router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#   #在特权模式下输入config t</span>
接口视图 router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#   #在全局模式下输入int 接口名称 例如int f0/0或int e0</span>
路由协议视图 router（config-route）<span class="token comment">#  #在全局模式下输入router 动态路由协议名称</span>
<span class="token builtin class-name">exit</span> <span class="token comment">#从接口、协议、line等视图模式下退回到全局配置模式，或从全局配置模式退回到特权模式</span>
end <span class="token comment">#回到特权模式</span>
router<span class="token comment">#reload #重新启动路由器</span>
</code></pre>
    <h3>
     <a id="1__26">
     </a>
     1. 基本配置
    </h3>
    <pre><code class="prism language-bash">router<span class="token operator">&gt;</span>en	 					<span class="token comment">#enable的缩写，进入特权模式</span>
router<span class="token comment">#conf t 					#configure terminal的缩写，进入全局配置模式</span>
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># hostname xxx 	#设置设备名称</span>
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#enable password XXX  #设置进入特权模式密码（低级密码，密码可逆）</span>
Router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#enable secret XXX    #设置进入特权模式密码（高级密码，密码不可逆）</span>

router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#no ip domain lookup #不允许路由器缺省使用DNS解析命令</span>
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># Service password-encrypt </span>
	<span class="token comment">#对所有在路由器上输入的口令进行暗文加密</span>
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#security</span>

router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#line vty 0 4 #进入虚拟终端线路配置模式</span>
router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#password xxx #设置telnet的密码。没有密码远程连接不了</span>
router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#login #开启登陆密码</span>

router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#line con 0 #进入控制口的服务模式</span>
router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#password xxx #设置console的密码</span>
router<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment">#login #开启密码</span>

router<span class="token comment">#Logout  #退出当前路由器登陆模式相对与windows的注销</span>
router<span class="token comment">#reload #重新启动路由器（热启动）冷启动就是关闭路由器再打开电源开关 </span>
</code></pre>
    <h3>
     <a id="2__54">
     </a>
     2. 接口配置与网络地址转换
    </h3>
    <p>
     NAT：network address translation，网络地址转换
    </p>
    <p>
     PAT：port address translation，端口地址转换
    </p>
    <pre><code class="prism language-bash">router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int s0 </span>
	<span class="token comment">#进入接口配置模式。serial 0端口配置（如果是模块化的路由器前面加上槽位编号，</span>
	<span class="token comment">#例如serial0/0 代表这个路由器的0槽位上的第一个接口）</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 10.9.9.1 255.255.255.0   </span>
	<span class="token comment">#这里的add是address的缩写，设置s0接口的ip地址，子网掩码</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#nameif outside</span>
	<span class="token comment">#设置接口命名为outside</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment"># security-level 0</span>
	<span class="token comment">#设置接口的安全级别为0</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#enca hdlc/ppp </span>
	<span class="token comment">#捆绑链路协议 hdlc 或者 ppp。</span>
	<span class="token comment">#思科缺省串口封装的链路层协议是HDLC，所以在show run中不会显示enca hdlc</span>
	<span class="token comment">#如果要封装为别的链路层协议例如PPP/FR/X25，show run才会显示enca ppp等配置</span>
	
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># int e0 #进入e0接口配置</span>
firewall<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment"># ip add 10.9.9.1 255.255.255.0 #设置e0接口的ip,netmask</span>
firewall<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment"># nameif inside #接口命名为inside，表示内部网络</span>
firewall<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment"># end #回到特权模式</span>
firewall<span class="token comment"># conf t #进入全局模式</span>
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># nat (inside) 101 10.9.9.0 255.255.255.0</span>
	<span class="token comment">#配置inside接口的网络地址转换，指定转换范围10.9.9.0/24网段的数据包</span>
	<span class="token comment">#穿越防火墙时将进行地址转换，NAT标识ID为101</span>
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># global (outside) 101 192.168.9.9-192.168.9.102 netmask 255.255.255.0</span>
	<span class="token comment">#配置outside接口的全局地址池，转换NAT标识ID为101的所有数据包源IP地址</span>
	<span class="token comment">#(需要与nat命令的NAT标识对应),分配出站的全局地址,范围192.168.9.9-192.168.9.102。</span>
	<span class="token comment">#比如来自内网10.9.9.2的数据包转换成192.168.9.9作为外部地址。</span>
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># global (outside) 101 192.168.9.103 netmask 255.255.255.255</span>
	<span class="token comment">#在上一条命令之后输入这一条，表示当上一条global的全局地址全部分配完毕后，才使用这条命令的全局地址池</span>

firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># static (dmz,outside) 192.168.9.21 172.5.5.2</span>
	<span class="token comment">#static [(internal_if_name,external_if_name)] global_ip local_ip[netmask network_mask][max_conns [em_limit]][norandomseq]</span>
	<span class="token comment">#配置静态网络地址转换，内部网络接口名dmz，外部网络接口名outside，</span>
	<span class="token comment">#指定dmz区域的ip地址为172.5.5.2，转换为防火墙外部区域的IP地址192.168.9.21</span>

firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># show run nat #查看正在运行的nat</span>
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># no nat (inside) 101 10.9.9.0 255.255.255.0 #删除这条配置</span>

router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int loopback </span>
	<span class="token comment">#建立环回口(逻辑接口)模拟不同的本机网段</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 192.168.1.1 255.255.255.255  </span>
	<span class="token comment">#添加ip 地址和掩码给环回口</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no sh  		#sh是shutdown的缩写，开启接口</span>
router<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#shutdown 		#管理性的关闭接口</span>
</code></pre>
    <h3>
     <a id="3__110">
     </a>
     3. 静态路由与动态路由
    </h3>
    <p>
     (1)静态路由
    </p>
    <pre><code class="prism language-bash">firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># route outside 0 0 10.9.9.13</span>
	<span class="token comment">#route if_name ip_address netmask gateway_ip [metric]</span>
    <span class="token comment">#ip_address为目的ip，metric为到gateway_ip的跳数</span>
	<span class="token comment">#配置默认路由为10.9.9.13，从防火墙outside接口出站的所有数据包，通过默认路由到达外网</span>

router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip route 0.0.0.0 0.0.0.0 192.168.9.1</span>
	<span class="token comment">#目的地址为0.0.0.0(任意地址)，下一跳地址192.168.9.1</span>
</code></pre>
    <p>
     (2)动态路由
    </p>
    <pre><code class="prism language-bash">rip协议
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router rip 	#启动rip协议</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network xxx.xxx.xxx.xxx #宣告自己的网段</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#version 2  #转换为rip 2版本</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#no auto-summary #关闭自动汇总功能，rip V2才有作用</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment"># passive-int 接口名 </span>
	<span class="token comment">#启动本路由器的那个接口为被动接口，该接口不会发送RIP更新</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment"># nei xxx.xxx.xxx.xxx </span>
	<span class="token comment">#neighbor的缩写，广播转单播报文，指定邻居的接收ip</span>
igrp协议
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#router igrp xxx #启动igrp协议 </span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network xxx.xxx.xxx.xxx #宣告自己的网段</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#variance xxx #调整倍数因子，使用不等价的负载均衡</span>
eigrp协议
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span>router eigrp xxx <span class="token comment">#启动协议</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#network xxx.xxx.xxx.xxx #宣告自己的网段</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#variance xxx #调整倍数因子，使用不等价的负载均衡</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span><span class="token comment">#no auto-summary #关闭自动汇总功能</span>
ospf协议
router<span class="token punctuation">(</span>config<span class="token punctuation">)</span>router ospf xxx <span class="token comment">#启动协议启动一个OSPF协议进程</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span>network xxx.xxx.xxx.xxx area xxx 
	<span class="token comment">#宣告自己的接口或网段,在ospf的区域中可以把不同接口宣告在不同区域中</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span>router-id xxx.xxx.xxx.xxx <span class="token comment">#配置路由的id</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span>aera xxx stub 
	<span class="token comment">#配置xxx区域为末梢区域,加入这个区域的路由器全部要配置这个条命令</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span>aera xxx stub no-summary  
	<span class="token comment">#配置xxx区域为完全末梢区域,只在ABR上配置</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span>aera xxx nssa 
	<span class="token comment">#配置xxx区域为非纯末梢区域(NSSA)加入这个区域的路由器全部要配置这个条命令</span>
router<span class="token punctuation">(</span>config-router<span class="token punctuation">)</span>aera xxx nssa no-summary  
	<span class="token comment">#配置xxx区域为完全非纯末梢区域,只在ABR上配置,</span>
	<span class="token comment">#并发布缺省路由信息给进入这个区域内的路由器</span>
</code></pre>
    <h3>
     <a id="4__163">
     </a>
     4. 保存配置
    </h3>
    <pre><code class="prism language-bash">router<span class="token comment">#wr </span>
	<span class="token comment">#write的缩写,将RAM中的当前配置存储到NVRAM中，下次路由器启动就是执行保存的配置</span>
router<span class="token comment">#Copy running-config startup-config </span>
	<span class="token comment">#命令与write效果一样</span>
</code></pre>
    <h3>
     <a id="5__174">
     </a>
     5. 查看命令
    </h3>
    <pre><code class="prism language-bash">特权模式下：
router<span class="token comment">#show ip int br </span>
	<span class="token comment">#brief的缩写，查看当前的路由器的接口ip地址启用情况</span>
router<span class="token comment">#show ip route #查看当前的路由表</span>
router<span class="token comment">#show ? #查看show命令用法</span>
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#show running-config nat #查看当前的 NAT 配置</span>
firewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#show running-config global #查看global命令配置</span>
firewall<span class="token comment">#show config #查看防火墙配置</span>
firewall<span class="token comment">#show run interface e0 #查看e0接口的nameif,security-level,ip address</span>
</code></pre>
    <h3>
     <a id="6__190">
     </a>
     6. 访问控制列表
    </h3>
    <p>
     防火墙流量过滤只关注第一个初始化的数据包，而非响应包。防火墙接口没有绑定ACL时，出站的流量默认是放行，入站流量默认说拒绝。那么，拒绝默认可以出站的流量，放行默认不能入站的流量，就需要通过配置访问控制列表（Access Control List，ACL）实现流量过滤。
    </p>
    <p>
     防火墙上的一个接口只能绑定一个ACL
    </p>
    <pre><code class="prism language-bash"><span class="token comment">#创建访问控制规则</span>
pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># access-list acl_id [line line-num] deny|permit protocol source_addr source_mask [operator [port]] destination_addr destination_mask operator [port]</span>

acl_id 指定ACL名称
deny<span class="token operator">|</span>permit 拒绝<span class="token operator">|</span>允许通过PIX防火墙的数据包
operator 有效的操作符有lt,gt,eq,neq,range
remark 添加到ACL中的注释
text 用于remark注释的正文

show access-list		 <span class="token comment">#显示ACL</span>
<span class="token function">clear</span> access-list <span class="token punctuation">[</span>acl_id<span class="token punctuation">]</span> <span class="token comment">#删除所有或指定条目的ACL</span>
no access-list acl_id 	<span class="token comment">#删除指定条目的ACL</span>

<span class="token comment">#绑定到防火墙的特定接口</span>
pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># access-group acl_id in interface interface_name</span>
	<span class="token comment">#绑定一个ACL到一个接口</span>

show access-group acl_id <span class="token keyword">in</span> interface interface_name	 <span class="token comment">#显示绑定在interface_name接口的ACL</span>
<span class="token function">clear</span> access-group acl_id <span class="token keyword">in</span> interface interface_name <span class="token comment">#删除acl_id标识的ACL中的所有条目</span>
no access-group acl_id <span class="token keyword">in</span> interface interface_name 	<span class="token comment">#删除绑定在接口上acl_id标识的ACL</span>
</code></pre>
    <p>
     示例：
    </p>
    <pre><code class="prism language-bash">pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># access-list 101 extended permit icmp any any echo-reply</span>
	<span class="token comment">#创建ACL，放行ping命令回显数据包，标识ID为101</span>
pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># access-list 101 permit tcp any host 192.168.9.21 eq 23</span>
	<span class="token comment">#创建ACL，放行所有到目的主机192.168.9.21且端口号为23的TCP协议数据包，标识ID为101</span>
pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># show access-list</span>
access-list cached ACL log flows: total <span class="token number">0</span>, denied <span class="token number">0</span> <span class="token punctuation">(</span>deny-flow-max <span class="token number">4096</span><span class="token punctuation">)</span>
            alert-interval <span class="token number">300</span>
access-list <span class="token number">101</span><span class="token punctuation">;</span> <span class="token number">2</span> elements
access-list <span class="token number">101</span> line <span class="token number">1</span> extended permit icmp any any echo-reply <span class="token punctuation">(</span>hitcnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> 0x30901cd
access-list <span class="token number">101</span> line <span class="token number">2</span> extended permit tcp any <span class="token function">host</span> <span class="token number">192.168</span>.9.21 eq telnet <span class="token punctuation">(</span>hitcnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> 0x17597d2

pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># access-group 101 in interface outside</span>
	<span class="token comment">#接口outside绑定标识为101的ACL</span>
pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># access-group 101 in interface dmz</span>
	<span class="token comment">#接口dmz绑定标识为101的ACL</span>
pixfirewall<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># show run access-group</span>
access-group <span class="token number">101</span> <span class="token keyword">in</span> interface outside
access-group <span class="token number">101</span> <span class="token keyword">in</span> interface dmz
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f676f6f676c6532302f:61727469636c652f64657461696c732f313436323538313239" class_="artid" style="display:none">
 </p>
</div>


