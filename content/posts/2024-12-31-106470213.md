---
layout: post
title: "微信小程序不同小程序间调用云环境多个不同小程序共享云数据"
date: 2024-12-31 16:25:13 +0800
description: "微信小程序的云开发功能十分方便，无需自己搭建服务器即可实现后台数据服务的管理。但做一些类似于电子购物"
keywords: "跨小程序获取云数据"
categories: ['微信小程序云开发']
tags: ['小程序', '云服务']
artid: "106470213"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=106470213
    alt: "微信小程序不同小程序间调用云环境多个不同小程序共享云数据"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=106470213
featuredImagePreview: https://bing.ee123.net/img/rand?artid=106470213
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序不同小程序间调用云环境（多个不同小程序共享云数据）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="text-indent:33px;">
     微信小程序的云开发功能十分方便，无需自己搭建服务器即可实现后台数据服务的管理。但做一些类似于电子购物商城的小程序时，就需要管理端对后台数据进行管理。由于每个微信公众平台账号只能发布一个小程序，因此无法共用同一个云开发环境。此时就需要进行云函数跨云开发调用。
    </p>
    <p style="text-indent:33px;">
     我们先看下云环境初始化时的传入参数：
    </p>
    <h3 id="init">
     输入参数：
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        字段
       </th>
       <th>
        类型
       </th>
       <th>
        必填
       </th>
       <th>
        说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        secretId
       </td>
       <td>
        string
       </td>
       <td>
        否
       </td>
       <td>
        腾讯云 API 固定密钥对，在云函数内执行，可不填。
       </td>
      </tr>
      <tr>
       <td>
        secretKey
       </td>
       <td>
        string
       </td>
       <td>
        否
       </td>
       <td>
        同上。
       </td>
      </tr>
      <tr>
       <td>
        env
       </td>
       <td>
        string
       </td>
       <td>
        否
       </td>
       <td>
        TCB 环境 ID，不填则使用默认环境。
       </td>
      </tr>
      <tr>
       <td>
        proxy
       </td>
       <td>
        string
       </td>
       <td>
        否
       </td>
       <td>
        调用接口时使用的 HTTP 代理 url。
       </td>
      </tr>
      <tr>
       <td>
        timeout
       </td>
       <td>
        number
       </td>
       <td>
        否
       </td>
       <td>
        调用接口的超时时间（ms），默认为5000，即5秒。
       </td>
      </tr>
      <tr>
       <td>
        credentials
       </td>
       <td>
        object
       </td>
       <td>
        否
       </td>
       <td>
        Cloudbase 私钥，包含 private_key 和 private_key_id 两个字符串。
       </td>
      </tr>
      <tr>
       <td>
        version
       </td>
       <td>
        string
       </td>
       <td>
        否
       </td>
       <td>
        版本号，依赖项目的版本号
       </td>
      </tr>
     </tbody>
    </table>
    <p style="text-indent:33px;">
     例如：我们已有小程序A，此时我们希望小程序B调用小程序A云数据库中的数据。在小程序B云函数进行初始化时，我们可以在B小程序的云函数里填入A小程序的&lt;secretId&gt;和&lt;secretKey&gt;以及&lt;env&gt;，传入参数的获取方法：
    </p>
    <p style="text-indent:33px;">
     前往腾讯云
     <a href="https://console.cloud.tencent.com/cam/capi" rel="nofollow">
      https://console.cloud.tencent.com/cam/capi
     </a>
     获取密钥对。
    </p>
    <p style="text-indent:33px;">
     <span style="color:#f33b45;">
      登录时选择微信公众号登录，使用管理员微信扫码二维码后，选择小程序A进行登录。访问管理-访问密钥-API密钥管理，新建密钥，即可获得&lt;secretId&gt;和&lt;secretKey&gt;。
     </span>
    </p>
    <p style="text-indent:33px;">
     <span style="color:#f33b45;">
      &lt;env&gt;为云开发环境，在A小程序的开发工具中的云开发控制台就可以找到。
     </span>
    </p>
    <p style="text-indent:0;">
     <img alt="" height="253" src="https://i-blog.csdnimg.cn/blog_migrate/58e2b13f6a3a69764ef78c7522237834.png" width="891"/>
    </p>
    <p style="text-indent:0;">
    </p>
    <p style="text-indent:33px;">
     &lt;env&gt;为云开发环境，在A小程序的开发工具中的云开发控制台就可以找到。
    </p>
    <p style="text-indent:33px;">
     在B小程序中新建云函数getData:
    </p>
    <pre><code class="language-javascript">// 云函数入口文件
const cloud = require('wx-server-sdk')

cloud.init({
  secretId: 'AXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXOZi',//之前获得的secretId和secretKey
  secretKey: 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXe',
  env: 'data-XXXX'//云环境ID
})

// 云函数入口函数
exports.main = async function(event, context){
  const db = cloud.database()
  const res = await  db.collection('login').where({
    _id:"16526515"
  }).get()
  return res
}</code></pre>
    <p style="text-indent:33px;">
     此时，在B小程序中调用云函数getData就可以获取得到小程序A云数据库中的数据：
    </p>
    <pre><code class="language-javascript">login(e){
    wx.cloud.init()
    wx.cloud.callFunction({
      name:"getData",
      success(res){
        console.log(res.result.data)
      }
    })
  },
})</code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f7a6a676f3030372f:61727469636c652f64657461696c732f313036343730323133" class_="artid" style="display:none">
 </p>
</div>


