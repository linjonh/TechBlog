---
layout: post
title: "Zookeeper与Kafka学习笔记-"
date: 2025-03-10 15:08:38 +0800
description: "采用层次化数据模型（Znode树结构），每个节点可存储<1MB数据。Topic逻辑分类，Partition物理分片（提升并发能力）环境要求：JDK8+、Zookeeper集群（建议3/5节点）数据变更通过版本号（Version）控制，实现乐观锁机制。ISR（In-Sync Replicas）机制保障高可用。分布式协调服务，用于维护配置/命名/同步等元数据。：解耦/削峰/异步通信，支持顺序性与回溯消费。：持久化存储+多副本机制，数据保留策略可配置。服务节点，负责消息持久化存储与副本同步。"
keywords: "Zookeeper与Kafka学习笔记 "
categories: ['未分类']
tags: ['学习', 'Zookeeper', 'Kafka']
artid: "146155049"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146155049
    alt: "Zookeeper与Kafka学习笔记-"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146155049
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146155049
cover: https://bing.ee123.net/img/rand?artid=146155049
image: https://bing.ee123.net/img/rand?artid=146155049
img: https://bing.ee123.net/img/rand?artid=146155049
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Zookeeper与Kafka学习笔记
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 style="margin-left:0.0001pt; margin-right:0px; text-align:justify">
     <strong>
      一、Zookeeper核心要点
     </strong>
    </h2>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      1. 核心特性
     </strong>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     分布式协调服务，用于维护配置/命名/同步等元数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     采用层次化数据模型（Znode树结构），每个节点可存储&lt;1MB数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     典型应用场景：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Hadoop NameNode高可用
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     HBase元数据管理
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Kafka集群选举与状态管理
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      2. 设计限制
     </strong>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     内存型存储，不适合大数据量场景
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     数据变更通过版本号（Version）控制，实现乐观锁机制
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     采用ZAB协议保证数据一致性
    </p>
    <h2 style="margin-left:0.0001pt; margin-right:0px; text-align:justify">
     <strong>
      二、Kafka核心架构
     </strong>
    </h2>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      1. 三大核心角色
     </strong>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      消息系统
     </strong>
     ：解耦/削峰/异步通信，支持顺序性与回溯消费
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      存储系统
     </strong>
     ：持久化存储+多副本机制，数据保留策略可配置
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      流处理平台
     </strong>
     ：提供窗口/连接/聚合等实时处理能力
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      2. 核心组件
     </strong>
    </p>
    <table border="1" cellspacing="0" style="margin-left:4.9000pt">
     <tbody>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="WQqf-1741524613714">
          </a>
          组件
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="ahIm-1741524613717">
          </a>
          功能说明
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="v1oV-1741524613721">
          </a>
          Producer
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="v6v8-1741524613724">
          </a>
          消息生产者，支持自动负载均衡/指定分区写入
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="iuNL-1741524613728">
          </a>
          Broker
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="trTv-1741524613731">
          </a>
          服务节点，负责消息持久化存储与副本同步
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="uEVw-1741524613735">
          </a>
          Consumer
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="Zgtm-1741524613738">
          </a>
          采用Pull模式消费，记录offset保证消费连续性
         </span>
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      3. 核心机制
     </strong>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      主题与分区
     </strong>
     ：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Topic逻辑分类，Partition物理分片（提升并发能力）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     单Partition内消息有序，不同Partition间无序
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      多副本机制
     </strong>
     ：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Leader处理读写，Follower同步数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     ISR（In-Sync Replicas）机制保障高可用
    </p>
    <h2 style="margin-left:0.0001pt; margin-right:0px; text-align:justify">
     <strong>
      三、Zookeeper与Kafka协同
     </strong>
    </h2>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      集群管理
     </strong>
     ：记录Broker注册信息与存活状态
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      元数据存储
     </strong>
     ：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     存储Topic配置、Partition分配方案
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     维护Consumer Group的offset信息（旧版本）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      选举机制
     </strong>
     ：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Controller选举（集群主节点）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Partition Leader选举
    </p>
    <h2 style="margin-left:0.0001pt; margin-right:0px; text-align:justify">
     <strong>
      四、消息存储与消费
     </strong>
    </h2>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      1. 存储设计
     </strong>
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     分区对应物理日志文件（Segment分段存储）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     索引文件采用稀疏存储，节省空间
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     消息按时间/大小策略清理旧数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      2. 消费模式
     </strong>
    </p>
    <table border="1" cellspacing="0" style="margin-left:4.9000pt">
     <tbody>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="TLeh-1741524613788">
          </a>
          模式
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="KmSg-1741524613791">
          </a>
          特点
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="aHl1-1741524613795">
          </a>
          点对点
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="Ye5w-1741524613798">
          </a>
          单消费组单消费者
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="3jkm-1741524613802">
          </a>
          发布-订阅
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="PlZa-1741524613805">
          </a>
          多消费组独立消费
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="azfE-1741524613809">
          </a>
          高效消费配置
         </span>
        </p>
       </td>
       <td style="background-color:#000000; height:30.0000pt; width:248.0000pt">
        <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
         <span style="color:#ffffff">
          <a name="Xhzc-1741524613812">
          </a>
          消费者数=分区数实现最大并行度
         </span>
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <h2 style="margin-left:0.0001pt; margin-right:0px; text-align:justify">
     <strong>
      五、常用命令速查
     </strong>
    </h2>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      1. Topic管理
     </strong>
    </p>
    <pre><code class="hljs">bash# 创建主题（4分区2副本）
kafka-topics.sh --create --bootstrap-server localhost:9092 \
--topic my-topic --partitions 4 --replication-factor 2

# 查看主题详情
kafka-topics.sh --describe --bootstrap-server localhost:9092 --topic my-topic</code></pre>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      2. 生产消费
     </strong>
    </p>
    <pre><code class="hljs">bash# 控制台生产者（带Key发送）
kafka-console-producer.sh --bootstrap-server localhost:9092 \
--topic my-topic --property parse.key=true --property key.separator=":"

# 控制台消费者（显示元数据）
kafka-console-consumer.sh --bootstrap-server localhost:9092 \
--topic my-topic --property print.partition=true --property print.offset=true</code></pre>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     <strong>
      3. 集群管理
     </strong>
    </p>
    <pre><code class="hljs">bash# 查看Broker状态
kafka-cluster.sh --bootstrap-server localhost:9092 --describe

# 修改集群配置
kafka-configs.sh --bootstrap-server localhost:9092 --entity-type brokers \
--entity-name 0 --alter --add-config "log.retention.hours=168"</code></pre>
    <h2 style="background-color:transparent; margin-left:0.0001pt; margin-right:0px; text-align:justify">
     <strong>
      六、部署要点
     </strong>
    </h2>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     环境要求：JDK8+、Zookeeper集群（建议3/5节点）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     推荐工具：Kafka-UI进行可视化监控
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     性能调优方向：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     分区数规划
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     副本因子设置
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     消息保留策略
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     压缩算法选择（gzip/lz4等）
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f79616e626f7368756a752f:61727469636c652f64657461696c732f313436313535303439" class_="artid" style="display:none">
 </p>
</div>


