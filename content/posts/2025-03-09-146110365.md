---
layout: post
title: "为你的python程序上锁软件序列号生成器"
date: 2025-03-09 08:21:50 +0800
description: "以当前时间戳为基准添加有效天数，然后将客户发送过来的序列号再进行一次组合，最后通过。接下来我们来自己实现序列号的生成及使用，通过本文的学习，希望能够帮助到你！：定时判断是否超过有效期，防止客户程序未关闭，就算超过有效期还能继续使用。：为了方便使用，可以将程序设计为可视化窗口模式，最简单的方式使用。的打包，可是由于没有使用序列号，程序被无限复制，导致收益下降。，这也是国人开发的一个加密库，包含加密、有效期、许可证。6. 当时间戳未过期，则运行程序，反之无法启动，提示。现在，客户将在程序启动时拿到这个。"
keywords: "为你的python程序上锁：软件序列号生成器"
categories: ['Python']
tags: ['开发语言', 'Python']
artid: "146110365"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146110365
    alt: "为你的python程序上锁软件序列号生成器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146110365
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146110365
cover: https://bing.ee123.net/img/rand?artid=146110365
image: https://bing.ee123.net/img/rand?artid=146110365
img: https://bing.ee123.net/img/rand?artid=146110365
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     为你的python程序上锁：软件序列号生成器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_1">
     </a>
     序列号
    </h3>
    <p>
     很多同学可能开发了非常多的程序了，并且进行了
     <strong>
      exe
     </strong>
     的打包，可是由于没有使用序列号，程序被无限复制，导致收益下降。
    </p>
    <p>
     接下来我们来自己实现序列号的生成及使用，通过本文的学习，希望能够帮助到你！
    </p>
    <blockquote>
     <p>
      本文适合
      <strong>
       windows
      </strong>
      系统，
      <strong>
       linux
      </strong>
      系统原理相通，但代码有所不同。
     </p>
    </blockquote>
    <h3>
     <a id="_10">
     </a>
     安装库
    </h3>
    <pre><code>pip install wmi
pip install pycryptodome
</code></pre>
    <h3>
     <a id="_18">
     </a>
     结构流程图
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/88e724c63f894574aacd0e1b4393d294.png"/>
    </p>
    <p>
     我们首先要通过
     <strong>
      硬件信息、UUID和时间戳
     </strong>
     来生成一个
     <strong>
      协议文件
     </strong>
     ，再通过非对称加密
     <strong>
      RSA
     </strong>
     生成公钥和私钥。
    </p>
    <p>
     1. 当我们给客户程序的时候，会附带一个
     <strong>
      私钥
     </strong>
    </p>
    <p>
     2. 程序启动时会判断是否存在
     <strong>
      协议文件
     </strong>
     ，如果没有
     <strong>
      协议文件
     </strong>
     将会生成一个
     <strong>
      序列号
     </strong>
     ，客户需要把序列号发送给管理员
    </p>
    <p>
     3. 管理员获取
     <strong>
      序列号
     </strong>
     ，使用
     <strong>
      公钥
     </strong>
     进行加密生成
     <strong>
      协议文件
     </strong>
     ，将其发送给客户
    </p>
    <p>
     4. 客户将
     <strong>
      协议文件
     </strong>
     放在相应位置，程序使用
     <strong>
      私钥
     </strong>
     进行解密，与相应的
     <strong>
      序列号
     </strong>
     进行对比
    </p>
    <p>
     5.
     <strong>
      协议文件
     </strong>
     解密成功，通过
     <strong>
      协议文件序列号
     </strong>
     中的时间戳信息判断是否过期
    </p>
    <p>
     6. 当时间戳未过期，则运行程序，反之无法启动，提示
     <strong>
      序列号过期
     </strong>
    </p>
    <h3>
     <a id="_40">
     </a>
     结构代码
    </h3>
    <h4>
     <a id="1_RSA_43">
     </a>
     1. 生成RSA公钥与私钥文件
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">from</span> Crypto <span class="token keyword">import</span> Random
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_v1_5
<span class="token keyword">import</span> os
<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> base64

CURRENT_FOLDER_PATH <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">make_rsa_key</span><span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    生成公钥和私钥
    :return:
    """</span>
    <span class="token comment"># 伪随机数生成器</span>
    random_gen <span class="token operator">=</span> Random<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read
    <span class="token comment"># 生成秘钥对实例对象：1024是秘钥的长度</span>
    rsa <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span>length<span class="token punctuation">,</span> random_gen<span class="token punctuation">)</span>
    private_pem <span class="token operator">=</span> rsa<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
    public_pem <span class="token operator">=</span> rsa<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> private_pem<span class="token punctuation">,</span> public_pem


<span class="token keyword">def</span> <span class="token function">rsa_encrypt</span><span class="token punctuation">(</span>pub_key<span class="token punctuation">,</span> content<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    rsa数据加密，单次加密串的长度最大为 (key_size/8)-11
    1024bit的证书用100， 2048bit的证书用 200
    :param pub_key:
    :param content:
    :param length:
    :return:
    """</span>
    pub_key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>pub_key<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>pub_key<span class="token punctuation">)</span>
    content <span class="token operator">=</span> content<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>content<span class="token punctuation">[</span>i<span class="token punctuation">:</span> i <span class="token operator">+</span> length<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">rsa_decrypt</span><span class="token punctuation">(</span>pri_key<span class="token punctuation">,</span> encrypt_txt<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    rsa信息解密
    1024bit的证书用128，2048bit证书用256位
    :param pri_key:
    :param encrypt_txt:
    :param length:
    :return:
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        encrypt_txt <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>encrypt_txt<span class="token punctuation">)</span>
        encrypt_txt <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>encrypt_txt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        pri_obj <span class="token operator">=</span> RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>pri_key<span class="token punctuation">)</span>
        pri_obj <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>pri_obj<span class="token punctuation">)</span>
        res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encrypt_txt<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pri_obj<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>encrypt_txt<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> length<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token keyword">def</span> <span class="token function">rsa_file_generator</span><span class="token punctuation">(</span>pri_path<span class="token punctuation">,</span> pub_path<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    生成公私钥文件
    :param pri_path: 私钥文件地址
    :param pub_path: 公钥文件地址
    :return:
    """</span>
    pri_key<span class="token punctuation">,</span> pub_key <span class="token operator">=</span> make_rsa_key<span class="token punctuation">(</span>length<span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pri_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pri_key<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pub_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pub_key<span class="token punctuation">)</span>

    <span class="token keyword">return</span> pri_key<span class="token punctuation">,</span> pub_key


<span class="token keyword">def</span> <span class="token function">get_or_make_rsa</span><span class="token punctuation">(</span>refresh<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    生成或获取公私钥内容
    :return:
    """</span>

    folder_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>CURRENT_FOLDER_PATH<span class="token punctuation">,</span> <span class="token string">'pem'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span>

    file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span>
    now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    now_str <span class="token operator">=</span> now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y%m%d%H%M%S'</span><span class="token punctuation">)</span>

    new_pri_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>now_str<span class="token punctuation">}</span></span><span class="token string">_private.pem'</span></span><span class="token punctuation">)</span>
    new_pub_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>now_str<span class="token punctuation">}</span></span><span class="token string">_public.pem'</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 公钥和私钥文件不存在</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>file_list<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        pri_key<span class="token punctuation">,</span> pub_key <span class="token operator">=</span> rsa_file_generator<span class="token punctuation">(</span>
            new_pri_path<span class="token punctuation">,</span>
            new_pub_path<span class="token punctuation">,</span>
            <span class="token number">1024</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        pri_path <span class="token operator">=</span> <span class="token string">''</span>
        pub_path <span class="token operator">=</span> <span class="token string">''</span>

        <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'private.pem'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                pri_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token builtin">file</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'public.pem'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                pub_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> pri_path <span class="token keyword">or</span> <span class="token keyword">not</span> pub_path<span class="token punctuation">:</span>
            pri_key<span class="token punctuation">,</span> pub_key <span class="token operator">=</span> rsa_file_generator<span class="token punctuation">(</span>
                new_pri_path<span class="token punctuation">,</span>
                new_pub_path<span class="token punctuation">,</span>
                <span class="token number">1024</span>
            <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 手动更新私钥</span>
            <span class="token keyword">if</span> refresh<span class="token punctuation">:</span>
                pri_key<span class="token punctuation">,</span> pub_key <span class="token operator">=</span> rsa_file_generator<span class="token punctuation">(</span>
                    new_pri_path<span class="token punctuation">,</span>
                    new_pub_path<span class="token punctuation">,</span>
                    <span class="token number">1024</span>
                <span class="token punctuation">)</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>pri_path<span class="token punctuation">)</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>pub_path<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pri_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    pri_key <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pub_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    pub_key <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> pri_key<span class="token punctuation">,</span> pub_key
</code></pre>
    <p>
     使用
     <strong>
      get_or_make_rsa()
     </strong>
     方法即可获取公钥与私钥，程序会生成一个
     <strong>
      pem
     </strong>
     文件夹保存相应的公钥和私钥。
    </p>
    <p>
     如果需要更新公钥与私钥，只要调用
     <strong>
      get_or_make_rsa()
     </strong>
     方法时，传入
     <strong>
      refresh
     </strong>
     的值为
     <strong>
      True
     </strong>
     即可。
    </p>
    <blockquote>
     <p>
      <strong>
       CURRENT_FOLDER_PATH
      </strong>
      全局变量保存的是当前程序的绝对路径，就算是打包后的
      <strong>
       exe
      </strong>
      也可以正确获取。
     </p>
    </blockquote>
    <h4>
     <a id="2__194">
     </a>
     2. 序列号生成
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">import</span> uuid
<span class="token keyword">import</span> wmi
<span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> zip_longest


<span class="token keyword">def</span> <span class="token function">get_license_txt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> wmi<span class="token punctuation">.</span>WMI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取第一个硬盘的序列号</span>
    disk_number <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> physical_disk <span class="token keyword">in</span> c<span class="token punctuation">.</span>Win32_DiskDrive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        disk_number <span class="token operator">=</span> physical_disk<span class="token punctuation">.</span>SerialNumber<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    <span class="token comment"># 获取第一个CPU的序列号</span>
    cpu_number <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> cpu <span class="token keyword">in</span> c<span class="token punctuation">.</span>Win32_Processor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cpu_number <span class="token operator">=</span> cpu<span class="token punctuation">.</span>ProcessorId<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    <span class="token comment"># 获取第一个BIOS的序列号</span>
    bios_number <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> bios <span class="token keyword">in</span> c<span class="token punctuation">.</span>Win32_BIOS<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        bios_number <span class="token operator">=</span> bios<span class="token punctuation">.</span>SerialNumber<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    uid <span class="token operator">=</span> get_a_guid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    paired <span class="token operator">=</span> zip_longest<span class="token punctuation">(</span>disk_number<span class="token punctuation">,</span> cpu_number<span class="token punctuation">,</span> bios_number<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> fillvalue<span class="token operator">=</span><span class="token string">'_'</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>pair<span class="token punctuation">)</span> <span class="token keyword">for</span> pair <span class="token keyword">in</span> paired<span class="token punctuation">]</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>result<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>content<span class="token punctuation">}</span></span><span class="token string">==</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>uid<span class="token punctuation">}</span></span><span class="token string">'</span></span>
</code></pre>
    <p>
     我们使用了一个相对复杂的方式将
     <strong>
      硬盘、cpu、BIOS
     </strong>
     的序列号与一个
     <strong>
      UUID
     </strong>
     进行组合，竟将其进行
     <strong>
      md5
     </strong>
     加密，最后将这个
     <strong>
      加密结果
     </strong>
     与
     <strong>
      UUID
     </strong>
     明文组合在一起作为一个
     <strong>
      完整的软件序列号
     </strong>
     。
    </p>
    <p>
     现在，客户将在程序启动时拿到这个
     <strong>
      软件序列号
     </strong>
     ，再将这个软件序列号发送给管理员进行加密即可。
    </p>
    <blockquote>
     <p>
      加密方法将使用之前的
      <strong>
       rsa_encrypt()
      </strong>
      方法。
     </p>
    </blockquote>
    <h4>
     <a id="3__237">
     </a>
     3. 加密软件序列号
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">make_license_key_file</span><span class="token punctuation">(</span>license_txt<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    创建协议文件
    :param license_txt: 软件序列号
    :param days: 有效天数
    :return: 
    '''</span>
    pri_key<span class="token punctuation">,</span> pub_key <span class="token operator">=</span> get_or_make_rsa<span class="token punctuation">(</span><span class="token punctuation">)</span>

    s_list <span class="token operator">=</span> license_txt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'=='</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s_list<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    uid <span class="token operator">=</span> s_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

    timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> days <span class="token operator">*</span> <span class="token number">86400</span>
    new_license_text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>license_txt<span class="token punctuation">}</span></span><span class="token string">==</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>timestamp<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    res <span class="token operator">=</span> rsa_encrypt<span class="token punctuation">(</span>pub_key<span class="token punctuation">,</span> new_license_text<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

    folder_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>CURRENT_FOLDER_PATH<span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>folder_path<span class="token punctuation">)</span>

    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>uid<span class="token punctuation">}</span></span><span class="token string">.key'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> file_path
</code></pre>
    <p>
     以当前时间戳为基准添加有效天数，然后将客户发送过来的序列号再进行一次组合，最后通过
     <strong>
      公钥
     </strong>
     进行加密，生成一个
     <strong>
      协议文件
     </strong>
     发送给客户。
    </p>
    <h4>
     <a id="4__272">
     </a>
     4. 验证协议文件
    </h4>
    <pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">auth_license</span><span class="token punctuation">(</span>key_file_path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> pem_file_path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> wmi<span class="token punctuation">.</span>WMI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    disk_number <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> physical_disk <span class="token keyword">in</span> c<span class="token punctuation">.</span>Win32_DiskDrive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        disk_number <span class="token operator">=</span> physical_disk<span class="token punctuation">.</span>SerialNumber<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    cpu_number <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> cpu <span class="token keyword">in</span> c<span class="token punctuation">.</span>Win32_Processor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cpu_number <span class="token operator">=</span> cpu<span class="token punctuation">.</span>ProcessorId<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    bios_number <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> bios <span class="token keyword">in</span> c<span class="token punctuation">.</span>Win32_BIOS<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        bios_number <span class="token operator">=</span> bios<span class="token punctuation">.</span>SerialNumber<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>

    <span class="token comment"># 协议文件不存在，无法通过</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>key_file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token comment"># 私钥文件不存在，无法通过</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>pem_file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token comment"># 读取协议文件内容</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>key_file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        key_res <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 读取私钥内容</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pem_file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        pem_res <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

    res <span class="token operator">=</span> rsa_decrypt<span class="token punctuation">(</span>pem_res<span class="token punctuation">,</span> key_res<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 解密失败，无法通过</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> res<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    s_list <span class="token operator">=</span> res<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'=='</span><span class="token punctuation">)</span>

    <span class="token comment"># 没有两个等号的内容，无法通过</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s_list<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    uid <span class="token operator">=</span> s_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    paired <span class="token operator">=</span> zip_longest<span class="token punctuation">(</span>disk_number<span class="token punctuation">,</span> cpu_number<span class="token punctuation">,</span> bios_number<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> fillvalue<span class="token operator">=</span><span class="token string">'_'</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>pair<span class="token punctuation">)</span> <span class="token keyword">for</span> pair <span class="token keyword">in</span> paired<span class="token punctuation">]</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>result<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 序列号不一致，无法通过</span>
    <span class="token keyword">if</span> content <span class="token operator">!=</span> s_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s_list<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token comment"># 无法变为时间戳，无法通过</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    now_timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 在有效时间内，通过</span>
    <span class="token keyword">if</span> now_timestamp <span class="token operator">&lt;=</span> timestamp<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre>
    <p>
     这个验证过程其实就是再次进行一次
     <strong>
      序列号
     </strong>
     组合，来判断是否与
     <strong>
      协议文件
     </strong>
     一致，其后还需判断是否在有效期内。
    </p>
    <h3>
     <a id="_345">
     </a>
     结尾
    </h3>
    <p>
     我相信如果认真看完文章的朋友已经可以实现自己的序列号生成器了，不过在此之前我需要申明这个文章的代码还不是完整版，这里提几个优化点：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        定时验证
       </strong>
       ：定时判断是否超过有效期，防止客户程序未关闭，就算超过有效期还能继续使用
      </p>
     </li>
     <li>
      <p>
       <strong>
        打包为加密模块
       </strong>
       ：当前代码为明文代码，由于
       <strong>
        python
       </strong>
       为解释器语言，如果不加密打包，很容易被破解规则
      </p>
     </li>
     <li>
      <p>
       <strong>
        添加可视化窗口
       </strong>
       ：为了方便使用，可以将程序设计为可视化窗口模式，最简单的方式使用
       <strong>
        TK
       </strong>
       创建
      </p>
     </li>
    </ol>
    <p>
     当然，如果你不想自己写，推荐可以直接使用
     <strong>
      pyarmor
     </strong>
     ，这也是国人开发的一个加密库，包含加密、有效期、许可证。
    </p>
    <p>
     如果这篇文章对你有帮助，点个赞让我知道哦！
    </p>
    <h3>
     <a id="_361">
     </a>
     干货分享
    </h3>
    <ul>
     <li>
      <a href="https://penguinservices.blog.csdn.net/article/details/145957933" rel="nofollow">
       软考系统架构设计师三科备考经验附学习资料
      </a>
     </li>
     <li>
      <a href="https://penguinservices.blog.csdn.net/article/details/145806840" rel="nofollow">
       信息安全管理体系（ISMS）制度模板分享
      </a>
     </li>
     <li>
      <a href="https://penguinservices.blog.csdn.net/article/details/145770107" rel="nofollow">
       免费文档翻译工具(支持word、pdf、ppt、excel)
      </a>
     </li>
     <li>
      <a href="https://penguinservices.blog.csdn.net/article/details/145715259" rel="nofollow">
       PuTTY中文版安装包
      </a>
     </li>
     <li>
      <a href="https://penguinservices.blog.csdn.net/article/details/145685469" rel="nofollow">
       MobaXterm中文版安装包
      </a>
     </li>
     <li>
      <a href="https://penguinservices.blog.csdn.net/article/details/146037842" rel="nofollow">
       pinginfoview网络诊断工具中文版
      </a>
      <br/>
      <a href="https://www.yooongchun.com/docs/notes/operation-system/linux/#df" rel="nofollow">
      </a>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f756e62756e74755f6c756f2f:61727469636c652f64657461696c732f313436313130333635" class_="artid" style="display:none">
 </p>
</div>


