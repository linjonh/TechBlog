---
layout: post
title: "使用kubeadm方式以及使用第三方工具sealos搭建K8S集群"
date: 2025-03-15 18:35:40 +0800
description: "kubeadm是官方社区推出的一个用于快速部署kubernetes集群的工具。"
keywords: "使用kubeadm方式以及使用第三方工具sealos搭建K8S集群"
categories: ['未分类']
tags: ['运维', '容器', 'Linux', 'Kubernetes', 'Java']
artid: "146231079"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146231079
    alt: "使用kubeadm方式以及使用第三方工具sealos搭建K8S集群"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146231079
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146231079
cover: https://bing.ee123.net/img/rand?artid=146231079
image: https://bing.ee123.net/img/rand?artid=146231079
img: https://bing.ee123.net/img/rand?artid=146231079
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用kubeadm方式以及使用第三方工具sealos搭建K8S集群
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <p>
    </p>
    <p>
    </p>
    <h2 id="kubeadm%E6%96%B9%E5%BC%8F%3A" name="kubeadm%E6%96%B9%E5%BC%8F%3A">
     kubeadm方式:
    </h2>
    <p>
     <span style="color:#be191c">
      kubeadm
     </span>
     是官方社区推出的一个用于快速部署kubernetes集群的工具。这个工具能通过两条指令完成一个kubernetes集群的部署：
    </p>
    <pre><code># 创建一个 Master 节点
kubeadm init

# 将一个 Node 节点加入到当前集群中
kubeadm join &lt;Master节点的IP和端口 &gt;</code></pre>
    <p>
     <strong>
      使用kubeadm方式搭建K8s集群主要分为以下几步：
     </strong>
    </p>
    <ul>
     <li>
      准备三台虚拟机，同时安装操作系统CentOS 7.x
     </li>
     <li>
      对三个安装之后的操作系统进行初始化操作
     </li>
     <li>
      在三个节点安装 docker kubelet kubeadm kubectl
     </li>
     <li>
      在master节点执行kubeadm init命令初始化
     </li>
     <li>
      在node节点上执行 kubeadm join命令，把node节点添加到当前集群
     </li>
     <li>
      配置CNI网络插件，用于节点之间的连通【失败了可以多试几次】
     </li>
     <li>
      通过拉取一个nginx进行测试，能否进行外网测试
     </li>
    </ul>
    <h2 id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E8%A6%81%E6%B1%82" name="%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E8%A6%81%E6%B1%82">
     一、安装要求
    </h2>
    <blockquote>
     <p>
      在开始之前，部署Kubernetes集群机器需要满足以下几个条件：
     </p>
     <ul>
      <li>
       一台或多台机器，操作系统 CentOS7.x-86_x64
      </li>
      <li>
       硬件配置：3GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多【
       <span style="background-color:#ffd900">
        注意master需要两核
       </span>
       】
      </li>
      <li>
       <span style="background-color:#ffd900">
        可以访问外网，需要拉取镜像，如果服务器不能上网，需要提前下载镜像并导入节点
       </span>
      </li>
      <li>
       <span style="background-color:#ffd900">
        禁止swap分区
       </span>
      </li>
     </ul>
    </blockquote>
    <h2 id="%E4%BA%8C%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" name="%E4%BA%8C%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">
     二、环境准备
    </h2>
    <table>
     <thead>
      <tr>
       <th>
        角色
       </th>
       <th>
        IP
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        master
       </td>
       <td>
        192.168.8.172
       </td>
      </tr>
      <tr>
       <td>
        node1
       </td>
       <td>
        192.168.8.173
       </td>
      </tr>
      <tr>
       <td>
        node2
       </td>
       <td>
        192.168.8.174
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      在每台机器上面执行下面命令：
     </strong>
    </p>
    <pre><code># 关闭防火墙
systemctl stop firewalld
systemctl disable firewalld

# 关闭selinux
# 永久关闭
sed -i 's/enforcing/disabled/' /etc/selinux/config  
# 临时关闭
setenforce 0  

# 关闭swap
# 临时
swapoff -a 
# 永久关闭
sed -ri 's/.*swap.*/#&amp;/' /etc/fstab

# 根据规划设置主机名【master节点上操作】
hostnamectl set-hostname k8s-master
# 根据规划设置主机名【node1节点操作】
hostnamectl set-hostname k8s-node01
# 根据规划设置主机名【node2节点操作】
hostnamectl set-hostname k8s-node02

# 在master添加hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.8.172 k8s-master
192.168.8.173 k8s-node01
192.168.8.174 k8s-node02
EOF


# 将桥接的IPv4流量传递到iptables的链
cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
# 生效
sysctl --system  

# 时间同步
yum install chrony -y
systemctl restart chronyd
</code></pre>
    <h2 id="%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85Docker%E3%80%81kubeadm%E3%80%81kubelet" name="%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85Docker%E3%80%81kubeadm%E3%80%81kubelet">
     二、安装Docker、kubeadm、kubelet
    </h2>
    <p>
     所有节点安装Docker/kubeadm/kubelet ，Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker
    </p>
    <h3 id="1%E3%80%81%E5%AE%89%E8%A3%85Docker" name="1%E3%80%81%E5%AE%89%E8%A3%85Docker">
     1、安装Docker
    </h3>
    <h4 id="%EF%BC%881%EF%BC%89%E9%A6%96%E5%85%88%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%8BDocker%E7%9A%84%E9%98%BF%E9%87%8Cyum%E6%BA%90" name="%EF%BC%881%EF%BC%89%E9%A6%96%E5%85%88%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%8BDocker%E7%9A%84%E9%98%BF%E9%87%8Cyum%E6%BA%90">
     （1）首先配置一下Docker的阿里yum源
    </h4>
    <pre><code>cat &gt;/etc/yum.repos.d/docker.repo&lt;&lt;EOF
[docker-ce-edge]
name=Docker CE Edge - \$basearch
baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\$basearch/edge
enabled=1
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
EOF</code></pre>
    <h4 id="%C2%A0%EF%BC%882%EF%BC%89%E7%84%B6%E5%90%8E%E7%94%A8yum%20%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85docker" name="%C2%A0%EF%BC%882%EF%BC%89%E7%84%B6%E5%90%8E%E7%94%A8yum%20%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85docker">
     （2）然后用yum 方式安装docker
    </h4>
    <pre><code># yum安装
yum -y install docker-ce

# 查看docker版本
docker --version  

# 启动docker
systemctl enable docker
systemctl start docker</code></pre>
    <h4 id="%EF%BC%883%EF%BC%89%E9%85%8D%E7%BD%AEDocker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8%C2%A0" name="%EF%BC%883%EF%BC%89%E9%85%8D%E7%BD%AEDocker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8%C2%A0">
     （3）配置Docker镜像加速器
    </h4>
    <pre><code>cat &gt;&gt; /etc/docker/daemon.json &lt;&lt; EOF
{
  "registry-mirrors": ["https://b9pmyelo.mirror.aliyuncs.com"]
}
EOF</code></pre>
    <h4 id="%EF%BC%884%EF%BC%89%E9%87%8D%E5%90%AFDocker%C2%A0" name="%EF%BC%884%EF%BC%89%E9%87%8D%E5%90%AFDocker%C2%A0">
     （4）重启Docker
    </h4>
    <pre><code>systemctl restart docker</code></pre>
    <h3 id="2%E3%80%81%E6%B7%BB%E5%8A%A0%C2%A0kubernetes%E8%BD%AF%E4%BB%B6%E6%BA%90" name="2%E3%80%81%E6%B7%BB%E5%8A%A0%C2%A0kubernetes%E8%BD%AF%E4%BB%B6%E6%BA%90">
     2、添加 kubernetes软件源
    </h3>
    <h4 id="%EF%BC%881%EF%BC%89%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%8Byum%E7%9A%84k8s%E8%BD%AF%E4%BB%B6%E6%BA%90" name="%EF%BC%881%EF%BC%89%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%8Byum%E7%9A%84k8s%E8%BD%AF%E4%BB%B6%E6%BA%90">
     （1）我们需要配置一下yum的k8s软件源
    </h4>
    <pre><code>cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</code></pre>
    <h4 id="%EF%BC%882%EF%BC%89%E5%AE%89%E8%A3%85kubeam%E3%80%81kubelet%E5%92%8Ckubectl" name="%EF%BC%882%EF%BC%89%E5%AE%89%E8%A3%85kubeam%E3%80%81kubelet%E5%92%8Ckubectl">
     （2）安装kubeam、kubelet和kubectl
    </h4>
    <pre><code># 安装kubelet、kubeadm、kubectl，同时指定版本
yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0
# 设置开机启动
systemctl enable kubelet</code></pre>
    <h3 id="3%E3%80%81%E9%83%A8%E7%BD%B2%20Kubernetes%20Master%EF%BC%88mster%20%E8%8A%82%E7%82%B9%E4%B8%8A%EF%BC%89%C2%A0" name="3%E3%80%81%E9%83%A8%E7%BD%B2%20Kubernetes%20Master%EF%BC%88mster%20%E8%8A%82%E7%82%B9%E4%B8%8A%EF%BC%89%C2%A0">
     3、部署 Kubernetes Master（mster 节点上）
    </h3>
    <pre><code>kubeadm init --apiserver-advertise-address=192.168.8.172 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.0 --service-cidr=10.96.0.0/12  --pod-network-cidr=10.244.0.0/16</code></pre>
    <p>
     <img alt="" height="457" src="https://i-blog.csdnimg.cn/direct/9150240c28924204b2bca33f56e6af46.png" width="1309">
      <strong>
       使用kubectl工具 【master节点操作】
      </strong>
     </img>
    </p>
    <pre><code> mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
    <p>
     执行完成后，我们可以使用下面命令，查看我们正在运行的节点：
    </p>
    <pre><code>kubectl get nodes</code></pre>
    <p>
     <img alt="" height="189" src="https://i-blog.csdnimg.cn/direct/88774fc4f20f4e0ea92a1793b48b68f3.png" width="1099"/>
    </p>
    <p>
     能够看到，目前有一个master节点已经运行了，但是还处于未准备状态
    </p>
    <p>
     下面我们还需要在Node节点执行其它的命令，将node1和node2加入到我们的master节点上
    </p>
    <h3 id="4%E3%80%81%E5%8A%A0%E5%85%A5%20Kubernetes%20Node%EF%BC%88%E5%9C%A8node%E8%8A%82%E7%82%B9%E4%B8%8A%E9%9D%A2%EF%BC%89%C2%A0" name="4%E3%80%81%E5%8A%A0%E5%85%A5%20Kubernetes%20Node%EF%BC%88%E5%9C%A8node%E8%8A%82%E7%82%B9%E4%B8%8A%E9%9D%A2%EF%BC%89%C2%A0">
     4、加入 Kubernetes Node（在node节点上面）
    </h3>
    <p>
     下面我们需要到 k8s-node01 和 k8s-node02服务器，执行下面的代码向集群添加新节点
    </p>
    <p>
     执行在kubeadm init输出的kubeadm join命令：
    </p>
    <p>
     <span style="background-color:#ffd900">
      注意，以下的命令是在master初始化完成后，每个人的都不一样！！！需要复制自己生成
     </span>
    </p>
    <pre><code>kubeadm join 192.168.8.172:6443 --token qpoymy.yx2t97sn368q4udl \
    --discovery-token-ca-cert-hash sha256:948606060e1a95f36daeac85cde3b231f544904802eed017060391bb606ddf31
</code></pre>
    <p>
     <img alt="" height="588" src="https://i-blog.csdnimg.cn/direct/3b41742875eb4d80951ae5bba6275c10.png" width="1320">
      <img alt="" height="567" src="https://i-blog.csdnimg.cn/direct/f19201bf7bfb4bde844132f61a78bc00.png" width="1312">
       默认token有效期为24小时，当过期之后，该token就不可用了。这时就需要重新创建token，操作如下：
      </img>
     </img>
    </p>
    <pre><code>kubeadm token create --print-join-command
</code></pre>
    <p>
     当我们把两个节点都加入进来后，我们就可以去Master节点 执行下面命令查看情况
    </p>
    <pre><code>kubectl get node</code></pre>
    <p>
     <img alt="" height="160" src="https://i-blog.csdnimg.cn/direct/ee8df9e6c7a44d6c860afdf5c2a37cc2.png" width="750"/>
    </p>
    <h2 id="%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B2%20CNI%20%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6" name="%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B2%20CNI%20%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6">
     三、部署 CNI 网络插件
    </h2>
    <p>
     <strong>
      网络插件选型对比
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        插件
       </th>
       <th>
        网络模式
       </th>
       <th>
        性能损耗
       </th>
       <th>
        适用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Flannel
       </td>
       <td>
        VXLAN
       </td>
       <td>
        8-10%
       </td>
       <td>
        中小型集群
       </td>
      </tr>
      <tr>
       <td>
        Calico
       </td>
       <td>
        BGP
       </td>
       <td>
        3-5%
       </td>
       <td>
        大规模生产环境
       </td>
      </tr>
      <tr>
       <td>
        Cilium
       </td>
       <td>
        eBPF
       </td>
       <td>
        1-3%
       </td>
       <td>
        云原生安全场景
       </td>
      </tr>
      <tr>
       <td>
        Weave
       </td>
       <td>
        mesh
       </td>
       <td>
        10-15%
       </td>
       <td>
        混合云环境
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id="1.%E4%BD%BF%E7%94%A8%20Calico%20%E6%8F%92%E4%BB%B6" name="1.%E4%BD%BF%E7%94%A8%20Calico%20%E6%8F%92%E4%BB%B6">
     1.使用 Calico 插件
    </h3>
    <p>
     由于网络的问题，我将需要的文件（
     <span style="background-color:#ffd900">
      calico.yaml和calico.tar.gz
     </span>
     ）下载到本地，然后再上传到主机上面
    </p>
    <h4 id="%EF%BC%881%EF%BC%89%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%EF%BC%9A%E2%80%8B%E7%BC%96%E8%BE%91" name="%EF%BC%881%EF%BC%89%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%EF%BC%9A%E2%80%8B%E7%BC%96%E8%BE%91">
     （1）上传文件：
     <img alt="" height="82" src="https://i-blog.csdnimg.cn/direct/4c6e95fcbd27416a9db0cc59bebba73c.png" width="660"/>
    </h4>
    <h4 id="%EF%BC%882%EF%BC%89%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%EF%BC%9A" name="%EF%BC%882%EF%BC%89%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%EF%BC%9A">
     （2）拉取镜像：
    </h4>
    <p>
     [root@k8s-master~]# docker load -i calico.tar.gz  （
     <span style="background-color:#ffd900">
      需要再三个节点上面操作
     </span>
     ）
     <img alt="" height="288" src="https://i-blog.csdnimg.cn/direct/90f081a0837b4c89a3092f184f961a21.png" width="1546"/>
    </p>
    <h4 id="%EF%BC%883%EF%BC%89%E9%83%A8%E7%BD%B2calico%E7%BD%91%E7%BB%9C%EF%BC%9A" name="%EF%BC%883%EF%BC%89%E9%83%A8%E7%BD%B2calico%E7%BD%91%E7%BB%9C%EF%BC%9A">
     （3）部署calico网络：
    </h4>
    <p>
     [root@k8s-master ~]# kubectl apply -f calico.yaml
    </p>
    <p>
     <img alt="" height="177" src="https://i-blog.csdnimg.cn/direct/69e3794960194218bd8eeb590d803f3f.png" width="966"/>
    </p>
    <h4 id="%EF%BC%884%EF%BC%89%E5%8F%91%E7%8E%B0%E5%87%BA%E7%8E%B0%E4%BA%86%E9%97%AE%E9%A2%98%EF%BC%9A" name="%EF%BC%884%EF%BC%89%E5%8F%91%E7%8E%B0%E5%87%BA%E7%8E%B0%E4%BA%86%E9%97%AE%E9%A2%98%EF%BC%9A">
     （4）发现出现了问题：
    </h4>
    <p>
     原因是 Kubernetes 集群版本不支持当前 calico 版本中
     <code>
      calico.yaml
     </code>
     文件使用的
     <code>
      policy/v1
     </code>
     版本的
     <code>
      PodDisruptionBudget
     </code>
     资源类型
    </p>
    <p>
     <strong>
      我们可以去检查 K8S 集群支持的 API 版本
     </strong>
     ：运行命令
     <strong>
      <code>
       kubectl api-versions | grep policy
      </code>
     </strong>
     ，查看当前 K8S 集群支持的
     <code>
      policy
     </code>
     相关 API 版本。
    </p>
    <p>
     [root@k8s-master ~]#
     <span style="background-color:#ffd900">
      kubectl api-versions | grep policy
     </span>
    </p>
    <p>
     policy/v1beta1
    </p>
    <p>
     然后我们需要修改calico.yaml 文件，在文件内搜索
     <span style="background-color:#d4e9d5">
     </span>
     <code>
      <span style="background-color:#d4e9d5">
       policy/v1
      </span>
     </code>
     ，将
     <span style="background-color:#d4e9d5">
      涉及
     </span>
     <code>
      <span style="background-color:#d4e9d5">
       PodDisruptionBudget
      </span>
     </code>
     <span style="background-color:#d4e9d5">
      的部分
     </span>
     改为
     <code>
      <span style="background-color:#d4e9d5">
       policy/v1beta1
      </span>
     </code>
    </p>
    <p>
     [root@k8s-master ~]# kubectl apply -f calico.yaml   删掉之前创建的，然后再次执行
    </p>
    <h4 id="%EF%BC%885%EF%BC%89%E6%A3%80%E6%9F%A5%EF%BC%9A" name="%EF%BC%885%EF%BC%89%E6%A3%80%E6%9F%A5%EF%BC%9A">
     （5）检查：
    </h4>
    <p>
     <img alt="" height="162" src="https://i-blog.csdnimg.cn/direct/773a25e292ea4c2fab8aea558ee03d35.png" width="832"/>
    </p>
    <p>
     <img alt="" height="535" src="https://i-blog.csdnimg.cn/direct/395f493b238b4b5cbc08ee438429cadf.png" width="1017"/>
    </p>
    <h3 id="%23%E5%88%B0%E6%AD%A4%E4%B8%BA%E6%AD%A4kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E3%80%82%C2%A0" name="%23%E5%88%B0%E6%AD%A4%E4%B8%BA%E6%AD%A4kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E3%80%82%C2%A0">
     <em>
      <strong>
       #到此为此kubeadm安装k8s集群安装完成。
      </strong>
     </em>
    </h3>
    <p>
    </p>
    <h2 id="Sealos%20%E6%96%B9%E5%BC%8F%EF%BC%9A" name="Sealos%20%E6%96%B9%E5%BC%8F%EF%BC%9A">
     Sealos 方式：
    </h2>
    <h2 id="%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" name="%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">
     一、环境准备
    </h2>
    <blockquote>
     <p>
      所有主机上面操作：
     </p>
     <p>
      1.主机名
     </p>
     <p>
      hostnamectl set-hostname xxx
      <br/>
      2. 主机名解析
      <br/>
      192.168.8.177 k8s-master
      <br/>
      192.168.8.143 k8s-node01
      <br/>
      192.168.8.143 k8s-node02
     </p>
     <p>
      3.关闭系统防火墙
     </p>
     <p>
      4.时间同步
     </p>
    </blockquote>
    <h2 id="%E4%BA%8C%E3%80%81k8s-master%20%E4%B8%8A%E5%AE%89%E8%A3%85sealos" name="%E4%BA%8C%E3%80%81k8s-master%20%E4%B8%8A%E5%AE%89%E8%A3%85sealos">
     二、k8s-master 上安装sealos
    </h2>
    <p>
     <img alt="" height="150" src="https://i-blog.csdnimg.cn/direct/2daf0ca4ea1a4a4dbdb6f5a1bc6e185c.png" width="738"/>
    </p>
    <h2 id="%E4%B8%89%E3%80%81sealos%20cli%E9%83%A8%E7%BD%B2K8S%E9%9B%86%E7%BE%A4" name="%E4%B8%89%E3%80%81sealos%20cli%E9%83%A8%E7%BD%B2K8S%E9%9B%86%E7%BE%A4">
     三、sealos cli部署K8S集群
    </h2>
    <ul>
     <li>
      <p>
       需要在 K8s 集群的
       <strong>
        第一个 master 节点
       </strong>
       上运行
       <code>
        sealos run
       </code>
       命令，目前
       <strong>
        集群外的节点不支持集群安装
       </strong>
       。
      </p>
     </li>
     <li>
      <p>
       建议使用干净的操作系统来创建集群。
       <strong>
        不要自己装 Docker！
       </strong>
      </p>
     </li>
    </ul>
    <blockquote>
     <p>
      只在 k8s-master 上操作：
     </p>
     <p>
      [root@k8s-master ~]#
      <span style="color:#b95514">
       sealos run registry.cn-shanghai.aliyuncs.com/labring/kubernetes-docker:v1.30.5 registry.cn-shanghai.aliyuncs.com/labring/helm:v3.9.4 registry.cn-shanghai.aliyuncs.com/labring/calico:v3.26.1 --masters 192.168.8.177 --nodes 192.168.8.143,192.168.8.147 -p '123'
      </span>
     </p>
    </blockquote>
    <p>
     参数说明：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        参数名
       </th>
       <th>
        参数值示例
       </th>
       <th>
        参数说明
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        --masters
       </td>
       <td>
        192.168.8.177
       </td>
       <td>
        K8s master 节点地址列表
       </td>
      </tr>
      <tr>
       <td>
        --nodes
       </td>
       <td>
        192.168.8.143,192.168.8.147
       </td>
       <td>
        K8s node 节点地址列表
       </td>
      </tr>
      <tr>
       <td>
        --ssh-passwd
       </td>
       <td>
        [your-ssh-passwd]
       </td>
       <td>
        ssh 登录密码
       </td>
      </tr>
      <tr>
       <td>
        kubernetes
       </td>
       <td>
        labring/kubernetes-docker:v1.30.5
       </td>
       <td>
        K8s 集群镜像
       </td>
      </tr>
     </tbody>
    </table>
    <h3 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E5%87%BA%E7%8E%B0%E8%BF%99%E4%B8%AA%E4%BB%A3%E8%A1%A8%E9%83%A8%E7%BD%B2%E6%88%90%E5%8A%9F%EF%BC%9A%E2%80%8B%E7%BC%96%E8%BE%91" name="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E5%87%BA%E7%8E%B0%E8%BF%99%E4%B8%AA%E4%BB%A3%E8%A1%A8%E9%83%A8%E7%BD%B2%E6%88%90%E5%8A%9F%EF%BC%9A%E2%80%8B%E7%BC%96%E8%BE%91">
     <img alt="" height="268" src="https://i-blog.csdnimg.cn/direct/7d3a71f1057d425b8a3398b1791879d8.png" width="1743"/>
     出现这个代表部署成功：
     <img alt="" height="604" src="https://i-blog.csdnimg.cn/direct/59e4311e8f644a95920fac2e23370b25.png" width="1220"/>
    </h3>
    <h3 id="%E6%A3%80%E6%9F%A5%EF%BC%9A" name="%E6%A3%80%E6%9F%A5%EF%BC%9A">
     检查：
    </h3>
    <p>
     <img alt="" height="772" src="https://i-blog.csdnimg.cn/direct/a85b8d7898bb4510aa440aa85a985e4f.png" width="1231"/>
    </p>
    <h3 id="%E7%84%B6%E5%90%8E%E9%9C%80%E8%A6%81%E5%86%8D%E5%90%84%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8%EF%BC%8C%E4%B8%8D%E7%84%B6%E5%8F%AF%E8%83%BD%E5%90%8E%E9%9D%A2%E5%81%9A%E5%AE%9E%E9%AA%8C%E7%9A%84%E6%97%B6%E5%80%99%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E4%B8%8D%E4%B8%8B%E6%9D%A5%EF%BC%9A" name="%E7%84%B6%E5%90%8E%E9%9C%80%E8%A6%81%E5%86%8D%E5%90%84%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8%EF%BC%8C%E4%B8%8D%E7%84%B6%E5%8F%AF%E8%83%BD%E5%90%8E%E9%9D%A2%E5%81%9A%E5%AE%9E%E9%AA%8C%E7%9A%84%E6%97%B6%E5%80%99%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96%E4%B8%8D%E4%B8%8B%E6%9D%A5%EF%BC%9A">
     然后需要再各个节点上配置镜像加速器，不然可能后面做实验的时候镜像拉取不下来：
    </h3>
    <p>
     <img alt="" height="708" src="https://i-blog.csdnimg.cn/direct/c8dd5618ad294dabbcd80856200ebee6.png" width="948"/>
    </p>
    <h3 id="%E6%B5%8B%E8%AF%95%EF%BC%9A%E2%80%8B%E7%BC%96%E8%BE%91Kubectl%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%20%EF%BC%9A" name="%E6%B5%8B%E8%AF%95%EF%BC%9A%E2%80%8B%E7%BC%96%E8%BE%91Kubectl%E5%91%BD%E4%BB%A4%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%20%EF%BC%9A">
     测试：
     <img alt="" height="300" src="https://i-blog.csdnimg.cn/direct/c0748b2f5682437cbf3ae3dabddaf00e.png" width="1096"/>
     <strong>
      Kubectl命令自动补全
     </strong>
     ：
    </h3>
    <blockquote>
     <p>
      yum -y install bash-completion
      <br/>
      source /usr/share/bash-completion/bash_completion
      <br/>
      source &lt;(kubectl completion bash)
      <br/>
      echo "source &lt;(kubectl completion bash)" &gt;&gt; ~/.bashrc
     </p>
    </blockquote>
    <h3 id="" name="">
    </h3>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38333334323235312f:61727469636c652f64657461696c732f313436323331303739" class_="artid" style="display:none">
 </p>
</div>


