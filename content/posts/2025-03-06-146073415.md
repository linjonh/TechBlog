---
layout: post
title: "使用-Kotlin-拆分大文本文件"
date: 2025-03-06 16:21:43 +0800
description: "在实际开发过程中，我们经常会遇到需要处理大文本文件的场景，比如日志文件、小说文本等。当文件过大时，直接打开可能会导致程序卡顿甚至崩溃。为了解决这个问题，我们可以将大文本文件按指定大小拆分成多个小文件，方便处理和查看"
keywords: "使用 Kotlin 拆分大文本文件"
categories: ['未分类']
tags: ['Kotlin']
artid: "146073415"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146073415
    alt: "使用-Kotlin-拆分大文本文件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146073415
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146073415
cover: https://bing.ee123.net/img/rand?artid=146073415
image: https://bing.ee123.net/img/rand?artid=146073415
img: https://bing.ee123.net/img/rand?artid=146073415
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用 Kotlin 拆分大文本文件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在实际开发过程中，我们经常会遇到需要处理大文本文件的场景，比如日志文件、小说文本等。当文件过大时，直接打开可能会导致程序卡顿甚至崩溃。为了解决这个问题，我们可以将大文本文件按指定大小拆分成多个小文件，方便处理和查看。
    </p>
    <p>
     本文介绍如何使用 Kotlin 实现文本文件拆分的功能，并提供完整代码示例。
    </p>
    <h3>
     <a id="_4">
     </a>
     功能需求
    </h3>
    <ul>
     <li>
      读取一个大文本文件。
     </li>
     <li>
      按照指定的字符数（如 190000 字符）拆分文件。
     </li>
     <li>
      处理不同的文件编码（支持 UTF-8、GBK、UTF-16）。
     </li>
     <li>
      将拆分后的文件存放到一个与原文件同名的文件夹中。
     </li>
     <li>
      保留原始文件的扩展名，文件名格式为
      <code>
       文件名_1.txt
      </code>
      ，
      <code>
       文件名_2.txt
      </code>
      。
     </li>
    </ul>
    <h3>
     <a id="_12">
     </a>
     代码实现
    </h3>
    <p>
     我们编写一个
     <code>
      splitTxtFile
     </code>
     函数来实现该功能，并确保能够处理不同的编码。
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>Charset

<span class="token comment">/**
 * 按指定字符数拆分大文本文件，并存放到与原文件同名的文件夹中。
 * 支持 UTF-8 / GBK / UTF-16 编码自动切换，防止编码不兼容问题。
 *
 * @param filePath 要拆分的文件路径
 * @param maxChars 每个分割文件的最大字符数
 * @param encodingList 尝试使用的字符编码列表
 */</span>
<span class="token keyword">fun</span> <span class="token function">splitTxtFile</span><span class="token punctuation">(</span>filePath<span class="token operator">:</span> String<span class="token punctuation">,</span> maxChars<span class="token operator">:</span> Int<span class="token punctuation">,</span> encodingList<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"UTF-8"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"GBK"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"UTF-16"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> file <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"文件不存在，请检查路径"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 尝试不同编码方式打开文件，防止编码错误</span>
    <span class="token keyword">var</span> reader<span class="token operator">:</span> BufferedReader<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>encoding <span class="token keyword">in</span> encodingList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            reader <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">bufferedReader</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>  <span class="token comment">// 成功读取则跳出循环</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> UnsupportedEncodingException<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> IOException<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>reader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"无法解析文件编码"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取文件所在目录、文件名（无后缀）和扩展名</span>
    <span class="token keyword">val</span> parentDir <span class="token operator">=</span> file<span class="token punctuation">.</span>parent <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">"."</span></span>
    <span class="token keyword">val</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span>nameWithoutExtension
    <span class="token keyword">val</span> fileExt <span class="token operator">=</span> file<span class="token punctuation">.</span>extension

    <span class="token comment">// 创建新文件夹存放分割后的文件</span>
    <span class="token keyword">val</span> newFolder <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>parentDir<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newFolder<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> newFolder<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> partContent <span class="token operator">=</span> <span class="token function">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> partNum <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token comment">// 逐行读取文件内容，防止一次性读取导致内存溢出</span>
    reader<span class="token punctuation">.</span><span class="token function">useLines</span> <span class="token punctuation">{<!-- --></span> lines <span class="token operator">-&gt;</span>
        lines<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{<!-- --></span> line <span class="token operator">-&gt;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>partContent<span class="token punctuation">.</span>length <span class="token operator">+</span> line<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> maxChars<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">savePartFile</span><span class="token punctuation">(</span>newFolder<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> fileExt<span class="token punctuation">,</span> partNum<span class="token punctuation">,</span> partContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                partContent<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                partNum<span class="token operator">++</span>
            <span class="token punctuation">}</span>
            partContent<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"\n"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 处理最后一部分</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>partContent<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">savePartFile</span><span class="token punctuation">(</span>newFolder<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> fileExt<span class="token punctuation">,</span> partNum<span class="token punctuation">,</span> partContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"文件拆分完成，共生成 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">partNum</span></span><span class="token string"> 个文件。"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 保存拆分后的文件到新目录
 * @param folder 存放文件的文件夹
 * @param baseName 原始文件名（无扩展名）
 * @param ext 原始文件扩展名
 * @param partNum 拆分的文件序号
 * @param content 文件内容
 */</span>
<span class="token keyword">fun</span> <span class="token function">savePartFile</span><span class="token punctuation">(</span>folder<span class="token operator">:</span> File<span class="token punctuation">,</span> baseName<span class="token operator">:</span> String<span class="token punctuation">,</span> ext<span class="token operator">:</span> String<span class="token punctuation">,</span> partNum<span class="token operator">:</span> Int<span class="token punctuation">,</span> content<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> newFile <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">baseName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">partNum</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ext</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    newFile<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> Charsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> filePath <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"C:/abc.txt"</span></span>
    <span class="token keyword">val</span> maxChars <span class="token operator">=</span> <span class="token number">10240000</span> <span class="token comment">// 每个文件10MB</span>
    <span class="token function">splitTxtFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> maxChars<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="_106">
     </a>
     代码解析
    </h3>
    <h4>
     <a id="1__108">
     </a>
     1. 处理文件编码
    </h4>
    <p>
     不同的文本文件可能使用不同的编码格式，如 UTF-8、GBK、UTF-16。为了避免编码错误，我们提供了一个编码列表，代码会尝试使用不同编码打开文件，直到成功读取。
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">var</span> reader<span class="token operator">:</span> BufferedReader<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>encoding <span class="token keyword">in</span> encodingList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        reader <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">bufferedReader</span><span class="token punctuation">(</span>Charset<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> UnsupportedEncodingException<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">continue</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> IOException<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2__126">
     </a>
     2. 创建存放分割文件的目录
    </h4>
    <p>
     我们获取原始文件所在的目录，并创建一个与原文件同名的文件夹，用于存放拆分后的文件。
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">val</span> parentDir <span class="token operator">=</span> file<span class="token punctuation">.</span>parent <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">"."</span></span>
<span class="token keyword">val</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span>nameWithoutExtension
<span class="token keyword">val</span> fileExt <span class="token operator">=</span> file<span class="token punctuation">.</span>extension
<span class="token keyword">val</span> newFolder <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>parentDir<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newFolder<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> newFolder<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="3__138">
     </a>
     3. 按指定大小拆分文件
    </h4>
    <p>
     为了避免一次性读取整个文件导致内存溢出，我们使用
     <code>
      useLines
     </code>
     逐行读取文件内容，并在达到
     <code>
      maxChars
     </code>
     限制时将当前内容写入新的文件。
    </p>
    <pre><code class="prism language-kotlin">reader<span class="token punctuation">.</span><span class="token function">useLines</span> <span class="token punctuation">{<!-- --></span> lines <span class="token operator">-&gt;</span>
    lines<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{<!-- --></span> line <span class="token operator">-&gt;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>partContent<span class="token punctuation">.</span>length <span class="token operator">+</span> line<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> maxChars<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">savePartFile</span><span class="token punctuation">(</span>newFolder<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> fileExt<span class="token punctuation">,</span> partNum<span class="token punctuation">,</span> partContent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            partContent<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            partNum<span class="token operator">++</span>
        <span class="token punctuation">}</span>
        partContent<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"\n"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="4__155">
     </a>
     4. 保存拆分后的文件
    </h4>
    <p>
     拆分后的内容会存放在新建的文件夹中，文件名格式为
     <code>
      文件名_1.txt
     </code>
     ，
     <code>
      文件名_2.txt
     </code>
     ，依此类推。
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">fun</span> <span class="token function">savePartFile</span><span class="token punctuation">(</span>folder<span class="token operator">:</span> File<span class="token punctuation">,</span> baseName<span class="token operator">:</span> String<span class="token punctuation">,</span> ext<span class="token operator">:</span> String<span class="token punctuation">,</span> partNum<span class="token operator">:</span> Int<span class="token punctuation">,</span> content<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> newFile <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>folder<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">baseName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">partNum</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ext</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    newFile<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> Charsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_166">
     </a>
     运行示例
    </h3>
    <p>
     假设
     <code>
      C:/abc.txt
     </code>
     是一个大文本文件，我们可以调用
     <code>
      splitTxtFile
     </code>
     进行拆分。
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> filePath <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"C:/abc.txt"</span></span>
    <span class="token keyword">val</span> maxChars <span class="token operator">=</span> <span class="token number">10240000</span> <span class="token comment">// 每个文件10MB</span>
    <span class="token function">splitTxtFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> maxChars<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     运行后，程序会在
     <code>
      C:/abc/
     </code>
     目录下生成多个拆分后的文件。
    </p>
    <h3>
     <a id="_180">
     </a>
     总结
    </h3>
    <p>
     本文介绍了如何使用 Kotlin 拆分大文本文件，支持自动检测编码，并将拆分后的文件存放在指定目录。代码采用逐行读取方式，避免内存溢出，适用于大文件处理场景。希望对你有所帮助！
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f6c69757a68756f31333339362f:61727469636c652f64657461696c732f313436303733343135" class_="artid" style="display:none">
 </p>
</div>


