---
layout: post
title: "C51-Proteus仿真实验17数码管显示44键盘矩阵按键"
date: 2025-03-14 14:54:37 +0800
description: "51单片机的proteus仿真实验"
keywords: "C51 Proteus仿真实验17：数码管显示4×4键盘矩阵按键"
categories: ['Proteus', 'C']
tags: ['单片机', 'Proteus', '51单片机']
artid: "146256723"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146256723
    alt: "C51-Proteus仿真实验17数码管显示44键盘矩阵按键"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146256723
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146256723
cover: https://bing.ee123.net/img/rand?artid=146256723
image: https://bing.ee123.net/img/rand?artid=146256723
img: https://bing.ee123.net/img/rand?artid=146256723
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C51 Proteus仿真实验17：数码管显示4×4键盘矩阵按键
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     说明
    </h2>
    <p>
     <strong>
      按下任意键时，数码管都会显示其键的序号，扫描程序首先判断按键发生在哪一列，然后根据所发生的行附加不同的值，从而得到按键的序号
     </strong>
    </p>
    <h2>
     <a id="Proteus_2">
     </a>
     Proteus仿真
    </h2>
    <p>
     <img alt="数码管显示4x4键盘矩阵按键" src="https://i-blog.csdnimg.cn/direct/a88679ddfc6c4b76aee2eb1f8973d55b.png"/>
    </p>
    <p>
     <strong>
      注意：
      <br/>
      K0、K4、K8、KC右边引脚连接的是P1.0
      <br/>
      K1、K5、K9、KD右边引脚连接的是P1.1
      <br/>
      K2、K6、KA、KE右边引脚连接的是P1.2
      <br/>
      K3、K7、KB、KF右边引脚连接的是P1.3
      <br/>
      K0、K1、K2、K3左边引脚连接的是P1.4
      <br/>
      K4、K5、K6、K7左边引脚连接的是P1.5
      <br/>
      K8、K9、KA、KB左边引脚连接的是P1.6
      <br/>
      KC、KD、KE、KF左边引脚连接的是P1.7
     </strong>
    </p>
    <p>
     <strong>
      使用到的元器件：
     </strong>
     <br/>
     单片机：AT89C51
     <br/>
     电容：CAP
     <br/>
     极性电容：CAP-ELEC
     <br/>
     电阻：RES、RESPACK-8
     <br/>
     晶振：CRYSTAL
     <br/>
     排阻：RX8
     <br/>
     按键：BUTTON
     <br/>
     数码管：7SEG-COM-CAT-GRN(共阴极，高电平点亮)
    </p>
    <h2>
     <a id="C51_26">
     </a>
     C51代码
    </h2>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;reg51.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uchar</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">char</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uint</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span>
<span class="token comment">//数码管显示码表 0-9、A-F、所有段关闭</span>
uchar code DSY_CODE<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
 	<span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token number">0xf9</span><span class="token punctuation">,</span><span class="token number">0xa4</span><span class="token punctuation">,</span><span class="token number">0xb0</span><span class="token punctuation">,</span><span class="token number">0x99</span><span class="token punctuation">,</span><span class="token number">0x92</span><span class="token punctuation">,</span><span class="token number">0x82</span><span class="token punctuation">,</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token number">0x90</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">,</span><span class="token number">0x83</span><span class="token punctuation">,</span><span class="token number">0xc6</span><span class="token punctuation">,</span><span class="token number">0xa1</span><span class="token punctuation">,</span><span class="token number">0x86</span><span class="token punctuation">,</span><span class="token number">0x8e</span><span class="token punctuation">,</span><span class="token number">0x00</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//定义一个蜂鸣器引脚</span>
sbit BEEP <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>

<span class="token comment">//定义上次按键值和当前按键值，默认为16</span>
uchar Pre_keyNo <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span>KeyNo <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

<span class="token comment">//延时</span>
<span class="token keyword">void</span> <span class="token function">DelayMs</span><span class="token punctuation">(</span>uint ms<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	uchar i<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ms<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">120</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//蜂鸣器</span>
<span class="token comment">//无源蜂鸣器 需要 高低电平交替 形成振荡信号，才能发出声音。</span>
<span class="token comment">//有源蜂鸣器 只需要单片机提供一个高电平，它内部有振荡电路自动发声</span>
<span class="token keyword">void</span> <span class="token function">Beep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	uchar i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	 	<span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		BEEP <span class="token operator">=</span> <span class="token operator">~</span>BEEP<span class="token punctuation">;</span><span class="token comment">//一直取反切换高低电平，驱动蜂鸣器发出响声</span>
	<span class="token punctuation">}</span>
	BEEP <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//按键扫描，通过行列得出当前按下的按键值</span>
<span class="token keyword">void</span> <span class="token function">Key_Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	uchar Tmp<span class="token punctuation">;</span>
	P1 <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span><span class="token comment">//设置低四位，监测是哪一列按下</span>
	<span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Tmp <span class="token operator">=</span> P1 <span class="token operator">^</span> <span class="token number">0x0f</span><span class="token punctuation">;</span><span class="token comment">//异或，相同为0，不同为1，得到列数                </span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>Tmp<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>KeyNo <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>KeyNo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>KeyNo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>KeyNo <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>KeyNo <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	P1 <span class="token operator">=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span><span class="token comment">//设置高四位，监测是哪一行按下</span>
	Tmp <span class="token operator">=</span> P1 <span class="token operator">&gt;&gt;</span> <span class="token number">4</span> <span class="token operator">^</span> <span class="token number">0x0f</span><span class="token punctuation">;</span><span class="token comment">//得到行数</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>Tmp<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>KeyNo <span class="token operator">+=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>KeyNo <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>KeyNo <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>KeyNo <span class="token operator">+=</span> <span class="token number">12</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	P0 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span><span class="token comment">//熄灭数码管，数码管高电平点亮</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		P1 <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>P1 <span class="token operator">!=</span> <span class="token number">0x0f</span><span class="token punctuation">)</span>
			<span class="token function">Key_Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Pre_keyNo <span class="token operator">!=</span> KeyNo<span class="token punctuation">)</span><span class="token comment">//判断按键是否发生改变</span>
		<span class="token punctuation">{<!-- --></span>
			P0 <span class="token operator">=</span> <span class="token operator">~</span>DSY_CODE<span class="token punctuation">[</span>KeyNo<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token function">Beep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Pre_keyNo <span class="token operator">=</span> KeyNo<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时消除按键抖动</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35313936343636372f:61727469636c652f64657461696c732f313436323536373233" class_="artid" style="display:none">
 </p>
</div>


