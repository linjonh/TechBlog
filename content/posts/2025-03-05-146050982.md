---
arturl_encode: "68747470:733a2f2f626c6f672e6373646e2e6e65742f595f313231352f:61727469636c652f64657461696c732f313436303530393832"
layout: post
title: "RabbitMQ-7ç§å·¥ä½œæ¨¡å¼è¯¦è§£åŠåº”ç”¨åœºæ™¯å¤ä¹ ç‰ˆ,åŸç”Ÿä»£ç å®ç°ç‰ˆ"
date: 2025-03-05 19:56:36 +0800
description: "2. Work Queueï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰1. å¸¸é‡ç±»ä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ RabbitMQ çš„è¿æ¥ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¸¸é‡ç±» ï¼Œç”¨äºå­˜å‚¨è¿æ¥æ‰€éœ€çš„ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åã€å¯†ç ä»¥åŠé˜Ÿåˆ—åç§°ã€‚2. ç”Ÿäº§è€…ç”Ÿäº§è€…ç±»çš„ä¸»è¦èŒè´£æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜é˜Ÿåˆ—ï¼Œå¹¶å‘é˜Ÿåˆ—ä¸­å‘é€ 10 æ¡æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼šä»£ç è§£é‡Šï¼šæ¶ˆè´¹è€…ç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜é˜Ÿåˆ—ï¼Œå¹¶ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªæ¶ˆè´¹è€…ç±»æ¥æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç«äº‰æ¶ˆè´¹æ¶ˆ"
keywords: "RabbitMQ 7ç§å·¥ä½œæ¨¡å¼è¯¦è§£åŠåº”ç”¨åœºæ™¯ï¼ˆå¤ä¹ ç‰ˆ,åŸç”Ÿä»£ç å®ç°ç‰ˆï¼‰"
categories: ['Rabbitmq']
tags: ['åˆ†å¸ƒå¼', 'Rabbitmq']
artid: "146050982"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146050982
    alt: "RabbitMQ-7ç§å·¥ä½œæ¨¡å¼è¯¦è§£åŠåº”ç”¨åœºæ™¯å¤ä¹ ç‰ˆ,åŸç”Ÿä»£ç å®ç°ç‰ˆ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146050982
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146050982
cover: https://bing.ee123.net/img/rand?artid=146050982
image: https://bing.ee123.net/img/rand?artid=146050982
img: https://bing.ee123.net/img/rand?artid=146050982
---

# RabbitMQ 7ç§å·¥ä½œæ¨¡å¼è¯¦è§£åŠåº”ç”¨åœºæ™¯ï¼ˆå¤ä¹ ç‰ˆ,åŸç”Ÿä»£ç å®ç°ç‰ˆï¼‰

## ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡

## â­Â RabbitMQ â­

## ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡ğŸ‡

---

## å‰è¨€

> [RabbitMQ 7ç§å·¥ä½œæ¨¡å¼è¯¦è§£åŠåº”ç”¨åœºæ™¯\_rabbitmq å¹¿æ’­æ¨¡å¼åº”ç”¨åœºæ™¯-CSDNåšå®¢](https://blog.csdn.net/Y_1215/article/details/142690057?spm=1001.2014.3001.5502 "RabbitMQ 7ç§å·¥ä½œæ¨¡å¼è¯¦è§£åŠåº”ç”¨åœºæ™¯_rabbitmq å¹¿æ’­æ¨¡å¼åº”ç”¨åœºæ™¯-CSDNåšå®¢")
>
> ä¹‹å‰ç®€å•ä»‹ç»äº†RabbitMQçš„ä¸ƒç§å·¥ä½œæ¨¡å¼ï¼Œä½†æ˜¯æ²¡æœ‰å…·ä½“çš„ä»£ç å®ç°ã€‚
>   
> è¿™é‡Œå¤ä¹ çš„æ—¶å€™ï¼ŒæŠŠä»£ç å®ç°è¡¥ä¸Šã€‚

---

## RabbitMQ 7ç§å·¥ä½œæ¨¡å¼

> RabbitMQ æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„å¼€æºæ¶ˆæ¯ä»£ç†å’Œé˜Ÿåˆ—æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯ä¼ é€’æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯RabbitMQæä¾›çš„7ç§ä¸»è¦çš„å·¥ä½œæ¨¡å¼åŠå…¶åº”ç”¨åœºæ™¯çš„è¯¦ç»†ä»‹ç»ã€‚

---

## 1. Simpleï¼ˆç®€å•æ¨¡å¼ï¼‰

> ![](https://i-blog.csdnimg.cn/direct/0f54257b21eb4ac1a1def36437c14523.png)
>
> **è§’è‰²**
> ï¼š
>
> * **P (Producer)**
>   : ç”Ÿäº§è€…ï¼Œè´Ÿè´£å‘é€æ¶ˆæ¯ã€‚
> * **C (Consumer)**
>   : æ¶ˆè´¹è€…ï¼Œè´Ÿè´£æ¥æ”¶æ¶ˆæ¯ã€‚
> * **Queue (æ¶ˆæ¯é˜Ÿåˆ—)**
>   : ç±»ä¼¼äºé‚®ç®±ï¼Œå¯ä»¥ç¼“å­˜æ¶ˆæ¯ï¼›ç”Ÿäº§è€…å‘å…¶ä¸­æŠ•é€’æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä»ä¸­å–å‡ºæ¶ˆæ¯ã€‚
>
> **ç‰¹ç‚¹**
> ï¼šä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¹Ÿç§°ä¸ºç‚¹å¯¹ç‚¹ (Point-to-Point) æ¨¡å¼ã€‚
>
> **é€‚ç”¨åœºæ™¯**
> ï¼šæ¶ˆæ¯åªèƒ½è¢«å•ä¸ªæ¶ˆè´¹è€…å¤„ç†çš„æƒ…å†µã€‚

---

### ç”Ÿäº§è€…

```java
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

public class RabbitProducer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        //2. è®¾ç½®å‚æ•°
        factory.setHost("110.41.51.65");//ip é»˜è®¤å€¼localhost
        factory.setPort(15673); //é»˜è®¤å€¼5672
        factory.setVirtualHost("bite");//è™šæ‹Ÿæœºåç§°, é»˜è®¤ /
        factory.setUsername("study");//ç”¨æˆ·å,é»˜è®¤guest
        factory.setPassword("study");//å¯†ç , é»˜è®¤guest

        //3. åˆ›å»ºè¿æ¥Connection
        Connection connection = factory.newConnection();
        //4. åˆ›å»ºchannelé€šé“
        Channel channel = connection.createChannel();

        //5. å£°æ˜é˜Ÿåˆ—
        /*
         queueDeclare(String queue, boolean durable, boolean exclusive, 
         boolean autoDelete, Map<String, Object> arguments)
         1.queue: é˜Ÿåˆ—åç§°
         2.durable: æ˜¯å¦æŒä¹…åŒ–, å½“mqé‡å¯ä¹‹å, æ¶ˆæ¯è¿˜åœ¨
         3.exclusive:
          * æ˜¯å¦ç‹¬å , åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—
          * å½“Connectionå…³é—­æ—¶, æ˜¯å¦åˆ é™¤é˜Ÿåˆ—
         4.autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤, å½“æ²¡æœ‰Consumeræ—¶, è‡ªåŠ¨åˆ é™¤æ‰
         5.arguments: ä¸€äº›å‚æ•°
         */
        //å¦‚æœæ²¡æœ‰ä¸€ä¸ªhelloè¿™æ ·çš„ä¸€ä¸ªé˜Ÿåˆ—, ä¼šè‡ªåŠ¨åˆ›å»º, å¦‚æœæœ‰, åˆ™ä¸åˆ›å»º
        channel.queueDeclare("hello", true, false, false, null);

        //6. é€šè¿‡channelå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­
        /*
         basicPublish(String exchange, String routingKey, AMQP.BasicProperties 
         props, byte[] body)
         1. exchange: äº¤æ¢æœºåç§°, ç®€å•æ¨¡å¼ä¸‹, äº¤æ¢æœºä¼šä½¿ç”¨é»˜è®¤çš„""
         2.routingKey: è·¯ç”±åç§°, routingKey = é˜Ÿåˆ—åç§°
         3.props: é…ç½®ä¿¡æ¯
         4.body: å‘é€æ¶ˆæ¯çš„æ•°æ®
         */
        String msg = "Hello World";
        //ä½¿ç”¨çš„æ˜¯å†…ç½®äº¤æ¢æœº. ä½¿ç”¨å†…ç½®äº¤æ¢æœºæ—¶, routingKeyè¦å’Œé˜Ÿåˆ—åç§°ä¸€æ ·, æ‰å¯ä»¥è·¯ç”±
        //åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸Šå»
        channel.basicPublish("", "hello", null, msg.getBytes());

        //7.é‡Šæ”¾èµ„æº
        System.out.println(msg + "æ¶ˆæ¯å‘é€æˆåŠŸ");
        channel.close();
        connection.close();
    }
}
```

> 1. **åˆ›å»ºè¿æ¥å·¥å‚å¹¶è®¾ç½®å‚æ•°**
>    ï¼šé¦–å…ˆåˆ›å»º
>    `ConnectionFactory`
>    å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸ RabbitMQ å»ºç«‹è¿æ¥çš„å·¥å‚ç±»ã€‚é€šè¿‡è®¾ç½®
>    `host`
>    ã€
>    `port`
>    ã€
>    `virtualHost`
>    ã€
>    `username`
>    å’Œ
>    `password`
>    ç­‰å‚æ•°ï¼ŒæŒ‡å®šè¦è¿æ¥çš„ RabbitMQ æœåŠ¡å™¨çš„åœ°å€ã€ç«¯å£ã€è™šæ‹Ÿæœºã€ç”¨æˆ·åå’Œå¯†ç ã€‚è¿™é‡Œè¿æ¥çš„æ˜¯
>    `110.41.51.65:15673`
>    ï¼Œä½¿ç”¨
>    `bite`
>    è™šæ‹Ÿæœºï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯
>    `study`
>    ã€‚
> 2. **åˆ›å»ºè¿æ¥å’Œé€šé“**
>    ï¼šåˆ©ç”¨
>    `ConnectionFactory`
>    åˆ›å»º
>    `Connection`
>    è¿æ¥å¯¹è±¡ï¼Œå†é€šè¿‡è¿æ¥åˆ›å»º
>    `Channel`
>    é€šé“ã€‚é€šé“æ˜¯è¿›è¡Œæ¶ˆæ¯è¯»å†™æ“ä½œçš„è½½ä½“ï¼Œé€šè¿‡å®ƒæ¥æ‰§è¡Œå„ç§ RabbitMQ çš„æ“ä½œã€‚
> 3. **å£°æ˜é˜Ÿåˆ—**
>    ï¼šè°ƒç”¨
>    `channel.queueDeclare`
>    æ–¹æ³•å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ã€‚è¿™é‡Œå£°æ˜äº†åä¸º
>    `hello`
>    çš„é˜Ÿåˆ—ï¼Œè®¾ç½®ä¸ºæŒä¹…åŒ–ï¼ˆ
>    `durable = true`
>    ï¼‰ï¼Œè¿™æ ·åœ¨ RabbitMQ é‡å¯åé˜Ÿåˆ—ä¾ç„¶å­˜åœ¨ï¼›ä¸ç‹¬å ï¼ˆ
>    `exclusive = false`
>    ï¼‰ï¼Œå…è®¸å¤šä¸ªæ¶ˆè´¹è€…ç›‘å¬ï¼›ä¸è‡ªåŠ¨åˆ é™¤ï¼ˆ
>    `autoDelete = false`
>    ï¼‰ï¼Œå³ä½¿æ²¡æœ‰æ¶ˆè´¹è€…æ—¶é˜Ÿåˆ—ä¹Ÿä¸ä¼šè¢«åˆ é™¤ã€‚
> 4. **å‘é€æ¶ˆæ¯**
>    ï¼šä½¿ç”¨
>    `channel.basicPublish`
>    æ–¹æ³•å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ã€‚åœ¨ç®€å•æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨é»˜è®¤äº¤æ¢æœºï¼ˆ
>    `exchange = ""`
>    ï¼‰ï¼Œ
>    `routingKey`
>    è®¾ç½®ä¸ºé˜Ÿåˆ—åç§°
>    `hello`
>    ï¼Œæ¶ˆæ¯å†…å®¹ä¸º
>    `"Hello World"`
>    ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„å‘é€ã€‚
> 5. **é‡Šæ”¾èµ„æº**
>    ï¼šæ¶ˆæ¯å‘é€å®Œæˆåï¼Œå…³é—­
>    `channel`
>    å’Œ
>    `connection`
>    ï¼Œé‡Šæ”¾ä¸ RabbitMQ æœåŠ¡å™¨çš„è¿æ¥èµ„æºã€‚

### æ¶ˆè´¹è€…

```java
import com.rabbitmq.client.*;
import java.io.IOException;
import java.util.concurrent.TimeUnit;

public class RabbitmqConsumer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        //2. è®¾ç½®å‚æ•°
        factory.setHost("110.41.51.65");//ip é»˜è®¤å€¼localhost
        factory.setPort(15673); //é»˜è®¤å€¼5672
        factory.setVirtualHost("bite");//è™šæ‹Ÿæœºåç§°, é»˜è®¤ /
        factory.setUsername("study");//ç”¨æˆ·å,é»˜è®¤guest
        factory.setPassword("study");//å¯†ç , é»˜è®¤guest

        //3. åˆ›å»ºè¿æ¥Connection
        Connection connection = factory.newConnection();
        //4. åˆ›å»ºchannelé€šé“
        Channel channel = connection.createChannel();

        //5. å£°æ˜é˜Ÿåˆ—
        /*
         queueDeclare(String queue, boolean durable, boolean exclusive, 
         boolean autoDelete, Map<String, Object> arguments)
         1.queue: é˜Ÿåˆ—åç§°
         2.durable: æ˜¯å¦æŒä¹…åŒ–, å½“mqé‡å¯ä¹‹å, æ¶ˆæ¯è¿˜åœ¨
         3.exclusive:
          * æ˜¯å¦ç‹¬å , åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—
          * å½“Connectionå…³é—­æ—¶, æ˜¯å¦åˆ é™¤é˜Ÿåˆ—
         4.autoDelete: æ˜¯å¦è‡ªåŠ¨åˆ é™¤, å½“æ²¡æœ‰Consumeræ—¶, è‡ªåŠ¨åˆ é™¤æ‰
         5.arguments: ä¸€äº›å‚æ•°
         */
        //å¦‚æœæ²¡æœ‰ä¸€ä¸ªhelloè¿™æ ·çš„ä¸€ä¸ªé˜Ÿåˆ—, ä¼šè‡ªåŠ¨åˆ›å»º, å¦‚æœæœ‰, åˆ™ä¸åˆ›å»º
        channel.queueDeclare("hello", true, false, false, null);

        //6. æ¥æ”¶æ¶ˆæ¯, å¹¶æ¶ˆè´¹
        /*
         basicConsume(String queue, boolean autoAck, Consumer callback)
         å‚æ•°:
         1. queue: é˜Ÿåˆ—åç§°
         2. autoAck: æ˜¯å¦è‡ªåŠ¨ç¡®è®¤, æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯ä¹‹å,è‡ªåŠ¨å’ŒMQç¡®è®¤
         3. callback: å›è°ƒå¯¹è±¡
         */
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            /*
             å›è°ƒæ–¹æ³•, å½“æ”¶åˆ°æ¶ˆæ¯å, ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•
             1. consumerTag: æ ‡è¯†
             2. envelope: è·å–ä¸€äº›ä¿¡æ¯, äº¤æ¢æœº, è·¯ç”±key
             3. properties:é…ç½®ä¿¡æ¯
             4. body:æ•°æ®
             */
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
            AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume("hello", true, consumer);

        //ç­‰å¾…å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹å, å…³é—­èµ„æº
        TimeUnit.SECONDS.sleep(5);
        //7. é‡Šæ”¾èµ„æº æ¶ˆè´¹è€…ç›¸å½“äºæ˜¯ä¸€ä¸ªç›‘å¬ç¨‹åº, ä¸éœ€è¦å…³é—­èµ„æº
        //é¡ºåºä¸å¯æ”¹å˜
        // channel.close();
        // connection.close();
    }
}

```

> 1. **è¿æ¥è®¾ç½®ä¸é˜Ÿåˆ—å£°æ˜**
>    ï¼šä¸ç”Ÿäº§è€…ç±»ä¼¼ï¼Œå…ˆåˆ›å»ºè¿æ¥å·¥å‚å¹¶è®¾ç½®å‚æ•°ï¼Œå»ºç«‹è¿æ¥å’Œé€šé“ï¼Œç„¶åå£°æ˜
>    `hello`
>    é˜Ÿåˆ—ï¼Œä¿è¯æ¶ˆè´¹è€…ä¸ç”Ÿäº§è€…æ“ä½œçš„æ˜¯åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚
> 2. **æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯**
>    ï¼šé€šè¿‡
>    `channel.basicConsume`
>    æ–¹æ³•æ¥æ”¶æ¶ˆæ¯ã€‚åˆ›å»ºä¸€ä¸ª
>    `DefaultConsumer`
>    å›è°ƒå¯¹è±¡ï¼Œé‡å†™
>    `handleDelivery`
>    æ–¹æ³•ï¼Œå½“æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°è¾“å‡ºã€‚è¿™é‡Œè®¾ç½®
>    `autoAck = true`
>    ï¼Œè¡¨ç¤ºæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯åè‡ªåŠ¨å‘ RabbitMQ ç¡®è®¤ï¼Œè¿™æ · RabbitMQ å°±ä¼šè®¤ä¸ºæ¶ˆæ¯å·²è¢«æˆåŠŸå¤„ç†å¹¶ä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚
> 3. **èµ„æºå¤„ç†**
>    ï¼šæ¶ˆè´¹è€…é€šå¸¸ä½œä¸ºä¸€ä¸ªç›‘å¬ç¨‹åºæŒç»­è¿è¡Œï¼Œè¿™é‡Œä½¿ç”¨
>    `TimeUnit.SECONDS.sleep(5)`
>    è®©ç¨‹åºç­‰å¾… 5 ç§’ï¼Œæ¨¡æ‹Ÿå›è°ƒå‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œä¹‹åå¦‚æœéœ€è¦å…³é—­èµ„æºï¼Œå¯ä»¥æŒ‰ç…§
>    `channel.close()`
>    å’Œ
>    `connection.close()`
>    çš„é¡ºåºå…³é—­ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹æ¶ˆè´¹è€…ä¸ä¼šè½»æ˜“å…³é—­è¿æ¥ï¼Œè€Œæ˜¯æŒç»­ç›‘å¬é˜Ÿåˆ—è·å–æ¶ˆæ¯ã€‚

---

## 2. Work Queueï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰

> ![](https://i-blog.csdnimg.cn/direct/f49a477b9a82484dabca7e7127c0f64c.png)
>
> **è§’è‰²**
> ï¼š
>
> * **P (Producer)**
>   : ç”Ÿäº§è€…ã€‚
> * **C1, C2 (Consumers)**
>   : å¤šä¸ªæ¶ˆè´¹è€…ã€‚
> * **Queue (æ¶ˆæ¯é˜Ÿåˆ—)**
>   : ç”¨äºç¼“å­˜æ¶ˆæ¯ã€‚
>
> **ç‰¹ç‚¹**
> ï¼šä¸€ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ã€‚åœ¨å¤šä¸ªæ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼ŒWork Queue ä¼šå°†æ¶ˆæ¯åˆ†æ´¾ç»™ä¸åŒçš„æ¶ˆè´¹è€…ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ¥æ”¶åˆ°ä¸åŒçš„æ¶ˆæ¯ã€‚
>
> **é€‚ç”¨åœºæ™¯**
> ï¼šé›†ç¾¤ç¯å¢ƒä¸­åšå¼‚æ­¥å¤„ç†ã€‚ä¾‹å¦‚ï¼Œ12306 çŸ­ä¿¡é€šçŸ¥æœåŠ¡ï¼Œè®¢å•æˆåŠŸåï¼Œè®¢å•æ¶ˆæ¯ä¼šè¢«å‘é€åˆ° RabbitMQï¼ŒçŸ­ä¿¡æœåŠ¡ä» RabbitMQ ä¸­è·å–è®¢å•ä¿¡æ¯ï¼Œå¹¶å‘é€é€šçŸ¥ä¿¡æ¯ã€‚
>
> ![](https://i-blog.csdnimg.cn/direct/bfd08dc4c8434ee6adaad501ea164a6e.png)

---

### 1. å¸¸é‡ç±»

ä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ RabbitMQ çš„è¿æ¥ä¿¡æ¯ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¸¸é‡ç±»
`Constants`
ï¼Œç”¨äºå­˜å‚¨è¿æ¥æ‰€éœ€çš„ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åã€å¯†ç ä»¥åŠé˜Ÿåˆ—åç§°ã€‚

```java
public class Constants {
    public static final String HOST = "110.41.51.65";
    public static final Integer PORT = 15673;
    public static final String VIRTUAL_HOST = "bite";
    public static final String USER_NAME = "study";
    public static final String PASSWORD = "study";
    public static final String WORK_QUEUE_NAME = "work_queues";
}

```

### 2. ç”Ÿäº§è€…

ç”Ÿäº§è€…ç±»çš„ä¸»è¦èŒè´£æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜é˜Ÿåˆ—ï¼Œå¹¶å‘é˜Ÿåˆ—ä¸­å‘é€ 10 æ¡æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç å®ç°ï¼š

```java
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import constant.Constants;

public class WorkRabbitProducer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. å£°æ˜é˜Ÿåˆ—
        // å¦‚æœé˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼›å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸åˆ›å»º
        channel.queueDeclare(Constants.WORK_QUEUE_NAME, true, false, false, null);

        // 5. å‘é€ 10 æ¡æ¶ˆæ¯
        for (int i = 0; i < 10; i++) {
            String msg = "Hello World" + i;
            // å‘é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯
            channel.basicPublish("", Constants.WORK_QUEUE_NAME, null, msg.getBytes());
        }

        // 6. é‡Šæ”¾èµ„æº
        channel.close();
        connection.close();
    }
}

```

ä»£ç è§£é‡Šï¼š

> * **è¿æ¥å·¥å‚å’Œè¿æ¥åˆ›å»º**
>   ï¼šä½¿ç”¨
>   `ConnectionFactory`
>   åˆ›å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®è¿æ¥æ‰€éœ€çš„å‚æ•°ï¼Œå¦‚ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ã€‚ç„¶åé€šè¿‡
>   `factory.newConnection()`
>   æ–¹æ³•åˆ›å»ºè¿æ¥ã€‚
> * **é€šé“åˆ›å»º**
>   ï¼šåœ¨è¿æ¥çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨
>   `connection.createChannel()`
>   æ–¹æ³•åˆ›å»ºé€šé“ï¼Œé€šé“æ˜¯è¿›è¡Œæ¶ˆæ¯è¯»å†™æ“ä½œçš„ä¸»è¦å¯¹è±¡ã€‚
> * **é˜Ÿåˆ—å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.queueDeclare`
>   æ–¹æ³•å£°æ˜é˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—çš„æŒä¹…åŒ–ã€ç‹¬å æ€§å’Œè‡ªåŠ¨åˆ é™¤ç­‰å±æ€§ã€‚
> * **æ¶ˆæ¯å‘é€**
>   ï¼šé€šè¿‡
>   `for`
>   å¾ªç¯å‘é€ 10 æ¡æ¶ˆæ¯ï¼Œä½¿ç”¨
>   `channel.basicPublish`
>   æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ã€‚
> * **èµ„æºé‡Šæ”¾**
>   ï¼šæ¶ˆæ¯å‘é€å®Œæˆåï¼Œå…³é—­é€šé“å’Œè¿æ¥ï¼Œé‡Šæ”¾èµ„æºã€‚

### 3. æ¶ˆè´¹è€…

æ¶ˆè´¹è€…ç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜é˜Ÿåˆ—ï¼Œå¹¶ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªæ¶ˆè´¹è€…ç±»æ¥æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç«äº‰æ¶ˆè´¹æ¶ˆæ¯çš„åœºæ™¯ã€‚

`WorkRabbitmqConsumer1`
ç±»

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class WorkRabbitmqConsumer1 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. å£°æ˜é˜Ÿåˆ—
        // å¦‚æœé˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼›å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸åˆ›å»º
        channel.queueDeclare(Constants.WORK_QUEUE_NAME, true, false, false, null);

        // 5. å®šä¹‰æ¶ˆè´¹è€…
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("WorkRabbitmqConsumer1 æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };

        // 6. å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯
        channel.basicConsume(Constants.WORK_QUEUE_NAME, true, consumer);
    }
}

```

**`WorkRabbitmqConsumer2`
ç±»ä¸ 1ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°**

ä»£ç è§£é‡Šï¼š

> * **è¿æ¥å’Œé€šé“åˆ›å»º**
>   ï¼šä¸ç”Ÿäº§è€…ç±»ç±»ä¼¼ï¼Œåˆ›å»ºè¿æ¥å·¥å‚ã€è¿æ¥å’Œé€šé“ã€‚
> * **é˜Ÿåˆ—å£°æ˜**
>   ï¼šç¡®ä¿æ¶ˆè´¹è€…ä½¿ç”¨çš„é˜Ÿåˆ—ä¸ç”Ÿäº§è€…å£°æ˜çš„é˜Ÿåˆ—ä¸€è‡´ã€‚
> * **æ¶ˆè´¹è€…å®šä¹‰**
>   ï¼šåˆ›å»º
>   `DefaultConsumer`
>   å¯¹è±¡ï¼Œå¹¶é‡å†™
>   `handleDelivery`
>   æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚
> * **æ¶ˆæ¯æ¶ˆè´¹**
>   ï¼šä½¿ç”¨
>   `channel.basicConsume`
>   æ–¹æ³•å¼€å§‹æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œè®¾ç½®è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ã€‚

è¿è¡Œæ­¥éª¤ï¼š

> 1. å…ˆå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ç¨‹åº
>    `WorkRabbitmqConsumer1`
>    å’Œ
>    `WorkRabbitmqConsumer2`
>    ã€‚
> 2. å†å¯åŠ¨ç”Ÿäº§è€…ç¨‹åº
>    `WorkRabbitProducer`
>    ã€‚

ç»“æœåˆ†æï¼š

> ç”±äºå·¥ä½œé˜Ÿåˆ—æ¨¡å¼é‡‡ç”¨è½®è¯¢çš„æ–¹å¼å°†æ¶ˆæ¯åˆ†å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå› æ­¤ä¸¤ä¸ªæ¶ˆè´¹è€…ä¼šäº¤æ›¿æ¶ˆè´¹ç”Ÿäº§è€…å‘é€çš„ 10 æ¡æ¶ˆæ¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ
> `WorkRabbitmqConsumer1`
> ä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯
> `Hello World0`
> ã€
> `Hello World2`
> ã€
> `Hello World4`
> ã€
> `Hello World6`
> ã€
> `Hello World8`
> ï¼Œè€Œ
> `WorkRabbitmqConsumer2`
> ä¼šæ¶ˆè´¹åˆ°æ¶ˆæ¯
> `Hello World1`
> ã€
> `Hello World3`
> ã€
> `Hello World5`
> ã€
> `Hello World7`
> ã€
> `Hello World9`
> ã€‚è¿™ä½“ç°äº†å¤šä¸ªæ¶ˆè´¹è€…ç«äº‰æ¶ˆè´¹æ¶ˆæ¯çš„ç‰¹ç‚¹ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å’Œæ•ˆç‡ã€‚

---

## 3. Publish/Subscribeï¼ˆå‘å¸ƒ/è®¢é˜…ï¼‰

> ![](https://i-blog.csdnimg.cn/direct/9f6034d61fbd476ca803d0ef734e3f35.png)
>
> **è§’è‰²**
> ï¼š
>
> **ç‰¹ç‚¹**
> ï¼šç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° Ex
>
> * **P (Producer)**
>   : ç”Ÿäº§è€…ã€‚
> * **X (Exchange, äº¤æ¢æœº)**
>   : è´Ÿè´£å°†æ¶ˆæ¯æŒ‰ä¸€å®šè§„åˆ™è·¯ç”±åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚
> * **C1, C2 (Consumers)**
>   : å¤šä¸ªæ¶ˆè´¹è€…ã€‚
> * **Queue (æ¶ˆæ¯é˜Ÿåˆ—)**
>   : ç”¨äºç¼“å­˜æ¶ˆæ¯ã€‚

**æ¦‚å¿µä»‹ç»**

**Exchange**
: äº¤æ¢æœº (X).

> ä½œâ½¤: â½£äº§è€…å°†æ¶ˆæ¯å‘é€åˆ°Exchange, ç”±äº¤æ¢æœºå°†æ¶ˆæ¯æŒ‰â¼€å®šè§„åˆ™è·¯ç”±åˆ°â¼€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ä¸­(ä¸Šå›¾ä¸­â½£äº§ è€…å°†æ¶ˆæ¯æŠ•é€’åˆ°é˜Ÿåˆ—ä¸­, å®é™…ä¸Šè¿™ä¸ªåœ¨RabbitMQä¸­ä¸ä¼šå‘â½£. )
>
> RabbitMQäº¤æ¢æœºæœ‰å››ç§ç±»å‹: fanout,direct, topic, headers, ä¸åŒç±»å‹æœ‰ç€ä¸åŒçš„è·¯ç”±ç­–ç•¥.
>
> AMQPå è®®â¾¥è¿˜æœ‰å¦å¤–ä¸¤ç§ç±»å‹, Systemå’Œâ¾ƒå®šä¹‰, æ­¤å¤„ä¸å†æè¿°.
>
> 1. Fanout:â¼´æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—(Publish/Subscribeæ¨¡å¼)
> 2. Direct:å®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting keyçš„é˜Ÿåˆ—(Routingæ¨¡å¼)
> 3. Topic:é€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting pattern(è·¯ç”±æ¨¡å¼)çš„é˜Ÿåˆ—(Topicsæ¨¡å¼)
> 4. headersç±»å‹çš„äº¤æ¢å™¨ä¸ä¾èµ–äºè·¯ç”±é”®çš„åŒ¹é…è§„åˆ™æ¥è·¯ç”±æ¶ˆæ¯, â½½æ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„
>
> headerså±æ€§è¿›â¾åŒ¹é…. headersç±»å‹çš„äº¤æ¢å™¨æ€§èƒ½ä¼šå¾ˆå·®,â½½ä¸”ä¹Ÿä¸å®â½¤,åŸºæœ¬ä¸Šä¸ä¼šçœ‹åˆ°å®ƒçš„å­˜åœ¨.
>
> Exchange(äº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯, ä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½â¼’, å› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿ Exchangeç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šä¸¢å¤±
>
> RoutingKey: è·¯ç”±é”®.â½£äº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢å™¨æ—¶, æŒ‡å®šçš„â¼€ä¸ªå­—ç¬¦ä¸², â½¤æ¥å‘Šè¯‰äº¤æ¢æœºåº”è¯¥å¦‚ä½•å¤„ç†è¿™ä¸ªæ¶ˆæ¯.
>
> Binding Key:ç»‘å®š. RabbitMQä¸­é€šè¿‡Binding(ç»‘å®š)å°†äº¤æ¢å™¨ä¸é˜Ÿåˆ—å…³è”èµ·æ¥, åœ¨ç»‘å®šçš„æ—¶å€™â¼€èˆ¬ä¼šæŒ‡ å®šâ¼€ä¸ªBinding Key, è¿™æ ·RabbitMQå°±çŸ¥é“å¦‚ä½•æ­£ç¡®åœ°å°†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—äº†.
>
> changeï¼Œç”±äº¤æ¢æœºå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ¥æ”¶åˆ°ç›¸åŒçš„æ¶ˆæ¯ã€‚

â½å¦‚ä¸‹å›¾: å¦‚æœåœ¨å‘é€æ¶ˆæ¯æ—¶, è®¾ç½®äº†RoutingKey ä¸ºorange, æ¶ˆæ¯å°±ä¼šè·¯ç”±åˆ°Q1

![](https://i-blog.csdnimg.cn/direct/7b04b11242c245df99ceea004eeb6fe4.png)

> å½“æ¶ˆæ¯çš„Routing keyä¸é˜Ÿåˆ—ç»‘å®šçš„Bindingkeyç›¸åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«è·¯ç”±åˆ°è¿™ä¸ªé˜Ÿåˆ—.
>
> BindingKeyå…¶å®ä¹Ÿå±äºè·¯ç”±é”®ä¸­çš„â¼€ç§, å®˜â½…è§£é‡Šä¸º:the routingkey to use for the binding.
>
> å¯ä»¥ç¿»è¯‘ä¸º:åœ¨ç»‘å®šçš„æ—¶å€™ä½¿â½¤çš„è·¯ç”±é”®. â¼¤å¤šæ•°æ—¶å€™,åŒ…æ‹¬å®˜â½…â½‚æ¡£å’ŒRabbitMQJava API ä¸­éƒ½æŠŠ
>
> BindingKeyå’ŒRoutingKeyçœ‹ä½œRoutingKey, ä¸ºäº†é¿å…æ··æ·†,å¯ä»¥è¿™ä¹ˆç†è§£:
>
> 1. åœ¨ä½¿â½¤ç»‘å®šçš„æ—¶å€™,éœ€è¦çš„è·¯ç”±é”®æ˜¯BindingKey.
>
> 2. åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™,éœ€è¦çš„è·¯ç”±é”®æ˜¯RoutingKey

**é€‚ç”¨åœºæ™¯**
ï¼šæ¶ˆæ¯éœ€è¦è¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¥æ”¶çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œä¸­å›½æ°”è±¡å±€å‘å¸ƒå¤©æ°”é¢„æŠ¥çš„æ¶ˆæ¯ï¼Œæ–°æµªã€ç™¾åº¦ã€æœç‹ç­‰é—¨æˆ·ç½‘ç«™é€šè¿‡é˜Ÿåˆ—ç»‘å®šåˆ°è¯¥äº¤æ¢æœºï¼Œè‡ªåŠ¨è·å–æ°”è±¡å±€æ¨é€çš„æ°”è±¡æ•°æ®ã€‚

---

### 1. å¸¸é‡ç±»

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›å¸¸é‡ï¼Œç”¨äºå­˜å‚¨ RabbitMQ è¿æ¥ä¿¡æ¯ä»¥åŠäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„åç§°ã€‚è¿™äº›å¸¸é‡å¯ä»¥æ–¹ä¾¿åœ°åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä»£ç ä¸­å¤ç”¨ã€‚

```java
public class Constants {
    public static final String HOST = "110.41.51.65";
    public static final Integer PORT = 15673;
    public static final String VIRTUAL_HOST = "bite";
    public static final String USER_NAME = "study";
    public static final String PASSWORD = "study";
    public static final String FANOUT_EXCHANGE_NAME = "test_fanout";
    public static final String FANOUT_QUEUE_NAME1 = "fanout_queue1";
    public static final String FANOUT_QUEUE_NAME2 = "fanout_queue2";
}

```

### 2. ç”Ÿäº§è€…

ç”Ÿäº§è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜æ‰‡å½¢äº¤æ¢å™¨ã€é˜Ÿåˆ—ï¼Œå¹¶å°†é˜Ÿåˆ—ä¸äº¤æ¢å™¨ç»‘å®šï¼Œæœ€åå‘é€æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ç”Ÿäº§è€…ä»£ç ï¼š

```java
import com.rabbitmq.client.BuiltinExchangeType;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import constant.Constants;

public class FanoutRabbitProducer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. åˆ›å»ºäº¤æ¢æœº
        channel.exchangeDeclare(Constants.FANOUT_EXCHANGE_NAME,
                BuiltinExchangeType.FANOUT, true, false, false, null);

        // 5. å£°æ˜é˜Ÿåˆ—
        channel.queueDeclare(Constants.FANOUT_QUEUE_NAME1, true, false, false, null);
        channel.queueDeclare(Constants.FANOUT_QUEUE_NAME2, true, false, false, null);

        // 6. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº
        channel.queueBind(Constants.FANOUT_QUEUE_NAME1, Constants.FANOUT_EXCHANGE_NAME, "");
        channel.queueBind(Constants.FANOUT_QUEUE_NAME2, Constants.FANOUT_EXCHANGE_NAME, "");

        // 7. å‘é€æ¶ˆæ¯
        String msg = "hello fanout";
        channel.basicPublish(Constants.FANOUT_EXCHANGE_NAME, "", null, msg.getBytes());

        // 8. é‡Šæ”¾èµ„æº
        channel.close();
        connection.close();
    }
}

```

ä»£ç è§£é‡Šï¼š

> * **è¿æ¥è®¾ç½®**
>   ï¼šä½¿ç”¨
>   `ConnectionFactory`
>   åˆ›å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½® RabbitMQ æœåŠ¡å™¨çš„ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ã€‚ç„¶åé€šè¿‡
>   `factory.newConnection()`
>   åˆ›å»ºè¿æ¥ã€‚
> * **é€šé“åˆ›å»º**
>   ï¼šé€šè¿‡
>   `connection.createChannel()`
>   åˆ›å»ºé€šé“ï¼Œé€šé“æ˜¯è¿›è¡Œæ¶ˆæ¯æ“ä½œçš„è½½ä½“ã€‚
> * **äº¤æ¢å™¨å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.exchangeDeclare`
>   æ–¹æ³•å£°æ˜ä¸€ä¸ªæ‰‡å½¢äº¤æ¢å™¨ï¼Œè®¾ç½®äº¤æ¢å™¨åç§°ä¸º
>   `test_fanout`
>   ï¼Œç±»å‹ä¸º
>   `FANOUT`
>   ï¼Œå¹¶è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼ˆ
>   `durable = true`
>   ï¼‰ï¼Œä¸è‡ªåŠ¨åˆ é™¤ï¼ˆ
>   `autoDelete = false`
>   ï¼‰ï¼Œä¸æ˜¯å†…éƒ¨ä½¿ç”¨ï¼ˆ
>   `internal = false`
>   ï¼‰ã€‚
> * **é˜Ÿåˆ—å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.queueDeclare`
>   æ–¹æ³•å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—
>   `fanout_queue1`
>   å’Œ
>   `fanout_queue2`
>   ï¼Œè®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œä¸ç‹¬å ï¼Œä¸è‡ªåŠ¨åˆ é™¤ã€‚
> * **ç»‘å®šæ“ä½œ**
>   ï¼šä½¿ç”¨
>   `channel.queueBind`
>   æ–¹æ³•å°†ä¸¤ä¸ªé˜Ÿåˆ—åˆ†åˆ«ä¸æ‰‡å½¢äº¤æ¢å™¨ç»‘å®šï¼Œç”±äºæ˜¯æ‰‡å½¢äº¤æ¢å™¨ï¼Œè·¯ç”±é”®è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ
>   `""`
>   ï¼‰ï¼Œè¡¨ç¤ºå¹¿æ’­æ¶ˆæ¯ã€‚
> * **æ¶ˆæ¯å‘é€**
>   ï¼šä½¿ç”¨
>   `channel.basicPublish`
>   æ–¹æ³•å‘é€æ¶ˆæ¯ï¼ŒæŒ‡å®šäº¤æ¢å™¨åç§°ï¼Œè·¯ç”±é”®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ¶ˆæ¯å†…å®¹ä¸º
>   `hello fanout`
>   ã€‚
> * **èµ„æºé‡Šæ”¾**
>   ï¼šå‘é€å®Œæ¶ˆæ¯åï¼Œå…³é—­é€šé“å’Œè¿æ¥ï¼Œé‡Šæ”¾èµ„æºã€‚

### 3. æ¶ˆè´¹è€…

æ¶ˆè´¹è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œæ¥æ”¶å¹¶å¤„ç†ä»é˜Ÿåˆ—ä¸­è·å–çš„æ¶ˆæ¯ã€‚ç”±äºäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„ç»‘å®šå…³ç³»åŠå£°æ˜å·²ç»åœ¨ç”Ÿäº§è€…ä»£ç ä¸­å®Œæˆï¼Œæ¶ˆè´¹è€…ä»£ç ä¸­ä¸éœ€è¦é‡å¤è¿™äº›æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªæ¶ˆè´¹è€…çš„ä»£ç ç¤ºä¾‹ï¼š

æ¶ˆè´¹è€… 1

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class FanoutRabbitmqConsumer1 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.FANOUT_QUEUE_NAME1, true, consumer);
    }
}

```

æ¶ˆè´¹è€… 2

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class FanoutRabbitmqConsumer2 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.FANOUT_QUEUE_NAME2, true, consumer);
    }
}

```

> ä»£ç è§£é‡Šï¼š
>
> * **è¿æ¥å’Œé€šé“åˆ›å»º**
>   ï¼šä¸ç”Ÿäº§è€…ç±»ä¼¼ï¼Œåˆ›å»ºè¿æ¥å·¥å‚ã€è¿æ¥å’Œé€šé“ã€‚
> * **æ¶ˆæ¯æ¶ˆè´¹**
>   ï¼šåˆ›å»º
>   `DefaultConsumer`
>   å¯¹è±¡ï¼Œå¹¶é‡å†™
>   `handleDelivery`
>   æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ç„¶åä½¿ç”¨
>   `channel.basicConsume`
>   æ–¹æ³•å¼€å§‹æ¶ˆè´¹æŒ‡å®šé˜Ÿåˆ—ï¼ˆ
>   `fanout_queue1`
>   æˆ–
>   `fanout_queue2`
>   ï¼‰ä¸­çš„æ¶ˆæ¯ï¼Œè®¾ç½®è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ï¼ˆ
>   `autoAck = true`
>   ï¼‰ã€‚
>
> 4. è¿è¡Œç»“æœ
>
> å½“æˆ‘ä»¬å…ˆå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…æ—¶ï¼Œç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯
> `hello fanout`
> ä¼šè¢«å¹¿æ’­åˆ°ä¸¤ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯å¹¶æ‰“å°å‡ºç›¸åº”çš„å†…å®¹ã€‚è¿™ä½“ç°äº†æ‰‡å½¢äº¤æ¢å™¨æ¨¡å¼çš„å¹¿æ’­ç‰¹æ€§ï¼Œå³æ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ‰€æœ‰ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—ï¼Œå®ç°äº†æ¶ˆæ¯çš„å¤šæ’­åŠŸèƒ½ã€‚

é€šè¿‡ä»¥ä¸Šä»£ç å’Œæ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº† RabbitMQ çš„æ‰‡å½¢äº¤æ¢å™¨æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥è§‚å¯Ÿåˆ°æ¶ˆæ¯å¹¿æ’­çš„æ•ˆæœã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‰‡å½¢äº¤æ¢å™¨æ¨¡å¼é€‚ç”¨äºéœ€è¦å°†æ¶ˆæ¯åŒæ—¶å‘é€ç»™å¤šä¸ªæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—è®°å½•ã€é€šçŸ¥ç³»ç»Ÿç­‰ã€‚

---

## 4. Routingï¼ˆè·¯ç”±æ¨¡å¼ï¼‰

> ![](https://i-blog.csdnimg.cn/direct/c19b4256bbe14d7a9136456cf8773b16.png)
>
> **è§’è‰²**
> ï¼š
>
> * **P (Producer)**
>   : ç”Ÿäº§è€…ã€‚
> * **X (Exchange, äº¤æ¢æœº)**
>   : æ ¹æ® RoutingKey çš„è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚
> * **C1, C2 (Consumers)**
>   : å¤šä¸ªæ¶ˆè´¹è€…ã€‚
> * **Queue (æ¶ˆæ¯é˜Ÿåˆ—)**
>   : ç”¨äºç¼“å­˜æ¶ˆæ¯ã€‚
>
> **ç‰¹ç‚¹**
> ï¼šäº¤æ¢æœºæ ¹æ® RoutingKey å°†æ¶ˆæ¯ç­›é€‰åå‘ç»™å¯¹åº”çš„æ¶ˆè´¹è€…é˜Ÿåˆ—ã€‚
>
> **é€‚ç”¨åœºæ™¯**
> ï¼šéœ€è¦æ ¹æ®ç‰¹å®šè§„åˆ™åˆ†å‘æ¶ˆæ¯çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿæ‰“å°æ—¥å¿—ï¼Œæ—¥å¿—ç­‰çº§åˆ†ä¸º error, warning, info, debugï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ¨¡å¼å°†ä¸åŒçš„æ—¥å¿—å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ï¼Œæœ€ç»ˆè¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ã€‚

### 1. å¸¸é‡ç±»

å®šä¹‰ä¸€äº›å¸¸é‡ï¼Œç”¨äºå­˜å‚¨ RabbitMQ è¿æ¥ä¿¡æ¯ä»¥åŠç›´è¿äº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„åç§°ã€‚

```java
public class Constants {
    public static final String HOST = "110.41.51.65";
    public static final Integer PORT = 15673;
    public static final String VIRTUAL_HOST = "bite";
    public static final String USER_NAME = "study";
    public static final String PASSWORD = "study";
    public static final String DIRECT_EXCHANGE_NAME = "test_direct";
    public static final String DIRECT_QUEUE_NAME1 = "direct_queue1";
    public static final String DIRECT_QUEUE_NAME2 = "direct_queue2";
}

```

### 2. ç”Ÿäº§è€…

ç”Ÿäº§è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜ç›´è¿äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå°†é˜Ÿåˆ—ä¸äº¤æ¢å™¨é€šè¿‡ä¸åŒçš„è·¯ç”±é”®è¿›è¡Œç»‘å®šï¼Œæœ€åæ ¹æ®ä¸åŒçš„è·¯ç”±é”®å‘é€æ¶ˆæ¯ã€‚

```java
import com.rabbitmq.client.BuiltinExchangeType;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import constant.Constants;

public class DirectRabbitProducer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. åˆ›å»ºç›´è¿äº¤æ¢å™¨
        // æ³¨æ„ï¼šåŸä»£ç æ­¤å¤„ä½¿ç”¨BuiltinExchangeType.FANOUTæœ‰è¯¯ï¼Œåº”æ”¹ä¸ºBuiltinExchangeType.DIRECT
        channel.exchangeDeclare(Constants.DIRECT_EXCHANGE_NAME, 
                BuiltinExchangeType.DIRECT, true, false, false, null);

        // 5. å£°æ˜é˜Ÿåˆ—
        channel.queueDeclare(Constants.DIRECT_QUEUE_NAME1, true, false, false, null);
        channel.queueDeclare(Constants.DIRECT_QUEUE_NAME2, true, false, false, null);

        // 6. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨
        // é˜Ÿåˆ—1ç»‘å®šåˆ°è·¯ç”±é”® "orange"
        channel.queueBind(Constants.DIRECT_QUEUE_NAME1, Constants.DIRECT_EXCHANGE_NAME, "orange");
        // é˜Ÿåˆ—2ç»‘å®šåˆ°è·¯ç”±é”® "black" å’Œ "green"
        channel.queueBind(Constants.DIRECT_QUEUE_NAME2, Constants.DIRECT_EXCHANGE_NAME, "black");
        channel.queueBind(Constants.DIRECT_QUEUE_NAME2, Constants.DIRECT_EXCHANGE_NAME, "green");

        // 7. å‘é€æ¶ˆæ¯
        String msg = "hello direct, I am orange";
        channel.basicPublish(Constants.DIRECT_EXCHANGE_NAME, "orange", null, msg.getBytes());

        String msg_black = "hello direct, I am black";
        channel.basicPublish(Constants.DIRECT_EXCHANGE_NAME, "black", null, msg_black.getBytes());

        String msg_green = "hello direct, I am green";
        channel.basicPublish(Constants.DIRECT_EXCHANGE_NAME, "green", null, msg_green.getBytes());

        // 8. é‡Šæ”¾èµ„æº
        channel.close();
        connection.close();
    }
}

```

ä»£ç è§£é‡Šï¼š

> * **è¿æ¥è®¾ç½®**
>   ï¼šä½¿ç”¨
>   `ConnectionFactory`
>   åˆ›å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½® RabbitMQ æœåŠ¡å™¨çš„ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶ååˆ›å»ºè¿æ¥å’Œé€šé“ã€‚
> * **äº¤æ¢å™¨å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.exchangeDeclare`
>   æ–¹æ³•å£°æ˜ä¸€ä¸ªç›´è¿äº¤æ¢å™¨ï¼ŒæŒ‡å®šäº¤æ¢å™¨åç§°ã€ç±»å‹ä¸º
>   `DIRECT`
>   ï¼Œå¹¶è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚
> * **é˜Ÿåˆ—å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.queueDeclare`
>   æ–¹æ³•å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—ï¼ŒåŒæ ·è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚
> * **ç»‘å®šæ“ä½œ**
>   ï¼šä½¿ç”¨
>   `channel.queueBind`
>   æ–¹æ³•å°†é˜Ÿåˆ— 1 ç»‘å®šåˆ°è·¯ç”±é”®
>   `"orange"`
>   ï¼Œé˜Ÿåˆ— 2 ç»‘å®šåˆ°è·¯ç”±é”®
>   `"black"`
>   å’Œ
>   `"green"`
>   ã€‚
> * **æ¶ˆæ¯å‘é€**
>   ï¼šä½¿ç”¨
>   `channel.basicPublish`
>   æ–¹æ³•æ ¹æ®ä¸åŒçš„è·¯ç”±é”®å‘é€ä¸åŒçš„æ¶ˆæ¯ã€‚
> * **èµ„æºé‡Šæ”¾**
>   ï¼šå‘é€å®Œæ¶ˆæ¯åï¼Œå…³é—­é€šé“å’Œè¿æ¥ã€‚

### 3. æ¶ˆè´¹è€…

æ¶ˆè´¹è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œä»æŒ‡å®šçš„é˜Ÿåˆ—ä¸­æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ã€‚

æ¶ˆè´¹è€… 1ï¼š
`DirectRabbitmqConsumer1`

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class DirectRabbitmqConsumer1 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
                    AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.DIRECT_QUEUE_NAME1, true, consumer);
    }
}

```

æ¶ˆè´¹è€… 2ï¼š
`DirectRabbitmqConsumer2`

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class DirectRabbitmqConsumer2 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
                    AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.DIRECT_QUEUE_NAME2, true, consumer);
    }
}

```

> ä»£ç è§£é‡Šï¼š
>
> * **è¿æ¥å’Œé€šé“åˆ›å»º**
>   ï¼šä¸ç”Ÿäº§è€…ç±»ä¼¼ï¼Œåˆ›å»ºè¿æ¥å·¥å‚ã€è¿æ¥å’Œé€šé“ã€‚
> * **æ¶ˆæ¯æ¶ˆè´¹**
>   ï¼šåˆ›å»º
>   `DefaultConsumer`
>   å¯¹è±¡ï¼Œå¹¶é‡å†™
>   `handleDelivery`
>   æ–¹æ³•ç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ä½¿ç”¨
>   `channel.basicConsume`
>   æ–¹æ³•ä»æŒ‡å®šé˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¾ç½®è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ã€‚
>
> 4. è¿è¡Œç»“æœåŠåˆ†æ
>
> è¿è¡Œæ­¥éª¤ï¼š
>
> 1. å…ˆè¿è¡Œç”Ÿäº§è€…ç¨‹åºï¼Œç”Ÿäº§è€…ä¼šæ ¹æ®ä¸åŒçš„è·¯ç”±é”®å°†æ¶ˆæ¯å‘é€åˆ°ç›¸åº”çš„é˜Ÿåˆ—ã€‚
> 2. å†è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç¨‹åºï¼Œæ¶ˆè´¹è€…ä¼šä»å„è‡ªç»‘å®šçš„é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚
>
> ç»“æœåˆ†æï¼š
>
> * `DirectRabbitmqConsumer1`
>   ä¼šæ¥æ”¶åˆ°è·¯ç”±é”®ä¸º
>   `"orange"`
>   çš„æ¶ˆæ¯ï¼Œå³
>   `"hello direct, I am orange"`
>   ã€‚
> * `DirectRabbitmqConsumer2`
>   ä¼šæ¥æ”¶åˆ°è·¯ç”±é”®ä¸º
>   `"black"`
>   å’Œ
>   `"green"`
>   çš„æ¶ˆæ¯ï¼Œå³
>   `"hello direct, I am black"`
>   å’Œ
>   `"hello direct, I am green"`
>   ã€‚
>
> é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›´è¿äº¤æ¢å™¨æ¨¡å¼æ ¹æ®è·¯ç”±é”®ç²¾ç¡®åˆ†å‘æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œä¸åŒçš„é˜Ÿåˆ—å¯ä»¥æ ¹æ®ç»‘å®šçš„è·¯ç”±é”®æ¥æ”¶ä¸åŒçš„æ¶ˆæ¯ï¼Œå®ç°äº†æ¶ˆæ¯çš„å®šå‘åˆ†å‘ã€‚

---

## 5. Topicsï¼ˆé€šé…ç¬¦æ¨¡å¼ï¼‰

> ![](https://i-blog.csdnimg.cn/direct/9f9b706a8ddd40009a0b588709888995.png)
>
> **è§’è‰²**
> ï¼š
>
> * **P (Producer)**
>   : ç”Ÿäº§è€…ã€‚
> * **X (Exchange, äº¤æ¢æœº)**
>   : æ ¹æ® RoutingKey çš„é€šé…ç¬¦åŒ¹é…è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ°å¯¹åº”çš„é˜Ÿåˆ—ã€‚
> * **C1, C2 (Consumers)**
>   : å¤šä¸ªæ¶ˆè´¹è€…ã€‚
> * **Queue (æ¶ˆæ¯é˜Ÿåˆ—)**
>   : ç”¨äºç¼“å­˜æ¶ˆæ¯ã€‚
>
> **ç‰¹ç‚¹**
> ï¼šç±»ä¼¼äº Routing æ¨¡å¼ï¼Œä½†ä½¿ç”¨é€šé…ç¬¦æ¥å®šä¹‰ RoutingKey çš„æ¨¡å¼ï¼Œä½¿å¾—åŒ¹é…æ›´åŠ çµæ´»ã€‚
>
> **é€‚ç”¨åœºæ™¯**
> ï¼šéœ€è¦çµæ´»åŒ¹é…å’Œè¿‡æ»¤æ¶ˆæ¯çš„åœºæ™¯ã€‚
>
> **ç¤ºä¾‹å›¾**
> ï¼šå±•ç¤ºäº¤æ¢æœºæ ¹æ®é€šé…ç¬¦åŒ¹é…è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚

### 1. å¸¸é‡ç±»

å®šä¹‰ä¸€äº›å¸¸é‡ï¼Œç”¨äºå­˜å‚¨ RabbitMQ è¿æ¥ä¿¡æ¯ä»¥åŠä¸»é¢˜äº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„åç§°ã€‚

```java
public class Constants {
    public static final String HOST = "110.41.51.65";
    public static final Integer PORT = 15673;
    public static final String VIRTUAL_HOST = "bite";
    public static final String USER_NAME = "study";
    public static final String PASSWORD = "study";
    public static final String TOPIC_EXCHANGE_NAME = "test_topic";
    public static final String TOPIC_QUEUE_NAME1 = "topic_queue1";
    public static final String TOPIC_QUEUE_NAME2 = "topic_queue2";
}

```

### 2. ç”Ÿäº§è€…

ç”Ÿäº§è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜ä¸»é¢˜äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå°†é˜Ÿåˆ—ä¸äº¤æ¢å™¨é€šè¿‡ä¸åŒçš„ä¸»é¢˜æ¨¡å¼è¿›è¡Œç»‘å®šï¼Œæœ€åæ ¹æ®ä¸åŒçš„ä¸»é¢˜å‘é€æ¶ˆæ¯ã€‚

```java
import com.rabbitmq.client.BuiltinExchangeType;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import constant.Constants;

public class TopicRabbitProducer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. åˆ›å»ºä¸»é¢˜äº¤æ¢å™¨
        channel.exchangeDeclare(Constants.TOPIC_EXCHANGE_NAME, 
                BuiltinExchangeType.TOPIC, true, false, false, null);

        // 5. å£°æ˜é˜Ÿåˆ—
        channel.queueDeclare(Constants.TOPIC_QUEUE_NAME1, true, false, false, null);
        channel.queueDeclare(Constants.TOPIC_QUEUE_NAME2, true, false, false, null);

        // 6. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨
        // é˜Ÿåˆ— 1 ç»‘å®š *.errorï¼Œä»…æ¥æ”¶ error ä¿¡æ¯
        channel.queueBind(Constants.TOPIC_QUEUE_NAME1, Constants.TOPIC_EXCHANGE_NAME, "*.error");
        // é˜Ÿåˆ— 2 ç»‘å®š #.info å’Œ *.errorï¼Œæ¥æ”¶ info å’Œ error ä¿¡æ¯
        channel.queueBind(Constants.TOPIC_QUEUE_NAME2, Constants.TOPIC_EXCHANGE_NAME, "#.info");
        channel.queueBind(Constants.TOPIC_QUEUE_NAME2, Constants.TOPIC_EXCHANGE_NAME, "*.error");

        // 7. å‘é€æ¶ˆæ¯
        String msg = "hello topic, I'm order.error";
        channel.basicPublish(Constants.TOPIC_EXCHANGE_NAME, "order.error", null, msg.getBytes());

        String msg_black = "hello topic, I'm order.pay.info";
        channel.basicPublish(Constants.TOPIC_EXCHANGE_NAME, "order.pay.info", null, msg_black.getBytes());

        String msg_green = "hello topic, I'm pay.error";
        channel.basicPublish(Constants.TOPIC_EXCHANGE_NAME, "pay.error", null, msg_green.getBytes());

        // 8. é‡Šæ”¾èµ„æº
        channel.close();
        connection.close();
    }
}

```

ä»£ç è§£é‡Šï¼š

> * **è¿æ¥è®¾ç½®**
>   ï¼šä½¿ç”¨
>   `ConnectionFactory`
>   åˆ›å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½® RabbitMQ æœåŠ¡å™¨çš„ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶ååˆ›å»ºè¿æ¥å’Œé€šé“ã€‚
> * **äº¤æ¢å™¨å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.exchangeDeclare`
>   æ–¹æ³•å£°æ˜ä¸€ä¸ªä¸»é¢˜äº¤æ¢å™¨ï¼ŒæŒ‡å®šäº¤æ¢å™¨åç§°ã€ç±»å‹ä¸º
>   `TOPIC`
>   ï¼Œå¹¶è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚
> * **é˜Ÿåˆ—å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.queueDeclare`
>   æ–¹æ³•å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—ï¼ŒåŒæ ·è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚
> * **ç»‘å®šæ“ä½œ**
>   ï¼šä½¿ç”¨
>   `channel.queueBind`
>   æ–¹æ³•å°†é˜Ÿåˆ— 1 ç»‘å®šåˆ°ä¸»é¢˜æ¨¡å¼
>   `"*.error"`
>   ï¼Œé˜Ÿåˆ— 2 ç»‘å®šåˆ°ä¸»é¢˜æ¨¡å¼
>   `"#.info"`
>   å’Œ
>   `"*.error"`
>   ã€‚å…¶ä¸­ï¼Œ
>   `*`
>   è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ
>   `#`
>   è¡¨ç¤ºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚
> * **æ¶ˆæ¯å‘é€**
>   ï¼šä½¿ç”¨
>   `channel.basicPublish`
>   æ–¹æ³•æ ¹æ®ä¸åŒçš„ä¸»é¢˜å‘é€ä¸åŒçš„æ¶ˆæ¯ã€‚
> * **èµ„æºé‡Šæ”¾**
>   ï¼šå‘é€å®Œæ¶ˆæ¯åï¼Œå…³é—­é€šé“å’Œè¿æ¥ã€‚

### 3. æ¶ˆè´¹è€…ä»£ç 

æ¶ˆè´¹è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œä»æŒ‡å®šçš„é˜Ÿåˆ—ä¸­æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ã€‚

æ¶ˆè´¹è€… 1ï¼š
`TopicRabbitmqConsumer1`

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class TopicRabbitmqConsumer1 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
                    AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.TOPIC_QUEUE_NAME1, true, consumer);
    }
}

```

æ¶ˆè´¹è€… 2ï¼š
`TopicRabbitmqConsumer2`

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class TopicRabbitmqConsumer2 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
                    AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.TOPIC_QUEUE_NAME2, true, consumer);
    }
}

```

> ä»£ç è§£é‡Šï¼š
>
> * **è¿æ¥å’Œé€šé“åˆ›å»º**
>   ï¼šä¸ç”Ÿäº§è€…ç±»ä¼¼ï¼Œåˆ›å»ºè¿æ¥å·¥å‚ã€è¿æ¥å’Œé€šé“ã€‚
> * **æ¶ˆæ¯æ¶ˆè´¹**
>   ï¼šåˆ›å»º
>   `DefaultConsumer`
>   å¯¹è±¡ï¼Œå¹¶é‡å†™
>   `handleDelivery`
>   æ–¹æ³•ç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ä½¿ç”¨
>   `channel.basicConsume`
>   æ–¹æ³•ä»æŒ‡å®šé˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¾ç½®è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ã€‚
>
> 4. è¿è¡Œç»“æœåŠåˆ†æ
>
> è¿è¡Œæ­¥éª¤ï¼š
>
> 1. å…ˆè¿è¡Œç”Ÿäº§è€…ç¨‹åºï¼Œç”Ÿäº§è€…ä¼šæ ¹æ®ä¸åŒçš„ä¸»é¢˜å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜äº¤æ¢å™¨ã€‚
> 2. å†è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç¨‹åºï¼Œæ¶ˆè´¹è€…ä¼šä»å„è‡ªç»‘å®šçš„é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚
>
> ç»“æœåˆ†æï¼š
>
> * `TopicRabbitmqConsumer1`
>   ä¼šæ¥æ”¶åˆ°ä¸»é¢˜åŒ¹é…
>   `"*.error"`
>   çš„æ¶ˆæ¯ï¼Œå³
>   `"hello topic, I'm order.error"`
>   å’Œ
>   `"hello topic, I'm pay.error"`
>   ã€‚
> * `TopicRabbitmqConsumer2`
>   ä¼šæ¥æ”¶åˆ°ä¸»é¢˜åŒ¹é…
>   `"#.info"`
>   å’Œ
>   `"*.error"`
>   çš„æ¶ˆæ¯ï¼Œå³
>   `"hello topic, I'm order.pay.info"`
>   ã€
>   `"hello topic, I'm order.error"`
>   å’Œ
>   `"hello topic, I'm pay.error"`
>   ã€‚
>
> é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»é¢˜äº¤æ¢å™¨æ¨¡å¼æ ¹æ®ä¸»é¢˜æ¨¡å¼çµæ´»åˆ†å‘æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œä¸åŒçš„é˜Ÿåˆ—å¯ä»¥æ ¹æ®ç»‘å®šçš„ä¸»é¢˜æ¨¡å¼æ¥æ”¶ä¸åŒçš„æ¶ˆæ¯ï¼Œå®ç°äº†æ¶ˆæ¯çš„çµæ´»è®¢é˜…å’Œåˆ†å‘ã€‚

---

## 6. RPC (Remote Procedure Call, è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)

> ![](https://i-blog.csdnimg.cn/direct/f8ba8329a71348dc87cdb6f661e8c746.png)
> **è§’è‰²**
> ï¼š
>
> * **å®¢æˆ·ç«¯ (Client)**
>   : å‘é€è¯·æ±‚æ¶ˆæ¯å¹¶ç­‰å¾…å“åº”ã€‚
> * **æœåŠ¡ç«¯ (Server)**
>   : æ¥æ”¶è¯·æ±‚æ¶ˆæ¯å¹¶å‘é€å“åº”æ¶ˆæ¯ã€‚
>
> ![](https://i-blog.csdnimg.cn/direct/3357580eb72646669e2199961d0cc762.png)
>
> **ç‰¹ç‚¹**
> ï¼šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½® replyTo å­—æ®µæŒ‡å®šå›è°ƒé˜Ÿåˆ—ã€‚æœåŠ¡ç«¯å¤„ç†è¯·æ±‚å¹¶å‘é€å“åº”æ¶ˆæ¯åˆ°å›è°ƒé˜Ÿåˆ—ã€‚å®¢æˆ·ç«¯åœ¨å›è°ƒé˜Ÿåˆ—ä¸Šç­‰å¾…å“åº”æ¶ˆæ¯ï¼Œå¹¶æ£€æŸ¥ correlationId å±æ€§ä»¥ç¡®ä¿å®ƒæ˜¯æ‰€æœŸæœ›çš„å“åº”ã€‚
>
> **é€‚ç”¨åœºæ™¯**
> ï¼šéœ€è¦å®ç°è¿œç¨‹è°ƒç”¨çš„è¿‡ç¨‹ï¼Œä¾‹å¦‚å¾®æœåŠ¡é—´çš„é€šä¿¡ã€‚

### 1. å¸¸é‡

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›å¸¸é‡ï¼Œç”¨äºå­˜å‚¨ RabbitMQ è¿æ¥ä¿¡æ¯ä»¥åŠä¸»é¢˜äº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„åç§°ã€‚

```java
public class Constants {
    public static final String HOST = "110.41.51.65";
    public static final Integer PORT = 15673;
    public static final String VIRTUAL_HOST = "bite";
    public static final String USER_NAME = "study";
    public static final String PASSWORD = "study";
    public static final String TOPIC_EXCHANGE_NAME = "test_topic";
    public static final String TOPIC_QUEUE_NAME1 = "topic_queue1";
    public static final String TOPIC_QUEUE_NAME2 = "topic_queue2";
}

```

### 2. ç”Ÿäº§è€…

ç”Ÿäº§è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œå£°æ˜ä¸»é¢˜äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå°†é˜Ÿåˆ—ä¸äº¤æ¢å™¨é€šè¿‡ä¸åŒçš„ä¸»é¢˜æ¨¡å¼è¿›è¡Œç»‘å®šï¼Œæœ€åæ ¹æ®ä¸åŒçš„ä¸»é¢˜å‘é€æ¶ˆæ¯ã€‚

```java
import com.rabbitmq.client.BuiltinExchangeType;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import constant.Constants;

public class TopicRabbitProducer {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. åˆ›å»ºä¸»é¢˜äº¤æ¢å™¨
        channel.exchangeDeclare(Constants.TOPIC_EXCHANGE_NAME, 
                BuiltinExchangeType.TOPIC, true, false, false, null);

        // 5. å£°æ˜é˜Ÿåˆ—
        channel.queueDeclare(Constants.TOPIC_QUEUE_NAME1, true, false, false, null);
        channel.queueDeclare(Constants.TOPIC_QUEUE_NAME2, true, false, false, null);

        // 6. ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢å™¨
        // é˜Ÿåˆ— 1 ç»‘å®š *.errorï¼Œä»…æ¥æ”¶ error ä¿¡æ¯
        channel.queueBind(Constants.TOPIC_QUEUE_NAME1, Constants.TOPIC_EXCHANGE_NAME, "*.error");
        // é˜Ÿåˆ— 2 ç»‘å®š #.info å’Œ *.errorï¼Œæ¥æ”¶ info å’Œ error ä¿¡æ¯
        channel.queueBind(Constants.TOPIC_QUEUE_NAME2, Constants.TOPIC_EXCHANGE_NAME, "#.info");
        channel.queueBind(Constants.TOPIC_QUEUE_NAME2, Constants.TOPIC_EXCHANGE_NAME, "*.error");

        // 7. å‘é€æ¶ˆæ¯
        String msg = "hello topic, I'm order.error";
        channel.basicPublish(Constants.TOPIC_EXCHANGE_NAME, "order.error", null, msg.getBytes());

        String msg_black = "hello topic, I'm order.pay.info";
        channel.basicPublish(Constants.TOPIC_EXCHANGE_NAME, "order.pay.info", null, msg_black.getBytes());

        String msg_green = "hello topic, I'm pay.error";
        channel.basicPublish(Constants.TOPIC_EXCHANGE_NAME, "pay.error", null, msg_green.getBytes());

        // 8. é‡Šæ”¾èµ„æº
        channel.close();
        connection.close();
    }
}

```

ä»£ç è§£é‡Šï¼š

> * **è¿æ¥è®¾ç½®**
>   ï¼šä½¿ç”¨
>   `ConnectionFactory`
>   åˆ›å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½® RabbitMQ æœåŠ¡å™¨çš„ä¸»æœºåœ°å€ã€ç«¯å£ã€è™šæ‹Ÿä¸»æœºã€ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶ååˆ›å»ºè¿æ¥å’Œé€šé“ã€‚
> * **äº¤æ¢å™¨å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.exchangeDeclare`
>   æ–¹æ³•å£°æ˜ä¸€ä¸ªä¸»é¢˜äº¤æ¢å™¨ï¼ŒæŒ‡å®šäº¤æ¢å™¨åç§°ã€ç±»å‹ä¸º
>   `TOPIC`
>   ï¼Œå¹¶è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚
> * **é˜Ÿåˆ—å£°æ˜**
>   ï¼šä½¿ç”¨
>   `channel.queueDeclare`
>   æ–¹æ³•å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—ï¼ŒåŒæ ·è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚
> * **ç»‘å®šæ“ä½œ**
>   ï¼šä½¿ç”¨
>   `channel.queueBind`
>   æ–¹æ³•å°†é˜Ÿåˆ— 1 ç»‘å®šåˆ°ä¸»é¢˜æ¨¡å¼
>   `"*.error"`
>   ï¼Œé˜Ÿåˆ— 2 ç»‘å®šåˆ°ä¸»é¢˜æ¨¡å¼
>   `"#.info"`
>   å’Œ
>   `"*.error"`
>   ã€‚å…¶ä¸­ï¼Œ
>   `*`
>   è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ
>   `#`
>   è¡¨ç¤ºåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚
> * **æ¶ˆæ¯å‘é€**
>   ï¼šä½¿ç”¨
>   `channel.basicPublish`
>   æ–¹æ³•æ ¹æ®ä¸åŒçš„ä¸»é¢˜å‘é€ä¸åŒçš„æ¶ˆæ¯ã€‚
> * **èµ„æºé‡Šæ”¾**
>   ï¼šå‘é€å®Œæ¶ˆæ¯åï¼Œå…³é—­é€šé“å’Œè¿æ¥ã€‚

### 3. æ¶ˆè´¹è€…

æ¶ˆè´¹è€…çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ›å»ºä¸ RabbitMQ çš„è¿æ¥ï¼Œä»æŒ‡å®šçš„é˜Ÿåˆ—ä¸­æ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯ã€‚

æ¶ˆè´¹è€… 1ï¼š
`TopicRabbitmqConsumer1`

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class TopicRabbitmqConsumer1 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
                    AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.TOPIC_QUEUE_NAME1, true, consumer);
    }
}

```

æ¶ˆè´¹è€… 2ï¼š
`TopicRabbitmqConsumer2`

```java
import com.rabbitmq.client.*;
import constant.Constants;
import java.io.IOException;

public class TopicRabbitmqConsumer2 {
    public static void main(String[] args) throws Exception {
        // 1. åˆ›å»ºè¿æ¥å·¥å‚
        ConnectionFactory factory = new ConnectionFactory();
        // è®¾ç½®è¿æ¥å‚æ•°
        factory.setHost(Constants.HOST);
        factory.setPort(Constants.PORT);
        factory.setVirtualHost(Constants.VIRTUAL_HOST);
        factory.setUsername(Constants.USER_NAME);
        factory.setPassword(Constants.PASSWORD);

        // 2. åˆ›å»ºè¿æ¥
        Connection connection = factory.newConnection();
        // 3. åˆ›å»ºé€šé“
        Channel channel = connection.createChannel();

        // 4. æ¥æ”¶å¹¶æ¶ˆè´¹æ¶ˆæ¯
        DefaultConsumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, 
                    AMQP.BasicProperties properties, byte[] body) throws IOException {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯: " + new String(body));
            }
        };
        channel.basicConsume(Constants.TOPIC_QUEUE_NAME2, true, consumer);
    }
}

```

> ä»£ç è§£é‡Šï¼š
>
> * **è¿æ¥å’Œé€šé“åˆ›å»º**
>   ï¼šä¸ç”Ÿäº§è€…ç±»ä¼¼ï¼Œåˆ›å»ºè¿æ¥å·¥å‚ã€è¿æ¥å’Œé€šé“ã€‚
> * **æ¶ˆæ¯æ¶ˆè´¹**
>   ï¼šåˆ›å»º
>   `DefaultConsumer`
>   å¯¹è±¡ï¼Œå¹¶é‡å†™
>   `handleDelivery`
>   æ–¹æ³•ç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ä½¿ç”¨
>   `channel.basicConsume`
>   æ–¹æ³•ä»æŒ‡å®šé˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè®¾ç½®è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ã€‚
>
> 4. è¿è¡Œç»“æœåŠåˆ†æ
>
> è¿è¡Œæ­¥éª¤ï¼š
>
> 1. å…ˆè¿è¡Œç”Ÿäº§è€…ç¨‹åºï¼Œç”Ÿäº§è€…ä¼šæ ¹æ®ä¸åŒçš„ä¸»é¢˜å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜äº¤æ¢å™¨ã€‚
> 2. å†è¿è¡Œä¸¤ä¸ªæ¶ˆè´¹è€…ç¨‹åºï¼Œæ¶ˆè´¹è€…ä¼šä»å„è‡ªç»‘å®šçš„é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚
>
> ç»“æœåˆ†æï¼š
>
> * `TopicRabbitmqConsumer1`
>   ä¼šæ¥æ”¶åˆ°ä¸»é¢˜åŒ¹é…
>   `"*.error"`
>   çš„æ¶ˆæ¯ï¼Œå³
>   `"hello topic, I'm order.error"`
>   å’Œ
>   `"hello topic, I'm pay.error"`
>   ã€‚
> * `TopicRabbitmqConsumer2`
>   ä¼šæ¥æ”¶åˆ°ä¸»é¢˜åŒ¹é…
>   `"#.info"`
>   å’Œ
>   `"*.error"`
>   çš„æ¶ˆæ¯ï¼Œå³
>   `"hello topic, I'm order.pay.info"`
>   ã€
>   `"hello topic, I'm order.error"`
>   å’Œ
>   `"hello topic, I'm pay.error"`
>   ã€‚
>
> é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»é¢˜äº¤æ¢å™¨æ¨¡å¼æ ¹æ®ä¸»é¢˜æ¨¡å¼çµæ´»åˆ†å‘æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œä¸åŒçš„é˜Ÿåˆ—å¯ä»¥æ ¹æ®ç»‘å®šçš„ä¸»é¢˜æ¨¡å¼æ¥æ”¶ä¸åŒçš„æ¶ˆæ¯ï¼Œå®ç°äº†æ¶ˆæ¯çš„çµæ´»è®¢é˜…å’Œåˆ†å‘ã€‚

---

## 7. Publisher Confirmsï¼ˆå‘å¸ƒç¡®è®¤ï¼‰

> **è§’è‰²**
> ï¼š
>
> * **P (Producer)**
>   : ç”Ÿäº§è€…ã€‚
> * **RabbitMQ Server**
>   : æ¶ˆæ¯æœåŠ¡å™¨.
>
> **ç‰¹ç‚¹**
> ï¼šç”Ÿäº§è€…å°† Channel è®¾ç½®ä¸º confirm æ¨¡å¼ï¼Œå‘å¸ƒçš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šè·å¾—ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚å½“æ¶ˆæ¯è¢« RabbitMQ æœåŠ¡å™¨æ¥æ”¶å¹¶å¤„ç†åï¼ŒæœåŠ¡å™¨ä¼šå¼‚æ­¥åœ°å‘ç”Ÿäº§è€…å‘é€ä¸€ä¸ªç¡®è®¤ (ACK)ï¼Œè¡¨æ˜æ¶ˆæ¯å·²ç»é€è¾¾ã€‚
>
> **é€‚ç”¨åœºæ™¯**
> ï¼šå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œä¾‹å¦‚é‡‘èäº¤æ˜“ã€è®¢å•å¤„ç†ã€‚
>
> ![](https://i-blog.csdnimg.cn/direct/1d99f9905cb247d68a9a33f42b4baff5.png)

### 1. å¸¸é‡ç±»

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›å¸¸é‡ï¼ŒåŒ…æ‹¬ RabbitMQ çš„è¿æ¥ä¿¡æ¯å’Œé˜Ÿåˆ—åç§°ï¼Œä»¥åŠè¦å‘é€çš„æ¶ˆæ¯æ•°é‡ã€‚å‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ª
`Constants`
ç±»æ¥å­˜å‚¨ RabbitMQ çš„è¿æ¥ä¿¡æ¯ã€‚

```java
import constant.Constants;
import java.io.IOException;
import java.util.Collections;
import java.util.SortedSet;
import java.util.TreeSet;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.ConfirmListener;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

public class PublisherConfirms {
    private static final int MESSAGE_COUNT = 500;
    private static final String PUBLISHER_CONFIRMS_QUEUE_NAME1 = "publisher_confirms_queue1";
    private static final String PUBLISHER_CONFIRMS_QUEUE_NAME2 = "publisher_confirms_queue2";
    private static final String PUBLISHER_CONFIRMS_QUEUE_NAME3 = "publisher_confirms_queue3";

    // åˆ›å»º RabbitMQ è¿æ¥
    static Connection createConnection() throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost(Constants.HOST); // ip é»˜è®¤å€¼ localhost
        factory.setPort(Constants.PORT); // é»˜è®¤å€¼ 5672
        factory.setVirtualHost(Constants.VIRTUAL_HOST); // è™šæ‹Ÿæœºåç§°, é»˜è®¤ /
        factory.setUsername(Constants.USER_NAME); // â½¤â¼¾å, é»˜è®¤ guest
        factory.setPassword(Constants.PASSWORD); // å¯†ç , é»˜è®¤ guest
        return factory.newConnection();
    }

    public static void main(String[] args) throws Exception {
        publishMessagesIndividually();
        publishMessagesInBatch();
        handlePublishConfirmsAsynchronously();
    }

```

### 2. å•ç‹¬ç¡®è®¤æ¨¡å¼ï¼ˆIndividual Confirmsï¼‰

åœ¨å•ç‹¬ç¡®è®¤æ¨¡å¼ä¸‹ï¼Œç”Ÿäº§è€…æ¯å‘é€ä¸€æ¡æ¶ˆæ¯åï¼Œä¼šç­‰å¾… Broker çš„ç¡®è®¤ä¿¡å·ï¼Œåªæœ‰åœ¨æ”¶åˆ°ç¡®è®¤åæ‰ä¼šç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯ç®€å•ç›´è§‚ï¼Œä½†æ€§èƒ½è¾ƒä½ï¼Œå› ä¸ºæ¯æ¬¡å‘é€æ¶ˆæ¯éƒ½éœ€è¦ç­‰å¾…ç¡®è®¤ï¼Œä¼šå¼•å…¥é¢å¤–çš„å»¶è¿Ÿã€‚

```java
    static void publishMessagesIndividually() throws Exception {
        try (Connection connection = createConnection()) {
            // åˆ›å»º channel
            Channel ch = connection.createChannel();
            // å¼€å¯ä¿¡é“ç¡®è®¤æ¨¡å¼
            ch.confirmSelect();
            // å£°æ˜é˜Ÿåˆ—
            ch.queueDeclare(PUBLISHER_CONFIRMS_QUEUE_NAME1, true, false, true, null);

            long start = System.currentTimeMillis();
            // å¾ªç¯å‘é€æ¶ˆæ¯
            for (int i = 0; i < MESSAGE_COUNT; i++) {
                String body = "æ¶ˆæ¯" + i;
                // å‘å¸ƒæ¶ˆæ¯
                ch.basicPublish("", PUBLISHER_CONFIRMS_QUEUE_NAME1, null, body.getBytes());
                // ç­‰å¾…ç¡®è®¤æ¶ˆæ¯ã€‚åªè¦æ¶ˆæ¯è¢«ç¡®è®¤ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¿”å›
                // å¦‚æœè¶…æ—¶è¿‡æœŸ, åˆ™æŠ›å‡º TimeoutExceptionã€‚å¦‚æœä»»ä½•æ¶ˆæ¯è¢« nack(ä¸¢å¤±ï¼‰, waitForConfirmsOrDie å°†æŠ›å‡º IOExceptionã€‚
                ch.waitForConfirmsOrDie(5_000);
            }
            long end = System.currentTimeMillis();
            System.out.format("Published %d messages individually in %d ms%n", MESSAGE_COUNT, end - start);
        }
    }

```

### 3. æ‰¹é‡ç¡®è®¤æ¨¡å¼ï¼ˆBatch Confirmsï¼‰

æ‰¹é‡ç¡®è®¤æ¨¡å¼æ˜¯å°†å¤šæ¡æ¶ˆæ¯ä½œä¸ºä¸€ä¸ªæ‰¹æ¬¡å‘é€ï¼Œç„¶åç­‰å¾…æ•´ä¸ªæ‰¹æ¬¡çš„æ¶ˆæ¯éƒ½è¢«ç¡®è®¤ã€‚è¿™ç§æ¨¡å¼çš„æ€§èƒ½æ¯”å•ç‹¬ç¡®è®¤æ¨¡å¼è¦å¥½ï¼Œå› ä¸ºå‡å°‘äº†ç­‰å¾…ç¡®è®¤çš„æ¬¡æ•°ï¼Œä½†å¦‚æœå…¶ä¸­ä¸€æ¡æ¶ˆæ¯å¤±è´¥ï¼Œéœ€è¦é‡æ–°å‘é€æ•´ä¸ªæ‰¹æ¬¡çš„æ¶ˆæ¯ã€‚

```java
    static void publishMessagesInBatch() throws Exception {
        try (Connection connection = createConnection()) {
            // åˆ›å»ºä¿¡é“
            Channel ch = connection.createChannel();
            // ä¿¡é“è®¾ç½®ä¸º confirm æ¨¡å¼
            ch.confirmSelect();
            // å£°æ˜é˜Ÿåˆ—
            ch.queueDeclare(PUBLISHER_CONFIRMS_QUEUE_NAME2, true, false, true, null);

            int batchSize = 100;
            int outstandingMessageCount = 0;
            long start = System.currentTimeMillis();

            for (int i = 0; i < MESSAGE_COUNT; i++) {
                String body = "æ¶ˆæ¯" + i;
                // å‘é€æ¶ˆæ¯
                ch.basicPublish("", PUBLISHER_CONFIRMS_QUEUE_NAME2, null, body.getBytes());
                outstandingMessageCount++;
                // æ‰¹é‡ç¡®è®¤æ¶ˆæ¯
                if (outstandingMessageCount == batchSize) {
                    ch.waitForConfirmsOrDie(5_000);
                    outstandingMessageCount = 0;
                }
            }
            // æ¶ˆæ¯å‘é€å®Œï¼Œè¿˜æœ‰æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œè¿›è¡Œç¡®è®¤
            if (outstandingMessageCount > 0) {
                ch.waitForConfirmsOrDie(5_000);
            }
            long end = System.currentTimeMillis();
            System.out.format("Published %d messages in batch in %d ms%n", MESSAGE_COUNT, end - start);
        }
    }

```

### 4. å¼‚æ­¥ç¡®è®¤æ¨¡å¼ï¼ˆAsynchronous Confirmsï¼‰

å¼‚æ­¥ç¡®è®¤æ¨¡å¼æ˜¯åœ¨å‘é€æ¶ˆæ¯çš„åŒæ—¶ï¼Œé€šè¿‡æ³¨å†Œä¸€ä¸ªç¡®è®¤ç›‘å¬å™¨æ¥å¤„ç† Broker çš„ç¡®è®¤ä¿¡å·ã€‚è¿™ç§æ¨¡å¼çš„æ€§èƒ½æœ€é«˜ï¼Œå› ä¸ºç”Ÿäº§è€…å¯ä»¥åœ¨å‘é€æ¶ˆæ¯åç»§ç»­å‘é€å…¶ä»–æ¶ˆæ¯ï¼Œè€Œä¸éœ€è¦ç­‰å¾…ç¡®è®¤ï¼Œç¡®è®¤ä¿¡å·ä¼šåœ¨åå°å¼‚æ­¥å¤„ç†ã€‚

```java
    static void handlePublishConfirmsAsynchronously() throws Exception {
        try (Connection connection = createConnection()) {
            Channel ch = connection.createChannel();
            ch.queueDeclare(PUBLISHER_CONFIRMS_QUEUE_NAME3, false, false, true, null);
            ch.confirmSelect();

            // æœ‰åºé›†åˆï¼Œå…ƒç´ æŒ‰ç…§è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œå­˜å‚¨æœª confirm æ¶ˆæ¯åºå·
            SortedSet<Long> confirmSet = Collections.synchronizedSortedSet(new TreeSet<>());

            ch.addConfirmListener(new ConfirmListener() {
                @Override
                public void handleAck(long deliveryTag, boolean multiple) throws IOException {
                    // multiple æ‰¹é‡
                    // confirmSet.headSet(n) æ–¹æ³•è¿”å›å½“å‰é›†åˆä¸­å°äº n çš„é›†åˆ
                    if (multiple) {
                        // æ‰¹é‡ç¡®è®¤ï¼šå°†é›†åˆä¸­å°äºç­‰äºå½“å‰åºå· deliveryTag å…ƒç´ çš„é›†åˆæ¸…é™¤ï¼Œè¡¨ç¤ºè¿™æ‰¹åºå·çš„æ¶ˆæ¯éƒ½å·²ç»è¢« ack äº†
                        confirmSet.headSet(deliveryTag + 1).clear();
                    } else {
                        // å•æ¡ç¡®è®¤ï¼šå°†å½“å‰çš„ deliveryTag ä»é›†åˆä¸­ç§»é™¤
                        confirmSet.remove(deliveryTag);
                    }
                }

                @Override
                public void handleNack(long deliveryTag, boolean multiple) throws IOException {
                    System.err.format("deliveryTag: %d, multiple: %b%n", deliveryTag, multiple);
                    if (multiple) {
                        // æ‰¹é‡ç¡®è®¤ï¼šå°†é›†åˆä¸­å°äºç­‰äºå½“å‰åºå· deliveryTag å…ƒç´ çš„é›†åˆæ¸…é™¤ï¼Œè¡¨ç¤ºè¿™æ‰¹åºå·çš„æ¶ˆæ¯éƒ½å·²ç»è¢« ack äº†
                        confirmSet.headSet(deliveryTag + 1).clear();
                    } else {
                        // å•æ¡ç¡®è®¤ï¼šå°†å½“å‰çš„ deliveryTag ä»é›†åˆä¸­ç§»é™¤
                        confirmSet.remove(deliveryTag);
                    }
                    // å¦‚æœå¤„ç†å¤±è´¥ï¼Œè¿™é‡Œéœ€è¦æ·»åŠ å¤„ç†æ¶ˆæ¯é‡å‘çš„åœºæ™¯ã€‚æ­¤å¤„ä»£ç çœç•¥
                }
            });

            // å¾ªç¯å‘é€æ¶ˆæ¯
            long start = System.currentTimeMillis();
            for (int i = 0; i < MESSAGE_COUNT; i++) {
                String message = "æ¶ˆæ¯" + i;
                // å¾—åˆ°ä¸‹æ¬¡å‘é€æ¶ˆæ¯çš„åºå·ï¼Œä» 1 å¼€å§‹
                long nextPublishSeqNo = ch.getNextPublishSeqNo();
                ch.basicPublish("", PUBLISHER_CONFIRMS_QUEUE_NAME3, null, message.getBytes());
                // å°†åºå·å­˜å…¥é›†åˆä¸­
                confirmSet.add(nextPublishSeqNo);
            }

            // æ¶ˆæ¯ç¡®è®¤å®Œæ¯•
            while (!confirmSet.isEmpty()) {
                Thread.sleep(10);
            }
            long end = System.currentTimeMillis();
            System.out.format("Published %d messages and handled confirms asynchronously in %d ms%n", MESSAGE_COUNT, end - start);
        }
    }
}

```

### 5. æ€§èƒ½å¯¹æ¯”

æ¶ˆæ¯æ•°è¶Šå¤šï¼Œå¼‚æ­¥ç¡®è®¤çš„ä¼˜åŠ¿è¶Šæ˜æ˜¾ã€‚ä»¥ä¸‹æ˜¯ä¸åŒæ¶ˆæ¯æ•°é‡ä¸‹ä¸‰ç§ç­–ç•¥çš„æ€§èƒ½å¯¹æ¯”ï¼š

#### 200 æ¡æ¶ˆæ¯çš„ç»“æœå¯¹æ¯”

```
Published 200 messages individually in 6931 ms
Published 200 messages in batch in 137 ms
Published 200 messages and handled confirms asynchronously in 73 ms

```

#### 500 æ¡æ¶ˆæ¯ç»“æœå¯¹æ¯”

```
Published 500 messages individually in 15805 ms
Published 500 messages in batch in 246 ms
Published 500 messages and handled confirms asynchronously in 107 ms

```

> * ä»ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œ
>   **å•ç‹¬ç¡®è®¤æ¨¡å¼**
>   çš„æ€§èƒ½æœ€å·®ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæ¯æ¡æ¶ˆæ¯ç­‰å¾…ç¡®è®¤ï¼Œå¼•å…¥äº†å¤§é‡çš„å»¶è¿Ÿã€‚
> * **æ‰¹é‡ç¡®è®¤æ¨¡å¼**
>   é€šè¿‡å‡å°‘ç­‰å¾…ç¡®è®¤çš„æ¬¡æ•°ï¼Œæé«˜äº†æ€§èƒ½ã€‚
> * è€Œ
>   **å¼‚æ­¥ç¡®è®¤æ¨¡å¼**
>   åˆ™è¿›ä¸€æ­¥ä¼˜åŒ–äº†æ€§èƒ½ï¼Œå› ä¸ºå®ƒå…è®¸ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯çš„åŒæ—¶ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œç¡®è®¤ä¿¡å·åœ¨åå°å¼‚æ­¥å¤„ç†ã€‚
>
> å› æ­¤ï¼Œ
> **åœ¨éœ€è¦é«˜ååé‡çš„åœºæ™¯ä¸­ï¼Œå»ºè®®ä½¿ç”¨å¼‚æ­¥ç¡®è®¤æ¨¡å¼ã€‚**

---

## æ€»ç»“

#### 

**ç”»äº†è¿™ä¹ˆä¹…çš„é¥¼ç»ˆäºå®ç°äº†å“ˆå“ˆå“ˆï¼Œä¸è¿‡ç°åœ¨å¤§éƒ¨åˆ†éƒ½ç”¨ springboot å°è£…çš„æ¥å®ç°äº†ã€‚ä»¥å‰è‚¯å®šè¿˜æœ‰å¾ˆå¤šå‘ï¼Œä»¥åä¼šæ…¢æ…¢è¡¥å…¨çš„ï¼Œæ„Ÿè°¢é˜…è§ˆï¼ï¼**