---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f796f7563686f75313237342f:61727469636c652f64657461696c732f313436313839353937"
layout: post
title: "05.åŸºäº-TCP-çš„è¿œç¨‹è®¡ç®—å™¨ä»åè®®è®¾è®¡åˆ°é«˜å¹¶å‘å®ç°"
date: 2025-03-11 21:33:01 +08:00
description: "è®¡ç®—æœºç½‘ç»œçš„æ ¸å¿ƒå°±æ˜¯é€šä¿¡ã€‚"
keywords: "05.åŸºäº TCP çš„è¿œç¨‹è®¡ç®—å™¨ï¼šä»åè®®è®¾è®¡åˆ°é«˜å¹¶å‘å®ç°"
categories: ['è®¡ç®—æœºç½‘ç»œ']
tags: ['ç½‘ç»œåè®®', 'ç½‘ç»œ', 'ç®—æ³•', 'Vscode', 'Tcp', 'Linux', 'C']
artid: "146189597"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146189597
    alt: "05.åŸºäº-TCP-çš„è¿œç¨‹è®¡ç®—å™¨ä»åè®®è®¾è®¡åˆ°é«˜å¹¶å‘å®ç°"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146189597
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146189597
cover: https://bing.ee123.net/img/rand?artid=146189597
image: https://bing.ee123.net/img/rand?artid=146189597
img: https://bing.ee123.net/img/rand?artid=146189597
---

# 05.åŸºäº TCP çš„è¿œç¨‹è®¡ç®—å™¨ï¼šä»åè®®è®¾è®¡åˆ°é«˜å¹¶å‘å®ç°

## **ğŸ“– ç›®å½•**

1. **ğŸ“Œ å‰è¨€**
2. **ğŸ” éœ€æ±‚åˆ†æ**
   * ğŸ¤” æˆ‘ä»¬éœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ
3. **ğŸ¯ æ–¹æ¡ˆè®¾è®¡**
   * ğŸ’¡ æœåŠ¡å™¨æ¶æ„
4. **ğŸš€ ä»€ä¹ˆæ˜¯åè®®ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡åè®®ï¼Ÿ**
   * ğŸ“Œ ç»“æ„åŒ–æ•°æ®çš„ä¼ è¾“é—®é¢˜
5. **ğŸ“Œ åè®®å®šåˆ¶ï¼šå¦‚ä½•è®©æœåŠ¡å™¨æ­£ç¡®è§£ææ•°æ®ï¼Ÿ**
   * âŒ TCP ç›´æ¥ä¼ è¾“çš„é—®é¢˜
   * âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨æ•°æ®å‰åŠ ä¸Šé•¿åº¦ä¿¡æ¯
6. **ğŸ“Œ åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šå¦‚ä½•è®©æ•°æ®æ›´å®¹æ˜“è§£æï¼Ÿ**
   * ğŸ“Œ ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿ
   * ğŸ“Œ é€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–æ–¹å¼
   * ğŸ“œ é€šä¿¡åè®®è®¾è®¡
7. **ğŸ”§ æ ¸å¿ƒä»£ç è§£æ**
   * ğŸ”¹ åè®®å°è£…
   * ğŸ”¹ è§£ææ•°æ®
   * ğŸ”¹ æœåŠ¡å™¨å¤„ç†è¯·æ±‚
   * ğŸ”¹ ç½‘ç»œé€šä¿¡çš„å®ç°
   * ğŸ”¹ æœåŠ¡å™¨å¹¶å‘å¤„ç†æ¨¡å‹
   * ğŸ”¹ å®¢æˆ·ç«¯è¯·æ±‚çš„å‘é€ä¸æ¥æ”¶
8. **ğŸš€ è¿˜æœ‰å“ªäº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ**
   * ğŸ›  é‡‡ç”¨æ›´é«˜æ•ˆçš„å¹¶å‘æ¨¡å‹
   * ğŸ”’ å¢åŠ å®‰å…¨æ€§
   * ğŸ“¡ æ”¯æŒæ›´ä¸°å¯Œçš„è®¡ç®—åŠŸèƒ½
   * ğŸ“ˆ å¢å¼ºæ—¥å¿—ä¸ç›‘æ§
   * ğŸŒ è®©å®ƒæ”¯æŒæ›´å¤šè®¾å¤‡ï¼ˆè·¨å¹³å° & Web è®¿é—®ï¼‰

---

## **ğŸ“Œ 1. å‰è¨€**

è®¡ç®—æœºç½‘ç»œçš„æ ¸å¿ƒå°±æ˜¯é€šä¿¡ã€‚è¿œç¨‹è®¡ç®—å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼š

* **æœ¬åœ°å®¢æˆ·ç«¯**
  è´Ÿè´£å‘é€è®¡ç®—è¯·æ±‚ï¼ˆå¦‚
  `10 + 20`
  ï¼‰
* **è¿œç¨‹æœåŠ¡å™¨**
  è´Ÿè´£è§£æã€è®¡ç®—ï¼Œå¹¶è¿”å›ç»“æœï¼ˆå¦‚
  `30`
  ï¼‰

è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ï¼š
**å®ç°ä¸€ä¸ªåŸºäº TCP çš„è¿œç¨‹è®¡ç®—æœåŠ¡**
ï¼Œè®©å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å‘é€è®¡ç®—è¯·æ±‚ï¼ŒæœåŠ¡å™¨è§£æå¹¶è¿”å›ç»“æœã€‚

---

## **ğŸ” 2. éœ€æ±‚åˆ†æ**

#### **ğŸ¤” æˆ‘ä»¬éœ€è¦è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ**

**1. è®¡ç®—å™¨çš„æ ¸å¿ƒåŠŸèƒ½**

* æ”¯æŒåŸºæœ¬çš„
  `+ - * / %`
  è¿ç®—
* è¿œç¨‹è®¡ç®—ï¼Œå®¢æˆ·ç«¯å‘é€è®¡ç®—è¯·æ±‚ï¼ŒæœåŠ¡å™¨è®¡ç®—å¹¶è¿”å›ç»“æœ
* å¤„ç†å¼‚å¸¸æƒ…å†µï¼ˆå¦‚é™¤é›¶ï¼‰

**2. ç½‘ç»œé€šä¿¡çš„æŒ‘æˆ˜**

* **å¦‚ä½•ä¿è¯æ•°æ®å®Œæ•´æ€§ï¼Ÿ**
  ï¼ˆTCP æ˜¯
  **æµå¼ä¼ è¾“**
  ï¼Œå¯èƒ½ä¼šç²˜åŒ…ï¼‰
* **å¦‚ä½•è§£ææ•°æ®ï¼Ÿ**
  ï¼ˆå®¢æˆ·ç«¯å‘é€çš„
  `10 + 20`
  ï¼ŒæœåŠ¡å™¨æ€ä¹ˆæ‹†è§£ï¼Ÿï¼‰
* **å¦‚ä½•æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ï¼Ÿ**
  ï¼ˆæœåŠ¡å™¨è¦èƒ½å¹¶å‘å¤„ç†è¯·æ±‚ï¼‰

---

## **ğŸ¯ 3. æ–¹æ¡ˆè®¾è®¡**

#### **ğŸ’¡ æœåŠ¡å™¨æ¶æ„**

```
[ å®¢æˆ·ç«¯ ]      <--TCP-->     [ æœåŠ¡å™¨ ]
     |                               |
     |-- ç”¨æˆ·è¾“å…¥                   |-- è§£æè¯·æ±‚
     |-- å‘é€è®¡ç®—å¼                 |-- è®¡ç®—ç»“æœ
     |-- æ˜¾ç¤ºè¿ç®—ç»“æœ               |-- å‘é€ç»“æœ

```

---

## **ğŸš€ 4. ä»€ä¹ˆæ˜¯åè®®ï¼Ÿä¸ºä»€ä¹ˆè¦è®¾è®¡åè®®ï¼Ÿ**

åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œä¸åŒçš„è®¾å¤‡æƒ³è¦äº’ç›¸é€šä¿¡ï¼Œå°±å¿…é¡»
**è¯´åŒä¸€ç§è¯­è¨€**
ï¼Œå¦åˆ™å°±ä¼šé¸¡åŒé¸­è®²ï¼Œæ— æ³•ç†è§£å¯¹æ–¹çš„ä¿¡æ¯ã€‚è€Œè¿™ç§â€œè¯­è¨€â€ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­å°±è¢«ç§°ä¸º
**åè®®ï¼ˆProtocolï¼‰**
ã€‚

è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±ä»
**åè®®çš„æ¦‚å¿µ**
å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ‹†è§£å¦‚ä½•åŸºäº
**TCP**
å®ç°ä¸€ä¸ªâ€œè¿œç¨‹è®¡ç®—å™¨â€æœåŠ¡ï¼Œè®©å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œå‘é€è®¡ç®—è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åè®¡ç®—ç»“æœå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

---

## **ğŸ“Œ 5. åè®®å®šåˆ¶ï¼šå¦‚ä½•è®©æœåŠ¡å™¨æ­£ç¡®è§£ææ•°æ®ï¼Ÿ**

#### **âŒ TCP ç›´æ¥ä¼ è¾“çš„é—®é¢˜**

TCP æ˜¯
**é¢å‘æµçš„åè®®**
ï¼Œå®ƒä¸ä¼šå¸®æˆ‘ä»¬åˆ’åˆ†æ•°æ®è¾¹ç•Œï¼Œå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š

1. **ç²˜åŒ…é—®é¢˜ï¼ˆå¤šä¸ªå°æ•°æ®åŒ…åˆå¹¶ï¼‰**
2. **æ‹†åŒ…é—®é¢˜ï¼ˆä¸€ä¸ªå¤§æ•°æ®åŒ…è¢«æ‹†æˆå¤šéƒ¨åˆ†ï¼‰**

#### **âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨æ•°æ®å‰åŠ ä¸Šé•¿åº¦ä¿¡æ¯**

åœ¨æ•°æ®åŒ…å‰åŠ ä¸Š
**å›ºå®šé•¿åº¦çš„å¤´éƒ¨**
ï¼Œå­˜å‚¨æ•°æ®é•¿åº¦ï¼š

```
[æ•°æ®é•¿åº¦][è®¡ç®—è¡¨è¾¾å¼]

```

---

## **ğŸ“Œ 6. åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šå¦‚ä½•è®©æ•°æ®æ›´å®¹æ˜“è§£æï¼Ÿ**

#### **ğŸ“Œ ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿ**

åºåˆ—åŒ–ï¼ˆSerializationï¼‰å°±æ˜¯
**å°†æ•°æ®è½¬æ¢ä¸ºå¯ä¼ è¾“çš„æ ¼å¼**
ï¼Œç„¶ååœ¨æ¥æ”¶ç«¯
**ååºåˆ—åŒ–**
ï¼ˆDeserializationï¼‰å›åŸå§‹æ ¼å¼ã€‚

#### **ğŸ“Œ é€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–æ–¹å¼**

è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨
**JSON**
ï¼Œå› ä¸ºå®ƒæ˜“è¯»æ˜“è§£æã€‚

#### **ğŸ“œ é€šä¿¡åè®®è®¾è®¡**

å®¢æˆ·ç«¯å‘é€çš„ JSON è¯·æ±‚æ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "expr": "10+20"
}

```

æœåŠ¡å™¨è¿”å›çš„ JSON ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "result": 30
}

```

---

## **ğŸ”§ 7. æ ¸å¿ƒä»£ç è§£æ**

### **ğŸ”¹ åè®®å°è£…**

```cpp
std::string encode_request(const std::string& expr)
{
    json j;
    j["expr"] = expr;
    return j.dump();
}

```

### **ğŸ”¹ è§£ææ•°æ®**

```cpp
std::string decode_response(const std::string& response)
{
    json j = json::parse(response);
    return j["result"].get<int>();
}

```

### **ğŸ”¹ æœåŠ¡å™¨å¤„ç†è¯·æ±‚**

```cpp
std::string process_request(const std::string& request)
{
    json j = json::parse(request);
    std::string expr = j["expr"];
    int result = eval(expr); // è®¡ç®—è¡¨è¾¾å¼
    json response;
    response["result"] = result;
    return response.dump();
}

```

### **ğŸ”¹ ç½‘ç»œé€šä¿¡çš„å®ç°**

```cpp
void handle_client(int client_sock)
{
    char buffer[1024] = {0};
    read(client_sock, buffer, 1024);
    
    std::string response = process_request(buffer);
    
    send(client_sock, response.c_str(), response.length(), 0);
    close(client_sock);
}

```

### **ğŸ”¹ æœåŠ¡å™¨å¹¶å‘å¤„ç†æ¨¡å‹**

```cpp
void start_server()
{
    int server_fd = socket(AF_INET, SOCK_STREAM, 0);
    struct sockaddr_in address;
    
    bind(server_fd, (struct sockaddr*)&address, sizeof(address));
    listen(server_fd, 5);
    
    while (true)
    {
        int client_sock = accept(server_fd, NULL, NULL);
        std::thread(handle_client, client_sock).detach();
    }
}

```

### **ğŸ”¹ å®¢æˆ·ç«¯è¯·æ±‚çš„å‘é€ä¸æ¥æ”¶**

```cpp
void send_request(const std::string& expr)
{
    int sock = socket(AF_INET, SOCK_STREAM, 0);
    struct sockaddr_in serv_addr;
    
    connect(sock, (struct sockaddr*)&serv_addr, sizeof(serv_addr));
    
    std::string request = encode_request(expr);
    send(sock, request.c_str(), request.length(), 0);
    
    char buffer[1024] = {0};
    read(sock, buffer, 1024);
    std::cout << "Server response: " << decode_response(buffer) << std::endl;
    
    close(sock);
}

```

### æœ€ç»ˆæ•ˆæœ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/2717f4d656794145b64e3c8e7a3afa44.png)

## **ğŸš€ 8. è¿˜æœ‰å“ªäº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ**

è™½ç„¶æˆ‘ä»¬çš„è¿œç¨‹è®¡ç®—å™¨å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†ä»ç„¶æœ‰è®¸å¤šä¼˜åŒ–ç©ºé—´ã€‚ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›å¯ä»¥æ”¹è¿›çš„æ–¹å‘ï¼Œå¹¶ç»™å‡ºå¤§è‡´çš„æ€è·¯ï¼š

#### **ğŸ›  1. é‡‡ç”¨æ›´é«˜æ•ˆçš„å¹¶å‘æ¨¡å‹**

ç›®å‰æœåŠ¡å™¨é‡‡ç”¨
**å¤šè¿›ç¨‹**
æ–¹å¼å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯ï¼Œä½†æ¯æ¬¡è¿æ¥éƒ½ä¼š
`fork()`
ä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿›ç¨‹åˆ›å»ºå’Œå›æ”¶çš„å¼€é”€è¾ƒå¤§ã€‚å¦‚æœè¿æ¥æ•°å¢åŠ ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™ã€‚

âœ…
**æ”¹è¿›æ–¹å‘**
ï¼š

* **çº¿ç¨‹æ± **
  ï¼šå¯ä»¥ä½¿ç”¨
  `std::thread`
  + çº¿ç¨‹æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»º/é”€æ¯è¿›ç¨‹ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ã€‚
* **`epoll`
  /
  `select`**
  ï¼šåŸºäº I/O å¤ç”¨çš„æ–¹å¼ï¼Œå®ç°
  **å•è¿›ç¨‹ç®¡ç†å¤šä¸ªè¿æ¥**
  ï¼Œå‡å°‘èµ„æºå ç”¨ã€‚
* **åç¨‹æ–¹æ¡ˆ**
  ï¼šä½¿ç”¨
  `libco`
  æˆ–
  `Boost.Asio`
  å®ç°é«˜å¹¶å‘çš„è®¡ç®—æœåŠ¡ã€‚

---

#### **ğŸ”’ 2. å¢åŠ å®‰å…¨æ€§**

ç›®å‰å®¢æˆ·ç«¯å¯ä»¥éšæ„è¾“å…¥æ•°æ®ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥äº†
`"100 / 0"`
ï¼Œå°±ä¼šå¯¼è‡´
**é™¤é›¶å¼‚å¸¸**
ã€‚æ­¤å¤–ï¼ŒæœåŠ¡å™¨ç›®å‰
**æ²¡æœ‰èº«ä»½éªŒè¯æœºåˆ¶**
ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¿æ¥å¹¶å‘é€è®¡ç®—è¯·æ±‚ã€‚

âœ…
**æ”¹è¿›æ–¹å‘**
ï¼š

* è¾“å…¥æ ¡éªŒ

  ï¼šåœ¨è§£æ

  ```
  x op y

  ```

  ä¹‹å‰ï¼Œæ£€æŸ¥è¿ç®—æ˜¯å¦åˆæ³•ï¼Œæ¯”å¦‚ï¼š

  ```cpp
  if (op == '/' && y == 0) {
      return "ERROR: Division by zero";
  }

  ```
* **èº«ä»½éªŒè¯**
  ï¼šå¯ä»¥æ·»åŠ 
  **ç”¨æˆ·å + å¯†ç **
  è®¤è¯ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®è®¡ç®—æœåŠ¡ã€‚
* **SQL æ³¨å…¥é˜²æŠ¤**
  ï¼ˆå¦‚æœæ¶‰åŠæ•°æ®åº“ï¼‰

---

#### **ğŸ“¡ 3. æ”¯æŒæ›´ä¸°å¯Œçš„è®¡ç®—åŠŸèƒ½**

ç›®å‰è®¡ç®—å™¨åªæ”¯æŒ
`+ - * / %`
ï¼Œå¦‚æœæƒ³è®©å®ƒæ›´å¼ºå¤§ï¼Œå¯ä»¥æ‰©å±•ä¸º
**æ•°å­¦è®¡ç®—å¼•æ“**
ï¼Œæ”¯æŒ
**sin()ã€cos()ã€log()ã€pow()**
ç­‰å‡½æ•°ã€‚

âœ…
**æ”¹è¿›æ–¹å‘**
ï¼š

* **è§£ææ•°å­¦è¡¨è¾¾å¼**
  ï¼šå¯ä»¥ç”¨
  `Shunting Yard Algorithm`
  è§£æå¤æ‚è¡¨è¾¾å¼ï¼Œå¦‚
  `3 + 5 * (2 - 8) / sin(30)`
  ã€‚
* **ç»“åˆå¼€æºæ•°å­¦åº“**
  ï¼šå¦‚
  `ExprTk`
  è§£ææ•°å­¦è¡¨è¾¾å¼ï¼Œç”šè‡³æ”¯æŒå¾®ç§¯åˆ†è®¡ç®—ã€‚

---

#### **ğŸ“ˆ 4. å¢å¼ºæ—¥å¿—ä¸ç›‘æ§**

ç›®å‰æœåŠ¡å™¨
**æ²¡æœ‰æ—¥å¿—ç³»ç»Ÿ**
ï¼Œå¦‚æœæŸä¸ªè¯·æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬å¾ˆéš¾çŸ¥é“
**å‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜**
ã€‚

âœ…
**æ”¹è¿›æ–¹å‘**
ï¼š

* **æ—¥å¿—ç³»ç»Ÿ**
  ï¼šä½¿ç”¨
  `log4cpp`
  æˆ–
  `spdlog`
  è®°å½•æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚
* **ç›‘æ§ç³»ç»Ÿ**
  ï¼šå¯ä»¥ç»“åˆ
  `Prometheus + Grafana`
  ç›‘æ§è¯·æ±‚æ•°é‡ã€CPU ä½¿ç”¨ç‡ç­‰æ•°æ®ï¼Œç¡®ä¿æœåŠ¡å™¨ç¨³å®šè¿è¡Œã€‚

---

#### **ğŸŒ 5. è®©å®ƒæ”¯æŒæ›´å¤šè®¾å¤‡ï¼ˆè·¨å¹³å° & Web è®¿é—®ï¼‰**

ç›®å‰æˆ‘ä»¬çš„è®¡ç®—å™¨æ˜¯
**C++ å®¢æˆ·ç«¯ + C++ æœåŠ¡å™¨**
ï¼Œä½†å¦‚æœæƒ³è¦è®©
**ç½‘é¡µã€æ‰‹æœºã€Python è„šæœ¬**
ä¹Ÿèƒ½è°ƒç”¨è®¡ç®—æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ª
**HTTP API**
æˆ–
**WebSocket**
ç‰ˆæœ¬ã€‚

âœ…
**æ”¹è¿›æ–¹å‘**
ï¼š

* RESTful API

  ï¼šè®©å®¢æˆ·ç«¯ç”¨

  ```
  curl

  ```

  æˆ–

  ```
  Python

  ```

  ç›´æ¥è°ƒç”¨ï¼š

  ```
  GET /calculate?expr=10+2 HTTP/1.1

  ```
* **WebSocket æ”¯æŒ**
  ï¼šè®©å‰ç«¯ç½‘é¡µä¹Ÿèƒ½å®æ—¶è®¡ç®—ã€‚