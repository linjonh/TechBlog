---
layout: post
title: "嵌入式Linux-使用iperf3同时压力测试4个网口-解决方案"
date: 2024-04-28 22:38:12 +0800
description: "文章目录iperf介绍安装iperf被测Linux板子PC主机iperf使用Linux网口初始化配置"
keywords: "iperf压力测试"
categories: ['网络传输', 'Linux', 'I']
tags: ['网络', 'Windows', 'Linux', 'Iperf']
artid: "119116970"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=119116970
    alt: "嵌入式Linux-使用iperf3同时压力测试4个网口-解决方案"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=119116970
featuredImagePreview: https://bing.ee123.net/img/rand?artid=119116970
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     嵌入式Linux 使用iperf3同时压力测试4个网口 解决方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#iperf_1" rel="nofollow">
        iperf
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_2" rel="nofollow">
          介绍
         </a>
        </li>
        <li>
         <a href="#iperf_4" rel="nofollow">
          安装iperf
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#Linux_5" rel="nofollow">
            被测Linux板子
           </a>
          </li>
          <li>
           <a href="#PC_9" rel="nofollow">
            PC主机
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li>
       <a href="#iperf_18" rel="nofollow">
        iperf使用
       </a>
      </li>
      <li>
       <a href="#Linux_51" rel="nofollow">
        Linux网口初始化配置
       </a>
      </li>
      <li>
       <a href="#4_73" rel="nofollow">
        同时测试4个网口吞吐量
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#Linux_74" rel="nofollow">
          Linux板子
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#linux_117" rel="nofollow">
            linux后台运行和关闭、查看后台任务
           </a>
          </li>
          <li>
           <ul>
            <li>
             <a href="#fg_120" rel="nofollow">
              fg
             </a>
            </li>
            <li>
             <a href="#ctrl__z_132" rel="nofollow">
              ctrl + z
             </a>
            </li>
            <li>
             <a href="#kill_136" rel="nofollow">
              kill
             </a>
            </li>
            <li>
             <a href="#bg_147" rel="nofollow">
              bg
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
        <li>
         <a href="#windows__156" rel="nofollow">
          windows 电脑
         </a>
        </li>
        <li>
         <a href="#_174" rel="nofollow">
          结果
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#iperfUDP_181" rel="nofollow">
        iperf测试UDP丢包率
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="iperf_1">
     </a>
     iperf
    </h2>
    <h3>
     <a id="_2">
     </a>
     介绍
    </h3>
    <p>
     iperf是一种命令行工具，用于通过测量服务器可以处理的最大网络吞吐量来诊断网络速度问题。它在遇到网络速度问题时特别有用，通过该工具可以确定哪个服务器无法达到最大吞吐量。
    </p>
    <h3>
     <a id="iperf_4">
     </a>
     安装iperf
    </h3>
    <h4>
     <a id="Linux_5">
     </a>
     被测Linux板子
    </h4>
    <p>
     板子是Linux环境，一般情况都会有iperf3，在目录
     <code>
      usr/bin
     </code>
     下，可以查找到
     <code>
      iperf3
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ed3ed0e763dc2510fbfffb1cb683200d.png"/>
    </p>
    <h4>
     <a id="PC_9">
     </a>
     PC主机
    </h4>
    <p>
     因为电脑是windows环境，考虑到使用Ubuntu是虚拟机的状态下运行，会影响到网络的测试，因此直接使用iperf 的windows版本
    </p>
    <p>
     首先先去iperf官网下载 https://iperf.fr/iperf-download.php
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2bc861f55c52b70c0148af18516674e8.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e9c6bff785896f04908bd983ac4cd721.png"/>
     </img>
    </p>
    <p>
     对于windows版的Iperf，直接将解压出来的
     <code>
      iperf3.exe
     </code>
     和
     <code>
      cygwin1.dll
     </code>
     复制到
     <code>
      C:\Windows\System32
     </code>
     ，这样cmd可以直接打开
    </p>
    <h2>
     <a id="iperf_18">
     </a>
     iperf使用
    </h2>
    <p>
     Windows打开cmd进入后，测试一下iperf如何使用，以及正常运行是什么状态
    </p>
    <p>
     基本的使用方法，如果Windows环境就是 iperf3 替换成 iperf3.exe
    </p>
    <pre><code class="prism language-c">iperf3 <span class="token operator">-</span>c 服务端ip <span class="token operator">-</span>p 监听的端口号 <span class="token operator">-</span>b 带宽 <span class="token operator">-</span>i 时间间隔<span class="token punctuation">(</span>单位秒<span class="token punctuation">)</span> <span class="token operator">-</span>t 持续时间<span class="token punctuation">(</span>单位秒<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token function">R</span><span class="token punctuation">(</span>反向传输<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token function">u</span><span class="token punctuation">(</span>采用udp模式<span class="token punctuation">)</span>
</code></pre>
    <table>
     <thead>
      <tr>
       <th>
        选项
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        -F
       </td>
       <td>
        更改运行测试的格式。例如，您可以使用-f k以每秒Kbits而不是每秒Mbits的速度获得结果。有效选项包括m（Mbits，默认），k（Kbits），K（KBytes）和M（MBytes）。
       </td>
      </tr>
      <tr>
       <td>
        -V
       </td>
       <td>
        强制iPerf使用IPv6而不是IPv4。
       </td>
      </tr>
      <tr>
       <td>
        -i
       </td>
       <td>
        更改带宽测试之间的间隔。例如，-i 60将每60秒生成一个新的带宽报告。默认值为零，执行一次带宽测试。
       </td>
      </tr>
      <tr>
       <td>
        -p
       </td>
       <td>
        更改端口。未指定时，默认端口为5001.您必须在客户端和服务器上都使用此标志。
       </td>
      </tr>
      <tr>
       <td>
        -B
       </td>
       <td>
        将iPerf绑定到特定的接口或地址。如果通过server命令传递，则将设置传入接口。如果通过client命令传递，则将设置传出接口。
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     然后就是测试一下
    </p>
    <p>
     单个网口连接（保证两个连接的网卡在
     <strong>
      同一网段
     </strong>
     ！）测试
    </p>
    <p>
     服务端（接收，这里接收端是windows环境，所以需要用iperf3.exe）启动：
    </p>
    <pre><code class="prism language-c">iperf3<span class="token punctuation">.</span>exe <span class="token operator">-</span>s
</code></pre>
    <p>
     客户端（发送）启动;
    </p>
    <pre><code class="prism language-c">iperf3 <span class="token operator">-</span>u <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span> <span class="token operator">-</span>i <span class="token number">1</span> <span class="token operator">-</span>t <span class="token number">60</span> <span class="token operator">-</span>b <span class="token number">100</span>M
</code></pre>
    <p>
     以udp模式向服务端 192.168.0.2 发送100M带宽的数据，持续60秒，每秒发送一次报告。
    </p>
    <h2>
     <a id="Linux_51">
     </a>
     Linux网口初始化配置
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c8c6de6cadd066ed19f84e970e4ae633.png"/>
    </p>
    <p>
     板子上存在4个网口，需要配置IP，为了避免一些不必要的麻烦，分别在四个网段
    </p>
    <pre><code class="prism language-c">ifconfig eth1 <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.232</span>
ifconfig eth2 <span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.232</span>
ifconfig eth3 <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.232</span>

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/62ed9f3e81412d77f944822142b52db4.png">
      <br/>
      初始化完成之后，就是接下来的测试工作，PC段的四个网卡ip也分别为
     </img>
    </p>
    <pre><code class="prism language-c"><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span>
<span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.2</span>
<span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.2</span>
<span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.2</span>
</code></pre>
    <h2>
     <a id="4_73">
     </a>
     同时测试4个网口吞吐量
    </h2>
    <h3>
     <a id="Linux_74">
     </a>
     Linux板子
    </h3>
    <p>
     Linux板子根据实际的信息流向，三个网口使用udp发送，也就是需要开三个客户端通过UDP发送
    </p>
    <p>
     对板子的控制因为只能通过串口或者网口，因此没有办法像电脑操作打开多个窗口
    </p>
    <p>
     使用 后台运行 + 隐藏打印
    </p>
    <pre><code class="prism language-c">iperf3 <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.2</span> <span class="token operator">-</span>u <span class="token operator">-</span>p <span class="token number">6001</span> <span class="token operator">-</span>t <span class="token number">9999</span> <span class="token operator">-</span>b <span class="token number">1000</span>m <span class="token operator">&gt;</span><span class="token operator">/</span>dev<span class="token operator">/</span>null <span class="token operator">&amp;</span>
</code></pre>
    <pre><code class="prism language-c">iperf3 <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.2</span><span class="token number">.2</span> <span class="token operator">-</span>u <span class="token operator">-</span>p <span class="token number">6002</span> <span class="token operator">-</span>t <span class="token number">9999</span> <span class="token operator">-</span>b <span class="token number">1000</span>m <span class="token operator">&gt;</span><span class="token operator">/</span>dev<span class="token operator">/</span>null <span class="token operator">&amp;</span>
</code></pre>
    <pre><code class="prism language-c">iperf3 <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.2</span> <span class="token operator">-</span>u <span class="token operator">-</span>p <span class="token number">6003</span> <span class="token operator">-</span>t <span class="token number">9999</span> <span class="token operator">-</span>b <span class="token number">1000</span>m <span class="token operator">&gt;</span><span class="token operator">/</span>dev<span class="token operator">/</span>null <span class="token operator">&amp;</span>
</code></pre>
    <p>
     注意：
    </p>
    <ul>
     <li>
      因为使用的是UDP，所以要
      <strong>
       配置数据带宽，-b 1000m
      </strong>
      ，不然速度会很低
     </li>
     <li>
      将打印信息输出到 &gt;/dev/null，可以不在调试界面打印
     </li>
     <li>
      &amp; 隐藏到后台运行
     </li>
    </ul>
    <p>
     通过
    </p>
    <pre><code class="prism language-c">top
</code></pre>
    <p>
     查看cpu占用率以及后台使用情况
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a20a9d536541731c79c52736e652eeba.png"/>
    </p>
    <pre><code class="prism language-c">jobs <span class="token operator">-</span>l		
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4b9702f0e1e4f0e2efeeb4021b6e0863.png">
      <br/>
      接着就是设置第四个网口，作为服务端，接受数据，使用TCP协议
     </img>
    </p>
    <pre><code class="prism language-c">iperf3 <span class="token operator">-</span>s <span class="token operator">-</span>p <span class="token number">6000</span> <span class="token operator">&gt;</span><span class="token operator">/</span>dev<span class="token operator">/</span>null <span class="token operator">&amp;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b18eddf45f6830b63960123dc066b5a3.png"/>
    </p>
    <h4>
     <a id="linux_117">
     </a>
     linux后台运行和关闭、查看后台任务
    </h4>
    <p>
     插播一段linux后台运行和关闭、查看后台任务的命令
    </p>
    <h5>
     <a id="fg_120">
     </a>
     fg
    </h5>
    <p>
     将后台中的命令调至前台继续运行。如果后台中有多个命令，可以用
    </p>
    <pre><code class="prism language-c">fg <span class="token operator">%</span>jobnumber（是命令编号，不是进程号）
</code></pre>
    <p>
     将选中的命令调出。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ee3f505481ab6101a7949881ec7f697d.png"/>
    </p>
    <h5>
     <a id="ctrl__z_132">
     </a>
     ctrl + z
    </h5>
    <p>
     可以将一个正在前台执行的命令放到后台，并且处于暂停状态。
    </p>
    <h5>
     <a id="kill_136">
     </a>
     kill
    </h5>
    <p>
     法子1：通过jobs命令查看job号（假设为num），然后执行
    </p>
    <pre><code class="prism language-c">kill <span class="token operator">%</span>num
</code></pre>
    <p>
     法子2：通过ps命令查看job的进程号（PID，假设为pid），然后执行kill pid
     <br/>
     前台进程的终止：Ctrl+c
    </p>
    <h5>
     <a id="bg_147">
     </a>
     bg
    </h5>
    <p>
     将一个在后台暂停的命令，变成在后台继续执行。如果后台中有多个命令，可以用
    </p>
    <pre><code class="prism language-c">bg <span class="token operator">%</span>jobnumber
</code></pre>
    <p>
     将选中的命令调出。
    </p>
    <h3>
     <a id="windows__156">
     </a>
     windows 电脑
    </h3>
    <p>
     因为Linux端已经配置完成，所以windows这边对应接受和发送就可以了
    </p>
    <p>
     首先是三个接收
    </p>
    <pre><code class="prism language-c">iperf3<span class="token punctuation">.</span>exe <span class="token operator">-</span>s <span class="token operator">-</span>p <span class="token number">6001</span>
</code></pre>
    <pre><code class="prism language-c">iperf3<span class="token punctuation">.</span>exe <span class="token operator">-</span>s <span class="token operator">-</span>p <span class="token number">6002</span>
</code></pre>
    <pre><code class="prism language-c">iperf3<span class="token punctuation">.</span>exe <span class="token operator">-</span>s <span class="token operator">-</span>p <span class="token number">6003</span>
</code></pre>
    <p>
     然后是一个发送
    </p>
    <pre><code class="prism language-c">iperf3<span class="token punctuation">.</span>exe <span class="token operator">-</span>c <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.232</span> <span class="token operator">-</span>p <span class="token number">6000</span> <span class="token operator">-</span>t <span class="token number">9999</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/b2bbb6942f2f0f37ca789145c86be5c9.png"/>
    </p>
    <h3>
     <a id="_174">
     </a>
     结果
    </h3>
    <p>
     按照设定时间测试完成后，会输出测试结果
    </p>
    <p>
     （拿了一个测试千兆网口的图片，意思一下）
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/da881c0d816988ca11ba37ed95f40e49.png"/>
    </p>
    <h2>
     <a id="iperfUDP_181">
     </a>
     iperf测试UDP丢包率
    </h2>
    <p>
     因为TCP是有链接，错误也会重发，所以不存在丢包率的指标。但是对于UDP iperf也可以用于UDP数据包吞吐量、丢包率和延迟指标，但是由于UDP协议是一个非面向连接的轻量级传输协议，并且不提供可靠的数据传输服务，因此对UDP应用的关注点不是传输数据有多快，而是它的丢包率和延时指标。
    </p>
    <p>
     通过iperf的“-u”参数即可测试UDP应用的传输性能，下测试的是在iperf客户端传输1000MB的UDP数据包的输出结果.：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3429847dcc05bb27e40c5f5b249320dd.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f737a6d313233342f:61727469636c652f64657461696c732f313139313136393730" class_="artid" style="display:none">
 </p>
</div>


