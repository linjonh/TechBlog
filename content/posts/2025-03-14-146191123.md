---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37343731323435332f:61727469636c652f64657461696c732f313436313931313233"
layout: post
title: "åŸºäºŽSTM32çš„ç«ç¾æŠ¥è­¦è®¾å¤‡é˜¿é‡Œäº‘å¹³å°"
date: 2025-03-14 11:37:47 +08:00
description: "éœ€è¦å®žç‰©çš„å¯ä»¥ç§ä¿¡åšä¸»æˆ–è€…åœ¨æ–‡ç« æœ€ä¸‹æ–¹æ·»åŠ å¥½å‹ã€‚é¡¹ç›®å®žç‰©å›¾ï¼šé¡¹ç›®æ¼”ç¤ºè§†é¢‘ï¼šåŸºäºŽSTM32çš„ç«ç¾æŠ¥è­¦ç³»ç»Ÿï¼ˆé˜¿é‡Œäº‘å¹³å°ï¼‰"
keywords: "åŸºäºŽSTM32çš„ç«ç¾æŠ¥è­¦è®¾å¤‡ï¼ˆé˜¿é‡Œäº‘å¹³å°ï¼‰"
categories: ['å•ç‰‡æœºè¯¾è®¾æ¯•è®¾']
tags: ['Stm']
artid: "146191123"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191123
    alt: "åŸºäºŽSTM32çš„ç«ç¾æŠ¥è­¦è®¾å¤‡é˜¿é‡Œäº‘å¹³å°"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191123
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191123
cover: https://bing.ee123.net/img/rand?artid=146191123
image: https://bing.ee123.net/img/rand?artid=146191123
img: https://bing.ee123.net/img/rand?artid=146191123
---

# åŸºäºŽSTM32çš„ç«ç¾æŠ¥è­¦è®¾å¤‡ï¼ˆé˜¿é‡Œäº‘å¹³å°ï¼‰

---

## å‰è¨€ï¼š

æºä»£ç ä¸‹è½½é“¾æŽ¥ï¼š

* [https://download.csdn.net/download/m0_74712453/90474701](https://download.csdn.net/download/m0_74712453/90474701 "https://download.csdn.net/download/m0_74712453/90474701")

![](https://i-blog.csdnimg.cn/direct/30b238fa934b40c284a49f4189ef27db.png)

éœ€è¦å®žç‰©çš„å¯ä»¥ç§ä¿¡åšä¸»æˆ–è€…åœ¨æ–‡ç« æœ€ä¸‹æ–¹æ·»åŠ å¥½å‹ã€‚

## ä¸€ã€é¡¹ç›®ä»‹ç»å’Œæ¼”ç¤ºè§†é¢‘

é¡¹ç›®å®žç‰©å›¾ï¼š

![](https://i-blog.csdnimg.cn/direct/1b38302230f64668af27219e717c534b.png)

![](https://i-blog.csdnimg.cn/direct/78271be2f4b249aea711bb664d2a88a0.png)

é¡¹ç›®æ¼”ç¤ºè§†é¢‘ï¼š

åŸºäºŽSTM32çš„ç«ç¾æŠ¥è­¦ç³»ç»Ÿï¼ˆé˜¿é‡Œäº‘å¹³å°ï¼‰

## äºŒã€ç¡¬ä»¶éœ€æ±‚å‡†å¤‡

* STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿
* 0.96å¯¸OLEDå±å¹•
* ESP88266-01s
* DHT11æ¸©æ¹¿åº¦æ¨¡å—
* ç«ç„°æ¨¡å—
* èœ‚é¸£å™¨
* MQ2çƒŸé›¾ä¼ æ„Ÿå™¨
* LEDç¯

## ä¸‰ã€ç¡¬ä»¶æ¡†å›¾

### 1. åŽŸç†å›¾

![](https://i-blog.csdnimg.cn/direct/8fc2f8ddf74d4790bd3be9373c9500a5.png)

### 2. PCB

![](https://i-blog.csdnimg.cn/direct/c7327a83c87e459e9291640157f637a3.png)

## å››ã€CubeMXé…ç½®

**1ã€RCCé…ç½®å¤–éƒ¨é«˜é€Ÿæ™¶æŒ¯â€”â€”HSE**

![](https://i-blog.csdnimg.cn/direct/2a5f4838b6d6455aa0f572c26654d556.png)
â€‹

**2ã€SYSé…ç½®ï¼šDebugè®¾ç½®æˆSerial Wire**

![](https://i-blog.csdnimg.cn/direct/0e784a06909049729b3ceade44622cee.png)
â€‹

**3ã€I2Cé…ç½®ï¼š**

![](https://i-blog.csdnimg.cn/direct/d5e13713ead6469a94d81bb7ce38827c.png)
â€‹

**4ã€ä¸²å£é…ç½®ï¼š**

![](https://i-blog.csdnimg.cn/direct/8bdadb9e5abc43ea917c4234e6d1e0ae.png)

****â€‹**
5ã€TIMé…ç½®ï¼ˆå¼€å¯ä¸­æ–­ï¼‰ï¼š**

![](https://i-blog.csdnimg.cn/direct/6d9aecec68d54bf7861918c48ad0ff68.png)

![](https://i-blog.csdnimg.cn/direct/6683e5585928466bba0d6bb9daa4551a.png)

**6ã€ADCé…ç½®ï¼š**

![](https://i-blog.csdnimg.cn/direct/d669f14392d147b3ae1dbbf7bf1c9e3e.png)

**7ã€GPIOå£é…ç½®ï¼ˆèœ‚é¸£å™¨ã€LEDã€ç«ç„°ä¼ æ„Ÿå™¨ï¼‰ ï¼š**

![](https://i-blog.csdnimg.cn/direct/fc04910398b542d69708d15e64bab695.png)
â€‹

**8ã€æ—¶é’Ÿæ ‘é…ç½®ï¼š**
![](https://i-blog.csdnimg.cn/direct/0afa2ee2a0b544b9af6474ffadbec9b6.png)

æœ€åŽæˆ‘ä»¬ç”Ÿæˆå·¥ç¨‹å³å¯ã€‚

## äº”ã€ä»£ç æ¡†æž¶

ä¸»ä½“ä»£ç å¾ªçŽ¯ç•Œé¢ï¼š

**å˜é‡ä½œç”¨è¯´æ˜Žï¼š**
**çœ‹æ‡‚å˜é‡çš„ä½œç”¨æ˜¯çœ‹æ‡‚ä»£ç çš„ç¬¬ä¸€æ­¥ï¼šï¼ˆä»£ç ä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–å˜é‡ï¼Œé‚£æ˜¯åŽé¢ä¾¿äºŽå¢žåŠ é¡¹ç›®åŠŸèƒ½çš„ä»£ç ï¼Œæœ‰äº†å®ƒä»¬å°±å¯ä»¥æ›´ä¾¿æ·æ·»åŠ ï¼‰**

```cpp
uint8_t datas[5];//ç©ºæ°”æ¸©æ¹¿åº¦æ•°æ® æ•°ç»„23ä¸ºæ¸©åº¦æ•´æ•°å°æ•°  æ•°ç»„01ä¸ºæ¹¿åº¦æ•´æ•°å°æ•°
extern unsigned int Beep_Slow;//èœ‚é¸£å™¨å‡é€Ÿï¼Œå®šæ—¶å™¨ä½¿ç”¨ï¼Œå¾—ä»¥æŽ§åˆ¶èœ‚é¸£å™¨å“çš„é¢‘çŽ‡
extern int Beep_flag;//èœ‚é¸£å™¨å¼€å…³æ ‡å¿—ä½â€”â€”ç€ç«äº†1ï¼Œæ²¡ç€ç«0
extern unsigned char Beep_data;//èœ‚é¸£å™¨GPIO 1-å¼€  0-å…³

unsigned char Flame_flag = 0;//1-æ˜¾ç¤ºå­—ä½“   0-ä¸æ˜¾ç¤ºå­—ä½“   å®žçŽ°å­—ä½“é—ªçƒçŽ°è±¡
unsigned int Flame_Slow = 0;//å®šæ—¶å™¨ä½¿ç”¨ï¼Œå­—ä½“é—ªçƒé¢‘çŽ‡å®žçŽ°
```

**åˆå§‹å…ˆè¿žæŽ¥çƒ­ç‚¹ï¼Œç„¶åŽè¿žæŽ¥é˜¿é‡Œäº‘å¹³å°ï¼š**

```cpp
u8g2_t u8g2;//å®šä¹‰ä¸€ä¸ªU8g2ç»“æž„ç±»åž‹å˜é‡
	
  u8g2Init(&u8g2);//åˆå§‹åŒ–å±å¹•
  //æ¸…å±
  u8g2_ClearBuffer(&u8g2);
  u8g2_SendBuffer(&u8g2);
	
  HAL_TIM_Base_Start_IT(&htim3);//å¼€å¯å®šæ—¶å™¨3ä¸­æ–­
  HAL_UART_Receive_IT(&huart1, &buf, 1);//å¼€å¯ä¸²å£ä¸­æ–­
	

	
  HAL_UART_Transmit(&huart1, "Hello\r\n", strlen("Hello]\r\n"),0xffff);
	
  Home_Draw(&u8g2);//æ˜¾ç¤ºå¼€æœºé¡µé¢
	
  Wifi_Connect();//WIFIè¿žæŽ¥
  u8g2DrawTest(&u8g2);//å¼€æœºåŠ¨ç”»
  u8g2_ClearBuffer(&u8g2);
  u8g2_SendBuffer(&u8g2);
  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
    Home_Menu(u8g2);//å¾ªçŽ¯ç•Œé¢ï¼ˆå¾ªçŽ¯åˆ¤æ–­ï¼Œåˆ·æ–°é¡µé¢ï¼‰
		
	}
```

**å…¨éƒ¨åˆå§‹åŒ–å¥½å¤–è®¾åŽï¼Œå°è£…å‡½æ•°æ˜¾ç¤ºåˆ°å±å¹•ä¸Š**

```cpp
//ä¸»é¡µæ˜¾ç¤ºç•Œé¢
void Home_Menu(u8g2_t u8g2)
{
	uint32_t Air = 0;
	
	while(1)//å½“å‰ä¸ºç¬¬0èœå•
	{
		
		
		Air = MQ2_data(u8g2, 0,  32, u8g2_font_ncenB10_tr);//æ‰“å°MQ2æ¨¡å—çš„çƒŸé›¾ADCè½¬æ¢æ•°æ®
		Printf_DHT11(u8g2, 0,  0, u8g2_font_ncenB10_tr);//æ‰“å°DHT11æ¨¡å—çš„æ¸©æ¹¿åº¦æ•°æ®
		u8g2_SendBuffer(&u8g2);
		u8g2_ClearBuffer(&u8g2);//åˆ·æ–°å±å¹•
		
		//ç«ç¾è­¦æŠ¥ç¯
		Beep();//å¤„ç†èœ‚é¸£å™¨æ˜¯å¦å¼€å…³æ ‡å¿—ä½
		if(Beep_flag == 1)//ç€ç«
		{
			HAL_GPIO_WritePin(GPIOB, GPIO_PIN_9,GPIO_PIN_SET);//å¼€ç¯
		}
		else
		{
			HAL_GPIO_WritePin(GPIOB, GPIO_PIN_9,GPIO_PIN_RESET);//å…³ç¯
		}
		//æ˜¯å¦å¼€å¯èœ‚é¸£å™¨
		if(Beep_data == 1)
		{
			if(Alarm_flag == 1)  HAL_GPIO_WritePin(GPIOA, GPIO_PIN_9,GPIO_PIN_RESET);
		}
		else if(Beep_data == 0)
		{
			if(Alarm_flag == 1)  HAL_GPIO_WritePin(GPIOA, GPIO_PIN_9,GPIO_PIN_SET);
		}
		
		
		if(Data_Slow > 1500 && Data_Slow < 1800 && Beep_flag == 0)  //æ•°æ®ä¸Šä¼ å‡é€ŸåŽå‘é€æ•°æ®
		{
			aliyun_Data_flag = 1;//å…è®¸ä¸Šä¼ æ•°æ®
			aliyun_Data(datas[2], datas[0], Air);
			
		}
		else if(Data_Slow > 1500 && Data_Slow < 1800 && Beep_flag == 1 && aliyun_Data_flag == 1)//ç€ç«äº†å‘é€99â„ƒ
		{

			aliyun_Data_Beeping(99,  0,  99);//å…è®¸å‘é€æ•°æ®ï¼Œä¸Šä¼ 99
			
			aliyun_Data_flag = 0;//å‘é€ä¸€æ¬¡åŽåœæ­¢å‘é€

		}
		
		
	}
	
}
```

**MQ2æ¨¡å—å°è£…å‡½æ•°å†…éƒ¨ï¼š**

```cpp
int MQ2_data(u8g2_t u8g2,u8g2_uint_t x, u8g2_uint_t y, const uint8_t *font)
{
	int value;
	
	char var_buff[100];
	char var_buff1[100];
	

	HAL_ADC_Start(&hadc1); //å¯åŠ¨ADCå•æ¬¡è½¬æ¢
	HAL_ADC_PollForConversion(&hadc1, 50); //ç­‰å¾…ADCè½¬æ¢å®Œæˆ
	value = HAL_ADC_GetValue(&hadc1); //è¯»å–ADCè½¬æ¢æ•°æ®
	
	
	u8g2_DrawXBMP(&u8g2, x, y, 16, 16, kong);//æ˜¾ç¤ºå­—ä½“
	u8g2_DrawXBMP(&u8g2, x+16, y, 16, 16, qi);
	u8g2_DrawXBMP(&u8g2, x+32, y, 16, 16, zhi);
	u8g2_DrawXBMP(&u8g2, x+48, y, 16, 16, liang);
	
	u8g2_DrawXBMP(&u8g2, x, y+16, 16, 16, huo);
	u8g2_DrawXBMP(&u8g2, x+16, y+16, 16, 16, yan);
	
	sprintf(var_buff, ": %dppm",value);  //æ˜¾ç¤ºADCè½¬æ¢æ•°æ®
	sprintf(var_buff1, ": ");
	u8g2_SetFont(&u8g2, font);
	u8g2_DrawStr(&u8g2, x+64, y+16, var_buff);
  u8g2_DrawStr(&u8g2, x+32, y+32, var_buff1);
	
  if(Beep_flag == 0)//æ˜¾ç¤ºç«ç„°æ­£å¸¸
  {
		u8g2_DrawXBMP(&u8g2, x+40, y+16, 16, 16, zheng);
	   u8g2_DrawXBMP(&u8g2, x+56, y+16, 16, 16, chang);
  }
  else if(Beep_flag == 1)//ç€ç«ï¼Œé—ªçƒç«ç„°ä¸æ­£å¸¸
  {
		if(Flame_flag == 0)//é—ªçƒå­—ä½“
		{
			
		}
		else if(Flame_flag == 1)
		{
			u8g2_DrawXBMP(&u8g2, x+40, y+16, 16, 16, bu);
			u8g2_DrawXBMP(&u8g2, x+56, y+16, 16, 16, zheng);
			u8g2_DrawXBMP(&u8g2, x+72, y+16, 16, 16, chang);
		}
		
  }

  
	return value;
}
```

**DHT11å°è£…å‡½æ•°å†…éƒ¨ï¼š**

```cpp
void Printf_DHT11(u8g2_t u8g2,u8g2_uint_t x, u8g2_uint_t y, const uint8_t *font)
{
	char var_buf[100];
	char var_buf1[100];
	
	Read_Data_From_DHT();//è¯»å–æ¸©æ¹¿åº¦æ•°æ®
	
	u8g2_DrawXBMP(&u8g2, x, y, 16, 16, kong);
	u8g2_DrawXBMP(&u8g2, x+16, y, 16, 16, qi);
	u8g2_DrawXBMP(&u8g2, x+32, y, 16, 16, wen);
	u8g2_DrawXBMP(&u8g2, x+48, y, 16, 16, du);
	u8g2_DrawXBMP(&u8g2, x, y+16, 16, 16, kong);
	u8g2_DrawXBMP(&u8g2, x+16, y+16, 16, 16, qi);
	u8g2_DrawXBMP(&u8g2, x+32, y+16, 16, 16, shi);
	u8g2_DrawXBMP(&u8g2, x+48, y+16, 16, 16, du);
	
//	sprintf(var_buf , ": %d.%d C",datas[2],datas[3]);//æ˜¾ç¤ºå°æ•°
	sprintf(var_buf , ": %d C",datas[2]);
	sprintf(var_buf1, ": %d.%d %%",datas[0],datas[1]);//ä¸æ˜¾ç¤ºå°æ•°
	u8g2_SetFont(&u8g2, font);//è®¾ç½®å­—ä½“
	u8g2_DrawStr(&u8g2, x+64, y+16, var_buf);
  u8g2_DrawStr(&u8g2, x+64, y+32, var_buf1);
}
```

**å®šæ—¶å™¨å‡é€Ÿï¼Œé—ªçƒå­—ä½“ï¼Œæ»´ç­”æ»´ç­”èœ‚é¸£å™¨ï¼š**

```cpp
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)   //ä¸­æ–­å›žè°ƒå‡½æ•°
{
	if(htim == (&htim3))//å®šæ—¶å™¨3ä¸­æ–­
	{
		Data_Slow++;//é˜¿é‡Œäº‘æ•°æ®ä¸Šä¼ å‡é€Ÿ
		if(Data_Slow == 2000)  Data_Slow = 0;

		Working_Pro();
	
	}
}

void Working_Pro()
{
	Key_Slow++;
	if(Key_Slow == 10)  Key_Slow = 0;//æŒ‰é”®æ¶ˆæŠ–
	
	if(Beep_flag == 1)//èœ‚é¸£å™¨å¼€  ç€ç«äº†
	{
		Beep_Slow ++;
		Flame_Slow ++;
		
		if(Flame_Slow == 500)//ç«ç„°çŠ¶æ€æ˜¾ç¤º
		{
			Flame_Slow = 0;//å¤ä½
			Flame_flag ^= 1;//å–å
		}
		
		if(Beep_Slow < 200 && Beep_data == 0)
		{
			Beep_data = 1;//å¼€
		}
		else if(Beep_Slow >= 200 && Beep_Slow < 400 && Beep_data == 1)
		{
			Beep_data = 0;
		}
		else if(Beep_Slow >= 400 && Beep_Slow < 600 && Beep_data == 0)
		{
			Beep_data = 1;
		}
		else if(Beep_Slow >= 600 && Beep_Slow < 1200 && Beep_data == 1)
		{
			Beep_data = 0;
		}
		else if(Beep_Slow == 1200 && Beep_data == 0)
		{
			Beep_Slow = 0;//å¤ä½
		}

	}
	else if(Beep_flag == 0)//èœ‚é¸£å™¨å…³
	{
		Beep_Slow = 0;
		Beep_data = 0;//å…³
	}
}
```

ðŸ‘‡ðŸ» éœ€è¦å®žç‰© æ·»åŠ  åšä¸»ðŸ‘‡ðŸ»