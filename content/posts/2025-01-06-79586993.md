---
layout: post
title: "编程控制仪器进行自动化测试Visa驱动GPIB驱动"
date: 2025-01-06 14:48:53 +0800
description: "本文将会介绍如何通过编程的方法来控制仪器，并进行自动测试编程控制仪器，下面简称[“程控”][3]；博"
keywords: "excel中visa无法程控仪器"
categories: ['编程技巧']
tags: ['编程', '仪器', 'Visa', 'Scpi', 'Gpib']
artid: "79586993"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=79586993
    alt: "编程控制仪器进行自动化测试Visa驱动GPIB驱动"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=79586993
featuredImagePreview: https://bing.ee123.net/img/rand?artid=79586993
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     编程控制仪器进行自动化测试（Visa驱动、GPIB驱动）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2 id="本文将会介绍如何通过编程的方法来控制仪器并进行自动测试">
     本文将会介绍如何通过编程的方法来控制仪器，并进行自动测试
    </h2>
    <hr/>
    <ul>
     <li>
      编程控制仪器，下面简称
      <strong>
       [“程控”][3]
      </strong>
      ；
     </li>
     <li>
      博主经常使用的是
      <strong>
       安捷伦
      </strong>
      、
      <strong>
       罗德与施瓦茨
      </strong>
      两大厂家的仪器；
     </li>
     <li>
      经常程控的仪器有信号源、频谱仪、示波器、网络信号分析仪、衰减器、电源等支持程控的设备；
     </li>
    </ul>
    <h4 id="程控必备基础">
     程控必备基础
    </h4>
    <p>
     学习程控仪器，就必须得了解一些相关的基础知识。
     <em>
      （曾经有群友向我请教关于程控的问题，几乎将我问到奔溃）
     </em>
    </p>
    <p>
     <strong>
      1. SCPI指令集
     </strong>
     <br/>
     可编程仪器标准命令，定义了一套用于控制可编程测试测量仪器的标准语法和命令。命令主要分为Set（控制）和Query（查询）两种。
     <br/>
     <strong>
      2. GPIB
     </strong>
     <br/>
     通用接口总线是一种设备和计算机连接的总线。大多数台式仪器是通过GPIB线以及GPIB接口与电脑相连，系统中最多不能超过15台仪器。
     <br/>
     如果是台式机或者笔记本作为主控机，需要买一个USB转GPIB的线。
     <br/>
     <strong>
      3. Visa
     </strong>
     <br/>
     Virtual instrument software architecture，虚拟仪器软件结构。可以使用网线连接仪器，通过网络地址来程控仪器，也可以通过GPIB线，使用端口程控仪器。
     <br/>
     关于visa的详细内容参见wiki：
     <a href="https://en.wikipedia.org/wiki/Virtual_instrument_software_architecture" rel="nofollow">
      https://en.wikipedia.org/wiki/Virtual_instrument_software_architecture
     </a>
     <br/>
     <strong>
      4. 编程基本功底
     </strong>
     <br/>
     基础功底是必备的，如果如何写程序都不会？肿么写程控软件？肿么写驱动程序？好比一个人，如果不会加减乘除法，却又不愿意使用计算器，却非要执拗的去做算数题，这样能有结果？欲速则不达啊。
    </p>
    <h4 id="编写程控软件的步骤">
     编写程控软件的步骤：
    </h4>
    <ol>
     <li>
      确定编程语言。
     </li>
     <li>
      明确手动控制仪器的流程，需要控制的仪器参数。
     </li>
     <li>
      查找仪器命令手册（一般从仪器官网可以下载到命令手册，），查找出对应参数的控制命令。
     </li>
     <li>
      安装GPIB或者Visa驱动（
      <strong>
       非常重要
      </strong>
      ）。
     </li>
     <li>
      调用驱动，编写自动测试流程（
      <em>
       实现你的测试流程，做你想做的事儿
      </em>
      ）。
     </li>
    </ol>
    <p>
     如果是安捷伦的设备，一般可以采用 Agilent IO软件来测试命令，也可以使用NI的NI MAX工具。
     <br/>
     GPIB和Visa我都使用过，个人比较偏爱于使用Visa，Visa相对于GPIB，封装的层次更高，更便于程序员理解和使用。
     <br/>
     编写程控软件，界面框架可以采用Qt、Winform、LabView、C++builder等，几乎没有限制。
    </p>
    <h4 id="gpib编程范例">
     GPIB编程范例：
    </h4>
    <pre class="prettyprint"><code class="hljs rust">回公司了再<span class="hljs-keyword">copy</span>一段代码示例。</code></pre>
    <h4 id="visa编程范例">
     Visa编程范例：
    </h4>
    <p>
     某电源的初始化函数
    </p>
    <pre class="prettyprint"><code class="hljs objectivec"><span class="hljs-built_in">BOOL</span> CXXXDlg::InitPower()  
{  

    <span class="hljs-keyword">char</span> chStatusDesc[_MAX_DIR] = {<!-- --><span class="hljs-number">0</span>};  
    <span class="hljs-keyword">int</span> retCnt=<span class="hljs-number">0</span>;     
    <span class="hljs-keyword">char</span> instrDesc[<span class="hljs-number">100</span>]={<!-- --><span class="hljs-number">0</span>};      
    ViFindList find_list;     
    <span class="hljs-keyword">float</span> voltSetting, currSetting;  
    voltSetting = atof(ini_powervolt);  
    currSetting = atof(ini_powercurrent);  
    VISAstatus=viOpenDefaultRM(&amp;defrm);  
    <span class="hljs-keyword">if</span> (VISAstatus != VI_SUCCESS)  
    {  
        <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span>;  
    }  
    VISAstatus = viFindRsrc(defrm,<span class="hljs-string">"GPIB?*INSTR"</span>,&amp;find_list,(ViPUInt32)&amp;retCnt, instrDesc);  

    VISAstatus=viOpen(defrm,instrDesc, VI_NULL, VI_NULL, &amp;session);  

    <span class="hljs-keyword">if</span> (VISAstatus!=VI_SUCCESS)  
    {  
        <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span>;  
    }  
    <span class="hljs-comment">//Set voltage  </span>
    viPrintf(session,<span class="hljs-string">"VOLT %f \n"</span>,voltSetting);     
    <span class="hljs-comment">//Set current level  </span>
    viPrintf(session,<span class="hljs-string">"CURR %f \n"</span>,currSetting);  
    <span class="hljs-keyword">return</span> <span class="hljs-literal">TRUE</span>;  
}  </code></pre>
    <blockquote>
     <p>
      关于仪器控制，可以前往NI的官网：
      <a href="http://www.ni.com/zh-cn.html" rel="nofollow">
       http://www.ni.com/zh-cn.html
      </a>
      <br/>
      NI提供的程控工具：VISA Interactive Control（可以去官网下载，NI的工具是收费的）
      <br/>
      <img alt="这里写图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6cc716a442a23b92983d0eb73cec7f50.png" title="">
       <br/>
       在测试测量领域，NI做的非常强大，感兴趣的朋友可以去NI的官网获取更多的知识。
      </img>
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f726c353239303134:2f61727469636c652f64657461696c732f3739353836393933" class_="artid" style="display:none">
 </p>
</div>


