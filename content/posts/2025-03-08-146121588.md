---
layout: post
title: "Android-FragmentContainerView如何使用"
date: 2025-03-08 19:57:35 +0800
description: "此外，用户可能遇到在FragmentTransaction中替换Fragment时的常见错误，比如使用add而不是replace，导致多个Fragment重叠的问题，这时候FragmentContainerView可能有更好的表现。FragmentContainerView是一个相对较新的组件，用来替代传统的FrameLayout作为Fragment的容器，可能用户之前用的是FrameLayout，现在想迁移或者了解更好的做法。需要结构清晰，分步骤说明，并提供代码示例，确保用户能够顺利应用在实际项目中。"
keywords: "Android FragmentContainerView如何使用"
categories: ['未分类']
tags: ['Android']
artid: "146121588"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146121588
    alt: "Android-FragmentContainerView如何使用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146121588
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146121588
cover: https://bing.ee123.net/img/rand?artid=146121588
image: https://bing.ee123.net/img/rand?artid=146121588
img: https://bing.ee123.net/img/rand?artid=146121588
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android FragmentContainerView如何使用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     嗯，用户之前问过关于Android ViewModel的使用，现在又问了FragmentContainerView的使用。可能他们正在开发一个包含多个Fragment的应用，需要管理Fragment之间的切换和容器。FragmentContainerView是一个相对较新的组件，用来替代传统的FrameLayout作为Fragment的容器，可能用户之前用的是FrameLayout，现在想迁移或者了解更好的做法。
    </p>
    <p>
     首先，我需要确认用户的需求。他们可能想知道如何正确使用FragmentContainerView，包括基本用法、与Navigation组件的结合，以及处理返回栈等问题。可能还涉及到动态添加Fragment、转场动画，或者一些常见问题，比如生命周期管理或布局优化。
    </p>
    <p>
     用户可能已经有使用Fragment的经验，但不太清楚FragmentContainerView的优势在哪里。需要解释它与传统布局的区别，比如更好的生命周期管理、转场动画的处理，以及对Navigation库的原生支持。此外，用户可能遇到在FragmentTransaction中替换Fragment时的常见错误，比如使用add而不是replace，导致多个Fragment重叠的问题，这时候FragmentContainerView可能有更好的表现。
    </p>
    <p>
     另外，用户可能在使用Navigation组件时，需要知道如何将FragmentContainerView作为NavHostFragment的容器，并正确设置app:navHost和app:defaultNavHost属性。这可能涉及到导航图的配置和导航控制器的获取。
    </p>
    <p>
     还需要考虑用户可能遇到的问题，例如如何处理返回按钮的导航，确保FragmentContainerView正确与返回栈交互。可能需要提到在Activity中覆盖onBackPressed方法，或者使用OnBackPressedDispatcher。
    </p>
    <p>
     另外，转场动画的部分，用户可能想了解如何在切换Fragment时添加动画，而FragmentContainerView在这方面的支持是否更优。需要提供示例代码，展示如何在事务中使用setCustomAnimations。
    </p>
    <p>
     可能还需要提到FragmentContainerView的一些限制，比如它只能用于显示一个Fragment，不能同时显示多个，因此动态添加时需要使用replace而不是add，否则会抛出异常。这一点对于从FrameLayout迁移过来的用户来说尤其重要，因为之前可能习惯于使用addToBackStack和add方法。
    </p>
    <p>
     最后，常见问题解答部分需要涵盖用户可能遇到的典型问题，比如Fragment重叠、动画不生效、返回栈处理不当等，给出解决方案。例如，确保使用commit()方法，检查NavController是否正确设置，或者动画资源是否正确引用。
    </p>
    <p>
     总结下来，用户需要一个全面的指南，涵盖FragmentContainerView的基本和高级用法，结合Navigation组件，处理动画和返回栈，以及解决常见问题。需要结构清晰，分步骤说明，并提供代码示例，确保用户能够顺利应用在实际项目中。
    </p>
    <p>
     在 Android 中使用
     <code>
      FragmentContainerView
     </code>
     是管理 Fragment 容器的最佳实践，它替代了传统的
     <code>
      FrameLayout
     </code>
     ，提供了更好的生命周期管理和动画支持。以下是详细用法和示例代码：
    </p>
    <hr/>
    <h4>
     <a id="1__26">
     </a>
     <strong>
      1. 基本用法
     </strong>
    </h4>
    <p>
     <strong>
      作用
     </strong>
     ：作为 Fragment 的容器，动态加载和切换 Fragment。
    </p>
    <h5>
     <a id="_1_29">
     </a>
     <strong>
      步骤 1：布局文件中声明
     </strong>
    </h5>
    <p>
     在 XML 布局中添加
     <code>
      FragmentContainerView
     </code>
     ：
    </p>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!-- res/layout/activity_main.xml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fragment_container<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.MyFragment<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>  <span class="token comment">&lt;!-- 直接指定初始 Fragment --&gt;</span>
</code></pre>
    <p>
     •
     <strong>
      <code>
       android:name
      </code>
     </strong>
     ：可选属性，直接指定初始 Fragment 的类名（需全限定名）。
    </p>
    <hr/>
    <h5>
     <a id="_2_Fragment_44">
     </a>
     <strong>
      步骤 2：动态加载 Fragment
     </strong>
    </h5>
    <p>
     通过代码动态替换容器中的 Fragment：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>

        <span class="token comment">// 如果未设置 android:name，手动加载初始 Fragment</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>savedInstanceState <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            supportFragmentManager<span class="token punctuation">.</span><span class="token function">commit</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">,</span> <span class="token function">MyFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">addToBackStack</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token comment">// 可选：添加到返回栈</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="2__Navigation__65">
     </a>
     <strong>
      2. 结合 Navigation 组件
     </strong>
    </h4>
    <p>
     <code>
      FragmentContainerView
     </code>
     是 Navigation 组件的推荐容器，用于托管导航图中的 Fragment。
    </p>
    <h5>
     <a id="_1_Navigation__68">
     </a>
     <strong>
      步骤 1：添加 Navigation 依赖
     </strong>
    </h5>
    <p>
     在
     <code>
      build.gradle
     </code>
     中添加：
    </p>
    <pre><code class="prism language-gradle">dependencies {
    implementation "androidx.navigation:navigation-fragment-ktx:2.5.3"
    implementation "androidx.navigation:navigation-ui-ktx:2.5.3"
}
</code></pre>
    <h5>
     <a id="_2_NavHost_77">
     </a>
     <strong>
      步骤 2：配置 NavHost
     </strong>
    </h5>
    <p>
     在布局中声明
     <code>
      FragmentContainerView
     </code>
     作为 NavHost：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/nav_host_fragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>androidx.navigation.fragment.NavHostFragment<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">app:</span>navGraph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@navigation/main_nav_graph<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">app:</span>defaultNavHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     •
     <strong>
      <code>
       app:navGraph
      </code>
     </strong>
     ：指定导航图资源。
     <br/>
     •
     <strong>
      <code>
       app:defaultNavHost="true"
      </code>
     </strong>
     ：处理系统返回键的导航。
    </p>
    <h5>
     <a id="_3_92">
     </a>
     <strong>
      步骤 3：创建导航图
     </strong>
    </h5>
    <p>
     在
     <code>
      res/navigation/main_nav_graph.xml
     </code>
     中定义导航逻辑：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigation</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">app:</span>startDestination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/homeFragment<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/homeFragment<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.HomeFragment<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/detailFragment<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.DetailFragment<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigation</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="_4_NavController__106">
     </a>
     <strong>
      步骤 4：通过 NavController 导航
     </strong>
    </h5>
    <p>
     在 Activity 或 Fragment 中操作导航：
    </p>
    <pre><code class="prism language-kotlin"><span class="token comment">// 在 Activity 中</span>
<span class="token function">findNavController</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>nav_host_fragment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>detailFragment<span class="token punctuation">)</span>

<span class="token comment">// 在 Fragment 中</span>
<span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>detailFragment<span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="3__Fragment__118">
     </a>
     <strong>
      3. 处理 Fragment 切换动画
     </strong>
    </h4>
    <p>
     通过
     <code>
      FragmentTransaction
     </code>
     添加转场动画：
    </p>
    <pre><code class="prism language-kotlin">supportFragmentManager<span class="token punctuation">.</span><span class="token function">commit</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setCustomAnimations</span><span class="token punctuation">(</span>
        R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_in_right<span class="token punctuation">,</span>    <span class="token comment">// 进入动画</span>
        R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_out_left<span class="token punctuation">,</span>    <span class="token comment">// 退出动画</span>
        R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_in_left<span class="token punctuation">,</span>     <span class="token comment">// 返回进入动画</span>
        R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>slide_out_right    <span class="token comment">// 返回退出动画</span>
    <span class="token punctuation">)</span>
    <span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">,</span> <span class="token function">DetailFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">addToBackStack</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="4__ViewModel__135">
     </a>
     <strong>
      4. 与 ViewModel 结合
     </strong>
    </h4>
    <p>
     在 Fragment 中共享数据：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> SharedViewModel <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> <span class="token keyword">data</span> <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在 Fragment 中</span>
<span class="token keyword">private</span> <span class="token keyword">val</span> sharedViewModel<span class="token operator">:</span> SharedViewModel <span class="token keyword">by</span> <span class="token function">activityViewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 在 Activity 中</span>
<span class="token keyword">private</span> <span class="token keyword">val</span> sharedViewModel<span class="token operator">:</span> SharedViewModel <span class="token keyword">by</span> <span class="token function">viewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h4>
     <a id="5__151">
     </a>
     <strong>
      5. 常见问题解决
     </strong>
    </h4>
    <h5>
     <a id="_1Fragment__152">
     </a>
     <strong>
      问题 1：Fragment 重叠
     </strong>
    </h5>
    <p>
     •
     <strong>
      原因
     </strong>
     ：未检查
     <code>
      savedInstanceState
     </code>
     导致重复加载。
     <br/>
     •
     <strong>
      修复
     </strong>
     ：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">if</span> <span class="token punctuation">(</span>savedInstanceState <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 加载初始 Fragment</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_2_Fragment_161">
     </a>
     <strong>
      问题 2：无法添加多个 Fragment
     </strong>
    </h5>
    <p>
     •
     <strong>
      原因
     </strong>
     ：
     <code>
      FragmentContainerView
     </code>
     同一时间只能显示一个 Fragment。
     <br/>
     •
     <strong>
      解决
     </strong>
     ：使用
     <code>
      replace()
     </code>
     而非
     <code>
      add()
     </code>
     ：
    </p>
    <pre><code class="prism language-kotlin">supportFragmentManager<span class="token punctuation">.</span><span class="token function">commit</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">replace</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>fragment_container<span class="token punctuation">,</span> <span class="token function">NewFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">addToBackStack</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_3_171">
     </a>
     <strong>
      问题 3：返回键不生效
     </strong>
    </h5>
    <p>
     •
     <strong>
      解决
     </strong>
     ：确保
     <code>
      app:defaultNavHost="true"
     </code>
     ，并在 Activity 中处理返回键：
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSupportNavigateUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">findNavController</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>nav_host_fragment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigateUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_181">
     </a>
     <strong>
      总结
     </strong>
    </h4>
    <p>
     •
     <strong>
      核心优势
     </strong>
     ：相比
     <code>
      FrameLayout
     </code>
     ，
     <code>
      FragmentContainerView
     </code>
     提供更好的生命周期管理和动画支持。
     <br/>
     •
     <strong>
      适用场景
     </strong>
     ：
     <br/>
     • 动态加载单个 Fragment。
     <br/>
     • 结合 Navigation 组件实现导航图。
     <br/>
     • 需要处理 Fragment 转场动画。
     <br/>
     •
     <strong>
      关键属性
     </strong>
     ：
     <code>
      android:name
     </code>
     ,
     <code>
      app:navGraph
     </code>
     ,
     <code>
      app:defaultNavHost
     </code>
     。
    </p>
    <p>
     通过上述方法，可以高效管理 Fragment 的切换和生命周期。
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32363239363139372f:61727469636c652f64657461696c732f313436313231353838" class_="artid" style="display:none">
 </p>
</div>


