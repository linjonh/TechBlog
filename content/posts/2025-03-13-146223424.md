---
layout: post
title: "DeepSeek-R1思路训练多模态大模型-Vision-R1开源及实现方法思路"
date: 2025-03-13 10:02:15 +0800
description: "刚开始琢磨使用DeepSeek-R1风格训练多模态R1模型，就看到这个工作，本文一起看看，供参考。先提出问题，仅靠 RL 是否足以激励 MLLM 的推理能力？结论：不能，。：从未经专门推理优化的原始 MLLM（例如 Qwen-2.5VL-7B-Instruct）开始，直接应用 RL 训练。使用与 Vision-R1 相同的奖励函数，即硬格式结果奖励函数（HFRRF）：如果输出格式正确且答案正确，奖励为 1，否则为 0。训练目标是激励模型生成多模态 CoT，解决数学推理任务。"
keywords: "DeepSeek-R1思路训练多模态大模型-Vision-R1开源及实现方法思路"
categories: ['大语言模型', '多模态']
tags: ['多模态', 'Llm', 'Deepseek']
artid: "146223424"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146223424
    alt: "DeepSeek-R1思路训练多模态大模型-Vision-R1开源及实现方法思路"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146223424
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146223424
cover: https://bing.ee123.net/img/rand?artid=146223424
image: https://bing.ee123.net/img/rand?artid=146223424
img: https://bing.ee123.net/img/rand?artid=146223424
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     DeepSeek-R1思路训练多模态大模型-Vision-R1开源及实现方法思路
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     刚开始琢磨使用DeepSeek-R1风格训练多模态R1模型，就看到这个工作，本文一起看看，供参考。
     <br/>
     先提出问题，仅靠 RL 是否足以激励 MLLM 的推理能力？
    </p>
    <p>
     结论：不能，
     <strong>
      因为如果 RL 能有效激励推理能力，Vision-R1-Zero 应该表现出生成复杂 CoT 的能力，并在基准测试中提升准确率
     </strong>
     。如下图D和E所示：
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/23b110e1d152590f1a38527f970d685c.png"/>
    </p>
    <p>
     <strong>
      方法
     </strong>
     ：从未经专门推理优化的原始 MLLM（例如 Qwen-2.5VL-7B-Instruct）开始，直接应用 RL 训练。使用与 Vision-R1 相同的奖励函数，即硬格式结果奖励函数（HFRRF）：如果输出格式正确且答案正确，奖励为 1，否则为 0。训练目标是激励模型生成多模态 CoT，解决数学推理任务。
    </p>
    <p>
     系统提示与奖励格式和Deepseek相似：
    </p>
    <ul>
     <li>
      <p>
       系统提示：
      </p>
      <pre><code>A conversation between User and
Assistant. ... first thinks about
the reasoning process ... provides
the user with the answer. The
reasoning process and answer are
enclosed within &lt;think&gt; &lt;/think&gt; and
&lt;answer&gt; &lt;/answer&gt; tags ...
</code></pre>
     </li>
     <li>
      <p>
       奖励格式：
      </p>
      <pre><code>&lt;think&gt; &lt;/think&gt;&lt;answer&gt;&lt;/answer&gt;
</code></pre>
     </li>
    </ul>
    <h3>
     <a id="_32">
     </a>
     方法架构
    </h3>
    <p>
     仅靠强化学习（RL）无法有效激励多模态大型语言模型（MLLM）的推理能力，主要原因是
     <strong>
      缺乏高质量初始数据和优化策略
     </strong>
     。
    </p>
    <p>
     因此，可以知道Vision-R1 的目标是：
    </p>
    <ul>
     <li>
      <p>
       生成高质量的多模态推理链（CoT）数据集，无需人工标注。
      </p>
     </li>
     <li>
      <p>
       通过 RL 优化模型，使其生成逻辑清晰、长度适中的 CoT，避免过度思考（Overthinking）。
      </p>
     </li>
    </ul>
    <p>
     基于此，Vision-R1 提出了一种两阶段方法，通过冷启动初始化和渐进式 RL 训练。
    </p>
    <p>
     <img alt="Vision-R1流程" src="https://i-blog.csdnimg.cn/img_convert/2a9eb5654b7f09abb27672e0b7d0da7d.png"/>
    </p>
    <h4>
     <a id="1__48">
     </a>
     1. 冷启动初始化
    </h4>
    <p>
     冷启动初始化是通过构建一个高质量的多模态链式推理（CoT）数据集来实现的。目的是为模型提供一个初始的、高质量的推理示例，以便在后续的强化学习过程中更好地学习和改进推理能力。
    </p>
    <p>
     冷启动初始化的核心在于如何从多模态数据中提取出高质量的推理过程。由于多模态大型语言模型（MLLMs）通常难以直接处理多模态输入，提出了一种称为“
     <strong>
      模态桥接
     </strong>
     ”（Modality Bridging）的方法来实现这一目标。
    </p>
    <p>
     <img alt="整体数据生成流程" src="https://i-blog.csdnimg.cn/img_convert/ff7600d781bc59d782a7f52fa650b9d2.png"/>
    </p>
    <h6>
     <a id="_56">
     </a>
     实现细节
    </h6>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         步骤
        </strong>
       </th>
       <th>
        <strong>
         作用
        </strong>
       </th>
       <th>
        <strong>
         方法
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        1. 伪 CoT 生成
       </td>
       <td>
        MLLM 处理图像-文本对，生成初步推理步骤
       </td>
       <td>
        使用 Qwen-2.5VL-72B
       </td>
      </tr>
      <tr>
       <td>
        2. 详细描述获取
       </td>
       <td>
        通过提示获取支持回答问题的详细图像描述
       </td>
       <td>
        提示模板见论文
       </td>
      </tr>
      <tr>
       <td>
        3. CoT 提取与优化
       </td>
       <td>
        DeepSeek-R1 提取并优化 CoT
       </td>
       <td>
        DeepSeek-R1 见
       </td>
      </tr>
      <tr>
       <td>
        4. 数据过滤
       </td>
       <td>
        规则过滤确保数据质量
       </td>
       <td>
        200K Vision-R1-cold 数据集
       </td>
      </tr>
     </tbody>
    </table>
    <ol>
     <li>
      <p>
       <strong>
        伪CoT生成
       </strong>
       ：首先，使用现有的多模态大型语言模型（MLLM）来生成“伪CoT”（Pseudo-CoT）。具体的，输入一个图像-问题-答案对和一个提示到一个MLLM中，模型会生成一个包含图像描述和推理过程的文本。这个“伪CoT”不仅包含了图像的描述，还尝试进行初步的推理，但可能缺乏深度和复杂性。
      </p>
      <p>
       <img alt="通过带有和不带“伪CoT”的描述生成的CoT过程比较。" src="https://i-blog.csdnimg.cn/img_convert/9c6c185b2b34479f26bb3f8adcd32e27.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        文本描述生成
       </strong>
       ：将生成的“伪CoT”与原始的图像-问题对以及一个新的提示一起输入到同一个MLLM中，以获取更详细的图像描述。这一步骤的目的是通过MLLM的文本生成能力，将图像中的视觉信息转化为更详细的文本描述，从而为后续的推理提供更多的上下文信息。
      </p>
     </li>
     <li>
      <p>
       <strong>
        推理生成
       </strong>
       ：将经过文本化的图像-问题对输入到一个专门的推理大型语言模型（如
       <strong>
        DeepSeek-R1
       </strong>
       ）中，以生成高质量的CoT推理过程。DeepSeek-R1能够生成包含自然认知过程的推理过程，如质疑、反思和检查等。
      </p>
     </li>
     <li>
      <p>
       <strong>
        数据过滤
       </strong>
       ：从生成的CoT数据中保留那些最终答案与真实值一致的样本。使用规则进行数据过滤，去除逻辑不一致的样本，并替换一些词汇以提高语义连贯性。
      </p>
     </li>
    </ol>
    <p>
     冷启动数据源：
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1c1108700e7feeb59b589d991aa06c50.png"/>
    </p>
    <p>
     小结：
     <strong>
      冷启动初始化的主要目的是为模型提供一个高质量的起点，使得模型在后续的强化学习过程中能够更快地学习和改进其推理能力
     </strong>
     。
    </p>
    <h4>
     <a id="2_PTST_85">
     </a>
     2 渐进式思维抑制训练（PTST）
    </h4>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/69f9ea12b91a86cd50c08ad0a6481b0f.png"/>
    </p>
    <p>
     为了解决冷启动后的过度思考问题，Vision-R1 采用渐进式思维抑制训练（PTST），通过 RL 进一步优化模型的推理能力。
    </p>
    <ul>
     <li>
      <p>
       <strong>
        分组相对策略优化（GRPO）：
       </strong>
       GRPO 是一种 RL 算法，通过分组类似状态或动作来优化策略，提高学习效率。 详细的可参考往期《
       <a href="https://mp.weixin.qq.com/s?__biz=Mzg4NjI0NDg0Ng==&amp;mid=2247487491&amp;idx=1&amp;sn=e3e2c5a43b107c16b12a0bfcd0c0de75&amp;chksm=cf9dc482f8ea4d94a382afa4903869f0d3ffe660dfaeae2e71e50fcc580b30e1bced687622c9&amp;scene=178&amp;cur_album_id=2829992858538491905#rd" rel="nofollow">
        DeepSeek采用的GRPO算法数学原理及算法过程浅析
       </a>
       》
      </p>
     </li>
     <li>
      <p>
       <strong>
        硬格式结果奖励函数（HFRRF）：
       </strong>
       奖励函数简单：如果输出格式正确且答案正确，则奖励为 1，否则为 0。
      </p>
     </li>
     <li>
      <p>
       <strong>
        分阶段训练：
       </strong>
       训练分为多个阶段，逐步增加序列长度（如 4K、8K、16K 标记）和调整组大小（如 16、8、4）。
      </p>
      <ul>
       <li>
        <p>
         每个阶段训练 100 步，使用 64 个 NVIDIA H800 80G GPU，约 2 天，使用 Verl 框架。
        </p>
       </li>
       <li>
        <p>
         与固定长度 16K、300 步训练的 Vision-R1-Long 相比，PTST 表现更好，平均长度 2057，平均准确率 55.4%。
        </p>
        <p>
         <img alt="" src="https://i-blog.csdnimg.cn/img_convert/4d2d314a43c33e9f7585fd2f2bc40565.png"/>
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="_102">
     </a>
     效果与实验
    </h3>
    <p>
     出现“顿悟时刻”：
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e175fce953d778c7a9228fb53ab1b625.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e27d02f667a07d1843df92b032990b92.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/72e1e22b8c6048a1acd420e163b1c065.png"/>
    </p>
    <p>
     数学评测：
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/cf15dbfcdc413a115665f0a44353c999.png"/>
    </p>
    <p>
     参考文献：Vision-R1: Incentivizing Reasoning Capability in Multimodal Large Language Models, https://arxiv.org/abs/2503.06749)
     <br/>
     code：https://github.com/Osilly/Vision-R1
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f796a685f53453030372f:61727469636c652f64657461696c732f313436323233343234" class_="artid" style="display:none">
 </p>
</div>


