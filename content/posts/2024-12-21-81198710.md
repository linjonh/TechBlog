---
layout: post
title: ARM全国产云平台部署容器实战
date: 2024-12-21 14:03:23 +0800
categories: ['科技']
tags: ['无标签']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=81198710
    alt: ARM全国产云平台部署容器实战
artid: 81198710
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=81198710
featuredImagePreview: https://bing.ee123.net/img/rand?artid=81198710
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ARM全国产云平台部署容器实战
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       如何基于国产CPU的云平台构建容器管理平台？
      </strong>
      <strong>
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      目录
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182751" rel="nofollow">
       <strong>
        <u>
         第一节 基于国产CPU的服务器
        </u>
       </strong>
       2
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182752" rel="nofollow">
       <strong>
        <u>
         第二节 国产云平台
        </u>
       </strong>
       6
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182753" rel="nofollow">
       <u>
        1、安装云平台
       </u>
       9
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182754" rel="nofollow">
       <u>
        1.1启动ARM服务器，从U盘启动
       </u>
       9
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182755" rel="nofollow">
       <u>
        1.2
       </u>
       <strong>
       </strong>
       <u>
        ARM服务器BIOS基本设置
       </u>
       <strong>
       </strong>
       <strong>
        10
       </strong>
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182756" rel="nofollow">
       <strong>
        <u>
         第三节 基于ZStack云主机构建K8S集群
        </u>
       </strong>
       18
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182757" rel="nofollow">
       <u>
        1、准备工作
       </u>
       20
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182758" rel="nofollow">
       <u>
        2、安装部署
       </u>
       21
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182759" rel="nofollow">
       <u>
        2.1安装Docker
       </u>
       21
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182760" rel="nofollow">
       <u>
        2.3 安装kubelet、kubeadm、kubectl
       </u>
       22
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182761" rel="nofollow">
       <u>
        2.4用kubeadm创建集群
       </u>
       22
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182762" rel="nofollow">
       <u>
        2.5 配置kubectl
       </u>
       22
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182763" rel="nofollow">
       <u>
        2.6 安装Pod网络
       </u>
       23
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182764" rel="nofollow">
       <u>
        2.7注册节点到K8S集群
       </u>
       29
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182765" rel="nofollow">
       <u>
        2.8部署kubernetes-dashboard
       </u>
       30
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <a href="#_Toc519182766" rel="nofollow">
       <strong>
        <u>
         第四节 全篇总结
        </u>
       </strong>
       40
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       如何基于国产CPU的云平台构建容器管理平台？（上篇）
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      随着“中兴事件”不断升级，引起了国人对国产自主可控技术的高度关注；本人作为所在单位的运维工程师，也希望能找到一个稳定、能兼容国产CPU的一整套架构方案，来构建IaaS平台和PaaS平台，满足单位对安全自主可控的需求。要基于全国产方式解决公司业务需求至少要在软硬件层面满足，而国内基本都是基于x86解决方案，想找到满足需求的国产化解决方案还是非常困难的事情。但笔者由于一个偶然的机会，接触到了国产的芯片厂商和云计算厂商，并得知他们已经实现了全国产化的云计算平台，笔者也亲自动手体验了安装部署该云计算平台，并在其之上安装部署了容器平台，以下是笔者的分享。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      <a name="_Toc519182751">
      </a>
      <strong>
       第一节 基于国产CPU的服务器
      </strong>
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      纵观国内能用于商用国产CPU服务器也没几家真实能用的；有的是基于3B1500国产商用28纳米8核处理最高主频达1.5GHz；通过多方查阅相关资料目前性能无法满足云平台需求，而且还不支持虚拟化。
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      一个偶然机会参加2018年贵州大数据博览会，参会过程中发现一个有意思的事情，就是在阿里云展台看到国产云平台+国产芯片宣传字样。
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      <a href="http://album.sina.com.cn/pic/006dHEtbzy7miTejLIT83" rel="nofollow">
       <img alt="" class="has" height="800" id="image_operate_48331532487200020" src="https://i-blog.csdnimg.cn/blog_migrate/354d6c882d9eb0946a274680167c57b0.jpeg" width="600"/>
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      于是上前跟现场的工作人员进行简单的沟通，了解到国产CPU是由华芯通设计开发，这颗芯片内置48颗物理核心，单核心2.6GHz，64Bit、 支持虚拟化！没想到这颗CPU居然支持虚拟化，看来距离我的想法又进一步，起码已经有硬件可以实现了。还了解到目前已经有国产云平台具备商用环境；名字叫ZStack for Alibaba Cloud，据工作人员介绍目前已有业务系统运行在基于华芯通CPU的云平台上，云平台就是ZStack。热心的工作人员带我去华芯通的专柜进行详细参观。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_61991532487247448" src="https://i-blog.csdnimg.cn/blog_migrate/487615d80a9290ca604fa4e652ea764d.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_15631532487247552" src="https://i-blog.csdnimg.cn/blog_migrate/eb6f8cb94e20225a409b83e86424fd58.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_46811532487255709" src="https://i-blog.csdnimg.cn/blog_migrate/608e48c1ac49d8a4fef9fc9ae042f20b.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      看到实物那一刻，我发现这个跟x86架构的服务器区别并不大，之前一直以为它是一个类似路由器这样的小盒子。没想到ARM服务器工艺已和x86服务器自造工艺无太大差别。
     </span>
    </p>
    <h2>
     <span style="color:#666666;">
      <a name="_Toc519182752">
      </a>
      <strong>
       第二节
      </strong>
      <strong>
      </strong>
      <strong>
       国产云平台
      </strong>
     </span>
    </h2>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ZStack作为国内为数不多的自研云平台，根据官网信息已发布基于国产CPU架构的版本，那么完全可以实现基于国产CPU架构来构建国产云平台。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_10661532487265415" src="https://i-blog.csdnimg.cn/blog_migrate/1b80d2b32f11b94255c36252faeb9938.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ZStack架构：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_14871532487276924" src="https://i-blog.csdnimg.cn/blog_migrate/6767b566044c1a28eda149cdfe8c64a6.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      这架构图摘自他们的产品白皮书，从架构上看整个逻辑还是比较清晰，各组件依赖度并不高，不会因为管理控制节点故障而影响业务系统。经过仔细研究ZStack架构发现以下特点：
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      全异步架构：异步消息、异步方法、异步HTTP调用
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      无状态服务：单次请求不依赖其他请求
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      无锁架构：一致性哈希算法。
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      进程内微服务：微服务解耦。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      再看看ZStack的功能架构图：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_21771532487296195" src="https://i-blog.csdnimg.cn/blog_migrate/a9e72335b145281edeaf9122d2297e69.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      从图里可以发现，服务之间的交互统一走消息队列，整个拓扑结构不再紧密，实现星状的架构，各服务之间只有消息的交互，服务之间基本独立，添加或者删除某个服务不会影响整个架构（只会失去某些功能）。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      回到文章的主题上，了解到以上信息后，我们决定使用华芯通CPU+ZStack国产化云平台来实现容器平台管理方案敲定后，接下来就是走借测流程。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      通过之前展会联系的华芯通负责人帮忙，在等了2、3个星期之后，机器寄到了单位。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_54961532487307475" src="https://i-blog.csdnimg.cn/blog_migrate/10379be6c2c985a80ff024038195f7ea.jpeg">
      </img>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      上图是他们的工程机，但做工已经非常精细，完全不输给主流大厂的X86服务器。接下来先部署云平台，之前提到的ZStack是国产化云计算平台的先行者，核心引擎也是完全开源的，笔者通过ZStack的官方网站（http://www.zstack.io/product/enterprise/），下载了他们的iso系统，并根据用户手册的图文教程做了烧录，不得不说，整个文档做的非常清晰，很快就完成了准备工作，下面就按照文档进入安装过程。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <h3>
     <span style="color:#666666;">
      <a name="_Toc519182753">
      </a>
      <strong>
       3、安装云平台
      </strong>
     </span>
    </h3>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182754">
      </a>
      3.1启动ARM服务器，从U盘启动
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      通过Console连接看到如下一些信息，这是ARM服务器在进行自检。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_81391532487318150" src="https://i-blog.csdnimg.cn/blog_migrate/b49e1b80f929111f36b70c1233ed5f7a.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      直到出现以下信息：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_72161532487325419" src="https://i-blog.csdnimg.cn/blog_migrate/8d06e6870dfd49fac098f816222039f0.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      按Delete或者ESC建进入BIOS设置。
     </span>
    </p>
    <p style="margin-left:36pt;">
     <span style="color:#666666;">
      <a name="_Toc519182755">
      </a>
      <strong>
       3.2
      </strong>
      <strong>
       ARM服务器BIOS基本设置
      </strong>
     </span>
    </p>
    <p>
     <span style="color:#666666;">
      3.2.1修改时间
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_22821532487334275" src="https://i-blog.csdnimg.cn/blog_migrate/6fa5a0c3b23662fb8b043b16bb71c096.jpeg"/>
     </span>
    </p>
    <p>
     <span style="color:#666666;">
      3.2.2快速选择引导设备
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_68951532487345548" src="https://i-blog.csdnimg.cn/blog_migrate/f7e35c323de2f157c4513adac84250da.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      选择引导设备后按回车键，快速引导。
     </span>
    </p>
    <p>
     <span style="color:#666666;">
      3.2.3使用基于VNC方式安装ZStack
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      当选择引导设备后，将进入启动项选择界面，如下图所示：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/93cb922817a7817916be504c8fe05d37.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      选择using VNC模式进行引导启动；
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/06db14e394cdb124ac9522056a2befd9.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      选择usingVNC模式引导启动，即可实现通过VNC图形模式进行安装；
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/58d1e47dca6f0ee6df2da913dbb8c589.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      表示启动VNC服务，并自动从DHCP工具获取IP地址同时自动分配默认VNC端口5901；当出现这个界面即可使用VNC viewer客户端进行连接。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_63251532487387755" src="https://i-blog.csdnimg.cn/blog_migrate/1208715ef4eb9ce2c68a3122dd3aa61d.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p>
     <span style="color:#666666;">
      3.2.4安装设置
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      A. 选择安装模式
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/86f4e3926893828ef0a5655159e83887.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      目前ZStack For ARM有3种安装模式分别对应为：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ?企业版管理节点模式
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ? 计算节点模式
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ? 专家模式
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      可根据实施规划进行选择部署，选择建议：
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      ? 如果在实施方案中将管理节点独立，则第一次安装时应选择管理节点模式；
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      ? 如果用承载云主机，则安装模式为计算节点；
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/39b0fcee8224a048bfeadfce87be6e31.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      根据实际情况选择好对应的安装模式，然后点击Done按钮；
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      B. 配置磁盘分区：
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      ? 选择磁盘：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/6a759c8ca7abeb034f7ec8dd12195a5a.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      选择用于安装ZStack的系统盘。
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      ? 配置分区
     </span>
    </p>
    <p style="margin-left:18pt;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_82621532487440067" src="https://i-blog.csdnimg.cn/blog_migrate/fef5aed985cd662d778df17a75708f92.jpeg"/>
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      ? 自动分区。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      下面就分区模式进行说明：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      分区模式有UEFI 模式和Legacy模式两种，应与BIOS设置的引导模式一致。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       ?
      </strong>
      <strong>
       UEFI 模式
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      /boot：创建分区 1GB
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      /boot/efi：创建分区 500MB
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      swap（交换分区）：创建分区 32GB
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      /（根分区）：配置剩下容量
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      ? 网络设置：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/8f68fe84892fa4e3a3865c4e60863500.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_45951532487458315" src="https://i-blog.csdnimg.cn/blog_migrate/0cf96525b3b892258d12d71f06bb3197.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      选择需要修改的网卡，点击Configure按钮进行配置；
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      设置密码并开始安装：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_46191532487478956" src="https://i-blog.csdnimg.cn/blog_migrate/326af0cfe74b7a06094bc86f808ca31a.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_9711532487485895" src="https://i-blog.csdnimg.cn/blog_migrate/024a49f0f161301755ae5daf9732ff31.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      各模式安装部署步骤都大同小异，官网可以直接下载用户手册。安装完后的Web UI，非常简洁大方，整个安装过程超级简单，以前一直都是使用OpenStack的，而这回使用ZStack 不到30分钟部署成功，1个小时内3个节点全部部署成功，还顺带初始化了环境。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/8ab1d6fe98d4a64176db2c71cd8ef3da.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_32981532487506718" src="https://i-blog.csdnimg.cn/blog_migrate/af58acf0dbabc2a3b7b50e54e1419a40.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      安装部署结束后，可以看到还有网络拓扑功能
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       安装总结：
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      底层硬件是ARM服务器，云平台底层也是基于ARM64位的系统。安装部署超级方便，管理控制层与业务层完全独立，就是说如果管控节点宕掉，根本就不影响业务系统的正常运行，这一点是OpenStack无法实现的。在测试过程中尝试各种断电关机测试，整个平台运行依然不受影响，稳定性非常高。目前在ZStack For ARM 云平台上轻松跑了16个ARM架构的云主机。
      <img alt="" class="has" id="image_operate_31741532487529491" src="https://i-blog.csdnimg.cn/blog_migrate/ca0a28ebc91a766fdb2f1f5e6c6adcf6.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
      </strong>
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      <a name="_Toc519182756">
      </a>
      <strong>
       第三节 基于ZStack云主机构建K8S集群
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      这里要提一下，为什么我们不直接使用物理ARM服务器部署K8S集群，这跟单位测试场景有关系，既要使用云主机透传GPU计算卡进行大量的计算，又要实现容器管理平台。况且国外主流的K8S集群通常是跑在虚拟机里面的，运行在虚拟机里面的好处有很多，比如可以实现资源定制分配、利用云平台API接口可以快速生成K8S集群Node节点、更好的灵活性以及可靠性；在ZStack ARM云平台上可以同时构建IaaS+PaaS混合平台，满足不同场景下的需求。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      由于篇幅有限下面先介绍一下如何在基于ZStack For ARM平台中云主机部署K8S集群，整个部署过程大概花1小时（这主要是访问部分国外网络时不是很顺畅）。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       集群环境介绍：
      </strong>
     </span>
    </p>
    <table cellspacing="0">
     <tbody>
      <tr>
       <td style="width:87pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          <strong>
           主机名
          </strong>
         </span>
        </p>
       </td>
       <td style="width:55.8pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          <strong>
           角色
          </strong>
         </span>
        </p>
       </td>
       <td style="width:123.3pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          <strong>
           IP地址
          </strong>
         </span>
        </p>
       </td>
       <td style="vertical-align:top;width:123.5pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          <strong>
           配置
          </strong>
         </span>
        </p>
       </td>
       <td style="width:163pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          <strong>
           系统版本
          </strong>
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:87pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          K8S-Master
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:55.8pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Master
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:123.3pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          172.120.194.196
         </span>
        </p>
       </td>
       <td style="vertical-align:top;width:123.5pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          8vCPU\16G内存
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:163pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Ubuntu-1804-aarch64
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:87pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          K8S-Node1
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:55.8pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Node
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:123.3pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          172.120.194.197
         </span>
        </p>
       </td>
       <td style="vertical-align:top;width:123.5pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          8vCPU\16G内存
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:163pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Ubuntu-1804-aarch64
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:87pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          K8S-Node2
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:55.8pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Node
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:123.3pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          172.120.194.198
         </span>
        </p>
       </td>
       <td style="vertical-align:top;width:123.5pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          8vCPU\16G内存
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:163pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Ubuntu-1804-aarch64
         </span>
        </p>
       </td>
      </tr>
      <tr>
       <td style="width:87pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          K8S-Node3
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:55.8pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Node
         </span>
        </p>
       </td>
       <td style="vertical-align:bottom;width:123.3pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          172.120.194.199
         </span>
        </p>
       </td>
       <td style="vertical-align:top;width:123.5pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          8vCPU\16G内存
         </span>
        </p>
       </td>
       <td style="width:163pt;">
        <p style="margin-left:0px;">
         <span style="color:#666666;">
          Ubuntu-1804-aarch64
         </span>
        </p>
       </td>
      </tr>
     </tbody>
    </table>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      在本环境中用于构建K8S集群所需的资源，为基于ZStack构建的平台上的云主机：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/8ac49578a7b1077887f985f47a6f9b59.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_84021532487559660" src="https://i-blog.csdnimg.cn/blog_migrate/6d99149b3fefb0dc8042657834841a43.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ZStack云主机K8S集群架构
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      <a name="_Toc519182757">
      </a>
      <strong>
       1、准备工作
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      配置主机名
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostnamectl set-hostname K8S-Master
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostnamectl set-hostname K8S-Node1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostnamectl set-hostname K8S-Node2
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostnamectl set-hostname K8S-Node3
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      所有云主机上关闭swap分区 否则会报错；该操作只需在云主机环境下执行，物理机环境无需操作。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo swapoff -a
     </span>
    </p>
    <h3>
     <span style="color:#666666;">
      <a name="_Toc519182758">
      </a>
      <strong>
       2
      </strong>
      <strong>
       、安装部署
      </strong>
     </span>
    </h3>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182759">
      </a>
      <strong>
       2.1安装Docker
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # step 1: 安装必要的一些系统工具
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo apt-get update
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # step 2: 安装GPG证书
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Step 3: 写入软件源信息
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo add-apt-repository "deb [arch=arm64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $（lsb_release -cs） stable"
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Step 4: 更新并安装 Docker-CE
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo apt-get -y update
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo apt-get -y install docker-ce
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      使用daocloud对docker镜像下载进行加速。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://56d10455.m.daocloud.io
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       2.2
      </strong>
      <strong>
       安装
      </strong>
      <strong>
       go环境
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apt-get install golang- golang
     </span>
    </p>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182760">
      </a>
      <strong>
       2.3 安装kubelet、kubeadm、kubectl
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apt-get update &amp;&amp; apt-get install -y apt-transport-https
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      deb http://apt.kubernetes.io/ kubernetes-xenial main
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      EOF
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apt-get update
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apt-get install -y kubectl kubeadm kubectl
     </span>
    </p>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182761">
      </a>
      <strong>
       2.4用kubeadm创建集群
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      初始化Master
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubeadm init --apiserver-advertise-address  172.120.194.196 --pod-network-cidr 10.244.0.0/16
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      执行完上面命令后，如果中途不报错会出现类似以下信息：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubeadm join 172.120.194.196:6443 --token oyf6ns.whcoaprs0q7growa --discovery-token-ca-cert-hash sha256:30a459df1b799673ca87f9dcc776f25b9839a8ab4b787968e05edfb6efe6a9d2
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      这段信息主要是提示如何注册其他节点到K8S集群。
     </span>
    </p>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182762">
      </a>
      <strong>
       2.5 配置kubectl
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Kubectl是管理K8S集群的命令行工具，因此需要对kubectl运行环境进行配置。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      su - zstack
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo mkdir -p $HOME/.kube
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo chown $（id -u）:$（id -g） $HOME/.kube/config
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      echo "source &lt;（kubectl completion bash）" &gt;&gt; ~/.bash
     </span>
    </p>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182763">
      </a>
      <strong>
       2.6 安装Pod网络
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      为了让K8S集群的Pod之间能够正常通讯，必须安装Pod网络，Pod网络可以支持多种网络方案，当前测试环境采用Flannel模式。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      先将Flannel的yaml文件下载到本地，进行编辑，编辑的主要目的是将原来X86架构的镜像名称，改为ARM架构的。让其能够在ZStack ARM云环境正常运行。修改位置及内容参考下面文件中红色粗体字部分。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo wget
      <a href="https://raw.githubusercontent.com/coreos/flannel/master/%EF%BD%84%EF%BD%8F%EF%BD%83%EF%BD%95%EF%BD%8D%EF%BD%85%EF%BD%8E%EF%BD%94ation/kube-flannel.yml" rel="nofollow">
       <u>
        https://raw.githubusercontent.com/coreos/flannel/master/ｄｏｃｕｍｅｎｔation/kube-flannel.yml
       </u>
      </a>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      vim kube-flannel.yml
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: ClusterRole
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: rbac.authorization.k8s.io/v1beta1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      rules:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - ""
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - pods
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - get
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - ""
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - nodes
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - list
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - watch
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - ""
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - nodes/status
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - patch
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: ClusterRoleBinding
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: rbac.authorization.k8s.io/v1beta1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      roleRef:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiGroup: rbac.authorization.k8s.io
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: ClusterRole
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      subjects:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - kind: ServiceAccount
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: ServiceAccount
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: ConfigMap
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kube-flannel-cfg
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      tier: node
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      app: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      data:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      cni-conf.json: |
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "name": "cbr0"，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "plugins": [
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "type": "flannel"，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "delegate": {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "hairpinMode": true，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "isDefaultGateway": true
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "type": "portmap"，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "capabilities": {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "portMappings": true
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      net-conf.json: |
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "Network": "10.244.0.0/16"，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "Backend": {
      <!-- -->
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      "Type": "vxlan"
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      }
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: extensions/v1beta1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: DaemonSet
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kube-flannel-ds
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      tier: node
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      app: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      spec:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      template:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      tier: node
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      app: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      spec:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostNetwork: true
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      nodeSelector:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       beta.kubernetes.io/arch: arm64
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      tolerations:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - key: node-role.kubernetes.io/master
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      operator: Exists
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      effect: NoSchedule
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      serviceAccountName: flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      initContainers:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: install-cni
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
      </strong>
      <strong>
       image: quay.io/coreos/flannel:v0.10.0-arm64
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      command:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - cp
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      args:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - -f
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - /etc/kube-flannel/cni-conf.json
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - /etc/cni/net.d/10-flannel.conflist
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      volumeMounts:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: cni
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      mountPath: /etc/cni/net.d
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: flannel-cfg
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      mountPath: /etc/kube-flannel/
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      containers:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: kube-flannel
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       image: quay.io/coreos/flannel:v0.10.0-arm64
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      command:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - /opt/bin/flanneld
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      args:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - --ip-masq
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - --kube-subnet-mgr
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      requests:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      cpu: "100m"
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      memory: "50Mi"
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      limits:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      cpu: "100m"
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      memory: "50Mi"
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      securityContext:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      privileged: true
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      env:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: POD_NAME
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      valueFrom:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      fieldRef:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      fieldPath: metadata.name
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: POD_NAMESPACE
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      valueFrom:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      fieldRef:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      fieldPath: metadata.namespace
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      volumeMounts:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: run
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      mountPath: /run
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: flannel-cfg
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      mountPath: /etc/kube-flannel/
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      volumes:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: run
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostPath:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      path: /run
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: cni
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      hostPath:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      path: /etc/cni/net.d
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: flannel-cfg
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      configMap:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kube-flannel-cfg
     </span>
    </p>
    <p style="margin-left:0px;">
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo kubectl apply -f   kube-flannel.yml
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      执行上面命令后会正常情况下会有如下输出：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      clusterrole.rbac.authorization.k8s.io "flannel" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      clusterrolebinding.rbac.authorization.k8s.io "flannel" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      serviceaccount "flannel" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      configmap "kube-flannel-cfg" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      daemonset.extensions "kube-flannel-ds" created
     </span>
    </p>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182764">
      </a>
      <strong>
       2.7
      </strong>
      <strong>
       注册节点到
      </strong>
      <strong>
       K8S集群
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      分别在K8S-Node1、K8S-Node2、K8S-Node3
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubeadm join 172.120.194.196:6443 --token oyf6ns.whcoaprs0q7growa --discovery-token-ca-cert-hash sha256:30a459df1b799673ca87f9dcc776f25b9839a8ab4b787968e05edfb6efe6a9d2
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubectl get nodes 查看节点状态
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      zstack@K8S-Master:~$ kubectl get nodes
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      NAME         STATUS     ROLES     AGE       VERSION
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-master   Ready      master    49m       v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-node1    NotReady   &lt;none&gt;    4m        v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-node2    NotReady   &lt;none&gt;    4m        v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-node3    NotReady   &lt;none&gt;    4m        v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      如果发现所有节点是NotReady 是因每个节点都需要启动若干个组件，这些组件都是在Pod中运行，且需要到Google下载镜像。使用下面命令查看Pod运行状况：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubectl get pod --all-namespaces  正常情况应该是如下的状态：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      NAMESPACE     NAME                                 READY     STATUS    RESTARTS   AGE
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   coredns-78fcdf6894-49tkw             1/1       Running   0          1h
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   coredns-78fcdf6894-gmcph             1/1       Running   0          1h
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   etcd-k8s-master                      1/1       Running   0          19m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-apiserver-k8s-master            1/1       Running   0          19m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-controller-manager-k8s-master   1/1       Running   0          19m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-flannel-ds-bqx2s                1/1       Running   0          16m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-flannel-ds-jgmjp                1/1       Running   0          16m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-flannel-ds-mxpl8                1/1       Running   0          21m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-flannel-ds-sd6lh                1/1       Running   0          16m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-proxy-cwslw                     1/1       Running   0          16m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-proxy-j75fj                     1/1       Running   0          1h
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-proxy-ptn55                     1/1       Running   0          16m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-proxy-zl8mb                     1/1       Running   0          16m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kube-scheduler-k8s-master            1/1       Running   0          19m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      在整个过程中如果发现状态为Pending、ContainerCreateing、ImagePullBackOff等状态都表示Pod还未就绪，只有Running状态才是正常的。要做的事情只有等待。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubectl get nodes 再次查看节点状态
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      NAME         STATUS    ROLES     AGE       VERSION
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-master   Ready     master    1h        v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-node1    Ready     &lt;none&gt;    16m       v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-node2    Ready     &lt;none&gt;    16m       v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-node3    Ready     &lt;none&gt;    16m       v1.11.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      当所有节点均为 Ready状时，此时就可以使用这个集群了
     </span>
    </p>
    <h4>
     <span style="color:#666666;">
      <a name="_Toc519182765">
      </a>
      <strong>
       2.
      </strong>
      <strong>
       8部署kubernetes-dashboard
      </strong>
     </span>
    </h4>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      克隆kubernetes-dashboard yaml文件
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      sudo git clone https://github.com/gh-Devin/kubernetes-dashboard.git
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      修改kubernetes-dashboard yaml文件，修改内容为下面红色粗体部分。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      cd kubernetes-dashboard/
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      vim kubernetes-dashboard.yaml
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Copyright 2017 The Kubernetes Authors.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Licensed under the Apache License， Version 2.0 （the "License"）;
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # you may not use this file except in compliance with the License.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # You may obtain a copy of the License at
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      #     http://www.apache.org/licenses/LICENSE-2.0
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Unless required by applicable law or agreed to in writing， software
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # distributed under the License is distributed on an "AS IS" BASIS，
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND， either express or implied.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # See the License for the specific language governing permissions and
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # limitations under the License.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Configuration to deploy release version of the Dashboard UI compatible with
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Kubernetes 1.8.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Example usage: kubectl create -f &lt;this_file&gt;
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # ------------------- Dashboard Secret ------------------- #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: Secret
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard-certs
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      type: Opaque
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # ------------------- Dashboard Service Account ------------------- #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: ServiceAccount
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # ------------------- Dashboard Role &amp; Role Binding ------------------- #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: Role
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: rbac.authorization.k8s.io/v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard-minimal
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      rules:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Allow Dashboard to create 'kubernetes-dashboard-key-holder' secret.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups: [""]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources: ["secrets"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs: ["create"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Allow Dashboard to create 'kubernetes-dashboard-settings' config map.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups: [""]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources: ["configmaps"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs: ["create"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Allow Dashboard to get， update and delete Dashboard exclusive secrets.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups: [""]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources: ["secrets"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resourceNames: ["kubernetes-dashboard-key-holder"， "kubernetes-dashboard-certs"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs: ["get"， "update"， "delete"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups: [""]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources: ["configmaps"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resourceNames: ["kubernetes-dashboard-settings"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs: ["get"， "update"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Allow Dashboard to get metrics from heapster.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups: [""]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources: ["services"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resourceNames: ["heapster"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs: ["proxy"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - apiGroups: [""]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resources: ["services/proxy"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      resourceNames: ["heapster"， "http:heapster:"， "https:heapster:"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      verbs: ["get"]
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: rbac.authorization.k8s.io/v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: RoleBinding
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard-minimal
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      roleRef:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiGroup: rbac.authorization.k8s.io
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: Role
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard-minimal
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      subjects:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - kind: ServiceAccount
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # ------------------- Dashboard Deployment ------------------- #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: Deployment
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: apps/v1beta2
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      spec:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      replicas: 1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      revisionHistoryLimit: 10
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      selector:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      matchLabels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      template:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      spec:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      serviceAccountName: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      containers:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       image: k8s.gcr.io/kubernetes-dashboard-arm64:v1.8.3
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ports:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - containerPort: 9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      protocol: TCP
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      args:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      #- --auto-generate-certificates
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Uncomment the following line to manually specify Kubernetes API server Host
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # If not specified， Dashboard will attempt to auto discover the API server and connect
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # to it. Uncomment only if the default does not work.
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      volumeMounts:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: kubernetes-dashboard-certs
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      mountPath: /certs
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Create on-disk volume to store exec logs
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - mountPath: /tmp
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: tmp-volume
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      livenessProbe:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      httpGet:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      scheme: HTTP
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      path: /
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      port: 9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      initialDelaySeconds: 30
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      timeoutSeconds: 30
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      volumes:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: kubernetes-dashboard-certs
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      secret:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      secretName: kubernetes-dashboard-certs
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - name: tmp-volume
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      emptyDir: {}
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       serviceAccountName: kubernetes-dashboard-admin
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # Comment the following tolerations if Dashboard must not be deployed on master
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      tolerations:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - key: node-role.kubernetes.io/master
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      effect: NoSchedule
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ---
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # ------------------- Dashboard Service ------------------- #
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: Service
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      spec:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ports:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - port: 9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      targetPort: 9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      selector:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      # ------------------------------------------------------------
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kind: Service
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      apiVersion: v1
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      metadata:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      labels:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      name: kubernetes-dashboard-external
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      namespace: kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      spec:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ports:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      - port: 9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      targetPort: 9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      nodePort: 30090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      type: NodePort
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      selector:
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      k8s-app: kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      修改完成后执行
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubectl  -n kube-system create -f .
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      执行命令的正常输出：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      serviceaccount "kubernetes-dashboard-admin" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      clusterrolebinding.rbac.authorization.k8s.io "kubernetes-dashboard-admin" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      secret "kubernetes-dashboard-certs" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      serviceaccount "kubernetes-dashboard" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      role.rbac.authorization.k8s.io "kubernetes-dashboard-minimal" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      rolebinding.rbac.authorization.k8s.io "kubernetes-dashboard-minimal" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      deployment.apps "kubernetes-dashboard" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      service "kubernetes-dashboard-external" created
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      然后查看kubernetes-dashboard Pod的状态
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubectl get pod --all-namespaces
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      NAMESPACE     NAME                                    READY     STATUS    RESTARTS   AGE
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kube-system   kubernetes-dashboard-66885dcb6f-v6qfm   1/1       Running   0          8m
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      当状态为running 时执行下面命令 查看端口
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      kubectl --namespace=kube-system describe svc kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Name:                     kubernetes-dashboard-external
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Namespace:                kube-system
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Labels:                   k8s-app=kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Annotations:              &lt;none&gt;
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Selector:                 k8s-app=kubernetes-dashboard
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Type:                     NodePort
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      IP:                       10.111.189.106
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Port:                     &lt;unset&gt;  9090/TCP
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      TargetPort:               9090/TCP
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <strong>
       NodePort:                 &lt;unset&gt;  30090/TCP     此端口为外部访问端口
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Endpoints:                10.244.2.4:9090
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Session Affinity:         None
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      External Traffic Policy:  Cluster
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      Events:                   &lt;none&gt;
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      注意：如果在部署K8S-Dashboard界面过程中如果则登录UI的时候会报错：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" src="https://i-blog.csdnimg.cn/blog_migrate/80ac1616c93e2337d551f5945bb2d7a2.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      这是因为K8S在1.6版本以后启用了RBAC访问控制策略，可以使用kubectl或Kubernetes API进行配置。使用RBAC可以直接授权给用户，让用户拥有授权管理的权限，这样就不再需要直接触碰Master Node。按照上面部署步骤则可以避免。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_2781532487630630" src="https://i-blog.csdnimg.cn/blog_migrate/ab719e21117afcb955d04868b7414839.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      <img alt="" class="has" id="image_operate_98351532487637566" src="https://i-blog.csdnimg.cn/blog_migrate/f455a301c0889f630456896585fceaf9.jpeg"/>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      至此，基于ARM环境的K8S集群就部署完成了。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
     </span>
    </p>
    <p style="margin-left:21pt;">
     <span style="color:#666666;">
      <a name="_Toc519182766">
      </a>
      <strong>
       第四节 全篇总结
      </strong>
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      先说说关于ZStack安装部署的一些心得，整个ZStack For ARM平台部署到业务环境构建的过程，都是比较流畅的。ZStack产品化程度高，安装过程非常简单，基本上按照官方部署文档1个小时内就能完成3台规模的云平台搭建及平台初始化工作。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      ZStack云平台采用独特的异步架构，大大提升了平台响应能力，使得批量并发操作不再成为烦恼；管理层面与业务层面独立，不会因为管理节点意外宕机导致业务中断；平台内置大量实用性很高的功能，极大方便了在测试过程中运维任务；版本升级简单可靠，完全实现5分钟跨版本无缝升级，经实测升级过程中完全不影响业务正常运行。通过升级后能实现异构集群管理，也就是说在ARM服务器上构建管理节点，可以同时管理ARM集群中的资源，也能管理X86架构集群中的资源；同时实现高级SDN功能。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      而基于ZStack云主机构建K8S集群时，我们团队在选择方案的时候，也拿物理机和云主机做过一系列对比，对比之后发现当我用ZStack云主机部署K8S集群的时候更加灵活、可控。具体的可以在以下几个方面体现：
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      1、ZStack云主机天生隔离性好
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      对容器技术了解的人应该清楚，多个容器公用一个Host Kernel；这样就会遇到隔离性方面的问题，虽然随着技术发展，目前也可以使用Linux系统上的防护机制实现安全隔离，但是从某个层面讲并不是完全隔离，而云主机方式受益于虚拟化技术，天生就有非常好的隔离性，从而可以进一步保障安全。ZStack就是基于KVM虚拟化技术架构自研。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      2、受益于ZStack云平台多租户
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      在物理服务器上运行的大堆容器要实现资源自理，所谓资源自理就是各自管理自己的容器资源，那么这个时候问题就来了，一台物理机上有成千上万个容器怎么去细分管理范围呢？这个时候云平台的多租户管理就派上用处了，每个租户被分配到相应的云主机，各自管理各自的云主机以及容器集群。同时还能对不同人员权限进行控制管理。在本次测试的ZStack For ARM云平台，就可以实现按企业组织架构方式进行资源、权限管理，同时还能实现流程审批，审批完成后自动创建所需的云主机；据说后面发布的ZStack2.5.0版本还有资源编排功能。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      3.ZStack云平台灵活性、自动化程度高
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      通过ZStack，可以根据业务需求，对云主机进行资源定制，减少资源浪费。同时根据自身业务情况调整架构实现模式，比如：有计算密集型业务，此时可以借助GPU透传功能，将GPU透传到云主机，能快速实现计算任务，避免过多繁琐配置。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      另外目前各种云平台都有相应API接口，可以方便第三方应用直接调用，从而实现根据业务压力自动进行资源伸缩。但是对于物理服务器来说没什么完整的API接口，基本上都是基于IPMI方式进行管理，而且每个厂商的IPMI还不通用，很难实现资源的动态伸缩。说到API接口，我了解到的ZStack云平台，具备全API接口开放的特点。可以使容器集群根据业务压力自动伸缩。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      4、可靠性非常好
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      为什么这么说呢?其实不难理解，计划内和计划外业务影响少。当我们对物理服务器进行计划内维护时，那些单容器运行的业务必定会受影响，此时可以借助云平台中的热迁移功能，迁移的过程中可实现业务不中断。对于计划外停机，对业务影响基本上都是按天算的，损失不可言表。如果采用云平台方式业务中断时间将会缩短到分钟级别。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      上面简单分享了一下用云主机构建K8S集群的一些优点，当然也有一些缺点，在我看来缺点无非就是性能有稍微点损失，总之利大于弊。可以在规划时规避掉这个问题，比如可以将性能型容器资源集中放到物理Node上，这样就可以完美解决了。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      最后再说说在ZStack ARM架构的云主机上部署K8S需要注意的地方，为大家提供一些参考。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      1、默认Get下来的yaml配置文件，里面涉及的image路径都是x86架构的amd64，需要将其改成arm64。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      2、在创建集群的时候，如果采用flannel网络模式则--pod-network-cidr一定要为 10.244.0.0/16，否则Pod网可能不通。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      3、云主机环境一定要执行sudo swapoff -a 不然创建K8S集群的时候就会报错。
     </span>
    </p>
    <p style="margin-left:0px;">
     <span style="color:#666666;">
      以上就是我本次的主要分享内容，欢迎大家关注交流。（qq：410185063；mail：zts@viczhu.com）。
     </span>
    </p>
   </div>
  </div>
 </article>
</div>


