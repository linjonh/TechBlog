---
layout: post
title: "在树莓派上运行-COCO-SSD-MobileNet-目标检测完整指南"
date: 2025-03-16 21:59:32 +0800
description: "无论是识别门口的快递包裹、监控花园里的小动物，还是打造一个智能安防系统，目标检测技术都能让你的树莓派项目如虎添翼。无需昂贵的硬件，只需一个普通的树莓派和摄像头，即可开启计算机视觉的奇妙之旅！标准卷积 vs 深度可分离卷积（来源：Google Research），无需复杂的区域建议步骤。通过本指南，你已经成功在树莓派上部署了实时目标检测系统！是计算机视觉领域最权威的数据集之一，包含。COCO数据集示例图像（来源：COCO官网）：OpenCV 不支持摄像头的像素格式。：预处理与后处理的坐标转换错误。"
keywords: "在树莓派上运行 COCO-SSD MobileNet 目标检测：完整指南"
categories: ['Ai']
tags: ['计算机视觉', '目标检测', '人工智能']
artid: "146302434"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146302434
    alt: "在树莓派上运行-COCO-SSD-MobileNet-目标检测完整指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146302434
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146302434
cover: https://bing.ee123.net/img/rand?artid=146302434
image: https://bing.ee123.net/img/rand?artid=146302434
img: https://bing.ee123.net/img/rand?artid=146302434
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     在树莓派上运行 COCO-SSD MobileNet 目标检测：完整指南
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <hr/>
    <h2>
     <a id="_COCOSSD_MobileNet__3">
     </a>
     <strong>
      在树莓派上运行 COCO-SSD MobileNet 目标检测：完整指南
     </strong>
    </h2>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=https%3A%2F%2Fmiro.medium.com%2Fmax%2F1400%2F1*QhCvUz6v3Q2jT4i4aQcZ5g.jpeg&amp;pos_id=img-qBUuat1q-1742133504895">
      <br/>
      <em>
       树莓派 + 摄像头 + AI = 无限可能！
      </em>
     </img>
    </p>
    <hr/>
    <h3>
     <a id="1__10">
     </a>
     <strong>
      1. 引言：让树莓派拥有「视觉智能」
     </strong>
    </h3>
    <p>
     <strong>
      你是否想过，让一台信用卡大小的电脑实时「看懂」周围的世界？
     </strong>
     <br/>
     无论是识别门口的快递包裹、监控花园里的小动物，还是打造一个智能安防系统，目标检测技术都能让你的树莓派项目如虎添翼。
    </p>
    <p>
     本指南将手把手教你：
     <strong>
      如何在树莓派上部署 COCO-SSD MobileNet 模型，通过摄像头实现实时目标检测
     </strong>
     。无需昂贵的硬件，只需一个普通的树莓派和摄像头，即可开启计算机视觉的奇妙之旅！
    </p>
    <hr/>
    <h3>
     <a id="2__COCOSSD_MobileNet_19">
     </a>
     <strong>
      2. 为什么选择 COCO-SSD MobileNet？
     </strong>
    </h3>
    <h4>
     <a id="21__21">
     </a>
     <strong>
      2.1 目标检测技术的演进
     </strong>
    </h4>
    <p>
     在深入技术细节前，我们先快速回顾目标检测的发展史：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        算法
       </th>
       <th>
        特点
       </th>
       <th>
        适用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         R-CNN
        </strong>
       </td>
       <td>
        高精度，但速度极慢
       </td>
       <td>
        学术研究
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         Fast R-CNN
        </strong>
       </td>
       <td>
        速度提升，仍依赖GPU
       </td>
       <td>
        服务器端应用
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         Faster R-CNN
        </strong>
       </td>
       <td>
        引入区域建议网络（RPN）
       </td>
       <td>
        高精度需求场景
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         YOLO
        </strong>
       </td>
       <td>
        实时检测，精度适中
       </td>
       <td>
        实时监控
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         SSD
        </strong>
       </td>
       <td>
        速度与精度平衡
       </td>
       <td>
        移动端/嵌入式
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <strong>
      SSD（Single Shot MultiBox Detector）
     </strong>
     的最大优势在于：
     <strong>
      单次前向传播即可完成所有目标的定位和分类
     </strong>
     ，无需复杂的区域建议步骤。这使得它在嵌入式设备上表现尤为出色。
    </p>
    <h4>
     <a id="22_MobileNet_35">
     </a>
     <strong>
      2.2 MobileNet：为移动端而生的轻量级网络
     </strong>
    </h4>
    <p>
     <strong>
      MobileNet
     </strong>
     的核心思想是使用
     <strong>
      深度可分离卷积（Depthwise Separable Convolution）
     </strong>
     替代标准卷积。这种设计将计算量减少了
     <strong>
      8-9倍
     </strong>
     ，而精度仅下降约
     <strong>
      1%
     </strong>
     。
    </p>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=https%3A%2F%2Fmiro.medium.com%2Fmax%2F1400%2F1*_SUv4lTk6lD5qilGKYsnow.png&amp;pos_id=img-MaRqhbIp-1742133504898">
      <br/>
      <em>
       标准卷积 vs 深度可分离卷积（来源：Google Research）
      </em>
     </img>
    </p>
    <h4>
     <a id="23_COCO_80_42">
     </a>
     <strong>
      2.3 COCO 数据集：覆盖80类常见物体
     </strong>
    </h4>
    <p>
     <strong>
      COCO（Common Objects in Context）
     </strong>
     是计算机视觉领域最权威的数据集之一，包含
     <strong>
      80 个日常物体类别
     </strong>
     ，例如：
    </p>
    <ul>
     <li>
      人物（person）
     </li>
     <li>
      交通工具（car, bicycle, airplane）
     </li>
     <li>
      动物（dog, cat, horse）
     </li>
     <li>
      家具（chair, sofa, bed）
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/835cd9d243f1a1a9cce3f6852ab17dec.jpeg">
      <br/>
      <em>
       COCO数据集示例图像（来源：COCO官网）
      </em>
     </img>
    </p>
    <h4>
     <a id="24__TensorFlow_Lite__54">
     </a>
     <strong>
      2.4 为何选择量化后的 TensorFlow Lite 模型？
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       模型体积更小
      </strong>
      ：原始模型约 25MB → 量化后仅 4.3MB
     </li>
     <li>
      <strong>
       推理速度更快
      </strong>
      ：8-bit 整数运算比 32-bit 浮点运算快 2-3 倍
     </li>
     <li>
      <strong>
       内存占用更低
      </strong>
      ：适合树莓派有限的 RAM（通常 1GB/4GB）
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="3__62">
     </a>
     <strong>
      3. 硬件与软件准备
     </strong>
    </h3>
    <h4>
     <a id="31__64">
     </a>
     <strong>
      3.1 所需硬件清单
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        组件
       </th>
       <th>
        推荐型号
       </th>
       <th>
        备注
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        树莓派
       </td>
       <td>
        Raspberry Pi 4B (4GB)
       </td>
       <td>
        3B+ 也可运行，但帧率较低
       </td>
      </tr>
      <tr>
       <td>
        摄像头
       </td>
       <td>
        Raspberry Pi Camera V2
       </td>
       <td>
        或 USB 摄像头（如 Logitech C920）
       </td>
      </tr>
      <tr>
       <td>
        电源适配器
       </td>
       <td>
        5V/3A USB-C
       </td>
       <td>
        确保稳定供电
       </td>
      </tr>
      <tr>
       <td>
        散热装置
       </td>
       <td>
        散热片 + 风扇
       </td>
       <td>
        避免长时间高负载导致过热
       </td>
      </tr>
      <tr>
       <td>
        存储卡
       </td>
       <td>
        32GB Class 10
       </td>
       <td>
        建议使用 Raspberry Pi OS Lite
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="32__74">
     </a>
     <strong>
      3.2 软件环境配置
     </strong>
    </h4>
    <h5>
     <a id="_1_Raspberry_Pi_OS_76">
     </a>
     <strong>
      步骤 1：安装 Raspberry Pi OS
     </strong>
    </h5>
    <p>
     推荐使用
     <strong>
      Raspberry Pi OS (64-bit) Lite
     </strong>
     版本，最小化系统资源占用：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 使用 Raspberry Pi Imager 工具刷写系统</span>
<span class="token comment"># 下载地址：https://www.raspberrypi.com/software/</span>
</code></pre>
    <h5>
     <a id="_2_85">
     </a>
     <strong>
      步骤 2：启用摄像头接口
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> raspi-config
<span class="token comment"># 选择 Interfacing Options → Camera → Enable</span>
</code></pre>
    <h5>
     <a id="_3_92">
     </a>
     <strong>
      步骤 3：安装必要依赖
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> python3-opencv libatlas-base-dev
</code></pre>
    <h5>
     <a id="_4_Python__99">
     </a>
     <strong>
      步骤 4：创建 Python 虚拟环境
     </strong>
    </h5>
    <pre><code class="prism language-bash">python3 <span class="token parameter variable">-m</span> venv tflite-env
<span class="token builtin class-name">source</span> tflite-env/bin/activate
pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip
pip <span class="token function">install</span> tflite-runtime numpy pillow
</code></pre>
    <p>
     <strong>
      注意
     </strong>
     ：如果使用 USB 摄像头时遇到问题，可尝试：
    </p>
    <pre><code class="prism language-bash">pip uninstall opencv-python
pip <span class="token function">install</span> opencv-python-headless
</code></pre>
    <hr/>
    <h3>
     <a id="4__117">
     </a>
     <strong>
      4. 模型下载与解析
     </strong>
    </h3>
    <h4>
     <a id="41__119">
     </a>
     <strong>
      4.1 下载预训练模型
     </strong>
    </h4>
    <pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/tflite_models <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> ~/tflite_models
<span class="token function">wget</span> https://storage.googleapis.com/download.tensorflow.org/models/tflite/coco_ssd_mobilenet_v1_1.0_quant_2018_06_29.zip
<span class="token function">unzip</span> coco_ssd_mobilenet_v1_1.0_quant_2018_06_29.zip
</code></pre>
    <p>
     解压后的关键文件：
    </p>
    <ul>
     <li>
      <code>
       detect.tflite
      </code>
      ：量化后的 TensorFlow Lite 模型
     </li>
     <li>
      <code>
       coco_labels.txt
      </code>
      ：包含 80 个类别名称的标签文件
     </li>
    </ul>
    <h4>
     <a id="42__132">
     </a>
     <strong>
      4.2 模型输入输出分析
     </strong>
    </h4>
    <p>
     使用
     <code>
      netron
     </code>
     工具可视化模型结构：
    </p>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> netron
python <span class="token parameter variable">-m</span> netron detect.tflite
</code></pre>
    <ul>
     <li>
      <strong>
       输入
      </strong>
      ：
      <code>
       300x300x3
      </code>
      的 RGB 图像（uint8 类型）
     </li>
     <li>
      <strong>
       输出
      </strong>
      ：
      <ul>
       <li>
        检测框坐标（[ymin, xmin, ymax, xmax]）
       </li>
       <li>
        类别索引
       </li>
       <li>
        置信度分数
       </li>
       <li>
        检测数量
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5__152">
     </a>
     <strong>
      5. 编写目标检测程序
     </strong>
    </h3>
    <h4>
     <a id="51__154">
     </a>
     <strong>
      5.1 完整代码解析
     </strong>
    </h4>
    <p>
     创建
     <code>
      tflite_camera.py
     </code>
     文件：
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> tflite_runtime<span class="token punctuation">.</span>interpreter <span class="token keyword">as</span> tflite
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

<span class="token comment"># 初始化模型</span>
model_path <span class="token operator">=</span> <span class="token string">"/home/pi/tflite_models/detect.tflite"</span>
interpreter <span class="token operator">=</span> tflite<span class="token punctuation">.</span>Interpreter<span class="token punctuation">(</span>model_path<span class="token operator">=</span>model_path<span class="token punctuation">)</span>
interpreter<span class="token punctuation">.</span>allocate_tensors<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 获取输入输出张量信息</span>
input_details <span class="token operator">=</span> interpreter<span class="token punctuation">.</span>get_input_details<span class="token punctuation">(</span><span class="token punctuation">)</span>
output_details <span class="token operator">=</span> interpreter<span class="token punctuation">.</span>get_output_details<span class="token punctuation">(</span><span class="token punctuation">)</span>
height <span class="token operator">=</span> input_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'shape'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
width <span class="token operator">=</span> input_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'shape'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

<span class="token comment"># 加载类别标签</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/home/pi/tflite_models/coco_labels.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    labels <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># 打开摄像头</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">preprocess_image</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""图像预处理：调整尺寸、转换颜色空间、归一化"""</span>
    image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span>
    image_rgb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
    input_data <span class="token operator">=</span> np<span class="token punctuation">.</span>expand_dims<span class="token punctuation">(</span>image_rgb<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> input_data

<span class="token keyword">def</span> <span class="token function">draw_detections</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> boxes<span class="token punctuation">,</span> classes<span class="token punctuation">,</span> scores<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""在图像上绘制检测框和标签"""</span>
    frame_height<span class="token punctuation">,</span> frame_width <span class="token operator">=</span> frame<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">:</span>  <span class="token comment"># 置信度阈值设为50%</span>
            ymin<span class="token punctuation">,</span> xmin<span class="token punctuation">,</span> ymax<span class="token punctuation">,</span> xmax <span class="token operator">=</span> boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            xmin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> xmin <span class="token operator">*</span> frame_width<span class="token punctuation">)</span><span class="token punctuation">)</span>
            xmax <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>frame_width<span class="token punctuation">,</span> xmax <span class="token operator">*</span> frame_width<span class="token punctuation">)</span><span class="token punctuation">)</span>
            ymin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ymin <span class="token operator">*</span> frame_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
            ymax <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>frame_height<span class="token punctuation">,</span> ymax <span class="token operator">*</span> frame_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> ymin<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>xmax<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>labels<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">int</span><span class="token punctuation">(</span>scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> ymin<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> frame

<span class="token keyword">while</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    
    <span class="token comment"># 预处理</span>
    input_data <span class="token operator">=</span> preprocess_image<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
    
    <span class="token comment"># 推理</span>
    interpreter<span class="token punctuation">.</span>set_tensor<span class="token punctuation">(</span>input_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> input_data<span class="token punctuation">)</span>
    interpreter<span class="token punctuation">.</span>invoke<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 获取结果</span>
    boxes <span class="token operator">=</span> interpreter<span class="token punctuation">.</span>get_tensor<span class="token punctuation">(</span>output_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    classes <span class="token operator">=</span> interpreter<span class="token punctuation">.</span>get_tensor<span class="token punctuation">(</span>output_details<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    scores <span class="token operator">=</span> interpreter<span class="token punctuation">.</span>get_tensor<span class="token punctuation">(</span>output_details<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 绘制检测结果</span>
    frame <span class="token operator">=</span> draw_detections<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> boxes<span class="token punctuation">,</span> classes<span class="token punctuation">,</span> scores<span class="token punctuation">)</span>
    
    <span class="token comment"># 显示</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Real-Time Detection'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="52__236">
     </a>
     <strong>
      5.2 关键代码详解
     </strong>
    </h4>
    <h5>
     <a id="_238">
     </a>
     <strong>
      图像预处理
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       尺寸调整
      </strong>
      ：模型要求输入为 300x300 像素
     </li>
     <li>
      <strong>
       颜色空间转换
      </strong>
      ：OpenCV 默认使用 BGR 格式，需转换为 RGB
     </li>
     <li>
      <strong>
       维度扩展
      </strong>
      ：添加 batch 维度（从 (300,300,3) → (1,300,300,3)）
     </li>
    </ul>
    <h5>
     <a id="_244">
     </a>
     <strong>
      推理结果解析
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       boxes
      </strong>
      ：检测框坐标（归一化到 0~1 之间）
     </li>
     <li>
      <strong>
       classes
      </strong>
      ：类别索引（对应
      <code>
       coco_labels.txt
      </code>
      的行号）
     </li>
     <li>
      <strong>
       scores
      </strong>
      ：置信度（0~1 之间的浮点数）
     </li>
    </ul>
    <h5>
     <a id="_250">
     </a>
     <strong>
      后处理技巧
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       置信度过滤
      </strong>
      ：仅显示分数高于 0.5 的检测结果
     </li>
     <li>
      <strong>
       坐标转换
      </strong>
      ：将归一化坐标转换为实际像素坐标
     </li>
     <li>
      <strong>
       边界检查
      </strong>
      ：确保绘制时不超出图像范围
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="6__258">
     </a>
     <strong>
      6. 性能优化技巧
     </strong>
    </h3>
    <h4>
     <a id="61_FPS_5__260">
     </a>
     <strong>
      6.1 提升帧率（FPS）的 5 种方法
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        降低输入分辨率
       </strong>
       <br/>
       修改模型输入尺寸（需重新训练模型）：
      </p>
      <pre><code class="prism language-python"><span class="token comment"># 将 300x300 改为 192x192</span>
image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        使用多线程处理
       </strong>
       <br/>
       分离摄像头捕获和模型推理线程：
      </p>
      <pre><code class="prism language-python"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">class</span> <span class="token class-name">VideoStream</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>stream <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>grabbed<span class="token punctuation">,</span> self<span class="token punctuation">.</span>frame <span class="token operator">=</span> self<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>stopped <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>self<span class="token punctuation">.</span>update<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
    
    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>stopped<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>grabbed<span class="token punctuation">,</span> self<span class="token punctuation">.</span>frame <span class="token operator">=</span> self<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>frame
    
    <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>stopped <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        启用 TensorFlow Lite XNNPACK 加速
       </strong>
       <br/>
       在初始化模型时添加参数：
      </p>
      <pre><code class="prism language-python">interpreter <span class="token operator">=</span> tflite<span class="token punctuation">.</span>Interpreter<span class="token punctuation">(</span>
    model_path<span class="token operator">=</span>model_path<span class="token punctuation">,</span>
    experimental_delegates<span class="token operator">=</span><span class="token punctuation">[</span>tflite<span class="token punctuation">.</span>load_delegate<span class="token punctuation">(</span><span class="token string">'libXNNPACK.so'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        超频树莓派 CPU
       </strong>
       <br/>
       编辑
       <code>
        /boot/config.txt
       </code>
       ：
      </p>
      <pre><code class="prism language-bash"><span class="token assign-left variable">over_voltage</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token assign-left variable">arm_freq</span><span class="token operator">=</span><span class="token number">1750</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        使用硬件加速的摄像头驱动
       </strong>
       <br/>
       改用
       <code>
        libcamera
       </code>
       API：
      </p>
      <pre><code class="prism language-python">cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'libcamerasrc ! video/x-raw,width=640,height=480 ! videoconvert ! appsink'</span><span class="token punctuation">)</span>
</code></pre>
     </li>
    </ol>
    <h4>
     <a id="62__Edge_TPU__318">
     </a>
     <strong>
      6.2 使用 Edge TPU 加速
     </strong>
    </h4>
    <p>
     如果你有
     <strong>
      Google Coral USB Accelerator
     </strong>
     ，执行以下步骤：
    </p>
    <ol>
     <li>
      <p>
       安装 Edge TPU 运行时：
      </p>
      <pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"deb https://packages.cloud.google.com/apt coral-edgetpu-stable main"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/coral-edgetpu.list
<span class="token function">curl</span> https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libedgetpu1-std
</code></pre>
     </li>
     <li>
      <p>
       下载 Edge TPU 兼容模型：
      </p>
      <pre><code class="prism language-bash"><span class="token function">wget</span> https://github.com/google-coral/edgetpu/raw/master/test_data/ssd_mobilenet_v2_coco_quant_postprocess_edgetpu.tflite
</code></pre>
     </li>
     <li>
      <p>
       修改代码加载 Edge TPU 模型：
      </p>
      <pre><code class="prism language-python">interpreter <span class="token operator">=</span> tflite<span class="token punctuation">.</span>Interpreter<span class="token punctuation">(</span>
    model_path<span class="token operator">=</span><span class="token string">"ssd_mobilenet_v2_coco_quant_postprocess_edgetpu.tflite"</span><span class="token punctuation">,</span>
    experimental_delegates<span class="token operator">=</span><span class="token punctuation">[</span>tflite<span class="token punctuation">.</span>load_delegate<span class="token punctuation">(</span><span class="token string">'libedgetpu.so.1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre>
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="7__345">
     </a>
     <strong>
      7. 常见问题与解决方案
     </strong>
    </h3>
    <h4>
     <a id="Q1_VIDEOIO_ERROR_V4L2_Pixel_format_of_incoming_image_is_unsupported_347">
     </a>
     <strong>
      Q1：摄像头无法打开，提示
      <code>
       VIDEOIO ERROR: V4L2: Pixel format of incoming image is unsupported
      </code>
     </strong>
    </h4>
    <p>
     <strong>
      原因
     </strong>
     ：OpenCV 不支持摄像头的像素格式
     <br/>
     <strong>
      解决
     </strong>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># 在 cv2.VideoCapture() 后添加以下代码</span>
cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FOURCC<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'J'</span><span class="token punctuation">,</span><span class="token string">'P'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span>
cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="Q21_FPS_358">
     </a>
     <strong>
      Q2：推理速度慢（&lt;1 FPS）
     </strong>
    </h4>
    <p>
     <strong>
      优化步骤
     </strong>
     ：
    </p>
    <ol>
     <li>
      确认使用 TensorFlow Lite 而非完整版 TensorFlow
     </li>
     <li>
      关闭不必要的后台进程：
      <pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl disable bluetooth.service
<span class="token function">sudo</span> systemctl disable avahi-daemon.service
</code></pre>
     </li>
     <li>
      使用轻量级窗口管理器（如 LXDE）
     </li>
    </ol>
    <h4>
     <a id="Q3_369">
     </a>
     <strong>
      Q3：检测框位置偏移
     </strong>
    </h4>
    <p>
     <strong>
      原因
     </strong>
     ：预处理与后处理的坐标转换错误
     <br/>
     <strong>
      检查点
     </strong>
     ：
    </p>
    <ul>
     <li>
      确保输入图像尺寸与模型匹配（300x300）
     </li>
     <li>
      坐标反归一化时乘以的是原始图像尺寸而非模型输入尺寸
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="8__378">
     </a>
     <strong>
      8. 拓展应用：从原型到产品
     </strong>
    </h3>
    <h4>
     <a id="_1_380">
     </a>
     <strong>
      案例 1：智能门铃系统
     </strong>
    </h4>
    <ul>
     <li>
      检测到人时拍照保存
     </li>
     <li>
      通过 Telegram Bot 发送通知
     </li>
     <li>
      使用 PIR 传感器降低功耗
     </li>
    </ul>
    <h4>
     <a id="_2_385">
     </a>
     <strong>
      案例 2：野生动物监测
     </strong>
    </h4>
    <ul>
     <li>
      太阳能供电 + 4G 模块
     </li>
     <li>
      检测到特定物种时触发录像
     </li>
     <li>
      数据上传至云端分析
     </li>
    </ul>
    <h4>
     <a id="_3_390">
     </a>
     <strong>
      案例 3：工业质检
     </strong>
    </h4>
    <ul>
     <li>
      定制训练模型检测产品缺陷
     </li>
     <li>
      配合机械臂自动分拣
     </li>
     <li>
      统计生产数据生成报表
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="9__397">
     </a>
     <strong>
      9. 总结与展望
     </strong>
    </h3>
    <p>
     通过本指南，你已经成功在树莓派上部署了实时目标检测系统！
     <strong>
      关键收获
     </strong>
     ：
    </p>
    <ul>
     <li>
      ✅ 理解 COCO-SSD MobileNet 的轻量级设计理念
     </li>
     <li>
      ✅ 掌握 TensorFlow Lite 在嵌入式设备的部署流程
     </li>
     <li>
      ✅ 学会优化推理性能的实用技巧
     </li>
    </ul>
    <p>
     <strong>
      未来探索方向
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       模型微调（Fine-tuning）
      </strong>
      ：使用自定义数据集提升特定场景的检测精度
     </li>
     <li>
      <strong>
       多模型融合
      </strong>
      ：结合姿态估计、语义分割等技术
     </li>
     <li>
      <strong>
       边缘-云协同
      </strong>
      ：在本地执行实时检测，云端进行大数据分析
     </li>
    </ul>
    <hr/>
    <p>
     <strong>
      🚀 现在，拿起你的树莓派，开启计算机视觉的创造之旅吧！
     </strong>
     <br/>
     任何问题或创意，欢迎在评论区留言交流！ 😊👋
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f496e746572766965775f54432f:61727469636c652f64657461696c732f313436333032343334" class_="artid" style="display:none">
 </p>
</div>


