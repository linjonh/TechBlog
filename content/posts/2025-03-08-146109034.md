---
layout: post
title: "Go红队开发格式导出"
date: 2025-03-08 11:41:24 +0800
description: "爆肝！！在我们使用安全工具的时候基本都会有一个输出功能，同样也很重要，所以下面介绍csv、json、html、sqlite的输出格式。"
keywords: "Go红队开发—格式导出"
categories: ['Go']
tags: ['网络', '开发语言', '安全', '后端', 'Golang']
artid: "146109034"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146109034
    alt: "Go红队开发格式导出"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146109034
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146109034
cover: https://bing.ee123.net/img/rand?artid=146109034
image: https://bing.ee123.net/img/rand?artid=146109034
img: https://bing.ee123.net/img/rand?artid=146109034
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Go红队开发—格式导出
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_2">
     </a>
     输出功能
    </h2>
    <p>
     在我们使用安全工具的时候基本都会有一个输出功能，同样也很重要，所以下面介绍csv、json、html、sqlite的输出格式。
    </p>
    <h3>
     <a id="CSV_6">
     </a>
     CSV输出
    </h3>
    <pre><code class="prism language-go">下载包：<span class="token keyword">go</span> get <span class="token operator">-</span>u github<span class="token punctuation">.</span>com<span class="token operator">/</span>gocarina<span class="token operator">/</span>gocsv
</code></pre>
    <p>
     使用之前先明确我们要csv格式干什么：
    </p>
    <ul>
     <li>
      首先一些数据可能就是存在csv文件里面，需要我们提取出来的话就需要另外写函数，但是现在有现成的包使用就很方便了
     </li>
     <li>
      其次我们使用一些安全工具的时候经常会有导出格式为csv格式的，所以在开发过程中也是一个很重要的需求，使用Gocsv包会很方便
      <br/>
      同理我们往后的其他格式也一样的需求。
     </li>
    </ul>
    <h4>
     <a id="CSV___19">
     </a>
     CSV 转 结构体
    </h4>
    <p>
     test.csv文件内容为：
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/92e1e294a434cf92c8fa9234c5b1d64c.png"/>
    </p>
    <p>
     1.在CSV转结构体的时候，我们需要构造一个结构体，用来接收CSV文件中的表头
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Id   <span class="token builtin">string</span> <span class="token string">`csv:"id"`</span>

    Name <span class="token builtin">string</span> <span class="token string">`csv:"name"`</span>

    Age  <span class="token builtin">int</span>    <span class="token string">`csv:"age"`</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     2.解析csv文件
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 解析CSV文件</span>

<span class="token keyword">func</span> <span class="token function">anlyzeCSV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>

        <span class="token string">"test.csv"</span><span class="token punctuation">,</span>

        os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token punctuation">,</span>

        <span class="token number">0666</span><span class="token punctuation">,</span>

    <span class="token punctuation">)</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    person <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Person<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> gocsv<span class="token punctuation">.</span><span class="token function">UnmarshalFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//UnmarshalFile将文件解析为结构体</span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"解析文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"id,name,age"</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> p <span class="token operator">:=</span> <span class="token keyword">range</span> person <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="__CSV_83">
     </a>
     结构体 转 CSV
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// 写入CSV文件</span>

<span class="token keyword">func</span> <span class="token function">writeCSV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"test.csv"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_APPEND<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    person <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Person<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    person <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Person<span class="token punctuation">{<!-- --></span>

        Id<span class="token punctuation">:</span>   <span class="token string">"1"</span><span class="token punctuation">,</span>

        Name<span class="token punctuation">:</span> <span class="token string">"李四"</span><span class="token punctuation">,</span>

        Age<span class="token punctuation">:</span>  <span class="token number">20</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    err <span class="token operator">=</span> gocsv<span class="token punctuation">.</span><span class="token function">MarshalFile</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token comment">//MarshalFile将数据写入文件</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"写入文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="CSV_124">
     </a>
     端口扫描结果使用CSV格式导出
    </h4>
    <p>
     结合之前的端口扫描练习，将结果通过所学的知识CSV格式输出
     <br/>
     这里我对之前的练习进行了一个改造，就是让输出美观一点，同时修改了传参与返回值，目的都是为了拿到扫描完成的端口结果。
     <br/>
     为了写进csv还创建了一个结构体。
    </p>
    <hr/>
    <p>
     <strong>
      <code>
       函数中大部分代码其实都是格式的转换，主要功能其实学会了上面基本都能做了。
      </code>
     </strong>
    </p>
    <p>
     所以这里我在放代码前说一下我遇到的问题：
    </p>
    <ul>
     <li>
      csv的表头要修改的话是比较困难，我没有找到一个比较好的办法，就是在写入csv的代码过程中，修改csv表头，我的解决办法是通过开一个新的结构体，通过老结构体的数据传递到新的结构体中就能够修改csv头写进文件里了
      <code>
       (这里有大佬知道解决办法可以告诉我一下)
      </code>
     </li>
     <li>
      时间格式化有问题，时间格式一定只能用他给出的几种时间：-
      <code>
       "2006-01-02 15:04:05"
      </code>
      ：表示
      <code>
       年-月-日 时:分:秒
      </code>
      格式，如果你修改一下2006年改为2002年都是会格式化出错，这一点尝试了几回发现原来是格式时间数字也固定的表达的。
     </li>
     <li>
      <strong>
       你要写入的结构体的变量名首个字母要大写，一定要大写，否则他会报错，可能这也是一种规范吧，反正不大写就会报错。
      </strong>
      最后的那个示例代码你可以尝试把HostPort结构体中的ScanTime修改首字母小写scanTime，很好的验证了小写的时候出现的错误，当然我运行的时候没有报错，但是他实际上是他没有吧你的时间写进csv中，也代码出错了，可以观察验证一下确实不能小写只能首字母大写。
     </li>
     <li>
      自定义格式实现MarshalCSV接口后，在写入的时候会自动调用该函数，你可以在该函数进行一些初始化或者格式化动作等等。
     </li>
    </ul>
    <p>
     这补充一下时间格式化的代码：
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 格式化时间time.Time类型</span>

<span class="token keyword">func</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006年1月2日"</span><span class="token punctuation">)</span> <span class="token comment">//转为string类型</span>

<span class="token punctuation">}</span>


<span class="token comment">// Parse将string类型转为time.Time类型</span>

<span class="token keyword">func</span> <span class="token function">timeParse</span><span class="token punctuation">(</span>t <span class="token builtin">string</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">{<!-- --></span>

    tm<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>

    <span class="token keyword">return</span> tm

<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <p>
     代码示例：(成功将扫描结果存到csv中保存)
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/89e20145d6a2a3890b35778915967e39.png"/>
    </p>
    <pre><code class="prism language-go">
<span class="token comment">// 稍微改一下代码，return一个port回来，然后输出到csv中</span>

<span class="token keyword">func</span> <span class="token function">start_WaitGroup_scan_port</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">var</span> <span class="token punctuation">(</span>

        wg      sync<span class="token punctuation">.</span>WaitGroup

        ch      <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 增加缓冲区，减少阻塞</span>

        count   <span class="token builtin">int</span>

        workers <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">// 控制并发数</span>

    <span class="token punctuation">)</span>

  

    <span class="token keyword">var</span> scanPort <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>hostname <span class="token builtin">string</span><span class="token punctuation">,</span> port <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        address <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s:%d"</span><span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> port<span class="token punctuation">)</span>

        conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">DialTimeout</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

            conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            ch <span class="token operator">&lt;-</span> port

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">// 控制并发数</span>

    sem <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> workers<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">65536</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>

        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        sem <span class="token operator">&lt;-</span> <span class="token number">1</span>

        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>port <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;-</span>sem <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">scanPort</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>

        <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    ports <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> ch <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//fmt.Printf("open: %d\n", port)</span>

        ports <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>ports<span class="token punctuation">,</span> port<span class="token punctuation">)</span> <span class="token comment">//开放端口添加进去</span>

        count<span class="token operator">++</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"-------------------------- host：%v --------------------------------\n"</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"扫描完成，共开放端口："</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"开放端口："</span><span class="token punctuation">,</span> ports<span class="token punctuation">)</span>

    t <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"时间："</span><span class="token punctuation">,</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"------------------------------------------------------------------"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> ports<span class="token punctuation">,</span> t

<span class="token punctuation">}</span>

  

<span class="token comment">// 自定义格式</span>

<span class="token keyword">type</span> myTime <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    time<span class="token punctuation">.</span>Time

<span class="token punctuation">}</span>

  

<span class="token comment">// 当你的自定义类型实现了这个接口后，在csv写入的时候会自动帮你格式化</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>myTime<span class="token punctuation">)</span> <span class="token function">MarshalCSV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> m<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 保存扫描的主机和端口</span>

<span class="token keyword">type</span> HostPort <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Host     <span class="token builtin">string</span> <span class="token string">`csv:"Host"`</span>

    Ports    <span class="token builtin">string</span> <span class="token string">`csv:"Ports"`</span>

    ScanTime myTime <span class="token string">`csv:"Time"`</span>

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">scanhost</span><span class="token punctuation">(</span>host <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>HostPort <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">var</span> ports <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>     <span class="token comment">//接收扫描端口结果</span>

    <span class="token keyword">var</span> t time<span class="token punctuation">.</span>Time     <span class="token comment">//接收扫描结束时间</span>

    plist <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">//接收每一个ip扫描的端口列表</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> h <span class="token operator">:=</span> <span class="token keyword">range</span> host <span class="token punctuation">{<!-- --></span>

        ports<span class="token punctuation">,</span> t <span class="token operator">=</span> <span class="token function">start_WaitGroup_scan_port</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> p <span class="token operator">:=</span> <span class="token keyword">range</span> ports <span class="token punctuation">{<!-- --></span>

            plist <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>plist<span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//strconv.Itoa将int转为string，添加进列表里面</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    hostports <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>HostPort<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> h <span class="token operator">:=</span> <span class="token keyword">range</span> host <span class="token punctuation">{<!-- --></span>

        hostports <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>hostports<span class="token punctuation">,</span> <span class="token operator">&amp;</span>HostPort<span class="token punctuation">{<!-- --></span>

            Host<span class="token punctuation">:</span>     h<span class="token punctuation">,</span>

            Ports<span class="token punctuation">:</span>    <span class="token string">"="</span> <span class="token operator">+</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>plist<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将列表转为字符串，用逗号分隔</span>

            ScanTime<span class="token punctuation">:</span> myTime<span class="token punctuation">{<!-- --></span>Time<span class="token punctuation">:</span> t<span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token comment">//自动格式化不用担心，因为实现了MarshalCSV方法</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token keyword">return</span> hostports

<span class="token punctuation">}</span>

  

<span class="token comment">// 输出结果到csv中</span>

<span class="token keyword">func</span> <span class="token function">outputHostPortCSV</span><span class="token punctuation">(</span>hostports <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>HostPort<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"host_port.csv"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_CREATE<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    err <span class="token operator">=</span> gocsv<span class="token punctuation">.</span><span class="token function">MarshalFile</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hostports<span class="token punctuation">,</span> file<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"写入文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"写入成功"</span><span class="token punctuation">)</span>

  

<span class="token punctuation">}</span>

  

<span class="token comment">// 格式化时间time.Time类型</span>

<span class="token keyword">func</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006年1月2日"</span><span class="token punctuation">)</span> <span class="token comment">//转为string类型</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// Parse将string类型转为time.Time类型</span>

<span class="token keyword">func</span> <span class="token function">timeParse</span><span class="token punctuation">(</span>t <span class="token builtin">string</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">{<!-- --></span>

    tm<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>

    <span class="token keyword">return</span> tm

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//anlyzeCSV()</span>

    <span class="token comment">//writeCSV()</span>

    <span class="token comment">//timeFormat()</span>

    <span class="token comment">//timeFormat(time.Now())</span>

    <span class="token comment">//timeParse("2024-11-5 5:40:43")</span>

    <span class="token comment">//anlyzeAlipay()</span>

    <span class="token function">outputHostPortCSV</span><span class="token punctuation">(</span><span class="token function">scanhost</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"127.0.0.1"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//这里可以通过参数来给一个ip列表，具体操作可以按自己需求来</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     到这里不知道各位是否觉得逐渐有点安全工具内味了。
    </p>
    <h3>
     <a id="HTML_425">
     </a>
     HTML输出
    </h3>
    <p>
     在html模板中就比较简单了，将结果传导模板渲染即可
     <br/>
     这里我个人没遇到什么问题，拿来就用了
    </p>
    <p>
     template.html文件直接复制就行，无所谓的，主要是看
     <code>
      {
      <!-- -->
      {range .}}
     </code>
     这个意思是循环，
     <code>
      {
      <!-- -->
      {end}}
     </code>
     表示循环结束，要输出你的结构体中的变量就是用
     <code>
      {
      <!-- -->
      {.xxx变量名}}
     </code>
    </p>
    <pre><code class="prism language-html">{<!-- -->{range .}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{.Host}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{.Ports}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{.ScanTime}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
{<!-- -->{end}}
</code></pre>
    <p>
     go代码中就主要用两个函数执行，你拿到数据之后无非就是渲染数据到html文件中：
    </p>
    <pre><code class="prism language-go">ParseFiles获取模板文件
Execute执行渲染
</code></pre>
    <ul>
     <li>
      有一个无关紧要的细节：
      <strong>
       <code>
        创建项目目录的时候不要和某些包重名
       </code>
      </strong>
      ，大小写不一样也算重名，重名了就无法使用你要导入的包了。
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5c3d327ae9a3e2a007120624fc458853.png">
      <br/>
      template.html
     </img>
    </p>
    <pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>扫描结果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">

        <span class="token selector">body</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Courier New'</span><span class="token punctuation">,</span> Courier<span class="token punctuation">,</span> monospace<span class="token punctuation">;</span>

            <span class="token property">background-color</span><span class="token punctuation">:</span> #0d0d0d<span class="token punctuation">;</span>

            <span class="token property">color</span><span class="token punctuation">:</span> #00ff00<span class="token punctuation">;</span>

            <span class="token property">margin</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">h1</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>

            <span class="token property">color</span><span class="token punctuation">:</span> #00ff00<span class="token punctuation">;</span>

            <span class="token property">font-size</span><span class="token punctuation">:</span> 2.5em<span class="token punctuation">;</span>

            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">table</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>

            <span class="token property">border-collapse</span><span class="token punctuation">:</span> collapse<span class="token punctuation">;</span>

            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>

            <span class="token property">border</span><span class="token punctuation">:</span> 2px solid #00ff00<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">th, td</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>

            <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>

            <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #00ff00<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">th</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">background-color</span><span class="token punctuation">:</span> #1a1a1a<span class="token punctuation">;</span>

            <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2em<span class="token punctuation">;</span>

            <span class="token property">color</span><span class="token punctuation">:</span> #00ff00<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">tr:nth-child(even)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">background-color</span><span class="token punctuation">:</span> #1a1a1a<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">tr:nth-child(odd)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">background-color</span><span class="token punctuation">:</span> #0d0d0d<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token selector">tr:hover</span> <span class="token punctuation">{<!-- --></span>

            <span class="token property">background-color</span><span class="token punctuation">:</span> #262626<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>扫描结果<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Host<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Ports<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

        {<!-- -->{range .}}

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{.Host}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{.Ports}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">word-wrap</span><span class="token punctuation">:</span>break-word<span class="token punctuation">;</span><span class="token property">word-break</span><span class="token punctuation">:</span>break-all<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{.ScanTime}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

        {<!-- -->{end}}

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     参考代码：
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

  

<span class="token keyword">import</span> <span class="token punctuation">(</span>

    <span class="token string">"fmt"</span>

    <span class="token string">"html/template"</span>

    <span class="token string">"net"</span>

    <span class="token string">"os"</span>

    <span class="token string">"strconv"</span>

    <span class="token string">"strings"</span>

    <span class="token string">"sync"</span>

    <span class="token string">"time"</span>

<span class="token punctuation">)</span>

  

<span class="token comment">// 格式化时间time.Time类型</span>

<span class="token keyword">func</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span> <span class="token comment">//转为string类型</span>

<span class="token punctuation">}</span>

  

<span class="token keyword">type</span> HostPort <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Host     <span class="token builtin">string</span>

    Ports    <span class="token builtin">string</span>

    ScanTime time<span class="token punctuation">.</span>Time

<span class="token punctuation">}</span>

  

<span class="token comment">// 这里就和csv不同了，就需要自己写一个函数重载调用，这里是用来格式化时间</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>HostPort<span class="token punctuation">)</span> <span class="token function">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> r<span class="token punctuation">.</span>ScanTime<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02 15:04:05"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 稍微改一下代码，return一个port回来，然后输出到csv中</span>

<span class="token keyword">func</span> <span class="token function">start_WaitGroup_scan_port</span><span class="token punctuation">(</span>host <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">var</span> <span class="token punctuation">(</span>

        wg      sync<span class="token punctuation">.</span>WaitGroup

        ch      <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// 增加缓冲区，减少阻塞</span>

        count   <span class="token builtin">int</span>

        workers <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">// 控制并发数</span>

    <span class="token punctuation">)</span>

  

    <span class="token keyword">var</span> scanPort <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>hostname <span class="token builtin">string</span><span class="token punctuation">,</span> port <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        address <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s:%d"</span><span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> port<span class="token punctuation">)</span>

        conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">DialTimeout</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

            conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            ch <span class="token operator">&lt;-</span> port

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">// 控制并发数</span>

    sem <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> workers<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">65536</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>

        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        sem <span class="token operator">&lt;-</span> <span class="token number">1</span>

        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>port <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">&lt;-</span>sem <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token function">scanPort</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>

        <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>

    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    ports <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> ch <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//fmt.Printf("open: %d\n", port)</span>

        ports <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>ports<span class="token punctuation">,</span> port<span class="token punctuation">)</span> <span class="token comment">//开放端口添加进去</span>

        count<span class="token operator">++</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"-------------------------- host：%v --------------------------------\n"</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"扫描完成，共开放端口："</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"开放端口："</span><span class="token punctuation">,</span> ports<span class="token punctuation">)</span>

    t <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"时间："</span><span class="token punctuation">,</span> <span class="token function">timeFormat</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"------------------------------------------------------------------"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> ports<span class="token punctuation">,</span> t

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">scanhost</span><span class="token punctuation">(</span>host <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>HostPort <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">var</span> ports <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>     <span class="token comment">//接收扫描端口结果</span>

    <span class="token keyword">var</span> t time<span class="token punctuation">.</span>Time     <span class="token comment">//接收扫描结束时间</span>

    plist <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">//接收每一个ip扫描的端口列表</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> h <span class="token operator">:=</span> <span class="token keyword">range</span> host <span class="token punctuation">{<!-- --></span>

        ports<span class="token punctuation">,</span> t <span class="token operator">=</span> <span class="token function">start_WaitGroup_scan_port</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> p <span class="token operator">:=</span> <span class="token keyword">range</span> ports <span class="token punctuation">{<!-- --></span>

            plist <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>plist<span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//strconv.Itoa将int转为string，添加进列表里面</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    hostports <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>HostPort<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> h <span class="token operator">:=</span> <span class="token keyword">range</span> host <span class="token punctuation">{<!-- --></span>

        hostports <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>hostports<span class="token punctuation">,</span> <span class="token operator">&amp;</span>HostPort<span class="token punctuation">{<!-- --></span>

            Host<span class="token punctuation">:</span>     h<span class="token punctuation">,</span>

            Ports<span class="token punctuation">:</span>    strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>plist<span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将列表转为字符串，用逗号分隔</span>

            ScanTime<span class="token punctuation">:</span> t<span class="token punctuation">,</span>                        <span class="token comment">//自动格式化不用担心，因为实现了MarshalCSV方法</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token keyword">return</span> hostports

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">anlyzeHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    temphtml<span class="token punctuation">,</span> err <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">ParseFiles</span><span class="token punctuation">(</span><span class="token string">"template.html"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开模版失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"output.html"</span><span class="token punctuation">)</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"创建文件失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    err <span class="token operator">=</span> temphtml<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token function">scanhost</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"127.0.0.1"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"渲染失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"html结果导出成功！"</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token function">anlyzeHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Sqlite_839">
     </a>
     Sqlite输出
    </h3>
    <p>
     下载包
    </p>
    <pre><code class="prism language-go"><span class="token keyword">go</span> get github<span class="token punctuation">.</span>com<span class="token operator">/</span>mattn<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">-</span>sqlite3
</code></pre>
    <p>
     导入包的时候注意细节
    </p>
    <blockquote>
     <p>
      github.com/mattn/go-sqlite3 导入包需要给一个匿名重命名一下
      <br/>
      因为go-sqlite3 包在导⼊时会执⾏其 init 函数，该函数会注册 SQLite3 驱动到 database/sql 包中，所以为了使⽤ sql.Open(“sqlite3”, …) 时，database/sql 包就能够找到并使⽤这个驱动就跟着做就行了。
     </p>
    </blockquote>
    <pre><code class="prism language-go"><span class="token boolean">_</span> <span class="token string">"github.com/mattn/go-sqlite3"</span>
</code></pre>
    <p>
     在涉及到数据库的时候无非就是几件事情
    </p>
    <ul>
     <li>
      打开数据库连接
     </li>
     <li>
      写sql语句
     </li>
     <li>
      执行sql语句
     </li>
     <li>
      关闭连接
     </li>
    </ul>
    <p>
     同理下面就按照这个顺序介绍
    </p>
    <p>
     打开数据库连接(test.db不存在他会帮你创建的，不用担心)
    </p>
    <pre><code class="prism language-go">db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"sqlite3"</span><span class="token punctuation">,</span> <span class="token string">"./test.db"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"连接失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
	<span class="token comment">//关闭数据库在这里，</span>
	<span class="token comment">//但是因为使用了go中的defer所以他会自动帮你关闭连接</span>
    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
</code></pre>
    <p>
     <code>
      写sql语句
     </code>
     与
     <code>
      执行语句
     </code>
     <br/>
     创建表：users表为例
    </p>
    <pre><code class="prism language-go">createTableSQL <span class="token operator">:=</span> CREATE TABLE IF NOT EXISTS users <span class="token punctuation">(</span>
<span class="token string">"id"</span> INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT<span class="token punctuation">,</span>
<span class="token string">"name"</span> TEXT<span class="token punctuation">,</span>
<span class="token string">"age"</span> INTEGER
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>createTableSQL<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"创建数据库失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     插入：参数值可以有两种方式给：
    </p>
    <ul>
     <li>
      第一种：直接给值在sql语句中
     </li>
    </ul>
    <pre><code class="prism language-go">insertSQL <span class="token operator">=</span> <span class="token string">`INSERT INTO users (name,age) VALUES ("李四",15)`</span>
db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">)</span>
</code></pre>
    <ul>
     <li>
      第二种：可以通过占位符
      <code>
       ?
      </code>
      在执行语句的时候传递参数值
     </li>
    </ul>
    <pre><code class="prism language-go">insertSQL <span class="token operator">:=</span> <span class="token string">`INSERT INTO users (name, age) VALUES (?,?)`</span> <span class="token comment">//可以通过??作为占位符，exec的时候就可以传参的方式传进去</span>
<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">,</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"插入数据失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     补充一些细节：
    </p>
    <ul>
     <li>
      如果你sql执行了，代码运行没有报错，但是你在数据库中仍然没有看到变化，那大概率是你sql语句写错了。
     </li>
     <li>
      sqlite在go中不用安装什么软件，直接使用即可，我个人是使用vscode中的sqlite插件查看数据的，下图中我两个插件都安装了，第一个安装完成后你在项目中点开db文件就能直接看到数据被解析可以看到内容了。如果你使用其他编辑器的话自行搜索方法打开即可，推荐
      <a href="https://www.navicat.com.cn/products/navicat-premium/" rel="nofollow">
       https://www.navicat.com.cn/products/navicat-premium/
      </a>
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/img_convert/741f1abaa31acbf84f5a131221b30cda.png"/>
     </li>
    </ul>
    <h4>
     <a id="nmap_916">
     </a>
     nmap扫描
    </h4>
    <p>
     这里我将之前自定义的端口扫描换成nmap扫描了
    </p>
    <p>
     1.第一步：需要提前安装好nmap:
     <br/>
     <a href="https://nmap.org/download.html" rel="nofollow">
      https://nmap.org/download.html
     </a>
     <br/>
     安装对应系统的版本后他会自己添加到系统变量中的，比如我windows安装完毕后再cmd窗口输入nmap就可以有提示出来了，如果没有自己就去安装的路径，将该路径复制到环境变量中去。(这里自行解决)
    </p>
    <p>
     2.第二步：下载
     <code>
      go-nmap
     </code>
     包
     <br/>
     注意了，这个是辅助包，不包含nmap的，nmap前面我们已经安装了
     <br/>
     (当然如果你要不安装nmap就使用的话也有对应的包是下载来就是go语言写的nmap:
     <a href="github.com/Ullaakut/nmap" rel="nofollow">
      github.com/Ullaakut/nmap
     </a>
     库 ，这个可以解决你的需求，但是功能肯定没有nmap强大)
    </p>
    <pre><code class="prism language-go"><span class="token keyword">go</span> get github<span class="token punctuation">.</span>com<span class="token operator">/</span>lair<span class="token operator">-</span>framework<span class="token operator">/</span><span class="token keyword">go</span><span class="token operator">-</span>nmap
</code></pre>
    <p>
     主要执行的还是调用我们的命令
     <br/>
     注意：-oX 如果你不加没有报错的话就可以不用加，这涉及到的输出问题，如果输出对不上他总是报错，解决办法我只有这一个，有大佬有其他解决办法可以告诉我一下。
    </p>
    <pre><code class="prism language-go">cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"nmap"</span><span class="token punctuation">,</span> <span class="token string">"-sV"</span><span class="token punctuation">,</span> <span class="token string">"-T4"</span><span class="token punctuation">,</span> <span class="token string">"-oX"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token comment">// -sV:服务探测，-T4:扫描速度</span>
</code></pre>
    <p>
     解析nmap的结果
    </p>
    <pre><code class="prism language-go">result<span class="token punctuation">,</span> err <span class="token operator">:=</span> nmap<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
	log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"解析失败: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     重点是打印，对应的变量名也写的很清楚了
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 打印结果</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> host <span class="token operator">:=</span> <span class="token keyword">range</span> result<span class="token punctuation">.</span>Hosts <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"主机: %s\n"</span><span class="token punctuation">,</span> host<span class="token punctuation">.</span>Addresses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Addr<span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> host<span class="token punctuation">.</span>Ports <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">" 端口 %d/%s: %s %s\n"</span><span class="token punctuation">,</span>
			port<span class="token punctuation">.</span>PortId<span class="token punctuation">,</span>
			port<span class="token punctuation">.</span>Protocol<span class="token punctuation">,</span>
			port<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
			port<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Product<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <p>
     运行后的结果与db数据库
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/96444ce0a6eae7174814079501025883.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5b945b8b2c52cb6824d0de0e8c9c9150.png">
      <br/>
      示例代码：
     </img>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>

    <span class="token string">"database/sql"</span>

    <span class="token string">"fmt"</span>

    <span class="token string">"log"</span>

    <span class="token string">"os/exec"</span>

    <span class="token string">"time"</span>

  
    <span class="token string">"github.com/lair-framework/go-nmap"</span>

    <span class="token boolean">_</span> <span class="token string">"github.com/mattn/go-sqlite3"</span>

<span class="token punctuation">)</span>

  

<span class="token comment">// 测试sqlite</span>

<span class="token keyword">func</span> <span class="token function">testSqlite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"sqlite3"</span><span class="token punctuation">,</span> <span class="token string">"./test.db"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"连接失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  

    <span class="token comment">// //创建表</span>

    createTableSQL <span class="token operator">:=</span> <span class="token string">`CREATE TABLE IF NOT EXISTS users (

    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,

    "name" TEXT,

    "age" INTEGER

    );`</span>

    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>createTableSQL<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"创建数据库失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//插入数据</span>

    insertSQL <span class="token operator">:=</span> <span class="token string">`INSERT INTO users (name, age) VALUES (?,?)`</span> <span class="token comment">//可以通过??作为占位符，exec的时候就可以传参的方式传进去</span>

    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">,</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"插入数据失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    insertSQL <span class="token operator">=</span> <span class="token string">`INSERT INTO users (name,age) VALUES ("李四",15)`</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">)</span>

    insertSQL <span class="token operator">=</span> <span class="token string">`INSERT INTO users (name,age) VALUES ("王五",23)`</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">)</span>

    insertSQL <span class="token operator">=</span> <span class="token string">`INSERT INTO users (name,age) VALUES ("test1",23)`</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">)</span>

    insertSQL <span class="token operator">=</span> <span class="token string">`INSERT INTO users (name,age) VALUES ("test1",23)`</span> <span class="token comment">//插入两个test1作为测试数据</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">)</span>

    insertSQL <span class="token operator">=</span> <span class="token string">`INSERT INTO users (name,age) VALUES ("test2",23)`</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">)</span>

  

    <span class="token comment">//更新数据</span>

    updateSQL <span class="token operator">:=</span> <span class="token string">`UPDATE users SET age = ? WHERE id = ?`</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>updateSQL<span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>                                    <span class="token comment">//更新id为1的年龄为45，即张三的年龄更改为45</span>

    updateSQL <span class="token operator">=</span> <span class="token string">`UPDATE users SET name = "五福" where name = "王五"`</span> <span class="token comment">//将所有叫王五的人更改名字为五福</span>

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>updateSQL<span class="token punctuation">)</span>

  

    <span class="token comment">// //删除数据</span>

    <span class="token comment">// //删除name为test的数据</span>

    deleteSQL <span class="token operator">:=</span> <span class="token string">`DELETE FROM users WHERE name = ?`</span>

    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>deleteSQL<span class="token punctuation">,</span> <span class="token string">"test1"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"删除失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//查看删除了多少个数据</span>

    resRows<span class="token punctuation">,</span> err <span class="token operator">:=</span> res<span class="token punctuation">.</span><span class="token function">RowsAffected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"删除失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"更新了："</span><span class="token punctuation">,</span> resRows<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 使用nmap扫描return结果</span>

<span class="token keyword">func</span> <span class="token function">nmapScan</span><span class="token punctuation">(</span>target <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun<span class="token punctuation">,</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  

    <span class="token comment">// 执行Nmap扫描</span>

    cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"nmap"</span><span class="token punctuation">,</span> <span class="token string">"-sV"</span><span class="token punctuation">,</span> <span class="token string">"-T4"</span><span class="token punctuation">,</span> <span class="token string">"-oX"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token comment">// -sV:服务探测，-T4:扫描速度</span>

    output<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">CombinedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Nmap扫描失败: %v\n输出: %s"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">// 解析Nmap输出</span>

    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> nmap<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"解析失败: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">// 打印结果</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> host <span class="token operator">:=</span> <span class="token keyword">range</span> result<span class="token punctuation">.</span>Hosts <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"主机: %s\n"</span><span class="token punctuation">,</span> host<span class="token punctuation">.</span>Addresses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Addr<span class="token punctuation">)</span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> host<span class="token punctuation">.</span>Ports <span class="token punctuation">{<!-- --></span>

            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">" 端口 %d/%s: %s %s\n"</span><span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>PortId<span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>Protocol<span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Product<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 将结果写进sqlite中</span>

<span class="token keyword">func</span> <span class="token function">outpuSqlite</span><span class="token punctuation">(</span>res <span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun<span class="token punctuation">,</span> t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"sqlite3"</span><span class="token punctuation">,</span> <span class="token string">"./test.db"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"连接失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> db<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    createTableSQL <span class="token operator">:=</span> <span class="token string">`CREATE TABLE IF NOT EXISTS result (

    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,

    "ip_address" TEXT,

    "port" INTEGER,

    "protocol" TEXT,

    "severity" TEXT,

    "timestamp" DATETIME

    );`</span>

  

    db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>createTableSQL<span class="token punctuation">)</span>

  

    <span class="token comment">//将扫描结果插入数据库中</span>

  

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> host <span class="token operator">:=</span> <span class="token keyword">range</span> res<span class="token punctuation">.</span>Hosts <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> host<span class="token punctuation">.</span>Ports <span class="token punctuation">{<!-- --></span>

            insertSQL <span class="token operator">:=</span> <span class="token string">`INSERT INTO result (ip_address, port, protocol, severity, timestamp) VALUES (?,?,?,?,?)`</span>

  

            <span class="token comment">//添加数据，注明：hight是我随便编的，可以搞一个对照表来确定是否高危端口</span>

            db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>insertSQL<span class="token punctuation">,</span> host<span class="token punctuation">.</span>Addresses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Addr<span class="token punctuation">,</span> port<span class="token punctuation">.</span>PortId<span class="token punctuation">,</span> port<span class="token punctuation">.</span>Protocol<span class="token punctuation">,</span> <span class="token string">"hight"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006年01月02日"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//nmapScan()</span>

    res<span class="token punctuation">,</span> t <span class="token operator">:=</span> <span class="token function">nmapScan</span><span class="token punctuation">(</span><span class="token string">"baidu.com"</span><span class="token punctuation">)</span> <span class="token comment">//扫描单个目标</span>

    <span class="token function">outpuSqlite</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> t<span class="token punctuation">)</span>

  

<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="JSON_1239">
     </a>
     JSON
    </h3>
    <p>
     爆肝json篇章…
    </p>
    <hr/>
    <p>
     没啥好说过了Sqlite这个坎后json不在话下了
    </p>
    <h4>
     <a id="mapjson_1248">
     </a>
     map转json
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// map数据转json</span>

<span class="token keyword">func</span> <span class="token function">mapTojson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    data <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token string">"person"</span><span class="token punctuation">:</span> <span class="token string">"something info"</span><span class="token punctuation">}</span>

    jsonData<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转json失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="json_1272">
     </a>
     结构体转json
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Name <span class="token builtin">string</span> <span class="token string">`json:name`</span>

    Age  <span class="token builtin">int</span>    <span class="token string">`json:age`</span>

<span class="token punctuation">}</span>
<span class="token comment">// 结构体转json</span>

<span class="token keyword">func</span> <span class="token function">structTojson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    user <span class="token operator">:=</span> person<span class="token punctuation">{<!-- --></span>Name<span class="token punctuation">:</span> <span class="token string">"lisi"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>

    jsonData<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转json失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="json_1303">
     </a>
     json写入文件
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Name <span class="token builtin">string</span> <span class="token string">`json:name`</span>

    Age  <span class="token builtin">int</span>    <span class="token string">`json:age`</span>

<span class="token punctuation">}</span>
<span class="token comment">// 将json数据写入文件</span>

<span class="token keyword">func</span> <span class="token function">outputJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    user <span class="token operator">:=</span> person<span class="token punctuation">{<!-- --></span>Name<span class="token punctuation">:</span> <span class="token string">"lisi"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>

    jsonData<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span> <span class="token comment">//先格式化再写入，这里的缩进采用tab</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转json失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"output.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"写入文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

        <span class="token keyword">return</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="json_1355">
     </a>
     json编解码
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Name <span class="token builtin">string</span> <span class="token string">`json:name`</span>

    Age  <span class="token builtin">int</span>    <span class="token string">`json:age`</span>

<span class="token punctuation">}</span>
<span class="token comment">// json编解码</span>

<span class="token keyword">func</span> <span class="token function">jsonEncoderDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    user <span class="token operator">:=</span> person<span class="token punctuation">{<!-- --></span>

        Name<span class="token punctuation">:</span> <span class="token string">"wangwu"</span><span class="token punctuation">,</span>

        Age<span class="token punctuation">:</span>  <span class="token number">16</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"test.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">06666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  

    <span class="token comment">//编码json</span>

    encoder <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewEncoder</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

    encoder<span class="token punctuation">.</span><span class="token function">SetIndent</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span> <span class="token comment">//格式添加tab</span>

  

    err <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转json失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">//解码</span>

    <span class="token keyword">var</span> newUser person

    file<span class="token punctuation">,</span> err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"test.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDONLY<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    decoder <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">NewDecoder</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

    err <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>newUser<span class="token punctuation">)</span> <span class="token comment">//将加载的file文件json数据解析到newUser中</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转换失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Name: %s, Age: %d\n"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>

  

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="json_1430">
     </a>
     json转结构体
    </h4>
    <pre><code class="prism language-go">
<span class="token keyword">type</span> person2 <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

    Name     <span class="token builtin">string</span> <span class="token string">`json:name`</span>

    Age      <span class="token builtin">int</span>    <span class="token string">`json:age`</span>

    Location <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

        City  <span class="token builtin">string</span> <span class="token string">`json:city`</span>

        Other <span class="token builtin">string</span> <span class="token string">`json:other`</span>

    <span class="token punctuation">}</span> <span class="token string">`json:location`</span>

<span class="token punctuation">}</span>
<span class="token comment">// 使用Unmarshal读取到的json文本数据解析到struct中</span>

<span class="token keyword">func</span> <span class="token function">jsonTostruct_Unmarshal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"test2.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"读取失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> user2 person2

    <span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"json转struct失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转换成功："</span><span class="token punctuation">,</span> user2<span class="token punctuation">.</span>Location<span class="token punctuation">.</span>City<span class="token punctuation">)</span> <span class="token comment">//验证一下即可</span>

  

    <span class="token comment">//结构体格式化json（MarshalIndent）</span>

    jsonData<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>user2<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span> <span class="token comment">//记得给制表符</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"struct转json失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//验证是否转换成功</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="jsonmap_1498">
     </a>
     json转map
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// json文本数据转map</span>

<span class="token keyword">func</span> <span class="token function">jsonTomap_Unmarshal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"test2.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"读取失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> user2 <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token comment">//同理上一次转struct一样，这里是转为map而已</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转换失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"验证是否转成功："</span><span class="token punctuation">,</span> user2<span class="token punctuation">[</span><span class="token string">"Location"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  

    <span class="token comment">//map格式化json</span>

    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>user2<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转换失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">//验证是否转回来成功</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="jsonstring_1556">
     </a>
     json转string
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// 直接从json文件转json字符串即可，</span>

<span class="token comment">// 不用其他什么自己写一个结构体啥的，</span>

<span class="token comment">// 如果贪图快就直接转字符串</span>

<span class="token keyword">func</span> <span class="token function">jsonTostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span><span class="token string">"test2.json"</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    res<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"读取文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> strjson <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token operator">&amp;</span>strjson<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"解析失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"查看是否解析成功（还未格式化）："</span><span class="token punctuation">,</span> strjson<span class="token punctuation">)</span> <span class="token comment">//这里还没格式化</span>

  

    <span class="token comment">//接下来进行格式化</span>

    res<span class="token punctuation">,</span> err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>strjson<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"格式化失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="nmapjson_1613">
     </a>
     练习：nmap扫描结果导出json格式
    </h4>
    <p>
     需求：
     <br/>
     通过读取json配置文件，配置文件可以控制变量传到nmap扫描，扫描结果以json格式导出
    </p>
    <pre><code class="prism language-go"><span class="token punctuation">{<!-- --></span>

    <span class="token string">"ip_addresses"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token string">"192.168.1.1"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token string">"port_range"</span><span class="token punctuation">:</span> <span class="token string">"1-1024"</span><span class="token punctuation">,</span>

    <span class="token string">"timeout"</span><span class="token punctuation">:</span> <span class="token number">5</span>

   <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <p>
     细节分块：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        nmapScan函数
       </strong>
       ：使用nmap扫描return结果
       <br/>
       通过传参形式，将最大延迟时间和端口范围给到函数内部namp进行扫描
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5e2479c284d37a539777553b28aeea80.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        getConfig函数
       </strong>
       ：这没啥好讲，我单独拿出来只是为了代码容易读一点，就是读取配置文件返回一个map类型数据
      </p>
     </li>
     <li>
      <p>
       <strong>
        startScan函数
       </strong>
       ：这里有一个之前没学过的知识点，
       <code>
        断言
       </code>
       ,用于从
       <code>
        interface{}
       </code>
       类型的值中
       <strong>
        提取其具体类型
       </strong>
       ，比如：
       <code>
        value, ok := interfaceValue.(具体类型)
       </code>
       <br/>
       这样就是强制的将你interface不指定的类型变量强制指定一个类型使用(非常好用)
       <br/>
       还有一个细节就是在json文件中读取出来的数字默认为float64，他直接给了最大的浮点数范围了，怕你不够用，所以我这里进行了类型转换
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8a78d1e5471f1911962d40cd587b5470.png">
        <br/>
        最后一个细节就是：return的
        <code>
         *nmap.NmapRun
        </code>
        是一个切片，因为我们扫描的ip可能是多个的，不然就是只返回最后扫描的那个ip了。
       </img>
      </p>
     </li>
     <li>
      <p>
       <strong>
        scanResultOutputJson函数
       </strong>
       ：
       <br/>
       这里我是使用结构体，根据json输出的字段定义了一下
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0953d08ed8383cd8ecab77bfc5ec704a.png"/>
       <br/>
       接收的result也是nmap刚刚讲的扫描的多个结果，同时我用时间戳作为文件名前缀以防多次不同扫描结果冲突或者覆盖，其他没啥问题了就正常写入json文件即可。
      </p>
     </li>
    </ul>
    <hr/>
    <p>
     先看运行截图，后面放源代码
     <br/>
     (ps:两张截图之间没有联系)
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/72deccfd4afdf254ea58e794708d15ee.png"/>
     <br/>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c8ddf7757e748320af54a9719473b65f.png"/>
     <br/>
     示例代码：
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

  

<span class="token keyword">import</span> <span class="token punctuation">(</span>

    <span class="token string">"encoding/json"</span>

    <span class="token string">"fmt"</span>

    <span class="token string">"io"</span>

    <span class="token string">"io/ioutil"</span>

    <span class="token string">"log"</span>

    <span class="token string">"os"</span>

    <span class="token string">"os/exec"</span>

    <span class="token string">"strconv"</span>

    <span class="token string">"time"</span>

  

    <span class="token string">"github.com/lair-framework/go-nmap"</span>

<span class="token punctuation">)</span>


  

<span class="token comment">// 将json文件存储扫描目标，加载进来作为，进行nmap扫描结果输出output到json文件中</span>

  

<span class="token comment">// 使用nmap扫描return结果</span>

<span class="token keyword">func</span> <span class="token function">nmapScan</span><span class="token punctuation">(</span>target <span class="token builtin">string</span><span class="token punctuation">,</span> port_range <span class="token builtin">string</span><span class="token punctuation">,</span> timeout <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun<span class="token punctuation">,</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  

    <span class="token comment">// 执行Nmap扫描</span>

    <span class="token comment">// -sV:服务探测，-T4:扫描速度</span>

    <span class="token comment">//--max-rtt-timeout控制每一个端口最大超时时间</span>

    cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">"nmap"</span><span class="token punctuation">,</span> <span class="token string">"-sV"</span><span class="token punctuation">,</span> <span class="token string">"-T4"</span><span class="token punctuation">,</span> <span class="token string">"--max-rtt-timeout"</span><span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"-p"</span><span class="token punctuation">,</span> port_range<span class="token punctuation">,</span> <span class="token string">"-oX"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span>

    output<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">CombinedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Nmap扫描失败: %v\n输出: %s"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">// 解析Nmap输出</span>

    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> nmap<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"解析失败: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

  

    <span class="token comment">// 打印结果</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> host <span class="token operator">:=</span> <span class="token keyword">range</span> result<span class="token punctuation">.</span>Hosts <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"主机: %s\n"</span><span class="token punctuation">,</span> host<span class="token punctuation">.</span>Addresses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Addr<span class="token punctuation">)</span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> host<span class="token punctuation">.</span>Ports <span class="token punctuation">{<!-- --></span>

            fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">" 端口 %d/%s: %s %s\n"</span><span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>PortId<span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>Protocol<span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>

                port<span class="token punctuation">.</span>Service<span class="token punctuation">.</span>Product<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

  

<span class="token comment">// 拿到配置数据</span>

<span class="token keyword">func</span> <span class="token function">getConfig</span><span class="token punctuation">(</span>configFile <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token punctuation">{<!-- --></span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>configFile<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDONLY<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

  

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">defer</span> file<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"读取配置文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> res <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"转map失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token comment">// fmt.Println(res["ip_addresses"])</span>

    <span class="token keyword">return</span> res

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">startScan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun<span class="token punctuation">,</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    config <span class="token operator">:=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token string">"config.json"</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun

    <span class="token keyword">var</span> r <span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun

    <span class="token keyword">var</span> scanTime time<span class="token punctuation">.</span>Time

    <span class="token comment">//断言，直接强制给定类型</span>

    <span class="token keyword">if</span> ipList<span class="token punctuation">,</span> ok <span class="token operator">:=</span> config<span class="token punctuation">[</span><span class="token string">"ip_addresses"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> host <span class="token operator">:=</span> <span class="token keyword">range</span> ipList <span class="token punctuation">{<!-- --></span>

            timeoutFloat<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> config<span class="token punctuation">[</span><span class="token string">"timeout"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token comment">//在json读取出来的是float64类型</span>

            r<span class="token punctuation">,</span> scanTime <span class="token operator">=</span> <span class="token function">nmapScan</span><span class="token punctuation">(</span>host<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span> config<span class="token punctuation">[</span><span class="token string">"port_range"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span>timeoutFloat<span class="token punctuation">)</span><span class="token punctuation">)</span>

            result <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> r<span class="token punctuation">)</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"读取失败，ip_addresses应该为列表类型"</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">,</span> scanTime

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">scanResultOutputJson</span><span class="token punctuation">(</span>result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>nmap<span class="token punctuation">.</span>NmapRun<span class="token punctuation">,</span> scanTime time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">type</span> res_struct <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>

        Id            <span class="token builtin">int</span>    <span class="token string">`json:id`</span>

        Ip_address    <span class="token builtin">string</span> <span class="token string">`json:ip_address`</span>

        Port          <span class="token builtin">int</span>    <span class="token string">`json:port`</span>

        Vulnerability <span class="token builtin">string</span> <span class="token string">`json:vulnerability`</span>

        Severity      <span class="token builtin">string</span> <span class="token string">`json:severity`</span>

        Timestamp     <span class="token builtin">string</span> <span class="token string">`json:timestamp`</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> ress <span class="token punctuation">[</span><span class="token punctuation">]</span>res_struct        <span class="token comment">//存储数据，最终要写入json文件中</span>

    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> res <span class="token operator">:=</span> <span class="token keyword">range</span> result <span class="token punctuation">{<!-- --></span> <span class="token comment">//遍历所有扫描结果</span>

        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> host <span class="token operator">:=</span> <span class="token keyword">range</span> res<span class="token punctuation">.</span>Hosts <span class="token punctuation">{<!-- --></span> <span class="token comment">//遍历扫描完成的结果数据</span>

            <span class="token keyword">for</span> index<span class="token punctuation">,</span> port <span class="token operator">:=</span> <span class="token keyword">range</span> host<span class="token punctuation">.</span>Ports <span class="token punctuation">{<!-- --></span>

                ress <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>ress<span class="token punctuation">,</span> res_struct<span class="token punctuation">{<!-- --></span>

                    Id<span class="token punctuation">:</span>            index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>

                    Ip_address<span class="token punctuation">:</span>    host<span class="token punctuation">.</span>Addresses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Addr<span class="token punctuation">,</span>

                    Port<span class="token punctuation">:</span>          port<span class="token punctuation">.</span>PortId<span class="token punctuation">,</span>

                    Vulnerability<span class="token punctuation">:</span> port<span class="token punctuation">.</span>Protocol<span class="token punctuation">,</span>

                    Severity<span class="token punctuation">:</span>      <span class="token string">"high"</span><span class="token punctuation">,</span>

                    Timestamp<span class="token punctuation">:</span>     scanTime<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006年01月02日"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

  

    outputdata<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">MarshalIndent</span><span class="token punctuation">(</span>ress<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"格式化失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//输出文件名通过时间戳来表示就不会出错了</span>

    fileName <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%d_scan_result.json"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//意思是清空该文件的内容先，其实没啥用这里，用来当一个知识点吧</span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_CREATE<span class="token operator">|</span>os<span class="token punctuation">.</span>O_RDWR<span class="token operator">|</span>os<span class="token punctuation">.</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"打开文件失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>outputdata<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>

        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"导出json文件失败:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

  

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//程序运行</span>
    <span class="token function">scanResultOutputJson</span><span class="token punctuation">(</span><span class="token function">startScan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36303532313033362f:61727469636c652f64657461696c732f313436313039303334" class_="artid" style="display:none">
 </p>
</div>


