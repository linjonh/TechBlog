---
layout: post
title: "Spring-IoC-详解"
date: 2025-03-06 11:01:05 +0800
description: "IoC即控制反转（Inversion of Control），也被称为依赖倒置原则，是设计模式六大原则之一。其核心思想是程序应依赖抽象接口，而非具体实现，从而降低代码间的耦合度。依赖注入（DI）：不通过类内部直接创建依赖对象，而是将外部创建好的依赖对象通过构造函数或参数传递给类使用。依赖查找：受控对象通过容器 API 查找所需资源和协作对象。谁控制谁，控制什么：传统编程中，对象由程序主动创建；而 IoC 中，对象由容器控制创建，容器负责管理外部资源获取。为何反转，哪些方面反转。"
keywords: "Spring IoC 详解"
categories: ['未分类']
tags: ['Spring', 'Rpc', 'Java']
artid: "146061211"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146061211
    alt: "Spring-IoC-详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146061211
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146061211
cover: https://bing.ee123.net/img/rand?artid=146061211
image: https://bing.ee123.net/img/rand?artid=146061211
img: https://bing.ee123.net/img/rand?artid=146061211
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring IoC 详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="IoC__0">
     </a>
     IoC 简介
    </h3>
    <h4>
     <a id="IoC__2">
     </a>
     IoC 是什么
    </h4>
    <p>
     <strong>
      IoC
     </strong>
     即
     <strong>
      控制反转
     </strong>
     （Inversion of Control），也被称为
     <strong>
      依赖倒置原则
     </strong>
     ，是设计模式六大原则之一。其核心思想是程序应依赖抽象接口，而非具体实现，从而降低代码间的耦合度。
    </p>
    <p>
     IoC 的实现方式包括两种：
    </p>
    <ul>
     <li>
      <strong>
       依赖注入（DI）
      </strong>
      ：不通过类内部直接创建依赖对象，而是将外部创建好的依赖对象通过构造函数或参数传递给类使用。
     </li>
     <li>
      <strong>
       依赖查找
      </strong>
      ：受控对象通过容器 API 查找所需资源和协作对象。
     </li>
    </ul>
    <p>
     理解 IoC 的关键在于两点：
    </p>
    <ol>
     <li>
      <strong>
       谁控制谁，控制什么
      </strong>
      ：传统编程中，对象由程序主动创建；而 IoC 中，对象由容器控制创建，容器负责管理外部资源获取。
     </li>
     <li>
      <strong>
       为何反转，哪些方面反转
      </strong>
      ：传统方式是程序主动获取依赖对象（正转），而 IoC 中容器负责创建并注入依赖对象（反转），依赖对象的获取方式发生了反转。
     </li>
    </ol>
    <h4>
     <a id="IoC__15">
     </a>
     IoC 的作用
    </h4>
    <p>
     IoC 是一种编程思想，而非具体技术，作为面向对象编程的重要法则，它指导设计松耦合的程序。传统方式中，类内部主动创建依赖对象导致高耦合，难以测试；IoC 将对象的创建和查找交由容器管理，使对象间松散耦合，便于测试和复用，提升程序体系结构的灵活性。IoC 体现了“主从换位”思想，应用程序从主动获取资源变为被动接受容器注入，符合“好莱坞法则”：别找我们，我们找你。
    </p>
    <h4>
     <a id="IoC__DI_19">
     </a>
     IoC 与 DI
    </h4>
    <p>
     IoC 和依赖注入（DI）是从不同角度描述同一概念。IoC 强调控制权的反转，而 DI 更明确地指出依赖对象由容器注入。2004 年，Martin Fowler 提出“依赖注入”这一术语，以更清晰地表达这一过程。
    </p>
    <h4>
     <a id="IoC__23">
     </a>
     IoC 容器
    </h4>
    <p>
     IoC 容器是具备依赖注入功能的容器，负责实例化、定位、配置应用程序中的对象并管理其依赖关系。在 Spring 中，
     <code>
      BeanFactory
     </code>
     是 IoC 容器的基础实现，通过配置文件（如 XML、注解或 Java 代码）定义对象的元数据，容器据此完成对象的组装。
    </p>
    <h4>
     <a id="Bean_27">
     </a>
     Bean
    </h4>
    <p>
     由 IoC 容器管理的对象称为 Bean。Bean 是容器初始化、装配和管理的对象，其定义通过配置元数据（如
     <code>
      BeanDefinition
     </code>
     ）指定，描述如何实例化和组装。
    </p>
    <h4>
     <a id="Spring_IoC_31">
     </a>
     Spring IoC
    </h4>
    <p>
     Spring IoC 容器通过构造函数参数、工厂方法参数或属性设置定义 Bean 的依赖关系，创建时由容器注入这些依赖。这一过程是对象主动控制依赖的反转，因此称为控制反转。核心包
     <code>
      org.springframework.beans
     </code>
     和
     <code>
      org.springframework.context
     </code>
     提供了 IoC 容器的基础支持。
    </p>
    <h3>
     <a id="IoC__35">
     </a>
     IoC 容器
    </h3>
    <p>
     Spring 提供两种 IoC 容器：
    </p>
    <ul>
     <li>
      <strong>
       BeanFactory
      </strong>
      ：基础 IoC 容器，提供配置框架和基本功能。
     </li>
     <li>
      <strong>
       ApplicationContext
      </strong>
      ：
      <code>
       BeanFactory
      </code>
      的子接口，扩展了国际化、资源访问、事件机制等功能，适用于大多数场景。
     </li>
    </ul>
    <p>
     实际开发中，推荐使用
     <code>
      ApplicationContext
     </code>
     ，因其功能更丰富。
     <code>
      ApplicationContext
     </code>
     接口负责实例化、配置和组装 Bean，通过配置元数据（XML、注解或 Java 代码）获取指令。
    </p>
    <p>
     常见实现包括：
    </p>
    <ul>
     <li>
      <code>
       ClassPathXmlApplicationContext
      </code>
      ：从类路径加载配置。
     </li>
     <li>
      <code>
       FileSystemXmlApplicationContext
      </code>
      ：从文件系统加载配置。
     </li>
    </ul>
    <p>
     使用 IoC 容器的步骤包括：
    </p>
    <ol>
     <li>
      <strong>
       配置元数据
      </strong>
      ：定义容器如何初始化和管理 Bean。
     </li>
     <li>
      <strong>
       实例化容器
      </strong>
      ：容器解析元数据，生成
      <code>
       BeanDefinition
      </code>
      并完成 Bean 的实例化与组装。
     </li>
     <li>
      <strong>
       使用容器
      </strong>
      ：客户端通过容器获取所需 Bean。
     </li>
    </ol>
    <h4>
     <a id="_53">
     </a>
     配置元数据
    </h4>
    <p>
     配置元数据描述 Bean 的属性和依赖，可通过以下方式实现：
    </p>
    <ul>
     <li>
      <strong>
       XML 配置
      </strong>
      ：传统方式，使用
      <code>
       &lt;bean&gt;
      </code>
      元素定义。
     </li>
     <li>
      <strong>
       注解配置
      </strong>
      ：Spring 2.5 引入，通过注解简化配置。
     </li>
     <li>
      <strong>
       Java 配置
      </strong>
      ：Spring 3.0 引入，使用 Java 代码定义。
     </li>
    </ul>
    <h4>
     <a id="_60">
     </a>
     实例化容器
    </h4>
    <p>
     通过指定资源路径（如 XML 文件）实例化
     <code>
      ApplicationContext
     </code>
     ，例如：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"services.xml"</span><span class="token punctuation">,</span> <span class="token string">"daos.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     支持通过多个 XML 文件分层定义 Bean，使用
     <code>
      &lt;import/&gt;
     </code>
     元素组合：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>services.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h4>
     <a id="_75">
     </a>
     使用容器
    </h4>
    <p>
     通过
     <code>
      getBean
     </code>
     方法获取 Bean 实例：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"services.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PetStoreService</span> service <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"petStore"</span><span class="token punctuation">,</span> <span class="token class-name">PetStoreService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="IoC__83">
     </a>
     IoC 配置元数据
    </h3>
    <h4>
     <a id="XML__85">
     </a>
     XML 配置
    </h4>
    <p>
     XML 配置是 Spring 的传统方式，基本结构如下：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>alias</span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean3<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bean2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>resource.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ul>
     <li>
      <code>
       &lt;bean&gt;
      </code>
      定义 Bean，
      <code>
       id
      </code>
      为唯一标识，
      <code>
       class
      </code>
      指定类名。
     </li>
     <li>
      <code>
       &lt;alias&gt;
      </code>
      设置别名。
     </li>
     <li>
      <code>
       &lt;import&gt;
      </code>
      导入其他配置文件。
     </li>
    </ul>
    <p>
     实例化方式：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">"services.xml"</span><span class="token punctuation">,</span> <span class="token string">"daos.xml"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_104">
     </a>
     注解配置
    </h4>
    <p>
     Spring 2.5 引入注解配置，需在 XML 中启用：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     常用注解包括：
    </p>
    <ul>
     <li>
      <strong>
       <code>
        @Required
       </code>
      </strong>
      ：修饰 setter 方法，确保属性在 XML 中配置。
     </li>
     <li>
      <strong>
       <code>
        @Autowired
       </code>
      </strong>
      ：修饰属性、setter 或构造函数，按类型自动注入。
     </li>
     <li>
      <strong>
       <code>
        @Qualifier
       </code>
      </strong>
      ：与
      <code>
       @Autowired
      </code>
      配合，按名称指定 Bean。
     </li>
     <li>
      <strong>
       <code>
        @Resource
       </code>
      </strong>
      ：按名称注入，支持 JSP 250 标准。
     </li>
     <li>
      <strong>
       <code>
        @PostConstruct
       </code>
       和
       <code>
        @PreDestroy
       </code>
      </strong>
      ：定义生命周期方法。
     </li>
     <li>
      <strong>
       <code>
        @Inject
       </code>
      </strong>
      ：Spring 3.0 支持的 JSR 330 注解，功能类似
      <code>
       @Autowired
      </code>
      。
     </li>
    </ul>
    <h4>
     <a id="Java__119">
     </a>
     Java 配置
    </h4>
    <p>
     Spring 3.0 引入 Java 配置，使用
     <code>
      @Configuration
     </code>
     和
     <code>
      @Bean
     </code>
     注解：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MyService</span> <span class="token function">myService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <code>
       @Configuration
      </code>
      标记配置类。
     </li>
     <li>
      <code>
       @Bean
      </code>
      定义 Bean，等价于 XML 中的
      <code>
       &lt;bean&gt;
      </code>
      。
     </li>
    </ul>
    <p>
     实例化：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AppConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_139">
     </a>
     依赖解决过程
    </h3>
    <p>
     容器解析 Bean 依赖的步骤：
    </p>
    <ol>
     <li>
      使用配置元数据创建和初始化
      <code>
       ApplicationContext
      </code>
      。
     </li>
     <li>
      为每个 Bean 提供依赖（属性或构造函数参数）。
     </li>
     <li>
      将值或引用转换为实际类型。
     </li>
    </ol>
    <p>
     Spring 在容器加载时验证配置，延迟设置属性以避免循环依赖问题。单例 Bean 默认预实例化，可通过配置改为延迟初始化。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36343433323130362f:61727469636c652f64657461696c732f313436303631323131" class_="artid" style="display:none">
 </p>
</div>


