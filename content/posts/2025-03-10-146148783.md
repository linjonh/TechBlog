---
layout: post
title: "WPF预览并打印FlowDocument"
date: 2025-03-10 11:28:02 +0800
description: "21             <Button Content=\"加载\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\" Width=\"88\" Height=\"28\" Click=\"Button_Click\"></Button>在前面的文章中，介绍过通过FixedDocument进行预览并打印。但是有时候我们可能使用的是。"
keywords: "WPF预览并打印FlowDocument"
categories: ['Wpf']
tags: ['Wpf']
artid: "146148783"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146148783
    alt: "WPF预览并打印FlowDocument"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146148783
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146148783
cover: https://bing.ee123.net/img/rand?artid=146148783
image: https://bing.ee123.net/img/rand?artid=146148783
img: https://bing.ee123.net/img/rand?artid=146148783
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     WPF预览并打印FlowDocument
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     在前面的文章中，介绍过通过FixedDocument进行预览并打印。
    </p>
    <p>
     <a href="https://www.cnblogs.com/zhaotianff/p/18254574" rel="nofollow" title="WPF使用XAML实现报表的一种思路（支持外部加载） - zhaotianff - 博客园">
      WPF使用XAML实现报表的一种思路（支持外部加载） - zhaotianff - 博客园
     </a>
    </p>
    <p>
    </p>
    <p>
     但是有时候我们可能使用的是
     <strong>
      FlowDocument
     </strong>
     ，例如在
     <strong>
      RichTextBox
     </strong>
     中时。
    </p>
    <p>
     如何对
     <strong>
      FlowDocument
     </strong>
     进行预览并打印呢。
    </p>
    <p>
    </p>
    <p>
     可以将
     <strong>
      FlowDocument
     </strong>
     转换成
     <strong>
      XpsDocument
     </strong>
     ，然后再使用
     <strong>
      DocumentViewer
     </strong>
     进行预览并打印。
    </p>
    <p>
    </p>
    <p>
     <strong>
      注意：需要引用 ReachFramework程序集
     </strong>
    </p>
    <p>
    </p>
    <p class="img-center">
     <img alt="" height="210" src="https://i-blog.csdnimg.cn/img_convert/4dca6834951774008075c9f786f3a486.png" width="647"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      例如我们有如下 的FlowDocument
     </strong>
    </p>
    <p>
    </p>
    <pre> 1 &lt;FlowDocument xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 2               xmlns:local="clr-namespace:FlowDocumentPreviewAndPrint"
 3               ColumnWidth="400" FontSize="14" FontFamily="Georgia"&gt;
 4     &lt;Paragraph&gt;
 5         &lt;Image Source="jk.png"&gt;&lt;/Image&gt;
 6     &lt;/Paragraph&gt;
 7     &lt;Paragraph&gt;
 8         &lt;Run&gt;Hello World&lt;/Run&gt;
 9     &lt;/Paragraph&gt;
10 &lt;/FlowDocument&gt;</pre>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      然后在主窗口中增加一个DocumentViewer
     </strong>
    </p>
    <p>
    </p>
    <pre> 1 &lt;wd:Window x:Class="FlowDocumentPreviewAndPrint.MainWindow"
 2         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 3         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 4         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
 5         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
 6         xmlns:local="clr-namespace:FlowDocumentPreviewAndPrint"
 7         xmlns:wd="https://github.com/WPFDevelopersOrg/WPFDevelopers"
 8         mc:Ignorable="d"
 9         Title="MainWindow" Height="450" Width="800"&gt;
10     &lt;Grid&gt;
11         &lt;Grid.RowDefinitions&gt;
12             &lt;RowDefinition/&gt;
13             &lt;RowDefinition Height="40"/&gt;
14         &lt;/Grid.RowDefinitions&gt;
15 
16         &lt;DocumentViewer Name="docv"&gt;
17 
18         &lt;/DocumentViewer&gt;
19 
20         &lt;Grid Grid.Row="1"&gt;
21             &lt;Button Content="加载" HorizontalAlignment="Center" VerticalAlignment="Center" Width="88" Height="28" Click="Button_Click"&gt;&lt;/Button&gt;
22         &lt;/Grid&gt;
23     &lt;/Grid&gt;
24 &lt;/wd:Window&gt;</pre>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      当点击打印时，我们将FlowDocument转换成XpsDocument，并设置到DocumentViewer的Document中去。
     </strong>
    </p>
    <p>
    </p>
    <pre> 1 private void Button_Click(object sender, RoutedEventArgs e)
 2 {
 3     try
 4     {
 5         FlowDocument flowDocument = (FlowDocument)Application.LoadComponent(new Uri("FlowDocument1.xaml", UriKind.RelativeOrAbsolute));
 6 
 7         string temp = System.IO.Path.GetTempFileName();

 8         if (File.Exists(temp) == true)
 9             File.Delete(temp);
10 
11         XpsDocument xpsDoc = new XpsDocument(temp, FileAccess.ReadWrite);
12 
13         XpsDocumentWriter xpsWriter = XpsDocument.CreateXpsDocumentWriter(xpsDoc);
14 
15         xpsWriter.Write((flowDocument as IDocumentPaginatorSource).DocumentPaginator);
16 
17         docv.Document = xpsDoc.GetFixedDocumentSequence();
18 
19         xpsDoc.Close();
20     }
21     catch (Exception ex)
22     {
23         MessageBox.Show(ex.Message);
24     }
25 }
</pre>
    <p>
    </p>
    <p>
    </p>
    <p>
     <strong>
      示例代码
     </strong>
    </p>
    <p>
     <a href="https://files-cdn.cnblogs.com/files/zhaotianff/FlowDocumentPreviewAndPrint.zip?t=1741335948&amp;download=true" rel="nofollow" title="下载">
      下载
     </a>
    </p>
    <p>
    </p>
    <p>
     <strong>
      参考资料
     </strong>
    </p>
    <p>
     <a href="https://bryanwilhite.github.io/the-funky-knowledge-base/entry/kb2076072263/" rel="nofollow" title="WPF: “Converting a WPF FlowDocument to an XPS FixedDocument”; Derek Smythe - the funky knowledge base">
      WPF: “Converting a WPF FlowDocument to an XPS FixedDocument”; Derek Smythe - the funky knowledge base
     </a>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f7a68616f7469616e66662f:61727469636c652f64657461696c732f313436313438373833" class_="artid" style="display:none">
 </p>
</div>


