---
layout: post
title: "OrioleDB-新一代PostgreSQL存储引擎"
date: 2025-03-16 21:00:00 +0800
description: "OrioleDB 旨在解决 PostgreSQL 默认 HEAP 表在 OLTP（在线事务处理）场景中的一些性能瓶颈，并引入现代数据库存储技术的设计理念，提供更高的并发性能、更低的延迟，并减少存储开销。"
keywords: "OrioleDB: 新一代PostgreSQL存储引擎"
categories: ['Postgresql']
tags: ['数据库', 'Postgresql']
artid: "146203277"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146203277
    alt: "OrioleDB-新一代PostgreSQL存储引擎"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146203277
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146203277
cover: https://bing.ee123.net/img/rand?artid=146203277
image: https://bing.ee123.net/img/rand?artid=146203277
img: https://bing.ee123.net/img/rand?artid=146203277
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     OrioleDB: 新一代PostgreSQL存储引擎
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     PostgreSQL 12 引入了可插拔式的
     <a href="https://www.postgresql.org/docs/current/tableam.html" rel="nofollow">
      表存储方法接口
     </a>
     ，允许为不同的表选择不同的存储机制，例如用于 OLTP 操作的堆表（HEAP、默认）、用于 OLAP 操作的列式表（Citus），以及用于超快速搜索处理的内存表。
    </p>
    <blockquote>
     <p>
      PostgreSQL 这一特性类似于 MySQL 的插件式存储引擎，例如 InnoDB、MyISAM。
     </p>
    </blockquote>
    <p>
     今天给大家介绍一个云原生的 PostgreSQL 存储引擎：
     <a href="https://www.orioledb.com/" rel="nofollow">
      OrioleDB
     </a>
     。
    </p>
    <h3>
     <a id="_6">
     </a>
     功能特性
    </h3>
    <p>
     OrioleDB 旨在解决 PostgreSQL 默认 HEAP 表在 OLTP（在线事务处理）场景中的一些性能瓶颈，并引入现代数据库存储技术的设计理念，提供更高的并发性能、更低的延迟，并减少存储开销。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7fbd5d64599a4107a8ec3832b38c2dba.png">
      <br/>
      OrioleDB 以扩展插件形式提供，基于 PostgreSQL 协议发布，提供的核心特性包括：
     </img>
    </p>
    <ul>
     <li>
      基于现代存储技术（SSD、NVRAM）设计，优化多核 CPU 和 NUMA 架构下的资源分配，提升吞吐量。
     </li>
     <li>
      基于 Undo Log 的 MVCC，将旧版本数据存储在独立的 Undo Log 而不是主表中。事务回滚或旧版本清理时直接操作 Undo Log，避免主表数据膨胀。同时还支持 64 位事务 ID，避免了回卷问题。
     </li>
     <li>
      聚簇索引，默认使用聚簇索引（类似 MySQL/InnoDB），数据按主键顺序存储，减少随机 I/O，提升范围查询性能。
     </li>
     <li>
      压缩存储，支持页级数据压缩，降低存储成本。
     </li>
     <li>
      分布式支持，Copy-on-Write 检查点提供结构一致的数据快照，兼容 SSD 特性，并支持紧凑的行级 WAL 记录。基于行级 WAL 日志和 Raft 共识算法，支持并行回放和 Active-Active 多主架构，适合分布式部署。
     </li>
    </ul>
    <h3>
     <a id="_19">
     </a>
     使用示例
    </h3>
    <p>
     目前，OrioleDB 还处于 Beta 阶段，最简单的使用方法就是利用 Docker：
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> orioledb <span class="token parameter variable">-p</span> <span class="token number">5432</span>:5432 orioledb/orioledb
</code></pre>
    <p>
     然后安装扩展插件并创建数据表：
    </p>
    <pre><code class="prism language-sql"><span class="token comment">-- 创建扩展插件</span>
<span class="token keyword">CREATE</span> EXTENSION orioledb<span class="token punctuation">;</span>

<span class="token comment">-- 创建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> blog_post
<span class="token punctuation">(</span>
    id int8 <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    title <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    body <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    author <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    published_at timestamptz  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
    views <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">USING</span> orioledb<span class="token punctuation">;</span> <span class="token comment">-- 使用OrioleDB存储引擎</span>

<span class="token comment">-- 创建索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> blog_post_published_at <span class="token keyword">ON</span> blog_post<span class="token punctuation">(</span>published_at<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     OrioleDB 使用聚簇索引，因此主键的选择对于性能至关重要；如果没有指定主键字段，数据库会基于 ctid 字段创建一个隐藏的替代主键。
    </p>
    <p>
     接下来就可以执行一些 DML 操作：
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> blog_post <span class="token punctuation">(</span>id<span class="token punctuation">,</span> title<span class="token punctuation">,</span> body<span class="token punctuation">,</span> author<span class="token punctuation">,</span> views<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Hello, World!'</span><span class="token punctuation">,</span> <span class="token string">'This is my first blog post.'</span><span class="token punctuation">,</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> blog_post <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> published_at <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     更详细的使用介绍和注意事项可以参考以下官方文档：
    </p>
    <p>
     https://www.orioledb.com/docs
    </p>
    <h3>
     <a id="_64">
     </a>
     性能比较
    </h3>
    <p>
     以下是一些 OrioleDB 和默认 HEAP 存储引擎的性能比较：
    </p>
    <p>
     测试一：只读测试显示 OrioleDB 存储引擎的性能是 PostgreSQL 默认引擎的 4 倍。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ca67d536945640a495f8d267982bc4eb.png"/>
    </p>
    <p>
     测试二：读写测试显示 OrioleDB 存储引擎的性能是 PostgreSQL 默认引擎的 4.5 倍。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/0b40e29caa4144ecaa7a2fd612c10b98.png"/>
    </p>
    <p>
     测试三：OrioleDB 存储引擎的磁盘读取（IOPS）是 PostgreSQL 默认引擎的 1/6。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ea226f74bdf64289bdb36e565ea5d52a.png"/>
    </p>
    <p>
     测试四：OrioleDB 存储引擎的磁盘写入比 PostgreSQL 默认引擎大幅减少。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a9c985d3c12147028baf49323b351881.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f686f727365732f:61727469636c652f64657461696c732f313436323033323737" class_="artid" style="display:none">
 </p>
</div>


