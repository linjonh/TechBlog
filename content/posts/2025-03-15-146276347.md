---
arturl_encode: "68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343638313739392f:61727469636c652f64657461696c732f313436323736333437"
layout: post
title: "Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾CentOS-7ç‰ˆ-Dockeréƒ¨ç½²çš„nginx"
date: 2025-03-15 12:21:00 +08:00
description: "dockerå®¹å™¨éƒ¨ç½²çš„Nginxä½¿ç”¨certbotå®ç°SSLè‡ªåŠ¨ç»­æœŸ"
keywords: "Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼ˆCentOS 7ç‰ˆ + Dockeréƒ¨ç½²çš„nginxï¼‰"
categories: ['æœªåˆ†ç±»']
tags: ['Ssl', 'Docker', 'Centos']
artid: "146276347"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146276347
    alt: "Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾CentOS-7ç‰ˆ-Dockeréƒ¨ç½²çš„nginx"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146276347
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146276347
cover: https://bing.ee123.net/img/rand?artid=146276347
image: https://bing.ee123.net/img/rand?artid=146276347
img: https://bing.ee123.net/img/rand?artid=146276347
---

# Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼ˆCentOS 7ç‰ˆ + Dockeréƒ¨ç½²çš„nginxï¼‰

å‰ç½®å®‰è£…ï¼Œå¯å‚è€ƒ
[Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼ˆCentOS 7 + nginx/apacheï¼‰](https://blog.csdn.net/u014681799/article/details/146276066?sharetype=blogdetail&sharerId=146276066&sharerefer=PC&sharesource=u014681799&spm=1011.2480.3001.8118)

å¦‚æœæ˜¯é€šè¿‡
**Docker**
è¿è¡Œ Nginxï¼Œ
`certbot`
æ— æ³•ç›´æ¥æ£€æµ‹åˆ°æœ¬åœ°çš„ Nginx é…ç½®ã€‚è§£å†³æ–¹æ¡ˆæ˜¯
**ä½¿ç”¨ standalone æ¨¡å¼**
æˆ–
**æŒ‚è½½ Webroot**
æ–¹å¼è·å– SSL è¯ä¹¦ï¼Œå¹¶æ‰‹åŠ¨é…ç½® Nginxã€‚

---

### **æ–¹æ¡ˆ 1ï¼šStandalone æ¨¡å¼ï¼ˆä¸´æ—¶å…³é—­ Nginx è·å–è¯ä¹¦ï¼‰**

å¦‚æœä½ çš„æœåŠ¡å™¨
**ä¸æ”¯æŒ Webroot**
ï¼ˆæˆ– Nginx é…ç½®ä¸æ–¹ä¾¿ä¿®æ”¹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨
**Standalone æ¨¡å¼**
ï¼Œä½†éœ€è¦
**çŸ­æš‚å…³é—­ Nginx**
ã€‚

#### **1. åœæ­¢ Nginx å®¹å™¨**

å…ˆæ‰¾åˆ° Nginx å®¹å™¨ IDï¼š

```bash
docker ps | grep nginx

```

ç„¶ååœæ­¢å®¹å™¨ï¼š

```bash
docker stop <nginx-container-id>

```

#### **2. ç”³è¯· SSL è¯ä¹¦**

è¿è¡Œ Certbotï¼Œä½¿ç”¨
`standalone`
æ¨¡å¼ï¼š

```bash
certbot certonly --standalone -d youdomain.com -d www.youdomain.com

```

> **è¯´æ˜**
> ï¼š
>
> * `certonly`
>   ï¼šåªè·å–è¯ä¹¦ï¼Œä¸ä¿®æ”¹é…ç½®
> * `--standalone`
>   ï¼šä½¿ç”¨ Certbot å†…ç½®çš„ web æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼ˆéœ€è¦ 80 ç«¯å£ï¼‰
> * `-d`
>   æŒ‡å®šåŸŸå

#### **3. å¯åŠ¨ Nginx**

```bash
docker start <nginx-container-id>

```

---

### **æ–¹æ¡ˆ 2ï¼šWebroot æ¨¡å¼ï¼ˆä¸åœæ­¢ Nginxï¼‰**

**é€‚ç”¨äº Nginx å®¹å™¨å¯æŒ‚è½½
`/var/www/html`
æˆ–æœ‰
`root`
ç›®å½•**

#### **1. ç¡®å®š Nginx å®¹å™¨çš„ Webroot è·¯å¾„**

è¿›å…¥å®¹å™¨ï¼š

```bash
docker exec -it <nginx-container-id> sh

```

æŸ¥æ‰¾
`root`
è·¯å¾„ï¼ˆé€šå¸¸æ˜¯
`/usr/share/nginx/html`
ï¼‰ï¼š

```bash
grep -r "root" /etc/nginx/nginx.conf

```

å‡è®¾ Webroot æ˜¯
`/usr/share/nginx/html`
ï¼Œé€€å‡ºå®¹å™¨ã€‚

#### **2. ç”³è¯· SSL è¯ä¹¦**

åœ¨å®¿ä¸»æœºè¿è¡Œï¼š

```bash
certbot certonly --webroot -w /usr/share/nginx/html -d youdomain.com -d www.youdomain.com

```

è¾“å…¥é‚®ç®±åæŒ‰enter
  
åè®®è¾“å…¥YåæŒ‰enter
  
æ˜¯å¦æ¥æ”¶æ¥è‡ªå®˜æ–¹çš„æ–°é—»ç­‰é‚®ä»¶é€šçŸ¥ï¼Œå¯ä»¥é€‰æ‹©Y/Nï¼Œä¸å½±å“ä½¿ç”¨

#### **3. é…ç½® Nginx ä½¿ç”¨ SSL**

ç¼–è¾‘
`nginx.conf`
ï¼ˆåœ¨
`server`
é…ç½®ä¸­æ·»åŠ  SSLï¼‰ï¼š

```nginx
server {
    listen 443 ssl;
    server_name youdomain.com www.youdomain.com;

    ssl_certificate /etc/letsencrypt/live/youdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/youdomain.com/privkey.pem;

    location / {
        root /usr/share/nginx/html;
        index index.html;
    }
}

```

**æ³¨æ„ï¼šå®¹å™¨è¦æŒ‚è½½/etc/letsencryptç›®å½• :roè¡¨ç¤ºåªè¯»**

```
-v /etc/letsencrypt:/etc/letsencrypt:ro

```

ç„¶åé‡å¯ Nginxï¼š

```bash
docker restart <nginx-container-id>

```

---

### **é…ç½® SSL è¯ä¹¦è‡ªåŠ¨ç»­çº¦**

Letâ€™s Encrypt è¯ä¹¦
**90 å¤©**
åè¿‡æœŸï¼Œå› æ­¤éœ€è¦è‡ªåŠ¨ç»­çº¦ã€‚

#### **1. æµ‹è¯•ç»­çº¦**

```bash
certbot renew --dry-run

```

å¦‚æœæ˜¾ç¤º
`Congratulations`
ï¼Œè¯´æ˜ç»­çº¦æ­£å¸¸ã€‚

#### **2. è®¾ç½®è‡ªåŠ¨ç»­çº¦**

æ·»åŠ 
`crontab`
ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥è¯ä¹¦å¹¶é‡å¯ Nginxï¼š

```bash
crontab -e

```

æ·»åŠ ï¼š

```bash
0 2 * * * certbot renew --quiet --deploy-hook "docker restart <nginx-container-id>"

```

> **è§£é‡Š**
> ï¼š
>
> * `0 2 * * *`
>   ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹è¿è¡Œ
> * `certbot renew --quiet`
>   ï¼šé™é»˜ç»­çº¦
> * `delopy-hook`
>   ï¼šåªæœ‰æˆåŠŸç»­æœŸåæ‰æ‰§è¡Œåé¢çš„å‘½ä»¤
> * `docker restart nginx`
>   ï¼šç»­çº¦åé‡å¯ Nginx ä½¿æ–°è¯ä¹¦ç”Ÿæ•ˆ

---

### **éªŒè¯è¯ä¹¦æ˜¯å¦ç”Ÿæ•ˆ**

```bash
certbot certificates
æˆ–è€…
openssl s_client -connect yourdomain.com:443 -servername yourdomain.com | openssl x509 -noout -dates

```

å¦‚æœ
`Not After`
æ—¥æœŸå·²æ›´æ–°ï¼Œè¯´æ˜è¯ä¹¦ç»­çº¦æˆåŠŸï¼âœ…

---

#### **æ€»ç»“**

* **Docker è¿è¡Œ Nginx ä¸èƒ½ç›´æ¥ç”¨
  `certbot --nginx`**
* **æ¨è
  `standalone`
  æ¨¡å¼ï¼ˆéœ€ä¸´æ—¶å…³é—­ Nginxï¼‰**
* **æˆ–è€…
  `webroot`
  æ¨¡å¼ï¼ˆéœ€æ‰‹åŠ¨ä¿®æ”¹ Nginx é…ç½®ï¼‰**
* **è‡ªåŠ¨ç»­çº¦é€šè¿‡
  `cron`
  è®¡åˆ’ä»»åŠ¡å®Œæˆ**

è¿™æ ·ï¼Œä½ çš„
**SSL è¯ä¹¦ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ**
ï¼ğŸš€