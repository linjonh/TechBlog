---
layout: post
title: "Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾CentOS-7ç‰ˆ-Dockeréƒ¨ç½²çš„nginx"
date: 2025-03-15 12:21:00 +0800
description: "dockerå®¹å™¨éƒ¨ç½²çš„Nginxä½¿ç”¨certbotå®ç°SSLè‡ªåŠ¨ç»­æœŸ"
keywords: "Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼ˆCentOS 7ç‰ˆ + Dockeréƒ¨ç½²çš„nginxï¼‰"
categories: ['æœªåˆ†ç±»']
tags: ['Ssl', 'Docker', 'Centos']
artid: "146276347"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146276347
    alt: "Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾CentOS-7ç‰ˆ-Dockeréƒ¨ç½²çš„nginx"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146276347
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146276347
cover: https://bing.ee123.net/img/rand?artid=146276347
image: https://bing.ee123.net/img/rand?artid=146276347
img: https://bing.ee123.net/img/rand?artid=146276347
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼ˆCentOS 7ç‰ˆ + Dockeréƒ¨ç½²çš„nginxï¼‰
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     å‰ç½®å®‰è£…ï¼Œå¯å‚è€ƒ
     <a href="https://blog.csdn.net/u014681799/article/details/146276066?sharetype=blogdetail&amp;sharerId=146276066&amp;sharerefer=PC&amp;sharesource=u014681799&amp;spm=1011.2480.3001.8118">
      Certbotå®ç°SSLå…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼ˆCentOS 7 + nginx/apacheï¼‰
     </a>
    </p>
    <p>
     å¦‚æœæ˜¯é€šè¿‡
     <strong>
      Docker
     </strong>
     è¿è¡Œ Nginxï¼Œ
     <code>
      certbot
     </code>
     æ— æ³•ç›´æ¥æ£€æµ‹åˆ°æœ¬åœ°çš„ Nginx é…ç½®ã€‚è§£å†³æ–¹æ¡ˆæ˜¯
     <strong>
      ä½¿ç”¨ standalone æ¨¡å¼
     </strong>
     æˆ–
     <strong>
      æŒ‚è½½ Webroot
     </strong>
     æ–¹å¼è·å– SSL è¯ä¹¦ï¼Œå¹¶æ‰‹åŠ¨é…ç½® Nginxã€‚
    </p>
    <hr/>
    <h3>
     <a id="_1Standalone__Nginx__7">
     </a>
     <strong>
      æ–¹æ¡ˆ 1ï¼šStandalone æ¨¡å¼ï¼ˆä¸´æ—¶å…³é—­ Nginx è·å–è¯ä¹¦ï¼‰
     </strong>
    </h3>
    <p>
     å¦‚æœä½ çš„æœåŠ¡å™¨
     <strong>
      ä¸æ”¯æŒ Webroot
     </strong>
     ï¼ˆæˆ– Nginx é…ç½®ä¸æ–¹ä¾¿ä¿®æ”¹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨
     <strong>
      Standalone æ¨¡å¼
     </strong>
     ï¼Œä½†éœ€è¦
     <strong>
      çŸ­æš‚å…³é—­ Nginx
     </strong>
     ã€‚
    </p>
    <h4>
     <a id="1__Nginx__10">
     </a>
     <strong>
      1. åœæ­¢ Nginx å®¹å™¨
     </strong>
    </h4>
    <p>
     å…ˆæ‰¾åˆ° Nginx å®¹å™¨ IDï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> nginx
</code></pre>
    <p>
     ç„¶ååœæ­¢å®¹å™¨ï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> stop <span class="token operator">&lt;</span>nginx-container-id<span class="token operator">&gt;</span>
</code></pre>
    <h4>
     <a id="2__SSL__20">
     </a>
     <strong>
      2. ç”³è¯· SSL è¯ä¹¦
     </strong>
    </h4>
    <p>
     è¿è¡Œ Certbotï¼Œä½¿ç”¨
     <code>
      standalone
     </code>
     æ¨¡å¼ï¼š
    </p>
    <pre><code class="prism language-bash">certbot certonly <span class="token parameter variable">--standalone</span> <span class="token parameter variable">-d</span> youdomain.com <span class="token parameter variable">-d</span> www.youdomain.com
</code></pre>
    <blockquote>
     <p>
      <strong>
       è¯´æ˜
      </strong>
      ï¼š
     </p>
     <ul>
      <li>
       <code>
        certonly
       </code>
       ï¼šåªè·å–è¯ä¹¦ï¼Œä¸ä¿®æ”¹é…ç½®
      </li>
      <li>
       <code>
        --standalone
       </code>
       ï¼šä½¿ç”¨ Certbot å†…ç½®çš„ web æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼ˆéœ€è¦ 80 ç«¯å£ï¼‰
      </li>
      <li>
       <code>
        -d
       </code>
       æŒ‡å®šåŸŸå
      </li>
     </ul>
    </blockquote>
    <h4>
     <a id="3__Nginx_30">
     </a>
     <strong>
      3. å¯åŠ¨ Nginx
     </strong>
    </h4>
    <pre><code class="prism language-bash"><span class="token function">docker</span> start <span class="token operator">&lt;</span>nginx-container-id<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_2Webroot__Nginx_37">
     </a>
     <strong>
      æ–¹æ¡ˆ 2ï¼šWebroot æ¨¡å¼ï¼ˆä¸åœæ­¢ Nginxï¼‰
     </strong>
    </h3>
    <p>
     <strong>
      é€‚ç”¨äº Nginx å®¹å™¨å¯æŒ‚è½½
      <code>
       /var/www/html
      </code>
      æˆ–æœ‰
      <code>
       root
      </code>
      ç›®å½•
     </strong>
    </p>
    <h4>
     <a id="1__Nginx__Webroot__40">
     </a>
     <strong>
      1. ç¡®å®š Nginx å®¹å™¨çš„ Webroot è·¯å¾„
     </strong>
    </h4>
    <p>
     è¿›å…¥å®¹å™¨ï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>nginx-container-id<span class="token operator">&gt;</span> <span class="token function">sh</span>
</code></pre>
    <p>
     æŸ¥æ‰¾
     <code>
      root
     </code>
     è·¯å¾„ï¼ˆé€šå¸¸æ˜¯
     <code>
      /usr/share/nginx/html
     </code>
     ï¼‰ï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token function">grep</span> <span class="token parameter variable">-r</span> <span class="token string">"root"</span> /etc/nginx/nginx.conf
</code></pre>
    <p>
     å‡è®¾ Webroot æ˜¯
     <code>
      /usr/share/nginx/html
     </code>
     ï¼Œé€€å‡ºå®¹å™¨ã€‚
    </p>
    <h4>
     <a id="2__SSL__51">
     </a>
     <strong>
      2. ç”³è¯· SSL è¯ä¹¦
     </strong>
    </h4>
    <p>
     åœ¨å®¿ä¸»æœºè¿è¡Œï¼š
    </p>
    <pre><code class="prism language-bash">certbot certonly <span class="token parameter variable">--webroot</span> <span class="token parameter variable">-w</span> /usr/share/nginx/html <span class="token parameter variable">-d</span> youdomain.com <span class="token parameter variable">-d</span> www.youdomain.com
</code></pre>
    <p>
     è¾“å…¥é‚®ç®±åæŒ‰enter
     <br/>
     åè®®è¾“å…¥YåæŒ‰enter
     <br/>
     æ˜¯å¦æ¥æ”¶æ¥è‡ªå®˜æ–¹çš„æ–°é—»ç­‰é‚®ä»¶é€šçŸ¥ï¼Œå¯ä»¥é€‰æ‹©Y/Nï¼Œä¸å½±å“ä½¿ç”¨
    </p>
    <h4>
     <a id="3__Nginx__SSL_59">
     </a>
     <strong>
      3. é…ç½® Nginx ä½¿ç”¨ SSL
     </strong>
    </h4>
    <p>
     ç¼–è¾‘
     <code>
      nginx.conf
     </code>
     ï¼ˆåœ¨
     <code>
      server
     </code>
     é…ç½®ä¸­æ·»åŠ  SSLï¼‰ï¼š
    </p>
    <pre><code class="prism language-nginx">server {
    listen 443 ssl;
    server_name youdomain.com www.youdomain.com;

    ssl_certificate /etc/letsencrypt/live/youdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/youdomain.com/privkey.pem;

    location / {
        root /usr/share/nginx/html;
        index index.html;
    }
}
</code></pre>
    <p>
     <mark>
      <strong>
       æ³¨æ„ï¼šå®¹å™¨è¦æŒ‚è½½/etc/letsencryptç›®å½• :roè¡¨ç¤ºåªè¯»
      </strong>
     </mark>
    </p>
    <pre><code>-v /etc/letsencrypt:/etc/letsencrypt:ro
</code></pre>
    <p>
     ç„¶åé‡å¯ Nginxï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> restart <span class="token operator">&lt;</span>nginx-container-id<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_SSL__87">
     </a>
     <strong>
      é…ç½® SSL è¯ä¹¦è‡ªåŠ¨ç»­çº¦
     </strong>
    </h3>
    <p>
     Letâ€™s Encrypt è¯ä¹¦
     <strong>
      90 å¤©
     </strong>
     åè¿‡æœŸï¼Œå› æ­¤éœ€è¦è‡ªåŠ¨ç»­çº¦ã€‚
    </p>
    <h4>
     <a id="1__90">
     </a>
     <strong>
      1. æµ‹è¯•ç»­çº¦
     </strong>
    </h4>
    <pre><code class="prism language-bash">certbot renew --dry-run
</code></pre>
    <p>
     å¦‚æœæ˜¾ç¤º
     <code>
      Congratulations
     </code>
     ï¼Œè¯´æ˜ç»­çº¦æ­£å¸¸ã€‚
    </p>
    <h4>
     <a id="2__96">
     </a>
     <strong>
      2. è®¾ç½®è‡ªåŠ¨ç»­çº¦
     </strong>
    </h4>
    <p>
     æ·»åŠ 
     <code>
      crontab
     </code>
     ä»»åŠ¡ï¼Œæ¯å¤©æ£€æŸ¥è¯ä¹¦å¹¶é‡å¯ Nginxï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token function">crontab</span> <span class="token parameter variable">-e</span>
</code></pre>
    <p>
     æ·»åŠ ï¼š
    </p>
    <pre><code class="prism language-bash"><span class="token number">0</span> <span class="token number">2</span> * * * certbot renew <span class="token parameter variable">--quiet</span> --deploy-hook <span class="token string">"docker restart &lt;nginx-container-id&gt;"</span>
</code></pre>
    <blockquote>
     <p>
      <strong>
       è§£é‡Š
      </strong>
      ï¼š
     </p>
     <ul>
      <li>
       <code>
        0 2 * * *
       </code>
       ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹è¿è¡Œ
      </li>
      <li>
       <code>
        certbot renew --quiet
       </code>
       ï¼šé™é»˜ç»­çº¦
      </li>
      <li>
       <code>
        delopy-hook
       </code>
       ï¼šåªæœ‰æˆåŠŸç»­æœŸåæ‰æ‰§è¡Œåé¢çš„å‘½ä»¤
      </li>
      <li>
       <code>
        docker restart nginx
       </code>
       ï¼šç»­çº¦åé‡å¯ Nginx ä½¿æ–°è¯ä¹¦ç”Ÿæ•ˆ
      </li>
     </ul>
    </blockquote>
    <hr/>
    <h3>
     <a id="_113">
     </a>
     <strong>
      éªŒè¯è¯ä¹¦æ˜¯å¦ç”Ÿæ•ˆ
     </strong>
    </h3>
    <pre><code class="prism language-bash">certbot certificates
æˆ–è€…
openssl s_client <span class="token parameter variable">-connect</span> yourdomain.com:443 <span class="token parameter variable">-servername</span> yourdomain.com <span class="token operator">|</span> openssl x509 <span class="token parameter variable">-noout</span> <span class="token parameter variable">-dates</span>
</code></pre>
    <p>
     å¦‚æœ
     <code>
      Not After
     </code>
     æ—¥æœŸå·²æ›´æ–°ï¼Œè¯´æ˜è¯ä¹¦ç»­çº¦æˆåŠŸï¼âœ…
    </p>
    <hr/>
    <h4>
     <a id="_123">
     </a>
     <strong>
      æ€»ç»“
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       Docker è¿è¡Œ Nginx ä¸èƒ½ç›´æ¥ç”¨
       <code>
        certbot --nginx
       </code>
      </strong>
     </li>
     <li>
      <strong>
       æ¨è
       <code>
        standalone
       </code>
       æ¨¡å¼ï¼ˆéœ€ä¸´æ—¶å…³é—­ Nginxï¼‰
      </strong>
     </li>
     <li>
      <strong>
       æˆ–è€…
       <code>
        webroot
       </code>
       æ¨¡å¼ï¼ˆéœ€æ‰‹åŠ¨ä¿®æ”¹ Nginx é…ç½®ï¼‰
      </strong>
     </li>
     <li>
      <strong>
       è‡ªåŠ¨ç»­çº¦é€šè¿‡
       <code>
        cron
       </code>
       è®¡åˆ’ä»»åŠ¡å®Œæˆ
      </strong>
     </li>
    </ul>
    <p>
     è¿™æ ·ï¼Œä½ çš„
     <strong>
      SSL è¯ä¹¦ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
     </strong>
     ï¼ğŸš€
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343638313739392f:61727469636c652f64657461696c732f313436323736333437" class_="artid" style="display:none">
 </p>
</div>


