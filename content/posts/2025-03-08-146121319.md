---
layout: post
title: "go的grpc"
date: 2025-03-08 19:46:08 +0800
description: "针对单体架构的问题出现了。"
keywords: "go的grpc"
categories: ['未分类']
tags: ['开发语言', '后端', 'Golang']
artid: "146121319"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146121319
    alt: "go的grpc"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146121319
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146121319
cover: https://bing.ee123.net/img/rand?artid=146121319
image: https://bing.ee123.net/img/rand?artid=146121319
img: https://bing.ee123.net/img/rand?artid=146121319
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     go的grpc
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="GRPC_0">
     </a>
     GRPC介绍
    </h2>
    <h3>
     <a id="_2">
     </a>
     目录
    </h3>
    <ol>
     <li>
      <a href="#%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84" rel="nofollow">
       单体架构
      </a>
     </li>
     <li>
      <a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" rel="nofollow">
       微服务架构
      </a>
     </li>
     <li>
      <a href="#%E9%97%AE%E9%A2%98" rel="nofollow">
       问题
      </a>
     </li>
     <li>
      <a href="#%E5%8E%9F%E5%A7%8B%E7%9A%84grpc" rel="nofollow">
       原始的grpc
      </a>
      <ul>
       <li>
        <a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF" rel="nofollow">
         服务端
        </a>
       </li>
       <li>
        <a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF" rel="nofollow">
         客户端
        </a>
       </li>
       <li>
        <a href="#%E5%8E%9F%E7%94%9Frpc%E7%9A%84%E9%97%AE%E9%A2%98" rel="nofollow">
         原生rpc的问题
        </a>
       </li>
      </ul>
     </li>
     <li>
      <a href="#grpc%E7%9A%84hello-world" rel="nofollow">
       grpc的hello world
      </a>
      <ul>
       <li>
        <a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF-1" rel="nofollow">
         服务端
        </a>
       </li>
       <li>
        <a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-1" rel="nofollow">
         客户端
        </a>
       </li>
      </ul>
     </li>
     <li>
      <a href="#proto%E6%96%87%E4%BB%B6" rel="nofollow">
       proto文件
      </a>
     </li>
     <li>
      <a href="#proto%E8%AF%AD%E6%B3%95" rel="nofollow">
       proto语法
      </a>
      <ul>
       <li>
        <a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" rel="nofollow">
         数据类型
        </a>
        <ul>
         <li>
          <a href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" rel="nofollow">
           基本数据类型
          </a>
         </li>
         <li>
          <a href="#%E5%85%B6%E4%BB%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" rel="nofollow">
           其他数据类型
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <a href="#%E7%BC%96%E5%86%99%E9%A3%8E%E6%A0%BC" rel="nofollow">
       编写风格
      </a>
     </li>
     <li>
      <a href="#%E5%A4%9A%E6%9C%8D%E5%8A%A1" rel="nofollow">
       多服务
      </a>
     </li>
    </ol>
    <h3>
     <a id="_21">
     </a>
     单体架构
    </h3>
    <ol>
     <li>
      只能对整体扩容
     </li>
     <li>
      一荣俱荣，一损俱损
     </li>
     <li>
      代码耦合，项目的开发者需要知道整个项目的流程
     </li>
    </ol>
    <h3>
     <a id="_26">
     </a>
     微服务架构
    </h3>
    <p>
     针对单体架构的问题出现了
     <strong>
      微服务架构
     </strong>
    </p>
    <ol>
     <li>
      可以按照服务进行单独扩容
     </li>
     <li>
      各个服务之间可以独立开发，独立部署
     </li>
    </ol>
    <h3>
     <a id="_32">
     </a>
     问题
    </h3>
    <ol>
     <li>
      代码冗余
     </li>
     <li>
      服务之间的调用很麻烦
     </li>
    </ol>
    <p>
     <a href="https://zhuanlan.zhihu.com/p/377860784" rel="nofollow">
      为什么要使用grpc
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_43067962/article/details/124807900">
      grpc使用的意义
     </a>
    </p>
    <h3>
     <a id="grpc_39">
     </a>
     原始的grpc
    </h3>
    <h4>
     <a id="_40">
     </a>
     服务端
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"fmt"</span>
  <span class="token string">"net"</span>
  <span class="token string">"net/http"</span>
  <span class="token string">"net/rpc"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Server <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Req <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  Num1 <span class="token builtin">int</span>
  Num2 <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Res <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  Num <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s Server<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>req Req<span class="token punctuation">,</span> res <span class="token operator">*</span>Res<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span>Num <span class="token operator">=</span> req<span class="token punctuation">.</span>Num1 <span class="token operator">+</span> req<span class="token punctuation">.</span>Num2
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 注册rpc服务</span>
  rpc<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token function">new</span><span class="token punctuation">(</span>Server<span class="token punctuation">)</span><span class="token punctuation">)</span>
  rpc<span class="token punctuation">.</span><span class="token function">HandleHTTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  listen<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">":8080"</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  http<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>listen<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_79">
     </a>
     客户端
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"fmt"</span>
  <span class="token string">"net/rpc"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Req <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  Num1 <span class="token builtin">int</span>
  Num2 <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Res <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  Num <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  req <span class="token operator">:=</span> Req<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
  client<span class="token punctuation">,</span> err <span class="token operator">:=</span> rpc<span class="token punctuation">.</span><span class="token function">DialHTTP</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">":8080"</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> res Res
  client<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token string">"Server.Add"</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="rpc_109">
     </a>
     原生rpc的问题：
    </h4>
    <ol>
     <li>
      编写相对复杂，需要自己去关注实现过程
     </li>
     <li>
      没有代码提示，容易写错。
     </li>
    </ol>
    <h3>
     <a id="grpchello_world_113">
     </a>
     grpc的hello world
    </h3>
    <h4>
     <a id="_114">
     </a>
     服务端
    </h4>
    <ol>
     <li>
      编写一个结构体，名字叫什么不重要
     </li>
     <li>
      重要的是得实现protobuf中的所有方法
     </li>
     <li>
      监听端口
     </li>
     <li>
      注册服务
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"google.golang.org/grpc"</span>
	<span class="token string">"google.golang.org/grpc/grpclog"</span>
	<span class="token string">"grpc_study/grpc_proto/hello_grpc"</span>
	<span class="token string">"net"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> HelloServiceServer <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s HelloServiceServer<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> request <span class="token operator">*</span>hello_grpc<span class="token punctuation">.</span>HelloRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span>res <span class="token operator">*</span>hello_grpc<span class="token punctuation">.</span>HelloResponse<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求来了！"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>hello_grpc<span class="token punctuation">.</span>HelloResponse<span class="token punctuation">{<!-- --></span>
		Message<span class="token punctuation">:</span> <span class="token string">"Hello "</span> <span class="token operator">+</span> <span class="token string">"Xiaoyu_Wang"</span><span class="token punctuation">,</span>
		Name<span class="token punctuation">:</span>    <span class="token string">"Server"</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 监听端口</span>
	listen<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">":8080"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		grpclog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Failed to listen: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 创建一个gRPC服务器实例。</span>
	s <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	server <span class="token operator">:=</span> HelloServiceServer<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token comment">// 将server结构体注册为gRPC服务。</span>
	hello_grpc<span class="token punctuation">.</span><span class="token function">RegisterHelloServiceServer</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token operator">&amp;</span>server<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"grpc server running :8080"</span><span class="token punctuation">)</span>
	<span class="token comment">// 开始处理客户端请求。</span>
	err <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>listen<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_161">
     </a>
     客户端
    </h4>
    <ol>
     <li>
      建立连接
     </li>
     <li>
      调用方法
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"context"</span>
  <span class="token string">"fmt"</span>
  <span class="token string">"google.golang.org/grpc"</span>
  <span class="token string">"google.golang.org/grpc/credentials/insecure"</span>
  <span class="token string">"grpc_study/grpc_proto/hello_grpc"</span>
  <span class="token string">"log"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  addr <span class="token operator">:=</span> <span class="token string">":8080"</span>
  <span class="token comment">// 使用 grpc.Dial 创建一个到指定地址的 gRPC 连接。</span>
  <span class="token comment">// 此处使用不安全的证书来实现 SSL/TLS 连接</span>
  conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithTransportCredentials</span><span class="token punctuation">(</span>insecure<span class="token punctuation">.</span><span class="token function">NewCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"grpc connect addr [%s] 连接失败 %s"</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 初始化客户端</span>
  client <span class="token operator">:=</span> hello_grpc<span class="token punctuation">.</span><span class="token function">NewHelloServiceClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
  result<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SayHello</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hello_grpc<span class="token punctuation">.</span>HelloRequest<span class="token punctuation">{<!-- --></span>
    Name<span class="token punctuation">:</span>    <span class="token string">"Xiaoyu_Wang"</span><span class="token punctuation">,</span>
    Message<span class="token punctuation">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="proto_196">
     </a>
     proto文件
    </h3>
    <pre><code class="prism language-protobuf">syntax = "proto3"; // 指定proto版本
package hello_grpc;     // 指定默认包名

// 指定golang包名
option go_package = "/hello_grpc";

//定义rpc服务
service HelloService {
  // 定义函数
  rpc SayHello (HelloRequest) returns (HelloResponse) {}
}

// HelloRequest 请求内容
message HelloRequest {
  string name = 1;  // 消息号
  string message = 2;
}

// HelloResponse 响应内容
message HelloResponse{
  string name = 1;
  string message = 2;
}
</code></pre>
    <h3>
     <a id="proto_224">
     </a>
     proto语法
    </h3>
    <ol>
     <li>
      service 对应的就是go里面的接口，可以作为服务端，客户端
     </li>
     <li>
      rpc 对应的就是结构体中的方法
     </li>
     <li>
      message对应的也是结构体
     </li>
    </ol>
    <h4>
     <a id="_230">
     </a>
     数据类型
    </h4>
    <h5>
     <a id="_231">
     </a>
     基本数据类型
    </h5>
    <pre><code class="prism language-protobuf">message Request {
  double a1 = 1;
  float a2 = 2;
  int32 a3 = 3;
  uint32 a4 = 4;
  uint64 a5 = 5;
  sint32 a6 = 6;
  sint64 a7 = 7;
  fixed32 a8 = 8;
  fixed64 a9 = 9;
  sfixed32 a10 = 10;
  sfixed64 a11 = 11;
  bool a12 = 12;
  string a13 = 13;
  bytes a14 = 14;
}
</code></pre>
    <p>
     对应的go类型：
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Request <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  state         protoimpl<span class="token punctuation">.</span>MessageState
  sizeCache     protoimpl<span class="token punctuation">.</span>SizeCache
  unknownFields protoimpl<span class="token punctuation">.</span>UnknownFields

  A1  <span class="token builtin">float64</span> <span class="token string">`protobuf:"fixed64,1,opt,name=a1,proto3" json:"a1,omitempty"`</span>
  A2  <span class="token builtin">float32</span> <span class="token string">`protobuf:"fixed32,2,opt,name=a2,proto3" json:"a2,omitempty"`</span>
  A3  <span class="token builtin">int32</span>   <span class="token string">`protobuf:"varint,3,opt,name=a3,proto3" json:"a3,omitempty"`</span>
  A4  <span class="token builtin">uint32</span>  <span class="token string">`protobuf:"varint,4,opt,name=a4,proto3" json:"a4,omitempty"`</span>
  A5  <span class="token builtin">uint64</span>  <span class="token string">`protobuf:"varint,5,opt,name=a5,proto3" json:"a5,omitempty"`</span>
  A6  <span class="token builtin">int32</span>   <span class="token string">`protobuf:"zigzag32,6,opt,name=a6,proto3" json:"a6,omitempty"`</span>
  A7  <span class="token builtin">int64</span>   <span class="token string">`protobuf:"zigzag64,7,opt,name=a7,proto3" json:"a7,omitempty"`</span>
  A8  <span class="token builtin">uint32</span>  <span class="token string">`protobuf:"fixed32,8,opt,name=a8,proto3" json:"a8,omitempty"`</span>
  A9  <span class="token builtin">uint64</span>  <span class="token string">`protobuf:"fixed64,9,opt,name=a9,proto3" json:"a9,omitempty"`</span>
  A10 <span class="token builtin">int32</span>   <span class="token string">`protobuf:"fixed32,10,opt,name=a10,proto3" json:"a10,omitempty"`</span>
  A11 <span class="token builtin">int64</span>   <span class="token string">`protobuf:"fixed64,11,opt,name=a11,proto3" json:"a11,omitempty"`</span>
  A12 <span class="token builtin">bool</span>    <span class="token string">`protobuf:"varint,12,opt,name=a12,proto3" json:"a12,omitempty"`</span>
  A13 <span class="token builtin">string</span>  <span class="token string">`protobuf:"bytes,13,opt,name=a13,proto3" json:"a13,omitempty"`</span>
  A14 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>  <span class="token string">`protobuf:"bytes,14,opt,name=a14,proto3" json:"a14,omitempty"`</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_275">
     </a>
     其他数据类型
    </h5>
    <ol>
     <li>
      数组类型
     </li>
    </ol>
    <pre><code class="prism language-protobuf">message ArrayRequest {
  repeated int64 a1 = 1;
  repeated string a2 = 2;
  repeated Request request_list = 3;
}
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">type</span> ArrayRequest <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  A1          <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span> 
  A2          <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>   
  RequestList <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Request
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      map类型
     </li>
    </ol>
    <pre><code class="prism language-protobuf">message MapRequest {
  map&lt;int64, string&gt; m_i_s = 1;
  map&lt;string, bool&gt; m_i_b = 2;
  map&lt;string, ArrayRequest&gt; m_i_arr = 3;
}
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">type</span> MapRequest <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  MIS   <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int64</span><span class="token punctuation">]</span><span class="token builtin">string</span>
  MIB   <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">bool</span>
  MIArr <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">*</span>ArrayRequest
<span class="token punctuation">}</span>
</code></pre>
    <ol start="3">
     <li>
      嵌套类型
     </li>
    </ol>
    <pre><code class="prism language-protobuf">message Q1 {
  message Q2{
    string name2 = 2;
  }
  string name1 = 1;
  Q2 q2 = 2;
}
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Q1 <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
  state         protoimpl<span class="token punctuation">.</span>MessageState
  sizeCache     protoimpl<span class="token punctuation">.</span>SizeCache
  unknownFields protoimpl<span class="token punctuation">.</span>UnknownFields

  Name1 <span class="token builtin">string</span> <span class="token string">`protobuf:"bytes,1,opt,name=name1,proto3" json:"name1,omitempty"`</span>
  Q2    <span class="token operator">*</span>Q1_Q2 <span class="token string">`protobuf:"bytes,2,opt,name=q2,proto3" json:"q2,omitempty"`</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_331">
     </a>
     编写风格
    </h3>
    <ol>
     <li>
      文件名建议下划线，例如：my_student.proto
     </li>
     <li>
      包名和目录名对应
     </li>
     <li>
      服务名、方法名、消息名均为大驼峰
     </li>
     <li>
      字段名为下划线
     </li>
    </ol>
    <h3>
     <a id="_337">
     </a>
     多服务
    </h3>
    <pre><code class="prism language-protobuf">syntax = "proto3";

option go_package = "/duo_grpc";

service VideoService {
  rpc Look (Request) returns (Response) {}
}

message Request{
  string name = 1;
}

message Response{
  string name = 1;
}

service OderService {
  rpc Buy (Request) returns (Response) {}
}
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f786961777562757368616e6762616e2f:61727469636c652f64657461696c732f313436313231333139" class_="artid" style="display:none">
 </p>
</div>


