---
layout: post
title: "HarmonyOS-3.14.0应用升级到HarmonyOS-NEXT改动点"
date: 2025-02-21 23:34:28 +0800
description: "在 “2024鸿蒙零基础快速实战-仿抖音App开发（ArkTS版）”（）视频课程中，因为讲师在该课程"
keywords: "indexed access is not supported for fields (arkts-no-props-by-index) <arktsc"
categories: ['Harmonyos']
tags: ['鸿蒙', '华为', 'Next', 'Harmonyos', 'Harmonyos']
artid: "141125285"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=141125285
    alt: "HarmonyOS-3.14.0应用升级到HarmonyOS-NEXT改动点"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=141125285
featuredImagePreview: https://bing.ee123.net/img/rand?artid=141125285
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     HarmonyOS 3.1/4.0应用升级到HarmonyOS NEXT改动点
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 “2024鸿蒙零基础快速实战-仿抖音App开发（ArkTS版）”（
     <a href="https://coding.imooc.com/class/843.html" rel="nofollow">
      https://coding.imooc.com/class/843.html
     </a>
     ）视频课程中，因为讲师在该课程授课时是使用的HarmonyOS 3.1/4.0应用（API 9），如果部分学员采用了最新的HarmonyOS NEXT API，此时就会遇到API兼容性的问题。
    </p>
    <p>
     本文整理了从HarmonyOS 3.1/4.0应用升级到HarmonyOS NEXT（Developer Preview2）改动点。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/9c86d8eeaca23c867f8f54e73ad5ed05.png"/>
    </p>
    <h4>
     <a id="_8">
     </a>
     获取路由参数
    </h4>
    <pre><code>// 从路由参数中获取用户信息
let userInfo: UserInfo = params[`${Constants.PARAM_LOGGED_USER_INFO_KEY}`];
</code></pre>
    <p>
     报错：
     <code>
      Indexed access is not supported for fields (arkts-no-props-by-index) &lt;ArkTSCheck&gt;
     </code>
    </p>
    <p>
     不应该通过索引来访问对象
    </p>
    <p>
     错误原因：在 HarmonyOS Next 开发中，如果你不能使用 TypeScript 或 JavaScript 的标准库，包括 hasOwnProperty 和通过
     <code>
      []
     </code>
     或
     <code>
      .
     </code>
     获取对象的属性值，那么你需要寻找其他方法来将对象转换为 Map。由于 ArkTS 对动态特性的限制，你可以考虑使用递归函数来遍历对象的属性，并将它们添加到 Map 中。
    </p>
    <p>
     改为
    </p>
    <pre><code>// 从路由参数中获取用户信息
let userInfo: UserInfo = new Map(Object.entries(params))[`${Constants.PARAM_LOGGED_USER_INFO_KEY}`];
</code></pre>
    <pre><code>router.replaceUrl({
  url: 'pages/Index',

  // 通过路由参数，传递待发布的视频数据
  params: {
    [`${Constants.PARAM_PUBLISHED_VIDEO_INFO_KEY}`]: this.selectedVideoInfo
  }
})
</code></pre>
    <p>
     报错：
     <code>
      Objects with property names that are not identifiers are not supported (arkts-identifiers-as-prop-names) &lt;ArkTSCheck&gt;
     </code>
    </p>
    <p>
     改为
    </p>
    <pre><code>router.replaceUrl({
  url: 'pages/Index',

  // 通过路由参数，传递待发布的视频数据
  params: {
    'publishedVideoInfo': this.selectedVideoInfo
  }
})
</code></pre>
    <h4>
     <a id="UI_57">
     </a>
     设置应用全局的UI状态存储
    </h4>
    <pre><code>AppStorage.SetOrCreate('UserInfo.username', userInfo.username);
</code></pre>
    <p>
     改为
    </p>
    <pre><code>AppStorage.setOrCreate('UserInfo.username', userInfo.username);
</code></pre>
    <pre><code>let username: string = AppStorage.Get('UserInfo.username');
</code></pre>
    <p>
     改为
    </p>
    <pre><code>let username: string = AppStorage.get('UserInfo.username') as string;
</code></pre>
    <h4>
     <a id="Entry_81">
     </a>
     不要导出
     <code>
      @Entry
     </code>
    </h4>
    <pre><code>@Entry
@Component
export struct VideoPublishPage {
</code></pre>
    <pre><code>@Entry
@Component
struct VideoPublishPage {
</code></pre>
    <h4>
     <a id="Property_videoId_has_no_initializer_and_is_not_definitely_assigned_in_the_constructor_101">
     </a>
     Property ‘videoId’ has no initializer and is not definitely assigned in the constructor.
    </h4>
    <pre><code>export class VideoInfo {
  // 视频ID
  videoId: number;
</code></pre>
    <pre><code> Property 'videoId' has no initializer and is not definitely assigned in the constructor.
</code></pre>
    <p>
     改为
    </p>
    <pre><code>export class VideoInfo {
  // 视频ID
  videoId: number = 0;
</code></pre>
    <h3>
     <a id="_123">
     </a>
     参考资料
    </h3>
    <ul>
     <li>
      本文同步至：
      <a href="https://waylau.com/changes-upgrade-from-3-1-4-0-to-harmonyos-next-developer-preview2/" rel="nofollow">
       https://waylau.com/changes-upgrade-from-3-1-4-0-to-harmonyos-next-developer-preview2/
      </a>
     </li>
     <li>
      《跟老卫学HarmonyOS开发》 开源免费教程，
      <a href="https://github.com/waylau/harmonyos-tutorial">
       https://github.com/waylau/harmonyos-tutorial
      </a>
     </li>
     <li>
      《鸿蒙HarmonyOS手机应用开发实战》（清华大学出版社）
     </li>
     <li>
      《鸿蒙HarmonyOS应用开发从入门到精通战》（北京大学出版社）
     </li>
     <li>
      “鸿蒙系统实战短视频App 从0到1掌握HarmonyOS”（
      <a href="https://coding.imooc.com/class/674.html" rel="nofollow">
       https://coding.imooc.com/class/674.html
      </a>
      ）
     </li>
     <li>
      《鸿蒙HarmonyOS应用开发入门》（清华大学出版社）
     </li>
     <li>
      “2024鸿蒙零基础快速实战-仿抖音App开发（ArkTS版）”（
      <a href="https://coding.imooc.com/class/843.html" rel="nofollow">
       https://coding.imooc.com/class/843.html
      </a>
      ）
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6b6b6b6c6f7665796f752f:61727469636c652f64657461696c732f313431313235323835" class_="artid" style="display:none">
 </p>
</div>


