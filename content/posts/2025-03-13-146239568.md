---
layout: post
title: "pytestallurejenkins-实现接口自动化测试"
date: 2025-03-13 19:03:55 +0800
description: "echo \"已更新 $INI_FILE 中 key 的值为 $NEW_VALUE\"# 使用 sed 替换 flag 的值,flag 0是生产，1仿真，2验收。elif [ \"$env\" == \"仿真环境\" ];if [ \"$env\" == \"验收环境\" ];echo \"配置文件 $INI_FILE 不存在。3、 根据输入的环境入参，修改代码库中的配置文件。# 定义要修改的配置文件 .ini 路径。1、参数化输入：输入执行的环境。进入 Jenkins 的 ‌。先看这篇，再看本文比较好。自动化接口测试代码库。"
keywords: "pytest+allure+jenkins 实现接口自动化测试"
categories: ['Jenkins']
tags: ['运维', 'Pytest', 'Jenkins']
artid: "146239568"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146239568
    alt: "pytestallurejenkins-实现接口自动化测试"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146239568
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146239568
cover: https://bing.ee123.net/img/rand?artid=146239568
image: https://bing.ee123.net/img/rand?artid=146239568
img: https://bing.ee123.net/img/rand?artid=146239568
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     pytest+allure+jenkins 实现接口自动化测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     先看这篇，再看本文比较好
     <a href="https://mp.csdn.net/mp_blog/creation/success/146211775" title="CSDN">
      CSDN
     </a>
    </p>
    <p>
     jenkins配置：
    </p>
    <p>
     1、参数化输入：输入执行的环境
     <img alt="" height="839" src="https://i-blog.csdnimg.cn/direct/b75991df0fa24f20823008993e0299b2.png" width="1609"/>
    </p>
    <p>
     2、设置代码链接：
     <a href="https://gitee.com/daxiashagnxian/apitest.git" rel="nofollow" title="APITEST: 接口自动化测试">
      APITEST: 接口自动化测试
     </a>
     自动化接口测试代码库
    </p>
    <p>
     <img alt="" height="795" src="https://i-blog.csdnimg.cn/direct/53d314ee924d4c1cb7fb7c9b42eb6980.png" width="1694">
     </img>
    </p>
    <p>
     3、 根据输入的环境入参，修改代码库中的配置文件
    </p>
    <p>
     <img alt="" height="803" src="https://i-blog.csdnimg.cn/direct/3b3f4385429940a7b3d4ac0cfd853218.png" width="1602"/>
    </p>
    <p>
     配置文件如下所示
    </p>
    <p>
     <img alt="" height="151" src="https://i-blog.csdnimg.cn/direct/80ff171d0f9b4904b9c893ff79c98beb.png" width="274">
     </img>
    </p>
    <blockquote>
     <p>
      ls
      <br/>
      # 定义要修改的配置文件 .ini 路径
      <br/>
      INI_FILE="./conf/env.ini"
      <br/>
      if [ "$env" == "验收环境" ]; then
      <br/>
      NEW_VALUE=2
      <br/>
      elif [ "$env" == "仿真环境" ]; then
      <br/>
      NEW_VALUE=1
      <br/>
      else
      <br/>
      NEW_VALUE=0
      <br/>
      fi
      <br/>
      echo $NEW_VALUE
      <br/>
      # 检查文件是否存在
      <br/>
      if [ ! -f "$INI_FILE" ]; then
      <br/>
      echo "配置文件 $INI_FILE 不存在。"
      <br/>
      exit 1
      <br/>
      fi
      <br/>
      # 使用 sed 替换 flag 的值,flag 0是生产，1仿真，2验收
      <br/>
      sed -i.bak "s/flag\s*=\s*[0-9]\+/flag = $NEW_VALUE/g" "$INI_FILE"
     </p>
     <p>
      # （可选）备份原文件
      <br/>
      # mv "$INI_FILE.bak" "$INI_FILE.backup"
     </p>
     <p>
      echo "已更新 $INI_FILE 中 key 的值为 $NEW_VALUE"
     </p>
    </blockquote>
    <p>
     4、 执行用例
    </p>
    <p>
     <img alt="" height="316" src="https://i-blog.csdnimg.cn/direct/4e995a56a7d649cb9a0483b38071fc21.png" width="1614"/>
    </p>
    <blockquote>
     <p>
      pytest --alluredir=allure-results --clean-alluredir ./testsuite/test
      <br/>
      allure generate allure-results - o allure-report --clean
     </p>
    </blockquote>
    <p>
     5、 配置allure
    </p>
    <p>
     <img alt="" height="646" src="https://i-blog.csdnimg.cn/direct/e9dd42f9df8d4896aae9935efe2f349b.png" width="1316"/>
    </p>
    <p>
    </p>
    <p>
     6、执行
     <img alt="" height="483" src="https://i-blog.csdnimg.cn/direct/22476c735c6b4ea799536a3e4474ea4f.png" width="1722"/>
    </p>
    <p>
     结果如下：
     <img alt="" height="601" src="https://i-blog.csdnimg.cn/direct/884cb8db77e440069312dc92c9075eca.png" width="1163"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      遇到问题及解决方案
     </strong>
    </p>
    <p>
     <img alt="" height="250" src="https://i-blog.csdnimg.cn/direct/e923fe9b593941a88cdf7afb39ca6dff.png" width="993"/>
    </p>
    <p>
     解决方案：
    </p>
    <blockquote>
     <p>
      进入 Jenkins 的 ‌
      <strong>
       Manage Jenkins &gt; Configure System
      </strong>
      ‌，在 ‌
      <strong>
       Global properties &gt; Environment variables
      </strong>
      ‌ 中添加：Name: PYTHONPATH Value: $WORKSPACE
     </p>
    </blockquote>
    <p>
    </p>
    <p>
     <img alt="" height="427" src="https://i-blog.csdnimg.cn/direct/b3c4ce3f2de940d782519e7b9f6b70c1.png" width="1252"/>
     解决方案：
    </p>
    <blockquote>
     <ol>
      <li>
       进入 Jenkins 控制台 → ‌
       <strong>
        Manage Jenkins
       </strong>
       ‌ → ‌
       <strong>
        Global Tool Configuration
       </strong>
       ‌ → ‌
       <strong>
        JDK
       </strong>
       ‌。
      </li>
      <li>
       点击 ‌
       <strong>
        Add JDK
       </strong>
       ‌，取消勾选 ‌
       <strong>
        Install automatically
       </strong>
       ‌。
      </li>
      <li>
       输入名称（如
       <code>
        JDK11
       </code>
       ）和 ‌
       <strong>
        完整的 JDK 主目录路径（不带bin）
       </strong>
      </li>
     </ol>
    </blockquote>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f64617869617368616e677869616e2f:61727469636c652f64657461696c732f313436323339353638" class_="artid" style="display:none">
 </p>
</div>


