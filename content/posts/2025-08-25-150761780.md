---
layout: post
title: "4G模块-EC200通过MQTT协议连接到阿里云"
date: 2025-08-25T10:36:17+0800
description: "在页面左侧导航栏中，先找到 “设备管理” 分类并展开，点击其下的 “设备” 选项进入设备管理页面，接着点击页面中的 “添加设备” 按钮，在弹出的添加设备窗口中填写设备名称、设备类型、所属产品等相关信息。在页面左侧导航栏中，沿着层级路径依次点击「设备管理」选项，进入二级菜单后找到并点击「产品」，在产品管理界面中点击「创建产品」按钮，随后跳转至产品创建页面，在此处完成产品名称等基本信息的配置填写。此时发送数据：{&quot;id&quot;:&quot;123&quot;,&quot;params&quot;:{&quot;temperature&quot;:22.8}}"
keywords: "4G模块 EC200通过MQTT协议连接到阿里云"
categories: ['未分类']
tags: ['阿里云', '物联网', '数据库', 'Mqtt', 'Ec', 'At']
artid: "150761780"
arturl: "https://blog.csdn.net/qq_41954594/article/details/150761780"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150761780
    alt: "4G模块-EC200通过MQTT协议连接到阿里云"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150761780
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150761780
cover: https://bing.ee123.net/img/rand?artid=150761780
image: https://bing.ee123.net/img/rand?artid=150761780
img: https://bing.ee123.net/img/rand?artid=150761780
---



# 4G模块 EC200通过MQTT协议连接到阿里云

命令说明

```
基础AT指令

ATI显示MT的ID信息

AT+CIMI查询IMSI

AT+QCCID查询ICCID

AT+CSQ查询信号强度

AT+CGATT?查询当前PS域状态

MQTT配置指令

AT+QMTCFG配置MQTT可选参数

AT+QMTCFG配置MQTT可选参数.

AT+QMTOPEN打开MQTT客户端网络

AT+QMTCLOSE关闭MQTT客户端网络

AT+QMTCONN连接客户端到MQTT服务器.

AT+QMTDISC客户端断开与MQTT服务器的连接

AT+QMTSUB订阅主题

AT+QMTUNS退订主题

AT+QMTPUBEX发布消息

AT+QMTRECV从缓存中读取消息
```

流程

[阿里云-计算，为了无法计算的价值](https://www.aliyun.com/ "阿里云-计算，为了无法计算的价值")

第一步：配置阿里云平台

登录个人账号后，在系统界面点击进入控制台，于功能菜单中选择 “物联网平台” 模块，进入平台页面后点击“公共实例”选项，即可跳转至公共实例的管理后台界面。

![](https://i-blog.csdnimg.cn/direct/40ab472c28874d1c9ec8f224bc4af8f4.png)

![](https://i-blog.csdnimg.cn/direct/692c12d2b2a04a0d824a1f14931a6211.png)

![](https://i-blog.csdnimg.cn/direct/0ea201dd91c4426d9eeae0b574345d6d.png)

在页面左侧导航栏中，沿着层级路径依次点击「设备管理」选项，进入二级菜单后找到并点击「产品」，在产品管理界面中点击「创建产品」按钮，随后跳转至产品创建页面，在此处完成产品名称等基本信息的配置填写。

![](https://i-blog.csdnimg.cn/direct/bc84382aa65542b79978c599109c9ede.png)

在产品列表找到已创建产品，点击对应产品的查看按钮，进入产品开发详情页。

![](https://i-blog.csdnimg.cn/direct/c21ac5f884fb4223817de16b3da45556.png)

在产品开发详情页，选择[功能定义]→[前往编辑草稿]。

![](https://i-blog.csdnimg.cn/direct/d45e6bb50ac74638af0dd74f3da2e42c.png)

可选自定义功能，按需填写功能名称、数据类型、标识符等信息。

![](https://i-blog.csdnimg.cn/direct/34bd0dea357b425b80da65105aabae28.png)

编辑草稿完，选择[发布上线]。

![](https://i-blog.csdnimg.cn/direct/2338462a4c4e416d9e6b4a0bff977df5.png)

在页面左侧导航栏中，先找到 “设备管理” 分类并展开，点击其下的 “设备” 选项进入设备管理页面，接着点击页面中的 “添加设备” 按钮，在弹出的添加设备窗口中填写设备名称、设备类型、所属产品等相关信息。

![](https://i-blog.csdnimg.cn/direct/51e37dd95f6f457ba87539b7593e9b2a.png)

经上述步骤，阿里云平台相关配置已全部完成。

第二步：4G模块接线

实物接线

![](https://i-blog.csdnimg.cn/direct/fe5123ddb8fd4151b2401e63f5d17700.jpeg)

第三步：连接阿里云平台

将USB转TTL模块接入设备，打开串口调试助手，选定对应通信端口，设置波特率为115200。之后通过发送AT指令，即可实现设备与阿里云平台的连接，完成数据的上传与数据下发操作。

AT命令流程及命令结果：

1. 查询模块信息

发送指令：ATI

说明：查询模块型号、固件版本等基础信息。

预期响应：Quectel

EC200A

Revision: EC200ACNDAR01A18M16

OK

![](https://i-blog.csdnimg.cn/direct/307ed9b5bf6a4b94a4ba272adedf244f.png)

2. 查询国际移动用户识别码（IMSI）

发送指令：AT+CIMI

说明：获取SIM卡的IMSI号码，用于识别移动用户。

预期响应：460023606806489  OK

![](https://i-blog.csdnimg.cn/direct/c2961c199f954d7db7fa23b928025471.png)

3. 查询SIM卡ID（ICCID）

发送指令：AT+QCCID

说明：获取SIM卡的唯一标识符。

预期响应：898600261322F1000989  OK

![](https://i-blog.csdnimg.cn/direct/bae1b2f90b3e4e5b99a6f772217263f6.png)

4.查询信号强度

发送指令：AT+CSQ

说明：检查当前网络信号质量（0-31，值越大信号越强）。

预期响应：+CSQ:20,99  OK

![](https://i-blog.csdnimg.cn/direct/7f967f4a45534f0586c1fb18e02ee9e9.png)

5.查询GPRS附着状态

发送指令：AT+CGATT?

说明：检查模块是否已附着到GPRS网络（1=已附着，0=未附着）。

预期响应：+CGATT: 1  OK

![](https://i-blog.csdnimg.cn/direct/eef0b90c127841a3b66e32f923c46c6d.png)

6.配置MQTT协议版本

发送指令：AT+QMTCFG="version",0,4

说明：设置MQTT客户端（ID=0）使用MQTT  v3.1.1协议。

预期响应：OK

![](https://i-blog.csdnimg.cn/direct/d3cf28404cef4d06a8594bd53931b18d.png)

7.打开MQTT连接

发送指令：AT+QMTOPEN=0,"hxffngKIBke.iot-as-mqtt.cn-shanghai.aliyuncs.com",1883

说明：建立服务器连接,MQTT客户端标识符为0。

"hxffngKIBke.iot-as-mqtt.cn-shanghai.aliyuncs.com"为MQTT服务器，1883为服务器端口号域名。

预期响应：OK  +QMTOPEN: 0,0

![](https://i-blog.csdnimg.cn/direct/da90cdc14db34fa982a28cba6243c4a4.png)

其中Token获取：点击设备的“查看详情”界面后，找到“DeviceSecret”字段并点击其对应的“查看”选项，获取相关密钥信息。随后，在生成Token时需填入相关参数。Token获取连接在文章末。

![](https://i-blog.csdnimg.cn/direct/3e96c9b7b6c747d48b81799fdf12804d.png)

![](https://i-blog.csdnimg.cn/direct/0be23149df0e4e1eb3e3a63b8059e52c.png)

![](https://i-blog.csdnimg.cn/direct/9b9ea175daae43309d359bc3a1ecf723.png)

8.连接客户端到MQTT服务器

发送指令：

AT+QMTCONN=0,"hxffngKIBke.Test|securemode=3,signmethod=hmacsha1,timestamp=1751339070|","Test&hxffngKIBke","84297ce7e265491701621b69449f8c29f007cf33"

说明：参数0为MQTT客户端标识符，

"hxffngKIBke.Test|securemode=3,signmethod=hmacsha1,timestamp=1751339070|"为MQTT客户端ID，"Test&hxffngKIBke"为username，

"84297ce7e265491701621b69449f8c29f007cf33"为密钥。

预期响应：OK  +QMTCONN: 0,0,0

![](https://i-blog.csdnimg.cn/direct/c31d59cbadb84b9c9c1fbea2d58a88e6.png)

9.订阅MQTT主题

发送指令：

AT+QMTSUB=0,1,"/sys/hxffngKIBke/Test/thing/service/property/set",2

说明：订阅平台下发属性设置的主题，0为MQTT客户端标识符，1为数据包标识符，

"/sys/hxffngKIBke/Test/thing/service/property/set"为订阅的主题名称，2为QoS级别。其中hxffngKIBke为产品id，Test为设备名称。

预期响应：OK   +QMTSUB: 0,1,0,1

![](https://i-blog.csdnimg.cn/direct/4266409585da40dca58676b625657f90.png)

10.发布MQTT消息

发送指令：

AT+QMTPUBEX=0,0,0,0,"/sys/hxffngKIBke/Test/thing/event/property/post",42

说明：准备发布MQTT消息到指定主题长度42字节）。

预期响应：>

此时发送数据：{"id":"123","params":{"temperature":22.8}}

最终响应：OK  +QMTPUBEX: 0,0,0

![](https://i-blog.csdnimg.cn/direct/c31b05f03c674ba391ec433b9233573b.png)

阿里云平台数据交互操作：

数据上报成功后，可通过阿里云平台实时查看数据：

在平台控制台找到已创建的设备后，点击“查看”进入设备详情页，再点击“物模型数据”即可直观查看设备成功上报的实时数据。

![](https://i-blog.csdnimg.cn/direct/eb46098212f34f8fb2a9e8e2b993b4d5.png)

平台数据下发操作

在左侧导航栏中选择【监控运维】→【在线调试】，然后选择需要调试的设备。

![](https://i-blog.csdnimg.cn/direct/9448b522b61f4329854402830ecc8919.png)

在串口调试助手中，可实时监控设备接收数据的状态：

![](https://i-blog.csdnimg.cn/direct/08b45980780448338b211a0785c83d15.png)

总结命令流程

```
ATI

AT+CIMI

AT+QCCID

AT+CSQ

AT+CGATT?

AT+QMTCFG="version",0,4

AT+QMTOPEN=0,"hxffngKIBke.iot-as-mqtt.cn-shanghai.aliyuncs.com",1883

AT+QMTCONN=0,"hxffngKIBke.Test|securemode=3,signmethod=hmacsha1,timestamp=1751339070|","Test&hxffngKIBke","84297ce7e265491701621b69449f8c29f007cf33"

AT+QMTSUB=0,1,"/sys/hxffngKIBke/Test/thing/service/property/set",2

AT+QMTPUBEX=0,0,0,0,"/sys/hxffngKIBke/Test/thing/event/property/post",42

{"id":"123","params":{"temperature":22.8}}
```

Token获取连接：https://pan.baidu.com/s/1IKtgH-Agr-Aq7PDhgSDzxw?pwd=sn6k 提取码: sn6k



