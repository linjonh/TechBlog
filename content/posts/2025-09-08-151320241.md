---
layout: post
title: "å¾®ä¿¡ç¾¤æœºå™¨äºº-å¤‡ä»½æ–‡ä»¶å‘é€é€šçŸ¥"
date: 2025-09-08T13:20:20+0800
description: "$error_count -gt 0 ] &amp;&amp; echo -e &quot;\\n**å¤±è´¥è¯¦æƒ…**:\\n${error_messages[@]//$&#x27;\\n&#x27;/\\\\n}&quot;[ &quot;$result&quot; == &quot;ok&quot; ] &amp;&amp; echo &quot;âœ… é€šçŸ¥å‘é€æˆåŠŸ&quot; || echo &quot;âŒ é€šçŸ¥å‘é€å¤±è´¥: $result&quot;&quot;${WX_ROBOT_URL}&quot; | jq -r &#x27;.errmsg // &quot;æœªçŸ¥é”™è¯¯&quot;&#x27;&gt; **åŒæ­¥æ—¶é—´**: $(date &quot;+%Y-%m-%d %H:%M:%S&quot;)echo -e &quot;\\nğŸ æ‰€æœ‰æ“ä½œå·²å®Œæˆ&quot;"
keywords: "å¾®ä¿¡ç¾¤æœºå™¨äºº-å¤‡ä»½æ–‡ä»¶å‘é€é€šçŸ¥"
categories: ['æœªåˆ†ç±»']
tags: ['ä¼ä¸šå¾®ä¿¡', 'Git', 'Bash']
artid: "151320241"
arturl: "https://blog.csdn.net/kevin_cat/article/details/151320241"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151320241
    alt: "å¾®ä¿¡ç¾¤æœºå™¨äºº-å¤‡ä»½æ–‡ä»¶å‘é€é€šçŸ¥"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151320241
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151320241
cover: https://bing.ee123.net/img/rand?artid=151320241
image: https://bing.ee123.net/img/rand?artid=151320241
img: https://bing.ee123.net/img/rand?artid=151320241
---



# å¾®ä¿¡ç¾¤æœºå™¨äºº-å¤‡ä»½æ–‡ä»¶å‘é€é€šçŸ¥

#!/bin/bash

# é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆä¸ä¼ä¸šå¾®ä¿¡é…ç½®åˆ†ç¦»ï¼‰  
CONFIG_FILE="$(dirname "$0")/git_pull_config.env"

# åŠ è½½é…ç½®æ–‡ä»¶  
if [ -f "$CONFIG_FILE" ]; then  
Â  Â  source "$CONFIG_FILE"  
else  
Â  Â  WX_ROBOT_URL="https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx" Â # é»˜è®¤ä¸å‘é€é€šçŸ¥  
fi

# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„  
repos_path="$(cd "$(dirname "$0")" && pwd)"

# åˆå§‹åŒ–ç»Ÿè®¡å˜é‡ï¼ˆé¿å…å­ Shell ä½œç”¨åŸŸé—®é¢˜ï¼‰  
declare -i total_repos=0 success_count=0 error_count=0  
declare -a error_messages=()

# å…³é”®ä¿®å¤ï¼šä½¿ç”¨è¿›ç¨‹æ›¿æ¢é¿å…å­ Shell å˜é‡ä¸¢å¤±  
while IFS= read -r gitdir; do  
Â  Â  ((total_repos++))  
Â  Â  project_dir=$(dirname "$gitdir")  
Â  Â  echo -e "\n[ START ] åŒæ­¥ä»“åº“: $project_dir"

Â  Â  # æ‰§è¡Œ git pull å¹¶æ•è·è¾“å‡º  
Â  Â  exec_output=$(cd "$project_dir" && git pull 2>&1)  
Â  Â  exec_status=$?

Â  Â  # è®°å½•æ‰§è¡Œç»“æœ  
Â  Â  if [ $exec_status -eq 0 ]; then  
Â  Â  Â  Â  ((success_count++))  
Â  Â  else  
Â  Â  Â  Â  ((error_count++))  
Â  Â  Â  Â  error_messages+=("ã€å¤±è´¥ã€‘$project_dir\n<pre>${exec_output}</pre>")  
Â  Â  fi  
done < <(find "$repos_path" -type d -name .git) Â # ä½¿ç”¨è¿›ç¨‹æ›¿æ¢

# æ„å»ºä¼ä¸šå¾®ä¿¡é€šçŸ¥å†…å®¹  
build_notification() {  
Â  Â  local status_icon="âœ…"  
Â  Â  [ $error_count -gt 0 ] && status_icon="âš ï¸"

Â  Â  cat <<EOF  
**Git åŒæ­¥å®Œæˆé€šçŸ¥** ${status_icon}  
> **åŒæ­¥æ—¶é—´**: $(date "+%Y-%m-%d %H:%M:%S")  
> **æ‰«æç›®å½•**: \`${repos_path}\`  
> **ä»“åº“æ€»æ•°**: ${total_repos}  
> **æˆåŠŸæ•°é‡**: ${success_count}  
> **å¤±è´¥æ•°é‡**: ${error_count}  
EOF

Â  Â  [ $error_count -gt 0 ] && echo -e "\n**å¤±è´¥è¯¦æƒ…**:\n${error_messages[@]//$'\n'/\\n}"  
}

# å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥ï¼ˆæ”¯æŒ Markdownï¼‰  
send_wx_notification() {  
Â  Â  local content=$(build_notification | jq -Rs .)  
Â  Â  local json_payload=$(cat <<EOF  
{  
Â  Â  "msgtype": "markdown",  
Â  Â  "markdown": {  
Â  Â  Â  Â  "content": ${content}  
Â  Â  }  
}  
EOF  
)

Â  Â  curl -sSL \  
Â  Â  Â  Â  -H "Content-Type: application/json" \  
Â  Â  Â  Â  -d "${json_payload}" \  
Â  Â  Â  Â  "${WX_ROBOT_URL}" | jq -r '.errmsg // "æœªçŸ¥é”™è¯¯"'  
}

# æ‰§è¡Œé€šçŸ¥ï¼ˆå½“é…ç½®æœ‰æ•ˆæ—¶ï¼‰  
if [[ -n "$WX_ROBOT_URL" && "$WX_ROBOT_URL" == *qyapi.weixin.qq.com* ]]; then  
Â  Â  echo -e "\nğŸ”„ æ­£åœ¨å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥..."  
Â  Â  result=$(send_wx_notification)  
Â  Â  [ "$result" == "ok" ] && echo "âœ… é€šçŸ¥å‘é€æˆåŠŸ" || echo "âŒ é€šçŸ¥å‘é€å¤±è´¥: $result"  
else  
Â  Â  echo -e "\nâš ï¸ æœªé…ç½®æœ‰æ•ˆä¼ä¸šå¾®ä¿¡æœºå™¨äººï¼Œè·³è¿‡é€šçŸ¥"  
fi

echo -e "\nğŸ æ‰€æœ‰æ“ä½œå·²å®Œæˆ"



