---
layout: post
title: "IoT智能单品设计一款基于涂鸦智能IoT云平台的新型智能蓝牙水杯"
date: 2022-03-29 19:31:47 +0800
description: "本文介绍了设计一款基于涂鸦智能IoT云平台的智能蓝牙水杯的过程，产"
keywords: "使用ccs3实现一个小水杯案例"
categories: ['送源码', '嵌入式物联网实战项目精选']
tags: ['物联网', '涂鸦智能', '智能水杯', '智能单品', 'Iot']
artid: "123825019"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123825019
    alt: "IoT智能单品设计一款基于涂鸦智能IoT云平台的新型智能蓝牙水杯"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123825019
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123825019
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【IoT智能单品设计】一款基于涂鸦智能IoT云平台的新型智能蓝牙水杯
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#1__4" rel="nofollow">
        1 前言
       </a>
      </li>
      <li>
       <a href="#2__12" rel="nofollow">
        2 产品构思
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#21__18" rel="nofollow">
          2.1 产品名称
         </a>
        </li>
        <li>
         <a href="#22__22" rel="nofollow">
          2.2 产品主要解决的问题
         </a>
        </li>
        <li>
         <a href="#23__30" rel="nofollow">
          2.3 产品的创新功能点
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#3__40" rel="nofollow">
        3 产品原型
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#31__44" rel="nofollow">
          3.1 云平台选型
         </a>
        </li>
        <li>
         <a href="#32__60" rel="nofollow">
          3.2 智能单品的创建
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#4__82" rel="nofollow">
        4 产品开发
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#41__86" rel="nofollow">
          4.1 硬件设计
         </a>
        </li>
        <li>
         <a href="#42__152" rel="nofollow">
          4.2 软件设计
         </a>
        </li>
        <li>
         <a href="#43__250" rel="nofollow">
          4.3 功能调试
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#5__276" rel="nofollow">
        5 产品功能展示
       </a>
      </li>
      <li>
       <a href="#6__286" rel="nofollow">
        6 产品功能拓展
       </a>
      </li>
      <li>
       <a href="#7__294" rel="nofollow">
        7 结束语
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="1__4">
     </a>
     1 前言
    </h2>
    <p>
     近些年来，随着科技的更新迭代，IoT行业迎来了一个快速膨胀发展的窗口期，我们随之可见的是，越来越多的智能化产品进入到了我们的日常生活中，包括发展比较早的
     <strong>
      智能家居
     </strong>
     类产品、
     <strong>
      智能家电
     </strong>
     类产品，还有近些年非常火热的
     <strong>
      智能穿戴
     </strong>
     类产品，这些都得到了市场很好的反馈。
    </p>
    <p>
     在都市日常生活工作中，通常的节奏都比较快，有数据统计中国有近75%的人都处于 “
     <strong>
      亚健康”
     </strong>
     状态，每个人都或多或少会有这样那样的健康问题。随着大家对健康问题的关注度提高，在智能IoT领域，也出现了越来越多有关
     <strong>
      运动健康
     </strong>
     类的智能单品，这些单品的功能核心都是针对某个日常的健康隐患，提供一套智能化的解决方案，使得人们在享受科技便捷的同时，也提升了自己的健康状态。
    </p>
    <blockquote>
     <p>
      PS：本项目所需要开发资料和相关硬件物料可以戳
      <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
       <strong>
        这里
       </strong>
      </a>
      .
     </p>
    </blockquote>
    <h2>
     <a id="2__12">
     </a>
     2 产品构思
    </h2>
    <p>
     结合当下的市场需求，综合分析各类健康问题的相关数据，我认为日常
     <strong>
      健康饮水
     </strong>
     问题，是一个具有可观前景的智能化单品方向。一方面涉及饮水问题，这是每个人每天都绕不开的话题，所以这是一个有群众基础的产品；另一方面，的确有很多人包括我自己会因为各种各样的原因，使得没法保证每一天的饮水摄入量，这个在一定程度上会加剧一些慢性病的爆发。
    </p>
    <p>
     随着大家对健康意识的苏醒和认知的提升，越来越多的人愿意为自己的健康问题买单。正是基于这样的市场调研考虑，我的想法是设计一款新型智能化水杯，着重解决人们日常的饮水健康问题。
    </p>
    <h3>
     <a id="21__18">
     </a>
     2.1 产品名称
    </h3>
    <p>
     饮水健康类的智能单品：
     <strong>
      一款基于蓝牙通讯的新型智能化水杯
     </strong>
    </p>
    <h3>
     <a id="22__22">
     </a>
     2.2 产品主要解决的问题
    </h3>
    <p>
     主要解决办公室白领、年轻情侣及独居老人的健康饮水问题：
    </p>
    <ul>
     <li>
      作为办公室白领，由于工作性质属于比较忙的那一种，常常会因为
      <strong>
       忙
      </strong>
      ，而忘记补充一定量的饮水，这样导致的问题就是每天无法保证摄入足量的水分，加上办公室环境本身就是一个
      <strong>
       久坐
      </strong>
      的姿态，长此以往容易引发健康问题；
     </li>
     <li>
      作为独居老人，往往年纪比较大，记性较差，时常会忘记喝水；同时可能眼睛不好使或者耳朵不好使，对普通水杯的容量和温度不容易判断，因此引入智能水杯的智能功能很有必要，有助于帮忙独居老人在一定程度上解决喝水的健康问题；
     </li>
     <li>
      作为情侣，时常需要使用各种秀恩爱的手段来表达爱意，智能水杯独创的情侣模式，可以很好地解决这个问题。
     </li>
    </ul>
    <h3>
     <a id="23__30">
     </a>
     2.3 产品的创新功能点
    </h3>
    <ul>
     <li>
      支持自定义定时提醒喝水的功能；
     </li>
     <li>
      支持联网统计分析，智能分析一段时间内的饮水健康问题；
     </li>
     <li>
      支持屏显水容量和水温；
     </li>
     <li>
      支持语音播报水容量和水温；
     </li>
     <li>
      支持用户群体设定（老年人、办公室白领、儿童等人群分类）；
     </li>
     <li>
      首创
      <strong>
       关怀模式
      </strong>
      ，智能水杯可以在子女和老人的账户下共享，当
      <strong>
       关怀模式
      </strong>
      开始时，子女的账户可远程操作APP达到及时查看并提醒老人喝水的功能；
     </li>
     <li>
      <strong>
       关怀模式
      </strong>
      的升级版本：
      <strong>
       情侣模式
      </strong>
      ，主要适用于年轻的情侣直接，支持一方直接发起即时语音提醒，达到秀恩爱的目的。
     </li>
    </ul>
    <h2>
     <a id="3__40">
     </a>
     3 产品原型
    </h2>
    <p>
     一个好的产品点子从脑海中诞生，到真正能够以最快的速度打入市场，并能够获得不错的口碑，它的原型设计就显得非常重要；同时，这个产品搭在一个什么样的平台上，也是一个非常值得调研和考究的问题。
    </p>
    <h3>
     <a id="31__44">
     </a>
     3.1 云平台选型
    </h3>
    <p>
     在国内主流的IoT云平台有阿里云平台、腾讯云平台、京东云平台、小米云平台、华为云平台，还有就是涂鸦云平台。
    </p>
    <p>
     每家云平台各具特色，各有千秋，这其中阿里云平台相对创立较早，发展也较为成熟，主要是围绕天猫精灵为核心打造全景式智能方案。
    </p>
    <p>
     相对于阿里云平台，涂鸦云平台的最大特色是采取
     <strong>
      标准模块化开发规则
     </strong>
     ，实现行业标品的标准化；这样的好处对于产品开发者来说，可以大幅降低研发成本和周期，同时也大大降低开发门槛，快速实现产品智能化。
    </p>
    <p>
     正是基于这种标品的开发能力，我们可以看到在涂鸦的开发者云平台上可以看到大量的行业标品，几乎覆盖到了我们所能见到的智能单品，这无疑给开发者带了极大的便利。同时，涂鸦开发者云平台上，具有非常丰富的开发文档，包括设备终端侧的SDK、手机APP端侧的SDK、云端的SDK等等都有完备的支持，这对于看重二次开发的开发者也是一个非常不错的福音。
    </p>
    <p>
     IoT领域的智能单品正在爆发式发展，随之带来的问题就是，产品功能、品质无法建立标准化，而涂鸦智能的出现，正是为了很好地解决这个痛点，我们也希望这个方向能够持续深化下去，让我们能够在涂鸦云平台能够看到更多的标品，这样我们就有更多的思路和方向去打造属于自己的智能单品。
    </p>
    <p>
     综上的几个因素，我这个智能水杯单品，我就选用了
     <a href="https://developer.tuya.com/cn/" rel="nofollow">
      涂鸦IoT云平台
     </a>
     。
    </p>
    <p>
     <img alt="image-20220322004229284" src="https://i-blog.csdnimg.cn/blog_migrate/7bcbb8834fd5526e1ed528f2976c7b21.png"/>
    </p>
    <h3>
     <a id="32__60">
     </a>
     3.2 智能单品的创建
    </h3>
    <p>
     选定了涂鸦IoT云平台之后，我就可以在涂鸦的
     <a href="https://iot.tuya.com/" rel="nofollow">
      IoT云平台
     </a>
     可以快速地
     <a href="https://developer.tuya.com/cn/product-development" rel="nofollow">
      创建
     </a>
     我需要的智能单品：
    </p>
    <p>
     <img alt="image-20220322005119693" src="https://i-blog.csdnimg.cn/blog_migrate/b8ad2cc039d2091f8d044c557c78ea4c.png"/>
    </p>
    <p>
     <img alt="image-20220322004751878" src="https://i-blog.csdnimg.cn/blog_migrate/c3c2d801e119c318198bee1d0a47b9d8.png"/>
    </p>
    <p>
     <img alt="image-20220322004836593" src="https://i-blog.csdnimg.cn/blog_migrate/7843a88d45a69a2cde27b4193840ffeb.png"/>
    </p>
    <p>
     <img alt="image-20220322005029386" src="https://i-blog.csdnimg.cn/blog_migrate/4c6bb795d52f653ce7a1b73381f0f07a.png"/>
    </p>
    <p>
     <img alt="image-20220329193453795" src="https://i-blog.csdnimg.cn/blog_migrate/05724c061da7b908248c92d2251b9c59.png"/>
    </p>
    <p>
     <img alt="image-20220322005239037" src="https://i-blog.csdnimg.cn/blog_migrate/1b6e053cd0daca5f348ea2a930622b01.png"/>
    </p>
    <p>
     <img alt="image-20220322005336864" src="https://i-blog.csdnimg.cn/blog_migrate/09ba07f374e0116abcde43a6cbb4e496.png"/>
    </p>
    <p>
     更多的介绍文档，大家可以参考
     <a href="https://developer.tuya.com/cn/product-development" rel="nofollow">
      这里
     </a>
     ，更多的智能单品案例，可以从
     <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
      这里
     </a>
     多一份了解。
    </p>
    <blockquote>
     <p>
      PS：本项目所需要开发资料和相关硬件物料可以戳
      <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
       <strong>
        这里
       </strong>
      </a>
      .
     </p>
    </blockquote>
    <h2>
     <a id="4__82">
     </a>
     4 产品开发
    </h2>
    <p>
     整个产品开发分为两大部分：硬件部分和软件部分。在硬件部分呢，由于涂鸦只提供标准化的模组（Wi-Fi模块或蓝牙模组等），它并不提供具体的MCU选型以及对应传感器相关的选型，这些就需要智能单品开发根据自己的实际情况，自行完成选型。
    </p>
    <h3>
     <a id="41__86">
     </a>
     4.1 硬件设计
    </h3>
    <p>
     有了基本的IoT云平台选型之后，下一步着重要进行的就是硬件部分的选型。
    </p>
    <p>
     硬件选型遵循的原则应该是：尽可能选用成熟的硬件方案，选用的硬件型号应略高于满足你的功能需求，即留有冗余空间，尽可能考虑使用易开发的组件。
    </p>
    <ul>
     <li>
      <p>
       <strong>
        主控模块
       </strong>
      </p>
      <p>
       主控模块我选用的是开发者最容易上手的增强型
       <strong>
        <a href="https://baike.baidu.com/item/STC12C5A60S2/10969771" rel="nofollow">
         STC12C5A60S2
        </a>
       </strong>
       ，它是宏晶科技生产的单时钟/机器周期(1T)的单片机，是高速/低功耗/超强抗干扰的新一代
       <a href="https://baike.baidu.com/item/8051%E5%8D%95%E7%89%87%E6%9C%BA/10816098" rel="nofollow">
        8051单片机
       </a>
       ，指令代码完全兼容传统8051,但速度快8-12倍。对比传统的51单片机，它有非常显著的技术优势：
      </p>
      <p>
       <img alt="image-20220322011329833" src="https://i-blog.csdnimg.cn/blog_migrate/53ef5c65f509e4bfec18c3aeb5ca4af0.png"/>
      </p>
      <p>
       <img alt="image-20220322014709519" src="https://i-blog.csdnimg.cn/blog_migrate/d83e57db4f0e693dc727749b2c371465.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        蓝牙通讯模块
       </strong>
      </p>
      <p>
       这里选用的涂鸦的
       <strong>
        <a href="https://developer.tuya.com/cn/docs/iot/br3l?id=K97rpns8f6xwh" rel="nofollow">
         BT3L
        </a>
       </strong>
       的的蓝牙模组，它极具性价比，在基于蓝牙的智能单品上应用非常广泛，它的基本资料如下：
      </p>
      <p>
       <img alt="image-20220322010929419" src="https://i-blog.csdnimg.cn/blog_migrate/1d3460141155e5044282c8c2d80992cf.png"/>
      </p>
      <p>
       <img alt="image-20220322015056213" src="https://i-blog.csdnimg.cn/blog_migrate/74417a8084f44fc312f3a2a184d2903f.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        OLED显示模块
       </strong>
      </p>
      <p>
       这里为了在产品中显示相关的基础数据，包括当前水杯温度、蓝牙连接状态、定时喝水提醒倒计时、电池电量、本地计时、杯中水量、已喝水量、目标水量等等。
      </p>
      <p>
       考虑成本和接口设计等因素，我采用的是由 SSD1306 芯片驱动的9.6寸的OLED。
      </p>
      <p>
       OLED 由于同时具备自发光，不需背光源、对比度高、厚度薄、视角广、反应速度快、可用于挠曲性面板、使用温度范围广、构造及
      </p>
      <p>
       制程较简单等优异之特性，被认为是下一代的平面显示器新兴应用技术。同比之下LCD 都需要背光，而 OLED 不需要，因为它是自发光的，这样的话同样的显示， OLED 效果要来得好一些。
      </p>
      <p>
       <img alt="image-20220322012925451" src="https://i-blog.csdnimg.cn/blog_migrate/4222a1b126591b95221a05cad8f6b5d3.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        按键模块
       </strong>
      </p>
      <p>
       按键这部分相对比较简单，我直接采用的是点触式非自锁开关；主要是配合应用做一些简单的功能切换；比如短按的时候切换屏幕开和关，长按的时候复位蓝牙模组，进入配网流程等。
      </p>
      <p>
       <img alt="image-20220322014630680" src="https://i-blog.csdnimg.cn/blog_migrate/35d22a44b8aaf947e9834a19732eee85.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        温度传感器模块
       </strong>
      </p>
      <p>
       温度传感器主要的用途是测量水杯的温度，以便于展示真实的水温度。这里我选用的是
       <a href="https://baike.baidu.com/item/DS18B20" rel="nofollow">
        DS18B20数字温度传感器
       </a>
       。
      </p>
      <p>
       DS18B20是常用的数字温度传感器，其输出的是数字信号，具有体积小，硬件开销低，抗干扰能力强，精度高的特点。 [1] DS18B20数字温度传感器接线方便，封装成后可应用于多种场合，如管道式，螺纹式，磁铁吸附式，不锈钢封装式，型号多种多样，有LTM8877，LTM8874等等。
      </p>
      <p>
       主要根据应用场合的不同而改变其外观。封装后的DS18B20可用于电缆沟测温，高炉水循环测温，锅炉测温，机房测温，农业大棚测温，洁净室测温，弹药库测温等各种非极限温度场合。耐磨耐碰，体积小，使用方便，封装形式多样，适用于各种狭小空间设备数字测温和控制领域。
      </p>
      <p>
       <img alt="img" src="https://i-blog.csdnimg.cn/blog_migrate/18bd773c2bf68ec96dec7dcd6710268a.gif"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        RTC时钟模块
       </strong>
      </p>
      <p>
       RTC时钟作为一个本地计时的模块而存在，我选用的是非常经典的RTC模块：
       <a href="https://baike.baidu.com/item/DS1302" rel="nofollow">
        DS1302
       </a>
       。
      </p>
      <p>
       DS1302 是美国DALLAS公司推出的一种高性能、低功耗、带RAM的实时时钟电路，它可以对年、月、日、周、时、分、秒进行计时，具有闰年补偿功能，工作电压为2.0V～5.5V。采用三线接口与CPU进行同步通信，并可采用突发方式一次传送多个字节的时钟信号或RAM数据。
      </p>
      <p>
       <img alt="image-20220322013903843" src="https://i-blog.csdnimg.cn/blog_migrate/c85865842faebd0e03eef6d7b9e00aae.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        压力传感器模块
       </strong>
      </p>
      <p>
       重力/压力传感器主要是用于测量水杯的整体重量，通过密度、体积、质量三者的数量关系，从而得出水容量的一种方法。
      </p>
      <p>
       这里我选用的是
       <a href="https://baike.baidu.com/item/HX711" rel="nofollow">
        HX711
       </a>
       ：它是一款专为高精度电子秤而设计的24位A/D转换器芯片与同类型其它芯片相比，该芯片集成了包括稳压电源、片内时钟振荡器等其它同类型芯片所需要的外围电路，具有集成度高、响应速度快、抗干扰性强等优点。降低了电子秤的整机成本，提高了整机的性能和可靠性。该芯片与后端MCU 芯片的接口和编程非常简单，所有控制信号由管脚驱动，无需对芯片内部的寄存器编程。
      </p>
      <p>
       <img alt="image-20220322014524191" src="https://i-blog.csdnimg.cn/blog_migrate/fb3ee31db2b338e5caabe4170df55da3.png"/>
      </p>
     </li>
    </ul>
    <h3>
     <a id="42__152">
     </a>
     4.2 软件设计
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        代码整体框架
       </strong>
      </p>
      <p>
       <img alt="image-20220322010523711" src="https://i-blog.csdnimg.cn/blog_migrate/50b09eb9f4adfc817ae2ffcb8c03cfc6.png"/>
      </p>
     </li>
     <li>
      <p>
       <strong>
        MCU主控
       </strong>
      </p>
     </li>
    </ul>
    <p>
     主控部分的软件代码，采用的是STC12C5A60S2这块增强型的51单片机，它的软件开发完全兼容传统的51单片机，它的开发特定就是易上手，IO口丰富，外设也相对丰富，基本满足我需要的功能需求。
    </p>
    <p>
     在这个项目，我主要使用它的以下几个部分：定时器、双串口（一个串口日志调试、另一个串口与蓝牙通讯）、ADC、标准的GPIO、E2PROM等。至于其他几个外设传感器，均采用的GPIO做通讯协议的模拟。
    </p>
    <p>
     值得注意的是，由于我是一个Linux编译环境的重度依赖者，我实在没法忍受KEIL那蛋疼的编译的IDE环境，所以我查找网上的资料，自行搭建了基于
     <a href="http://sdcc.sourceforge.net/" rel="nofollow">
      SDCC
     </a>
     的编译环境，完美实现Linux环境下编译51单片机。这块相关的教程，我回头整理下，再发出来大家讨论讨论。
    </p>
    <p>
     <img alt="image-20220328210232079" src="https://i-blog.csdnimg.cn/blog_migrate/435c93d80beb0ac1c1b9c04fcfaa892d.png"/>
    </p>
    <p>
     以下便是我的代码的内容的展示，感兴趣可以到我的gitee找相关的开源代码。
    </p>
    <p>
     <img alt="image-20220322011819840" src="https://i-blog.csdnimg.cn/blog_migrate/044d425348978a3ff2094e5f894594ad.png"/>
    </p>
    <ul>
     <li>
      <p>
       <strong>
        蓝牙通讯
       </strong>
      </p>
      <p>
       蓝牙通讯这部分的软件代码其实分为两部分：蓝牙模组的固件代码和MCU侧对接蓝牙模组的软件代码。由于我这是在涂鸦云平台上直接创建产品，模组直接选用的是涂鸦提供的标准蓝牙模组，所以蓝牙模组这部分的固件代码，我是不用开发的，而需要开发的仅仅是通过简单的串口协议跟蓝牙模块就能够对接起来。类似下边这张图的左半部分所展示的这样：
      </p>
      <p>
       <img alt="MCU 低代码开发" src="https://i-blog.csdnimg.cn/blog_migrate/a712d9381e2bc542618caaba3170727b.png"/>
      </p>
      <p>
       关于这种开发方式，涂鸦叫
       <strong>
        “MCU低代码开发”
       </strong>
       ，详尽的介绍可以参考
       <a href="https://developer.tuya.com/cn/docs/iot/mcu-access-guide?id=K9hrbv1ub5owo" rel="nofollow">
        这里
       </a>
       。
      </p>
      <blockquote>
       <p>
        PS：本项目所需要开发资料和相关硬件物料可以戳
        <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
         <strong>
          这里
         </strong>
        </a>
        .
       </p>
      </blockquote>
     </li>
     <li>
      <p>
       <strong>
        涂鸦的MCU侧SDK移植
       </strong>
      </p>
      <p>
       在涂鸦的IoT云平台上创建了对应的智能单品后，云平台会自动创建对应的MCU侧参考SDK，这个SDK中将对应产品的功能属性、物模型数据都固话在里面了，并且SDK内部已经很好地实现了MCU和蓝牙模组的对接，当收到蓝牙模组的数据传递时，自动进行处理。
      </p>
      <p>
       在适配的过程中，只需要根据SDK包中的参考文档，将MCU侧几个核心的跟串口收发的接口适配好后，整一个与蓝牙模组的通讯功能就可以跑起来了。
      </p>
      <p>
       这时，通过SDK包中的mcu_api.h的接口就可以实现对蓝牙模组的各种操作了。
      </p>
      <p>
       <img alt="image-20220322020641422" src="https://i-blog.csdnimg.cn/blog_migrate/7881507a9b6b2b3dee74bbc3bcc3f5e6.png"/>
      </p>
      <p>
       更为详尽的移植步骤，可以参考
       <a href="https://developer.tuya.com/cn/docs/iot/mcu-sdk-migration-guide?id=K9fs77cw2vy27" rel="nofollow">
        这里
       </a>
       。
      </p>
     </li>
     <li>
      <p>
       <strong>
        基础外设
       </strong>
      </p>
      <ul>
       <li>
        <p>
         <strong>
          按键触发
         </strong>
        </p>
        <p>
         为了简单处理，本项目中采用的简单的GPIO实现单点按键的功能；同时，为了实现单个按键短按和长按的对应不同的功能，在按键处理代码中，增加了按键状态机的处理模型，有效地区分按键短按和长按状态。
        </p>
        <p>
         <img alt="image-20220322020910380" src="https://i-blog.csdnimg.cn/blog_migrate/ac96d514a65705f9c6ce10899cb386b3.png"/>
        </p>
       </li>
       <li>
        <p>
         <strong>
          OLED显示
         </strong>
        </p>
        <p>
         OLED采用的是I2C串行数据协议，考虑到GPIO的分布，本项目采用的是GPIO软件模拟I2C洗衣的方式，通过对不同寄存器的读写封装，可以实现对OLED区域的显示；同时配合字模制作软件，可以生成中文字模以及自定义的各式各样的图形和符号，极大地方便了显示的多样性。
        </p>
        <p>
         <img alt="image-20220322021945646" src="https://i-blog.csdnimg.cn/blog_migrate/0ad912eb9e9f4824adc692c2028566f1.png"/>
        </p>
       </li>
       <li>
        <p>
         <strong>
          温度传感器测温
         </strong>
        </p>
        <p>
         DS18B20温度传感器采用的是单数据线串行协议，切换单数据线的电平切换实现对温度信息的采集，经过合理的转换运算后，得到一个比较精确的水杯温度值，用于展示在显示屏上。
        </p>
        <p>
         <img alt="image-20220329165326991" src="https://i-blog.csdnimg.cn/blog_migrate/771b9ec7d77d78b9aff3c5e088fbb62e.png"/>
        </p>
       </li>
       <li>
        <p>
         <strong>
          压力传感器测水容量
         </strong>
        </p>
        <p>
         压力传感器用于检测水的容量，这是一个间接的测量方法，先通过压力（重力）传感器测得不同水容量下的重量，得出不能容量下的重量分布表；在真正的测量中，将取得的重量数据对照水容量表格，大致可以得出对应的水容量，从而做水量的数据展示。
        </p>
        <p>
         <img alt="image-20220322022628462" src="https://i-blog.csdnimg.cn/blog_migrate/70c375f119da2b1a9719c8ff599cf6e3.png"/>
        </p>
       </li>
       <li>
        <p>
         <strong>
          RTC本地时钟
         </strong>
        </p>
        <p>
         RTC时钟，采用的是自定义的串行数据协议，通过RST、IO、SCK三线的变化，可以准确地实现对RTC时钟的读和写；同时该模块是采用纽扣电池长供电的，所以可以长时间保持时钟的有效性。
        </p>
        <p>
         <img alt="image-20220322021914939" src="https://i-blog.csdnimg.cn/blog_migrate/82c2e508131b06ae157f69c22917a38d.png"/>
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        电池电量检测
       </strong>
      </p>
      <p>
       本产品由锂电池或干锰电池供电，借助MCU侧自带的ADC通道，可以很快地测出供电电压。由于STC12C5A60S2的ADC内部参考电压就是供电电压VCC，所以必须借助2路ADC通道，其中一路外接一个参考电压，然后根据等比关系计算出供电电压VCC。
      </p>
      <p>
       比如外部参考电压是V1 = 1.0V，对应这路ADC测量的电压值为V11；而另一路ADC测量出来的电压值为V12。他们与VCC的等比关系是：
       <strong>
        VCC / V12 = V1 / V11
       </strong>
      </p>
      <p>
       由此可计算出：
       <strong>
        VCC = V1 * V12 / V11
       </strong>
      </p>
      <p>
       再结合VCC电压和锂电池的降压特性，初步得出当前的电量百分比，随后送到屏幕展示。
      </p>
     </li>
     <li>
      <p>
       <strong>
        基础的应用逻辑
       </strong>
      </p>
      <p>
       这里的基础应用逻辑有包括以下几点：
      </p>
      <ul>
       <li>
        <strong>
         设备复位和设备配网
        </strong>
        ：当按键长按3秒以上时，则触发蓝牙设备的解绑，所有本地数据都讲复位到默认值，同时蓝牙设备再次发起广播，等到手机APP的自动发现，以及发起后续的设备配网操作。
       </li>
       <li>
        <strong>
         饮水提醒
        </strong>
        ： 当手机APP端下发的饮水提醒时间已到，则整个OLED屏幕开始1秒钟开灭一次，直到检测到一次新的喝水动作。
       </li>
       <li>
        <strong>
         饮水动作的检测
        </strong>
        ：当水杯水容量，前后的变化锐减20ml以上，则认为是一次有效的喝水动作，此时
        <strong>
         已喝水量
        </strong>
        会增加对应的喝水量，同时喝水次数会加1，且会上报一次全量数据。
       </li>
       <li>
        <strong>
         本地数据定时上报
        </strong>
        ：本地的数据，每个5秒钟会触发上报，同时观察手机APP，即可看到数据的变化。
       </li>
       <li>
        <strong>
         蓝牙连接状态显示
        </strong>
        ：蓝牙有3种状态，0状态对应的是设备未绑定，此时蓝牙图标每秒钟闪烁一次；1状态对应已绑定但未连接手机，此时蓝牙图标3秒钟闪烁一次；2状态表示正常已绑定已连接状态，测试蓝牙图标常态化一直显示。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        代码开源
       </strong>
      </p>
     </li>
    </ul>
    <p>
     本产品的相关代码已
     <strong>
      开源
     </strong>
     在gitee，感兴趣的童鞋，可以
     <a href="https://gitee.com/recan-li/smart-cup" rel="nofollow">
      戳这里
     </a>
     获得更多内容。
    </p>
    <h3>
     <a id="43__250">
     </a>
     4.3 功能调试
    </h3>
    <ul>
     <li>
      <strong>
       模拟调试
      </strong>
     </li>
    </ul>
    <p>
     涂鸦
     <strong>
      模组调试助手
     </strong>
     是一个集成了云模组通讯协议的串口调试工具，常用于
     <a href="https://developer.tuya.com/cn/docs/iot/mcu-access-guide?id=K9hrbv1ub5owo" rel="nofollow">
      MCU 低代码开发
     </a>
     方案的开发调试。模组调试助手集成了包括 Wi-Fi、蓝牙、Zigbee、NB-IoT 等云模组常用串口协议，既可以模拟模组验证 MCU 代码逻辑，也可以模拟 MCU 调试配网功能。
    </p>
    <p>
     这个助手很好地解决了产品设计前期的快速落地验证和原型规划，也极大地方便了在实际开发过程中遇到数据通讯问题时的调试手段，可以比较快地定位和解决问题。
    </p>
    <p>
     <img alt="image-20220321235520767" src="https://i-blog.csdnimg.cn/blog_migrate/9f133fe421b9131582db1ebf101adef2.png"/>
    </p>
    <p>
     关于模组调试助手的详尽介绍，可以
     <a href="https://developer.tuya.com/cn/docs/iot/network-module-overview?id=Ka4z12ojepber" rel="nofollow">
      戳这里
     </a>
     。
    </p>
    <ul>
     <li>
      <strong>
       设备调试
      </strong>
     </li>
    </ul>
    <p>
     有了模拟调试的基础之后，就可以在开发过程中，进行真实设备的功能调试，这里采用的方式也是先从本地的基础数据入手，先把本地的基础数据调通，比如水温的探测、饮水量的检测、杯中水量的探测等等。
    </p>
    <p>
     <img alt="image-20220322015001657" src="https://i-blog.csdnimg.cn/blog_migrate/0ac5f4ad67cdb980291fefce896fdaa9.png"/>
    </p>
    <ul>
     <li>
      <strong>
       联网调试
      </strong>
     </li>
    </ul>
    <p>
     这里主要验证智能水杯的联网功能，包括与 智能生活APP的发现配对、连接，基础数据的上下行对接，智能场景联动等核心功能调试。
    </p>
    <p>
     <img alt="image-20220322015309180" src="https://i-blog.csdnimg.cn/blog_migrate/c450d6529a97c2c61176c66280bf2972.png"/>
    </p>
    <blockquote>
     <p>
      PS：本项目所需要开发资料和相关硬件物料可以戳
      <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
       <strong>
        这里
       </strong>
      </a>
      .
     </p>
    </blockquote>
    <h2>
     <a id="5__276">
     </a>
     5 产品功能展示
    </h2>
    <p>
     这里我将展示智能水杯单品的核心功能：设备发现、设备配网、设备解绑、设备绑定、设备连接/断开、基础数据的屏幕显示、人机交互的，数据的上下行，设备与智能APP的联动感应等等。
    </p>
    <p>
     <img alt="image-20220322014856704" src="https://i-blog.csdnimg.cn/blog_migrate/c3535c52402e182950c12d58e4b2747c.png"/>
    </p>
    <p>
     产品核心功能的完整演示视频，可以从这里进行观看，感兴趣的戳
     <a href="https://www.bilibili.com/video/BV1da411x7hj/" rel="nofollow">
      这里
     </a>
     。
    </p>
    <blockquote>
     <p>
      PS：本项目所需要开发资料和相关硬件物料可以戳
      <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
       <strong>
        这里
       </strong>
      </a>
      .
     </p>
    </blockquote>
    <h2>
     <a id="6__286">
     </a>
     6 产品功能拓展
    </h2>
    <p>
     由于时间投入的关系，本次开发主要集中在开发核心的功能特性上，包括基本数据的采集、数据的下发及对云端数据的响应等等。
    </p>
    <p>
     回到最开始我规划的几个特色功能，比如
     <strong>
      联网分析饮水数据、智能语音播报、设备共享、多人提醒互动
     </strong>
     等特色功能，将会在后续的产品开发中继续保持功能迭代，感兴趣的童鞋可以保持关注。
    </p>
    <p>
     <img alt="image-20220321234751883" src="https://i-blog.csdnimg.cn/blog_migrate/0657e9f239c25d39ccfbe82bc2b30bdc.png"/>
    </p>
    <h2>
     <a id="7__294">
     </a>
     7 结束语
    </h2>
    <p>
     看似一个简单的智能单品，但是，从最早的产品孵化再到产品原型的设计，再到IoT云平台、硬件模块的选型，然后进行软件开发、功能调试，这一系列的内容也是需要经过不断地思考和打磨，方可把这个智能化产品真的的落地。
    </p>
    <p>
     期间，也遇到了不少之前完全没有遇到的硬件问题、软件问题，也使用了一些以前没有调试过的传感器，问题都是一个个去解决。期间也去请教了一些IoT的da神，一些IoT相关的问题得到了比较好的解决。
    </p>
    <p>
     另外，这里着重需要感谢的还有
     <strong>
      涂鸦智能云平台
     </strong>
     ，在这里我可以很快地创建我需要的智能单品，也可以很快地把产品原型进行落地开发，它提供了一个出色的开发者平台，有各种详尽的开发对接文档，还有技术工单等反馈渠道，这些都给了我开发这个智能单品有了更为强大的技术信心。
    </p>
    <p>
     若对涂鸦智能云平台快速创建智能产品想了解更多信息，欢迎从
     <a href="https://t.tuya.com/AY1D3R9mUC" rel="nofollow">
      <strong>
       这里
      </strong>
     </a>
     得到更多了解，智能设备从这里开始！
    </p>
    <p>
     这段开发经历对我来说，最大的收获并不是说把几个智能化的核心功能给实现了，反倒是这个智能单品的开发全流程让我学习到了不少技术以外的内容，这些对于我深入理解IoT领域提供了极大的帮助，我也相信将来会有更多优秀的智能单品从这里诞生。
    </p>
    <p>
     最后，感谢IoT，感谢涂鸦，感谢自己；期待一同进步，一同成长。
    </p>
    <p>
     <img alt="查看源图像" src="https://i-blog.csdnimg.cn/blog_migrate/bfd9657176a5c7e1c9b855d4655f7dc0.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f737a756c6c632f:61727469636c652f64657461696c732f313233383235303139" class_="artid" style="display:none">
 </p>
</div>


