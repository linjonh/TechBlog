---
layout: post
title: "WebSocket实现实时通信的利器"
date: 2025-03-11 12:41:23 +0800
description: "WebSocket 是一种网络通信协议，允许在客户端和服务器之间建立持久化的、全双工的通信通道。与传统的 HTTP 请求-响应模式不同，WebSocket 可以在单个 TCP 连接上实现双向通信，极大地减少了通信延迟和开销。WebSocket 协议于 2011 年由 IETF 标准化（RFC 6455），现已被广泛应用于各种实时通信场景。WebSocket 是一种强大的实时通信协议，适用于需要低延迟、双向通信的场景。它通过持久连接和轻量级的协议设计，解决了传统 HTTP 协议在实时性方面的不足。"
keywords: "WebSocket：实现实时通信的利器"
categories: ['未分类']
tags: ['网络协议', '网络', 'Websocket']
artid: "146175668"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146175668
    alt: "WebSocket实现实时通信的利器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146175668
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146175668
cover: https://bing.ee123.net/img/rand?artid=146175668
image: https://bing.ee123.net/img/rand?artid=146175668
img: https://bing.ee123.net/img/rand?artid=146175668
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     WebSocket：实现实时通信的利器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="WebSocket_0">
     </a>
     WebSocket：实现实时通信的利器
    </h2>
    <p>
     在现代Web应用中，实时通信变得越来越重要。无论是聊天应用、在线游戏，还是实时数据推送，都需要一种高效、低延迟的通信方式。WebSocket 正是为此而生的技术。本文将详细介绍 WebSocket 的特点、工作原理以及使用方法，帮助你全面了解这一强大的通信协议。
    </p>
    <hr/>
    <h3>
     <a id="_WebSocket_6">
     </a>
     什么是 WebSocket？
    </h3>
    <p>
     WebSocket 是一种网络通信协议，允许在客户端和服务器之间建立持久化的、全双工的通信通道。与传统的 HTTP 请求-响应模式不同，WebSocket 可以在单个 TCP 连接上实现双向通信，极大地减少了通信延迟和开销。
    </p>
    <p>
     WebSocket 协议于 2011 年由 IETF 标准化（RFC 6455），现已被广泛应用于各种实时通信场景。
    </p>
    <hr/>
    <h3>
     <a id="WebSocket__14">
     </a>
     WebSocket 的特点
    </h3>
    <h4>
     <a id="1__16">
     </a>
     1.
     <strong>
      全双工通信
     </strong>
    </h4>
    <p>
     WebSocket 允许客户端和服务器同时发送和接收数据，而不需要等待对方的响应。这种双向通信模式非常适合实时应用。
    </p>
    <h4>
     <a id="2__19">
     </a>
     2.
     <strong>
      持久连接
     </strong>
    </h4>
    <p>
     WebSocket 连接一旦建立，就会保持打开状态，直到客户端或服务器主动关闭连接。这避免了频繁建立和断开连接的开销。
    </p>
    <h4>
     <a id="3__22">
     </a>
     3.
     <strong>
      低延迟
     </strong>
    </h4>
    <p>
     由于不需要为每个请求重新建立连接，WebSocket 的通信延迟非常低，适合需要实时更新的应用。
    </p>
    <h4>
     <a id="4__25">
     </a>
     4.
     <strong>
      轻量级协议
     </strong>
    </h4>
    <p>
     WebSocket 的协议头比 HTTP 小得多，减少了通信的开销。
    </p>
    <h4>
     <a id="5__28">
     </a>
     5.
     <strong>
      跨平台支持
     </strong>
    </h4>
    <p>
     WebSocket 协议被主流浏览器和服务器广泛支持，可以在 Web、移动端和桌面端使用。
    </p>
    <hr/>
    <h3>
     <a id="WebSocket__33">
     </a>
     WebSocket 的工作原理
    </h3>
    <p>
     WebSocket 的工作过程可以分为两个阶段：
     <strong>
      握手阶段
     </strong>
     和
     <strong>
      数据传输阶段
     </strong>
     。
    </p>
    <h4>
     <a id="1__37">
     </a>
     1.
     <strong>
      握手阶段
     </strong>
    </h4>
    <p>
     WebSocket 连接通过 HTTP 协议发起。客户端发送一个带有
     <code>
      Upgrade: websocket
     </code>
     头的 HTTP 请求，请求升级到 WebSocket 协议。如果服务器支持 WebSocket，它会返回一个 HTTP 101 状态码（Switching Protocols），表示协议升级成功。
    </p>
    <h5>
     <a id="_40">
     </a>
     握手请求示例：
    </h5>
    <pre><code class="prism language-http">GET /socket HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
</code></pre>
    <h5>
     <a id="_50">
     </a>
     握手响应示例：
    </h5>
    <pre><code class="prism language-http">HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
</code></pre>
    <h4>
     <a id="2__58">
     </a>
     2.
     <strong>
      数据传输阶段
     </strong>
    </h4>
    <p>
     握手完成后，连接从 HTTP 切换到 WebSocket 协议。客户端和服务器可以通过 WebSocket 连接发送消息（文本或二进制数据）。消息以帧（frame）的形式传输，每个帧包含少量元数据和有效载荷。
    </p>
    <h4>
     <a id="3__61">
     </a>
     3.
     <strong>
      连接关闭
     </strong>
    </h4>
    <p>
     客户端或服务器可以发送关闭帧来终止连接。关闭连接时，双方可以指定关闭原因和状态码。
    </p>
    <hr/>
    <h3>
     <a id="WebSocket__66">
     </a>
     WebSocket 的使用方法
    </h3>
    <h4>
     <a id="1_JavaScript_68">
     </a>
     1.
     <strong>
      客户端（JavaScript）
     </strong>
    </h4>
    <p>
     在浏览器中，可以通过 JavaScript 的
     <code>
      WebSocket
     </code>
     API 创建 WebSocket 连接。
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 创建 WebSocket 连接</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://example.com/socket'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 连接打开时触发</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket 连接已建立'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向服务器发送消息</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 接收到服务器消息时触发</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到服务器消息:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 连接关闭时触发</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket 连接已关闭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 发生错误时触发</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'WebSocket 错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="2_Nodejs__ws__97">
     </a>
     2.
     <strong>
      服务器（Node.js 使用
      <code>
       ws
      </code>
      库）
     </strong>
    </h4>
    <p>
     在服务器端，可以使用 Node.js 的
     <code>
      ws
     </code>
     库来实现 WebSocket 服务器。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ws</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'客户端已连接'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 接收到客户端消息时触发</span>
    ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到客户端消息:'</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Client!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向客户端发送消息</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 连接关闭时触发</span>
    ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'客户端已断开连接'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <hr/>
    <h3>
     <a id="WebSocket__122">
     </a>
     WebSocket 的适用场景
    </h3>
    <p>
     WebSocket 非常适合需要实时通信的应用场景，例如：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        实时聊天应用
       </strong>
       ：
      </p>
      <ul>
       <li>
        客户端和服务器需要实时交换消息。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        在线游戏
       </strong>
       ：
      </p>
      <ul>
       <li>
        游戏状态需要实时同步。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        实时数据推送
       </strong>
       ：
      </p>
      <ul>
       <li>
        股票行情、天气预报等实时数据的推送。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        协同编辑工具
       </strong>
       ：
      </p>
      <ul>
       <li>
        多个用户同时编辑文档时的实时同步。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        物联网（IoT）
       </strong>
       ：
      </p>
      <ul>
       <li>
        设备与服务器之间的实时通信。
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="WebSocket__HTTP__143">
     </a>
     WebSocket 与 HTTP 的区别
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        特性
       </th>
       <th>
        WebSocket
       </th>
       <th>
        HTTP
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         连接方式
        </strong>
       </td>
       <td>
        持久连接，全双工通信
       </td>
       <td>
        短连接，请求-响应模式
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         通信方向
        </strong>
       </td>
       <td>
        双向通信
       </td>
       <td>
        单向通信（客户端发起请求）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         延迟
        </strong>
       </td>
       <td>
        低延迟
       </td>
       <td>
        较高延迟（每次请求需握手）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         协议头大小
        </strong>
       </td>
       <td>
        较小
       </td>
       <td>
        较大
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         适用场景
        </strong>
       </td>
       <td>
        实时通信
       </td>
       <td>
        静态资源请求、REST API
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_155">
     </a>
     总结
    </h3>
    <p>
     WebSocket 是一种强大的实时通信协议，适用于需要低延迟、双向通信的场景。它通过持久连接和轻量级的协议设计，解决了传统 HTTP 协议在实时性方面的不足。无论是开发聊天应用、在线游戏，还是实时数据推送，WebSocket 都是一个理想的选择。
    </p>
    <p>
     希望本文能帮助你更好地理解 WebSocket 的特点、原理和使用方法。如果你有任何问题或想法，欢迎在评论区留言讨论！
    </p>
    <hr/>
    <p>
     <strong>
      参考资料
     </strong>
     ：
    </p>
    <ul>
     <li>
      <a href="https://tools.ietf.org/html/rfc6455" rel="nofollow">
       WebSocket RFC 6455
      </a>
     </li>
     <li>
      <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket" rel="nofollow">
       MDN WebSocket Documentation
      </a>
     </li>
     <li>
      <a href="https://github.com/websockets/ws">
       Node.js
       <code>
        ws
       </code>
       Library
      </a>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33373834303930342f:61727469636c652f64657461696c732f313436313735363638" class_="artid" style="display:none">
 </p>
</div>


