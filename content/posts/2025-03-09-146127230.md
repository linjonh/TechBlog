---
layout: post
title: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—å¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯"
date: 2025-03-09 08:26:19 +0800
description: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ä¸è§£å†³æ–¹æ¡ˆæ˜ç¡®ç°è±¡ï¼šè¿æ¥å¤±è´¥ï¼Ÿæ€§èƒ½ä¸‹é™ï¼Ÿæ•°æ®å¼‚å¸¸ï¼Ÿå®šä½æ–¹å‘ï¼šç½‘ç»œ > é…ç½® > èµ„æº > æ•°æ® > é›†ç¾¤å·¥å…·è¾…åŠ©infoslowlogmemoryéªŒè¯è§£å†³ï¼šå˜æ›´åé€šè¿‡å‹æµ‹éªŒè¯æ•ˆæœé™„å½•ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨# å®æ—¶ç›‘æ§ redis-cli monitor # å†…å­˜åˆ†æ redis-cli memory stats # è¿æ¥æ± è¯Šæ–­ redis-cli client listé€šè¿‡ç³»ç»ŸåŒ–çš„æ’æŸ¥æ€è·¯å’Œå·¥å…·é“¾ï¼ŒRedisçº¿ä¸Šé—®é¢˜å°†ä¸å†ä»¤äººå¤´ç–¼ã€‚è·å–æ›´å¤šæŠ€æœ¯å¹²è´§ï¼Œæ¬¢è¿å…³æ³¨åšä¸»ï¼ğŸ’¡ã€‚"
keywords: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—ï¼šå¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯"
categories: ['æœªåˆ†ç±»']
tags: ['åç«¯', 'Spring', 'Spring', 'Spring', 'Java', 'Cloud', 'Boot']
artid: "146127230"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146127230
    alt: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—å¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146127230
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146127230
cover: https://bing.ee123.net/img/rand?artid=146127230
image: https://bing.ee123.net/img/rand?artid=146127230
img: https://bing.ee123.net/img/rand?artid=146127230
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—ï¼šå¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="RedisRedisRedis_0">
     </a>
     ä½œä¸ºé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼ŒRedisåœ¨çº¿ä¸Šç¯å¢ƒä¸­æ‰¿æ‹…ç€ç¼“å­˜ã€é˜Ÿåˆ—ã€è®¡æ•°å™¨ç­‰é‡è¦è§’è‰²ã€‚ç„¶è€Œï¼Œé¢å¯¹å¤æ‚çš„ç”Ÿäº§ç¯å¢ƒï¼ŒRedisä¹Ÿéš¾å…ä¼šé‡åˆ°å„ç§â€œç–‘éš¾æ‚ç—‡â€ã€‚æœ¬æ–‡ç»“åˆå®æˆ˜ç»éªŒï¼Œæ€»ç»“
     <strong>
      Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ä¸è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼ŒåŠ©ä½ å¿«é€Ÿå®šä½é—®é¢˜ï¼Œæ¢å¤ä¸šåŠ¡ç¨³å®šã€‚
    </h3>
    <h3>
     <a id="_2">
     </a>
     ä¸€ã€å¸¸è§é—®é¢˜åˆ†ç±»ä¸æ’æŸ¥æ–¹å‘
    </h3>
    <h4>
     <a id="1__4">
     </a>
     1. è¿æ¥é—®é¢˜
    </h4>
    <p>
     <strong>
      ç°è±¡
     </strong>
     ï¼šå®¢æˆ·ç«¯æ— æ³•è¿æ¥Redisï¼Œè¿”å›
     <code>
      Connection refused
     </code>
     æˆ–è¶…æ—¶é”™è¯¯ã€‚
    </p>
    <ul>
     <li>
      <strong>
       æ’æŸ¥æ­¥éª¤
      </strong>
      ï¼š
      <ol>
       <li>
        æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼š
        <code>
         telnet &lt;redis_ip&gt; &lt;port&gt;
        </code>
       </li>
       <li>
        éªŒè¯RedisæœåŠ¡çŠ¶æ€ï¼š
        <code>
         ps -ef | grep redis
        </code>
       </li>
       <li>
        æŸ¥çœ‹Redisé…ç½®ï¼š
        <pre><code class="prism language-bash"><span class="token comment"># æ£€æŸ¥bindå’Œprotected-modeé…ç½®</span>
redis-cli config get <span class="token builtin class-name">bind</span>
redis-cli config get protected-mode
</code></pre>
       </li>
       <li>
        æ£€æŸ¥æœ€å¤§è¿æ¥æ•°é™åˆ¶ï¼š
        <pre><code class="prism language-bash">redis-cli config get maxclients
redis-cli info clients  <span class="token comment"># æŸ¥çœ‹å½“å‰è¿æ¥æ•°</span>
</code></pre>
       </li>
       <li>
        æŸ¥çœ‹æ—¥å¿—å®šä½é”™è¯¯ï¼š
        <code>
         tail -f /var/log/redis/redis.log
        </code>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </p>
    <ul>
     <li>
      è°ƒæ•´
      <code>
       bind
      </code>
      ç»‘å®šåœ°å€æˆ–å…³é—­
      <code>
       protected-mode
      </code>
      ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
     </li>
     <li>
      ä¿®æ”¹
      <code>
       maxclients
      </code>
      å¹¶ä¼˜åŒ–å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®
     </li>
     <li>
      æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼š
      <code>
       iptables -L -n
      </code>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2__28">
     </a>
     2. æ€§èƒ½é—®é¢˜ï¼ˆå»¶è¿Ÿé«˜ï¼‰
    </h4>
    <p>
     <strong>
      ç°è±¡
     </strong>
     ï¼šRediså“åº”å˜æ…¢ï¼Œä¸šåŠ¡ä¾§å‡ºç°è¶…æ—¶ã€‚
    </p>
    <ul>
     <li>
      <strong>
       æ’æŸ¥æ­¥éª¤
      </strong>
      ï¼š
      <ol>
       <li>
        ä½¿ç”¨
        <code>
         redis-cli --latency
        </code>
        æ£€æµ‹åŸºå‡†å»¶è¿Ÿ
       </li>
       <li>
        æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š
        <pre><code class="prism language-bash">redis-cli config <span class="token builtin class-name">set</span> slowlog-log-slower-than <span class="token number">1000</span>  <span class="token comment"># è®¾ç½®é˜ˆå€¼ï¼ˆå¾®ç§’ï¼‰</span>
redis-cli slowlog get <span class="token number">10</span>  <span class="token comment"># æŸ¥çœ‹æœ€è¿‘10æ¡æ…¢æŸ¥è¯¢</span>
</code></pre>
       </li>
       <li>
        åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼š
        <pre><code class="prism language-bash">redis-cli info memory  <span class="token comment"># å…³æ³¨used_memoryã€mem_fragmentation_ratio</span>
</code></pre>
       </li>
       <li>
        æ£€æŸ¥æŒä¹…åŒ–é˜»å¡ï¼š
        <ul>
         <li>
          RDBï¼š
          <code>
           redis-cli info persistence | grep rdb_last_bgsave_status
          </code>
         </li>
         <li>
          AOFï¼š
          <code>
           redis-cli info persistence | grep aof_last_bgrewrite_status
          </code>
         </li>
        </ul>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </p>
    <ul>
     <li>
      ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼ˆé¿å…
      <code>
       KEYS *
      </code>
      ã€å¤§èŒƒå›´
      <code>
       HGETALL
      </code>
      ï¼‰
     </li>
     <li>
      å‡çº§å®ä¾‹è§„æ ¼æˆ–å¯ç”¨é›†ç¾¤åˆ†ç‰‡
     </li>
     <li>
      è°ƒæ•´æŒä¹…åŒ–ç­–ç•¥ï¼ˆå¦‚å…³é—­AOFçš„
      <code>
       appendfsync always
      </code>
      ï¼‰
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3_OOM_52">
     </a>
     3. å†…å­˜é—®é¢˜ï¼ˆOOMï¼‰
    </h4>
    <p>
     <strong>
      ç°è±¡
     </strong>
     ï¼šRedisè§¦å‘OOMï¼ˆOut Of Memoryï¼‰ï¼Œæ— æ³•å†™å…¥æ–°æ•°æ®ã€‚
    </p>
    <ul>
     <li>
      <strong>
       æ’æŸ¥æ­¥éª¤
      </strong>
      ï¼š
      <ol>
       <li>
        æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡ï¼š
        <code>
         redis-cli info memory | grep used_memory_human
        </code>
       </li>
       <li>
        æŸ¥æ‰¾å¤§Keyï¼š
        <pre><code class="prism language-bash">redis-cli <span class="token parameter variable">--bigkeys</span>  <span class="token comment"># æ‰«æå¤§Keyï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰</span>
</code></pre>
       </li>
       <li>
        åˆ†æå†…å­˜ç¢ç‰‡ç‡ï¼š
        <pre><code class="prism language-bash">redis-cli info memory <span class="token operator">|</span> <span class="token function">grep</span> mem_fragmentation_ratio
<span class="token comment"># &gt;1.5 è¡¨ç¤ºç¢ç‰‡è¾ƒé«˜</span>
</code></pre>
       </li>
       <li>
        æ£€æŸ¥æ·˜æ±°ç­–ç•¥ï¼š
        <code>
         redis-cli config get maxmemory-policy
        </code>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </p>
    <ul>
     <li>
      æ¸…ç†å¤§Keyï¼ˆåˆ†æ‰¹æ¬¡åˆ é™¤ï¼‰
     </li>
     <li>
      è®¾ç½®åˆç†çš„
      <code>
       maxmemory
      </code>
      å’Œæ·˜æ±°ç­–ç•¥ï¼ˆå¦‚
      <code>
       allkeys-lru
      </code>
      ï¼‰
     </li>
     <li>
      å¯ç”¨å†…å­˜ç¢ç‰‡æ•´ç†ï¼š
      <code>
       config set activedefrag yes
      </code>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="4__73">
     </a>
     4. æ•°æ®ä¸ä¸€è‡´é—®é¢˜
    </h4>
    <p>
     <strong>
      ç°è±¡
     </strong>
     ï¼šä¸»ä»èŠ‚ç‚¹æ•°æ®ä¸ä¸€è‡´ï¼Œæˆ–ç¼“å­˜ä¸DBä¸ä¸€è‡´ã€‚
    </p>
    <ul>
     <li>
      <strong>
       æ’æŸ¥æ­¥éª¤
      </strong>
      ï¼š
      <ol>
       <li>
        æ£€æŸ¥ä¸»ä»åŒæ­¥çŠ¶æ€ï¼š
        <pre><code class="prism language-bash">redis-cli info replication
<span class="token comment"># å…³æ³¨slave0:offsetä¸master_repl_offsetå·®å€¼</span>
</code></pre>
       </li>
       <li>
        éªŒè¯è¿‡æœŸé”®ç­–ç•¥ï¼š
        <pre><code class="prism language-bash">redis-cli config get hz  <span class="token comment"># é»˜è®¤10ï¼Œæ§åˆ¶è¿‡æœŸé”®æ¸…ç†é¢‘ç‡</span>
</code></pre>
       </li>
       <li>
        ä½¿ç”¨
        <code>
         redis-check-rdb
        </code>
        æˆ–
        <code>
         redis-check-aof
        </code>
        éªŒè¯æŒä¹…åŒ–æ–‡ä»¶
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </p>
    <ul>
     <li>
      ç¡®ä¿ä¸»ä»ç½‘ç»œç¨³å®šï¼Œé€‚å½“å¢å¤§
      <code>
       repl-timeout
      </code>
     </li>
     <li>
      ä½¿ç”¨
      <code>
       EXPIRE
      </code>
      å‘½ä»¤è®¾ç½®åˆç†TTL
     </li>
     <li>
      åŒå†™åœºæ™¯ä¸‹é‡‡ç”¨å»¶è¿ŸåŒåˆ ç­–ç•¥
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="5__94">
     </a>
     5. é›†ç¾¤é—®é¢˜
    </h4>
    <p>
     <strong>
      ç°è±¡
     </strong>
     ï¼šé›†ç¾¤èŠ‚ç‚¹æ•…éšœã€æ§½ä½è¿ç§»å¤±è´¥ã€‚
    </p>
    <ul>
     <li>
      <strong>
       æ’æŸ¥æ­¥éª¤
      </strong>
      ï¼š
      <ol>
       <li>
        æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼š
        <pre><code class="prism language-bash">redis-cli <span class="token parameter variable">--cluster</span> check <span class="token operator">&lt;</span>node_ip<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre>
       </li>
       <li>
        æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š
        <pre><code class="prism language-bash">redis-cli cluster nodes
</code></pre>
       </li>
       <li>
        æ£€æŸ¥é›†ç¾¤ç½‘ç»œå¸¦å®½ï¼š
        <code>
         iftop -i eth0
        </code>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </p>
    <ul>
     <li>
      æ•…éšœèŠ‚ç‚¹æ¢å¤æˆ–æ›¿æ¢
     </li>
     <li>
      æ‰‹åŠ¨æ‰§è¡Œæ§½ä½è¿ç§»ï¼š
      <code>
       redis-cli --cluster reshard
      </code>
     </li>
     <li>
      ä¼˜åŒ–é›†ç¾¤èŠ‚ç‚¹éƒ¨ç½²ï¼ˆé¿å…è·¨æœºæˆ¿ï¼‰
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_114">
     </a>
     äºŒã€é¢„é˜²æªæ–½ä¸æœ€ä½³å®è·µ
    </h3>
    <ol>
     <li>
      <strong>
       ç›‘æ§å‘Šè­¦
      </strong>
      ï¼šéƒ¨ç½²Prometheus + Grafanaç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š
      <ul>
       <li>
        å†…å­˜ä½¿ç”¨ç‡ã€è¿æ¥æ•°ã€QPSã€å‘½ä¸­ç‡ã€ä¸»ä»å»¶è¿Ÿ
       </li>
      </ul>
     </li>
     <li>
      <strong>
       å®šæœŸç»´æŠ¤
      </strong>
      ï¼š
      <ul>
       <li>
        æ¯æœˆæ‰§è¡Œ
        <code>
         scan
        </code>
        æ‰«ææ¸…ç†æ— ç”¨Key
       </li>
       <li>
        æ£€æŸ¥æŒä¹…åŒ–æ–‡ä»¶å®Œæ•´æ€§
       </li>
      </ul>
     </li>
     <li>
      <strong>
       å®¹é‡è§„åˆ’
      </strong>
      ï¼šæå‰è¯„ä¼°ä¸šåŠ¡å¢é•¿ï¼Œé¢„ç•™30%å†…å­˜ç¼“å†²
     </li>
     <li>
      <strong>
       ä»£ç è§„èŒƒ
      </strong>
      ï¼š
      <ul>
       <li>
        é¿å…ä½¿ç”¨é˜»å¡å‘½ä»¤ï¼ˆå¦‚
        <code>
         BLPOP
        </code>
        é•¿æ—¶é—´é˜»å¡ï¼‰
       </li>
       <li>
        ä½¿ç”¨Pipelineå‡å°‘ç½‘ç»œå¾€è¿”
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="Redis_126">
     </a>
     ä¸‰ã€æ€»ç»“ï¼šRedisæ’æŸ¥è·¯çº¿å›¾
    </h3>
    <ol>
     <li>
      <strong>
       æ˜ç¡®ç°è±¡
      </strong>
      ï¼šè¿æ¥å¤±è´¥ï¼Ÿæ€§èƒ½ä¸‹é™ï¼Ÿæ•°æ®å¼‚å¸¸ï¼Ÿ
     </li>
     <li>
      <strong>
       å®šä½æ–¹å‘
      </strong>
      ï¼šç½‘ç»œ &gt; é…ç½® &gt; èµ„æº &gt; æ•°æ® &gt; é›†ç¾¤
     </li>
     <li>
      <strong>
       å·¥å…·è¾…åŠ©
      </strong>
      ï¼š
      <ul>
       <li>
        å†…ç½®å‘½ä»¤ï¼š
        <code>
         info
        </code>
        ã€
        <code>
         slowlog
        </code>
        ã€
        <code>
         memory
        </code>
       </li>
       <li>
        å¤–éƒ¨å·¥å…·ï¼š
        <code>
         redis-cli --bigkeys
        </code>
        ã€
        <code>
         redis-benchmark
        </code>
       </li>
      </ul>
     </li>
     <li>
      <strong>
       éªŒè¯è§£å†³
      </strong>
      ï¼šå˜æ›´åé€šè¿‡å‹æµ‹éªŒè¯æ•ˆæœ
     </li>
    </ol>
    <hr/>
    <p>
     <strong>
      é™„å½•ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># å®æ—¶ç›‘æ§</span>
redis-cli monitor

<span class="token comment"># å†…å­˜åˆ†æ</span>
redis-cli memory stats

<span class="token comment"># è¿æ¥æ± è¯Šæ–­</span>
redis-cli client list
</code></pre>
    <p>
     é€šè¿‡ç³»ç»ŸåŒ–çš„æ’æŸ¥æ€è·¯å’Œå·¥å…·é“¾ï¼ŒRedisçº¿ä¸Šé—®é¢˜å°†ä¸å†ä»¤äººå¤´ç–¼ã€‚å»ºè®®æ”¶è—æœ¬æ–‡ï¼Œéšæ—¶åº”å¯¹çªå‘çŠ¶å†µï¼
    </p>
    <p>
     <strong>
      è·å–æ›´å¤šæŠ€æœ¯å¹²è´§ï¼Œæ¬¢è¿å…³æ³¨åšä¸»ï¼
     </strong>
     ğŸ’¡
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36323932323034322f:61727469636c652f64657461696c732f313436313237323330" class_="artid" style="display:none">
 </p>
</div>


