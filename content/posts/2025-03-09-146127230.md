---
arturl_encode: "68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36323932323034322f:61727469636c652f64657461696c732f313436313237323330"
layout: post
title: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—å¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯"
date: 2025-03-09 08:26:19 +08:00
description: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ä¸è§£å†³æ–¹æ¡ˆæ˜ç¡®ç°è±¡ï¼šè¿æ¥å¤±è´¥ï¼Ÿæ€§èƒ½ä¸‹é™ï¼Ÿæ•°æ®å¼‚å¸¸ï¼Ÿå®šä½æ–¹å‘ï¼šç½‘ç»œ > é…ç½® > èµ„æº > æ•°æ® > é›†ç¾¤å·¥å…·è¾…åŠ©infoslowlogmemoryéªŒè¯è§£å†³ï¼šå˜æ›´åé€šè¿‡å‹æµ‹éªŒè¯æ•ˆæœé™„å½•ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨# å®æ—¶ç›‘æ§ redis-cli monitor # å†…å­˜åˆ†æ redis-cli memory stats # è¿æ¥æ± è¯Šæ–­ redis-cli client listé€šè¿‡ç³»ç»ŸåŒ–çš„æ’æŸ¥æ€è·¯å’Œå·¥å…·é“¾ï¼ŒRedisçº¿ä¸Šé—®é¢˜å°†ä¸å†ä»¤äººå¤´ç–¼ã€‚è·å–æ›´å¤šæŠ€æœ¯å¹²è´§ï¼Œæ¬¢è¿å…³æ³¨åšä¸»ï¼ğŸ’¡ã€‚"
keywords: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—ï¼šå¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯"
categories: ['æœªåˆ†ç±»']
tags: ['åç«¯', 'Spring', 'Spring', 'Spring', 'Java', 'Cloud', 'Boot']
artid: "146127230"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146127230
    alt: "Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—å¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146127230
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146127230
cover: https://bing.ee123.net/img/rand?artid=146127230
image: https://bing.ee123.net/img/rand?artid=146127230
img: https://bing.ee123.net/img/rand?artid=146127230
---

# Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æŒ‡å—ï¼šå¸¸è§é”™è¯¯ä¸è§£å†³æ€è·¯

### ä½œä¸ºé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼ŒRedisåœ¨çº¿ä¸Šç¯å¢ƒä¸­æ‰¿æ‹…ç€ç¼“å­˜ã€é˜Ÿåˆ—ã€è®¡æ•°å™¨ç­‰é‡è¦è§’è‰²ã€‚ç„¶è€Œï¼Œé¢å¯¹å¤æ‚çš„ç”Ÿäº§ç¯å¢ƒï¼ŒRedisä¹Ÿéš¾å…ä¼šé‡åˆ°å„ç§â€œç–‘éš¾æ‚ç—‡â€ã€‚æœ¬æ–‡ç»“åˆå®æˆ˜ç»éªŒï¼Œæ€»ç»“ **Redisçº¿ä¸Šé—®é¢˜æ’æŸ¥æ€è·¯ä¸è§£å†³æ–¹æ¡ˆ** ï¼ŒåŠ©ä½ å¿«é€Ÿå®šä½é—®é¢˜ï¼Œæ¢å¤ä¸šåŠ¡ç¨³å®šã€‚

### ä¸€ã€å¸¸è§é—®é¢˜åˆ†ç±»ä¸æ’æŸ¥æ–¹å‘

#### 1. è¿æ¥é—®é¢˜

**ç°è±¡**
ï¼šå®¢æˆ·ç«¯æ— æ³•è¿æ¥Redisï¼Œè¿”å›
`Connection refused`
æˆ–è¶…æ—¶é”™è¯¯ã€‚

* **æ’æŸ¥æ­¥éª¤**
  ï¼š
  1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼š
     `telnet <redis_ip> <port>`
  2. éªŒè¯RedisæœåŠ¡çŠ¶æ€ï¼š
     `ps -ef | grep redis`
  3. æŸ¥çœ‹Redisé…ç½®ï¼š

     ```bash
     # æ£€æŸ¥bindå’Œprotected-modeé…ç½®
     redis-cli config get bind
     redis-cli config get protected-mode

     ```
  4. æ£€æŸ¥æœ€å¤§è¿æ¥æ•°é™åˆ¶ï¼š

     ```bash
     redis-cli config get maxclients
     redis-cli info clients  # æŸ¥çœ‹å½“å‰è¿æ¥æ•°

     ```
  5. æŸ¥çœ‹æ—¥å¿—å®šä½é”™è¯¯ï¼š
     `tail -f /var/log/redis/redis.log`

**è§£å†³æ–¹æ¡ˆ**
ï¼š

* è°ƒæ•´
  `bind`
  ç»‘å®šåœ°å€æˆ–å…³é—­
  `protected-mode`
  ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
* ä¿®æ”¹
  `maxclients`
  å¹¶ä¼˜åŒ–å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®
* æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼š
  `iptables -L -n`

---

#### 2. æ€§èƒ½é—®é¢˜ï¼ˆå»¶è¿Ÿé«˜ï¼‰

**ç°è±¡**
ï¼šRediså“åº”å˜æ…¢ï¼Œä¸šåŠ¡ä¾§å‡ºç°è¶…æ—¶ã€‚

* **æ’æŸ¥æ­¥éª¤**
  ï¼š
  1. ä½¿ç”¨
     `redis-cli --latency`
     æ£€æµ‹åŸºå‡†å»¶è¿Ÿ
  2. æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š

     ```bash
     redis-cli config set slowlog-log-slower-than 1000  # è®¾ç½®é˜ˆå€¼ï¼ˆå¾®ç§’ï¼‰
     redis-cli slowlog get 10  # æŸ¥çœ‹æœ€è¿‘10æ¡æ…¢æŸ¥è¯¢

     ```
  3. åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼š

     ```bash
     redis-cli info memory  # å…³æ³¨used_memoryã€mem_fragmentation_ratio

     ```
  4. æ£€æŸ¥æŒä¹…åŒ–é˜»å¡ï¼š
     + RDBï¼š
       `redis-cli info persistence | grep rdb_last_bgsave_status`
     + AOFï¼š
       `redis-cli info persistence | grep aof_last_bgrewrite_status`

**è§£å†³æ–¹æ¡ˆ**
ï¼š

* ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼ˆé¿å…
  `KEYS *`
  ã€å¤§èŒƒå›´
  `HGETALL`
  ï¼‰
* å‡çº§å®ä¾‹è§„æ ¼æˆ–å¯ç”¨é›†ç¾¤åˆ†ç‰‡
* è°ƒæ•´æŒä¹…åŒ–ç­–ç•¥ï¼ˆå¦‚å…³é—­AOFçš„
  `appendfsync always`
  ï¼‰

---

#### 3. å†…å­˜é—®é¢˜ï¼ˆOOMï¼‰

**ç°è±¡**
ï¼šRedisè§¦å‘OOMï¼ˆOut Of Memoryï¼‰ï¼Œæ— æ³•å†™å…¥æ–°æ•°æ®ã€‚

* **æ’æŸ¥æ­¥éª¤**
  ï¼š
  1. æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡ï¼š
     `redis-cli info memory | grep used_memory_human`
  2. æŸ¥æ‰¾å¤§Keyï¼š

     ```bash
     redis-cli --bigkeys  # æ‰«æå¤§Keyï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰

     ```
  3. åˆ†æå†…å­˜ç¢ç‰‡ç‡ï¼š

     ```bash
     redis-cli info memory | grep mem_fragmentation_ratio
     # >1.5 è¡¨ç¤ºç¢ç‰‡è¾ƒé«˜

     ```
  4. æ£€æŸ¥æ·˜æ±°ç­–ç•¥ï¼š
     `redis-cli config get maxmemory-policy`

**è§£å†³æ–¹æ¡ˆ**
ï¼š

* æ¸…ç†å¤§Keyï¼ˆåˆ†æ‰¹æ¬¡åˆ é™¤ï¼‰
* è®¾ç½®åˆç†çš„
  `maxmemory`
  å’Œæ·˜æ±°ç­–ç•¥ï¼ˆå¦‚
  `allkeys-lru`
  ï¼‰
* å¯ç”¨å†…å­˜ç¢ç‰‡æ•´ç†ï¼š
  `config set activedefrag yes`

---

#### 4. æ•°æ®ä¸ä¸€è‡´é—®é¢˜

**ç°è±¡**
ï¼šä¸»ä»èŠ‚ç‚¹æ•°æ®ä¸ä¸€è‡´ï¼Œæˆ–ç¼“å­˜ä¸DBä¸ä¸€è‡´ã€‚

* **æ’æŸ¥æ­¥éª¤**
  ï¼š
  1. æ£€æŸ¥ä¸»ä»åŒæ­¥çŠ¶æ€ï¼š

     ```bash
     redis-cli info replication
     # å…³æ³¨slave0:offsetä¸master_repl_offsetå·®å€¼

     ```
  2. éªŒè¯è¿‡æœŸé”®ç­–ç•¥ï¼š

     ```bash
     redis-cli config get hz  # é»˜è®¤10ï¼Œæ§åˆ¶è¿‡æœŸé”®æ¸…ç†é¢‘ç‡

     ```
  3. ä½¿ç”¨
     `redis-check-rdb`
     æˆ–
     `redis-check-aof`
     éªŒè¯æŒä¹…åŒ–æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**
ï¼š

* ç¡®ä¿ä¸»ä»ç½‘ç»œç¨³å®šï¼Œé€‚å½“å¢å¤§
  `repl-timeout`
* ä½¿ç”¨
  `EXPIRE`
  å‘½ä»¤è®¾ç½®åˆç†TTL
* åŒå†™åœºæ™¯ä¸‹é‡‡ç”¨å»¶è¿ŸåŒåˆ ç­–ç•¥

---

#### 5. é›†ç¾¤é—®é¢˜

**ç°è±¡**
ï¼šé›†ç¾¤èŠ‚ç‚¹æ•…éšœã€æ§½ä½è¿ç§»å¤±è´¥ã€‚

* **æ’æŸ¥æ­¥éª¤**
  ï¼š
  1. æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼š

     ```bash
     redis-cli --cluster check <node_ip>:<port>

     ```
  2. æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š

     ```bash
     redis-cli cluster nodes

     ```
  3. æ£€æŸ¥é›†ç¾¤ç½‘ç»œå¸¦å®½ï¼š
     `iftop -i eth0`

**è§£å†³æ–¹æ¡ˆ**
ï¼š

* æ•…éšœèŠ‚ç‚¹æ¢å¤æˆ–æ›¿æ¢
* æ‰‹åŠ¨æ‰§è¡Œæ§½ä½è¿ç§»ï¼š
  `redis-cli --cluster reshard`
* ä¼˜åŒ–é›†ç¾¤èŠ‚ç‚¹éƒ¨ç½²ï¼ˆé¿å…è·¨æœºæˆ¿ï¼‰

---

### äºŒã€é¢„é˜²æªæ–½ä¸æœ€ä½³å®è·µ

1. **ç›‘æ§å‘Šè­¦**
   ï¼šéƒ¨ç½²Prometheus + Grafanaç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š
   * å†…å­˜ä½¿ç”¨ç‡ã€è¿æ¥æ•°ã€QPSã€å‘½ä¸­ç‡ã€ä¸»ä»å»¶è¿Ÿ
2. **å®šæœŸç»´æŠ¤**
   ï¼š
   * æ¯æœˆæ‰§è¡Œ
     `scan`
     æ‰«ææ¸…ç†æ— ç”¨Key
   * æ£€æŸ¥æŒä¹…åŒ–æ–‡ä»¶å®Œæ•´æ€§
3. **å®¹é‡è§„åˆ’**
   ï¼šæå‰è¯„ä¼°ä¸šåŠ¡å¢é•¿ï¼Œé¢„ç•™30%å†…å­˜ç¼“å†²
4. **ä»£ç è§„èŒƒ**
   ï¼š
   * é¿å…ä½¿ç”¨é˜»å¡å‘½ä»¤ï¼ˆå¦‚
     `BLPOP`
     é•¿æ—¶é—´é˜»å¡ï¼‰
   * ä½¿ç”¨Pipelineå‡å°‘ç½‘ç»œå¾€è¿”

---

### ä¸‰ã€æ€»ç»“ï¼šRedisæ’æŸ¥è·¯çº¿å›¾

1. **æ˜ç¡®ç°è±¡**
   ï¼šè¿æ¥å¤±è´¥ï¼Ÿæ€§èƒ½ä¸‹é™ï¼Ÿæ•°æ®å¼‚å¸¸ï¼Ÿ
2. **å®šä½æ–¹å‘**
   ï¼šç½‘ç»œ > é…ç½® > èµ„æº > æ•°æ® > é›†ç¾¤
3. **å·¥å…·è¾…åŠ©**
   ï¼š
   * å†…ç½®å‘½ä»¤ï¼š
     `info`
     ã€
     `slowlog`
     ã€
     `memory`
   * å¤–éƒ¨å·¥å…·ï¼š
     `redis-cli --bigkeys`
     ã€
     `redis-benchmark`
4. **éªŒè¯è§£å†³**
   ï¼šå˜æ›´åé€šè¿‡å‹æµ‹éªŒè¯æ•ˆæœ

---

**é™„å½•ï¼šå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨**

```bash
# å®æ—¶ç›‘æ§
redis-cli monitor

# å†…å­˜åˆ†æ
redis-cli memory stats

# è¿æ¥æ± è¯Šæ–­
redis-cli client list

```

é€šè¿‡ç³»ç»ŸåŒ–çš„æ’æŸ¥æ€è·¯å’Œå·¥å…·é“¾ï¼ŒRedisçº¿ä¸Šé—®é¢˜å°†ä¸å†ä»¤äººå¤´ç–¼ã€‚å»ºè®®æ”¶è—æœ¬æ–‡ï¼Œéšæ—¶åº”å¯¹çªå‘çŠ¶å†µï¼

**è·å–æ›´å¤šæŠ€æœ¯å¹²è´§ï¼Œæ¬¢è¿å…³æ³¨åšä¸»ï¼**
ğŸ’¡