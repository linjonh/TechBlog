---
layout: post
title: "Redis线上问题排查指南常见错误与解决思路"
date: 2025-03-09 08:26:19 +0800
description: "Redis线上问题排查思路与解决方案明确现象：连接失败？性能下降？数据异常？定位方向：网络 > 配置 > 资源 > 数据 > 集群工具辅助infoslowlogmemory验证解决：变更后通过压测验证效果附录：常用命令速查表# 实时监控 redis-cli monitor # 内存分析 redis-cli memory stats # 连接池诊断 redis-cli client list通过系统化的排查思路和工具链，Redis线上问题将不再令人头疼。获取更多技术干货，欢迎关注博主！💡。"
keywords: "Redis线上问题排查指南：常见错误与解决思路"
categories: ['未分类']
tags: ['后端', 'Spring', 'Spring', 'Spring', 'Java', 'Cloud', 'Boot']
artid: "146127230"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146127230
    alt: "Redis线上问题排查指南常见错误与解决思路"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146127230
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146127230
cover: https://bing.ee123.net/img/rand?artid=146127230
image: https://bing.ee123.net/img/rand?artid=146127230
img: https://bing.ee123.net/img/rand?artid=146127230
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redis线上问题排查指南：常见错误与解决思路
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="RedisRedisRedis_0">
     </a>
     作为高性能的内存数据库，Redis在线上环境中承担着缓存、队列、计数器等重要角色。然而，面对复杂的生产环境，Redis也难免会遇到各种“疑难杂症”。本文结合实战经验，总结
     <strong>
      Redis线上问题排查思路与解决方案
     </strong>
     ，助你快速定位问题，恢复业务稳定。
    </h3>
    <h3>
     <a id="_2">
     </a>
     一、常见问题分类与排查方向
    </h3>
    <h4>
     <a id="1__4">
     </a>
     1. 连接问题
    </h4>
    <p>
     <strong>
      现象
     </strong>
     ：客户端无法连接Redis，返回
     <code>
      Connection refused
     </code>
     或超时错误。
    </p>
    <ul>
     <li>
      <strong>
       排查步骤
      </strong>
      ：
      <ol>
       <li>
        检查网络连通性：
        <code>
         telnet &lt;redis_ip&gt; &lt;port&gt;
        </code>
       </li>
       <li>
        验证Redis服务状态：
        <code>
         ps -ef | grep redis
        </code>
       </li>
       <li>
        查看Redis配置：
        <pre><code class="prism language-bash"><span class="token comment"># 检查bind和protected-mode配置</span>
redis-cli config get <span class="token builtin class-name">bind</span>
redis-cli config get protected-mode
</code></pre>
       </li>
       <li>
        检查最大连接数限制：
        <pre><code class="prism language-bash">redis-cli config get maxclients
redis-cli info clients  <span class="token comment"># 查看当前连接数</span>
</code></pre>
       </li>
       <li>
        查看日志定位错误：
        <code>
         tail -f /var/log/redis/redis.log
        </code>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      调整
      <code>
       bind
      </code>
      绑定地址或关闭
      <code>
       protected-mode
      </code>
      （仅测试环境）
     </li>
     <li>
      修改
      <code>
       maxclients
      </code>
      并优化客户端连接池配置
     </li>
     <li>
      检查防火墙规则：
      <code>
       iptables -L -n
      </code>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2__28">
     </a>
     2. 性能问题（延迟高）
    </h4>
    <p>
     <strong>
      现象
     </strong>
     ：Redis响应变慢，业务侧出现超时。
    </p>
    <ul>
     <li>
      <strong>
       排查步骤
      </strong>
      ：
      <ol>
       <li>
        使用
        <code>
         redis-cli --latency
        </code>
        检测基准延迟
       </li>
       <li>
        检查慢查询日志：
        <pre><code class="prism language-bash">redis-cli config <span class="token builtin class-name">set</span> slowlog-log-slower-than <span class="token number">1000</span>  <span class="token comment"># 设置阈值（微秒）</span>
redis-cli slowlog get <span class="token number">10</span>  <span class="token comment"># 查看最近10条慢查询</span>
</code></pre>
       </li>
       <li>
        分析内存使用情况：
        <pre><code class="prism language-bash">redis-cli info memory  <span class="token comment"># 关注used_memory、mem_fragmentation_ratio</span>
</code></pre>
       </li>
       <li>
        检查持久化阻塞：
        <ul>
         <li>
          RDB：
          <code>
           redis-cli info persistence | grep rdb_last_bgsave_status
          </code>
         </li>
         <li>
          AOF：
          <code>
           redis-cli info persistence | grep aof_last_bgrewrite_status
          </code>
         </li>
        </ul>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      优化慢查询（避免
      <code>
       KEYS *
      </code>
      、大范围
      <code>
       HGETALL
      </code>
      ）
     </li>
     <li>
      升级实例规格或启用集群分片
     </li>
     <li>
      调整持久化策略（如关闭AOF的
      <code>
       appendfsync always
      </code>
      ）
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3_OOM_52">
     </a>
     3. 内存问题（OOM）
    </h4>
    <p>
     <strong>
      现象
     </strong>
     ：Redis触发OOM（Out Of Memory），无法写入新数据。
    </p>
    <ul>
     <li>
      <strong>
       排查步骤
      </strong>
      ：
      <ol>
       <li>
        检查内存使用率：
        <code>
         redis-cli info memory | grep used_memory_human
        </code>
       </li>
       <li>
        查找大Key：
        <pre><code class="prism language-bash">redis-cli <span class="token parameter variable">--bigkeys</span>  <span class="token comment"># 扫描大Key（生产环境慎用）</span>
</code></pre>
       </li>
       <li>
        分析内存碎片率：
        <pre><code class="prism language-bash">redis-cli info memory <span class="token operator">|</span> <span class="token function">grep</span> mem_fragmentation_ratio
<span class="token comment"># &gt;1.5 表示碎片较高</span>
</code></pre>
       </li>
       <li>
        检查淘汰策略：
        <code>
         redis-cli config get maxmemory-policy
        </code>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      清理大Key（分批次删除）
     </li>
     <li>
      设置合理的
      <code>
       maxmemory
      </code>
      和淘汰策略（如
      <code>
       allkeys-lru
      </code>
      ）
     </li>
     <li>
      启用内存碎片整理：
      <code>
       config set activedefrag yes
      </code>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="4__73">
     </a>
     4. 数据不一致问题
    </h4>
    <p>
     <strong>
      现象
     </strong>
     ：主从节点数据不一致，或缓存与DB不一致。
    </p>
    <ul>
     <li>
      <strong>
       排查步骤
      </strong>
      ：
      <ol>
       <li>
        检查主从同步状态：
        <pre><code class="prism language-bash">redis-cli info replication
<span class="token comment"># 关注slave0:offset与master_repl_offset差值</span>
</code></pre>
       </li>
       <li>
        验证过期键策略：
        <pre><code class="prism language-bash">redis-cli config get hz  <span class="token comment"># 默认10，控制过期键清理频率</span>
</code></pre>
       </li>
       <li>
        使用
        <code>
         redis-check-rdb
        </code>
        或
        <code>
         redis-check-aof
        </code>
        验证持久化文件
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      确保主从网络稳定，适当增大
      <code>
       repl-timeout
      </code>
     </li>
     <li>
      使用
      <code>
       EXPIRE
      </code>
      命令设置合理TTL
     </li>
     <li>
      双写场景下采用延迟双删策略
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="5__94">
     </a>
     5. 集群问题
    </h4>
    <p>
     <strong>
      现象
     </strong>
     ：集群节点故障、槽位迁移失败。
    </p>
    <ul>
     <li>
      <strong>
       排查步骤
      </strong>
      ：
      <ol>
       <li>
        检查集群状态：
        <pre><code class="prism language-bash">redis-cli <span class="token parameter variable">--cluster</span> check <span class="token operator">&lt;</span>node_ip<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre>
       </li>
       <li>
        查看节点信息：
        <pre><code class="prism language-bash">redis-cli cluster nodes
</code></pre>
       </li>
       <li>
        检查集群网络带宽：
        <code>
         iftop -i eth0
        </code>
       </li>
      </ol>
     </li>
    </ul>
    <p>
     <strong>
      解决方案
     </strong>
     ：
    </p>
    <ul>
     <li>
      故障节点恢复或替换
     </li>
     <li>
      手动执行槽位迁移：
      <code>
       redis-cli --cluster reshard
      </code>
     </li>
     <li>
      优化集群节点部署（避免跨机房）
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_114">
     </a>
     二、预防措施与最佳实践
    </h3>
    <ol>
     <li>
      <strong>
       监控告警
      </strong>
      ：部署Prometheus + Grafana监控以下指标：
      <ul>
       <li>
        内存使用率、连接数、QPS、命中率、主从延迟
       </li>
      </ul>
     </li>
     <li>
      <strong>
       定期维护
      </strong>
      ：
      <ul>
       <li>
        每月执行
        <code>
         scan
        </code>
        扫描清理无用Key
       </li>
       <li>
        检查持久化文件完整性
       </li>
      </ul>
     </li>
     <li>
      <strong>
       容量规划
      </strong>
      ：提前评估业务增长，预留30%内存缓冲
     </li>
     <li>
      <strong>
       代码规范
      </strong>
      ：
      <ul>
       <li>
        避免使用阻塞命令（如
        <code>
         BLPOP
        </code>
        长时间阻塞）
       </li>
       <li>
        使用Pipeline减少网络往返
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="Redis_126">
     </a>
     三、总结：Redis排查路线图
    </h3>
    <ol>
     <li>
      <strong>
       明确现象
      </strong>
      ：连接失败？性能下降？数据异常？
     </li>
     <li>
      <strong>
       定位方向
      </strong>
      ：网络 &gt; 配置 &gt; 资源 &gt; 数据 &gt; 集群
     </li>
     <li>
      <strong>
       工具辅助
      </strong>
      ：
      <ul>
       <li>
        内置命令：
        <code>
         info
        </code>
        、
        <code>
         slowlog
        </code>
        、
        <code>
         memory
        </code>
       </li>
       <li>
        外部工具：
        <code>
         redis-cli --bigkeys
        </code>
        、
        <code>
         redis-benchmark
        </code>
       </li>
      </ul>
     </li>
     <li>
      <strong>
       验证解决
      </strong>
      ：变更后通过压测验证效果
     </li>
    </ol>
    <hr/>
    <p>
     <strong>
      附录：常用命令速查表
     </strong>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 实时监控</span>
redis-cli monitor

<span class="token comment"># 内存分析</span>
redis-cli memory stats

<span class="token comment"># 连接池诊断</span>
redis-cli client list
</code></pre>
    <p>
     通过系统化的排查思路和工具链，Redis线上问题将不再令人头疼。建议收藏本文，随时应对突发状况！
    </p>
    <p>
     <strong>
      获取更多技术干货，欢迎关注博主！
     </strong>
     💡
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f36323932323034322f:61727469636c652f64657461696c732f313436313237323330" class_="artid" style="display:none">
 </p>
</div>


