---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f6c3738393738393738393738392f:61727469636c652f64657461696c732f313436323032303532"
layout: post
title: "车载以太网测试-9网络层-子网划分的子网掩码VLAN"
date: 2025-03-13 11:44:25 +0800
description: "车载以太网的网络层是OSI（开放系统互连）模型中的第三层，主要负责数据包的路由和转发，确保数据能够在不同的网络节点之间正确传输。上一专题对以太网网络层的IP协议以及路由协议进行了介绍，本文主要对网络层的子网划分的子网掩码以及VLAN进行介绍。以上对车载以太网网络层的子网掩码、VLAN的定义、广播域以及冲突域的相关概念和原理进行了介绍，并穿插介绍了PVID、VID、Native VLAN、VLAN的端口类型以及VLAN间的通信。希望能对大家理解车载以太网网络层通信有所帮助！"
keywords: "车载以太网测试-9【网络层】-子网划分的子网掩码&VLAN"
categories: ['车载以太网测试']
tags: ['车载系统', '网络协议', '网络', '经验分享', '开发语言', 'Php']
artid: "146202052"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146202052
    alt: "车载以太网测试-9网络层-子网划分的子网掩码VLAN"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146202052
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146202052
cover: https://bing.ee123.net/img/rand?artid=146202052
image: https://bing.ee123.net/img/rand?artid=146202052
img: https://bing.ee123.net/img/rand?artid=146202052
---

# 车载以太网测试-9【网络层】-子网划分的子网掩码&VLAN

## 1 摘要

车载以太网的网络层是OSI（开放系统互连）模型中的第三层，主要负责数据包的路由和转发，确保数据能够在不同的网络节点之间正确传输。上一专题对以太网网络层的IP协议以及路由协议进行了介绍，本文主要对网络层的子网划分的子网掩码以及VLAN进行介绍。

## 2 子网划分

* **子网掩码**
  ：通过子网划分，可以将车载网络划分为多个子网，以提高网络管理的灵活性和效率。
* **VLAN（虚拟局域网）**
  ：在车载以太网中，VLAN技术可以用于将不同的网络流量隔离，提高网络的安全性和性能。

### 2.1 子网掩码

车载以太网的子网掩码与普通以太网的子网掩码概念相同，用于划分网络中的子网。子网掩码是一个32位的二进制数，通常以点分十进制表示（例如255.255.255.0），它决定了IP地址中哪些位用于网络标识，哪些位用于主机标识。
  
在车载以太网中，子网掩码的选择取决于网络设计和需求。以下是一些常见的子网掩码及其对应的网络规模：

1. **255.255.255.0（/24）**
   ：
   * 这是最常见的子网掩码，表示一个子网可以容纳254个主机（2^8 - 2）。
   * 适用于中小型车载网络。
2. **255.255.0.0（/16）**
   ：
   * 这个子网掩码允许一个子网内包含65534个主机（2^16 - 2）。
   * 适用于较大的车载网络。
3. **255.255.255.128（/25）**
   ：
   * 这个子网掩码允许一个子网内包含126个主机（2^7 - 2）。
   * 适用于较小的车载网络。
4. **255.255.255.252（/30）**
   ：
   * 这个子网掩码通常用于点对点连接，只允许2个主机。
   * 适用于车载网络中的特定设备之间的直接连接。

**选择子网掩码的考虑因素：**

* **网络规模**
  ：需要根据网络中设备的数量选择合适的子网掩码。
* **网络拓扑**
  ：复杂的网络拓扑可能需要更细致的子网划分。
* **IP地址管理**
  ：合理划分子网可以简化IP地址管理，避免地址浪费。

**示例：**
  
假设车载以太网的IP地址范围是192.168.1.0/24，那么子网掩码就是255.255.255.0。这意味着：

* 网络地址：192.168.1.0
* 可用主机地址范围：192.168.1.1 到 192.168.1.254
* 广播地址：192.168.1.255
    
  在实际应用中，子网掩码的选择应根据具体的网络需求和设计来确定。
    
  车载以太网（Automotive Ethernet）是一种专为汽车应用设计的以太网技术，它支持高速数据传输和实时通信，适用于现代汽车中复杂的电子系统和网络架构。VLAN（Virtual Local Area Network，虚拟局域网）技术在车载以太网中的应用，主要是为了实现对网络流量的有效管理和隔离，从而提高网络的效率和安全性。

### 2.2 VLAN（虚拟局域网）

IEEE 802.1Q 是一种用于在以太网帧中插入虚拟局域网（VLAN）标签的标准。它允许网络管理员在同一个物理网络中创建多个逻辑网络（VLAN），从而提高网络的灵活性和安全性。

#### 2.2.1 IEEE 802.1Q VLAN标签

##### 2.2.1.1 VLAN标签的结构

IEEE 802.1Q 标签是一个4字节（32位）的字段，插入在以太网帧的源MAC地址和以太网类型/长度字段之间。标签的结构如下：

* Tag Protocol Identifier (TPID): 2字节（16位）
    
  标识帧中是否包含802.1Q标签，固定值为 0x8100，表示这是一个802.1Q标签帧。
* Priority Code Point (PCP): 3位
    
  用于标识帧的优先级，范围从0（最低）到7（最高），常用于服务质量（QoS）机制，以优先处理高优先级流量。
* Canonical Format Indicator (CFI): 1位
    
  用于指示MAC地址是否为规范格式，在以太网中，通常设置为0。
* VLAN Identifier (VID): 12位
    
  标识帧所属的VLAN，有效范围为1到4094，其中0和4095为保留值。

##### 2.2.1.2 VLAN标签的插入

在没有VLAN标签的以太网帧中，TPID字段通常是以太网类型/长度字段（如 0x0800 表示IPv4）。当插入802.1Q标签时，TPID字段被替换为 0x8100，并在其后插入PCP、CFI和VID字段。

##### 2.2.1.3 VLAN标签的处理

VLAN标签的添加：当帧从主机发送到交换机时，交换机可以根据配置的VLAN信息，在帧中添加802.1Q标签。
  
VLAN标签的移除：当帧从交换机发送到主机时，交换机通常会移除802.1Q标签，因为主机可能无法识别或处理VLAN标签。
  
VLAN标签的保留：在交换机之间传输帧时，VLAN标签通常会被保留，以确保帧能够正确地传递到目标VLAN。
  
VLAN是一种将物理网络划分为多个逻辑网络的技术。通过VLAN，可以在同一个物理网络中创建多个独立的广播域，每个VLAN内的设备可以相互通信，而不同VLAN之间的通信则需要通过路由器或三层交换机进行。

##### 2.1.2.4 PVID（Port VLAN Identifier） 和 VID（VLAN Identifier）

车载以太网中的
**PVID（Port VLAN Identifier）**
和
**VID（VLAN Identifier）**
是与 VLAN（虚拟局域网）相关的概念，用于在车载网络中实现数据包的隔离和分类。以下是它们的详细介绍：

1. VID（VLAN Identifier）
     
   定义：VID 是 VLAN 的唯一标识符，用于区分不同的 VLAN。它是一个 12 位的字段，取值范围为 1 到 4094。
     
   作用：在数据帧中，VID 用于标记该数据帧属于哪个 VLAN。交换机根据 VID 将数据帧转发到相应的 VLAN。
     
   示例：如果一个数据帧的 VID 为 10，表示它属于 VLAN 10，交换机会将其转发到 VLAN 10 的端口。
2. PVID（Port VLAN Identifier）
     
   定义：PVID 是端口的默认 VLAN ID，表示该端口在没有明确 VLAN 标记的情况下，会将接收到的数据帧归类到哪个 VLAN。
     
   **作用：**
     
   当端口接收到未标记（untagged）的数据帧时，交换机会根据 PVID 为该数据帧分配一个 VLAN。
     
   当端口发送数据帧时，如果数据帧的 VID 与 PVID 相同，交换机会移除 VLAN 标记（untagged）。
     
   \*\*配置：\*\*每个端口都有一个 PVID，通常默认值为 1（默认 VLAN），但可以根据需要进行配置。
     
   示例：如果一个端口的 PVID 设置为 20，那么所有未标记的数据帧都会被归类到 VLAN 20。
3. PVID 和 VID 的关系
     
   接收数据帧时：
     
   如果数据帧带有 VLAN 标记（tagged），交换机会根据 VID 转发数据帧。
     
   如果数据帧未标记（untagged），交换机会根据端口的 PVID 为其分配一个 VLAN。
     
   发送数据帧时：
     
   如果数据帧的 VID 与端口的 PVID 相同，交换机会移除 VLAN 标记（untagged）。
     
   如果数据帧的 VID 与端口的 PVID 不同，交换机会保留 VLAN 标记（tagged）。
4. 在车载以太网中的应用
     
   在车载网络中，不同功能模块（如动力系统、娱乐系统、ADAS 等）通常需要隔离。通过配置 PVID 和 VID，可以实现以下功能：
     
   数据隔离：将不同功能模块的数据分配到不同的 VLAN，避免相互干扰。
     
   优先级管理：通过 VLAN 标记，可以为不同功能模块的数据设置不同的优先级。
     
   简化网络设计：通过 PVID 和 VID 的配置，可以灵活地管理网络流量，减少硬件成本。

5.总结

* VID 是数据帧的 VLAN 标识，用于区分不同的 VLAN。
* PVID 是端口的默认 VLAN ID，用于处理未标记的数据帧。
    
  在车载以太网中，PVID 和 VID 的合理配置可以实现数据隔离、优先级管理和网络优化。通过理解 PVID 和 VID 的作用和关系，可以更好地设计和维护车载以太网系统。

##### 2.1.2.5 **Native VLAN**

* **定义**
  ：在交换机的VLAN配置中，Native VLAN（本征 VLAN）是一个特殊的概念，主要用于处理不带标签的报文。以下是Native VLAN端口在处理不带标签的报文和带标签的报文时的接收与发送方式：
* **工作原理**
  ：
* + **工作原理**
    ：
  + **接收报文**

    - **不带标签的报文**
      ：当交换机接收到一个不带标签的报文时，交换机会将该报文归类到Native VLAN中。 报文在交换机内部会被视为属于Native VLAN的流量。 如果报文的接收端口配置了Native VLAN，交换机会根据Native VLAN的配置进行转发。
    - **带标签的报文**
      ： 当交换机接收到一个带标签的报文时，交换机会检查报文的VLAN标签。 如果报文的VLAN标签与Native VLAN的VLAN ID相同，交换机会根据配置决定是否保留标签或去掉标签。如果报文的VLAN标签与Native VLAN的VLAN ID不同，交换机会根据报文的VLAN标签进行转发。
  + **发送报文**

    - **发送到Native VLAN的报文**
      ：当交换机需要发送一个属于Native VLAN的报文时，如果发送端口配置了Native VLAN，交换机会去掉报文的VLAN标签，发送不带标签的报文。这是为了确保与其他不支持VLAN标签的设备兼容。
    - **发送到非Native VLAN的报文**
      ：当交换机需要发送一个不属于Native VLAN的报文时，交换机会保留报文的VLAN标签，并发送带标签的报文。 这是为了确保接收端能够正确识别报文的VLAN归属。
* **Native VLAN的配置**

  + Native VLAN通常默认是VLAN 1，但可以根据需要进行配置。
  + 在Trunk端口上，Native VLAN的配置尤其重要，因为它决定了如何处理不带标签的报文。
* **总结**

  + **接收不带标签的报文**
    ：归类到Native VLAN。
  + **接收带标签的报文**
    ：根据VLAN标签进行处理。
  + **发送Native VLAN的报文**
    ：去掉标签，发送不带标签的报文。
  + **发送非Native VLAN的报文**
    ：保留标签，发送带标签的报文。

以下是PVID、VID和Native VLAN的异同对比表：

| **特性** | **PVID (Port VLAN ID)** | **VID (VLAN ID)** | **Native VLAN** |
| --- | --- | --- | --- |
| **定义** | 端口默认的VLAN ID，用于标识未标记的流量 | VLAN的唯一标识符，用于区分不同的VLAN | 交换机端口上用于处理未标记流量的VLAN |
| **作用** | 指定端口接收未标记流量时所属的VLAN | 标识不同的VLAN，用于隔离广播域 | 处理未标记的流量，通常用于与不支持VLAN的设备通信 |
| **应用场景** | 用于接入端口，处理未标记的流量 | 用于所有VLAN相关的配置和通信 | 用于Trunk端口，处理未标记的流量 |
| **默认值** | 通常为VLAN 1 | 无默认值，需手动配置 | 通常为VLAN 1 |
| **标记方式** | 不直接标记流量，但指定未标记流量的VLAN | 用于标记流量，标识流量所属的VLAN | 不标记流量，直接传输未标记的流量 |
| **配置位置** | 交换机端口配置 | VLAN数据库配置 | 交换机Trunk端口配置 |
| **流量处理** | 接收未标记流量时，将其分配到PVID指定的VLAN | 用于标识和隔离不同VLAN的流量 | 接收未标记流量时，将其分配到Native VLAN |
| **兼容性** | 用于与不支持VLAN的设备通信 | 用于所有支持VLAN的设备 | 用于与不支持VLAN的设备通信，或与其他交换机的Trunk端口通信 |

**总结：**

* **PVID**
  ：用于指定端口接收未标记流量时所属的VLAN。
* **VID**
  ：用于唯一标识一个VLAN，是VLAN的核心标识符。
* **Native VLAN**
  ：用于处理Trunk端口上的未标记流量，通常与PVID相同，但在Trunk端口上有特殊用途。

#### 2.2.2 VLAN的划分方式

VLAN（Virtual Local Area Network，虚拟局域网）主要有以下几种：

1. 基于端口的VLAN划分
   * **定义**
     ：根据交换机的物理端口来划分VLAN。
   * **特点**
     ：简单易行，配置直观，但灵活性较差。
   * **应用场景**
     ：适用于网络结构相对简单且变化不大的环境。

**2. 基于MAC地址的VLAN划分**

* **定义**
  ：根据设备的MAC地址来划分VLAN。
* **特点**
  ：灵活性高，设备移动时VLAN配置不变，但配置复杂，管理难度较大。
* **应用场景**
  ：适用于设备频繁移动或网络结构复杂的环境。

**3. 基于协议的VLAN划分**

* **定义**
  ：根据网络层协议（如IP、IPX等）来划分VLAN。
* **特点**
  ：可以根据不同的网络协议进行划分，适用于多协议环境，但配置较为复杂。
* **应用场景**
  ：适用于支持多种网络协议的环境。

**4. 基于子网的VLAN划分**

* **定义**
  ：根据IP地址的子网来划分VLAN。
* **特点**
  ：配置相对简单，便于管理，但需要网络设备支持三层交换功能。
* **应用场景**
  ：适用于基于IP地址的网络环境。

**5. 基于策略的VLAN划分**

* **定义**
  ：根据预定义的策略（如端口、MAC地址、IP地址等组合）来划分VLAN。
* **特点**
  ：灵活性最高，配置复杂，管理难度大。
* **应用场景**
  ：适用于需要高度灵活性和复杂策略的网络环境。

**6. 基于用户的VLAN划分**

* **定义**
  ：根据用户的身份或组别来划分VLAN。
* **特点**
  ：安全性高，便于管理，但需要身份认证系统的支持。
* **应用场景**
  ：适用于需要严格用户管理的环境，如企业网络。

**7. 基于应用的VLAN划分**

* **定义**
  ：根据应用程序或服务类型来划分VLAN。
* **特点**
  ：可以根据不同的应用需求进行划分，提高网络资源利用率。
* **应用场景**
  ：适用于需要区分不同应用服务的网络环境。

**8. 基于时间的VLAN划分**

* **定义**
  ：根据时间策略来划分VLAN。
* **特点**
  ：可以根据时间动态调整VLAN配置，灵活性高。
* **应用场景**
  ：适用于需要根据时间动态调整网络策略的环境。

不同的VLAN划分方式适用于不同的网络环境和需求，选择合适的划分方式可以提高网络的管理效率和安全性。

**VLAN的配置示例**
：
  
以下是一个简单的车载以太网VLAN配置示例：

1. **定义VLAN**
   ：首先在交换机上定义不同的VLAN，例如VLAN 10用于娱乐系统，VLAN 20用于驾驶辅助系统，VLAN 30用于车身控制系统。
2. **配置端口VLAN**
   ：将连接到娱乐系统设备的交换机端口配置为VLAN 10，连接到驾驶辅助系统设备的端口配置为VLAN 20，连接到车身控制系统设备的端口配置为VLAN 30。
3. **配置Trunk端口**
   ：如果需要跨交换机传输多个VLAN的流量，可以配置Trunk端口，并在Trunk端口上启用IEEE 802.1Q协议，以支持VLAN标签的传输。

#### 3.2.3 VLAN的端口类型

车载以太网中的VLAN端口类型根据不同的应用场景和需求进行选择和配置。Access端口适用于简单的终端设备连接，Trunk端口适用于交换机之间的互联，Hybrid端口则提供了更高的灵活性。此外，Native VLAN、Voice VLAN和Management VLAN等特殊VLAN类型也根据具体需求在网络中发挥作用。以下是常见的VLAN端口类型及其通信原理：

##### 3.2.3.1 **Access端口**

* **定义**
  ：Access端口是用于连接终端设备（如PC、打印机等）的端口，通常只允许一个VLAN的数据通过。
* **工作原理**
  ：
  + **不带标签的报文（Untagged Frames）**
    - **接收报文**
      ：当Access端口接收到一个不带标签的报文时，交换机会为该报文打上该端口的默认VLAN（PVID，Port VLAN ID）标签，然后将报文转发到相应的VLAN中。
    - **发送报文**
      ：当Access端口需要发送报文到终端设备时，交换机会将报文的VLAN标签移除，发送一个不带标签的报文到终端设备。
  + **带标签的报文（Tagged Frames）**
    - **接收报文**
      ：当Access端口接收到一个带标签的报文时，交换机会检查该报文的VLAN标签是否与端口的默认VLAN（PVID）一致。如果一致，交换机会处理该报文；如果不一致，交换机会丢弃该报文。
    - **发送报文**
      ：Access端口通常不会发送带标签的报文到终端设备，因为终端设备通常无法处理VLAN标签。如果交换机需要将带标签的报文发送到其他交换机或支持VLAN的设备，会通过Trunk端口或Hybrid端口进行转发。

因此，Access端口能够确保终端设备与交换机之间的通信在正确的VLAN中进行，同时避免终端设备接收到无法处理的带标签报文。

* **应用场景**
  ：
    
  在网络交换设备中，Access端口通常用于连接终端设备（如PC、打印机等）。

##### 3.2.3.2 **Trunk端口**

* **定义**
  ：在网络设备中，Trunk端口用于传输多个VLAN的流量，通常用于交换机之间的连接。Trunk端口处理不带标签的报文和带标签的报文的方式有所不同，具体如下：
* **工作原理**
  ：

  + **不带标签的报文（Untagged Frame）**

    - **接收报文**
      ：当Trunk端口接收到一个不带标签的报文时，交换机会根据端口的默认VLAN（PVID，Port VLAN ID）来标记该报文。PVID是在Trunk端口上配置的，表示该端口默认所属的VLAN。报文会被打上PVID对应的VLAN标签，然后在交换机内部进行处理。
    - **发送报文**
      ：当Trunk端口需要发送一个不带标签的报文时，交换机会根据报文的VLAN信息决定是否去掉标签。通常，Trunk端口会将报文打上VLAN标签后再发送出去。如果Trunk端口配置为允许某个VLAN的流量以不带标签的方式发送（例如在某些特定场景下），交换机会在发送前去掉该报文的VLAN标签。
  + **带标签的报文（Tagged Frame）**

    - **接收报文**
      ： 当Trunk端口接收到一个带标签的报文时，交换机会直接读取报文中的VLAN标签，并根据该标签将报文转发到相应的VLAN。如果报文中的VLAN标签与Trunk端口允许的VLAN列表不匹配，报文可能会被丢弃，具体取决于交换机的配置。
    - **发送报文**
      ： 当Trunk端口需要发送一个带标签的报文时，交换机会直接将该报文发送出去，保留VLAN标签。Trunk端口通常会保留报文的VLAN标签，以便接收端交换机能够正确识别报文所属的VLAN。
* **应用场景**
  ：交换机之间的连接，支持多VLAN传输。
* **总结**

  + **接收**
    ：Trunk端口根据报文的标签状态（带标签或不带标签）来决定如何处理。不带标签的报文会被打上PVID标签，带标签的报文则直接根据标签进行处理。
  + **发送**
    ：Trunk端口通常会保留报文的VLAN标签，除非特别配置为去掉某个VLAN的标签。

这种处理方式确保了Trunk端口能够有效地在多个VLAN之间传输流量，同时保持VLAN的隔离和正确的转发行为。

##### 3.2.3.3 **Hybrid端口**

* **定义**
  ：Hybrid端口是Access端口和Trunk端口的结合体，Hybrid端口是一种可以同时处理带标签（Tagged）和不带标签（Untagged）报文的端口类型。它通常用于交换机或路由器上，特别是在VLAN（虚拟局域网）环境中。Hybrid端口的通信方式如下：
* **工作原理**
  ：

  + **不带标签的报文（Untagged Frame）**
    - **接收报文**
      ：当Hybrid端口接收到一个不带标签的报文时，交换机会根据端口的配置，为该报文分配一个默认的VLAN ID（PVID，Port VLAN ID）。报文在交换机内部会被标记为这个PVID，并按照该VLAN的规则进行转发。
    - **发送处理**
      ：当Hybrid端口需要发送一个不带标签的报文时，交换机会检查该报文的VLAN ID是否与端口的PVID一致。如果一致，交换机会将VLAN标签移除，并将报文以不带标签的形式发送出去。如果不一致，则不会通过该端口发送该报文，除非端口配置允许发送其他VLAN的报文。
  + **带标签的报文（Tagged Frame）**
    - **接收处理**
      ：当Hybrid端口接收到一个带标签的报文时，交换机会检查该报文的VLAN ID。如果该VLAN ID在端口的允许列表中（即端口配置允许接收该VLAN的报文），则报文会被正常接收并按照VLAN规则转发。如果VLAN ID不在允许列表中，则报文会被丢弃。
    - **发送处理**
      ：当Hybrid端口需要发送一个带标签的报文时，交换机会检查该报文的VLAN ID。如果端口配置允许发送该VLAN的报文，则报文会以带标签的形式发送出去。如果端口配置不允许发送该VLAN的报文，则报文不会被发送。
* **应用场景**
  ：Hybrid端口常用于连接交换机与交换机、交换机与路由器、交换机与服务器等场景，特别是在需要同时处理多个VLAN的情况下。
* **总结**
    
  Hybrid端口通过灵活的配置，能够同时处理带标签和不带标签的报文，适用于多种网络场景。通过合理配置，可以实现不同VLAN之间的通信，同时保持网络的简洁性和高效性。

##### 3.2.3.4 **General端口**

* **定义**
  ：在以太网交换机中，
  **General端口**
  （也称为
  **Hybrid端口**
  ）是一种灵活的端口类型，可以同时处理
  **带标签的报文（Tagged Frame）
  **和**
  不带标签的报文（Untagged Frame）**
  。其通信方式取决于端口的配置和报文类型。以下是General端口处理这两种报文的具体方式：
* **工作原理**
  ：

  + **不带标签的报文（Untagged Frame）**

    - **接收报文**
      ：当General端口接收到不带标签的报文时，交换机会根据端口的\*\*PVID（Port VLAN ID）\*\*为该报文打上相应的VLAN标签。例如，如果端口的PVID为10，则交换机会为该报文打上VLAN 10的标签。
    - **发送处理**
      ：在发送报文时，如果端口的配置允许将该VLAN的报文以不带标签的方式发送，则交换机会移除VLAN标签，将报文作为Untagged Frame发送出去。如果端口配置不允许，则报文会以Tagged Frame的形式发送。
  + **带标签的报文（Tagged Frame）**

    - **接收报文**
      ：当General端口接收到带标签的报文时，交换机会检查该报文的VLAN标签是否在端口的允许VLAN列表中。如果VLAN标签被允许，则报文会被正常处理；如果VLAN标签不被允许，则报文会被丢弃。
    - **发送处理**
      ： 在发送报文时，如果端口的配置允许将该VLAN的报文以带标签的方式发送，则报文会保留VLAN标签。如果端口配置不允许，则交换机会根据配置决定是否移除VLAN标签或以不带标签的方式发送。
* **应用场景**
  ：需要灵活配置VLAN标签的场景。
* **General端口的关键配置**
  ：

  + **PVID（Port VLAN ID）**
    ：
    - 为不带标签的报文分配默认VLAN标签。
  + **允许的VLAN列表**
    ：
    - 指定端口可以接收和发送哪些VLAN的报文。
  + **Tagged/Untagged配置**
    ：
    - 指定某个VLAN的报文在发送时是否保留标签。
* **示例**
  ：

  + 假设General端口的PVID为10，允许VLAN 10和VLAN 20的报文，并配置为：
    - VLAN 10的报文以不带标签的方式发送。
    - VLAN 20的报文以带标签的方式发送。
  + **接收**
    ：
    - 收到不带标签的报文时，打上VLAN 10的标签。
    - 收到带VLAN 20标签的报文时，正常处理。
  + **发送**
    ：
    - 发送VLAN 10的报文时，移除标签。
    - 发送VLAN 20的报文时，保留标签。
* **以下是Access端口、Trunk端口、Hybrid端口和General端口的异同对比表：**

| 特性/端口类型 | Access端口 | Trunk端口 | Hybrid端口 | General端口 |
| --- | --- | --- | --- | --- |
| **主要用途** | 连接终端设备 | 连接交换机或路由器 | 连接交换机或终端设备 | 连接交换机或终端设备 |
| **VLAN处理** | 仅支持单个VLAN | 支持多个VLAN | 支持多个VLAN | 支持多个VLAN |
| **默认VLAN** | 有默认VLAN（PVID） | 有默认VLAN（PVID） | 有默认VLAN（PVID） | 有默认VLAN（PVID） |
| **帧标记** | 不标记帧 | 标记帧（802.1Q） | 可标记或不标记帧 | 可标记或不标记帧 |
| **接收未标记帧** | 将帧分配到默认VLAN | 将帧分配到默认VLAN | 将帧分配到默认VLAN | 将帧分配到默认VLAN |
| **接收标记帧** | 丢弃标记帧 | 根据标记的VLAN处理 | 根据标记的VLAN处理 | 根据标记的VLAN处理 |
| **发送帧** | 发送未标记帧 | 发送标记帧 | 可发送标记或未标记帧 | 可发送标记或未标记帧 |
| **VLAN成员关系** | 仅属于一个VLAN | 属于多个VLAN | 属于多个VLAN | 属于多个VLAN |
| **典型应用场景** | 连接PC、打印机等终端设备 | 交换机间链路 | 需要灵活VLAN处理的场景 | 需要灵活VLAN处理的场景 |
| **兼容性** | 仅适用于终端设备 | 适用于交换机间连接 | 适用于交换机间和终端设备 | 适用于交换机间和终端设备 |

* **详细说明：**

1. **Access端口**
   ：通常用于连接终端设备，如PC、打印机等。它只能属于一个VLAN，并且不会对帧进行标记。接收到的帧会被分配到默认VLAN，发送的帧也不会带有VLAN标记。
2. **Trunk端口**
   ：通常用于交换机之间的连接，支持多个VLAN。它会对帧进行标记（802.1Q），以便在交换机之间传递多个VLAN的流量。接收到的标记帧会根据标记的VLAN进行处理，未标记的帧会被分配到默认VLAN。
3. **Hybrid端口**
   ：是Access端口和Trunk端口的结合体，既可以连接终端设备，也可以连接交换机。它支持多个VLAN，并且可以根据配置选择是否对帧进行标记。这使得它在需要灵活VLAN处理的场景中非常有用。
4. **General端口**
   ：类似于Hybrid端口，支持多个VLAN，并且可以根据配置选择是否对帧进行标记。它适用于需要灵活VLAN处理的场景，可以连接交换机或终端设备。

* **以下是Hybrid端口和General端口的异同对比表：**

| **特性** | **Hybrid端口** | **General端口** |
| --- | --- | --- |
| **定义** | 一种特殊的交换机端口模式，可以同时处理带标签（Tagged）和不带标签（Untagged）的数据帧。 | 华为设备中的一种端口模式，类似于Hybrid端口，支持Tagged和Untagged帧的处理。 |
| **Tagged帧处理** | 支持 | 支持 |
| **Untagged帧处理** | 支持 | 支持 |
| **VLAN标记** | 可以手动指定端口在发送Untagged帧时是否添加VLAN标记。 | 可以手动指定端口在发送Untagged帧时是否添加VLAN标记。 |
| **灵活性** | 更灵活，可以同时属于多个VLAN，并且可以自定义Tagged和Untagged帧的处理方式。 | 灵活性稍低，但功能与Hybrid端口类似。 |
| **默认行为** | 默认情况下，Hybrid端口不会自动添加VLAN标记，需要手动配置。 | 默认情况下，General端口也不会自动添加VLAN标记，需要手动配置。 |
| **厂商支持** | 主要见于华为、H3C等厂商的设备。 | 华为设备专用，其他厂商通常使用Hybrid端口模式。 |
| **配置命令** | 使用 `port hybrid` 相关命令配置。 | 使用 `port general` 相关命令配置。 |
| **适用场景** | 适用于需要同时处理Tagged和Untagged帧的复杂网络环境。 | 适用于华为设备中需要灵活处理VLAN标记的场景。 |

* **相同点**
  ：Hybrid端口和General端口都支持Tagged和Untagged帧的处理，并且可以手动配置VLAN标记行为。
* **不同点**
  ：Hybrid端口是更通用的术语，适用于多厂商设备；而General端口是华为设备中的特定实现，功能与Hybrid端口类似，但命名和配置命令有所不同。

#### 3.2.4 **VLAN间通信**

* **定义**
  ：VLAN（Virtual Local Area Network，虚拟局域网）是一种将物理网络划分为多个逻辑网络的技术。VLAN的主要目的是隔离广播域，提高网络的安全性和管理灵活性。然而，在某些情况下，不同VLAN之间需要进行通信。VLAN间通信的原理主要依赖于
  **三层设备**
  （如路由器或三层交换机）来实现。以下是VLAN间通信的基本原理和工作流程：
* **VLAN间通信的基本概念**

  + **VLAN隔离**
    ：默认情况下，不同VLAN之间的设备无法直接通信，因为它们处于不同的广播域。
  + **三层设备的作用**
    ：为了实现VLAN间通信，需要通过三层设备（如路由器或三层交换机）进行数据包的转发。三层设备能够识别IP地址，并根据路由表将数据包从一个VLAN转发到另一个VLAN。
* **VLAN间通信的实现方式**

  + **使用路由器（Router）**

    - **单臂路由（Router on a Stick）**
      ：路由器通过一个物理接口连接交换机，并在该接口上配置多个子接口（Sub-interface），每个子接口对应一个VLAN。交换机将不同VLAN的流量通过Trunk链路发送到路由器的子接口。
        
      路由器根据子接口的配置，对数据包进行路由转发，从而实现VLAN间通信。
    - **优点**
      ：节省路由器接口。
    - **缺点**
      ：性能可能成为瓶颈，因为所有VLAN的流量都通过一个物理接口。
  + **多接口路由**
    ：路由器的每个物理接口连接一个VLAN。路由器根据接口的IP地址和路由表，将数据包从一个VLAN转发到另一个VLAN。

    - **优点**
      ：性能较好。
    - **缺点**
      ：需要多个物理接口，成本较高。
  + **使用三层交换机（Layer 3 Switch）**
      
    三层交换机结合了交换机和路由器的功能，可以在硬件层面实现VLAN间路由。三层交换机为每个VLAN配置一个虚拟接口（SVI，Switch Virtual Interface），并为每个SVI分配IP地址。当不同VLAN的设备需要通信时，三层交换机根据路由表将数据包从一个VLAN转发到另一个VLAN。
  + **优点**
    ：性能高，延迟低。
  + **缺点**
    ：成本较高。
* **VLAN间通信的工作流程**
    
  以下是VLAN间通信的典型工作流程（以三层交换机为例）：

  + **数据包发送**
    ：
      
    源设备（如PC1）在VLAN 10中，目标设备（如PC2）在VLAN 20中。PC1发送数据包时，目标IP地址为PC2的IP地址。
  + **查找网关**
    ：
      
    PC1发现目标IP地址不在同一网段，于是将数据包发送到默认网关（VLAN 10的SVI接口）。
  + **路由转发**
    ：
      
    三层交换机收到数据包后，检查目标IP地址，并根据路由表确定数据包需要转发到VLAN 20。
  + **数据包转发**
    ：
      
    三层交换机将数据包从VLAN 10的SVI接口转发到VLAN 20的SVI接口。
  + **数据包接收**
    ：
      
    数据包到达VLAN 20后，交换机将数据包发送给PC2。
* **配置VLAN间通信的关键点**

  + **VLAN划分**
    ：确保不同VLAN的设备和接口正确配置。
  + **IP地址分配**
    ：为每个VLAN的SVI接口或路由器子接口分配IP地址，并确保设备配置正确的默认网关。
  + **路由配置**
    ：在三层设备上配置静态路由或动态路由协议，以确保VLAN间通信的路径正确。
  + **Trunk链路**
    ：在交换机和路由器之间配置Trunk链路，以传输多个VLAN的流量。
* **总结**
    
  VLAN间通信的核心是通过三层设备（路由器或三层交换机）实现不同VLAN之间的数据包转发。单臂路由适用于小型网络，而三层交换机更适合中大型网络，能够提供更高的性能和更低的延迟。正确配置VLAN、IP地址和路由是实现VLAN间通信的关键。

## 3 广播域与冲突域

以太网（Ethernet）是局域网（LAN）中最常用的网络技术之一。在以太网中，广播域（Broadcast Domain）和冲突域（Collision Domain）是两个重要的概念，它们分别描述了网络中数据传播和冲突的范围。

### 3.1 广播域（Broadcast Domain）

广播域是指网络中所有能够接收到广播消息的设备集合。广播消息是发送到网络中所有设备的特殊消息，通常用于网络发现、地址解析（如ARP协议）等。

* **定义**
  ：广播域是网络中所有能够接收到同一广播消息的设备集合。
* **范围**
  ：在一个广播域中，广播消息会被传播到所有设备，无论它们是否直接相连。
* **设备影响**
  ：
  + **集线器（Hub）**
    ：集线器会将广播消息转发到所有端口，因此所有连接到集线器的设备都在同一个广播域中。
  + **交换机（Switch）**
    ：交换机默认情况下会将广播消息转发到所有端口，因此所有连接到交换机的设备也在同一个广播域中。
  + **路由器（Router）**
    ：路由器不会转发广播消息，因此它会分隔广播域。每个路由器的接口通常属于不同的广播域。

### 3.2 冲突域（Collision Domain）

冲突域是指网络中所有可能发生数据冲突的设备集合。冲突发生在多个设备同时尝试在同一物理介质上发送数据时，导致数据包碰撞和丢失。

* **定义**
  ：冲突域是网络中所有可能发生数据冲突的设备集合。
* **范围**
  ：在一个冲突域中，多个设备共享同一物理介质，如果它们同时发送数据，就会发生冲突。
* **设备影响**
  ：
  + **集线器（Hub）**
    ：集线器是一个共享介质设备，所有连接到集线器的设备都在同一个冲突域中。
  + **交换机（Switch）**
    ：交换机为每个端口创建一个独立的冲突域。因此，连接到交换机的每个设备都在自己的冲突域中，不会与其他设备发生冲突。
  + **路由器（Router）**
    ：路由器也会分隔冲突域，每个接口通常属于不同的冲突域。

### 3.3 广播域与冲突域的对比

* **广播域**
  ：所有能够接收到广播消息的设备集合。集线器和交换机不会分隔广播域，而路由器会分隔广播域。关注的是网络中广播消息的传播范围，通常由路由器或 VLAN 技术进行隔离。
* **冲突域**
  ：所有可能发生数据冲突的设备集合。集线器不分隔冲突域，而交换机和路由器会分隔冲突域。关注的是网络中数据冲突的范围，通常由交换机进行隔离。
    
  **以下是车载以太网广播域与冲突域的异同对比表：**

| **特性** | **广播域** | **冲突域** |
| --- | --- | --- |
| **定义** | 广播域是指网络中所有能够接收到广播消息的设备集合。 | 冲突域是指网络中所有共享同一传输介质并可能发生数据冲突的设备集合。 |
| **范围** | 广播域的范围通常比冲突域大，可以跨越多个交换机或路由器。 | 冲突域的范围通常较小，通常局限于同一物理网段或同一交换机端口。 |
| **设备影响** | 广播域由交换机、路由器等设备划分，路由器可以隔离广播域。 | 冲突域由集线器、交换机等设备划分，交换机可以隔离冲突域。 |
| **数据传播** | 广播域内的设备可以接收到广播、组播和未知单播帧。 | 冲突域内的设备在发送数据时可能会发生冲突，导致数据重传。 |
| **性能影响** | 广播域过大可能导致广播风暴，影响网络性能。 | 冲突域过大会增加冲突概率，降低网络效率。 |
| **隔离方式** | 通过路由器或 VLAN 技术隔离广播域。 | 通过交换机或网桥隔离冲突域。 |
| **常见设备** | 路由器、三层交换机 | 集线器、交换机 |
| **车载以太网应用** | 在车载以太网中，广播域用于实现车辆内部各ECU（电子控制单元）之间的通信。 | 在车载以太网中，冲突域通常较小，因为现代车载网络多采用全双工通信，冲突较少发生。 |

## 4 总结

以上对车载以太网网络层的子网掩码、VLAN的定义、广播域以及冲突域的相关概念和原理进行了介绍，并穿插介绍了PVID、VID、Native VLAN、VLAN的端口类型以及VLAN间的通信。希望能对大家理解车载以太网网络层通信有所帮助！