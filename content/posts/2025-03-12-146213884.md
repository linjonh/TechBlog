---
layout: post
title: "侯捷-C-课程学习笔记进阶语法之lambda表达式二"
date: 2025-03-12 20:17:47 +0800
description: "侯捷 C++ 课程学习笔记：进阶语法之lambda表达式（二）"
keywords: "侯捷 C++ 课程学习笔记：进阶语法之lambda表达式（二）"
categories: ['读研的日常拾光']
tags: ['笔记', '开发语言', '学习', 'C']
artid: "146213884"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146213884
    alt: "侯捷-C-课程学习笔记进阶语法之lambda表达式二"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146213884
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146213884
cover: https://bing.ee123.net/img/rand?artid=146213884
image: https://bing.ee123.net/img/rand?artid=146213884
img: https://bing.ee123.net/img/rand?artid=146213884
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     侯捷 C++ 课程学习笔记：进阶语法之lambda表达式（二）
    </h1>
   </div>
  </div>
 </div>
 <a data-report-click='{"spm":"1001.2101.3001.8632"}' data-report-query="spm=1001.2101.3001.8632" data-report-view='{"spm":"1001.2101.3001.8632"}' href="https://activity.csdn.net/writing?id=10820" id="creatActivityHref" style="display:block;margin-top:16px;font-size:16px;color:#5094d5;font-weight:500" target="_blank">
  #“学C++，赢好礼”——侯捷C++系列精品课学习笔记征文活动#
 </a>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_C_lambda_0">
     </a>
     侯捷 C++ 课程学习笔记：进阶语法之lambda表达式（二）
    </h2>
    <hr/>
    <h3>
     <a id="_4">
     </a>
     一、捕获范围界定
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6e241c08a4de4e148ae9946dc3536e7c.png"/>
    </p>
    <h4>
     <a id="1__7">
     </a>
     1. 局部变量与函数参数
    </h4>
    <ul>
     <li>
      ​
      <strong>
       非静态局部变量
      </strong>
      ：Lambda 所在作用域内定义的局部变量（如函数内部的
      <code>
       int x
      </code>
      ）会被完整复制其当前值。捕获后外部变量的后续修改不影响 Lambda 内部的值。
     </li>
     <li>
      ​
      <strong>
       函数参数
      </strong>
      ：Lambda 所在函数的形参（如
      <code>
       void func(int param)
      </code>
      中的
      <code>
       param
      </code>
      ）同样按值捕获，行为与局部变量一致。
     </li>
    </ul>
    <h4>
     <a id="2__11">
     </a>
     2. 类的成员变量
    </h4>
    <ul>
     <li>
      ​
      <strong>
       隐式捕获 this 指针
      </strong>
      ：当 Lambda 定义在类的成员函数中时，
      <code>
       [=]
      </code>
      会隐式捕获
      <code>
       this
      </code>
      指针，允许通过
      <code>
       this
      </code>
      访问成员变量（如
      <code>
       this-&gt;data
      </code>
      ）。
     </li>
     <li>
      ​
      <strong>
       实时访问特性
      </strong>
      ：成员变量的值在 Lambda 执行时动态获取，而非定义时的快照。若外部修改了成员变量，Lambda 内部访问的是最新值。
     </li>
    </ul>
    <h4>
     <a id="3__15">
     </a>
     3. 块作用域变量
    </h4>
    <ul>
     <li>
      ​
      <strong>
       代码块内变量
      </strong>
      ：在
      <code>
       {}
      </code>
      代码块中定义的变量（如循环或条件分支内声明的
      <code>
       int y
      </code>
      ）也属于捕获范围，行为与局部变量相同。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_20">
     </a>
     二、不捕获的变量类型
    </h3>
    <h4>
     <a id="1__21">
     </a>
     1. 全局变量与静态变量
    </h4>
    <ul>
     <li>
      ​
      <strong>
       全局变量
      </strong>
      ：直接访问全局作用域的变量（如
      <code>
       int global_var
      </code>
      ），无需捕获。
     </li>
     <li>
      ​
      <strong>
       静态局部变量
      </strong>
      ：函数内定义的
      <code>
       static int x
      </code>
      不会被捕获，Lambda 直接访问其内存地址。
     </li>
    </ul>
    <h4>
     <a id="2__25">
     </a>
     2. 未使用的变量
    </h4>
    <ul>
     <li>
      ​
      <strong>
       编译器优化
      </strong>
      ：即使使用
      <code>
       [=]
      </code>
      ，未在 Lambda 函数体中实际使用的外部变量会被自动忽略，不执行捕获操作。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_30">
     </a>
     三、关键注意事项
    </h3>
    <h4>
     <a id="1__31">
     </a>
     1. 值捕获的瞬时性
    </h4>
    <ul>
     <li>
      ​
      <strong>
       快照机制
      </strong>
      ：捕获的变量值在 Lambda ​
      <strong>
       定义时
      </strong>
      生成副本，后续外部修改不影响内部副本（例如外部将
      <code>
       x
      </code>
      从 5 改为 10，Lambda 内部仍使用 。
     </li>
    </ul>
    <h4>
     <a id="2__34">
     </a>
     2. 成员变量的特殊风险
    </h4>
    <ul>
     <li>
      ​
      <strong>
       悬垂指针问题
      </strong>
      ：若 Lambda 被传递到类对象生命周期之外（如跨线程调用），隐式捕获的
      <code>
       this
      </code>
      指针可能指向已销毁的对象，导致未定义行为。
     </li>
    </ul>
    <h4>
     <a id="3__37">
     </a>
     3. 隐式捕获的局限性
    </h4>
    <ul>
     <li>
      ​
      <strong>
       全局变量不可控
      </strong>
      ：由于全局变量未被捕获，其值的变化会直接影响 Lambda 执行结果，可能引发意外副作用。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_42">
     </a>
     四、最佳实践建议
    </h3>
    <h4>
     <a id="1__43">
     </a>
     1. 显式捕获策略
    </h4>
    <ul>
     <li>
      ​
      <strong>
       优先显式列出变量
      </strong>
      ：使用
      <code>
       [x, &amp;y]
      </code>
      而非
      <code>
       [=]
      </code>
      或
      <code>
       [&amp;]
      </code>
      ，明确控制捕获方式，提升代码可读性和安全性。
     </li>
    </ul>
    <h4>
     <a id="2__46">
     </a>
     2. 生命周期管理
    </h4>
    <ul>
     <li>
      ​
      <strong>
       智能指针辅助
      </strong>
      ：对可能跨生命周期的 Lambda，使用
      <code>
       shared_ptr
      </code>
      或
      <code>
       weak_ptr
      </code>
      管理资源，避免悬垂指针问题。
     </li>
    </ul>
    <h4>
     <a id="3__49">
     </a>
     3. 混合捕获优化
    </h4>
    <ul>
     <li>
      ​
      <strong>
       组合捕获模式
      </strong>
      ：灵活搭配
      <code>
       [=, &amp;counter]
      </code>
      （大部分变量按值捕获，仅
      <code>
       counter
      </code>
      按引用）或
      <code>
       [&amp;, id]
      </code>
      （大部分按引用，仅
      <code>
       id
      </code>
      按值），平衡性能与安全性。
     </li>
    </ul>
    <h4>
     <a id="4__52">
     </a>
     4. 避免隐式全捕获
    </h4>
    <ul>
     <li>
      ​
      <strong>
       减少隐式依赖
      </strong>
      ：禁用
      <code>
       [=]
      </code>
      或
      <code>
       [&amp;]
      </code>
      的全捕获方式，防止意外捕获无关变量导致性能损耗或逻辑错误。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_57">
     </a>
     五、典型场景对比
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        场景
       </th>
       <th>
        推荐捕获方式
       </th>
       <th>
        风险提示
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        短暂回调函数
       </td>
       <td>
        <code>
         [x]
        </code>
        显式值捕获
       </td>
       <td>
        避免拷贝大对象
       </td>
      </tr>
      <tr>
       <td>
        跨线程异步任务
       </td>
       <td>
        <code>
         [sp=make_shared]
        </code>
       </td>
       <td>
        防止
        <code>
         this
        </code>
        指针失效
       </td>
      </tr>
      <tr>
       <td>
        STL 算法参数
       </td>
       <td>
        <code>
         [&amp;]
        </code>
        局部引用捕获
       </td>
       <td>
        确保变量生命周期覆盖算法执行
       </td>
      </tr>
      <tr>
       <td>
        成员函数内逻辑封装
       </td>
       <td>
        <code>
         [this, x]
        </code>
       </td>
       <td>
        显式分离成员与局部变量
       </td>
      </tr>
     </tbody>
    </table>
    <div class="mermaid">
     <svg class="mermaid-svg" height="158" id="mermaid-svg-pDcNUDUII8Bd2yNY" viewbox="0 0 828 158" width="828" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-pDcNUDUII8Bd2yNY {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY .error-icon{fill:#552222;}#mermaid-svg-pDcNUDUII8Bd2yNY .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-pDcNUDUII8Bd2yNY .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-pDcNUDUII8Bd2yNY .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-pDcNUDUII8Bd2yNY .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-pDcNUDUII8Bd2yNY .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-pDcNUDUII8Bd2yNY .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-pDcNUDUII8Bd2yNY .marker{fill:#333333;stroke:#333333;}#mermaid-svg-pDcNUDUII8Bd2yNY .marker.cross{stroke:#333333;}#mermaid-svg-pDcNUDUII8Bd2yNY svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-pDcNUDUII8Bd2yNY .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY .cluster-label text{fill:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY .cluster-label span{color:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY .label text,#mermaid-svg-pDcNUDUII8Bd2yNY span{fill:#333;color:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY .node rect,#mermaid-svg-pDcNUDUII8Bd2yNY .node circle,#mermaid-svg-pDcNUDUII8Bd2yNY .node ellipse,#mermaid-svg-pDcNUDUII8Bd2yNY .node polygon,#mermaid-svg-pDcNUDUII8Bd2yNY .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-pDcNUDUII8Bd2yNY .node .label{text-align:center;}#mermaid-svg-pDcNUDUII8Bd2yNY .node.clickable{cursor:pointer;}#mermaid-svg-pDcNUDUII8Bd2yNY .arrowheadPath{fill:#333333;}#mermaid-svg-pDcNUDUII8Bd2yNY .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-pDcNUDUII8Bd2yNY .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-pDcNUDUII8Bd2yNY .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-pDcNUDUII8Bd2yNY .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-pDcNUDUII8Bd2yNY .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-pDcNUDUII8Bd2yNY .cluster text{fill:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY .cluster span{color:#333;}#mermaid-svg-pDcNUDUII8Bd2yNY div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-pDcNUDUII8Bd2yNY :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M290.8125,49.354395604395606L253.34375,54.29532967032967C215.875,59.23626373626374,140.9375,69.11813186813187,103.46875,78.2257326007326C66,87.33333333333333,66,95.66666666666667,66,99.83333333333333L66,104" marker-end="url(#arrowhead56)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead56" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-C" id="L-A-C" style="opacity: 1;">
          <path class="path" d="M342.7916666666667,54L326.9930555555556,58.166666666666664C311.19444444444446,62.333333333333336,279.59722222222223,70.66666666666667,263.79861111111114,79C248,87.33333333333333,248,95.66666666666667,248,99.83333333333333L248,104" marker-end="url(#arrowhead57)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead57" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-D" id="L-A-D" style="opacity: 1;">
          <path class="path" d="M430,54L430,58.166666666666664C430,62.333333333333336,430,70.66666666666667,430,79C430,87.33333333333333,430,95.66666666666667,430,99.83333333333333L430,104" marker-end="url(#arrowhead58)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead58" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-E" id="L-A-E" style="opacity: 1;">
          <path class="path" d="M509.5416666666667,54L523.9513888888889,58.166666666666664C538.3611111111112,62.333333333333336,567.1805555555555,70.66666666666667,581.5902777777777,79C596,87.33333333333333,596,95.66666666666667,596,99.83333333333333L596,104" marker-end="url(#arrowhead59)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead59" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-A LE-F" id="L-A-F" style="opacity: 1;">
          <path class="path" d="M569.1875,51.123493975903614L601.3229166666666,55.769578313253014C633.4583333333334,60.41566265060241,697.7291666666666,69.7078313253012,729.8645833333334,78.52058232931726C762,87.33333333333333,762,95.66666666666667,762,99.83333333333333L762,104" marker-end="url(#arrowhead60)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead60" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-C" id="L-L-A-C">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-D" id="L-L-A-D">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-E" id="L-L-A-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-F" id="L-L-A-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-70" style="opacity: 1;" transform="translate(430,31)">
          <rect class="label-container" height="46" rx="5" ry="5" width="278.375" x="-139.1875" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-129.1875,-13)">
            <foreignobject height="26" width="258.375">
             <div style="display: inline-block; white-space: nowrap;">
              侯捷C++课程学习笔记Lambda表达式
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-71" style="opacity: 1;" transform="translate(66,127)">
          <rect class="label-container" height="46" rx="5" ry="5" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              捕获范围界定
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-73" style="opacity: 1;" transform="translate(248,127)">
          <rect class="label-container" height="46" rx="5" ry="5" width="148" x="-74" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-64,-13)">
            <foreignobject height="26" width="128">
             <div style="display: inline-block; white-space: nowrap;">
              不捕获的变量类型
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-75" style="opacity: 1;" transform="translate(430,127)">
          <rect class="label-container" height="46" rx="5" ry="5" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              关键注意事项
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-77" style="opacity: 1;" transform="translate(596,127)">
          <rect class="label-container" height="46" rx="5" ry="5" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              最佳实践建议
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-79" style="opacity: 1;" transform="translate(762,127)">
          <rect class="label-container" height="46" rx="5" ry="5" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              典型场景对比
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35313335303935372f:61727469636c652f64657461696c732f313436323133383834" class_="artid" style="display:none">
 </p>
</div>


