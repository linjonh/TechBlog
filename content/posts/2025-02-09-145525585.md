---
layout: post
title: "ESP32S3读取数字麦克风INMP441的音频数据"
date: 2025-02-09 01:09:16 +0800
description: "这种连线方式是基于I2S协议的标准连接方法，确保了ESP32S3能够正确地与INMP441麦克风进行通信，实现音频数据的采集和处理。通过将麦克风的I2S信号引脚连接到ESP32的相应GPIO引脚，并配置ESP32的I2S接口，可以实现高质量的音频数据传输。引脚名称功能描述VDD电源引脚，连接1.8V至3.3V的电源GND地引脚，连接电源地SD串行数据输出引脚，通过I2S接口传输数字音频数据SCK串行时钟输入引脚，用于I2S接口的时钟信号WS字选择输入引脚，用于I2S接口的帧同步信号（也称为LRCK）"
keywords: "inmp441 esp32"
categories: ['嵌入式']
tags: ['嵌入式硬件']
artid: "145525585"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145525585
    alt: "ESP32S3读取数字麦克风INMP441的音频数据"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145525585
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145525585
cover: https://bing.ee123.net/img/rand?artid=145525585
image: https://bing.ee123.net/img/rand?artid=145525585
img: https://bing.ee123.net/img/rand?artid=145525585
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ESP32S3读取数字麦克风INMP441的音频数据
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     ESP32S3 与 INMP441 麦克风模块的集成通常涉及使用 I2S 接口进行数字音频数据的传输。INMP441 是一款高性能的数字麦克风，它通过 I2S 接口输出音频数据。在 Arduino 环境中，ESP32S3 的开发通常使用 ESP-IDF（Espressif IoT Development Framework）或兼容的 Arduino Core for ESP32，后者允许你使用类似于 Arduino 的编程模型。
    </p>
    <p>
     由于 Arduino Core for ESP32 对 I2S 的直接支持可能不如 ESP-IDF 那么全面，但你可以使用已有的库或编写自己的代码来与 INMP441 通信。以下是一个简化的步骤指南和示例代码，用于在 Arduino 环境中使用 ESP32S3 读取 INMP441 的数据信号。
    </p>
    <h4>
     <a id="Arduino__5">
     </a>
     软件编程（Arduino 语言风格）
    </h4>
    <p>
     在 Arduino Core for ESP32 中，I2S 的支持可能不如 ESP-IDF 那么直接，但你可以使用现有的库或自己编写代码来配置和使用 I2S 接口。以下是一个简化的示例代码框架，用于初始化 I2S 接口并尝试读取 INMP441 的数据。请注意，这个示例可能需要根据你的具体硬件连接进行调整。
    </p>
    <h4>
     <a id="_7">
     </a>
     硬件连接
    </h4>
    <p>
     <strong>
      1、电源和地线连接
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       INMP441 VCC → ESP32的3.3V
      </strong>
      ：为麦克风模块提供工作电压，确保其正常运行。
     </li>
     <li>
      <strong>
       INMP441 GND → ESP32的GND
      </strong>
      ：完成电路的接地连接，确保电路的稳定性和可靠性。
     </li>
    </ul>
    <p>
     <strong>
      2、I2S 信号线连接
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       INMP441 SCK（时钟）→ ESP32的GPIO 17
      </strong>
      ：SCK是I2S通信的时钟信号，用于同步数据传输。ESP32的GPIO 17被配置为I2S的时钟引脚，以接收来自麦克风的时钟信号。
     </li>
     <li>
      <strong>
       INMP441 WS（帧选择）→ ESP32的GPIO 18
      </strong>
      ：WS用于选择左声道或右声道的数据帧。ESP32的GPIO 18被配置为I2S的帧选择引脚，以识别当前数据帧的声道信息。
     </li>
     <li>
      <strong>
       INMP441 SD（数据）→ ESP32的GPIO 16
      </strong>
      ：SD是传输数字音频数据的信号线。ESP32的GPIO 16被配置为I2S的数据引脚，以接收麦克风采集到的数字音频信号。
     </li>
    </ul>
    <h4>
     <a id="_17">
     </a>
     连线依据总结
    </h4>
    <p>
     这种连线方式是基于I2S协议的标准连接方法，确保了ESP32S3能够正确地与INMP441麦克风进行通信，实现音频数据的采集和处理。通过将麦克风的I2S信号引脚连接到ESP32的相应GPIO引脚，并配置ESP32的I2S接口，可以实现高质量的音频数据传输。
    </p>
    <table>
     <thead>
      <tr>
       <th align="left">
        引脚名称
       </th>
       <th align="left">
        功能描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         VDD
        </strong>
       </td>
       <td align="left">
        电源引脚，连接1.8V至3.3V的电源
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         GND
        </strong>
       </td>
       <td align="left">
        地引脚，连接电源地
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         SD
        </strong>
       </td>
       <td align="left">
        串行数据输出引脚，通过I2S接口传输数字音频数据
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         SCK
        </strong>
       </td>
       <td align="left">
        串行时钟输入引脚，用于I2S接口的时钟信号
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         WS
        </strong>
       </td>
       <td align="left">
        字选择输入引脚，用于I2S接口的帧同步信号（也称为LRCK）
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         L/R
        </strong>
       </td>
       <td align="left">
        左/右声道选择引脚。当该引脚设置为低电平时，麦克风在I²S帧中输出其信号到左声道；当该引脚设置为高电平时，麦克风在I²S帧中输出其信号到右声道
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     这些引脚通过I2S协议实现音频数据的传输，其中SCK、WS和SD是I2S通信的关键引脚，L/R引脚用于选择声道。
    </p>
    <h4>
     <a id="Arduino_30">
     </a>
     Arduino代码
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Arduino.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;driver/i2s.h&gt;</span></span>

<span class="token comment">// 定义I2S引脚</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">I2S_WS</span> <span class="token expression"><span class="token number">18</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">I2S_SD</span> <span class="token expression"><span class="token number">16</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">I2S_SCK</span> <span class="token expression"><span class="token number">17</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">I2S_PORT</span> <span class="token expression">I2S_NUM_0</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">bufferLen</span> <span class="token expression"><span class="token number">1024</span>  </span><span class="token comment">// 缓冲区大小</span></span>

<span class="token keyword">int16_t</span> sBuffer<span class="token punctuation">[</span>bufferLen<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 存储音频数据的缓冲区</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Setup I2S..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 初始化I2S</span>
  i2s_config_t i2s_config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span>mode <span class="token operator">=</span> <span class="token punctuation">(</span>i2s_mode_t<span class="token punctuation">)</span><span class="token punctuation">(</span>I2S_MODE_MASTER <span class="token operator">|</span> I2S_MODE_RX<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>sample_rate <span class="token operator">=</span> <span class="token number">48000</span><span class="token punctuation">,</span>  <span class="token comment">// 采样率</span>
    <span class="token punctuation">.</span>bits_per_sample <span class="token operator">=</span> I2S_BITS_PER_SAMPLE_16BIT<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>channel_format <span class="token operator">=</span> I2S_CHANNEL_FMT_ONLY_LEFT<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>communication_format <span class="token operator">=</span> <span class="token punctuation">(</span>i2s_comm_format_t<span class="token punctuation">)</span><span class="token punctuation">(</span>I2S_COMM_FORMAT_STAND_I2S<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>intr_alloc_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>dma_buf_count <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span>dma_buf_len <span class="token operator">=</span> bufferLen<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>use_apll <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">i2s_driver_install</span><span class="token punctuation">(</span>I2S_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>i2s_config<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  i2s_pin_config_t pin_config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span>bck_io_num <span class="token operator">=</span> I2S_SCK<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>ws_io_num <span class="token operator">=</span> I2S_WS<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>data_out_num <span class="token operator">=</span> I2S_PIN_NO_CHANGE<span class="token punctuation">,</span>
    <span class="token punctuation">.</span>data_in_num <span class="token operator">=</span> I2S_SD
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">i2s_set_pin</span><span class="token punctuation">(</span>I2S_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pin_config<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">i2s_start</span><span class="token punctuation">(</span>I2S_PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 从INMP441读取数据</span>
  size_t bytesIn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  esp_err_t result <span class="token operator">=</span> <span class="token function">i2s_read</span><span class="token punctuation">(</span>I2S_PORT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sBuffer<span class="token punctuation">,</span> bufferLen <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int16_t</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bytesIn<span class="token punctuation">,</span> portMAX_DELAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> ESP_OK <span class="token operator">&amp;&amp;</span> bytesIn <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 通过串口输出数据</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bufferLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>sBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> bufferLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_92">
     </a>
     代码说明
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        I2S配置
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用I2S接口读取INMP441的音频数据。
       </li>
       <li>
        配置采样率为48000Hz，16位深度，单声道。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        音频数据读取
       </strong>
       ：
      </p>
      <ul>
       <li>
        使用
        <code>
         i2s_read
        </code>
        函数从I2S接口读取音频数据。
       </li>
       <li>
        将数据通过UDP发送到接收端。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_101">
     </a>
     注意事项
    </h4>
    <ul>
     <li>
      如果需要本地处理音频数据，可以将数据存储到文件或进行实时分析。
     </li>
    </ul>
    <p>
     通过上述代码，你可以成功读取INMP441麦克风的数据信号，并通过ESP32S3进行处理或传输。
    </p>
    <h4>
     <a id="_107">
     </a>
     实验结果
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/baa67d343a764ad3987e7f11a0309bac.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33393737373535302f:61727469636c652f64657461696c732f313435353235353835" class_="artid" style="display:none">
 </p>
</div>


