---
layout: post
title: "ElasticSearch-入门到放弃持续更新中"
date: 2025-03-13 11:02:01 +0800
description: "一个开源的分布式搜索引擎，可以实现搜索，日志统计，分析，系统监控等的搜索引擎"
keywords: "ElasticSearch 入门到放弃（持续更新中）"
categories: ['知识点', '服务器', '工具类']
tags: ['搜索引擎', 'Wpf', 'Elasticsearch']
artid: "146225399"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146225399
    alt: "ElasticSearch-入门到放弃持续更新中"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146225399
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146225399
cover: https://bing.ee123.net/img/rand?artid=146225399
image: https://bing.ee123.net/img/rand?artid=146225399
img: https://bing.ee123.net/img/rand?artid=146225399
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ElasticSearch 入门到放弃（持续更新中）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     前言
    </h2>
    <blockquote>
     <p>
      什么是ElasticSearch?
     </p>
    </blockquote>
    <p>
     一个开源的分布式搜索引擎，可以实现搜索，日志统计，分析，系统监控等
    </p>
    <blockquote>
     <p>
      什么是ealstic stack (ELK)?
     </p>
    </blockquote>
    <p>
     是以elasticsearch为核心的技术栈，包括beats，Logstash，Kibana，ElasticSearch
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/7cdf408d6907bee3a00d08c96645024b.png"/>
    </p>
    <h2>
     <a id="Ealsticsearch__18">
     </a>
     Ealsticsearch 入门
    </h2>
    <h3>
     <a id="_19">
     </a>
     正向索引、倒排索引
    </h3>
    <h4>
     <a id="_20">
     </a>
     正向索引
    </h4>
    <p>
     是基于MySQL这样的正向索引而言
    </p>
    <blockquote>
     <p>
      设置了索引的话查询很快，但是模糊查询则很慢
     </p>
    </blockquote>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/98e1342013c2a4cb396cda1898e567d6.png"/>
    </p>
    <p>
     如果是根据id查询，那么直接走索引，查询会很快
    </p>
    <p>
     但是基于title做模糊查询，只能逐行扫描数据，也就是全表扫描，随着数据量的增加，查询效率也会越来越低，当数据量达到百万时，就是一场灾难。
    </p>
    <h4>
     <a id="_32">
     </a>
     倒排索引
    </h4>
    <p>
     倒排索引中有两个非常重要的概念：
    </p>
    <ul>
     <li>
      文档
      <code>
       Document
      </code>
      ：用来搜索的数据，其中每一条数据就是一个文档，例如一个网页，一个商品信息
     </li>
     <li>
      词条
      <code>
       Term
      </code>
      ：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条
     </li>
    </ul>
    <p>
     创建倒排索引是对正向索引的一种特殊处理，流程如下：
    </p>
    <ul>
     <li>
      将没一个文档的数据利用分词，得到一个个词条
     </li>
     <li>
      创建表，每行数据包括词条，词条所在的文档，位置等信息
     </li>
     <li>
      因为词条唯一性，可以给词条创建索引，例如hash表结构索引
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/97bda2491e79ccdb11d953c52f807985.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/ceb19963434a66379b1774443f0dc83e.png"/>
    </p>
    <h4>
     <a id="_48">
     </a>
     正向和倒叙对比
    </h4>
    <ul>
     <li>
      <strong>
       正向索引
      </strong>
      是最传统的，根据id索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是
      <strong>
       根据文档找词条的过程
      </strong>
      。
     </li>
     <li>
      而
      <strong>
       倒排索引
      </strong>
      则相反，是先找到用户要搜索的词条，根据词条得到保护词条的文档的id，然后根据id获取文档。是
      <strong>
       根据词条找文档的过程
      </strong>
      。
     </li>
    </ul>
    <p>
     <strong>
      正向索引
     </strong>
     ：
    </p>
    <ul>
     <li>
      优点：
      <ul>
       <li>
        可以给多个字段创建索引
       </li>
       <li>
        根据索引字段搜索、排序速度非常快
       </li>
      </ul>
     </li>
     <li>
      缺点：
      <ul>
       <li>
        根据非索引字段，或者索引字段中的部分词条查找时，只能全表扫描。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      倒排索引
     </strong>
     ：
    </p>
    <ul>
     <li>
      优点：
      <ul>
       <li>
        根据词条搜索、模糊搜索时，速度非常快
       </li>
      </ul>
     </li>
     <li>
      缺点：
      <ul>
       <li>
        只能给词条创建索引，而不是字段
       </li>
       <li>
        无法根据字段做排序
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="ES_68">
     </a>
     ES数据库基本概念
    </h3>
    <h4>
     <a id="_69">
     </a>
     文档和字段
    </h4>
    <blockquote>
     <p>
      文档类似于数据库中的一条数据，字段就像数据库中列
     </p>
    </blockquote>
    <p>
     <code>
      elasticSearch
     </code>
     是面向文档document存储，可以是数据库中的一条商品数据，一个订单信息。文档数据会被序列化为json格式后存储在es中。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/248faf7db54e924c33750e2d256b496b.png"/>
    </p>
    <p>
     而json文档中往往包含很多字段Field，类似于mysql数据库中的列。
    </p>
    <h4>
     <a id="_79">
     </a>
     索引和映射
    </h4>
    <blockquote>
     <p>
      索引就像数据库中的表，映射就像数据库表中的表结构
     </p>
    </blockquote>
    <p>
     <strong>
      索引（Index）
     </strong>
     ，就是相同类型的文档的集合【
     <strong>
      类似mysql中的表
     </strong>
     】
    </p>
    <p>
     例如：
    </p>
    <ul>
     <li>
      所有用户文档，就可以组织在一起，称为用户的索引；
     </li>
     <li>
      所有商品的文档，可以组织在一起，称为商品的索引；
     </li>
     <li>
      所有订单的文档，可以组织在一起，称为订单的索引；
     </li>
    </ul>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/25a9a7462ab5c736c1b422cfdbf799f1.png"/>
    </p>
    <p>
     数据库的表会有约束信息，用来定义表的结构、字段的名称、类型等信息。因此，索引库中就有
     <strong>
      映射（mapping）
     </strong>
     ，是索引中文档的字段约束信息，类似表的结构约束。
    </p>
    <h4>
     <a id="MySQLElasticSearch_95">
     </a>
     MySQL与ElasticSearch
    </h4>
    <p>
     MySQL：擅长事务类型的操作，可以确保数据的安全性和一致性。
    </p>
    <p>
     ElasticSearch：擅长海量的数据的搜索，分析，计算
    </p>
    <h3>
     <a id="ES_100">
     </a>
     ES的安装
    </h3>
    <h4>
     <a id="docker_101">
     </a>
     基于docker
    </h4>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
	<span class="token parameter variable">--name</span> es <span class="token punctuation">\</span>
    <span class="token parameter variable">-e</span> <span class="token string">"http.host=0.0.0.0"</span>
    <span class="token parameter variable">-e</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-e</span> <span class="token string">"discovery.type=single-node"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> /usr/local/docker/es/data:/usr/share/elasticsearch/data <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> /usr/local/docker/es/logs:/usr/share/elasticsearch/logs <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> /usr/local/docker/es/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span>
    <span class="token parameter variable">--privileged</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--network</span> app_net <span class="token punctuation">\</span>
    <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token punctuation">\</span>
    <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token punctuation">\</span>
elasticsearch:7.14.2
</code></pre>
    <h4>
     <a id="dockercompose_118">
     </a>
     基于docker-compose
    </h4>
    <pre><code class="prism language-yaml">cd /usr/local/docker/
mkdir es
cd es
<span class="token comment"># 创建数据卷宿主机路径</span>
mkdir <span class="token punctuation">-</span>p data logs plugins config/analysis<span class="token punctuation">-</span>ik
<span class="token comment"># 授权</span>
chmod 777 data/ logs/ plguins/ config/
</code></pre>
    <pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span> 
  <span class="token comment"># elasticsearch</span>
  <span class="token key atrule">es</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class="token punctuation">:</span>7.14.2
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> es
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9200:9200"</span>
      <span class="token punctuation">-</span> <span class="token string">"9300:9300"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"discovery.type=single-node"</span>
      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>
      <span class="token punctuation">-</span> <span class="token string">"http.host=0.0.0.0"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /usr/local/docker/es/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data
      <span class="token punctuation">-</span> /usr/local/docker/es/logs<span class="token punctuation">:</span>/usr/share/elasticsearch/logs
      <span class="token punctuation">-</span> /usr/local/docker/es/plugins<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins
      <span class="token punctuation">-</span> /usr/local/docker/es/config/analysis<span class="token punctuation">-</span>ik<span class="token punctuation">:</span>/usr/share/elasticsearch/config/analysis<span class="token punctuation">-</span>ik
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> app_net
      
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">app_net</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
</code></pre>
    <h4>
     <a id="_158">
     </a>
     测试安装
    </h4>
    <p>
     <code>
      docker ps
     </code>
     查看进程情况
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a687398806631da650b7a33f9a3e42ea.png"/>
    </p>
    <p>
     <code>
      http://ip:9200/
     </code>
     查看服务安装是否成功
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a383485901bfb577d9b4a0afe86cf40a.png"/>
    </p>
    <h3>
     <a id="Kibana_167">
     </a>
     Kibana的安装
    </h3>
    <h4>
     <a id="docker_168">
     </a>
     基于docker
    </h4>
    <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> kibana <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://es:9200 <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span><span class="token operator">=</span>es-net <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">5601</span>:5601  <span class="token punctuation">\</span>
kibana:7.14.2
</code></pre>
    <h4>
     <a id="dockercompose_178">
     </a>
     基于docker-compose
    </h4>
    <pre><code class="prism language-bash">version: <span class="token string">'3.8'</span>

services: 
  <span class="token comment"># elasticsearch</span>
  es:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.14.2
    container_name: es
    restart: always
    ports:
      - <span class="token string">"9200:9200"</span>
      - <span class="token string">"9300:9300"</span>
    environment:
      - <span class="token string">"discovery.type=single-node"</span>
      - <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>
      - <span class="token string">"http.host=0.0.0.0"</span>
    volumes:
      - /usr/local/docker/es/data:/usr/share/elasticsearch/data
      - /usr/local/docker/es/logs:/usr/share/elasticsearch/logs
      - /usr/local/docker/es/plugins:/usr/share/elasticsearch/plugins
    networks:
      - app_net
  <span class="token comment"># kibana</span>
  kibana:
    image: docker.elastic.co/kibana/kibana:7.14.2
    container_name: kibana
    restart: always
    ports:
      - <span class="token string">"5601:5601"</span>
    environment:
      - <span class="token string">"ELASTICSEARCH_HOSTS=http://es:9200"</span>
    networks:
      - app_net

networks:
  app_net:
    driver: bridge
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c9f1c826b1b6cf7fd9e27189c0a11c91.png"/>
    </p>
    <h3>
     <a id="IK_222">
     </a>
     IK分词器安装
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># 进入容器内部</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> es <span class="token function">bash</span>

<span class="token comment"># 执行安装命令</span>
./bin/elasticsearch-plugin <span class="token function">install</span> https://get.infini.cloud/elasticsearch/analysis-ik/7.14.2

<span class="token comment"># 退出容器内部</span>
<span class="token builtin class-name">exit</span>

<span class="token comment"># docker-compose 重启es</span>
<span class="token function">docker-compose</span> restart es
<span class="token comment"># docker 重启es</span>
<span class="token function">docker</span> restart es
</code></pre>
    <h4>
     <a id="IK_239">
     </a>
     IK分词器模式
    </h4>
    <h5>
     <a id="ik_smart_240">
     </a>
     ik_smart
    </h5>
    <blockquote>
     <p>
      智慧拆分，最少切分
     </p>
    </blockquote>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a2a97f33bfbb68f1218a12c4748323db.png"/>
    </p>
    <h5>
     <a id="ik_max_word_246">
     </a>
     ik_max_word
    </h5>
    <blockquote>
     <p>
      最细切分
     </p>
    </blockquote>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e003896e3dd7284c4355a67e6dd18b33.png"/>
    </p>
    <h5>
     <a id="_252">
     </a>
     自定义分词库
    </h5>
    <pre><code class="prism language-yaml">cd /usr/local/docker/es/config/analysis<span class="token punctuation">-</span>ik/

<span class="token comment"># 创建自定义的分词库文件</span>
touch ext.dic
<span class="token comment"># 追加自己的分词</span>
你打我撒
巴适得板
<span class="token punctuation">...</span>.

<span class="token comment"># 更新分词器配置</span>
vim IKAnalyzer.cfg.xml

&lt;<span class="token punctuation">?</span>xml version="1.0" encoding="UTF<span class="token punctuation">-</span>8"<span class="token punctuation">?</span><span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!DOCTYPE</span> properties SYSTEM "http<span class="token punctuation">:</span>//java.sun.com/dtd/properties.dtd"<span class="token punctuation">&gt;</span>
&lt;properties<span class="token punctuation">&gt;</span>
        &lt;comment<span class="token punctuation">&gt;</span>IK Analyzer 扩展配置&lt;/comment<span class="token punctuation">&gt;</span>
        &lt;<span class="token tag">!--</span>用户可以在这里配置自己的扩展字典 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
        &lt;entry key="ext_dict"&gt;ext.dic&lt;/entry&gt;
         &lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;
        &lt;entry key="ext_stopwords"&gt;&lt;/entry&gt;
        &lt;!--用户可以在这里配置远程扩展字典 --&gt;
        &lt;!-- &lt;entry key="remote_ext_dict"&gt;words_location&lt;/entry&gt; --&gt;
        &lt;!--用户可以在这里配置远程扩展停止词字典--&gt;
        &lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span>
&lt;/properties<span class="token punctuation">&gt;</span>


<span class="token comment"># 重启es</span>
docker<span class="token punctuation">-</span>compose restart es
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3bc88f74b9d9af709e056ce66f645385.png"/>
    </p>
    <h5>
     <a id="IK_287">
     </a>
     IK停词器
    </h5>
    <pre><code class="prism language-yaml"><span class="token comment"># 向stopword.dic文件追加停词器</span>
的
是
啊
阿
在
<span class="token punctuation">...</span>


<span class="token comment"># 更新分词器配置</span>
vim IKAnalyzer.cfg.xml

&lt;<span class="token punctuation">?</span>xml version="1.0" encoding="UTF<span class="token punctuation">-</span>8"<span class="token punctuation">?</span><span class="token punctuation">&gt;</span>
&lt;<span class="token tag">!DOCTYPE</span> properties SYSTEM "http<span class="token punctuation">:</span>//java.sun.com/dtd/properties.dtd"<span class="token punctuation">&gt;</span>
&lt;properties<span class="token punctuation">&gt;</span>
        &lt;comment<span class="token punctuation">&gt;</span>IK Analyzer 扩展配置&lt;/comment<span class="token punctuation">&gt;</span>
        &lt;<span class="token tag">!--</span>用户可以在这里配置自己的扩展字典 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span><span class="token scalar string">
        &lt;entry key="ext_dict"&gt;ext.dic&lt;/entry&gt;
         &lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;
        &lt;entry key="ext_stopwords"&gt;stopword.dic&lt;/entry&gt;
        &lt;!--用户可以在这里配置远程扩展字典 --&gt;
        &lt;!-- &lt;entry key="remote_ext_dict"&gt;words_location&lt;/entry&gt; --&gt;
        &lt;!--用户可以在这里配置远程扩展停止词字典--&gt;
        &lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span>
&lt;/properties<span class="token punctuation">&gt;</span>


<span class="token comment"># 重启es</span>
docker<span class="token punctuation">-</span>compose restart es
</code></pre>
    <p>
     预期满足！“的”，“啊”是跳过分词的。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6ab97980a94fb278304464bc0865d733.png"/>
    </p>
    <h2>
     <a id="_326">
     </a>
     索引库操作
    </h2>
    <h3>
     <a id="Mapping__327">
     </a>
     Mapping 属性映射
    </h3>
    <p>
     <code>
      Index
     </code>
     索引库就类似数据库表，
     <code>
      mappnig
     </code>
     映射就类似表的结构。
    </p>
    <blockquote>
     <p>
      mapping 是对索引库中文档结构的约束
     </p>
    </blockquote>
    <ul>
     <li>
      <code>
       **type**
      </code>
      ：字段数据类型，常见的类型有：
      <ul>
       <li>
        字符串：
        <code>
         text
        </code>
        （可分词文本），
        <code>
         keyword
        </code>
        （精确值，例如：品牌，国家，ip地址等）
       </li>
       <li>
        数值：
        <code>
         long
        </code>
        ，
        <code>
         Integer
        </code>
        ，
        <code>
         short
        </code>
        ，
        <code>
         byte
        </code>
        ，
        <code>
         double
        </code>
        ，
        <code>
         float
        </code>
       </li>
       <li>
        布尔：
        <code>
         boolean
        </code>
       </li>
       <li>
        日期：
        <code>
         date
        </code>
       </li>
       <li>
        对象：
        <code>
         object
        </code>
       </li>
       <li>
        地图：
        <code>
         geo_point
        </code>
        由经纬度确定的一个点。例如：“32.8752345,120.2981576”
       </li>
       <li>
        坐标：
        <code>
         geo_shape
        </code>
        由多个geo_point组成的复杂几何图形，例如一条直线：“LINESTRING(-77.036553 388.897676,-77.009051 38.889939)”
       </li>
      </ul>
     </li>
     <li>
      index：是否创建索引，默认true
     </li>
     <li>
      analyzer：使用分词器类型
     </li>
     <li>
      properties：字段的子字段
     </li>
    </ul>
    <h3>
     <a id="Index__345">
     </a>
     Index 索引操作
    </h3>
    <blockquote>
     <p>
      简单的CRUD
     </p>
    </blockquote>
    <ul>
     <li>
      创建索引：PUT /索引名
     </li>
     <li>
      查询索引：GET /索引名
     </li>
     <li>
      删除索引：DELETE /索引名
     </li>
     <li>
      修改索引库（添加字段）：PUT /索引名/_mapping
     </li>
    </ul>
    <h4>
     <a id="_354">
     </a>
     创建索引
    </h4>
    <pre><code class="prism language-yaml">PUT /user
<span class="token punctuation">{<!-- --></span>
  <span class="token key atrule">"mappings"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token key atrule">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      "userId"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"type"</span><span class="token punctuation">:</span> <span class="token string">"long"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      "username"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"analyzer"</span><span class="token punctuation">:</span> <span class="token string">"ik_smart"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      "profile"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"type"</span><span class="token punctuation">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"index"</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      "age"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"type"</span><span class="token punctuation">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"index"</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      "address"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          "city"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
            "type"<span class="token punctuation">:</span><span class="token string">"keyword"</span><span class="token punctuation">,</span>
            "index"<span class="token punctuation">:</span><span class="token boolean important">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          "area"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
            "type"<span class="token punctuation">:</span><span class="token string">"keyword"</span><span class="token punctuation">,</span>
            "index"<span class="token punctuation">:</span><span class="token boolean important">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_392">
     </a>
     查询索引
    </h4>
    <pre><code class="prism language-yaml">GET /user

<span class="token comment">#! Elasticsearch built-in security features are not enabled. Without authentication, your cluster could be accessible to anyone. See https://www.elastic.co/guide/en/elasticsearch/reference/7.14/security-minimal-setup.html to enable security.</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token key atrule">"user"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token key atrule">"aliases"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">"mappings"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token key atrule">"properties"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"address"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"properties"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token key atrule">"area"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token key atrule">"index"</span> <span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token key atrule">"city"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
              <span class="token key atrule">"index"</span> <span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"age"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span>
          <span class="token key atrule">"index"</span> <span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"doc"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"properties"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token key atrule">"email"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
              <span class="token key atrule">"fields"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token key atrule">"keyword"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
                  <span class="token key atrule">"ignore_above"</span> <span class="token punctuation">:</span> <span class="token number">256</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"email"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token key atrule">"analyzer"</span> <span class="token punctuation">:</span> <span class="token string">"ik_smart"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"profile"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
          <span class="token key atrule">"index"</span> <span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"userId"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"long"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"username"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"type"</span> <span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          <span class="token key atrule">"analyzer"</span> <span class="token punctuation">:</span> <span class="token string">"ik_smart"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token key atrule">"settings"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token key atrule">"index"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token key atrule">"routing"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"allocation"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token key atrule">"include"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token key atrule">"_tier_preference"</span> <span class="token punctuation">:</span> <span class="token string">"data_content"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token key atrule">"number_of_shards"</span> <span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"provided_name"</span> <span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"creation_date"</span> <span class="token punctuation">:</span> <span class="token string">"1741833092487"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"number_of_replicas"</span> <span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"uuid"</span> <span class="token punctuation">:</span> <span class="token string">"Nw2N6NvtQlysXix9mqfw1A"</span><span class="token punctuation">,</span>
        <span class="token key atrule">"version"</span> <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token key atrule">"created"</span> <span class="token punctuation">:</span> <span class="token string">"7140299"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="_472">
     </a>
     更新索引
    </h4>
    <pre><code class="prism language-yaml">PUT /user/_mapping
<span class="token punctuation">{<!-- --></span>
  "properties"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
    "email"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
      "type"<span class="token punctuation">:</span><span class="token string">"text"</span><span class="token punctuation">,</span>
       <span class="token key atrule">"analyzer"</span> <span class="token punctuation">:</span> <span class="token string">"ik_smart"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="_486">
     </a>
     删除索引
    </h4>
    <pre><code class="prism language-yaml">DELETE /user_d
</code></pre>
    <h3>
     <a id="Document__491">
     </a>
     Document 文档操作
    </h3>
    <blockquote>
     <p>
      简单的CRUD操作
     </p>
    </blockquote>
    <ul>
     <li>
      创建文档：POST /索引名/_doc/文档id
     </li>
     <li>
      查询文档：
      <ul>
       <li>
        查询当前索引下所有文档数据：GET /索引名/_search
       </li>
       <li>
        查询指定文档：GET /索引名/_doc/文档id
       </li>
      </ul>
     </li>
     <li>
      删除文档：DELETE /索引名/_doc/文档id
     </li>
     <li>
      更新文档：
      <ul>
       <li>
        全量更新：PUT /索引名/_doc/文档id （为空的值则会赋值为空）
       </li>
       <li>
        增量更新：POST /索引名/_update/文档id {“doc”:{}} （只会更新doc中的字段）
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_504">
     </a>
     创建文档
    </h4>
    <pre><code class="prism language-yaml">POST /user/_doc/1
<span class="token punctuation">{<!-- --></span>
  "userId"<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  "username"<span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">,</span>
  "profile"<span class="token punctuation">:</span><span class="token string">"个性签名1111212121"</span><span class="token punctuation">,</span>
  "age"<span class="token punctuation">:</span><span class="token number">27</span><span class="token punctuation">,</span>
  "address"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
    "city"<span class="token punctuation">:</span><span class="token string">"昆明"</span><span class="token punctuation">,</span>
    "area"<span class="token punctuation">:</span><span class="token string">"官渡区"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  "email"<span class="token punctuation">:</span><span class="token string">"moon.nie@infocare.org.cn"</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_520">
     </a>
     查询文档
    </h4>
    <pre><code class="prism language-yaml">GET /user/_doc/1
GET /user/_doc/2
GET /user/_doc/3

GET /user/_search
</code></pre>
    <h4>
     <a id="_529">
     </a>
     删除文档
    </h4>
    <pre><code class="prism language-yaml">DELETE /user_d
</code></pre>
    <h4>
     <a id="_534">
     </a>
     更新文档
    </h4>
    <pre><code class="prism language-yaml">PUT /user/_doc/3
<span class="token punctuation">{<!-- --></span>
  "userId"<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span>
  "username"<span class="token punctuation">:</span><span class="token string">"updateUser11"</span><span class="token punctuation">,</span>
  "profile"<span class="token punctuation">:</span><span class="token string">"updateUser11"</span><span class="token punctuation">,</span>
  "age"<span class="token punctuation">:</span><span class="token number">117</span><span class="token punctuation">,</span>
  "address"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
    "city"<span class="token punctuation">:</span><span class="token string">"昆1明"</span><span class="token punctuation">,</span>
    "area"<span class="token punctuation">:</span><span class="token string">"五华1区"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /user/_update/3
<span class="token punctuation">{<!-- --></span>
  "doc"<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>
    "email"<span class="token punctuation">:</span><span class="token string">"nnn111n@163.com"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6e656f5f47677832332f:61727469636c652f64657461696c732f313436323235333939" class_="artid" style="display:none">
 </p>
</div>


