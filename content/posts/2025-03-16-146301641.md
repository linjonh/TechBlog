---
layout: post
title: "k8s002k8s健康检查与故障诊断"
date: 2025-03-16 21:26:55 +0800
description: "CrashLoopBackOff → 查看容器日志及 describe pod 事件。ImagePullBackOff → 验证镜像名称及私有仓库凭据。Ingress 无法访问 → 检查路由规则及防火墙策略 ‌。Service 无端点 → 检查 Pod 标签匹配 ‌。Pending → 检查资源配额/节点容量。"
keywords: "【k8s002】k8s健康检查与故障诊断"
categories: ['K']
tags: ['容器', '云原生', 'Kubernetes']
artid: "146301641"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146301641
    alt: "k8s002k8s健康检查与故障诊断"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146301641
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146301641
cover: https://bing.ee123.net/img/rand?artid=146301641
image: https://bing.ee123.net/img/rand?artid=146301641
img: https://bing.ee123.net/img/rand?artid=146301641
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【k8s002】k8s健康检查与故障诊断
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="k8s_0">
     </a>
     k8s健康检查与故障诊断
    </h3>
    <h4>
     <a id="_2">
     </a>
     <mark>
      ‌
     </mark>
     <strong>
      <mark>
       一、集群状态检查
      </mark>
     </strong>
     <mark>
      ‌
     </mark>
    </h4>
    <ol>
     <li>
      <p>
       <mark>
        ‌
       </mark>
       <strong>
        <mark>
         检查节点健康状态
        </mark>
       </strong>
       <mark>
        ‌
       </mark>
      </p>
      <pre><code>kubectl get nodes -o wide          # 查看节点状态及基本信息 
kubectl describe node &lt;node-name&gt;  # 分析节点详细事件（如资源不足、网络异常） 
kubectl top nodes                  # 查看节点资源使用率（CPU/内存） 

</code></pre>
     </li>
     <li>
      <p>
       <mark>
        ‌
       </mark>
       <strong>
        <mark>
         检查核心组件状态
        </mark>
       </strong>
       <mark>
        ‌
       </mark>
      </p>
      <pre><code>kubectl get pods -n kube-system    # 确认控制平面组件（如 apiserver、scheduler）运行状态 

</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="Pod__21">
     </a>
     <mark>
      ‌
     </mark>
     <strong>
      <mark>
       二、Pod 诊断
      </mark>
     </strong>
     <mark>
      ‌
     </mark>
    </h4>
    <ol>
     <li>
      <p>
       <mark>
        ‌
       </mark>
       <strong>
        <mark>
         Pod 状态异常（Pending/CrashLoopBackOff）
        </mark>
       </strong>
       <mark>
        ‌
       </mark>
      </p>
      <pre><code>kubectl get pods -A -o wide        # 查看所有命名空间 Pod 状态及所在节点 
kubectl describe pod &lt;pod-name&gt;    # 查看事件日志（如调度失败、镜像拉取错误） 
kubectl logs -f &lt;pod-name&gt;         # 实时跟踪容器日志 
kubectl exec -it &lt;pod-name&gt; -- sh  # 进入容器内部排查（如配置文件错误） 

</code></pre>
     </li>
     <li>
      <p>
       <mark>
        ‌
       </mark>
       <strong>
        <mark>
         资源不足问题
        </mark>
       </strong>
       <mark>
        ‌
       </mark>
      </p>
      <pre><code>kubectl get resourcequotas -n &lt;namespace&gt;  # 检查命名空间资源配额限制 
kubectl get pods --field-selector=status.phase=Pending  # 筛选待调度的 Pod 

</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_42">
     </a>
     <mark>
      ‌
     </mark>
     <strong>
      <mark>
       三、服务与网络检查
      </mark>
     </strong>
     <mark>
      ‌
     </mark>
    </h4>
    <ol>
     <li>
      <p>
       <mark>
        ‌
       </mark>
       <strong>
        <mark>
         Service 流量异常
        </mark>
       </strong>
       <mark>
        ‌
       </mark>
      </p>
      <pre><code>kubectl get svc -o wide            # 查看 Service 的 ClusterIP 和端口映射
kubectl get endpoints &lt;service-name&gt;  # 验证后端 Pod 是否被正确关联 

</code></pre>
     </li>
     <li>
      <p>
       <mark>
        ‌
       </mark>
       <strong>
        <mark>
         Ingress 配置问题
        </mark>
       </strong>
       <mark>
        ‌
       </mark>
      </p>
      <pre><code>kubectl describe ingress &lt;name&gt;    # 检查路由规则和证书配置 

</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_60">
     </a>
     <mark>
      ‌
     </mark>
     <strong>
      <mark>
       四、存储问题排查
      </mark>
     </strong>
    </h4>
    <pre><code>```
kubectl get pvc -n &lt;namespace&gt;     # 查看 PVC 绑定状态
kubectl describe pvc &lt;pvc-name&gt;    # 分析存储类配置或容量不足问题 ‌
kubectl get pv                     # 检查持久卷可用性 

```
</code></pre>
    <hr/>
    <h4>
     <a id="_71">
     </a>
     <mark>
      ‌
     </mark>
     <strong>
      <mark>
       五、事件与日志分析
      </mark>
     </strong>
     <mark>
      ‌
     </mark>
    </h4>
    <pre><code>kubectl get events -A --sort-by='.lastTimestamp'  # 按时间排序查看集群事件 
kubectl logs --previous &lt;pod-name&gt;   # 查看容器崩溃前的日志（适用于 CrashLoopBackOff） 

</code></pre>
    <hr/>
    <h4>
     <a id="_81">
     </a>
     <mark>
      ‌
     </mark>
     <strong>
      <mark>
       六、高级调试命令
      </mark>
     </strong>
     <mark>
      ‌
     </mark>
    </h4>
    <pre><code>kubectl api-resources                # 列出所有资源类型（如排查 CRD 问题） 
kubectl explain &lt;resource&gt;           # 查看资源配置字段定义（如验证 YAML 合法性） 
kubectl drain &lt;node-name&gt; --ignore-daemonsets  # 排空节点（维护前隔离 Pod）
</code></pre>
    <h4>
     <a id="_87">
     </a>
     七、故障排查流程：‌
    </h4>
    <p>
     ‌Pod 异常诊断路径‌：
     <br/>
     Pending → 检查资源配额/节点容量
     <br/>
     CrashLoopBackOff → 查看容器日志及 describe pod 事件
     <br/>
     ImagePullBackOff → 验证镜像名称及私有仓库凭据
    </p>
    <p>
     ‌网络问题诊断路径‌：
     <br/>
     Service 无端点 → 检查 Pod 标签匹配 ‌
     <br/>
     Ingress 无法访问 → 检查路由规则及防火墙策略 ‌
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f79793434383637313234362f:61727469636c652f64657461696c732f313436333031363431" class_="artid" style="display:none">
 </p>
</div>


