---
layout: post
title: "Xilinx-ZYNQ-FSBL解读LoadBootImage"
date: 2025-03-08 22:32:33 +0800
description: "LoadBootImage()是Zynq7000 FSBL的核心加载函数，通过XFsblLoadPartitions()XFsblL​oadPartitions()实现多阶段引导：首先验证BootROM头部结构，使用SHA-3/RSA-2048进行安全认证，随后按分区表依次加载比特流和应用代码。关键过程包含DDR初始化预处理、加密校验"
keywords: "Xilinx ZYNQ FSBL解读：LoadBootImage()"
categories: ['解读', 'Zynq', 'Xilinx', 'Fsbl']
tags: ['驱动开发', '嵌入式硬件', 'Stm', 'Fpga', 'C', 'Arm']
artid: "146124080"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146124080
    alt: "Xilinx-ZYNQ-FSBL解读LoadBootImage"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146124080
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146124080
cover: https://bing.ee123.net/img/rand?artid=146124080
image: https://bing.ee123.net/img/rand?artid=146124080
img: https://bing.ee123.net/img/rand?artid=146124080
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Xilinx ZYNQ FSBL解读：LoadBootImage()
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     篇首
    </h2>
    <p>
     最近突发奇想，Xilinx 的集成开发环境已经很好了，很多必要的代码都直接生成了，这给开发者带来了巨大便利的同时，也让人错过了很多代码的精彩，可能有很多人用了很多年了，都还无法清楚的理解其中过程。博主准备以FSBL为例，与大家深入探讨一番，从而加深对ZYNQ的加载过程的理解，以便大家作出更精彩的设计！
    </p>
    <hr/>
    <h3>
     <a id="LoadBootImage__4">
     </a>
     <strong>
      LoadBootImage() 解读
     </strong>
    </h3>
    <p>
     本文以Zynq7000 FSBL工程代码为基础，分析启动流程核心函数
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        L 
        
       
         o 
        
       
         a 
        
       
         d 
        
       
         B 
        
       
         o 
        
       
         o 
        
       
         t 
        
       
         I 
        
       
         m 
        
       
         a 
        
       
         g 
        
       
         e 
        
       
         ( 
        
       
         ) 
        
       
      
        LoadBootImage()
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          L
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0502em;">
          B
         </span>
         <span class="mord mathnormal">
          oo
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal">
          ma
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          g
         </span>
         <span class="mord mathnormal">
          e
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     的执行逻辑与关键技术细节。
    </p>
    <h4>
     <a id="_7">
     </a>
     <strong>
      一、函数调用框架
     </strong>
    </h4>
    <pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">LoadBootImage</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">FsblHookBeforeBitstreamDdr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 钩子函数</span>
    Status <span class="token operator">=</span> <span class="token function">XFsbl_LoadPartitions</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 核心加载</span>
    <span class="token function">FsblHookBeforeHandoff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 移交前预处理</span>
    <span class="token keyword">return</span> Status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="__17">
     </a>
     <strong>
      二、 函数执行全流程分解
     </strong>
    </h4>
    <h5>
     <a id="__18">
     </a>
     ** 函数入口与预处理**
    </h5>
    <pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">LoadBootImage</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    u32 Status <span class="token operator">=</span> XFSBL_SUCCESS<span class="token punctuation">;</span>
    XTime tStart<span class="token punctuation">,</span> tEnd<span class="token punctuation">;</span>  <span class="token comment">// 64位计时器（若启用性能分析）</span>
</code></pre>
    <ul>
     <li>
      <strong>
       硬件依赖
      </strong>
      ：
      <ul>
       <li>
        依赖
        <code>
         psu_init.c
        </code>
        完成的PS端基础初始化（时钟、MIO、SLCR锁等）
       </li>
       <li>
        DDR物理层已通过
        <code>
         Xil_DDRInit()
        </code>
        完成训练（
        <code>
         psu_ddr_phyinit.c
        </code>
        ）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="_FsblHookBeforeBitstreamDdr__28">
     </a>
     **
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
        
       
         s 
        
       
         b 
        
       
         l 
        
       
         H 
        
       
         o 
        
       
         o 
        
       
         k 
        
       
         B 
        
       
         e 
        
       
         f 
        
       
         o 
        
       
         r 
        
       
         e 
        
       
         B 
        
       
         i 
        
       
         t 
        
       
         s 
        
       
         t 
        
       
         r 
        
       
         e 
        
       
         a 
        
       
         m 
        
       
         D 
        
       
         d 
        
       
         r 
        
       
         ( 
        
       
         ) 
        
       
      
        FsblHookBeforeBitstreamDdr()
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          F
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          b
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
         <span class="mord mathnormal">
          Hoo
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0315em;">
          k
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0502em;">
          B
         </span>
         <span class="mord mathnormal">
          e
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1076em;">
          f
         </span>
         <span class="mord mathnormal">
          ore
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0502em;">
          B
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          re
         </span>
         <span class="mord mathnormal">
          am
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          D
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          r
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     钩子函数**
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">FSBL_PERF</span></span>
    <span class="token function">XTime_GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tStart<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 记录TSC起始值（AXI Timer 0）</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token comment">/* 用户自定义扩展点：可插入DDR重配置代码 */</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键寄存器操作
      </strong>
      ：
      <ul>
       <li>
        <strong>
         DDRC控制
        </strong>
        ：通过
        <code>
         Xil_Out32(0xFD070000, 0x00040010)
        </code>
        设置
        <code>
         DDRC_ADDRMAP0
        </code>
        调整地址映射
       </li>
       <li>
        <strong>
         OCM重映射
        </strong>
        ：关闭OCM缓存（
        <code>
         SLCR.OCM_CFG
        </code>
        寄存器位3置1）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="XFsbl_LoadPartitions__39">
     </a>
     <strong>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         X 
         
        
          F 
         
        
          s 
         
        
          b 
         
         
         
           l 
          
         
           L 
          
         
        
          o 
         
        
          a 
         
        
          d 
         
        
          P 
         
        
          a 
         
        
          r 
         
        
          t 
         
        
          i 
         
        
          t 
         
        
          i 
         
        
          o 
         
        
          n 
         
        
          s 
         
        
          ( 
         
        
          ) 
         
        
       
         XFsbl_LoadPartitions()
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           XF
          </span>
          <span class="mord mathnormal">
           s
          </span>
          <span class="mord mathnormal">
           b
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.0197em;">
            l
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3283em;">
               <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mathnormal mtight">
                  L
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mord mathnormal">
           o
          </span>
          <span class="mord mathnormal">
           a
          </span>
          <span class="mord mathnormal">
           d
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           P
          </span>
          <span class="mord mathnormal">
           a
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           r
          </span>
          <span class="mord mathnormal">
           t
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mord mathnormal">
           t
          </span>
          <span class="mord mathnormal">
           i
          </span>
          <span class="mord mathnormal">
           o
          </span>
          <span class="mord mathnormal">
           n
          </span>
          <span class="mord mathnormal">
           s
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
      核心加载
     </strong>
    </h5>
    <h6>
     <a id="1Boot_Header_40">
     </a>
     <strong>
      阶段1：Boot Header解析
     </strong>
    </h6>
    <pre><code class="prism language-c">XFsblPs_BootHdr Header<span class="token punctuation">;</span>
<span class="token function">XFsbl_CheckBootHeader</span><span class="token punctuation">(</span>ImageAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从QSPI/NAND读取头部</span>
</code></pre>
    <ul>
     <li>
      <strong>
       头部结构体
      </strong>
      （
      <code>
       xfsbl_ps_boothdr.h
      </code>
      ）：
      <pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    u32 ImageID<span class="token punctuation">;</span>          <span class="token comment">// 魔数0xAA995566</span>
    u32 NumPartitions<span class="token punctuation">;</span>    <span class="token comment">// 分区总数（含PL比特流+应用）</span>
    u32 AuthType<span class="token punctuation">;</span>         <span class="token comment">// 加密类型：0=None, 1=RSA-2048</span>
    u32 Checksum<span class="token punctuation">;</span>         <span class="token comment">// 头部的CRC32校验</span>
    <span class="token comment">// ... 其他字段（分区表偏移、证书偏移等）</span>
<span class="token punctuation">}</span> XFsblPs_BootHdr<span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <h6>
     <a id="2RSA2048_56">
     </a>
     <strong>
      阶段2：安全认证（以RSA-2048为例）
     </strong>
    </h6>
    <pre><code class="prism language-c"><span class="token function">XSecure_Sha3Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Sha3Instance<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化SHA-3引擎</span>
<span class="token function">XSecure_Sha3Update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Sha3Instance<span class="token punctuation">,</span> <span class="token punctuation">(</span>u8<span class="token operator">*</span><span class="token punctuation">)</span>ImageAddr<span class="token punctuation">,</span> Header<span class="token punctuation">.</span>HashLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">XSecure_Sha3Final</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Sha3Instance<span class="token punctuation">,</span> CalculatedHash<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 计算哈希</span>
<span class="token function">XSecure_VerifySignature</span><span class="token punctuation">(</span>CalculatedHash<span class="token punctuation">,</span> StoredSignature<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// RSA验签</span>
</code></pre>
    <ul>
     <li>
      <strong>
       硬件加速
      </strong>
      ：
      <ul>
       <li>
        使用PS内置的CSU模块（Crypto Subsystem）
       </li>
       <li>
        RSA密钥存储在eFUSE或BBRAM中（通过
        <code>
         XSecure_GetEfuseKek()
        </code>
        读取）
       </li>
      </ul>
     </li>
    </ul>
    <h6>
     <a id="3_67">
     </a>
     <strong>
      阶段3：分区加载循环
     </strong>
    </h6>
    <pre><code class="prism language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span>u8 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>Header<span class="token punctuation">.</span>NumPartitions<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    XFsblPs_PartitionHdr PartHdr<span class="token punctuation">;</span>
    <span class="token function">XFsbl_ReadPartitionHdr</span><span class="token punctuation">(</span>ImageAddr <span class="token operator">+</span> Offset<span class="token punctuation">,</span> <span class="token operator">&amp;</span>PartHdr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>PartHdr<span class="token punctuation">.</span>Attr <span class="token operator">&amp;</span> PART_ATTR_PL<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// PL比特流分区</span>
        <span class="token function">XFsbl_LoadPlBitstream</span><span class="token punctuation">(</span>PartHdr<span class="token punctuation">.</span>LoadAddr<span class="token punctuation">,</span> PartHdr<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// PS应用程序分区</span>
        <span class="token function">XFsbl_LoadElf</span><span class="token punctuation">(</span>PartHdr<span class="token punctuation">.</span>LoadAddr<span class="token punctuation">,</span> PartHdr<span class="token punctuation">.</span>Size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ELF解析</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      <strong>
       关键操作细节
      </strong>
      ：
      <ul>
       <li>
        <strong>
         PL加载
        </strong>
        ：通过DevCfg接口（
        <code>
         XDcfg_CfgInitialize()
        </code>
        ）写入PCAP
       </li>
       <li>
        <strong>
         ELF加载
        </strong>
        ：解析Program Headers，使用
        <code>
         Xil_Out32()
        </code>
        逐段写入DDR
       </li>
       <li>
        <strong>
         地址对齐
        </strong>
        ：通过
        <code>
         XLAT_FSBL_TABLE
        </code>
        处理非32位对齐访问（触发Data Abort时自动转换）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="FsblHookBeforeHandoff__85">
     </a>
     <strong>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         F 
         
        
          s 
         
        
          b 
         
        
          l 
         
        
          H 
         
        
          o 
         
        
          o 
         
        
          k 
         
        
          B 
         
        
          e 
         
        
          f 
         
        
          o 
         
        
          r 
         
        
          e 
         
        
          H 
         
        
          a 
         
        
          n 
         
        
          d 
         
        
          o 
         
        
          f 
         
        
          f 
         
        
          ( 
         
        
          ) 
         
        
       
         FsblHookBeforeHandoff()
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1389em;">
           F
          </span>
          <span class="mord mathnormal">
           s
          </span>
          <span class="mord mathnormal">
           b
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0197em;">
           l
          </span>
          <span class="mord mathnormal">
           Hoo
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0315em;">
           k
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0502em;">
           B
          </span>
          <span class="mord mathnormal">
           e
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1076em;">
           f
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0813em;">
           oreH
          </span>
          <span class="mord mathnormal">
           an
          </span>
          <span class="mord mathnormal">
           d
          </span>
          <span class="mord mathnormal">
           o
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1076em;">
           ff
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
      移交前处理
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token function">Xil_DCacheFlush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 数据缓存刷新（确保DDR数据一致性）</span>
<span class="token function">Xil_Out32</span><span class="token punctuation">(</span>CRL_APB_BASE <span class="token operator">+</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x01000F00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 配置时钟分频</span>
</code></pre>
    <ul>
     <li>
      <strong>
       寄存器详解
      </strong>
      ：
      <ul>
       <li>
        <strong>
         CRL_APB (0xFF5E0024)
        </strong>
        : 设置
        <code>
         RPLL_CTRL
        </code>
        分频系数（CPU=1.3GHz, DDR=1066MHz）
       </li>
       <li>
        <strong>
         SLCR_UNLOCK (0xF8000008)
        </strong>
        : 写入
        <code>
         0xDF0D
        </code>
        解锁保护寄存器
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_96">
     </a>
     <strong>
      三、关键子函数解析
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           F 
           
          
            s 
           
          
            b 
           
          
            l 
           
          
            H 
           
          
            o 
           
          
            o 
           
          
            k 
           
          
            B 
           
          
            e 
           
          
            f 
           
          
            o 
           
          
            r 
           
          
            e 
           
          
            B 
           
          
            i 
           
          
            t 
           
          
            s 
           
          
            t 
           
          
            r 
           
          
            e 
           
          
            a 
           
          
            m 
           
          
            D 
           
          
            d 
           
          
            r 
           
          
            ( 
           
          
            ) 
           
          
         
           FsblHookBeforeBitstreamDdr()
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             F
            </span>
            <span class="mord mathnormal">
             s
            </span>
            <span class="mord mathnormal">
             b
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0197em;">
             l
            </span>
            <span class="mord mathnormal">
             Hoo
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0315em;">
             k
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0502em;">
             B
            </span>
            <span class="mord mathnormal">
             e
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1076em;">
             f
            </span>
            <span class="mord mathnormal">
             ore
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0502em;">
             B
            </span>
            <span class="mord mathnormal">
             i
            </span>
            <span class="mord mathnormal">
             t
            </span>
            <span class="mord mathnormal">
             s
            </span>
            <span class="mord mathnormal">
             t
            </span>
            <span class="mord mathnormal">
             re
            </span>
            <span class="mord mathnormal">
             am
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0278em;">
             D
            </span>
            <span class="mord mathnormal">
             d
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0278em;">
             r
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mclose">
             )
            </span>
           </span>
          </span>
         </span>
        </span>
       </strong>
      </p>
      <ul>
       <li>
        作用：DDR初始化前的预处理钩子
       </li>
       <li>
        执行内容：
        <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">FSBL_PERF</span></span>
<span class="token function">XTime_GetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tStart<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 性能计数器启动</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           X 
           
          
            F 
           
          
            s 
           
          
            b 
           
           
           
             l 
            
           
             L 
            
           
          
            o 
           
          
            a 
           
          
            d 
           
          
            P 
           
          
            a 
           
          
            r 
           
          
            t 
           
          
            i 
           
          
            t 
           
          
            i 
           
          
            o 
           
          
            n 
           
          
            s 
           
          
            ( 
           
          
            ) 
           
          
         
           XFsbl_LoadPartitions()
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             XF
            </span>
            <span class="mord mathnormal">
             s
            </span>
            <span class="mord mathnormal">
             b
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0197em;">
              l
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3283em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight">
                    L
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord mathnormal">
             o
            </span>
            <span class="mord mathnormal">
             a
            </span>
            <span class="mord mathnormal">
             d
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             P
            </span>
            <span class="mord mathnormal">
             a
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0278em;">
             r
            </span>
            <span class="mord mathnormal">
             t
            </span>
            <span class="mord mathnormal">
             i
            </span>
            <span class="mord mathnormal">
             t
            </span>
            <span class="mord mathnormal">
             i
            </span>
            <span class="mord mathnormal">
             o
            </span>
            <span class="mord mathnormal">
             n
            </span>
            <span class="mord mathnormal">
             s
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mclose">
             )
            </span>
           </span>
          </span>
         </span>
        </span>
       </strong>
      </p>
      <ul>
       <li>
        流程分解：
        <ul>
         <li>
          <strong>
           <span class="katex--inline">
            <span class="katex">
             <span class="katex-mathml">
              X 
              
             
               F 
              
             
               s 
              
             
               b 
              
              
              
                l 
               
              
                C 
               
              
             
               h 
              
             
               e 
              
             
               c 
              
             
               k 
              
             
               B 
              
             
               o 
              
             
               o 
              
             
               t 
              
             
               H 
              
             
               e 
              
             
               a 
              
             
               d 
              
             
               e 
              
             
               r 
              
             
               ( 
              
             
               ) 
              
             
            
              XFsbl_CheckBootHeader()
             </span>
             <span class="katex-html">
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                XF
               </span>
               <span class="mord mathnormal">
                s
               </span>
               <span class="mord mathnormal">
                b
               </span>
               <span class="mord">
                <span class="mord mathnormal" style="margin-right: 0.0197em;">
                 l
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3283em;">
                    <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight" style="margin-right: 0.0715em;">
                       C
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mord mathnormal">
                h
               </span>
               <span class="mord mathnormal">
                ec
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0315em;">
                k
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0502em;">
                B
               </span>
               <span class="mord mathnormal">
                oo
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mord mathnormal">
                He
               </span>
               <span class="mord mathnormal">
                a
               </span>
               <span class="mord mathnormal">
                d
               </span>
               <span class="mord mathnormal" style="margin-right: 0.0278em;">
                er
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mclose">
                )
               </span>
              </span>
             </span>
            </span>
           </span>
          </strong>
          <br/>
          验证BIN文件头结构（含
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             s 
             
            
              i 
             
            
              z 
             
            
              e 
             
            
              o 
             
            
              f 
             
            
              ( 
             
            
              X 
             
            
              F 
             
            
              s 
             
            
              b 
             
            
              l 
             
            
              P 
             
             
             
               s 
              
             
               B 
              
             
            
              o 
             
            
              o 
             
            
              t 
             
            
              H 
             
            
              d 
             
            
              r 
             
            
              ) 
             
            
           
             sizeof(XFsblPs_BootHdr)
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord mathnormal">
               s
              </span>
              <span class="mord mathnormal">
               i
              </span>
              <span class="mord mathnormal">
               zeo
              </span>
              <span class="mord mathnormal" style="margin-right: 0.1076em;">
               f
              </span>
              <span class="mopen">
               (
              </span>
              <span class="mord mathnormal" style="margin-right: 0.1389em;">
               XF
              </span>
              <span class="mord mathnormal">
               s
              </span>
              <span class="mord mathnormal">
               b
              </span>
              <span class="mord mathnormal" style="margin-right: 0.1389em;">
               lP
              </span>
              <span class="mord">
               <span class="mord mathnormal">
                s
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.3283em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mathnormal mtight" style="margin-right: 0.0502em;">
                      B
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mord mathnormal">
               oo
              </span>
              <span class="mord mathnormal">
               t
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0813em;">
               H
              </span>
              <span class="mord mathnormal">
               d
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0278em;">
               r
              </span>
              <span class="mclose">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
          ）
         </li>
         <li>
          <strong>
           <span class="katex--inline">
            <span class="katex">
             <span class="katex-mathml">
              X 
              
             
               F 
              
             
               s 
              
             
               b 
              
              
              
                l 
               
              
                A 
               
              
             
               u 
              
             
               t 
              
             
               h 
              
             
               e 
              
             
               n 
              
             
               t 
              
             
               i 
              
             
               c 
              
             
               a 
              
             
               t 
              
             
               i 
              
             
               o 
              
             
               n 
              
             
               ( 
              
             
               ) 
              
             
            
              XFsbl_Authentication()
             </span>
             <span class="katex-html">
              <span class="base">
               <span class="strut" style="height: 1em; vertical-align: -0.25em;">
               </span>
               <span class="mord mathnormal" style="margin-right: 0.1389em;">
                XF
               </span>
               <span class="mord mathnormal">
                s
               </span>
               <span class="mord mathnormal">
                b
               </span>
               <span class="mord">
                <span class="mord mathnormal" style="margin-right: 0.0197em;">
                 l
                </span>
                <span class="msupsub">
                 <span class="vlist-t vlist-t2">
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.3283em;">
                    <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                     <span class="pstrut" style="height: 2.7em;">
                     </span>
                     <span class="sizing reset-size6 size3 mtight">
                      <span class="mord mathnormal mtight">
                       A
                      </span>
                     </span>
                    </span>
                   </span>
                   <span class="vlist-s">
                    ​
                   </span>
                  </span>
                  <span class="vlist-r">
                   <span class="vlist" style="height: 0.15em;">
                    <span class="">
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="mord mathnormal">
                u
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mord mathnormal">
                h
               </span>
               <span class="mord mathnormal">
                e
               </span>
               <span class="mord mathnormal">
                n
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mord mathnormal">
                i
               </span>
               <span class="mord mathnormal">
                c
               </span>
               <span class="mord mathnormal">
                a
               </span>
               <span class="mord mathnormal">
                t
               </span>
               <span class="mord mathnormal">
                i
               </span>
               <span class="mord mathnormal">
                o
               </span>
               <span class="mord mathnormal">
                n
               </span>
               <span class="mopen">
                (
               </span>
               <span class="mclose">
                )
               </span>
              </span>
             </span>
            </span>
           </span>
          </strong>
          <br/>
          执行RSA-2048签名验证（通过
          <span class="katex--inline">
           <span class="katex">
            <span class="katex-mathml">
             X 
             
            
              S 
             
            
              e 
             
            
              c 
             
            
              u 
             
            
              r 
             
             
             
               e 
              
             
               S 
              
             
            
              h 
             
            
              a 
             
            
              3 
             
            
              I 
             
            
              n 
             
            
              i 
             
            
              t 
             
            
              ( 
             
            
              ) 
             
            
           
             XSecure_Sha3Init()
            </span>
            <span class="katex-html">
             <span class="base">
              <span class="strut" style="height: 1em; vertical-align: -0.25em;">
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0576em;">
               XS
              </span>
              <span class="mord mathnormal">
               ec
              </span>
              <span class="mord mathnormal">
               u
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0278em;">
               r
              </span>
              <span class="mord">
               <span class="mord mathnormal">
                e
               </span>
               <span class="msupsub">
                <span class="vlist-t vlist-t2">
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.3283em;">
                   <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                    <span class="pstrut" style="height: 2.7em;">
                    </span>
                    <span class="sizing reset-size6 size3 mtight">
                     <span class="mord mathnormal mtight" style="margin-right: 0.0576em;">
                      S
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="vlist-s">
                   ​
                  </span>
                 </span>
                 <span class="vlist-r">
                  <span class="vlist" style="height: 0.15em;">
                   <span class="">
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="mord mathnormal">
               ha
              </span>
              <span class="mord">
               3
              </span>
              <span class="mord mathnormal" style="margin-right: 0.0785em;">
               I
              </span>
              <span class="mord mathnormal">
               ni
              </span>
              <span class="mord mathnormal">
               t
              </span>
              <span class="mopen">
               (
              </span>
              <span class="mclose">
               )
              </span>
             </span>
            </span>
           </span>
          </span>
          等加密API）
         </li>
         <li>
          <strong>
           分区加载循环
          </strong>
          <br/>
          遍历分区表加载：
          <pre><code class="prism language-c"><span class="token keyword">for</span><span class="token punctuation">(</span>u8 PartNum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> PartNum<span class="token operator">&lt;</span>Header<span class="token punctuation">.</span>NumPartitions<span class="token punctuation">;</span> PartNum<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">XFsbl_LoadPartition</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加载单个分区</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">FSBL_DEBUG</span></span>
    <span class="token function">xil_printf</span><span class="token punctuation">(</span><span class="token string">"Partition %d Loaded\r\n"</span><span class="token punctuation">,</span> PartNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>
</code></pre>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           F 
           
          
            s 
           
          
            b 
           
          
            l 
           
          
            H 
           
          
            o 
           
          
            o 
           
          
            k 
           
          
            B 
           
          
            e 
           
          
            f 
           
          
            o 
           
          
            r 
           
          
            e 
           
          
            H 
           
          
            a 
           
          
            n 
           
          
            d 
           
          
            o 
           
          
            f 
           
          
            f 
           
          
            ( 
           
          
            ) 
           
          
         
           FsblHookBeforeHandoff()
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             F
            </span>
            <span class="mord mathnormal">
             s
            </span>
            <span class="mord mathnormal">
             b
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0197em;">
             l
            </span>
            <span class="mord mathnormal">
             Hoo
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0315em;">
             k
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0502em;">
             B
            </span>
            <span class="mord mathnormal">
             e
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1076em;">
             f
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0813em;">
             oreH
            </span>
            <span class="mord mathnormal">
             an
            </span>
            <span class="mord mathnormal">
             d
            </span>
            <span class="mord mathnormal">
             o
            </span>
            <span class="mord mathnormal" style="margin-right: 0.1076em;">
             ff
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mclose">
             )
            </span>
           </span>
          </span>
         </span>
        </span>
       </strong>
      </p>
      <ul>
       <li>
        执行DDR刷新操作（
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           X 
           
          
            i 
           
           
           
             l 
            
           
             D 
            
           
          
            C 
           
          
            a 
           
          
            c 
           
          
            h 
           
          
            e 
           
          
            F 
           
          
            l 
           
          
            u 
           
          
            s 
           
          
            h 
           
          
            ( 
           
          
            ) 
           
          
         
           Xil_DCacheFlush()
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0785em;">
             X
            </span>
            <span class="mord mathnormal">
             i
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0197em;">
              l
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3283em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                    D
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0715em;">
             C
            </span>
            <span class="mord mathnormal">
             a
            </span>
            <span class="mord mathnormal">
             c
            </span>
            <span class="mord mathnormal">
             h
            </span>
            <span class="mord mathnormal">
             e
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0197em;">
             Fl
            </span>
            <span class="mord mathnormal">
             u
            </span>
            <span class="mord mathnormal">
             s
            </span>
            <span class="mord mathnormal">
             h
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mclose">
             )
            </span>
           </span>
          </span>
         </span>
        </span>
        ）
       </li>
       <li>
        配置时钟分频器（通过
        <span class="katex--inline">
         <span class="katex">
          <span class="katex-mathml">
           X 
           
          
            i 
           
           
           
             l 
            
           
             O 
            
           
          
            u 
           
          
            t 
           
          
            32 
           
          
            ( 
           
          
            ) 
           
          
         
           Xil_Out32()
          </span>
          <span class="katex-html">
           <span class="base">
            <span class="strut" style="height: 1em; vertical-align: -0.25em;">
            </span>
            <span class="mord mathnormal" style="margin-right: 0.0785em;">
             X
            </span>
            <span class="mord mathnormal">
             i
            </span>
            <span class="mord">
             <span class="mord mathnormal" style="margin-right: 0.0197em;">
              l
             </span>
             <span class="msupsub">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 0.3283em;">
                 <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
                  <span class="pstrut" style="height: 2.7em;">
                  </span>
                  <span class="sizing reset-size6 size3 mtight">
                   <span class="mord mathnormal mtight" style="margin-right: 0.0278em;">
                    O
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 0.15em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord mathnormal">
             u
            </span>
            <span class="mord mathnormal">
             t
            </span>
            <span class="mord">
             32
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mclose">
             )
            </span>
           </span>
          </span>
         </span>
        </span>
        写CRL_APB寄存器）
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_127">
     </a>
     <strong>
      四、核心宏定义
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       $FSBL_DEBUG
      </strong>
      <br/>
      控制调试输出（默认关闭）
     </li>
     <li>
      <strong>
       <span class="katex--inline">
        KaTeX parse error: Double subscript at position 15: XPAR_PSU_DDR_0_̲S_AXI_BASEADDR
       </span>
      </strong>
      <br/>
      DDR控制器基地址宏（值
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         0 
         
        
          x 
         
        
          00100000 
         
        
       
         0x00100000
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6444em;">
          </span>
          <span class="mord">
           0
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mord">
           00100000
          </span>
         </span>
        </span>
       </span>
      </span>
      ）
     </li>
     <li>
      <strong>
       <span class="katex--inline">
        <span class="katex">
         <span class="katex-mathml">
          X 
          
         
           L 
          
         
           A 
          
          
          
            T 
           
          
            F 
           
          
         
           S 
          
         
           B 
          
          
          
            L 
           
          
            T 
           
          
         
           A 
          
         
           B 
          
         
           L 
          
         
           E 
          
         
        
          XLAT_FSBL_TABLE
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0785em;">
            X
           </span>
           <span class="mord mathnormal">
            L
           </span>
           <span class="mord mathnormal">
            A
           </span>
           <span class="mord">
            <span class="mord mathnormal" style="margin-right: 0.1389em;">
             T
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3283em;">
                <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                   F
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0502em;">
            SB
           </span>
           <span class="mord">
            <span class="mord mathnormal">
             L
            </span>
            <span class="msupsub">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 0.3283em;">
                <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                 <span class="pstrut" style="height: 2.7em;">
                 </span>
                 <span class="sizing reset-size6 size3 mtight">
                  <span class="mord mathnormal mtight" style="margin-right: 0.1389em;">
                   T
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 0.15em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mord mathnormal">
            A
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0502em;">
            B
           </span>
           <span class="mord mathnormal">
            L
           </span>
           <span class="mord mathnormal" style="margin-right: 0.0576em;">
            E
           </span>
          </span>
         </span>
        </span>
       </span>
      </strong>
      <br/>
      地址转换表（处理非对齐访问）
     </li>
    </ul>
    <h4>
     <a id="_135">
     </a>
     <strong>
      五、执行流程图
     </strong>
    </h4>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         初始化硬件 
            
           
          
          
           
           
             → 
            
           
          
          
           
           
             验证头部 
            
           
          
         
         
          
           
           
             ↓ 
            
           
          
          
           
            
           
          
          
           
           
             ↓ 
            
           
          
         
         
          
           
           
             DDR预处理 
            
           
          
          
           
           
             → 
            
           
          
          
           
           
             加载分区 
            
           
          
         
         
          
           
            
           
          
          
           
           
             ↘ 
            
           
          
          
           
           
             ↓ 
            
           
          
         
         
          
           
            
           
          
          
           
            
           
          
          
           
           
             移交控制权 
            
           
          
         
        
       
         \begin{array}{ccc} \text{初始化硬件} &amp; \rightarrow &amp; \text{验证头部} \\ \downarrow &amp; &amp; \downarrow \\ \text{DDR预处理} &amp; \rightarrow &amp; \text{加载分区} \\ &amp; \searrow &amp; \downarrow \\ &amp; &amp; \text{移交控制权} \end{array}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 6em; vertical-align: -2.75em;">
          </span>
          <span class="mord">
           <span class="mtable">
            <span class="arraycolsep" style="width: 0.5em;">
            </span>
            <span class="col-align-c">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 3.25em;">
                <span class="" style="top: -5.41em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    初始化硬件
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -4.21em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mrel">
                   ↓
                  </span>
                 </span>
                </span>
                <span class="" style="top: -3.01em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mord text">
                   <span class="mord">
                    DDR
                   </span>
                   <span class="mord cjk_fallback">
                    预处理
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -1.81em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                 </span>
                </span>
                <span class="" style="top: -0.61em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 2.75em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="arraycolsep" style="width: 0.5em;">
            </span>
            <span class="arraycolsep" style="width: 0.5em;">
            </span>
            <span class="col-align-c">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 3.25em;">
                <span class="" style="top: -5.41em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mrel">
                   →
                  </span>
                 </span>
                </span>
                <span class="" style="top: -4.21em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                 </span>
                </span>
                <span class="" style="top: -3.01em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mrel">
                   →
                  </span>
                 </span>
                </span>
                <span class="" style="top: -1.81em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mrel">
                   ↘
                  </span>
                 </span>
                </span>
                <span class="" style="top: -0.61em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 2.75em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="arraycolsep" style="width: 0.5em;">
            </span>
            <span class="arraycolsep" style="width: 0.5em;">
            </span>
            <span class="col-align-c">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 3.25em;">
                <span class="" style="top: -5.41em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    验证头部
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -4.21em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mrel">
                   ↓
                  </span>
                 </span>
                </span>
                <span class="" style="top: -3.01em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    加载分区
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -1.81em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mrel">
                   ↓
                  </span>
                 </span>
                </span>
                <span class="" style="top: -0.61em;">
                 <span class="pstrut" style="height: 3em;">
                 </span>
                 <span class="mord">
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    移交控制权
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 2.75em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="arraycolsep" style="width: 0.5em;">
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <h4>
     <a id="__149">
     </a>
     <strong>
      六、 关键数据流与硬件交互
     </strong>
    </h4>
    <h5>
     <a id="_150">
     </a>
     <strong>
      数据加载路径
     </strong>
    </h5>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         QSPI Flash 
         
         
         
           → 
          
          
          
            AXI Quad-SPI控制器 
           
          
         
        
          OCM缓存 
         
         
         
           → 
          
          
          
            DMA 
           
          
         
        
          DDR3 
         
        
       
         \text{QSPI Flash} \xrightarrow{\text{AXI Quad-SPI控制器}} \text{OCM缓存} \xrightarrow{\text{DMA}} \text{DDR3}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.3025em; vertical-align: -0.1944em;">
          </span>
          <span class="mord text">
           <span class="mord">
            QSPI Flash
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel x-arrow">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 1.1081em;">
              <span class="" style="top: -3.322em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight x-arrow-pad">
                <span class="mord mtight">
                 <span class="mord text mtight">
                  <span class="mord mtight">
                   AXI Quad-SPI
                  </span>
                  <span class="mord cjk_fallback mtight">
                   控制器
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="svg-align" style="top: -2.689em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="hide-tail" style="height: 0.522em; min-width: 1.469em;">
                <svg height="0.522em" preserveaspectratio="xMaxYMin slice" viewbox="0 0 400000 522" width="400em">
                 <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z">
                 </path>
                </svg>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.011em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.1113em; vertical-align: -0.011em;">
          </span>
          <span class="mord text">
           <span class="mord">
            OCM
           </span>
           <span class="mord cjk_fallback">
            缓存
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel x-arrow">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 1.1003em;">
              <span class="" style="top: -3.322em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight x-arrow-pad">
                <span class="mord mtight">
                 <span class="mord text mtight">
                  <span class="mord mtight">
                   DMA
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="svg-align" style="top: -2.689em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="hide-tail" style="height: 0.522em; min-width: 1.469em;">
                <svg height="0.522em" preserveaspectratio="xMaxYMin slice" viewbox="0 0 400000 522" width="400em">
                 <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z">
                 </path>
                </svg>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.011em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord text">
           <span class="mord">
            DDR3
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <ul>
     <li>
      <strong>
       性能优化
      </strong>
      ：
      <ul>
       <li>
        启用DMA传输（
        <code>
         XQspiPs_DmaTransfer()
        </code>
        ）
       </li>
       <li>
        使用线性突发模式（QSPI配置为DDR模式，时钟速率83MHz）
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="_158">
     </a>
     <strong>
      安全认证流程
     </strong>
    </h5>
    <p>
     <span class="katex--display">
      <span class="katex-display">
       <span class="katex">
        <span class="katex-mathml">
         原始镜像 
             
             
             
               → 
              
              
              
                SHA-3/384 
               
              
             
            
              哈希值 
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              哈希值 
             
             
             
               → 
              
              
              
                RSA-2048签名 
               
              
             
            
              验签结果 
             
            
           
          
         
        
       
         \begin{aligned} &amp;\text{原始镜像} \xrightarrow{\text{SHA-3/384}} \text{哈希值} \\ &amp;\text{哈希值} \xrightarrow{\text{RSA-2048签名}} \text{验签结果} \end{aligned}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 3.5673em; vertical-align: -1.5337em;">
          </span>
          <span class="mord">
           <span class="mtable">
            <span class="col-align-r">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 2.0337em;">
                <span class="" style="top: -4.0337em;">
                 <span class="pstrut" style="height: 3.147em;">
                 </span>
                 <span class="mord">
                 </span>
                </span>
                <span class="" style="top: -2.2733em;">
                 <span class="pstrut" style="height: 3.147em;">
                 </span>
                 <span class="mord">
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 1.5337em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="col-align-l">
             <span class="vlist-t vlist-t2">
              <span class="vlist-r">
               <span class="vlist" style="height: 2.0337em;">
                <span class="" style="top: -4.0337em;">
                 <span class="pstrut" style="height: 3.147em;">
                 </span>
                 <span class="mord">
                  <span class="mord">
                  </span>
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    原始镜像
                   </span>
                  </span>
                  <span class="mspace" style="margin-right: 0.2778em;">
                  </span>
                  <span class="mrel x-arrow">
                   <span class="vlist-t vlist-t2">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 1.147em;">
                      <span class="" style="top: -3.322em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="sizing reset-size6 size3 mtight x-arrow-pad">
                        <span class="mord mtight">
                         <span class="mord text mtight">
                          <span class="mord mtight">
                           SHA-3/384
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="svg-align" style="top: -2.689em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="hide-tail" style="height: 0.522em; min-width: 1.469em;">
                        <svg height="0.522em" preserveaspectratio="xMaxYMin slice" viewbox="0 0 400000 522" width="400em">
                         <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z">
                         </path>
                        </svg>
                       </span>
                      </span>
                     </span>
                     <span class="vlist-s">
                      ​
                     </span>
                    </span>
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.011em;">
                      <span class="">
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mspace" style="margin-right: 0.2778em;">
                  </span>
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    哈希值
                   </span>
                  </span>
                 </span>
                </span>
                <span class="" style="top: -2.2733em;">
                 <span class="pstrut" style="height: 3.147em;">
                 </span>
                 <span class="mord">
                  <span class="mord">
                  </span>
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    哈希值
                   </span>
                  </span>
                  <span class="mspace" style="margin-right: 0.2778em;">
                  </span>
                  <span class="mrel x-arrow">
                   <span class="vlist-t vlist-t2">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 1.1003em;">
                      <span class="" style="top: -3.322em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="sizing reset-size6 size3 mtight x-arrow-pad">
                        <span class="mord mtight">
                         <span class="mord text mtight">
                          <span class="mord mtight">
                           RSA-2048
                          </span>
                          <span class="mord cjk_fallback mtight">
                           签名
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="svg-align" style="top: -2.689em;">
                       <span class="pstrut" style="height: 2.7em;">
                       </span>
                       <span class="hide-tail" style="height: 0.522em; min-width: 1.469em;">
                        <svg height="0.522em" preserveaspectratio="xMaxYMin slice" viewbox="0 0 400000 522" width="400em">
                         <path d="M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z">
                         </path>
                        </svg>
                       </span>
                      </span>
                     </span>
                     <span class="vlist-s">
                      ​
                     </span>
                    </span>
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.011em;">
                      <span class="">
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="mspace" style="margin-right: 0.2778em;">
                  </span>
                  <span class="mord text">
                   <span class="mord cjk_fallback">
                    验签结果
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="vlist-s">
                ​
               </span>
              </span>
              <span class="vlist-r">
               <span class="vlist" style="height: 1.5337em;">
                <span class="">
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </p>
    <ul>
     <li>
      <strong>
       抗攻击设计
      </strong>
      ：
      <ul>
       <li>
        哈希计算前会清空CSU的密钥缓存（
        <code>
         XSecure_CsuAesKcvClear()
        </code>
        ）
       </li>
       <li>
        签名失败触发安全锁定（通过
        <code>
         XSecure_SetTamperConfig()
        </code>
        ）
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="_171">
     </a>
     <strong>
      七、调试与错误处理
     </strong>
    </h4>
    <h5>
     <a id="_172">
     </a>
     <strong>
      调试宏启用
     </strong>
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FSBL_DEBUG</span>  <span class="token comment">// 启用调试输出</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       典型输出
      </strong>
      ：
      <pre><code>XFsbl_Debug: Partition 0 Loaded at 0x00100000 (Size 1MB)
XFsbl_Debug: PL Bitstream CRC Check Passed
</code></pre>
     </li>
    </ul>
    <h5>
     <a id="__182">
     </a>
     ** 错误码定义**
    </h5>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XFSBL_ERROR_BOOTHEADER</span>   <span class="token expression"><span class="token number">0x1000</span>  </span><span class="token comment">// 头部校验失败</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XFSBL_ERROR_AUTHFAIL</span>     <span class="token expression"><span class="token number">0x1001</span>  </span><span class="token comment">// RSA验签错误</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">XFSBL_ERROR_PLLLOCK</span>      <span class="token expression"><span class="token number">0x1002</span>  </span><span class="token comment">// 时钟锁相环失锁</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       错误处理
      </strong>
      ：
      <ul>
       <li>
        记录错误到PMU全局状态寄存器（
        <code>
         XFsbl_WriteReg(PMU_GLOBAL_GLOB_GEN_STORAGE, errCode)
        </code>
        ）
       </li>
       <li>
        触发系统复位（
        <code>
         XFsbl_FallbackReset()
        </code>
        ）
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="___194">
     </a>
     **八、 总结 **
    </h4>
    <p>
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        L 
        
       
         o 
        
       
         a 
        
       
         d 
        
       
         B 
        
       
         o 
        
       
         o 
        
       
         t 
        
       
         I 
        
       
         m 
        
       
         a 
        
       
         g 
        
       
         e 
        
       
         ( 
        
       
         ) 
        
       
      
        LoadBootImage()
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal">
          L
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0502em;">
          B
         </span>
         <span class="mord mathnormal">
          oo
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0785em;">
          I
         </span>
         <span class="mord mathnormal">
          ma
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0359em;">
          g
         </span>
         <span class="mord mathnormal">
          e
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     作为Zynq7000启动链的核心，其执行涵盖硬件初始化、安全认证、多阶段加载三大模块。函数首先通过
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        F 
        
       
         s 
        
       
         b 
        
       
         l 
        
       
         H 
        
       
         o 
        
       
         o 
        
       
         k 
        
       
         B 
        
       
         e 
        
       
         f 
        
       
         o 
        
       
         r 
        
       
         e 
        
       
         B 
        
       
         i 
        
       
         t 
        
       
         s 
        
       
         t 
        
       
         r 
        
       
         e 
        
       
         a 
        
       
         m 
        
       
         D 
        
       
         d 
        
       
         r 
        
       
         ( 
        
       
         ) 
        
       
      
        FsblHookBeforeBitstreamDdr()
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          F
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          b
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
         <span class="mord mathnormal">
          Hoo
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0315em;">
          k
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0502em;">
          B
         </span>
         <span class="mord mathnormal">
          e
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1076em;">
          f
         </span>
         <span class="mord mathnormal">
          ore
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0502em;">
          B
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          re
         </span>
         <span class="mord mathnormal">
          am
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          D
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          r
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     完成DDR时序微调与性能监控启动，随后
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        X 
        
       
         F 
        
       
         s 
        
       
         b 
        
        
        
          l 
         
        
          L 
         
        
       
         o 
        
       
         a 
        
       
         d 
        
       
         P 
        
       
         a 
        
       
         r 
        
       
         t 
        
       
         i 
        
       
         t 
        
       
         i 
        
       
         o 
        
       
         n 
        
       
         s 
        
       
         ( 
        
       
         ) 
        
       
      
        XFsbl_LoadPartitions()
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1em; vertical-align: -0.25em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          XF
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          b
         </span>
         <span class="mord">
          <span class="mord mathnormal" style="margin-right: 0.0197em;">
           l
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3283em;">
              <span class="" style="top: -2.55em; margin-left: -0.0197em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight">
                 L
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1389em;">
          P
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          r
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mopen">
          (
         </span>
         <span class="mclose">
          )
         </span>
        </span>
       </span>
      </span>
     </span>
     深度解析Boot Header结构，利用CSU硬件模块实现RSA-2048/SHA-3安全认证，并依据分区属性（PL比特流或PS应用）选择PCAP配置或ELF加载机制。关键点包括：通过DevCfg接口的PL动态重配置、基于XLAT表的非对齐地址访问补偿、以及DMA加速的QSPI数据传输。移交控制权前，函数会强制刷新数据缓存（确保内存一致性）并通过CRL_APB寄存器组重配时钟域。调试方面，FSBL_DEBUG宏可实时输出分区加载状态，而错误处理机制将异常状态固化至PMU寄存器，为后续故障分析提供关键日志。该函数的设计充分体现了Zynq架构中PS-PL协同、硬件安全加速、以及多级启动链的技术特点。
    </p>
    <hr/>
    <p>
     <strong>
      注
     </strong>
     ：具体实现细节需参考对应版本的
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        f 
        
       
         s 
        
       
         b 
        
       
         l 
        
       
         _ 
        
       
         h 
        
       
         o 
        
       
         o 
        
       
         k 
        
       
         s 
        
       
         . 
        
       
         c 
        
       
      
        fsbl\_hooks.c
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0044em; vertical-align: -0.31em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1076em;">
          f
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          b
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
         <span class="mord" style="margin-right: 0.0278em;">
          _
         </span>
         <span class="mord mathnormal">
          h
         </span>
         <span class="mord mathnormal">
          oo
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0315em;">
          k
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord">
          .
         </span>
         <span class="mord mathnormal">
          c
         </span>
        </span>
       </span>
      </span>
     </span>
     和
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        x 
        
       
         f 
        
       
         s 
        
       
         b 
        
       
         l 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         t 
        
       
         i 
        
       
         t 
        
       
         i 
        
       
         o 
        
        
        
          n 
         
        
          l 
         
        
       
         o 
        
       
         a 
        
       
         d 
        
       
         . 
        
       
         c 
        
       
      
        xfsbl\_partition_load.c
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 1.0044em; vertical-align: -0.31em;">
         </span>
         <span class="mord mathnormal">
          x
         </span>
         <span class="mord mathnormal" style="margin-right: 0.1076em;">
          f
         </span>
         <span class="mord mathnormal">
          s
         </span>
         <span class="mord mathnormal">
          b
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0197em;">
          l
         </span>
         <span class="mord" style="margin-right: 0.0278em;">
          _
         </span>
         <span class="mord mathnormal">
          p
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mord mathnormal" style="margin-right: 0.0278em;">
          r
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          t
         </span>
         <span class="mord mathnormal">
          i
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord">
          <span class="mord mathnormal">
           n
          </span>
          <span class="msupsub">
           <span class="vlist-t vlist-t2">
            <span class="vlist-r">
             <span class="vlist" style="height: 0.3361em;">
              <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
               <span class="pstrut" style="height: 2.7em;">
               </span>
               <span class="sizing reset-size6 size3 mtight">
                <span class="mord mathnormal mtight" style="margin-right: 0.0197em;">
                 l
                </span>
               </span>
              </span>
             </span>
             <span class="vlist-s">
              ​
             </span>
            </span>
            <span class="vlist-r">
             <span class="vlist" style="height: 0.15em;">
              <span class="">
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="mord mathnormal">
          o
         </span>
         <span class="mord mathnormal">
          a
         </span>
         <span class="mord mathnormal">
          d
         </span>
         <span class="mord">
          .
         </span>
         <span class="mord mathnormal">
          c
         </span>
        </span>
       </span>
      </span>
     </span>
     源码文件。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f6a7a5f64646b2f:61727469636c652f64657461696c732f313436313234303830" class_="artid" style="display:none">
 </p>
</div>


