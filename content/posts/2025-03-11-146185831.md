---
arturl_encode: "68747470733a2f2f:626c6f672e6373646e2e6e65742f427261645f50695474372f:61727469636c652f64657461696c732f313436313835383331"
layout: post
title: "NexLM-å¼€æºç³»åˆ—è®©-AI-èŠå¤©æ›´ä¸æ»‘SSE-å®ç°æµå¼å¯¹è¯"
date: 2025-03-11 20:50:01 +08:00
description: "åœ¨æœ¬ç¯‡æˆ‘ä»¬æˆåŠŸå®ç°äº†åŸºäºçš„æµå¼å¯¹è¯ï¼Œè®© AI çš„å›å¤èƒ½å¤Ÿé€æ­¥å‘ˆç°ï¼Œæå¤§åœ°æå‡äº†ç”¨æˆ·çš„äº¤äº’ä½“éªŒã€‚SSE æ–¹æ¡ˆç®€å•æ˜“ç”¨ï¼Œç‰¹åˆ«é€‚ç”¨äºå•å‘æ¨é€çš„åœºæ™¯ï¼Œæ¯”å¦‚ AI å›å¤ã€ç³»ç»Ÿæ—¥å¿—æ¨é€ç­‰ã€‚ç„¶è€Œï¼ŒSSE ä¹Ÿå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œæ¯”å¦‚å®ƒæ˜¯å•å‘é€šä¿¡çš„ï¼Œä»…æ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œæ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„ä¸»åŠ¨äº¤äº’éœ€æ±‚ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å®ç°æ›´å¤æ‚çš„å®æ—¶åŒå‘é€šä¿¡ï¼ˆæ¯”å¦‚ AI ç”Ÿæˆè¿‡ç¨‹ä¸­ç”¨æˆ·å¯ä»¥ä¸­æ–­å¯¹è¯ã€å‘é€æŒ‡ä»¤è°ƒæ•´å›å¤å†…å®¹ç­‰ï¼‰ï¼ŒWebSocketå°±æ˜¯ä¸€ä¸ªæ›´ä¼˜çš„é€‰æ‹©ï¼åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨WebSocketã€‚"
keywords: "ã€NexLM å¼€æºç³»åˆ—ã€‘è®© AI èŠå¤©æ›´ä¸æ»‘ï¼šSSE å®ç°æµå¼å¯¹è¯ï¼"
categories: ['æœªåˆ†ç±»']
tags: ['å¤§æ¨¡å‹é›†æˆ', 'Deepseek', 'Chatgpt']
artid: "146185831"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146185831
    alt: "NexLM-å¼€æºç³»åˆ—è®©-AI-èŠå¤©æ›´ä¸æ»‘SSE-å®ç°æµå¼å¯¹è¯"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146185831
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146185831
cover: https://bing.ee123.net/img/rand?artid=146185831
image: https://bing.ee123.net/img/rand?artid=146185831
img: https://bing.ee123.net/img/rand?artid=146185831
---

# ã€NexLM å¼€æºç³»åˆ—ã€‘è®© AI èŠå¤©æ›´ä¸æ»‘ï¼šSSE å®ç°æµå¼å¯¹è¯ï¼

ğŸŒŸ åœ¨è¿™ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€èµ·æ¢ç´¢å¦‚ä½•æ­å»ºä¸€ä¸ªæ”¯æŒå¤§æ¨¡å‹é›†æˆé¡¹ç›®
**NexLM**
çš„å¼€å‘è¿‡ç¨‹ï¼Œä»
**æ¶æ„è®¾è®¡**
åˆ°
**ä»£ç å®æˆ˜**
ï¼Œé€æ­¥æ­å»ºä¸€ä¸ªæ”¯æŒ
**å¤šç§å¤§æ¨¡å‹ï¼ˆGPT-4ã€DeepSeek ç­‰ï¼‰**
çš„
**ä¸€ç«™å¼å¤§æ¨¡å‹é›†æˆä¸ç®¡ç†å¹³å°**
ï¼Œå¹¶é›†æˆ
**è®¤è¯ä¸­å¿ƒã€å¾®æœåŠ¡ã€æµå¼å¯¹è¯**
ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

**ç³»åˆ—ç›®å½•è§„åˆ’ï¼š**

1. **NexLMï¼šä»é›¶å¼€å§‹æ‰“é€ ä½ çš„ä¸“å±å¤§æ¨¡å‹é›†æˆå¹³å°**
   âœ…
2. **Spring Boot + OpenAI/DeepSeekï¼šå¦‚ä½•å°è£…å¤šä¸ªå¤§æ¨¡å‹ API è°ƒç”¨**
   âœ…
3. **æ”¯æŒæµå¼å¯¹è¯ SSE & WebSocketï¼šè®© AI äº’åŠ¨æ›´ä¸æ»‘**
   âœ…
4. **å¾®æœåŠ¡ + è®¤è¯ä¸­å¿ƒï¼šå¦‚ä½•ä¿éšœå¤§æ¨¡å‹ API çš„å®‰å…¨è°ƒç”¨**
5. **ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–ï¼šæé«˜ LLM API å“åº”é€Ÿåº¦**
6. **NexLM å¼€æºéƒ¨ç½²æŒ‡å—ï¼ˆDockerï¼‰**

---

## **ç¬¬ä¸‰ç¯‡ï¼šè®© AI èŠå¤©æ›´ä¸æ»‘ï¼šSSE å®ç°æµå¼å¯¹è¯ï¼**

*ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•å°è£…å¤šä¸ªå¤§æ¨¡å‹ API è°ƒç”¨ã€‚*

ç„¶è€Œï¼Œä¼ ç»Ÿçš„è¯·æ±‚-å“åº”æ¨¡å¼åœ¨ä¸ AI æ¨¡å‹äº¤äº’æ—¶ï¼Œå¾€å¾€éœ€è¦ç­‰å¾…æ¨¡å‹ç”Ÿæˆå®Œæ•´çš„å›å¤åæ‰èƒ½è¿”å›ç»™ç”¨æˆ·ï¼Œè¿™å¯èƒ½å¯¼è‡´ç”¨æˆ·ä½“éªŒä¸ä½³ã€‚ä¸ºæå‡äº¤äº’çš„å®æ—¶æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥æµå¼å¯¹è¯æŠ€æœ¯ï¼Œä½¿ AI çš„å›å¤èƒ½å¤Ÿé€æ­¥å‘ˆç°ï¼Œå¸¦æ¥æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/bdad9cba78c4458291cd65b57929c34e.gif)

### ä¸ºä»€ä¹ˆé€‰æ‹©æµå¼å¯¹è¯ï¼Ÿ

åœ¨ä¼ ç»Ÿçš„åŒæ­¥é€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¤„ç†åè¿”å›å®Œæ•´çš„å“åº”ã€‚ç„¶è€Œï¼Œå¯¹äºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œç”Ÿæˆå®Œæ•´çš„å›å¤å¯èƒ½éœ€è¦ä¸€å®šæ—¶é—´ã€‚å¦‚æœç”¨æˆ·éœ€è¦ç­‰å¾…æ•´ä¸ªå›å¤ç”Ÿæˆå®Œæ¯•ï¼Œå¯èƒ½ä¼šæ„Ÿåˆ°å»¶è¿Ÿï¼Œå½±å“ä½“éªŒã€‚
**é€šè¿‡æµå¼å¯¹è¯ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨ç”Ÿæˆå›å¤çš„è¿‡ç¨‹ä¸­ï¼Œé€æ­¥å°†å†…å®¹å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿèƒ½å®æ—¶å‘ˆç°è¿™äº›å†…å®¹ï¼Œæå‡äº¤äº’çš„å³æ—¶æ€§ã€‚**

### SSE å®ç°æµå¼å¯¹è¯çš„æ–¹å¼

#### Server-Sent Eventsï¼ˆSSEï¼‰

**SSE æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„æŠ€æœ¯**
ã€‚å®ƒä½¿ç”¨ç®€å•ï¼Œé€‚åˆæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å®æ—¶æ›´æ–°çš„åœºæ™¯ã€‚åœ¨ SSE ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡å»ºç«‹ä¸€ä¸ªæŒä¹…çš„ HTTP è¿æ¥ï¼ŒæœåŠ¡å™¨å¯ä»¥æŒç»­åœ°å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚

**ä¼˜ç‚¹ï¼š**

* å®ç°ç®€å•ï¼Œä½¿ç”¨æ ‡å‡†çš„ HTTP åè®®ã€‚
* æµè§ˆå™¨å…¼å®¹æ€§å¥½ï¼Œæ”¯æŒè‡ªåŠ¨é‡è¿ã€‚

**ç¼ºç‚¹ï¼š**

* ä»…æ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯çš„å•å‘é€šä¿¡ã€‚

### å®æˆ˜ï¼šåœ¨ Spring Boot ä¸­å®ç°æµå¼å¯¹è¯

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ SSE å’Œ WebSocket å®ç°ä¸ AI æ¨¡å‹çš„æµå¼å¯¹è¯ã€‚ä»£ç ä»“åº“åœ°å€ï¼š
<https://github.com/pitt1997/NexLM>

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/aef022efe9f04eeda3ca4b9635bce03b.png)

#### ä½¿ç”¨ SSE å®ç°æµå¼å¯¹è¯

**1. Controller å±‚ï¼š**

æˆ‘ä»¬éœ€è¦åœ¨æ§åˆ¶å™¨ä¸­å®šä¹‰ä¸€ä¸ªä½¿ç”¨ SSE çš„ç«¯ç‚¹ã€‚

```java
@RestController
@RequestMapping("/api/ai")
public class ChatApiController {

    @Autowired
    private ChatService chatService;

    @GetMapping(value = "/chat/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public SseEmitter streamChat(@RequestParam String prompt) {
        SseEmitter emitter = new SseEmitter();
        executor.execute(() -> {
            try {
                deepSeekClient.streamChat(prompt, emitter);
                emitter.complete();
            } catch (IOException e) {
                emitter.completeWithError(e);
            }
        });
        return emitter;
    }
}

```

**2. Service å±‚ï¼š**

åœ¨æœåŠ¡å±‚ï¼Œæˆ‘ä»¬éœ€è¦å®ç°
`callAIModel`
æ–¹æ³•ï¼Œæ ¹æ®ä¸åŒçš„æ¨¡å‹ç±»å‹ï¼Œè°ƒç”¨å¯¹åº”çš„å®¢æˆ·ç«¯è¿›è¡Œæµå¼å¯¹è¯ã€‚

```java
@Service
public class ChatService {

    @Autowired
    private OpenAIClient openAIClient;

    @Autowired
    private DeepSeekClient deepSeekClient;

    @Autowired
    private LocalLLMClient localLLMClient;

    public String callAIModel(String prompt, String modelType) {
        if ("chatgpt".equalsIgnoreCase(modelType)) {
            return openAIClient.chat(prompt);
        } else if ("deepseek".equalsIgnoreCase(modelType)) {
            return deepSeekClient.chat(prompt);
        } else if ("local".equalsIgnoreCase(modelType)) {
            return localLLMClient.chat(prompt);
        }
        return "Invalid Model Type";
    }
}

```

**3. è°ƒç”¨å¤§æ¨¡å‹æ¥å£ APIï¼š**

ä»¥ DeepSeek ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç°
`streamChat`
æ–¹æ³•ï¼Œé€æ­¥å°† AI æ¨¡å‹çš„å›å¤å‘é€ç»™å®¢æˆ·ç«¯ã€‚

```java
@Component
public class DeepSeekClient {
    private static final String API_URL = "https://api.deepseek.com/chat/completions";
    private static final String API_KEY = "ä½ çš„ DeepSeek API Key";
    private static final String MODEL = "deepseek-chat";

    public void streamChat(String prompt, SseEmitter emitter) throws IOException {
        RestTemplate restTemplate = new RestTemplate();
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.add("Authorization", "Bearer " + API_KEY);

        Map<String, Object> body = new HashMap<>();
        body.put("model", MODEL); // deepseek-v3 / deepseek-r1
        body.put("temperature", 0.7); // å¯è°ƒæ•´æ¸©åº¦
        body.put("max_tokens", 2048); // æ§åˆ¶å›å¤é•¿åº¦
        body.put("stream", true); // å¯ç”¨æµå¼å“åº”

        List<Map<String, String>> messages = Arrays.asList(
                new HashMap<String, String>() {{
                    put("role", "user");
                    put("content", prompt);
                }}
        );
        body.put("messages", messages);

        HttpEntity<Map<String, Object>> request = new HttpEntity<>(body, headers);

        // ä½¿ç”¨ RequestCallback å¤„ç†è¯·æ±‚
        RequestCallback requestCallback = clientHttpRequest -> {
            ObjectMapper objectMapper = new ObjectMapper();
            objectMapper.writeValue(clientHttpRequest.getBody(), body);
            clientHttpRequest.getHeaders().addAll(headers);
        };

        // ä½¿ç”¨ ResponseExtractor å¤„ç†å“åº”
        restTemplate.execute(API_URL, HttpMethod.POST, requestCallback, response -> {
            BufferedReader reader = new BufferedReader(new InputStreamReader(response.getBody()));
            String line;
            while ((line = reader.readLine()) != null) {
                if (line.startsWith("data: ")) {
                    String json = line.substring(6).trim();
                    if (!json.equals("[DONE]")) {
                        String content = extractContentStream(json);
                        if (!content.isEmpty()) { // æ£€æŸ¥ content æ˜¯å¦ä¸ºç©º
                            // å‘é€æ•°æ®åˆ°å®¢æˆ·ç«¯
                            emitter.send(SseEmitter.event().data(content));
                        }
                    }
                }
            }
            return null;
        });
    }

    private String extractContentStream(String json) {
        try {
            ObjectMapper objectMapper = new ObjectMapper();
            JsonNode root = objectMapper.readTree(json);
            JsonNode deltaNode = root.path("choices").get(0).path("delta");
            if (deltaNode.has("content")) {
                return deltaNode.path("content").asText();
            }
            return ""; // å¦‚æœ delta ä¸­æ²¡æœ‰ content å­—æ®µï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²
        } catch (Exception e) {
            e.printStackTrace();
            return "Error parsing response";
        }
    }

}

```

**4. å‰é¢é€šè¿‡ SSE æ–¹å¼è·å–æµå¼è¿”å›ç»“æœ**

```javascript
<script>
    function sendMessage() {
        let input = document.getElementById("userInput");
        let message = input.value.trim();
        if (message === "") return;

        let modelType = document.getElementById("modelType").value;
        let chatBox = document.getElementById("chatBox");

        // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        let userMessage = document.createElement("div");
        userMessage.className = "message user-message";
        userMessage.innerText = message;
        chatBox.appendChild(userMessage);

        // æ˜¾ç¤º AI "æ­£åœ¨è¾“å…¥..." å’ŒåŠ è½½åŠ¨ç”»
        let botMessage = document.createElement("div");
        botMessage.className = "message bot-message";
        botMessage.innerHTML = "AI æ­£åœ¨è¾“å…¥... <span class='loader'></span>";
        chatBox.appendChild(botMessage);
        input.value = "";

        // æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
        chatBox.scrollTop = chatBox.scrollHeight;

        // ç¼–ç ç”¨æˆ·è¾“å…¥
        var encodedMessage = encodeURIComponent(message);
        console.log("URL Encoded message:", encodedMessage);

        // é€šè¿‡ SSE æ–¹å¼è·å–æµå¼è¿”å›çš„ AI ç»“æœ
        let eventSource = new EventSource("/web/api/ai/chat/stream?modelType=" + modelType + "&prompt=" + encodedMessage);
        let isFirstChunk = true; // æ ‡è®°æ˜¯å¦æ˜¯ç¬¬ä¸€æ¡æ¶ˆæ¯

        eventSource.onmessage = function(event) {
            if (isFirstChunk) {
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œæ›¿æ¢åˆå§‹æ–‡æ¡ˆ
                botMessage.innerHTML = event.data;
                isFirstChunk = false;
            } else {
                // å¦åˆ™ï¼Œè¿½åŠ å†…å®¹
                botMessage.innerHTML += event.data;
            }
            // æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            chatBox.scrollTop = chatBox.scrollHeight;
        };

        eventSource.onerror = function() {
            eventSource.close();
            if (isFirstChunk) {
                // å¦‚æœæµå¼è¯·æ±‚å‡ºé”™ï¼Œä¸”æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ•°æ®ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                botMessage.innerHTML = "AI å“åº”å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚";
            }
        };
    }
</script>

```

#### SSE å®ç°æµå¼å¯¹è¯æ•ˆæœæ¼”ç¤º

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/cbbc5e3b99ce4031b11e8d3a45df92f2.gif)

### ç»“è¯­

åœ¨æœ¬ç¯‡æˆ‘ä»¬æˆåŠŸå®ç°äº†åŸºäº
**SSEï¼ˆServer-Sent Eventsï¼‰**
çš„æµå¼å¯¹è¯ï¼Œè®© AI çš„å›å¤èƒ½å¤Ÿé€æ­¥å‘ˆç°ï¼Œæå¤§åœ°æå‡äº†ç”¨æˆ·çš„äº¤äº’ä½“éªŒã€‚SSE æ–¹æ¡ˆç®€å•æ˜“ç”¨ï¼Œç‰¹åˆ«é€‚ç”¨äºå•å‘æ¨é€çš„åœºæ™¯ï¼Œæ¯”å¦‚ AI å›å¤ã€ç³»ç»Ÿæ—¥å¿—æ¨é€ç­‰ã€‚ç„¶è€Œï¼ŒSSE ä¹Ÿå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œæ¯”å¦‚å®ƒæ˜¯
**å•å‘é€šä¿¡**
çš„ï¼Œä»…æ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œæ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„ä¸»åŠ¨äº¤äº’éœ€æ±‚ã€‚

é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å®ç°
**æ›´å¤æ‚çš„å®æ—¶åŒå‘é€šä¿¡**
ï¼ˆæ¯”å¦‚ AI ç”Ÿæˆè¿‡ç¨‹ä¸­ç”¨æˆ·å¯ä»¥ä¸­æ–­å¯¹è¯ã€å‘é€æŒ‡ä»¤è°ƒæ•´å›å¤å†…å®¹ç­‰ï¼‰ï¼Œ
**WebSocket**
å°±æ˜¯ä¸€ä¸ªæ›´ä¼˜çš„é€‰æ‹©ï¼

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨
**WebSocket**
å¦‚ä½•å®ç°æµå¼å¯¹è¯ï¼Œå¹¶å¯¹æ¯” SSE å’Œ WebSocket çš„é€‚ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ åœ¨å®é™…åº”ç”¨ä¸­åšå‡ºæœ€ä½³é€‰æ‹©ã€‚

ğŸ“Œ
**ä¸‹ä¸€ç« é¢„å‘Šï¼šè®© AI èŠå¤©æ›´ä¸æ»‘ï¼šWebSocket å®ç°æµå¼å¯¹è¯ï¼**

---

ğŸ“¢
**ä½ å¯¹è¿™ä¸ªé¡¹ç›®æ„Ÿå…´è¶£å—ï¼Ÿæ¬¢è¿ Star & å…³æ³¨ï¼**
ğŸ“Œ
**[GitHub é¡¹ç›®åœ°å€](https://github.com/pitt1997/NexLM)**
**ğŸŒŸ ä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€åˆ†äº«ï¼**