---
layout: post
title: "C设计模式第二十一篇模板方法模式Template-Method"
date: 2025-03-12 09:15:32 +0800
description: "算法骨架的标准化定义"
keywords: "​【C++设计模式】第二十一篇：模板方法模式（Template Method）"
categories: ['C']
tags: ['设计模式', '模板方法模式', 'C']
artid: "146195588"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146195588
    alt: "C设计模式第二十一篇模板方法模式Template-Method"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146195588
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146195588
cover: https://bing.ee123.net/img/rand?artid=146195588
image: https://bing.ee123.net/img/rand?artid=146195588
img: https://bing.ee123.net/img/rand?artid=146195588
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ​【C++设计模式】第二十一篇：模板方法模式（Template Method）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <code>
      注意：复现代码时，确保 VS2022 使用 C++17/20 标准以支持现代特性。
     </code>
    </p>
    <h3>
     <a id="_2">
     </a>
     算法骨架的标准化定义
    </h3>
    <hr/>
    <h3>
     <a id="1__4">
     </a>
     1. 模式定义与用途
    </h3>
    <h4>
     <a id="_5">
     </a>
     核心思想
    </h4>
    <ul>
     <li>
      ​
      <strong>
       模板方法模式
      </strong>
      ：在父类中定义算法的骨架，将某些步骤延迟到子类实现，使得子类
      <strong>
       不改变算法结构
      </strong>
      即可重写特定步骤。
     </li>
     <li>
      ​
      <strong>
       关键用途
      </strong>
      ：
      <br/>
      ​1.
      <strong>
       代码复用
      </strong>
      ：提取多个类的共同流程到父类。
      <br/>
      ​2.
      <strong>
       流程标准化
      </strong>
      ：确保算法步骤的执行顺序不变。
      <br/>
      ​3.
      <strong>
       扩展性
      </strong>
      ：子类仅需关注差异化的实现细节。
     </li>
    </ul>
    <h4>
     <a id="_11">
     </a>
     经典场景
    </h4>
    <ul>
     <li>
      数据解析框架（固定解析流程，支持多种格式）。
     </li>
     <li>
      游戏角色行为（如攻击流程统一，子类实现不同攻击方式）。
     </li>
     <li>
      自动化测试框架（测试步骤固定，具体操作可定制）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2__16">
     </a>
     2. 模式结构解析
    </h3>
    <h4>
     <a id="UML_17">
     </a>
     UML类图
    </h4>
    <pre><code class="prism language-plaintext">+---------------------+       
|   AbstractClass     |      
+---------------------+        
| + templateMethod() |       
| + step1()           |     
| + step2()           |  
| + step3()           |  
+---------------------+  
          ^  
          |  
          |  
   +-----------------+  
   |   ConcreteClass |  
   +-----------------+  
   | + step2()       |  
   +-----------------+  
</code></pre>
    <h4>
     <a id="_36">
     </a>
     角色说明
    </h4>
    <ol>
     <li>
      <code>
       AbstractClass
      </code>
      ：抽象类，定义模板方法（算法骨架）和抽象步骤（
      <code>
       step2()
      </code>
      ）。
     </li>
     <li>
      <code>
       ConcreteClass
      </code>
      ：具体子类，实现父类定义的抽象步骤。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="3_C_40">
     </a>
     3. 现代C++实现示例
    </h3>
    <h4>
     <a id="_41">
     </a>
     场景：数据报告生成器
    </h4>
    <h5>
     <a id="1_42">
     </a>
     ​步骤1：定义抽象模板类
    </h5>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span>  </span>

<span class="token comment">// 抽象报告生成器  </span>
<span class="token keyword">class</span> <span class="token class-name">ReportGenerator</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">ReportGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>  

    <span class="token comment">// 模板方法（固定流程）  </span>
    <span class="token keyword">void</span> <span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">collectData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 抽象步骤  </span>
        <span class="token function">formatReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">saveReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token comment">// 通用步骤（已实现）  </span>
    <span class="token keyword">void</span> <span class="token function">collectData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"收集数据...\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 抽象步骤  </span>

    <span class="token keyword">void</span> <span class="token function">formatReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"格式化报告为PDF...\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token keyword">void</span> <span class="token function">saveReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"保存报告到服务器\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="2_78">
     </a>
     步骤2：实现具体子类
    </h5>
    <pre><code class="prism language-cpp"><span class="token comment">// 销售报告生成器  </span>
<span class="token keyword">class</span> <span class="token class-name">SalesReport</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">ReportGenerator</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"处理销售数据：计算总销售额和增长率\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token comment">// 库存报告生成器  </span>
<span class="token keyword">class</span> <span class="token class-name">InventoryReport</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">ReportGenerator</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"处理库存数据：分析缺货商品和周转率\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

    <span class="token comment">// 扩展：重写非抽象步骤  </span>
    <span class="token keyword">void</span> <span class="token function">saveReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"保存报告到本地数据库\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="3_102">
     </a>
     步骤3：客户端代码
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    SalesReport salesReport<span class="token punctuation">;</span>  
    salesReport<span class="token punctuation">.</span><span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">/* 输出：  
        收集数据...  
        处理销售数据：计算总销售额和增长率  
        格式化报告为PDF...  
        保存报告到服务器  
    */</span>  

    InventoryReport inventoryReport<span class="token punctuation">;</span>  
    inventoryReport<span class="token punctuation">.</span><span class="token function">generateReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">/* 输出：  
        收集数据...  
        处理库存数据：分析缺货商品和周转率  
        格式化报告为PDF...  
        保存报告到本地数据库  
    */</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="4__126">
     </a>
     4. 应用场景示例
    </h3>
    <h4>
     <a id="1_127">
     </a>
     场景1：游戏角色攻击流程
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Character</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">aim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">loadWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 抽象方法  </span>
        <span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">loadWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">void</span> <span class="token function">aim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"瞄准目标\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">void</span> <span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"开火！\n"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">Sniper</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Character</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">loadWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"装填狙击步枪\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">Mage</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Character</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">loadWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"凝聚魔法能量\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h4>
     <a id="2_158">
     </a>
     场景2：跨平台文件解析器
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">FileParser</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">public</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">openFile</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">validateHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 抽象方法  </span>
        <span class="token function">extractContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">closeFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  

<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">validateHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">void</span> <span class="token function">openFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* 通用实现 */</span> <span class="token punctuation">}</span>  
    <span class="token keyword">void</span> <span class="token function">extractContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* 通用实现 */</span> <span class="token punctuation">}</span>  
    <span class="token keyword">void</span> <span class="token function">closeFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/* 通用实现 */</span> <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">XMLParser</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">FileParser</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">validateHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"验证XML头部...\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <hr/>
    <h3>
     <a id="5__185">
     </a>
     5. 优缺点分析
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        ​优点
       </th>
       <th align="left">
        ​缺点
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        避免重复代码，提升复用性
       </td>
       <td align="left">
        父类修改可能影响所有子类
       </td>
      </tr>
      <tr>
       <td align="left">
        确保核心流程不可变
       </td>
       <td align="left">
        子类可能被迫实现无用的抽象方法
       </td>
      </tr>
      <tr>
       <td align="left">
        通过钩子方法（Hook）灵活扩展
       </td>
       <td align="left">
        过度继承可能导致类层次复杂
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="6__192">
     </a>
     6. 调试与优化策略
    </h3>
    <h4>
     <a id="VS2022_193">
     </a>
     调试技巧（VS2022）​
    </h4>
    <h5>
     <a id="1__194">
     </a>
     1. ​跟踪模板方法执行流程：
    </h5>
    <ul>
     <li>
      在
      <code>
       generateReport()
      </code>
      方法内设置断点，验证步骤顺序是否正确。
     </li>
    </ul>
    <h5>
     <a id="2__196">
     </a>
     2. 验证子类方法覆盖：
    </h5>
    <ul>
     <li>
      使用 ​重写指示符
      <code>
       override
      </code>
      确保子类正确实现抽象方法。
     </li>
    </ul>
    <h4>
     <a id="_198">
     </a>
     性能优化
    </h4>
    <h5>
     <a id="1_Hook_199">
     </a>
     1. ​钩子方法（Hook）​：
    </h5>
    <ul>
     <li>
      在父类中提供空实现的钩子方法，允许子类选择性扩展。
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">ReportGenerator</span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">preSaveHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment">// 钩子方法  </span>
    <span class="token keyword">void</span> <span class="token function">saveReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">preSaveHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"保存报告到服务器\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  

<span class="token keyword">class</span> <span class="token class-name">InventoryReport</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">ReportGenerator</span></span> <span class="token punctuation">{<!-- --></span>  
<span class="token keyword">protected</span><span class="token operator">:</span>  
    <span class="token keyword">void</span> <span class="token function">preSaveHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>  
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"压缩报告数据...\n"</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>  
</code></pre>
    <h5>
     <a id="2__219">
     </a>
     2. ​模板方法拆分：
    </h5>
    <ul>
     <li>
      将大型模板方法拆分为多个小方法，提升可维护性。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e637364:6e2e6e65742f4a7569637941637469766547696c626572742f:61727469636c652f64657461696c732f313436313935353838" class_="artid" style="display:none">
 </p>
</div>


