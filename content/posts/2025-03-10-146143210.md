---
layout: post
title: "Spark8配置Hadoop集群环境-使用脚本命令实现集群文件同步"
date: 2025-03-10 10:31:17 +0800
description: "在一台机器上模拟出 Hadoop 分布式系统的各个组件，各个组件在逻辑上是分离的，但是都运行在同一台物理机器上，以此来模拟分布式环境。在hadoop102上，将hadoop101中/opt/module/hadoop-3.1.3目录拷贝到hadoop102上。在root目录建立bin文件夹，在bin内建立xsync文件，并在文件中输入脚本。2.scp -r /etc/tst/B机器的用户名@主机名:/etc/tst。重新查看它的颜色，它现在已经变成执行的脚本了（如下图）。把这个脚本同步到其他的机器中。"
keywords: "Spark（8）配置Hadoop集群环境-使用脚本命令实现集群文件同步"
categories: ['未分类']
tags: ['大数据', '分布式', 'Spark']
artid: "146143210"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146143210
    alt: "Spark8配置Hadoop集群环境-使用脚本命令实现集群文件同步"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146143210
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146143210
cover: https://bing.ee123.net/img/rand?artid=146143210
image: https://bing.ee123.net/img/rand?artid=146143210
img: https://bing.ee123.net/img/rand?artid=146143210
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spark（8）配置Hadoop集群环境-使用脚本命令实现集群文件同步
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="text-align:center">
     <span style="color:#fe2c24">
      <strong>
       一.hadoop的运行模式
      </strong>
     </span>
    </p>
    <p style="text-align:center">
     <span style="color:#fe2c24">
      <strong>
       二.scp命令————基本使用
      </strong>
     </span>
    </p>
    <p style="text-align:center">
     <span style="color:#fe2c24">
      <strong>
       三.scp命令———拓展使用
      </strong>
     </span>
    </p>
    <p style="text-align:center">
     <span style="color:#fe2c24">
      <strong>
       四.rsync远程同步
      </strong>
     </span>
    </p>
    <p style="text-align:center">
     <span style="color:#fe2c24">
      <strong>
       五.xsync脚本集群之间的同步
      </strong>
     </span>
    </p>
    <hr/>
    <p>
     <span style="color:#fe2c24">
      <strong>
       一.hadoop的运行模式
      </strong>
     </span>
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       hadoop一共有如下
      </span>
      <span style="color:#000000">
       三种运行方式：
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       1. 本地运行。
      </span>
      <span style="color:#000000">
       数据存储在
      </span>
      <span style="color:#000000">
       linux
      </span>
      <span style="color:#000000">
       本地，测试偶尔用一下。
      </span>
      <span style="color:#000000">
       我们上一节课使用的就是本地
      </span>
      <span style="color:#000000">
       运行模式hadoop100。
      </span>
     </p>
     <p>
      <span style="color:#000000">
       2.
      </span>
      <span style="color:#000000">
       伪分布式
      </span>
      <span style="color:#000000">
       。在一台机器上模拟出 Hadoop 分布式系统的各个组件，各个组件在逻辑上是分离的，但是都运行在同一台物理机器上，以此来模拟分布式环境。
      </span>
     </p>
     <p>
      <span style="color:#000000">
       3. 完全分布式。数据存储在HDFS，多台服务器工作，企业中大量使用。
      </span>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        要在本地去
       </span>
       <span style="color:#000000">
        模拟这个
       </span>
       <span style="color:#000000">
        真实的场景
       </span>
       <span style="color:#000000">
        功能，我们需要做好如下的准备
       </span>
       <span style="color:#000000">
        ：
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        1）准备3台客户机（关闭防火墙、静态
       </span>
       <span style="color:#000000">
        IP
       </span>
       <span style="color:#000000">
        、主机名称）
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        2）安装javaJDK
       </span>
       <span style="color:#000000">
        ，
       </span>
       <span style="color:#000000">
        安装Hadoop
       </span>
       <span style="color:#000000">
        ，
       </span>
       <span style="color:#000000">
        并
       </span>
       <span style="color:#000000">
        配置环境变量
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        3
       </span>
       <span style="color:#000000">
        ）配置集群
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        4
       </span>
       <span style="color:#000000">
        ）单点启动
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        5
       </span>
       <span style="color:#000000">
        ）
       </span>
       <span style="color:#000000">
        配置
       </span>
       <span style="color:#000000">
        ssh
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        6）
       </span>
       <span style="color:#000000">
        群起并
       </span>
       <span style="color:#000000">
        测试集群
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        现在我们来看看按照JDK和Hadoop并配置环境变量的工作。有两种思路：
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        1. 每台机器都去手动安装一次（上传jar包再去解压）。
       </span>
      </strong>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        2. 把一台机器装好，把module 拷贝到其他的机器。这样就不需要省略了上传和解压的工作了。
       </span>
      </strong>
     </p>
    </div>
    <p>
     <span style="color:#fe2c24">
      <strong>
       二.scp命令————基本使用
      </strong>
     </span>
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       现在要学一个新的命令：
      </span>
      <span style="color:#000000">
       scp
      </span>
      <span style="color:#000000">
       。
      </span>
      <span style="color:#000000">
       它
      </span>
      <span style="color:#000000">
       可以实现服务器与服务器之间的数据拷贝。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         1.
        </strong>
       </span>
      </strong>
      <strong>
       <span style="color:#000000">
        <strong>
         基本语法
        </strong>
       </span>
      </strong>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        scp    -r        $pdir/$fname    $user@$host:$pdir/$fname
       </span>
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       说明
      </span>
      <span style="color:#000000">
       ：
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （1）
      </span>
      <span style="color:#000000">
       -
      </span>
      <span style="color:#000000">
       r
      </span>
      <span style="color:#000000">
       :
      </span>
      <span style="color:#000000">
       表示递归拷贝
      </span>
      <span style="color:#000000">
       。如果要拷贝的是文件夹，就把文件夹下的内容都拷贝
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （2）
      </span>
      <span style="color:#000000">
       $pdir/$fname:
      </span>
      <span style="color:#000000">
       要拷贝的文件路径/名称
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （3）
      </span>
      <span style="color:#000000">
       $user@host:$pdir/$fname:
      </span>
      <span style="color:#000000">
       目的地用户@主机:目的地路径/名称
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         注意：要输入相应的账号和密码！
        </strong>
       </span>
      </strong>
     </p>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         2.案例操作
        </strong>
       </span>
      </strong>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       来，我们一起看下
      </span>
      <span style="color:#000000">
       案例实操
      </span>
      <span style="color:#000000">
       。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         背景
        </strong>
       </span>
      </strong>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       假设你
      </span>
      <span style="color:#000000">
       已经：
      </span>
     </p>
     <p style="margin-left:25.0000pt">
      <span style="color:#000000">
       （1）
      </span>
      <span style="color:#000000">
       在
      </span>
      <span style="color:#000000">
       两
      </span>
      <span style="color:#000000">
       台虚拟机（
      </span>
      <span style="color:#000000">
       hadoop10
      </span>
      <span style="color:#000000">
       0
      </span>
      <span style="color:#000000">
       、hadoop10
      </span>
      <span style="color:#000000">
       1
      </span>
      <span style="color:#000000">
       ）
      </span>
      <span style="color:#000000">
       都已经创建好了/opt/module
      </span>
      <span style="color:#000000">
       ,
      </span>
      <span style="color:#000000">
       /opt/software两个目录
      </span>
     </p>
     <p style="margin-left:25.0000pt">
      <span style="color:#000000">
       （2）
      </span>
      <span style="color:#000000">
       在
      </span>
      <span style="color:#000000">
       hadoop10
      </span>
      <span style="color:#000000">
       0
      </span>
      <span style="color:#000000">
       这台机器中已经安装了jdk和hadoop。
      </span>
     </p>
     <p>
      <strong>
       <span style="color:#000000">
        <strong>
         目标
        </strong>
       </span>
      </strong>
     </p>
     <p>
      <span style="color:#000000">
       现在的目标是：
      </span>
      <span style="color:#000000">
       要把
      </span>
      <span style="color:#000000">
       hadoop
      </span>
      <span style="color:#000000">
       10
      </span>
      <span style="color:#000000">
       0
      </span>
      <span style="color:#000000">
       上的jdk
      </span>
      <span style="color:#000000">
       文件夹
      </span>
      <span style="color:#000000">
       拷贝到
      </span>
      <span style="color:#000000">
       ha
      </span>
      <span style="color:#000000">
       d
      </span>
      <span style="color:#000000">
       oop
      </span>
      <span style="color:#000000">
       10
      </span>
      <span style="color:#000000">
       1
      </span>
      <span style="color:#000000">
       中
      </span>
      <span style="color:#000000">
       的相同的目录下
      </span>
      <span style="color:#000000">
       。
      </span>
     </p>
     <p>
      <img alt="" height="448" src="https://i-blog.csdnimg.cn/direct/5f781944a840454e987a5c48794666dd.png" width="677"/>
     </p>
     <div>
      <p>
       <strong>
        <span style="color:#000000">
         <strong>
          操作
         </strong>
        </span>
       </strong>
      </p>
      <p>
       <span style="color:#000000">
        我们一起看
       </span>
       <span style="color:#000000">
        具体操作：
       </span>
      </p>
      <p>
       <span style="color:#000000">
        1. 启动虚拟机
       </span>
       <span style="color:#000000">
        。把
       </span>
       <span style="color:#000000">
        hadoop100
       </span>
       <span style="color:#000000">
        和
       </span>
       <span style="color:#000000">
        hadoop101
       </span>
       <span style="color:#000000">
        都启动
       </span>
       <span style="color:#000000">
        。
       </span>
      </p>
      <p>
       <span style="color:#000000">
        2. 进入到hadoop10
       </span>
       <span style="color:#000000">
        0
       </span>
      </p>
      <p>
       <span style="color:#000000">
        3. 命令：
       </span>
       <br/>
       <span style="color:#000000">
        scp -r /opt/module/jdk1.8.0_212
       </span>
       <span style="color:#000000">
        /
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        1
       </span>
       <span style="color:#000000">
        :/opt/module
       </span>
       <span style="color:#000000">
        /
       </span>
       <span style="color:#000000">
        jdk1.8.0_212
       </span>
       <span style="color:#000000">
        /
       </span>
      </p>
     </div>
    </div>
    <p>
     <span style="color:#fe2c24">
      <strong>
       三.scp命令———拓展使用
      </strong>
     </span>
    </p>
    <div>
     <ol>
      <li>
       <span style="color:#000000">
        拉取。
       </span>
       <span style="color:#000000">
        在
       </span>
       <span style="color:#000000">
        hadoop101
       </span>
       <span style="color:#000000">
        上，拉取
       </span>
       <span style="color:#000000">
        hadoop100
       </span>
       <span style="color:#000000">
        机器上的内容
       </span>
       <span style="color:#000000">
        （如下左图）
       </span>
       <span style="color:#000000">
        。
       </span>
      </li>
     </ol>
    </div>
    <p>
     <img alt="" height="283" src="https://i-blog.csdnimg.cn/direct/3cc0435c88e34390b41f9e56e2356793.png" width="462"/>
    </p>
    <div>
     <ol>
      <li>
       <span style="color:#000000">
        推送。
       </span>
       <span style="color:#000000">
        在
       </span>
       <span style="color:#000000">
        hadoop100
       </span>
       <span style="color:#000000">
        机器上，把文件
       </span>
       <span style="color:#000000">
        推送
       </span>
       <span style="color:#000000">
        到
       </span>
       <span style="color:#000000">
        hadoop101
       </span>
       <span style="color:#000000">
        机器上
       </span>
       <span style="color:#000000">
        （如上右图）
       </span>
       <span style="color:#000000">
        。
       </span>
      </li>
      <li>
       <span style="color:#000000">
        搭桥。
       </span>
       <span style="color:#000000">
        在
       </span>
       <span style="color:#000000">
        hadoop101
       </span>
       <span style="color:#000000">
        机器上，把
       </span>
       <span style="color:#000000">
        hadoop100
       </span>
       <span style="color:#000000">
        的文件传递到
       </span>
       <span style="color:#000000">
        hadoop102
       </span>
       <span style="color:#000000">
        上
       </span>
      </li>
     </ol>
    </div>
    <p>
     <img alt="" height="350" src="https://i-blog.csdnimg.cn/direct/b8ba13f0475e48bca297469c716369e6.png" width="773"/>
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         任务
        </strong>
       </span>
      </strong>
      <strong>
       <span style="color:#000000">
        <strong>
         1
        </strong>
       </span>
      </strong>
      <span style="color:#000000">
       ：
      </span>
      <span style="color:#000000">
       在hadoop102上，将hadoop101中/opt/module/hadoop-3.1.3目录拷贝到hadoop102上。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       分析：使用scp进行拉取
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       操作：
      </span>
     </p>
     <ol>
      <li>
       <span style="color:#000000">
        先登录到
       </span>
       <span style="color:#000000">
        hadoop2
       </span>
      </li>
      <li>
       <span style="color:#000000">
        使用命令：
       </span>
      </li>
     </ol>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        scp -r
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop101:/opt/module/hadoop-3.1.3 /opt/module/
       </span>
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         任务
        </strong>
       </span>
      </strong>
      <strong>
       <span style="color:#000000">
        <strong>
         2
        </strong>
       </span>
      </strong>
      <span style="color:#000000">
       ：
      </span>
      <span style="color:#000000">
       在hadoop10
      </span>
      <span style="color:#000000">
       1
      </span>
      <span style="color:#000000">
       上操作，将hadoop10
      </span>
      <span style="color:#000000">
       0
      </span>
      <span style="color:#000000">
       中/opt/module目录下所有目录拷贝到hadoop10
      </span>
      <span style="color:#000000">
       2
      </span>
      <span style="color:#000000">
       上。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       分析：使用scp进行搭桥
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       操作：
      </span>
     </p>
     <ol>
      <li>
       <span style="color:#000000">
        登录hadoop101
       </span>
      </li>
      <li>
       <span style="color:#000000">
        使用命令：
       </span>
      </li>
     </ol>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        scp -r
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        0
       </span>
       <span style="color:#000000">
        :/opt/module/*
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        2
       </span>
       <span style="color:#000000">
        :/opt/module
       </span>
      </span>
     </p>
    </div>
    <p>
     <span style="color:#fe2c24">
      <strong>
       四.rsync远程同步
      </strong>
     </span>
    </p>
    <p>
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       rsync主要用于备份和镜像。具有速度快、避免复制相同内容和支持符号链接的优点。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       rsync和scp区别是：rsync只对差异文件做更新，
      </span>
      <span style="color:#000000">
       而
      </span>
      <span style="color:#000000">
       scp是把所有文件都复制过去
      </span>
      <span style="color:#000000">
       ，所以它的效果更高一些
      </span>
      <span style="color:#000000">
       。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <img alt="" height="347" src="https://i-blog.csdnimg.cn/direct/edadf076d8f34b2abd7076473f8dbd84.png" width="805"/>
     </p>
    </div>
    <div>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         1.
        </strong>
       </span>
      </strong>
      <strong>
       <span style="color:#000000">
        <strong>
         基本语法
        </strong>
       </span>
      </strong>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        rsync    -av       $pdir/$fname             $user@$host:$pdir/$fname
       </span>
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       语法
      </span>
      <span style="color:#000000">
       说明：
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （1）
      </span>
      <span style="color:#000000">
       -
      </span>
      <span style="color:#000000">
       a：归档拷贝
      </span>
      <span style="color:#000000">
       ，尽可能让拷贝的文件之间保持一致。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （2）
      </span>
      <span style="color:#000000">
       -
      </span>
      <span style="color:#000000">
       v：显示拷贝过程。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （3）
      </span>
      <span style="color:#000000">
       $
      </span>
      <span style="color:#000000">
       p
      </span>
      <span style="color:#000000">
       dir/$fname:
      </span>
      <span style="color:#000000">
       要拷贝的文件路径/名称
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （4）
      </span>
      <span style="color:#000000">
       $user@host:$pdir/$fname:
      </span>
      <span style="color:#000000">
       目的地用户@主机:目的地路径/名称
      </span>
     </p>
    </div>
    <p>
     <span style="color:#38d8f0">
      实操：
     </span>
    </p>
    <p>
     <span style="color:#a2e043">
      rsync -av /opt/conf/ root@hadoop101:/opt/conf
     </span>
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       第一步：在
      </span>
      <span style="color:#000000">
       两台
      </span>
      <span style="color:#000000">
       机器上
      </span>
      <span style="color:#000000">
       准备
      </span>
      <span style="color:#000000">
       文件。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       在
      </span>
      <span style="color:#000000">
       hadoop
      </span>
      <span style="color:#000000">
       100
      </span>
      <span style="color:#000000">
       的
      </span>
      <span style="color:#000000">
       /opt/
      </span>
      <span style="color:#000000">
       conf
      </span>
      <span style="color:#000000">
       /
      </span>
      <span style="color:#000000">
       新
      </span>
      <span style="color:#000000">
       建1
      </span>
      <span style="color:#000000">
       .txt,
      </span>
      <span style="color:#000000">
       2
      </span>
      <span style="color:#000000">
       .txt
      </span>
      <span style="color:#000000">
       , 3
      </span>
      <span style="color:#000000">
       .txt,
      </span>
      <span style="color:#000000">
       4
      </span>
      <span style="color:#000000">
       .txt
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       做一次同步。
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        [
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        0
       </span>
       <span style="color:#000000">
        ]$ rsync -av
       </span>
       <span style="color:#000000">
        /opt/conf/
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        1
       </span>
       <span style="color:#000000">
        :/opt/
       </span>
       <span style="color:#000000">
        conf/
       </span>
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       它会在hadoop101上创建conf目录。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       第二步：
      </span>
      <span style="color:#000000">
       在hadoop100中，添加新文件，5.txt, 6.txt, 7.txt
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       第三步：
      </span>
      <span style="color:#000000">
       使用命令把新
      </span>
      <span style="color:#000000">
       添加的
      </span>
      <span style="color:#000000">
       文件同步到
      </span>
      <span style="color:#000000">
       hadoop101中
      </span>
      <span style="color:#000000">
       。
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       命令如下：
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        [
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        0
       </span>
       <span style="color:#000000">
        ]$ rsync -av
       </span>
       <span style="color:#000000">
        /opt/conf/
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        1
       </span>
       <span style="color:#000000">
        :/opt/
       </span>
       <span style="color:#000000">
        conf/
       </span>
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       请特别注意目录最后的尾/。有/表示拷贝这文件夹下的内容，没有/表示会拷贝这个文件夹
      </span>
     </p>
    </div>
    <p>
     <span style="color:#fe2c24">
      <strong>
       五.xsync脚本集群之间的同步
      </strong>
     </span>
    </p>
    <p>
     在root目录建立bin文件夹，在bin内建立xsync文件，并在文件中输入脚本
    </p>
    <p>
     chmod +x xsync
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <strong>
       <span style="color:#000000">
        <strong>
         2.
        </strong>
       </span>
      </strong>
      <strong>
       <span style="color:#000000">
        <strong>
         步骤
        </strong>
       </span>
      </strong>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （1）
      </span>
      <span style="color:#000000">
       在/
      </span>
      <span style="color:#000000">
       root
      </span>
      <span style="color:#000000">
       /bin目录下创建xsync文件
      </span>
      <span style="color:#000000">
       。在这个
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （2）
      </span>
      <span style="color:#000000">
       在该文件中编写如下代码
      </span>
      <span style="color:#000000">
       。这个部分的代码不需要会写，能看懂，了解即可。
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #!/bin/bash
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #1. 判断参数个数
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        if [ $# -lt 1 ]
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        then
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        echo Not Enough Arguement!
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        exit;
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        fi
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #2. 遍历集群所有机器
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        for host in hadoop10
       </span>
       <span style="color:#000000">
        0
       </span>
       <span style="color:#000000">
        hadoop10
       </span>
       <span style="color:#000000">
        1
       </span>
       <span style="color:#000000">
        hadoop10
       </span>
       <span style="color:#000000">
        2
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        do
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        echo ====================  $host  ====================
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #3. 遍历所有目录，挨个发送
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        for file in $@
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        do
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #4. 判断文件是否存在
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        if [ -e $file ]
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        then
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #5. 获取父目录
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        pdir=$(cd -P $(dirname $file); pwd)
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        #6. 获取当前文件的名称
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        fname=$(basename $file)
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        ssh $host "mkdir -p $pdir"
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        rsync -av $pdir/$fname $host:$pdir
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        else
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        echo $file does not exists!
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        fi
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        done
       </span>
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        done
       </span>
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       （
      </span>
      <span style="color:#000000">
       3
      </span>
      <span style="color:#000000">
       ）
      </span>
      <span style="color:#000000">
       修改执行权限。
      </span>
      <span style="color:#000000">
       此时，我们去查看文件
      </span>
      <span style="color:#000000">
       ，可以看到它的
      </span>
      <span style="color:#000000">
       颜色是灰色的，不具备执行权限
      </span>
      <span style="color:#000000">
       （如下图）
      </span>
     </p>
     <p style="margin-left:0.0000pt">
      <img alt="" height="48" src="https://i-blog.csdnimg.cn/direct/0c05a747973a4e63a9de2a060e84841d.png" width="460"/>
     </p>
     <p style="margin-left:0.0000pt; text-align:justify">
      <span style="color:#000000">
       接下来要通过命令：
      </span>
      <span style="color:#000000">
       chmod +x xsync
      </span>
      <span style="color:#000000">
       （
      </span>
      <span style="color:#000000">
       或者是chmod 777 xsync
      </span>
      <span style="color:#000000">
       ）
      </span>
     </p>
     <p style="margin-left:0.0000pt; text-align:justify">
      <span style="color:#000000">
       重新查看它的颜色，它现在已经变成执行的脚本了（如下图）。
      </span>
     </p>
     <p style="margin-left:0.0000pt; text-align:justify">
      <img alt="" height="68" src="https://i-blog.csdnimg.cn/direct/06e54b8ccf4046c18547a6e2c495a5b4.png" width="429"/>
     </p>
     <p style="margin-left:0.0000pt; text-align:justify">
      <span style="color:#000000">
       （4）测试使用。把这个脚本同步到其他的机器中。
      </span>
     </p>
     <p>
      <span style="background-color:#f2f2f2">
       <span style="color:#000000">
        <a name="_Hlk44780859">
         [
        </a>
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        @hadoop10
       </span>
       <span style="color:#000000">
        0
       </span>
       <span style="color:#000000">
        ~]$ xsync /
       </span>
       <span style="color:#000000">
        root
       </span>
       <span style="color:#000000">
        /bin
       </span>
       <span style="color:#000000">
        /
       </span>
      </span>
     </p>
    </div>
    <hr/>
    <p>
     <span style="color:#6eaad7">
      课堂小结
     </span>
    </p>
    <div>
     <ol>
      <li style="text-align:justify">
       <span style="color:#000000">
        scp的作用是什么？
       </span>
      </li>
      <li style="text-align:justify">
       如果当前在A机器上，要把A机器上的/etc/tst下的所有内容拷贝到B机器上的/etc/tst目录下，应该的命令应该怎么写？
      </li>
      <li style="text-align:justify">
       <span style="color:#000000">
        rsync与scp的区别是什么？
       </span>
      </li>
     </ol>
    </div>
    <p>
     <span style="color:#1c7892">
      答案：
     </span>
    </p>
    <p>
     1.实现服务器和服务器之间数据拷贝
    </p>
    <p>
     2.scp -r /etc/tst/B机器的用户名@主机名:/etc/tst
    </p>
    <div>
     <p style="margin-left:0.0000pt">
      <span style="color:#000000">
       3.rsync和scp区别是：rsync只对差异文件做更新，
      </span>
      <span style="color:#000000">
       而
      </span>
      <span style="color:#000000">
       scp是把所有文件都复制过去
      </span>
      <span style="color:#000000">
       ，所以它的效果更高一些
      </span>
      <span style="color:#000000">
       。
      </span>
     </p>
    </div>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38323339333231372f:61727469636c652f64657461696c732f313436313433323130" class_="artid" style="display:none">
 </p>
</div>


