---
layout: post
title: "如何将ReactNext.js的项目部署到服务器"
date: 2025-03-07 11:17:30 +0800
description: "将React+Next.js项目部署到本地服务器需要以下步骤，分为环境准备、项目配置、部署和优化三个阶段："
keywords: "如何将React+Next.js的项目部署到服务器"
categories: ['未分类']
tags: ['服务器', '持续部署', '前端面试题', '前端', 'React', 'Node', 'Javascript']
artid: "146089893"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146089893
    alt: "如何将ReactNext.js的项目部署到服务器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146089893
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146089893
cover: https://bing.ee123.net/img/rand?artid=146089893
image: https://bing.ee123.net/img/rand?artid=146089893
img: https://bing.ee123.net/img/rand?artid=146089893
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     如何将React+Next.js的项目部署到服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     一、服务器环境准备
    </h2>
    <h3>
     <a id="1__Nodejs__2">
     </a>
     1. 安装依赖 Node.js ：
    </h3>
    <h5>
     <a id="_NextjsNodejsLTS_3">
     </a>
     · Next.js需要Node.js环境（建议使用LTS版本）。
    </h5>
    <pre><code class="prism language-bash"> <span class="token comment"># Ubuntu示例 curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash - sudo apt-get install -y nodejs </span>
</code></pre>
    <h5>
     <a id="_PM2__9">
     </a>
     · PM2 （进程管理工具，用于保持应用运行）：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> pm2 
</code></pre>
    <h5>
     <a id="_Nginx__14">
     </a>
     · Nginx （可选，用于反向代理和静态资源处理）：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> 
</code></pre>
    <h3>
     <a id="_2_nginx__18">
     </a>
     · 2. nginx 配置防火墙
    </h3>
    <h5>
     <a id="_804433000_19">
     </a>
     · 开放必要端口（如80、443、3000）：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> ufw allow <span class="token number">80</span> /tcp <span class="token function">sudo</span> ufw allow <span class="token number">443</span> /tcp <span class="token function">sudo</span> ufw allow <span class="token number">3000</span> /tcp <span class="token function">sudo</span> ufw reload
</code></pre>
    <h2>
     <a id="_25">
     </a>
     二、项目配置与构建
    </h2>
    <h3>
     <a id="1__26">
     </a>
     1. 上传代码到服务器
    </h3>
    <h5>
     <a id="_Git_27">
     </a>
     · 通过Git克隆项目（确保服务器有访问仓库的权限）：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">git</span> clone https://your-repo-url.git
<span class="token builtin class-name">cd</span> your-project
</code></pre>
    <p>
     也可手动上传代码压缩包并解压。
    </p>
    <h3>
     <a id="2_35">
     </a>
     2.安装依赖并构建
    </h3>
    <h5>
     <a id="__36">
     </a>
     · 安装依赖：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--production</span>
</code></pre>
    <h5>
     <a id="_42">
     </a>
     ·环境变量配置：
    </h5>
    <ul>
     <li>
      在项目根目录创建或更新 .env.production 文件。
     </li>
     <li>
      构建时Next.js会读取该文件（变量需以 NEXT_PUBLIC_ 前缀暴露到客户端）。
     </li>
    </ul>
    <h5>
     <a id="__47">
     </a>
     · 构建项目：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">npm</span> run build
</code></pre>
    <h3>
     <a id="2_Nextjs_53">
     </a>
     2. 启动Next.js服务
    </h3>
    <h5>
     <a id="_PM2_54">
     </a>
     · 使用PM2启动：
    </h5>
    <pre><code class="prism language-bash">pm2 start <span class="token function">npm</span> <span class="token parameter variable">--name</span> <span class="token string">"next-app"</span> -- start
pm2 save
pm2 startup
</code></pre>
    <h2>
     <a id="Nginx_63">
     </a>
     三、配置Nginx反向代理（推荐）
    </h2>
    <h3>
     <a id="1_Nginx_64">
     </a>
     1. 创建Nginx配置文件
    </h3>
    <h5>
     <a id="__etcnginxsitesavailablenextapp__65">
     </a>
     · 新建文件 /etc/nginx/sites-available/next-app ，内容如下：
    </h5>
    <pre><code class="prism language-bash">server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name your-domain.com<span class="token punctuation">;</span> <span class="token comment"># 替换为公司内部域名或IP</span>

    location / <span class="token punctuation">{<!-- --></span>
        proxy_pass http://localhost:3000<span class="token punctuation">;</span> <span class="token comment"># 转发到Next.js服务</span>
        proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
        proxy_set_header Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
        proxy_set_header Connection <span class="token string">'upgrade'</span><span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_cache_bypass <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 静态资源缓存（可选）</span>
    location /_next/static <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">alias</span> /path/to/your-project/.next/static<span class="token punctuation">;</span>
        expires 365d<span class="token punctuation">;</span>
        access_log off<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="2_Nginx_90">
     </a>
     2. 启用配置并重启Nginx
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/nginx/sites-available/next-app /etc/nginx/sites-enabled/
<span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>  <span class="token comment"># 测试配置是否正确</span>
<span class="token function">sudo</span> systemctl restart nginx
</code></pre>
    <h2>
     <a id="HTTPS_99">
     </a>
     四、HTTPS配置（可选）
    </h2>
    <ol>
     <li>
      使用Let’s Encrypt申请证书（需公网域名）或公司内部CA签发。
     </li>
     <li>
      修改Nginx配置监听443端口并添加SSL证书路径：
     </li>
    </ol>
    <pre><code class="prism language-bash">server <span class="token punctuation">{<!-- --></span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name your-domain.com<span class="token punctuation">;</span>
    ssl_certificate /path/to/cert.pem<span class="token punctuation">;</span>
    ssl_certificate_key /path/to/privkey.pem<span class="token punctuation">;</span>
    <span class="token comment"># ...其他配置同上</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="_114">
     </a>
     五、验证与监控
    </h2>
    <h4>
     <a id="1__116">
     </a>
     1. 检查服务状态
    </h4>
    <pre><code class="prism language-bash">pm2 status       <span class="token comment"># 查看PM2进程状态</span>
systemctl status nginx  <span class="token comment"># 检查Nginx是否运行</span>
</code></pre>
    <h4>
     <a id="2__123">
     </a>
     2. 查看日志
    </h4>
    <pre><code class="prism language-bash">pm2 logs next-app  <span class="token comment"># Next.js日志</span>
journalctl <span class="token parameter variable">-u</span> nginx <span class="token parameter variable">-f</span>  <span class="token comment"># Nginx日志</span>
</code></pre>
    <h2>
     <a id="_130">
     </a>
     六、高级优化（可选）
    </h2>
    <h3>
     <a id="1_Docker_132">
     </a>
     1. 使用Docker容器化部署
    </h3>
    <h5>
     <a id="__Dockerfile__133">
     </a>
     · 创建 Dockerfile ：
    </h5>
    <pre><code class="prism language-bash">FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--production</span>
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
RUN <span class="token function">npm</span> run build
CMD <span class="token punctuation">[</span><span class="token string">"npm"</span>, <span class="token string">"start"</span><span class="token punctuation">]</span>
</code></pre>
    <h5>
     <a id="__145">
     </a>
     · 构建镜像并运行：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> next-app <span class="token builtin class-name">.</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 next-app
</code></pre>
    <h3>
     <a id="2_CICD_152">
     </a>
     2. 配置CI/CD
    </h3>
    <p>
     · 通过Jenkins/GitLab CI自动触发部署脚本。
    </p>
    <h2>
     <a id="_155">
     </a>
     注意事项
    </h2>
    <ul>
     <li>
      <strong>
       环境变量
      </strong>
      ：确保生产环境变量（如API地址）正确配置，敏感信息不要提交到代码库。
     </li>
     <li>
      <strong>
       资源限制
      </strong>
      ：Node.js可能需调整内存限制，可在启动时添加
      <mark>
       –max-old-space-size=4096
      </mark>
      。
     </li>
     <li>
      <strong>
       备份与回滚
      </strong>
      ：部署前备份旧版本，便于快速回滚。
     </li>
    </ul>
    <p>
     完成以上步骤后，访问服务器的IP或域名即可查看部署成功的应用。
    </p>
    <h2>
     <a id="_164">
     </a>
     完整部署脚本：
    </h2>
    <p>
     以下是为Node.js环境设计的完整部署脚本，包含依赖安装、项目构建、进程管理及Nginx反向代理配置，可直接保存为 deploy.sh 并执行：
    </p>
    <pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 部署脚本：自动部署Next.js项目到本地服务器（Node.js环境）</span>
<span class="token comment"># 使用方法：chmod +x deploy.sh &amp;&amp; ./deploy.sh</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 配置区（根据实际情况修改）</span>
<span class="token comment"># ----------------------------------</span>
<span class="token assign-left variable">PROJECT_NAME</span><span class="token operator">=</span><span class="token string">"my-next-app"</span>       <span class="token comment"># 项目名称</span>
<span class="token assign-left variable">PROJECT_PORT</span><span class="token operator">=</span><span class="token number">3000</span>                <span class="token comment"># Next.js服务端口</span>
<span class="token assign-left variable">PROJECT_GIT_REPO</span><span class="token operator">=</span><span class="token string">"https://github.com/yourusername/your-repo.git"</span>  <span class="token comment"># Git仓库地址</span>
<span class="token assign-left variable">PROJECT_DIR</span><span class="token operator">=</span><span class="token string">"/var/www/<span class="token variable">$PROJECT_NAME</span>"</span>     <span class="token comment"># 项目部署目录</span>
<span class="token assign-left variable">NGINX_AVAILABLE</span><span class="token operator">=</span><span class="token string">"/etc/nginx/sites-available/<span class="token variable">$PROJECT_NAME</span>.conf"</span>  <span class="token comment"># Nginx配置路径</span>
<span class="token assign-left variable">NGINX_ENABLED</span><span class="token operator">=</span><span class="token string">"/etc/nginx/sites-enabled/<span class="token variable">$PROJECT_NAME</span>.conf"</span>      <span class="token comment"># Nginx启用链接</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 颜色输出函数</span>
<span class="token comment"># ----------------------------------</span>
<span class="token assign-left variable">RED</span><span class="token operator">=</span><span class="token string">'\033[0;31m'</span>
<span class="token assign-left variable">GREEN</span><span class="token operator">=</span><span class="token string">'\033[0;32m'</span>
<span class="token assign-left variable">YELLOW</span><span class="token operator">=</span><span class="token string">'\033[0;33m'</span>
<span class="token assign-left variable">NC</span><span class="token operator">=</span><span class="token string">'\033[0m'</span> <span class="token comment"># 恢复默认颜色</span>

<span class="token function-name function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">${GREEN}</span><span class="token variable">$1</span><span class="token variable">${NC}</span>"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token function-name function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">${RED}</span><span class="token variable">$1</span><span class="token variable">${NC}</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token function-name function">warning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">${YELLOW}</span><span class="token variable">$1</span><span class="token variable">${NC}</span>"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 1. 安装依赖</span>
<span class="token comment"># ----------------------------------</span>
<span class="token function-name function">install_dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    success <span class="token string">"<span class="token entity" title="\n">\n</span>[1/6] 安装系统依赖..."</span>
    <span class="token comment"># 安装Node.js（LTS版本）</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token function">node</span> <span class="token operator">&amp;&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        warning <span class="token string">"未安装Node.js，正在安装..."</span>
        <span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://deb.nodesource.com/setup_lts.x <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token parameter variable">-E</span> <span class="token function">bash</span> -
        <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> nodejs <span class="token operator">||</span> error <span class="token string">"Node.js安装失败"</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># 安装PM2</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> pm2 <span class="token operator">&amp;&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> pm2 <span class="token operator">||</span> error <span class="token string">"PM2安装失败"</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># 安装Nginx（可选）</span>
    <span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> nginx <span class="token operator">&amp;&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        warning <span class="token string">"未安装Nginx，正在安装..."</span>
        <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx <span class="token operator">||</span> error <span class="token string">"Nginx安装失败"</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 2. 配置防火墙</span>
<span class="token comment"># ----------------------------------</span>
<span class="token function-name function">configure_firewall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    success <span class="token string">"<span class="token entity" title="\n">\n</span>[2/6] 配置防火墙..."</span>
    <span class="token function">sudo</span> ufw allow <span class="token variable">$PROJECT_PORT</span>/tcp    <span class="token comment"># 开放Next.js端口</span>
    <span class="token function">sudo</span> ufw allow <span class="token string">'Nginx Full'</span>         <span class="token comment"># 开放HTTP/HTTPS</span>
    <span class="token function">sudo</span> ufw reload
<span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 3. 拉取项目代码</span>
<span class="token comment"># ----------------------------------</span>
<span class="token function-name function">clone_project</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    success <span class="token string">"<span class="token entity" title="\n">\n</span>[3/6] 拉取项目代码..."</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$PROJECT_DIR</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        warning <span class="token string">"检测到已有项目目录，更新代码..."</span>
        <span class="token builtin class-name">cd</span> <span class="token variable">$PROJECT_DIR</span>
        <span class="token function">git</span> pull <span class="token operator">||</span> error <span class="token string">"代码拉取失败"</span>
    <span class="token keyword">else</span>
        <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$PROJECT_DIR</span>
        <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> <span class="token environment constant">$USER</span><span class="token builtin class-name">:</span><span class="token environment constant">$USER</span> <span class="token variable">$PROJECT_DIR</span>
        <span class="token function">git</span> clone <span class="token variable">$PROJECT_GIT_REPO</span> <span class="token variable">$PROJECT_DIR</span> <span class="token operator">||</span> error <span class="token string">"代码克隆失败"</span>
        <span class="token builtin class-name">cd</span> <span class="token variable">$PROJECT_DIR</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 4. 安装依赖并构建</span>
<span class="token comment"># ----------------------------------</span>
<span class="token function-name function">build_project</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    success <span class="token string">"<span class="token entity" title="\n">\n</span>[4/6] 安装依赖并构建..."</span>
    <span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--production</span> <span class="token operator">||</span> error <span class="token string">"依赖安装失败"</span>
    
    <span class="token comment"># 检查环境变量文件是否存在</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> .env.production <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        warning <span class="token string">"检测到缺少 .env.production 文件，请手动创建！"</span>
        <span class="token function">touch</span> .env.production
    <span class="token keyword">fi</span>

    <span class="token function">npm</span> run build <span class="token operator">||</span> error <span class="token string">"项目构建失败"</span>
<span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 5. 启动PM2进程</span>
<span class="token comment"># ----------------------------------</span>
<span class="token function-name function">start_pm2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    success <span class="token string">"<span class="token entity" title="\n">\n</span>[5/6] 启动PM2进程..."</span>
    <span class="token comment"># 检查是否已存在同名进程</span>
    <span class="token keyword">if</span> pm2 list <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token variable">$PROJECT_NAME</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        pm2 reload <span class="token variable">$PROJECT_NAME</span> <span class="token operator">||</span> error <span class="token string">"PM2进程重启失败"</span>
    <span class="token keyword">else</span>
        pm2 start <span class="token function">npm</span> <span class="token parameter variable">--name</span> <span class="token string">"<span class="token variable">$PROJECT_NAME</span>"</span> -- start <span class="token operator">||</span> error <span class="token string">"PM2进程启动失败"</span>
    <span class="token keyword">fi</span>
    pm2 save
    pm2 startup  <span class="token comment"># 提示用户执行生成的命令以设置开机启动</span>
<span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 6. 配置Nginx反向代理</span>
<span class="token comment"># ----------------------------------</span>
<span class="token function-name function">configure_nginx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    success <span class="token string">"<span class="token entity" title="\n">\n</span>[6/6] 配置Nginx反向代理..."</span>
    <span class="token function">sudo</span> <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">"cat &gt; <span class="token variable">$NGINX_AVAILABLE</span> &lt;&lt; EOF
server {
    listen 80;
    server_name _;  # 替换为实际域名或IP

    location / {
        proxy_pass http://localhost:<span class="token variable">$PROJECT_PORT</span>;
        proxy_set_header Host \<span class="token variable">$host</span>;
        proxy_set_header X-Real-IP \<span class="token variable">$remote_addr</span>;
        proxy_set_header X-Forwarded-For \<span class="token variable">$proxy_add_x_forwarded_for</span>;
        proxy_set_header X-Forwarded-Proto \<span class="token variable">$scheme</span>;
    }

    # 静态资源缓存
    location /_next/static {
        alias <span class="token variable">$PROJECT_DIR</span>/.next/static;
        expires 365d;
        access_log off;
    }
}
EOF"</span>

    <span class="token comment"># 创建启用链接</span>
    <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-sf</span> <span class="token variable">$NGINX_AVAILABLE</span> <span class="token variable">$NGINX_ENABLED</span>
    <span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span> <span class="token operator">||</span> error <span class="token string">"Nginx配置测试失败"</span>
    <span class="token function">sudo</span> systemctl restart nginx
<span class="token punctuation">}</span>

<span class="token comment"># ----------------------------------</span>
<span class="token comment"># 主执行流程</span>
<span class="token comment"># ----------------------------------</span>
install_dependencies
configure_firewall
clone_project
build_project
start_pm2
configure_nginx

success <span class="token string">"<span class="token entity" title="\n">\n</span>✅ 部署完成！访问 http://服务器IP 查看站点"</span>
warning <span class="token string">"提示：若需HTTPS，请手动修改Nginx配置添加SSL证书"</span>
</code></pre>
    <h5>
     <a id="1___323">
     </a>
     1. 修改配置
    </h5>
    <p>
     打开脚本，修改顶部的配置区：
     <br/>
     - PROJECT_NAME : 项目名称（用于PM2和Nginx配置
     <br/>
     - PROJECT_PORT : Next.js服务端口（默认3000）
     <br/>
     - PROJECT_GIT_REPO : 你的Git仓库地址（确保服务器有访问权限 ）
     <br/>
     - PROJECT_DIR : 项目部署目录（默认/var/www/my-next-app ）
    </p>
    <h5>
     <a id="2__331">
     </a>
     2. 赋予执行权限
    </h5>
    <pre><code class="prism language-bash"><span class="token function">chmod</span> +x deploy.sh 
</code></pre>
    <h5>
     <a id="3__337">
     </a>
     3. 运行脚本
    </h5>
    <pre><code class="prism language-bash"> ./deploy.sh 
</code></pre>
    <h5>
     <a id="4__343">
     </a>
     4. 后续操作
    </h5>
    <ul>
     <li>
      <p>
       · 根据提示手动创建 .env.production 文件并填写生产环境变量
      </p>
      <pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /var/www/my-next-app 
<span class="token function">nano</span> .env.production <span class="token comment"># 示例内容：NEXT_PUBLIC_API_URL=http://api.example.com </span>
</code></pre>
     </li>
     <li>
      <p>
       · 执行
       <mark>
        pm2 startup
       </mark>
       生成的命令（设置开机自启）
      </p>
     </li>
     <li>
      <p>
       ·
       <strong>
        日志监控
       </strong>
       ： 使用 pm2 logs 查看实时日志：
      </p>
      <pre><code class="prism language-bash">pm2 logs my-next-app
</code></pre>
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f4a6f65303231372f:61727469636c652f64657461696c732f313436303839383933" class_="artid" style="display:none">
 </p>
</div>


