---
layout: post
title: "JavaEE进阶Spring事务"
date: 2025-03-16 22:12:22 +0800
description: "本篇文章主要内容为以下两个方面对事务进行一个简单的介绍Spring中事务如何实现事务的概念，我相信很多人在数据库的时候已经听过和了解了，所以这里只进行简单的介绍事务是⼀组操作的集合，是⼀个不可分割的操作。事务会把所有的操作作为⼀个整体，⼀起向数据库提交或者是撤销操作请求。所以这组操作要么同时成功，要么同时失败。"
keywords: "【JavaEE进阶】Spring事务"
categories: ['未分类']
tags: ['Spring', 'Mybatis', 'Ee']
artid: "145999418"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145999418
    alt: "JavaEE进阶Spring事务"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145999418
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145999418
cover: https://bing.ee123.net/img/rand?artid=145999418
image: https://bing.ee123.net/img/rand?artid=145999418
img: https://bing.ee123.net/img/rand?artid=145999418
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【JavaEE进阶】Spring事务
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <hr id="hr-toc" name="tableOfContents"/>
    <h2>
     🍃前言
    </h2>
    <p>
     本篇文章主要内容为以下两个方面
    </p>
    <ol>
     <li>
      对事务进行一个简单的介绍
     </li>
     <li>
      Spring中事务如何实现
     </li>
    </ol>
    <h2 id="%F0%9F%8C%B4%E4%BA%8B%E5%8A%A1%E7%AE%80%E4%BB%8B" name="%F0%9F%8C%B4%E4%BA%8B%E5%8A%A1%E7%AE%80%E4%BB%8B">
     <a name="t2">
     </a>
     <a id="_6">
     </a>
     🌴事务简介
    </h2>
    <p>
     事务的概念，我相信很多人在数据库的时候已经听过和了解了，所以这里只进行简单的介绍
    </p>
    <h3 id="%F0%9F%9A%A9%20%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%3F" name="%F0%9F%9A%A9%20%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%3F">
     🚩 什么是事务?
    </h3>
    <p>
     事务是⼀组操作的集合，是⼀个不可分割的操作。
    </p>
    <p>
     事务会把所有的操作作为⼀个整体，⼀起向数据库提交或者是撤销操作请求。
    </p>
    <p>
     所以这组操作要么同时成功，要么同时失败。
    </p>
    <h3 id="%F0%9F%9A%A9%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BA%8B%E5%8A%A1%3F" name="%F0%9F%9A%A9%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BA%8B%E5%8A%A1%3F">
     🚩为什么需要事务?
    </h3>
    <p>
     我们在进行程序开发时,也会有事务的需求.
    </p>
    <p>
     举个例子吧
    </p>
    <p>
     比如转账操作，A向B转账
    </p>
    <ul>
     <li>
      第⼀步：A账⼾-100元.
     </li>
     <li>
      第⼆步：B账⼾+100元.
     </li>
    </ul>
    <p>
     如果没有事务，第⼀步执⾏成功了,第⼆步执⾏失败了,那么A账⼾的100元就平⽩⽆故消失了.
    </p>
    <p>
     如果使⽤事务就可以解决这个问题,让这⼀组操作要么⼀起成功,要么⼀起失败.
    </p>
    <h3 id="%F0%9F%9A%A9%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%93%8D%E4%BD%9C" name="%F0%9F%9A%A9%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%93%8D%E4%BD%9C">
     🚩事务的操作
    </h3>
    <p>
     事务的操作主要有三步:
    </p>
    <ol>
     <li>
      开启事start transaction/begin(⼀组操作前开启事务)
     </li>
     <li>
      提交事务:commit(这组操作全部成功,提交事务)
     </li>
     <li>
      回滚事务:rollback(这组操作中间任何⼀个操作出现异常,回滚事务)
     </li>
    </ol>
    <p>
     <img alt="" height="273" src="https://i-blog.csdnimg.cn/direct/0f2f5f08ae55442c9b6a7e6956ad583d.png" width="1038"/>
    </p>
    <h2 id="%F0%9F%8D%80Spring%20%E4%B8%AD%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0" name="%F0%9F%8D%80Spring%20%E4%B8%AD%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0">
     🍀Spring 中事务的实现
    </h2>
    <p>
     前⾯课程我们讲了MySQL的事务操作,Spring对事务也进⾏了实现.
    </p>
    <p>
     Spring 中的事务操作分为两类：
    </p>
    <ol>
     <li>
      编程式事务(⼿动写代码操作事务).
     </li>
     <li>
      声明式事务(利⽤注解⾃动开启和提交事务).
     </li>
    </ol>
    <p>
     在学习事务之前,我们先准备数据和数据的访问代码
    </p>
    <p>
     需求: ⽤⼾注册,注册时在⽇志表中插⼊⼀条操作记录
    </p>
    <p>
     <strong>
      数据准备：
     </strong>
     <img alt="" height="235" src="https://i-blog.csdnimg.cn/direct/9661d6e3536b4ccda578f11676a9f9ee.png" width="1122">
     </img>
    </p>
    <p>
     <strong>
      代码准备：
     </strong>
    </p>
    <ul>
     <li>
      1. 创建项⽬spring-trans,引⼊SpringWeb,Mybatis,mysql等依赖
      <img alt="" height="329" src="https://i-blog.csdnimg.cn/direct/b7ef85878a64492092d758aa01b758b7.png" width="972"/>
     </li>
     <li>
      2. applicant.yml 文件配置：
      <img alt="" height="332" src="https://i-blog.csdnimg.cn/direct/0c6a2dab74624f568c1e6f59d6ca78a0.png" width="1108">
      </img>
     </li>
     <li>
      3. model(实体类)
      <img alt="" height="266" src="https://i-blog.csdnimg.cn/direct/59b01be8c8d3467ebc3c15b12b1b663e.png" width="899">
      </img>
     </li>
     <li>
      4. controller
      <img alt="" height="564" src="https://i-blog.csdnimg.cn/direct/3c7a0a9e610c4184accfe36a18ae322a.png" width="1058"/>
     </li>
     <li>
      5. service
      <img alt="" height="335" src="https://i-blog.csdnimg.cn/direct/22665ed131284186aa8f89eda77caeb0.png" width="1047">
      </img>
     </li>
     <li>
      6. model
      <img alt="" height="269" src="https://i-blog.csdnimg.cn/direct/9f48813d73ec4929866744f52e572c48.png" width="858"/>
     </li>
     <li>
      7. mapper
      <img alt="" height="211" src="https://i-blog.csdnimg.cn/direct/f381dec6c0394396996edd30a8de884d.png" width="1092"/>
     </li>
     <li>
      测试
      <img alt="" height="616" src="https://i-blog.csdnimg.cn/direct/c0e5d87db4034551a2f984a71c27160d.png" width="1346"/>
     </li>
    </ul>
    <h3 id="%F0%9F%9A%A9Spring%20%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BA%8B%E5%8A%A1" name="%F0%9F%9A%A9Spring%20%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BA%8B%E5%8A%A1">
     🚩Spring 编程式事务
    </h3>
    <p>
     Spring ⼿动操作事务和上⾯MySQL操作事务类似,有3个重要操作步骤：
    </p>
    <ul>
     <li>
      开启事务(获取事务)
     </li>
     <li>
      提交事务
     </li>
     <li>
      回滚事务
     </li>
    </ul>
    <p>
     SpringBoot 内置了两个对象:
    </p>
    <ol>
     <li>
      DataSourceTransactionManager 事务管理器.用来获取事务(开启事务),提交或回滚事务的
     </li>
     <li>
      TransactionDefinition 是事务的属性,在获取事务的时候需要将TransactionDefinition 传递进去从而获得⼀个事务TransactionStatus
     </li>
    </ol>
    <p>
     我们先来实现一个增加用户，提交事务的案例，操作代码如下：
     <img alt="" height="1012" src="https://i-blog.csdnimg.cn/direct/065b7c38ade14445a3781eeb70d5b28c.png" width="1421"/>
    </p>
    <p>
     首先查看当前表中数据：
     <img alt="" height="148" src="https://i-blog.csdnimg.cn/direct/13181ec2b2664d1699162c6ce94cb7a4.png" width="698"/>
    </p>
    <p>
     通过Postman进行访问：
     <img alt="" height="624" src="https://i-blog.csdnimg.cn/direct/68fd99838a2b4e00a350423cf67769b1.png" width="1366"/>
    </p>
    <p>
     再次查看表中数据：
     <img alt="" height="148" src="https://i-blog.csdnimg.cn/direct/2f1624e8f1794f49912671206b2c935e.png" width="698"/>
    </p>
    <p>
     没有任何变化，成功进行了回滚操作。
    </p>
    <p>
     我们再来查看事务的提交：
    </p>
    <p>
     代码：
     <img alt="" height="1125" src="https://i-blog.csdnimg.cn/direct/90f5407f614a46ca87a2cb385b8d1283.png" width="1427"/>
    </p>
    <p>
     首先查看当前表中数据：
     <img alt="" height="148" src="https://i-blog.csdnimg.cn/direct/1c19b0929a7e4b4abfcc730924c2632b.png" width="698"/>
    </p>
    <p>
     通过Postman进行访问：
     <img alt="" height="630" src="https://i-blog.csdnimg.cn/direct/84550f4d5a9f478fafd9e34940cd2b64.png" width="1353"/>
    </p>
    <p>
     再次查看表中数据：
     <img alt="" height="196" src="https://i-blog.csdnimg.cn/direct/708083ad555547a29f9ed3b2887afc9a.png" width="753"/>
    </p>
    <p>
     可以看到当前表中并没有id为4的字段，那么可以看出成功的进行了回滚
    </p>
    <p>
     以上代码虽然可以实现事务,但操作也很繁琐,有没有更简单的实现⽅法呢?
    </p>
    <p>
     是有的，接下来我们来看一下声命式事务
    </p>
    <h3 id="%F0%9F%9A%A9Spring%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%40Transactional" name="%F0%9F%9A%A9Spring%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%40Transactional">
     🚩Spring声明式事务@Transactional
    </h3>
    <p>
     声明式事务的实现很简单
    </p>
    <p>
     两步操作:
    </p>
    <p>
     1. 添加依赖
     <img alt="" height="138" src="https://i-blog.csdnimg.cn/direct/4df7c03ebe124d2d888515e26a869668.png" width="729"/>
    </p>
    <p class="img-center">
     <img alt="" height="299" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=data%3Aimage%2Fgif%3Bbase64%2CR0lGODlhAQABAPABAP%2F%2F%2FwAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D&amp;pos_id=tOhTymLo" width="534"/>
    </p>
    <p>
     ​编辑
    </p>
    <p>
     2. 在需要事务的⽅法上添加 @Transactional 注解就可以实现了.⽆需⼿动开启事务和提交事 务,进⼊⽅法时⾃动开启事务,⽅法执⾏完会⾃动提交事务,如果中途发⽣了没有处理的异常会⾃动 回滚事务.
    </p>
    <p>
     代码：
     <img alt="" height="660" src="https://i-blog.csdnimg.cn/direct/cb5e87adb61d4691a4eea6dcec13c355.png" width="1185"/>
    </p>
    <p>
     进行访问：
     <img alt="" height="635" src="https://i-blog.csdnimg.cn/direct/90f854e7a151404380174053d2a1642c.png" width="1333"/>
    </p>
    <p>
     查看数据库，添加成功：
     <img alt="" height="222" src="https://i-blog.csdnimg.cn/direct/d420ab8116934ae8a2efee275031e9ac.png" width="766"/>
    </p>
    <p>
     使用此注解后，我们还可以从日志中观察到committing表示事务提交成功
     <img alt="" height="346" src="https://i-blog.csdnimg.cn/direct/0a1e32e651594da0af37767b71ffa4e3.png" width="1527"/>
    </p>
    <p>
     接下来我们修改代码，使该程序出现异常，然后再看看效果
     <img alt="" height="1540" src="https://i-blog.csdnimg.cn/direct/cf0ec251ad5643a18618d6b89258495c.png" width="2560"/>
    </p>
    <p>
     此时，我们再进行访问时，会出现异常
     <img alt="" height="737" src="https://i-blog.csdnimg.cn/direct/7523161737d74fcb91fbfe488af6107d.png" width="1379"/>
    </p>
    <p>
     数据库数据也没有进行添加
     <img alt="" height="228" src="https://i-blog.csdnimg.cn/direct/b814c2af7bff4608b724302ea768d441.png" width="762"/>
    </p>
    <p>
     观察日志，也没有出现committing，说明事务进行了回滚
     <img alt="" height="207" src="https://i-blog.csdnimg.cn/direct/e730880bc83f496a9dd55b40b6ef5fb3.png" width="1461"/>
    </p>
    <p>
     小结：若加了 @Transactional注解，出现异常会自动的把数据进行回滚；若没有加@Transactional注解，数据会执行成功，不会进行回滚(事务没有开启)，在表中显示。
    </p>
    <h3 id="%F0%9F%9A%A9%40Transactional%E7%9A%84%E4%BD%9C%E7%94%A8" name="%F0%9F%9A%A9%40Transactional%E7%9A%84%E4%BD%9C%E7%94%A8" style="background-color:transparent">
     🚩@Transactional的作用
    </h3>
    <p>
     @Transactional 可以用来修饰⽅法或类:
    </p>
    <ul>
     <li>
      修饰⽅法时:只有修饰public⽅法时才生效(修饰其他⽅法时不会报错,也不生效)[推荐]
     </li>
     <li>
      修饰类时:对 @Transactional 修饰的类中所有的public⽅法都⽣效
     </li>
    </ul>
    <p>
     方法/类被 @Transactional 注解修饰时,在目标方法执行开始之前,会自动开启事务,方法执行结束之后,自动提交事务.
    </p>
    <ul>
     <li>
      如果在方法执行过程中,出现异常,且异常未被捕获,就进行事务回滚操作.
     </li>
     <li>
      如果异常被程序捕获,⽅法就被认为是成功执行,依然会提交事务.
     </li>
    </ul>
    <p>
     比如我们对上述代码进行修改，对异常进行捕获
     <img alt="" height="830" src="https://i-blog.csdnimg.cn/direct/691fab148b1d4cda967b2567499d1271.png" width="1269"/>
    </p>
    <p>
     发送请求后，再次访问查看数据库，发现数据添加成功
     <img alt="" height="246" src="https://i-blog.csdnimg.cn/direct/db85ce093bd94a6696e26e97c2ef15af.png" width="872"/>
    </p>
    <p>
     观察日志：这些报红的信息是e.printStackTrace打印的
     <img alt="" height="504" src="https://i-blog.csdnimg.cn/direct/9d42a1ee32bd440bba9d5884589d223c.png" width="1572"/>
    </p>
    <p>
     运⾏程序,发现虽然程序出错了,但是由于异常被捕获了,所以事务依然得到了提交.
    </p>
    <p>
     如果想进行回滚，那么有两种方式可以实现
    </p>
    <ul>
     <li>
      1. 重新抛出异常
      <img alt="" height="822" src="https://i-blog.csdnimg.cn/direct/8e26c8cb60874a4aa92ddebc9e7df0e7.png" width="1142"/>
      <img alt="" height="171" src="https://i-blog.csdnimg.cn/direct/0fe17bc9aa284ebe927dd49bfdf69fa9.png" width="1293"/>
     </li>
     <li>
      2. 设置手动回滚
      <img alt="" height="831" src="https://i-blog.csdnimg.cn/direct/a179ae7f7cd5434abdafbd93a2dd5d06.png" width="1235"/>
      <img alt="" height="153" src="https://i-blog.csdnimg.cn/direct/38abd6abbcef495fbd86f45159791245.png" width="1458"/>
     </li>
    </ul>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f38313531303337342f:61727469636c652f64657461696c732f313435393939343138" class_="artid" style="display:none">
 </p>
</div>


