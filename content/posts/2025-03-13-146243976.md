---
layout: post
title: "文件系统-linux-第19课"
date: 2025-03-13 23:25:22 +0800
description: "文件系统"
keywords: "文件系统 linux ─── 第19课"
categories: ['Linux']
tags: ['运维', '服务器', 'Linux']
artid: "146243976"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146243976
    alt: "文件系统-linux-第19课"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146243976
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146243976
cover: https://bing.ee123.net/img/rand?artid=146243976
image: https://bing.ee123.net/img/rand?artid=146243976
img: https://bing.ee123.net/img/rand?artid=146243976
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     文件系统 linux ─── 第19课
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <img alt="" height="261" src="https://i-blog.csdnimg.cn/direct/f635df83759c4bbfb50222bc4c5da1dc.jpeg" width="463"/>
    </p>
    <p>
    </p>
    <p>
     <span style="color:#0d0016">
      <strong>
       前面博客讲解的是内存级文件管理,接下来介绍磁盘级文件管理
      </strong>
     </span>
    </p>
    <blockquote>
     <p>
      <span style="color:#0d0016">
       <strong>
        文件系统分为两部分
       </strong>
      </span>
     </p>
     <ol>
      <li>
       <strong>
        内存级文件系统 : OS加载进程 ,进程打开文件, OS为文件创建struct file 和文件描述符表 ,将进程与打开的文件相连, struct file 内还函数有指针表, 屏蔽了底层操作的差异,struct file中还有内核级文件缓冲区(提高效率)
       </strong>
      </li>
      <li>
       <strong>
        磁盘级文件系统: 管理磁盘上的文件
       </strong>
      </li>
     </ol>
    </blockquote>
    <h2>
     磁盘结构
    </h2>
    <blockquote>
     <p>
      它通过磁性材料或闪存技术将数据持久化存储，即使在断电后数据也不会丢失
     </p>
     <p>
      主要分为机械硬盘（HDD）和固态硬盘（SSD）
     </p>
     <p>
     </p>
     <p>
      今天我们讲解机械硬盘
     </p>
     <h5>
      <strong>
       机械硬盘（HDD，Hard Disk Drive）
      </strong>
     </h5>
     <ul>
      <li>
       <p>
        <strong>
         工作原理
        </strong>
        ：
       </p>
       <ul>
        <li>
         <p>
          使用磁性材料涂覆的旋转盘片存储数据, 比如磁性南极代表1 ,磁性北极代表0(打比方)
         </p>
        </li>
        <li>
         <p>
          通过磁头在盘片上移动来读写数据
         </p>
        </li>
       </ul>
      </li>
     </ul>
    </blockquote>
    <p>
    </p>
    <p>
     <img alt="" height="934" src="https://i-blog.csdnimg.cn/direct/c1b58f2c6cc74574a1d165f6c982229f.png" width="1606"/>
    </p>
    <h2>
     定位扇区
    </h2>
    <h3>
     CHS寻址模式
    </h3>
    <blockquote>
     <p>
      在硬盘的传统寻址模式中，数据是通过
      <strong>
       柱面（Cylinder）、磁头（Head）、扇区（Sector）的组合来寻址的，这种方式被称为CHS寻址（Cylinder-Head-Sector）
      </strong>
     </p>
     <p>
      扇区: 磁盘存储数据的基本单位 ,512字节, 因此,磁盘是
      <strong>
       块设备
      </strong>
     </p>
     <p>
      <strong>
      </strong>
      <strong>
       柱⾯上的每个磁道，扇区个数是⼀样的
      </strong>
     </p>
     <p>
      <span style="color:#fe2c24">
       <strong>
        注意: C H都是从0编码 ,S从1编码
       </strong>
      </span>
     </p>
    </blockquote>
    <p>
     真实过程 ⼀个细节：
     <strong>
      传动臂上的磁头是共进退的
     </strong>
    </p>
    <p>
     <img alt="" height="291" src="https://i-blog.csdnimg.cn/direct/c3c171dac57f4ef996dd55ca4acba559.png" width="333">
      <img alt="" height="502" src="https://i-blog.csdnimg.cn/direct/fd076c34cd4a4d98805bc3a5917ec529.png" width="341"/>
     </img>
    </p>
    <p>
    </p>
    <h3>
     LBA逻辑块寻址模式
    </h3>
    <blockquote>
     <p>
      LBA(Logical Block Addressing)逻辑块寻址模式。在 LBA 模式下，我们知道硬盘上的一个数据区域由它所在的磁头、柱面（也就是磁道）和扇区所唯一确定。
     </p>
     <p>
      <img alt="" height="840" src="https://i-blog.csdnimg.cn/direct/9201cd58014d467bb89f39556587c0b1.png" width="1675"/>
     </p>
     <p>
      在LBA地址中，地址不再表示实际硬盘的实际物理地址（柱面、磁头和扇区）。LBA编址方式将 CHS这种
      <strong>
       三维寻址方式
      </strong>
      转变为
      <strong>
       一维的线性寻址
      </strong>
      ，它把硬盘所有的物理扇区的C/H/S编号通过一定的规则转变为一线性的编号，系统效率得到大大提高，避免了烦琐的磁头/柱面/扇区的寻址方式。
     </p>
     <p>
      在访问硬盘时，由硬盘控制器再这种逻辑地址转换为实际硬盘的物理地址。
     </p>
     <p>
      <span style="color:#4da8ee">
       <strong>
        OS只需要使⽤LBA就可以了！！LBA地址转成CHS地址，CHS如何转换成为LBA地址。谁做啊？？磁盘 自己来做！固件(硬件电路，伺服系统)
       </strong>
      </span>
     </p>
    </blockquote>
    <h3>
     LBA与C/H/S 之间的转换:
    </h3>
    <blockquote>
     <p>
      LBA =柱面号C*单个柱面的扇区总数 + 磁头号H*每个磁道扇区的数量+ 扇区号S-1
     </p>
     <p>
      =柱面号*(磁头数*每个磁道扇区数)+磁头号H*每个磁道扇区的数量+ 扇区号S-1
      <br/>
     </p>
    </blockquote>
    <blockquote>
     <p>
      柱面号C = LBA//(磁头数*每磁道扇区数)   就是单个柱面的扇区总数
     </p>
     <p>
      磁头号H =(LBA% (磁头数* 每磁道扇区数)) // 每磁道扇区数
     </p>
     <p>
      扇区号S =(LBA% 每磁道扇区数)+1
     </p>
     <p>
      // 代表除法向下取整
     </p>
    </blockquote>
    <p>
     所以：从此往后，在
     <strong>
      磁盘使用者看来，根本就不关心CHS地址，⽽是直接使⽤LBA地址
     </strong>
     ，
     <strong>
      磁盘内部自己转换
     </strong>
     。所以： 从现在开始，磁盘就是⼀个
     <strong>
      元素为扇区
     </strong>
     的⼀维数组，数组的下标就是每⼀个扇区的LBA地址。OS使用磁盘，就可以⽤⼀个数字访问磁盘扇区了。
    </p>
    <h2>
    </h2>
    <h2>
     在磁盘如何管理文件
    </h2>
    <h3>
     引入"块"概念
    </h3>
    <p>
     其实硬盘是典型的“块”设备，
     <strong>
      操作系统读取硬盘数据
     </strong>
     的时候，其实是不会⼀个个扇区地读取，这样 效率太低，⽽是
     <strong>
      ⼀次性连续读取多个扇区，即⼀次性读取⼀个”块”（block）
     </strong>
     。
    </p>
    <p>
     硬盘的每个分区是被划分为⼀个个的”块”。⼀个”块”的⼤⼩是由格式化的时候确定的，并且不可 以更改，最常⻅的是
     <strong>
      4KB
     </strong>
     ，即
     <strong>
      连续⼋个扇区组成⼀个”块”
     </strong>
     。
     <span style="color:#fe2c24">
      <strong>
       ”块”是⽂件存取的最⼩单位。
      </strong>
     </span>
    </p>
    <p>
     <img alt="" height="292" src="https://i-blog.csdnimg.cn/direct/f00da868f72249d7a714b72b26781b56.png" width="1301"/>
    </p>
    <h4>
     <strong>
      注意：
     </strong>
    </h4>
    <blockquote>
     <ul>
      <li>
       磁盘就是⼀个三维数组，我们把它看待成为⼀个"一维数组"，数组下标就是LBA，每个元素都是扇区
      </li>
      <li>
       每个扇区都有LBA，那么8个扇区⼀个块，每⼀个块的地址我们也能算出来.
      </li>
      <li>
       知道LBA：块号 = LBA / 8
      </li>
      <li>
       知道块号：LAB=块号*8+n  (n是块内第几个扇区 1&lt;= n &lt;=8)
      </li>
     </ul>
    </blockquote>
    <p>
     <img alt="" height="456" src="https://i-blog.csdnimg.cn/direct/9494659754904f87a55dce9e415612de.png" width="1280"/>
    </p>
    <h3 style="background-color:transparent">
     引入"分区"概念
    </h3>
    <p>
     其实磁盘是可以被分成多个分区（partition）的，以Windows观点来看，你可能会有⼀块磁盘并且将 它分区成C,D,E盘。那个C,D,E就是分区。分区从实质上说就是对硬盘的⼀种格式化。但是Linux的设备 都是以文件形式存在，那是怎么分区的呢？
    </p>
    <blockquote>
     <p>
      <strong>
       柱面是分区的最⼩单位
      </strong>
      ，我们可以利⽤参考柱⾯号码的⽅式来进⾏分区，其本质就是设置每个区的起 始柱⾯和结束柱⾯号码。此时我们可以将硬盘上的柱⾯（分区）进⾏平铺，将其想象成⼀个⼤的平面，如下图所示：
     </p>
     <p>
     </p>
     <p>
      <img alt="" height="270" src="https://i-blog.csdnimg.cn/direct/59d6869db12c4b81aff612b9b0998f35.png" width="2063"/>
     </p>
     <p>
      柱面大小⼀致，扇区个位⼀致，那么其实只要知道每个分区的起始和结束柱⾯号，知道每 ⼀个柱面多少个扇区，那么该分区多⼤，其实和解释LBA是多少也就清楚了.
     </p>
     <p>
      <img alt="" height="192" src="https://i-blog.csdnimg.cn/direct/e0e69f4e72f8414aa5ab27564a8de7fc.png" width="1280"/>
     </p>
     <p>
     </p>
    </blockquote>
    <p>
     也就是OS管理磁盘,通过分治思想,将磁盘进行分区处理,但分出的区大小还有几百GB ,进一步对区分组 分成Block Group ,直接将每个组管理好即可.
    </p>
    <p>
    </p>
    <blockquote>
     <ul>
      <li>
       <strong>
        文件 = 内容+属性
       </strong>
      </li>
      <li>
       <strong>
        文件内容存储在(Block Group)
        <span style="color:#fe2c24">
         组
        </span>
        的 Data blocks中
       </strong>
      </li>
      <li>
       <strong>
        文件属性也是数据 ,linux中 文件的属性数据(比如文件的创建者、文件的创建日期、文件的大小等等
       </strong>
       <strong>
        )以数据结构(inode)的方式 存储
       </strong>
      </li>
      <li>
       <strong>
        一个文件一个inode ,inode大小有128字节 或者256字节, inode又存在 inodetable中
       </strong>
      </li>
      <li>
       <strong>
        ls -l -i    可以打印出文件详细信息   包括文件的inode值
       </strong>
      </li>
     </ul>
     <p>
      <img alt="" height="300" src="https://i-blog.csdnimg.cn/direct/ae4775bbcd0c442dac3c8522ba0b7a4a.png" width="875"/>
     </p>
    </blockquote>
    <p>
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37333735313239352f:61727469636c652f64657461696c732f313436323433393736" class_="artid" style="display:none">
 </p>
</div>


