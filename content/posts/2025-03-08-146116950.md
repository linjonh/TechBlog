---
layout: post
title: "Linux权限相关知识点"
date: 2025-03-08 16:17:06 +0800
description: "权限管理"
keywords: "【Linux】权限相关知识点"
categories: ['Shell']
tags: ['运维', '服务器', 'Linux']
artid: "146116950"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146116950
    alt: "Linux权限相关知识点"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146116950
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146116950
cover: https://bing.ee123.net/img/rand?artid=146116950
image: https://bing.ee123.net/img/rand?artid=146116950
img: https://bing.ee123.net/img/rand?artid=146116950
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Linux】权限相关知识点
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     思考
    </h2>
    <p>
     我们平时使用Linux创建文件或目录时的默认权限是多少？
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">mkdir</span> <span class="token function">dir</span> 
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">touch</span> <span class="token function">file</span>
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: ll
total <span class="token number">0</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">6</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:23 <span class="token function">dir</span>   <span class="token comment">#755</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:23 <span class="token function">file</span>  <span class="token comment">#644</span>
</code></pre>
    <p>
     可以看到文件创建时获得的权限是644
     <br/>
     目录创建时获得的权限是755
    </p>
    <hr/>
    <p>
     通过对上面问题的思考，我们现在引入下面的概念：
    </p>
    <h3>
     <a id="umask_16">
     </a>
     <code>
      umask
     </code>
    </h3>
    <p>
     默认情况下内核给文件分配的权限是
     <code>
      666
     </code>
     ，给目录分配的权限是
     <code>
      777
     </code>
     <br/>
     而用户创建文件或目录时，会与umask的掩码相减获得对应的权限值
     <br/>
     如下所示掩码值为
     <code>
      0022
     </code>
     <br/>
     那么创建文件时就是，666-022=644
     <br/>
     创建目录时为，777-022=755
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token builtin class-name">umask</span> 
0022
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token builtin class-name">umask</span> <span class="token parameter variable">-S</span>
<span class="token assign-left variable">u</span><span class="token operator">=</span>rwx,g<span class="token operator">=</span>rx,o<span class="token operator">=</span>rx

</code></pre>
    <p>
     接下来我们试着修改umask的值，再去创建文件和目录会发生什么？
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token builtin class-name">umask</span> 0777
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">mkdir</span> new_dir
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">touch</span> new_file
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: ll
total <span class="token number">0</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">6</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:23 <span class="token function">dir</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:23 <span class="token function">file</span>
d--------- <span class="token number">2</span> root root <span class="token number">6</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:45 new_dir
---------- <span class="token number">1</span> root root <span class="token number">0</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:49 new_file
</code></pre>
    <p>
     可以看到新的文件于目录的权限全部为000了。
    </p>
    <hr/>
    <p>
     umask的值，默认是在/etc/profile中的脚本初始化后得到的
    </p>
    <pre><code class="prism language-shell"><span class="token function">cat</span> /etc/profile

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token environment constant">$UID</span> <span class="token parameter variable">-gt</span> <span class="token number">199</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span>/usr/bin/id <span class="token parameter variable">-gn</span><span class="token variable">`</span></span>"</span> <span class="token operator">=</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span>/usr/bin/id <span class="token parameter variable">-un</span><span class="token variable">`</span></span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">umask</span> 002
<span class="token keyword">else</span>
    <span class="token builtin class-name">umask</span> 022
<span class="token keyword">fi</span>
</code></pre>
    <h3>
     <a id="chmod_55">
     </a>
     <code>
      chmod
     </code>
    </h3>
    <p>
     格式1：
     <br/>
     用户类别
     <br/>
     u: 所有者（user）
     <br/>
     g: 所属组（group）
     <br/>
     o: 其他用户（others）
     <br/>
     a: 所有用户（等同于 ugo，默认值）
     <br/>
     操作符
     <br/>
     +: 添加权限
     <br/>
     -: 移除权限
     <br/>
     =: 直接设置权限（覆盖原有权限）
    </p>
    <pre><code class="prism language-shell"><span class="token function">chmod</span> u+x <span class="token function">file</span>        <span class="token comment"># 给所有者添加执行权限  </span>
<span class="token function">chmod</span> go-w <span class="token function">file</span>       <span class="token comment"># 移除组和其他用户的写权限  </span>
<span class="token function">chmod</span> <span class="token assign-left variable">a</span><span class="token operator">=</span>rw <span class="token function">file</span>       <span class="token comment"># 所有用户设置为读写权限  </span>
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> o+rX <span class="token function">dir</span>     <span class="token comment"># 递归给其他用户添加读权限，目录加执行权限  </span>
</code></pre>
    <p>
     格式2：
     <br/>
     权限计算
     <br/>
     将权限对应的数值相加：
     <br/>
     r (读) = 4
     <br/>
     w (写) = 2
     <br/>
     x (执行) = 1
    </p>
    <pre><code class="prism language-shell"><span class="token function">chmod</span> nnn 文件或目录
<span class="token function">chmod</span> <span class="token number">777</span> dir_file
</code></pre>
    <p>
     目录权限：
     <br/>
     目录的 x 权限表示可进入（cd），r 权限表示可列出内容。
     <br/>
     若目录无 x 权限，即使有 r 权限也无法读取内部文件列表。
    </p>
    <h3>
     <a id="chown_87">
     </a>
     <code>
      chown
     </code>
    </h3>
    <p>
     必须是root
     <br/>
     用户和组必须存在
     <br/>
     格式：
    </p>
    <pre><code class="prism language-shell"><span class="token function">chown</span> 所有者 文件
<span class="token function">chown</span> :所属组 文件
<span class="token function">chown</span> 所有者:所属组 文件

<span class="token function">chown</span> luobozi:atri /home/ytl
</code></pre>
    <h3>
     <a id="chgrp_99">
     </a>
     <code>
      chgrp
     </code>
    </h3>
    <p>
     必须是root或者文件的所有者
     <br/>
     必须是新的组的成员
     <br/>
     格式：
    </p>
    <pre><code class="prism language-shell"><span class="token function">chgrp</span> 所属组 文件
</code></pre>
    <h2>
     <a id="_108">
     </a>
     查看常见目录的权限
    </h2>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost perm<span class="token punctuation">]</span>: ll /home
total <span class="token number">0</span>
drwx------ <span class="token number">2</span> kotonghitoli bondband  <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">14</span>:57 gdyg
drwx------ <span class="token number">2</span> luobozi      luobozi   <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">10</span>:50 luobozi
drwx------ <span class="token number">2</span> luobozi_1    luobozi_1 <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">16</span>:17 luobozi_1
drwx------ <span class="token number">2</span> luobozi_2    luobozi_2 <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">16</span>:17 luobozi_2
drwx------ <span class="token number">2</span> luobozi_3    luobozi_3 <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">16</span>:17 luobozi_3
drwx------ <span class="token number">2</span> luobozi_4    luobozi_4 <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">16</span>:17 luobozi_4
drwx------ <span class="token number">2</span> luobozi_5    luobozi_5 <span class="token number">62</span> Mar  <span class="token number">7</span> <span class="token number">16</span>:17 luobozi_5
<span class="token punctuation">[</span>root@localhost perm<span class="token punctuation">]</span>: ll <span class="token parameter variable">-d</span> /
dr-xr-xr-x. <span class="token number">22</span> root root <span class="token number">4096</span> Mar  <span class="token number">8</span> <span class="token number">16</span>:28 /
<span class="token punctuation">[</span>root@localhost perm<span class="token punctuation">]</span>: ll <span class="token parameter variable">-d</span> /root
dr-xr-x---. <span class="token number">15</span> root root <span class="token number">4096</span> Mar  <span class="token number">8</span> <span class="token number">15</span>:23 /root
<span class="token punctuation">[</span>root@localhost perm<span class="token punctuation">]</span>: ll <span class="token parameter variable">-d</span> /tmp/
drwxrwxrwt. <span class="token number">9</span> root root <span class="token number">255</span> Mar  <span class="token number">8</span> <span class="token number">16</span>:30 /tmp/
</code></pre>
    <h3>
     <a id="sudo_128">
     </a>
     <code>
      sudo
     </code>
     授权
    </h3>
    <p>
     在Linux中root用户的权限最大
     <br/>
     普通用户的权限很小，那么如何让普通用户也具有一定的权限呢？
     <br/>
     修改配置文件，使得普通用户可以使用sudo提权
    </p>
    <p>
     1.创建一个king用户，使他可以使用sudo提权执行所有命令
    </p>
    <pre><code class="prism language-shell">root@localhost ~<span class="token punctuation">]</span>: <span class="token function">useradd</span> king
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token builtin class-name">echo</span> <span class="token string">"123456"</span> <span class="token operator">|</span><span class="token function">passwd</span> king <span class="token parameter variable">--stdin</span>
Changing password <span class="token keyword">for</span> user king.
passwd: all authentication tokens updated successfully.

<span class="token comment">#添加如下内容</span>
<span class="token function">vim</span> /etc/sudoers
king    <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>       ALL

<span class="token comment">#使用sudo 提权查看root的家目录</span>
<span class="token function">su</span> - king
Last login: Sat Mar  <span class="token number">8</span> <span class="token number">17</span>:13:00 CST <span class="token number">2025</span> on pts/1
<span class="token punctuation">[</span>king@localhost ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">ls</span> /root
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> king: 
<span class="token number">2025</span>-1-14  anaconda-ks.cfg    dbbackup    functions  grep_file  shell  shell_bk_db   while_read.sh
</code></pre>
    <p>
     2.定义命令别名USERADMINS包含useradd、userdel、passwd、groupadd、groupdel命令
    </p>
    <pre><code class="prism language-shell"><span class="token comment">#添加如下内容</span>
<span class="token function">vim</span> /etc/sudoers
Cmnd_Alias USERADMINS <span class="token operator">=</span> /usr/sbin/useradd, /usr/sbin/userdel, /usr/bin/passwd,/usr/sbin/groupadd,/usr/sbin/groupdel
</code></pre>
    <p>
     3.新建用户组
     <code>
      k
     </code>
     ，里面的成员有
     <code>
      mikoto、reisi、weissman
     </code>
     <br/>
     设置sudoers文件允许k组里的成员可以使用
     <code>
      USERADMINS
     </code>
     命令别名里的命令，在任何机器上
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">groupadd</span> k
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">useradd</span> mikoto <span class="token parameter variable">-G</span> k
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">useradd</span> reisi <span class="token parameter variable">-G</span> k
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">useradd</span> weissman <span class="token parameter variable">-G</span> k
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token builtin class-name">echo</span> <span class="token string">"123456"</span> <span class="token operator">|</span><span class="token function">passwd</span> mikoto <span class="token parameter variable">--stdin</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token builtin class-name">echo</span> <span class="token string">"123456"</span> <span class="token operator">|</span><span class="token function">passwd</span> reisi <span class="token parameter variable">--stdin</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token builtin class-name">echo</span> <span class="token string">"123456"</span> <span class="token operator">|</span><span class="token function">passwd</span> weissman <span class="token parameter variable">--stdin</span>
<span class="token function">vim</span>  /etc/sudoers
%k ALL <span class="token operator">=</span> USERADMINS
</code></pre>
    <p>
     验证是否成功：
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">su</span> - weissman
<span class="token punctuation">[</span>weissman@localhost ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">useradd</span> neko <span class="token parameter variable">-G</span> weissman

We trust you have received the usual lecture from the <span class="token builtin class-name">local</span> System
Administrator. It usually boils down to these three things:

    <span class="token comment">#1) Respect the privacy of others.</span>
    <span class="token comment">#2) Think before you type.</span>
    <span class="token comment">#3) With great power comes great responsibility.</span>

<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> weissman: 
<span class="token punctuation">[</span>weissman@localhost ~<span class="token punctuation">]</span>$ <span class="token function">id</span> neko
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">3013</span><span class="token punctuation">(</span>neko<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">3015</span><span class="token punctuation">(</span>neko<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">3015</span><span class="token punctuation">(</span>neko<span class="token punctuation">)</span>,3012<span class="token punctuation">(</span>weissman<span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="selinux_187">
     </a>
     <code>
      selinux
     </code>
    </h3>
    <p>
     是Linux系统里的安全子系统（security linux）
     <br/>
     它可以限制哪些进程能访问哪些类型的文件
     <br/>
     默认情况下它是开启状态，一般情况下我们都是将它关闭的，修改配置文件永久关闭
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">cat</span> /etc/selinux/config 

<span class="token comment"># This file controls the state of SELinux on the system.</span>
<span class="token comment"># SELINUX= can take one of these three values:</span>
<span class="token comment">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment">#     disabled - No SELinux policy is loaded.</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disabled
<span class="token comment"># SELINUXTYPE= can take one of three values:</span>
<span class="token comment">#     targeted - Targeted processes are protected,</span>
<span class="token comment">#     minimum - Modification of targeted policy. Only selected processes are protected. </span>
<span class="token comment">#     mls - Multi Level Security protection.</span>
<span class="token assign-left variable">SELINUXTYPE</span><span class="token operator">=</span>targeted 


<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: setenforce <span class="token number">0</span> 临时关闭命令
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: getenforce 
Disabled
</code></pre>
    <h3>
     <a id="chattr_213">
     </a>
     <code>
      chattr
     </code>
    </h3>
    <p>
     设置文件的隐藏属性
     <br/>
     选项
     <code>
      [+-]
     </code>
     加是授予 减是取消
     <br/>
     -R 递归修改
     <br/>
     +i 锁定文件，任何人都不能改动，包括root用户
     <br/>
     +a 设置文件只能增加，不能修改和删除
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">mkdir</span> test1
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: chattr +i test1/
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: lsattr <span class="token parameter variable">-d</span> test1
----i----------- test1
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">mkdir</span> test1/dir1
mkdir: cannot create directory ‘test1/dir1’: Permission denied
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: chattr <span class="token parameter variable">-i</span> test1
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">mkdir</span> test1/dir1
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: ll test1
total <span class="token number">0</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">6</span> Mar  <span class="token number">8</span> <span class="token number">18</span>:05 dir1

</code></pre>
    <h3>
     <a id="lsattr_233">
     </a>
     <code>
      lsattr
     </code>
    </h3>
    <p>
     查看文件的隐藏属性
     <br/>
     -R 递归修改
     <br/>
     -d 查看目录本身的属性
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: lsattr <span class="token parameter variable">-d</span> test1
----i----------- test1
</code></pre>
    <h3>
     <a id="SET_242">
     </a>
     <code>
      SET位权限
     </code>
     特别权限位
    </h3>
    <p>
     SUID (4): 文件以所有者权限执行（如 /usr/bin/passwd）。
     <br/>
     SGID (2): 目录中新文件继承组权限。
     <br/>
     粘滞位 (1): 仅文件所有者可删除目录内文件（如 /tmp）。
    </p>
    <p>
     suid：如果摸个文件具有suid权限位，普通用户在执行这个命令的时候，会以文件拥有者身份去执行
     <br/>
     粘滞位（sticky）
    </p>
    <p>
     使用
     <code>
      chmod
     </code>
     修改set位
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: ll /bin/passwd 
-rwsr-xr-x. <span class="token number">1</span> root root <span class="token number">27856</span> Apr  <span class="token number">1</span>  <span class="token number">2020</span> /bin/passwd
<span class="token comment">#可以看到passwd的执行位置就是s</span>
</code></pre>
    <p>
     修改mkdir的suid权限位置
     <br/>
     注意观察属主的执行位置的权限变化
     <br/>
     第1位（可选）
     <br/>
     （SUID=4，SGID=2，粘滞位=1）
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">chmod</span> u+s /bin/mkdir
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: ll /bin/mkdir 
-rwsr-xr-x. <span class="token number">1</span> root root <span class="token number">79768</span> Aug <span class="token number">20</span>  <span class="token number">2019</span> /bin/mkdir


<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">chmod</span> 0755 /bin/mkdir 
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: ll /bin/mkdir 
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">79768</span> Aug <span class="token number">20</span>  <span class="token number">2019</span> /bin/mkdir


<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">chmod</span> <span class="token number">4755</span> /bin/mkdir 
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: ll /bin/mkdir 
-rwsr-xr-x. <span class="token number">1</span> root root <span class="token number">79768</span> Aug <span class="token number">20</span>  <span class="token number">2019</span> /bin/mkdir
</code></pre>
    <h2>
     <a id="ACL_279">
     </a>
     <code>
      ACL
     </code>
     访问控制列表
    </h2>
    <p>
     一个文件/目录的访问控制列表，可以针对任意指定的用户/组使用权限字符分配rwx权限
    </p>
    <h3>
     <a id="setfacl_282">
     </a>
     <code>
      setfacl
     </code>
    </h3>
    <p>
     格式 setfacl 选项 规则 文件
     <br/>
     -m 新增或修改ACL中的规则
     <br/>
     -b 删除所有ACL规则
     <br/>
     -x 删除指定的ACL规则
    </p>
    <pre><code class="prism language-shell">setfacl <span class="token parameter variable">-m</span> user:<span class="token punctuation">(</span>uid/name<span class="token punctuation">)</span>:<span class="token punctuation">(</span>perms<span class="token punctuation">)</span>  <span class="token comment">#指定某个使用者的权限</span>
setfacl <span class="token parameter variable">-m</span> group:<span class="token punctuation">(</span>uid/name<span class="token punctuation">)</span>:<span class="token punctuation">(</span>perms<span class="token punctuation">)</span> <span class="token comment">#指定某一个群组的权限</span>
setfacl <span class="token parameter variable">-m</span> other::<span class="token punctuation">(</span>perms<span class="token punctuation">)</span>  <span class="token comment">#指定其它使用者的权限</span>
setfacl <span class="token parameter variable">-m</span> mask::<span class="token punctuation">(</span>perms<span class="token punctuation">)</span>   <span class="token comment">#设定有效的最大权限</span>
</code></pre>
    <p>
     <code>
      user、group、other、mask
     </code>
     简写为：
     <code>
      u,g,o,m
     </code>
     <br/>
     perms使用
     <code>
      rwx
     </code>
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: setfacl <span class="token parameter variable">-m</span> u:luobozi:rw test.txt
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: getfacl test.txt
<span class="token comment"># file: test.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::rw-
user:luobozi:rw-
group::r--
mask::rw-
other::r--

</code></pre>
    <h3>
     <a id="getfacl_308">
     </a>
     <code>
      getfacl
     </code>
    </h3>
    <p>
     格式：getfacl 文件
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: getfacl test.txt
<span class="token comment"># file: test.txt</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::rw-
user:luobozi:rw-
group::r--
mask::rw-
other::r--
</code></pre>
    <h4>
     <a id="acl_324">
     </a>
     <code>
      acl练习
     </code>
    </h4>
    <ol>
     <li>
      创建三个组
      <code>
       homura 、silver、scepter4
      </code>
     </li>
     <li>
      创建三个用户，
      <code>
       anna
      </code>
      属于homura组，
      <code>
       seri
      </code>
      属于scepter4组，
      <code>
       neko
      </code>
      属于silver组
     </li>
     <li>
      在根目录下创建新目录
      <code>
       sword
      </code>
      ，再将/etc/passwd文件复制到sword目录下
     </li>
     <li>
      设置权限，passwd文件能被homura组读写，seri这个用户能读写执行，neko这个用户不能进行任何操作。
     </li>
    </ol>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">groupadd</span> homura
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">groupadd</span> silver
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">groupadd</span> scepter4
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">useradd</span> <span class="token parameter variable">-G</span> homura anna
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">useradd</span> <span class="token parameter variable">-G</span> scepter4 seri
<span class="token punctuation">[</span>root@localhost test<span class="token punctuation">]</span>: <span class="token function">useradd</span> <span class="token parameter variable">-G</span> silver neko

<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: <span class="token function">mkdir</span> /sword
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span>: <span class="token function">chmod</span> <span class="token number">777</span> /sword/
<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: <span class="token function">cp</span> /etc/passwd /sword

<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: setfacl <span class="token parameter variable">-m</span> g:homura:rw <span class="token function">passwd</span>
<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: setfacl <span class="token parameter variable">-m</span> u:seri:rwx <span class="token function">passwd</span>
<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: setfacl <span class="token parameter variable">-m</span> u:neko:--- <span class="token function">passwd</span>


<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: getfacl <span class="token function">passwd</span>
<span class="token comment"># file: passwd</span>
<span class="token comment"># owner: root</span>
<span class="token comment"># group: root</span>
user::rw-
user:seri:rwx
user:neko:---
group::r--
group:homura:rw-
mask::rwx
other::r--
</code></pre>
    <p>
     验证结果
    </p>
    <pre><code class="prism language-shell"><span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: <span class="token function">su</span> neko
neko@localhost sword<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"hellp"</span> <span class="token operator">&gt;&gt;</span> <span class="token function">passwd</span>
bash: passwd: Permission denied
<span class="token punctuation">[</span>neko@localhost sword<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token function">passwd</span>
cat: passwd: Permission denied

<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: <span class="token function">su</span> seri
<span class="token punctuation">[</span>seri@localhost sword<span class="token punctuation">]</span>$ ./passwd   <span class="token comment">#可以执行</span>
./passwd: line <span class="token number">1</span>: root:x:0:0:root:/root:/bin/bash: No such <span class="token function">file</span> or directory
<span class="token punctuation">[</span>seri@localhost sword<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"hello"</span> <span class="token operator">&gt;&gt;</span> <span class="token function">passwd</span>
<span class="token punctuation">[</span>seri@localhost sword<span class="token punctuation">]</span>$ <span class="token function">tail</span> <span class="token parameter variable">-1</span> <span class="token function">passwd</span>
hello

<span class="token punctuation">[</span>root@localhost sword<span class="token punctuation">]</span>: <span class="token function">su</span> anna
<span class="token punctuation">[</span>anna@localhost sword<span class="token punctuation">]</span>$ ./passwd   <span class="token comment">#无法执行</span>
bash: ./passwd: Permission denied
<span class="token punctuation">[</span>anna@localhost sword<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"hello,anna"</span> <span class="token operator">&gt;&gt;</span> <span class="token function">passwd</span>
<span class="token punctuation">[</span>anna@localhost sword<span class="token punctuation">]</span>$ <span class="token function">tail</span> <span class="token parameter variable">-1</span> <span class="token function">passwd</span>
hello,anna
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f467265657369615f323335302f:61727469636c652f64657461696c732f313436313136393530" class_="artid" style="display:none">
 </p>
</div>


