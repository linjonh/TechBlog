---
layout: post
title: "实践-基于Go语言自己动手实现区块链"
date: 2022-07-22 20:46:32 +0800
description: "本文介绍了如何从零开始构建一个简单的区块链模型，包括理解区块链的基本结构、创建区块、形成链式结构，并"
keywords: "go语言区块链学习"
categories: ['区块链']
tags: ['区块链']
artid: "125923989"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=125923989
    alt: "实践-基于Go语言自己动手实现区块链"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=125923989
featuredImagePreview: https://bing.ee123.net/img/rand?artid=125923989
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     实践 # 基于Go语言自己动手实现区块链
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="0__1">
     </a>
     0 介绍
    </h2>
    <p>
     <strong>
      学习目标
     </strong>
     ：1、理解什么是区块链；2、掌握区块链基本结构；3、构建区块链基本模型；
    </p>
    <ul>
     <li>
      理论部分：1、区块链七层架构模型；2、区块链链式结构；
     </li>
     <li>
      实践部分：1、创建区块；2、创建区块的“链”；3、访问区块链；
     </li>
    </ul>
    <p>
     开发环境：GoLand （付费，学生可以申请免费，需要提供证明）
     <br/>
     区块链的理论基础部分可以参考我写的其他博客，本文主要介绍实践。
    </p>
    <ul>
     <li>
      没有Go语言基础:
      <a href="https://www.bilibili.com/video/BV1AJ411D7j3/" rel="nofollow">
       10min快速入门 video
      </a>
     </li>
    </ul>
    <p>
     开源代码：https://github.com/hexbo/go-blockchain-demo
     <br/>
     如果有帮助欢迎star和分享~也欢迎提pr
    </p>
    <hr/>
    <h2>
     <a id="1__16">
     </a>
     1 区块链理论基础
    </h2>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/da12f9eab30ad442a19617dd598539d0.png">
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/6e415b73047065289c02a337fa83e2a9.png">
       <br/>
       <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/e7814c0cffee4d0e1c05b37d7ff50b77.png">
        <br/>
        <img alt="" src="https://i-blog.csdnimg.cn/blog_migrate/133dacd1fd3fca7f5af0df36496f552f.png#pic_center"/>
       </img>
      </img>
     </img>
    </p>
    <h3>
     <a id="_21">
     </a>
     数据层
    </h3>
    <h4>
     <a id="hash_22">
     </a>
     hash
    </h4>
    <p>
     hash函数的特点：单向性、确定性、隐蔽性、抗篡改、抗碰撞；
    </p>
    <p>
     区块链最基本的技术是hash，这里给出用go写的一个hash的demo:
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"crypto/sha256"</span>
	<span class="token string">"encoding/hex"</span>
	<span class="token string">"log"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">calcHash</span><span class="token punctuation">(</span>toBeHashed <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	hashInBytes <span class="token operator">:=</span> sha256<span class="token punctuation">.</span><span class="token function">Sum256</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>toBeHashed<span class="token punctuation">)</span><span class="token punctuation">)</span>
	hashInStr <span class="token operator">:=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>hashInBytes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s %s"</span><span class="token punctuation">,</span> toBeHashed<span class="token punctuation">,</span> hashInStr<span class="token punctuation">)</span>
	<span class="token keyword">return</span> hashInStr
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">calcHash</span><span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     如果不熟悉Go，关于上述代码可能会有以下问题：
    </p>
    <ul>
     <li>
      <p>
       Go语言字符串
       <code>
        string
       </code>
       和字节数组
       <code>
        []byte
       </code>
       类型转换问题：
       <a href="https://www.bilibili.com/video/BV1ff4y1m72A" rel="nofollow">
        【Golang】字符咋存？utf8咋编码？string啥结构？
       </a>
       、
       <a href="https://blog.csdn.net/ens160/article/details/120993451">
        golang中字符串与数组，切片的转换
       </a>
      </p>
     </li>
     <li>
      <p>
       Go语言数组、切片的转换问题：
       <a href="https://www.jianshu.com/p/e5ad83fff40b" rel="nofollow">
        数组和切片的相互转换
       </a>
       <br/>
       说明：sha256返回的是[32]byte,通过hashInBytes[:]将数组类型转为slice即[]byte
      </p>
     </li>
     <li>
      <p>
       Go语言数组/切片传参问题：
       <a href="https://blog.csdn.net/dl962454/article/details/121636938">
        【Go基础】Go中数组传参的几种方式
       </a>
       、
       <a href="https://blog.csdn.net/baolingye/article/details/111142386">
        Golang 数组（切片）的值传递与引用传递
       </a>
      </p>
     </li>
    </ul>
    <h2>
     <a id="2_01_55">
     </a>
     2 从0到1实现区块链模型
    </h2>
    <p>
     组成部分：1.实现区块和链式结构；2.实现一个简单的HTTP Server，对外暴露读写接口；
    </p>
    <p>
     <strong>
      说明：Go语言函数名大小写：小写代表方法只能在当前包使用，是私有方法，大写代表公有方法。
     </strong>
    </p>
    <h3>
     <a id="_Block_60">
     </a>
     区块 Block
    </h3>
    <pre><code class="prism language-go"><span class="token keyword">package</span> core

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"crypto/sha256"</span>
	<span class="token string">"encoding/hex"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Block <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Index         <span class="token builtin">int64</span>  <span class="token comment">// 区块编号</span>
	Timestamp     <span class="token builtin">int64</span>  <span class="token comment">// 区块时间戳</span>
	PrevBlockHash <span class="token builtin">string</span> <span class="token comment">// 上一个区块哈希值</span>
	Hash          <span class="token builtin">string</span> <span class="token comment">// 当前区块哈希</span>
	Data          <span class="token builtin">string</span> <span class="token comment">// 区块数据</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">calculateHash</span><span class="token punctuation">(</span>b Block<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	blockData <span class="token operator">:=</span> <span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>Index<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>Timestamp<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">.</span>PrevBlockHash <span class="token operator">+</span> b<span class="token punctuation">.</span>Data
	hashInBytes <span class="token operator">:=</span> sha256<span class="token punctuation">.</span><span class="token function">Sum256</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>blockData<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>hashInBytes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">GenerateNewBlock</span><span class="token punctuation">(</span>preBlock Block<span class="token punctuation">,</span> data <span class="token builtin">string</span><span class="token punctuation">)</span> Block <span class="token punctuation">{<!-- --></span>
	newBlock <span class="token operator">:=</span> Block<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	newBlock<span class="token punctuation">.</span>Index <span class="token operator">=</span> preBlock<span class="token punctuation">.</span>Index <span class="token operator">+</span> <span class="token number">1</span>
	newBlock<span class="token punctuation">.</span>PrevBlockHash <span class="token operator">=</span> preBlock<span class="token punctuation">.</span>Hash
	newBlock<span class="token punctuation">.</span>Timestamp <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	newBlock<span class="token punctuation">.</span>Data <span class="token operator">=</span> data
	newBlock<span class="token punctuation">.</span>Hash <span class="token operator">=</span> <span class="token function">calculateHash</span><span class="token punctuation">(</span>newBlock<span class="token punctuation">)</span>
	<span class="token keyword">return</span> newBlock
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">GenerateGenesisBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Block <span class="token punctuation">{<!-- --></span>
	preBlock <span class="token operator">:=</span> Block<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	preBlock<span class="token punctuation">.</span>Index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	preBlock<span class="token punctuation">.</span>Hash <span class="token operator">=</span> <span class="token string">""</span>
	<span class="token keyword">return</span> <span class="token function">GenerateNewBlock</span><span class="token punctuation">(</span>preBlock<span class="token punctuation">,</span> <span class="token string">"Genesis Block"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="_103">
     </a>
     链式结构
    </h3>
    <p>
     <strong>
      代码说明
     </strong>
     ：参数名在函数前是
     <a href="https://www.cnblogs.com/sunylat/p/6384721.html" rel="nofollow">
      结构函数
     </a>
     的语法，类似C++的类成员函数，GO里都是绑定到结构体上的。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> core

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Blockchain <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Blocks <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Block
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewBlockchain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Blockchain <span class="token punctuation">{<!-- --></span>
	genesisBlock <span class="token operator">:=</span> <span class="token function">GenerateGenesisBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	blockchain <span class="token operator">:=</span> Blockchain<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	blockchain<span class="token punctuation">.</span><span class="token function">AppendBlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>genesisBlock<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>blockchain
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>bc <span class="token operator">*</span>Blockchain<span class="token punctuation">)</span> <span class="token function">SendData</span><span class="token punctuation">(</span>data <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	preBlock <span class="token operator">:=</span> bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
	newBlock <span class="token operator">:=</span> <span class="token function">GenerateNewBlock</span><span class="token punctuation">(</span><span class="token operator">*</span>preBlock<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
	bc<span class="token punctuation">.</span><span class="token function">AppendBlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>newBlock<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>bc <span class="token operator">*</span>Blockchain<span class="token punctuation">)</span> <span class="token function">AppendBlock</span><span class="token punctuation">(</span>newBlock <span class="token operator">*</span>Block<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		bc<span class="token punctuation">.</span>Blocks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">,</span> newBlock<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token operator">*</span>newBlock<span class="token punctuation">,</span> <span class="token operator">*</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		bc<span class="token punctuation">.</span>Blocks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">,</span> newBlock<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"invalid block"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>bc <span class="token operator">*</span>Blockchain<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> block <span class="token operator">:=</span> <span class="token keyword">range</span> bc<span class="token punctuation">.</span>Blocks <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Index: %d\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>Index<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"PrevHash: %s\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>PrevBlockHash<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"CurrHash: %s\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>Hash<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Data: %s\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>Data<span class="token punctuation">)</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Timestamp: %d\n"</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span>Timestamp<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">isValid</span><span class="token punctuation">(</span>newBlock Block<span class="token punctuation">,</span> oldBlock Block<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> newBlock<span class="token punctuation">.</span>Index<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">!=</span> oldBlock<span class="token punctuation">.</span>Index <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> newBlock<span class="token punctuation">.</span>PrevBlockHash <span class="token operator">!=</span> oldBlock<span class="token punctuation">.</span>Hash <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token function">calculateHash</span><span class="token punctuation">(</span>newBlock<span class="token punctuation">)</span> <span class="token operator">!=</span> newBlock<span class="token punctuation">.</span>Hash <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     【问题】如下代码: 这里的len函数在这里不会冗余吗？
     <br/>
     C的strlen需要对char数组遍历一遍，因此相当于O(n)的复杂度，不是O(1)，不清楚Go的len函数
    </p>
    <pre><code class="prism language-go"><span class="token keyword">if</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token operator">*</span>newBlock<span class="token punctuation">,</span> <span class="token operator">*</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>bc<span class="token punctuation">.</span>Blocks<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
</code></pre>
    <p>
     说明：参考上面给出的一个关于go string存储的问题，go在字符串指针开头存了字符串长度数据，而不是在末尾存’\0’，所以应该是可以O(1)查询。
    </p>
    <h4>
     <a id="CMD_172">
     </a>
     CMD验证
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"go-blockchain/core"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	bc <span class="token operator">:=</span> core<span class="token punctuation">.</span><span class="token function">NewBlockchain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	bc<span class="token punctuation">.</span><span class="token function">SendData</span><span class="token punctuation">(</span><span class="token string">"Send 1 BTC to Alice"</span><span class="token punctuation">)</span>
	bc<span class="token punctuation">.</span><span class="token function">SendData</span><span class="token punctuation">(</span><span class="token string">"Send 1 EOS to Bob"</span><span class="token punctuation">)</span>
	bc<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="HTTP_RPC_187">
     </a>
     HTTP RPC读写
    </h3>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"encoding/json"</span>
	<span class="token string">"go-blockchain/core"</span>
	<span class="token string">"io"</span>
	<span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> blockchain <span class="token operator">*</span>core<span class="token punctuation">.</span>Blockchain

<span class="token keyword">func</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/blockchain/get"</span><span class="token punctuation">,</span> blockchainGetHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/blockchain/write"</span><span class="token punctuation">,</span> blockchainWriteHandler<span class="token punctuation">)</span>
	http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"localhost:8888"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">blockchainGetHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	bytes<span class="token punctuation">,</span> <span class="token builtin">error</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>blockchain<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token builtin">error</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		http<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">blockchainWriteHandler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	blockData <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>
	blockchain<span class="token punctuation">.</span><span class="token function">SendData</span><span class="token punctuation">(</span>blockData<span class="token punctuation">)</span>
	<span class="token function">blockchainGetHandler</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	blockchain <span class="token operator">=</span> core<span class="token punctuation">.</span><span class="token function">NewBlockchain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     运行后访问localhost:8888/blockchain/get可以查看当前区块数据，访问/write?data="xxxx"可以写数据
    </p>
    <h2>
     <a id="Reference_228">
     </a>
     Reference
    </h2>
    <ol>
     <li>
      <a href="https://www.imooc.com/video/17451/0" rel="nofollow">
       video
      </a>
     </li>
    </ol>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33333538333036392f:61727469636c652f64657461696c732f313235393233393839" class_="artid" style="display:none">
 </p>
</div>


