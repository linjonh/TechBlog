---
layout: post
title: "iOS-模块化架构设计主流方案与实现详解"
date: 2025-03-14 16:55:08 +0800
description: "随着 iOS 工程规模的扩大，模块化设计成为提升代码可维护性、团队协作效率和开发灵活性的关键。本文将探讨为什么需要模块化，详细介绍三种主流的模块化架构方案（协议抽象、依赖注入、路由机制和事件总线），并通过式代码示例帮助开发者深入理解每种方案的实现方式。最后，通过对比表格分析它们的优缺点。"
keywords: "iOS 模块化架构设计：主流方案与实现详解"
categories: ['架构']
tags: ['架构', 'Ios']
artid: "146260852"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146260852
    alt: "iOS-模块化架构设计主流方案与实现详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146260852
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146260852
cover: https://bing.ee123.net/img/rand?artid=146260852
image: https://bing.ee123.net/img/rand?artid=146260852
img: https://bing.ee123.net/img/rand?artid=146260852
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     iOS 模块化架构设计：主流方案与实现详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     随着 iOS 工程规模的扩大，模块化设计成为提升代码可维护性、团队协作效率和开发灵活性的关键。本文将探讨为什么需要模块化，介绍四种主流的模块化架构方案（
     <strong>
      协议抽象
     </strong>
     、
     <strong>
      依赖注入
     </strong>
     、
     <strong>
      路由机制
     </strong>
     和
     <strong>
      事件总线
     </strong>
     ），并通过代码示例和对比表格帮助开发者选择适合的方案。
    </p>
    <hr/>
    <h3>
     <a id="_6">
     </a>
     一、为什么需要模块化？
    </h3>
    <h4>
     <a id="1__8">
     </a>
     1.
     <strong>
      代码可维护性
     </strong>
    </h4>
    <p>
     随着工程规模的增长，代码量迅速增加，模块化可以将代码拆分为独立的功能模块，降低代码复杂度，提升可维护性。
    </p>
    <h4>
     <a id="2__11">
     </a>
     2.
     <strong>
      团队协作效率
     </strong>
    </h4>
    <p>
     模块化允许团队成员并行开发不同的功能模块，减少代码冲突，提升开发效率。
    </p>
    <h4>
     <a id="3__14">
     </a>
     3.
     <strong>
      独立测试与调试
     </strong>
    </h4>
    <p>
     每个模块可以独立打包和测试，便于定位问题和验证功能。
    </p>
    <h4>
     <a id="4__17">
     </a>
     4.
     <strong>
      代码复用
     </strong>
    </h4>
    <p>
     模块化设计使得功能模块可以在不同项目中复用，减少重复开发。
    </p>
    <h4>
     <a id="5__20">
     </a>
     5.
     <strong>
      灵活性与可扩展性
     </strong>
    </h4>
    <p>
     新增功能或修改现有功能时，只需关注特定模块，避免影响其他部分。
    </p>
    <hr/>
    <h3>
     <a id="_25">
     </a>
     二、主流模块化架构方案
    </h3>
    <h4>
     <a id="1_ProtocolOriented_Programming_28">
     </a>
     1.
     <strong>
      协议抽象（Protocol-Oriented Programming）
     </strong>
    </h4>
    <p>
     通过定义协议（Protocol）来实现模块间的通信，模块之间只依赖协议，而不依赖具体实现。
    </p>
    <h5>
     <a id="_31">
     </a>
     实现步骤：
    </h5>
    <p>
     1.在公共模块中定义协议：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// CommonModule/LoginServiceProtocol.swift</span>
<span class="token keyword">protocol</span> <span class="token class-name">LoginServiceProtocol</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">func</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     2.在模块中实现协议：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// LoginModule/LoginService.swift</span>
<span class="token keyword">class</span> <span class="token class-name">LoginService</span><span class="token punctuation">:</span> <span class="token class-name">LoginServiceProtocol</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">func</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 登录逻辑...</span>
        <span class="token function">completion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     3.在其他模块中通过协议调用：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// DataModule/DataManager.swift</span>
<span class="token keyword">class</span> <span class="token class-name">DataManager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> loginService<span class="token punctuation">:</span> <span class="token class-name">LoginServiceProtocol</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>loginService<span class="token punctuation">:</span> <span class="token class-name">LoginServiceProtocol</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>loginService <span class="token operator">=</span> loginService
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        loginService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"JohnDoe"</span></span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"password"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> success <span class="token keyword">in</span>
            <span class="token keyword">if</span> success <span class="token punctuation">{<!-- --></span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Fetching data..."</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     4.在主工程中注入依赖：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// MainApp/AppDelegate.swift</span>
<span class="token keyword">let</span> loginService <span class="token operator">=</span> <span class="token class-name">LoginService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> dataManager <span class="token operator">=</span> <span class="token class-name">DataManager</span><span class="token punctuation">(</span>loginService<span class="token punctuation">:</span> loginService<span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="_78">
     </a>
     优点：
    </h5>
    <ul>
     <li>
      <strong>
       类型安全
      </strong>
      : 通过协议定义接口，避免类型错误。
     </li>
     <li>
      <strong>
       可测试性
      </strong>
      : 易于单元测试，可以轻松替换实现。
     </li>
     <li>
      <strong>
       松耦合
      </strong>
      : 模块之间只依赖协议，不依赖具体实现。
     </li>
    </ul>
    <h5>
     <a id="_83">
     </a>
     缺点：
    </h5>
    <ul>
     <li>
      <strong>
       需要依赖注入
      </strong>
      : 需要手动管理依赖关系。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2_Dependency_Injection_88">
     </a>
     2.
     <strong>
      依赖注入（Dependency Injection）
     </strong>
    </h4>
    <p>
     通过依赖注入容器管理模块间的依赖关系，模块之间不直接依赖，而是通过容器获取依赖。
    </p>
    <h5>
     <a id="_91">
     </a>
     实现步骤：
    </h5>
    <p>
     1.定义依赖注入容器：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// CommonModule/DIContainer.swift</span>
<span class="token keyword">class</span> <span class="token class-name">DIContainer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">DIContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> services<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token keyword">func</span> <span class="token function-definition function">register</span><span class="token operator">&lt;</span><span class="token class-name">Service</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> service<span class="token punctuation">:</span> <span class="token class-name">Service</span><span class="token punctuation">,</span> <span class="token keyword">for</span> type<span class="token punctuation">:</span> <span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        services<span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> type<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> service
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">resolve</span><span class="token operator">&lt;</span><span class="token class-name">Service</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> type<span class="token punctuation">:</span> <span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Service</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> services<span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> type<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token class-name">Service</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     2.注册服务：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// MainApp/AppDelegate.swift</span>
<span class="token keyword">let</span> loginService <span class="token operator">=</span> <span class="token class-name">LoginService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">DIContainer</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>loginService<span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token class-name">LoginServiceProtocol</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     3.在模块中通过容器获取服务：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// DataModule/DataManager.swift</span>
<span class="token keyword">class</span> <span class="token class-name">DataManager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> loginService<span class="token punctuation">:</span> <span class="token class-name">LoginServiceProtocol</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>loginService <span class="token operator">=</span> <span class="token class-name">DIContainer</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">LoginServiceProtocol</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        loginService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"JohnDoe"</span></span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"password"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> success <span class="token keyword">in</span>
            <span class="token keyword">if</span> success <span class="token punctuation">{<!-- --></span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Fetching data..."</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_138">
     </a>
     优点：
    </h5>
    <ul>
     <li>
      <strong>
       高度解耦
      </strong>
      : 模块之间无直接依赖。
     </li>
     <li>
      <strong>
       易于管理
      </strong>
      : 集中管理依赖关系。
     </li>
     <li>
      <strong>
       可扩展性
      </strong>
      : 方便替换或扩展服务。
     </li>
    </ul>
    <h5>
     <a id="_143">
     </a>
     缺点：
    </h5>
    <ul>
     <li>
      <strong>
       复杂性
      </strong>
      : 需要引入依赖注入容器，增加代码复杂性。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3_Router_Pattern_148">
     </a>
     3.
     <strong>
      路由机制（Router Pattern）
     </strong>
    </h4>
    <p>
     通过路由机制实现模块间的跳转和通信，模块之间不直接依赖，而是通过路由进行交互。
    </p>
    <h5>
     <a id="_151">
     </a>
     实现步骤：
    </h5>
    <p>
     1.定义路由协议：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// CommonModule/RouterProtocol.swift</span>
<span class="token keyword">protocol</span> <span class="token class-name">RouterProtocol</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">func</span> <span class="token function-definition function">navigate</span><span class="token punctuation">(</span>to route<span class="token punctuation">:</span> <span class="token class-name">Route</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">enum</span> <span class="token class-name">Route</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> login
    <span class="token keyword">case</span> <span class="token function">profile</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     2.实现路由：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// MainApp/AppRouter.swift</span>
<span class="token keyword">class</span> <span class="token class-name">AppRouter</span><span class="token punctuation">:</span> <span class="token class-name">RouterProtocol</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">func</span> <span class="token function-definition function">navigate</span><span class="token punctuation">(</span>to route<span class="token punctuation">:</span> <span class="token class-name">Route</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> route <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span>login<span class="token punctuation">:</span>
            <span class="token keyword">let</span> loginVC <span class="token operator">=</span> <span class="token class-name">LoginViewController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 跳转到登录页面...</span>
        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">profile</span><span class="token punctuation">(</span><span class="token keyword">let</span> username<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">let</span> profileVC <span class="token operator">=</span> <span class="token class-name">ProfileViewController</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> username<span class="token punctuation">)</span>
            <span class="token comment">// 跳转到个人主页...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     3.在模块中通过路由跳转：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// LoginModule/LoginViewController.swift</span>
<span class="token keyword">class</span> <span class="token class-name">LoginViewController</span><span class="token punctuation">:</span> <span class="token class-name">UIViewController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">let</span> router<span class="token punctuation">:</span> <span class="token class-name">RouterProtocol</span>

    <span class="token keyword">init</span><span class="token punctuation">(</span>router<span class="token punctuation">:</span> <span class="token class-name">RouterProtocol</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>router <span class="token operator">=</span> router
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span>nibName<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">,</span> bundle<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">profile</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"JohnDoe"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_199">
     </a>
     优点：
    </h5>
    <ul>
     <li>
      <strong>
       高度解耦
      </strong>
      : 模块之间无直接依赖。
     </li>
     <li>
      <strong>
       灵活性
      </strong>
      : 方便实现页面跳转和模块间通信。
     </li>
    </ul>
    <h5>
     <a id="_203">
     </a>
     缺点：
    </h5>
    <ul>
     <li>
      <strong>
       复杂性
      </strong>
      : 需要定义路由协议和实现路由逻辑。
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="4_Event_Bus_208">
     </a>
     4.
     <strong>
      事件总线（Event Bus）
     </strong>
    </h4>
    <p>
     事件总线是一种全局通信机制，模块可以通过发布和订阅事件进行通信。
    </p>
    <h5>
     <a id="_211">
     </a>
     实现步骤：
    </h5>
    <p>
     1.定义事件总线：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// CommonModule/EventBus.swift</span>
<span class="token keyword">class</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> observers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">Any</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token keyword">func</span> <span class="token function-definition function">subscribe</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> type<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">,</span> observer<span class="token punctuation">:</span> <span class="token attribute atrule">@escaping</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Void</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> type<span class="token punctuation">)</span>
        <span class="token keyword">if</span> observers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{<!-- --></span>
            observers<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        observers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span>append <span class="token punctuation">{<!-- --></span> value <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> value <span class="token operator">=</span> value <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">T</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">publish</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> event<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>
        observers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span>forEach <span class="token punctuation">{<!-- --></span> <span class="token short-argument">$0</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     2.发布事件：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// LoginModule/LoginService.swift</span>
<span class="token keyword">func</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 登录逻辑...</span>
    <span class="token class-name">EventBus</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">UserDidLoginEvent</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> username<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     3.订阅事件：
    </p>
    <pre><code class="prism language-swift"><span class="token comment">// DataModule/DataManager.swift</span>
<span class="token keyword">class</span> <span class="token class-name">DataManager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">EventBus</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">UserDidLoginEvent</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> event <span class="token keyword">in</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"User did login: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">event<span class="token punctuation">.</span>username</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_261">
     </a>
     优点：
    </h5>
    <ul>
     <li>
      <strong>
       全局通信
      </strong>
      : 适合跨模块的全局事件。
     </li>
     <li>
      <strong>
       松耦合
      </strong>
      : 模块之间无直接依赖。
     </li>
    </ul>
    <h5>
     <a id="_265">
     </a>
     缺点：
    </h5>
    <ul>
     <li>
      <strong>
       可读性差
      </strong>
      : 事件发布和订阅分散在代码中，难以追踪。
     </li>
     <li>
      <strong>
       类型不安全
      </strong>
      : 事件类型需要手动转换。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_270">
     </a>
     三、方案对比
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         特性
        </strong>
       </th>
       <th>
        <strong>
         协议抽象
        </strong>
       </th>
       <th>
        <strong>
         依赖注入
        </strong>
       </th>
       <th>
        <strong>
         路由机制
        </strong>
       </th>
       <th>
        <strong>
         事件总线
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         解耦性
        </strong>
       </td>
       <td>
        高（依赖协议）
       </td>
       <td>
        高（依赖容器）
       </td>
       <td>
        高（依赖路由）
       </td>
       <td>
        极高（无直接依赖）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         灵活性
        </strong>
       </td>
       <td>
        中（需定义协议）
       </td>
       <td>
        中（需定义容器）
       </td>
       <td>
        中（需定义路由类型）
       </td>
       <td>
        高（任意事件）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         可读性
        </strong>
       </td>
       <td>
        高（代码结构清晰）
       </td>
       <td>
        高（依赖关系明确）
       </td>
       <td>
        高（路由集中管理）
       </td>
       <td>
        低（事件分散）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         类型安全
        </strong>
       </td>
       <td>
        高（编译时检查）
       </td>
       <td>
        高（依赖关系明确）
       </td>
       <td>
        高（路由类型明确）
       </td>
       <td>
        低（需手动转换类型）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         调试难度
        </strong>
       </td>
       <td>
        低（依赖关系明确）
       </td>
       <td>
        低（依赖关系明确）
       </td>
       <td>
        低（跳转逻辑集中）
       </td>
       <td>
        高（全局事件流复杂）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         适用场景
        </strong>
       </td>
       <td>
        模块间接口明确的功能调用
       </td>
       <td>
        模块间依赖管理
       </td>
       <td>
        页面跳转和简单数据传递
       </td>
       <td>
        跨模块的复杂事件交互
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_283">
     </a>
     四、总结
    </h3>
    <ul>
     <li>
      <strong>
       协议抽象
      </strong>
      ：适合模块间接口明确的功能调用，类型安全且易于测试。
     </li>
     <li>
      <strong>
       依赖注入
      </strong>
      ：适合管理模块间的依赖关系，提升代码的可维护性和可扩展性。
     </li>
     <li>
      <strong>
       路由机制
      </strong>
      ：适合以页面跳转为主的模块交互，集中管理导航逻辑。
     </li>
     <li>
      <strong>
       事件总线
      </strong>
      ：适合跨模块的复杂事件通知，灵活性高但可读性较差。
     </li>
    </ul>
    <p>
     在实际项目中，可以根据需求组合使用这些方案。例如：
    </p>
    <ul>
     <li>
      使用
      <strong>
       协议抽象 + 依赖注入
      </strong>
      管理服务调用。
     </li>
     <li>
      使用
      <strong>
       路由机制
      </strong>
      处理页面跳转。
     </li>
     <li>
      使用
      <strong>
       事件总线
      </strong>
      实现全局状态通知。
     </li>
    </ul>
    <p>
     通过合理选择模块化方案，可以显著提升代码的可维护性和团队的开发效率。
    </p>
    <hr/>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f67616e673534343034333936332f:61727469636c652f64657461696c732f313436323630383532" class_="artid" style="display:none">
 </p>
</div>


