---
layout: post
title: "node基础"
date: 2025-03-12 17:12:58 +0800
description: "本文介绍了 Node.js 中 NPM 的使用，我们先来了解什么是 NPM。允许用户从NPM服务器下载别人编写的第三方包到本地使用。允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。"
keywords: "node基础"
categories: ['未分类']
tags: ['Node']
artid: "145801491"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=145801491
    alt: "node基础"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=145801491
featuredImagePreview: https://bing.ee123.net/img/rand?artid=145801491
cover: https://bing.ee123.net/img/rand?artid=145801491
image: https://bing.ee123.net/img/rand?artid=145801491
img: https://bing.ee123.net/img/rand?artid=145801491
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     node基础
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h4>
     <a id="1NPM__3">
     </a>
     1、NPM 使用介绍
    </h4>
    <p>
     本文介绍了 Node.js 中 NPM 的使用，我们先来了解什么是 NPM。
    </p>
    <p>
     NPM是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：
    </p>
    <ul>
     <li>
      允许用户从NPM服务器下载别人编写的第三方包到本地使用。
     </li>
     <li>
      允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。
     </li>
     <li>
      允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。
     </li>
    </ul>
    <h4>
     <a id="2express_13">
     </a>
     2、express
    </h4>
    <p>
     服务框架
    </p>
    <pre><code>npm install express          # 本地安装
//本地安装，会生成node_modules文件
npm install express -g   # 全局安装
//全局安装，安装在了这个地址，C:\Users\用户\AppData\Roaming\npm
</code></pre>
    <p>
     要改淘宝镜像，安装时
     <a href="https://blog.csdn.net/m0_48300767/article/details/140958703">
      地址failed
     </a>
     ,淘宝镜像可能改了。
    </p>
    <p>
     <strong>
      两种方法
     </strong>
    </p>
    <p>
     <strong>
      1.cnpm命令行工具代替npm
     </strong>
    </p>
    <pre><code>npm install -g cnpm --registry=https://registry.npm.taobao.org
</code></pre>
    <p>
     <strong>
      2.命令行设置将npm地址修改为淘宝镜像源
     </strong>
    </p>
    <pre><code>npm config set registry https://registry.npm.taobao.org
</code></pre>
    <h5>
     <a id="_37">
     </a>
     简单案例
    </h5>
    <pre><code class="prism language-cpp">let express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"这是首页"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"服务器启动："</span><span class="token punctuation">,</span><span class="token char">'http://localhost:8080/'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     然后终端打开，node demo2.js 运行
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/eac28aed00da4e0681043d0357405692.png"/>
    </p>
    <h4>
     <a id="3_55">
     </a>
     3、模块导入与导出
    </h4>
    <pre><code class="prism language-cpp"><span class="token comment">//index1.js</span>
function <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'fn'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

let student <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    username<span class="token operator">:</span><span class="token string">"老陈"</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'student:'</span><span class="token punctuation">,</span>student<span class="token punctuation">.</span>username<span class="token punctuation">)</span>

<span class="token comment">// module.exports = {student,fn}</span>

<span class="token comment">//函数需要导出才能用</span>
exports<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>

</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">//index2.js</span>
<span class="token comment">//绝对路径</span>
let file1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'./index1.js'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'file1'</span><span class="token punctuation">,</span>file1<span class="token punctuation">)</span>  

<span class="token comment">//调用index.js，函数fn</span>
file1<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     效果
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9e1a6b16f6684d7e9db9b4a866d7c82c.png"/>
    </p>
    <h4>
     <a id="4_89">
     </a>
     4、模块路径
    </h4>
    <p>
     node_modules 目录
    </p>
    <pre><code>let express = require('foo/ba')
</code></pre>
    <p>
     NodeJS 定义了一个特殊的 node_modules 目录用于存放模块。例如某个模块的绝对路径是 /home/user/hello.js，在该模块中使用 require(‘foo/bar’) 方式加载模块时，则 NodeJS 依次尝试使用以下路径。
    </p>
    <pre><code> /home/user/node_modules/foo/bar
 /home/node_modules/foo/bar
 /node_modules/foo/bar
</code></pre>
    <p>
     NODE_PATH 环境变量
    </p>
    <p>
     与 PATH 环境变量类似，NodeJS 允许通过 NODE_PATH 环境变量来指定额外的模块搜索路径。NODE_PATH 环境变量中包含一到多个目录路径，路径之间在 Linux 下使用:分隔，在 Windows 下使用;分隔。例如定义了以下 NODE_PATH 环境变量：
    </p>
    <pre><code> NODE_PATH=/home/user/lib:/home/lib
</code></pre>
    <p>
     当使用 require(‘foo/bar’)的方式加载模块时，则 NodeJS 依次尝试以下路径。
    </p>
    <pre><code> /home/user/lib/foo/bar
 /home/lib/foo/bar
</code></pre>
    <h4>
     <a id="5nodejs_115">
     </a>
     5、nodejs包
    </h4>
    <p>
     包结构
    </p>
    <p>
     包实际上是一个存档文件，即一个目录直接打包为.zip或tar.gz格式的文件，安装后解压还原为目录。完全符合CommonJS规范的包目录应该 包含如下这些文件。
     <br/>
     1、package.json：包描述文件
     <br/>
     2、bin：用于存放可执行二进制文件的目录
     <br/>
     3、lib：用于存放JavaScript代码的目录
     <br/>
     4、doc：用于存放文档的目录
     <br/>
     5、test：用于存放单元测试用例的代码
     <br/>
     node_modules里面的express
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9a2864e595c5410795ce45e494e2d9e6.png"/>
    </p>
    <p>
     npm init,初始化配置
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7e0c3e0dc70d4b229264e25ab86261c0.png">
      <br/>
      翻译
      <br/>
      包的名称
      <br/>
      包的版本
      <br/>
      包的描述
      <br/>
      包的执行文件
     </img>
    </p>
    <p>
     yes，确认
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7491a7d632c94712ba8a724009ea8ed7.png">
      <br/>
      然后就能在package.json看到这些内容
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9257e4fddca2467a8cc37674ee0f5223.png"/>
     </img>
    </p>
    <h4>
     <a id="6_141">
     </a>
     6、文件同步写入
    </h4>
    <h5>
     <a id="openSync_143">
     </a>
     同步openSync
    </h5>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">// 同步打开文件</span>
let fd <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">openSync</span><span class="token punctuation">(</span><span class="token char">'text1.html'</span><span class="token punctuation">,</span><span class="token char">'w'</span><span class="token punctuation">)</span>

<span class="token comment">// 写入内容</span>
let str <span class="token operator">=</span> <span class="token string">"&lt;h1&gt;你好！&lt;/h1&gt;"</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 退出文件  </span>
fs<span class="token punctuation">.</span><span class="token function">closeSync</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
</code></pre>
    <p>
     然后就会创建一个html文件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/22d5db509b58487897ff6ab1b9167130.png"/>
    </p>
    <h4>
     <a id="7_159">
     </a>
     7、文件异步写入
    </h4>
    <h5>
     <a id="open_160">
     </a>
     异步open
    </h5>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token char">'text2.txt'</span><span class="token punctuation">,</span><span class="token char">'w'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"文件打开"</span><span class="token punctuation">)</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token char">'你好'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"写入完成！"</span><span class="token punctuation">)</span>
            fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"文件关闭完成"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'123'</span><span class="token punctuation">)</span>

<span class="token comment">// 同步：点汉堡-》制作汉堡-》汉堡制作好之后，你拿走了。-》下一位用户继续点汉堡</span>
<span class="token comment">// 异步：点汉堡-》旁边等候-&gt;下一位用户继续点汉堡-》旁边等候。汉堡好了之后，会自动叫你领取。</span>
</code></pre>
    <p>
     异步函数，会先输出123，再执行其他函数
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/96836512ce2447d49aec11d232fccfe6.png"/>
    </p>
    <h4>
     <a id="8createWriteStream_185">
     </a>
     8、文件流写入，createWriteStream
    </h4>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建写入流</span>
let ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token char">'text3.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听通道打开</span>
ws<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token char">'open'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"通道打开"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token char">'你吃饭了吗1？'</span><span class="token punctuation">)</span>
    ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token char">'你吃饭了吗2？'</span><span class="token punctuation">)</span>
    ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token char">'你吃饭了吗3？'</span><span class="token punctuation">)</span> 
    <span class="token comment">// 写入结束</span>
    ws<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听通道关闭,once表示监听一次</span>
ws<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token char">'close'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'通道关闭'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     text文件
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/59714b240b674e8ba9856cbb8ad7c366.png"/>
    </p>
    <h4>
     <a id="9readFile_210">
     </a>
     9、文件读取，readFile
    </h4>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token char">'text1.html'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//toString()转化字符串，如果直接输出data，默认时二进制数据</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'err'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'读取数据'</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="readFilewriteFile_226">
     </a>
     读取文件，然后复制后替换其他文件，readFile读取，writeFile写入
    </h5>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token char">'大炮.png'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token comment">//复制大炮，改名字为小炮</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token char">'小炮.png'</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'图片读取写入成功'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'err'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'err'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="10_246">
     </a>
     10、文件的读取和写入流以及管道
    </h4>
    <h5>
     <a id="_247">
     </a>
     读取图片，然后重命名再写入图片
    </h5>
    <h5>
     <a id="createReadStream_248">
     </a>
     createReadStream
    </h5>
    <p>
     读取
    </p>
    <h5>
     <a id="createWriteStream_250">
     </a>
     createWriteStream
    </h5>
    <p>
     写入
    </p>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

let rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token char">'大炮.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
let ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token char">'中泡.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听读取流打开</span>
rs<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token char">'open'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'监听读取流'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听读取流关闭</span>
rs<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token char">'close'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'读取流关闭'</span><span class="token punctuation">)</span>
    <span class="token comment">// 在 rs.once('close') 中调用 ws.end() 会触发写入流的关闭，因为 ws.end() 显式地关闭了写入流。</span>
    <span class="token comment">// ws.end()</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 监听写入流打开</span>
ws<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token char">'open'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'监听写入流'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听读写入关闭</span>
ws<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token char">'close'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'写入流关闭'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听到数据data，将读取的数据通过写入流写入（将大炮的图片复制，再改名为重炮）</span>
rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="_286">
     </a>
     管道（简单化，一样效果）
    </h5>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

let rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token char">'大炮.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
let ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token char">'重炮.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建管道，将读取流通过管道流出</span>
rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="11_297">
     </a>
     11、删除文件和读取目录下文件
    </h4>
    <h5>
     <a id="unlink_298">
     </a>
     unlink
    </h5>
    <p>
     删除
    </p>
    <h5>
     <a id="readdir_300">
     </a>
     readdir
    </h5>
    <p>
     读取
    </p>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 删除文件</span>
<span class="token comment">// fs.unlink('text1.html',(err)=&gt;{<!-- --></span>
<span class="token comment">//     if(err){<!-- --></span>
<span class="token comment">//         console.log(err)</span>
<span class="token comment">//     }else{<!-- --></span>
<span class="token comment">//         console.log('删除文件成功')</span>
<span class="token comment">//     }</span>
<span class="token comment">// })</span>

<span class="token comment">// 读取目录下的所有文件</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token char">'./'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>files<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre>
    <h4>
     <a id="12_325">
     </a>
     12、创建删除目录、递归删除非空目录
    </h4>
    <h5>
     <a id="mkdir_326">
     </a>
     mkdir
    </h5>
    <p>
     创建
    </p>
    <h5>
     <a id="rmdir_328">
     </a>
     rmdir
    </h5>
    <p>
     删除
    </p>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建文件夹</span>
<span class="token comment">// fs.mkdir('./img',(err)=&gt;{<!-- --></span>
<span class="token comment">//     if(err){<!-- --></span>
<span class="token comment">//         console.log(err)</span>
<span class="token comment">//     }else{<!-- --></span>
<span class="token comment">//         console.log('创建成功')</span>
<span class="token comment">//     }</span>
   
<span class="token comment">// })</span>

<span class="token comment">// 删除文件夹</span>
fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token char">'./img'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'文件夹删除成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h5>
     <a id="_352">
     </a>
     非空目录
    </h5>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
function <span class="token function">delDir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 读取目录</span>
    var filesArr <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 拿到目录的文件，然后循环</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>var i in filesArr<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 把目录拼接出来</span>
        var filePath <span class="token operator">=</span> dirPath<span class="token operator">+</span><span class="token char">'/'</span><span class="token operator">+</span>filesArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取文件信息</span>
        var stat <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断是文件还是目录，node的语法</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 删除</span>
            fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 递归调用自己，再循环</span>
            <span class="token function">delDir</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 删除空目录</span>
    fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">delDir</span><span class="token punctuation">(</span><span class="token char">'./img'</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="13node_381">
     </a>
     13、node事件触发
    </h4>
    <p>
     创建文件夹后，触发事件
    </p>
    <pre><code class="prism language-cpp">let fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'fs'</span><span class="token punctuation">)</span>
let events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'events'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建事件对象</span>
var eventLog <span class="token operator">=</span> <span class="token keyword">new</span> events<span class="token punctuation">.</span><span class="token function">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 监听事件</span>
eventLog<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'lcMkDir'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'创建目录事件触发1'</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
eventLog<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'lcMkDir'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'创建目录事件触发2'</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
eventLog<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'lcMkDir'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'创建目录事件触发3'</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 触发事件</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'over'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建文件夹</span>
fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token char">'./img'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'创建成功'</span><span class="token punctuation">)</span>
        <span class="token comment">//传参，msg</span>
        eventLog<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"lcMkDir"</span><span class="token punctuation">,</span><span class="token string">"你好"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="14buffer_413">
     </a>
     14、buffer缓冲区
    </h4>
    <p>
     多用于人工智能
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// 将字符串放置到缓冲区</span>
let b1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token char">'10'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b1<span class="token punctuation">)</span>
<span class="token comment">//转化二级制</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 初始化缓冲区,创建一个大小为10个字节的缓冲区</span>
<span class="token comment">// 保证新创建的缓冲区数据是不会包含旧的数据</span>
let b2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span>

<span class="token comment">// 不会重置数据,不太安全，需要谨慎使用</span>
let b3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b3<span class="token punctuation">)</span>

b3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b3<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="15exec_435">
     </a>
     15、多进程之exec
    </h4>
    <p>
     通过main1.js，打开index1.js
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//index1.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'进程：'</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"执行。"</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">//main1.js</span>
<span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>var i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// stdout子进程的输出结果</span>
    <span class="token comment">// stderr子进程输出的错误</span>
    var workerProcess <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token char">'node index1.js '</span><span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">,</span><span class="token constant">stderr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'stdout:'</span><span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'stderr:'</span><span class="token punctuation">,</span><span class="token constant">stderr</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    workerProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'exit'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'子进程已退出,退出码：'</span><span class="token operator">+</span>code<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ebd3f0eaf0d144d2bfc81f402c8906dd.png"/>
    </p>
    <h4>
     <a id="16forkspawn_462">
     </a>
     16、多进程之fork与spawn
    </h4>
    <h5>
     <a id="spawn_463">
     </a>
     spawn
    </h5>
    <pre><code class="prism language-cpp"><span class="token comment">//index1.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'进程：'</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"执行。"</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-cpp"><span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>var i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// stdout子进程的输出结果</span>
    <span class="token comment">// stderr子进程输出的错误</span>
    var workerProcess <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token char">'node'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token char">'index1.js'</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听数据</span>
    workerProcess<span class="token punctuation">.</span><span class="token constant">stdout</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'data：'</span><span class="token operator">+</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听错误</span>
    workerProcess<span class="token punctuation">.</span><span class="token constant">stderr</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'data'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'err：'</span><span class="token operator">+</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 监听关闭</span>
    workerProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'close'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'子进程已退出,退出码：'</span><span class="token operator">+</span>code<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d38abff8013742a083c9fd4eaa1f82e9.png"/>
    </p>
    <h5>
     <a id="fork_491">
     </a>
     fork
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>var i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// stdout子进程的输出结果</span>
    <span class="token comment">// stderr子进程输出的错误</span>
    var workerProcess <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token char">'index1.js'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    workerProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'close'</span><span class="token punctuation">,</span><span class="token function">function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'子进程已退出,退出码：'</span><span class="token operator">+</span>code<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1e63b68abb084f0bbdd6989921a48a90.png"/>
    </p>
    <h4>
     <a id="17nodepath_506">
     </a>
     17、node模块path
    </h4>
    <pre><code class="prism language-cpp">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token comment">//当前正在执行的脚本的文件名称</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token comment">//当前正在执行脚本的目录名称</span>

let path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'path'</span><span class="token punctuation">)</span>
<span class="token comment">//文件路径的例子</span>
let strPath <span class="token operator">=</span> 'E<span class="token operator">:</span><span class="token operator">/</span>share<span class="token operator">/</span>Node<span class="token operator">/</span>node<span class="token operator">/</span>代码<span class="token operator">/</span>demo6<span class="token operator">/</span>index1<span class="token punctuation">.</span>png<span class="token number">'</span>
<span class="token comment">// 获取扩展名</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>strPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//.png</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//.js</span>

<span class="token comment">// 获取文件名称</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>strPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//index1.png</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//index1.js</span>

<span class="token comment">// 获取目录名称</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>strPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//E:/share/Node/node/代码/demo6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//C:\Users\VAEVBWERV\Documents\企业级项目代码\node\代码\demo6</span>

<span class="token comment">// 路径解析和规范化路径</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span>strPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//E:\share\Node\node\代码\demo6\index1.png   </span>

<span class="token comment">// 路径合并</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> __dirname<span class="token operator">+</span><span class="token char">'/abc.png'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token comment">//C:\Users\VAEVBWERV\Documents\企业级项目代码\node\代码\demo6\abc.png</span>

<span class="token comment">// 获取绝对路径的合并</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span> __dirname<span class="token operator">+</span><span class="token char">'/abc.png'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token comment">//C:\Users\VAEVBWERV\Documents\企业级项目代码\node\代码\demo6\abc.png</span>
</code></pre>
    <h4>
     <a id="18_536">
     </a>
     18、网络通信
    </h4>
    <p>
     协议是网络中计算机或设备之间进行通信的一系列规则的集合。常用协议有IP、TCP、HTTP、POP3、SMTP等。
     <br/>
     <img alt="img" src="https://i-blog.csdnimg.cn/img_convert/f3235672c2d83461e8d8fd8c8d0f933f.jpeg"/>
    </p>
    <h6>
     <a id="GetCharlesrequest_540">
     </a>
     Get请求例子，使用Charles抓取的request：
    </h6>
    <p>
     #
    </p>
    <pre><code>GET /562f25980001b1b106000338.jpg HTTP/1.1
Host    img.mukewang.com
User-Agent    Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36
Accept    image/webp,image/*,*/*;q=0.8
Referer    http://www.imooc.com/
Accept-Encoding    gzip, deflate, sdch
Accept-Language    zh-CN,zh;q=0.8
</code></pre>
    <h6>
     <a id="HTTP_554">
     </a>
     第一部分：请求行，用来说明请求类型,要访问的资源以及所使用的HTTP版本.
    </h6>
    <p>
     GET说明请求类型为GET,[/562f25980001b1b106000338.jpg]为要访问的资源，该行的最后一部分说明使用的是HTTP1.1版本。
    </p>
    <h6>
     <a id="_558">
     </a>
     第二部分：请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息
    </h6>
    <p>
     从第二行起为请求头部，HOST将指出请求的目的地.User-Agent,服务器端和客户端脚本都能访问它,它是浏览器类型检测逻辑的重要基础.该信息由你的浏览器来定义,并且在每个请求中自动发送等等
    </p>
    <h6>
     <a id="_562">
     </a>
     第三部分：空行，请求头部后面的空行是必须的
    </h6>
    <p>
     即使第四部分的请求数据为空，也必须有空行。
    </p>
    <h6>
     <a id="_566">
     </a>
     第四部分：请求数据也叫主体，可以添加任意的其他数据。
    </h6>
    <p>
     这个例子的请求数据为空。
    </p>
    <h6>
     <a id="POSTCharlesrequest_570">
     </a>
     POST请求例子，使用Charles抓取的request：
    </h6>
    <p>
     #
    </p>
    <pre><code>POST / HTTP1.1
Host:www.wrox.com
User-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)
Content-Type:application/x-www-form-urlencoded
Content-Length:40
Connection: Keep-Alive

name=Professional%20Ajax&amp;publisher=Wiley
</code></pre>
    <p>
     第一部分：请求行，第一行明了是post请求，以及http1.1版本。 第二部分：请求头部，第二行至第六行。 第三部分：空行，第七行的空行。 第四部分：请求数据，第八行。
    </p>
    <h4>
     <a id="19HTTP_587">
     </a>
     19、HTTP模块搭建简易服务器
    </h4>
    <p>
     通过地址返回内容
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// 导入node的HTTP模块</span>
let http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建服务器实例</span>
let server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 服务器监听请求数据</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token char">'index'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token char">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token char">'login page'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token char">'404 not found'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 绑定监听的端口号</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token char">'服务器启动:'</span><span class="token punctuation">,</span><span class="token string">"http://127.0.0.1:3000"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="20express_613">
     </a>
     20、express实现静态服务器和自定义接口
    </h4>
    <p>
     当你在浏览器中访问 http://127.0.0.1:3000 时，服务器会自动打开 index.html 页面，这是因为 Express 的静态文件服务 (express.static) 默认会寻找并返回 index.html 文件作为根路径 (/) 的响应。
    </p>
    <p>
     具体原因
     <br/>
     静态文件服务：
     <br/>
     在你的代码中，app.use(express.static(“static”)) 将 static 目录设置为静态资源目录。Express 会将该目录下的文件作为静态资源提供给客户端。
    </p>
    <p>
     默认文件：
     <br/>
     当访问根路径 / 时，Express 会默认查找 index.html 文件并返回。这是因为 index.html 是静态文件服务的默认入口文件。
    </p>
    <p>
     文件结构：
     <br/>
     假设你的项目目录结构如下：
    </p>
    <p>
     复制
     <br/>
     project/
     <br/>
     ├── app.js
     <br/>
     └── static/
     <br/>
     ├── index.html
     <br/>
     └── css/
     <br/>
     └── style.css
     <br/>
     当你访问 http://127.0.0.1:3000 时，Express 会在 static 目录下查找 index.html 文件并返回。
    </p>
    <p>
     浏览器行为：
     <br/>
     浏览器在访问根路径时，默认会请求 /，而 Express 会返回 index.html 文件，因此页面会自动加载。
    </p>
    <p>
     node app.js打开
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">//app.js</span>
<span class="token comment">// 导入express框架</span>
let express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'express'</span><span class="token punctuation">)</span>

<span class="token comment">// 实例化服务器应用</span>
let app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">// 实现静态服务器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">"static"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 

  
<span class="token comment">// 实现自定义接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'/api/userlist'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 请求的信息：req对象</span>
    <span class="token comment">// 响应的操作和信息：res对象</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        state<span class="token operator">:</span><span class="token string">"ok"</span><span class="token punctuation">,</span>
        userList<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>username<span class="token operator">:</span><span class="token string">"小明"</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">"男"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>username<span class="token operator">:</span><span class="token string">"小黑"</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">"男"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>username<span class="token operator">:</span><span class="token string">"小白"</span><span class="token punctuation">,</span>sex<span class="token operator">:</span><span class="token string">"女"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"服务器启动"</span><span class="token punctuation">,</span><span class="token string">"http://127.0.0.1:3000"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
    <pre><code class="prism language-cpp"><span class="token comment">//index.html</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"css/style.css"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bg"</span><span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token char">'/api/userlist'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>
            
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

            res<span class="token punctuation">.</span>userList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>

                let newDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'div'</span><span class="token punctuation">)</span>

                newDiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> item<span class="token punctuation">.</span>username<span class="token operator">+</span><span class="token string">"的性别是"</span><span class="token operator">+</span>item<span class="token punctuation">.</span>sex

                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newDiv<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ed3430715aa14fb8aa7c212526c6258f.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f6c69616f6a75616a756e2f:61727469636c652f64657461696c732f313435383031343931" class_="artid" style="display:none">
 </p>
</div>


