---
arturl_encode: "68747470733a2f2f:626c6f672e6373646e2e6e65742f5a5f6f696f69686f69692f:61727469636c652f64657461696c732f313436303530373337"
layout: post
title: "C20-中使用括号进行聚合初始化新特性与实践指南"
date: 2025-03-06 00:00:00 +0800
description: "聚合初始化是一种使用大括号{}或圆括号()对聚合类型（如数组、结构体、类等）进行初始化的方法。没有用户定义的构造函数。没有私有或受保护的非静态数据成员。没有虚函数。没有基类。int x;int y;在 C++20 之前，聚合初始化只能使用大括号{}// 使用大括号初始化然而，C++20 引入了使用圆括号()进行聚合初始化的能力，这使得语法更加灵活。C++20 对聚合初始化的扩展，尤其是引入圆括号初始化和指定初始化器，为开发者提供了更灵活、更直观的初始化方式。"
keywords: "C++20 中使用括号进行聚合初始化：新特性与实践指南"
categories: ['C']
tags: ['C']
artid: "146050737"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146050737
    alt: "C20-中使用括号进行聚合初始化新特性与实践指南"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146050737
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146050737
cover: https://bing.ee123.net/img/rand?artid=146050737
image: https://bing.ee123.net/img/rand?artid=146050737
img: https://bing.ee123.net/img/rand?artid=146050737
---

# C++20 中使用括号进行聚合初始化：新特性与实践指南

![](https://i-blog.csdnimg.cn/img_convert/7d3f21a613536dfbff3dc4614d8536b6.png)

  
在 C++20 中，聚合初始化（Aggregate Initialization）得到了进一步的扩展和改进，尤其是在使用圆括号进行初始化时。这一特性不仅提升了代码的灵活性，还为开发者提供了更简洁的初始化方式。本文将详细介绍 C++20 中聚合初始化的新特性，以及如何在实际开发中使用括号进行聚合初始化。

### 1. 聚合初始化简介

聚合初始化是一种使用大括号
`{}`
或圆括号
`()`
对聚合类型（如数组、结构体、类等）进行初始化的方法。聚合类型必须满足以下条件：

* 没有用户定义的构造函数。
* 没有私有或受保护的非静态数据成员。
* 没有虚函数。
* 没有基类。

例如，以下结构体是一个典型的聚合类型：

```cpp
struct Point {
    int x;
    int y;
};

```

在 C++20 之前，聚合初始化只能使用大括号
`{}`
，例如：

```cpp
Point p = {1, 2}; // 使用大括号初始化

```

然而，C++20 引入了使用圆括号
`()`
进行聚合初始化的能力，这使得语法更加灵活。

### 2. C++20 中的括号聚合初始化

C++20 允许使用圆括号进行聚合初始化，这在某些场景下可以减少代码的复杂性。例如：

```cpp
Point p(1, 2); // 使用圆括号初始化

```

这种初始化方式与大括号初始化的效果相同，但语法上更加简洁。

#### 2.1 指定初始化器（Designated Initializers）

C++20 还引入了指定初始化器（Designated Initializers），允许开发者通过成员名称显式指定初始化值。这种方式不仅提高了代码的可读性，还避免了因成员顺序错误而导致的问题。

例如：

```cpp
struct AudioInfo {
    int channel_num;
    int channel_layout;
    int sample_rate;
    int frame_count;
    int bit_depth;
};

AudioInfo info{.channel_num = 1, .bit_depth = 16};

```

在上述代码中，
`info`
的
`channel_num`
和
`bit_depth`
被显式初始化，而其他成员将使用默认值（如果未提供默认值，则初始化为零）。

#### 2.2 嵌套聚合初始化

对于嵌套的聚合类型，C++20 支持递归地使用指定初始化器。例如：

```cpp
struct Point {
    int x;
    int y;
};

struct Color {
    int r;
    int g;
    int b;
};

struct ComplexPoint {
    Point pt;
    Color color;
};

ComplexPoint cp{
   .pt = {.x = 66, .y = 99},
   .color = {.r = 255, .g = 0, .b = 0}
};

```

这种方式使得嵌套结构的初始化更加直观。

### 3. 使用括号初始化数组

C++20 还允许使用圆括号初始化数组，这在某些情况下可以减少代码的冗余。例如：

```cpp
int arr[3] = (1, 2, 3); // 使用圆括号初始化数组

```

这种方式与大括号初始化的效果相同，但语法上更加简洁。

### 4. 注意事项

尽管 C++20 提供了更灵活的聚合初始化方式，但在使用时仍需注意以下几点：

1. **窄化转换**
   ：在聚合初始化中，C++20 允许窄化转换（如从
   `double`
   转换为
   `int`
   ），但这种转换可能导致数据丢失。
2. **成员顺序**
   ：即使使用指定初始化器，成员的初始化顺序仍需与声明顺序一致。
3. **联合体初始化**
   ：对于联合体，只能为其一个成员提供初始化值。

### 5. 实际应用场景

C++20 的聚合初始化特性在以下场景中特别有用：

* **数据类初始化**
  ：对于仅包含数据成员的类或结构体，聚合初始化提供了一种简洁的初始化方式。
* **嵌套配置类**
  ：在处理多层嵌套的配置结构时，指定初始化器可以显著提高代码的可读性。
* **数组初始化**
  ：使用圆括号初始化数组可以减少代码的复杂性。

### 6. 总结

C++20 对聚合初始化的扩展，尤其是引入圆括号初始化和指定初始化器，为开发者提供了更灵活、更直观的初始化方式。这些特性不仅简化了代码，还减少了因成员顺序错误而导致的潜在问题。然而，在使用时仍需注意窄化转换和成员顺序等限制。

通过合理利用 C++20 的聚合初始化特性，开发者可以编写出更加简洁、高效且易于维护的代码。