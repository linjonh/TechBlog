---
layout: post
title: "三分钟掌握视频剪辑-在-Rust-中优雅地集成-FFmpeg"
date: 2025-03-15 12:00:05 +0800
description: "在当今的短视频时代，高效的视频剪辑已成为内容创作者和开发者的迫切需求。无论是裁剪视频开头结尾、提取高光时刻，还是制作 GIF、去除广告，剪辑都是必不可少的一环。"
keywords: "三分钟掌握视频剪辑 | 在 Rust 中优雅地集成 FFmpeg"
categories: ['未分类']
tags: ['音频', '音视频', '视频', 'Rust', 'Ffmpeg']
artid: "146277196"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146277196
    alt: "三分钟掌握视频剪辑-在-Rust-中优雅地集成-FFmpeg"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146277196
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146277196
cover: https://bing.ee123.net/img/rand?artid=146277196
image: https://bing.ee123.net/img/rand?artid=146277196
img: https://bing.ee123.net/img/rand?artid=146277196
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     三分钟掌握视频剪辑 | 在 Rust 中优雅地集成 FFmpeg
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     <strong>
      前言
     </strong>
    </h3>
    <p>
     在当今的短视频时代，
     <strong>
      高效的视频剪辑
     </strong>
     已成为内容创作者和开发者的迫切需求。无论是裁剪视频开头结尾、提取高光时刻，还是制作 GIF、去除广告，剪辑都是必不可少的一环。
    </p>
    <p>
     然而，
     <strong>
      批量处理大量视频
     </strong>
     并非易事，常见的挑战包括：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        手动剪辑
       </strong>
       ：费时费力，效率低下。
      </p>
     </li>
     <li>
      <p>
       <strong>
        使用专业软件（如 Premiere、After Effects）
       </strong>
       ：适合专业剪辑，但自动化批量处理难以实现。
      </p>
     </li>
     <li>
      <p>
       <strong>
        FFmpeg 命令行
       </strong>
       ：功能强大，但参数复杂，容易出错。
      </p>
     </li>
    </ul>
    <p>
     对于 Rust 开发者而言，如何在程序中
     <strong>
      优雅地实现视频剪辑
     </strong>
     ，以满足自动化和高效处理的需求？
    </p>
    <h3>
     <a id="Rust__14">
     </a>
     <strong>
      Rust 中的视频剪辑挑战
     </strong>
    </h3>
    <p>
     FFmpeg 是一个功能强大的多媒体处理工具，广泛应用于视频剪辑、格式转换等领域。然而，直接在 Rust 中调用 FFmpeg 的 C 语言 API 存在以下问题：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        复杂性
       </strong>
       ：需要深入理解 FFmpeg 的底层实现和参数配置，学习成本高。
      </p>
     </li>
     <li>
      <p>
       <strong>
        内存管理
       </strong>
       ：直接使用 C 语言 API，容易引发内存泄漏、非法访问等问题，影响程序稳定性。
      </p>
     </li>
     <li>
      <p>
       <strong>
        开发效率
       </strong>
       ：复杂的接口和繁琐的配置，可能降低开发效率，增加出错风险。
      </p>
     </li>
    </ul>
    <h3>
     <a id="_Rust__FFmpeg_24">
     </a>
     <strong>
      解决方案：在 Rust 中优雅地使用 FFmpeg
     </strong>
    </h3>
    <p>
     为了解决上述问题，Rust 社区提供了多种封装库，使开发者能够更简洁、安全地使用 FFmpeg。例如，
     <strong>
      <code>
       ez-ffmpeg
      </code>
     </strong>
     库通过 FFI 调用 FFmpeg 的底层 C 代码，为 Rust 开发者提供了一个安全且符合人体工学的接口。该库的设计目标是简化 FFmpeg 的使用，避免直接操作复杂的原生 API，从而降低开发难度，提高开发效率。
    </p>
    <h3>
     <a id="_Rust__28">
     </a>
     <strong>
      快速上手：用 Rust 剪辑视频片段
     </strong>
    </h3>
    <p>
     假设你有一个
     <code>
      test.mp4
     </code>
     ，想从
     <strong>
      第 5 秒开始
     </strong>
     提取
     <strong>
      3 秒
     </strong>
     的片段，生成
     <code>
      output.mp4
     </code>
     ，可以按照以下步骤进行：
    </p>
    <h4>
     <a id="1__FFmpeg_32">
     </a>
     <strong>
      1. 安装 FFmpeg
     </strong>
    </h4>
    <p>
     如果你的环境尚未安装 FFmpeg，可以按以下方式安装：
    </p>
    <h5>
     <a id="macOS_36">
     </a>
     macOS：
    </h5>
    <pre><code class="prism language-bash">brew <span class="token function">install</span> ffmpeg
</code></pre>
    <h5>
     <a id="Windows_42">
     </a>
     Windows：
    </h5>
    <pre><code class="prism language-bash"><span class="token function">vcpkg</span> <span class="token function">install</span> ffmpeg
<span class="token comment"># 如果是第一次安装 vcpkg，还需设置环境变量 VCPKG_ROOT</span>
</code></pre>
    <h4>
     <a id="2__Rust__49">
     </a>
     <strong>
      2. 添加 Rust 依赖
     </strong>
    </h4>
    <p>
     在
     <code>
      Cargo.toml
     </code>
     中引入
     <code>
      ez-ffmpeg
     </code>
     ：
    </p>
    <pre><code class="prism language-toml">[dependencies]
ez-ffmpeg = "*"
</code></pre>
    <h4>
     <a id="3__58">
     </a>
     <strong>
      3. 编写并运行代码
     </strong>
    </h4>
    <pre><code class="prism language-rust"><span class="token keyword">use</span> <span class="token namespace">ez_ffmpeg<span class="token punctuation">::</span></span><span class="token punctuation">{<!-- --></span><span class="token class-name">FfmpegContext</span><span class="token punctuation">,</span> <span class="token class-name">Input</span><span class="token punctuation">,</span> <span class="token class-name">Output</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建一个 FFmpeg 上下文，从第 5 秒开始剪辑 3 秒</span>
    <span class="token class-name">FfmpegContext</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token class-name">Input</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test.mp4"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">set_start_time_us</span><span class="token punctuation">(</span><span class="token number">5_000_000</span><span class="token punctuation">)</span> <span class="token comment">// 从 5 秒开始（FFmpeg 以微秒为单位）</span>
            <span class="token punctuation">.</span><span class="token function">set_recording_time_us</span><span class="token punctuation">(</span><span class="token number">3_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 录制 3 秒</span>
        <span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"output.mp4"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
        <span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_77">
     </a>
     <strong>
      代码解析
     </strong>
    </h3>
    <p>
     这段代码的主要步骤包括：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        加载输入视频
       </strong>
      </p>
      <pre><code class="prism language-rust"><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token class-name">Input</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test.mp4"</span><span class="token punctuation">)</span>
</code></pre>
      <p>
       这里的
       <code>
        test.mp4
       </code>
       是需要剪辑的原始视频。
      </p>
     </li>
     <li>
      <p>
       <strong>
        设置剪辑时间
       </strong>
      </p>
      <pre><code class="prism language-rust"><span class="token punctuation">.</span><span class="token function">set_start_time_us</span><span class="token punctuation">(</span><span class="token number">5_000_000</span><span class="token punctuation">)</span> <span class="token comment">// 从 5 秒开始</span>
<span class="token punctuation">.</span><span class="token function">set_recording_time_us</span><span class="token punctuation">(</span><span class="token number">3_000_000</span><span class="token punctuation">)</span> <span class="token comment">// 录制 3 秒</span>
</code></pre>
      <ul>
       <li>
        <p>
         <code>
          set_start_time_us(5_000_000)
         </code>
         ：从
         <strong>
          第 5 秒
         </strong>
         开始剪辑。
        </p>
       </li>
       <li>
        <p>
         <code>
          set_recording_time_us(3_000_000)
         </code>
         ：剪辑
         <strong>
          3 秒
         </strong>
         的内容。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        指定输出文件
       </strong>
      </p>
      <pre><code class="prism language-rust"><span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"output.mp4"</span><span class="token punctuation">)</span>
</code></pre>
      <ul>
       <li>
        处理后的视频会保存在
        <code>
         output.mp4
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        启动并等待剪辑完成
       </strong>
      </p>
      <pre><code class="prism language-rust"><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre>
      <ul>
       <li>
        <p>
         <strong>
          构建
         </strong>
         FFmpeg 任务。
        </p>
       </li>
       <li>
        <p>
         <strong>
          启动剪辑
         </strong>
         过程。
        </p>
       </li>
       <li>
        <p>
         <strong>
          等待执行完成
         </strong>
         。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_120">
     </a>
     <strong>
      更多剪辑场景
     </strong>
    </h3>
    <h4>
     <a id="1__10__122">
     </a>
     <strong>
      1. 只剪辑视频的前 10 秒
     </strong>
    </h4>
    <p>
     如果你只想
     <strong>
      保留视频的前 10 秒
     </strong>
     ，可以这样写：
    </p>
    <pre><code class="prism language-rust"><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token class-name">Input</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set_recording_time_us</span><span class="token punctuation">(</span><span class="token number">10_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     这会生成一个
     <strong>
      只有 10 秒
     </strong>
     的
     <code>
      output.mp4
     </code>
     。
    </p>
    <h4>
     <a id="2__10__132">
     </a>
     <strong>
      2. 从 10 秒开始，一直剪到视频结束
     </strong>
    </h4>
    <pre><code class="prism language-rust"><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token class-name">Input</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set_start_time_us</span><span class="token punctuation">(</span><span class="token number">10_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     这会剪掉
     <strong>
      前 10 秒
     </strong>
     ，然后保存剩余部分。
    </p>
    <h4>
     <a id="3__GIF_140">
     </a>
     <strong>
      3. 剪切成 GIF
     </strong>
    </h4>
    <p>
     如果你想
     <strong>
      把剪辑后的视频转换成 GIF
     </strong>
     ，只需修改输出格式：
    </p>
    <pre><code class="prism language-rust"><span class="token class-name">FfmpegContext</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token class-name">Input</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test.mp4"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">set_start_time_us</span><span class="token punctuation">(</span><span class="token number">5_000_000</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">set_recording_time_us</span><span class="token punctuation">(</span><span class="token number">3_000_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"output.gif"</span><span class="token punctuation">)</span> <span class="token comment">// 直接输出 GIF</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     这样，
     <code>
      output.gif
     </code>
     就会生成一个
     <strong>
      3 秒长的 GIF 动图
     </strong>
     。
    </p>
    <h3>
     <a id="_157">
     </a>
     <strong>
      总结
     </strong>
    </h3>
    <p>
     通过在 Rust 中使用类似
     <code>
      ez-ffmpeg
     </code>
     的封装库，开发者可以：
    </p>
    <ul>
     <li>
      <p>
       <strong>
        简化操作
       </strong>
       ：通过链式调用，几行代码即可完成视频剪辑任务。
      </p>
     </li>
     <li>
      <p>
       <strong>
        确保安全
       </strong>
       ：Rust 的内存安全特性，避免了直接使用 C 语言 API 时可能出现的内存泄漏等问题。
      </p>
     </li>
     <li>
      <p>
       <strong>
        提高效率
       </strong>
       ：专注于业务逻辑，无需深入了解 FFmpeg 的复杂参数配置。
      </p>
     </li>
    </ul>
    <p>
     如果你正在开发与短视频、直播剪辑、内容生成等相关的 Rust 应用，利用
     <code>
      ez-ffmpeg
     </code>
     将使你事半功倍。
    </p>
    <p>
     🔗
     <strong>
      开源项目地址
     </strong>
     ：
     <a href="https://github.com/YeautyYE/ez-ffmpeg">
      ez-ffmpeg
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f5965617574792f:61727469636c652f64657461696c732f313436323737313936" class_="artid" style="display:none">
 </p>
</div>


