---
layout: post
title: "CQt-æ§½å‡½æ•°æ”¶ä¸åˆ°ä¿¡å·é—®é¢˜ä¿¡å·çš„æ³¨å†Œ"
date: 2025-03-14 13:02:32 +0800
description: "å¦‚æœä¿¡å·å‚æ•°æ˜¯ã€‚"
keywords: "[C++&Qt] æ§½å‡½æ•°æ”¶ä¸åˆ°ä¿¡å·é—®é¢˜ï¼ˆä¿¡å·çš„æ³¨å†Œï¼‰"
categories: ['Qt', 'Gui']
tags: ['æ•°æ®åº“', 'Qt', 'C']
artid: "146248443"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146248443
    alt: "CQt-æ§½å‡½æ•°æ”¶ä¸åˆ°ä¿¡å·é—®é¢˜ä¿¡å·çš„æ³¨å†Œ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146248443
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146248443
cover: https://bing.ee123.net/img/rand?artid=146248443
image: https://bing.ee123.net/img/rand?artid=146248443
img: https://bing.ee123.net/img/rand?artid=146248443
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [C++&amp;Qt] æ§½å‡½æ•°æ”¶ä¸åˆ°ä¿¡å·é—®é¢˜ï¼ˆä¿¡å·çš„æ³¨å†Œï¼‰
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <ul>
      <li>
       ğŸ“¢åšå®¢ä¸»é¡µï¼š
       <a href="https://blog.csdn.net/weixin_43197380">
        https://loewen.blog.csdn.net
       </a>
      </li>
      <li>
       ğŸ“¢æ¬¢è¿ç‚¹èµ ğŸ‘ æ”¶è— â­ç•™è¨€ ğŸ“ å¦‚æœ‰é”™è¯¯æ•¬è¯·æŒ‡æ­£ï¼
      </li>
      <li>
       ğŸ“¢æœ¬æ–‡ç”±
       <font color="fuchsia">
        ä¸¶å¸ƒå¸ƒ
       </font>
       åŸåˆ›ï¼Œé¦–å‘äº CSDNï¼Œ
       <font color="red">
        è½¬è½½æ³¨æ˜å‡ºå¤„
       </font>
       ğŸ™‰
      </li>
      <li>
       ğŸ“¢ç°åœ¨çš„ä»˜å‡ºï¼Œéƒ½ä¼šæ˜¯ä¸€ç§æ²‰æ·€ï¼Œåªä¸ºè®©ä½ æˆä¸ºæ›´å¥½çš„äººâœ¨
      </li>
     </ul>
    </blockquote>
    <hr/>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h4>
     <a id="font_size4_faceSTCAIYUN_font_13">
     </a>
     <font face="STCAIYUN" size="4">
      ä¸€. éœ€è¦æ³¨å†Œä¿¡å·å‚æ•°çš„æƒ…å†µ
     </font>
    </h4>
    <p>
     <strong>
      1ã€è·¨çº¿ç¨‹çš„ä¿¡å·æ§½è¿æ¥ï¼ˆä½¿ç”¨ QueuedConnectionï¼‰
     </strong>
    </p>
    <p>
     å½“ä¿¡å·å’Œæ§½ä½äºä¸åŒçº¿ç¨‹ï¼Œä¸”è¿æ¥æ–¹å¼ä¸º
     <code>
      Qt::QueuedConnection
     </code>
     æˆ–
     <code>
      Qt::BlockingQueuedConnection
     </code>
     æ—¶ï¼Œ
     <mark>
      å‚æ•°ç±»å‹å¿…é¡»æ³¨å†Œ
     </mark>
     ã€‚
    </p>
    <p>
     åŸå› ï¼šè·¨çº¿ç¨‹é€šä¿¡æ—¶ï¼ŒQt éœ€è¦å°†å‚æ•°åºåˆ—åŒ–åˆ°æ¥æ”¶çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œè¿™è¦æ±‚ç±»å‹å¿…é¡»èƒ½è¢« Qt çš„å…ƒå¯¹è±¡ç³»ç»Ÿè¯†åˆ«ã€‚
    </p>
    <p>
     <strong>
      2ã€ä½¿ç”¨ QVariant ä¼ é€’è‡ªå®šä¹‰ç±»å‹
     </strong>
    </p>
    <p>
     å¦‚æœä¿¡å·å‚æ•°æ˜¯
     <code>
      è‡ªå®šä¹‰ç±»å‹
     </code>
     ï¼Œä¸”éœ€è¦ä¸
     <code>
      QVariant
     </code>
     ç»“åˆä½¿ç”¨ï¼Œå¿…é¡»æ³¨å†Œç±»å‹ã€‚
    </p>
    <hr/>
    <h4>
     <a id="font_size4_faceSTCAIYUN_font_25">
     </a>
     <font face="STCAIYUN" size="4">
      äºŒ. ä¸æ³¨å†Œå¯èƒ½å¼•å‘çš„é—®é¢˜
     </font>
    </h4>
    <p>
     <strong>
      1ã€è¿è¡Œæ—¶è­¦å‘Šæˆ–é”™è¯¯
     </strong>
    </p>
    <p>
     å¦‚æœæœªæ³¨å†Œè‡ªå®šä¹‰ç±»å‹ï¼Œ
     <code>
      Qt
     </code>
     ä¼šåœ¨è¿è¡Œæ—¶è¾“å‡ºç±»ä¼¼ä»¥ä¸‹è­¦å‘Šï¼š
    </p>
    <pre><code class="prism language-cpp">QObject<span class="token double-colon punctuation">::</span>connect<span class="token operator">:</span> Cannot queue arguments of type <span class="token char">'MyCustomType'</span>
<span class="token punctuation">(</span>Make sure <span class="token char">'MyCustomType'</span> is registered <span class="token keyword">using</span> <span class="token function">qRegisterMetaType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      åæœ
     </strong>
     ï¼šè·¨çº¿ç¨‹çš„ä¿¡å·æ§½è°ƒç”¨ä¼šå¤±è´¥ï¼Œæ§½å‡½æ•°ä¸ä¼šæ‰§è¡Œï¼Œç¨‹åºå¯èƒ½æ— å“åº”æˆ–å´©æºƒã€‚
    </p>
    <p>
     <strong>
      2ã€å‚æ•°æ— æ³•æ­£ç¡®ä¼ é€’
     </strong>
    </p>
    <p>
     æœªæ³¨å†Œçš„ç±»å‹æ— æ³•è¢« Qt åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œå¯¼è‡´æ§½å‡½æ•°æ¥æ”¶åˆ°çš„å‚æ•°æ˜¯æ— æ•ˆæˆ–æœªåˆå§‹åŒ–çš„å€¼ã€‚
    </p>
    <p>
     <strong>
      3ã€æ— æ³•ä¸ QVariant äº¤äº’
     </strong>
    </p>
    <p>
     è‡ªå®šä¹‰ç±»å‹æ— æ³•é€šè¿‡
     <code>
      QVariant
     </code>
     å­˜å‚¨æˆ–ä¼ é€’ï¼Œå¯¼è‡´ç›¸å…³åŠŸèƒ½ï¼ˆå¦‚å±æ€§ç³»ç»Ÿã€æ¨¡å‹/è§†å›¾ï¼‰å¤±æ•ˆã€‚
    </p>
    <hr/>
    <h4>
     <a id="font_size4_faceSTCAIYUN_font_46">
     </a>
     <font face="STCAIYUN" size="4">
      ä¸‰. å¦‚ä½•æ³¨å†Œè‡ªå®šä¹‰ç±»å‹
     </font>
    </h4>
    <p>
     <strong>
      1ã€ä½¿ç”¨ Q_DECLARE_METATYPE å®
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMetaType&gt;</span></span>

<span class="token comment">// è‡ªå®šä¹‰ç±»å‹å®šä¹‰</span>
<span class="token keyword">struct</span> <span class="token class-name">MyCustomType</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    QString name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å£°æ˜å…ƒç±»å‹æ”¯æŒï¼ˆæ”¾åœ¨å¤´æ–‡ä»¶æœ«å°¾ï¼‰</span>
<span class="token function">Q_DECLARE_METATYPE</span><span class="token punctuation">(</span>MyCustomType<span class="token punctuation">)</span>
</code></pre>
    <p>
     <strong>
      æ³¨
     </strong>
     ï¼š
     <strong>
      Q_DECLARE_METATYPE çš„ä½œç”¨
     </strong>
    </p>
    <p>
     1ï¼‰ç¼–è¯‘æ—¶å…ƒä¿¡æ¯ç”Ÿæˆ
    </p>
    <p>
     <strong>
      Q_DECLARE_METATYPE
     </strong>
     å®ä¼šä¸ºç±»å‹ç”Ÿæˆç¼–è¯‘æ—¶çš„å…ƒä¿¡æ¯ï¼ˆå¦‚ç±»å‹åç§°ã€å¤§å°ã€å¯¹é½æ–¹å¼ç­‰ï¼‰ï¼Œä½¿å¾—ä»¥ä¸‹åŠŸèƒ½å¯ç”¨ï¼š
    </p>
    <ul>
     <li>
      <code>
       QVariant
      </code>
      çš„æ„é€ å’Œç±»å‹è½¬æ¢ï¼ˆä¾‹å¦‚
      <code>
       QVariant::fromValue å’Œ QVariant::value
      </code>
      ï¼‰ã€‚
     </li>
     <li>
      ç±»å‹åœ¨æ¨¡æ¿å’Œå®ä¸­çš„é™æ€è¯†åˆ«ï¼ˆä¾‹å¦‚
      <code>
       QMetaType
      </code>
      çš„é™æ€æ¥å£ï¼‰ã€‚
     </li>
    </ul>
    <p>
     2ï¼‰éšå¼è¦æ±‚
    </p>
    <p>
     å¦‚æœæœªä½¿ç”¨
     <strong>
      Q_DECLARE_METATYPE
     </strong>
     ï¼Œå³ä½¿é€šè¿‡
     <code>
      qRegisterMetaType
     </code>
     æ³¨å†Œäº†ç±»å‹ï¼Œä»¥ä¸‹æ“ä½œå¯èƒ½å¤±è´¥ï¼š
    </p>
    <pre><code class="prism language-cpp">MyCustomType data<span class="token punctuation">;</span>
QVariant variant <span class="token operator">=</span> <span class="token class-name">QVariant</span><span class="token double-colon punctuation">::</span><span class="token function">fromValue</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
    <p>
     <strong>
      2ã€ä½¿ç”¨ qRegisterMetaType æ³¨å†Œç±»å‹
     </strong>
    </p>
    <p>
     åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼ˆå¦‚ main å‡½æ•°ã€æ„é€ å‡½æ•°ç­‰ä¸­ï¼‰æ³¨å†Œç±»å‹ï¼š
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMetaType&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æ³¨å†Œè‡ªå®šä¹‰ç±»å‹</span>
    <span class="token generic-function"><span class="token function">qRegisterMetaType</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyCustomType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"MyCustomType"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å¦‚æœç±»å‹æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¯ä»¥ç®€å†™ä¸ºï¼š</span>
    <span class="token generic-function"><span class="token function">qRegisterMetaType</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyCustomType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="font_size4_faceSTCAIYUN_font_103">
     </a>
     <font face="STCAIYUN" size="4">
      å››. ç¤ºä¾‹ï¼šè·¨çº¿ç¨‹ä¿¡å·æ§½çš„æ­£ç¡®ç”¨æ³•
     </font>
    </h4>
    <pre><code class="prism language-cpp"><span class="token comment">// è‡ªå®šä¹‰ç±»å‹</span>
<span class="token keyword">struct</span> <span class="token class-name">MyCustomType</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    QString name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">Q_DECLARE_METATYPE</span><span class="token punctuation">(</span>MyCustomType<span class="token punctuation">)</span>

<span class="token comment">// å‘é€è€…ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Sender</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QObject</span></span> <span class="token punctuation">{<!-- --></span>
    Q_OBJECT
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        MyCustomType data<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Test"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        emit <span class="token function">signalData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‘é€ä¿¡å·</span>
    <span class="token punctuation">}</span>
signals<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">signalData</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyCustomType<span class="token operator">&amp;</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æ¥æ”¶è€…ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Receiver</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QObject</span></span> <span class="token punctuation">{<!-- --></span>
    Q_OBJECT
<span class="token keyword">public</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">onDataReceived</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyCustomType<span class="token operator">&amp;</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Received:"</span> <span class="token operator">&lt;&lt;</span> data<span class="token punctuation">.</span>id <span class="token operator">&lt;&lt;</span> data<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">qRegisterMetaType</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyCustomType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ³¨å†Œç±»å‹</span>

    Sender sender<span class="token punctuation">;</span>
    Receiver receiver<span class="token punctuation">;</span>
    QThread thread<span class="token punctuation">;</span>

    <span class="token comment">// è·¨çº¿ç¨‹è¿æ¥</span>
    <span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sender<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Sender<span class="token double-colon punctuation">::</span>signalData<span class="token punctuation">,</span>
                     <span class="token operator">&amp;</span>receiver<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Receiver<span class="token double-colon punctuation">::</span>onDataReceived<span class="token punctuation">,</span>
                     Qt<span class="token double-colon punctuation">::</span>QueuedConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     
    <span class="token comment">//å°†æ¥å—è€…ç§»è‡³çº¿ç¨‹ä¸­ï¼Œè¿™æ ·ä¸å‘é€è€…å³åˆ†å±äºä¸åŒçš„çº¿ç¨‹ä¸­</span>
    receiver<span class="token punctuation">.</span><span class="token function">moveToThread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sender<span class="token punctuation">.</span><span class="token function">sendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="font_size4_faceSTCAIYUN__qRegisterMetaType_font_157">
     </a>
     <font face="STCAIYUN" size="4">
      äº”. ä¸ºä»€ä¹ˆâ€œä»…ç”¨ qRegisterMetaType ä¹Ÿèƒ½å·¥ä½œâ€ï¼Ÿ
     </font>
    </h4>
    <p>
     <strong>
      åœºæ™¯ 1
     </strong>
     ï¼šè·¨çº¿ç¨‹ä¿¡å·æ§½é€šä¿¡
    </p>
    <ul>
     <li>
      å¦‚æœä»…åœ¨è·¨çº¿ç¨‹ä¿¡å·æ§½ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ï¼Œä¸”æœªç›´æ¥æ“ä½œ QVariantï¼Œç¨‹åºå¯èƒ½æ­£å¸¸æ‰§è¡Œã€‚
     </li>
     <li>
      <strong>
       åŸå› 
      </strong>
      ï¼š
      <br/>
      <code>
       qRegisterMetaType
      </code>
      åœ¨è¿è¡Œæ—¶æ³¨å†Œäº†ç±»å‹ï¼Œä½¿å¾— Qt èƒ½æ­£ç¡®åºåˆ—åŒ–å‚æ•°ã€‚
      <br/>
      <code>
       Q_DECLARE_METATYPE
      </code>
      çš„ç¼ºå¤±åœ¨æ­¤åœºæ™¯ä¸‹å¯èƒ½ä¸ä¼šç«‹å³æš´éœ²é—®é¢˜ã€‚
     </li>
    </ul>
    <p>
     <strong>
      åœºæ™¯ 2
     </strong>
     ï¼šä½ç‰ˆæœ¬ Qt çš„å®½æ¾å¤„ç†
    </p>
    <ul>
     <li>
      æŸäº›æ—§ç‰ˆ Qtï¼ˆå¦‚ Qt4ï¼‰å¯¹ç±»å‹æ³¨å†Œçš„è¦æ±‚è¾ƒä¸ºå®½æ¾ï¼Œå¯èƒ½å…è®¸æœªå£°æ˜ Q_DECLARE_METATYPEã€‚
     </li>
     <li>
      é£é™©ï¼š
      <br/>
      è¿™ç§è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ï¼Œå¯èƒ½å›  Qt ç‰ˆæœ¬æˆ–å¹³å°ä¸åŒè€Œå¤±æ•ˆã€‚
     </li>
    </ul>
    <hr/>
    <table>
     <tbody>
      <tr>
       <td bgcolor="#7FFFD4">
        <font color="#855E42" face="STCAIYUN" size="4">
         ä¸‹é›¨å¤©ï¼Œæœ€æƒ¬æ„çš„äº‹è«è¿‡äºèººåœ¨åºŠä¸Šé™é™å¬é›¨ï¼Œé›¨ä¸­å…¥çœ ï¼Œè¿æ¢¦é‡Œä¹Ÿé•¿å‡ºé’è‹”ã€‚
        </font>
       </td>
      </tr>
     </tbody>
    </table>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333139373338302f:61727469636c652f64657461696c732f313436323438343433" class_="artid" style="display:none">
 </p>
</div>


