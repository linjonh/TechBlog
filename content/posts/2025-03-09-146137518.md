---
layout: post
title: "-SQL-Profiles-SQL-Baselines-未生效的一个原因"
date: 2025-03-09 19:51:11 +0800
description: "【代码】 SQL Profiles / SQL Baselines 未生效的一个原因。"
keywords: " SQL Profiles / SQL Baselines 未生效的一个原因"
categories: ['未分类']
tags: ['Sql', 'Oracle']
artid: "146137518"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146137518
    alt: "-SQL-Profiles-SQL-Baselines-未生效的一个原因"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146137518
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146137518
cover: https://bing.ee123.net/img/rand?artid=146137518
image: https://bing.ee123.net/img/rand?artid=146137518
img: https://bing.ee123.net/img/rand?artid=146137518
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     SQL Profiles / SQL Baselines 未生效的一个原因
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3>
     query to ignore SQL Profiles/SQL Baselines and was not using desired index. (Doc ID 2570477.1)
    </h3>
    <h3>
     <br/>
     Applies to:
    </h3>
    <p>
     Oracle Database - Enterprise Edition - Version 12.1.0.1 and later
     <br/>
     Information in this document applies to any platform.
    </p>
    <h3>
     <a name="SYMPTOM">
     </a>
     Symptoms
    </h3>
    <ul>
     <li>
      On 12.1.0.1 version, SQL_IDs are not picking the desired explain plan after applying the profile
     </li>
    </ul>
    <h3>
     <a name="CHANGE">
     </a>
     Changes
    </h3>
    <p>
     Linuguistic Sorting by the use of NLS_COMP = LINGUISTIC  at client side, caused the Oracle Index access path to be ignored by specific runs from Application. Query invoked from SQLPLUS was using desired index.
    </p>
    <h3>
     <a name="CAUSE">
     </a>
     Cause
    </h3>
    <p>
     <a name="aref_section31">
     </a>
    </p>
    <h3>
    </h3>
    <p>
     When performing SQL comparison operations, characters are compared according to their binary values. A character is greater than another if it has a higher binary value. Because the binary sequences rarely match the linguistic sequences for most languages, such comparisons may not be meaningful for a typical user. To achieve a meaningful comparison, you can specify behavior by using the session parameters
     <code>
      NLS_COMP
     </code>
     and
     <code>
      NLS_SORT
     </code>
     . The way you set these two parameters determines the rules by which characters are sorted and compared.
    </p>
    <p>
     The
     <code>
      NLS_COMP
     </code>
     setting determines how
     <code>
      NLS_SORT
     </code>
     is handled by the SQL operations. There are three valid values for
     <code>
      NLS_COMP
     </code>
     :
    </p>
    <ul>
     <li>
      <p>
       <code>
        BINARY
       </code>
      </p>
      <p>
       All SQL sorts and comparisons are based on the binary values of the string characters, regardless of the value set to
       <code>
        NLS_SORT
       </code>
       . This is the default setting.
      </p>
     </li>
    </ul>
    <ul>
     <li>
      <p>
       <code>
        LINGUISTIC
       </code>
      </p>
      <p>
       All SQL sorting and comparison are based on the linguistic rule specified by
       <code>
        NLS_SORT
       </code>
       . For example,
       <code>
        NLS_COMP=LINGUISTIC
       </code>
       and
       <code>
        NLS_SORT=BINARY_CI
       </code>
       means the collation sensitive SQL operations will use binary value for sorting and comparison but ignore character case.
      </p>
     </li>
    </ul>
    <ul>
     <li>
      <p>
       <code>
        ANSI
       </code>
      </p>
     </li>
    </ul>
    <p>
    </p>
    <p>
     NLS_COMP was not BINARY and this setting was invoked as CLIENT SIDE setting on the application sessions running the query on database. This caused the query from application not using the desired Index.
    </p>
    <p>
     Plan was not reproducible and hence plan stability option did not worked here. Also when the query was invoked from sqlplus it chose the desired index access path, this plan was used for creating baseline for the original query coming from application. However as mentioned this plan won't be reproducible because of NLS_COMP being used as LINGUISTIC and not BINARY
     <br/>
    </p>
    <h3>
     <a name="FIX">
     </a>
     Solution
    </h3>
    <p>
     1. Ensure that your application session before running the query on dataabase or SQL job sets NLS_COMP to BINARY, and then run the query.
     <br/>
     <br/>
     or
     <br/>
     <br/>
     2. Check in the job code, if there are any NLS settings modifying the NLS_COMP and see if it's value is set to BINARY , discuss this with application team.
     <br/>
     <br/>
     or
     <br/>
     <br/>
     3. Create Functional Index on the sort functions as visible in the predicates information section of execution plan details and capture statistics and then re-acess sql executed from job.
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6a6e726a69616e2f:61727469636c652f64657461696c732f313436313337353138" class_="artid" style="display:none">
 </p>
</div>


