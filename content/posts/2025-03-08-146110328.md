---
layout: post
title: "Windows-虚拟化架构解析WSL-与-Hyper-V-及其对-Docker-部署的影响"
date: 2025-03-08 08:29:40 +0800
description: "在 Windows 平台上运行 Linux 环境已经成为开发者的常见需求，而微软提供了两种主要的解决方案：WSL（Windows Subsystem for Linux）和Hyper-V。这两种架构在虚拟化技术上存在明显区别，同时对 Docker 等容器技术的运行方式也有不同的影响。本篇文章将详细解析 WSL 和 Hyper-V 的架构特点，深入探讨其在 Docker 部署中的表现，并提供选择建议和优化配置方法。"
keywords: "wsl和hyperfv docker"
categories: ['软件架构', '编程工具']
tags: ['Windows', 'Docker']
artid: "146110328"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146110328
    alt: "Windows-虚拟化架构解析WSL-与-Hyper-V-及其对-Docker-部署的影响"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146110328
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146110328
cover: https://bing.ee123.net/img/rand?artid=146110328
image: https://bing.ee123.net/img/rand?artid=146110328
img: https://bing.ee123.net/img/rand?artid=146110328
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Windows 虚拟化架构解析：WSL 与 Hyper-V 及其对 Docker 部署的影响
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="1__2">
     </a>
     1 前言
    </h2>
    <p>
     在 Windows 平台上运行 Linux 环境已经成为开发者的常见需求，而微软提供了两种主要的解决方案：WSL（Windows Subsystem for Linux）和Hyper-V。这两种架构在虚拟化技术上存在明显区别，同时对 Docker 等容器技术的运行方式也有不同的影响。
    </p>
    <p>
     本篇文章将详细解析 WSL 和 Hyper-V 的架构特点，深入探讨其在 Docker 部署中的表现，并提供选择建议和优化配置方法。
    </p>
    <h2>
     <a id="2_WSL__HyperV__8">
     </a>
     2 WSL 与 Hyper-V 架构对比
    </h2>
    <h3>
     <a id="21_WSLWindows_Subsystem_for_Linux_10">
     </a>
     2.1 WSL（Windows Subsystem for Linux）
    </h3>
    <p>
     WSL 是 Windows 提供的 Linux 兼容层，允许用户直接在 Windows 上运行原生 Linux 应用程序，而无需依赖完整的虚拟机。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a4be88c4ab024408a441814391602d07.png"/>
    </p>
    <h4>
     <a id="211_WSL_1__15">
     </a>
     2.1.1 WSL 1 及其架构特点
    </h4>
    <p>
     WSL 1 采用了一种翻译层（translation layer）技术，拦截 Linux 系统调用并将其转换为 Windows 系统调用。这意味着 WSL 1 并未真正运行一个完整的 Linux 内核，而是通过模拟的方式执行 Linux 程序。
    </p>
    <p>
     WSL 1 的主要特点如下：
    </p>
    <ul>
     <li>
      <strong>
       无虚拟机
      </strong>
      ，不依赖 Hyper-V，可以在 Windows 10 家庭版上运行。
     </li>
     <li>
      <strong>
       系统调用翻译
      </strong>
      ，部分系统调用可能不兼容，影响某些 Linux 应用的运行。
     </li>
     <li>
      <strong>
       文件系统性能较低
      </strong>
      ，由于 NTFS 和 Linux 文件系统存在差异，WSL 1 在处理大量小文件时性能较差。
     </li>
    </ul>
    <h4>
     <a id="212_WSL_2__25">
     </a>
     2.1.2 WSL 2 及其架构特点
    </h4>
    <p>
     WSL 2 相较于 WSL 1 进行了重大架构升级，基于轻量级的 Hyper-V 虚拟机运行完整的 Linux 内核，带来了更好的兼容性和性能。
    </p>
    <p>
     WSL 2 的核心特点包括：
    </p>
    <ul>
     <li>
      <strong>
       使用真正的 Linux 内核
      </strong>
      ，提供更好的系统调用兼容性。
     </li>
     <li>
      <strong>
       基于 Hyper-V 虚拟化技术
      </strong>
      ，但采用轻量级架构，与传统 Hyper-V VM 资源管理方式不同。
     </li>
     <li>
      <strong>
       文件系统性能提升
      </strong>
      ，通过 9p 文件协议优化了 Windows 与 Linux 之间的文件访问速度。
     </li>
     <li>
      <strong>
       动态资源管理
      </strong>
      ，内存与 CPU 按需分配，提高运行效率。
     </li>
    </ul>
    <h3>
     <a id="22_HyperV_36">
     </a>
     2.2 Hyper-V
    </h3>
    <p>
     Hyper-V 是微软提供的 Type-1 裸机（bare-metal）虚拟化技术，允许用户创建和管理完整的虚拟机（VM）。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7888e313514d49b69387bd0e5ef2838c.png"/>
    </p>
    <p>
     Hyper-V 的关键特点包括：
    </p>
    <ul>
     <li>
      <strong>
       独立的虚拟机环境
      </strong>
      ，每个 VM 运行完整的操作系统，并有独立的 CPU、内存和存储资源。
     </li>
     <li>
      <strong>
       适用于服务器虚拟化
      </strong>
      ，支持 Windows 和 Linux 系统，可用于生产环境部署。
     </li>
     <li>
      <strong>
       资源预分配
      </strong>
      ，每个虚拟机需要分配固定的 CPU、内存和磁盘，可能导致资源浪费。
     </li>
     <li>
      <strong>
       启动速度较慢
      </strong>
      ，通常需要较长的启动时间（分钟级），因为每个 VM 都是一个完整的操作系统实例。
     </li>
    </ul>
    <h3>
     <a id="23_WSL__HyperV__48">
     </a>
     2.3 WSL 与 Hyper-V 对比总结
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        特性
       </th>
       <th>
        WSL 2
       </th>
       <th>
        Hyper-V
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        虚拟化类型
       </td>
       <td>
        轻量级 Hyper-V 虚拟机
       </td>
       <td>
        完整虚拟机
       </td>
      </tr>
      <tr>
       <td>
        资源管理
       </td>
       <td>
        动态分配 CPU 和内存
       </td>
       <td>
        预分配固定资源
       </td>
      </tr>
      <tr>
       <td>
        启动速度
       </td>
       <td>
        秒级
       </td>
       <td>
        分钟级
       </td>
      </tr>
      <tr>
       <td>
        文件系统访问
       </td>
       <td>
        9p 文件协议，适用于开发环境
       </td>
       <td>
        虚拟磁盘，适用于生产环境
       </td>
      </tr>
      <tr>
       <td>
        兼容性
       </td>
       <td>
        适用于 Windows 10/11 家庭版
       </td>
       <td>
        需要 Windows 10/11 专业版
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="3_WSL__HyperV__Docker__58">
     </a>
     3 WSL 与 Hyper-V 在 Docker 运行中的区别
    </h2>
    <h3>
     <a id="31__HyperV__Docker__60">
     </a>
     3.1 传统 Hyper-V 模式下的 Docker 运行方式
    </h3>
    <p>
     在未引入 WSL 2 之前，Windows 上运行 Docker 主要依赖 Hyper-V 架构。Docker Desktop 需要创建一个 Hyper-V 虚拟机（MobyLinuxVM），在该虚拟机内部运行 Docker Engine。Windows 端的 Docker CLI 通过网络接口与该虚拟机内的 Docker Engine 进行通信。
    </p>
    <p>
     <strong>
      Hyper-V 模式的特点
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       需要 Hyper-V 支持
      </strong>
      ，无法在 Windows 10 家庭版上运行。
     </li>
     <li>
      <strong>
       占用较多资源
      </strong>
      ，因为 Hyper-V 虚拟机需要固定分配 CPU 和内存。
     </li>
     <li>
      <strong>
       文件系统访问受限
      </strong>
      ，Windows 与 Hyper-V 虚拟机之间的文件共享需要额外配置，性能较低。
     </li>
    </ul>
    <h3>
     <a id="32__WSL_2__Docker_70">
     </a>
     3.2 基于 WSL 2 运行 Docker
    </h3>
    <p>
     WSL 2 引入后，Docker Desktop 采用了 WSL 2 作为后端，直接在 WSL 2 的 Linux 内核中运行 Docker Engine，无需单独的 Hyper-V 虚拟机。
    </p>
    <p>
     <strong>
      WSL 2 模式的特点
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       不再需要额外的 Hyper-V 虚拟机
      </strong>
      ，减少资源占用。
     </li>
     <li>
      <strong>
       文件访问速度更快
      </strong>
      ，可以直接在 WSL 2 访问 Windows 文件系统（\wsl$ 共享）。
     </li>
     <li>
      <strong>
       开发体验更流畅
      </strong>
      ，可以直接在 VS Code 或其他开发工具中操作 WSL 2 内的容器。
     </li>
    </ul>
    <h3>
     <a id="33_Docker__80">
     </a>
     3.3 Docker 运行模式对比总结
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        运行方式
       </th>
       <th>
        Hyper-V 模式
       </th>
       <th>
        WSL 2 模式
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        依赖的虚拟化技术
       </td>
       <td>
        Hyper-V 独立虚拟机
       </td>
       <td>
        轻量级 Hyper-V 虚拟机
       </td>
      </tr>
      <tr>
       <td>
        资源占用
       </td>
       <td>
        需要固定预分配内存和 CPU
       </td>
       <td>
        动态分配资源
       </td>
      </tr>
      <tr>
       <td>
        文件系统性能
       </td>
       <td>
        通过 SMB 共享，性能较低
       </td>
       <td>
        直接访问 \wsl$ 目录
       </td>
      </tr>
      <tr>
       <td>
        兼容性
       </td>
       <td>
        需要 Windows 专业版
       </td>
       <td>
        适用于 Windows 所有版本
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="4__89">
     </a>
     4 如何选择合适的架构？
    </h2>
    <h3>
     <a id="41__WSL_2__91">
     </a>
     4.1 选择 WSL 2 的场景
    </h3>
    <p>
     如果你的主要需求是
     <strong>
      开发和测试环境
     </strong>
     ，那么 WSL 2 是更优的选择：
    </p>
    <ul>
     <li>
      适用于 Windows 10/11 家庭版用户。
     </li>
     <li>
      需要快速启动的开发环境（如 Web 开发、后端开发）。
     </li>
     <li>
      需要频繁访问 Windows 文件系统的容器应用。
     </li>
    </ul>
    <h3>
     <a id="42__HyperV__99">
     </a>
     4.2 选择 Hyper-V 的场景
    </h3>
    <p>
     如果你的需求是
     <strong>
      运行多个独立的虚拟机
     </strong>
     或
     <strong>
      部署生产环境
     </strong>
     ，Hyper-V 更加适合：
    </p>
    <ul>
     <li>
      需要在 Windows 上运行多个完整的 Linux 或 Windows Server 机器。
     </li>
     <li>
      需要严格的系统隔离，避免 WSL 2 共享宿主机资源。
     </li>
    </ul>
    <h2>
     <a id="5__Docker__WSL_2_106">
     </a>
     5 如何配置 Docker 使用 WSL 2
    </h2>
    <ol>
     <li>
      <p>
       启用 WSL 2：
      </p>
      <pre><code class="prism language-powershell">wsl <span class="token operator">--</span>install
wsl <span class="token operator">--</span><span class="token function">set-default</span><span class="token operator">-</span>version 2
</code></pre>
     </li>
     <li>
      <p>
       安装 Docker Desktop 并启用 WSL 2 后端：
      </p>
      <ul>
       <li>
        在 Docker Desktop 设置中勾选
        <strong>
         Use WSL 2 based engine
        </strong>
        。
       </li>
      </ul>
     </li>
     <li>
      <p>
       选择要集成的 WSL 发行版：
      </p>
      <ul>
       <li>
        在 Docker Desktop 的 WSL 选项卡中选择 Ubuntu 或其他 Linux 发行版。
       </li>
      </ul>
     </li>
    </ol>
    <h2>
     <a id="6__123">
     </a>
     6 结语
    </h2>
    <p>
     WSL 2 的引入极大地优化了 Windows 上的 Docker 体验，使开发者可以更高效地使用容器技术。相比 Hyper-V，WSL 2 更适合开发环境，而 Hyper-V 则适用于完整的虚拟机需求。希望本文能帮助你根据实际需求选择合适的技术架构。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f636f6f6c647265616d323030392f:61727469636c652f64657461696c732f313436313130333238" class_="artid" style="display:none">
 </p>
</div>


