---
layout: post
title: "ECEF与ENU坐标系定义及C语言实现"
date: 2025-03-11 23:45:07 +0800
description: "简单介绍了ECEF 与 ENU 坐标与他们之间的转换，并提供C语言实现"
keywords: "ECEF与ENU坐标系定义及C语言实现"
categories: ['未分类']
tags: ['C']
artid: "146191291"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191291
    alt: "ECEF与ENU坐标系定义及C语言实现"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191291
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191291
cover: https://bing.ee123.net/img/rand?artid=146191291
image: https://bing.ee123.net/img/rand?artid=146191291
img: https://bing.ee123.net/img/rand?artid=146191291
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ECEF与ENU坐标系定义及C语言实现
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="ECEFENU_2">
     </a>
     一、ECEF与ENU坐标系定义
    </h3>
    <ol>
     <li>
      ECEF坐标系（地心地固坐标系）
     </li>
    </ol>
    <ul>
     <li>
      原点：地球质心
     </li>
     <li>
      X轴：指向本初子午线与赤道交点
     </li>
     <li>
      Y轴：在赤道平面内与X轴垂直
     </li>
     <li>
      Z轴：指向北极
     </li>
     <li>
      数学表示：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         P 
          
          
          
            e 
           
          
            c 
           
          
            e 
           
          
            f 
           
          
         
        
          = 
         
        
          ( 
         
        
          x 
         
        
          , 
         
        
          y 
         
        
          , 
         
        
          z 
         
        
          ) 
         
        
       
         P_{ecef} = (x, y, z)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.9694em; vertical-align: -0.2861em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            P
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.3361em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   ece
                  </span>
                  <span class="mord mathnormal mtight" style="margin-right: 0.1076em;">
                   f
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.2861em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           x
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0359em;">
           y
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.044em;">
           z
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
    </ul>
    <ol start="2">
     <li>
      ENU坐标系（东北天坐标系）
     </li>
    </ol>
    <ul>
     <li>
      原点：本地参考点
     </li>
     <li>
      E轴：指向东方
     </li>
     <li>
      N轴：指向北方
     </li>
     <li>
      U轴：垂直地面向上
     </li>
     <li>
      数学表示：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         P 
          
          
          
            e 
           
          
            n 
           
          
            u 
           
          
         
        
          = 
         
        
          ( 
         
        
          e 
         
        
          , 
         
        
          n 
         
        
          , 
         
        
          u 
         
        
          ) 
         
        
       
         P_{enu} = (e, n, u)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8333em; vertical-align: -0.15em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1389em;">
            P
           </span>
           <span class="msupsub">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.1514em;">
               <span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   e
                  </span>
                  <span class="mord mathnormal mtight">
                   n
                  </span>
                  <span class="mord mathnormal mtight">
                   u
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.15em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal">
           e
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal">
           n
          </span>
          <span class="mpunct">
           ,
          </span>
          <span class="mspace" style="margin-right: 0.1667em;">
          </span>
          <span class="mord mathnormal">
           u
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
    </ul>
    <h3>
     <a id="_17">
     </a>
     二、坐标转换数学原理
    </h3>
    <ol>
     <li>
      地理坐标转ECEF：
      <br/>
      <span class="katex--display">
       <span class="katex-display">
        <span class="katex">
         <span class="katex-mathml">
          { 
          
          
           
            
             
              
              
                x 
               
              
                = 
               
              
                ( 
               
              
                N 
               
              
                + 
               
              
                h 
               
              
                ) 
               
              
                cos 
               
              
                ⁡ 
               
              
                ϕ 
               
              
                cos 
               
              
                ⁡ 
               
              
                λ 
               
              
             
            
           
           
            
             
              
              
                y 
               
              
                = 
               
              
                ( 
               
              
                N 
               
              
                + 
               
              
                h 
               
              
                ) 
               
              
                cos 
               
              
                ⁡ 
               
              
                ϕ 
               
              
                sin 
               
              
                ⁡ 
               
              
                λ 
               
              
             
            
           
           
            
             
              
              
                z 
               
              
                = 
               
              
                ( 
               
              
                N 
               
              
                ( 
               
              
                1 
               
              
                − 
               
               
               
                 e 
                
               
                 2 
                
               
              
                ) 
               
              
                + 
               
              
                h 
               
              
                ) 
               
              
                sin 
               
              
                ⁡ 
               
              
                ϕ 
               
              
             
            
           
          
         
        
          \begin{cases} x = (N + h)\cos\phi\cos\lambda \\ y = (N + h)\cos\phi\sin\lambda \\ z = (N(1-e^2)+h)\sin\phi \end{cases}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 4.32em; vertical-align: -1.91em;">
           </span>
           <span class="minner">
            <span class="mopen">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.35em;">
                 <span class="" style="top: -2.2em;">
                  <span class="pstrut" style="height: 3.15em;">
                  </span>
                  <span class="delimsizinginner delim-size4">
                   <span class="">
                    ⎩
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -2.192em;">
                  <span class="pstrut" style="height: 3.15em;">
                  </span>
                  <span class="" style="height: 0.316em; width: 0.8889em;">
                   <svg height="0.316em" preserveaspectratio="xMinYMin" style="width:0.8889em" viewbox="0 0 888.89 316" width="0.8889em">
                    <path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z">
                    </path>
                   </svg>
                  </span>
                 </span>
                 <span class="" style="top: -3.15em;">
                  <span class="pstrut" style="height: 3.15em;">
                  </span>
                  <span class="delimsizinginner delim-size4">
                   <span class="">
                    ⎨
                   </span>
                  </span>
                 </span>
                 <span class="" style="top: -4.292em;">
                  <span class="pstrut" style="height: 3.15em;">
                  </span>
                  <span class="" style="height: 0.316em; width: 0.8889em;">
                   <svg height="0.316em" preserveaspectratio="xMinYMin" style="width:0.8889em" viewbox="0 0 888.89 316" width="0.8889em">
                    <path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z">
                    </path>
                   </svg>
                  </span>
                 </span>
                 <span class="" style="top: -4.6em;">
                  <span class="pstrut" style="height: 3.15em;">
                  </span>
                  <span class="delimsizinginner delim-size4">
                   <span class="">
                    ⎧
                   </span>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.85em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord">
             <span class="mtable">
              <span class="col-align-l">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 2.41em;">
                  <span class="" style="top: -4.41em;">
                   <span class="pstrut" style="height: 3.008em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal">
                     x
                    </span>
                    <span class="mspace" style="margin-right: 0.2778em;">
                    </span>
                    <span class="mrel">
                     =
                    </span>
                    <span class="mspace" style="margin-right: 0.2778em;">
                    </span>
                    <span class="mopen">
                     (
                    </span>
                    <span class="mord mathnormal" style="margin-right: 0.109em;">
                     N
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     +
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord mathnormal">
                     h
                    </span>
                    <span class="mclose">
                     )
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -2.97em;">
                   <span class="pstrut" style="height: 3.008em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0359em;">
                     y
                    </span>
                    <span class="mspace" style="margin-right: 0.2778em;">
                    </span>
                    <span class="mrel">
                     =
                    </span>
                    <span class="mspace" style="margin-right: 0.2778em;">
                    </span>
                    <span class="mopen">
                     (
                    </span>
                    <span class="mord mathnormal" style="margin-right: 0.109em;">
                     N
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     +
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord mathnormal">
                     h
                    </span>
                    <span class="mclose">
                     )
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -1.53em;">
                   <span class="pstrut" style="height: 3.008em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.044em;">
                     z
                    </span>
                    <span class="mspace" style="margin-right: 0.2778em;">
                    </span>
                    <span class="mrel">
                     =
                    </span>
                    <span class="mspace" style="margin-right: 0.2778em;">
                    </span>
                    <span class="mopen">
                     (
                    </span>
                    <span class="mord mathnormal" style="margin-right: 0.109em;">
                     N
                    </span>
                    <span class="mopen">
                     (
                    </span>
                    <span class="mord">
                     1
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord">
                     <span class="mord mathnormal">
                      e
                     </span>
                     <span class="msupsub">
                      <span class="vlist-t">
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.8141em;">
                         <span class="" style="top: -3.063em; margin-right: 0.05em;">
                          <span class="pstrut" style="height: 2.7em;">
                          </span>
                          <span class="sizing reset-size6 size3 mtight">
                           <span class="mord mtight">
                            2
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="mclose">
                     )
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     +
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord mathnormal">
                     h
                    </span>
                    <span class="mclose">
                     )
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.91em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mclose nulldelimiter">
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      <br/>
      其中：
     </li>
    </ol>
    <ul>
     <li>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         N 
         
        
          = 
         
         
         
           a 
          
          
           
           
             1 
            
           
             − 
            
            
            
              e 
             
            
              2 
             
            
            
             
             
               sin 
              
             
               ⁡ 
              
             
            
              2 
             
            
           
             ϕ 
            
           
          
         
        
       
         N = \frac{a}{\sqrt{1-e^2\sin^2\phi}}
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.525em; vertical-align: -0.8296em;">
          </span>
          <span class="mord">
           <span class="mopen nulldelimiter">
           </span>
           <span class="mfrac">
            <span class="vlist-t vlist-t2">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.6954em;">
               <span class="" style="top: -2.4359em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord sqrt mtight">
                   <span class="vlist-t vlist-t2">
                    <span class="vlist-r">
                     <span class="vlist" style="height: 1.0773em;">
                      <span class="svg-align" style="top: -3.4286em;">
                       <span class="pstrut" style="height: 3.4286em;">
                       </span>
                       <span class="mord mtight" style="padding-left: 1.19em;">
                        <span class="mord mtight">
                         1
                        </span>
                        <span class="mbin mtight">
                         −
                        </span>
                        <span class="mord mtight">
                         <span class="mord mathnormal mtight">
                          e
                         </span>
                         <span class="msupsub">
                          <span class="vlist-t">
                           <span class="vlist-r">
                            <span class="vlist" style="height: 0.7463em;">
                             <span class="" style="top: -2.786em; margin-right: 0.0714em;">
                              <span class="pstrut" style="height: 2.5em;">
                              </span>
                              <span class="sizing reset-size3 size1 mtight">
                               <span class="mord mtight">
                                2
                               </span>
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="mspace mtight" style="margin-right: 0.1952em;">
                        </span>
                        <span class="mop mtight">
                         <span class="mop mtight">
                          <span class="mtight">
                           s
                          </span>
                          <span class="mtight">
                           i
                          </span>
                          <span class="mtight">
                           n
                          </span>
                         </span>
                         <span class="msupsub">
                          <span class="vlist-t">
                           <span class="vlist-r">
                            <span class="vlist" style="height: 0.7753em;">
                             <span class="" style="top: -2.815em; margin-right: 0.0714em;">
                              <span class="pstrut" style="height: 2.5em;">
                              </span>
                              <span class="sizing reset-size3 size1 mtight">
                               <span class="mord mtight">
                                2
                               </span>
                              </span>
                             </span>
                            </span>
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="mspace mtight" style="margin-right: 0.1952em;">
                        </span>
                        <span class="mord mathnormal mtight">
                         ϕ
                        </span>
                       </span>
                      </span>
                      <span class="" style="top: -3.0493em;">
                       <span class="pstrut" style="height: 3.4286em;">
                       </span>
                       <span class="hide-tail mtight" style="min-width: 0.853em; height: 1.5429em;">
                        <svg height="1.5429em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 1080" width="400em">
                         <path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z">
                         </path>
                        </svg>
                       </span>
                      </span>
                     </span>
                     <span class="vlist-s">
                      ​
                     </span>
                    </span>
                    <span class="vlist-r">
                     <span class="vlist" style="height: 0.3792em;">
                      <span class="">
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
               <span class="" style="top: -3.23em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="frac-line" style="border-bottom-width: 0.04em;">
                </span>
               </span>
               <span class="" style="top: -3.394em;">
                <span class="pstrut" style="height: 3em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  <span class="mord mathnormal mtight">
                   a
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="vlist-s">
               ​
              </span>
             </span>
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8296em;">
               <span class="">
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mclose nulldelimiter">
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      （卯酉圈曲率半径）
     </li>
     <li>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         e 
          
         
           2 
          
         
        
          = 
         
        
          2 
         
        
          f 
         
        
          − 
         
         
         
           f 
          
         
           2 
          
         
        
       
         e^2 = 2f - f^2
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8141em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal">
            e
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
          </span>
          <span class="mord">
           2
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1076em;">
           f
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           −
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1.0085em; vertical-align: -0.1944em;">
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.1076em;">
            f
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      （椭球偏心率平方）
     </li>
     <li>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         a 
         
        
          = 
         
        
          6378137 
         
        
          m 
         
        
       
         a=6378137m
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.4306em;">
          </span>
          <span class="mord mathnormal">
           a
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6444em;">
          </span>
          <span class="mord">
           6378137
          </span>
          <span class="mord mathnormal">
           m
          </span>
         </span>
        </span>
       </span>
      </span>
      （WGS84长半轴）
     </li>
     <li>
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         f 
         
        
          = 
         
        
          1 
         
        
          / 
         
        
          298.257223563 
         
        
       
         f=1/298.257223563
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.1076em;">
           f
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
          <span class="mrel">
           =
          </span>
          <span class="mspace" style="margin-right: 0.2778em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord">
           1/298.257223563
          </span>
         </span>
        </span>
       </span>
      </span>
      （WGS84扁率）
     </li>
    </ul>
    <ol start="2">
     <li>
      ECEF转ENU：
      <br/>
      <span class="katex--display">
       <span class="katex-display">
        <span class="katex">
         <span class="katex-mathml">
          [ 
           
           
            
             
              
              
                e 
               
              
             
            
            
             
              
              
                n 
               
              
             
            
            
             
              
              
                u 
               
              
             
            
           
          
            ] 
           
          
         
           = 
          
          
          
            [ 
           
           
            
             
              
               
               
                 − 
                
               
                 sin 
                
               
                 ⁡ 
                
               
                 λ 
                
               
              
             
             
              
               
               
                 cos 
                
               
                 ⁡ 
                
               
                 λ 
                
               
              
             
             
              
              
                0 
               
              
             
            
            
             
              
               
               
                 − 
                
               
                 sin 
                
               
                 ⁡ 
                
               
                 ϕ 
                
               
                 cos 
                
               
                 ⁡ 
                
               
                 λ 
                
               
              
             
             
              
               
               
                 − 
                
               
                 sin 
                
               
                 ⁡ 
                
               
                 ϕ 
                
               
                 sin 
                
               
                 ⁡ 
                
               
                 λ 
                
               
              
             
             
              
               
               
                 cos 
                
               
                 ⁡ 
                
               
                 ϕ 
                
               
              
             
            
            
             
              
               
               
                 cos 
                
               
                 ⁡ 
                
               
                 ϕ 
                
               
                 cos 
                
               
                 ⁡ 
                
               
                 λ 
                
               
              
             
             
              
               
               
                 cos 
                
               
                 ⁡ 
                
               
                 ϕ 
                
               
                 sin 
                
               
                 ⁡ 
                
               
                 λ 
                
               
              
             
             
              
               
               
                 sin 
                
               
                 ⁡ 
                
               
                 ϕ 
                
               
              
             
            
           
          
            ] 
           
          
          
          
            [ 
           
           
            
             
              
               
               
                 x 
                
               
                 − 
                
                
                
                  x 
                 
                
                  0 
                 
                
               
              
             
            
            
             
              
               
               
                 y 
                
               
                 − 
                
                
                
                  y 
                 
                
                  0 
                 
                
               
              
             
            
            
             
              
               
               
                 z 
                
               
                 − 
                
                
                
                  z 
                 
                
                  0 
                 
                
               
              
             
            
           
          
            ] 
           
          
         
        
          \begin{bmatrix} e \\ n \\ u \end{bmatrix} = \begin{bmatrix} -\sin\lambda &amp; \cos\lambda &amp; 0 \\ -\sin\phi\cos\lambda &amp; -\sin\phi\sin\lambda &amp; \cos\phi \\ \cos\phi\cos\lambda &amp; \cos\phi\sin\lambda &amp; \sin\phi \end{bmatrix} \begin{bmatrix} x-x_0 \\ y-y_0 \\ z-z_0 \end{bmatrix}
         </span>
         <span class="katex-html">
          <span class="base">
           <span class="strut" style="height: 3.6em; vertical-align: -1.55em;">
           </span>
           <span class="minner">
            <span class="mopen">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.05em;">
                 <span class="" style="top: -4.05em;">
                  <span class="pstrut" style="height: 5.6em;">
                  </span>
                  <span class="" style="width: 0.667em; height: 3.6em;">
                   <svg height="3.600em" viewbox="0 0 667 3600" width="0.667em">
                    <path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z">
                    </path>
                   </svg>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.55em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord">
             <span class="mtable">
              <span class="col-align-c">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 2.05em;">
                  <span class="" style="top: -4.21em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal">
                     e
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.01em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal">
                     n
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -1.81em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal">
                     u
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.55em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mclose">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.05em;">
                 <span class="" style="top: -4.05em;">
                  <span class="pstrut" style="height: 5.6em;">
                  </span>
                  <span class="" style="width: 0.667em; height: 3.6em;">
                   <svg height="3.600em" viewbox="0 0 667 3600" width="0.667em">
                    <path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z">
                    </path>
                   </svg>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.55em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
           <span class="mrel">
            =
           </span>
           <span class="mspace" style="margin-right: 0.2778em;">
           </span>
          </span>
          <span class="base">
           <span class="strut" style="height: 3.6em; vertical-align: -1.55em;">
           </span>
           <span class="minner">
            <span class="mopen">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.05em;">
                 <span class="" style="top: -4.05em;">
                  <span class="pstrut" style="height: 5.6em;">
                  </span>
                  <span class="" style="width: 0.667em; height: 3.6em;">
                   <svg height="3.600em" viewbox="0 0 667 3600" width="0.667em">
                    <path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z">
                    </path>
                   </svg>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.55em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord">
             <span class="mtable">
              <span class="col-align-c">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 2.05em;">
                  <span class="" style="top: -4.21em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.01em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -1.81em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.55em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="arraycolsep" style="width: 0.5em;">
              </span>
              <span class="arraycolsep" style="width: 0.5em;">
              </span>
              <span class="col-align-c">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 2.05em;">
                  <span class="" style="top: -4.21em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.01em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -1.81em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     λ
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.55em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
              <span class="arraycolsep" style="width: 0.5em;">
              </span>
              <span class="arraycolsep" style="width: 0.5em;">
              </span>
              <span class="col-align-c">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 2.05em;">
                  <span class="" style="top: -4.21em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord">
                     0
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.01em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mop">
                     cos
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -1.81em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mop">
                     sin
                    </span>
                    <span class="mspace" style="margin-right: 0.1667em;">
                    </span>
                    <span class="mord mathnormal">
                     ϕ
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.55em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mclose">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.05em;">
                 <span class="" style="top: -4.05em;">
                  <span class="pstrut" style="height: 5.6em;">
                  </span>
                  <span class="" style="width: 0.667em; height: 3.6em;">
                   <svg height="3.600em" viewbox="0 0 667 3600" width="0.667em">
                    <path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z">
                    </path>
                   </svg>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.55em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
           <span class="mspace" style="margin-right: 0.1667em;">
           </span>
           <span class="minner">
            <span class="mopen">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.05em;">
                 <span class="" style="top: -4.05em;">
                  <span class="pstrut" style="height: 5.6em;">
                  </span>
                  <span class="" style="width: 0.667em; height: 3.6em;">
                   <svg height="3.600em" viewbox="0 0 667 3600" width="0.667em">
                    <path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z">
                    </path>
                   </svg>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.55em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mord">
             <span class="mtable">
              <span class="col-align-c">
               <span class="vlist-t vlist-t2">
                <span class="vlist-r">
                 <span class="vlist" style="height: 2.05em;">
                  <span class="" style="top: -4.21em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal">
                     x
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord">
                     <span class="mord mathnormal">
                      x
                     </span>
                     <span class="msupsub">
                      <span class="vlist-t vlist-t2">
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.3011em;">
                         <span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;">
                          <span class="pstrut" style="height: 2.7em;">
                          </span>
                          <span class="sizing reset-size6 size3 mtight">
                           <span class="mord mtight">
                            0
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="vlist-s">
                         ​
                        </span>
                       </span>
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.15em;">
                         <span class="">
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -3.01em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.0359em;">
                     y
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord">
                     <span class="mord mathnormal" style="margin-right: 0.0359em;">
                      y
                     </span>
                     <span class="msupsub">
                      <span class="vlist-t vlist-t2">
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.3011em;">
                         <span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;">
                          <span class="pstrut" style="height: 2.7em;">
                          </span>
                          <span class="sizing reset-size6 size3 mtight">
                           <span class="mord mtight">
                            0
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="vlist-s">
                         ​
                        </span>
                       </span>
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.15em;">
                         <span class="">
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  <span class="" style="top: -1.81em;">
                   <span class="pstrut" style="height: 3em;">
                   </span>
                   <span class="mord">
                    <span class="mord mathnormal" style="margin-right: 0.044em;">
                     z
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mbin">
                     −
                    </span>
                    <span class="mspace" style="margin-right: 0.2222em;">
                    </span>
                    <span class="mord">
                     <span class="mord mathnormal" style="margin-right: 0.044em;">
                      z
                     </span>
                     <span class="msupsub">
                      <span class="vlist-t vlist-t2">
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.3011em;">
                         <span class="" style="top: -2.55em; margin-left: -0.044em; margin-right: 0.05em;">
                          <span class="pstrut" style="height: 2.7em;">
                          </span>
                          <span class="sizing reset-size6 size3 mtight">
                           <span class="mord mtight">
                            0
                           </span>
                          </span>
                         </span>
                        </span>
                        <span class="vlist-s">
                         ​
                        </span>
                       </span>
                       <span class="vlist-r">
                        <span class="vlist" style="height: 0.15em;">
                         <span class="">
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                 <span class="vlist-s">
                  ​
                 </span>
                </span>
                <span class="vlist-r">
                 <span class="vlist" style="height: 1.55em;">
                  <span class="">
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
            <span class="mclose">
             <span class="delimsizing mult">
              <span class="vlist-t vlist-t2">
               <span class="vlist-r">
                <span class="vlist" style="height: 2.05em;">
                 <span class="" style="top: -4.05em;">
                  <span class="pstrut" style="height: 5.6em;">
                  </span>
                  <span class="" style="width: 0.667em; height: 3.6em;">
                   <svg height="3.600em" viewbox="0 0 667 3600" width="0.667em">
                    <path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z">
                    </path>
                   </svg>
                  </span>
                 </span>
                </span>
                <span class="vlist-s">
                 ​
                </span>
               </span>
               <span class="vlist-r">
                <span class="vlist" style="height: 1.55em;">
                 <span class="">
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </li>
    </ol>
    <h3>
     <a id="Cecef2enuc_48">
     </a>
     三、C语言实现（保存为ecef2enu.c）
    </h3>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WGS84_A</span> <span class="token expression"><span class="token number">6378137.0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WGS84_F</span> <span class="token expression"><span class="token number">1</span><span class="token operator">/</span><span class="token number">298.257223563</span></span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span> <span class="token punctuation">}</span> ECEF<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">double</span> lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> alt<span class="token punctuation">;</span> <span class="token punctuation">}</span> Geodetic<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">double</span> e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> u<span class="token punctuation">;</span> <span class="token punctuation">}</span> ENU<span class="token punctuation">;</span>

ECEF <span class="token function">geodetic_to_ecef</span><span class="token punctuation">(</span>Geodetic geo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> a <span class="token operator">=</span> WGS84_A<span class="token punctuation">;</span>
    <span class="token keyword">double</span> f <span class="token operator">=</span> WGS84_F<span class="token punctuation">;</span>
    <span class="token keyword">double</span> e2 <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>f <span class="token operator">-</span> f<span class="token operator">*</span>f<span class="token punctuation">;</span>
    <span class="token keyword">double</span> sinphi <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>geo<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> cosphi <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>geo<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> N <span class="token operator">=</span> a <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> e2<span class="token operator">*</span>sinphi<span class="token operator">*</span>sinphi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    ECEF ecef<span class="token punctuation">;</span>
    ecef<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>N <span class="token operator">+</span> geo<span class="token punctuation">.</span>alt<span class="token punctuation">)</span> <span class="token operator">*</span> cosphi <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>geo<span class="token punctuation">.</span>lon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ecef<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>N <span class="token operator">+</span> geo<span class="token punctuation">.</span>alt<span class="token punctuation">)</span> <span class="token operator">*</span> cosphi <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>geo<span class="token punctuation">.</span>lon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ecef<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>e2<span class="token punctuation">)</span> <span class="token operator">+</span> geo<span class="token punctuation">.</span>alt<span class="token punctuation">)</span> <span class="token operator">*</span> sinphi<span class="token punctuation">;</span>
    <span class="token keyword">return</span> ecef<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ENU <span class="token function">ecef_to_enu</span><span class="token punctuation">(</span>ECEF target<span class="token punctuation">,</span> Geodetic ref_geo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ECEF ref_ecef <span class="token operator">=</span> <span class="token function">geodetic_to_ecef</span><span class="token punctuation">(</span>ref_geo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> dx <span class="token operator">=</span> target<span class="token punctuation">.</span>x <span class="token operator">-</span> ref_ecef<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">double</span> dy <span class="token operator">=</span> target<span class="token punctuation">.</span>y <span class="token operator">-</span> ref_ecef<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    <span class="token keyword">double</span> dz <span class="token operator">=</span> target<span class="token punctuation">.</span>z <span class="token operator">-</span> ref_ecef<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    
    <span class="token keyword">double</span> sinphi <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>ref_geo<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> cosphi <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>ref_geo<span class="token punctuation">.</span>lat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> sinlam <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>ref_geo<span class="token punctuation">.</span>lon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> coslam <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>ref_geo<span class="token punctuation">.</span>lon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    ENU enu<span class="token punctuation">;</span>
    enu<span class="token punctuation">.</span>e <span class="token operator">=</span> <span class="token operator">-</span>sinlam<span class="token operator">*</span>dx <span class="token operator">+</span> coslam<span class="token operator">*</span>dy<span class="token punctuation">;</span>
    enu<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token operator">-</span>sinphi<span class="token operator">*</span>coslam<span class="token operator">*</span>dx <span class="token operator">-</span> sinphi<span class="token operator">*</span>sinlam<span class="token operator">*</span>dy <span class="token operator">+</span> cosphi<span class="token operator">*</span>dz<span class="token punctuation">;</span>
    enu<span class="token punctuation">.</span>u <span class="token operator">=</span> cosphi<span class="token operator">*</span>coslam<span class="token operator">*</span>dx <span class="token operator">+</span> cosphi<span class="token operator">*</span>sinlam<span class="token operator">*</span>dy <span class="token operator">+</span> sinphi<span class="token operator">*</span>dz<span class="token punctuation">;</span>
    <span class="token keyword">return</span> enu<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 北京参考点（39.9042°N, 116.4074°E，海拔43m）</span>
    Geodetic ref <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span>lat <span class="token operator">=</span> <span class="token number">39.9042</span> <span class="token operator">*</span> M_PI<span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span>lon <span class="token operator">=</span> <span class="token number">116.4074</span> <span class="token operator">*</span> M_PI<span class="token operator">/</span><span class="token number">180</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span>alt <span class="token operator">=</span> <span class="token number">43</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 生成测试数据（实际应用时可从文件读取）</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Geodetic target_geo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">.</span>lat <span class="token operator">=</span> ref<span class="token punctuation">.</span>lat <span class="token operator">+</span> <span class="token number">0.01</span><span class="token operator">*</span>i<span class="token punctuation">,</span>
            <span class="token punctuation">.</span>lon <span class="token operator">=</span> ref<span class="token punctuation">.</span>lon <span class="token operator">+</span> <span class="token number">0.01</span><span class="token operator">*</span>i<span class="token punctuation">,</span>
            <span class="token punctuation">.</span>alt <span class="token operator">=</span> ref<span class="token punctuation">.</span>alt <span class="token operator">+</span> <span class="token number">10</span><span class="token operator">*</span>i
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        ECEF target_ecef <span class="token operator">=</span> <span class="token function">geodetic_to_ecef</span><span class="token punctuation">(</span>target_geo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ENU enu <span class="token operator">=</span> <span class="token function">ecef_to_enu</span><span class="token punctuation">(</span>target_ecef<span class="token punctuation">,</span> ref<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ENU: E=%.3fm, N=%.3fm, U=%.3fm\n"</span><span class="token punctuation">,</span> enu<span class="token punctuation">.</span>e<span class="token punctuation">,</span> enu<span class="token punctuation">.</span>n<span class="token punctuation">,</span> enu<span class="token punctuation">.</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     编译执行：
    </p>
    <pre><code class="prism language-bash">gcc ecef2enu.c <span class="token parameter variable">-lm</span> <span class="token parameter variable">-o</span> ecef2enu <span class="token operator">&amp;&amp;</span> ./ecef2enu
</code></pre>
    <h3>
     <a id="Python_122">
     </a>
     四、Python验证代码
    </h3>
    <pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> pyproj <span class="token keyword">import</span> Transformer
<span class="token keyword">from</span> subprocess <span class="token keyword">import</span> check_output

<span class="token comment"># 生成100个测试点</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
ref_lat<span class="token punctuation">,</span> ref_lon <span class="token operator">=</span> <span class="token number">39.9042</span><span class="token punctuation">,</span> <span class="token number">116.4074</span>
d_lats <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
d_lons <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
alts <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment"># 运行C程序获取结果</span>
c_output <span class="token operator">=</span> check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"./ecef2enu"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
c_enu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">,</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> c_output<span class="token punctuation">]</span>

<span class="token comment"># 使用pyproj计算</span>
ecef_trans <span class="token operator">=</span> Transformer<span class="token punctuation">.</span>from_crs<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">,</span> <span class="token number">4978</span><span class="token punctuation">)</span>
enu_trans <span class="token operator">=</span> Transformer<span class="token punctuation">.</span>from_crs<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">,</span> <span class="token number">4467</span><span class="token punctuation">,</span> 
                        authority<span class="token operator">=</span><span class="token string">"EPSG"</span><span class="token punctuation">,</span>
                        lon_0<span class="token operator">=</span>ref_lon<span class="token punctuation">,</span> lat_0<span class="token operator">=</span>ref_lat<span class="token punctuation">,</span> h_0<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Python计算结果</span>
    lat <span class="token operator">=</span> ref_lat <span class="token operator">+</span> d_lats<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    lon <span class="token operator">=</span> ref_lon <span class="token operator">+</span> d_lons<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    alt <span class="token operator">=</span> alts<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    
    <span class="token comment"># pyproj计算ENU</span>
    ecef <span class="token operator">=</span> ecef_trans<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> alt<span class="token punctuation">)</span>
    enu_py <span class="token operator">=</span> enu_trans<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> alt<span class="token punctuation">)</span>
    
    <span class="token comment"># 计算误差</span>
    enu_c <span class="token operator">=</span> c_enu<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">if</span> i <span class="token operator">&lt;</span><span class="token number">5</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment"># 仅示例前5个</span>
    errors<span class="token punctuation">.</span>append<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>enu_py<span class="token punctuation">)</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>enu_c<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 可视化</span>
errors <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>errors<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>errors<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'East Error Distribution'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Meters'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>errors<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'North Error Distribution'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>errors<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'East Error'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'North Error'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'enu_errors.png'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h3>
     <a id="_183">
     </a>
     五、验证结果分析
    </h3>
    <ol>
     <li>
      误差直方图显示各方向误差分布
     </li>
     <li>
      散点图展示平面误差的相关性
     </li>
     <li>
      典型误差应小于1e-4米（数值计算误差）
     </li>
    </ol>
    <p>
     该实现完整展示了从理论到实践的全流程，可通过调整测试点数量和分布进行更严格的验证。实际工程应用中需考虑坐标系的旋转顺序、大地水准面模型等更多细节。
    </p>
    <p>
     （验证代码还有BUG，不能直接运行，但是我肝不了了，该天再调了，晚安，吗喀巴卡）
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f6a7a5f64646b2f:61727469636c652f64657461696c732f313436313931323931" class_="artid" style="display:none">
 </p>
</div>


