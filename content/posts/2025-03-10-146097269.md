---
layout: post
title: "Golang学习笔记_48中介者模式"
date: 2025-03-10 19:30:00 +0800
description: "中介者模式是一种行为型设计模式，通过引入中介对象来封装一组对象间的交互，实现对象间解耦。交互中心化：所有对象通信通过中介者进行解耦网络：消除对象间的直接依赖关系动态协调：可随时调整交互规则而不影响对象。"
keywords: "Golang学习笔记_48——中介者模式"
categories: ['Golang']
tags: ['设计模式', '笔记', '学习', '中介者模式', 'Golang']
artid: "146097269"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146097269
    alt: "Golang学习笔记_48中介者模式"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146097269
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146097269
cover: https://bing.ee123.net/img/rand?artid=146097269
image: https://bing.ee123.net/img/rand?artid=146097269
img: https://bing.ee123.net/img/rand?artid=146097269
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Golang学习笔记_48——中介者模式
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <a href="https://blog.csdn.net/LuckyLay/article/details/146096029">
      Golang学习笔记_45——备忘录模式
     </a>
     <br/>
     <a href="https://blog.csdn.net/LuckyLay/article/details/146096336">
      Golang学习笔记_46——状态模式
     </a>
     <br/>
     <a href="https://blog.csdn.net/LuckyLay/article/details/146096547">
      Golang学习笔记_47——访问者模式
     </a>
    </p>
    <hr/>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h3>
     <a id="_11">
     </a>
     一、核心概念
    </h3>
    <h4>
     <a id="1__12">
     </a>
     1. 定义
    </h4>
    <p>
     <strong>
      中介者模式
     </strong>
     是一种
     <strong>
      行为型设计模式
     </strong>
     ，通过引入中介对象来封装一组对象间的交互，实现对象间解耦。其核心特点包括：
    </p>
    <ul>
     <li>
      <strong>
       交互中心化
      </strong>
      ：所有对象通信通过中介者进行
     </li>
     <li>
      <strong>
       解耦网络
      </strong>
      ：消除对象间的直接依赖关系
     </li>
     <li>
      <strong>
       动态协调
      </strong>
      ：可随时调整交互规则而不影响对象
     </li>
    </ul>
    <h4>
     <a id="2__18">
     </a>
     2. 解决的问题
    </h4>
    <p>
     •
     <strong>
      复杂网状依赖
     </strong>
     ：对象间直接引用形成复杂网络
     <br/>
     •
     <strong>
      修改扩散风险
     </strong>
     ：单个对象变更影响多个关联对象
     <br/>
     •
     <strong>
      复用困难
     </strong>
     ：因高度耦合导致组件难以独立复用
    </p>
    <h4>
     <a id="3__23">
     </a>
     3. 核心角色
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        角色
       </th>
       <th>
        作用
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Mediator
       </td>
       <td>
        定义对象间通信接口
       </td>
      </tr>
      <tr>
       <td>
        ConcreteMediator
       </td>
       <td>
        实现具体协调逻辑，维护同事对象引用
       </td>
      </tr>
      <tr>
       <td>
        Colleague
       </td>
       <td>
        定义同事对象接口，持有中介者引用
       </td>
      </tr>
      <tr>
       <td>
        ConcreteColleague
       </td>
       <td>
        具体业务对象，通过中介者与其他对象交互
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="4__31">
     </a>
     4. 类图
    </h4>
    <p>
     <img alt="中介者模式类图" src="https://i-blog.csdnimg.cn/direct/494a8191ab104a2ea69c2f9b98427f40.png"/>
    </p>
    <pre><code class="prism language-plantuml">@startuml
interface Mediator {
    + notify(sender: Colleague, event: string)
}

class ControlTower {
    - airplanes: List&lt;Airplane&gt;
    + notify(sender: Airplane, event: string)
}

interface Colleague {
    + setMediator(mediator: Mediator)
}

class Airplane {
    - mediator: Mediator
    + requestLanding()
    + receive(message: string)
}

Mediator &lt;|-- ControlTower
Colleague &lt;|-- Airplane
ControlTower --&gt; Airplane : manages

note right of ControlTower::notify
    根据事件类型协调飞机起降
    例如处理着陆请求或跑道释放通知
end note
@enduml
</code></pre>
    <h3>
     <a id="_66">
     </a>
     二、特点分析
    </h3>
    <p>
     <strong>
      优点
     </strong>
    </p>
    <ol>
     <li>
      <strong>
       简化依赖
      </strong>
      ：将N:N关系转为1:N关系
     </li>
     <li>
      <strong>
       集中控制
      </strong>
      ：交互规则统一维护于中介者
     </li>
     <li>
      <strong>
       职责清晰
      </strong>
      ：各对象专注核心职责
     </li>
    </ol>
    <p>
     <strong>
      缺点
     </strong>
    </p>
    <ol>
     <li>
      <strong>
       复杂度转移
      </strong>
      ：中介者可能成为复杂单体
     </li>
     <li>
      <strong>
       性能瓶颈
      </strong>
      ：高频通信场景存在吞吐限制
     </li>
     <li>
      <strong>
       过度设计
      </strong>
      ：简单场景增加不必要抽象
     </li>
    </ol>
    <h3>
     <a id="_77">
     </a>
     三、适用场景
    </h3>
    <h4>
     <a id="1__78">
     </a>
     1. 航空管制系统
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> AirTrafficControl <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">RequestLanding</span><span class="token punctuation">(</span>planeID <span class="token builtin">string</span><span class="token punctuation">)</span>
    <span class="token function">NotifyTakeoff</span><span class="token punctuation">(</span>planeID <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Boeing747 <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    controlTower AirTrafficControl
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Boeing747<span class="token punctuation">)</span> <span class="token function">LandingRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    b<span class="token punctuation">.</span>controlTower<span class="token punctuation">.</span><span class="token function">RequestLanding</span><span class="token punctuation">(</span><span class="token string">"BOEING-747"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2__94">
     </a>
     2. 分布式交易系统
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> TradeMediator <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">ExecuteOrder</span><span class="token punctuation">(</span>order Order<span class="token punctuation">,</span> traderID <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> StockExchange <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    participants <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Trader
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>StockExchange<span class="token punctuation">)</span> <span class="token function">ExecuteOrder</span><span class="token punctuation">(</span>o Order<span class="token punctuation">,</span> src <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> id<span class="token punctuation">,</span> trader <span class="token operator">:=</span> <span class="token keyword">range</span> s<span class="token punctuation">.</span>participants <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> id <span class="token operator">!=</span> src <span class="token punctuation">{<!-- --></span>
            trader<span class="token punctuation">.</span><span class="token function">ReceiveOrder</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="3_GUI_113">
     </a>
     3. GUI组件交互
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> UIComponent <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">OnClick</span><span class="token punctuation">(</span>mediator UIMediator<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> LoginDialog <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    mediator UIMediator
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>LoginDialog<span class="token punctuation">)</span> <span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    l<span class="token punctuation">.</span>mediator<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token string">"submit"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="Go_128">
     </a>
     四、Go语言实现示例
    </h3>
    <p>
     <img alt="示例类图" src="https://i-blog.csdnimg.cn/direct/76b930b1bbe3404a8f35f3cf586602d8.png"/>
    </p>
    <h4>
     <a id="_132">
     </a>
     完整实现代码
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> mediator_demo

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"sync"</span>
<span class="token punctuation">)</span>

<span class="token comment">// Mediator Interface</span>
<span class="token keyword">type</span> ChatMediator <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Register</span><span class="token punctuation">(</span>user User<span class="token punctuation">)</span>
    <span class="token function">Broadcast</span><span class="token punctuation">(</span>sender User<span class="token punctuation">,</span> message <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Concrete Mediator</span>
<span class="token keyword">type</span> chatRoom <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    users <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>User
    lock  sync<span class="token punctuation">.</span>RWMutex
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewChatRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ChatMediator <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>chatRoom<span class="token punctuation">{<!-- --></span>
        users<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>User<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>chatRoom<span class="token punctuation">)</span> <span class="token function">Register</span><span class="token punctuation">(</span>user User<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span>users<span class="token punctuation">[</span>user<span class="token punctuation">.</span><span class="token function">GetID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> user
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>chatRoom<span class="token punctuation">)</span> <span class="token function">Broadcast</span><span class="token punctuation">(</span>sender User<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> c<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> id<span class="token punctuation">,</span> user <span class="token operator">:=</span> <span class="token keyword">range</span> c<span class="token punctuation">.</span>users <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> id <span class="token operator">!=</span> sender<span class="token punctuation">.</span><span class="token function">GetID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            user<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>sender<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Colleague Interface</span>
<span class="token keyword">type</span> User <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">GetID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
    <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
    <span class="token function">Send</span><span class="token punctuation">(</span>message <span class="token builtin">string</span><span class="token punctuation">)</span>
    <span class="token function">Receive</span><span class="token punctuation">(</span>sender <span class="token builtin">string</span><span class="token punctuation">,</span> message <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Concrete Colleague</span>
<span class="token keyword">type</span> chatUser <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    id       <span class="token builtin">string</span>
    name     <span class="token builtin">string</span>
    mediator ChatMediator
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewUser</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> med ChatMediator<span class="token punctuation">)</span> User <span class="token punctuation">{<!-- --></span>
    u <span class="token operator">:=</span> <span class="token operator">&amp;</span>chatUser<span class="token punctuation">{<!-- --></span>
        id<span class="token punctuation">:</span>       id<span class="token punctuation">,</span>
        name<span class="token punctuation">:</span>     name<span class="token punctuation">,</span>
        mediator<span class="token punctuation">:</span> med<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    med<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
    <span class="token keyword">return</span> u
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>chatUser<span class="token punctuation">)</span> <span class="token function">GetID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>  <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> c<span class="token punctuation">.</span>id <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>chatUser<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> c<span class="token punctuation">.</span>name <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>chatUser<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"[%s] 发送消息: %s\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span>mediator<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>chatUser<span class="token punctuation">)</span> <span class="token function">Receive</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"[%s] 收到来自 %s 的消息: %s\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端使用示例</span>
<span class="token keyword">func</span> <span class="token function">ExampleUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    room <span class="token operator">:=</span> <span class="token function">NewChatRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    user1 <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span><span class="token string">"001"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> room<span class="token punctuation">)</span>
    user2 <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span><span class="token string">"002"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> room<span class="token punctuation">)</span>
    user3 <span class="token operator">:=</span> <span class="token function">NewUser</span><span class="token punctuation">(</span><span class="token string">"003"</span><span class="token punctuation">,</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span> room<span class="token punctuation">)</span>

    user1<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">"大家好！"</span><span class="token punctuation">)</span>
    user2<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">"欢迎新人！"</span><span class="token punctuation">)</span>
    user3<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">"需要帮助吗？"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_227">
     </a>
     执行结果
    </h4>
    <pre><code class="prism language-text">=== RUN   TestExampleUsage
[Alice] 发送消息: 大家好！
[Bob] 收到来自 Alice 的消息: 大家好！
[Charlie] 收到来自 Alice 的消息: 大家好！
[Bob] 发送消息: 欢迎新人！
[Alice] 收到来自 Bob 的消息: 欢迎新人！
[Charlie] 收到来自 Bob 的消息: 欢迎新人！
[Charlie] 发送消息: 需要帮助吗？
[Alice] 收到来自 Charlie 的消息: 需要帮助吗？
[Bob] 收到来自 Charlie 的消息: 需要帮助吗？
--- PASS: TestExampleUsage (0.00s)
PASS
</code></pre>
    <h3>
     <a id="_243">
     </a>
     五、高级应用
    </h3>
    <h4>
     <a id="1__244">
     </a>
     1. 智能路由中介
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> SmartRouter <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    nodes      <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Node
    trafficMgr <span class="token operator">*</span>TrafficAnalyzer
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SmartRouter<span class="token punctuation">)</span> <span class="token function">Route</span><span class="token punctuation">(</span>message Message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> s<span class="token punctuation">.</span>trafficMgr<span class="token punctuation">.</span><span class="token function">IsCongested</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>Destination<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        s<span class="token punctuation">.</span><span class="token function">RedirectToBackup</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        s<span class="token punctuation">.</span><span class="token function">SendDirect</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2__260">
     </a>
     2. 事务协调器
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">type</span> TransactionCoordinator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    services <span class="token punctuation">[</span><span class="token punctuation">]</span>Microservice
    sagaLog  <span class="token operator">*</span>SagaLogger
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>TransactionCoordinator<span class="token punctuation">)</span> <span class="token function">BeginSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> svc <span class="token operator">:=</span> <span class="token keyword">range</span> t<span class="token punctuation">.</span>services <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> svc<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
            t<span class="token punctuation">.</span><span class="token function">CompensateAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_277">
     </a>
     六、与其他模式对比
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        模式
       </th>
       <th>
        核心区别
       </th>
       <th>
        典型应用场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         观察者模式
        </strong>
       </td>
       <td>
        广播通知 vs 定向协调
       </td>
       <td>
        事件订阅系统
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         代理模式
        </strong>
       </td>
       <td>
        控制访问 vs 协调交互
       </td>
       <td>
        延迟加载对象
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         门面模式
        </strong>
       </td>
       <td>
        简化接口 vs 协调交互
       </td>
       <td>
        复杂子系统封装
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_284">
     </a>
     七、实现建议
    </h3>
    <ol>
     <li>
      <strong>
       接口分层设计
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> AdvancedMediator <span class="token keyword">interface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Register</span><span class="token punctuation">(</span>Colleague<span class="token punctuation">)</span>
    <span class="token function">Unregister</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
    <span class="token function">QueryColleagues</span><span class="token punctuation">(</span>filter <span class="token keyword">func</span><span class="token punctuation">(</span>Colleague<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Colleague
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       并发安全处理
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> SafeMediator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    colleagues sync<span class="token punctuation">.</span>Map
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SafeMediator<span class="token punctuation">)</span> <span class="token function">Register</span><span class="token punctuation">(</span>c Colleague<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    s<span class="token punctuation">.</span>colleagues<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">ID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="3">
     <li>
      <strong>
       消息协议优化
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    Header <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>
    Body   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
    Metadata ProtocolMetadata
<span class="token punctuation">}</span>
</code></pre>
    <ol start="4">
     <li>
      <strong>
       性能监控扩展
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> InstrumentedMediator <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    mediator    Mediator
    metrics     <span class="token operator">*</span>PrometheusCollector
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>i <span class="token operator">*</span>InstrumentedMediator<span class="token punctuation">)</span> <span class="token function">Broadcast</span><span class="token punctuation">(</span>msg Message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    i<span class="token punctuation">.</span>mediator<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    i<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span><span class="token function">ObserveLatency</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_328">
     </a>
     八、典型应用
    </h3>
    <ol>
     <li>
      <strong>
       微服务编排
      </strong>
      ：服务间调用协调
     </li>
     <li>
      <strong>
       物联网中枢
      </strong>
      ：设备联动控制中心
     </li>
     <li>
      <strong>
       多人游戏同步
      </strong>
      ：玩家动作协调引擎
     </li>
     <li>
      <strong>
       工作流引擎
      </strong>
      ：任务节点调度中枢
     </li>
    </ol>
    <p>
     在Go语言中实现建议：
    </p>
    <ul>
     <li>
      使用
      <code>
       context.Context
      </code>
      传递协调上下文
     </li>
     <li>
      结合channel实现事件总线机制
     </li>
     <li>
      采用接口组合实现策略可插拔
     </li>
     <li>
      利用sync.Pool优化高频消息对象
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f4c75636b794c61792f:61727469636c652f64657461696c732f313436303937323639" class_="artid" style="display:none">
 </p>
</div>


