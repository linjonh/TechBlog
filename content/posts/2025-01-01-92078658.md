---
layout: post
title: "Ubuntu上使用nginx搭建https文件服务器"
date: 2025-01-01 22:02:16 +0800
description: "1.这里我们使用nginx搭建https服务器，因为其设置比apache简单很多。使用nginx 搭"
keywords: "Ubuntu上使用nginx搭建https文件服务器"
categories: ['Linux']
tags: ['Nginx', 'Linux', 'Https']
artid: "92078658"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=92078658
    alt: "Ubuntu上使用nginx搭建https文件服务器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=92078658
featuredImagePreview: https://bing.ee123.net/img/rand?artid=92078658
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Ubuntu上使用nginx搭建https文件服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       1.这里我们使用nginx搭建https服务器，因为其设置比apache简单很多。
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     使用nginx 搭建web服务器网上有很多文档。
    </p>
    <p style="margin-left:0pt;">
     这里我使用sudo apt-get install nginx安装nginx，全部使用默认设置。
    </p>
    <p style="margin-left:0pt;">
     如果安装成功，在浏览器输入IP地址会弹出如下窗口：
    </p>
    <p style="margin-left:0pt;">
     <img alt="" class="has" height="127" src="https://i-blog.csdnimg.cn/blog_migrate/15be057a7d5d5fb6823b79132ae2fce1.png" width="553"/>
    </p>
    <p style="margin-left:0pt;">
    </p>
    <p style="margin-left:0pt;">
     到这一步你的基于nginx的web服务器已经搭建成功了。
    </p>
    <p style="margin-left:0pt;">
     下面是如何搭建https服务器以及如何把文件放到https服务器中。
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       2.搭建https服务器
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     可以参考：
    </p>
    <p style="margin-left:0pt;">
     <a href="http://www.cnblogs.com/yanghuahui/archive/2012/06/25/2561568.html" rel="nofollow">
      <u>
       <span style="color:#0000ff;">
        <u>
         http://www.cnblogs.com/yanghuahui/archive/2012/06/25/2561568.html
        </u>
       </span>
      </u>
     </a>
    </p>
    <p style="margin-left:0pt;">
     如果是默认安装nginx会安装在/usr/share/nginx/
    </p>
    <p style="margin-left:0pt;">
     进入/usr/share/nginx/创建conf文件夹。
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       2.1生成证书
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     可以通过以下步骤生成一个简单的证书：
    </p>
    <p style="margin-left:0pt;">
     首先，进入你想创建证书和私钥的目录。
    </p>
    <p style="margin-left:0pt;">
     创建服务器私钥，命令会让你输入一个口令：
    </p>
    <p style="margin-left:0pt;">
     $openssl genrsa -des3 -out server.key 1024
    </p>
    <p style="margin-left:0pt;">
     例如：
    </p>
    <p style="margin-left:0pt;">
     root@host:cd /usr/share/nginx/conf
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# openssl genrsa -des3 -out server.key 1024
    </p>
    <p style="margin-left:0pt;">
     Generating RSA private key, 1024 bit long modulus
    </p>
    <p style="margin-left:0pt;">
     ............................................++++++
    </p>
    <p style="margin-left:0pt;">
     ..++++++
    </p>
    <p style="margin-left:0pt;">
     e is 65537 (0x10001)
    </p>
    <p style="margin-left:0pt;">
     Enter pass phrase for server.key:
    </p>
    <p style="margin-left:0pt;">
     Verifying - Enter pass phrase for server.key:
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf#
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# ls -l
    </p>
    <p style="margin-left:0pt;">
     total 12
    </p>
    <p style="margin-left:0pt;">
     drwxr-xr-x 2 root root 4096  4月  1 15:09 ./
    </p>
    <p style="margin-left:0pt;">
     drwxr-xr-x 4 root root 4096  4月  1 15:05 ../
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  963  4月  1 15:09 server.key
    </p>
    <p style="margin-left:0pt;">
     生成server.key时要输入pass phrase for server.key，我都是输入的123456
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       2.2创建签名请求的证书（CSR）：
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     $openssl req -new -key server.key -out server.csr
    </p>
    <p style="margin-left:0pt;">
     例如：
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# openssl req -new -key server.key -out server.csr
    </p>
    <p style="margin-left:0pt;">
     Enter pass phrase for server.key:
    </p>
    <p style="margin-left:0pt;">
     You are about to be asked to enter information that will be incorporated
    </p>
    <p style="margin-left:0pt;">
     into your certificate request.
    </p>
    <p style="margin-left:0pt;">
     What you are about to enter is what is called a Distinguished Name or a DN.
    </p>
    <p style="margin-left:0pt;">
     There are quite a few fields but you can leave some blank
    </p>
    <p style="margin-left:0pt;">
     For some fields there will be a default value,
    </p>
    <p style="margin-left:0pt;">
     If you enter '.', the field will be left blank.
    </p>
    <p style="margin-left:0pt;">
     -----
    </p>
    <p style="margin-left:0pt;">
     Country Name (2 letter code) [AU]:CN
    </p>
    <p style="margin-left:0pt;">
     State or Province Name (full name) [Some-State]:FJ
    </p>
    <p style="margin-left:0pt;">
     Locality Name (eg, city) []:XM
    </p>
    <p style="margin-left:0pt;">
     Organization Name (eg, company) [Internet Widgits Pty Ltd]:DNI
    </p>
    <p style="margin-left:0pt;">
     Organizational Unit Name (eg, section) []:RD
    </p>
    <p style="margin-left:0pt;">
     Common Name (e.g. server FQDN or YOUR name) []:TEST
    </p>
    <p style="margin-left:0pt;">
     Email Address []:dniplex2@163.com
    </p>
    <p style="margin-left:0pt;">
    </p>
    <p style="margin-left:0pt;">
     Please enter the following 'extra' attributes
    </p>
    <p style="margin-left:0pt;">
     to be sent with your certificate request
    </p>
    <p style="margin-left:0pt;">
     A challenge password []:123456
    </p>
    <p style="margin-left:0pt;">
     An optional company name []:DNI
    </p>
    <p style="margin-left:0pt;">
     You have new mail in /var/mail/root
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf#ls -l
    </p>
    <p style="margin-left:0pt;">
     total 16
    </p>
    <p style="margin-left:0pt;">
     drwxr-xr-x 2 root root 4096  4月  1 15:12 ./
    </p>
    <p style="margin-left:0pt;">
     drwxr-xr-x 4 root root 4096  4月  1 15:05 ../
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  725  4月  1 15:12 server.csr
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  963  4月  1 15:09 server.key
    </p>
    <p style="margin-left:0pt;">
     root@lu-host:/usr/share/nginx/conf#
    </p>
    <p style="margin-left:0pt;">
     创建server.csr时会要求输入一些信息。这个可以随便填写。
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       2.3在加载SSL支持的Nginx并使用上述私钥时除去必须的口令：
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     $ cp server.key server.key.org
    </p>
    <p style="margin-left:0pt;">
     $ openssl rsa -in server.key.org -out server.key
    </p>
    <p style="margin-left:0pt;">
     例如：
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# cp server.key server.key.org
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# openssl rsa -in server.key.org -out server.key
    </p>
    <p style="margin-left:0pt;">
     Enter pass phrase for server.key.org:
    </p>
    <p style="margin-left:0pt;">
     writing RSA key
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# ls -l
    </p>
    <p style="margin-left:0pt;">
     total 12
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root 725  4月  1 15:12 server.csr
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root 887  4月  1 15:19 server.key
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root 963  4月  1 15:19 server.key.org
    </p>
    <p style="margin-left:0pt;">
     root@lu-host:/usr/share/nginx/conf# 3.2.4配置nginx
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       2.4最后标记证书使用上述私钥和CSR：
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     $openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
    </p>
    <p style="margin-left:0pt;">
     例如：
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
    </p>
    <p style="margin-left:0pt;">
     Signature ok
    </p>
    <p style="margin-left:0pt;">
     subject=/C=CN/ST=FJ/L=XM/O=DNI/OU=RD/CN=TEST/emailAddress=dniplex2@163.com
    </p>
    <p style="margin-left:0pt;">
     Getting Private key
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf# ls -l
    </p>
    <p style="margin-left:0pt;">
     total 24
    </p>
    <p style="margin-left:0pt;">
     drwxr-xr-x 2 root root 4096  4月  1 15:21 ./
    </p>
    <p style="margin-left:0pt;">
     drwxr-xr-x 4 root root 4096  4月  1 15:05 ../
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  879  4月  1 15:21 server.crt
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  725  4月  1 15:12 server.csr
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  887  4月  1 15:19 server.key
    </p>
    <p style="margin-left:0pt;">
     -rw-r--r-- 1 root root  963  4月  1 15:19 server.key.org
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx/conf#
    </p>
    <p style="margin-left:0pt;">
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       2.5修改Nginx配置文件/etc/nginx/nginx.conf，让其包含新标记的证书和私钥：
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     如果没有server{}可以在http{}中添加。
    </p>
    <p style="margin-left:0pt;">
     server{
     <!-- -->
    </p>
    <p style="margin-left:0pt;">
     server_name my_test;
    </p>
    <p style="margin-left:0pt;">
     listen 443;
    </p>
    <p style="margin-left:0pt;">
     root /usr/share/nginx;
    </p>
    <p style="margin-left:0pt;">
     autoindex on;
    </p>
    <p style="margin-left:0pt;">
     ssl on;
    </p>
    <p style="margin-left:0pt;">
     ssl_certificate /usr/share/nginx/conf/server.crt;
    </p>
    <p style="margin-left:0pt;">
     ssl_certificate_key /usr/share/nginx/conf/server.key;
    </p>
    <p style="margin-left:0pt;">
     }
    </p>
    <p style="margin-left:0pt;">
     重启nginx。
    </p>
    <p style="margin-left:0pt;">
     service nginx restart
    </p>
    <p style="margin-left:0pt;">
     这样就可以通过以下方式访问：
    </p>
    <p style="margin-left:0pt;">
     <a href="https://192.168.33.3" rel="nofollow">
      <u>
       <span style="color:#0000ff;">
        <u>
         https://192.168.33.3
        </u>
       </span>
      </u>
     </a>
    </p>
    <p style="margin-left:0pt;">
    </p>
    <p style="margin-left:0pt;">
     <strong>
      <strong>
       3如何把文件放到https服务器
      </strong>
     </strong>
    </p>
    <p style="margin-left:0pt;">
     创建download文件夹。在里面放上文件.
    </p>
    <p style="margin-left:0pt;">
     如下：
    </p>
    <p style="margin-left:0pt;">
     root@host:cd /usr/share/nginx/conf
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx# mkdir download/
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx#
    </p>
    <p style="margin-left:0pt;">
     将文件放入即可。
    </p>
    <p style="margin-left:0pt;">
     root@host:/usr/share/nginx#ls -l download/
    </p>
    <p style="margin-left:0pt;">
     test.zip
    </p>
    <p style="margin-left:0pt;">
     放好之后试试：
    </p>
    <p style="margin-left:0pt;">
     root@lu-host:/usr/share/nginx# curl --insecure
     <u>
      <span style="color:#0000ff;">
       <u>
        <a href="https://192.168.33.3/plex-media-server/1.4.3.3433-03e4cfa35/plexmediaserver-r9k-1.4.3.3433-03e4cfa35-armv7.tgz" rel="nofollow">
         https://192.168.33.3/download/test.
        </a>
        zip
       </u>
      </span>
     </u>
     -o  /tmp/test.zip
    </p>
    <p style="margin-left:0pt;">
     如果能下载成功说明搭建成功。
    </p>
    <p style="margin-left:0pt;">
     也可以通过浏览器下载：
    </p>
    <p style="margin-left:0pt;">
     浏览器输入：“
     <u>
      <span style="color:#0000ff;">
       <u>
        <a href="https://192.168.33.3/plex-media-server/1.4.3.3433-03e4cfa35/plexmediaserver-r9k-1.4.3.3433-03e4cfa35-armv7.tgz" rel="nofollow">
         https://192.168.33.3
        </a>
       </u>
      </span>
     </u>
     ”，选择download目录，选择test.zip开始下载。
    </p>
    <p style="margin-left:0pt;">
    </p>
    <p style="margin-left:0pt;">
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6c755f6c696e7578:2f61727469636c652f64657461696c732f3932303738363538" class_="artid" style="display:none">
 </p>
</div>


