---
layout: post
title: "解决post请求form-data格式后端拿不到数据问题"
date: 2024-12-24 17:51:48 +0800
description: "在调用第三方后端接口的时候，有个接口，它要求post请求头中，content-type必须为mult"
keywords: "formdata获取不到值"
categories: ['Bug']
tags: ['Python', 'Flask']
artid: "130520272"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=130520272
    alt: "解决post请求form-data格式后端拿不到数据问题"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=130520272
featuredImagePreview: https://bing.ee123.net/img/rand?artid=130520272
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     解决post请求form-data格式后端拿不到数据问题
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在调用第三方后端接口的时候，有个接口，它要求post请求头中，content-type必须为multipart/form-data的时候，一开始就是显示指定content-type格式，也就是在请求头headers={‘Content-Type’: multipart/form-data}，导致form-data数据丢失，导致后端拿不到数据，一直报错
    </p>
    <p>
     解决方法：
     <br/>
     1、不要在请求头设置headers，直接传个files字段，这样就会自动识别为multipart/form-data格式，如果files字段没有值，可以自己构建一个，比如files={ ‘a’: None }
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> reqeusts
request<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>
</code></pre>
    <p>
     2、显示设置请求头，也就是上面出现bug的做法，但是需要做个格式
    </p>
    <pre><code class="prism language-python">payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
	--</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string"> Content-Disposition: form-data; name="advertiser_id" 11111 
    --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string"> Content-Disposition: form-data; name="upload_type" UPLOAD_BY_URL 
    --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string"> Content-Disposition: form-data; name="image_url" https://p26-sign.douyinpic.com/tos-cn-v-c9e10a/ogQzCTHJRedoTNEtRfaCteAQP2G74BHI8CvIbg~tplv-noop.image?x-expires=3366331560&amp;x-signature=MkKM7TWMpNJ9xTcE0eCs%2Fxk%2Bps4%3D 
    --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string"> Content-Disposition: form-data; name="filename" 0331-维达山茶花湿厕纸-原生2-y 
    --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">-- 
    """</span></span>
</code></pre>
    <p>
     案例代码
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> uuid

<span class="token keyword">def</span> <span class="token function">upload_image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    open_api_url_prefix <span class="token operator">=</span> <span class="token string">"https://ad.oceanengine.com/open_api/"</span>
    uri <span class="token operator">=</span> <span class="token string">"2/file/image/ad/"</span>
    url <span class="token operator">=</span> open_api_url_prefix <span class="token operator">+</span> uri
    files <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># 生成边界值</span>
    boundary <span class="token operator">=</span> <span class="token string">'----WebKitFormBoundary'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 构建 multipart/form-data 格式的数据</span>
    payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""--</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">
        Content-Disposition: form-data; name="advertiser_id"
        
        17026
        --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">
        Content-Disposition: form-data; name="upload_type"
        
        UPLOAD_BY_URL
        --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">
        Content-Disposition: form-data; name="image_url"
        
        https://www.baidu.com
        --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">
        Content-Disposition: form-data; name="filename"
        
        文件名
        --</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">--
	    """</span></span>
	
	    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token string">"Access-Token"</span><span class="token punctuation">:</span> <span class="token string">"xxxx"</span><span class="token punctuation">,</span>
	        <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"multipart/form-data; boundary=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>boundary<span class="token punctuation">}</span></span><span class="token string">"</span></span>
	    <span class="token punctuation">}</span>
	
	    rsp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
	    rsp_data <span class="token operator">=</span> rsp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> rsp_data
    <span class="token keyword">if</span> __name__<span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    upload_image<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34313638303233342f:61727469636c652f64657461696c732f313330353230323732" class_="artid" style="display:none">
 </p>
</div>


