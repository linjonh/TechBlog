---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38323937383639392f:61727469636c652f64657461696c732f313436303832333230"
layout: post
title: "顶点着色器和片段着色器"
date: 2025-03-06 22:50:21 +0800
description: "我们可以通过一个比喻来理解它们的分工：想象你要画一幅由三角形组成的3D模型，顶点着色器负责确定每个三角形的“顶点位置”，而片段着色器负责给每个像素“填色”。：顶点着色器是渲染管线的第一步，它处理模型的每个顶点（比如立方体的8个角点），主要任务是将这些顶点的位置从模型自身的坐标系转换到屏幕坐标系中，同时可以修改顶点的其他属性（如颜色、法线方向、纹理坐标等）。：在顶点着色器之后，光栅化会将三角形转换为屏幕上的像素（称为“片段”），片段着色器则负责计算每个像素的颜色，比如纹理贴图、光照、阴影等效果。"
keywords: "vertexshader 和 fragmentshader"
categories: ['Unityshader']
tags: ['着色器']
artid: "146082320"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146082320
    alt: "顶点着色器和片段着色器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146082320
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146082320
cover: https://bing.ee123.net/img/rand?artid=146082320
image: https://bing.ee123.net/img/rand?artid=146082320
img: https://bing.ee123.net/img/rand?artid=146082320
---

# 顶点着色器和片段着色器

在Unity渲染中，\*\*顶点着色器（Vertex Shader）
**和**
片段着色器（Fragment Shader）\*\*是图形渲染管线中的两个核心阶段。我们可以通过一个比喻来理解它们的分工：想象你要画一幅由三角形组成的3D模型，顶点着色器负责确定每个三角形的“顶点位置”，而片段着色器负责给每个像素“填色”。

#### **1. 顶点着色器（Vertex Shader）——定位形状**

**作用**
：顶点着色器是渲染管线的第一步，它处理模型的每个顶点（比如立方体的8个角点），主要任务是将这些顶点的位置从模型自身的坐标系转换到屏幕坐标系中，同时可以修改顶点的其他属性（如颜色、法线方向、纹理坐标等）。

* **通俗理解**
  ：假设你有一个纸箱模型，顶点着色器的作用就是告诉电脑“这个纸箱应该放在屏幕的哪个位置，如何旋转或缩放”，类似确定纸箱在画面中的摆放姿势。
* **核心功能**
  ：
  + **坐标变换**
    ：将顶点从模型空间→世界空间→屏幕空间
  + **传递属性**
    ：把顶点的颜色、纹理坐标等信息传递给后续阶段。
  + **动画效果**
    ：通过修改顶点位置实现波浪形变、骨骼动画等

**代码示例**
（简化版）：

*这段代码将顶点的位置转换到屏幕空间，并保留纹理坐标供后续使用*

#### **2. 片段着色器（Fragment Shader）——填充颜色**

**作用**
：在顶点着色器之后，光栅化会将三角形转换为屏幕上的像素（称为“片段”），片段着色器则负责计算每个像素的颜色，比如纹理贴图、光照、阴影等效果。

* **通俗理解**
  ：顶点着色器摆好了纸箱的位置，片段着色器负责给纸箱表面贴上图案，或者根据光照方向计算哪部分更亮、哪部分更暗。
* **核心功能**
  ：
  + **纹理采样**
    ：从贴图中读取颜色（比如纸箱的包装图案）
  + **光照计算**
    ：根据光源方向、材质属性等计算像素的最终颜色
  + **特效处理**
    ：比如透明度混合、火焰效果、水面折射等

**代码示例**
（简化版）：

```cpp
fixed4 frag (v2f i) : SV_Target {
    fixed4 col = tex2D(_MainTex, i.uv); // 从纹理中采样颜色
    return col; // 输出像素颜色
}
```

*这段代码根据顶点传递的纹理坐标，从贴图中获取颜色并输出到屏幕*

#### **3. 两者的协作流程**

1. **顶点着色器**
   处理所有顶点，确定模型在屏幕上的形状。
2. **光栅化**
   将三角形拆解为像素（片段）。
3. **片段着色器**
   对每个像素进行颜色计算，最终输出图像。

**举个实际例子**
：

* 如果想让一个旗帜飘动，顶点着色器修改顶点的位置来模拟波动，片段着色器根据纹理和光照计算旗帜的颜色

#### **4. 关键区别**

| **维度** | **顶点着色器** | **片段着色器** |
| --- | --- | --- |
| **处理对象** | 每个顶点（数量少，如立方体8个顶点） | 每个像素（数量多，如屏幕百万像素） |
| **性能消耗** | 较低 | 较高（逐像素计算） |
| **主要任务** | 坐标变换、传递属性 | 颜色计算、特效处理 |
| **可修改内容** | 顶点位置、法线、UV坐标等 | 像素颜色、透明度等 |

#### **5. 实际应用场景**

* **顶点着色器**
  更适合做形状变化（如动态扭曲、骨骼动画）。
* **片段着色器**
  更适合做视觉细节（如水面反光、阴影、边缘发光）。

通过两者的配合，Unity可以实现从简单的物体渲染到复杂的动态特效