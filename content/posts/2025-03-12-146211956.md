---
layout: post
title: "Redis-数据结构详解"
date: 2025-03-12 18:34:54 +0800
description: "数据结构特点典型场景String简单键值对缓存、计数器List有序、支持双向操作消息队列、最新列表Hash对象存储用户信息、商品详情Set无序、唯一标签、共同好友ZSet有序、唯一排行榜、延迟任务Bitmap位操作用户活跃统计基数估算UV统计Stream消息队列事件日志、实时数据处理。"
keywords: "Redis 数据结构详解"
categories: ['未分类']
tags: ['数据结构', '数据库', 'Redis']
artid: "146211956"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146211956
    alt: "Redis-数据结构详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146211956
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146211956
cover: https://bing.ee123.net/img/rand?artid=146211956
image: https://bing.ee123.net/img/rand?artid=146211956
img: https://bing.ee123.net/img/rand?artid=146211956
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Redis 数据结构详解
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Redis__0">
     </a>
     Redis 数据结构详解
    </h2>
    <h3>
     <a id="1_String_2">
     </a>
     1. 字符串（String）
    </h3>
    <h4>
     <a id="_3">
     </a>
     <strong>
      特点
     </strong>
    </h4>
    <ul>
     <li>
      最基本的数据类型，可存储
      <strong>
       文本
      </strong>
      、
      <strong>
       二进制数据
      </strong>
      （如图片）或
      <strong>
       数值
      </strong>
      。
     </li>
     <li>
      <strong>
       最大容量
      </strong>
      ：512MB。
     </li>
    </ul>
    <h4>
     <a id="_7">
     </a>
     <strong>
      底层实现
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       动态字符串（SDS, Simple Dynamic String）
      </strong>
      ：
      <ul>
       <li>
        预分配冗余空间（减少内存频繁分配）。
       </li>
       <li>
        二进制安全（可存储任意数据，包括
        <code>
         \0
        </code>
        ）。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_12">
     </a>
     <strong>
      常用命令
     </strong>
    </h4>
    <pre><code class="prism language-bash">SET key value          <span class="token comment"># 设置值</span>
GET key                <span class="token comment"># 获取值</span>
INCR key               <span class="token comment"># 数值+1</span>
APPEND key <span class="token string">"new"</span>       <span class="token comment"># 追加字符串</span>
STRLEN key             <span class="token comment"># 获取长度</span>
</code></pre>
    <h4>
     <a id="_21">
     </a>
     <strong>
      应用场景
     </strong>
    </h4>
    <ul>
     <li>
      缓存用户会话（Session）、计数器（如文章阅读量）、分布式锁。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2_List_26">
     </a>
     2. 列表（List）
    </h3>
    <h4>
     <a id="_27">
     </a>
     <strong>
      特点
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       有序
      </strong>
      的元素集合，支持双向操作（头尾插入/删除）。
     </li>
     <li>
      元素可重复。
     </li>
    </ul>
    <h4>
     <a id="_31">
     </a>
     <strong>
      底层实现
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       快速列表（QuickList，Redis 3.2+）
      </strong>
      ：
      <ul>
       <li>
        由多个
        <strong>
         压缩列表（ZipList）
        </strong>
        节点组成的双向链表。
       </li>
       <li>
        平衡内存效率和操作速度。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_36">
     </a>
     <strong>
      常用命令
     </strong>
    </h4>
    <pre><code class="prism language-bash">LPUSH key value1       <span class="token comment"># 头部插入</span>
RPOP key               <span class="token comment"># 尾部删除</span>
LRANGE key <span class="token number">0</span> <span class="token parameter variable">-1</span>        <span class="token comment"># 获取所有元素</span>
LINDEX key <span class="token number">0</span>           <span class="token comment"># 获取第一个元素</span>
LLEN key               <span class="token comment"># 获取长度</span>
</code></pre>
    <h4>
     <a id="_45">
     </a>
     <strong>
      应用场景
     </strong>
    </h4>
    <ul>
     <li>
      消息队列（生产者-消费者模型）、最新消息排行（如微博时间线）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="3_Hash_50">
     </a>
     3. 哈希（Hash）
    </h3>
    <h4>
     <a id="_51">
     </a>
     <strong>
      特点
     </strong>
    </h4>
    <ul>
     <li>
      键值对集合，适合存储
      <strong>
       对象
      </strong>
      （如用户信息）。
     </li>
     <li>
      可单独操作字段，无需读取整个哈希。
     </li>
    </ul>
    <h4>
     <a id="_55">
     </a>
     <strong>
      底层实现
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       ZipList（元素少时）
      </strong>
      或
      <strong>
       HashTable（元素多时）
      </strong>
      ：
      <ul>
       <li>
        默认使用
        <code>
         ZipList
        </code>
        （内存紧凑），当元素数量或大小超过阈值时转为
        <code>
         HashTable
        </code>
        。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_59">
     </a>
     <strong>
      常用命令
     </strong>
    </h4>
    <pre><code class="prism language-bash">HSET user:1 name <span class="token string">"John"</span>  <span class="token comment"># 设置字段</span>
HGET user:1 name         <span class="token comment"># 获取字段</span>
HGETALL user:1           <span class="token comment"># 获取所有字段</span>
HDEL user:1 age          <span class="token comment"># 删除字段</span>
</code></pre>
    <h4>
     <a id="_67">
     </a>
     <strong>
      应用场景
     </strong>
    </h4>
    <ul>
     <li>
      存储对象（用户信息、商品详情）、聚合统计（如用户标签）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="4_Set_72">
     </a>
     4. 集合（Set）
    </h3>
    <h4>
     <a id="_73">
     </a>
     <strong>
      特点
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       无序
      </strong>
      、
      <strong>
       唯一
      </strong>
      的元素集合。
     </li>
     <li>
      支持交集、并集、差集运算。
     </li>
    </ul>
    <h4>
     <a id="_77">
     </a>
     <strong>
      底层实现
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       IntSet（整数集合）
      </strong>
      或
      <strong>
       HashTable
      </strong>
      ：
      <ul>
       <li>
        元素全为整数且数量较少时使用
        <code>
         IntSet
        </code>
        ，否则转为
        <code>
         HashTable
        </code>
        。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_81">
     </a>
     <strong>
      常用命令
     </strong>
    </h4>
    <pre><code class="prism language-bash">SADD tags <span class="token string">"Java"</span>        <span class="token comment"># 添加元素</span>
SREM tags <span class="token string">"Python"</span>      <span class="token comment"># 删除元素</span>
SMEMBERS tags           <span class="token comment"># 获取所有元素</span>
SINTER set1 set2        <span class="token comment"># 求交集</span>
SCARD tags              <span class="token comment"># 获取元素数量</span>
</code></pre>
    <h4>
     <a id="_90">
     </a>
     <strong>
      应用场景
     </strong>
    </h4>
    <ul>
     <li>
      标签系统（如文章标签）、共同好友（社交关系）、去重（UV统计）。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5_Sorted_Set__ZSet_95">
     </a>
     5. 有序集合（Sorted Set / ZSet）
    </h3>
    <h4>
     <a id="_96">
     </a>
     <strong>
      特点
     </strong>
    </h4>
    <ul>
     <li>
      元素
      <strong>
       唯一
      </strong>
      ，每个元素关联一个
      <strong>
       分数（Score）
      </strong>
      ，按分数排序。
     </li>
     <li>
      支持范围查询和排名操作。
     </li>
    </ul>
    <h4>
     <a id="_100">
     </a>
     <strong>
      底层实现
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       跳跃表（SkipList） + HashTable
      </strong>
      ：
      <ul>
       <li>
        <code>
         HashTable
        </code>
        存储元素到分数的映射。
       </li>
       <li>
        <code>
         SkipList
        </code>
        按分数排序，支持快速范围查询。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_105">
     </a>
     <strong>
      常用命令
     </strong>
    </h4>
    <pre><code class="prism language-bash">ZADD rank <span class="token number">90</span> <span class="token string">"Alice"</span>    <span class="token comment"># 添加元素</span>
ZRANGE rank <span class="token number">0</span> <span class="token parameter variable">-1</span> WITHSCORES  <span class="token comment"># 按分数升序获取</span>
ZREVRANK rank <span class="token string">"Bob"</span>     <span class="token comment"># 获取元素排名（降序）</span>
ZCOUNT rank <span class="token number">80</span> <span class="token number">100</span>      <span class="token comment"># 统计分数区间内的元素</span>
</code></pre>
    <h4>
     <a id="_113">
     </a>
     <strong>
      应用场景
     </strong>
    </h4>
    <ul>
     <li>
      排行榜（游戏积分）、延迟队列（按时间戳排序）、带权重的任务调度。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="6__118">
     </a>
     6. 其他高级数据结构
    </h3>
    <h4>
     <a id="61_Bitmap_119">
     </a>
     6.1 位图（Bitmap）
    </h4>
    <ul>
     <li>
      <strong>
       本质
      </strong>
      ：字符串的二进制位操作。
     </li>
     <li>
      <strong>
       命令
      </strong>
      ：
      <pre><code class="prism language-bash">SETBIT user:login:202310 <span class="token number">5</span> <span class="token number">1</span>  <span class="token comment"># 记录用户第5天登录</span>
BITCOUNT user:login:202310    <span class="token comment"># 统计当月登录天数</span>
</code></pre>
     </li>
     <li>
      <strong>
       应用
      </strong>
      ：用户活跃度统计、布隆过滤器。
     </li>
    </ul>
    <h4>
     <a id="62_HyperLogLog_128">
     </a>
     6.2 HyperLogLog
    </h4>
    <ul>
     <li>
      <strong>
       特点
      </strong>
      ：用于基数统计（估算不重复元素数量），误差率约 0.81%。
     </li>
     <li>
      <strong>
       命令
      </strong>
      ：
      <pre><code class="prism language-bash">PFADD ip_visitors <span class="token string">"192.168.1.1"</span>
PFCOUNT ip_visitors          <span class="token comment"># 估算唯一IP数</span>
</code></pre>
     </li>
     <li>
      <strong>
       应用
      </strong>
      ：大规模去重统计（如UV）。
     </li>
    </ul>
    <h4>
     <a id="63_GEO_137">
     </a>
     6.3 地理空间（GEO）
    </h4>
    <ul>
     <li>
      <strong>
       底层
      </strong>
      ：基于
      <code>
       ZSet
      </code>
      实现，存储经纬度。
     </li>
     <li>
      <strong>
       命令
      </strong>
      ：
      <pre><code class="prism language-bash">GEOADD cities <span class="token number">116.40</span> <span class="token number">39.90</span> <span class="token string">"Beijing"</span>
GEODIST cities <span class="token string">"Beijing"</span> <span class="token string">"Shanghai"</span> km  <span class="token comment"># 计算距离</span>
</code></pre>
     </li>
     <li>
      <strong>
       应用
      </strong>
      ：附近的人、地理位置搜索。
     </li>
    </ul>
    <h4>
     <a id="64_StreamRedis_50_146">
     </a>
     6.4 流（Stream，Redis 5.0+）
    </h4>
    <ul>
     <li>
      <strong>
       特点
      </strong>
      ：持久化的消息队列，支持消费者组。
     </li>
     <li>
      <strong>
       命令
      </strong>
      ：
      <pre><code class="prism language-bash">XADD mystream * field1 <span class="token string">"value1"</span>  <span class="token comment"># 添加消息</span>
XREAD COUNT <span class="token number">10</span> STREAMS mystream <span class="token number">0</span>  <span class="token comment"># 读取消息</span>
</code></pre>
     </li>
     <li>
      <strong>
       应用
      </strong>
      ：事件溯源、日志收集。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="7__157">
     </a>
     7. 数据结构选择总结
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        数据结构
       </th>
       <th>
        特点
       </th>
       <th>
        典型场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        String
       </td>
       <td>
        简单键值对
       </td>
       <td>
        缓存、计数器
       </td>
      </tr>
      <tr>
       <td>
        List
       </td>
       <td>
        有序、支持双向操作
       </td>
       <td>
        消息队列、最新列表
       </td>
      </tr>
      <tr>
       <td>
        Hash
       </td>
       <td>
        对象存储
       </td>
       <td>
        用户信息、商品详情
       </td>
      </tr>
      <tr>
       <td>
        Set
       </td>
       <td>
        无序、唯一
       </td>
       <td>
        标签、共同好友
       </td>
      </tr>
      <tr>
       <td>
        ZSet
       </td>
       <td>
        有序、唯一
       </td>
       <td>
        排行榜、延迟任务
       </td>
      </tr>
      <tr>
       <td>
        Bitmap
       </td>
       <td>
        位操作
       </td>
       <td>
        用户活跃统计
       </td>
      </tr>
      <tr>
       <td>
        HyperLogLog
       </td>
       <td>
        基数估算
       </td>
       <td>
        UV统计
       </td>
      </tr>
      <tr>
       <td>
        Stream
       </td>
       <td>
        消息队列
       </td>
       <td>
        事件日志、实时数据处理
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="8__171">
     </a>
     8. 底层编码优化
    </h3>
    <p>
     Redis 根据数据量和元素类型自动选择编码方式以节省内存：
    </p>
    <ul>
     <li>
      <strong>
       Hash / ZSet / List
      </strong>
      ：小数据量时使用
      <code>
       ZipList
      </code>
      ，大数据量时转为
      <code>
       HashTable
      </code>
      或
      <code>
       SkipList
      </code>
      。
     </li>
     <li>
      <strong>
       Set
      </strong>
      ：整数元素且数量少时使用
      <code>
       IntSet
      </code>
      ，否则转为
      <code>
       HashTable
      </code>
      。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="9__178">
     </a>
     9. 注意事项
    </h3>
    <ol>
     <li>
      <strong>
       内存优化
      </strong>
      ：合理选择数据结构（如小数据用
      <code>
       Hash
      </code>
      而非多个
      <code>
       String
      </code>
      ）。
     </li>
     <li>
      <strong>
       时间复杂度
      </strong>
      ：关注命令的时间复杂度（如
      <code>
       ZRANGE
      </code>
      为 O(log N)）。
     </li>
     <li>
      <strong>
       持久化
      </strong>
      ：RDB/AOF 对数据结构的存储效率不同。
     </li>
    </ol>
    <p>
     通过合理选择数据结构和编码方式，可显著提升 Redis 性能和内存利用率。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33373230353539372f:61727469636c652f64657461696c732f313436323131393536" class_="artid" style="display:none">
 </p>
</div>


