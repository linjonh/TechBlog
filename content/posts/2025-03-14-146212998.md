---
layout: post
title: "WPF程序使用AutoUpdate实现自动更新"
date: 2025-03-14 00:51:42 +0800
description: "AutoUpdater.NET 是一个开源库，支持从各种源（如GitHub、FTP、HTTP服务器等）下载并安装更新。它提供了灵活的配置选项，允许开发者根据需求定制更新检查逻辑和用户体验。"
keywords: "上传一台服务器代码 剩余的10台自动更新"
categories: ['未分类']
tags: ['Wpf']
artid: "146212998"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146212998
    alt: "WPF程序使用AutoUpdate实现自动更新"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146212998
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146212998
cover: https://bing.ee123.net/img/rand?artid=146212998
image: https://bing.ee123.net/img/rand?artid=146212998
img: https://bing.ee123.net/img/rand?artid=146212998
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     WPF程序使用AutoUpdate实现自动更新
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="AutoUpdateNET_0">
     </a>
     AutoUpdate.NET使用
    </h3>
    <h4>
     <a id="AutoUpdaterNET__1">
     </a>
     一、AutoUpdater.NET 简介
    </h4>
    <p>
     AutoUpdater.NET 是一个开源库，支持从各种源（如GitHub、FTP、HTTP服务器等）下载并安装更新。它提供了灵活的配置选项，允许开发者根据需求定制更新检查逻辑和用户体验。
    </p>
    <h4>
     <a id="_AutoUpdaterNET_3">
     </a>
     二、安装 AutoUpdater.NET
    </h4>
    <p>
     你可以通过 NuGet 包管理器来安装 AutoUpdater.NET。在你的 Visual Studio 中，打开“包管理器控制台”，然后输入以下命令：
    </p>
    <pre><code class="prism language-csharp">Install<span class="token operator">-</span>Package AutoUpdater<span class="token punctuation">.</span>NET
</code></pre>
    <p>
     也可以通过nuget包的方式来安装：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1033ebba44af403b9cc8d2aa7f2d6bdb.png"/>
    </p>
    <h4>
     <a id="AutoUpdaterNET__11">
     </a>
     三、AutoUpdater.NET 基本用法
    </h4>
    <p>
     1.配置更新源：首先需要配置一个版本更新文件，可以为Json格式也可以为Xml,该文件指明当前配置源的软件版本以及下载地址，软件版本用于客户端软件更新时进行校验。
     <br/>
     2.检查更新：使用库提供的方法检查是否有新版本可用。
     <br/>
     3.下载并安装更新：如果检测到新版本，下载更新包并自动安装。
    </p>
    <h4>
     <a id="IISAutoUpdateNET_15">
     </a>
     四、使用IIS部署对应AutoUpdate.NET配置源文件以及软件程序
    </h4>
    <p>
     1.打开IIS新建网站，在网站添加对应文件夹为Downloads以及Updates文件夹
     <br/>
     Downloads文件夹存放软件生成文件的压缩包、或者可以打包成可执行程序
     <br/>
     Updates文件夹存放配置源文件 可以是Json格式也可以是XML
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f7944f2d65ec491f894328c309bbcb09.png"/>
    </p>
    <p>
     XML格式：
    </p>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version='1.0' encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--在版本标记之间提供应用程序的最新版本。版本必须为X.X.X.X格式。--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 
    <span class="token comment">&lt;!--在url标签之间提供最新版本安装程序文件或zip文件的url。自动更新。NET下载这里提供的文件，并在用户按下Update按钮时安装它。--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://127.0.0.1/Downloads/Updates.zip<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--在changelog标记之间提供应用程序更改日志的URL。如果你不提供变更日志的URL，那么更新对话框将不会显示变更日志。--&gt;</span>
    <span class="token comment">&lt;!--如果你不想让用户跳过这个版本，可以将其设置为true。这将忽略“稍后提醒”和“跳过”选项，并在更新对话框中隐藏“稍后提醒”和“跳过”按钮。--&gt;</span>
    <span class="token comment">&lt;!--mandatory mode="2"&gt;true&lt;/mandatory --&gt;</span>
    <span class="token comment">&lt;!--可以在强制元素上提供minVersion属性。当您提供该选项时，只有当安装的应用程序版本小于您在这里指定的最小版本时才会触发强制选项。--&gt;</span>
    <span class="token comment">&lt;!--mandatory minVersion="1.2.0.0"&gt;true&lt;/mandatory --&gt;</span>
    <span class="token comment">&lt;!--args(可选):您可以在这个标记之间为安装程序提供命令行参数。您可以在命令行参数中包含%path%，它将被当前正在执行的应用程序所在目录的path所取代。--&gt;</span>
    <span class="token comment">&lt;!--mandatory args="xxxxx"&gt;false&lt;/mandatory --&gt;</span>
    <span class="token comment">&lt;!--提供更新文件的校验和。如果你做这个autotoupater。NET将在执行更新过程之前比较下载文件的校验和，以检查文件的完整性。
    您可以在校验和标记中提供algorithm属性，以指定应该使用哪个算法来生成下载文件的校验和。目前支持MD5、SHA1、SHA256、SHA384和SHA512。--&gt;</span>
    <span class="token comment">&lt;!--checksum algorithm="MD5"&gt;Update file Checksum&lt;/checksum --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     XML文件中可以配置源更新的很多属性，例如当前服务端最新的软件版本号，以及是否强制用户进行更新属性。
     <br/>
     Url属性可以配置软件更新的文件形式以及地址，这里可以使用打包的Updates.exe执行程序
    </p>
    <h4>
     <a id="_45">
     </a>
     五、客户端代码设置
    </h4>
    <p>
     示例：
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">AutoUpdaterDotNET</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Documents</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Media</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>Imaging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Navigation</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Shapes</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">AutoUpdateTest</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// MainWindow.xaml 的交互逻辑</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">MainWindow</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Window</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token function">MainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//这里编写自定义触发事件</span>
            AutoUpdater<span class="token punctuation">.</span>CheckForUpdateEvent <span class="token operator">+=</span> AutoUpdater_CheckForUpdateEvent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutoUpdater_CheckForUpdateEvent</span><span class="token punctuation">(</span><span class="token class-name">UpdateInfoEventArgs</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">//请求是否有问题</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>Error <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">//检测当前版本是否可以更新</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>IsUpdateAvailable<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"发现新版本"</span><span class="token punctuation">,</span><span class="token interpolation-string"><span class="token string">$"V</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">args<span class="token punctuation">.</span>InstalledVersion</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>MessageBoxButton<span class="token punctuation">.</span>YesNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> MessageBoxResult<span class="token punctuation">.</span>Yes<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>AutoUpdater<span class="token punctuation">.</span><span class="token function">DownloadUpdate</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            Environment<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
		
		<span class="token comment">//此处点击触发更新事件</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Button_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//指定当前版本</span>
            AutoUpdater<span class="token punctuation">.</span>InstalledVersion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Version</span><span class="token punctuation">(</span><span class="token string">"1.0.1.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前的App版本</span>
            AutoUpdater<span class="token punctuation">.</span>HttpUserAgent <span class="token operator">=</span> <span class="token string">"AutoUpdater"</span><span class="token punctuation">;</span>
            AutoUpdater<span class="token punctuation">.</span>ReportErrors <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token comment">//AutoUpdater.ShowSkipButton = false;//禁用跳过</span>
            <span class="token comment">//AutoUpdater.ShowRemindLaterButton = false;//禁用稍后提醒</span>

            <span class="token comment">稍后提醒设置</span>
            <span class="token comment">//AutoUpdater.LetUserSelectRemindLater = false;</span>
            <span class="token comment">//AutoUpdater.RemindLaterTimeSpan = RemindLaterFormat.Days;</span>
            <span class="token comment">//AutoUpdater.RemindLaterAt = 2;</span>
            <span class="token comment">//AutoUpdater.TopMost = true;</span>
			<span class="token comment">//此处的url为服务器存放的xml文件地址</span>
            AutoUpdater<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:7077/Updates/AutoUpdaterStarter.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     使用生成文件zip压缩包的形式更新，将debug文件夹中文件打包放入服务器Downloads文件夹
    </p>
    <p>
     并且更新此时Updates文件夹中xml的文件版本到1.0.1.1
    </p>
    <p>
     此时点击更新，由于客户端此时版本为V1.0.1.0 服务器配置源文件为V1.0.1.1
    </p>
    <p>
     满足触发更新的条件，于是从xml的下载链接中下载对应zip压缩包并且解压到对应设置的目录
    </p>
    <pre><code class="prism language-csharp"><span class="token comment">//设置下载后的压缩包存储地址 如果不设置采用默认</span>
 AutoUpdater<span class="token punctuation">.</span>DownloadPath <span class="token operator">=</span> AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token operator">+</span><span class="token string">@"\AutoUpdater"</span><span class="token punctuation">;</span>
 <span class="token comment">//设置安装地址 对于zip压缩包 对应的就是解压的地址</span>
 AutoUpdater<span class="token punctuation">.</span>InstallationPath <span class="token operator">=</span> AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">;</span>
</code></pre>
    <p>
     对应zip压缩包会下载到设置的地址
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/dda9836d74034c59983e819045cf97a2.png"/>
    </p>
    <p>
     更新前 V1.0.1.0
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5c90b3e7ccad44b688da20e799fc55a6.png"/>
    </p>
    <p>
     点击更新
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/feb061b985d14526b41124cd995a9361.png"/>
    </p>
    <p>
     更新后 版本V1.0.1.2
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/cf266de7aae8457aa327d1ea6d395306.png"/>
    </p>
    <h4>
     <a id="_148">
     </a>
     常见问题
    </h4>
    <p>
     401-未授权：由于凭证无效，访问被拒绝
     <br/>
     原因：文件访问未授权
     <br/>
     症状：HTTP 错误 401.1 - 未经授权：访问由于凭据无效被拒绝。
     <br/>
     分析：
     <br/>
     由于用户匿名访问使用的账号(默认是IUSR_机器名)被禁用，或者没有权限访问计算机，将造成用户无法访问。
     <br/>
     解决方案：
     <br/>
     （1）查看IIS管理器中站点安全设置的匿名帐户是否被禁用，如果是，请尝试用以下办法启用：
     <br/>
     控制面板-&gt;管理工具-&gt;计算机管理-&gt;本地用户和组，将IUSR_机器名账号启用。如果还没有解决，请继续下一步。
     <br/>
     （2）查看本地安全策略中，IIS管理器中站点的默认匿名访问帐号或者其所属的组是否有通过网络访问服务器的权限，如果没有尝试用以下步骤赋予权限：
     <br/>
     开始-&gt;程序-&gt;管理工具-&gt;本地安全策略-&gt;安全策略-&gt;本地策略-&gt;用户权限分配，双击“从网络访问此计算机”，添加IIS默认用户或者其所属的组。
     <br/>
     注意：一般自定义 IIS默认匿名访问帐号都属于组，为了安全，没有特殊需要，请遵循此规则。
    </p>
    <p>
     选择服务器存放文件的文件夹
     <br/>
     属性-&gt;安全-&gt;编辑-&gt;添加-&gt;高级-&gt;立即查找-&gt;找到IUSR-&gt;添加-&gt;设置权限完全控制
    </p>
    <p>
     参考：https://blog.csdn.net/Tiger_shl/article/details/80618097
    </p>
    <h4>
     <a id="_165">
     </a>
     参考链接：
    </h4>
    <p>
     https://github.com/ravibpatel/AutoUpdater.NET
     <br/>
     https://www.cnblogs.com/congroo/p/15655717.html
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34343936373231332f:61727469636c652f64657461696c732f313436323132393938" class_="artid" style="display:none">
 </p>
</div>


