---
layout: post
title: "django-运行时仅显示500-但是不提示其他内容-如何令其显示更多错误信息"
date: 2025-03-13 00:30:47 +0800
description: "•开发环境：直接启用查看完整错误。•生产环境• 配置日志记录（LOGGING• 使用自定义错误视图和中间件记录详细信息。• 检查服务器配置是否拦截了错误响应。• 通过监控工具（如 Sentry）实时捕获错误。"
keywords: "django 运行时仅显示500 但是不提示其他内容 如何令其显示更多错误信息"
categories: ['Django']
tags: ['数据库', 'Sqlite', 'Django']
artid: "146218731"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146218731
    alt: "django-运行时仅显示500-但是不提示其他内容-如何令其显示更多错误信息"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146218731
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146218731
cover: https://bing.ee123.net/img/rand?artid=146218731
image: https://bing.ee123.net/img/rand?artid=146218731
img: https://bing.ee123.net/img/rand?artid=146218731
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     django 运行时仅显示500 但是不提示其他内容 如何令其显示更多错误信息
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 Django 中，当发生 500 错误时默认仅显示简单的错误页面（不包含堆栈跟踪等详细信息），这通常是因为
     <strong>
      生产环境配置禁用了调试模式
     </strong>
     （
     <code>
      DEBUG = False
     </code>
     ）。以下是逐步解决方案，帮助你显示更详细的错误信息：
    </p>
    <hr/>
    <h4>
     <a id="1__6">
     </a>
     1.
     <strong>
      启用调试模式（仅限开发环境！）
     </strong>
    </h4>
    <p>
     在
     <code>
      settings.py
     </code>
     中设置
     <code>
      DEBUG = True
     </code>
     ，并确保
     <code>
      ALLOWED_HOSTS
     </code>
     包含你的访问域名或 IP：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># settings.py</span>
DEBUG <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 开启调试模式</span>
ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token string">'你的服务器IP'</span><span class="token punctuation">]</span>  <span class="token comment"># 允许访问的主机</span>
</code></pre>
    <p>
     •
     <strong>
      效果
     </strong>
     ：错误页面将显示完整的堆栈跟踪、局部变量、请求信息等。
     <br/>
     •
     <strong>
      警告
     </strong>
     ：
     <strong>
      切勿在生产环境中启用
      <code>
       DEBUG = True
      </code>
     </strong>
     ，否则会暴露敏感信息（如密钥、代码路径）。
    </p>
    <hr/>
    <h4>
     <a id="2__DEBUG__False_18">
     </a>
     2.
     <strong>
      强制显示错误详情（即使
      <code>
       DEBUG = False
      </code>
      ）
     </strong>
    </h4>
    <p>
     如果需要在生产环境临时查看错误详情（不推荐长期开启），可以修改
     <code>
      settings.py
     </code>
     ：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># settings.py</span>
DEBUG_PROPAGATE_EXCEPTIONS <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 传播异常到服务器（如Gunicorn/Uvicorn）</span>
</code></pre>
    <p>
     然后通过服务器日志（如
     <code>
      gunicorn.error
     </code>
     或
     <code>
      nginx error.log
     </code>
     ）查看完整错误。
    </p>
    <hr/>
    <h4>
     <a id="3__28">
     </a>
     3.
     <strong>
      配置日志记录（推荐用于生产环境）
     </strong>
    </h4>
    <p>
     在
     <code>
      settings.py
     </code>
     中配置日志记录，将错误信息写入文件：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># settings.py</span>
LOGGING <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'version'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'disable_existing_loggers'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'ERROR'</span><span class="token punctuation">,</span>
            <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'logging.FileHandler'</span><span class="token punctuation">,</span>
            <span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token string">'/var/log/django/error.log'</span><span class="token punctuation">,</span>  <span class="token comment"># 日志文件路径</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'loggers'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'django'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'handlers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'level'</span><span class="token punctuation">:</span> <span class="token string">'ERROR'</span><span class="token punctuation">,</span>
            <span class="token string">'propagate'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     •
     <strong>
      查看日志
     </strong>
     ：
    </p>
    <pre><code class="prism language-bash"><span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/django/error.log  <span class="token comment"># 实时监控错误日志</span>
</code></pre>
    <hr/>
    <h4>
     <a id="4__58">
     </a>
     4.
     <strong>
      自定义错误视图（生产环境友好）
     </strong>
    </h4>
    <p>
     创建自定义错误页面，在发生 500 错误时记录详细信息：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># views.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> requires_csrf_token
<span class="token keyword">from</span> django<span class="token punctuation">.</span>template <span class="token keyword">import</span> RequestContext
<span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@requires_csrf_token</span>
<span class="token keyword">def</span> <span class="token function">server_error</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> template_name<span class="token operator">=</span><span class="token string">'500.html'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 记录错误信息</span>
    logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"500 Error: %s"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>path<span class="token punctuation">,</span> exc_info<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> template_name<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     在
     <code>
      urls.py
     </code>
     中注册：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># urls.py</span>
handler500 <span class="token operator">=</span> <span class="token string">'myapp.views.server_error'</span>  <span class="token comment"># 指向自定义视图</span>
</code></pre>
    <hr/>
    <h4>
     <a id="5__83">
     </a>
     5.
     <strong>
      使用中间件捕获异常
     </strong>
    </h4>
    <p>
     创建中间件捕获所有异常并记录详细信息：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># middleware.py</span>
<span class="token keyword">import</span> traceback
<span class="token keyword">import</span> logging

logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ExceptionLoggingMiddleware</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> get_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>get_response <span class="token operator">=</span> get_response

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> self<span class="token punctuation">.</span>get_response<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token keyword">return</span> response

    <span class="token keyword">def</span> <span class="token function">process_exception</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 记录完整的堆栈跟踪</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span>
            <span class="token string">"Unhandled Exception: %s\n%s"</span><span class="token punctuation">,</span>
            <span class="token builtin">str</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">,</span>
            traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>  <span class="token comment"># 继续返回默认500响应</span>
</code></pre>
    <p>
     在
     <code>
      settings.py
     </code>
     中添加中间件：
    </p>
    <pre><code class="prism language-python">MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># ...</span>
    <span class="token string">'myapp.middleware.ExceptionLoggingMiddleware'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
    <hr/>
    <h4>
     <a id="6_NginxApache_120">
     </a>
     6.
     <strong>
      服务器配置（Nginx/Apache）
     </strong>
    </h4>
    <p>
     确保服务器不会覆盖 Django 的错误响应。例如在 Nginx 中，关闭对 500 错误的拦截：
    </p>
    <pre><code class="prism language-nginx"># nginx.conf
server {
    ...
    error_page 500 502 503 504 /500.html;  # 注释或删除此行以允许 Django 处理错误
    location / {
        proxy_intercept_errors off;  # 禁止Nginx拦截错误
        proxy_pass http://django_app;
    }
}
</code></pre>
    <hr/>
    <h4>
     <a id="7__Django_Debug_Toolbar_136">
     </a>
     7.
     <strong>
      使用 Django Debug Toolbar（仅限开发）
     </strong>
    </h4>
    <p>
     安装调试工具栏以实时查看请求详情：
    </p>
    <pre><code class="prism language-bash">pip <span class="token function">install</span> django-debug-toolbar
</code></pre>
    <p>
     在
     <code>
      settings.py
     </code>
     中配置：
    </p>
    <pre><code class="prism language-python"><span class="token comment"># settings.py</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># ...</span>
    <span class="token string">'debug_toolbar'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'debug_toolbar.middleware.DebugToolbarMiddleware'</span><span class="token punctuation">,</span>
    <span class="token comment"># ...</span>
<span class="token punctuation">]</span>

INTERNAL_IPS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">]</span>  <span class="token comment"># 允许访问的IP</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_159">
     </a>
     总结
    </h4>
    <p>
     •
     <strong>
      开发环境
     </strong>
     ：直接启用
     <code>
      DEBUG = True
     </code>
     查看完整错误。
     <br/>
     •
     <strong>
      生产环境
     </strong>
     ：
     <br/>
     • 配置日志记录（
     <code>
      LOGGING
     </code>
     ）。
     <br/>
     • 使用自定义错误视图和中间件记录详细信息。
     <br/>
     • 检查服务器配置是否拦截了错误响应。
     <br/>
     • 通过监控工具（如 Sentry）实时捕获错误。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f4c43593133332f:61727469636c652f64657461696c732f313436323138373331" class_="artid" style="display:none">
 </p>
</div>


