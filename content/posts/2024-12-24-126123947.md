---
layout: post
title: 2024-12-24-OpenStackäº‘å¹³å°æ­å»ºopenstackäº‘å¹³å°
date: 2024-12-24 13:15:52 +08:00
categories: ['äº‘è®¡ç®—', 'Linux']
tags: ['Linux', 'äº‘è®¡ç®—', 'æœåŠ¡å™¨']
image:
  path: https://img-blog.csdnimg.cn/eab5a78fd5a14c498ed7a0a07cef8a62.png?x-oss-process=image/resize,m_fixed,h_150
  alt: OpenStackäº‘å¹³å°æ­å»ºopenstackäº‘å¹³å°
artid: 126123947
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=126123947
featuredImagePreview: https://bing.ee123.net/img/rand?artid=126123947
---

# ã€OpenStackäº‘å¹³å°ã€‘æ­å»ºopenstackäº‘å¹³å°

### 1. ç³»ç»Ÿé•œåƒ

å®‰è£…è¿è¡ŒçŽ¯å¢ƒç³»ç»Ÿè¦æ±‚ä¸ºCentOS7.5ï¼Œå†…æ ¸ç‰ˆæœ¬ä¸ä½ŽäºŽ3.10ã€‚
  
CentOS-7.5-x86\_64-DVD-1804.iso
  
Chinaskill\_Cloud\_iaas.iso

### 2. ç½‘ç»œæž¶æž„åŠç¡¬ä»¶é…ç½®

| ä¸»æœºå | å†…å­˜ | ç¡¬ç›˜1 | ç¡¬ç›˜2 | IPåœ°å€(VMnet1) | IPåœ°å€(VMnet8) |
| --- | --- | --- | --- | --- | --- |
| controller | 4G | 100G | æ—  | 192.168.100.10 | 192.168.200.10 |
| compute | 4G | 100G | 200G | 192.168.100.20 | 192.168.200.20 |

### 3. åŸºç¡€çŽ¯å¢ƒéƒ¨ç½²

#### 3.1 é…ç½®æ˜ å°„ã€ä¸»æœºåã€ç½‘ç»œã€å…³é—­é˜²ç«å¢™

**computerèŠ‚ç‚¹å’ŒcomputeèŠ‚ç‚¹ï¼š**
  
ä¿®æ”¹/etc/hostsæ–‡ä»¶æ·»åŠ æ˜ å°„
  
192.168.100.10 controller
  
192.168.100.20 compute
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/f7d4927b9c172898d432478d68c76afb.png)

##### 3.1.1 controllerèŠ‚ç‚¹

**ä¿®æ”¹ä¸»æœºåï¼š**

```c
hostnamectl set-hostname controller

```

**é…ç½®ç½‘ç»œï¼š**
  
ä¿®æ”¹BOOTPROTO=dhcp ï¼ˆdhcpæ”¹ä¸ºstaticï¼‰ ONBOOT=no ï¼ˆnoæ”¹ä¸ºyesï¼‰
  
**ens33æ·»åŠ ï¼š**
  
IPADDR=192.168.100.10
  
PREFIX=24
  
GATEWAY=192.168.100.1
  
**ens34æ·»åŠ ï¼š**
  
IPADDR=192.168.200.10
  
PREFIX=24
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/d414fa4d0755e453b216121548eb20dd.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/70d6171ec0324cd822f8b13aed1a36ce.png)

**å…³é—­é˜²ç«å¢™åŠä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š**

```c
[root@controller ~]# systemctl stop firewalld	å…³é—­é˜²ç«å¢™
[root@controller ~]# systemctl disable firewalld
[root@controller ~]# vi /etc/selinux/config      
SELINUX=enforcing  ï¼ˆenforcing æ”¹ä¸ºdisabledï¼‰
[root@controller ~]# setenforce 0	#ç«‹å³ç”Ÿæ•ˆ
[root@controller ~]# getenforce

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/456748be1db9b1eca0d72f1c83bc983c.png)

##### 3.1.2 compute èŠ‚ç‚¹

**ä¿®æ”¹ä¸»æœºåï¼š**

```c
hostnamectl set-hostname compute

```

**é…ç½®ç½‘ç»œï¼š**
  
ä¿®æ”¹BOOTPROTO=dhcp ï¼ˆdhcpæ”¹ä¸ºstaticï¼‰ ONBOOT=no ï¼ˆnoæ”¹ä¸ºyesï¼‰
  
**ens33æ·»åŠ ï¼š**
  
IPADDR=192.168.100.20
  
PREFIX=24
  
GATEWAY=192.168.100.1
  
**ens34æ·»åŠ ï¼š**
  
IPADDR=192.168.200.20
  
PREFIX=24
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/4b7951e24eef691d65292928c5e3dad9.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/6f898085260ebbca4ead6fb73c07ac55.png)

**å…³é—­é˜²ç«å¢™åŠä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š**

```c
[root@compute ~]# systemctl stop firewalld	 #å…³é—­é˜²ç«å¢™
[root@compute ~]# systemctl disable firewalld
[root@compute ~]# vi /etc/selinux/config      
SELINUX=enforcing  ï¼ˆenforcing æ”¹ä¸ºdisabledï¼‰
[root@compute ~]# setenforce 0	 #ç«‹å³ç”Ÿæ•ˆ
[root@compute ~]# getenforce

```

#### 3.2 æŒ‚è½½é•œåƒã€é…ç½®yumæº

##### 3.2.1 controllerèŠ‚ç‚¹

**ä¸Šä¼ centos7.5é•œåƒå’Œchinaskills\_cloud\_iaas.isoé•œåƒè‡³controllerèŠ‚ç‚¹ã€‚**
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/d626b92fcc4c04703beceb141a080df7.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/784cafdf823e287dca8316e78e12b083.png)
  
**chinaskills\_cloud\_iaas.isoé•œåƒä¸Šä¼ æ–¹å¼å¦‚ä¸Šã€‚**

**æŸ¥çœ‹é•œåƒæ˜¯å¦å·²ä¸Šä¼ **
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/eb5b6b971cc7cfcb51e30334c446c9c5.png)

```c
[root@controller ~]# mkdir /opt/{iaas,centos}	   #åˆ›å»ºä¸¤ä¸ªæŒ‚è½½é•œåƒçš„æ–‡ä»¶å¤¹
[root@controller ~]# mv /etc/yum.repos.d/CentOS-* /home	   #å¤‡ä»½åŽŸyumæºé…ç½®æ–‡ä»¶
[root@controller ~]# vi /etc/yum.repos.d/local.repo	   #åˆ›å»ºæœ¬åœ°yumæºé…ç½®æ–‡ä»¶

[iaas]
name=iaas
baseurl=file:///opt/iaas/iaas-repo
gpgcheck=0
enabled=1
[centos]
name=centos
baseurl=file:///opt/centos
gpgcheck=0
enabled=1

[root@controller ~]# mount -o loop /CentOS-7.5-x86_64-DVD-1804.iso /opt/centos
[root@controller ~]# mount -o loop /Chinaskill_Cloud_iaas.iso /opt/iaas

[root@controller ~]# yum clean all	#æ›´æ–°yumæºé…ç½®
[root@controller ~]# yum repolist   #æ˜¾ç¤ºä»“åº“

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/5aef9e03df59cdd2f5ef11dd75417bd9.png)

```c
#æ­å»ºftpæœåŠ¡å™¨
[root@controller ~]# yum -y install vsftpd
[root@controller ~]# vi /etc/vsftpd/vsftpd.conf
æ·»åŠ  anon_root=/opt/
[root@controller ~]# systemctl restart vsftpd
[root@controller ~]# systemctl enable vsftpd

```

##### 3.2.2 computeèŠ‚ç‚¹

```c
[root@compute ~]# mv /etc/yum.repos.d/CentOS-* /home	   #å¤‡ä»½åŽŸyumæºé…ç½®æ–‡ä»¶
[root@compute ~]# vi /etc/yum.repos.d/local.repo	   #åˆ›å»ºæœ¬åœ°yumæºé…ç½®æ–‡ä»¶

[centos]
name=centos
baseurl=ftp://192.168.100.10/centos
gpgcheck=0
enabled=1
[iaas]
name=iaas
baseurl=ftp://192.168.100.10/iaas-repo
gpgcheck=0
enabled=1

[root@compute ~]# yum clean all	#æ›´æ–°yumæºé…ç½®
[root@compute ~]# yum repolist   #æ˜¾ç¤ºä»“åº“

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/11f843aad97aeb8df6e06390c45040c2.png)
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/51365fb860391ea108b0b33596a23587.png)

#### 3.3 è®¡ç®—èŠ‚ç‚¹åˆ†åŒº

åœ¨computeèŠ‚ç‚¹ä¸Šåˆ©ç”¨ç©ºç™½åˆ†åŒºåˆ’åˆ†2ä¸ª100Gåˆ†åŒºã€‚

```c
[root@compute ~]# fdisk /dev/sdb
æ¬¢è¿Žä½¿ç”¨ fdisk (util-linux 2.23.2)ã€‚
 
æ›´æ”¹å°†åœç•™åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°æ‚¨å†³å®šå°†æ›´æ”¹å†™å…¥ç£ç›˜ã€‚
ä½¿ç”¨å†™å…¥å‘½ä»¤å‰è¯·ä¸‰æ€ã€‚
 
Device does not contain a recognized partition table
ä½¿ç”¨ç£ç›˜æ ‡è¯†ç¬¦ 0x34bc5373 åˆ›å»ºæ–°çš„ DOS ç£ç›˜æ ‡ç­¾ã€‚
 
å‘½ä»¤(è¾“å…¥ m èŽ·å–å¸®åŠ©)ï¼šn
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): 
Using default response p
åˆ†åŒºå· (1-4ï¼Œé»˜è®¤ 1)ï¼š
èµ·å§‹ æ‰‡åŒº (2048-209715199ï¼Œé»˜è®¤ä¸º 2048)ï¼š
å°†ä½¿ç”¨é»˜è®¤å€¼ 2048
Last æ‰‡åŒº, +æ‰‡åŒº or +size{K,M,G} (2048-209715199ï¼Œé»˜è®¤ä¸º 209715199)ï¼š+25G
åˆ†åŒº 1 å·²è®¾ç½®ä¸º Linux ç±»åž‹ï¼Œå¤§å°è®¾ä¸º 25 GiB
 
å‘½ä»¤(è¾“å…¥ m èŽ·å–å¸®åŠ©)ï¼šn
Partition type:
   p   primary (1 primary, 0 extended, 3 free)
   e   extended
Select (default p): 
Using default response p
åˆ†åŒºå· (2-4ï¼Œé»˜è®¤ 2)ï¼š
èµ·å§‹ æ‰‡åŒº (52430848-209715199ï¼Œé»˜è®¤ä¸º 52430848)ï¼š
å°†ä½¿ç”¨é»˜è®¤å€¼ 52430848
Last æ‰‡åŒº, +æ‰‡åŒº or +size{K,M,G} (52430848-209715199ï¼Œé»˜è®¤ä¸º 209715199)ï¼š+25G
åˆ†åŒº 2 å·²è®¾ç½®ä¸º Linux ç±»åž‹ï¼Œå¤§å°è®¾ä¸º 25 GiB
 
å‘½ä»¤(è¾“å…¥ m èŽ·å–å¸®åŠ©)ï¼šw
The partition table has been altered!
 
Calling ioctl() to re-read partition table.
æ­£åœ¨åŒæ­¥ç£ç›˜ã€‚
[root@compute ~]# lsblk 
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0  200G  0 disk 
â”œâ”€sda1            8:1    0    1G  0 part /boot
â””â”€sda2            8:2    0  199G  0 part 
  â”œâ”€centos-root 253:0    0   50G  0 lvm  /
  â”œâ”€centos-swap 253:1    0    2G  0 lvm  [SWAP]
  â””â”€centos-home 253:2    0  147G  0 lvm  /home
sdb               8:16   0  100G  0 disk 
â”œâ”€sdb1            8:17   0   25G  0 part 
â””â”€sdb2            8:18   0   25G  0 part 
sr0              11:0    1  4.2G  0 rom  

```

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/01af3886f902481aaa408d747752b7fe.png)

#### 3.4 ç¼–è¾‘çŽ¯å¢ƒå˜é‡

**controllerå’ŒcomputeèŠ‚ç‚¹éƒ½è¦æ“ä½œ**

ç¼–è¾‘æ–‡ä»¶/etc/xiandian/openrc.sh,æ­¤æ–‡ä»¶æ˜¯å®‰è£…è¿‡ç¨‹ä¸­çš„å„é¡¹å‚æ•°ï¼Œæ ¹æ®æ¯é¡¹å‚æ•°ä¸Šä¸€è¡Œçš„è¯´æ˜ŽåŠæœåŠ¡å™¨å®žé™…æƒ…å†µè¿›è¡Œé…ç½®ã€‚

```c
[root@controller ~]# yum -y install iaas-xiandian
[root@controller ~]# vi /etc/xiandian/openrc.sh
[root@compute ~]# yum -y install iaas-xiandian
[root@compute ~]# vi /etc/xiandian/openrc.sh

HOST_IP=ï¼ˆæŽ§åˆ¶èŠ‚ç‚¹IPåœ°å€ï¼‰
HOST_PASS=000000
HOST_NAME=ï¼ˆæŽ§åˆ¶èŠ‚ç‚¹ä¸»æœºåï¼‰
HOST_IP_NODE=ï¼ˆè®¡ç®—èŠ‚ç‚¹IPåœ°å€ï¼‰
HOST_PASS_NODE=000000
HOST_NAME_NODE=ï¼ˆæŽ§åˆ¶èŠ‚ç‚¹ä¸»æœºåï¼‰
network_segment_IP=192.168.100.0/24
RABBIT_USER=openstack
RABBIT_PASS=000000
DB_PASS=000000
DOMAIN_NAME=demo
ADMIN_PASS=000000
DEMO_PASS=000000
KEYSTONE_DBPASS=000000
GLANCE_DBPASS=000000
GLANCE_PASS=000000
NOVA_DBPASS=000000
NOVA_PASS=000000
NEUTRON_DBPASS=000000
NEUTRON_PASS=000000
METADATA_SECRET=000000
INTERFACE_IP=ï¼ˆå½“å‰èŠ‚ç‚¹IPåœ°å€ï¼‰
INTERFACE_NAME=ens34 ï¼ˆå¤–éƒ¨ç½‘ç»œç½‘å¡åç§°ï¼‰
Physical_NAME=provider ï¼ˆå¤–éƒ¨ç½‘ç»œé€‚é…å™¨åç§°ï¼‰
minvlan=ï¼ˆvlanç½‘ç»œèŒƒå›´çš„ç¬¬ä¸€ä¸ªvlanIDï¼‰
maxvlan=vlanç½‘ç»œèŒƒå›´çš„æœ€åŽä¸€ä¸ªvlanIDï¼‰
CINDER_DBPASS=000000
CINDER_PASS=000000
BLOCK_DISK=ï¼ˆè®¡ç®—èŠ‚ç‚¹ç¬¬ä¸€å—ç£ç›˜åˆ†åŒºåï¼‰
SWIFT_PASS=000000
OBJECT_DISK=ï¼ˆè®¡ç®—èŠ‚ç‚¹ç¬¬äºŒå—ç£ç›˜åˆ†åŒºåï¼‰
STORAGE_LOCAL_NET_IP=ï¼ˆè®¡ç®—èŠ‚ç‚¹IPåœ°å€ï¼‰
HEAT_DBPASS=000000
HEAT_PASS=000000
ZUN_DBPASS=000000
ZUN_PASS=000000
KURYR_DBPASS=000000
KURYR_PASS=000000
CEILOMETER_DBPASS=000000
CEILOMETER_PASS=000000
AODH_DBPASS=000000
AODH_PASS=000000

```

#### 3.5 é€šè¿‡è„šæœ¬å®‰è£…æœåŠ¡

##### 3.5.1 æ‰§è¡Œè„šæœ¬iaas-pre-host.shè¿›è¡Œå®‰è£…

**controllerèŠ‚ç‚¹ï¼š**
  
å®‰è£…å®ŒæˆåŽåŒæ—¶é‡å¯ï¼Œé‡å¯åŽéœ€é‡æ–°æŒ‚è½½isoé•œåƒ

```c
[root@controller ~]# iaas-pre-host.sh
[root@controller ~]# reboot  #é‡å¯
[root@controller ~]# mount -o loop CentOS-7-x86_64-DVD-1804.iso /opt/centos/
[root@controller ~]# mount -o loop chinaskills_cloud_iaas.iso /opt/iaas/

```

**computeèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-pre-host.sh
[root@controller ~]# reboot  #é‡å¯

```

##### 3.5.2 Mysqlæ•°æ®åº“æœåŠ¡

**controllerèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-install-mysql.sh

```

##### 3.5.3 keystoneè®¤è¯æœåŠ¡

**controllerèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-install-keystone.s

```

##### 3.5.4 Glanceé•œåƒæœåŠ¡

**controllerèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-install-glance.sh

```

##### 3.5.5 novaè®¡ç®—æœåŠ¡

**controllerèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-install-nova-controller.sh

```

**computeèŠ‚ç‚¹ï¼š**

```c
[root@compute ~]# iaas-install-nova-compute.sh 

```

##### 3.5.6 Neutronç½‘ç»œæœåŠ¡

**controllerèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-install-neutron-controller.sh

```

**computeèŠ‚ç‚¹ï¼š**

```c
[root@compute ~]# iaas-install-neutron-compute.sh

```

##### 3.5.7 DashboardæœåŠ¡

**controllerèŠ‚ç‚¹ï¼š**

```c
[root@controller ~]# iaas-install-dashboard.sh

```

åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://192.168.100.10/dashboard

**æ³¨ï¼šæ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼Œç¡®ä¿å…è®¸httpæœåŠ¡ç›¸å…³ç«¯å£é€šè¡Œï¼Œæˆ–è€…å…³é—­é˜²ç«å¢™**

Domainï¼šdemo
  
ç”¨æˆ·åï¼šadmin
  
å¯†ç ï¼š000000
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/7ede7132acb714b648821371afb319fc.png)
  
å‡ºçŽ°ä»¥ä¸‹å›¾ç¤ºè¡¨ç¤ºäº‘å¹³å°æ­å»ºæˆåŠŸã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/b801618497fc38e9a0755bdb59c10e3b.png)

> æœŸå¾…ä¸‹æ¬¡çš„åˆ†äº«ï¼Œåˆ«å¿˜äº†ä¸‰è¿žæ”¯æŒåšä¸»å‘€~
>   
> æˆ‘æ˜¯
> **[å¿µèˆ’\_C.ying](https://blog.csdn.net/qq_52716296?type=blog)**
> ï¼ŒæœŸå¾…ä½ çš„å…³æ³¨~ðŸ’ªðŸ’ªðŸ’ª

68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35323731363239362f:61727469636c652f64657461696c732f313236313233393437