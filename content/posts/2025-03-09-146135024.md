---
layout: post
title: "Easysearch-ä½¿ç”¨-AWS-S3-è¿›è¡Œå¿«ç…§å¤‡ä»½ä¸è¿˜åŸå®Œæ•´æŒ‡å—åŠå¸¸è§é”™è¯¯æ’æŸ¥"
date: 2025-03-09 17:15:36 +0800
description: "Easysearch å¯ä»¥ä½¿ç”¨ä½œä¸ºè¿œç¨‹å­˜å‚¨åº“ï¼Œè¿›è¡Œç´¢å¼•çš„å¿«ç…§ï¼ˆSnapshotï¼‰å¤‡ä»½å’Œæ¢å¤ã€‚åŒæ—¶ï¼ŒEasysearch å†…ç½®äº† S3 æ’ä»¶ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„é…ç½®å’Œæ“ä½œæ­¥éª¤ã€‚ç™»å½•ï¼Œè¿›å…¥æœåŠ¡ã€‚ï¼ˆä¾‹å¦‚ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰ã€‚ï¼šç¡®ä¿ IAM è§’è‰²å…·æœ‰è®¿é—® S3 çš„æƒé™ã€‚],},],bucketregionä¸€æ—¦ï¼šè¿™ä¼šä»è¿˜åŸmy_indexï¼Œä½†ä»¥å‘½åï¼Œé¿å…ä¸ç°æœ‰ç´¢å¼•å†²çªã€‚å¦‚æœè¦ç›´æ¥è¦†ç›–åŸç´¢å¼•ï¼ˆç¡®ä¿my_indexã€‚"
keywords: "effect\": \"allow\", \"action\": [ \"s3:*"
categories: ['Infinilabs']
tags: ['äº‘è®¡ç®—', 'Linux', 'Es', 'Easysearch', 'Aws']
artid: "146135024"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146135024
    alt: "Easysearch-ä½¿ç”¨-AWS-S3-è¿›è¡Œå¿«ç…§å¤‡ä»½ä¸è¿˜åŸå®Œæ•´æŒ‡å—åŠå¸¸è§é”™è¯¯æ’æŸ¥"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146135024
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146135024
cover: https://bing.ee123.net/img/rand?artid=146135024
image: https://bing.ee123.net/img/rand?artid=146135024
img: https://bing.ee123.net/img/rand?artid=146135024
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Easysearch ä½¿ç”¨ AWS S3 è¿›è¡Œå¿«ç…§å¤‡ä»½ä¸è¿˜åŸï¼šå®Œæ•´æŒ‡å—åŠå¸¸è§é”™è¯¯æ’æŸ¥
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Easysearch å¯ä»¥ä½¿ç”¨
     <strong>
      AWS S3
     </strong>
     ä½œä¸ºè¿œç¨‹å­˜å‚¨åº“ï¼Œè¿›è¡Œç´¢å¼•çš„å¿«ç…§ï¼ˆSnapshotï¼‰å¤‡ä»½å’Œæ¢å¤ã€‚åŒæ—¶ï¼ŒEasysearch å†…ç½®äº† S3 æ’ä»¶ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„é…ç½®å’Œæ“ä½œæ­¥éª¤ã€‚
    </p>
    <hr/>
    <h3>
     <a id="1__AWS_S3__6">
     </a>
     1. åœ¨ AWS S3 ä¸Šåˆ›å»ºå­˜å‚¨æ¡¶
    </h3>
    <ol>
     <li>
      ç™»å½•
      <strong>
       AWS æ§åˆ¶å°
      </strong>
      ï¼Œè¿›å…¥
      <strong>
       S3
      </strong>
      æœåŠ¡ã€‚
     </li>
     <li>
      <strong>
       åˆ›å»ºä¸€ä¸ªæ–°å­˜å‚¨æ¡¶
      </strong>
      ï¼ˆä¾‹å¦‚
      <code>
       easysearch-backups
      </code>
      ï¼‰ã€‚
     </li>
     <li>
      <strong>
       å¯ç”¨ç‰ˆæœ¬æ§åˆ¶
      </strong>
      ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰ã€‚
     </li>
     <li>
      <strong>
       æƒé™é…ç½®
      </strong>
      ï¼šç¡®ä¿ IAM è§’è‰²å…·æœ‰è®¿é—® S3 çš„æƒé™ã€‚
     </li>
    </ol>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
<span class="token string-property property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"s3:ListBucket"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"arn:aws:s3:::s3-bucket-name"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>
      <span class="token string">"s3:PutObject"</span><span class="token punctuation">,</span>
      <span class="token string">"s3:DeleteObject"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"arn:aws:s3:::s3-bucket-name/*"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__Console__S3__40">
     </a>
     2. åœ¨ Console ä¸Šæ³¨å†Œ S3 ä½œä¸ºå¿«ç…§å­˜å‚¨åº“
    </h3>
    <h4>
     <a id="_Console_DevTools__API_42">
     </a>
     <strong>
      ä½¿ç”¨ Console DevTools æˆ– API
     </strong>
    </h4>
    <p>
     åœ¨ Easysearch çš„ DevTools æ‰§è¡Œï¼š
    </p>
    <pre><code class="prism language-json"><span class="token constant">PUT</span> _snapshot<span class="token operator">/</span>my_s3_repository
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"s3"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"bucket"</span><span class="token operator">:</span> <span class="token string">"easysearch-backups"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"base_path"</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      <strong>
       æ³¨æ„
      </strong>
      ï¼š
     </p>
     <ul>
      <li>
       <code>
        bucket
       </code>
       éœ€è¦å¡«å†™ä½ çš„ S3 å­˜å‚¨æ¡¶åç§°ã€‚
      </li>
      <li>
       <code>
        region
       </code>
       éœ€è¦æ›¿æ¢æˆä½ çš„ AWS S3 æ‰€åœ¨åŒºåŸŸï¼ŒSDK é»˜è®¤ç¾ä¸œåŒºã€‚
      </li>
      <li>
       å¦‚æœ Bucket åœ¨ä¸­å›½åŒºï¼Œè¿˜éœ€æ·»åŠ 
       <code>
        endpoint: https://s3.&lt;region&gt;.amazonaws.com.cn
       </code>
       å‚æ•°ã€‚
      </li>
     </ul>
    </blockquote>
    <hr/>
    <h3>
     <a id="3__65">
     </a>
     3. åˆ›å»ºå¿«ç…§
    </h3>
    <p>
     ä¸€æ—¦
     <code>
      my_s3_repository
     </code>
     æ³¨å†Œå®Œæˆï¼Œå°±å¯ä»¥åˆ›å»ºå¿«ç…§ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token constant">PUT</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>my_snapshot_001
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"include_global_state"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     æŸ¥çœ‹å½“å‰å­˜å‚¨çš„å¿«ç…§ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token constant">GET</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>_all
</code></pre>
    <hr/>
    <p>
     <img alt="image-20250309161102887" src="https://i-blog.csdnimg.cn/img_convert/8ac6983caa20c4deeefb80ff3d41eafe.png"/>
    </p>
    <h3>
     <a id="4__AWS_S3__85">
     </a>
     4. ä» AWS S3 è¿˜åŸå¿«ç…§
    </h3>
    <p>
     å½“ä½ éœ€è¦æ¢å¤ç´¢å¼•æ—¶ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token constant">POST</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>my_snapshot_001<span class="token operator">/</span>_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_pattern"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_replacement"</span><span class="token operator">:</span> <span class="token string">"restored_my_index"</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      <strong>
       è¯´æ˜
      </strong>
      ï¼šè¿™ä¼šä»
      <code>
       my_snapshot_001
      </code>
      è¿˜åŸ
      <code>
       my_index
      </code>
      ï¼Œä½†ä»¥
      <code>
       restored_my_index
      </code>
      å‘½åï¼Œé¿å…ä¸ç°æœ‰ç´¢å¼•å†²çªã€‚
     </p>
    </blockquote>
    <p>
     å¦‚æœè¦ç›´æ¥è¦†ç›–åŸç´¢å¼•ï¼ˆç¡®ä¿
     <code>
      my_index
     </code>
     ä¸ºç©ºæˆ–å·²åˆ é™¤ï¼‰ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token constant">POST</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>my_snapshot_001<span class="token operator">/</span>_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"ignore_unavailable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"include_global_state"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="5__113">
     </a>
     5. å¯èƒ½çš„é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         é”™è¯¯ä¿¡æ¯
        </strong>
       </th>
       <th>
        <strong>
         å¯èƒ½åŸå› 
        </strong>
       </th>
       <th>
        <strong>
         è§£å†³æ–¹æ¡ˆ
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         repository_s3 plugin not installed
        </code>
       </td>
       <td>
        æ²¡æœ‰å®‰è£…
        <code>
         repository-s3
        </code>
        æ’ä»¶
       </td>
       <td>
        è¿è¡Œ
        <code>
         bin/elasticsearch-plugin install repository-s3
        </code>
        å¹¶é‡å¯
       </td>
      </tr>
      <tr>
       <td>
        <code>
         NoSuchBucket
        </code>
       </td>
       <td>
        S3 å­˜å‚¨æ¡¶ä¸å­˜åœ¨
       </td>
       <td>
        ç¡®ä¿ S3 å­˜å‚¨æ¡¶åç§°æ­£ç¡®
       </td>
      </tr>
      <tr>
       <td>
        <code>
         AccessDenied
        </code>
       </td>
       <td>
        æƒé™ä¸è¶³
       </td>
       <td>
        ç¡®ä¿ S3 å­˜å‚¨æ¡¶ç­–ç•¥æ­£ç¡®ï¼Œæ£€æŸ¥ IAM è§’è‰²
       </td>
      </tr>
      <tr>
       <td>
        <code>
         index_closed_exception
        </code>
       </td>
       <td>
        ç›®æ ‡ç´¢å¼•å·²å…³é—­
       </td>
       <td>
        å…ˆ
        <code>
         POST my_index/_open
        </code>
        å†æ¢å¤
       </td>
      </tr>
      <tr>
       <td>
        <code>
         index_already_exists_exception
        </code>
       </td>
       <td>
        ç›®æ ‡ç´¢å¼•å·²å­˜åœ¨
       </td>
       <td>
        å…ˆ
        <code>
         DELETE my_index
        </code>
        å†æ¢å¤
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="6__125">
     </a>
     6. å¿«ç…§æ¢å¤å¸¸è§é”™è¯¯æ’æŸ¥
    </h3>
    <h4>
     <a id="_1_S3_127">
     </a>
     <strong>
      æŠ¥é”™ 1ï¼šæ— æ³•è¿æ¥åˆ° S3
     </strong>
    </h4>
    <pre><code class="prism language-json">
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository] path [/] is not accessible on master node"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository] path [/] is not accessible on master node"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"i_o_exception"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Unable to upload object [//tests-sXkmh3q5ThCCIX2VJp609g/master.dat] using a single upload"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"sdk_client_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Failed to connect to service endpoint: "</span><span class="token punctuation">,</span>
        <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"socket_timeout_exception"</span><span class="token punctuation">,</span>
          <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Connect timed out"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_158">
     </a>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </h5>
    <ol>
     <li>
      åœ¨ keystore ä¸­æ·»åŠ  AWS å‡­è¯ï¼š
      <pre><code class="prism language-bash"><span class="token function">sudo</span> ./bin/easysearch-keystore <span class="token function">add</span> s3.client.default.access_key
<span class="token function">sudo</span> ./bin/easysearch-keystore <span class="token function">add</span> s3.client.default.secret_key
</code></pre>
     </li>
     <li>
      å¦‚æœè¿è¡Œåœ¨ EC2 ä¸Šï¼Œç¡®ä¿å®ä¾‹æŒ‚è½½äº† IAM Roleã€‚
     </li>
    </ol>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repositor1] path  is not accessible on master node"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repositor1] path  is not accessible on master node"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"i_o_exception"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Unable to upload object [tests-sUUzs-mTSZeYw1qk372DkQ/master.dat] using a single upload"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"sdk_client_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"The requested metadata is not found at http://169.254.169.254/latest/meta-data/iam/security-credentials/"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_2_192">
     </a>
     æŠ¥é”™ 2ï¼šç´¢å¼•å·²å­˜åœ¨ï¼Œæ— æ³•æ¢å¤
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"snapshot_restore_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository:1/9gIDCgSySwKzQqEYvaGM_w] cannot restore index [my_index] because an open index with same name already exists in the cluster. Either close or delete the existing index or restore the index under a different name by providing a rename pattern and replacement name"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"snapshot_restore_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository:1/9gIDCgSySwKzQqEYvaGM_w] cannot restore index [my_index] because an open index with same name already exists in the cluster. Either close or delete the existing index or restore the index under a different name by providing a rename pattern and replacement name"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_210">
     </a>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </h5>
    <ol>
     <li>
      <strong>
       åˆ é™¤ç°æœ‰ç´¢å¼•åæ¢å¤
      </strong>
      ï¼š
      <pre><code class="prism language-bash">DELETE /my_index
</code></pre>
     </li>
     <li>
      <strong>
       å…³é—­ç´¢å¼•åæ¢å¤
      </strong>
      ï¼š
      <pre><code class="prism language-bash">POST /my_index/_close
</code></pre>
     </li>
     <li>
      <strong>
       æ¢å¤ä¸ºæ–°çš„ç´¢å¼•åç§°
      </strong>
      ï¼š
      <pre><code class="prism language-json"><span class="token constant">POST</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_pattern"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_replacement"</span><span class="token operator">:</span> <span class="token string">"restored_my_index"</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_3_232">
     </a>
     æŠ¥é”™ 3ï¼šæƒé™é”™è¯¯
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"security_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no permissions for [] and User [name=admin, external_roles=[admin]]"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"security_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no permissions for [] and User [name=admin, external_roles=[admin]]"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">403</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_250">
     </a>
     <strong>
      è§£å†³æ–¹æ¡ˆ
     </strong>
     ï¼š
    </h5>
    <ol>
     <li>
      <strong>
       ç¡®ä¿ç”¨æˆ·æœ‰
       <code>
        manage_snapshots
       </code>
       è§’è‰²æƒé™
      </strong>
      ã€‚
     </li>
     <li>
      <strong>
       æ’é™¤
       <code>
        .security
       </code>
       ç´¢å¼•æˆ–å…¨å±€çŠ¶æ€
      </strong>
      ï¼Œå¦åˆ™æ— æ³•æ¢å¤ã€‚
     </li>
    </ol>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/31e63b73d7fd427f84f0079872962f37.png"/>
    </p>
    <pre><code>POST _snapshot/my_s3_repositor1/snapshot_002/_restore
{
  "indices": "-.security",
  "ignore_unavailable": true,
  "include_global_state": false
}
</code></pre>
    <h2>
     <a id="_Repository_API_266">
     </a>
     <strong>
      ğŸ“Œ å­˜å‚¨åº“ï¼ˆRepositoryï¼‰ç®¡ç† API
     </strong>
    </h2>
    <p>
     å­˜å‚¨åº“ç”¨äºå­˜å‚¨å¿«ç…§ï¼ŒElasticsearch æ”¯æŒ AWS S3ã€GCSã€æœ¬åœ°ç­‰å­˜å‚¨ã€‚
    </p>
    <h3>
     <a id="1__270">
     </a>
     1ï¸âƒ£ æŸ¥çœ‹æ‰€æœ‰å·²æ³¨å†Œçš„å­˜å‚¨åº“
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/_all
</code></pre>
    <p>
     <strong>
      ç¤ºä¾‹è¿”å›
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"my_s3_repository"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"s3"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"bucket"</span><span class="token operator">:</span> <span class="token string">"es-snapshots-bucket"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"region"</span><span class="token operator">:</span> <span class="token string">"us-east-1"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__290">
     </a>
     2ï¸âƒ£ æŸ¥çœ‹ç‰¹å®šå­˜å‚¨åº“ä¿¡æ¯
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository
</code></pre>
    <h3>
     <a id="3_AWS_S3__296">
     </a>
     3ï¸âƒ£ åˆ›å»ºå­˜å‚¨åº“ï¼ˆAWS S3 ç¤ºä¾‹ï¼‰
    </h3>
    <pre><code class="prism language-bash">PUT _snapshot/my_s3_repository
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"s3"</span>,
  <span class="token string">"settings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bucket"</span><span class="token builtin class-name">:</span> <span class="token string">"es-snapshots-bucket"</span>,
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="4__308">
     </a>
     4ï¸âƒ£ åˆ é™¤å­˜å‚¨åº“
    </h3>
    <pre><code class="prism language-bash">DELETE _snapshot/my_s3_repository
</code></pre>
    <p>
     <strong>
      âš  åˆ é™¤å­˜å‚¨åº“ä¸ä¼šåˆ é™¤å¿«ç…§ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤å¿«ç…§ï¼
     </strong>
    </p>
    <hr/>
    <h2>
     <a id="_Snapshot_API_318">
     </a>
     <strong>
      ğŸ“Œ å¿«ç…§ï¼ˆSnapshotï¼‰ç®¡ç† API
     </strong>
    </h2>
    <p>
     å¿«ç…§ç”¨äºå¤‡ä»½å’Œæ¢å¤ç´¢å¼•æ•°æ®ã€‚
    </p>
    <h3>
     <a id="1__322">
     </a>
     1ï¸âƒ£ åˆ›å»ºå¿«ç…§
    </h3>
    <p>
     <strong>
      å¤‡ä»½ç‰¹å®šç´¢å¼•
     </strong>
    </p>
    <pre><code class="prism language-bash">PUT _snapshot/my_s3_repository/snapshot_001
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"include_global_state"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      å¤‡ä»½æ‰€æœ‰ç´¢å¼•
     </strong>
    </p>
    <pre><code class="prism language-bash">PUT _snapshot/my_s3_repository/snapshot_002
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"include_global_state"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__343">
     </a>
     2ï¸âƒ£ æŸ¥çœ‹æ‰€æœ‰å¿«ç…§
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository/_all
</code></pre>
    <h3>
     <a id="3__349">
     </a>
     3ï¸âƒ£ æŸ¥çœ‹ç‰¹å®šå¿«ç…§ä¿¡æ¯
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository/snapshot_001
</code></pre>
    <h3>
     <a id="4__355">
     </a>
     4ï¸âƒ£ åˆ é™¤å¿«ç…§
    </h3>
    <pre><code class="prism language-bash">DELETE _snapshot/my_s3_repository/snapshot_001
</code></pre>
    <hr/>
    <h2>
     <a id="_RestoreAPI_363">
     </a>
     <strong>
      ğŸ“Œ å¿«ç…§æ¢å¤ï¼ˆRestoreï¼‰API
     </strong>
    </h2>
    <p>
     æ¢å¤å·²å¤‡ä»½çš„ç´¢å¼•ã€‚
    </p>
    <h3>
     <a id="1__367">
     </a>
     1ï¸âƒ£ è¿˜åŸå•ä¸ªç´¢å¼•
    </h3>
    <pre><code class="prism language-bash">POST _snapshot/my_s3_repository/snapshot_001/_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"ignore_unavailable"</span><span class="token builtin class-name">:</span> true,
  <span class="token string">"include_global_state"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__378">
     </a>
     2ï¸âƒ£ è¿˜åŸç´¢å¼•å¹¶é‡å‘½å
    </h3>
    <pre><code class="prism language-bash">POST _snapshot/my_s3_repository/snapshot_001/_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"rename_pattern"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"rename_replacement"</span><span class="token builtin class-name">:</span> <span class="token string">"restored_my_index"</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3__389">
     </a>
     3ï¸âƒ£ è¿˜åŸæ‰€æœ‰ç´¢å¼•
    </h3>
    <pre><code class="prism language-bash">POST _snapshot/my_s3_repository/snapshot_002/_restore
</code></pre>
    <hr/>
    <h2>
     <a id="__API_397">
     </a>
     <strong>
      ğŸ“Œ å¿«ç…§çŠ¶æ€ API
     </strong>
    </h2>
    <p>
     æŸ¥è¯¢å¿«ç…§çš„æ‰§è¡ŒçŠ¶æ€ã€‚
    </p>
    <h3>
     <a id="1__401">
     </a>
     1ï¸âƒ£ æŸ¥çœ‹å½“å‰å¿«ç…§ä»»åŠ¡
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/_status
</code></pre>
    <h3>
     <a id="2__407">
     </a>
     2ï¸âƒ£ æŸ¥çœ‹ç‰¹å®šå¿«ç…§çŠ¶æ€
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository/snapshot_001/_status
</code></pre>
    <hr/>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         API
        </strong>
       </th>
       <th>
        <strong>
         ç”¨é€”
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         GET _snapshot/_all
        </code>
       </td>
       <td>
        æŸ¥çœ‹æ‰€æœ‰å­˜å‚¨åº“
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/my_s3_repository
        </code>
       </td>
       <td>
        æŸ¥çœ‹ç‰¹å®šå­˜å‚¨åº“
       </td>
      </tr>
      <tr>
       <td>
        <code>
         PUT _snapshot/my_s3_repository
        </code>
       </td>
       <td>
        åˆ›å»ºå­˜å‚¨åº“
       </td>
      </tr>
      <tr>
       <td>
        <code>
         DELETE _snapshot/my_s3_repository
        </code>
       </td>
       <td>
        åˆ é™¤å­˜å‚¨åº“
       </td>
      </tr>
      <tr>
       <td>
        <code>
         PUT _snapshot/my_s3_repository/snapshot_001
        </code>
       </td>
       <td>
        åˆ›å»ºå¿«ç…§
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/my_s3_repository/_all
        </code>
       </td>
       <td>
        æŸ¥çœ‹æ‰€æœ‰å¿«ç…§
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/my_s3_repository/snapshot_001
        </code>
       </td>
       <td>
        æŸ¥çœ‹å¿«ç…§è¯¦æƒ…
       </td>
      </tr>
      <tr>
       <td>
        <code>
         DELETE _snapshot/my_s3_repository/snapshot_001
        </code>
       </td>
       <td>
        åˆ é™¤å¿«ç…§
       </td>
      </tr>
      <tr>
       <td>
        <code>
         POST _snapshot/my_s3_repository/snapshot_001/_restore
        </code>
       </td>
       <td>
        è¿˜åŸå¿«ç…§
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/_status
        </code>
       </td>
       <td>
        æŸ¥çœ‹å¿«ç…§çŠ¶æ€
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     ğŸš€ é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥é«˜æ•ˆåœ°ä½¿ç”¨
     <strong>
      AWS S3 è¿›è¡Œ Easysearch å¿«ç…§å¤‡ä»½å’Œæ¢å¤
     </strong>
     ï¼Œå¹¶æ’æŸ¥å¯èƒ½çš„é”™è¯¯ï¼Œç¡®ä¿é›†ç¾¤æ•°æ®å®‰å…¨æ— å¿§ï¼
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33383738313439382f:61727469636c652f64657461696c732f313436313335303234" class_="artid" style="display:none">
 </p>
</div>


