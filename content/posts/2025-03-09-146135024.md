---
layout: post
title: "Easysearch-使用-AWS-S3-进行快照备份与还原完整指南及常见错误排查"
date: 2025-03-09 17:15:36 +0800
description: "Easysearch 可以使用作为远程存储库，进行索引的快照（Snapshot）备份和恢复。同时，Easysearch 内置了 S3 插件，无需额外安装。以下是完整的配置和操作步骤。登录，进入服务。（例如（可选，但推荐）。：确保 IAM 角色具有访问 S3 的权限。],},],bucketregion一旦：这会从还原my_index，但以命名，避免与现有索引冲突。如果要直接覆盖原索引（确保my_index。"
keywords: "effect\": \"allow\", \"action\": [ \"s3:*"
categories: ['Infinilabs']
tags: ['云计算', 'Linux', 'Es', 'Easysearch', 'Aws']
artid: "146135024"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146135024
    alt: "Easysearch-使用-AWS-S3-进行快照备份与还原完整指南及常见错误排查"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146135024
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146135024
cover: https://bing.ee123.net/img/rand?artid=146135024
image: https://bing.ee123.net/img/rand?artid=146135024
img: https://bing.ee123.net/img/rand?artid=146135024
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Easysearch 使用 AWS S3 进行快照备份与还原：完整指南及常见错误排查
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Easysearch 可以使用
     <strong>
      AWS S3
     </strong>
     作为远程存储库，进行索引的快照（Snapshot）备份和恢复。同时，Easysearch 内置了 S3 插件，无需额外安装。以下是完整的配置和操作步骤。
    </p>
    <hr/>
    <h3>
     <a id="1__AWS_S3__6">
     </a>
     1. 在 AWS S3 上创建存储桶
    </h3>
    <ol>
     <li>
      登录
      <strong>
       AWS 控制台
      </strong>
      ，进入
      <strong>
       S3
      </strong>
      服务。
     </li>
     <li>
      <strong>
       创建一个新存储桶
      </strong>
      （例如
      <code>
       easysearch-backups
      </code>
      ）。
     </li>
     <li>
      <strong>
       启用版本控制
      </strong>
      （可选，但推荐）。
     </li>
     <li>
      <strong>
       权限配置
      </strong>
      ：确保 IAM 角色具有访问 S3 的权限。
     </li>
    </ol>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
<span class="token string-property property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
<span class="token string-property property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"s3:ListBucket"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"arn:aws:s3:::s3-bucket-name"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>
      <span class="token string">"s3:PutObject"</span><span class="token punctuation">,</span>
      <span class="token string">"s3:DeleteObject"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"arn:aws:s3:::s3-bucket-name/*"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__Console__S3__40">
     </a>
     2. 在 Console 上注册 S3 作为快照存储库
    </h3>
    <h4>
     <a id="_Console_DevTools__API_42">
     </a>
     <strong>
      使用 Console DevTools 或 API
     </strong>
    </h4>
    <p>
     在 Easysearch 的 DevTools 执行：
    </p>
    <pre><code class="prism language-json"><span class="token constant">PUT</span> _snapshot<span class="token operator">/</span>my_s3_repository
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"s3"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"bucket"</span><span class="token operator">:</span> <span class="token string">"easysearch-backups"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"base_path"</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      <strong>
       注意
      </strong>
      ：
     </p>
     <ul>
      <li>
       <code>
        bucket
       </code>
       需要填写你的 S3 存储桶名称。
      </li>
      <li>
       <code>
        region
       </code>
       需要替换成你的 AWS S3 所在区域，SDK 默认美东区。
      </li>
      <li>
       如果 Bucket 在中国区，还需添加
       <code>
        endpoint: https://s3.&lt;region&gt;.amazonaws.com.cn
       </code>
       参数。
      </li>
     </ul>
    </blockquote>
    <hr/>
    <h3>
     <a id="3__65">
     </a>
     3. 创建快照
    </h3>
    <p>
     一旦
     <code>
      my_s3_repository
     </code>
     注册完成，就可以创建快照：
    </p>
    <pre><code class="prism language-json"><span class="token constant">PUT</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>my_snapshot_001
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"include_global_state"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     查看当前存储的快照：
    </p>
    <pre><code class="prism language-json"><span class="token constant">GET</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>_all
</code></pre>
    <hr/>
    <p>
     <img alt="image-20250309161102887" src="https://i-blog.csdnimg.cn/img_convert/8ac6983caa20c4deeefb80ff3d41eafe.png"/>
    </p>
    <h3>
     <a id="4__AWS_S3__85">
     </a>
     4. 从 AWS S3 还原快照
    </h3>
    <p>
     当你需要恢复索引时：
    </p>
    <pre><code class="prism language-json"><span class="token constant">POST</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>my_snapshot_001<span class="token operator">/</span>_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_pattern"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_replacement"</span><span class="token operator">:</span> <span class="token string">"restored_my_index"</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
     <p>
      <strong>
       说明
      </strong>
      ：这会从
      <code>
       my_snapshot_001
      </code>
      还原
      <code>
       my_index
      </code>
      ，但以
      <code>
       restored_my_index
      </code>
      命名，避免与现有索引冲突。
     </p>
    </blockquote>
    <p>
     如果要直接覆盖原索引（确保
     <code>
      my_index
     </code>
     为空或已删除）：
    </p>
    <pre><code class="prism language-json"><span class="token constant">POST</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span>my_snapshot_001<span class="token operator">/</span>_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"ignore_unavailable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"include_global_state"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="5__113">
     </a>
     5. 可能的错误与解决方案
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         错误信息
        </strong>
       </th>
       <th>
        <strong>
         可能原因
        </strong>
       </th>
       <th>
        <strong>
         解决方案
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         repository_s3 plugin not installed
        </code>
       </td>
       <td>
        没有安装
        <code>
         repository-s3
        </code>
        插件
       </td>
       <td>
        运行
        <code>
         bin/elasticsearch-plugin install repository-s3
        </code>
        并重启
       </td>
      </tr>
      <tr>
       <td>
        <code>
         NoSuchBucket
        </code>
       </td>
       <td>
        S3 存储桶不存在
       </td>
       <td>
        确保 S3 存储桶名称正确
       </td>
      </tr>
      <tr>
       <td>
        <code>
         AccessDenied
        </code>
       </td>
       <td>
        权限不足
       </td>
       <td>
        确保 S3 存储桶策略正确，检查 IAM 角色
       </td>
      </tr>
      <tr>
       <td>
        <code>
         index_closed_exception
        </code>
       </td>
       <td>
        目标索引已关闭
       </td>
       <td>
        先
        <code>
         POST my_index/_open
        </code>
        再恢复
       </td>
      </tr>
      <tr>
       <td>
        <code>
         index_already_exists_exception
        </code>
       </td>
       <td>
        目标索引已存在
       </td>
       <td>
        先
        <code>
         DELETE my_index
        </code>
        再恢复
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="6__125">
     </a>
     6. 快照恢复常见错误排查
    </h3>
    <h4>
     <a id="_1_S3_127">
     </a>
     <strong>
      报错 1：无法连接到 S3
     </strong>
    </h4>
    <pre><code class="prism language-json">
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository] path [/] is not accessible on master node"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository] path [/] is not accessible on master node"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"i_o_exception"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Unable to upload object [//tests-sXkmh3q5ThCCIX2VJp609g/master.dat] using a single upload"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"sdk_client_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Failed to connect to service endpoint: "</span><span class="token punctuation">,</span>
        <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"socket_timeout_exception"</span><span class="token punctuation">,</span>
          <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Connect timed out"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_158">
     </a>
     <strong>
      解决方案
     </strong>
     ：
    </h5>
    <ol>
     <li>
      在 keystore 中添加 AWS 凭证：
      <pre><code class="prism language-bash"><span class="token function">sudo</span> ./bin/easysearch-keystore <span class="token function">add</span> s3.client.default.access_key
<span class="token function">sudo</span> ./bin/easysearch-keystore <span class="token function">add</span> s3.client.default.secret_key
</code></pre>
     </li>
     <li>
      如果运行在 EC2 上，确保实例挂载了 IAM Role。
     </li>
    </ol>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repositor1] path  is not accessible on master node"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"repository_verification_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repositor1] path  is not accessible on master node"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"i_o_exception"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"Unable to upload object [tests-sUUzs-mTSZeYw1qk372DkQ/master.dat] using a single upload"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"caused_by"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"sdk_client_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"The requested metadata is not found at http://169.254.169.254/latest/meta-data/iam/security-credentials/"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="_2_192">
     </a>
     报错 2：索引已存在，无法恢复
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"snapshot_restore_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository:1/9gIDCgSySwKzQqEYvaGM_w] cannot restore index [my_index] because an open index with same name already exists in the cluster. Either close or delete the existing index or restore the index under a different name by providing a rename pattern and replacement name"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"snapshot_restore_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"[my_s3_repository:1/9gIDCgSySwKzQqEYvaGM_w] cannot restore index [my_index] because an open index with same name already exists in the cluster. Either close or delete the existing index or restore the index under a different name by providing a rename pattern and replacement name"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_210">
     </a>
     <strong>
      解决方案
     </strong>
     ：
    </h5>
    <ol>
     <li>
      <strong>
       删除现有索引后恢复
      </strong>
      ：
      <pre><code class="prism language-bash">DELETE /my_index
</code></pre>
     </li>
     <li>
      <strong>
       关闭索引后恢复
      </strong>
      ：
      <pre><code class="prism language-bash">POST /my_index/_close
</code></pre>
     </li>
     <li>
      <strong>
       恢复为新的索引名称
      </strong>
      ：
      <pre><code class="prism language-json"><span class="token constant">POST</span> _snapshot<span class="token operator">/</span>my_s3_repository<span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span>_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"indices"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_pattern"</span><span class="token operator">:</span> <span class="token string">"my_index"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"rename_replacement"</span><span class="token operator">:</span> <span class="token string">"restored_my_index"</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="_3_232">
     </a>
     报错 3：权限错误
    </h4>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"security_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no permissions for [] and User [name=admin, external_roles=[admin]]"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"security_exception"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no permissions for [] and User [name=admin, external_roles=[admin]]"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">403</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_250">
     </a>
     <strong>
      解决方案
     </strong>
     ：
    </h5>
    <ol>
     <li>
      <strong>
       确保用户有
       <code>
        manage_snapshots
       </code>
       角色权限
      </strong>
      。
     </li>
     <li>
      <strong>
       排除
       <code>
        .security
       </code>
       索引或全局状态
      </strong>
      ，否则无法恢复。
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/31e63b73d7fd427f84f0079872962f37.png"/>
    </p>
    <pre><code>POST _snapshot/my_s3_repositor1/snapshot_002/_restore
{
  "indices": "-.security",
  "ignore_unavailable": true,
  "include_global_state": false
}
</code></pre>
    <h2>
     <a id="_Repository_API_266">
     </a>
     <strong>
      📌 存储库（Repository）管理 API
     </strong>
    </h2>
    <p>
     存储库用于存储快照，Elasticsearch 支持 AWS S3、GCS、本地等存储。
    </p>
    <h3>
     <a id="1__270">
     </a>
     1️⃣ 查看所有已注册的存储库
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/_all
</code></pre>
    <p>
     <strong>
      示例返回
     </strong>
     ：
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"my_s3_repository"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"s3"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"bucket"</span><span class="token operator">:</span> <span class="token string">"es-snapshots-bucket"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"region"</span><span class="token operator">:</span> <span class="token string">"us-east-1"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__290">
     </a>
     2️⃣ 查看特定存储库信息
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository
</code></pre>
    <h3>
     <a id="3_AWS_S3__296">
     </a>
     3️⃣ 创建存储库（AWS S3 示例）
    </h3>
    <pre><code class="prism language-bash">PUT _snapshot/my_s3_repository
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"s3"</span>,
  <span class="token string">"settings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bucket"</span><span class="token builtin class-name">:</span> <span class="token string">"es-snapshots-bucket"</span>,
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="4__308">
     </a>
     4️⃣ 删除存储库
    </h3>
    <pre><code class="prism language-bash">DELETE _snapshot/my_s3_repository
</code></pre>
    <p>
     <strong>
      ⚠ 删除存储库不会删除快照，需要手动删除快照！
     </strong>
    </p>
    <hr/>
    <h2>
     <a id="_Snapshot_API_318">
     </a>
     <strong>
      📌 快照（Snapshot）管理 API
     </strong>
    </h2>
    <p>
     快照用于备份和恢复索引数据。
    </p>
    <h3>
     <a id="1__322">
     </a>
     1️⃣ 创建快照
    </h3>
    <p>
     <strong>
      备份特定索引
     </strong>
    </p>
    <pre><code class="prism language-bash">PUT _snapshot/my_s3_repository/snapshot_001
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"include_global_state"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      备份所有索引
     </strong>
    </p>
    <pre><code class="prism language-bash">PUT _snapshot/my_s3_repository/snapshot_002
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"include_global_state"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__343">
     </a>
     2️⃣ 查看所有快照
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository/_all
</code></pre>
    <h3>
     <a id="3__349">
     </a>
     3️⃣ 查看特定快照信息
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository/snapshot_001
</code></pre>
    <h3>
     <a id="4__355">
     </a>
     4️⃣ 删除快照
    </h3>
    <pre><code class="prism language-bash">DELETE _snapshot/my_s3_repository/snapshot_001
</code></pre>
    <hr/>
    <h2>
     <a id="_RestoreAPI_363">
     </a>
     <strong>
      📌 快照恢复（Restore）API
     </strong>
    </h2>
    <p>
     恢复已备份的索引。
    </p>
    <h3>
     <a id="1__367">
     </a>
     1️⃣ 还原单个索引
    </h3>
    <pre><code class="prism language-bash">POST _snapshot/my_s3_repository/snapshot_001/_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"ignore_unavailable"</span><span class="token builtin class-name">:</span> true,
  <span class="token string">"include_global_state"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="2__378">
     </a>
     2️⃣ 还原索引并重命名
    </h3>
    <pre><code class="prism language-bash">POST _snapshot/my_s3_repository/snapshot_001/_restore
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"indices"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"rename_pattern"</span><span class="token builtin class-name">:</span> <span class="token string">"my_index"</span>,
  <span class="token string">"rename_replacement"</span><span class="token builtin class-name">:</span> <span class="token string">"restored_my_index"</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3__389">
     </a>
     3️⃣ 还原所有索引
    </h3>
    <pre><code class="prism language-bash">POST _snapshot/my_s3_repository/snapshot_002/_restore
</code></pre>
    <hr/>
    <h2>
     <a id="__API_397">
     </a>
     <strong>
      📌 快照状态 API
     </strong>
    </h2>
    <p>
     查询快照的执行状态。
    </p>
    <h3>
     <a id="1__401">
     </a>
     1️⃣ 查看当前快照任务
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/_status
</code></pre>
    <h3>
     <a id="2__407">
     </a>
     2️⃣ 查看特定快照状态
    </h3>
    <pre><code class="prism language-bash">GET _snapshot/my_s3_repository/snapshot_001/_status
</code></pre>
    <hr/>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         API
        </strong>
       </th>
       <th>
        <strong>
         用途
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         GET _snapshot/_all
        </code>
       </td>
       <td>
        查看所有存储库
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/my_s3_repository
        </code>
       </td>
       <td>
        查看特定存储库
       </td>
      </tr>
      <tr>
       <td>
        <code>
         PUT _snapshot/my_s3_repository
        </code>
       </td>
       <td>
        创建存储库
       </td>
      </tr>
      <tr>
       <td>
        <code>
         DELETE _snapshot/my_s3_repository
        </code>
       </td>
       <td>
        删除存储库
       </td>
      </tr>
      <tr>
       <td>
        <code>
         PUT _snapshot/my_s3_repository/snapshot_001
        </code>
       </td>
       <td>
        创建快照
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/my_s3_repository/_all
        </code>
       </td>
       <td>
        查看所有快照
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/my_s3_repository/snapshot_001
        </code>
       </td>
       <td>
        查看快照详情
       </td>
      </tr>
      <tr>
       <td>
        <code>
         DELETE _snapshot/my_s3_repository/snapshot_001
        </code>
       </td>
       <td>
        删除快照
       </td>
      </tr>
      <tr>
       <td>
        <code>
         POST _snapshot/my_s3_repository/snapshot_001/_restore
        </code>
       </td>
       <td>
        还原快照
       </td>
      </tr>
      <tr>
       <td>
        <code>
         GET _snapshot/_status
        </code>
       </td>
       <td>
        查看快照状态
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     🚀 通过本文，你可以高效地使用
     <strong>
      AWS S3 进行 Easysearch 快照备份和恢复
     </strong>
     ，并排查可能的错误，确保集群数据安全无忧！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33383738313439382f:61727469636c652f64657461696c732f313436313335303234" class_="artid" style="display:none">
 </p>
</div>


