---
layout: post
title: "5-分钟搭建-Prometheus-Grafana-监控"
date: 2025-03-14 12:16:32 +0800
description: "这个 1860 对应的模板地址是 https://grafana.com/grafana/dashboards/1860-node-exporter-full/在被监控机器上下载 mysqld_exporter。导⼊⽅式同上，只不过对应的 ID 是 7362。在被监控机器上下载 node_exporter。重启 mysqld_exporter。初始账号密码：admin/admin。启动 node_exporter。检查 Targets。下载 Grafana。启动 grafana。登录 grafana。"
keywords: "5 分钟搭建 Prometheus + Grafana 监控"
categories: ['Mysql']
tags: ['Prometheus', 'Grafana']
artid: "146253343"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146253343
    alt: "5-分钟搭建-Prometheus-Grafana-监控"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146253343
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146253343
cover: https://bing.ee123.net/img/rand?artid=146253343
image: https://bing.ee123.net/img/rand?artid=146253343
img: https://bing.ee123.net/img/rand?artid=146253343
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     5 分钟搭建 Prometheus + Grafana 监控
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     一.安装 Prometheus
    </h2>
    <pre><code>cd /usr/local/
wget https://github.com/prometheus/prometheus/releases/download/v2.38.0/prometheus-2.38.0.linux-amd64.tar.gz
tar xvf prometheus-2.38.0.linux-amd64.tar.gz
ln -s prometheus-2.38.0.linux-amd64 prometheus
</code></pre>
    <p>
     <img alt="" height="304" src="https://i-blog.csdnimg.cn/direct/baa47666300c45b0bc220430470ad3cb.png" width="1072"/>
    </p>
    <h2>
     二.安装 node_exporter
    </h2>
    <p>
     在被监控机器上下载 node_exporter
    </p>
    <pre><code>wget https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.linux-amd64.tar.gz
tar xvf node_exporter-1.3.1.linux-amd64.tar.gz
ln -s node_exporter-1.3.1.linux-amd64 node_exporter</code></pre>
    <p>
     启动 node_exporter
    </p>
    <pre><code>nohup ./node_exporter  --web.listen-address=":9100"&amp;
netstat -ntlup | grep 9100</code></pre>
    <p>
     <img alt="" height="51" src="https://i-blog.csdnimg.cn/direct/73d58690972c4c3993828abb766a5bd4.png" width="1076"/>
    </p>
    <h2>
     三.安装 mysqld_exporter
    </h2>
    <p>
     在被监控机器上下载 mysqld_exporter
    </p>
    <pre><code>wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz
tar xvf mysqld_exporter-0.14.0.linux-amd64.tar.gz
ln -s mysqld_exporter-0.14.0.linux-amd64 mysqld_exporter</code></pre>
    <p>
     创建监控⽤户
    </p>
    <pre><code>create user 'monitor'@'127.0.0.1' identified with mysql_native_password by '123456';
grant select,replication client, process on *.* to 'monitor'@'127.0.0.1';</code></pre>
    <p>
     添加客户端账号
    </p>
    <pre><code>vim /usr/local/mysqld_exporter/.my.cnf

 [client]
 host=127.0.0.1
 port=3306
 user=monitor
 password=123456</code></pre>
    <p>
     <img alt="" height="121" src="https://i-blog.csdnimg.cn/direct/86238a282bbc429694ea0c242b2c9ce4.png" width="501"/>
    </p>
    <p>
     重启 mysqld_exporter
    </p>
    <pre><code>nohup /usr/local/mysqld_exporter/mysqld_exporter --config.my-cnf=/usr/local/mysqld_exporter/.my.cnf &amp;

netstat -ntlup | grep 9104</code></pre>
    <p>
     <img alt="" height="51" src="https://i-blog.csdnimg.cn/direct/63952e75ed06410690ffd447f77e6644.png" width="1116"/>
    </p>
    <h2>
     四.修改 prometheus 配置⽂件
    </h2>
    <p>
     添加被监控主机
    </p>
    <pre><code>global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
  # scrape_timeout is set to the global default (10s).

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.
  - job_name: "prometheus"

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
      - targets: ["localhost:9090"]


  - job_name: 'node2'
    static_configs:
      - targets: ['192.168.80.11:9100']

  - job_name: 'node-mysql'
    static_configs:
      - targets: ['192.168.80.11:9104']
</code></pre>
    <p>
     重启 prometheus
    </p>
    <pre><code>pkill prometheus
/usr/local/prometheus/prometheus --config.file=/usr/local/prometheus/prometheus.yml &amp;</code></pre>
    <p>
     检查 Targets
    </p>
    <p>
     <img alt="" height="671" src="https://i-blog.csdnimg.cn/direct/ea47367978bf4aa7a5a8990c12144dc8.png" width="1638"/>
    </p>
    <h2>
     五.安装 Grafana
    </h2>
    <p>
     下载 Grafana
    </p>
    <pre><code>wget https://dl.grafana.com/oss/release/grafana-9.1.5.linux-amd64.tar.gz
tar -zxvf grafana-9.1.5.linux-amd64.tar.gz
ln -s grafana-9.1.5 grafana</code></pre>
    <p>
     启动 grafana
    </p>
    <pre><code>cd grafana
./bin/grafana-server &amp;</code></pre>
    <p>
     登录 grafana
    </p>
    <p>
     <img alt="" height="770" src="https://i-blog.csdnimg.cn/direct/4a99b93e3b0a4ac2b99a60b8f107d86a.png" width="1001"/>
    </p>
    <p>
     初始账号密码：admin/admin
    </p>
    <p>
    </p>
    <h2>
     六.导入主机
    </h2>
    <p>
     Add data source
    </p>
    <p>
     <img alt="" height="777" src="https://i-blog.csdnimg.cn/direct/7e0454a91cbd4541adb796985cd17f09.png" width="1258"/>
    </p>
    <p>
     <img alt="" height="769" src="https://i-blog.csdnimg.cn/direct/7d54af6ed8ad4d1f94d1a4ae92baa544.png" width="1220"/>
    </p>
    <p>
     这个 1860 对应的模板地址是 https://grafana.com/grafana/dashboards/1860-node-exporter-full/
     <img alt="" height="774" src="https://i-blog.csdnimg.cn/direct/d7f36b4db3034f82ab5223da316fc402.png" width="1129"/>
    </p>
    <p>
     查看效果
    </p>
    <p>
     <img alt="" height="842" src="https://i-blog.csdnimg.cn/direct/7933d146ec8f4ebca518185c47b38b7e.png" width="1906"/>
    </p>
    <h2>
     七.导入mysql
    </h2>
    <p>
     <img alt="" height="776" src="https://i-blog.csdnimg.cn/direct/691f319de8f741f2b2bd53334e3555fd.png" width="1110"/>
    </p>
    <p>
     导⼊⽅式同上，只不过对应的 ID 是 7362。
    </p>
    <p>
     https://grafana.com/grafana/dashboards/7362-mysql-overview/
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="817" src="https://i-blog.csdnimg.cn/direct/2db976d19cff4cd388b7f2aa05d56604.png" width="1858"/>
    </p>
    <p>
     完成。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f646e75696b696e672f:61727469636c652f64657461696c732f313436323533333433" class_="artid" style="display:none">
 </p>
</div>


