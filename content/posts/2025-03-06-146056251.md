---
layout: post
title: "系统架构设计师数据库基础篇数据库的控制功能"
date: 2025-03-06 00:18:17 +0800
description: "事务故障是指，事务未运行至正常终止点前被撤销，这时恢复子系统应对此事务做撤销处理。事务是用户定义的一个数据库操作序列，这些操作要么全做要么全不做，是一个。在S封锁解除之前，不允许任何事务对S锁数据实现X锁。利用DBMS自带的工具软件备份和恢复数据库的内容。在操作系统层面上对数据库的数据文件进行备份。只允许一个事物，独锁某个数据，具有。"
keywords: "系统架构设计师—数据库基础篇—数据库的控制功能"
categories: ['系统架构设计师']
tags: ['系统架构设计师', '系统架构', '数据库', '控制功能', '恢复技术']
artid: "146056251"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146056251
    alt: "系统架构设计师数据库基础篇数据库的控制功能"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146056251
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146056251
cover: https://bing.ee123.net/img/rand?artid=146056251
image: https://bing.ee123.net/img/rand?artid=146056251
img: https://bing.ee123.net/img/rand?artid=146056251
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     系统架构设计师—数据库基础篇—数据库的控制功能
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     事务管理
    </h2>
    <p>
     事务是用户定义的一个数据库操作序列，这些操作要么全做要么全不做，是一个
     <strong>
      不可分割
     </strong>
     的工作单位。
    </p>
    <h3>
     <a id="Atomicity_4">
     </a>
     原子性（Atomicity）
    </h3>
    <ul>
     <li>
      操作
     </li>
     <li>
      操作序列要么全做要么全不做。
     </li>
    </ul>
    <h3>
     <a id="Consistency_7">
     </a>
     一致性（Consistency）
    </h3>
    <ul>
     <li>
      数据
     </li>
     <li>
      数据库从一个一致性状态变到另一个一致性状态。
     </li>
    </ul>
    <h3>
     <a id="Isolation_10">
     </a>
     隔离性（Isolation）
    </h3>
    <ul>
     <li>
      执行
     </li>
     <li>
      不能被其他事务打扰
     </li>
    </ul>
    <h3>
     <a id="Durability_13">
     </a>
     持久性（Durability）
    </h3>
    <ul>
     <li>
      变化
     </li>
     <li>
      一旦提交，改变就是永久的。
     </li>
    </ul>
    <h2>
     <a id="_17">
     </a>
     并发控制
    </h2>
    <h3>
     <a id="X_18">
     </a>
     排他型封锁（X封锁，写锁）
    </h3>
    <p>
     只允许一个事物，独锁某个数据，具有
     <strong>
      排他性
     </strong>
     。
    </p>
    <ul>
     <li>
      不允许并发加写锁。
     </li>
    </ul>
    <h3>
     <a id="S_22">
     </a>
     共享型封锁（S封锁，读锁）
    </h3>
    <p>
     在S封锁解除之前，不允许任何事务对S锁数据实现X锁。
    </p>
    <ul>
     <li>
      允许并发加读锁
     </li>
    </ul>
    <h2>
     <a id="_27">
     </a>
     备份
    </h2>
    <h3>
     <a id="_28">
     </a>
     逻辑备份
    </h3>
    <p>
     利用DBMS自带的工具软件备份和恢复数据库的内容。
    </p>
    <h3>
     <a id="_30">
     </a>
     物理备份
    </h3>
    <p>
     在操作系统层面上对数据库的数据文件进行备份。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        冷备份
       </th>
       <th>
        热备份
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        关闭数据库进行备份
       </td>
       <td>
        不关闭数据库进行备份。可使用备份软件。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_37">
     </a>
     备份的类型
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        完全备份
       </th>
       <th>
        增量备份
       </th>
       <th>
        差异备份
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        将数据库的内容
        <strong>
         全部备份
        </strong>
        ，备份所需时间较长。
       </td>
       <td>
        只备份上次
        <strong>
         完全、增量或差异备份
        </strong>
        以来
        <strong>
         修改的
        </strong>
        数据。
       </td>
       <td>
        备份自上次
        <strong>
         完全备份
        </strong>
        后发生变化的所有数据。
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="_43">
     </a>
     故障恢复
    </h2>
    <h3>
     <a id="_44">
     </a>
     事务故障的恢复
    </h3>
    <p>
     事务故障是指，事务未运行至正常终止点前被撤销，这时恢复子系统应对此事务做撤销处理。
    </p>
    <p>
     事务故障的恢复是由系统自动完成的，不需要用户干预，步骤如下：
    </p>
    <ol>
     <li>
      反向扫描文件日志，查找该事务的更新操作。
     </li>
     <li>
      对该事务的更新操作执行逆操作。
     </li>
     <li>
      继续反向扫描日志文件，查找该事务的其他更新操作，并做同样处理。
     </li>
     <li>
      如此处理下去，直至读到此事务的开始标记，事务故障恢复完成。
     </li>
    </ol>
    <h3>
     <a id="_54">
     </a>
     系统故障的恢复
    </h3>
    <p>
     系统故障发生时，造成数据库不一致状态的原因有两个：
    </p>
    <ol>
     <li>
      由于一些未完成事务对数据库的更新已写入数据库。
     </li>
     <li>
      由于一些已提交事务对数据库的更新还留在缓冲区未写入数据库。
     </li>
    </ol>
    <p>
     系统故障的恢复是在重新启动时自动完成的，不需要用户干预，步骤如下：
    </p>
    <ol>
     <li>
      正向扫描日志文件，找出在故障发生前已经提交的事务，将其事务标识记入重做（Redo）队列。同时找出故障发生时尚未完成的事务，将事务标识记入撤销（Undo）队列。
     </li>
     <li>
      对撤销队列中的各个事务进行撤销处理：反向扫描日志文件，对每个Undo事务的更新操作执行逆操作。
     </li>
     <li>
      对重做队列中各个事务进行重做处理：正向扫描日志文件，对每个Redo事务重新执行日志文件登记的操作。
     </li>
    </ol>
    <h3>
     <a id="_66">
     </a>
     介质故障与病毒破坏的恢复
    </h3>
    <p>
     在发生介质故障和遭病毒破坏时，磁盘上的物理数据库被破坏，这时的恢复操作可分为三步：
    </p>
    <ol>
     <li>
      装入最新的数据库后备副本，使数据库恢复到最近一次转储时的一致性状态。
     </li>
     <li>
      从故障点开始反向读日志文件，找出已提交事务标识将其记入重做队列。
     </li>
     <li>
      从起始点开始正向阅读日志文件，根据重做队列中的记录，重做所有已完成事务，将数据库恢复至故障前某一时刻的已执行状态。
     </li>
    </ol>
    <h3>
     <a id="_73">
     </a>
     具有检查点的恢复技术
    </h3>
    <p>
     检查点记录的内容可包括：
    </p>
    <ul>
     <li>
      建立检查点时刻所有正在执行的事务清单。
     </li>
     <li>
      这些事务最近一个日志记录的地址。
     </li>
    </ul>
    <p>
     采用检查点的恢复步骤如下：
    </p>
    <ul>
     <li>
      找到最后一个检查点记录在日志文件中的位置，由该地址在日志文件中找到最后一个检查点记录。
     </li>
     <li>
      由该检查点记录得到检查点建立时，所有正在执行的事务清单队列（A）。
     </li>
     <li>
      建立重做队列（R）和撤销队列（U），将A队列放入U队列中，R队列为空。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f31383934313731332f:61727469636c652f64657461696c732f313436303536323531" class_="artid" style="display:none">
 </p>
</div>


