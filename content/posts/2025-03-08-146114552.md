---
layout: post
title: "docker远程响应"
date: 2025-03-08 12:58:01 +0800
description: "从日志中可以看到，Docker 服务已经成功启动，并且监听在 /var/run/docker.sock 和 [::]:2376 端口。\"hosts\": [\"unix:///var/run/docker.sock\",  \"tcp://0.0.0.0:2376\"]   #注意：加密和不加密用的端口不一样。安装docker之后，默认的镜像及容器存储路径为/var/lib/docker，可以使用命令docker info查看。编辑 /etc/docker/daemon.json。"
keywords: "【docker远程响应】"
categories: ['智能化运维']
tags: ['运维', '数据库', '容器', '云计算', 'Oracle', 'Mysql', 'Docker']
artid: "146114552"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146114552
    alt: "docker远程响应"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146114552
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146114552
cover: https://bing.ee123.net/img/rand?artid=146114552
image: https://bing.ee123.net/img/rand?artid=146114552
img: https://bing.ee123.net/img/rand?artid=146114552
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【docker远程响应】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2 style="margin-left:0px; margin-right:0px; text-align:left">
     一、实验目的：
    </h2>
    <p style="margin-left:0; margin-right:0; text-align:left">
     1、熟练掌握docker的安装和使用
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     2、熟练掌握docker的文件配置
    </p>
    <h2 style="margin-left:0px; margin-right:0px; text-align:left">
     二、实验内容：
    </h2>
    <p style="margin-left:0; margin-right:0; text-align:left">
     需求：
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     使用centos完成docekr的远程响应
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     完成
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     1、docker加速器配置
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     2、修改默认存储配置
    </p>
    <p style="margin-left:0; margin-right:0; text-align:left">
     3、docker远程响应
    </p>
    <h2 style="text-align:left">
     三、实验结果
    </h2>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      添加加速器
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     vi /etc/docker/daemon.json
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     添加以下内容
    </p>
    <blockquote>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      {
      <!-- -->
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "registry-mirrors": [
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.registry.cyou",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker-cf.registry.cyou",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://dockercf.jsdelivr.fyi",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.jsdelivr.fyi",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://dockertest.jsdelivr.fyi",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://mirror.aliyuncs.com",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://dockerproxy.com",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://mirror.baidubce.com",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.m.daocloud.io",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.nju.edu.cn",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.mirrors.sjtug.sjtu.edu.cn",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.mirrors.ustc.edu.cn",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://mirror.iscas.ac.cn",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "https://docker.rainbond.cc"
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      ]
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      }
     </p>
    </blockquote>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="617" src="https://i-blog.csdnimg.cn/direct/157862723a284183bb481a3e79a60e65.png" width="1267"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     重置配置和docker服务
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     systemctl daemon-reload 更新源
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     systemctl docker
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     如果启动有错误可以去日志查看
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     journalctl -u docker.service -f
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="106" src="https://i-blog.csdnimg.cn/direct/0b593b6acaf64c8c837e7d1ceca33d25.png" width="1595"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      修改默认存储位置
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     安装docker之后，默认的镜像及容器存储路径为/var/lib/docker，可以使用命令docker info查看。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker info
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="1343" src="https://i-blog.csdnimg.cn/direct/d17ae37227ec40b2a87366df4cde7259.png" width="1246"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     这是系统默认位置
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="127" src="https://i-blog.csdnimg.cn/direct/7f6bec44cc214c11b7b59b115d08980c.png" width="679"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      配置
     </strong>
     <strong>
      docker
     </strong>
     <strong>
      远程响应
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     编辑 /etc/docker/daemon.json
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     添加hosts参数以启用 TCP 监听，同时保留本地 UNIX 套接字：
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="599" src="https://i-blog.csdnimg.cn/direct/55381e40d62e4e669b33cad4d589b32e.png" width="1261"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     重启
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     systemctl daemon-reload
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     systemctl restart docker
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     处理 systemd 冲突
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     若系统使用systemd（如 Rocky Linux/CentOS），需创建覆盖文件
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     mkdir -p /etc/systemd/system/docker.service.
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     vim /etc/systemd/system/docker.service.d/override.conf
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     [Service]
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     ExecStart=
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     ExecStart=/usr/bin/dockerd
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     重启服务：
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     systemctl daemon-reload &amp;&amp; systemctl restart docker
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="123" src="https://i-blog.csdnimg.cn/direct/abb413f88f724d7f8b377c7912fb1b93.png" width="1313"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker -H tcp://10.1.1.123:2375 info
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="1148" src="https://i-blog.csdnimg.cn/direct/f25cea5ffa1c4338ae5090d893968d10.png" width="1226"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      生成
     </strong>
     <strong>
      TLS
     </strong>
     <strong>
      证书
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     mkdir -p /etc/docker/certs &amp;&amp; cd /etc/docker/certs
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      生成
     </strong>
     <strong>
      CA
     </strong>
     <strong>
      根证书
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 生成加密的 CA 私钥（4096位，AES-256加密）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl genrsa -aes256 -out ca-key.pem  4096   #注意需要输入至少4个字符，不然报错
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 生成 CA 根证书（有效期10年）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl req -new -x509 -days 3650 -key ca-key.pem  -sha256 -out ca.pem
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="576" src="https://i-blog.csdnimg.cn/direct/78d867425c3746e6b4c6086e292d8d4f.png" width="1346"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      1.2
     </strong>
     <strong>
      生成服务端证书
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 生成服务端私钥（不加密，便于自动加载）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl genrsa -out server-key.pem  4096
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 创建证书签名请求（CSR）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl req -subj "/CN=10.1.1.123" -sha256 -new -key server-key.pem  -out server.csr
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 设置扩展属性（仅用于服务端认证）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     echo subjectAltName = IP:10.1.1.123 &gt; extfile.cnf
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="91" src="https://i-blog.csdnimg.cn/direct/10a0e698c94647ee8eafdef2209ffc06.png" width="828"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 签发服务端证书
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl x509 -req -days 365 -sha256 -in server.csr  -CA ca.pem  -CAkey ca-key.pem  \
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     -CAcreateserial -out server-cert.pem  -extfile extfile.cnf
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="246" src="https://i-blog.csdnimg.cn/direct/26aa0e7cf8c049fdacd4000c7e5dc1d4.png" width="1331"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      1.3
     </strong>
     <strong>
      生成客户端证书
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 生成客户端私钥
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl genrsa -out client-key.pem  4096
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 创建客户端 CSR
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl req -subj "/CN=client" -new -key client-key.pem  -out client.csr
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 设置扩展属性（客户端认证）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     echo extendedKeyUsage = clientAuth &gt; extfile-client.cnf
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 签发客户端证书
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     openssl x509 -req -days 365 -sha256 -in client.csr  -CA ca.pem  -CAkey ca-key.pem  \
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     -CAcreateserial -out client-cert.pem  -extfile extfile-client.cnf
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="314" src="https://i-blog.csdnimg.cn/direct/7aedd9ffd1ad4649be0bbf22a321d89e.png" width="1340"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      1.4
     </strong>
     <strong>
      设置证书的权限
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     chmod 0400 ca-key.pem  server-key.pem  client-key.pem
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     chmod 0444 ca.pem  server-cert.pem  client-cert.pem
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="103" src="https://i-blog.csdnimg.cn/direct/85b0cfe620a04382aa851784da844471.png" width="941"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker服务端配置 TLS 监听
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     修改 daemon.json ：
    </p>
    <blockquote>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      {
      <!-- -->
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "tls": true,
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "tlscacert": "/path/to/ca.pem",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "tlscert": "/path/to/server-cert.pem",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "tlskey": "/path/to/server-key.pem",
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      "hosts": ["unix:///var/run/docker.sock",  "tcp://0.0.0.0:2376"]   #注意：加密和不加密用的端口不一样
     </p>
     <p style="margin-left:0; margin-right:0; text-align:justify">
      }
     </p>
    </blockquote>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="776" src="https://i-blog.csdnimg.cn/direct/a72ac1216ef24890939acf58e1bbb737.png" width="1321"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     3.3、防火墙配置
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     开放 TCP 端口根据是否加密选择）：若防火墙未开，省掉该步
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 非加密端口（仅限内网）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     firewall-cmd --permanent --add-port=2375/tcp
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     # 加密端口（推荐公网）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     firewall-cmd --permanent --add-port=2376/tcp
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     firewall-cmd –reload
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      重启
     </strong>
     <strong>
      Docker
     </strong>
     <strong>
      服务
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     systemctl restart docker
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     journalctl -u docker.service  -f
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="537" src="https://i-blog.csdnimg.cn/direct/5a028a9c598f481684c2eb9856c47fdc.png" width="1552"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     发现前面的文件写错了（前面图片是已经更正完的）
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <strong>
      远程客户端测试连接
     </strong>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     传输证书到客户端
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     将 ca.pem 、client-cert.pem 、client-key.pem 复制到客户端 ~/.docker/ 目录。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     scp ca.pem client-cert.pem client-key.pem
     <a href="mailto:root@10.1.1.123:~/.docker/" rel="nofollow">
      root@10.1.1.123:~/.docker/
     </a>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="389" src="https://i-blog.csdnimg.cn/direct/3f8e756e184e4a39a6bb08c56609d889.png" width="1533"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker -H tcp://10.1.1.123:2376 --tlsverify ps
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     然后这里出现了错误
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="629" src="https://i-blog.csdnimg.cn/direct/9ad61eed3f874b0ea9a65c2c6b89b00d.png" width="1624"/>
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     从日志中可以看到，Docker 服务已经成功启动，并且监听在 /var/run/docker.sock 和 [::]:2376 端口。然而，客户端尝试连接时有错误，这表明客户端在尝试通过 TLS 连接到 Docker 守护进程时，未能提供有效的客户端证书。
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     docker -H tcp://10.1.1.123:2376 --tlsverify --tlscacert=ca.pem  --tlscert=client-cert.pem  --tlskey=client-key.pem  info
    </p>
    <p style="margin-left:0; margin-right:0; text-align:justify">
     <img alt="" height="1120" src="https://i-blog.csdnimg.cn/direct/9f8de2ddb685447bb568d8f1b117771f.png" width="1314"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f41313131315f3539392f:61727469636c652f64657461696c732f313436313134353532" class_="artid" style="display:none">
 </p>
</div>


