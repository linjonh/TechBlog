---
layout: post
title: "SegRNN-源码理解"
date: 2025-03-05 17:09:02 +0800
description: "特征，时间步，每个特征 60 个观察值，分成 5 份，每份 12 个时间步，嵌入到 512 维输入: x = [16, 7, 60]  # [batch, feature, time]v   重塑v  嵌入。"
keywords: "segrnn 模型"
categories: ['扒代码']
tags: ['Python']
artid: "146044810"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146044810
    alt: "SegRNN-源码理解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146044810
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146044810
cover: https://bing.ee123.net/img/rand?artid=146044810
image: https://bing.ee123.net/img/rand?artid=146044810
img: https://bing.ee123.net/img/rand?artid=146044810
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【SegRNN 源码理解】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <span style="color:#fe2c24">
      x = self.valueEmbedding(x.reshape(-1, self.seg_num_x, self.seg_len))
     </span>
    </p>
    <h2 id="valueEmbedding" name="valueEmbedding">
     <span style="color:#fe2c24">
      valueEmbedding
     </span>
    </h2>
    <p>
     特征，时间步，每个特征 60 个观察值，分成 5 份，每份 12 个时间步，嵌入到 512 维
    </p>
    <p>
     输入: x = [16, 7, 60]  # [batch, feature, time]
     <br/>
     |
     <br/>
     v   重塑
     <br/>
     [112, 5, 12]  # [batch*feature, segments, segment_length]
     <br/>
     |
     <br/>
     v  嵌入
     <br/>
     [112, 5, 512]  # [batch*feature, segments, d_model]
    </p>
    <p>
     <img alt="" height="918" src="https://i-blog.csdnimg.cn/direct/573cb5450f2f43b0a55e6ee0b5f7934f.png" width="2010"/>
    </p>
    <p>
     <img alt="" height="680" src="https://i-blog.csdnimg.cn/direct/b6fb0c7627a044f1857d7f58103a6420.png" width="2004">
     </img>
    </p>
    <h2 id="_%2C%20hn%20%3D%20self.rnn(x)" name="_%2C%20hn%20%3D%20self.rnn(x)">
     _, hn = self.rnn(x)
    </h2>
    <p>
     x 嵌入以后，喂给 RNN
    </p>
    <p>
     <img alt="" height="952" src="https://i-blog.csdnimg.cn/direct/1430337ba178462cbc3c4ce766c3d633.png" width="1430"/>
    </p>
    <p>
     RNN 隐藏层的输出：1×112×512
    </p>
    <p>
     <img alt="" height="582" src="https://i-blog.csdnimg.cn/direct/355ec16a65fc4678a554bebe29955f64.png" width="1448"/>
    </p>
    <p>
     <img alt="" height="784" src="https://i-blog.csdnimg.cn/direct/adab0003e95b489faa04266cc962ce99.png" width="1438"/>
    </p>
    <h2 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E4%B8%BA%E4%BB%80%E4%B9%88h_n%E7%9A%84%E5%BD%A2%E7%8A%B6%20%5B1%2C%20112%2C%20512%5D" name="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E4%B8%BA%E4%BB%80%E4%B9%88h_n%E7%9A%84%E5%BD%A2%E7%8A%B6%20%5B1%2C%20112%2C%20512%5D">
     <img alt="" height="1310" src="https://i-blog.csdnimg.cn/direct/cf3269c82b534a4c951751b5c8653014.png" width="1462">
      为什么h_n的形状 [1, 112, 512]
     </img>
    </h2>
    <p>
     <img alt="" height="876" src="https://i-blog.csdnimg.cn/direct/5c10465072e74a30b81ea9b3defe7996.png" width="2030"/>
    </p>
    <p>
     <img alt="" height="628" src="https://i-blog.csdnimg.cn/direct/4dac158573074a8ca4ef8bc585828c9e.png" width="1992">
      <img alt="" height="644" src="https://i-blog.csdnimg.cn/direct/78387d641e3f4c1c81030c38d0e6d65d.png" width="2016"/>
     </img>
    </p>
    <p>
     <img alt="" height="678" src="https://i-blog.csdnimg.cn/direct/4eb6166e567b4f76bba5d731a984f8f7.png" width="1930"/>
    </p>
    <h2 id="RNN%E5%9C%A8%E4%B8%8D%E5%88%86%E6%AE%B5%E5%A4%84%E7%90%86%E6%97%B6%E7%9A%84%E5%BD%A2%E7%8A%B6%E5%88%86%E6%9E%90" name="RNN%E5%9C%A8%E4%B8%8D%E5%88%86%E6%AE%B5%E5%A4%84%E7%90%86%E6%97%B6%E7%9A%84%E5%BD%A2%E7%8A%B6%E5%88%86%E6%9E%90">
     RNN在不分段处理时的形状分析
    </h2>
    <p>
     如果SegRNN模型不进行分段处理，而是直接将完整的时间序列输入到RNN中，其输入、输出的形状和处理过程会有显著不同。
    </p>
    <p>
     <strong>
      不分段的RNN输入输出形状
     </strong>
    </p>
    <p>
     假设我们保持批次大小(16)和特征数(7)不变，但不对60个时间步分段处理：
    </p>
    <p>
     输入数据预处理
    </p>
    <p>
     <img alt="" height="934" src="https://i-blog.csdnimg.cn/direct/822dbb9da9f24a8085deec658d549bec.png" width="2012"/>
    </p>
    <p>
     <img alt="" height="1166" src="https://i-blog.csdnimg.cn/direct/8e7b235e7163466ca43aea8da1c84658.png" width="2018"/>
    </p>
    <p>
     <img alt="" height="922" src="https://i-blog.csdnimg.cn/direct/952efef5fb8047f2b5cdadc5eb3989e4.png" width="2006"/>
     <img alt="" height="720" src="https://i-blog.csdnimg.cn/direct/cfc5c1d2ba084b6ca592fabfea4bee26.png" width="2000"/>
    </p>
    <p>
     <img alt="" height="926" src="https://i-blog.csdnimg.cn/direct/defc1305b0e54e18a2f3b6c917f6ca18.png" width="2000"/>
     <span style="background-color:#fe2c24">
      问题：
     </span>
    </p>
    <blockquote>
     <p>
      它这么处理是在建模什么东西，尤其是 16*7 的变换我不明白，是什么实际意义，然后又分成 5 段，相当于 5 个时间步，感觉把原始的 16 个 Batch，每个 Batch 60 个时间步，每个时间步 7 个特征的原始信息含义都混着了
     </p>
    </blockquote>
    <p>
     <img alt="" height="956" src="https://i-blog.csdnimg.cn/direct/5d44a5a545a6454d867dcc5dbaf4d4dd.png" width="1992"/>
    </p>
    <p>
     <img alt="" height="498" src="https://i-blog.csdnimg.cn/direct/df7223adf563452b9b230ec982f2a027.png" width="2012"/>
    </p>
    <p>
     <img alt="" height="444" src="https://i-blog.csdnimg.cn/direct/9dc4ffe0b9e54c819dc7d42c6f29810a.png" width="2010"/>
    </p>
    <p>
     <img alt="" height="804" src="https://i-blog.csdnimg.cn/direct/8aa94999c67341dd8f7c9be22c1d628a.png" width="2000"/>
    </p>
    <p>
     <img alt="" height="826" src="https://i-blog.csdnimg.cn/direct/e04427fe89484ca38cae5d17ab67ccd1.png" width="2014"/>
    </p>
    <p>
     <img alt="" height="390" src="https://i-blog.csdnimg.cn/direct/36df50938eae492da0db2a2ecf0e9cae.png" width="2018"/>
    </p>
    <p>
     <img alt="" height="1232" src="https://i-blog.csdnimg.cn/direct/a9b470704360491b8d2d73876018e2ed.png" width="1988"/>
    </p>
    <blockquote>
     <p>
      RNN 对这个 16个地区的疫情数据 每个地区记录60天 每天记录7种指标（确诊数、死亡数、恢复数、新增病例、R0值、人口密度、医疗资源） 直接进行时间序列建模的输入和输出是什么样的
     </p>
    </blockquote>
    <p>
     <img alt="" height="568" src="https://i-blog.csdnimg.cn/direct/2d6e99acf13e45d69c195fc619976ec6.png" width="2006"/>
    </p>
    <p>
     <img alt="" height="804" src="https://i-blog.csdnimg.cn/direct/6ed32627426649cead0176ca79fc403e.png" width="2004"/>
    </p>
    <p>
     <img alt="" height="776" src="https://i-blog.csdnimg.cn/direct/f9b58cf2411c43fea81fd139962def73.png" width="2006"/>
    </p>
    <p>
     <img alt="" height="448" src="https://i-blog.csdnimg.cn/direct/477f9303352748e6850dce38a3a4a698.png" width="2000"/>
    </p>
    <p>
     <img alt="" height="798" src="https://i-blog.csdnimg.cn/direct/0c260fd105c64cca8b31aed03252e1d3.png" width="1988"/>
    </p>
    <p>
     <img alt="" height="792" src="https://i-blog.csdnimg.cn/direct/5a0eab928780402baf1c0aefe1cadd57.png" width="2036"/>
    </p>
    <p>
     <img alt="" height="988" src="https://i-blog.csdnimg.cn/direct/6695332e7bca49ff80abd42f132b94e2.png" width="2016"/>
    </p>
    <p>
     <span style="color:#fe2c24">
      16个 batch，60 个时间步，7 个特征 -》 112 个序列，5 段，512 维（先理解每段）-》112 个序列，512 维（再混合段落，理解全文）
     </span>
    </p>
    <h2>
     SegRNN的创新：视角转换的重要意义
    </h2>
    <p>
     <img alt="" height="756" src="https://i-blog.csdnimg.cn/direct/86734dacd8824cdfb6a73cf9aae5f9f4.png" width="2008"/>
    </p>
    <p>
     <img alt="" height="1072" src="https://i-blog.csdnimg.cn/direct/22aca0e621b24467adb2b8a1c823ca4d.png" width="2020"/>
    </p>
    <p>
     <img alt="" height="598" src="https://i-blog.csdnimg.cn/direct/53d455d3ce8f4d63a400cc42fb4216f9.png" width="1990"/>
    </p>
    <p>
     <img alt="" height="952" src="https://i-blog.csdnimg.cn/direct/4a392a2193c640e0b58669fda1c01035.png" width="1998"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37373534393937372f:61727469636c652f64657461696c732f313436303434383130" class_="artid" style="display:none">
 </p>
</div>


