---
layout: post
title: "webpack打包nodejs后端代码配置可独立修改方案"
date: 2023-05-05 10:18:06 +0800
description: "文章介绍了使用Webpack和NodeByte进行模块打包的步骤，包括安装依赖、创建webpack."
keywords: "webpack打包nodejs后端代码"
categories: ['Nodejs']
tags: ['后端', 'Webpack', 'Node']
artid: "130500378"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=130500378
    alt: "webpack打包nodejs后端代码配置可独立修改方案"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=130500378
featuredImagePreview: https://bing.ee123.net/img/rand?artid=130500378
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     webpack打包nodejs后端代码配置可独立修改方案
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     工具: webpack + nodebyte
    </p>
    <h4 id="1.%20%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97">
     1. 安装第三方模块
    </h4>
    <pre><code class="language-bash">npm i webpack
npm i -g -S nodebyte</code></pre>
    <h4>
     2. 根目录下创建webpack.config.js文件
    </h4>
    <pre><code class="language-javascript">const path = require('path');
 
module.exports = {
  entry: './index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'build')
  },
  target: 'node' ,
  output: {
    libraryTarget: 'commonjs',
  },
  externals: [
    /^(?!\.|\/).+/i,
  ]
}</code></pre>
    <h4 id="3.%C2%A0%E6%B7%BB%E5%8A%A0%E5%91%BD%E4%BB%A4%E8%87%B3package.json%E6%96%B9%E4%BE%BF%E5%90%8E%E7%BB%AD%E6%89%93%E5%8C%85">
     3. 添加命令至package.json方便后续打包
    </h4>
    <pre><code class="language-javascript">"scripts": {
    "build": "webpack",
    "build2": "bytenode --compile ./dist/main.js"
  },</code></pre>
    <h4 id="4.%C2%A0%E5%88%9B%E5%BB%BAstatic%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%B0%86%E5%8E%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6config.js%E5%A4%8D%E5%88%B6%E4%B8%80%E4%BB%BD%E5%89%AF%E6%9C%AC%E6%94%BE%E5%9C%A8%E8%AF%A5%E7%9B%AE%E5%BD%95%E4%B8%8B">
     4. 创建static目录，将原配置文件config.js复制一份副本放在该目录下
    </h4>
    <p>
     目录结构如下：
    </p>
    <p>
     |—config
    </p>
    <p>
     | |—config.js
    </p>
    <p>
     |—static
    </p>
    <p>
     | |—config.js
    </p>
    <h4>
     5. 修改两个config.js
    </h4>
    <ul>
     <li>
      static/config.js 正常编写配置
     </li>
    </ul>
    <pre><code class="language-javascript">module.exports = {
    "api": {
        "address": "0.0.0.0",
        "port": "13000"
    },
    "mongodb": {
        "url": "mongodb://192.168.0.26:27017/test"
    }
};</code></pre>
    <ul>
     <li>
      config/config.js 使用fs读取static下配置
     </li>
    </ul>
    <pre><code class="language-javascript">const Fs = require('fs');
let configfile = Fs.readFileSync('./static/config.js','utf-8').toString();
let index = configfile.indexOf("=")
let configStr = configfile.substring(index + 1);    
configStr = configStr.substring(0,configStr.length - 1)   //去掉最后的;号
let config = JSON.parse(configStr)
module.exports = config</code></pre>
    <blockquote>
     <p>
      因为webpack会将require或import的js全部打包在一起，所以采用fs读取配置的方式。其他js文件引用config/config.js中的配置即可。
     </p>
    </blockquote>
    <h4>
     6. 打包
    </h4>
    <p>
     <strong>
      <code>
       npm run build
      </code>
     </strong>
     使用webpack进行打包，打包为一个main.js文件
    </p>
    <p>
     <strong>
      <code>
       npm run build2
      </code>
     </strong>
     将main.js转为字节码文件main.jsc
    </p>
    <h4>
     7. 运行
    </h4>
    <ul>
     <li>
      方式一： 直接使用bytenode ./dist/main.jsc运行项目
     </li>
     <li>
      方式二：
      <ul>
       <li>
        先编写运行文件index.js
        <pre><code class="language-javascript">require('bytenode');
require('./dist/main.jsc');</code></pre>
       </li>
       <li>
        再node运行index.js或使用pm2运行index.js
       </li>
      </ul>
     </li>
    </ul>
    <h4>
    </h4>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f46414e473437372f:61727469636c652f64657461696c732f313330353030333738" class_="artid" style="display:none">
 </p>
</div>


