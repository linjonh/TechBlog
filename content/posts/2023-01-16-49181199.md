---
layout: post
title: "多种的方法得到数据库的connection"
date: 2023-01-16 18:10:19 +0800
description: "第一种方式得到连接：数据库厂商必须实现的接口Driver，当连接数据库是别忘了添加相应的数据库驱动j"
keywords: "mysql文件中的connections.ncx如何获得"
categories: ['Javaweb']
tags: ['无标签']
artid: "49181199"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=49181199
    alt: "多种的方法得到数据库的connection"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=49181199
featuredImagePreview: https://bing.ee123.net/img/rand?artid=49181199
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     多种的方法得到数据库的connection
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <span style="color:#660000">
      <span style="font-size:18px">
       第一种方式得到连接：数据库厂商必须实现的接口Driver，当连接数据库是别忘了添加相应的数据库驱动jar包
      </span>
      <span style="font-size:18px">
       。
      </span>
     </span>
    </p>
    <p>
     <span style="color:#660000">
      <span style="font-size:18px">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="color:#660000">
      <span style="font-size:18px">
       最原始的Driver 接口实现获取connection：
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="color:#660000">
      <span style="font-size:18px">
       Java.sql.Driver 接口是所有 JDBC 驱动程序需要实现的接口。这个接口是提供给数据库厂商使用的，不同数据库厂商提供不同的实现
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="color:#660000">
      <span style="font-size:18px">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      @Test
      <br/>
      public void testDriver() throws SQLException{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      //1.创建一个Driver实现类的对象
      <br/>
      <span style="white-space:pre">
      </span>
      Driver driver=new Driver();
      <br/>
      <span style="white-space:pre">
      </span>
      //2.准备连接数据库的基本信息：url、user、password
      <br/>
      <span style="white-space:pre">
      </span>
      String url="jdbc:mysql://localhost:3306/bookstore";
      <br/>
      <span style="white-space:pre">
      </span>
      java.util.Properties info=new java.util.Properties();
      <br/>
      <span style="white-space:pre">
      </span>
      info.put("user","root");
      <br/>
      <span style="white-space:pre">
      </span>
      info.put("password","");
      <br/>
      <span style="white-space:pre">
      </span>
      //3.调用Driver接口的connect(url,info)获取数据库连接
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      Connection connection= driver.connect(url, info);
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(connection);
      <br/>
      }
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      driver接口提供了得到connection的方法：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      Connection connect(String url,
      <br/>
      Properties info)
      <br/>
      throws SQLException
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px; color:#990000">
      在运行中出现了这种错误：
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#990000">
       java.sql.SQLException: Access denied for user 'root'@'localhost' (using password: NO)
      </span>
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#990000">
       解决的方案：将root用户的password设置为空。
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#990000">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      G:\mysql-5.5.41-winx64\bin&gt;mysql -u root -p
      <br/>
      Enter password: ******
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      mysql&gt; use mysql；
      <br/>
      <span style="color:#990000">
       ERROR 1049 (42000): Unknown database 'mysql；'
      </span>
      <br/>
      <span style="color:#990000">
       mysql&gt; use mysql;
      </span>
      <br/>
      <span style="color:#990000">
       Database changed
      </span>
      <br/>
      mysql&gt; update user set password=password('') where user='root';
      <br/>
      <span style="color:#990000">
       Query OK, 3 rows affected (0.01 sec)
      </span>
      <br/>
      <span style="color:#990000">
       Rows matched: 3  Changed: 3  Warnings: 0
      </span>
      <br/>
      mysql&gt; flush privileges;
      <br/>
      <span style="color:#990000">
       Query OK, 0 rows affected (0.03 sec)
      </span>
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px; color:#660000">
      第二种方式：通过修改配置文件的方式实现和具体的数据库解耦
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      /*编写一个通用的方法，在不改变源程序的情况下，
      <br/>
      * 可以获取任何数据库的连接。
      <br/>
      * 解决方法：把数据库驱动Driver实现累的全类名
      <br/>
      * url、user、password放入一个配置一个文件中
      <br/>
      * 通过修改配置文件的方式实现和具体的数据库解耦
      <br/>
      */
      <br/>
      <br/>
      <br/>
      public Connection getconnection() throws
      <br/>
      InstantiationException, IllegalAccessException,
      <br/>
      ClassNotFoundException, SQLException, IOException{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      String driverClass=null;
      <br/>
      <span style="white-space:pre">
      </span>
      String jdbcUrl=null;
      <br/>
      <span style="white-space:pre">
      </span>
      String user=null;
      <br/>
      <span style="white-space:pre">
      </span>
      String password=null;
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //读取jdbc.properties文件
      <br/>
      <span style="white-space:pre">
      </span>
      InputStream in=getClass()
      <br/>
      <span style="white-space:pre">
      </span>
      .getClassLoader()
      <br/>
      <span style="white-space:pre">
      </span>
      .getResourceAsStream("jdbc.properties");
      <br/>
      <span style="white-space:pre">
      </span>
      Properties properties=new Properties();
      <br/>
      <span style="white-space:pre">
      </span>
      properties.load(in);
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      driverClass=properties.getProperty("driverClass");
      <br/>
      <span style="white-space:pre">
      </span>
      jdbcUrl=properties.getProperty("jdbcUrl");
      <br/>
      <span style="white-space:pre">
      </span>
      user=properties.getProperty("user");
      <br/>
      <span style="white-space:pre">
      </span>
      password=properties.getProperty("password");
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      Driver driver=
      <br/>
      <span style="white-space:pre">
      </span>
      (Driver) Class.forName(driverClass).newInstance();
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      Properties info=new Properties();
      <br/>
      info.put("user", user);
      <br/>
      info.put("password", password);
      <br/>
      <br/>
      Connection connection=driver.connect(jdbcUrl, info);
      <br/>
      return connection;
      <br/>
      }
      <br/>
      <br/>
      <br/>
      @Test
      <br/>
      public void testGetConnection() throws InstantiationException, IllegalAccessException, ClassNotFoundException, SQLException, IOException{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(getconnection());
      <br/>
      }
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px; color:#660000">
      配置文件：jdbc.properties
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      driverClass=com.mysql.jdbc.Driver
      <br/>
      jdbcUrl=jdbc:mysql://localhost:3306/bookstore
      <br/>
      user=root
      <br/>
      password=root
      <br/>
      <br/>
      <br/>
      #driverClass=oracle.jdbc.driver.OracleDriver
      <br/>
      #jdbcUrl=jdbc:oracle:thin:@localhost:1521:oracle
      <br/>
      #user=scott
      <br/>
      #password=tiger
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#660000">
       第三种方式：
       <span style="font-size:18px">
        //3、通过DriverManager的getconnection（）方法获取数据连接。
       </span>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      @Test
      <br/>
      <span style="white-space:pre">
      </span>
      public void TestDriverManager() throws IOException, ClassNotFoundException, SQLException{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      String driverClass=null;
      <br/>
      <span style="white-space:pre">
      </span>
      String jdbcUrl=null;
      <br/>
      <span style="white-space:pre">
      </span>
      String user=null;
      <br/>
      <span style="white-space:pre">
      </span>
      String password=null;
      <br/>
      <span style="white-space:pre">
      </span>
      //读取jdbc.properties文件
      <br/>
      <span style="white-space:pre">
      </span>
      InputStream in=getClass()
      <br/>
      <span style="white-space:pre">
      </span>
      .getClassLoader()
      <br/>
      <span style="white-space:pre">
      </span>
      .getResourceAsStream("jdbc.properties");
      <br/>
      <span style="white-space:pre">
      </span>
      Properties properties=new Properties();
      <br/>
      <span style="white-space:pre">
      </span>
      properties.load(in);
      <br/>
      <span style="white-space:pre">
      </span>
      driverClass=properties.getProperty("driverClass");
      <br/>
      <span style="white-space:pre">
      </span>
      jdbcUrl=properties.getProperty("jdbcUrl");
      <br/>
      <span style="white-space:pre">
      </span>
      user=properties.getProperty("user");
      <br/>
      <span style="white-space:pre">
      </span>
      password=properties.getProperty("password");
      <br/>
      <span style="white-space:pre">
      </span>
      //2、加载数据库驱动程序（注册驱动）
      <br/>
      <span style="white-space:pre">
      </span>
      Class.forName(driverClass);
      <br/>
      <span style="white-space:pre">
      </span>
      //3、通过DriverManager的getconnection（）方法获取数据连接。
      <br/>
      <span style="white-space:pre">
      </span>
      Connection connection=(Connection) DriverManager.getConnection(jdbcUrl,user, password);
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(connection);
      <br/>
      <span style="white-space:pre">
      </span>
      }
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px; color:#660000">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#660000">
       通过DriverManager类中的static Connection getConnection(String url, Properties info) 。
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#990000">
       第四种方式：DBCP共享池
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      DBCP 数据源
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      DBCP 是 Apache 软件基金组织下的开源连接池实现，该连接池依赖该组织下的另一个开源系统：Common-pool. 如需使用该连接池实现，应在系统中增加如下两个 jar 文件：
      <br/>
      Commons-dbcp.jar：连接池的实现
      <br/>
      Commons-pool.jar：连接池实现的依赖库
      <br/>
      Tomcat 的连接池正是采用该连接池来实现的。该数据库连接池既可以与应用服务器整合使用，也可由应用程序独立使用。
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      DBCP 数据源使用范例
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      数据源和数据库连接不同，数据源无需创建多个，它是产生数据库连接的工厂，因此整个应用只需要一个数据源即可。
      <br/>
      当数据库访问结束后，程序还是像以前一样关闭数据库连接：conn.close(); 但上面的代码并没有关闭数据库的物理连接，它仅仅把数据库连接释放，归还给了数据库连接池。
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      @Test
      <br/>
      <span style="white-space:pre">
      </span>
      public void testDBCP() throws SQLException{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      BasicDataSource dataSource=null;
      <br/>
      <span style="white-space:pre">
      </span>
      //1.建立创建DBPC数据源实例
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource=new BasicDataSource();
      <br/>
      <span style="white-space:pre">
      </span>
      //2.为数据源实例指定必须的属性
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setUsername("root");
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setPassword("root");
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setUrl("jdbc:mysql://localhost:3306/atguigu");
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setDriverClassName("com.mysql.jdbc.Driver");
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //指定数据源的一些可选的属性
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //1、指定数据库连接池中初始连接数的个数
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setInitialSize(10);
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //2、指定最大的连接数：同一时刻可以同时向数据库申请的连接数
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setMaxActive(50);
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //3、指定最小连接数：在数据库连接池中保存最少的空闲的连接的数量
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setMinIdle(5);
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //4、等待数据库连接池分配连接的最长时间，单位为毫秒，超出该时间抛出异常
      <br/>
      <span style="white-space:pre">
      </span>
      dataSource.setMaxWait(1000*5);
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      //3、从数据库中获取数据库连接
      <br/>
      <span style="white-space:pre">
      </span>
      Connection connection=dataSource.getConnection();
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(connection);
      <br/>
      <span style="white-space:pre">
      </span>
      }
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      通过DBCP共享池中的
      <span style="font-size:18px">
       BasicDataSourceFactory：
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="font-size:18px">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      @Test
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      public void testDBCPWithDataSourceFactory() throws Exception{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      Properties properties=new Properties();
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      InputStream inputStream=JDBCTest.class.getClassLoader()
      <br/>
      <span style="white-space:pre">
      </span>
      .getResourceAsStream("dbcp.properties");
      <br/>
      <span style="white-space:pre">
      </span>
      properties.load(inputStream);
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      javax.sql.DataSource dataSource=
      <br/>
      <span style="white-space:pre">
      </span>
      BasicDataSourceFactory.createDataSource(properties);
      <br/>
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(dataSource.getConnection());
      <br/>
      <span style="white-space:pre">
      </span>
      BasicDataSource basicDataSource=(BasicDataSource) dataSource;
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(basicDataSource.getMaxWait());
      <br/>
      <span style="white-space:pre">
      </span>
      }
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#cc0000">
       第五种方式：c3p0共享池
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
      <br/>
      <span style="white-space:pre">
      </span>
      /**
      <br/>
      <span style="white-space:pre">
      </span>
      * 1. 创建 c3p0-config.xml 文件,
      <br/>
      <span style="white-space:pre">
      </span>
      * 参考帮助文档中 Appendix B: Configuation Files 的内容
      <br/>
      <span style="white-space:pre">
      </span>
      * 2. 创建 ComboPooledDataSource 实例；
      <br/>
      <span style="white-space:pre">
      </span>
      * DataSource dataSource =
      <br/>
      <span style="white-space:pre">
      </span>
      *
      <span style="white-space:pre">
      </span>
      new ComboPooledDataSource("helloc3p0");
      <br/>
      <span style="white-space:pre">
      </span>
      * 3. 从 DataSource 实例中获取数据库连接.
      <br/>
      <span style="white-space:pre">
      </span>
      */
      <br/>
      <span style="white-space:pre">
      </span>
      @Test
      <br/>
      <span style="white-space:pre">
      </span>
      public void testC3poWithConfigFile() throws Exception{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      DataSource dataSource =
      <br/>
      <span style="white-space:pre">
      </span>
      new ComboPooledDataSource("helloc3p0");
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(dataSource.getConnection());
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      ComboPooledDataSource comboPooledDataSource =
      <br/>
      <span style="white-space:pre">
      </span>
      (ComboPooledDataSource) dataSource;
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(comboPooledDataSource.getMaxStatements());
      <br/>
      <span style="white-space:pre">
      </span>
      }
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      /**
      <br/>
      <span style="white-space:pre">
      </span>
      *
      <br/>
      <span style="white-space:pre">
      </span>
      * @throws PropertyVetoException
      <br/>
      <span style="white-space:pre">
      </span>
      * @throws SQLException
      <br/>
      <span style="white-space:pre">
      </span>
      */
      <br/>
      <span style="white-space:pre">
      </span>
      @Test
      <br/>
      <span style="white-space:pre">
      </span>
      public void testC3p0() throws PropertyVetoException, SQLException{
      <!-- -->
      <br/>
      <span style="white-space:pre">
      </span>
      ComboPooledDataSource cpds = new ComboPooledDataSource();
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      cpds.setDriverClass( "com.mysql.jdbc.Driver" ); //loads the jdbc driver
      <br/>
      <span style="white-space:pre">
      </span>
      cpds.setJdbcUrl( "jdbc:mysql:///atguigu" );
      <br/>
      <span style="white-space:pre">
      </span>
      cpds.setUser("root");
      <br/>
      <span style="white-space:pre">
      </span>
      cpds.setPassword("root");
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
      <span style="white-space:pre">
      </span>
      System.out.println(cpds.getConnection());
      <br/>
      <span style="white-space:pre">
      </span>
      }
      <br/>
      <span style="white-space:pre">
      </span>
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <span style="color:#660000">
       <br/>
      </span>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px; color:#990000">
      <br/>
     </span>
    </p>
    <p>
     <span style="font-size:18px; color:#990000">
      <br/>
     </span>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f677a313533303136:2f61727469636c652f64657461696c732f3439313831313939" class_="artid" style="display:none">
 </p>
</div>


