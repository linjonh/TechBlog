---
layout: post
title: "ä¸‰åˆ†é’ŸæŒæ¡éŸ³è§†é¢‘ä¿¡æ¯æŸ¥è¯¢-åœ¨-Rust-ä¸­ä¼˜é›…åœ°é›†æˆ-FFmpeg"
date: 2025-03-13 00:23:01 +0800
description: "Rust å¼€å‘è€…å¯ä»¥åœ¨ä¸ç›´æ¥å¤„ç† FFmpeg å‘½ä»¤è¡Œå·¥å…·æˆ–åŸç”Ÿ API çš„æƒ…å†µä¸‹ï¼Œå®‰å…¨ã€é«˜æ•ˆåœ°è·å–åª’ä½“æ–‡ä»¶çš„ä¿¡æ¯"
keywords: "ä¸‰åˆ†é’ŸæŒæ¡éŸ³è§†é¢‘ä¿¡æ¯æŸ¥è¯¢ | åœ¨ Rust ä¸­ä¼˜é›…åœ°é›†æˆ FFmpeg"
categories: ['æœªåˆ†ç±»']
tags: ['éŸ³è§†é¢‘', 'Rust', 'Ffmpeg']
artid: "146218538"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146218538
    alt: "ä¸‰åˆ†é’ŸæŒæ¡éŸ³è§†é¢‘ä¿¡æ¯æŸ¥è¯¢-åœ¨-Rust-ä¸­ä¼˜é›…åœ°é›†æˆ-FFmpeg"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146218538
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146218538
cover: https://bing.ee123.net/img/rand?artid=146218538
image: https://bing.ee123.net/img/rand?artid=146218538
img: https://bing.ee123.net/img/rand?artid=146218538
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ä¸‰åˆ†é’ŸæŒæ¡éŸ³è§†é¢‘ä¿¡æ¯æŸ¥è¯¢ | åœ¨ Rust ä¸­ä¼˜é›…åœ°é›†æˆ FFmpeg
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     å‰è¨€
    </h3>
    <p>
     åœ¨éŸ³è§†é¢‘å¤„ç†é¢†åŸŸï¼Œå¼€å‘è€…å¸¸å¸¸éœ€è¦è·å–åª’ä½“æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚æ—¶é•¿ã€æ ¼å¼ã€å…ƒæ•°æ®ï¼Œä»¥åŠéŸ³è§†é¢‘æµçš„ç¼–ç å‚æ•°ç­‰ã€‚è¿™äº›ä¿¡æ¯å¯¹äºåª’ä½“ç®¡ç†ã€è½¬ç è°ƒåº¦ã€æ’­æ”¾æ§åˆ¶ç­‰åœºæ™¯è‡³å…³é‡è¦ã€‚
    </p>
    <p>
     ç„¶è€Œï¼Œç›´æ¥ä½¿ç”¨ FFmpeg å‘½ä»¤è¡Œå·¥å…·æˆ–å…¶åŸç”Ÿ API å­˜åœ¨ä»¥ä¸‹æŒ‘æˆ˜ï¼š
    </p>
    <ul>
     <li>
      <p>
       <strong>
        å‘½ä»¤è¡Œå·¥å…·çš„å¤æ‚æ€§
       </strong>
       ï¼šFFmpeg çš„å‘½ä»¤è¡Œå‚æ•°ä¼—å¤šä¸”å¤æ‚ï¼Œä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¤„ç†åŒ…å«ç©ºæ ¼çš„æ–‡ä»¶åæ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„æ­£ç¡®çš„è½¬ä¹‰å’Œå¼•ç”¨æ–¹å¼ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ— æ³•è¯†åˆ«æ–‡ä»¶åçš„é—®é¢˜ã€‚
      </p>
     </li>
     <li>
      <p>
       <strong>
        åŸç”Ÿ API çš„å¤æ‚æ€§
       </strong>
       ï¼šFFmpeg æ¶‰åŠå¤§é‡çš„æ•°æ®ç»“æ„å’Œå‡½æ•°è°ƒç”¨ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­ã€‚
      </p>
     </li>
     <li>
      <p>
       <strong>
        å†…å­˜ç®¡ç†çš„å¤æ‚æ€§
       </strong>
       ï¼šç›´æ¥æ“ä½œåº•å±‚ C æ¥å£ï¼Œå®¹æ˜“å¼•å…¥å†…å­˜æ³„æ¼å’Œå®‰å…¨éšæ‚£ã€‚
      </p>
     </li>
     <li>
      <p>
       <strong>
        ç»´æŠ¤æˆæœ¬é«˜
       </strong>
       ï¼šéœ€è¦å¤„ç†ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ï¼Œå¢åŠ äº†å¼€å‘å’Œç»´æŠ¤çš„éš¾åº¦ã€‚
      </p>
     </li>
    </ul>
    <p>
     å› æ­¤ï¼Œåœ¨ Rust ç”Ÿæ€ä¸­ï¼Œå¯»æ‰¾ä¸€ç§ç®€æ´ã€å®‰å…¨ä¸”é«˜æ•ˆçš„æ–¹å¼æ¥é›†æˆ FFmpegï¼Œæˆä¸ºå¼€å‘è€…çš„è¿«åˆ‡éœ€æ±‚ã€‚
    </p>
    <h3>
     <a id="_16">
     </a>
     æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ
    </h3>
    <p>
     ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œ
     <code>
      ez-ffmpeg
     </code>
     åº“åº”è¿è€Œç”Ÿã€‚å®ƒé€šè¿‡ FFIï¼ˆå¤–éƒ¨å‡½æ•°æ¥å£ï¼‰è°ƒç”¨ FFmpeg çš„åº•å±‚ C ä»£ç ï¼Œä¸º Rust å¼€å‘è€…æä¾›äº†ä¸€ä¸ªå®‰å…¨ä¸”ç¬¦åˆäººä½“å·¥å­¦çš„æ¥å£ã€‚è¯¥åº“çš„è®¾è®¡ç›®æ ‡æ˜¯ç®€åŒ– FFmpeg çš„ä½¿ç”¨ï¼Œé¿å…ç›´æ¥æ“ä½œå¤æ‚çš„åŸç”Ÿ APIï¼Œä»è€Œé™ä½å¼€å‘éš¾åº¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚
    </p>
    <h3>
     <a id="_Rust__20">
     </a>
     <strong>
      å¿«é€Ÿä¸Šæ‰‹ï¼šç”¨ Rust æŸ¥è¯¢éŸ³è§†é¢‘ä¿¡æ¯
     </strong>
    </h3>
    <p>
     å‡è®¾æˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªåª’ä½“æ–‡ä»¶çš„æ—¶é•¿ã€æ ¼å¼ã€å…ƒæ•°æ®ä»¥åŠéŸ³è§†é¢‘æµä¿¡æ¯ï¼Œä½¿ç”¨
     <code>
      ez-ffmpeg
     </code>
     åªéœ€å‡ è¡Œä»£ç ï¼š
    </p>
    <h4>
     <a id="1__FFmpeg_24">
     </a>
     <strong>
      1. å®‰è£… FFmpeg
     </strong>
    </h4>
    <p>
     å¦‚æœä½ çš„ç¯å¢ƒå°šæœªå®‰è£… FFmpegï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼š
    </p>
    <h5>
     <a id="macOS_28">
     </a>
     macOSï¼š
    </h5>
    <pre><code class="prism language-bash">brew <span class="token function">install</span> ffmpeg
</code></pre>
    <h5>
     <a id="Windows_34">
     </a>
     Windowsï¼š
    </h5>
    <pre><code class="prism language-bash"><span class="token function">vcpkg</span> <span class="token function">install</span> ffmpeg
<span class="token comment"># å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£… vcpkgï¼Œè¿˜éœ€è®¾ç½®ç¯å¢ƒå˜é‡ VCPKG_ROOT</span>
</code></pre>
    <h4>
     <a id="2__Rust__41">
     </a>
     <strong>
      2. æ·»åŠ  Rust ä¾èµ–
     </strong>
    </h4>
    <p>
     åœ¨
     <code>
      Cargo.toml
     </code>
     ä¸­å¼•å…¥
     <code>
      ez-ffmpeg
     </code>
     ï¼š
    </p>
    <pre><code class="prism language-toml">[dependencies]
ez-ffmpeg = "*"
</code></pre>
    <h4>
     <a id="3__50">
     </a>
     <strong>
      3. è¿è¡Œä»£ç 
     </strong>
    </h4>
    <pre><code class="prism language-rust"><span class="token keyword">use</span> <span class="token namespace">ez_ffmpeg<span class="token punctuation">::</span>container_info<span class="token punctuation">::</span></span><span class="token punctuation">{<!-- --></span>get_duration_us<span class="token punctuation">,</span> get_format<span class="token punctuation">,</span> get_metadata<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">ez_ffmpeg<span class="token punctuation">::</span>stream_info<span class="token punctuation">::</span></span><span class="token punctuation">{<!-- --></span>find_all_stream_infos<span class="token punctuation">,</span> find_audio_stream_info<span class="token punctuation">,</span> find_video_stream_info<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> file_path <span class="token operator">=</span> <span class="token string">"test.mp4"</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–åª’ä½“æ–‡ä»¶çš„æ—¶é•¿ï¼ˆå¾®ç§’ï¼‰</span>
    <span class="token keyword">let</span> duration <span class="token operator">=</span> <span class="token function">get_duration_us</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ—¶é•¿: {} å¾®ç§’"</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–åª’ä½“æ–‡ä»¶çš„æ ¼å¼</span>
    <span class="token keyword">let</span> format <span class="token operator">=</span> <span class="token function">get_format</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ ¼å¼: {}"</span><span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–åª’ä½“æ–‡ä»¶çš„å…ƒæ•°æ®</span>
    <span class="token keyword">let</span> metadata <span class="token operator">=</span> <span class="token function">get_metadata</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å…ƒæ•°æ®:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">in</span> metadata <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}: {}"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–è§†é¢‘æµä¿¡æ¯</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>video_info<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">find_video_stream_info</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"è§†é¢‘æµä¿¡æ¯: {:?}"</span><span class="token punctuation">,</span> video_info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æœªæ‰¾åˆ°è§†é¢‘æµã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–éŸ³é¢‘æµä¿¡æ¯</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>audio_info<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">find_audio_stream_info</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éŸ³é¢‘æµä¿¡æ¯: {:?}"</span><span class="token punctuation">,</span> audio_info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æœªæ‰¾åˆ°éŸ³é¢‘æµã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è·å–æ‰€æœ‰æµä¿¡æ¯</span>
    <span class="token keyword">let</span> all_stream_infos <span class="token operator">=</span> <span class="token function">find_all_stream_infos</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ‰€æœ‰æµä¿¡æ¯:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> stream_info <span class="token keyword">in</span> all_stream_infos <span class="token punctuation">{<!-- --></span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> stream_info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼š
    </p>
    <ul>
     <li>
      <code>
       get_duration_us(file_path)
      </code>
      ï¼šè·å–åª’ä½“æ–‡ä»¶çš„æ—¶é•¿ï¼Œå•ä½ä¸ºå¾®ç§’ã€‚
     </li>
     <li>
      <code>
       get_format(file_path)
      </code>
      ï¼šè·å–åª’ä½“æ–‡ä»¶çš„æ ¼å¼åç§°ã€‚
     </li>
     <li>
      <code>
       get_metadata(file_path)
      </code>
      ï¼šè·å–åª’ä½“æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚
     </li>
     <li>
      <code>
       find_video_stream_info(file_path)
      </code>
      ï¼šè·å–åª’ä½“æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªè§†é¢‘æµçš„ä¿¡æ¯ã€‚
     </li>
     <li>
      <code>
       find_audio_stream_info(file_path)
      </code>
      ï¼šè·å–åª’ä½“æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªéŸ³é¢‘æµçš„ä¿¡æ¯ã€‚
     </li>
     <li>
      <code>
       find_all_stream_infos(file_path)
      </code>
      ï¼šè·å–åª’ä½“æ–‡ä»¶ä¸­æ‰€æœ‰æµçš„ä¿¡æ¯ã€‚
     </li>
    </ul>
    <p>
     æ‰§è¡Œæ­¤ä»£ç åï¼Œå°†è¾“å‡ºåª’ä½“æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ—¶é•¿ã€æ ¼å¼ã€å…ƒæ•°æ®ä»¥åŠå„ä¸ªæµçš„ä¿¡æ¯ã€‚
    </p>
    <h3>
     <a id="_110">
     </a>
     <strong>
      æ€»ç»“
     </strong>
    </h3>
    <p>
     é€šè¿‡
     <code>
      ez-ffmpeg
     </code>
     ï¼ŒRust å¼€å‘è€…å¯ä»¥åœ¨ä¸ç›´æ¥å¤„ç† FFmpeg å‘½ä»¤è¡Œå·¥å…·æˆ–åŸç”Ÿ API çš„æƒ…å†µä¸‹ï¼Œå®‰å…¨ã€é«˜æ•ˆåœ°è·å–åª’ä½“æ–‡ä»¶çš„ä¿¡æ¯ã€‚è¿™ä¸ä»…ç®€åŒ–äº†å¼€å‘æµç¨‹ï¼Œè¿˜é™ä½äº†å‡ºé”™çš„é£é™©ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚
    </p>
    <p>
     ğŸ”—
     <strong>
      å¼€æºé¡¹ç›®åœ°å€
     </strong>
     ï¼š
     <a href="https://github.com/YeautyYE/ez-ffmpeg">
      ez-ffmpeg
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f5965617574792f:61727469636c652f64657461696c732f313436323138353338" class_="artid" style="display:none">
 </p>
</div>


