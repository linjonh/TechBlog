---
layout: post
title: "ffmpegffplayffprobe-常用命令详解音视频必备"
date: 2022-10-02 23:47:54 +0800
description: "ffmpeg主要是多媒体的编解码工具，具体功能主要包括视频裁剪，去除水印，添加 logo，提取封面，"
keywords: "ffprobe"
categories: ['音视频', '测试开发']
tags: ['音视频录制命令', '音视频常用测试命令', '音视频', 'Ffmpeg', 'Ffmpeg']
artid: "127147756"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=127147756
    alt: "ffmpegffplayffprobe-常用命令详解音视频必备"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=127147756
featuredImagePreview: https://bing.ee123.net/img/rand?artid=127147756
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ffmpeg、ffplay、ffprobe 常用命令详解（音视频必备）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="./../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="./../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      前言：
      <br/>
      😄作者简介：小曾同学.com,小伙伴们也可以叫我小曾，一个致力于测试开发的博主⛽️
      <br/>
      如果文章知识点有错误的地方，还请大家指正，让我们一起学习，一起进步。😊
      <br/>
      座右铭：不想当开发的测试，不是一个好测试✌️。
      <br/>
      <code>
       如果感觉博主的文章还不错的话，还请点赞、收藏哦！
      </code>
      👍
     </p>
    </blockquote>
    <p>
     之前给小伙伴们分享了
     <a href="https://blog.csdn.net/weixin_42182599/article/details/125142176?spm=1001.2014.3001.5501">
      在Mac中安装FFMPEG
     </a>
     ，今天主要给大家整理了下在
     <code>
      音视频测试
     </code>
     中经常使用的
     <code>
      FFMPEG
     </code>
     相关命令。
     <br/>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <a href="#1_FFMPEG_8" rel="nofollow">
        1 FFMPEG概念
       </a>
      </li>
      <li>
       <a href="#2_ffmpeg__12" rel="nofollow">
        2 ffmpeg 介绍
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#21_ffmpeg_13" rel="nofollow">
          2.1 ffmpeg工作流程
         </a>
        </li>
        <li>
         <a href="#22_ffmpeg_34" rel="nofollow">
          2.2 ffmpeg常用命令
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#3_ffplay__156" rel="nofollow">
        3 ffplay 常用命令
       </a>
      </li>
      <li>
       <a href="#4_ffprobe_189" rel="nofollow">
        4 ffprobe常用命令
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="1_FFMPEG_8">
     </a>
     1 FFMPEG概念
    </h2>
    <p>
     <code>
      FFmpeg
     </code>
     是一款
     <code>
      音视频编解码
     </code>
     工具，也是一组音视频编解码开发套件，为开发者提供了丰富的音视频处理调用接口。
     <br/>
     <code>
      FFmpeg
     </code>
     源代码编译后会生成几个可执行程序，分别是
     <code>
      ffmpeg
     </code>
     、
     <code>
      ffplay
     </code>
     、
     <code>
      ffprobe
     </code>
     ，这三个也称为
     <code>
      FFmpeg 三剑客
     </code>
     ，各有各的作用，接下来就给大家一一介绍。
    </p>
    <h2>
     <a id="2_ffmpeg__12">
     </a>
     2 ffmpeg 介绍
    </h2>
    <h3>
     <a id="21_ffmpeg_13">
     </a>
     2.1 ffmpeg工作流程
    </h3>
    <p>
     <code>
      ffmpeg
     </code>
     主要是多媒体的编解码工具，具体功能主要包括视频裁剪，去除水印，添加 logo，提取封面，提取音频，提取视频等功能。
     <br/>
     ffmpeg的主要工作流程相对比较简单，介绍如下，
    </p>
    <pre><code>1）解封装（Demuxing）
2）解码（Decoding）
3）编码（Encoding）
4）封装（Muxing）
</code></pre>
    <p>
     其中需要经过六个步骤，具体如下，
    </p>
    <pre><code>1）读取输入源
2）进行音视频的解封装
3）解码每一帧音视频数据
4）编码每一帧音视频数据
5）进行音视频的重新封装
6）输出到目标
</code></pre>
    <p>
     ffmpeg 整体处理的工作流程与步骤如图所示，
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3b5f15d9a4dc8fed01de48ef37f5ccd4.png">
      <br/>
      从工作流程可以看出，ffmpeg 首先读取输入源，然后通过
      <code>
       Demuxer
      </code>
      将音视频包进行解封装，再通过
      <code>
       Decoder
      </code>
      进行解码，将音视频通过
      <code>
       Decoder解码
      </code>
      成为
      <code>
       YUV
      </code>
      或者
      <code>
       PCM
      </code>
      数据，然后通过
      <code>
       Encoder
      </code>
      将对应的数据进行编码，将编码后的音视频数据包通过
      <code>
       Muxer
      </code>
      进行封装，最终输出为输出流。
     </img>
    </p>
    <h3>
     <a id="22_ffmpeg_34">
     </a>
     2.2 ffmpeg常用命令
    </h3>
    <ul>
     <li>
      <p>
       基本信息查询命令
      </p>
      <table>
       <thead>
        <tr>
         <th>
          字段
         </th>
         <th>
          描述信息
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td>
          -version
         </td>
         <td>
          表示显示版本信息
         </td>
        </tr>
        <tr>
         <td>
          -formats
         </td>
         <td>
          表示可用格式
         </td>
        </tr>
        <tr>
         <td>
          -muxers
         </td>
         <td>
          显示可用复用器
         </td>
        </tr>
        <tr>
         <td>
          -demuxers
         </td>
         <td>
          显示可用解复用器
         </td>
        </tr>
        <tr>
         <td>
          -codecs
         </td>
         <td>
          显示可用编解码器
         </td>
        </tr>
        <tr>
         <td>
          -decoders
         </td>
         <td>
          显示可用解码器
         </td>
        </tr>
        <tr>
         <td>
          -encoders
         </td>
         <td>
          显示可用编码器
         </td>
        </tr>
        <tr>
         <td>
          -protocols
         </td>
         <td>
          显示可用的协议
         </td>
        </tr>
        <tr>
         <td>
          -pix_fmts
         </td>
         <td>
          显示可用的像素格式
         </td>
        </tr>
       </tbody>
      </table>
     </li>
     <li>
      <p>
       录制命令
      </p>
      <ul>
       <li>
        录制视频
       </li>
      </ul>
      <pre><code class="prism language-bash">
ffmpeg -f avfoundation -i <span class="token number">1</span> -r <span class="token number">30</span> out.yuv

<span class="token comment"># -f:指定使用Mac下的avfoundation来采集数据。</span>
<span class="token comment"># -i：指定从哪采集的数据，</span>
<span class="token comment"># 1代表的是文件索引值（0:摄像头）</span>
<span class="token comment"># -r：表示帧率</span>
<span class="token comment"># 采集的数据 是原始数据，没有经过压缩</span>

<span class="token comment"># 或者输入命令</span>
ffmpeg -f avfoundation -pixel_format uyvy422 -i <span class="token string">"1"</span> -f flv  pingmu.flv
</code></pre>
      <ul>
       <li>
        录制音频
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -f avfoundation -i :0 out.wav
<span class="token comment"># :0代表音频设备</span>

<span class="token comment"># 或者</span>
ffmpeg -f avfoundation -i <span class="token string">":0"</span> -vcodec libx264 -preset ultrafast -acodec libmp3lame -ar <span class="token number">44100</span> -ac <span class="token number">1</span> -f flv maikefeng.flv
</code></pre>
      <ul>
       <li>
        录制音视频
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -f avfoundation -framerate <span class="token number">30</span> -video_size 1280x720 -i <span class="token string">"0:0"</span> -vcodec libx264 -preset ultrafast -acodec libmp3lame -ar <span class="token number">44100</span> -ac <span class="token number">1</span> -f flv <span class="token string">"rtmp:xxxx推流地址"</span>
</code></pre>
     </li>
     <li>
      <p>
       分解/复用命令
      </p>
      <ul>
       <li>
        文件格式的转换
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -i out.mp4 -vcodec copy -acodec copy out.flv
<span class="token comment"># copy：针对音视频编解码方式不做改变</span>
<span class="token comment"># -i:输入文件</span>
<span class="token comment"># -vcodec：视频编解码方式</span>
<span class="token comment"># -acodec：音频编解码方式</span>
</code></pre>
      <ul>
       <li>
        提取视频
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -i out.mp4 -an -vcodec copy out.h264
</code></pre>
      <ul>
       <li>
        提取音频
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -i out.mp4 -vn -acodec copy out.aac 
</code></pre>
     </li>
     <li>
      <p>
       处理原始数据命令
      </p>
      <p>
       原始数据：就是ffmpeg解码后的数据，pcm、yuv格式的数据
      </p>
      <p>
       例如 提取PCM数据：
      </p>
      <pre><code class="prism language-bash">ffmpeg -i out.mp4 -vn -ar <span class="token number">44100</span> -ac2 -f s16le out1212.pcm
<span class="token comment">#  -ar 表示音频采样率</span>
<span class="token comment"># -ac2表示双声道</span>
<span class="token comment"># -f s16le：音频数据存储格式，s代表有符号的</span>
</code></pre>
     </li>
     <li>
      <p>
       裁剪与合并命令
      </p>
      <ul>
       <li>
        视频裁剪
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -i out.mp4 -ss 00:00:00 -t <span class="token number">10</span> out.ts
ffmpeg -i out.mp4 -ss 00:00:00 -t <span class="token number">10</span> out1.mp4

<span class="token comment"># 十分秒</span>
<span class="token comment"># -t裁剪后视频的时长为10s</span>
</code></pre>
      <ul>
       <li>
        视频合并
       </li>
      </ul>
      <pre><code class="prism language-bash">ffmpeg -f concat -i in.txt outin999.mp4
</code></pre>
     </li>
     <li>
      <p>
       图片/视频互转命令
      </p>
      <pre><code class="prism language-bash">ffmpeg -i outin999.mp4 -f image2 image-%3d.jpeg
每秒转一张图片
-f image2将图片转为什么格式

<span class="token comment"># 图片转视频</span>
ffmpeg -i image-%3d.jpeg out1212121.mp4
</code></pre>
     </li>
     <li>
      <p>
       直播相关命令
      </p>
      <pre><code class="prism language-bash">ffmpeg -re -i out.mp4 -c copy -f fly  推流地址
<span class="token comment"># -re：减慢帧率速度</span>
<span class="token comment"># 推出去的文件格式：-f fly</span>
</code></pre>
     </li>
    </ul>
    <h2>
     <a id="3_ffplay__156">
     </a>
     3 ffplay 常用命令
    </h2>
    <p>
     ffplay提供了音视频显示和播放相关的图像信息，音频的波形信息等。简而言之就是一个播放器。
    </p>
    <ul>
     <li>
      <p>
       播放一个音视频资源
      </p>
      <pre><code class="prism language-bash">ffplay -i input.mp4
或者 
ffplay input.mp4
</code></pre>
     </li>
     <li>
      <p>
       指定视频起始位置及播放时长播放
      </p>
      <pre><code class="prism language-bash">ffplay -ss <span class="token number">10</span> -t <span class="token number">20</span> input.mp4
<span class="token comment">## 从视频的第10秒开始播放，播放20秒</span>
</code></pre>
     </li>
     <li>
      <p>
       自定义播放器的显示窗口标题
      </p>
      <pre><code class="prism language-bash">ffplay -window_title <span class="token string">"hello world"</span> input.mp4
</code></pre>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ce07b55ccb1d84519b06dd63ce3667a4.png"/>
      </p>
     </li>
     <li>
      <p>
       播放音频文件以波形的形式显示
      </p>
      <pre><code class="prism language-bash">ffplay -showmode <span class="token number">1</span> input.mp3
</code></pre>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/38260185c2d626a255edec8a71af61af.png"/>
      </p>
     </li>
    </ul>
    <h2>
     <a id="4_ffprobe_189">
     </a>
     4 ffprobe常用命令
    </h2>
    <p>
     ffprobe是多媒体分析工具，比如音视频的参数、媒体容器的参数信息等。也可以分析媒体文件中每个包的长度、包的类型、帧的信息等。
    </p>
    <ul>
     <li>
      <p>
       查看多媒体数据包信息
      </p>
      <pre><code class="prism language-bash">ffprobe -show_packages input.mp4
<span class="token comment">## 可以将打印的日志保存在文本中，这样方便查找</span>
ffprobe -show_packets input.mp4 <span class="token operator">&gt;</span>log.log
</code></pre>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f4695fe73de3d5af4a821386220ef669.png">
        <br/>
        <strong>
         show_packets 查看的多媒体数据包信息使用PACKET标签括起来，其中包含的主要信息如下：
        </strong>
       </img>
      </p>
      <table>
       <thead>
        <tr>
         <th>
          字段
         </th>
         <th>
          描述
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td>
          codec_type
         </td>
         <td>
          多媒体类型，表示该段是音频包还是视频包等
         </td>
        </tr>
        <tr>
         <td>
          stream_index
         </td>
         <td>
          表示多媒体的stream 索引
         </td>
        </tr>
        <tr>
         <td>
          pts
         </td>
         <td>
          表示多媒体的显示时间值
         </td>
        </tr>
        <tr>
         <td>
          pts_time
         </td>
         <td>
          根据不同格式计算过后的多媒体的显示时间
         </td>
        </tr>
        <tr>
         <td>
          dts
         </td>
         <td>
          多媒体解码时间值
         </td>
        </tr>
        <tr>
         <td>
          dts_time
         </td>
         <td>
          根据不同格式计算过后的多媒体解码时间
         </td>
        </tr>
        <tr>
         <td>
          duration
         </td>
         <td>
          多媒体包占用的时间值
         </td>
        </tr>
        <tr>
         <td>
          duration_time
         </td>
         <td>
          根据不同格式计算过后的多媒体包所占用的时间值
         </td>
        </tr>
        <tr>
         <td>
          size
         </td>
         <td>
          多媒体包的大小
         </td>
        </tr>
        <tr>
         <td>
          pos
         </td>
         <td>
          多媒体所在的文件偏移位置
         </td>
        </tr>
        <tr>
         <td>
          flags
         </td>
         <td>
          多媒体包标记，如关键包与非关键包的标记
         </td>
        </tr>
       </tbody>
      </table>
     </li>
     <li>
      <p>
       查看媒体包中具体的数据
      </p>
      <pre><code class="prism language-bash">ffprobe -show_data -show_packets input.mp4
</code></pre>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cdd1b90e4567e494e838ec01aaa04aab.png"/>
      </p>
     </li>
     <li>
      <p>
       查看多媒体的封装格式
      </p>
      <pre><code class="prism language-bash">ffprobe -show_format input.mp4
</code></pre>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/31c4aca6acd7a1343bdd6eba9aafab42.png"/>
      </p>
      <table>
       <thead>
        <tr>
         <th>
          字段
         </th>
         <th>
          描述信息
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td>
          filename
         </td>
         <td>
          表示文件名
         </td>
        </tr>
        <tr>
         <td>
          nb_streams
         </td>
         <td>
          表示媒体中包含的流的个数
         </td>
        </tr>
        <tr>
         <td>
          nb_programs
         </td>
         <td>
          表示节目数
         </td>
        </tr>
        <tr>
         <td>
          format_name
         </td>
         <td>
          表示使用的封装模块的名称
         </td>
        </tr>
        <tr>
         <td>
          format_long_name
         </td>
         <td>
          表示封装的完整名称
         </td>
        </tr>
        <tr>
         <td>
          start_time
         </td>
         <td>
          表示媒体的起始时间
         </td>
        </tr>
        <tr>
         <td>
          duration
         </td>
         <td>
          表示媒体文件的总时间长度
         </td>
        </tr>
        <tr>
         <td>
          size
         </td>
         <td>
          表示媒体文件的大小
         </td>
        </tr>
        <tr>
         <td>
          bit_rate
         </td>
         <td>
          表示媒体文件的码率(bit/s)
         </td>
        </tr>
        <tr>
         <td>
          probe_score
         </td>
         <td>
          表示输入媒体文件的格式与其实际数据格式的匹配度，匹配度高则得分高，例如 input.mp4 确实是 mp4 格式），匹配度低则得分低（比如：input.mp4 其实是 wav 的格式
         </td>
        </tr>
       </tbody>
      </table>
     </li>
     <li>
      <p>
       查看视频文件中的帧信息（最常用命令）
      </p>
      <pre><code class="prism language-bash">ffprobe -show_frames input.mp4
</code></pre>
      <p>
       例如：输入如下命令
      </p>
      <pre><code class="prism language-bash">ffprobe -show_frames https://sdk-release.qnsdk.com/1080_60_5390.mp4 <span class="token operator">&gt;</span> input.log
<span class="token comment">## 显示结果如下图</span>
</code></pre>
      <p>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/d11dc4e0693974153c450bfa92b44e32.png"/>
      </p>
      <table>
       <thead>
        <tr>
         <th>
          字段
         </th>
         <th>
          描述信息
         </th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td>
          media_type
         </td>
         <td>
          表示帧的类型（视频、音频、字幕等）
         </td>
        </tr>
        <tr>
         <td>
          stream_index
         </td>
         <td>
          表示帧所在的索引区域
         </td>
        </tr>
        <tr>
         <td>
          key_frame
         </td>
         <td>
          表示是否为关键帧
         </td>
        </tr>
        <tr>
         <td>
          pkt_pts
         </td>
         <td>
          表示Frame包的pts
         </td>
        </tr>
        <tr>
         <td>
          pkt_pts_time
         </td>
         <td>
          表示Frame包的pts的时间显示
         </td>
        </tr>
        <tr>
         <td>
          pkt_dts
         </td>
         <td>
          表示Frame包的dts
         </td>
        </tr>
        <tr>
         <td>
          pkt_dts_time
         </td>
         <td>
          表示Frame包的dts的时间显示
         </td>
        </tr>
        <tr>
         <td>
          pkt_duration
         </td>
         <td>
          Frame包的时长
         </td>
        </tr>
        <tr>
         <td>
          pkt_duration_time
         </td>
         <td>
          表示Frame包的时长时间显示
         </td>
        </tr>
        <tr>
         <td>
          pkt_pos
         </td>
         <td>
          表示Frame包的所在文件的偏移位置
         </td>
        </tr>
        <tr>
         <td>
          pkt_size
         </td>
         <td>
          表示Frame包的大小
         </td>
        </tr>
        <tr>
         <td>
          width
         </td>
         <td>
          帧显示的宽度
         </td>
        </tr>
        <tr>
         <td>
          height
         </td>
         <td>
          帧的显示高度
         </td>
        </tr>
        <tr>
         <td>
          pix_fmt
         </td>
         <td>
          帧的图像色彩格式
         </td>
        </tr>
        <tr>
         <td>
          pict_type
         </td>
         <td>
          帧类型
         </td>
        </tr>
        <tr>
         <td>
          SIDE_DATA
         </td>
         <td>
          表示视频中包含SEI信息
         </td>
        </tr>
       </tbody>
      </table>
      <p>
       在音视频测试中，经常会用到该命令
       <code>
        ffprobe -show_frames input.mp4 &gt; demo.log
       </code>
       ，将日志保存至本地文件，这样方面查看数据帧信息。当查看视频中有多少个关键帧时，可以在文件中搜索
       <code>
        pict_type=I
       </code>
       ，pict_type 字段可以看到视频的帧是
       <code>
        I帧
       </code>
       、
       <code>
        P帧
       </code>
       或者
       <code>
        B帧
       </code>
       ，也可以通过 pict_type=I，计算出关键帧时间；每一帧的大小也可以通过 ffprobe 的 pkt_size 查看到。
      </p>
     </li>
    </ul>
    <p>
     后续还会为小伙伴们补充相关知识，如果感觉博主的文章还不错的话，还请点赞、收藏哦！
    </p>
   </div>
   <link href="./../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="./../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34323138323539392f:61727469636c652f64657461696c732f313237313437373536" class_="artid" style="display:none">
 </p>
</div>


