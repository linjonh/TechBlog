---
layout: post
title: 前端-前端文件操作与文件上传-前端接受后端传输文件指南
date: 2024-05-05 17:04:41 +0800
categories: ['前端']
tags: ['前端', 'Javascript']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=138466699
    alt: 前端-前端文件操作与文件上传-前端接受后端传输文件指南
artid: 138466699
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=138466699
featuredImagePreview: https://bing.ee123.net/img/rand?artid=138466699
---
<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【前端】-【前端文件操作与文件上传】-【前端接受后端传输文件指南】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      目录
     </h4>
     <ul>
      <li>
       <a href="#_1" rel="nofollow">
        前端文件操作与文件上传
       </a>
      </li>
      <li>
       <a href="#_197" rel="nofollow">
        前端接受后端传输文件指南
       </a>
      </li>
      <li>
       <a href="#excelword_223" rel="nofollow">
        前端excel、word操作指南
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#excel_224" rel="nofollow">
          excel
         </a>
        </li>
        <li>
         <a href="#word_359" rel="nofollow">
          word
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     前端文件操作与文件上传
    </h2>
    <p>
     一、前端文件上传有两种思路：
    </p>
    <ol>
     <li>
      二进制blob传输：典型案例是formData传输，相当于用formData搭载二进制的blob传给后端
     </li>
     <li>
      base64传输：转为base64传输，后端再将base64转回来。简便、耗时
     </li>
    </ol>
    <p>
     二、与文件相关的对象
    </p>
    <ol>
     <li>
      files：通过input标签读过来的文件对象，是blob的子类。
     </li>
     <li>
      blob：不可变的二进制内容，包含很多操作方法，切片上传、断点续传都是基于blob的
     </li>
     <li>
      formData：用于后端传输的对象。files是一个前端的对象，不能直接传给后端，所以我们需要一个前后端都认可的载体来传递文件，这个载体就是formData。formData就像一辆汽车用来搭载files，这样才能让文件以二进制的形式传到后端
     </li>
     <li>
      fileReader：多用于把文件读取为某种形式（如base64、text文件）直接传给后端
     </li>
    </ol>
    <p>
     三、file参数、blob切割文件、FileReader将文件转成base64，浓缩图/文本预览：
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileChange<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 缩略图，文本预览 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>200px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgbase64<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> fstat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"fs"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> _fileObj<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">imgbase64</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token keyword">let</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">// files是个数组</span>
       _fileObj <span class="token operator">=</span> file<span class="token punctuation">;</span>
       <span class="token comment">// file常用属性：size（大小）、type（类型）、name（文件名）</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文件不能大于十兆"</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'video/mp4'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"必须是mp4"</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 使用blob的slice方法可以切割文件</span>
      <span class="token keyword">let</span> _sliceBlob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>file<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 切割二进制的0-5000位</span>
      <span class="token comment">// 将切割后的Blob对象转成File对象（第二个参数是文件名），之后就可以上传切割后的File对象</span>
      <span class="token keyword">let</span> _sliceFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_sliceBlob<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"test.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">//将File对象或者Blob对象转成base64或text</span>
      <span class="token keyword">let</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fr<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>_sliceFile<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// readAsDataURL是转成base64的方法</span>
      <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      fr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// base64是异步的转换，通过onload方法获得转换结果</span>
        self<span class="token punctuation">.</span>imgbase64 <span class="token operator">=</span> fr<span class="token punctuation">.</span>result<span class="token comment">// 直接将转换结果赋值给img的src，设置src的大小即可获得浓缩图</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fr<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token comment">// 打印结果见下图一</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 这部分的代码后面讲</span>
    	<span class="token keyword">let</span> _formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"asdasd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">,</span> _fileObj<span class="token punctuation">)</span>
        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/xx"</span><span class="token punctuation">,</span> _formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <img alt="图一：上传结果打印" src="https://i-blog.csdnimg.cn/blog_migrate/3423b04a6f25b31a51b8e88004d70fa8.jpeg">
      <br/>
      四、formData：不仅可以搭载文件，还可以搭载文字、input的其他输入
     </img>
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>默认情况下提交为query参数<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xxx<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>enctype指定提交为formData<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     五、文件上传：将blob转成FormData上传
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> _formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"asdasd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">,</span> _fileObj<span class="token punctuation">)</span>
    axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/xx"</span><span class="token punctuation">,</span> _formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过查看网络可以发现：
    </p>
    <ol>
     <li>
      上传内容：
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/dfe6437b0df4aa63b401beabed7100de.jpeg"/>
     </li>
     <li>
      请求头content-Type指定了传输内容为form-data，且boundary指定了分割符
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e70f147e73d7db6b8df3aefa51908937.jpeg"/>
     </li>
     <li>
      分隔了两个内容（下面还有一个分割线，即以分割线结尾）
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7e1be2bec4402f3a91e8fac8bd3d83f8.jpeg">
       <br/>
       六、转换关系
       <br/>
       <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cbcce9ab048d2f7c2dc558e5268bd74e.jpeg"/>
      </img>
     </li>
     <li>
      我们直接拿到的是file对象，file对象可以转换成Blob对象，Blob对象也可以转成file对象
     </li>
     <li>
      file、blob都可以根据FileReader读成base64或text文本
     </li>
     <li>
      通过接口传输给后端时，只能传输base64、text文本、formData，所以，如果不把file、blob通过FileReader读成base64或text文本，那么就需要把file或者blob append到formData才能通过接口传输
     </li>
    </ol>
    <p>
     七、具体功能
    </p>
    <ol>
     <li>
      单文件上传（详见前述代码）
     </li>
     <li>
      多文件上传：
     </li>
    </ol>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileChange<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in imgList<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ item.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> fstat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"fs"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> _fileObj<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">imgList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//多文件上传</span>
      <span class="token comment">// multiple的多文件上传其实很不友好，需要用户在选择文件时按住ctrl多选，否则就会变成单选</span>
      <span class="token comment">// 所以使用imgList数组将用户每次选择的内容都push进去</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>imgList<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>imgList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//切片上传</span>
      _fileObj <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 遍历，一个一个上传</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>imgList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> _formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"file"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/xx"</span><span class="token punctuation">,</span> _formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="2">
     <li>
      切片上传
     </li>
    </ol>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileChange<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ precent }}%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> fstat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"fs"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> _fileObj<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">precent</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">fileChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//切片上传，在上传的时候进行切片，文件改变时只赋值</span>
      _fileObj <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span><span class="token comment">// 每次切片的大小，片为2m</span>
      <span class="token keyword">let</span> fileSize <span class="token operator">=</span> _fileObj<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
      <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 当前已经传了多少</span>
      <span class="token comment">// 断点续传，永久记录中断的地方，下次上传时直接从断点开始传</span>
      <span class="token comment">//localStorage.setItem(_fileObj.name, current);</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> fileSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> _formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>_fileObj<span class="token punctuation">.</span>name<span class="token punctuation">,</span> _fileObj<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> current <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"http://localhost:4000/upload"</span><span class="token punctuation">,</span>_formData<span class="token punctuation">)</span>
        <span class="token comment">// 进度条可以用axios的onUploadProgress方法，且发送切片时可以并行发送请求，后续可以自行优化</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>precent <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span>current <span class="token operator">/</span> fileSize<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
        current <span class="token operator">+=</span> size<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <blockquote>
     <p>
      File System Access API 允许直接读取、写入或保存对用户设备上的文件和文件夹的更改。从 Chrome 86 开始支持 File System Access API，目前只有基于 Chromium 系列的浏览器全面支持，Safari 部分支持（支持读取，不支持写入和保存），而 Firefox 未支持。
     </p>
    </blockquote>
    <h2>
     <a id="_197">
     </a>
     前端接受后端传输文件指南
    </h2>
    <p>
     一、前端把后端传过来的文件下载下来（后端返回给我们的文件一般是二进制的），有以下几种方式：
    </p>
    <ol>
     <li>
      直接打开下载地址：无法命名，只适用于get直接返回blob接口；没有通过项目去发，直接打开了一个窗口，相当于是浏览器请求的，就不会有token，无法做验证
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6e56188a34e5dd9341108d6d766307e4.jpeg">
       <br/>
       直接在浏览器输入：
       <code>
        localhost:8000/download
       </code>
       就可以下载了，或者在代码中使用
       <code>
        window.open(地址)
       </code>
       下载
       <br/>
       <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ef38fda9781842a8454b02162fffd06d.jpeg"/>
      </img>
     </li>
     <li>
      利用a标签的download：比较合适的方案
     </li>
    </ol>
    <blockquote>
     <p>
      几个重要的概念：
     </p>
     <ol>
      <li>
       <code>
        createObjectURL
       </code>
       ：把blob对象的内存地址以URL形式给出。接口返回的是二进制传输的文件，那前端就可以拿到这个文件的blob对象，前端把这个blob对象传给
       <code>
        createObjectURL
       </code>
       ，得到一个URL，然后就可以使用a标签加载这个URL，从而实现下载
      </li>
      <li>
       <code>
        msSaveBlob
       </code>
       ：ie不支持a标签下载，用的是
       <code>
        msSaveBlob
       </code>
       方案。如果是ie浏览器，直接调用
       <code>
        msSaveBlob
       </code>
       方法，把blob对象给进去，就直接下载下来了
      </li>
      <li>
       a标签的
       <code>
        download
       </code>
       属性：表面该a标签的行为时下载，并设置文件名
      </li>
     </ol>
    </blockquote>
    <p>
     文件下载流程：
     <br/>
     （1）
     <br/>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9f75e4254c824248c07d344df0a019ca.jpeg">
      <br/>
      （1）使用blob接收后端传过来的二进制文件
      <br/>
      （2）判断浏览器有没有msSaveBlob方法，如果有，说用户使用ie浏览器，直接使用msSaveBlob下载
      <br/>
      （3）如果msSaveBlob……（见上图）
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/33c4102be93de817961bf7add5a12940.jpeg">
       <br/>
       注意：msSaveBlob中type的值在打印的res.data中
      </img>
     </img>
    </p>
    <ol start="3">
     <li>
      file- saver：现成的库，简单方便
      <br/>
      （1）安装：
      <code>
       npm i file-saver
      </code>
      <br/>
      （2）在代码中引入：
      <code>
       import {saveAs} from 'file-saver'
      </code>
      <br/>
      <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f222c32d31bca04a2d3b43c5576ecf9e.jpeg"/>
      <br/>
      二、前端把后端传过来的blob文件流展示出来（即预览功能）思路：URL除了线上地址外，还有个base64的URL。将后端返回的blob转为base64（使用fileReader），将base64给预览工具
     </li>
    </ol>
    <h2>
     <a id="excelword_223">
     </a>
     前端excel、word操作指南
    </h2>
    <h3>
     <a id="excel_224">
     </a>
     excel
    </h3>
    <p>
     对excel操作所用库
     <br/>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/476948d07125a8bc0879a04b10fa644c.jpeg"/>
     <br/>
     xlsx产物转化示意图
     <br/>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c7a7978b3d8ddac4f6a1a08d70a7bd85.jpeg"/>
     <br/>
     调用blob文件流的方法将blob文件流转换为arrayBuffer，将arrayBuffer给xlsx的read方法，read方法将arrayBuffer读取为一个book对象（可以理解为，将整个excel文件转换为js对象，这个js对象就是book对象），然后从book对象里面提取出对应的sheet对象，接下来就可以将这个sheet对象转换为你想要的前端产物（html或json）了，反过来，也可以把前端的html，一般是一个table（一个dom）给过去，转换成一个sheet对象，也可以将前端的json对象转换为sheet对象，然后输出一个excel文件。可以创建一个新的workbook对象，把sheet对象加入到这个新的workbook对象中，然后输出为excel文件
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果是react，则使用该组件
    <span class="token operator">&lt;</span>fileviews fileType<span class="token operator">=</span><span class="token string">"指定预览的文件类型"</span> fielPath<span class="token operator">=</span><span class="token string">"路径"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>fileviews<span class="token operator">&gt;</span>
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>直接给vueofficeExcel组件的src指定地址即可实现预览，可以给<span class="token number">1</span>，线上的路径地址  <span class="token number">2</span>，dataURL<span class="token operator">-</span><span class="token operator">&gt;</span>base64（将二进制流转换成base64） <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>vueofficeExcel v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"excelSrc"</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"excelSrc"</span> style<span class="token operator">=</span><span class="token string">"height:500px"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>vueofficeExcel<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"createExcel"</span><span class="token operator">&gt;</span>创建<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> @change<span class="token operator">=</span><span class="token string">"change"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"loadExcel"</span><span class="token operator">&gt;</span>加载<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"excel-content"</span> v<span class="token operator">-</span>html<span class="token operator">=</span><span class="token string">"excelHTML"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>table ref<span class="token operator">=</span><span class="token string">"excelTable"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>thead<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>科目<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>人数<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>平均分<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>thead<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td rowspan<span class="token operator">=</span><span class="token string">"3"</span><span class="token operator">&gt;</span>数学<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token number">90</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token number">86</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token number">85</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token number">82</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token number">78</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td<span class="token operator">&gt;</span><span class="token number">32</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token comment">//1,本地选择-》读取为前端html和数据对象</span>
<span class="token comment">//2，请求-》读取为前端html和数据对象</span>

<span class="token comment">//1,把前端的一个table dom转化为excel</span>
<span class="token comment">//2,把一个前端对象转化为excel</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vueofficeExcel <span class="token keyword">from</span> <span class="token string">"@vue-office/excel"</span><span class="token punctuation">;</span><span class="token comment">// 由于使用xlsx库进行预览时，预览的excel很原生，很丑，需要我们自己写样式，所以可以使用@vue-office/excel组件，他的预览功能和原生excel一样，假如我们在excel中设置了样式，vueofficeExcel也会展示出来</span>
<span class="token comment">// 与此相似的还有"@vue-office/docx"、"@vue-office/pdf"，他们定义了不同的预览方式</span>
<span class="token comment">// 如果使用的是react框架，则使用react-file-viewer，该组件支持很多种类型的预览，不管是word、excel还是ppt都使用这一个组件进行预览</span>
<span class="token comment">// 他也是一个组件，引入注册后直接使用</span>
<span class="token keyword">import</span> <span class="token string">"@vue-office/excel/lib/index.css"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> read<span class="token punctuation">,</span> writeFile<span class="token punctuation">,</span> utils <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"xlsx"</span><span class="token comment">// xlsx是函数式编程</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 注册</span>
    vueofficeExcel
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">excelHTML</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token literal-property property">excelSrc</span><span class="token operator">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">loadExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8000/download"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">"blob"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> wb <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> sheet1 <span class="token operator">=</span> wb<span class="token punctuation">.</span>Sheets<span class="token punctuation">.</span>Sheet1
          <span class="token keyword">const</span> _data <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">sheet_to_json</span><span class="token punctuation">(</span>sheet1<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> _html <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">sheet_to_html</span><span class="token punctuation">(</span>sheet1<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>excelHTML <span class="token operator">=</span> _html
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">createExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"张四"</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"张五"</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
      <span class="token comment">//转化data数组</span>
      <span class="token keyword">const</span> ws <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">json_to_sheet</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将前端的数据转换为sheet</span>
      <span class="token keyword">const</span> wb <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">book_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建空的excel文件，即book对象</span>
      utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>wb<span class="token punctuation">,</span> ws<span class="token punctuation">,</span> <span class="token string">"people"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将sheet表加入excel（book对象），并给这个sheet表命名为people</span>
      <span class="token function">writeFile</span><span class="token punctuation">(</span>wb<span class="token punctuation">,</span> <span class="token string">"test1.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 浏览器下载excel，并将其命名为test1.xlsx</span>
      <span class="token comment">//转化table dom</span>
      <span class="token keyword">const</span> tableDom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>excelTable<span class="token punctuation">;</span><span class="token comment">// 获取table的dom元素</span>
      <span class="token keyword">const</span> tableWs <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">table_to_sheet</span><span class="token punctuation">(</span>tableDom<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将dom元素转换为sheet，也可以用table_to_book()直接将其转换为book，然后使用writeFile</span>
      <span class="token keyword">const</span> wb2 <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">book_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建book对象，即excel</span>
      utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>wb2<span class="token punctuation">,</span> tableWs<span class="token punctuation">,</span> <span class="token string">"sheet1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将sheet表加入excel（book对象），并给这个sheet表命名为sheet1</span>
      <span class="token function">writeFile</span><span class="token punctuation">(</span>wb2<span class="token punctuation">,</span> <span class="token string">"tableTest.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 浏览器下载excel，并将其命名为tableTest.xlsx</span>
      <span class="token comment">//const wb2=utils.table_to_book(tableDom);</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> _file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">// e.target.files[0]拿到的就是blob文件流</span>
      <span class="token keyword">const</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// FileReader用于将文件流读取为你想要的格式</span>
      fr<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>_file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将文件流读取为base64</span>
      fr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 转换完成后获取转换结果</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>excelSrc <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/*_file.arrayBuffer().then((res) =&gt; {// arrayBuffer()对象本身会返回一个promise
		// 将blob文件流转换成arrayBuffer，res转换出来的内容
        const wb = read(res);// 读取arrayBuffer，生成一个book对象
        const sheet1 = wb.Sheets.Sheet1// 从Sheets中取出Sheet1这张表
        const _data = utils.sheet_to_json(sheet1);// 将Sheet1表转换为json
        const _html = utils.sheet_to_html(sheet1);// 将Sheet1表转换为html
        this.excelHTML = _html// 需要自己给表格写样式
      })*/</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>excel<span class="token operator">-</span>content table <span class="token punctuation">{<!-- --></span>
  border<span class="token operator">-</span>collapse<span class="token operator">:</span> collapse
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>excel<span class="token operator">-</span>content td <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid black<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6448d4be25def40b1884b10c2d495ef0.png"/>
     <br/>
     在做文件预览功能时，都需要提供src路径，这个src要么是线上地址，要么是dataURL，所以一般我们都会转换一下路径，如果文件是本地选取的，直接将文件线上地址给src，如果文件是接口返回的，那就是个二进制流，使用FileReader将地址转换为dataURL，再给src
    </p>
    <h3>
     <a id="word_359">
     </a>
     word
    </h3>
    <p>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0429685166201ebd4eb46d06f3257869.png"/>
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"home"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token operator">&lt;</span>vueofficedocx v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"wordPath"</span> <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"wordPath"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>vueofficedocx<span class="token operator">&gt;</span><span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> @change<span class="token operator">=</span><span class="token string">"change"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">"docxPreview"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> vueofficedocx <span class="token keyword">from</span> <span class="token string">"@vue-office/docx"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> renderAsync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"docx-preview"</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">"axios"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PizZip <span class="token keyword">from</span> <span class="token string">'pizzip'</span>
<span class="token keyword">import</span> Docxtemplater <span class="token keyword">from</span> <span class="token string">'docxtemplater'</span><span class="token comment">// 将word里面的内容作为模版，将html中的数据渲染进去。他接收的的内容是经过压缩的内容，所以还需引入pizzip</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> saveAs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'file-saver'</span><span class="token comment">// 用于保存文件，你给他一个文件流，他可以把这个文件流作为一个文件导出出来，不仅仅用于word</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">wordPath</span><span class="token operator">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    vueofficedocx
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">/*let _file = e.target.files[0]
      const fr = new FileReader();
      fr.readAsDataURL(_file);
      fr.onload = (e) =&gt; {
        this.wordPath = e.target.result;
      }*/</span>
      <span class="token comment">//let _file = e.target.files[0];</span>
      <span class="token comment">//blob,arrayBuffer</span>
      <span class="token comment">//renderAsync(_file, this.$refs.docxPreview);// renderAsync接收blob/arrayBuffer，并将其渲染到指定dom中进行预览</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">student</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"张四"</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"张五"</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">99</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> _file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      _file<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> zip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PizZip</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// PizZip只能压缩arrayBuffer，所以需要将blob转成arrayBuffer</span>
        <span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Docxtemplater</span><span class="token punctuation">(</span>zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        doc<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token comment">//设置数据</span>
        doc<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 渲染</span>
        <span class="token keyword">const</span> out <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"blob"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">mimeType</span><span class="token operator">:</span>
            <span class="token string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span><span class="token comment">// 指定word文档的类型</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 渲染完成的二进制流</span>
        <span class="token function">saveAs</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> <span class="token string">"test1.docx"</span><span class="token punctuation">)</span><span class="token comment">// 保存二进制流并将其命名为test1.docx</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>excel<span class="token operator">-</span>content table <span class="token punctuation">{<!-- --></span>
  border<span class="token operator">-</span>collapse<span class="token operator">:</span> collapse
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>excel<span class="token operator">-</span>content td <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid black<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre>
    <p>
     word模版中的内容：
     <br/>
     <img alt="请添加图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a66acf8c8c740448c0327db69a480d20.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
</div>


