---
layout: post
title: "微信小程序的优化方案之主包与分包的研究"
date: 2024-12-30 18:36:31 +0800
description: "某些情况下，开发者需要将小程序划分成不同的子包，在构建时打包成不同的分包，用户在使用时按需进行加载。"
keywords: "微信小程序主包分包什么意思"
categories: ['移动端']
tags: ['微信小程序', '小程序', 'Javascript']
artid: "128981883"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=128981883
    alt: "微信小程序的优化方案之主包与分包的研究"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=128981883
featuredImagePreview: https://bing.ee123.net/img/rand?artid=128981883
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序的优化方案之主包与分包的研究
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h5>
     <a id="_1">
     </a>
     什么是分包？
    </h5>
    <blockquote>
     <p>
      某些情况下，开发者需要将小程序划分成不同的子包，在构建时打包成不同的分包，用户在使用时按需进行加载。
      <br/>
      在构建小程序分包项目时，构建会输出一个或多个分包。每个使用分包小程序必定含有一个主包。所谓的主包，即放置默认启动页面/TabBar 页面，以及一些所有分包都需用到公共资源/JS 脚本；而分包则是根据开发者的配置进行划分。
      <br/>
      在小程序启动时，默认会下载主包并启动主包内页面，当用户进入分包内某个页面时，客户端会把对应分包下载下来，下载完成后再进行展示。
      <br/>
      目前小程序分包大小有以下限制：
      <br/>
      整个小程序所有分包大小不超过 20M
      <br/>
      单个分包/主包大小不能超过 2M
     </p>
    </blockquote>
    <h5>
     <a id="_10">
     </a>
     优点
    </h5>
    <blockquote>
     <p>
      对小程序进行分包，可以优化小程序首次启动的下载时间，以及在多团队共同开发时可以更好的解耦协作。
     </p>
    </blockquote>
    <p>
     有如下的项目结构
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bfdb82b3da9a6b47628394f1ab64492a.png">
      <br/>
      app.json配置文件，pages是主包的内容，subpackages是分包的内容
     </img>
    </p>
    <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"pages/index/index"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"subpackages"</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"root"</span><span class="token operator">:</span> <span class="token string">"packageA"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"pages"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"pages/about/about"</span><span class="token punctuation">,</span>
        <span class="token string">"pages/app"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"window"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"backgroundTextStyle"</span><span class="token operator">:</span> <span class="token string">"light"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"navigationBarBackgroundColor"</span><span class="token operator">:</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"navigationBarTitleText"</span><span class="token operator">:</span> <span class="token string">"Weixin"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"navigationBarTextStyle"</span><span class="token operator">:</span> <span class="token string">"black"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"style"</span><span class="token operator">:</span> <span class="token string">"v2"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"sitemapLocation"</span><span class="token operator">:</span> <span class="token string">"sitemap.json"</span>
  
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_42">
     </a>
     主包页面跳转到分包页面
    </h5>
    <p>
     pages\index\index.wxml
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>goToClick<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>跳转到about<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-js">  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span><span class="token string">'ops'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">goToClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'goToClick'</span><span class="token punctuation">)</span>
    wx<span class="token punctuation">.</span><span class="token function">reLaunch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/packageA/pages/about/about'</span><span class="token punctuation">,</span>  <span class="token comment">//必须写完整路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="_59">
     </a>
     分包页面跳转到主包页面且携带参数
    </h5>
    <p>
     packageA\pages\about\about.wxml
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>goIndexClick<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>跳转到首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <pre><code class="prism language-js"> <span class="token function">goIndexClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/pages/index/index?name=gaofeng'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7029c08fbe72cc5e124714ddbb0e5cfb.png"/>
    </p>
    <h5>
     <a id="_74">
     </a>
     可能会出现的报错及处理方法
    </h5>
    <p>
     https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html#packOptions
     <br/>
     https://developers.weixin.qq.com/community/develop/doc/00040e5a0846706e893dcc24256009
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f2a7d5c8f1d298bdc873f5fe898e3892.png"/>
    </p>
    <pre><code class="prism language-json"> <span class="token string-property property">"packOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token string">"packageA/pages/app/app.js"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"file"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token string">"packageA/pages/cat.js"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"file"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token string">"packageA/pages/dog.js"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"file"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token string">"packageA/pages/about.js"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"file"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre>
    <p>
     即可以解决这个问题
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32373730323733392f:61727469636c652f64657461696c732f313238393831383833" class_="artid" style="display:none">
 </p>
</div>


