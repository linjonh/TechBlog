---
layout: post
title: "playWright学习总结"
date: 2025-03-11 13:04:46 +0800
description: "注意，这里并没有学过selenium自动化。playwright对比selenium来说，不需要不断下载驱动。且playWright最大的优点是可以录制操作，并自动生成自动化脚本。"
keywords: "playWright学习总结"
categories: ['未分类']
tags: ['开发语言', 'Python']
artid: "146175562"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146175562
    alt: "playWright学习总结"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146175562
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146175562
cover: https://bing.ee123.net/img/rand?artid=146175562
image: https://bing.ee123.net/img/rand?artid=146175562
img: https://bing.ee123.net/img/rand?artid=146175562
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     playWright学习总结
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     注意，这里并没有学过selenium自动化。playwright对比selenium来说，不需要不断下载驱动。
     <br/>
     且playWright最大的优点是可以录制操作，并自动生成自动化脚本。
    </p>
    <p>
     视频：
     <a href="https://www.bilibili.com/video/BV1Gw411N73T?spm_id_from=333.788.player.switch&amp;vd_source=513373b4d34804e388f350d084e973b5&amp;p=3" rel="nofollow" title="快速上手-3-示例_哔哩哔哩_bilibili">
      快速上手-3-示例_哔哩哔哩_bilibili
     </a>
     <br/>
     资料：
     <a href="https://www.byhy.net/etc/playwright/03/" rel="nofollow" title="Xpath/Role/视觉 定位方法 - 白月黑羽">
      Xpath/Role/视觉 定位方法 - 白月黑羽
     </a>
    </p>
    <h3>
     安装：
    </h3>
    <p>
     直接使用命令安装：pip install playwright
     <br/>
     安装需要的浏览器：playwright install
     <br/>
     安装对应的浏览器：playwright install chromium
    </p>
    <p>
     之前写的差不多了，然后没保存笔记，导致重新打开都不见了。就简约过了。
    </p>
    <p>
     下面两章的定位方法，其实通过
     <strong>
      辅助codegen 助手
     </strong>
     的方式都可以快速实习，而且定位方法涉及的语法较多，不是一时半会学的完的，这里就快速过一遍了。
     <br/>
     codegen助手：playwright codegen+网址。
    </p>
    <h3>
     CSS选择器 定位方法
    </h3>
    <p>
     这是第一种定位，通过CSS选择器的方式。
     <br/>
     其中，使用的操作方式有：click()、fill()、inner_text()。
    </p>
    <p id="locator">
     <strong>
      Locator 对象：
     </strong>
    </p>
    <pre><code>page.locator('#kw').fill('通讯')
page.locator('#go').click() </code></pre>
    <p id="tagidclass">
     <strong>
      根据 tag名、id、class 选择元素：
     </strong>
    </p>
    <pre><code>locators = page.locator('div').all()
for info in locators:
   print(locators.inner_text())</code></pre>
    <p>
     开发者工具栏：
     <br/>
     通过ctrl+f可以快速搜素定位目标元素。并知道目标元素有多少个。
    </p>
    <p>
    </p>
    <h3>
     Xpath/Role/视觉 定位方法
    </h3>
    <p>
     Xpath是一种语法，用于html文档选择节点。常用于playwright中。比起CSS语法更简洁。格式：/元素/子元素 。而css一般格式：元素&gt;子元素。
    </p>
    <p>
     <strong>
      根据本文内容定位：
     </strong>
     get_by_text(‘文本内容’).   //可以获取对应文本的所有文本内容
    </p>
    <p>
     <strong>
      根据 元素 role 定位：
     </strong>
     get_by_role('对应元素属性值')
    </p>
    <p>
     role元素是一种角色定位，一般是用于像alert这种信息，它是一种属性。
    </p>
    <p id="codegen">
     <strong>
      使用 codegen 助手
     </strong>
     ：playwright codegen +网址
    </p>
    <p>
     HTML元素有隐含的 ARIA role 和 ARIA Attribute，以及对应的 Accessible Name，规则比较复杂，不太容易掌握。可以使用 Playwright 的代码助手
     <code>
      codegen
     </code>
     ，代码助手产生代码时， 能使用 role定位的，会优先使用 role 定位。
    </p>
    <p id="_2">
     <strong>
      其它用户视觉定位：
     </strong>
     <br/>
     根据 元素 placeholder 定位:get_by_placeholder
    </p>
    <p id="label">
     <strong>
      根据 元素关联的 label 定位：
     </strong>
     get_by_label()
    </p>
    <p>
     <strong>
      根据 元素的 alt text 定位：
     </strong>
     get_by_alt_text()
    </p>
    <p>
     <strong>
      根据 元素 title 定位
     </strong>
     ：get_by_title("byhy首页")
    </p>
    <p>
     <strong>
      缺省等待时间
     </strong>
     ：
     <br/>
     其实就是playwright找不到此元素所消耗的时间，且返回错误信息。不过，默认等待时间之内不会返回错误信息。
    </p>
    <p>
    </p>
    <h3>
     界面操作
    </h3>
    <h4 id="_1">
     <strong>
      元素通用操作：
     </strong>
    </h4>
    <p>
     获取文本内容方法：
     <br/>
     1.inner_text()  获得单个文本信息，通过for in 操作可以获取多个。
     <br/>
     2.all_inner_texts()  获取多个文本信息，返回列表。
    </p>
    <p>
     上述是获取可见文本，还存在不可见文本：通过text_content()或者all_text_contents()获取
    </p>
    <p>
     <strong>
      获取元素属性
     </strong>
     ：get_attribute()，获取元素熟悉值
    </p>
    <p>
     <strong>
      获取元素内部html
     </strong>
     ：inner_html()
    </p>
    <p>
     <strong>
      点击方法
     </strong>
     ：click()，双击方法是dblclick()
    </p>
    <p>
     <strong>
      悬停光标
     </strong>
     ：hover()
    </p>
    <p id="_6">
     <strong>
      等待元素可见：
     </strong>
     使用 Locator对象的
     <a href="https://playwright.dev/python/docs/api/class-locator#locator-wait-for" rel="nofollow" title="wait_for">
      wait_for
     </a>
     方法
    </p>
    <p>
    </p>
    <h4 id="_8">
     输入框操作：
    </h4>
    <p>
     <strong>
      文本框输入
     </strong>
     ：单行文本框
     <code>
      input
     </code>
     或者 多行文本框
     <code>
      textarea
     </code>
     都可以使用 Locator对象的
     <a href="https://playwright.dev/python/docs/api/class-locator#locator-fill" rel="nofollow" title="fill">
      fill
     </a>
     方法进行输入。
    </p>
    <p>
     <strong>
      文本框清空
     </strong>
     ：locator.clear()
    </p>
    <p>
     <strong>
      获取文本框里的文字
     </strong>
     ：input_value。注意不是inner_text。
    </p>
    <p>
     <strong>
      获取文件输入框的文件
     </strong>
     ：set_input_files()方法。
    </p>
    <pre><code># 先定位
lc = page.locator('input[type=file]')

# 单选一个文件
lc.set_input_files('d:/1.png')</code></pre>
    <p id="radiocheckbox">
     <strong>
      radio单选/checkbox多选
     </strong>
     ：
    </p>
    <p>
     如果要点选 radio框， 可以使用 Locator对象的
     <a href="https://playwright.dev/python/docs/api/class-locator#locator-check" rel="nofollow" title="check">
      check
     </a>
     方法
     <br/>
     如果要取消选择 radio框， 可以使用 Locator对象的
     <a href="https://playwright.dev/python/docs/api/class-locator#locator-uncheck" rel="nofollow" title="uncheck">
      uncheck
     </a>
     方法
     <br/>
     如果我们要判断 radio框 是否选中，可以使用 Locator对象的
     <a href="https://playwright.dev/python/docs/api/class-locator#locator-is-checked" rel="nofollow" title="is_checked">
      is_checked
     </a>
     方法
    </p>
    <p id="select">
     <strong>
      select元素操作:
     </strong>
    </p>
    <p>
     select框 则是一个新的select标签，要选择选项，可以使用
     <code>
      select
     </code>
     元素对应的 Locator对象的
     <a href="https://playwright.dev/python/docs/api/class-locator#locator-select-option" rel="nofollow" title="select_option">
      select_option
     </a>
     方法。
    </p>
    <p id="select_1">
     <strong>
      select单选框：
     </strong>
     直接用Select方法选择即可。
     <br/>
     例如，page.locator('#ss_single').select_option('小江老师')
    </p>
    <p id="select_2">
     <strong>
      select多选框：
     </strong>
     对于select多选框，要选中某几个选项，同样可以使用上面的方法，参数为包含多个值的列表即可，page.locator('#ss_multi').select_option(['小江老师', '小雷老师'])
    </p>
    <p id="select_3">
     <strong>
      获取select选中选项：
     </strong>
     同样可以通过css selector 表达式
     <code>
      :checked
     </code>
     伪选择 获取所有选中的 select选项。
    </p>
    <pre><code class="hljs">page.locator('#ss_multi').select_option(['小江老师','小雷老师'])
lcs = page.locator('#ss_multi option:checked').all_inner_texts()
print(lcs)</code></pre>
    <h3 id="_13">
     网页操作：
    </h3>
    <p id="_14">
     <strong>
      打开网址/刷新/前进/后退
     </strong>
     ：要
     <code>
      打开网址/刷新/前进/后退
     </code>
     ， 可以分别调用 Page 对象的
     <code>
      goto/reload/go_back/go_forward
     </code>
     方法
    </p>
    <p id="html_1">
     <strong>
      获取网页Html：
     </strong>
     page.content()
    </p>
    <p>
     <strong>
      设置页面大小
     </strong>
     ：page.set_viewport_size({"width": 640, "height": 480})
    </p>
    <p>
    </p>
    <h3>
     frame/tab 切换，一些技巧
    </h3>
    <h4 id="frame">
     frame切换：
    </h4>
    <p>
     特别注意，有些html文档中，lcs = page.locator('.plant').all() 无法输出文本内容。比如，iframe 元素， 在html语法中，
     <code>
      frame
     </code>
     元素 或者
     <code>
      iframe
     </code>
     元素的内部 会包含一个
     <strong>
      被嵌入的
     </strong>
     另一份html文档。
    </p>
    <p>
     所以这个时候，需要用到切换，其实就是定位到这个内部来。
    </p>
    <p>
     方法： Page 或者 Locator 对象的frame_locator() 可以定位到frame内部。
     <br/>
     例如：
    </p>
    <pre><code class="hljs"># 产生一个  FrameLocator 对象
frame = page.frame_locator("iframe[src='sample1.html']")

# 再 在其内部进行定位
lcs = frame.locator('.plant').all()
for lc in lcs:
    print(lc.inner_text(timeout=1000))</code></pre>
    <h4 id="_1">
     窗口切换：
    </h4>
    <p>
     即是，点击链接跳转到一个新接口。这个时候即使 使用了page.locator('').click()跳转到另一个页面，这个时候获取的page页面仍然是原网页。
    </p>
    <p>
     如果要到新窗口使用，需要用到BrowserContext对象。
     <br/>
     # 创建 BrowserContext 对象   context = browser.new_context()
    </p>
    <pre><code class="hljs">context = browser.new_context()
page = context.new_page()
page.goto("https://www.byhy.net/cdn2/files/selenium/sample3.html")

page.locator('a').click()
# //必须要等待几秒，否则跳转太快，而newPage还未获取网页元素
page.wait_for_timeout(2000)
newPage = context.pages[1]
print(page.title())
print(newPage.title())</code></pre>
    <p>
     上述特别注意，创建的context对象。与原先page = browser.new_page()的区别！！！现在page的获取方式是通过context获取。page = context.new_page()。
    </p>
    <p id="tab">
     <strong>
      设置当前tab
     </strong>
     ：如果当前界面有很多窗口，要把某个窗口作为当前活动窗口显示出来，可以调用该窗口对应的Page对象的
     <a href="https://playwright.dev/python/docs/api/class-page#page-bring-to-front" rel="nofollow" title="bring_to_front">
      bring_to_front
     </a>
     方法。
    </p>
    <p id="_2">
     <strong>
      关闭网页窗口
     </strong>
     ：前面我们学过Browser对象有close 方法，那是关闭整个浏览器。如果只是要关闭某个网页窗口，可以调用该窗口对应的Page对象的
     <a href="https://playwright.dev/python/docs/api/class-page#page-close" rel="nofollow" title="close">
      close
     </a>
     方法。
    </p>
    <p>
    </p>
    <h4 id="_3">
     冻结界面：
    </h4>
    <p>
     案例：当我们的鼠标 从
     <code>
      音乐
     </code>
     移开， 这个 栏目就整个消失了， 就没法 查看 其对应的 HTML。
     <br/>
     其实就是一些鼠标悬浮会展示信息，但是当移开就不展示，这个时候不好获取对应的dom节点。
    </p>
    <p>
     在 开发者工具栏 console 里面执行如下js代码
    </p>
    <pre id="__code_6"><code>setTimeout(function(){debugger}, 5000)</code></pre>
    <h4 id="_4">
     截屏：
    </h4>
    <p>
     整个网页截屏，使用 Page 对象的
     <a href="https://playwright.dev/python/docs/api/class-page#page-screenshot" rel="nofollow" title="screenshot">
      screenshot
     </a>
     （path='***.img'）方法。
     <br/>
     部分网页内容截屏，使用locator对象的screenshot方法。
    </p>
    <h4 id="_5">
     拖拽：
    </h4>
    <p>
     使用page对象的drag_and_drop方法。暂时跳过。
    </p>
    <h4 id="_6">
     弹出对话框：
    </h4>
    <p>
     有出现对话框的情况，会因为对话框卡在那里导致后续操作超时而无法完成。 那么需要模拟用户点击ok按钮处理对话框。
    </p>
    <p>
     <strong>
      alert弹出框：
     </strong>
     可以使用codegen处理。其中accept方法等同点击确定按钮。dismiss等同取消按钮。message属性就是对话框提示信息字符串。
    </p>
    <pre><code class="hljs">page.once("dialog", lambda dialog: dialog.dismiss())
def handinfo(dialog):
    print(dialog.message)
page.on('dialog',handinfo)

page.get_by_role("button", name="alert").click()</code></pre>
    <p id="confirm">
     <strong>
      Confirm弹出框：
     </strong>
     只有确认或取消操作。同上。
    </p>
    <p id="prompt">
     <strong>
      Prompt弹出框
     </strong>
     ：需要用户输入信息上去。通过dialog对象的accept方法可以输入参数字符串，作为要输入的信息。
    </p>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f35353932383038362f:61727469636c652f64657461696c732f313436313735353632" class_="artid" style="display:none">
 </p>
</div>


