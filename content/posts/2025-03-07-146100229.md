---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33393935303537322f:61727469636c652f64657461696c732f313436313030323239"
layout: post
title: "UIè‡ªåŠ¨åŒ–æ¡†æ¶ç¬¬äº”å¼ AndroidUiAutomation-ç±»åŠŸèƒ½ç®€ä»‹"
date: 2025-03-07 17:04:35 +0800
description: "ç±»å°è£…äº†è®¾å¤‡äº¤äº’çš„åŸºæœ¬æ“ä½œï¼ˆå¦‚è¿æ¥ã€æˆªå›¾ã€ç‚¹å‡»ã€æ»‘åŠ¨ï¼‰ï¼ŒåŸºäº uiautomator2 å®ç°ã€‚ç±»è´Ÿè´£æ ¹æ®ç³»ç»Ÿå’Œè¯­è¨€åˆå§‹åŒ–ç¯å¢ƒï¼Œå¹¶æä¾›æ“ä½œæ­¥éª¤çš„æ‰§è¡Œæ¥å£ã€‚æ”¯æŒé€šè¿‡æ–‡æœ¬è¯†åˆ«å’Œå›¾ç‰‡è¯†åˆ«å®šä½ UI å…ƒç´ ï¼Œå¹¶æ‰§è¡Œç‚¹å‡»ç­‰æ“ä½œã€‚simulation_operation_step æ–¹æ³•è®¾è®¡ä¸ºå¯æ‰©å±•ï¼Œæ”¯æŒæ›´å¤šæ“ä½œç±»å‹ï¼ˆå¦‚è¾“å…¥ã€æ»‘åŠ¨ï¼‰ã€‚AndroidUiAutomation ç±»ä¸­åŒ…å«äº†è¿æ¥é”™è¯¯å¤„ç†å’Œèµ„æºæ¸…ç†åŠŸèƒ½ï¼Œç¡®ä¿æ“ä½œçš„ç¨³å®šæ€§å’Œèµ„æºé‡Šæ”¾ã€‚"
keywords: "ã€UIè‡ªåŠ¨åŒ–æ¡†æ¶ç¬¬äº”å¼ ã€‘AndroidUiAutomation ç±»åŠŸèƒ½ç®€ä»‹"
categories: ['æœªåˆ†ç±»']
tags: ['è¿ç»´', 'è‡ªåŠ¨åŒ–', 'Ui']
artid: "146100229"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146100229
    alt: "UIè‡ªåŠ¨åŒ–æ¡†æ¶ç¬¬äº”å¼ AndroidUiAutomation-ç±»åŠŸèƒ½ç®€ä»‹"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146100229
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146100229
cover: https://bing.ee123.net/img/rand?artid=146100229
image: https://bing.ee123.net/img/rand?artid=146100229
img: https://bing.ee123.net/img/rand?artid=146100229
---

# ã€UIè‡ªåŠ¨åŒ–æ¡†æ¶ç¬¬äº”å¼ ã€‘AndroidUiAutomation ç±»åŠŸèƒ½ç®€ä»‹

## ä¸€ã€AndroidUiAutomation ç±» åŠŸèƒ½ç®€ä»‹

* **åŠŸèƒ½ï¼š**
  ä¸º Android è®¾å¤‡æä¾› UI è‡ªåŠ¨åŒ–æ“ä½œçš„å·¥å…·ç±»ï¼Œæ”¯æŒè¿æ¥è®¾å¤‡ã€è·å–æˆªå›¾ã€ç‚¹å‡»ã€æ»‘åŠ¨ã€è·å–å±å¹•åˆ†è¾¨ç‡å’Œæ¸…ç†èµ„æºç­‰åŠŸèƒ½ã€‚
* **å‚æ•°ï¼š**

  + `device_idï¼ˆå¯é€‰ï¼‰ï¼š`
    è®¾å¤‡ IDï¼ˆå¦‚ â€œemulator-5554â€ï¼‰ï¼Œå¦‚æœæœªæŒ‡å®šåˆ™è‡ªåŠ¨æ£€æµ‹ã€‚
* **å¼‚å¸¸ï¼š**

  + `ConnectionErrorï¼š`
    å¦‚æœæ— æ³•è¿æ¥è®¾å¤‡ã€‚
* **è¯´æ˜ï¼š**
    
  AndroidUiAutomation ç±»åŸºäº uiautomator2 åº“ä¸ Android è®¾å¤‡äº¤äº’ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ‰§è¡Œå¸¸è§çš„ UI æ“ä½œï¼Œé€‚ç”¨äº UI æµ‹è¯•å’Œè‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚

---

## äºŒã€ä»£ç åŠŸèƒ½è§£æ

### 1. `__init__` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*åˆå§‹åŒ–
  `AndroidUiAutomation`
  ç±»å¹¶è¿æ¥è®¾å¤‡ã€‚
* **å‚æ•°ï¼š**

  + `device_idï¼ˆå¯é€‰ï¼‰`
    ï¼šè®¾å¤‡ IDï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def __init__(self, device_id=None):
      try:
          self.device = u2.connect(device_id) if device_id else u2.connect()
          print(f"æˆåŠŸè¿æ¥è®¾å¤‡: {self.device.device_info}")
      except Exception as e:
          raise ConnectionError(f"æ— æ³•è¿æ¥è®¾å¤‡: {e}")

  ```
* **è¯´æ˜ï¼š**

  + å¦‚æœæä¾›äº†
    `device_id`
    ï¼Œåˆ™è¿æ¥æŒ‡å®šè®¾å¤‡ï¼›å¦åˆ™ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶è¿æ¥è®¾å¤‡ã€‚
  + è¿æ¥å¤±è´¥æ—¶æŠ›å‡º
    `ConnectionError å¼‚å¸¸`
    ã€‚

---

### 2. `get_screenshot` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*è·å–è®¾å¤‡å±å¹•çš„å®æ—¶æˆªå›¾ï¼Œå¹¶å¯é€‰æ‹©ä¿å­˜åˆ°æ–‡ä»¶ã€‚
* **å‚æ•°ï¼š**

  + `save_path`
    ï¼ˆå¯é€‰ï¼‰ï¼šä¿å­˜æˆªå›¾çš„è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ï¼Œå¦‚æœä¸º None åˆ™ä¸ä¿å­˜ã€‚
* **è¿”å›å€¼ï¼š**

  + `numpy.ndarrayï¼š`
    OpenCV æ ¼å¼çš„æˆªå›¾ï¼ˆBGR æ ¼å¼ï¼‰ã€‚
* **å¼‚å¸¸ï¼š**

  + `Exceptionï¼š`
    å¦‚æœæˆªå›¾å¤±è´¥ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def get_screenshot(self, save_path=None):
      try:
          screenshot = self.device.screenshot(format='opencv')
          if save_path:
              cv2.imwrite(save_path, screenshot)
              print(f"æˆªå›¾å·²ä¿å­˜åˆ°: {save_path}")
          return screenshot
      except Exception as e:
          raise Exception(f"è·å–æˆªå›¾å¤±è´¥: {e}")

  ```
* **è¯´æ˜ï¼š**

  + è¿”å›è®¾å¤‡çš„å®æ—¶æˆªå›¾ï¼ˆOpenCV æ ¼å¼ï¼‰ã€‚
  + å¦‚æœæŒ‡å®šäº†
    `save_path`
    ï¼Œåˆ™ä¿å­˜æˆªå›¾åˆ°è¯¥è·¯å¾„ã€‚

---

### 3. `click` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*ç‚¹å‡»è®¾å¤‡å±å¹•ä¸Šçš„æŒ‡å®šåæ ‡ã€‚
* **å‚æ•°ï¼š**

  + `xï¼šX åæ ‡ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€‚`
  + `yï¼šY åæ ‡ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€‚`
* **è¿”å›å€¼ï¼š**

  + `boolï¼š`
    æ“ä½œæ˜¯å¦æˆåŠŸã€‚
* **å¼‚å¸¸ï¼š**

  + `ValueErrorï¼š`
    å¦‚æœåæ ‡æ— æ•ˆæˆ–è¶…å‡ºå±å¹•èŒƒå›´ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def click(self, x, y):
      try:
          width, height = self.device.window_size()
          if not (0 <= x < width and 0 <= y < height):
              raise ValueError(f"åæ ‡ ({x}, {y}) è¶…å‡ºå±å¹•èŒƒå›´ {width}x{height}")
          self.device.click(x, y)
          print(f"æˆåŠŸç‚¹å‡»åæ ‡ ({x}, {y})")
          return True
      except Exception as e:
          print(f"ç‚¹å‡»å¤±è´¥: {e}")
          return False

  ```
* **è¯´æ˜ï¼š**

  + æ£€æŸ¥åæ ‡æ˜¯å¦åœ¨å±å¹•èŒƒå›´å†…ï¼Œè‹¥æœ‰æ•ˆåˆ™æ‰§è¡Œç‚¹å‡»æ“ä½œå¹¶è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚

---

### 4. `swipe_coordinates` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*åœ¨è®¾å¤‡å±å¹•ä¸Šä»èµ·å§‹åæ ‡æ»‘åŠ¨åˆ°ç»“æŸåæ ‡ã€‚
* **å‚æ•°ï¼š**

  + `start_xï¼š`
    èµ·å§‹ç‚¹ X åæ ‡ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€‚
  + `start_yï¼š`
    èµ·å§‹ç‚¹ Y åæ ‡ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€‚
  + `end_xï¼š`
    ç»“æŸç‚¹ X åæ ‡ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€‚
  + `end_yï¼š`
    ç»“æŸç‚¹ Y åæ ‡ï¼ˆæ•´æ•°ç±»å‹ï¼‰ã€‚
  + `durationï¼ˆå¯é€‰ï¼‰ï¼š`
    æ»‘åŠ¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼Œé»˜è®¤ä¸º 500msï¼‰ã€‚
* **è¿”å›å€¼ï¼š**

  + `boolï¼š`
    æ“ä½œæ˜¯å¦æˆåŠŸã€‚
* **å¼‚å¸¸ï¼š**

  + `ValueErrorï¼š`
    å¦‚æœåæ ‡æ— æ•ˆæˆ–è¶…å‡ºå±å¹•èŒƒå›´ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def swipe_coordinates(self, start_x, start_y, end_x, end_y, duration=500):
      try:
          width, height = self.device.window_size()
          if not (0 <= start_x < width and 0 <= start_y < height and 
                  0 <= end_x < width and 0 <= end_y < height):
              raise ValueError(f"åæ ‡è¶…å‡ºå±å¹•èŒƒå›´ {width}x{height}")
          self.device.swipe(start_x, start_y, end_x, end_y, duration)
          print(f"æˆåŠŸä» ({start_x}, {start_y}) æ»‘åŠ¨åˆ° ({end_x}, {end_y})ï¼Œæ—¶é•¿ {duration}ms")
          return True
      except Exception as e:
          print(f"æ»‘åŠ¨å¤±è´¥: {e}")
          return False

  ```
* **è¯´æ˜ï¼š**

  + æ£€æŸ¥åæ ‡æœ‰æ•ˆæ€§åæ‰§è¡Œæ»‘åŠ¨æ“ä½œï¼Œè¿”å›æ“ä½œç»“æœã€‚

---

### 5. `get_screen_resolution` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*è·å–è®¾å¤‡å±å¹•çš„åˆ†è¾¨ç‡ã€‚
* **è¿”å›å€¼ï¼š**

  + `tupleï¼š`
    å±å¹•åˆ†è¾¨ç‡ï¼ˆwidth, heightï¼‰ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def get_screen_resolution(self):
      try:
          width, height = self.device.window_size()
          print(f"å±å¹•åˆ†è¾¨ç‡: {width}x{height}")
          return width, height
      except Exception as e:
          print(f"è·å–åˆ†è¾¨ç‡å¤±è´¥: {e}")
          return None, None

  ```
* **è¯´æ˜ï¼š**

  + è¿”å›å±å¹•çš„å®½åº¦å’Œé«˜åº¦ï¼Œå¤±è´¥æ—¶è¿”å› (None, None)ã€‚

---

### 6. cleanup æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*æ¸…ç†èµ„æºï¼Œæ–­å¼€è®¾å¤‡è¿æ¥ã€‚
* **è¿”å›å€¼ï¼š**

  + `boolï¼š`
    æ“ä½œæ˜¯å¦æˆåŠŸã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def cleanup(self):
      try:
          self.device.disconnect()
          print("è®¾å¤‡è¿æ¥å·²æ–­å¼€")
          return True
      except Exception as e:
          print(f"æ¸…ç†å¤±è´¥: {e}")
          return False

  ```
* æ¸…ç†èµ„æºï¼Œæ–­å¼€è®¾å¤‡è¿æ¥

  + æ–­å¼€è®¾å¤‡è¿æ¥å¹¶é‡Šæ”¾èµ„æºï¼Œè¿”å›æ“ä½œç»“æœã€‚

---

### `UiAutomation` ç±»

* \*\*åŠŸèƒ½ï¼š\*\*æ ¹æ®ç³»ç»Ÿå’Œè¯­è¨€åˆå§‹åŒ– UI è‡ªåŠ¨åŒ–æ“ä½œï¼Œå¹¶æä¾›æ¨¡æ‹Ÿæ“ä½œæ­¥éª¤çš„æ–¹æ³•ã€‚
* **å‚æ•°ï¼š**

  + \*\*systemï¼š\*\*æ“ä½œç³»ç»Ÿç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚ â€œandroidâ€ï¼‰ã€‚
  + \*\*languageï¼š\*\*è¯­è¨€ç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚ â€œenâ€ï¼‰ã€‚
* **è¯´æ˜ï¼š**
    
  `UiAutomation`
  ç±»è®¾è®¡ä¸ºæ ¹æ®ç³»ç»Ÿå’Œè¯­è¨€é…ç½®åˆå§‹åŒ– UI æ“ä½œç¯å¢ƒï¼Œå¹¶é€šè¿‡
  `simulation_operation_step`
  æ–¹æ³•æ‰§è¡Œå…·ä½“æ“ä½œæ­¥éª¤ã€‚

---

### 1 `. __init__` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*åˆå§‹åŒ–
  `UiAutomation`
  ç±»ã€‚
* **å‚æ•°ï¼š**

  + `systemï¼š`
    æ“ä½œç³»ç»Ÿç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ã€‚
  + `languageï¼š`
    è¯­è¨€ç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def __init__(self, system, language):
      if system == "android":
          # self.drive = AndroidUiAutomation()
          print(f"system: {system}, language: {language}")
      # self.action = UITools(self.drive, language)

  ```
* **è¯´æ˜ï¼š**

  + æ ¹æ®
    `system`
    åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹ï¼Œå½“å‰ä»…æ”¯æŒ â€œandroidâ€ã€‚
  + `self.drive`
    å’Œ
    `self.action`
    è¢«æ³¨é‡Šæ‰ï¼Œä»…æ‰“å°ç³»ç»Ÿå’Œè¯­è¨€ä¿¡æ¯ã€‚
  + æ³¨æ„ï¼šåˆå§‹åŒ–é€»è¾‘ä¸å®Œæ•´ï¼Œå»ºè®®å¯ç”¨å¹¶å®Œå–„ç›¸å…³ä»£ç ã€‚

---

### 2. `simulation_operation_step` æ–¹æ³•

* \*\*åŠŸèƒ½ï¼š\*\*æ ¹æ®æ­¥éª¤æ‰§è¡Œ UI æ“ä½œã€‚
* **å‚æ•°ï¼š**

  + `stepï¼š`
    æ“ä½œæ­¥éª¤ï¼ˆå­—å…¸ç±»å‹ï¼ŒåŒ…å« â€œtypeâ€ã€â€œactionâ€ å’Œ â€œvalueâ€ é”®ï¼‰ã€‚
  + `keywordsï¼ˆå¯é€‰ï¼‰ï¼š`
    æ“ä½œå…³é”®è¯åˆ—è¡¨ï¼ˆé»˜è®¤ä¸º [â€œtypeâ€, â€œactionâ€, â€œvalueâ€]ï¼‰ã€‚
* **ä»£ç ç‰‡æ®µï¼š**

  ```python
  def simulation_operation_step(self, step, keywords=None):
      if keywords is None:
          keywords = ["type", "action", "value"]
      type = step[keywords[0]]        # è¯†åˆ«æ–¹æ³•ï¼šæ–‡å­—è¯†åˆ«/å›¾ç‰‡è¯†åˆ«
      action = step[keywords[1]]      # æ“ä½œæ–¹æ³•ï¼šç‚¹å‡»/è¾“å…¥/æ»‘åŠ¨
      value = step[keywords[2]]       # æ•°æ®
      if type in ["text", "ocr", "æ–‡æœ¬"]:
          if action in ["click", "ç‚¹å‡»"]:
              # self.action.click_text(value)
              print(f"text: {value}")
      elif type in ["image", "å›¾ç‰‡"]:
          if action in ["click", "ç‚¹å‡»"]:
              # self.action.click_image(value)
              print(f"image: {value}")
      else:
          raise ValueError("ä¸æ”¯æŒçš„æ“ä½œç±»å‹")

  ```
* **è¯´æ˜ï¼š**

  + æ ¹æ® step ä¸­çš„ type å’Œ action æ‰§è¡Œæ“ä½œï¼Œæ”¯æŒæ–‡æœ¬è¯†åˆ«ï¼ˆâ€œtextâ€ã€â€œocrâ€ã€â€œæ–‡æœ¬â€ï¼‰å’Œå›¾ç‰‡è¯†åˆ«ï¼ˆâ€œimageâ€ã€â€œå›¾ç‰‡â€ï¼‰ã€‚
  + å½“å‰ä»…æ”¯æŒç‚¹å‡»æ“ä½œï¼Œå®é™…æ“ä½œè¢«æ³¨é‡Šæ‰ï¼Œä»…æ‰“å°ä¿¡æ¯ã€‚
  + æ³¨æ„ï¼šéœ€å®ç° self.action çš„ç›¸å…³æ–¹æ³•ä»¥å®ŒæˆåŠŸèƒ½ã€‚

---

## ä¸‰ã€æ€è·¯æ€»ç»“

#### æ ¸å¿ƒæ€è·¯ï¼š

1. **æ¨¡å—åŒ–è®¾è®¡ï¼š**

   * `AndroidUiAutomation`
     ç±»å°è£…äº†è®¾å¤‡äº¤äº’çš„åŸºæœ¬æ“ä½œï¼ˆå¦‚è¿æ¥ã€æˆªå›¾ã€ç‚¹å‡»ã€æ»‘åŠ¨ï¼‰ï¼ŒåŸºäº uiautomator2 å®ç°ã€‚
   * `UiAutomation`
     ç±»è´Ÿè´£æ ¹æ®ç³»ç»Ÿå’Œè¯­è¨€åˆå§‹åŒ–ç¯å¢ƒï¼Œå¹¶æä¾›æ“ä½œæ­¥éª¤çš„æ‰§è¡Œæ¥å£ã€‚
2. **çµæ´»çš„æ“ä½œæ”¯æŒï¼š**

   * æ”¯æŒé€šè¿‡æ–‡æœ¬è¯†åˆ«å’Œå›¾ç‰‡è¯†åˆ«å®šä½ UI å…ƒç´ ï¼Œå¹¶æ‰§è¡Œç‚¹å‡»ç­‰æ“ä½œã€‚
   * simulation_operation_step æ–¹æ³•è®¾è®¡ä¸ºå¯æ‰©å±•ï¼Œæ”¯æŒæ›´å¤šæ“ä½œç±»å‹ï¼ˆå¦‚è¾“å…¥ã€æ»‘åŠ¨ï¼‰ã€‚
3. **å¼‚å¸¸å¤„ç†å’Œèµ„æºç®¡ç†ï¼š**

   * AndroidUiAutomation ç±»ä¸­åŒ…å«äº†è¿æ¥é”™è¯¯å¤„ç†å’Œèµ„æºæ¸…ç†åŠŸèƒ½ï¼Œç¡®ä¿æ“ä½œçš„ç¨³å®šæ€§å’Œèµ„æºé‡Šæ”¾ã€‚
4. **å½“å‰å®ç°çŠ¶æ€ï¼š**

   * UiAutomation ç±»çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆself.drive å’Œ self.actionï¼‰è¢«æ³¨é‡Šæ‰ï¼Œä»…æ‰“å°ä¿¡æ¯ï¼Œæœªå®ç°å®é™…æ“ä½œã€‚
   * ä»£ç æ³¨é‡Šè¡¨æ˜ä½œè€…è®¡åˆ’é›†æˆ AndroidUiAutomation å’Œ UITools æ¥å®Œæˆå®Œæ•´åŠŸèƒ½ï¼Œä½†å°šæœªå®ç°ã€‚
5. **æ”¹è¿›å»ºè®®ï¼š**

   * å®Œå–„ UiAutomation ç±»çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå¯ç”¨ self.drive å’Œ self.actionã€‚
   * å®ç° UITools ä¸­çš„ click_text å’Œ click_image æ–¹æ³•ï¼Œä»¥æ”¯æŒæ–‡æœ¬å’Œå›¾ç‰‡è¯†åˆ«çš„ç‚¹å‡»æ“ä½œã€‚
   * ğŸ’¢
     **æ‰©å±• simulation_operation_step æ–¹æ³•ï¼Œæ”¯æŒæ›´å¤šæ“ä½œç±»å‹ï¼ˆå¦‚è¾“å…¥ã€æ»‘åŠ¨ï¼‰**
     ã€‚