---
layout: post
title: "前端原生Selection-api操作选中文本-样式取消样式解决标签的无限嵌套问题"
date: 2024-10-24 18:32:46 +0800
description: "大家好，我是yma16，本文分享 前端——Selection api操作选中文本 样式、取消样式（解"
keywords: "selection api"
categories: ['Web']
tags: ['1024程序员节']
artid: "143199359"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=143199359
    alt: "前端原生Selection-api操作选中文本-样式取消样式解决标签的无限嵌套问题"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=143199359
featuredImagePreview: https://bing.ee123.net/img/rand?artid=143199359
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     前端——原生Selection api操作选中文本 样式、取消样式（解决标签的无限嵌套问题）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      文章目录
     </h4>
     <ul>
      <li>
       <ul>
        <li>
         <a href="#_2" rel="nofollow">
          ⭐前言
         </a>
        </li>
        <li>
         <a href="#Selection_55" rel="nofollow">
          ⭐Selection获取选区
         </a>
        </li>
        <li>
         <ul>
          <li>
           <a href="#EyeDropperapi_70" rel="nofollow">
            ✏️EyeDropper拾色器api给选区加颜色
           </a>
          </li>
          <li>
           <a href="#selection_insertNode_html_88" rel="nofollow">
            ✏️selection insertNode 插入html字符串并渲染
           </a>
          </li>
          <li>
           <a href="#selection_insertNode_120" rel="nofollow">
            ✏️selection insertNode清空内容再写入内容再清除样式
           </a>
          </li>
          <li>
           <a href="#selection_insertNode_148" rel="nofollow">
            ✏️selection insertNode带来的空节点和冗余父级节点问题
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#_232" rel="nofollow">
          ⭐结束
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h3>
     <a id="_2">
     </a>
     ⭐前言
    </h3>
    <p>
     大家好，我是yma16，本文分享 前端——Selection api操作选中文本 样式、取消样式（解决标签的无限嵌套问题）
     <br/>
     <strong>
      Selection API
     </strong>
    </p>
    <blockquote>
     <p>
      Selection 对象表示用户选择的文本范围或插入符号的当前位置。它代表页面中的文本选区，可能横跨多个元素。文本选区由用户拖拽鼠标经过文字而产生。
     </p>
    </blockquote>
    <p>
     <strong>
      node系列往期文章
     </strong>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/108611336">
      node_windows环境变量配置
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/120364769">
      node_npm发布包
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/126220134">
      linux_配置node
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130445328">
      node_nvm安装配置
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130450397">
      node笔记_http服务搭建（渲染html、json）
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130545110">
      node笔记_读文件
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130545899">
      node笔记_写文件
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130611818?spm=1001.2014.3001.5501">
      node笔记_连接mysql实现crud
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130672968">
      node笔记_formidable实现前后端联调的文件上传
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130715454?spm=1001.2014.3001.5502">
      node笔记_koa框架介绍
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/130737052?spm=1001.2014.3001.5501">
      node_koa路由
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/131030287?spm=1001.2014.3001.5501">
      node_生成目录
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/131255680?spm=1001.2014.3001.5501">
      node_读写excel
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/131316417" rel="nofollow">
      node笔记_读取目录的文件
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/132136139" rel="nofollow">
      node笔记——调用免费qq的smtp发送html格式邮箱
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/134046367?spm=1001.2014.3001.5501">
      node实战——搭建带swagger接口文档的后端koa项目（node后端就业储备知识）
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/134090053">
      node实战——后端koa结合jwt连接mysql实现权限登录（node后端就业储备知识）
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/134277390?spm=1001.2014.3001.5501">
      node实战——koa给邮件发送验证码并缓存到redis服务（node后端储备知识）
     </a>
    </p>
    <p>
     <strong>
      koa系列项目文章
     </strong>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/136110298?spm=1001.2014.3001.5501">
      前端vite+vue3结合后端node+koa——实现代码模板展示平台（支持模糊搜索+分页查询）
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/136121838?spm=1001.2014.3001.5502" rel="nofollow">
      node+vue3+mysql前后分离开发范式——实现对数据库表的增删改查
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/136136317" rel="nofollow">
      node+vue3+mysql前后分离开发范式——实现视频文件上传并渲染
     </a>
    </p>
    <p>
     <strong>
      koa-vue性能监控到封装sdk系列文章
     </strong>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/139034129">
      性能监控系统搭建——node_koa实现性能监控数据上报（第一章）
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/139048710?spm=1001.2014.3001.5501">
      性能监控系统搭建——vue3实现性能监控数据展示（第二章）
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/139401047">
      性能监控计算——封装带性能计算并上报的npm包（第三章）
     </a>
     <br/>
     <strong>
      canvas系列文章
     </strong>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/136773707">
      web canvas系列——快速入门上手绘制二维空间点、线、面
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/136788633" rel="nofollow">
      webgl canvas系列——快速加背景、抠图、加水印并下载图片
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/137060576" rel="nofollow">
      webgl canvas系列——animation中基本旋转、平移、缩放（模拟冒泡排序过程）
     </a>
     <br/>
     <strong>
      前端vue系列文章
     </strong>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/133955447">
      vue3 + fastapi 实现选择目录所有文件自定义上传到服务器
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/132520250">
      前端vue2、vue3去掉url路由“ # ”号——nginx配置
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/131778530">
      csdn新星计划vue3+ts+antd赛道——利用inscode搭建vue3(ts)+antd前端模板
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/129460437">
      认识vite_vue3 初始化项目到打包
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/131756726">
      python_selenuim获取csdn新星赛道选手所在城市用echarts地图显示
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/134022655?spm=1001.2014.3001.5501">
      让大模型分析csdn文章质量 —— 提取csdn博客评论在文心一言分析评论区内容
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145?spm=1010.2135.3001.5343">
      前端vue3——html2canvas给网站截图生成宣传海报
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/134794991">
      前端——html拖拽原理
     </a>
     <br/>
     <a href="https://blog.csdn.net/qq_38870145/article/details/133579239">
      前端 富文本编辑器原理——从javascript、html、css开始入门
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/139666938" rel="nofollow">
      前端老古董execCommand——操作 选中文本 样式
     </a>
     <br/>
     <a href="https://yma16.blog.csdn.net/article/details/141536599" rel="nofollow">
      前端如何在30秒内实现吸管拾色器？
     </a>
    </p>
    <h3>
     <a id="Selection_55">
     </a>
     ⭐Selection获取选区
    </h3>
    <p>
     通过document.getSelection()获取选中的选区
     <br/>
     通过onselectionchange 监听 选区变化
    </p>
    <pre><code class="prism language-javascript">  document<span class="token punctuation">.</span><span class="token function-variable function">onselectionchange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'New selection made'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    selection <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'selection'</span><span class="token punctuation">,</span> selection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> selection<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> selection<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     在控制台打印选区的内容
     <br/>
     <img alt="selection-log" src="https://i-blog.csdnimg.cn/direct/4a2c9c2f5c7546febeb86e63286ccc24.png"/>
    </p>
    <h4>
     <a id="EyeDropperapi_70">
     </a>
     ✏️EyeDropper拾色器api给选区加颜色
    </h4>
    <p>
     使用EyeDropper对象获取唤起拾色器api
    </p>
    <pre><code class="prism language-javascript">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>EyeDropper<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">"你的浏览器不支持 EyeDropper API"</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> eyeDropper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EyeDropper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    eyeDropper
      <span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result.sRGBHex'</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>sRGBHex<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="selection_insertNode_html_88">
     </a>
     ✏️selection insertNode 插入html字符串并渲染
    </h4>
    <p>
     使用insertNode api
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">insertHTML</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> sel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">.</span>rangeCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> range <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      node<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      node<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">nd</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>nd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sel<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sel<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     添加成功
     <br/>
     <img alt="add-color" src="https://i-blog.csdnimg.cn/direct/7a06733d3b1e44c0a95a2a856f14d026.png">
      <br/>
      查看div下的span节点
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2cfe82a4e6034499b28643b2fdd33740.png"/>
     </img>
    </p>
    <h4>
     <a id="selection_insertNode_120">
     </a>
     ✏️selection insertNode清空内容再写入内容再清除样式
    </h4>
    <p>
     先删除选区再添加选区
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">clearStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> sel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> text<span class="token operator">=</span>sel<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span>text<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">.</span>rangeCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>value<span class="token operator">=</span>text
    <span class="token keyword">const</span> range <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    range<span class="token punctuation">.</span><span class="token function">deleteContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span>innerHTML<span class="token operator">=</span>text

    <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">nd</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nd'</span><span class="token punctuation">,</span>nd<span class="token punctuation">)</span>
      range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>nd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    sel<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sel<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     带来的问题：遗留空节点标签
     <br/>
     <img alt="del-style" src="https://i-blog.csdnimg.cn/direct/8c12751087304d2bb1dfe20426b5f481.png"/>
    </p>
    <h4>
     <a id="selection_insertNode_148">
     </a>
     ✏️selection insertNode带来的空节点和冗余父级节点问题
    </h4>
    <p>
     使用selection 插入 节点和样式带来，如下无限嵌套问题
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token style language-css">red</span><span class="token punctuation">'</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token style language-css">red</span><span class="token punctuation">'</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token style language-css">red</span><span class="token punctuation">'</span></span></span><span class="token punctuation">&gt;</span></span>修改文字<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     空节点问题
    </p>
    <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token style language-css">red</span><span class="token punctuation">'</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token style language-css">red</span><span class="token punctuation">'</span></span></span><span class="token punctuation">&gt;</span></span>修改文字<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     思路：
    </p>
    <ol>
     <li>
      每次修改选区时刻进行
      <code>
       整体向下
      </code>
      内容校验，合并嵌套的标签，删除无效标签（父节点查找子节点）
     </li>
     <li>
      每次修改选区时刻进行
      <code>
       从选区内容往父级节点查找
      </code>
      内容校验，合并嵌套的标签，删除无效标签（子节点查找父节点）
     </li>
    </ol>
    <p>
     整体修改内容清除冗余嵌套标签
     <br/>
     逻辑实现（参考）
    </p>
    <pre><code class="prism language-javascript">    <span class="token comment">/**
     * 
     * @param node 合并节点样式
     * @returns {*}
     */</span>
    <span class="token keyword">function</span> <span class="token function">mergeTag</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>node<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node.textContent'</span><span class="token punctuation">,</span>node<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> Node<span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> nodeStyle<span class="token operator">=</span>node<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
            <span class="token comment">// 如果是 span 标签，递归处理其子节点</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span>child<span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node.innerText'</span><span class="token punctuation">,</span>node<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child.innerText'</span><span class="token punctuation">,</span>child<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>textContent <span class="token operator">===</span>node<span class="token punctuation">.</span>textContent <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 内容一样的子节点忽略 获取style</span>
                    <span class="token keyword">const</span> childStyle<span class="token operator">=</span>child<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>childStyle<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">const</span> nodeStyleConfig<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>nodeStyle<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            nodeStyle<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">const</span> key<span class="token operator">=</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                                <span class="token keyword">const</span> value<span class="token operator">=</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                    nodeStyleConfig<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>value
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">// 子节点样式覆盖</span>
                        childStyle<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">const</span> key<span class="token operator">=</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                            <span class="token keyword">const</span> value<span class="token operator">=</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                nodeStyleConfig<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>value
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nodeStyleConfig'</span><span class="token punctuation">,</span>nodeStyleConfig<span class="token punctuation">)</span>
                        <span class="token comment">// console.log('nodeStyleConfig.entries()',nodeStyleConfig.entries())</span>
                        <span class="token keyword">let</span> style<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>nodeStyleConfig<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
                            style<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token operator">+</span><span class="token string">':'</span><span class="token operator">+</span>nodeStyleConfig<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span>style<span class="token punctuation">)</span>
                        node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span>style<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// 合并 nodeStyle 和  childStyle （childStyle 优先级高）</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//  节点变成文本 创建一个新的文本节点并替换它</span>
                    <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    child<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 删除 空节点</span>
                    child<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    <span class="token function">mergeTag</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> node
    <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_232">
     </a>
     ⭐结束
    </h3>
    <p>
     本文分享到这结束，如有错误或者不足之处欢迎指出！
    </p>
    <p>
     <img alt="sence" src="https://i-blog.csdnimg.cn/direct/43ba8e75529c476da572ac0993e56362.png"/>
    </p>
    <blockquote>
     <p>
      👍 点赞，是我创作的动力！
     </p>
     <p>
      ⭐️ 收藏，是我努力的方向！
     </p>
     <p>
      ✏️ 评论，是我进步的财富！
     </p>
     <p>
      💖 最后，感谢你的阅读！
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
  <div class="blog-extension-box" id="blogExtensionBox" style="width:400px;margin:auto;margin-top:12px">
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33383837303134352f:61727469636c652f64657461696c732f313433313939333539" class_="artid" style="display:none">
 </p>
</div>


