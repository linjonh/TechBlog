---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33383837303134352f:61727469636c652f64657461696c732f313433313939333539"
layout: post
title: "å‰ç«¯åŸç”ŸSelection-apiæ“ä½œé€‰ä¸­æ–‡æœ¬-æ ·å¼å–æ¶ˆæ ·å¼è§£å†³æ ‡ç­¾çš„æ— é™åµŒå¥—é—®é¢˜"
date: 2024-10-24 18:32:46 +08:00
description: "å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯yma16ï¼Œæœ¬æ–‡åˆ†äº« å‰ç«¯â€”â€”Selection apiæ“ä½œé€‰ä¸­æ–‡æœ¬ æ ·å¼ã€å–æ¶ˆæ ·å¼ï¼ˆè§£"
keywords: "selection api"
categories: ['Web']
tags: ['1024ç¨‹åºå‘˜èŠ‚']
artid: "143199359"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=143199359
    alt: "å‰ç«¯åŸç”ŸSelection-apiæ“ä½œé€‰ä¸­æ–‡æœ¬-æ ·å¼å–æ¶ˆæ ·å¼è§£å†³æ ‡ç­¾çš„æ— é™åµŒå¥—é—®é¢˜"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=143199359
featuredImagePreview: https://bing.ee123.net/img/rand?artid=143199359
---

# å‰ç«¯â€”â€”åŸç”ŸSelection apiæ“ä½œé€‰ä¸­æ–‡æœ¬ æ ·å¼ã€å–æ¶ˆæ ·å¼ï¼ˆè§£å†³æ ‡ç­¾çš„æ— é™åµŒå¥—é—®é¢˜ï¼‰

#### æ–‡ç« ç›®å½•

* + [â­å‰è¨€](#_2)
  + [â­Selectionè·å–é€‰åŒº](#Selection_55)
  + - [âœï¸EyeDropperæ‹¾è‰²å™¨apiç»™é€‰åŒºåŠ é¢œè‰²](#EyeDropperapi_70)
    - [âœï¸selection insertNode æ’å…¥htmlå­—ç¬¦ä¸²å¹¶æ¸²æŸ“](#selection_insertNode_html_88)
    - [âœï¸selection insertNodeæ¸…ç©ºå†…å®¹å†å†™å…¥å†…å®¹å†æ¸…é™¤æ ·å¼](#selection_insertNode_120)
    - [âœï¸selection insertNodeå¸¦æ¥çš„ç©ºèŠ‚ç‚¹å’Œå†—ä½™çˆ¶çº§èŠ‚ç‚¹é—®é¢˜](#selection_insertNode_148)
  + [â­ç»“æŸ](#_232)

### â­å‰è¨€

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯yma16ï¼Œæœ¬æ–‡åˆ†äº« å‰ç«¯â€”â€”Selection apiæ“ä½œé€‰ä¸­æ–‡æœ¬ æ ·å¼ã€å–æ¶ˆæ ·å¼ï¼ˆè§£å†³æ ‡ç­¾çš„æ— é™åµŒå¥—é—®é¢˜ï¼‰
  
**Selection API**

> Selection å¯¹è±¡è¡¨ç¤ºç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬èŒƒå›´æˆ–æ’å…¥ç¬¦å·çš„å½“å‰ä½ç½®ã€‚å®ƒä»£è¡¨é¡µé¢ä¸­çš„æ–‡æœ¬é€‰åŒºï¼Œå¯èƒ½æ¨ªè·¨å¤šä¸ªå…ƒç´ ã€‚æ–‡æœ¬é€‰åŒºç”±ç”¨æˆ·æ‹–æ‹½é¼ æ ‡ç»è¿‡æ–‡å­—è€Œäº§ç”Ÿã€‚

**nodeç³»åˆ—å¾€æœŸæ–‡ç« **
  
[node\_windowsç¯å¢ƒå˜é‡é…ç½®](https://blog.csdn.net/qq_38870145/article/details/108611336)
  
[node\_npmå‘å¸ƒåŒ…](https://blog.csdn.net/qq_38870145/article/details/120364769)
  
[linux\_é…ç½®node](https://blog.csdn.net/qq_38870145/article/details/126220134)
  
[node\_nvmå®‰è£…é…ç½®](https://blog.csdn.net/qq_38870145/article/details/130445328)
  
[nodeç¬”è®°\_httpæœåŠ¡æ­å»ºï¼ˆæ¸²æŸ“htmlã€jsonï¼‰](https://blog.csdn.net/qq_38870145/article/details/130450397)
  
[nodeç¬”è®°\_è¯»æ–‡ä»¶](https://blog.csdn.net/qq_38870145/article/details/130545110)
  
[nodeç¬”è®°\_å†™æ–‡ä»¶](https://blog.csdn.net/qq_38870145/article/details/130545899)
  
[nodeç¬”è®°\_è¿æ¥mysqlå®ç°crud](https://blog.csdn.net/qq_38870145/article/details/130611818?spm=1001.2014.3001.5501)
  
[nodeç¬”è®°\_formidableå®ç°å‰åç«¯è”è°ƒçš„æ–‡ä»¶ä¸Šä¼ ](https://blog.csdn.net/qq_38870145/article/details/130672968)
  
[nodeç¬”è®°\_koaæ¡†æ¶ä»‹ç»](https://blog.csdn.net/qq_38870145/article/details/130715454?spm=1001.2014.3001.5502)
  
[node\_koaè·¯ç”±](https://blog.csdn.net/qq_38870145/article/details/130737052?spm=1001.2014.3001.5501)
  
[node\_ç”Ÿæˆç›®å½•](https://blog.csdn.net/qq_38870145/article/details/131030287?spm=1001.2014.3001.5501)
  
[node\_è¯»å†™excel](https://blog.csdn.net/qq_38870145/article/details/131255680?spm=1001.2014.3001.5501)
  
[nodeç¬”è®°\_è¯»å–ç›®å½•çš„æ–‡ä»¶](https://yma16.blog.csdn.net/article/details/131316417)
  
[nodeç¬”è®°â€”â€”è°ƒç”¨å…è´¹qqçš„smtpå‘é€htmlæ ¼å¼é‚®ç®±](https://yma16.blog.csdn.net/article/details/132136139)
  
[nodeå®æˆ˜â€”â€”æ­å»ºå¸¦swaggeræ¥å£æ–‡æ¡£çš„åç«¯koaé¡¹ç›®ï¼ˆnodeåç«¯å°±ä¸šå‚¨å¤‡çŸ¥è¯†ï¼‰](https://blog.csdn.net/qq_38870145/article/details/134046367?spm=1001.2014.3001.5501)
  
[nodeå®æˆ˜â€”â€”åç«¯koaç»“åˆjwtè¿æ¥mysqlå®ç°æƒé™ç™»å½•ï¼ˆnodeåç«¯å°±ä¸šå‚¨å¤‡çŸ¥è¯†ï¼‰](https://blog.csdn.net/qq_38870145/article/details/134090053)
  
[nodeå®æˆ˜â€”â€”koaç»™é‚®ä»¶å‘é€éªŒè¯ç å¹¶ç¼“å­˜åˆ°redisæœåŠ¡ï¼ˆnodeåç«¯å‚¨å¤‡çŸ¥è¯†ï¼‰](https://blog.csdn.net/qq_38870145/article/details/134277390?spm=1001.2014.3001.5501)

**koaç³»åˆ—é¡¹ç›®æ–‡ç« **
  
[å‰ç«¯vite+vue3ç»“åˆåç«¯node+koaâ€”â€”å®ç°ä»£ç æ¨¡æ¿å±•ç¤ºå¹³å°ï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢+åˆ†é¡µæŸ¥è¯¢ï¼‰](https://blog.csdn.net/qq_38870145/article/details/136110298?spm=1001.2014.3001.5501)
  
[node+vue3+mysqlå‰ååˆ†ç¦»å¼€å‘èŒƒå¼â€”â€”å®ç°å¯¹æ•°æ®åº“è¡¨çš„å¢åˆ æ”¹æŸ¥](https://yma16.blog.csdn.net/article/details/136121838?spm=1001.2014.3001.5502)
  
[node+vue3+mysqlå‰ååˆ†ç¦»å¼€å‘èŒƒå¼â€”â€”å®ç°è§†é¢‘æ–‡ä»¶ä¸Šä¼ å¹¶æ¸²æŸ“](https://yma16.blog.csdn.net/article/details/136136317)

**koa-vueæ€§èƒ½ç›‘æ§åˆ°å°è£…sdkç³»åˆ—æ–‡ç« **
  
[æ€§èƒ½ç›‘æ§ç³»ç»Ÿæ­å»ºâ€”â€”node\_koaå®ç°æ€§èƒ½ç›‘æ§æ•°æ®ä¸ŠæŠ¥ï¼ˆç¬¬ä¸€ç« ï¼‰](https://blog.csdn.net/qq_38870145/article/details/139034129)
  
[æ€§èƒ½ç›‘æ§ç³»ç»Ÿæ­å»ºâ€”â€”vue3å®ç°æ€§èƒ½ç›‘æ§æ•°æ®å±•ç¤ºï¼ˆç¬¬äºŒç« ï¼‰](https://blog.csdn.net/qq_38870145/article/details/139048710?spm=1001.2014.3001.5501)
  
[æ€§èƒ½ç›‘æ§è®¡ç®—â€”â€”å°è£…å¸¦æ€§èƒ½è®¡ç®—å¹¶ä¸ŠæŠ¥çš„npmåŒ…ï¼ˆç¬¬ä¸‰ç« ï¼‰](https://blog.csdn.net/qq_38870145/article/details/139401047)
  
**canvasç³»åˆ—æ–‡ç« **
  
[web canvasç³»åˆ—â€”â€”å¿«é€Ÿå…¥é—¨ä¸Šæ‰‹ç»˜åˆ¶äºŒç»´ç©ºé—´ç‚¹ã€çº¿ã€é¢](https://blog.csdn.net/qq_38870145/article/details/136773707)
  
[webgl canvasç³»åˆ—â€”â€”å¿«é€ŸåŠ èƒŒæ™¯ã€æŠ å›¾ã€åŠ æ°´å°å¹¶ä¸‹è½½å›¾ç‰‡](https://yma16.blog.csdn.net/article/details/136788633)
  
[webgl canvasç³»åˆ—â€”â€”animationä¸­åŸºæœ¬æ—‹è½¬ã€å¹³ç§»ã€ç¼©æ”¾ï¼ˆæ¨¡æ‹Ÿå†’æ³¡æ’åºè¿‡ç¨‹ï¼‰](https://yma16.blog.csdn.net/article/details/137060576)
  
**å‰ç«¯vueç³»åˆ—æ–‡ç« **
  
[vue3 + fastapi å®ç°é€‰æ‹©ç›®å½•æ‰€æœ‰æ–‡ä»¶è‡ªå®šä¹‰ä¸Šä¼ åˆ°æœåŠ¡å™¨](https://blog.csdn.net/qq_38870145/article/details/133955447)
  
[å‰ç«¯vue2ã€vue3å»æ‰urlè·¯ç”±â€œ # â€å·â€”â€”nginxé…ç½®](https://blog.csdn.net/qq_38870145/article/details/132520250)
  
[csdnæ–°æ˜Ÿè®¡åˆ’vue3+ts+antdèµ›é“â€”â€”åˆ©ç”¨inscodeæ­å»ºvue3(ts)+antdå‰ç«¯æ¨¡æ¿](https://blog.csdn.net/qq_38870145/article/details/131778530)
  
[è®¤è¯†vite\_vue3 åˆå§‹åŒ–é¡¹ç›®åˆ°æ‰“åŒ…](https://blog.csdn.net/qq_38870145/article/details/129460437)
  
[python\_selenuimè·å–csdnæ–°æ˜Ÿèµ›é“é€‰æ‰‹æ‰€åœ¨åŸå¸‚ç”¨echartsåœ°å›¾æ˜¾ç¤º](https://blog.csdn.net/qq_38870145/article/details/131756726)
  
[è®©å¤§æ¨¡å‹åˆ†æcsdnæ–‡ç« è´¨é‡ â€”â€” æå–csdnåšå®¢è¯„è®ºåœ¨æ–‡å¿ƒä¸€è¨€åˆ†æè¯„è®ºåŒºå†…å®¹](https://blog.csdn.net/qq_38870145/article/details/134022655?spm=1001.2014.3001.5501)
  
[å‰ç«¯vue3â€”â€”html2canvasç»™ç½‘ç«™æˆªå›¾ç”Ÿæˆå®£ä¼ æµ·æŠ¥](https://blog.csdn.net/qq_38870145?spm=1010.2135.3001.5343)
  
[å‰ç«¯â€”â€”htmlæ‹–æ‹½åŸç†](https://blog.csdn.net/qq_38870145/article/details/134794991)
  
[å‰ç«¯ å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åŸç†â€”â€”ä»javascriptã€htmlã€csså¼€å§‹å…¥é—¨](https://blog.csdn.net/qq_38870145/article/details/133579239)
  
[å‰ç«¯è€å¤è‘£execCommandâ€”â€”æ“ä½œ é€‰ä¸­æ–‡æœ¬ æ ·å¼](https://yma16.blog.csdn.net/article/details/139666938)
  
[å‰ç«¯å¦‚ä½•åœ¨30ç§’å†…å®ç°å¸ç®¡æ‹¾è‰²å™¨ï¼Ÿ](https://yma16.blog.csdn.net/article/details/141536599)

### â­Selectionè·å–é€‰åŒº

é€šè¿‡document.getSelection()è·å–é€‰ä¸­çš„é€‰åŒº
  
é€šè¿‡onselectionchange ç›‘å¬ é€‰åŒºå˜åŒ–

```javascript
  document.onselectionchange = function () {
    console.log('New selection made');
    selection = document.getSelection();
    console.log('selection', selection);
    console.log('type', selection.type);
    console.log('content', selection.toString())
  };

```

åœ¨æ§åˆ¶å°æ‰“å°é€‰åŒºçš„å†…å®¹
  
![selection-log](https://i-blog.csdnimg.cn/direct/4a2c9c2f5c7546febeb86e63286ccc24.png)

#### âœï¸EyeDropperæ‹¾è‰²å™¨apiç»™é€‰åŒºåŠ é¢œè‰²

ä½¿ç”¨EyeDropperå¯¹è±¡è·å–å”¤èµ·æ‹¾è‰²å™¨api

```javascript
    if (!window.EyeDropper) {
      message.warning("ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ EyeDropper API")
      return;
    }
    const eyeDropper = new EyeDropper();

    eyeDropper
      .open()
      .then((result) => {
        console.log('result.sRGBHex',result.sRGBHex)
      })
      .catch((e) => {
        console.error(e)
      });

```

#### âœï¸selection insertNode æ’å…¥htmlå­—ç¬¦ä¸²å¹¶æ¸²æŸ“

ä½¿ç”¨insertNode api

```javascript
function insertHTML(value) {
  const sel = document.getSelection();

  if (sel && sel.rangeCount) {
    const node = document.createElement('div');
    const range = sel.getRangeAt(0);
    range.deleteContents();

    if (value) {
      node.innerHTML = value;
    } else if (value) {
      node.appendChild(value);
    }

    Array.prototype.slice.call(node.childNodes).forEach(nd => {
      range.insertNode(nd);
    });

    sel.removeAllRanges();
    sel.addRange(range);
  }
}

```

æ·»åŠ æˆåŠŸ
  
![add-color](https://i-blog.csdnimg.cn/direct/7a06733d3b1e44c0a95a2a856f14d026.png)
  
æŸ¥çœ‹divä¸‹çš„spanèŠ‚ç‚¹
  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/2cfe82a4e6034499b28643b2fdd33740.png)

#### âœï¸selection insertNodeæ¸…ç©ºå†…å®¹å†å†™å…¥å†…å®¹å†æ¸…é™¤æ ·å¼

å…ˆåˆ é™¤é€‰åŒºå†æ·»åŠ é€‰åŒº

```javascript
function clearStyle() {
  const sel = document.getSelection();
  const text=sel.toString()
  console.log('text',text)
  if (sel && sel.rangeCount) {
    const node = document.createElement('span');
    node.value=text
    const range = sel.getRangeAt(0);
    range.deleteContents();
    node.innerHTML=text

    Array.prototype.slice.call(node.childNodes).forEach(nd => {
      console.log('nd',nd)
      range.insertNode(nd);
    });

    sel.removeAllRanges();
    sel.addRange(range);
  }
}

```

å¸¦æ¥çš„é—®é¢˜ï¼šé—ç•™ç©ºèŠ‚ç‚¹æ ‡ç­¾
  
![del-style](https://i-blog.csdnimg.cn/direct/8c12751087304d2bb1dfe20426b5f481.png)

#### âœï¸selection insertNodeå¸¦æ¥çš„ç©ºèŠ‚ç‚¹å’Œå†—ä½™çˆ¶çº§èŠ‚ç‚¹é—®é¢˜

ä½¿ç”¨selection æ’å…¥ èŠ‚ç‚¹å’Œæ ·å¼å¸¦æ¥ï¼Œå¦‚ä¸‹æ— é™åµŒå¥—é—®é¢˜

```html
<span style='red'><span style='red'><span style='red'>ä¿®æ”¹æ–‡å­—</span></span></span>

```

ç©ºèŠ‚ç‚¹é—®é¢˜

```html
<span style='red'></span><span style='red'>ä¿®æ”¹æ–‡å­—</span>

```

æ€è·¯ï¼š

1. æ¯æ¬¡ä¿®æ”¹é€‰åŒºæ—¶åˆ»è¿›è¡Œ
   `æ•´ä½“å‘ä¸‹`
   å†…å®¹æ ¡éªŒï¼Œåˆå¹¶åµŒå¥—çš„æ ‡ç­¾ï¼Œåˆ é™¤æ— æ•ˆæ ‡ç­¾ï¼ˆçˆ¶èŠ‚ç‚¹æŸ¥æ‰¾å­èŠ‚ç‚¹ï¼‰
2. æ¯æ¬¡ä¿®æ”¹é€‰åŒºæ—¶åˆ»è¿›è¡Œ
   `ä»é€‰åŒºå†…å®¹å¾€çˆ¶çº§èŠ‚ç‚¹æŸ¥æ‰¾`
   å†…å®¹æ ¡éªŒï¼Œåˆå¹¶åµŒå¥—çš„æ ‡ç­¾ï¼Œåˆ é™¤æ— æ•ˆæ ‡ç­¾ï¼ˆå­èŠ‚ç‚¹æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹ï¼‰

æ•´ä½“ä¿®æ”¹å†…å®¹æ¸…é™¤å†—ä½™åµŒå¥—æ ‡ç­¾
  
é€»è¾‘å®ç°ï¼ˆå‚è€ƒï¼‰

```javascript
    /**
     * 
     * @param node åˆå¹¶èŠ‚ç‚¹æ ·å¼
     * @returns {*}
     */
    function mergeTag(node){
        console.log('node',node)
        console.log('node.textContent',node.textContent)
        if (node.nodeType === Node.ELEMENT_NODE) {
            const nodeStyle=node.getAttribute('style')
            // å¦‚æœæ˜¯ span æ ‡ç­¾ï¼Œé€’å½’å¤„ç†å…¶å­èŠ‚ç‚¹
            for (let child of node.childNodes) {
                console.log('child',child)
                console.log('node.innerText',node.textContent)
                console.log('child.innerText',child.textContent)
                if(child.textContent ===node.textContent ){
                    // å†…å®¹ä¸€æ ·çš„å­èŠ‚ç‚¹å¿½ç•¥ è·å–style
                    const childStyle=child.getAttribute('style')
                    if(childStyle){
                        const nodeStyleConfig={}
                        if(nodeStyle){
                            nodeStyle.split(';').map(item=>{
                                const key=item.split(':')[0]
                                const value=item.split(':')[1]
                                if(key){
                                    nodeStyleConfig[key]=value
                                }
                            })
                        }
                        // å­èŠ‚ç‚¹æ ·å¼è¦†ç›–
                        childStyle.split(';').map(item=>{
                            const key=item.split(':')[0]
                            const value=item.split(':')[1]
                            if(key){
                                nodeStyleConfig[key]=value
                            }
                        })
                        console.log('nodeStyleConfig',nodeStyleConfig)
                        // console.log('nodeStyleConfig.entries()',nodeStyleConfig.entries())
                        let style=[]
                        Object.keys(nodeStyleConfig).forEach(key=>{
                            style.push(key+':'+nodeStyleConfig[key])
                        })
                        console.log('style',style)
                        node.setAttribute('style',style.join(';'))
                        // åˆå¹¶ nodeStyle å’Œ  childStyle ï¼ˆchildStyle ä¼˜å…ˆçº§é«˜ï¼‰
                    }
                    //  èŠ‚ç‚¹å˜æˆæ–‡æœ¬ åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æœ¬èŠ‚ç‚¹å¹¶æ›¿æ¢å®ƒ
                    const textNode = document.createTextNode(child.textContent);
                    child.parentNode.replaceChild(textNode, child);
                }
                else if(!child.textContent){
                    // åˆ é™¤ ç©ºèŠ‚ç‚¹
                    child.remove()
                }
                else{
                    mergeTag(child);
                }

            }
        }
        return node
    }

```

### â­ç»“æŸ

æœ¬æ–‡åˆ†äº«åˆ°è¿™ç»“æŸï¼Œå¦‚æœ‰é”™è¯¯æˆ–è€…ä¸è¶³ä¹‹å¤„æ¬¢è¿æŒ‡å‡ºï¼

![sence](https://i-blog.csdnimg.cn/direct/43ba8e75529c476da572ac0993e56362.png)

> ğŸ‘ ç‚¹èµï¼Œæ˜¯æˆ‘åˆ›ä½œçš„åŠ¨åŠ›ï¼
>
> â­ï¸ æ”¶è—ï¼Œæ˜¯æˆ‘åŠªåŠ›çš„æ–¹å‘ï¼
>
> âœï¸ è¯„è®ºï¼Œæ˜¯æˆ‘è¿›æ­¥çš„è´¢å¯Œï¼
>
> ğŸ’– æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼