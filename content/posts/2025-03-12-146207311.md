---
layout: post
title: "C实现本地Deepseek模型及其他模型的对话v1.4"
date: 2025-03-12 17:25:34 +0800
description: "WPF+OllamaSharpe实现本地聊天功能、如Deepseek、Llama。交互式聊天、根据之前记录聊天、添加外部文本聊天、添加图像聊天，识别图像内容。"
keywords: "C#实现本地Deepseek模型及其他模型的对话v1.4"
categories: ['Wpf', 'C']
tags: ['本地部署', 'Wpf', 'Ollama', 'Deepseek', 'C', 'Ai']
artid: "146207311"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146207311
    alt: "C实现本地Deepseek模型及其他模型的对话v1.4"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146207311
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146207311
cover: https://bing.ee123.net/img/rand?artid=146207311
image: https://bing.ee123.net/img/rand?artid=146207311
img: https://bing.ee123.net/img/rand?artid=146207311
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C#实现本地Deepseek模型及其他模型的对话v1.4
    </h1>
   </div>
   <div class="article-resource-info-box">
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前言
    </h2>
    <blockquote>
     <p>
      系 统：Window11
      <br/>
      开发工具：Visual Studio 2022
      <br/>
      相关技术：C# 、WPF .Net 8.0
     </p>
    </blockquote>
    <h3>
     <a id="1CAI_4">
     </a>
     1、C#实现本地AI聊天功能
    </h3>
    <blockquote>
     <p>
      <strong>
       WPF+OllamaSharpe实现本地聊天功能,可以选择使用Deepseek 及其他模型。
      </strong>
     </p>
     <ol>
      <li>
       <p>
        新增根据聊天记录回复的功能。
       </p>
      </li>
      <li>
       <p>
        优化了部分ViewModel，将对应Model字段、属性移到Model中，方便后续扩展。
       </p>
      </li>
      <li>
       <p>
        新增读取外部数据回复问题功能，目前支持txt文件。
       </p>
      </li>
      <li>
       <p>
        新增添加图片提问题功能，模型需要支持视觉（如：minicpm-v:latest）。
       </p>
      </li>
      <li>
       <p>
        优化了类结构，创建对应的Model(MainWindowModel),将所有字段、属性移到Model。
       </p>
      </li>
      <li>
       <p>
        新增聊天记录窗体，修改了窗体加载时，加载聊天记录的功能。将其拆分成一个视图。
       </p>
      </li>
      <li>
       <p>
        移除了折叠栏功能，更新为Grid区域的显示与隐藏。 将聊天记录列表从主窗体中分离）。
       </p>
      </li>
      <li>
       <p>
        更新记录文件加载功能，显示提问日期。 新增选择文件类型设置预览图标。
       </p>
      </li>
      <li>
       <p>
        新增功能，新聊天后第一次提问完成后，保存的记录刷新到记录列表、记录删除功能。
       </p>
      </li>
      <li>
       <p>
        新增功能，创建新窗体判断显示Ollama服务运行状态。
       </p>
      </li>
     </ol>
    </blockquote>
    <h3>
     <a id="2_27">
     </a>
     2、相关依赖
    </h3>
    <p>
     OllamaSharpe：启用本地Ollama服务
     <br/>
     Markdig.wpf : Markdown格式化输出功能。
     <br/>
     Microsoft.Xaml.Behaviors.Wpf ：解决部分不能进行命令绑定的控件实现命令绑定功能。
     <br/>
     Newtonsoft.Json：Json数据的序列化和反序列化。
    </p>
    <h3>
     <a id="3__33">
     </a>
     3 界面预览
    </h3>
    <h4>
     <a id="_34">
     </a>
     ①界面预览
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/890c429d6c4f475691a2fa52fd08a0ab.png"/>
    </p>
    <h4>
     <a id="_36">
     </a>
     ②界面预览-聊天记录
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7af5261b3f9a42b084f3989ee9133c2e.png"/>
    </p>
    <h4>
     <a id="_38">
     </a>
     ③界面预览-图像分析
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ae1dd0dede4d4d3fb83c551cbce0c6d6.png"/>
    </p>
    <h4>
     <a id="_40">
     </a>
     ④项目结构
    </h4>
    <blockquote>
     <p>
      Commands: 用于命令绑定
      <br/>
      ExtensionTool:目前没啥大功能…
      <br/>
      Services ：一些服务操作,如聊天数据处理、图像处理、序列化…
      <br/>
      Models : 视图对应的模型，在类中创建一些字段、属性。
      <br/>
      Views :视图以及一些视图控件的样式资源
      <br/>
      ViewModels：视图模型，主要处理视图和模型的交互、以及一些业务处理
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1594b7003b8a4ae0911c6431886fe8bd.png"/>
     </p>
    </blockquote>
    <hr/>
    <hr/>
    <h2>
     <a id="_51">
     </a>
     代码
    </h2>
    <h3>
     <a id="Commands__52">
     </a>
     Commands 目录
    </h3>
    <h5>
     <a id="OfflineAICommands_53">
     </a>
     命名空间：OfflineAI.Commands
    </h5>
    <h4>
     <a id="EventsCommand_54">
     </a>
     EventsCommand
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventsCommand<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICommand</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> _execute<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> _canExecute<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">EventsCommand</span><span class="token punctuation">(</span><span class="token class-name">Action<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> execute<span class="token punctuation">,</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> canExecute <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _execute <span class="token operator">=</span> execute <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>execute<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _canExecute <span class="token operator">=</span> canExecute<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CanExecute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> _canExecute<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>parameter<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">_execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token return-type class-name">EventHandler</span> CanExecuteChanged
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">add</span> <span class="token punctuation">{<!-- --></span> CommandManager<span class="token punctuation">.</span>RequerySuggested <span class="token operator">+=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">remove</span> <span class="token punctuation">{<!-- --></span> CommandManager<span class="token punctuation">.</span>RequerySuggested <span class="token operator">-=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ParameterCommand_82">
     </a>
     ParameterCommand
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParameterCommand</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICommand</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> execute<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">ParameterCommand</span><span class="token punctuation">(</span><span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> execute<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>execute <span class="token operator">=</span> execute<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">?</span></span> CanExecuteChanged<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CanExecute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> CanExecuteChanged <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        execute<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ParameterlessCommand_104">
     </a>
     ParameterlessCommand
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParameterlessCommand</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICommand</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Action</span> _execute<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">ParameterlessCommand</span><span class="token punctuation">(</span><span class="token class-name">Action</span> execute<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_execute <span class="token operator">=</span> execute<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">?</span></span> CanExecuteChanged<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CanExecute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> CanExecuteChanged <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">?</span></span> parameter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _execute<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="RelayCommand_126">
     </a>
     RelayCommand
    </h4>
    <pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RelayCommand</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICommand</span></span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> _execute<span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Predicate<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> _canExecute<span class="token punctuation">;</span>
     <span class="token keyword">public</span> <span class="token function">RelayCommand</span><span class="token punctuation">(</span><span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> execute<span class="token punctuation">,</span> <span class="token class-name">Predicate<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> canExecute <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         _execute <span class="token operator">=</span> execute <span class="token operator">??</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>execute<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         _canExecute <span class="token operator">=</span> canExecute<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CanExecute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> parameter<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">return</span> _canExecute <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">_canExecute</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> parameter<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token function">_execute</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token return-type class-name">EventHandler</span> CanExecuteChanged
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">add</span> <span class="token punctuation">{<!-- --></span> CommandManager<span class="token punctuation">.</span>RequerySuggested <span class="token operator">+=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token keyword">remove</span> <span class="token punctuation">{<!-- --></span> CommandManager<span class="token punctuation">.</span>RequerySuggested <span class="token operator">-=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h3>
     <a id="ExtensionTool__154">
     </a>
     ExtensionTool 目录
    </h3>
    <h5>
     <a id="_OfflineAIExtensionTool_155">
     </a>
     命名空间 OfflineAI.ExtensionTool
    </h5>
    <h4>
     <a id="LimitedObservableCollection_156">
     </a>
     LimitedObservableCollection
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 限定大小集合</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LimitedObservableCollection<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObservableCollection<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">int</span></span> _maxSize<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">LimitedObservableCollection</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> maxSize<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _maxSize <span class="token operator">=</span> maxSize<span class="token punctuation">;</span>
        CollectionChanged <span class="token operator">+=</span> OnCollectionChanged<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollectionChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">NotifyCollectionChangedEventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Count <span class="token operator">&gt;</span> _maxSize<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 移除超出部分的元素</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> Count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> _maxSize<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">RemoveAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h3>
     <a id="Models__184">
     </a>
     Models 目录
    </h3>
    <h5>
     <a id="_OfflineAIModels_185">
     </a>
     命名空间 OfflineAI.Models
    </h5>
    <h4>
     <a id="PropertyChangedBase_186">
     </a>
     PropertyChangedBase
    </h4>
    <pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertyChangedBase</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">INotifyPropertyChanged</span></span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">PropertyChangedEventHandler<span class="token punctuation">?</span></span> PropertyChanged<span class="token punctuation">;</span>
     <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CallerMemberName</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span></span> propertyName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         PropertyChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyChangedEventArgs</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ChatDataModel_199">
     </a>
     ChatDataModel
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 聊天数据：路径、数据对象、右键菜单命令</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatDataModel</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token function">ChatDataModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        JsonModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatJsonDataModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Uri <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ChatJsonDataModel<span class="token punctuation">?</span></span> JsonModel <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> MenuItemMouseDownCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ChatJsonDataModel_215">
     </a>
     ChatJsonDataModel
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 聊天（Json）数据:角色、内容、图像、返回内容、时间</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatJsonDataModel</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">JsonProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Role <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">JsonProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Content <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">JsonProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"images[]"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Image <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">JsonProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Result <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">JsonProperty</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"date"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Date <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ExternalDataPreModel_234">
     </a>
     ExternalDataPreModel
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 外部数据预览模型：文件名、索引、图像文件</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExternalDataPreModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FileName <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ExternalDataType</span> DataType
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">object</span></span> _index<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Index
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _index<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_index <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _index <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> imageSource<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ImageSource
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> imageSource<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>imageSource <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                imageSource <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/// 外部数据类型:文本、图像、其他未知</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ExternalDataType</span>
<span class="token punctuation">{<!-- --></span>
    Text<span class="token punctuation">,</span>
    Image<span class="token punctuation">,</span>
    Unknown
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="_284">
     </a>
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 文件变更</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileChangedModel</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"文件名"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> FileName <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"操作"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">FileChangeType</span> Options <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// 文件变更类型，创建，删除，修改</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">FileChangeType</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"文件被创建"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Created<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"文件被删除"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Deleted<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Description</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"文件被修改"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    Modified
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="FileOperationModel_309">
     </a>
     FileOperationModel
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">///文件操作:1、是否生成目录 2、目录 3、日期目录 4、文件名 5、日期文件名 6、扩展名 7、文件名格式</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileOperationModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsGenerateDirectory <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Directory <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DirectoryDT <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FileName <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FileNameDT <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Extension <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FileNameFormat <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="MainWindowModel_325">
     </a>
     MainWindowModel
    </h4>
    <p>
     ///
    </p>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainWindowModel</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _expandedBarWidth <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>     <span class="token comment">//折叠栏宽度</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _selectedModel<span class="token punctuation">;</span>          <span class="token comment">//选择的模型</span>
    <span class="token keyword">private</span> <span class="token class-name">Visibility</span> _expandedMenuIsHide <span class="token operator">=</span> Visibility<span class="token punctuation">.</span>Hidden<span class="token punctuation">;</span><span class="token comment">//折叠栏是否隐藏</span>
    <span class="token keyword">private</span> <span class="token class-name">OllamaService</span> _ollamaService<span class="token punctuation">;</span>                  		<span class="token comment">// Ollama服务对象</span>
    <span class="token keyword">private</span> <span class="token class-name">UserControl</span> _currentView<span class="token punctuation">;</span>                           <span class="token comment">// 当前显示视图</span>
    <span class="token keyword">private</span> <span class="token class-name">UserControl</span> _expandedBarView<span class="token punctuation">;</span>                       <span class="token comment">// 折叠栏视图</span>
    <span class="token keyword">private</span> <span class="token class-name">ObservableCollection<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> _modelListCollection<span class="token punctuation">;</span>  <span class="token comment">// 模型列表集合</span>
    <span class="token comment">/// 视图集合，保存视图</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ObservableCollection<span class="token punctuation">&lt;</span>UserControl<span class="token punctuation">&gt;</span></span> ViewCollection <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 折叠栏宽度</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ExpandedBarWidth
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _expandedBarWidth<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> _expandedBarWidth<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _expandedBarWidth <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 选择的模型</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SelectedModel 
    <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _selectedModel<span class="token punctuation">;</span> 
        <span class="token keyword">set</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> _selectedModel<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _selectedModel <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                _ollamaService<span class="token punctuation">.</span>SelectModel <span class="token operator">=</span> _selectedModel<span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Visibility</span> ExpandedMenuIsHide <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _expandedMenuIsHide<span class="token punctuation">;</span> 
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> _expandedMenuIsHide<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _expandedMenuIsHide <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// Ollama服务对象</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">OllamaService</span> Ollama
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _ollamaService<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_ollamaService <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _ollamaService <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 当前显示视图</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">UserControl</span> CurrentView
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _currentView<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_currentView <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _currentView <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 当前折叠栏视图</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">UserControl</span> ExpandedBarView
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _expandedBarView<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_expandedBarView <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _expandedBarView <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 模型列表集合</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ObservableCollection<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> ModelListCollection
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _modelListCollection<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_modelListCollection <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _modelListCollection <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="UseChatModel_433">
     </a>
     UseChatModel
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 用户聊天</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserChatModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> _isAutoScrolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token comment">//是否自动滚动</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> _isHintVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token comment">//提示是否可见</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _inputText <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>   <span class="token comment">//输入文本</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _directory <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>   <span class="token comment">//目录</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _fileName <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>    <span class="token comment">//文件</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _submitButtonName <span class="token operator">=</span> <span class="token string">"提交"</span><span class="token punctuation">;</span>  <span class="token comment">//提交按钮名称</span>
    <span class="token keyword">private</span> <span class="token class-name">OllamaService</span> _ollama<span class="token punctuation">;</span>              <span class="token comment">//共享Ollama对象</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> _isShowRunState <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token comment">//是否显示运行状态</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> _runState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">//运行状态</span>
    <span class="token comment">/// 是否自动滚动</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsAutoScrolling <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _isAutoScrolling<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_isAutoScrolling <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _isAutoScrolling <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 是否显示运行状态</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsShowRunState
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _isShowRunState<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_isShowRunState <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _isShowRunState <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 输入文本</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> InputText <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _inputText<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_inputText <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _inputText <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 运行状态</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> RunState
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _runState<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_runState <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _runState <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 是否显示提示</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsHintVisible
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _isHintVisible<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_isHintVisible <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _isHintVisible <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 目录</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Directory <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _directory<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_directory <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _directory <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 文件名</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FileName <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _fileName<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_fileName <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _fileName <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 提交按钮名称</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SubmitButtonName <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _submitButtonName<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_submitButtonName <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _submitButtonName <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">///Ollama对象 </span>
    <span class="token keyword">public</span> <span class="token return-type class-name">OllamaService</span> Ollama
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _ollama<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_ollama <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _ollama <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                RunState <span class="token operator">=</span> _ollama<span class="token punctuation">.</span>Connected<span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h3>
     <a id="Services__564">
     </a>
     Services 目录
    </h3>
    <h5>
     <a id="OfflineServices_565">
     </a>
     命名空间：Offline.Services
    </h5>
    <h4>
     <a id="DataService_566">
     </a>
     DataService
    </h4>
    <pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataService</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段、属性</span>
     <span class="token comment">/// 外部数据模型集合:当前最大10个</span>
     <span class="token keyword">private</span> <span class="token class-name">LimitedObservableCollection<span class="token punctuation">&lt;</span>ExternalDataService<span class="token punctuation">&gt;</span></span> _externalDatas 
         <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LimitedObservableCollection<span class="token punctuation">&lt;</span>ExternalDataService<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">/// 数据索引</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> DataID <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 外部数据模型集合个数</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ExternalDataCount <span class="token operator">=&gt;</span> ExternalDatas<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
     <span class="token comment">/// 外部数据模型集合</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">LimitedObservableCollection<span class="token punctuation">&lt;</span>ExternalDataService<span class="token punctuation">&gt;</span></span> ExternalDatas <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _externalDatas<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 文件操作模型</span>
     <span class="token keyword">private</span> <span class="token class-name">FileOperationModel</span> _fileModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileOperationModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">/// 文件操作模型</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">FileOperationModel</span> FileModel
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _fileModel<span class="token punctuation">;</span>
         <span class="token keyword">private</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _fileModel <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 构造函数</span>
     <span class="token keyword">public</span> <span class="token function">DataService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         FileModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileOperationModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token function">DataService</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> directory<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         FileModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileOperationModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             IsGenerateDirectory <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>         <span class="token comment">//是否生成目录</span>
             Directory <span class="token operator">=</span> directory<span class="token punctuation">,</span>              <span class="token comment">//目录</span>
             FileNameFormat <span class="token operator">=</span> <span class="token string">"yyyyMMddHHmmss"</span><span class="token punctuation">,</span>  <span class="token comment">//生成文件名格式</span>
             Extension <span class="token operator">=</span> <span class="token string">"json"</span><span class="token punctuation">,</span>                 <span class="token comment">//拓展名</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
         FileModel<span class="token punctuation">.</span>FileName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">directory</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp"><span class="token function">GenFileNameDT</span><span class="token punctuation">(</span>FileModel<span class="token punctuation">.</span>FileNameFormat<span class="token punctuation">,</span>FileModel<span class="token punctuation">.</span>Extension<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
         <span class="token function">GenerateDirectoryDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">GenerateFileNameDT</span><span class="token punctuation">(</span>FileModel<span class="token punctuation">.</span>FileNameFormat<span class="token punctuation">,</span> FileModel<span class="token punctuation">.</span>Extension<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 公共方法</span>
     <span class="token comment">/// 生成日期目录路径</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GenerateDirectoryDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">//创建日期目录1</span>
         <span class="token class-name"><span class="token keyword">string</span></span> filePath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">FileModel<span class="token punctuation">.</span>Directory</span><span class="token punctuation">}</span></span><span class="token string">\\</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyy"</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
         Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">filePath</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//创建日期目录2</span>
         filePath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">filePath</span><span class="token punctuation">}</span></span><span class="token string">\\</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"yyyyMMdd"</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\\"</span></span><span class="token punctuation">;</span>
         Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">filePath</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//设置日期目录</span>
         FileModel<span class="token punctuation">.</span>DirectoryDT <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 生成日期文件名</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GenerateFileNameDT</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> timeFormat<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> extension<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         FileModel<span class="token punctuation">.</span>FileNameDT <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">FileModel<span class="token punctuation">.</span>DirectoryDT</span><span class="token punctuation">}</span></span><span class="token string">"</span></span> <span class="token operator">+</span>
             <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>timeFormat<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">extension</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 更新路径</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdatePath</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span></span> extension <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span></span> directory <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetDirectoryName</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
         FileModel<span class="token punctuation">.</span>Extension <span class="token operator">=</span> extension<span class="token punctuation">;</span>
         FileModel<span class="token punctuation">.</span>FileName <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
         FileModel<span class="token punctuation">.</span>Directory <span class="token operator">=</span> directory<span class="token punctuation">;</span>
         <span class="token function">GenerateDirectoryDT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">GenerateFileNameDT</span><span class="token punctuation">(</span>FileModel<span class="token punctuation">.</span>FileNameFormat<span class="token punctuation">,</span> FileModel<span class="token punctuation">.</span>Extension<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 生成文件名，根据时间格式和扩展名生成文件名</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GenFileNameDT</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> timeFormat<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> extension<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>FileModel<span class="token punctuation">.</span>FileNameFormat<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">FileModel<span class="token punctuation">.</span>Extension</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 添加外部数据</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddExternaalData</span><span class="token punctuation">(</span><span class="token class-name">ExternalDataService</span> dataModel<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         ExternalDatas<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
         DataID<span class="token operator">++</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 清空外部数据</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ClearExternalData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         ExternalDatas<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         DataID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 静态方法</span>
     <span class="token comment">/// 获取指定目录下的所有文件（*.json）</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetFiles</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> directory<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> files <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"*.Json"</span></span><span class="token punctuation">,</span> SearchOption<span class="token punctuation">.</span>AllDirectories<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> files<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 写入数据到文件：以追加的方式将数据写入到 JSON 文件，如果文件不存在，则创建一个新文件添加数据。</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AppendDataToJsonFile</span><span class="token punctuation">(</span><span class="token class-name">ChatDataModel</span> dataModel<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> datas<span class="token punctuation">;</span>
         <span class="token comment">/// 如果文件存在，读取现有数据</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">.</span>Uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name"><span class="token keyword">var</span></span> json <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllText</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">.</span>Uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
             datas <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">/// 如果文件不存在，创建一个空的列表</span>
         <span class="token keyword">else</span>
         <span class="token punctuation">{<!-- --></span>
             datas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">// 添加新数据</span>
         datas<span class="token punctuation">?.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">.</span>JsonModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 将更新后的数据写回文件</span>
         <span class="token class-name"><span class="token keyword">var</span></span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonSerializerOptions</span> <span class="token punctuation">{<!-- --></span> WriteIndented <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">var</span></span> updatedJson <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span>datas<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
         File<span class="token punctuation">.</span><span class="token function">WriteAllText</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">.</span>Uri<span class="token punctuation">,</span> updatedJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 读取Json文件中的数据</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> <span class="token function">ReadDataFormJsonFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> datas <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name"><span class="token keyword">var</span></span> json <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllText</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
             datas <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span> datas<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 检查文件扩展名</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">FileFilter</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name"><span class="token keyword">string</span></span> extension <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".txt"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".json"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".cs"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".xaml"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".js"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".css"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".cpp"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".c"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".py"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".xml"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".html"</span><span class="token punctuation">)</span>
          <span class="token operator">||</span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span>extension<span class="token punctuation">,</span> <span class="token string">".xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 检查文件扩展名是否与指定的扩展名匹配（不区分大小写）</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsFileOfType</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> extension<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> type<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">return</span> extension<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>OrdinalIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 获取文件是否为图像</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ImageFormat</span> <span class="token function">GetFileIsImage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">return</span> ImageFormatService<span class="token punctuation">.</span><span class="token function">GetImageFormat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 获取文件是否为文本类型</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">GetFileIsText</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">return</span> <span class="token function">FileFilter</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 获取文件类型</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ExternalDataType</span> <span class="token function">GetFileType</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">GetFileIsText</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">return</span> ExternalDataType<span class="token punctuation">.</span>Text<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">GetFileIsImage</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">return</span> ExternalDataType<span class="token punctuation">.</span>Image<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">return</span> ExternalDataType<span class="token punctuation">.</span>Unknown<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
 <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ExternalDataService_756">
     </a>
     ExternalDataService
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 外部数据对象：</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExternalDataService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token function">ExternalDataService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">ExternalDataService</span><span class="token punctuation">(</span><span class="token class-name">ExternalDataPreView</span> view<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>View <span class="token operator">=</span> view<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token comment">/// 外部数据预览视图模型</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ExternalDataPreViewModel<span class="token punctuation">?</span></span> ViewModel <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> View<span class="token punctuation">?.</span>ViewModel<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 外部数据预览视图</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ExternalDataPreView<span class="token punctuation">?</span></span> View <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 外部数据预览模型</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ExternalDataPreModel<span class="token punctuation">?</span></span> Model <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> ViewModel<span class="token punctuation">?.</span>Model<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 生成外部数据预览对象：1、索引、2、文件路径、3、点击事件回调</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ExternalDataService</span> <span class="token function">GeneratePreObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> index<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">,</span> <span class="token class-name">RoutedEventHandler</span> clickCallback<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建外部数据预览面板</span>
        <span class="token class-name">FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExternalDataPreView</span> preView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ExternalDataPreView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>Index <span class="token operator">=</span> index<span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>FileName <span class="token operator">=</span> filePath<span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>DataType <span class="token operator">=</span> DataService<span class="token punctuation">.</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>RemoveButton<span class="token punctuation">.</span>Tag <span class="token operator">=</span> preView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>Index<span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>Height <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span><span class="token function">SetImageSource</span><span class="token punctuation">(</span>DataService<span class="token punctuation">.</span><span class="token function">GetFileType</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>Tbx_Text<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>Tbx_Text<span class="token punctuation">.</span><span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>Tbx_Text<span class="token punctuation">.</span><span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"大小</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp"><span class="token function">FormatFileSize</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">.</span>Length<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preView<span class="token punctuation">.</span>RemoveButton<span class="token punctuation">.</span>Click <span class="token operator">+=</span> clickCallback<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ExternalDataService</span><span class="token punctuation">(</span>preView<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 文件大小格式</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">FormatFileSize</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">long</span></span> bytes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> sizes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"KB"</span><span class="token punctuation">,</span> <span class="token string">"MB"</span><span class="token punctuation">,</span> <span class="token string">"GB"</span><span class="token punctuation">,</span> <span class="token string">"TB"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> order <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>bytes <span class="token operator">&gt;=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> order <span class="token operator">&lt;</span> sizes<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            order<span class="token operator">++</span><span class="token punctuation">;</span>
            bytes <span class="token operator">=</span> bytes <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">bytes</span><span class="token format-string"><span class="token punctuation">:</span>0.##</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">sizes<span class="token punctuation">[</span>order<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ImageFormatService_803">
     </a>
     ImageFormatService
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImageFormatService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 判断图像的正确格式</span>
    <span class="token comment">/// 图像格式工具：获取正确的图像格式，通过图像文件的二进制头部图像格式标识。</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">ImageFormat</span> <span class="token function">GetImageFormat</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filePath<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 读取文件的前几个字节</span>
                <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> headerBytes <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">ReadBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 根据文件的前几个字节判断图像的实际格式</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsJpeg</span><span class="token punctuation">(</span>headerBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> ImageFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">;</span><span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsPng</span><span class="token punctuation">(</span>headerBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> ImageFormat<span class="token punctuation">.</span>Png<span class="token punctuation">;</span><span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsGif</span><span class="token punctuation">(</span>headerBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> ImageFormat<span class="token punctuation">.</span>Gif<span class="token punctuation">;</span><span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsBmp</span><span class="token punctuation">(</span>headerBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> ImageFormat<span class="token punctuation">.</span>Bmp<span class="token punctuation">;</span><span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// JPEG 文件的前两个字节是 0xFF, 0xD8</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsJpeg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> headerBytes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        
        <span class="token keyword">return</span> headerBytes<span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0xFF</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0xD8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// PNG 文件的前八个字节是固定的签名：137 80 78 71 13 10 26 10</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsPng</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> headerBytes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> headerBytes<span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">8</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">137</span>
                <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">80</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">78</span>
                <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">71</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">13</span>
                <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">26</span>
                <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// GIF 文件的前三个字节是 "GIF"</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsGif</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> headerBytes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> headerBytes<span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">71</span>
                <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">73</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">70</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// BMP 文件的前两个字节是 "BM"</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsBmp</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> headerBytes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> headerBytes<span class="token punctuation">.</span>Length <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">66</span><span class="token operator">&amp;&amp;</span> headerBytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">77</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="OllamaService_857">
     </a>
     OllamaService
    </h4>
    <pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OllamaService</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段|属性</span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段</span>
     <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> _connected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token comment">//连接状态</span>
     <span class="token keyword">private</span> <span class="token class-name">Chat</span> chat<span class="token punctuation">;</span>                      <span class="token comment">//构建交互式聊天模型对象。</span>
     <span class="token keyword">private</span> <span class="token class-name">OllamaApiClient</span> _ollama<span class="token punctuation">;</span>        <span class="token comment">//OllamaAPI对象</span>
     <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _selectModel<span class="token punctuation">;</span>            <span class="token comment">//选择的模型名称</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 属性</span>
     <span class="token comment">/// 连接状态</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Connected
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">get</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> _connected<span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token keyword">set</span> <span class="token punctuation">{<!-- --></span> _connected <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 选择的模型名称</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SelectModel <span class="token punctuation">{<!-- --></span> 
         <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _selectModel<span class="token punctuation">;</span>
         <span class="token keyword">set</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> _selectModel<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 _selectModel <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                 _ollama<span class="token punctuation">.</span>SelectedModel <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                 chat<span class="token punctuation">.</span>Model <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 构建交互式聊天模型对象。</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">Chat</span> Chat
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">get</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> chat<span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token keyword">set</span> <span class="token punctuation">{<!-- --></span> chat <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// OllamaAPI对象</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">OllamaApiClient</span> Ollama
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">get</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> _ollama<span class="token punctuation">;</span> <span class="token punctuation">}</span>
         <span class="token keyword">set</span> <span class="token punctuation">{<!-- --></span> _ollama <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 模型列表</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ObservableCollection<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> ModelList <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 构造函数</span>
     <span class="token keyword">public</span> <span class="token function">OllamaService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         ProcessService<span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token string">"ollama list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token string">"llama3.2:3b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 其他方法</span>
     <span class="token comment">/// 初始化方法</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Initialize</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">string</span></span> modelName<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">try</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token comment">// 设置默认设备为GPU</span>
             Environment<span class="token punctuation">.</span><span class="token function">SetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">"OLLAMA_DEFAULT_DEVICE"</span><span class="token punctuation">,</span> <span class="token string">"gpu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//连接Ollama，并设置初始模型</span>
             Ollama <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OllamaApiClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">"http://localhost:11434"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//获取本地可用的模型列表</span>
             ModelList <span class="token operator">=</span> <span class="token punctuation">(</span>ObservableCollection<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token function">GetModelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//遍历查找是否包含llama3.2:3b模型</span>
             <span class="token class-name"><span class="token keyword">var</span></span> tmepModelName <span class="token operator">=</span> ModelList<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>name <span class="token operator">=&gt;</span> name<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"llama3.2:3b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//设置的模型不为空</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>tmepModelName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 Ollama<span class="token punctuation">.</span>SelectedModel <span class="token operator">=</span> tmepModelName<span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token comment">//模型列表不为空</span>
             <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ModelList<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 _ollama<span class="token punctuation">.</span>SelectedModel <span class="token operator">=</span> ModelList<span class="token punctuation">[</span>ModelList<span class="token punctuation">.</span>Count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token comment">//Ollama服务启用成功</span>
             chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Chat</span><span class="token punctuation">(</span>_ollama<span class="token punctuation">)</span><span class="token punctuation">;</span>
             SelectModel <span class="token operator">=</span> _ollama<span class="token punctuation">.</span>SelectedModel<span class="token punctuation">;</span>
             _connected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             _connected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>     <span class="token comment">//Ollama服务启用失败</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 获取模型里列表</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">Collection<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetModelList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name"><span class="token keyword">var</span></span> models <span class="token operator">=</span> _ollama<span class="token punctuation">.</span><span class="token function">ListLocalModelsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">var</span></span> modelList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObservableCollection<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> model <span class="token keyword">in</span> models<span class="token punctuation">.</span>Result<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             modelList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> modelList<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 创建新的聊天对象</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateNewChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">try</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name"><span class="token keyword">var</span></span> version <span class="token operator">=</span> _ollama<span class="token punctuation">.</span><span class="token function">GetVersionAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>version<span class="token punctuation">?.</span>Result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Chat</span><span class="token punctuation">(</span>_ollama<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 Connected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">else</span>
             <span class="token punctuation">{<!-- --></span>
                 chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Chat</span><span class="token punctuation">(</span>_ollama<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 Connected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             Connected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
 <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ProcessService_983">
     </a>
     ProcessService
    </h4>
    <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> command<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	    <span class="token comment">// 创建一个新的进程启动信息</span>
	    <span class="token class-name">ProcessStartInfo</span> processStartInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProcessStartInfo</span>
	    <span class="token punctuation">{<!-- --></span>
	        FileName <span class="token operator">=</span> <span class="token string">"cmd.exe"</span><span class="token punctuation">,</span>           <span class="token comment">// 设置要启动的程序为cmd.exe</span>
	        Arguments <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"/C </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">command</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>    <span class="token comment">// 设置要执行的命令</span>
	        UseShellExecute <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>         <span class="token comment">// 使用操作系统shell启动进程</span>
	        CreateNoWindow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>         <span class="token comment">//不创建窗体</span>
	    <span class="token punctuation">}</span><span class="token punctuation">;</span>
	    <span class="token keyword">try</span>
	    <span class="token punctuation">{<!-- --></span>
	        <span class="token class-name">Process</span> process <span class="token operator">=</span> Process<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>processStartInfo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 启动进程</span>
	        process<span class="token punctuation">.</span><span class="token function">WaitForExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 等待进程退出</span>
	        process<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 返回是否成功执行</span>
	        <span class="token keyword">return</span> process<span class="token punctuation">.</span>ExitCode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
	    <span class="token punctuation">{<!-- --></span>
	        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"发生错误: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ex<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 其他异常处理</span>
	        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h3>
     <a id="ViewModels_1014">
     </a>
     ViewModels目录
    </h3>
    <h5>
     <a id="OfflineViewModels_1015">
     </a>
     命名空间：Offline.ViewModels
    </h5>
    <h4>
     <a id="ChatRecordListViewModel_1016">
     </a>
     ChatRecordListViewModel
    </h4>
    <pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatRecordListViewModel</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段、属性</span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段</span>
     <span class="token comment">/// 聊天记录集合：</span>
     <span class="token keyword">private</span> <span class="token class-name">ObservableCollection<span class="token punctuation">&lt;</span>ChatDataModel<span class="token punctuation">&gt;</span></span> _chatRecordCollection<span class="token punctuation">;</span>
     <span class="token comment">/// 文件侦听</span>
     <span class="token keyword">private</span> <span class="token class-name">FileSystemWatcher</span> FileWatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileSystemWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 属性</span>
     <span class="token comment">/// 聊天记录集合</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ObservableCollection<span class="token punctuation">&lt;</span>ChatDataModel<span class="token punctuation">&gt;</span></span> ChatRecordCollection
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _chatRecordCollection<span class="token punctuation">;</span>
         <span class="token keyword">set</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>_chatRecordCollection <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 _chatRecordCollection <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                 <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 事件：加载聊天记录</span>
     <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> LoadChatRecordEventHandler<span class="token punctuation">;</span>
     <span class="token comment">/// 聊天记录鼠标点击事件</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> ChatRecordMouseDownCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 构造函数、初始化方法</span>
     <span class="token keyword">public</span> <span class="token function">ChatRecordListViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token operator">~</span><span class="token function">ChatRecordListViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token function">StopFileWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token comment">/// 初始化</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         ChatRecordMouseDownCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RelayCommand</span><span class="token punctuation">(</span>OnChatRecordMouseDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">LoadChatRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">StartFileWatcher</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory</span><span class="token punctuation">}</span></span><span class="token string">\\Record"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 菜单项鼠标按下:删除文件</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMenuItemMouseDown</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">is</span> <span class="token class-name"><span class="token keyword">string</span></span> uri<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             File<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
             Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"删除记录：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">uri</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 命令方法</span>
     <span class="token comment">/// 事件：聊天记录鼠标按下:</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnChatRecordMouseDown</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> args<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>args <span class="token keyword">is</span> <span class="token class-name">MouseButtonEventArgs</span> mouseDown<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>mouseDown<span class="token punctuation">.</span>ChangedButton <span class="token operator">==</span> MouseButton<span class="token punctuation">.</span>Left<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>mouseDown<span class="token punctuation">.</span>Source <span class="token keyword">is</span> <span class="token class-name">TextBlock</span> textBlock<span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>textBlock<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token function">OnLoadChatRecordCallBack</span><span class="token punctuation">(</span>textBlock<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>mouseDown<span class="token punctuation">.</span>ChangedButton <span class="token operator">==</span> MouseButton<span class="token punctuation">.</span>Right<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>mouseDown<span class="token punctuation">.</span>Source <span class="token keyword">is</span> <span class="token class-name">TextBlock</span> textBlock<span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>textBlock<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 其他方法</span>
     <span class="token comment">/// 加载聊天记录:</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadChatRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name"><span class="token keyword">string</span></span> directory <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory</span><span class="token punctuation">}</span></span><span class="token string">\\Record"</span></span><span class="token punctuation">;</span>
         <span class="token class-name">ObservableCollection<span class="token punctuation">&lt;</span>ChatDataModel<span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObservableCollection<span class="token punctuation">&lt;</span>ChatDataModel<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ChatRecordCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObservableCollection<span class="token punctuation">&lt;</span>ChatDataModel<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> files <span class="token operator">=</span> DataService<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> file <span class="token keyword">in</span> files<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span> 
             <span class="token class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> datas <span class="token operator">=</span> DataService<span class="token punctuation">.</span><span class="token function">ReadDataFormJsonFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>datas <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token class-name">ChatDataModel</span> dataModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatDataModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 dataModel<span class="token punctuation">.</span>JsonModel <span class="token operator">=</span> datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//Json数据</span>
                 dataModel<span class="token punctuation">.</span>Uri <span class="token operator">=</span> file<span class="token punctuation">;</span>               <span class="token comment">//加载链接           </span>
                 dataModel<span class="token punctuation">.</span>MenuItemMouseDownCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RelayCommand</span><span class="token punctuation">(</span>OnMenuItemMouseDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 records<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Content<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//排序：按时间排序</span>
         <span class="token class-name"><span class="token keyword">var</span></span> sortDatas <span class="token operator">=</span> records<span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ChatDataModel</span> dataModel <span class="token keyword">in</span> sortDatas<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             ChatRecordCollection<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
             Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">dataModel<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Date</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 开始文件侦听</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StartFileWatcher</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> directory<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         FileWatcher<span class="token punctuation">.</span>Path <span class="token operator">=</span> directory<span class="token punctuation">;</span>
         FileWatcher<span class="token punctuation">.</span>Filter <span class="token operator">=</span> <span class="token string">"*.json"</span><span class="token punctuation">;</span>
         FileWatcher<span class="token punctuation">.</span>IncludeSubdirectories <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         FileWatcher<span class="token punctuation">.</span>Created <span class="token operator">+=</span> OnCreated<span class="token punctuation">;</span>       <span class="token comment">// 侦听文件创建事件</span>
         FileWatcher<span class="token punctuation">.</span>Deleted <span class="token operator">+=</span> OnDeleted<span class="token punctuation">;</span>       <span class="token comment">// 侦听文件删除事件</span>
         FileWatcher<span class="token punctuation">.</span>EnableRaisingEvents <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 开始侦听</span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"开始侦听目录: "</span> <span class="token operator">+</span> directory<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// &lt;summary&gt;</span>
     <span class="token comment">/// 停止文件侦听</span>
     <span class="token comment">/// &lt;/summary&gt;</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StopFileWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         FileWatcher<span class="token punctuation">.</span>EnableRaisingEvents <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 停止侦听</span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"停止侦听目录: "</span> <span class="token operator">+</span> FileWatcher<span class="token punctuation">.</span>Path<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 事件方法</span>
     <span class="token comment">/// 触发回调：加载聊天记录：</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnLoadChatRecordCallBack</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> args<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         LoadChatRecordEventHandler<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 注册回调：1、LoadChatRecordEventHandler事件</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterCallBack</span><span class="token punctuation">(</span><span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         LoadChatRecordEventHandler <span class="token operator">+=</span> action<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 取消注册回调 1、LoadChatRecordEventHandler事件</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UnRegisterCallBack</span><span class="token punctuation">(</span><span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         LoadChatRecordEventHandler <span class="token operator">-=</span> action<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 文件创建事件处理程序：</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCreated</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">FileSystemEventArgs</span> e<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"文件已创建: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">e<span class="token punctuation">.</span>FullPath</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">OnFileChanged</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>FullPath<span class="token punctuation">,</span> FileChangeType<span class="token punctuation">.</span>Created<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 事件：文件删除事件</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDeleted</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">FileSystemEventArgs</span> e<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"文件已删除: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">e<span class="token punctuation">.</span>FullPath</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">OnFileChanged</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>FullPath<span class="token punctuation">,</span> FileChangeType<span class="token punctuation">.</span>Deleted<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 事件：触发文件变更事件。</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnFileChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> fileName<span class="token punctuation">,</span> <span class="token class-name">FileChangeType</span> options<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">==</span> FileChangeType<span class="token punctuation">.</span>Created<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> datas <span class="token operator">=</span> DataService<span class="token punctuation">.</span><span class="token function">ReadDataFormJsonFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">///读取Json文件中的数据</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>datas <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token class-name">ChatDataModel</span> dataModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatDataModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 dataModel<span class="token punctuation">.</span>JsonModel <span class="token operator">=</span> datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 dataModel<span class="token punctuation">.</span>Uri <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
                 <span class="token comment">//使用线程异步删除</span>
                 Application<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                 <span class="token punctuation">{<!-- --></span>
                     ChatRecordCollection<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dataModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>datas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Content<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//执行移除操作</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">==</span> FileChangeType<span class="token punctuation">.</span>Deleted<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token comment">//使用线程异步删除</span>
             Application<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
             <span class="token punctuation">{<!-- --></span>
                 ChatRecordCollection<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>ChatRecordCollection<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj<span class="token punctuation">.</span>Uri<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
 <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="External_1206">
     </a>
     External
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// 外部数据预览视图模型： 1、 根据文件类型设置预览图标。</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExternalDataPreViewModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">ExternalDataPreModel</span> _model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ExternalDataPreModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ExternalDataPreModel</span> Model 
    <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span>_model<span class="token punctuation">;</span>  
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_model <span class="token operator">==</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _model <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">ExternalDataPreViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Model<span class="token punctuation">.</span>ImageSource <span class="token operator">=</span> <span class="token string">"/Views/Resources/text-file-blue-64.png"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 根据文件类型设置图像源</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetImageSource</span><span class="token punctuation">(</span><span class="token class-name">ExternalDataType</span> fileType<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>fileType<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> ExternalDataType<span class="token punctuation">.</span>Text<span class="token punctuation">:</span>
                Model<span class="token punctuation">.</span>ImageSource <span class="token operator">=</span> <span class="token string">"/Views/Resources/text-file-blue-64.png"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> ExternalDataType<span class="token punctuation">.</span>Image<span class="token punctuation">:</span>
                Model<span class="token punctuation">.</span>ImageSource <span class="token operator">=</span> <span class="token string">"/Views/Resources/image-file-blue-64.png"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                Model<span class="token punctuation">.</span>ImageSource <span class="token operator">=</span> <span class="token string">"/Views/Resources/unknown-red-64.png"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="MainViewModel_1249">
     </a>
     MainViewModel
    </h4>
    <pre><code class="prism language-csharp"><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 主窗体视图模型：</span>
<span class="token comment">/// 作者：吾与谁归</span>
<span class="token comment">/// 时间：2025年02月17日（首次创建时间）</span>
<span class="token comment">/// 功能: </span>
<span class="token comment">/// 版本version: 1.0</span>
<span class="token comment">///     1、2025-02-17：添加折叠栏展开|折叠功能。</span>
<span class="token comment">///     2、2025-02-17：添加视图切换功能 1）系统设置 2) 聊天</span>
<span class="token comment">///     3、2025-02-18：添加窗体关闭时提示。</span>
<span class="token comment">///     4、2025-02-19：添加首页功能、修改新聊天功能。点击首页显示当前聊天，点击新聊天会创建新的会话（Chat）。</span>
<span class="token comment">///     5、2025-02-20：添加窗体加载时传递Ollama对象功能。</span>
<span class="token comment">///     6、2025-02-24：添加窗体加载时，加载聊天记录的功能。</span>
<span class="token comment">///     7、2025-02-28：修复创建新对话后，无法查看记录的问题。</span>
<span class="token comment">/// 版本version: 1.1~1.4</span>
<span class="token comment">///     1、2025-03-01：优化了类结构，创建对应的Model(MainWindowModel),将所有字段、属性移到Model。</span>
<span class="token comment">///     2、2025-03-01：新增聊天记录窗体，修改了窗体加载时，加载聊天记录的功能。将其移动到了ChatRecordListView，在其视图模型中实现。</span>
<span class="token comment">///     2、2025-03-10：移除了折叠栏功能，更新为Grid区域的显示与隐藏 </span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段、属性、命令</span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段</span>
    <span class="token comment">/// 主窗体模型对象</span>
    <span class="token keyword">private</span> <span class="token class-name">MainWindowModel</span> _mainModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MainWindowModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 属性</span>
    <span class="token comment">///  获取聊天记录视图对象</span>
    <span class="token keyword">private</span> <span class="token return-type class-name">ChatRecordListView<span class="token punctuation">?</span></span> GetChatRecordView
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> MainModel<span class="token punctuation">.</span>ExpandedBarView <span class="token keyword">as</span> <span class="token class-name">ChatRecordListView</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 主窗体模型对象</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">MainWindowModel</span> MainModel 
    <span class="token punctuation">{<!-- --></span> 
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _mainModel<span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_mainModel <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _mainModel <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 命令属性</span>
    <span class="token comment">/// 折叠功能菜单命令</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> ExpandedMenuCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 切换视图命令</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> SwitchViewCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 窗体关闭命令</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> ClosingWindowCommand <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">/// 窗体加载命令</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> LoadedWindowCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 构造函数</span>
    <span class="token keyword">public</span> <span class="token function">MainViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 初始化方法</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//初始化Ollama</span>
        MainModel<span class="token punctuation">.</span>Ollama <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OllamaService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        MainModel<span class="token punctuation">.</span>ModelListCollection <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>ModelList<span class="token punctuation">;</span>
        MainModel<span class="token punctuation">.</span>SelectedModel <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>SelectModel<span class="token punctuation">;</span>
        <span class="token comment">//创建命令</span>
        SwitchViewCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterCommand</span><span class="token punctuation">(</span>OnSwitchView<span class="token punctuation">)</span><span class="token punctuation">;</span>
        LoadedWindowCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnLoadedWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ClosingWindowCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnClosingWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ExpandedMenuCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnExpandedMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化视图集合</span>
        MainModel<span class="token punctuation">.</span>ViewCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObservableCollection<span class="token punctuation">&lt;</span>UserControl<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加视图到集合</span>
        MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SystemSettingView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserChatView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//默认显示视图</span>
        MainModel<span class="token punctuation">.</span>CurrentView <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//设置折叠栏显示视图</span>
        MainModel<span class="token punctuation">.</span>ExpandedBarView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatRecordListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取聊天视图对象 //注册事件回调</span>
        GetChatRecordView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span><span class="token function">RegisterCallBack</span><span class="token punctuation">(</span><span class="token generic-method"><span class="token function">GetUserControl</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserChatView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>LoadChatRecordCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//折叠栏折叠状态</span>
        MainModel<span class="token punctuation">.</span>ExpandedBarWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 命令方法</span>
    <span class="token comment">/// 触发主视图窗体加载方法：窗体加载时传递Ollama对象</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnLoadedWindow</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>obj<span class="token punctuation">?.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> userView <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetUserControl</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserChatView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>ChatModel<span class="token punctuation">.</span>Ollama <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 触发关闭窗体方法</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnClosingWindow</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">is</span> <span class="token class-name">CancelEventArgs</span> cancelEventArgs<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"确定要关闭程序吗？"</span><span class="token punctuation">,</span> <span class="token string">"确认关闭"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>YesNo<span class="token punctuation">)</span> <span class="token operator">==</span> MessageBoxResult<span class="token punctuation">.</span>No<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>cancelEventArgs<span class="token punctuation">.</span>Cancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 取消关闭}</span>
            <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span><span class="token function">ClearResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 视图切换命令触发的方法</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSwitchView</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token string">"SystemSettingView"</span><span class="token punctuation">:</span>
                MainModel<span class="token punctuation">.</span>CurrentView <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"UserChatView"</span><span class="token punctuation">:</span>
                MainModel<span class="token punctuation">.</span>CurrentView <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"NewUserChatView"</span><span class="token punctuation">:</span> <span class="token comment">//新建聊天窗体</span>
                <span class="token function">NewChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 折叠菜单功能</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnExpandedMenu</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>MainModel<span class="token punctuation">.</span>ExpandedMenuIsHide <span class="token operator">==</span> Visibility<span class="token punctuation">.</span>Visible<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            MainModel<span class="token punctuation">.</span>ExpandedMenuIsHide <span class="token operator">=</span> Visibility<span class="token punctuation">.</span>Hidden<span class="token punctuation">;</span>
            MainModel<span class="token punctuation">.</span>ExpandedBarWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            MainModel<span class="token punctuation">.</span>ExpandedMenuIsHide <span class="token operator">=</span> Visibility<span class="token punctuation">.</span>Visible<span class="token punctuation">;</span>
            MainModel<span class="token punctuation">.</span>ExpandedBarWidth <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
    <span class="token preprocessor property">#<span class="token directive keyword">region</span> 其他方法</span>
    <span class="token comment">/// 获取用户控件视图：获取集合中的视图对象</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">T<span class="token punctuation">?</span></span> <span class="token generic-method"><span class="token function">GetUserControl</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">UserControl</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj <span class="token keyword">is</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">T</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// 释放资源：窗体关闭时触发</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ClearResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token comment">/// 新建聊天窗体</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NewChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">var</span></span> view <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetUserControl</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserChatView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserChatView</span> newChatView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserChatView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//取消注册的回调</span>
       GetChatRecordView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span><span class="token function">UnRegisterCallBack</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>LoadChatRecordCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//给当前对象注册回调GetChatRecordView.ViewModel.RegisterCallBack(newChatView.ViewModel.LoadChatRecordCallback);</span>
        <span class="token comment">//创建新的Chat对象并初始化数据</span>
        MainModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span><span class="token function">CreateNewChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newChatView<span class="token punctuation">.</span>ViewModel<span class="token punctuation">.</span>ChatModel<span class="token punctuation">.</span>Ollama <span class="token operator">=</span> MainModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">;</span>
        MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        MainModel<span class="token punctuation">.</span>ViewCollection<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> newChatView<span class="token punctuation">;</span>
        MainModel<span class="token punctuation">.</span>CurrentView <span class="token operator">=</span> newChatView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="UserChatViewModel_1418">
     </a>
     UserChatViewModel
    </h4>
    <pre><code class="prism language-csharp"> <span class="token comment">/// &lt;summary&gt;</span>
 <span class="token comment">/// 描述：用户聊天视图模型：</span>
 <span class="token comment">/// 作者：吾与谁归</span>
 <span class="token comment">/// 时间: 2025年2月19日</span>
 <span class="token comment">/// 功能：</span>
 <span class="token comment">/// 版本version: 1.0</span>
 <span class="token comment">///    1、 2025-02-19：添加了AI聊天功能，输出问题及结果到UI,并使用Markdown相关的库做简单渲染。</span>
 <span class="token comment">///    2、 2025-02-20：优化了构造函数，使用无参构造，方便在设计器中直接绑定数据上下文（感觉）。</span>
 <span class="token comment">///    3、 2025-02-20：添加了滑动查看内容（自动滚动，鼠标滚动）。</span>
 <span class="token comment">///    4、 2025-02-24：添加了聊天记录保存功能。</span>
 <span class="token comment">///    5、 2025-02-24：添加了聊天记录加载功能，通过点击记录列表显示。</span>
 <span class="token comment">/// 版本version: 1.1</span>
 <span class="token comment">///    1、 2025-03-01：添加了根据聊天记录回复的功能。</span>
 <span class="token comment">///    2、 2025-03-01：添加了UserChatViewModel对应Model,将字段、属性移到Model中，方便后续扩展。</span>
 <span class="token comment">///    3、 2025-03-05：新增读取外部数据回复问题功能，目前支持txt文件。</span>
 <span class="token comment">///    4、 2025-03-05：新增添加图片提问题功能，模型需要支持视觉（如：minicpm-v:latest）。</span>
 <span class="token comment">/// &lt;/summary&gt;</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserChatViewModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">PropertyChangedBase</span></span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段、属性、命令</span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 字段</span>
     <span class="token keyword">private</span> <span class="token class-name">MarkdownViewer</span> _markdownViewer<span class="token punctuation">;</span>                     <span class="token comment">//MarkdownViewer控件</span>
     <span class="token keyword">private</span> <span class="token class-name">ScrollViewer</span> scrollViewer<span class="token punctuation">;</span>                          <span class="token comment">//ScrollViewer滑动控件</span>
     <span class="token keyword">private</span> <span class="token class-name">WrapPanel</span> wrapPanel<span class="token punctuation">;</span>                                <span class="token comment">//水平排序容器</span>
     <span class="token keyword">private</span> <span class="token class-name">CancellationTokenSource<span class="token punctuation">?</span></span> _cts_ChatThread<span class="token punctuation">;</span>           <span class="token comment">//聊天异步线程：取消标记</span>
     <span class="token keyword">private</span> <span class="token class-name">CancellationTokenSource<span class="token punctuation">?</span></span> _cts_MessageQueue<span class="token punctuation">;</span>         <span class="token comment">//消息异步线程：取消标记</span>
     <span class="token keyword">private</span> <span class="token class-name">ConcurrentQueue<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> _messageQueue<span class="token punctuation">;</span>              <span class="token comment">//消息异步线程：消息队列</span>
     <span class="token comment">//自定义</span>
     <span class="token keyword">private</span> <span class="token class-name">DataService</span> _userDataService<span class="token punctuation">;</span>                       <span class="token comment">//聊天数据服务</span>
     <span class="token keyword">private</span> <span class="token class-name">UserChatModel</span> _chatModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserChatModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//用户聊天模型</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 属性</span>
     <span class="token comment">/// 聊天数据服务</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">DataService</span> UserDataService 
     <span class="token punctuation">{<!-- --></span> 
         <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _userDataService<span class="token punctuation">;</span> 
         <span class="token keyword">private</span> <span class="token keyword">set</span> <span class="token operator">=&gt;</span> _userDataService <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span>
     <span class="token comment">/// 用户聊天模型</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">UserChatModel</span> ChatModel
     <span class="token punctuation">{<!-- --></span> 
         <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _chatModel<span class="token punctuation">;</span>
         <span class="token keyword">set</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>_chatModel <span class="token operator">!=</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 _chatModel <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
                 <span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 命令</span>
     <span class="token comment">/// 展开功能菜单命令</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> SelecteAddFileCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 提交命令</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> SubmitQuestionCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 鼠标滚动</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> MouseWheelCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 鼠标按下</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> MouseDownCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// Markdown对象命令</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> MarkdownOBJCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 滑动条加载</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> ScrollLoadedCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token comment">/// 外部数据面板加载</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">ICommand</span> ExternalDataPanelLoadedCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 构造函数</span>
     <span class="token keyword">public</span> <span class="token function">UserChatViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 初始化方法</span>
     <span class="token comment">/// 初始化方法</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">//初始化命令</span>
         SelecteAddFileCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterCommand</span><span class="token punctuation">(</span>OnSelecteAddFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
         MouseWheelCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span>MouseWheelEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnMouseWheel<span class="token punctuation">)</span><span class="token punctuation">;</span>
         MouseDownCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span>MouseButtonEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnMouseDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
         MarkdownOBJCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnMarkdownOBJ<span class="token punctuation">)</span><span class="token punctuation">;</span>
         SubmitQuestionCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ParameterlessCommand</span><span class="token punctuation">(</span>OnSubmitQuestion<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ScrollLoadedCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span>RoutedEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnScrollLoaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ExternalDataPanelLoadedCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventsCommand<span class="token punctuation">&lt;</span>RoutedEventArgs<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>OnExternalDataPanelLoaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//按钮名称</span>
         ChatModel<span class="token punctuation">.</span>SubmitButtonName <span class="token operator">=</span> <span class="token string">"提交"</span><span class="token punctuation">;</span>
         <span class="token comment">//聊天记录</span>
         ChatModel<span class="token punctuation">.</span>Directory <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory</span><span class="token punctuation">}</span></span><span class="token string">\\Record\\"</span></span><span class="token punctuation">;</span>
         UserDataService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataService</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ChatModel<span class="token punctuation">.</span>Directory</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         ChatModel<span class="token punctuation">.</span>FileName <span class="token operator">=</span> UserDataService<span class="token punctuation">.</span>FileModel<span class="token punctuation">.</span>FileNameDT<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">///  水平排列容器加载</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnExternalDataPanelLoaded</span><span class="token punctuation">(</span><span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>Source <span class="token keyword">is</span> <span class="token class-name">WrapPanel</span> wrapP<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             wrapPanel <span class="token operator">=</span> wrapP<span class="token punctuation">;</span>
             Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"wrapPanel loaded..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 命令方法</span>
     <span class="token comment">/// 加载文件:选择添加文件，最多添加10个文件</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSelecteAddFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name">OpenFileDialog</span> openFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenFileDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         openFile<span class="token punctuation">.</span>Filter <span class="token operator">=</span> <span class="token string">"(*.txt;*,png;*.jpg;*.jpeg;*.bmp)|*.txt;*.png;*.jpg;*.jpeg;*.bmp|(*.png)|*.png|(*.*)|*.*"</span><span class="token punctuation">;</span>
         openFile<span class="token punctuation">.</span>Multiselect <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>openFile<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> files <span class="token operator">=</span> openFile<span class="token punctuation">.</span>FileNames<span class="token punctuation">;</span>
             <span class="token comment">//多个文件时创建外部数据</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 wrapPanel<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> file <span class="token keyword">in</span> files<span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>UserDataService<span class="token punctuation">.</span>ExternalDataCount <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span>
                     <span class="token punctuation">{<!-- --></span>
                         <span class="token class-name">ExternalDataService</span> dataObj <span class="token operator">=</span> ExternalDataService<span class="token punctuation">.</span><span class="token function">GeneratePreObject</span><span class="token punctuation">(</span>UserDataService<span class="token punctuation">.</span>DataID<span class="token punctuation">,</span> file<span class="token punctuation">,</span> BtnRemoveControl_Click<span class="token punctuation">)</span><span class="token punctuation">;</span>
                         UserDataService<span class="token punctuation">.</span><span class="token function">AddExternaalData</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                         wrapPanel<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">.</span>View<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
             <span class="token comment">//单个文件时创建外部数据</span>
             <span class="token keyword">else</span>
             <span class="token punctuation">{<!-- --></span>
                 Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>openFile<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>UserDataService<span class="token punctuation">.</span>ExternalDataCount <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     <span class="token class-name">ExternalDataService</span> dataObj <span class="token operator">=</span> ExternalDataService<span class="token punctuation">.</span><span class="token function">GeneratePreObject</span><span class="token punctuation">(</span>UserDataService<span class="token punctuation">.</span>DataID<span class="token punctuation">,</span> openFile<span class="token punctuation">.</span>FileName<span class="token punctuation">,</span> BtnRemoveControl_Click<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     UserDataService<span class="token punctuation">.</span><span class="token function">AddExternaalData</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     wrapPanel<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dataObj<span class="token punctuation">.</span>View<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 提交:  提交问题到AI并获取返回结果</span>
     <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSubmitQuestion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         _ <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span></span> input <span class="token operator">=</span> ChatModel<span class="token punctuation">.</span>InputText<span class="token punctuation">;</span>
         <span class="token class-name">ChatDataModel</span> chatData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatDataModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         chatData<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Role <span class="token operator">=</span> <span class="token string">"User"</span><span class="token punctuation">;</span>         
         chatData<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Content <span class="token operator">=</span> input<span class="token punctuation">;</span>
         chatData<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span></span> appendText <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">string</span></span> tempText <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
         <span class="token keyword">try</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">SubmintChecked</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token comment">//直接回答完成：设置输入框为空，不自动滚动，按钮名称，按钮使能</span>
                 ChatModel<span class="token punctuation">.</span>IsAutoScrolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                 <span class="token function">OnStopCurrentChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 ChatModel<span class="token punctuation">.</span>SubmitButtonName <span class="token operator">=</span> <span class="token string">"提交"</span><span class="token punctuation">;</span>
                 <span class="token keyword">return</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             ChatModel<span class="token punctuation">.</span>SubmitButtonName <span class="token operator">=</span> <span class="token string">"停止"</span><span class="token punctuation">;</span>
             ChatModel<span class="token punctuation">.</span>IsAutoScrolling <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"##</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"### [</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">chatData<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Date</span><span class="token punctuation">}</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"# 【User】</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"**</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">chatData<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Content</span><span class="token punctuation">}</span></span><span class="token string">**</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"---</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             scrollViewer<span class="token punctuation">.</span><span class="token function">ScrollToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> imageBase64 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
             <span class="token class-name"><span class="token keyword">int</span></span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
             <span class="token comment">//加载文本|图像文件数据</span>
             <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> data <span class="token keyword">in</span> UserDataService<span class="token punctuation">.</span>ExternalDatas<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token comment">//加载图像数据</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>DataType <span class="token operator">==</span> ExternalDataType<span class="token punctuation">.</span>Image<span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     <span class="token class-name">OllamaSharp<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Message</span> externalMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OllamaSharp<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     imageBase64 <span class="token operator">=</span> <span class="token function">ConvertImageToBase64IEnumerable</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     externalMessage<span class="token punctuation">.</span>Role <span class="token operator">=</span> ChatRole<span class="token punctuation">.</span>User<span class="token punctuation">;</span>
                     externalMessage<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"这是第</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">index<span class="token operator">++</span></span><span class="token punctuation">}</span></span><span class="token string">张图像，如果用户问到，那么可能是这张！"</span></span><span class="token punctuation">;</span>
                     externalMessage<span class="token punctuation">.</span>Images <span class="token operator">=</span> imageBase64<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     ChatModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>externalMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token class-name"><span class="token keyword">string</span></span> ImageUri <span class="token operator">=</span> <span class="token string">"![Local Image](file:///"</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
                     appendText <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ImageUri</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
                     <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ImageUri</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
                 <span class="token comment">//加载文本数据</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>DataType <span class="token operator">==</span> ExternalDataType<span class="token punctuation">.</span>Text<span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     <span class="token class-name">OllamaSharp<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Message</span> externalMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OllamaSharp<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     externalMessage<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"$\"文件名{<!-- -->{Path.GetFileName(data.FileName)}},以下是这一份文件内容:如果用户有问到文件，可能是这些内容：\\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">File<span class="token punctuation">.</span><span class="token function">ReadAllText</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
                     externalMessage<span class="token punctuation">.</span>Role <span class="token operator">=</span> ChatRole<span class="token punctuation">.</span>User<span class="token punctuation">;</span>
                     ChatModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>externalMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"## 【AI】</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//异步获取AI回答</span>
             _cts_ChatThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             _cts_MessageQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             _messageQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConcurrentQueue<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">await</span> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> answerToken <span class="token keyword">in</span> ChatModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> imageBase64<span class="token punctuation">,</span> _cts_ChatThread<span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>answerToken<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span> <span class="token operator">||</span> answerToken<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>answerToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
                 appendText <span class="token operator">+=</span> answerToken<span class="token punctuation">;</span>
                 <span class="token function">AppendText</span><span class="token punctuation">(</span>answerToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>ChatModel<span class="token punctuation">.</span>IsAutoScrolling<span class="token punctuation">)</span> scrollViewer<span class="token punctuation">.</span><span class="token function">ScrollToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否自动滚动</span>
             <span class="token punctuation">}</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             chatData<span class="token punctuation">.</span>JsonModel<span class="token punctuation">.</span>Result <span class="token operator">=</span> appendText<span class="token punctuation">;</span>
             <span class="token comment">//创建聊天数据模型，保存记录</span>
             chatData<span class="token punctuation">.</span>Uri <span class="token operator">=</span> UserDataService<span class="token punctuation">.</span>FileModel<span class="token punctuation">.</span>FileNameDT<span class="token punctuation">;</span>
             DataService<span class="token punctuation">.</span><span class="token function">AppendDataToJsonFile</span><span class="token punctuation">(</span>chatData<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//提交回答完后清空外部数据</span>
             wrapPanel<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
             UserDataService<span class="token punctuation">.</span><span class="token function">ClearExternalData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Error: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">ex<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//回答完成：设置输入框为空，不自动滚动，按钮名称</span>
         ChatModel<span class="token punctuation">.</span>InputText <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
         ChatModel<span class="token punctuation">.</span>IsAutoScrolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         ChatModel<span class="token punctuation">.</span>SubmitButtonName <span class="token operator">=</span> <span class="token string">"提交"</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 停止当前聊天</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStopCurrentChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         _cts_ChatThread<span class="token punctuation">?.</span><span class="token function">CancelAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         _cts_MessageQueue<span class="token punctuation">?.</span><span class="token function">CancelAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"-----------取消提问------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 鼠标滚动上下滑动</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMouseWheel</span><span class="token punctuation">(</span><span class="token class-name">MouseWheelEventArgs</span> e<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">try</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Source <span class="token keyword">is</span> <span class="token class-name">FrameworkElement</span> element <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>Parent <span class="token keyword">is</span> <span class="token class-name">ScrollViewer</span> scrollViewer<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token class-name"><span class="token keyword">double</span></span> currentOffset <span class="token operator">=</span> scrollViewer<span class="token punctuation">.</span>VerticalOffset<span class="token punctuation">;</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Delta <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                 <span class="token punctuation">{<!-- --></span>
                     scrollViewer<span class="token punctuation">.</span><span class="token function">ScrollToVerticalOffset</span><span class="token punctuation">(</span>currentOffset <span class="token operator">-</span> e<span class="token punctuation">.</span>Delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
                 <span class="token keyword">else</span>
                 <span class="token punctuation">{<!-- --></span>
                     scrollViewer<span class="token punctuation">.</span><span class="token function">ScrollToVerticalOffset</span><span class="token punctuation">(</span>currentOffset <span class="token operator">-</span> e<span class="token punctuation">.</span>Delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
                 e<span class="token punctuation">.</span>Handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 标记事件已处理，防止默认滚动行为</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// Markdown中鼠标按下</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMouseDown</span><span class="token punctuation">(</span><span class="token class-name">MouseButtonEventArgs</span> args<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>LeftButton <span class="token operator">==</span> MouseButtonState<span class="token punctuation">.</span>Pressed<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             ChatModel<span class="token punctuation">.</span>IsAutoScrolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
             Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"Mouse Down..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 滚动栏触发</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnScrollLoaded</span><span class="token punctuation">(</span><span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>Source <span class="token keyword">is</span> <span class="token class-name">ScrollViewer</span> scrollView<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             scrollViewer <span class="token operator">=</span> scrollView<span class="token punctuation">;</span>
             Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"Scroll loaded..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// Markdown控件对象更新触发</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnMarkdownOBJ</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>_markdownViewer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">is</span> <span class="token class-name">MarkdownViewer</span> markdownViewer<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             _markdownViewer <span class="token operator">=</span> markdownViewer<span class="token punctuation">;</span>
             _markdownViewer<span class="token punctuation">.</span>Markdown <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 其他方法</span>
     <span class="token comment">/// 输出文本</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> newText<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>newText<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ChatModel<span class="token punctuation">.</span>IsShowRunState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         _markdownViewer<span class="token punctuation">.</span>Markdown <span class="token operator">+=</span> newText<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 提交校验</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SubmintChecked</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Length<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>ChatModel<span class="token punctuation">.</span>SubmitButtonName<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"停止"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 获取Markdown格式文本</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetMarkdownFormat</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">// 解析Markdown</span>
         <span class="token class-name"><span class="token keyword">var</span></span> pipeline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MarkdownPipelineBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name"><span class="token keyword">var</span></span> document <span class="token operator">=</span> Markdig<span class="token punctuation">.</span> Markdown<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 遍历语法树并输出结果</span>
         <span class="token class-name">StringBuilder</span> output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">TraverseMarkdown</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 显示结果</span>
         <span class="token class-name">ChatJsonDataModel</span> chatJsonDataModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatJsonDataModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         chatJsonDataModel<span class="token punctuation">.</span>Result <span class="token operator">=</span> output<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 遍历语法树：输出代码块字符串</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TraverseMarkdown</span><span class="token punctuation">(</span><span class="token class-name">MarkdownObject</span> markdownObject<span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span> output<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">//代码块</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>markdownObject <span class="token keyword">is</span> <span class="token class-name">FencedCodeBlock</span> codeBlock<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             output<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span>codeBlock<span class="token punctuation">.</span>Lines<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>markdownObject <span class="token keyword">is</span> <span class="token class-name">ContainerBlock</span> containerBlock<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> child <span class="token keyword">in</span> containerBlock<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token function">TraverseMarkdown</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>markdownObject <span class="token keyword">is</span> <span class="token class-name">LeafBlock</span> leafBlock<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             output<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span>leafBlock<span class="token punctuation">.</span>Lines<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 转换输出Markdown文本</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConvertMarkdownOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> text<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">// .UseCustomRenderers()   // 使用自定义渲染器</span>
         <span class="token class-name"><span class="token keyword">var</span></span> pipeline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MarkdownPipelineBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UseAdvancedExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 应用样式</span>
         _markdownViewer<span class="token punctuation">.</span>Pipeline <span class="token operator">=</span> pipeline<span class="token punctuation">;</span>
         _markdownViewer<span class="token punctuation">.</span>Markdown <span class="token operator">=</span> text<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">///  移除控件：移除外部数据预览控件</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BtnRemoveControl_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token comment">// 获取触发事件的按钮</span>
         <span class="token class-name">Button</span> removeButton <span class="token operator">=</span> sender <span class="token keyword">as</span> <span class="token class-name">Button</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>removeButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             removeButton<span class="token punctuation">.</span>Click <span class="token operator">-=</span> BtnRemoveControl_Click<span class="token punctuation">;</span>
             <span class="token class-name"><span class="token keyword">var</span></span> dataView <span class="token operator">=</span> UserDataService<span class="token punctuation">.</span>ExternalDatas<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>obj <span class="token operator">=&gt;</span> obj<span class="token punctuation">.</span>Model<span class="token punctuation">.</span>Index<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>removeButton<span class="token punctuation">.</span>Tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             wrapPanel<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>dataView<span class="token punctuation">.</span>View<span class="token punctuation">)</span><span class="token punctuation">;</span>
             UserDataService<span class="token punctuation">.</span>ExternalDatas<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>dataView<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token return-type class-name">OllamaSharp<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Message</span> <span class="token function">GenerateMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> content<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> role <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OllamaSharp<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             Content <span class="token operator">=</span> content<span class="token punctuation">,</span>
             Role <span class="token operator">=</span> role
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 图像功能</span>
     <span class="token comment">/// 转换图像为Base64</span>
     <span class="token keyword">private</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">ConvertImagesToBytes</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> imagePaths<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name">List<span class="token punctuation">&lt;</span>IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> imagesAsBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">try</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> imageBytes <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span>imagePaths<span class="token punctuation">)</span><span class="token punctuation">;</span>
             imagesAsBytes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>imageBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Failed to convert image to bytes: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">return</span> imagesAsBytes<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 转换图像为Base64</span>
     <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ConvertImageToBase64</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> imagePath<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">try</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> imageBytes <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span> Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>imageBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Failed to convert image to Base64: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 从字节中加载图像</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadImagesFromBytes</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> imagesAsBytes<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span> imageBytes <span class="token keyword">in</span> imagesAsBytes<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">try</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token class-name">BitmapImage</span> bitmapImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BitmapImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 bitmapImage<span class="token punctuation">.</span><span class="token function">BeginInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 bitmapImage<span class="token punctuation">.</span>StreamSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span>imageBytes<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 bitmapImage<span class="token punctuation">.</span><span class="token function">EndInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Failed to load image: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 转换图像到base64 IEnumerable</span>
     <span class="token keyword">private</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">ConvertImageToBase64IEnumerable</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> imagePath<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token class-name"><span class="token keyword">string</span></span> base64String <span class="token operator">=</span> <span class="token function">ConvertImageToBase64</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span> base64String <span class="token punctuation">}</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">/// 从Base 64加载图像</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadImagesFromBase64</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> imagesAsBase64<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> base64String <span class="token keyword">in</span> imagesAsBase64<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">try</span>
             <span class="token punctuation">{<!-- --></span>
                 <span class="token class-name"><span class="token keyword">string</span></span> base64Data <span class="token operator">=</span> base64String<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> imageBytes <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">FromBase64String</span><span class="token punctuation">(</span>base64Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token class-name">BitmapImage</span> bitmapImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BitmapImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 bitmapImage<span class="token punctuation">.</span><span class="token function">BeginInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 bitmapImage<span class="token punctuation">.</span>StreamSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span>imageBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 bitmapImage<span class="token punctuation">.</span><span class="token function">EndInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
             <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
             <span class="token punctuation">{<!-- --></span>
                 MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Failed to load image: "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
     <span class="token preprocessor property">#<span class="token directive keyword">region</span> 回调方法</span>
     <span class="token comment">///  加载聊天记录回调:</span>
     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadChatRecordCallback</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> path<span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         Debug<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">List<span class="token punctuation">&lt;</span>ChatJsonDataModel<span class="token punctuation">&gt;</span></span> datas <span class="token operator">=</span> DataService<span class="token punctuation">.</span><span class="token function">ReadDataFormJsonFile</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">StringBuilder</span> appendText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//切换聊天记录时，清空Chat对象中的消息，避免重复加载。</span>
         ChatModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Messages<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
         <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ChatJsonDataModel</span> data <span class="token keyword">in</span> datas<span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             <span class="token comment">//文本追加、添加到Markdown控件中</span>
             appendText<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"### </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">data<span class="token punctuation">.</span>Date</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             appendText<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"## 【</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">data<span class="token punctuation">.</span>Role</span><span class="token punctuation">}</span></span><span class="token string">】</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             appendText<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"#### </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">data<span class="token punctuation">.</span>Content</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token function">AppendText</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"---</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             appendText<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"## 【AI】</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             appendText<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">data<span class="token punctuation">.</span>Result</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             appendText<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Environment<span class="token punctuation">.</span>NewLine</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//创建并添加消息到Chat中</span>
             ChatModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">GenerateMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             ChatModel<span class="token punctuation">.</span>Ollama<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span>Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">GenerateMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token string">"system"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//设置当前路径为该文件路径，方便提问时将内容续写到该文件中</span>
         UserDataService<span class="token punctuation">.</span>FileModel<span class="token punctuation">.</span>FileNameDT <span class="token operator">=</span> path<span class="token punctuation">;</span>  
         <span class="token function">ConvertMarkdownOut</span><span class="token punctuation">(</span>appendText<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示内容</span>
         scrollViewer<span class="token punctuation">.</span><span class="token function">ScrollToTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//滚动到顶部</span>
     <span class="token punctuation">}</span>
     <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
 <span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <hr/>
    <h3>
     <a id="Views_1905">
     </a>
     Views
    </h3>
    <h5>
     <a id="_OfflineAIViews_1906">
     </a>
     命名空间 OfflineAI.Views
    </h5>
    <h4>
     <a id="_1907">
     </a>
     资源
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1959556dfb884ff0952c8d51c4bacb15.png"/>
    </p>
    <hr/>
    <hr/>
    <h4>
     <a id="_1913">
     </a>
     样式
    </h4>
    <h5>
     <a id="BorderStylexaml_1914">
     </a>
     BorderStyle.xaml
    </h5>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token class-name">Style</span> x<span class="token punctuation">:</span>Key<span class="token operator">=</span><span class="token string">"BorderStyle"</span> TargetType<span class="token operator">=</span><span class="token string">"Border"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Background"</span> Value<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Margin"</span> Value<span class="token operator">=</span><span class="token string">"5"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Padding"</span> Value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderThickness"</span> Value<span class="token operator">=</span><span class="token string">"1 1 1 1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderBrush"</span> Value<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h5>
     <a id="ButtonStylexaml_1926">
     </a>
     ButtonStyle.xaml
    </h5>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义圆角按钮的静态样式 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">Style</span> x<span class="token punctuation">:</span>Key<span class="token operator">=</span><span class="token string">"RoundCornerButtonStyle"</span> TargetType<span class="token operator">=</span><span class="token string">"Button"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Width"</span> Value<span class="token operator">=</span><span class="token string">"60"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Height"</span> Value<span class="token operator">=</span><span class="token string">"20"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Margin"</span> Value<span class="token operator">=</span><span class="token string">"10"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Padding"</span> Value<span class="token operator">=</span><span class="token string">"5"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderThickness"</span> Value<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderBrush"</span> Value<span class="token operator">=</span><span class="token string">"DarkGray"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#04D3F2"</span> Offset<span class="token operator">=</span><span class="token string">"0.6"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#FFAB0D"</span> Offset<span class="token operator">=</span><span class="token string">"2.8"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>设置模板样式<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Template"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ControlTemplate</span> TargetType<span class="token operator">=</span><span class="token string">"Button"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Border</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> 
                        CornerRadius<span class="token operator">=</span><span class="token string">"10"</span>
                        Background<span class="token operator">=</span><span class="token string">"{TemplateBinding Background}"</span> 
                        BorderBrush<span class="token operator">=</span><span class="token string">"{TemplateBinding BorderBrush}"</span> 
                        BorderThickness<span class="token operator">=</span><span class="token string">"{TemplateBinding BorderThickness}"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设置顶部圆角 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">ContentPresenter</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Border<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 鼠标悬停时 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsMouseOver"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> TargetName<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#FFB3B3"</span> Offset<span class="token operator">=</span><span class="token string">"0.4"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#D68B8B"</span> Offset<span class="token operator">=</span><span class="token string">"0.7"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Trigger<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 按钮被按下时 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsPressed"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> TargetName<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#D68B8B"</span> Offset<span class="token operator">=</span><span class="token string">"0.4"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#A05252"</span> Offset<span class="token operator">=</span><span class="token string">"0.7"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Trigger<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义带图标的按钮的静态样式 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">Style</span> x<span class="token punctuation">:</span>Key<span class="token operator">=</span><span class="token string">"IconButtonStyle"</span> TargetType<span class="token operator">=</span><span class="token string">"Button"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Padding"</span> Value<span class="token operator">=</span><span class="token string">"5"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 调整高度以适应图标和文本 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Height"</span> Value<span class="token operator">=</span><span class="token string">"50"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"FontSize"</span> Value<span class="token operator">=</span><span class="token string">"20"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Margin"</span> Value<span class="token operator">=</span><span class="token string">"5 5 5 5"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderThickness"</span> Value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderBrush"</span> Value<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>设置背景颜色<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 淡色 <span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#AAAAAA"</span> Offset<span class="token operator">=</span><span class="token string">"0.7"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#666666"</span> Offset<span class="token operator">=</span><span class="token string">"0.3"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Template"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ControlTemplate</span> TargetType<span class="token operator">=</span><span class="token string">"Button"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Border</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> 
                        CornerRadius<span class="token operator">=</span><span class="token string">"10"</span>
                        Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span>
                        BorderBrush<span class="token operator">=</span><span class="token string">"{TemplateBinding BorderBrush}"</span> 
                        BorderThickness<span class="token operator">=</span><span class="token string">"{TemplateBinding BorderThickness}"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用 StackPanel 来布局图标和文本 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> Orientation<span class="token operator">=</span><span class="token string">"Horizontal"</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">ContentPresenter</span> Content<span class="token operator">=</span><span class="token string">"{TemplateBinding Content}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Border<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 鼠标悬停时 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsMouseOver"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> TargetName<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#4477BB"</span> Offset<span class="token operator">=</span><span class="token string">"0.4"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#5599BB"</span> Offset<span class="token operator">=</span><span class="token string">"0.7"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Trigger<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 按钮被按下时 <span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsPressed"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> TargetName<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#6655BB"</span> Offset<span class="token operator">=</span><span class="token string">"0.4"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#6699BB"</span> Offset<span class="token operator">=</span><span class="token string">"0.7"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Trigger<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h5>
     <a id="ComboBoxStylexaml_2049">
     </a>
     ComboBoxStyle.xaml
    </h5>
    <pre><code class="prism language-csharp"> <span class="token operator">&lt;</span><span class="token class-name">Style</span>  x<span class="token punctuation">:</span>Key<span class="token operator">=</span><span class="token string">"RoundComboBoxStyle"</span> TargetType<span class="token operator">=</span><span class="token string">"{x:Type ComboBox}"</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Margin"</span> Value<span class="token operator">=</span><span class="token string">"5"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Width"</span> Value<span class="token operator">=</span><span class="token string">"200"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"HorizontalAlignment"</span> Value<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Template"</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token class-name">ControlTemplate</span> TargetType<span class="token operator">=</span><span class="token string">"{x:Type ComboBox}"</span><span class="token operator">&gt;</span>
                 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>边缘设置<span class="token operator">--</span><span class="token operator">&gt;</span>
                 <span class="token operator">&lt;</span><span class="token class-name">Border</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"roundedRectangle"</span>
                         CornerRadius<span class="token operator">=</span><span class="token string">"5"</span> 
                         BorderThickness<span class="token operator">=</span><span class="token string">"1"</span> 
                         BorderBrush<span class="token operator">=</span><span class="token string">"#AAAAFF"</span>
                         Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span><span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span>Grid<span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下拉箭头：开关按钮：（检验下拉菜单是否打开：IsDropDownOpen）<span class="token operator">--</span><span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token class-name">ToggleButton</span> IsChecked<span class="token operator">=</span><span class="token string">"{Binding IsDropDownOpen,Mode=TwoWay,RelativeSource={RelativeSource TemplatedParent}}"</span><span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>开关按钮样式<span class="token operator">--</span><span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span>ToggleButton<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"{x:Type ToggleButton}"</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Margin"</span> Value<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Width"</span> Value<span class="token operator">=</span><span class="token string">"Auto"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Height"</span> Value<span class="token operator">=</span><span class="token string">"Auto"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"MinWidth"</span> Value<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"MinHeight"</span> Value<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"ClickMode"</span> Value<span class="token operator">=</span><span class="token string">"Press"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Focusable"</span> Value<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderThickness"</span> Value<span class="token operator">=</span><span class="token string">"3"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下拉箭头颜色<span class="token operator">--</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Foreground"</span> Value<span class="token operator">=</span><span class="token string">"#000000"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下拉箭头颜色边缘线宽<span class="token operator">--</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"BorderBrush"</span> Value<span class="token operator">=</span><span class="token string">"#00000000"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Template"</span><span class="token operator">&gt;</span>
                                         <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                             <span class="token operator">&lt;</span><span class="token class-name">ControlTemplate</span> TargetType<span class="token operator">=</span><span class="token string">"{x:Type ToggleButton}"</span><span class="token operator">&gt;</span>
                                                 <span class="token operator">&lt;</span><span class="token class-name">DockPanel</span> LastChildFill<span class="token operator">=</span><span class="token string">"False"</span> 
                                                            SnapsToDevicePixels<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                                                     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>面板背景颜色<span class="token operator">--</span><span class="token operator">&gt;</span>
                                                     <span class="token operator">&lt;</span>DockPanel<span class="token punctuation">.</span>Background<span class="token operator">&gt;</span>
                                                         <span class="token operator">&lt;</span><span class="token class-name">SolidColorBrush</span> Color<span class="token operator">=</span><span class="token string">"{TemplateBinding Background}"</span><span class="token operator">&gt;</span>
                                                         <span class="token operator">&lt;</span><span class="token operator">/</span>SolidColorBrush<span class="token operator">&gt;</span>
                                                     <span class="token operator">&lt;</span><span class="token operator">/</span>DockPanel<span class="token punctuation">.</span>Background<span class="token operator">&gt;</span>
                                                     
                                                     <span class="token operator">&lt;</span><span class="token class-name">Border</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"Border"</span> 
                                                             CornerRadius<span class="token operator">=</span><span class="token string">"5"</span>
                                                             DockPanel<span class="token punctuation">.</span>Dock<span class="token operator">=</span><span class="token string">"Right"</span> 
                                                             BorderBrush<span class="token operator">=</span><span class="token string">"{TemplateBinding BorderBrush}"</span> 
                                                             BorderThickness<span class="token operator">=</span><span class="token string">"{TemplateBinding BorderThickness}"</span><span class="token operator">&gt;</span>
                                                         <span class="token operator">&lt;</span><span class="token class-name">Path</span> Data<span class="token operator">=</span><span class="token string">"M0,0L3.5,4 7,0z"</span>
                                                               VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                                                               HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                                                               Fill<span class="token operator">=</span><span class="token string">"{TemplateBinding Foreground}"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                                     <span class="token operator">&lt;</span><span class="token operator">/</span>Border<span class="token operator">&gt;</span>
                                                 <span class="token operator">&lt;</span><span class="token operator">/</span>DockPanel<span class="token operator">&gt;</span>
                                                 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>是否校验<span class="token operator">--</span><span class="token operator">&gt;</span>
                                                 <span class="token operator">&lt;</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                                     <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsChecked"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                                 <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                             <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token operator">&gt;</span>
                                         <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                         <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsEnabled"</span> Value<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">&gt;</span>
                                             <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Foreground"</span> 
                                                     Value<span class="token operator">=</span><span class="token string">"{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                         <span class="token operator">&lt;</span><span class="token operator">/</span>Trigger<span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span><span class="token operator">/</span>ToggleButton<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token operator">/</span>ToggleButton<span class="token operator">&gt;</span>
                         
                         <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>项内容<span class="token operator">--</span><span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token class-name">ContentPresenter</span> Margin<span class="token operator">=</span><span class="token string">"3"</span>
                                           IsHitTestVisible<span class="token operator">=</span><span class="token string">"False"</span>
                                           VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                                           HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span>
                                           Content<span class="token operator">=</span><span class="token string">"{TemplateBinding SelectionBoxItem}"</span>
                                           ContentTemplate<span class="token operator">=</span><span class="token string">"{TemplateBinding SelectionBoxItemTemplate}"</span>
                                           ContentTemplateSelector<span class="token operator">=</span><span class="token string">"{TemplateBinding ItemTemplateSelector}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下拉显示面板：设置下拉面板的相对位置<span class="token operator">--</span><span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token class-name">Popup</span> PopupAnimation<span class="token operator">=</span><span class="token string">"Slide"</span> 
                                Focusable<span class="token operator">=</span><span class="token string">"False"</span> 
                                HorizontalOffset<span class="token operator">=</span><span class="token string">"-1"</span>
                                Height<span class="token operator">=</span><span class="token string">"200"</span>
                                Width<span class="token operator">=</span><span class="token string">"{TemplateBinding ActualWidth}"</span>
                                IsOpen<span class="token operator">=</span><span class="token string">"{TemplateBinding IsDropDownOpen}"</span><span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span><span class="token class-name">Grid</span>  SnapsToDevicePixels<span class="token operator">=</span><span class="token string">"True"</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token class-name">Border</span>  CornerRadius<span class="token operator">=</span><span class="token string">"5"</span>
                                          BorderBrush<span class="token operator">=</span><span class="token string">"#AAAAFF"</span>
                                          BorderThickness<span class="token operator">=</span><span class="token string">"1,1,1,1"</span> 
                                          HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>下拉面板背景颜色<span class="token operator">--</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span>Border<span class="token punctuation">.</span>Background<span class="token operator">&gt;</span>
                                         <span class="token operator">&lt;</span><span class="token class-name">SolidColorBrush</span> Color<span class="token operator">=</span><span class="token string">"#EEEEEE"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">/</span>Border<span class="token punctuation">.</span>Background<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">/</span>Border<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>滑动条<span class="token operator">--</span><span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token class-name">ScrollViewer</span>  SnapsToDevicePixels<span class="token operator">=</span><span class="token string">"True"</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> <span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> IsItemsHost<span class="token operator">=</span><span class="token string">"True"</span>
                                                 HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> KeyboardNavigation<span class="token punctuation">.</span>DirectionalNavigation<span class="token operator">=</span><span class="token string">"Contained"</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">/</span>ScrollViewer<span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token operator">/</span>Popup<span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
                 <span class="token operator">&lt;</span><span class="token operator">/</span>Border<span class="token operator">&gt;</span>
                 <span class="token operator">&lt;</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 触发颜色： 鼠标悬停时 <span class="token operator">--</span><span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span><span class="token class-name">Trigger</span> Property<span class="token operator">=</span><span class="token string">"IsMouseOver"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token class-name">Setter</span> TargetName<span class="token operator">=</span><span class="token string">"roundedRectangle"</span> Property<span class="token operator">=</span><span class="token string">"Background"</span><span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token class-name">LinearGradientBrush</span> StartPoint<span class="token operator">=</span><span class="token string">"0,0"</span> EndPoint<span class="token operator">=</span><span class="token string">"1,0"</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">GradientStop</span> Color<span class="token operator">=</span><span class="token string">"#AABBCC"</span> Offset<span class="token operator">=</span><span class="token string">"0.4"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">/</span>LinearGradientBrush<span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span><span class="token operator">/</span>Trigger<span class="token operator">&gt;</span>
                 <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span><span class="token operator">/</span>ControlTemplate<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token punctuation">.</span>Value<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>Setter<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="ChatRecordListView_2176">
     </a>
     ChatRecordListView
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e16b9742d8974820976dd1b99da90848.png"/>
    </p>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token class-name">UserControl</span> x<span class="token punctuation">:</span>Class<span class="token operator">=</span><span class="token string">"OfflineAI.Views.ChatRecordListView"</span>
             xmlns<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             xmlns<span class="token punctuation">:</span>x<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
             xmlns<span class="token punctuation">:</span>mc<span class="token operator">=</span><span class="token string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> 
             xmlns<span class="token punctuation">:</span>d<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/expression/blend/2008"</span> 
             xmlns<span class="token punctuation">:</span>behavior<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/xaml/behaviors"</span>
             xmlns<span class="token punctuation">:</span>local<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.Views"</span>
             xmlns<span class="token punctuation">:</span>viewModel<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.ViewModels"</span>
             xmlns<span class="token punctuation">:</span>commands<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.Commands"</span>
             mc<span class="token punctuation">:</span>Ignorable<span class="token operator">=</span><span class="token string">"d"</span> 
             d<span class="token punctuation">:</span>DesignHeight<span class="token operator">=</span><span class="token string">"450"</span> d<span class="token punctuation">:</span>DesignWidth<span class="token operator">=</span><span class="token string">"300"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>UserControl<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>viewModel<span class="token punctuation">:</span><span class="token class-name">ChatRecordListViewModel</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"ViewModel"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">Grid</span> Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">ScrollViewer</span> Background<span class="token operator">=</span><span class="token string">"Transparent"</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"RecordScrollViewer"</span>
                      HorizontalScrollBarVisibility<span class="token operator">=</span><span class="token string">"Visible"</span>
                      VerticalScrollBarVisibility<span class="token operator">=</span><span class="token string">"Visible"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ListBox</span> Background<span class="token operator">=</span><span class="token string">"Transparent"</span> Margin<span class="token operator">=</span><span class="token string">"5"</span> 
                     HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span>
                     ItemsSource<span class="token operator">=</span><span class="token string">"{Binding ChatRecordCollection}"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ListBox<span class="token punctuation">.</span>ItemContainerStyle<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"ListBoxItem"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"HorizontalContentAlignment"</span> Value<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Background"</span> Value<span class="token operator">=</span><span class="token string">"#FAFFFF"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ListBox<span class="token punctuation">.</span>ItemContainerStyle<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>ListBox<span class="token punctuation">.</span>ItemTemplate<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>DataTemplate<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> Orientation<span class="token operator">=</span><span class="token string">"Vertical"</span>  Margin<span class="token operator">=</span><span class="token string">"0,0,0,0"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>显示消息日期<span class="token operator">--</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">TextBlock</span> FontSize<span class="token operator">=</span><span class="token string">"14"</span>  Margin<span class="token operator">=</span><span class="token string">"0,0,0,0"</span>
                                       Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span> Foreground<span class="token operator">=</span><span class="token string">"#CCCCCC"</span>
                                       Tag<span class="token operator">=</span><span class="token string">"{Binding Uri}"</span>  Text<span class="token operator">=</span><span class="token string">"{Binding JsonModel.Date}"</span> <span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>TextBlock<span class="token punctuation">.</span>ContextMenu<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">ContextMenu</span> Name<span class="token operator">=</span><span class="token string">"RightKeyMenu"</span>
                                            DataContext<span class="token operator">=</span><span class="token string">"{Binding PlacementTarget.DataContext,RelativeSource={RelativeSource Self}}"</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span><span class="token class-name">MenuItem</span> Name<span class="token operator">=</span><span class="token string">"Delete"</span> Header<span class="token operator">=</span><span class="token string">"删除"</span>
                                           Command<span class="token operator">=</span><span class="token string">"{Binding MenuItemMouseDownCommand}"</span>  CommandParameter<span class="token operator">=</span><span class="token string">"{Binding Uri}"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span>Separator<span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>ContextMenu<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token punctuation">.</span>ContextMenu<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token operator">&gt;</span>
                            
                            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 显示消息内容 <span class="token operator">--</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">TextBlock</span> FontSize<span class="token operator">=</span><span class="token string">"14"</span>  Margin<span class="token operator">=</span><span class="token string">"10,5,0,0"</span> 
                                       Tag<span class="token operator">=</span><span class="token string">"{Binding Uri}"</span> 
                                       Text<span class="token operator">=</span><span class="token string">"{Binding JsonModel.Content}"</span> <span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>鼠标点击命令事件<span class="token operator">--</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"PreviewMouseDown"</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span>
                                         Command<span class="token operator">=</span>"<span class="token punctuation">{<!-- --></span>Binding DataContext<span class="token punctuation">.</span>ChatRecordMouseDownCommand<span class="token punctuation">,</span> 
                                                   RelativeSource<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token class-name">RelativeSource</span> AncestorType<span class="token operator">=</span>ListBox<span class="token punctuation">}</span><span class="token punctuation">}</span>"
                                                   PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>InvokeCommandAction<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>DataTemplate<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ListBox<span class="token punctuation">.</span>ItemTemplate<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ListBox<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ScrollViewer<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="UserChatView_2249">
     </a>
     UserChatView
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/814896b9efde4597915438fa50b60b82.png"/>
    </p>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token class-name">UserControl</span> x<span class="token punctuation">:</span>Class<span class="token operator">=</span><span class="token string">"OfflineAI.Views.UserChatView"</span>
             xmlns<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             xmlns<span class="token punctuation">:</span>x<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
             xmlns<span class="token punctuation">:</span>mc<span class="token operator">=</span><span class="token string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> 
             xmlns<span class="token punctuation">:</span>d<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/expression/blend/2008"</span> 
             xmlns<span class="token punctuation">:</span>behavior<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/xaml/behaviors"</span>
             xmlns<span class="token punctuation">:</span>local<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.Views"</span>
             xmlns<span class="token punctuation">:</span>markdig <span class="token operator">=</span><span class="token string">"clr-namespace:Markdig.Wpf;assembly=Markdig.Wpf"</span>
             xmlns<span class="token punctuation">:</span>viewmodels<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.ViewModels"</span>
             mc<span class="token punctuation">:</span>Ignorable<span class="token operator">=</span><span class="token string">"d"</span> 
             d<span class="token punctuation">:</span>DesignHeight<span class="token operator">=</span><span class="token string">"600"</span> d<span class="token punctuation">:</span>DesignWidth<span class="token operator">=</span><span class="token string">"800"</span>
             HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>绑定数据上下文<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>UserControl<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>viewmodels<span class="token punctuation">:</span><span class="token class-name">UserChatViewModel</span>  x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"ViewModel"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>控件资源<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>UserControl<span class="token punctuation">.</span>Resources<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ResourceDictionary<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>资源字典<span class="token punctuation">:</span> 添加控件样式<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ResourceDictionary<span class="token punctuation">.</span>MergedDictionaries<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ResourceDictionary</span> Source<span class="token operator">=</span><span class="token string">"../Views/Styles/MarkDownViewerStyle.xaml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ResourceDictionary</span> Source<span class="token operator">=</span><span class="token string">"../Views/Styles/BorderStyle.xaml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ResourceDictionary<span class="token punctuation">.</span>MergedDictionaries<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ResourceDictionary<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token punctuation">.</span>Resources<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>Grid<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>命令绑定事件：窗体加载时传参数Markdown控件对象。在Grid中创建，否则会出现<span class="token keyword">null</span>异常<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"Loaded"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> 
                  Command<span class="token operator">=</span><span class="token string">"{Binding MarkdownOBJCommand}"</span>
                  CommandParameter<span class="token operator">=</span><span class="token string">"{Binding ElementName=MarkdownContent}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>定义行<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"250"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"Auto"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>行背景色<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"1"</span> Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"2"</span> Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span> BorderThickness<span class="token operator">=</span><span class="token string">"0"</span> BorderBrush<span class="token operator">=</span><span class="token string">"Transparent"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Height<span class="token operator">=</span><span class="token string">"Auto"</span> 
              HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> 
              VerticalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>markdown 滑动条<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ScrollViewer</span> Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span>
                          x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"MarkDownScrollViewer"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>加载事件命令<span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"Loaded"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> 
                         Command<span class="token operator">=</span><span class="token string">"{Binding ScrollLoadedCommand}"</span>
                         PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>markdown 控件<span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>markdig<span class="token punctuation">:</span><span class="token class-name">MarkdownViewer</span>
                        Name<span class="token operator">=</span><span class="token string">"MarkdownContent"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>markdig<span class="token punctuation">:</span>MarkdownViewer<span class="token punctuation">.</span>Resources<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 应用自定义样式 <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"Paragraph"</span> BasedOn<span class="token operator">=</span><span class="token string">"{StaticResource Heading1Style}"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"Hyperlink"</span> BasedOn<span class="token operator">=</span><span class="token string">"{StaticResource LinkStyle}"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>markdig<span class="token punctuation">:</span>MarkdownViewer<span class="token punctuation">.</span>Resources<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>命令绑定事件：鼠标滚动显示内容<span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>鼠标滚动命令事件<span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"PreviewMouseWheel"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> 
                             Command<span class="token operator">=</span><span class="token string">"{Binding MouseWheelCommand}"</span>
                             PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>鼠标点击命令事件<span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"PreviewMouseDown"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> 
                             Command<span class="token operator">=</span><span class="token string">"{Binding MouseDownCommand}"</span>
                             PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>markdig<span class="token punctuation">:</span>MarkdownViewer<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ScrollViewer<span class="token operator">&gt;</span>
            
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Ollama 运行状态显示 <span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">TextBlock</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                       HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                       FontSize<span class="token operator">=</span><span class="token string">"18"</span>
                       IsHitTestVisible<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>TextBlock<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"TextBlock"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认显示运行状态 <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Visibility"</span> Value<span class="token operator">=</span><span class="token string">"Visible"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果 ChatModel<span class="token punctuation">.</span>显示状态为True，显示运行状态 <span class="token operator">--</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.IsShowRunState}"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Visibility"</span> Value<span class="token operator">=</span><span class="token string">"Visible"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.IsShowRunState}"</span> Value<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Visibility"</span> Value<span class="token operator">=</span><span class="token string">"Hidden"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>WrapPanel<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Image</span> Width<span class="token operator">=</span><span class="token string">"24"</span> Height<span class="token operator">=</span><span class="token string">"24"</span>  Margin<span class="token operator">=</span><span class="token string">"0,0,5,0"</span>  
                           HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>Image<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"Image"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果 RunState 为 <span class="token boolean">true</span>，显示绿色图像 <span class="token operator">--</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.RunState}"</span> Value<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Source"</span> Value<span class="token operator">=</span><span class="token string">"../Views/Resources/ollama-run-state-red-32.png"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.RunState}"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Source"</span> Value<span class="token operator">=</span><span class="token string">"../Views/Resources/ollama-run-state-green-32.png"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">TextBox</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> 
                         Background<span class="token operator">=</span><span class="token string">"Transparent"</span> BorderThickness<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span>TextBox<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"TextBox"</span><span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果 RunState 为 <span class="token boolean">true</span>，显示绿色图像 <span class="token operator">--</span><span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.RunState}"</span> Value<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Text"</span> Value<span class="token operator">=</span><span class="token string">"Ollama停止运行"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.RunState}"</span> Value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
                                     <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Text"</span> Value<span class="token operator">=</span><span class="token string">"Ollama正在运行"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                 <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                             <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                         <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                     <span class="token operator">&lt;</span><span class="token operator">/</span>TextBox<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>TextBox<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>WrapPanel<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">2</span>行内容：显示回话内容<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"1"</span>  Margin<span class="token operator">=</span><span class="token string">"2"</span> Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>定义三行<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"auto"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"40"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Grid<span class="token punctuation">.</span>ColumnDefinitions<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ColumnDefinition</span> Width<span class="token operator">=</span><span class="token string">"1*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ColumnDefinition</span> Width<span class="token operator">=</span><span class="token string">"3*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ColumnDefinition</span> Width<span class="token operator">=</span><span class="token string">"1*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token punctuation">.</span>ColumnDefinitions<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">1</span>行Border样式<span class="token punctuation">:</span><span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span> BorderThickness<span class="token operator">=</span><span class="token string">"0"</span> Style<span class="token operator">=</span><span class="token string">"{StaticResource BorderStyle}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">2</span>行Border样式<span class="token punctuation">:</span><span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"1"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span> Style<span class="token operator">=</span><span class="token string">"{StaticResource BorderStyle}"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">3</span>行Border样式<span class="token punctuation">:</span><span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"2"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span> 
                    Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span>
                    BorderThickness<span class="token operator">=</span><span class="token string">"1 0 1 1"</span>
                    BorderBrush <span class="token operator">=</span><span class="token string">"#000000"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
            
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">1</span>行内容区域<span class="token punctuation">:</span>外部数据预览面板<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span>  Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">WrapPanel</span> Name<span class="token operator">=</span><span class="token string">"FileShowArea"</span> Margin<span class="token operator">=</span><span class="token string">"0,0,0,0"</span> 
                           HorizontalAlignment<span class="token operator">=</span><span class="token string">"Left"</span> 
                           VerticalAlignment<span class="token operator">=</span><span class="token string">"Top"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"Loaded"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> 
                              Command<span class="token operator">=</span><span class="token string">"{Binding ExternalDataPanelLoadedCommand}"</span>
                              PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>WrapPanel<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
            
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">2</span>行内容区域：文本输入框<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"1"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">TextBox</span> Padding<span class="token operator">=</span><span class="token string">"5"</span> 
                         FontSize<span class="token operator">=</span><span class="token string">"14"</span>
                         BorderThickness<span class="token operator">=</span><span class="token string">"1,1,1,0"</span>
                         BorderBrush <span class="token operator">=</span><span class="token string">"#000000"</span>
                         AcceptsReturn<span class="token operator">=</span><span class="token string">"True"</span> 
                         Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span>  
                         Foreground<span class="token operator">=</span><span class="token string">"#000000"</span>
                         TextWrapping<span class="token operator">=</span><span class="token string">"WrapWithOverflow"</span>
                         Text<span class="token operator">=</span><span class="token string">"{Binding ChatModel.InputText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"</span>
                         VerticalScrollBarVisibility<span class="token operator">=</span><span class="token string">"Auto"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>回车发送<span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>TextBox<span class="token punctuation">.</span>InputBindings<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">KeyBinding</span> Command<span class="token operator">=</span><span class="token string">"{Binding SubmitQuestionCommand}"</span> Key<span class="token operator">=</span><span class="token string">"Enter"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>TextBox<span class="token punctuation">.</span>InputBindings<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>TextBox<span class="token operator">&gt;</span>

                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 提示文本 <span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">TextBlock</span> Text<span class="token operator">=</span><span class="token string">"给AI发送消息"</span>
                       Foreground<span class="token operator">=</span><span class="token string">"#555555"</span>
                       VerticalAlignment<span class="token operator">=</span><span class="token string">"Top"</span>
                       HorizontalAlignment<span class="token operator">=</span><span class="token string">"Left"</span>
                       Margin<span class="token operator">=</span><span class="token string">"10,5,0,0"</span>
                       FontSize<span class="token operator">=</span><span class="token string">"14"</span>
                       IsHitTestVisible<span class="token operator">=</span><span class="token string">"False"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>TextBlock<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"TextBlock"</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认隐藏提示文本 <span class="token operator">--</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Visibility"</span> Value<span class="token operator">=</span><span class="token string">"Collapsed"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 如果 ChatModel<span class="token punctuation">.</span>InputText 为空，显示提示文本 <span class="token operator">--</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.InputText}"</span> Value<span class="token operator">=</span><span class="token string">""</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Visibility"</span> Value<span class="token operator">=</span><span class="token string">"Visible"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">DataTrigger</span> Binding<span class="token operator">=</span><span class="token string">"{Binding ChatModel.InputText}"</span> Value<span class="token operator">=</span><span class="token string">"{x:Null}"</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"Visibility"</span> Value<span class="token operator">=</span><span class="token string">"Visible"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>DataTrigger<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>TextBlock<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
            
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">3</span>行内容区域<span class="token punctuation">:</span>文件选择，提交按钮<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"2"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">WrapPanel</span>  Margin<span class="token operator">=</span><span class="token string">"0,0,5,0"</span> 
                            HorizontalAlignment<span class="token operator">=</span><span class="token string">"Right"</span> 
                            VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>选择添加文件按钮<span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Button</span> Width<span class="token operator">=</span><span class="token string">"50"</span> Command<span class="token operator">=</span><span class="token string">"{Binding SelecteAddFileCommand}"</span> BorderThickness<span class="token operator">=</span><span class="token string">"0"</span> Background<span class="token operator">=</span><span class="token string">"Transparent"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Image</span> Width<span class="token operator">=</span><span class="token string">"24"</span> Height<span class="token operator">=</span><span class="token string">"24"</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"FileIco"</span>
                            Source<span class="token operator">=</span><span class="token string">"/Views/Resources/append-black-24.png"</span> 
                            HorizontalAlignment<span class="token operator">=</span><span class="token string">"Right"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义ToolTip <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>Button<span class="token punctuation">.</span>ToolTip<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">ToolTip</span> Content<span class="token operator">=</span><span class="token string">"添加文件"</span> Placement<span class="token operator">=</span><span class="token string">"Top"</span>  HorizontalOffset<span class="token operator">=</span><span class="token string">"0"</span> VerticalOffset<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span>ToolTip<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设置ToolTip显示延迟<span class="token number">1</span>秒 <span class="token operator">--</span><span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token class-name">EventTrigger</span> RoutedEvent<span class="token operator">=</span><span class="token string">"ToolTip.Opened"</span><span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span>BeginStoryboard<span class="token operator">&gt;</span>
                                            <span class="token operator">&lt;</span>Storyboard<span class="token operator">&gt;</span>
                                                <span class="token operator">&lt;</span>DoubleAnimation Storyboard<span class="token punctuation">.</span>TargetProperty<span class="token operator">=</span><span class="token string">"Opacity"</span> From<span class="token operator">=</span><span class="token string">"0"</span> To<span class="token operator">=</span><span class="token string">"1"</span> Duration<span class="token operator">=</span><span class="token string">"0:0:1"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                            <span class="token operator">&lt;</span><span class="token operator">/</span>Storyboard<span class="token operator">&gt;</span>
                                        <span class="token operator">&lt;</span><span class="token operator">/</span>BeginStoryboard<span class="token operator">&gt;</span>
                                    <span class="token operator">&lt;</span><span class="token operator">/</span>EventTrigger<span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">/</span>ToolTip<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>ToolTip<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token punctuation">.</span>ToolTip<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 设置ToolTip的显示和隐藏 <span class="token operator">--</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>Button<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">Style</span> TargetType<span class="token operator">=</span><span class="token string">"Button"</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"ToolTipService.ShowDuration"</span> Value<span class="token operator">=</span><span class="token string">"10000"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> ToolTip显示持续时间 <span class="token operator">--</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"ToolTipService.InitialShowDelay"</span> Value<span class="token operator">=</span><span class="token string">"1000"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 延迟<span class="token number">1</span>秒显示 <span class="token operator">--</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token class-name">Setter</span> Property<span class="token operator">=</span><span class="token string">"ToolTipService.BetweenShowDelay"</span> Value<span class="token operator">=</span><span class="token string">"0"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 防止快速显示 <span class="token operator">--</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token operator">/</span>Style<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token punctuation">.</span>Style<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                    
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>问题提交按钮<span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">Button</span> Width<span class="token operator">=</span><span class="token string">"50"</span>  Margin<span class="token operator">=</span><span class="token string">"5 0 0 0"</span> BorderThickness<span class="token operator">=</span><span class="token string">"0"</span>   Background<span class="token operator">=</span><span class="token string">"Transparent"</span>
                            Command<span class="token operator">=</span><span class="token string">"{Binding SubmitQuestionCommand}"</span> 
                            Content<span class="token operator">=</span><span class="token string">"{Binding ChatModel.SubmitButtonName}"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>WrapPanel<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第<span class="token number">3</span>行内容：<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="SystemSettingView_2533">
     </a>
     SystemSettingView
    </h4>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token class-name">UserControl</span> x<span class="token punctuation">:</span>Class<span class="token operator">=</span><span class="token string">"OfflineAI.Views.SystemSettingView"</span>
             xmlns<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             xmlns<span class="token punctuation">:</span>x<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
             xmlns<span class="token punctuation">:</span>mc<span class="token operator">=</span><span class="token string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> 
             xmlns<span class="token punctuation">:</span>d<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/expression/blend/2008"</span> 
             xmlns<span class="token punctuation">:</span>local<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.Views"</span>
             xmlns<span class="token punctuation">:</span>viewModels<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.ViewModels"</span>
             mc<span class="token punctuation">:</span>Ignorable<span class="token operator">=</span><span class="token string">"d"</span> 
             d<span class="token punctuation">:</span>DesignHeight<span class="token operator">=</span><span class="token string">"450"</span> d<span class="token punctuation">:</span>DesignWidth<span class="token operator">=</span><span class="token string">"800"</span>
             HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Grid<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span> Margin<span class="token operator">=</span><span class="token string">"5"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">TextBox</span> FontSize<span class="token operator">=</span><span class="token string">"36"</span> IsReadOnly<span class="token operator">=</span><span class="token string">"True"</span>
                     HorizontalContentAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalContentAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">&gt;</span>系统设置<span class="token operator">&lt;</span><span class="token operator">/</span>TextBox<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="UserViews_2554">
     </a>
     UserViews
    </h4>
    <h5>
     <a id="OfflineAIViewsUserViews_2555">
     </a>
     命名空间：OfflineAI.Views.UserViews
    </h5>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c3870178198d428e8b4e4f1bbb86b928.png"/>
    </p>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token class-name">UserControl</span> x<span class="token punctuation">:</span>Class<span class="token operator">=</span><span class="token string">"OfflineAI.Views.UserViews.ExternalDataPreView"</span>
             xmlns<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
             xmlns<span class="token punctuation">:</span>x<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
             xmlns<span class="token punctuation">:</span>mc<span class="token operator">=</span><span class="token string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> 
             xmlns<span class="token punctuation">:</span>d<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/expression/blend/2008"</span> 
             xmlns<span class="token punctuation">:</span>local<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.Views.UserViews"</span>
             xmlns<span class="token punctuation">:</span>viewmodels<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.ViewModels"</span>
             mc<span class="token punctuation">:</span>Ignorable<span class="token operator">=</span><span class="token string">"d"</span>
             HorizontalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span>
             VerticalAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>绑定数据上下文<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>UserControl<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>viewmodels<span class="token punctuation">:</span><span class="token class-name">ExternalDataPreViewModel</span>  x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"ViewModel"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">Grid</span> Background<span class="token operator">=</span><span class="token string">"Transparent"</span> <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>外部数据预览视图：<span class="token number">1</span>、显示加载的外部数据文件名<span class="token number">2</span>、隐藏显示文件路径<span class="token number">3</span>、点击按钮可以删除 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">Border</span> Background<span class="token operator">=</span><span class="token string">"Transparent"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">WrapPanel</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Left"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> Margin<span class="token operator">=</span><span class="token string">"1"</span> Background<span class="token operator">=</span><span class="token string">"#AAAABB"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">Image</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"ImgFileIco"</span> Width<span class="token operator">=</span><span class="token string">"20"</span> Height<span class="token operator">=</span><span class="token string">"20"</span> 
                   VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                   HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                   Source<span class="token operator">=</span><span class="token string">"{Binding Model.ImageSource}"</span> <span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Image<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">TextBox</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"Tbx_Text"</span>  
              Text<span class="token operator">=</span><span class="token string">"External Data"</span>
              IsReadOnly<span class="token operator">=</span><span class="token string">"True"</span>
              Background<span class="token operator">=</span><span class="token string">"#AAAABB"</span>
              HorizontalContentAlignment<span class="token operator">=</span><span class="token string">"Left"</span>
              VerticalContentAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
              TextWrapping<span class="token operator">=</span><span class="token string">"Wrap"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">Button</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"RemoveButton"</span> 
                    Tag<span class="token operator">=</span><span class="token string">"{Binding Model.Index}"</span>
                    Background<span class="token operator">=</span><span class="token string">"#AAAABB"</span> 
                    VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                    HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span>
                    VerticalContentAlignment<span class="token operator">=</span><span class="token string">"Center"</span> 
                    Content<span class="token operator">=</span><span class="token string">" × "</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>WrapPanel<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserControl<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <hr/>
    <h4>
     <a id="MainWindow_2602">
     </a>
     MainWindow
    </h4>
    <h5>
     <a id="OfflineAI_2603">
     </a>
     命名空间：OfflineAI
    </h5>
    <pre><code class="prism language-csharp"><span class="token operator">&lt;</span><span class="token class-name">Window</span> x<span class="token punctuation">:</span>Class<span class="token operator">=</span><span class="token string">"OfflineAI.MainWindow"</span>
        xmlns<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span>
        xmlns<span class="token punctuation">:</span>x<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
        xmlns<span class="token punctuation">:</span>d<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/expression/blend/2008"</span>
        xmlns<span class="token punctuation">:</span>mc<span class="token operator">=</span><span class="token string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
        xmlns<span class="token punctuation">:</span>behavior<span class="token operator">=</span><span class="token string">"http://schemas.microsoft.com/xaml/behaviors"</span>
        xmlns<span class="token punctuation">:</span>local<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI"</span>
        xmlns<span class="token punctuation">:</span>viewmodels<span class="token operator">=</span><span class="token string">"clr-namespace:OfflineAI.ViewModels"</span> 
        WindowStartupLocation<span class="token operator">=</span><span class="token string">"CenterScreen"</span>
        mc<span class="token punctuation">:</span>Ignorable<span class="token operator">=</span><span class="token string">"d"</span>
        Title<span class="token operator">=</span><span class="token string">"ChatAI"</span> Height<span class="token operator">=</span><span class="token string">"800"</span> Width<span class="token operator">=</span><span class="token string">"1000"</span>
        Icon<span class="token operator">=</span><span class="token string">"/Views/Resources/app-logo-128.ico"</span>
        MinHeight<span class="token operator">=</span><span class="token string">"600"</span> MinWidth<span class="token operator">=</span><span class="token string">"800"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>绑定上下文<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Window<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>viewmodels<span class="token punctuation">:</span>MainViewModel<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Window<span class="token punctuation">.</span>DataContext<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>样式资源<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Window<span class="token punctuation">.</span>Resources<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>ResourceDictionary<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>资源字典<span class="token punctuation">:</span> 添加控件样式<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ResourceDictionary<span class="token punctuation">.</span>MergedDictionaries<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ResourceDictionary</span> Source<span class="token operator">=</span><span class="token string">"Views/Styles/ButtonStyle.xaml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ResourceDictionary</span> Source<span class="token operator">=</span><span class="token string">"Views/Styles/ComboBoxStyle.xaml"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ResourceDictionary<span class="token punctuation">.</span>MergedDictionaries<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ResourceDictionary<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Window<span class="token punctuation">.</span>Resources<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>事件命令绑定<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>窗体加载命令绑定<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"Loaded"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> Command<span class="token operator">=</span><span class="token string">"{Binding LoadedWindowCommand}"</span> 
                                          PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>窗体关闭命令绑定<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">EventTrigger</span> EventName<span class="token operator">=</span><span class="token string">"Closing"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>behavior<span class="token punctuation">:</span><span class="token class-name">InvokeCommandAction</span> Command<span class="token operator">=</span><span class="token string">"{Binding ClosingWindowCommand}"</span> 
                                       PassEventArgsToCommand<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>EventTrigger<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>behavior<span class="token punctuation">:</span>Interaction<span class="token punctuation">.</span>Triggers<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Grid <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义<span class="token number">2</span>行 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"20"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 定义<span class="token number">3</span>列：<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid<span class="token punctuation">.</span>ColumnDefinitions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ColumnDefinition</span> Width<span class="token operator">=</span><span class="token string">"auto"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ColumnDefinition</span> Width<span class="token operator">=</span><span class="token string">"*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ColumnDefinition</span> Width<span class="token operator">=</span><span class="token string">"10"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token punctuation">.</span>ColumnDefinitions<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"0"</span> Visibility<span class="token operator">=</span><span class="token string">"{Binding MainModel.ExpandedMenuIsHide}"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>折叠栏内添加的视图<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">ContentControl</span> Margin<span class="token operator">=</span><span class="token string">"5,5,5,5"</span> Width<span class="token operator">=</span><span class="token string">"{Binding MainModel.ExpandedBarWidth}"</span>
                         Content<span class="token operator">=</span><span class="token string">"{Binding MainModel.ExpandedBarView}"</span> 
                         HorizontalContentAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> 
                         VerticalContentAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 右侧内容区域 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">Border</span> Background<span class="token operator">=</span><span class="token string">"LightGray"</span> Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span> Padding<span class="token operator">=</span><span class="token string">"10"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>主要区域<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Grid Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Grid<span class="token punctuation">.</span>Column<span class="token operator">=</span><span class="token string">"1"</span> Margin<span class="token operator">=</span><span class="token string">"3"</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>定义三行<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"50"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"*"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">RowDefinition</span> Height<span class="token operator">=</span><span class="token string">"350"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token punctuation">.</span>RowDefinitions<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>设置背景色<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"0"</span> Background<span class="token operator">=</span><span class="token string">"#EEEEEE"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Border Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"1"</span> Background<span class="token operator">=</span><span class="token string">"#FFFFFF"</span> Grid<span class="token punctuation">.</span>RowSpan<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第一行内容：左对齐内容<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">WrapPanel</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Button</span>  Background<span class="token operator">=</span><span class="token string">"Transparent"</span> BorderThickness<span class="token operator">=</span><span class="token string">"0"</span>
                         Command<span class="token operator">=</span><span class="token string">"{Binding ExpandedMenuCommand}"</span>
                         CommandParameter<span class="token operator">=</span><span class="token string">"expanded"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>StackPanel<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Image</span> Source<span class="token operator">=</span><span class="token string">"Views/Resources/expended-bar-black-64.png"</span>
                          Margin<span class="token operator">=</span><span class="token string">"5"</span> Width<span class="token operator">=</span><span class="token string">"32"</span> Height<span class="token operator">=</span><span class="token string">"32"</span>
                          HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>视图切换：首页<span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Button</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"Btn_HomePage"</span> Width<span class="token operator">=</span><span class="token string">"40"</span> Height<span class="token operator">=</span><span class="token string">"36"</span> FontSize<span class="token operator">=</span><span class="token string">"16"</span>
                   Style<span class="token operator">=</span><span class="token string">"{StaticResource IconButtonStyle}"</span> 
                   Command<span class="token operator">=</span><span class="token string">"{Binding SwitchViewCommand}"</span>
                   CommandParameter<span class="token operator">=</span><span class="token string">"UserChatView"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> Orientation<span class="token operator">=</span><span class="token string">"Horizontal"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Image</span> Source<span class="token operator">=</span><span class="token string">"Views/Resources/home-black-24.png"</span>
                             Margin<span class="token operator">=</span><span class="token string">"5"</span> Width<span class="token operator">=</span><span class="token string">"24"</span> Height<span class="token operator">=</span><span class="token string">"24"</span>
                             HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>视图切换：新聊天界面<span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Button</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"Btn_Chat"</span> Width<span class="token operator">=</span><span class="token string">"100"</span> Height<span class="token operator">=</span><span class="token string">"36"</span> FontSize<span class="token operator">=</span><span class="token string">"16"</span>
                          Style<span class="token operator">=</span><span class="token string">"{StaticResource IconButtonStyle}"</span> 
                          Command<span class="token operator">=</span><span class="token string">"{Binding SwitchViewCommand}"</span>
                          CommandParameter<span class="token operator">=</span><span class="token string">"NewUserChatView"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> Orientation<span class="token operator">=</span><span class="token string">"Horizontal"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Image</span> Source<span class="token operator">=</span><span class="token string">"Views/Resources/edit-black-24.png"</span>
                                Margin<span class="token operator">=</span><span class="token string">"5"</span> Width<span class="token operator">=</span><span class="token string">"24"</span> Height<span class="token operator">=</span><span class="token string">"24"</span>
                                HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">TextBlock</span>  Text<span class="token operator">=</span><span class="token string">"新聊天"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>模型列表<span class="token operator">--</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Label</span>  Foreground<span class="token operator">=</span><span class="token string">"#000000"</span> Margin<span class="token operator">=</span><span class="token string">"5"</span> FontSize<span class="token operator">=</span><span class="token string">"16"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> <span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">TextBlock</span> Foreground<span class="token operator">=</span><span class="token string">"#333333"</span>  Text<span class="token operator">=</span><span class="token string">"模型:"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Label<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">ComboBox</span> x<span class="token punctuation">:</span>Name<span class="token operator">=</span><span class="token string">"Cbx_ModelList"</span> 
                          Style<span class="token operator">=</span><span class="token string">"{StaticResource RoundComboBoxStyle}"</span> 
                          ItemsSource<span class="token operator">=</span><span class="token string">"{Binding MainModel.ModelListCollection}"</span>
                          SelectedItem<span class="token operator">=</span><span class="token string">"{Binding MainModel.SelectedModel}"</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ComboBox<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>WrapPanel<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第一行内容：右对齐内容<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">WrapPanel</span> Margin<span class="token operator">=</span><span class="token string">"0,0,0,0"</span> HorizontalAlignment<span class="token operator">=</span><span class="token string">"Right"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> <span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">Button</span> Width<span class="token operator">=</span><span class="token string">"36"</span> Height<span class="token operator">=</span><span class="token string">"36"</span>
                        Style<span class="token operator">=</span><span class="token string">"{StaticResource IconButtonStyle}"</span> 
                        Command<span class="token operator">=</span><span class="token string">"{Binding SwitchViewCommand}"</span>
                        CommandParameter<span class="token operator">=</span><span class="token string">"SystemSettingView"</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">StackPanel</span> Orientation<span class="token operator">=</span><span class="token string">"Horizontal"</span> Background<span class="token operator">=</span><span class="token string">"Transparent"</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">Image</span> Source<span class="token operator">=</span><span class="token string">"/Views/Resources/setting-64.png"</span> 
                            Width<span class="token operator">=</span><span class="token string">"24"</span> Height<span class="token operator">=</span><span class="token string">"24"</span>
                            HorizontalAlignment<span class="token operator">=</span><span class="token string">"Center"</span> VerticalAlignment<span class="token operator">=</span><span class="token string">"Center"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>StackPanel<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>WrapPanel<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>第二行内容：显示当前视图<span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ContentControl Grid<span class="token punctuation">.</span>Row<span class="token operator">=</span><span class="token string">"1"</span> Margin<span class="token operator">=</span><span class="token string">"5,5,5,5"</span>
                 Content<span class="token operator">=</span><span class="token string">"{Binding MainModel.CurrentView}"</span> 
                 HorizontalContentAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> 
                 VerticalContentAlignment<span class="token operator">=</span><span class="token string">"Stretch"</span> Grid<span class="token punctuation">.</span>RowSpan<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Grid<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Window<span class="token operator">&gt;</span>

</code></pre>
    <hr/>
    <hr/>
    <hr/>
    <hr/>
    <h2>
     <a id="_2750">
     </a>
     代码完结
    </h2>
    <p>
     <a href="https://github.com/timenodes/OfflineAI">
      附上项目地址：https://github.com/timenodes/OfflineAI
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333632363231382f:61727469636c652f64657461696c732f313436323037333131" class_="artid" style="display:none">
 </p>
</div>


