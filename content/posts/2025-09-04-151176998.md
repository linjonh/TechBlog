---
layout: post
title: "Grafana-多指标相乘"
date: 2025-09-04T10:29:21+0800
description: "PromQL多指标相乘的关键在于向量匹配。当0.045 * h9_daily_income{coin=&amp;quot;nock&amp;quot;} * h9_pool_price_cny{coin=&amp;quot;nock&amp;quot;}显示&amp;quot;No data&amp;quot;时，问题出在标签不匹配（如instance、job）。最佳解决方案是使用on(coin)明确指定匹配标签：0.045 * h9_daily_income{coin=&amp;quot;nock&amp;quot;} * on(coin) h9_pool_price"
keywords: "Grafana 多指标相乘"
categories: ['Grafana']
tags: ['数据可视化', '向量匹配', 'Promql', 'Grafana']
artid: "151176998"
arturl: "https://blog.csdn.net/u010953692/article/details/151176998"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=151176998
    alt: "Grafana-多指标相乘"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=151176998
featuredImagePreview: https://bing.ee123.net/img/rand?artid=151176998
cover: https://bing.ee123.net/img/rand?artid=151176998
image: https://bing.ee123.net/img/rand?artid=151176998
img: https://bing.ee123.net/img/rand?artid=151176998
---



# Grafana 多指标相乘



## PromQL中多指标相乘

PromQL表达式：

```shell
0.045 * h9_daily_income{coin="nock"} * h9_pool_price_cny{coin="nock"}

```

### 📈 基础：单指标运算

#### 常数与指标相乘

在PromQL中，常数与指标的乘法是最简单的运算：

```shell
# ✅ 简单有效
0.045 * h9_daily_income{coin="nock"}

```

### ⚠️ 挑战：多指标相乘

#### 初次尝试失败

```shell
# ❌ 可能显示 "No data"
0.045 * h9_daily_income{coin="nock"} * h9_pool_price_cny{coin="nock"}

```

三重乘法 ❌ 显示：“No data”

#### 问题根源

问题出现在**向量匹配**上。PromQL要求参与运算的时间序列必须能够正确匹配，  
**问题分析**：

* ✅ `coin` 标签匹配
* ❌ `instance` 标签不匹配
* ❌ `job` 标签不匹配  
  结果：默认匹配失败，返回空结果。

#### 方案1：on() 明确匹配标签 ⭐⭐⭐⭐⭐

**最推荐的解决方案**：

```promql
0.045 * h9_daily_income{coin="nock"} * on(coin) h9_pool_price_cny{coin="nock"}

```

**工作原理**：

* `on(coin)` 告诉PromQL只基于 `coin` 标签进行匹配
* 忽略其他所有标签的差异
* 确保具有相同 `coin` 值的序列能够参与运算



