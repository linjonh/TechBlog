---
layout: post
title: "Ubuntu-高级进阶教程"
date: 2025-03-08 10:22:49 +0800
description: "自由分享，禁止用于商业用途。"
keywords: "Ubuntu 高级进阶教程"
categories: ['Linux']
tags: ['数据库', '容器', 'Ubuntu', 'Python', 'Linux']
artid: "146111958"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146111958
    alt: "Ubuntu-高级进阶教程"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146111958
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146111958
cover: https://bing.ee123.net/img/rand?artid=146111958
image: https://bing.ee123.net/img/rand?artid=146111958
img: https://bing.ee123.net/img/rand?artid=146111958
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Ubuntu 高级进阶教程
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      适用对象：具备 Ubuntu 基础知识的开发者、运维工程师、系统管理员
     </strong>
    </p>
    <hr/>
    <h3>
     <a id="_4">
     </a>
     <strong>
      目录
     </strong>
    </h3>
    <ol>
     <li>
      内核编译与调优
     </li>
     <li>
      高级包管理
     </li>
     <li>
      系统安全加固
     </li>
     <li>
      网络高级配置
     </li>
     <li>
      存储与 RAID 管理
     </li>
     <li>
      自动化运维与脚本
     </li>
     <li>
      虚拟化与容器技术
     </li>
     <li>
      性能分析与优化
     </li>
     <li>
      故障排查与恢复
     </li>
     <li>
      附录：工具链与资源
     </li>
    </ol>
    <hr/>
    <h4>
     <a id="1__18">
     </a>
     <strong>
      1. 内核编译与调优
     </strong>
    </h4>
    <h5>
     <a id="11__19">
     </a>
     <strong>
      1.1 编译自定义内核
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装依赖  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> build-essential libncurses-dev bison flex libssl-dev  

<span class="token comment"># 下载内核源码（以 5.15 为例）  </span>
<span class="token function">wget</span> https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.15.tar.xz  
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> linux-5.15.tar.xz  
<span class="token builtin class-name">cd</span> linux-5.15  

<span class="token comment"># 配置内核（选择默认配置并自定义）  </span>
<span class="token function">make</span> oldconfig          <span class="token comment"># 基于当前系统配置  </span>
<span class="token function">make</span> menuconfig         <span class="token comment"># 图形化界面调整选项  </span>

<span class="token comment"># 编译与安装  </span>
<span class="token function">make</span> -j<span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span>         <span class="token comment"># 多线程编译  </span>
<span class="token function">sudo</span> <span class="token function">make</span> modules_install  
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>  

<span class="token comment"># 更新 GRUB  </span>
<span class="token function">sudo</span> <span class="token function">update-grub</span>  
</code></pre>
    <p>
     <strong>
      调优选项
     </strong>
     ：
    </p>
    <ul>
     <li>
      启用
      <code>
       CONFIG_PREEMPT
      </code>
      降低延迟（适合实时性要求高的场景）
     </li>
     <li>
      调整
      <code>
       CONFIG_HZ=1000
      </code>
      提升响应速度
     </li>
     <li>
      禁用未使用的驱动以减少内核体积
     </li>
    </ul>
    <h5>
     <a id="12_etcsysctlconf_46">
     </a>
     <strong>
      1.2 内核参数优化（/etc/sysctl.conf）
     </strong>
    </h5>
    <pre><code class="prism language-conf"># 提升网络性能  
net.core.rmem_max = 16777216  
net.core.wmem_max = 16777216  
net.ipv4.tcp_fin_timeout = 15  

# 优化文件系统  
vm.swappiness = 10  
fs.file-max = 2097152  
</code></pre>
    <p>
     应用配置：
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-p</span>  
</code></pre>
    <hr/>
    <h4>
     <a id="2__64">
     </a>
     <strong>
      2. 高级包管理
     </strong>
    </h4>
    <h5>
     <a id="21__65">
     </a>
     <strong>
      2.1 创建本地仓库
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装必要工具  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> reprepro gnupg  

<span class="token comment"># 创建仓库目录  </span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/myrepo/conf  
<span class="token function">cat</span> <span class="token operator">&gt;</span> /opt/myrepo/conf/distributions <span class="token operator">&lt;&lt;</span><span class="token string">EOF  
Codename: focal  
Architectures: amd64 arm64  
Components: main  
SignWith: YOUR_KEY_ID  
EOF</span>  

<span class="token comment"># 添加 DEB 包  </span>
reprepro includedeb focal /path/to/package.deb  

<span class="token comment"># 客户端配置  </span>
<span class="token builtin class-name">echo</span> <span class="token string">"deb http://your-server/myrepo focal main"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/myrepo.list  
</code></pre>
    <h5>
     <a id="22__AptPinning_86">
     </a>
     <strong>
      2.2 使用 Apt-Pinning
     </strong>
    </h5>
    <pre><code class="prism language-conf"># /etc/apt/preferences.d/99-mypriority  
Package: *  
Pin: release o=MyRepo  
Pin-Priority: 1001  
</code></pre>
    <hr/>
    <h4>
     <a id="3__96">
     </a>
     <strong>
      3. 系统安全加固
     </strong>
    </h4>
    <h5>
     <a id="31__AppArmorSELinux_97">
     </a>
     <strong>
      3.1 启用 AppArmor/SELinux
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装 AppArmor 工具  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> apparmor-utils  

<span class="token comment"># 强制模式配置  </span>
<span class="token function">sudo</span> aa-enforce /etc/apparmor.d/*  

<span class="token comment"># 查看状态  </span>
aa-status  
</code></pre>
    <h5>
     <a id="32_SSH__109">
     </a>
     <strong>
      3.2 SSH 安全加固
     </strong>
    </h5>
    <pre><code class="prism language-conf"># /etc/ssh/sshd_config  
PermitRootLogin no  
PasswordAuthentication no  
AllowUsers alice  
MaxAuthTries 3  
ClientAliveInterval 300  
</code></pre>
    <p>
     重启服务：
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl restart sshd  
</code></pre>
    <hr/>
    <h4>
     <a id="4__125">
     </a>
     <strong>
      4. 网络高级配置
     </strong>
    </h4>
    <h5>
     <a id="41_Bonding_126">
     </a>
     <strong>
      4.1 网络绑定（Bonding）
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装工具  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ifenslave  

<span class="token comment"># 配置（/etc/netplan/01-bond.yaml）  </span>
network:  
  bonds:  
    bond0:  
      interfaces: <span class="token punctuation">[</span>enp1s0, enp2s0<span class="token punctuation">]</span>  
      addresses: <span class="token punctuation">[</span><span class="token number">192.168</span>.1.100/24<span class="token punctuation">]</span>  
      gateway4: <span class="token number">192.168</span>.1.1  
      parameters:  
        mode: <span class="token number">802</span>.3ad  
        lacp-rate: fast  
</code></pre>
    <h5>
     <a id="42__WireGuard_VPN_143">
     </a>
     <strong>
      4.2 使用 WireGuard VPN
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> wireguard  

<span class="token comment"># 生成密钥对  </span>
wg genkey <span class="token operator">|</span> <span class="token function">tee</span> privatekey <span class="token operator">|</span> wg pubkey <span class="token operator">&gt;</span> publickey  

<span class="token comment"># 配置文件（/etc/wireguard/wg0.conf）  </span>
<span class="token punctuation">[</span>Interface<span class="token punctuation">]</span>  
PrivateKey <span class="token operator">=</span> <span class="token operator">&lt;</span>SERVER_PRIVATE_KEY<span class="token operator">&gt;</span>  
Address <span class="token operator">=</span> <span class="token number">10.8</span>.0.1/24  
ListenPort <span class="token operator">=</span> <span class="token number">51820</span>  

<span class="token punctuation">[</span>Peer<span class="token punctuation">]</span>  
PublicKey <span class="token operator">=</span> <span class="token operator">&lt;</span>CLIENT_PUBLIC_KEY<span class="token operator">&gt;</span>  
AllowedIPs <span class="token operator">=</span> <span class="token number">10.8</span>.0.2/32  
</code></pre>
    <hr/>
    <h4>
     <a id="5__RAID__164">
     </a>
     <strong>
      5. 存储与 RAID 管理
     </strong>
    </h4>
    <h5>
     <a id="51__RAID_5_165">
     </a>
     <strong>
      5.1 创建软 RAID 5
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">mdadm</span> <span class="token parameter variable">--create</span> /dev/md0 <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --raid-devices<span class="token operator">=</span><span class="token number">3</span> /dev/sdb /dev/sdc /dev/sdd  
<span class="token function">sudo</span> mkfs.ext4 /dev/md0  
<span class="token function">sudo</span> <span class="token function">mount</span> /dev/md0 /mnt/raid  
</code></pre>
    <h5>
     <a id="52_LVM__172">
     </a>
     <strong>
      5.2 LVM 高级操作
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 扩展逻辑卷  </span>
<span class="token function">sudo</span> lvextend <span class="token parameter variable">-L</span> +20G /dev/vg0/lv_data  
<span class="token function">sudo</span> resize2fs /dev/vg0/lv_data  

<span class="token comment"># 创建快照  </span>
<span class="token function">sudo</span> lvcreate <span class="token parameter variable">-s</span> <span class="token parameter variable">-n</span> snap_data <span class="token parameter variable">-L</span> 5G /dev/vg0/lv_data  
</code></pre>
    <hr/>
    <h4>
     <a id="6__184">
     </a>
     <strong>
      6. 自动化运维与脚本
     </strong>
    </h4>
    <h5>
     <a id="61__Ansible_185">
     </a>
     <strong>
      6.1 使用 Ansible
     </strong>
    </h5>
    <pre><code class="prism language-yaml"><span class="token comment"># playbook.yml  </span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webservers  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Nginx  
      <span class="token key atrule">apt</span><span class="token punctuation">:</span>  
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx  
        <span class="token key atrule">state</span><span class="token punctuation">:</span> latest  
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Start Service  
      <span class="token key atrule">systemd</span><span class="token punctuation">:</span>  
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx  
        <span class="token key atrule">state</span><span class="token punctuation">:</span> started  
</code></pre>
    <p>
     执行命令：
    </p>
    <pre><code class="prism language-bash">ansible-playbook playbook.yml  
</code></pre>
    <h5>
     <a id="62__Systemd__204">
     </a>
     <strong>
      6.2 编写 Systemd 服务
     </strong>
    </h5>
    <pre><code class="prism language-conf"># /etc/systemd/system/my-service.service  
[Unit]  
Description=My Custom Service  

[Service]  
ExecStart=/usr/local/bin/my-script.sh  
Restart=on-failure  

[Install]  
WantedBy=multi-user.target  
</code></pre>
    <p>
     启用服务：
    </p>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> my-service  
</code></pre>
    <hr/>
    <h4>
     <a id="7__224">
     </a>
     <strong>
      7. 虚拟化与容器技术
     </strong>
    </h4>
    <h5>
     <a id="71_KVM__225">
     </a>
     <strong>
      7.1 KVM 虚拟化
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装 KVM  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> qemu-kvm libvirt-daemon-system  

<span class="token comment"># 创建虚拟机  </span>
virt-install <span class="token punctuation">\</span>  
  <span class="token parameter variable">--name</span> ubuntu-vm <span class="token punctuation">\</span>  
  <span class="token parameter variable">--ram</span> <span class="token number">2048</span> <span class="token punctuation">\</span>  
  <span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/var/lib/libvirt/images/ubuntu.qcow2,size<span class="token operator">=</span><span class="token number">20</span> <span class="token punctuation">\</span>  
  <span class="token parameter variable">--vcpus</span> <span class="token number">2</span> <span class="token punctuation">\</span>  
  --os-type linux <span class="token punctuation">\</span>  
  --os-variant ubuntu22.04 <span class="token punctuation">\</span>  
  <span class="token parameter variable">--network</span> <span class="token assign-left variable">bridge</span><span class="token operator">=</span>virbr0 <span class="token punctuation">\</span>  
  <span class="token parameter variable">--graphics</span> none <span class="token punctuation">\</span>  
  <span class="token parameter variable">--console</span> pty,target_type<span class="token operator">=</span>serial <span class="token punctuation">\</span>  
  <span class="token parameter variable">--location</span> <span class="token string">'http://archive.ubuntu.com/ubuntu/dists/jammy/main/installer-amd64/'</span>  
</code></pre>
    <h5>
     <a id="72__Docker__244">
     </a>
     <strong>
      7.2 构建 Docker 镜像
     </strong>
    </h5>
    <pre><code class="prism language-dockerfile"># Dockerfile  
FROM ubuntu:22.04  
RUN apt update &amp;&amp; apt install -y nginx  
EXPOSE 80  
CMD ["nginx", "-g", "daemon off;"]  
</code></pre>
    <p>
     构建命令：
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> my-nginx <span class="token builtin class-name">.</span>  
</code></pre>
    <hr/>
    <h4>
     <a id="8__259">
     </a>
     <strong>
      8. 性能分析与优化
     </strong>
    </h4>
    <h5>
     <a id="81__Perf__260">
     </a>
     <strong>
      8.1 使用 Perf 工具
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 安装  </span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> linux-tools-common linux-tools-generic  

<span class="token comment"># 分析 CPU 热点  </span>
perf record <span class="token parameter variable">-g</span> <span class="token parameter variable">-F</span> <span class="token number">99</span> <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">$(</span>pgrep nginx<span class="token variable">)</span></span>  
perf report  
</code></pre>
    <h5>
     <a id="82__IO__270">
     </a>
     <strong>
      8.2 调整 I/O 调度器
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 查看当前调度器  </span>
<span class="token function">cat</span> /sys/block/sda/queue/scheduler  

<span class="token comment"># 修改为 deadline 调度器（SSD 推荐）  </span>
<span class="token builtin class-name">echo</span> <span class="token string">'deadline'</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /sys/block/sda/queue/scheduler  
</code></pre>
    <hr/>
    <h4>
     <a id="9__281">
     </a>
     <strong>
      9. 故障排查与恢复
     </strong>
    </h4>
    <h5>
     <a id="91__GRUB__282">
     </a>
     <strong>
      9.1 修复 GRUB 引导
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token comment"># 进入 Live CD 环境  </span>
<span class="token function">sudo</span> <span class="token function">mount</span> /dev/sda1 /mnt  
<span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">--bind</span> /dev /mnt/dev  
<span class="token function">sudo</span> <span class="token function">chroot</span> /mnt  
grub-install /dev/sda  
<span class="token function">update-grub</span>  
</code></pre>
    <h5>
     <a id="92_ext4__292">
     </a>
     <strong>
      9.2 恢复误删文件（ext4 文件系统）
     </strong>
    </h5>
    <pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> extundelete  
extundelete /dev/sda1 --restore-file /home/user/important.txt  
</code></pre>
    <hr/>
    <h4>
     <a id="10__300">
     </a>
     <strong>
      10. 附录：工具链与资源
     </strong>
    </h4>
    <h5>
     <a id="101__301">
     </a>
     <strong>
      10.1 推荐工具
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       监控
      </strong>
      ：Prometheus + Grafana
     </li>
     <li>
      <strong>
       日志
      </strong>
      ：ELK Stack (Elasticsearch, Logstash, Kibana)
     </li>
     <li>
      <strong>
       调试
      </strong>
      ：strace, ltrace, gdb
     </li>
     <li>
      <strong>
       网络分析
      </strong>
      ：tcpdump, Wireshark, nmap
     </li>
    </ul>
    <h5>
     <a id="102__307">
     </a>
     <strong>
      10.2 学习资源
     </strong>
    </h5>
    <ul>
     <li>
      <strong>
       官方文档
      </strong>
      ：
      <a href="https://ubuntu.com/server/docs" rel="nofollow">
       Ubuntu Server Guide
      </a>
     </li>
     <li>
      <strong>
       书籍
      </strong>
      ：《The Linux Programming Interface》《UNIX and Linux System Administration Handbook》
     </li>
     <li>
      <strong>
       社区
      </strong>
      ：
      <a href="https://serverfault.com" rel="nofollow">
       Server Fault
      </a>
      ,
      <a href="https://ubuntuforums.org" rel="nofollow">
       Ubuntu Forums
      </a>
     </li>
    </ul>
    <hr/>
    <p>
     <strong>
      注意
     </strong>
     ：
    </p>
    <ul>
     <li>
      所有涉及系统级修改的操作，建议提前备份数据。
     </li>
     <li>
      内核编译、RAID/LVM 操作等高风险任务，需在测试环境验证后再应用于生产环境。
     </li>
    </ul>
    <p>
     <strong>
      更新日期
     </strong>
     ：2023年10月
     <br/>
     <strong>
      版权声明
     </strong>
     ：自由分享，禁止用于商业用途。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33303737363134372f:61727469636c652f64657461696c732f313436313131393538" class_="artid" style="display:none">
 </p>
</div>


