---
layout: post
title: "ç›‘å¬-RabbitMQ-å»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°OpenFeign-è·¯å¾„å‚æ•°ä¼ å…¥æ–œæ æ— æ³•æ­£ç¡®è½¬ä¹‰"
date: 2025-03-05 23:45:53 +08:00
description: "ç›‘å¬ RabbitMQ å»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°ï¼Œç”¨ OpenFeign åš http å®¢æˆ·ç«¯ï¼Œå¤„ç† OpenFeign è·¯å¾„å‚æ•°ä¼ å…¥æ–œæ æ— æ³•æ­£å¸¸è½¬ä¹‰çš„é—®é¢˜"
keywords: "ç›‘å¬ RabbitMQ å»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°ã€OpenFeign è·¯å¾„å‚æ•°ä¼ å…¥æ–œæ æ— æ³•æ­£ç¡®è½¬ä¹‰"
categories: ['åç«¯è¿›é˜¶å®è·µ']
tags: ['åˆ†å¸ƒå¼', 'Rabbitmq', 'Openfeign']
artid: "146055109"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146055109
    alt: "ç›‘å¬-RabbitMQ-å»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°OpenFeign-è·¯å¾„å‚æ•°ä¼ å…¥æ–œæ æ— æ³•æ­£ç¡®è½¬ä¹‰"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146055109
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146055109
cover: https://bing.ee123.net/img/rand?artid=146055109
image: https://bing.ee123.net/img/rand?artid=146055109
img: https://bing.ee123.net/img/rand?artid=146055109
---

# ç›‘å¬ RabbitMQ å»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°ã€OpenFeign è·¯å¾„å‚æ•°ä¼ å…¥æ–œæ æ— æ³•æ­£ç¡®è½¬ä¹‰
## èƒŒæ™¯
[ã€MQã€‘ä¸€å¥—ä¸ºæµ·é‡æ¶ˆæ¯å’Œé«˜å¹¶å‘çƒ­ç‚¹æ¶ˆæ¯ï¼Œæä¾›é«˜å¯ç”¨ç²¾å‡†å»¶æ—¶æœåŠ¡çš„è§£å†³æ–¹æ¡ˆ](https://blog.csdn.net/Carefree_State/article/details/145536456?spm=1001.2014.3001.5502)
æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯ç›‘å¬ RabbitMQ ä¸€ä¸ªå»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°ï¼Œè€Œ RabbitTemplate æ˜¯ä¸å­˜åœ¨å¯¹åº”çš„æ–¹æ³•æ¥è·å–çš„ã€‚
è€Œæˆ‘ä»¬åœ¨ RabbitMQ çš„æ§åˆ¶å°å´å¯ä»¥å‘ç°å»¶æ—¶äº¤æ¢æœºçš„æ¶ˆæ¯æ•°ï¼Œæ‰€ä»¥å…¶å¼€æ”¾çš„ http-api é‡Œå­˜åœ¨æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œé€šè¿‡æŠ“åŒ…å¯å¾—ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/9de916ca7ac64359b9570a02aab29ed9.png)
è€Œæˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ªåŒ…ï¼Œæ„é€ è¯·æ±‚ï¼ˆæŠ“åŒ…+åˆ†æçš„æŠ€å·§è¿™é‡Œä¸åšä»‹ç»ï¼‰
> å½“ç„¶ä½ å®Œå…¨å¯ä»¥å»çœ‹ RabbitMQ çš„ http-api å¼€æ”¾æ–‡æ¡£ï¼Œä½†æ˜¯æˆ‘è§‰å¾—æœ‰ç‚¹å¤šï¼Œè¿˜ä¸å¦‚ç›´æ¥æŠ“åŒ…
**URLï¼š**
* `http://rabbithost:15672/api/exchanges/{virtualHost}/{exchange}?msg_rates_age=60&msg_rates_incr=5`
**Methodï¼š**
* `GET`
**Headerï¼š**
* Authorization: `"Basic " + EncryptUtil.encodeBase64(String.format("%s:%s", rabbitMQConfig.getUsername(), rabbitMQConfig.getPassword()));`
**å¾ˆå¿«æˆ‘ä»¬å°±èƒ½å†™ä¸€ä¸ª OpenFeign å®¢æˆ·ç«¯ï¼š**
@FeignClient(name = "rabbitmq-service", url = "${okr.mq.http-api}")
public interface RabbitMQHttpFeignClient {
@GetMapping("/exchanges/{virtualHost}/{exchange}?msg_rates_age=60&msg_rates_incr=5")
DelayExchangeVO getMessagesDelayed(@RequestHeader(HttpHeaders.AUTHORIZATION) String authorization,
@PathVariable("virtualHost") String virtualHost,
@PathVariable("exchange") String exchange);
}
ä½†æ˜¯ä½ ä¼šå‘ç°ï¼ŒvirtualHost æ˜¯å¸¦ `/` çš„ï¼Œä½†æ˜¯æœ€ç»ˆçš„ url å¹¶æ²¡æœ‰è½¬ä¹‰ï¼Œå¯¼è‡´è·¯ç”±å‡ºé”™æŠ¥äº† 404
* 400 æ˜¯å‚æ•°æœªé€šè¿‡éªŒè¯ã€401 æœªé€šè¿‡èº«ä»½è®¤è¯ã€403 æ— æƒé™
## å…ˆè¯´ç»“è®ºï¼ï¼ï¼
é…ç½®ä¸€ä¸ª Contract ï¼ˆåè®®ï¼Œçº¦å®šï¼‰ï¼Œå¹¶è®¾ç½® decodeSlash ä¸º false ï¼
@Component
public class OpenFeignConfig {
@Bean
public Contract notdecodeSlashContract(){
// æ— è‡ªå®šä¹‰å¤„ç†å™¨ã€é»˜è®¤çš„ ConversionServiceã€å–æ¶ˆ %2F -> / çš„è§£ç 
return new SpringMvcContract(Collections.emptyList(), new DefaultConversionService(), Boolean.FALSE);
}
}
decodeSlashï¼Œç›´è¯‘å°±æ˜¯â€œæ–œæ è§£ç â€
encode: `/` â†’ `%2F`
decode: `%2F` â†’ `/`
è€Œæˆ‘ä»¬å°±æ˜¯é˜»æ­¢ `%2F` â†’ `/` ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é˜»æ­¢å‘¢ï¼Ÿ
## é—®é¢˜åˆ†æ
é¦–å…ˆæˆ‘ä»¬å¯èƒ½ä¼šæƒ³ï¼Œå®ƒæ˜¯å¦‚ä½•è½¬ä¹‰çš„ï¼Œæ˜¯ä¼ å…¥çš„æ—¶å€™è½¬ä¹‰ï¼Œè¿˜æ˜¯æœ€ç»ˆä¸€èµ·è½¬ä¹‰ï¼š
å¦‚æœæ˜¯æœ€ç»ˆä¸€èµ·è½¬ä¹‰ï¼Œé‚£ `/` å¿…ç„¶ä¸èƒ½è¢«è½¬ä¹‰ï¼Œå¦åˆ™é‚£äº›è·¯ç”±éƒ½ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥å¦‚æœæ˜¯æœ€ç»ˆè½¬ä¹‰ï¼Œæ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼š
è¿™é‡Œå†™äº†ä¸ªç®€å•çš„æ–¹æ³•ï¼Œæ–¹ä¾¿ç†è§£
public static

String buildUrl(String baseUrl, Map> queryParams, Map pathParams) {
queryParams = Optional.ofNullable(queryParams).orElseGet(Map::of);
pathParams = Optional.ofNullable(pathParams).orElseGet(Map::of);
return UriComponentsBuilder
.fromHttpUrl(baseUrl)
.queryParams(new LinkedMultiValueMap<>(queryParams))
.buildAndExpand(pathParams)
.encode() // å¼€å¯è¯‘ç æ¨¡å¼
.toUriString();
}
å¦‚æœåœ¨ä¼ å…¥çš„æ—¶å€™è½¬ä¹‰ï¼Œæ‰èƒ½å®ç°æˆ‘ä»¬çš„æ•ˆæœï¼š
public static

String buildUrl(String baseUrl, Map> queryParams, Map pathParams) {
queryParams = Optional.ofNullable(queryParams).orElseGet(Map::of);
pathParams = Optional.ofNullable(pathParams).orElseGet(Map::of);
return UriComponentsBuilder
.fromHttpUrl(baseUrl)
.encode() // å¼€å¯è¯‘ç æ¨¡å¼ï¼Œè¿™é‡Œä¹‹åè·¯å¾„å‚æ•°ï¼Œ/ ä¹Ÿä¼šè¢«è½¬ä¹‰ä¸º %2Fï¼
.queryParams(new LinkedMultiValueMap<>(queryParams))
.buildAndExpand(pathParams)
.toUriString();
}
é‚£ OpenFeign æ˜¯å“ªç§å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬æ²¡çœ‹æºç ï¼Œæˆ‘ä»¬å¯èƒ½æ²¡æ³•åˆ¤æ–­ï¼Œä½†æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒOpenFeign åœ¨è§£æè·¯å¾„å‚æ•°çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯
PathVariableParameterProcessor
å‚è€ƒæ–‡ç« ï¼š[æ–‡ç« ](https://blog.csdn.net/qq_34623557/article/details/125490493?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522ad419b8755f492410cd82465f56d3413%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=ad419b8755f492410cd82465f56d3413&biz_id=0&utm_medium=distribute.pc_search_result.none-
task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-125490493-null-
null.nonecase&utm_term=feign&spm=1018.2226.3001.4450)
é€šè¿‡è‡ªå®šä¹‰æ³¨è§£ + è‡ªå®šä¹‰å¤„ç†å™¨çš„æ–¹å¼ï¼Œå¤„ç†è¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡ï¼š
`data.indexToExpander().put(context.getParameterIndex(), o ->
URLEncoder.encode(String.valueOf(o), Charset.defaultCharset());`
æˆ‘ä»¬ç»™ {name} å¯¹åº”çš„ index æä¾›äº†ä¸€ä¸ªè§£æå™¨ï¼Œä½†æ˜¯è²Œä¼¼æ²¡å•¥ç”¨ï¼Œå¦‚æœè¿›è¡ŒåŒé‡ç¼–ç ï¼Œå¯¼è‡´ `%` ä¹Ÿä¹Ÿè¢«è½¬ä¹‰äº†ï¼Œä½†å¦‚æœåªæ˜¯ä¸€é‡ç¼–ç ï¼Œæœ€ç»ˆ `/`
è¿˜æ˜¯ä»¥ `/` çš„å½¢å¼å‡ºç°
**è¿™ä¸€åº¦è®©æˆ‘è§‰å¾—æ˜¯ç„å­¦ï¼**
ä½†æˆ‘å¯¹æ¯”äº† PathVariableParameterProcessor
ç±»çš„å®ç°ï¼Œå‘ç°å…¶å¹¶æ²¡æœ‰ä¸“é—¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œæ‰€ä»¥æˆ‘çŒœæµ‹åº•å±‚æ˜¯å®šç„¶ç¼–ç äº†çš„ï¼Œæ‰€ä»¥æˆ‘è¿›è¡Œäº†è°ƒè¯•ï¼Œä¸€æ­¥æ­¥æ‰¾åˆ°äº†å…³é”®ä»£ç ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/b5f91b5c71424bbd80b4abd4de3a5210.png)
ä½ ä¼šå‘ç°ï¼Œå¦‚æœä¼ å…¥ `/` ä¼šè¢«è½¬ä¹‰æˆ `%2F` ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ å…¥æ—¶ç¡®å®å·²ç»ç¼–ç äº†ï¼Œä½ ç”šè‡³å¯ä»¥å®ç°ä¼ å…¥ `%2F`
ä½†å¹¶è®¾ç½®å…¶å·²ç¼–ç ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡ç¼–ç ï¼Œç­‰ç­‰æ— è®ºå¦‚ä½•å„ç§æ–¹å¼è®©å­—ç¬¦ä¸²ä¸º `%2F`
ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå±æ€§ encodeSlashï¼Œå¦‚æœä¸º falseï¼Œåˆ™å°†æœ€ç»ˆç»“æœçš„ `%2F` ç»™é‡æ–°è§£ç æˆ `/`
* è¯´å®è¯æˆ‘å®Œå…¨ä¸çŸ¥é“ä¸ºå•¥è¦è¿™æ ·ï¼Œå¤ªæ”¾å‰‘äº†ğŸ¤£
* å¦‚æœæ˜¯è·¯å¾„å‚æ•°ä¹Ÿæ˜¯ä¸ª uriï¼Œä¹Ÿæœ‰è¿™æ ·çš„ç¼–ç¨‹æ–¹å¼ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¾ˆä¸è§„èŒƒ
è¿™ä¹Ÿæ˜¯æˆ‘ä¸ç†Ÿæ‚‰ SpringMvcContract å¯¼è‡´çš„å•¦ï¼Œä¸çŸ¥é“è¿˜æœ‰è¿™ä¹ˆä¸€ä¸ªå‚æ•° decodeSlash
`new SpringMvcContract(Collections.emptyList(), new
DefaultConversionService(), false)`
decodeSlash è®¾ç½®ä¸º false åï¼ŒencodeSlash å°±ä¸º trueï¼Œ`%2F` å°±ä¸ä¼šé‡æ–°è§£ç æˆ `/`
äº†ï¼Œæœ€ç»ˆä¹Ÿå°±èƒ½è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸçš„æ•ˆæœäº†