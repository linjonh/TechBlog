---
layout: post
title: "微信小程序获取个人头像和昵称,和地图选点功能"
date: 2022-02-26 10:46:07 +0800
description: "微信小程序获取头像昵称，地图选点_如何让小程序获得头像"
keywords: "如何让小程序获得头像"
categories: ['Js']
tags: ['微信小程序', '小程序']
artid: "123145918"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=123145918
    alt: "微信小程序获取个人头像和昵称,和地图选点功能"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=123145918
featuredImagePreview: https://bing.ee123.net/img/rand?artid=123145918
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     微信小程序获取个人头像和昵称，和地图选点功能
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      微信小程序获取个人头像和昵称，有技巧
      <br/>
      1.可以直接获取
      <br/>
      2.通过用户点击获取
      <br/>
      过程中，有什么问题，可以加我微信号yizheng369探讨
     </p>
    </blockquote>
    <h3>
     <a id="_5">
     </a>
     先分析
    </h3>
    <p>
     这里面隐含了很多默认的规则，大家要注意：
    </p>
    <p>
     <strong>
      1.可以直接获取
     </strong>
     ：
     <br/>
     这个要满足的条件是一定要按照微信官方给出的写法来写。这个应该是微信为了安全考虑，防止我们将用户信息用于其他违法用途吧。只能这样写。
    </p>
    <p>
     （1）直接获取：来个最简单写法
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/24ca49f683d461700e7afd3609a5f4bf.png">
      <br/>
      只需这两句即可
     </img>
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span>open<span class="token operator">-</span>data type<span class="token operator">=</span><span class="token string">"userAvatarUrl"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>open<span class="token operator">-</span>data<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>open<span class="token operator">-</span>data type<span class="token operator">=</span><span class="token string">"userNickName"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>open<span class="token operator">-</span>data<span class="token operator">&gt;</span>
</code></pre>
    <hr/>
    <p>
     （2）直接获取：复杂写法：（源码在文章最后）
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9b4b09d310da9a6e38cac2442f9a9606.png"/>
    </p>
    <p>
     这种直接获得的最大好处是，是非常便利的，不用自己调方法去获得了。
    </p>
    <hr/>
    <p>
     但是，有些网友觉得这种方法不够帅，不够装逼
     <br/>
     那就用第二种：
     <strong>
      通过方法获取
     </strong>
     。
    </p>
    <p>
     <strong>
      2.通过方法获取
     </strong>
     ：
     <br/>
     （这个有个问题，就是一定要通过用户点击一个按钮，然后再触发
     <code>
      wx.getUserProfile
     </code>
     方法获取到。）
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/043b332a37e22443c1651b1fd25b9653.png"/>
    </p>
    <blockquote>
     <p>
      **注意：**有些网友就想我直接调用
      <code>
       wx.getUserProfile
      </code>
      能获取到吗？
      <br/>
      回答：不行。
      <br/>
      微信规定，只能通过用户点击【授权头像昵称】这个按钮，然后触发
      <code>
       wx.getUserProfile
      </code>
      方法，才能拿到正确的头像数据。
      <br/>
      自己随便在页面上写一个按钮，然后
      <code>
       bindtap="getUserProfile"
      </code>
      绑定这个方法就行了，
      <code>
       getUserProfile
      </code>
      这个方法的具体逻辑在下面
     </p>
    </blockquote>
    <blockquote>
     <p>
      过程中，有什么问题，可以加我微信号yizheng369探讨
      <br/>
      我在微信小程序调用
      <a href="https://lbs.qq.com/miniProgram/plugin/pluginGuide/locationPicker" rel="nofollow">
       <code>
        地图选点功能
       </code>
      </a>
      也颇有感想喔
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5136794b4ea19a4ce0139ae419830330.png"/>
     </p>
    </blockquote>
    <h3>
     <a id="_44">
     </a>
     获取头像和昵称：官方源码
    </h3>
    <p>
     // index.js
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// index.js</span>
<span class="token comment">// 获取应用实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    motto<span class="token operator">:</span> <span class="token string">'Hello World'</span><span class="token punctuation">,</span>
    userInfo<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    hasUserInfo<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否已经获取到了</span>
    canIUse<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 能不能使用  另外一种写法  wx.canIUse('button.open-type.getUserInfo'),</span>
    canIUseGetUserProfile<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 该版本微信有GetUserProfile这个方法吗？</span>
    canIUseOpenData<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 我能直接使用微信个人的公开数据吗？-（包括头像我昵称） // 如需尝试获取用户信息可改为false </span>
    <span class="token comment">// canIUseOpenData: true 可以直接获取到</span>
    <span class="token comment">// canIUseOpenData: false 用用户点击才能获取到</span>
    <span class="token comment">// 另一种写法 canIUseOpenData: wx.canIUse('open-data.type.userAvatarUrl') &amp;&amp; wx.canIUse('open-data.type.userNickName')</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 事件处理函数</span>
  <span class="token function">bindViewTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      url<span class="token operator">:</span> <span class="token string">'../logs/logs'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span>getUserProfile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"当前微信版本有wx.getUserProfile："</span><span class="token punctuation">,</span>wx<span class="token punctuation">.</span>getUserProfile<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        canIUseGetUserProfile<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 推荐使用wx.getUserProfile获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认，开发者妥善保管用户快速填写的头像昵称，避免重复弹窗</span>
    wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      desc<span class="token operator">:</span> <span class="token string">'展示用户信息'</span><span class="token punctuation">,</span> <span class="token comment">// 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          userInfo<span class="token operator">:</span> res<span class="token punctuation">.</span>userInfo<span class="token punctuation">,</span>
          hasUserInfo<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 不推荐使用getUserInfo获取用户信息，预计自2021年4月13日起，getUserInfo将不再弹出弹窗，并直接返回匿名的用户个人信息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      userInfo<span class="token operator">:</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>userInfo<span class="token punctuation">,</span>
      hasUserInfo<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
    <p>
     // index.wxml
    </p>
    <pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>index<span class="token punctuation">.</span>wxml<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"userinfo"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>block wx<span class="token operator">:</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"{<!-- -->{canIUseOpenData}}"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"userinfo-avatar"</span> bindtap<span class="token operator">=</span><span class="token string">"bindViewTap"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>open<span class="token operator">-</span>data type<span class="token operator">=</span><span class="token string">"userAvatarUrl"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>open<span class="token operator">-</span>data<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>open<span class="token operator">-</span>data type<span class="token operator">=</span><span class="token string">"userNickName"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>open<span class="token operator">-</span>data<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>block wx<span class="token operator">:</span>elif<span class="token operator">=</span><span class="token string">"{<!-- -->{!hasUserInfo}}"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button wx<span class="token operator">:</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"{<!-- -->{canIUseGetUserProfile}}"</span> bindtap<span class="token operator">=</span><span class="token string">"getUserProfile"</span><span class="token operator">&gt;</span> 获取头像昵称 <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button wx<span class="token operator">:</span>elif<span class="token operator">=</span><span class="token string">"{<!-- -->{canIUse}}"</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">"getUserInfo"</span> bindgetuserinfo<span class="token operator">=</span><span class="token string">"getUserInfo"</span><span class="token operator">&gt;</span> 获取头像昵称 <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>view wx<span class="token operator">:</span><span class="token keyword">else</span><span class="token operator">&gt;</span> 请使用<span class="token number">1.4</span><span class="token number">.4</span>及以上版本基础库 <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>block wx<span class="token operator">:</span><span class="token keyword">else</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>image bindtap<span class="token operator">=</span><span class="token string">"bindViewTap"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"userinfo-avatar"</span> src<span class="token operator">=</span><span class="token string">"{<!-- -->{userInfo.avatarUrl}}"</span> mode<span class="token operator">=</span><span class="token string">"cover"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"userinfo-nickname"</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>userInfo<span class="token punctuation">.</span>nickName<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>block<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>view <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"usermotto"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>text <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"user-motto"</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>motto<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>text<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>

</code></pre>
    <p>
     // index.wxss
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">/**index.wxss**/</span>
<span class="token punctuation">.</span>userinfo <span class="token punctuation">{<!-- --></span>
  display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
  flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span>
  align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
  color<span class="token operator">:</span> #aaa<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>userinfo<span class="token operator">-</span>avatar <span class="token punctuation">{<!-- --></span>
  overflow<span class="token operator">:</span> hidden<span class="token punctuation">;</span>
  width<span class="token operator">:</span> <span class="token number">128</span>rpx<span class="token punctuation">;</span>
  height<span class="token operator">:</span> <span class="token number">128</span>rpx<span class="token punctuation">;</span>
  margin<span class="token operator">:</span> <span class="token number">20</span>rpx<span class="token punctuation">;</span>
  <span class="token comment">/* border-radius: 50%; */</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>usermotto <span class="token punctuation">{<!-- --></span>
  margin<span class="token operator">-</span>top<span class="token operator">:</span> <span class="token number">200</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f7975616e5f3631383835392f:61727469636c652f64657461696c732f313233313435393138" class_="artid" style="display:none">
 </p>
</div>


