---
layout: post
title: "算法OJN-皇后问题回溯剪枝C实现N-Queens"
date: 2025-03-07 00:31:49 +0800
description: "通过回溯算法解决了 N-皇后问题，能够找到所有可能的解。代码中使用了递归和剪枝技术，确保高效地搜索所有可能的棋盘配置。"
keywords: "⭐算法OJ⭐N-皇后问题【回溯剪枝】（C++实现）N-Queens"
categories: ['算法Oj']
tags: ['算法', '剪枝', 'C']
artid: "146083103"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146083103
    alt: "算法OJN-皇后问题回溯剪枝C实现N-Queens"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146083103
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146083103
cover: https://bing.ee123.net/img/rand?artid=146083103
image: https://bing.ee123.net/img/rand?artid=146083103
img: https://bing.ee123.net/img/rand?artid=146083103
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ⭐算法OJ⭐N-皇后问题【回溯剪枝】（C++实现）N-Queens
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     问题描述
    </h3>
    <p>
     The
     <strong>
      n-queens
     </strong>
     puzzle is the problem of placing
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        n 
        
       
      
        n
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          n
         </span>
        </span>
       </span>
      </span>
     </span>
     queens on an
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        n 
        
       
         × 
        
       
         n 
        
       
      
        n \times n
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;">
         </span>
         <span class="mord mathnormal">
          n
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ×
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.4306em;">
         </span>
         <span class="mord mathnormal">
          n
         </span>
        </span>
       </span>
      </span>
     </span>
     chessboard such that no two queens attack each other.
    </p>
    <p>
     Given an integer
     <code>
      n
     </code>
     , return all distinct solutions to the
     <em>
      <strong>
       n-queens puzzle
      </strong>
     </em>
     . You may return the answer in
     <strong>
      any order
     </strong>
     .
    </p>
    <p>
     Each solution contains a distinct board configuration of the n-queens’ placement, where
     <code>
      'Q'
     </code>
     and
     <code>
      '.'
     </code>
     both indicate a queen and an empty space, respectively.
    </p>
    <p>
     在
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        N 
        
       
         × 
        
       
         N 
        
       
      
        N \times N
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
         <span class="mbin">
          ×
         </span>
         <span class="mspace" style="margin-right: 0.2222em;">
         </span>
        </span>
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
        </span>
       </span>
      </span>
     </span>
     的棋盘上放置
     <span class="katex--inline">
      <span class="katex">
       <span class="katex-mathml">
        N 
        
       
      
        N
       </span>
       <span class="katex-html">
        <span class="base">
         <span class="strut" style="height: 0.6833em;">
         </span>
         <span class="mord mathnormal" style="margin-right: 0.109em;">
          N
         </span>
        </span>
       </span>
      </span>
     </span>
     个皇后，使得它们互不攻击。皇后可以攻击同一行、同一列或同一对角线上的任何棋子。因此，需要找到所有可能的皇后位置，满足这些条件。
    </p>
    <p>
     <strong>
      Example 1:
     </strong>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9846ad05cc744f4883fbca0cceab59bf.png"/>
    </p>
    <pre><code>Input: n = 4
Output: [[".Q..","...Q","Q...","..Q."],["..Q.","Q...","...Q",".Q.."]]
Explanation: There exist two distinct solutions to the 4-queens puzzle as shown above
</code></pre>
    <p>
     <strong>
      Example 2:
     </strong>
    </p>
    <pre><code>Input: n = 1
Output: [["Q"]]
</code></pre>
    <h3>
     <a id="_22">
     </a>
     关键点
    </h3>
    <ul>
     <li>
      棋盘大小：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         N 
         
        
          × 
         
        
          N 
         
        
       
         N \times N
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
          <span class="mbin">
           ×
          </span>
          <span class="mspace" style="margin-right: 0.2222em;">
          </span>
         </span>
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
         </span>
        </span>
       </span>
      </span>
      的棋盘。
     </li>
     <li>
      皇后数量：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         N 
         
        
       
         N
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
         </span>
        </span>
       </span>
      </span>
      个皇后。
     </li>
     <li>
      攻击规则：
      <ul>
       <li>
        不能在同一行。
       </li>
       <li>
        不能在同一列。
       </li>
       <li>
        不能在同一对角线。
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="_29">
     </a>
     解决方法
    </h3>
    <h4>
     <a id="_30">
     </a>
     回溯算法
    </h4>
    <ul>
     <li>
      逐行放置皇后。
     </li>
     <li>
      每放置一个皇后，检查是否与已放置的皇后冲突。
     </li>
     <li>
      如果冲突，回溯并尝试下一个位置。
     </li>
     <li>
      找到所有可能的解。
     </li>
    </ul>
    <h4>
     <a id="_35">
     </a>
     递归实现
    </h4>
    <ul>
     <li>
      使用递归尝试每一行的每个位置。
     </li>
     <li>
      通过剪枝减少无效搜索。
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 检查当前位置 (row, col) 是否可以放置皇后</span>
<span class="token keyword">bool</span> <span class="token function">isSafe</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token operator">&amp;</span> board<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 检查列</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> row<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'Q'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 检查左上对角线</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> row<span class="token punctuation">,</span> j <span class="token operator">=</span> col<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">,</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'Q'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 检查右上对角线</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> row<span class="token punctuation">,</span> j <span class="token operator">=</span> col<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">,</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'Q'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 回溯函数</span>
<span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token operator">&amp;</span> board<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> result<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 如果当前行是最后一行，说明找到一个解</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将当前棋盘配置存入结果</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 尝试在当前行的每一列放置皇后</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> col <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> col<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSafe</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> board<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果当前位置安全</span>
            board<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'Q'</span><span class="token punctuation">;</span> <span class="token comment">// 放置皇后</span>
            <span class="token function">solve</span><span class="token punctuation">(</span>row <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> board<span class="token punctuation">,</span> result<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 递归到下一行</span>
            board<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'.'</span><span class="token punctuation">;</span> <span class="token comment">// 回溯，撤销皇后</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主函数：求解 N-皇后问题</span>
vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;&gt;</span> <span class="token function">solveNQueens</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;&gt;</span> result<span class="token punctuation">;</span> <span class="token comment">// 存储所有解</span>
    vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token function">board</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化棋盘，所有位置为空（'.'）</span>
    <span class="token function">solve</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> board<span class="token punctuation">,</span> result<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从第 0 行开始回溯</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_99">
     </a>
     代码解释
    </h3>
    <ul>
     <li>
      <p>
       <code>
        isSafe
       </code>
       函数：
      </p>
      <ul>
       <li>
        检查当前位置
        <code>
         (row, col)
        </code>
        是否可以放置皇后。
       </li>
       <li>
        检查列、左上对角线和右上对角线是否有冲突。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <code>
        solve
       </code>
       函数：
      </p>
      <ul>
       <li>
        使用回溯算法逐行尝试放置皇后。
       </li>
       <li>
        如果找到一个有效位置，递归到下一行。
       </li>
       <li>
        如果当前行所有位置都尝试完毕，回溯并撤销上一步的皇后。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <code>
        solveNQueens
       </code>
       函数：
      </p>
      <ul>
       <li>
        初始化棋盘（用
        <code>
         '.'
        </code>
        表示空位）。
       </li>
       <li>
        调用
        <code>
         solve
        </code>
        函数开始求解。
       </li>
      </ul>
     </li>
    </ul>
    <h3>
     <a id="_113">
     </a>
     复杂度分析
    </h3>
    <ul>
     <li>
      时间复杂度：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         O 
         
        
          ( 
         
        
          N 
         
        
          ! 
         
        
          ) 
         
        
       
         O(N!)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           O
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
          <span class="mclose">
           !)
          </span>
         </span>
        </span>
       </span>
      </span>
      ，因为每行有
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         N 
         
        
       
         N
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 0.6833em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.109em;">
           N
          </span>
         </span>
        </span>
       </span>
      </span>
      种选择，且需要检查冲突。
     </li>
     <li>
      空间复杂度：
      <span class="katex--inline">
       <span class="katex">
        <span class="katex-mathml">
         O 
         
        
          ( 
         
         
         
           N 
          
         
           2 
          
         
        
          ) 
         
        
       
         O(N^2)
        </span>
        <span class="katex-html">
         <span class="base">
          <span class="strut" style="height: 1.0641em; vertical-align: -0.25em;">
          </span>
          <span class="mord mathnormal" style="margin-right: 0.0278em;">
           O
          </span>
          <span class="mopen">
           (
          </span>
          <span class="mord">
           <span class="mord mathnormal" style="margin-right: 0.109em;">
            N
           </span>
           <span class="msupsub">
            <span class="vlist-t">
             <span class="vlist-r">
              <span class="vlist" style="height: 0.8141em;">
               <span class="" style="top: -3.063em; margin-right: 0.05em;">
                <span class="pstrut" style="height: 2.7em;">
                </span>
                <span class="sizing reset-size6 size3 mtight">
                 <span class="mord mtight">
                  2
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
          <span class="mclose">
           )
          </span>
         </span>
        </span>
       </span>
      </span>
      ，用于存储棋盘和递归栈。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f566974616c69612f:61727469636c652f64657461696c732f313436303833313033" class_="artid" style="display:none">
 </p>
</div>


