---
layout: post
title: "eBPF-å®æ—¶æ•è·é”®ç›˜è¾“å…¥"
date: 2025-03-15 21:15:00 +0800
description: "æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨eBPFæŠ€æœ¯é€šè¿‡`Go`è¯­è¨€å’Œ`libbpfgo`å®ç°é”®ç›˜è¾“å…¥çš„å®æ—¶æ•è·ã€‚æ–‡ç« é¦–å…ˆæ¦‚è¿°äº†åˆ©ç”¨eBPFçš„`kprobe`æŠ€æœ¯æ¥ç›‘å¬å†…æ ¸å‡½æ•°`input_handle_event`ï¼Œä»è€Œåœ¨æŒ‰é”®äº‹ä»¶å‘ç”Ÿæ—¶æ•è·æ•°æ®ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´è¿›è¡Œå¤„ç†ã€‚æ–‡ä¸­è¯¦ç»†è®²è§£äº†ä»ç¡¬ä»¶ä¸­æ–­è§¦å‘åˆ°å­—ç¬¦æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šçš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬å†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„ä¸åŒæ•è·æ–¹å¼ã€‚"
keywords: "eBPF å®æ—¶æ•è·é”®ç›˜è¾“å…¥"
categories: ['Go']
tags: ['é”®ç›˜è®°å½•', 'Kprobe', 'Ebpf']
artid: "146276525"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146276525
    alt: "eBPF-å®æ—¶æ•è·é”®ç›˜è¾“å…¥"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146276525
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146276525
cover: https://bing.ee123.net/img/rand?artid=146276525
image: https://bing.ee123.net/img/rand?artid=146276525
img: https://bing.ee123.net/img/rand?artid=146276525
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     eBPF å®æ—¶æ•è·é”®ç›˜è¾“å…¥
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="eBPF__0">
     </a>
     eBPF å®æ—¶æ•è·é”®ç›˜è¾“å…¥
    </h2>
    <p>
     æœ¬æ–‡å°†å¸¦ä½ ä¸€æ­¥æ­¥å®ç°ä¸€ä¸ªåŸºäºeBPF kprobeçš„é”®ç›˜è®°å½•åŠŸèƒ½ï¼Œé€šè¿‡
     <code>
      Go
     </code>
     è¯­è¨€é…åˆ
     <code>
      libbpfgo
     </code>
     ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•æ— æŸåœ°ç›‘æ§ç³»ç»Ÿé”®ç›˜è¾“å…¥ï¼Œå¹¶ä»ä¸­è·å–å®æ—¶æ•°æ®ï¼Œè¿›ä¸€æ­¥æé«˜ç³»ç»Ÿå®‰å…¨å’Œç›‘æ§èƒ½åŠ›ã€‚
    </p>
    <hr/>
    <h3>
     <a id="1__6">
     </a>
     1. è¯´æ˜
    </h3>
    <p>
     æœ¬æ–‡å±äºä¸“æ 
     <a href="https://licheng.blog.csdn.net/article/details/146085973" rel="nofollow">
      Goè¯­è¨€+libbpfgoå®æˆ˜eBPFå¼€å‘
     </a>
     ï¼Œç¤ºä¾‹ä»£ç ç›®å½•ä¸º
     <code>
      040
     </code>
     ã€‚
    </p>
    <p>
     å¦‚ä½•ä¸‹è½½å¹¶è¿è¡Œä»£ç ï¼Œè¯·å‚è€ƒ
     <a href="https://licheng.blog.csdn.net/article/details/146085973" rel="nofollow">
      ä¸“æ ä»‹ç»
     </a>
     ã€‚
    </p>
    <blockquote>
     <p>
      <strong>
       æ³¨:
      </strong>
      è€å­¦å‘˜å¯ä»¥ç›´æ¥
      <code>
       git pull
      </code>
      æ‹‰å–æœ€æ–°ä»£ç ã€‚
     </p>
    </blockquote>
    <hr/>
    <h3>
     <a id="2__16">
     </a>
     2. å¼•è¨€
    </h3>
    <p>
     åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨ eBPF çš„
     <code>
      kprobe
     </code>
     æŠ€æœ¯æ•æ‰é”®ç›˜è¾“å…¥äº‹ä»¶ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„é”®ç›˜è®°å½•åŠŸèƒ½ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•åœ¨å†…æ ¸å±‚é¢ç›‘æ§
     <code>
      input_handle_event
     </code>
     å‡½æ•°ï¼Œå¹¶å°†æ•è·åˆ°çš„æŒ‰é”®äº‹ä»¶ä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´è¿›è¡Œå¤„ç†ã€‚æ•´ä¸ªè¿‡ç¨‹é«˜æ•ˆä¸”éä¾µå…¥å¼ï¼Œé€‚ç”¨äºå®æ—¶ç›‘æ§åœºæ™¯ã€‚ğŸ’¡
    </p>
    <p>
     eBPF å…è®¸åœ¨å†…æ ¸ä¸­åŠ¨æ€åŠ è½½å’Œæ‰§è¡Œä»£ç ã€‚å€ŸåŠ©
     <code>
      kprobe
     </code>
     ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨
     <code>
      input_handle_event
     </code>
     å‡½æ•°å…¥å£å¤„æŒ‚è½½æ¢é’ˆï¼Œä»è€Œæ•è·å…³é”®äº‹ä»¶ã€‚
    </p>
    <ul>
     <li>
      <strong>
       é”®ç›˜äº‹ä»¶ç±»å‹
      </strong>
      ï¼šæˆ‘ä»¬å…³æ³¨
      <code>
       EV_KEY
      </code>
      ç±»å‹çš„æŒ‰é”®äº‹ä»¶ï¼Œå¹¶ä»…è®°å½•æŒ‰ä¸‹ï¼ˆ
      <code>
       value=1
      </code>
      ï¼‰æ—¶çš„äº‹ä»¶ã€‚
     </li>
     <li>
      <strong>
       äº‹ä»¶ä¼ é€’æ–¹å¼
      </strong>
      ï¼šé€šè¿‡
      <code>
       bpf_perf_event_output
      </code>
      å°†äº‹ä»¶æ•°æ®å‘é€åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç”¨æˆ·ç©ºé—´ç¨‹åºä½¿ç”¨
      <code>
       perf buffer
      </code>
      è¿›è¡Œå®æ—¶è¯»å–ã€‚
     </li>
    </ul>
    <p>
     è¿™æ ·æ—¢èƒ½ç²¾å‡†ç›‘æ§è¾“å…¥äº‹ä»¶ï¼Œåˆæ— éœ€å¯¹ç³»ç»Ÿè¿›è¡Œä¾µå…¥å¼ä¿®æ”¹ã€‚
    </p>
    <hr/>
    <h3>
     <a id="3__28">
     </a>
     3. åŸç†è¯¦è§£
    </h3>
    <h4>
     <a id="31__30">
     </a>
     3.1 å½“ä½ æŒ‰ä¸‹ä¸€ä¸ªé”®ç›˜ä¸Šçš„æŒ‰é”®æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
    </h4>
    <p>
     <strong>
      æµç¨‹å›¾
     </strong>
    </p>
    <pre><code>ç¡¬ä»¶ä¸­æ–­ â†’ é”®ç›˜é©±åŠ¨ â†’ è¾“å…¥å­ç³»ç»Ÿ â†’ TTY è¡Œè§„ç¨‹ â†’ Shell è¿›ç¨‹ â†’ TTY å›æ˜¾ â†’ ç»ˆç«¯æ¸²æŸ“
</code></pre>
    <p>
     åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä»æŒ‰ä¸‹é”®ç›˜åˆ°å­—ç¬¦æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šï¼Œæ¶‰åŠ
     <strong>
      ç¡¬ä»¶ä¸­æ–­å¤„ç†ã€å†…æ ¸å­ç³»ç»Ÿåä½œå’Œç”¨æˆ·ç©ºé—´è¿›ç¨‹äº¤äº’
     </strong>
     ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æµç¨‹å’Œå…³é”®å‡½æ•°ã€‚
    </p>
    <p>
     <strong>
      1. ç¡¬ä»¶ä¸­æ–­è§¦å‘
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       ç¡¬ä»¶å±‚é¢
      </strong>
      ï¼šé”®ç›˜æ§åˆ¶å™¨ï¼ˆå¦‚ PS/2 æˆ– USBï¼‰æ£€æµ‹åˆ°æŒ‰é”®åŠ¨ä½œï¼Œç”Ÿæˆ
      <strong>
       ç¡¬ä»¶ä¸­æ–­
      </strong>
      ï¼ˆPS/2 é”®ç›˜é€šå¸¸ä½¿ç”¨ IRQ 1ï¼‰ã€‚
     </li>
     <li>
      <strong>
       ä¸­æ–­æ§åˆ¶å™¨
      </strong>
      ï¼šå°†ä¸­æ–­è·¯ç”±è‡³ CPUï¼ŒCPU é€šè¿‡ä¸­æ–­å‘é‡è¡¨è°ƒç”¨å¯¹åº”çš„
      <strong>
       ä¸­æ–­å¤„ç†ç¨‹åº
      </strong>
      ã€‚
     </li>
    </ul>
    <p>
     <strong>
      2. å†…æ ¸ä¸­æ–­å¤„ç†
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       ä¸­æ–­å¤„ç†å‡½æ•°
      </strong>
      ï¼šå†…æ ¸æ³¨å†Œçš„é”®ç›˜ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆ
      <code>
       irq_handler
      </code>
      ï¼‰è¢«è§¦å‘ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®å‡½æ•°
        </strong>
        ï¼š
        <code>
         request_irq()
        </code>
        æ³¨å†Œä¸­æ–­å¤„ç†å‡½æ•°ï¼Œå¦‚ PS/2 é”®ç›˜çš„
        <code>
         kbd_event
        </code>
        æˆ– USB é”®ç›˜çš„
        <code>
         usb_kbd_irq
        </code>
        ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       è¯»å–æ‰«æç 
      </strong>
      ï¼šé©±åŠ¨ä»é”®ç›˜æ§åˆ¶å™¨è¯»å–
      <strong>
       æ‰«æç ï¼ˆScancodeï¼‰
      </strong>
      ï¼ˆå¦‚
      <code>
       inb(0x60)
      </code>
      è¯»å– PS/2 é”®ç›˜æ•°æ®ç«¯å£ï¼‰ã€‚
     </li>
     <li>
      <strong>
       è½¬æ¢ä¸ºé”®ç 
      </strong>
      ï¼šæ‰«æç è½¬æ¢ä¸º
      <strong>
       é”®ç ï¼ˆKeycodeï¼‰
      </strong>
      ï¼ˆå¦‚
      <code>
       kbd_keycode
      </code>
      å¤„ç†æ˜ å°„å…³ç³»ï¼‰ã€‚
     </li>
    </ul>
    <p>
     <strong>
      3. è¾“å…¥å­ç³»ç»Ÿï¼ˆInput Subsystemï¼‰
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       ç”Ÿæˆè¾“å…¥äº‹ä»¶
      </strong>
      ï¼šé”®ç é€šè¿‡è¾“å…¥å­ç³»ç»Ÿå°è£…ä¸º
      <code>
       input_event
      </code>
      ç»“æ„ï¼ˆåŒ…å«æ—¶é—´æˆ³ã€é”®å€¼ã€åŠ¨ä½œç­‰ï¼‰ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®å‡½æ•°
        </strong>
        ï¼š
        <code>
         input_event()
        </code>
        â†’
        <code>
         input_handle_event()
        </code>
        ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       ä¼ é€’äº‹ä»¶
      </strong>
      ï¼šäº‹ä»¶é€šè¿‡
      <code>
       /dev/input/eventX
      </code>
      è®¾å¤‡èŠ‚ç‚¹ä¼ é€’ï¼Œä¾›ç”¨æˆ·ç©ºé—´ç¨‹åºï¼ˆå¦‚ç»ˆç«¯ï¼‰è¯»å–ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®ç»“æ„
        </strong>
        ï¼š
        <code>
         struct input_handler
        </code>
        è´Ÿè´£äº‹ä»¶è·¯ç”±ï¼ˆå¦‚
        <code>
         evdev_handler
        </code>
        ï¼‰ã€‚
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      4. TTY å­ç³»ç»Ÿå¤„ç†
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       ç»‘å®šåˆ° TTY
      </strong>
      ï¼šè¾“å…¥äº‹ä»¶ä¼ é€’åˆ°å½“å‰æ´»åŠ¨çš„ TTYï¼ˆå¦‚
      <code>
       /dev/tty1
      </code>
      ï¼‰ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®å‡½æ•°
        </strong>
        ï¼š
        <code>
         tty_insert_flip_char()
        </code>
        å°†å­—ç¬¦å†™å…¥ TTY çš„ flip bufferã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       è¡Œè§„ç¨‹ï¼ˆLine Disciplineï¼‰
      </strong>
      ï¼šå¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚å›è½¦ã€é€€æ ¼ï¼‰ã€‚é»˜è®¤è¡Œè§„ç¨‹ä¸º
      <code>
       n_tty
      </code>
      ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®å‡½æ•°
        </strong>
        ï¼š
        <code>
         n_tty_receive_char()
        </code>
        è§£æå­—ç¬¦å¹¶æ‰§è¡Œå›æ˜¾é€»è¾‘ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       åˆ·æ–°ç¼“å†²åŒº
      </strong>
      ï¼šè°ƒç”¨
      <code>
       tty_flip_buffer_push()
      </code>
      æ¨é€æ•°æ®è‡³ TTY è¯»é˜Ÿåˆ—ã€‚
     </li>
    </ul>
    <p>
     <strong>
      5. ç”¨æˆ·ç©ºé—´è¿›ç¨‹è¯»å–è¾“å…¥
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       å‰å°è¿›ç¨‹
      </strong>
      ï¼šShellï¼ˆå¦‚ Bashï¼‰é€šè¿‡
      <code>
       read()
      </code>
      ç³»ç»Ÿè°ƒç”¨è¯»å– TTY è®¾å¤‡çš„è¾“å…¥ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®è·¯å¾„
        </strong>
        ï¼š
        <code>
         read()
        </code>
        â†’
        <code>
         tty_read()
        </code>
        â†’
        <code>
         copy_from_read_buf()
        </code>
        ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       è¡Œç¼–è¾‘æ¨¡å¼ï¼ˆCanonical Modeï¼‰
      </strong>
      ï¼šå¯ç”¨æ—¶ï¼Œè¾“å…¥ç¼“å­˜åœ¨å†…æ ¸ç›´åˆ°ç”¨æˆ·æŒ‰ä¸‹å›è½¦ã€‚
     </li>
    </ul>
    <p>
     <strong>
      6. å­—ç¬¦æ˜¾ç¤ºåˆ°ç»ˆç«¯
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       å›æ˜¾ï¼ˆEchoï¼‰
      </strong>
      ï¼šé»˜è®¤
      <code>
       n_tty
      </code>
      è§„ç¨‹ä¼šè‡ªåŠ¨å›æ˜¾å­—ç¬¦åˆ°ç»ˆç«¯ã€‚
      <ul>
       <li>
        <strong>
         å…³é”®å‡½æ•°
        </strong>
        ï¼š
        <code>
         n_tty_receive_char()
        </code>
        è°ƒç”¨
        <code>
         echo_char()
        </code>
        è¿›è¡Œå›æ˜¾ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       ç»ˆç«¯å†™å…¥
      </strong>
      ï¼šå­—ç¬¦é€šè¿‡
      <code>
       write()
      </code>
      ç³»ç»Ÿè°ƒç”¨å‘é€è‡³ç»ˆç«¯æ˜¾ç¤ºã€‚
      <ul>
       <li>
        <strong>
         å…³é”®è·¯å¾„
        </strong>
        ï¼š
        <code>
         write()
        </code>
        â†’
        <code>
         tty_write()
        </code>
        â†’
        <code>
         do_tty_write()
        </code>
        â†’ ç»ˆç«¯é©±åŠ¨çš„å†™å‡½æ•°ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       ç»ˆç«¯æ¸²æŸ“æ–¹å¼
      </strong>
      ï¼š
      <ul>
       <li>
        <strong>
         ç‰©ç†ç»ˆç«¯
        </strong>
        ï¼šé€šè¿‡æ˜¾å¡é©±åŠ¨ï¼ˆå¦‚
        <code>
         vt_console_print()
        </code>
        ï¼‰ç›´æ¥è¾“å‡ºã€‚
       </li>
       <li>
        <strong>
         ä¼ªç»ˆç«¯ï¼ˆPTYï¼‰
        </strong>
        ï¼šå¦‚ SSH æˆ–ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼ˆå¦‚ GNOME Terminalï¼‰ï¼Œå­—ç¬¦é€šè¿‡ PTY ä¸»ä»è®¾å¤‡ä¼ è¾“ï¼Œæœ€ç»ˆç”±ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ¸²æŸ“ã€‚
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="32__76">
     </a>
     3.2 åœ¨å“ªé‡Œæ•è·é”®ç›˜è¾“å…¥äº‹ä»¶ï¼Ÿ
    </h4>
    <p>
     åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé”®ç›˜è¾“å…¥äº‹ä»¶å¯ä»¥åœ¨ä¸åŒå±‚æ¬¡è¿›è¡Œæ•è·ï¼Œä¸»è¦åŒ…æ‹¬
     <strong>
      å†…æ ¸æ€
     </strong>
     å’Œ
     <strong>
      ç”¨æˆ·æ€
     </strong>
     ï¼Œä»¥ä¸‹æ˜¯å¸¸è§çš„æ•è·ä½ç½®åŠæ–¹æ³•ã€‚
    </p>
    <h5>
     <a id="1__80">
     </a>
     1. å†…æ ¸æ€æ•è·
    </h5>
    <p>
     <strong>
      1.1 ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆIRQ çº§åˆ«ï¼‰
     </strong>
    </p>
    <ul>
     <li>
      æœ€åº•å±‚çš„æ•è·æ–¹å¼ï¼Œåœ¨é”®ç›˜è§¦å‘
      <strong>
       ç¡¬ä»¶ä¸­æ–­
      </strong>
      æ—¶ï¼Œå†…æ ¸çš„
      <strong>
       ä¸­æ–­å¤„ç†å‡½æ•°
      </strong>
      è¢«è°ƒç”¨ã€‚
     </li>
     <li>
      ç›¸å…³ä»£ç ä½ç½®ï¼š
      <code>
       drivers/input/keyboard/atkbd.c
      </code>
      ï¼ˆPS/2 é”®ç›˜ï¼‰ æˆ–
      <code>
       drivers/hid/usbhid/usbkbd.c
      </code>
      ï¼ˆUSB é”®ç›˜ï¼‰ã€‚
     </li>
     <li>
      å…³é”®å‡½æ•°ï¼š
      <ul>
       <li>
        <code>
         irq_handler_t kbd_event()
        </code>
        ï¼ˆPS/2ï¼‰
       </li>
       <li>
        <code>
         usb_kbd_irq()
        </code>
        ï¼ˆUSBï¼‰
       </li>
       <li>
        è¯»å–
        <strong>
         æ‰«æç 
        </strong>
        å¹¶ä¼ é€’è‡³
        <strong>
         è¾“å…¥å­ç³»ç»Ÿ
        </strong>
        ã€‚
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      1.2 è¾“å…¥å­ç³»ç»Ÿï¼ˆInput Subsystemï¼‰
     </strong>
    </p>
    <ul>
     <li>
      å†…æ ¸çš„
      <code>
       input_event
      </code>
      æœºåˆ¶å°è£…äº†é”®ç›˜è¾“å…¥äº‹ä»¶ã€‚
     </li>
     <li>
      ç›¸å…³è®¾å¤‡èŠ‚ç‚¹ï¼š
      <code>
       /dev/input/eventX
      </code>
      ã€‚
     </li>
     <li>
      å…³é”®å‡½æ•°ï¼š
      <ul>
       <li>
        <code>
         input_event()
        </code>
        ç”Ÿæˆé”®ç›˜äº‹ä»¶ã€‚
       </li>
       <li>
        <code>
         input_handle_event()
        </code>
        å¤„ç†äº‹ä»¶å¹¶åˆ†å‘è‡³ç”¨æˆ·ç©ºé—´ã€‚
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="2__97">
     </a>
     2. ç”¨æˆ·æ€æ•è·
    </h5>
    <p>
     <strong>
      2.1 é€šè¿‡
      <code>
       /dev/input/eventX
      </code>
      æ•è·åŸå§‹è¾“å…¥äº‹ä»¶
     </strong>
    </p>
    <ul>
     <li>
      <p>
       é€‚ç”¨äºè¯»å–åº•å±‚è¾“å…¥è®¾å¤‡ï¼ˆé€‚ç”¨äºé”®ç›˜ç›‘å¬ã€æŒ‰é”®ç»Ÿè®¡ç­‰ï¼‰ã€‚
      </p>
     </li>
     <li>
      <p>
       ä»£ç ç¤ºä¾‹ï¼ˆä½¿ç”¨
       <code>
        evdev
       </code>
       æ¥å£ï¼‰ï¼š
      </p>
      <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/input.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/dev/input/event2"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> <span class="token class-name">input_event</span> ev<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ev<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>type <span class="token operator">==</span> EV_KEY <span class="token operator">&amp;&amp;</span> ev<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Key %d pressed\n"</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ul>
    <p>
     <strong>
      2.2 é€šè¿‡
      <code>
       /dev/tty
      </code>
      è¯»å–ç»ˆç«¯è¾“å…¥
     </strong>
    </p>
    <ul>
     <li>
      <p>
       é€‚ç”¨äºè¯»å–å½“å‰ç»ˆç«¯çš„é”®ç›˜è¾“å…¥ï¼ˆå— TTY è§„ç¨‹æ§åˆ¶ï¼‰ã€‚
      </p>
     </li>
     <li>
      <p>
       ä»£ç ç¤ºä¾‹ï¼ˆè¯»å–æ ‡å‡†è¾“å…¥ï¼‰ï¼š
      </p>
      <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        c <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Pressed: %c\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ul>
    <p>
     <strong>
      2.3 ä½¿ç”¨
      <code>
       libinput
      </code>
      ç›‘å¬é”®ç›˜è¾“å…¥ï¼ˆWayland ç¯å¢ƒï¼‰
     </strong>
    </p>
    <ul>
     <li>
      <p>
       é€‚ç”¨äºç°ä»£æ¡Œé¢ç¯å¢ƒï¼ˆX11/Waylandï¼‰ã€‚
      </p>
     </li>
     <li>
      <p>
       ç›‘å¬ç³»ç»Ÿçº§è¾“å…¥äº‹ä»¶ï¼Œé€‚ç”¨äºå›¾å½¢ç•Œé¢åº”ç”¨ã€‚
      </p>
     </li>
     <li>
      <p>
       ä»£ç ç¤ºä¾‹ï¼ˆPythonï¼‰ï¼š
      </p>
      <pre><code class="prism language-python"><span class="token keyword">from</span> evdev <span class="token keyword">import</span> InputDevice<span class="token punctuation">,</span> categorize<span class="token punctuation">,</span> ecodes

dev <span class="token operator">=</span> InputDevice<span class="token punctuation">(</span><span class="token string">'/dev/input/event2'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> event <span class="token keyword">in</span> dev<span class="token punctuation">.</span>read_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> ecodes<span class="token punctuation">.</span>EV_KEY<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>categorize<span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
     </li>
    </ul>
    <p>
     <strong>
      2.4 ç›‘å¬ X11 æŒ‰é”®äº‹ä»¶ï¼ˆX Window Systemï¼‰
     </strong>
    </p>
    <ul>
     <li>
      <p>
       é€‚ç”¨äº GUI åº”ç”¨ï¼Œä½¿ç”¨
       <code>
        Xlib
       </code>
       ç›‘å¬æŒ‰é”®ã€‚
      </p>
     </li>
     <li>
      <p>
       ä»£ç ç¤ºä¾‹ï¼ˆPython +
       <code>
        python-xlib
       </code>
       ï¼‰ï¼š
      </p>
      <pre><code class="prism language-python"><span class="token keyword">from</span> Xlib <span class="token keyword">import</span> display<span class="token punctuation">,</span> X

d <span class="token operator">=</span> display<span class="token punctuation">.</span>Display<span class="token punctuation">(</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> d<span class="token punctuation">.</span>screen<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>root
r<span class="token punctuation">.</span>grab_keyboard<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>GrabModeAsync<span class="token punctuation">,</span> X<span class="token punctuation">.</span>GrabModeAsync<span class="token punctuation">,</span> X<span class="token punctuation">.</span>CurrentTime<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    event <span class="token operator">=</span> r<span class="token punctuation">.</span>display<span class="token punctuation">.</span>next_event<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> event<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> X<span class="token punctuation">.</span>KeyPress<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Key pressed"</span><span class="token punctuation">)</span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="33__173">
     </a>
     3.3 é€‰æ‹©åˆé€‚çš„æ•è·æ–¹å¼
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        éœ€æ±‚
       </th>
       <th>
        æ¨èæ–¹æ³•
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        ä½çº§è¾“å…¥ç›‘æ§ï¼ˆæ‰«æç ï¼‰
       </td>
       <td>
        å†…æ ¸
        <code>
         input_event
        </code>
        æˆ–è€…
        <code>
         input_handle_event
        </code>
        API
       </td>
      </tr>
      <tr>
       <td>
        ç›‘å¬æ‰€æœ‰é”®ç›˜äº‹ä»¶
       </td>
       <td>
        è¯»å–
        <code>
         /dev/input/eventX
        </code>
       </td>
      </tr>
      <tr>
       <td>
        ç›‘å¬ç»ˆç«¯è¾“å…¥
       </td>
       <td>
        è¯»å–
        <code>
         /dev/tty
        </code>
       </td>
      </tr>
      <tr>
       <td>
        GUI åº”ç”¨æŒ‰é”®æ•è·
       </td>
       <td>
        <code>
         Xlib
        </code>
        æˆ–
        <code>
         libinput
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     ä¸åŒåœºæ™¯ä¸‹ï¼Œå¯ä»¥é€‰æ‹©åˆé€‚çš„æ–¹å¼è¿›è¡Œé”®ç›˜è¾“å…¥æ•è·ã€‚
    </p>
    <blockquote>
     <p>
      æœ¬æ–‡å°†æ¼”ç¤ºé€šè¿‡ hook å†…æ ¸å‡½æ•°
      <code>
       input_handle_event
      </code>
      å®ç°é”®ç›˜è®°å½•åŠŸèƒ½ã€‚
     </p>
    </blockquote>
    <hr/>
    <h3>
     <a id="4__188">
     </a>
     4. ä»£ç è¯¦è§£
    </h3>
    <h4>
     <a id="41_bpf_190">
     </a>
     4.1 bpfä»£ç 
    </h4>
    <h5>
     <a id="411__192">
     </a>
     4.1.1 æ•´ä½“é€»è¾‘
    </h5>
    <ul>
     <li>
      <strong>
       åŠ è½½å…¥å£:
      </strong>
      ä»£ç é€šè¿‡
      <code>
       SEC("kprobe/input_handle_event")
      </code>
      æŒ‚è½½åˆ°å†…æ ¸çš„
      <code>
       input_handle_event
      </code>
      å‡½æ•°ã€‚
     </li>
     <li>
      <strong>
       äº‹ä»¶è¿‡æ»¤:
      </strong>
      åˆ¤æ–­ä¼ å…¥çš„
      <code>
       type
      </code>
      æ˜¯å¦ä¸º
      <code>
       EV_KEY
      </code>
      ä¸”
      <code>
       value
      </code>
      æ˜¯å¦ç­‰äº1ï¼Œåªåœ¨æŒ‰é”®æŒ‰ä¸‹æ—¶è¿›è¡Œå¤„ç†ã€‚
     </li>
     <li>
      <strong>
       æ•°æ®å‘é€:
      </strong>
      å¦‚æœæ»¡è¶³æ¡ä»¶ä¸”æŒ‰é”®ç å°äº
      <code>
       MAX_KEYS
      </code>
      ï¼Œåˆ™åˆ©ç”¨
      <code>
       bpf_perf_event_output
      </code>
      å°†äº‹ä»¶æ•°æ®å‘é€åˆ°ç”¨æˆ·ç©ºé—´ã€‚
     </li>
    </ul>
    <h5>
     <a id="412__198">
     </a>
     4.1.2 ä»£ç ç»†èŠ‚è§£æ
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        å¤´æ–‡ä»¶ä¸å®å®šä¹‰:
       </strong>
      </p>
      <ul>
       <li>
        åŒ…å«äº†
        <code>
         vmlinux.h
        </code>
        ã€
        <code>
         bpf_helpers.h
        </code>
        ã€
        <code>
         bpf_tracing.h
        </code>
        å’Œ
        <code>
         bpf_core_read.h
        </code>
        ç­‰å¤´æ–‡ä»¶ï¼Œä¿è¯ä»£ç èƒ½è°ƒç”¨å†…æ ¸ç›¸å…³çš„APIã€‚
       </li>
       <li>
        å®šä¹‰äº†
        <code>
         EV_KEY
        </code>
        å’Œ
        <code>
         MAX_KEYS
        </code>
        ï¼Œåˆ†åˆ«ä»£è¡¨æŒ‰é”®äº‹ä»¶ç±»å‹å’Œå…è®¸çš„æœ€å¤§æŒ‰é”®æ•°é‡ã€‚
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        äº‹ä»¶ç»“æ„ä½“:
       </strong>
      </p>
      <pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">event_t</span> <span class="token punctuation">{<!-- --></span>
    u32 type<span class="token punctuation">;</span>
    u32 code<span class="token punctuation">;</span>
    u32 value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      <p>
       è¯¥ç»“æ„ä½“ç”¨äºä¿å­˜æŒ‰é”®äº‹ä»¶æ•°æ®ï¼ŒåŒ…æ‹¬äº‹ä»¶ç±»å‹ã€æŒ‰é”®ç å’ŒæŒ‰é”®çŠ¶æ€ã€‚
      </p>
     </li>
     <li>
      <p>
       <strong>
        kprobeå‡½æ•°:
       </strong>
      </p>
      <pre><code class="prism language-c"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">"kprobe/input_handle_event"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">BPF_KPROBE</span><span class="token punctuation">(</span>hook_input_handle_event<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">input_dev</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token class-name">event_t</span> event <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    event<span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
    event<span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
    event<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> EV_KEY <span class="token operator">&amp;&amp;</span> value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>code <span class="token operator">&lt;</span> MAX_KEYS<span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">bpf_perf_event_output</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>events<span class="token punctuation">,</span> BPF_F_CURRENT_CPU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>event<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      <ul>
       <li>
        <strong>
         æ•´ä½“é€»è¾‘:
        </strong>
        åœ¨æ¯æ¬¡
        <code>
         input_handle_event
        </code>
        è°ƒç”¨æ—¶ï¼Œå°†è¾“å…¥æ•°æ®å°è£…åˆ°
        <code>
         event
        </code>
        ä¸­ï¼›åˆ¤æ–­æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°†äº‹ä»¶é€šè¿‡
        <code>
         perf event
        </code>
        å‘é€ã€‚
       </li>
       <li>
        <strong>
         ç»†èŠ‚è¯´æ˜:
        </strong>
        <ul>
         <li>
          <code>
           SEC("kprobe/input_handle_event")
          </code>
          ï¼šå£°æ˜è¯¥å‡½æ•°ä¸ºkprobeå¤„ç†å‡½æ•°ã€‚
         </li>
         <li>
          <code>
           BPF_KPROBE
          </code>
          å®ç”¨äºè‡ªåŠ¨ç”Ÿæˆæ¢é’ˆå…¥å£ã€‚
         </li>
         <li>
          <code>
           bpf_perf_event_output
          </code>
          è´Ÿè´£å°†æ•°æ®ä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä¸æ¶‰åŠé”™è¯¯å¤„ç†ä»£ç ã€‚
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="42_go_243">
     </a>
     4.2 goä»£ç 
    </h4>
    <h5>
     <a id="421_maingo_245">
     </a>
     4.2.1 main.go
    </h5>
    <h6>
     <a id="_247">
     </a>
     æ•´ä½“é€»è¾‘
    </h6>
    <ul>
     <li>
      <strong>
       ä¿¡å·æ³¨å†Œ:
      </strong>
      åˆ©ç”¨
      <code>
       signal.NotifyContext
      </code>
      æ³¨å†Œç³»ç»Ÿä¿¡å·ï¼ˆå¦‚
      <code>
       SIGINT
      </code>
      ã€
      <code>
       SIGTERM
      </code>
      ï¼‰ï¼Œç¡®ä¿ç¨‹åºèƒ½ä¼˜é›…é€€å‡ºã€‚
     </li>
     <li>
      <strong>
       åŠ è½½BPFç¨‹åº:
      </strong>
      è°ƒç”¨
      <code>
       BpfLoadAndAttach
      </code>
      åŠ è½½å¹¶é™„åŠ BPFç¨‹åºæ–‡ä»¶
      <code>
       bpf.o
      </code>
      ã€‚
     </li>
     <li>
      <strong>
       åˆ›å»ºperf buffer:
      </strong>
      åˆå§‹åŒ–
      <code>
       perf buffer
      </code>
      ï¼Œé€šè¿‡
      <code>
       eventsChannel
      </code>
      å’Œ
      <code>
       lostChannel
      </code>
      æ¥æ”¶äº‹ä»¶æ•°æ®åŠä¸¢å¤±äº‹ä»¶ç»Ÿè®¡ã€‚
     </li>
     <li>
      <strong>
       äº‹ä»¶å¤„ç†:
      </strong>
      å¯åŠ¨ä¸€ä¸ªäº‹ä»¶å¤„ç†å¾ªç¯ï¼Œå®æ—¶è§£æå¹¶æ‰“å°é”®ç›˜äº‹ä»¶ï¼Œç›´åˆ°æ”¶åˆ°é€€å‡ºä¿¡å·ã€‚
     </li>
    </ul>
    <h6>
     <a id="_254">
     </a>
     ä»£ç ç»†èŠ‚è§£æ
    </h6>
    <ul>
     <li>
      <strong>
       æ—¥å¿—è®¾ç½®:
      </strong>
      ä½¿ç”¨
      <code>
       logrus
      </code>
      è®¾ç½®æ—¥å¿—çº§åˆ«å’Œæ—¶é—´æ ¼å¼ï¼Œä½¿è°ƒè¯•ä¿¡æ¯æ›´ç›´è§‚ã€‚
     </li>
     <li>
      <strong>
       èµ„æºç®¡ç†:
      </strong>
      åˆ©ç”¨
      <code>
       defer
      </code>
      è¯­å¥ç¡®ä¿BPFæ¨¡å—å’Œperf bufferåœ¨ç¨‹åºç»“æŸæ—¶è¢«æ­£ç¡®å…³é—­ã€‚
     </li>
     <li>
      <strong>
       äº‹ä»¶å¾ªç¯:
      </strong>
      <pre><code class="prism language-go"><span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// å¾ªç¯æ¥æ”¶äº‹ä»¶</span>
  	<span class="token keyword">select</span> <span class="token punctuation">{<!-- --></span>
  	<span class="token comment">// æ¥æ”¶åˆ°äº‹ä»¶æ—¶æ‰“å°äº‹ä»¶ä¿¡æ¯</span>
  	<span class="token keyword">case</span> data <span class="token operator">:=</span> <span class="token operator">&lt;-</span>eventsChannel<span class="token punctuation">:</span>
  		<span class="token keyword">var</span> event Event
  		err <span class="token operator">:=</span> event<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
  			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"parse event error: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  			log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  		<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      è¯¥å¾ªç¯å®æ—¶å“åº”æ¥è‡ªå†…æ ¸ç©ºé—´çš„äº‹ä»¶æ•°æ®ã€‚
     </li>
    </ul>
    <hr/>
    <h5>
     <a id="422_eventgo_279">
     </a>
     4.2.2 event.go
    </h5>
    <h6>
     <a id="_281">
     </a>
     æ•´ä½“é€»è¾‘
    </h6>
    <ul>
     <li>
      <strong>
       æ•°æ®ç»“æ„:
      </strong>
      å®šä¹‰äº†
      <code>
       Event
      </code>
      ç»“æ„ä½“ï¼Œç”¨äºä¸å†…æ ¸ä¼ æ¥çš„
      <code>
       event_t
      </code>
      æ•°æ®ä¸€ä¸€å¯¹åº”ã€‚
     </li>
     <li>
      <strong>
       æ•°æ®è§£æ:
      </strong>
      <code>
       Parse
      </code>
      æ–¹æ³•åˆ©ç”¨
      <code>
       binary.Read
      </code>
      å°†æ¥æ”¶åˆ°çš„å­—èŠ‚æµè½¬åŒ–ä¸ºç»“æ„ä½“æ•°æ®ã€‚
     </li>
     <li>
      <strong>
       æ•°æ®å±•ç¤º:
      </strong>
      <code>
       String
      </code>
      æ–¹æ³•è°ƒç”¨
      <code>
       keyStr
      </code>
      å‡½æ•°ï¼Œå°†æŒ‰é”®ç è½¬æ¢ä¸ºå¯¹åº”çš„æŒ‰é”®åç§°ï¼Œä¾¿äºç›´è§‚å±•ç¤ºã€‚
     </li>
    </ul>
    <h6>
     <a id="_287">
     </a>
     ä»£ç ç»†èŠ‚è§£æ
    </h6>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"bytes"</span>
	<span class="token string">"encoding/binary"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Event <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Type  <span class="token builtin">uint32</span>
	Code  <span class="token builtin">uint32</span>
	Value <span class="token builtin">uint32</span>
<span class="token punctuation">}</span>

<span class="token comment">// è§£æeventæ•°æ®</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>Event<span class="token punctuation">)</span> <span class="token function">Parse</span><span class="token punctuation">(</span>data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	err <span class="token operator">:=</span> binary<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> binary<span class="token punctuation">.</span>LittleEndian<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// è½¬æ¢æˆå­—ç¬¦ä¸²</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>Event<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">keyStr</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Code<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> MAX_KEYS <span class="token operator">=</span> <span class="token number">256</span>

<span class="token keyword">var</span> keyNames <span class="token operator">=</span> <span class="token punctuation">[</span>MAX_KEYS<span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>
	<span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"RESERVED"</span><span class="token punctuation">,</span>
	<span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"ESC"</span><span class="token punctuation">,</span>
	<span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">:</span> <span class="token string">"6"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">:</span> <span class="token string">"7"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">:</span> <span class="token string">"8"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">:</span> <span class="token string">"9"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">:</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
	<span class="token number">12</span><span class="token punctuation">:</span> <span class="token string">"MINUS"</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">:</span> <span class="token string">"EQUAL"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">:</span> <span class="token string">"BACKSPACE"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">:</span> <span class="token string">"TAB"</span><span class="token punctuation">,</span>
	<span class="token number">16</span><span class="token punctuation">:</span> <span class="token string">"Q"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">:</span> <span class="token string">"W"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">:</span> <span class="token string">"E"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">:</span> <span class="token string">"R"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">:</span> <span class="token string">"T"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">:</span> <span class="token string">"U"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">:</span> <span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">:</span> <span class="token string">"O"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">:</span> <span class="token string">"P"</span><span class="token punctuation">,</span>
	<span class="token number">26</span><span class="token punctuation">:</span> <span class="token string">"LEFTBRACE"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">:</span> <span class="token string">"RIGHTBRACE"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">:</span> <span class="token string">"ENTER"</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">:</span> <span class="token string">"LEFTCTRL"</span><span class="token punctuation">,</span>
	<span class="token number">30</span><span class="token punctuation">:</span> <span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">:</span> <span class="token string">"S"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">:</span> <span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">:</span> <span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">:</span> <span class="token string">"G"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">:</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">:</span> <span class="token string">"J"</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">:</span> <span class="token string">"K"</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">:</span> <span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">:</span> <span class="token string">"SEMICOLON"</span><span class="token punctuation">,</span>
	<span class="token number">40</span><span class="token punctuation">:</span> <span class="token string">"APOSTROPHE"</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">:</span> <span class="token string">"GRAVE"</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">:</span> <span class="token string">"LEFTSHIFT"</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">:</span> <span class="token string">"BACKSLASH"</span><span class="token punctuation">,</span>
	<span class="token number">44</span><span class="token punctuation">:</span> <span class="token string">"Z"</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">:</span> <span class="token string">"X"</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">:</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">:</span> <span class="token string">"V"</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">:</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">:</span> <span class="token string">"N"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">:</span> <span class="token string">"M"</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">:</span> <span class="token string">"COMMA"</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">:</span> <span class="token string">"DOT"</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">:</span> <span class="token string">"SLASH"</span><span class="token punctuation">,</span>
	<span class="token number">54</span><span class="token punctuation">:</span> <span class="token string">"RIGHTSHIFT"</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">:</span> <span class="token string">"KPASTERISK"</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">:</span> <span class="token string">"LEFTALT"</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">:</span> <span class="token string">"SPACE"</span><span class="token punctuation">,</span>
	<span class="token number">58</span><span class="token punctuation">:</span> <span class="token string">"CAPSLOCK"</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">:</span> <span class="token string">"F1"</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">:</span> <span class="token string">"F2"</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">:</span> <span class="token string">"F3"</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">:</span> <span class="token string">"F4"</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">:</span> <span class="token string">"F5"</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">:</span> <span class="token string">"F6"</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">:</span> <span class="token string">"F7"</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">:</span> <span class="token string">"F8"</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">:</span> <span class="token string">"F9"</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">:</span> <span class="token string">"F10"</span><span class="token punctuation">,</span>
	<span class="token number">69</span><span class="token punctuation">:</span> <span class="token string">"NUMLOCK"</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">:</span> <span class="token string">"SCROLLLOCK"</span><span class="token punctuation">,</span> <span class="token number">71</span><span class="token punctuation">:</span> <span class="token string">"KP7"</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">:</span> <span class="token string">"KP8"</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">:</span> <span class="token string">"KP9"</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">:</span> <span class="token string">"KPMINUS"</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">:</span> <span class="token string">"KP4"</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">:</span> <span class="token string">"KP5"</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">:</span> <span class="token string">"KP6"</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">:</span> <span class="token string">"KPPLUS"</span><span class="token punctuation">,</span>
	<span class="token number">79</span><span class="token punctuation">:</span> <span class="token string">"KP1"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">:</span> <span class="token string">"KP2"</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">:</span> <span class="token string">"KP3"</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">:</span> <span class="token string">"KP0"</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">:</span> <span class="token string">"KPDOT"</span><span class="token punctuation">,</span>
	<span class="token number">85</span><span class="token punctuation">:</span> <span class="token string">"ZENKAKUHANKAKU"</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">:</span> <span class="token string">"102ND"</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">:</span> <span class="token string">"F11"</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">:</span> <span class="token string">"F12"</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">:</span> <span class="token string">"RO"</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">:</span> <span class="token string">"KATAKANA"</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">:</span> <span class="token string">"HIRAGANA"</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">:</span> <span class="token string">"HENKAN"</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">:</span> <span class="token string">"KATAKANAHIRAGANA"</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">:</span> <span class="token string">"MUHENKAN"</span><span class="token punctuation">,</span>
	<span class="token number">95</span><span class="token punctuation">:</span> <span class="token string">"KPJPCOMMA"</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">:</span> <span class="token string">"KPENTER"</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">:</span> <span class="token string">"RIGHTCTRL"</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">:</span> <span class="token string">"KPSLASH"</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">:</span> <span class="token string">"SYSRQ"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">:</span> <span class="token string">"RIGHTALT"</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">:</span> <span class="token string">"LINEFEED"</span><span class="token punctuation">,</span>
	<span class="token number">102</span><span class="token punctuation">:</span> <span class="token string">"HOME"</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">:</span> <span class="token string">"UP"</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">:</span> <span class="token string">"PAGEUP"</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">:</span> <span class="token string">"LEFT"</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">:</span> <span class="token string">"RIGHT"</span><span class="token punctuation">,</span> <span class="token number">107</span><span class="token punctuation">:</span> <span class="token string">"END"</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">:</span> <span class="token string">"DOWN"</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">:</span> <span class="token string">"PAGEDOWN"</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">:</span> <span class="token string">"INSERT"</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">:</span> <span class="token string">"DELETE"</span><span class="token punctuation">,</span>
	<span class="token number">112</span><span class="token punctuation">:</span> <span class="token string">"MACRO"</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">:</span> <span class="token string">"MUTE"</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">:</span> <span class="token string">"VOLUMEDOWN"</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">:</span> <span class="token string">"VOLUMEUP"</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">:</span> <span class="token string">"POWER"</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">:</span> <span class="token string">"KPEQUAL"</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">:</span> <span class="token string">"KPPLUSMINUS"</span><span class="token punctuation">,</span> <span class="token number">119</span><span class="token punctuation">:</span> <span class="token string">"PAUSE"</span><span class="token punctuation">,</span>
	<span class="token number">120</span><span class="token punctuation">:</span> <span class="token string">"SCALE"</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">:</span> <span class="token string">"KPCOMMA"</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">:</span> <span class="token string">"HANGEUL"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">:</span> <span class="token string">"HANJA"</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">:</span> <span class="token string">"YEN"</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">:</span> <span class="token string">"LEFTMETA"</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">:</span> <span class="token string">"RIGHTMETA"</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">:</span> <span class="token string">"COMPOSE"</span><span class="token punctuation">,</span>
	<span class="token number">128</span><span class="token punctuation">:</span> <span class="token string">"STOP"</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">:</span> <span class="token string">"AGAIN"</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">:</span> <span class="token string">"PROPS"</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">:</span> <span class="token string">"UNDO"</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">:</span> <span class="token string">"FRONT"</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">:</span> <span class="token string">"COPY"</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">:</span> <span class="token string">"OPEN"</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">:</span> <span class="token string">"PASTE"</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">:</span> <span class="token string">"FIND"</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">:</span> <span class="token string">"CUT"</span><span class="token punctuation">,</span>
	<span class="token number">138</span><span class="token punctuation">:</span> <span class="token string">"HELP"</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">:</span> <span class="token string">"MENU"</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">:</span> <span class="token string">"CALC"</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">:</span> <span class="token string">"SETUP"</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">:</span> <span class="token string">"SLEEP"</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">:</span> <span class="token string">"WAKEUP"</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">:</span> <span class="token string">"FILE"</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">:</span> <span class="token string">"SENDFILE"</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">:</span> <span class="token string">"DELETEFILE"</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">:</span> <span class="token string">"XFER"</span><span class="token punctuation">,</span>
	<span class="token number">148</span><span class="token punctuation">:</span> <span class="token string">"PROG1"</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">:</span> <span class="token string">"PROG2"</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">:</span> <span class="token string">"WWW"</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">:</span> <span class="token string">"MSDOS"</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">:</span> <span class="token string">"COFFEE"</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">:</span> <span class="token string">"ROTATE_DISPLAY"</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">:</span> <span class="token string">"CYCLEWINDOWS"</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">:</span> <span class="token string">"MAIL"</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">:</span> <span class="token string">"BOOKMARKS"</span><span class="token punctuation">,</span>
	<span class="token number">157</span><span class="token punctuation">:</span> <span class="token string">"COMPUTER"</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">:</span> <span class="token string">"BACK"</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">:</span> <span class="token string">"FORWARD"</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">:</span> <span class="token string">"CLOSECD"</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">:</span> <span class="token string">"EJECTCD"</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">:</span> <span class="token string">"EJECTCLOSECD"</span><span class="token punctuation">,</span> <span class="token number">163</span><span class="token punctuation">:</span> <span class="token string">"NEXTSONG"</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">:</span> <span class="token string">"PLAYPAUSE"</span><span class="token punctuation">,</span>
	<span class="token number">165</span><span class="token punctuation">:</span> <span class="token string">"PREVIOUSSONG"</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">:</span> <span class="token string">"STOPCD"</span><span class="token punctuation">,</span> <span class="token number">167</span><span class="token punctuation">:</span> <span class="token string">"RECORD"</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">:</span> <span class="token string">"REWIND"</span><span class="token punctuation">,</span> <span class="token number">169</span><span class="token punctuation">:</span> <span class="token string">"PHONE"</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">:</span> <span class="token string">"ISO"</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">:</span> <span class="token string">"CONFIG"</span><span class="token punctuation">,</span> <span class="token number">172</span><span class="token punctuation">:</span> <span class="token string">"HOMEPAGE"</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">:</span> <span class="token string">"REFRESH"</span><span class="token punctuation">,</span>
	<span class="token number">174</span><span class="token punctuation">:</span> <span class="token string">"EXIT"</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">:</span> <span class="token string">"MOVE"</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">:</span> <span class="token string">"EDIT"</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">:</span> <span class="token string">"SCROLLUP"</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">:</span> <span class="token string">"SCROLLDOWN"</span><span class="token punctuation">,</span> <span class="token number">179</span><span class="token punctuation">:</span> <span class="token string">"KPLEFTPAREN"</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">:</span> <span class="token string">"KPRIGHTPAREN"</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">:</span> <span class="token string">"NEW"</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">:</span> <span class="token string">"REDO"</span><span class="token punctuation">,</span>
	<span class="token number">183</span><span class="token punctuation">:</span> <span class="token string">"F13"</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">:</span> <span class="token string">"F14"</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">:</span> <span class="token string">"F15"</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">:</span> <span class="token string">"F16"</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">:</span> <span class="token string">"F17"</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">:</span> <span class="token string">"F18"</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">:</span> <span class="token string">"F19"</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">:</span> <span class="token string">"F20"</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">:</span> <span class="token string">"F21"</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">:</span> <span class="token string">"F22"</span><span class="token punctuation">,</span> <span class="token number">193</span><span class="token punctuation">:</span> <span class="token string">"F23"</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">:</span> <span class="token string">"F24"</span><span class="token punctuation">,</span>
	<span class="token number">200</span><span class="token punctuation">:</span> <span class="token string">"PLAYCD"</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">:</span> <span class="token string">"PAUSECD"</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">:</span> <span class="token string">"PROG3"</span><span class="token punctuation">,</span> <span class="token number">203</span><span class="token punctuation">:</span> <span class="token string">"PROG4"</span><span class="token punctuation">,</span> <span class="token number">204</span><span class="token punctuation">:</span> <span class="token string">"ALL_APPLICATIONS"</span><span class="token punctuation">,</span> <span class="token number">205</span><span class="token punctuation">:</span> <span class="token string">"SUSPEND"</span><span class="token punctuation">,</span> <span class="token number">206</span><span class="token punctuation">:</span> <span class="token string">"CLOSE"</span><span class="token punctuation">,</span> <span class="token number">207</span><span class="token punctuation">:</span> <span class="token string">"PLAY"</span><span class="token punctuation">,</span> <span class="token number">208</span><span class="token punctuation">:</span> <span class="token string">"FASTFORWARD"</span><span class="token punctuation">,</span>
	<span class="token number">209</span><span class="token punctuation">:</span> <span class="token string">"BASSBOOST"</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">:</span> <span class="token string">"PRINT"</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">:</span> <span class="token string">"HP"</span><span class="token punctuation">,</span> <span class="token number">212</span><span class="token punctuation">:</span> <span class="token string">"CAMERA"</span><span class="token punctuation">,</span> <span class="token number">213</span><span class="token punctuation">:</span> <span class="token string">"SOUND"</span><span class="token punctuation">,</span> <span class="token number">214</span><span class="token punctuation">:</span> <span class="token string">"QUESTION"</span><span class="token punctuation">,</span> <span class="token number">215</span><span class="token punctuation">:</span> <span class="token string">"EMAIL"</span><span class="token punctuation">,</span> <span class="token number">216</span><span class="token punctuation">:</span> <span class="token string">"CHAT"</span><span class="token punctuation">,</span> <span class="token number">217</span><span class="token punctuation">:</span> <span class="token string">"SEARCH"</span><span class="token punctuation">,</span> <span class="token number">218</span><span class="token punctuation">:</span> <span class="token string">"CONNECT"</span><span class="token punctuation">,</span>
	<span class="token number">219</span><span class="token punctuation">:</span> <span class="token string">"FINANCE"</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">:</span> <span class="token string">"SPORT"</span><span class="token punctuation">,</span> <span class="token number">221</span><span class="token punctuation">:</span> <span class="token string">"SHOP"</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">:</span> <span class="token string">"ALTERASE"</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">:</span> <span class="token string">"CANCEL"</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">:</span> <span class="token string">"BRIGHTNESSDOWN"</span><span class="token punctuation">,</span> <span class="token number">225</span><span class="token punctuation">:</span> <span class="token string">"BRIGHTNESSUP"</span><span class="token punctuation">,</span> <span class="token number">226</span><span class="token punctuation">:</span> <span class="token string">"MEDIA"</span><span class="token punctuation">,</span>
	<span class="token number">227</span><span class="token punctuation">:</span> <span class="token string">"SWITCHVIDEOMODE"</span><span class="token punctuation">,</span> <span class="token number">228</span><span class="token punctuation">:</span> <span class="token string">"KBDILLUMTOGGLE"</span><span class="token punctuation">,</span> <span class="token number">229</span><span class="token punctuation">:</span> <span class="token string">"KBDILLUMDOWN"</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">:</span> <span class="token string">"KBDILLUMUP"</span><span class="token punctuation">,</span> <span class="token number">231</span><span class="token punctuation">:</span> <span class="token string">"SEND"</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">:</span> <span class="token string">"REPLY"</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">:</span> <span class="token string">"FORWARDMAIL"</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">:</span> <span class="token string">"SAVE"</span><span class="token punctuation">,</span>
	<span class="token number">235</span><span class="token punctuation">:</span> <span class="token string">"DOCUMENTS"</span><span class="token punctuation">,</span> <span class="token number">236</span><span class="token punctuation">:</span> <span class="token string">"BATTERY"</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">:</span> <span class="token string">"BLUETOOTH"</span><span class="token punctuation">,</span> <span class="token number">238</span><span class="token punctuation">:</span> <span class="token string">"WLAN"</span><span class="token punctuation">,</span> <span class="token number">239</span><span class="token punctuation">:</span> <span class="token string">"UWB"</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">:</span> <span class="token string">"UNKNOWN"</span><span class="token punctuation">,</span> <span class="token number">241</span><span class="token punctuation">:</span> <span class="token string">"VIDEO_NEXT"</span><span class="token punctuation">,</span> <span class="token number">242</span><span class="token punctuation">:</span> <span class="token string">"VIDEO_PREV"</span><span class="token punctuation">,</span>
	<span class="token number">243</span><span class="token punctuation">:</span> <span class="token string">"BRIGHTNESS_CYCLE"</span><span class="token punctuation">,</span> <span class="token number">244</span><span class="token punctuation">:</span> <span class="token string">"BRIGHTNESS_AUTO"</span><span class="token punctuation">,</span> <span class="token number">245</span><span class="token punctuation">:</span> <span class="token string">"DISPLAY_OFF"</span><span class="token punctuation">,</span> <span class="token number">246</span><span class="token punctuation">:</span> <span class="token string">"WWAN"</span><span class="token punctuation">,</span> <span class="token number">247</span><span class="token punctuation">:</span> <span class="token string">"RFKILL"</span><span class="token punctuation">,</span> <span class="token number">248</span><span class="token punctuation">:</span> <span class="token string">"MICMUTE"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">keyStr</span><span class="token punctuation">(</span>code <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> code <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> code <span class="token operator">&gt;=</span> MAX_KEYS <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"UNKNOWN"</span>
	<span class="token punctuation">}</span>
	name <span class="token operator">:=</span> keyNames<span class="token punctuation">[</span>code<span class="token punctuation">]</span>
	<span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"UNKNOWN"</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> name
<span class="token punctuation">}</span>

</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        Parse
       </code>
       æ–¹æ³•:
      </strong>
      <ul>
       <li>
        é€šè¿‡
        <code>
         binary.LittleEndian
        </code>
        æ ¼å¼è§£ææ•°æ®ï¼Œç¡®ä¿ä¸å†…æ ¸ä¼ è¾“çš„æ•°æ®æ ¼å¼ä¸€è‡´ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        String
       </code>
       æ–¹æ³•ä¸é”®å€¼æ˜ å°„:
      </strong>
      <ul>
       <li>
        åˆ©ç”¨é¢„å®šä¹‰çš„
        <code>
         keyNames
        </code>
        æ•°ç»„æ˜ å°„æŒ‰é”®ç åˆ°å…·ä½“æŒ‰é”®åç§°ã€‚
       </li>
       <li>
        <code>
         keyStr
        </code>
        å‡½æ•°é€šè¿‡åˆ¤æ–­ç å€¼èŒƒå›´è¿”å›å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›
        <code>
         "UNKNOWN"
        </code>
        ã€‚
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5__374">
     </a>
     5. æ€»ç»“
    </h3>
    <p>
     æœ¬æ–‡é€šè¿‡
     <code>
      Go
     </code>
     è¯­è¨€ç»“åˆ
     <code>
      libbpfgo
     </code>
     æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨eBPFå®ç°é”®ç›˜è®°å½•åŠŸèƒ½ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
    </p>
    <ul>
     <li>
      <strong>
       å®æ—¶æ€§:
      </strong>
      ç›´æ¥åˆ©ç”¨å†…æ ¸
      <code>
       kprobe
      </code>
      æ•æ‰é”®ç›˜äº‹ä»¶ï¼Œæ— éœ€è½®è¯¢ï¼Œå®æ—¶æ€§æä½³â±ï¸ã€‚
     </li>
     <li>
      <strong>
       é«˜æ•ˆæ€§:
      </strong>
      é€šè¿‡
      <code>
       perf buffer
      </code>
      å°†æ•°æ®é«˜æ•ˆä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç¡®ä¿ç³»ç»Ÿæ€§èƒ½ä¸å—å½±å“ã€‚
     </li>
    </ul>
    <p>
     è¯¥æ–¹æ¡ˆä¸ä»…é€‚ç”¨äºé”®ç›˜äº‹ä»¶ç›‘æ§ï¼Œè¿˜å¯ä»¥æ‹“å±•åˆ°å…¶ä»–ç³»ç»Ÿç›‘æ§å’Œå®‰å…¨æ£€æµ‹åœºæ™¯ã€‚åŠ¨æ‰‹å®è·µåï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ä»£ç ï¼Œå®ç°æ›´å¤šé«˜çº§åŠŸèƒ½ã€‚
    </p>
    <hr/>
    <h3>
     <a id="6__384">
     </a>
     6. ç»ƒä¹ é¢˜
    </h3>
    <ol>
     <li>
      <strong>
       æŒ‰é”®è¿‡æ»¤:
      </strong>
      ä¿®æ”¹ä»£ç ä½¿å…¶åªè®°å½•ç‰¹å®šæŒ‰é”®ï¼ˆå¦‚
      <code>
       ESC
      </code>
      æˆ–
      <code>
       ENTER
      </code>
      ï¼‰çš„äº‹ä»¶ï¼Œå¹¶åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œç‰¹åˆ«å¤„ç†ã€‚
     </li>
     <li>
      <strong>
       æ•°æ®ç»Ÿè®¡:
      </strong>
      å¢åŠ åŠŸèƒ½ï¼Œå¯¹æ¯ç§æŒ‰é”®çš„å‡ºç°æ¬¡æ•°è¿›è¡Œç»Ÿè®¡ï¼Œå¹¶å®šæ—¶è¾“å‡ºç»Ÿè®¡ç»“æœã€‚
     </li>
     <li>
      <strong>
       æ‰©å±•åº”ç”¨:
      </strong>
      åœ¨BPFç¨‹åºä¸­å¢åŠ å…¶ä»–ç±»å‹äº‹ä»¶ï¼ˆå¦‚é¼ æ ‡äº‹ä»¶ï¼‰çš„ç›‘æ§ï¼Œæ¢ç´¢æ›´å¤šå†…æ ¸äº‹ä»¶çš„æ•æ‰æ–¹å¼ã€‚
     </li>
    </ol>
    <p>
     ğŸš€
     <strong>
      åŠ¨æ‰‹è¯•è¯•å§ï¼é‡åˆ°é—®é¢˜æ¬¢è¿ç•™è¨€äº¤æµï¼Œä¸€èµ·è¿›æ­¥ï¼
     </strong>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34373736333632332f:61727469636c652f64657461696c732f313436323736353235" class_="artid" style="display:none">
 </p>
</div>


