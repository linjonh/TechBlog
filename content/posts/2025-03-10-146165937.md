---
layout: post
title: "重生之我在学Vue-第6天-Vue-3-状态管理Pinia"
date: 2025-03-10 22:40:04 +0800
description: "当项目发展到多组件共享状态时，单纯依靠父子组件通信会变得难以维护。Pinia 作为 Vue 3 官方推荐的状态管理工具，提供更清晰的逻辑分层和响应式状态管理。今天我们将学习如何用 Pinia 实现全局状态管理，并构建可维护的任务管理模块。Vue3 官方中文文档传送点：简介 | Vue.jsVue3 的中文官方文档学习笔记很全还有练习场，推荐去官网学习Vue 前端成仙之路_野生的程序媛的博客-CSDN博客Go 后端成神之路_野生的程序媛的博客-CSDN博客。"
keywords: "重生之我在学Vue--第6天 Vue 3 状态管理（Pinia）"
categories: ['前端成仙之路', 'Vue']
tags: ['前端', 'Vue', 'Javascript']
artid: "146165937"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146165937
    alt: "重生之我在学Vue-第6天-Vue-3-状态管理Pinia"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146165937
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146165937
cover: https://bing.ee123.net/img/rand?artid=146165937
image: https://bing.ee123.net/img/rand?artid=146165937
img: https://bing.ee123.net/img/rand?artid=146165937
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     重生之我在学Vue--第6天 Vue 3 状态管理（Pinia）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Vue6_Vue_3_Pinia_0">
     </a>
     重生之我在学Vue–第6天 Vue 3 状态管理（Pinia）
    </h2>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="_3">
     </a>
     前言
    </h3>
    <p>
     当项目发展到多组件共享状态时，单纯依靠父子组件通信会变得难以维护。Pinia 作为 Vue 3 官方推荐的状态管理工具，提供更清晰的逻辑分层和响应式状态管理。今天我们将学习如何用 Pinia 实现全局状态管理，并构建可维护的任务管理模块。
    </p>
    <p>
     Vue3 官方中文文档传送点：
     <a href="https://cn.vuejs.org/guide/introduction.html" rel="nofollow">
      简介 | Vue.js
     </a>
    </p>
    <blockquote>
     <p>
      Vue3 的中文官方文档学习笔记很全还有练习场，推荐去官网学习
     </p>
    </blockquote>
    <p>
     Vue前端成仙之路：
     <a href="https://blog.csdn.net/xiao651/category_12852894.html?spm=1001.2014.3001.5482">
      Vue 前端成仙之路_野生的程序媛的博客-CSDN博客
     </a>
    </p>
    <p>
     GO后端成神之路：
     <a href="https://blog.csdn.net/xiao651/category_12842927.html">
      Go 后端成神之路_野生的程序媛的博客-CSDN博客
     </a>
    </p>
    <hr/>
    <h3>
     <a id="Pinia__17">
     </a>
     一、Pinia 核心概念速览
    </h3>
    <h4>
     <a id="11__19">
     </a>
     1.1 为什么需要状态管理？
    </h4>
    <p>
     当遇到以下场景时，需引入状态管理：
    </p>
    <ul>
     <li>
      多个组件依赖同一状态（如用户登录信息）
     </li>
     <li>
      跨层级组件需要修改同一状态
     </li>
     <li>
      需要跟踪复杂的状态变更历史
     </li>
    </ul>
    <h4>
     <a id="12_Pinia__27">
     </a>
     1.2 Pinia 核心三要素
    </h4>
    <table>
     <thead>
      <tr>
       <th align="center">
        概念
       </th>
       <th align="center">
        作用
       </th>
       <th align="center">
        示例场景
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="center">
        State
       </td>
       <td align="center">
        存储全局响应式数据
       </td>
       <td align="center">
        <code>
         tasks: []
        </code>
        任务列表
       </td>
      </tr>
      <tr>
       <td align="center">
        Getters
       </td>
       <td align="center">
        基于 State 的派生数据（计算属性）
       </td>
       <td align="center">
        <code>
         completedTasksCount
        </code>
       </td>
      </tr>
      <tr>
       <td align="center">
        Actions
       </td>
       <td align="center">
        修改 State 的业务逻辑
       </td>
       <td align="center">
        <code>
         addTask()
        </code>
        ,
        <code>
         deleteTask()
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="Pinia__37">
     </a>
     二、Pinia 快速上手
    </h3>
    <h4>
     <a id="21__39">
     </a>
     2.1 安装与初始化
    </h4>
    <p>
     bash
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> pinia
</code></pre>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="22__Store_58">
     </a>
     2.2 创建第一个 Store
    </h4>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// stores/taskStore.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useTaskStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'task'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">tasks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filter</span><span class="token operator">:</span> <span class="token string">'all'</span> <span class="token comment">// all/completed/active</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">filteredTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">task</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filter <span class="token operator">===</span> <span class="token string">'completed'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> task<span class="token punctuation">.</span>completed
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filter <span class="token operator">===</span> <span class="token string">'active'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>completed
        <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token parameter">title</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        title<span class="token punctuation">,</span>
        <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">toggleTask</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">)</span> task<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>completed
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_98">
     </a>
     三、模块化状态管理
    </h3>
    <h4>
     <a id="31__Store__100">
     </a>
     3.1 多 Store 场景
    </h4>
    <p>
     bash
    </p>
    <pre><code class="prism language-bash">src/
  stores/
    taskStore.js    <span class="token comment"># 任务管理模块</span>
    userStore.js    <span class="token comment"># 用户模块</span>
    configStore.js  <span class="token comment"># 系统配置模块</span>
</code></pre>
    <h4>
     <a id="32_Store__112">
     </a>
     3.2 Store 间通信
    </h4>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// stores/userStore.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> taskStore <span class="token operator">=</span> <span class="token function">useTaskStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      taskStore<span class="token punctuation">.</span><span class="token function">$reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 退出时清空任务状态</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_Pinia_130">
     </a>
     四、在组件中使用 Pinia
    </h3>
    <h4>
     <a id="41__132">
     </a>
     4.1 状态访问与修改
    </h4>
    <p>
     vue
    </p>
    <pre><code class="prism language-vue">&lt;script setup&gt;
import { useTaskStore } from '@/stores/taskStore'

const taskStore = useTaskStore()

// 直接访问状态
console.log(taskStore.tasks) 

// 调用 Action
const handleAdd = () =&gt; taskStore.addTask(newTask.value)
&lt;/script&gt;

&lt;template&gt;
  &lt;div v-for="task in taskStore.filteredTasks" :key="task.id"&gt;
    {<!-- -->{ task.title }}
    &lt;button @click="taskStore.toggleTask(task.id)"&gt;切换状态&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
    <h4>
     <a id="42__157">
     </a>
     4.2 状态解构的陷阱
    </h4>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// ❌ 错误：破坏响应性</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> tasks <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>taskStore<span class="token punctuation">)</span> 

<span class="token comment">// ✅ 正确方式</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> tasks <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span>taskStore<span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_172">
     </a>
     五、进阶开发技巧
    </h3>
    <h4>
     <a id="51__174">
     </a>
     5.1 持久化存储插件
    </h4>
    <p>
     bash
    </p>
    <pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> pinia-plugin-persistedstate
</code></pre>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> piniaPluginPersistedstate <span class="token keyword">from</span> <span class="token string">'pinia-plugin-persistedstate'</span>

<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>piniaPluginPersistedstate<span class="token punctuation">)</span>
</code></pre>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 在 Store 中启用</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useTaskStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'task'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">persist</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启持久化</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="52__203">
     </a>
     5.2 状态重置与订阅
    </h4>
    <p>
     javascript
    </p>
    <pre><code class="prism language-javascript"><span class="token comment">// 重置单个 Store</span>
taskStore<span class="token punctuation">.</span><span class="token function">$reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 订阅状态变化</span>
taskStore<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'状态变化:'</span><span class="token punctuation">,</span> mutation<span class="token punctuation">.</span>type<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_219">
     </a>
     六、常见问题解答
    </h3>
    <h4>
     <a id="Q1Pinia__Vuex__221">
     </a>
     Q1：Pinia 和 Vuex 有什么区别？
    </h4>
    <table>
     <thead>
      <tr>
       <th align="center">
        特性
       </th>
       <th align="center">
        Pinia
       </th>
       <th align="center">
        Vuex
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="center">
        Vue 3 支持
       </td>
       <td align="center">
        原生支持
       </td>
       <td align="center">
        需要兼容版本
       </td>
      </tr>
      <tr>
       <td align="center">
        TypeScript
       </td>
       <td align="center">
        完美支持
       </td>
       <td align="center">
        需要额外配置
       </td>
      </tr>
      <tr>
       <td align="center">
        代码结构
       </td>
       <td align="center">
        更简洁的 Composition API
       </td>
       <td align="center">
        基于 Options API
       </td>
      </tr>
      <tr>
       <td align="center">
        模块化
       </td>
       <td align="center">
        天然多 Store 设计
       </td>
       <td align="center">
        需要分 modules
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="Q2_Pinia__230">
     </a>
     Q2：如何调试 Pinia 状态？
    </h4>
    <ol>
     <li>
      安装 Vue Devtools
     </li>
     <li>
      在浏览器开发者工具中查看 Pinia 标签页
     </li>
     <li>
      实时查看状态变化和时间旅行调试
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_238">
     </a>
     今日任务：构建任务管理模块
    </h3>
    <ol>
     <li>
      <p>
       创建
       <code>
        taskStore
       </code>
       实现以下功能：
      </p>
      <ul>
       <li>
        任务增删改查
       </li>
       <li>
        按状态过滤任务
       </li>
       <li>
        s任务统计（总数/完成数）
       </li>
      </ul>
     </li>
     <li>
      <p>
       在组件中集成：
      </p>
      <p>
       vue
      </p>
      <pre><code class="prism language-vue">&lt;template&gt;
  &lt;div&gt;
    &lt;input v-model="newTask" @keyup.enter="addTask"&gt;
    &lt;select v-model="taskStore.filter"&gt;
      &lt;option value="all"&gt;全部&lt;/option&gt;
      &lt;option value="completed"&gt;已完成&lt;/option&gt;
      &lt;option value="active"&gt;未完成&lt;/option&gt;
    &lt;/select&gt;
    &lt;div v-for="task in taskStore.filteredTasks" :key="task.id"&gt;
      {<!-- -->{ task.title }}
      &lt;button @click="taskStore.toggleTask(task.id)"&gt;
        {<!-- -->{ task.completed ? '✅' : '⬜' }}
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f5869616f3635312f:61727469636c652f64657461696c732f313436313635393337" class_="artid" style="display:none">
 </p>
</div>


