---
layout: post
title: "通过接口或抽象类进一步解耦"
date: 2025-03-10 13:10:15 +0800
description: "通过这种方式，我们可以有效地解耦模块，并确保系统的可扩展性和可维护性。的示例，展示如何通过接口和抽象类来解耦模块，并确保模块内部的函数之间不会产生不必要的依赖。这个接口可以被不同的实现类（如系统时间提供者、模拟时间提供者）实现。为了避免耦合，我们使用接口（抽象类）来定义模块之间的交互。在主程序中，我们通过依赖注入的方式将各个模块组合在一起。类，负责格式化时间数据。，用于显示格式化后的时间。接下来，我们实现一个具体的类。接口，而不是具体的实现类。首先，我们定义一个接口。，它从系统获取时间数据。"
keywords: "模块之间耦合使用接口实现还是函数实现"
categories: ['Qt']
tags: ['系统架构', '数据库']
artid: "146151767"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146151767
    alt: "通过接口或抽象类进一步解耦"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146151767
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146151767
cover: https://bing.ee123.net/img/rand?artid=146151767
image: https://bing.ee123.net/img/rand?artid=146151767
img: https://bing.ee123.net/img/rand?artid=146151767
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     通过接口或抽象类进一步解耦
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在 C++ 中，使用
     <strong>
      接口（抽象类）
     </strong>
     和
     <strong>
      依赖注入
     </strong>
     是避免模块之间过度耦合的常见方法。以下是一个基于
     <strong>
      Qt
     </strong>
     的示例，展示如何通过接口和抽象类来解耦模块，并确保模块内部的函数之间不会产生不必要的依赖。
    </p>
    <hr/>
    <h3>
     <a id="1__4">
     </a>
     <strong>
      1. 示例场景
     </strong>
    </h3>
    <p>
     假设我们有一个
     <strong>
      日期时间显示模块
     </strong>
     ，它涉及以下层次：
    </p>
    <ul>
     <li>
      <strong>
       用户界面层（UI Layer）
      </strong>
      ：负责显示日期时间。
     </li>
     <li>
      <strong>
       业务逻辑层（Business Logic Layer）
      </strong>
      ：负责获取和格式化日期时间。
     </li>
     <li>
      <strong>
       数据访问层（Data Access Layer）
      </strong>
      ：负责从系统获取原始时间数据。
     </li>
    </ul>
    <p>
     为了避免耦合，我们使用接口（抽象类）来定义模块之间的交互。
    </p>
    <hr/>
    <h3>
     <a id="2__14">
     </a>
     <strong>
      2. 实现代码
     </strong>
    </h3>
    <h4>
     <a id="21__16">
     </a>
     <strong>
      2.1 定义接口（抽象类）
     </strong>
    </h4>
    <p>
     首先，我们定义一个接口
     <code>
      IDateTimeProvider
     </code>
     ，用于获取原始时间数据。这个接口可以被不同的实现类（如系统时间提供者、模拟时间提供者）实现。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// IDateTimeProvider.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">IDATETIMEPROVIDER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IDATETIMEPROVIDER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDateTime&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">IDateTimeProvider</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">IDateTimeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> QDateTime <span class="token function">getCurrentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 获取当前时间</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// IDATETIMEPROVIDER_H</span></span>
</code></pre>
    <hr/>
    <h4>
     <a id="22__37">
     </a>
     <strong>
      2.2 实现接口
     </strong>
    </h4>
    <p>
     接下来，我们实现一个具体的类
     <code>
      SystemDateTimeProvider
     </code>
     ，它从系统获取时间数据。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// SystemDateTimeProvider.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SYSTEMDATETIMEPROVIDER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SYSTEMDATETIMEPROVIDER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IDateTimeProvider.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDateTime&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">SystemDateTimeProvider</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">IDateTimeProvider</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    QDateTime <span class="token function">getCurrentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">QDateTime</span><span class="token double-colon punctuation">::</span><span class="token function">currentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从系统获取当前时间</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// SYSTEMDATETIMEPROVIDER_H</span></span>
</code></pre>
    <hr/>
    <h4>
     <a id="23__60">
     </a>
     <strong>
      2.3 业务逻辑层
     </strong>
    </h4>
    <p>
     我们创建一个
     <code>
      DateTimeFormatter
     </code>
     类，负责格式化时间数据。它依赖于
     <code>
      IDateTimeProvider
     </code>
     接口，而不是具体的实现类。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// DateTimeFormatter.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">DATETIMEFORMATTER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DATETIMEFORMATTER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IDateTimeProvider.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QString&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">DateTimeFormatter</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">DateTimeFormatter</span><span class="token punctuation">(</span>IDateTimeProvider<span class="token operator">*</span> provider<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m_provider</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    QString <span class="token function">getFormattedDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
        QDateTime dateTime <span class="token operator">=</span> m_provider<span class="token operator">-&gt;</span><span class="token function">getCurrentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 格式化时间</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    IDateTimeProvider<span class="token operator">*</span> m_provider<span class="token punctuation">;</span> <span class="token comment">// 依赖注入</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// DATETIMEFORMATTER_H</span></span>
</code></pre>
    <hr/>
    <h4>
     <a id="24__89">
     </a>
     <strong>
      2.4 用户界面层
     </strong>
    </h4>
    <p>
     我们创建一个 Qt 窗口类
     <code>
      DateTimeWindow
     </code>
     ，用于显示格式化后的时间。它依赖于
     <code>
      DateTimeFormatter
     </code>
     。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// DateTimeWindow.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">DATETIMEWINDOW_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DATETIMEWINDOW_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QLabel&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DateTimeFormatter.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">DateTimeWindow</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">DateTimeWindow</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token operator">*</span> formatter<span class="token punctuation">,</span> QWidget<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_formatter</span><span class="token punctuation">(</span>formatter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setupUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setupUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        QVBoxLayout<span class="token operator">*</span> layout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QVBoxLayout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        QLabel<span class="token operator">*</span> label <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        label<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span>m_formatter<span class="token operator">-&gt;</span><span class="token function">getFormattedDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示格式化时间</span>
        layout<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setLayout</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    DateTimeFormatter<span class="token operator">*</span> m_formatter<span class="token punctuation">;</span> <span class="token comment">// 依赖注入</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// DATETIMEWINDOW_H</span></span>
</code></pre>
    <hr/>
    <h4>
     <a id="25__130">
     </a>
     <strong>
      2.5 主程序
     </strong>
    </h4>
    <p>
     在主程序中，我们通过依赖注入的方式将各个模块组合在一起。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// main.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DateTimeWindow.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DateTimeFormatter.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SystemDateTimeProvider.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建具体的时间提供者</span>
    SystemDateTimeProvider provider<span class="token punctuation">;</span>

    <span class="token comment">// 创建格式化器，注入时间提供者</span>
    DateTimeFormatter <span class="token function">formatter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建窗口，注入格式化器</span>
    DateTimeWindow <span class="token function">window</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>formatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="3__159">
     </a>
     <strong>
      3. 代码结构说明
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       <code>
        IDateTimeProvider
       </code>
      </strong>
      ：
      <ul>
       <li>
        是一个抽象类，定义了获取时间数据的接口。
       </li>
       <li>
        具体的实现类（如
        <code>
         SystemDateTimeProvider
        </code>
        ）可以替换为其他实现（如模拟时间提供者）。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        DateTimeFormatter
       </code>
      </strong>
      ：
      <ul>
       <li>
        依赖于
        <code>
         IDateTimeProvider
        </code>
        接口，而不是具体的实现类。
       </li>
       <li>
        通过依赖注入的方式获取时间数据。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       <code>
        DateTimeWindow
       </code>
      </strong>
      ：
      <ul>
       <li>
        依赖于
        <code>
         DateTimeFormatter
        </code>
        ，负责显示格式化后的时间。
       </li>
       <li>
        通过依赖注入的方式获取格式化器。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="4__172">
     </a>
     <strong>
      4. 解耦的优势
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       可扩展性
      </strong>
      ：
      <ul>
       <li>
        如果需要更换时间提供者（如从系统时间切换到网络时间），只需实现新的
        <code>
         IDateTimeProvider
        </code>
        类，而不需要修改
        <code>
         DateTimeFormatter
        </code>
        或
        <code>
         DateTimeWindow
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       可测试性
      </strong>
      ：
      <ul>
       <li>
        可以通过模拟
        <code>
         IDateTimeProvider
        </code>
        的实现类来测试
        <code>
         DateTimeFormatter
        </code>
        ，而不依赖真实的系统时间。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       职责清晰
      </strong>
      ：
      <ul>
       <li>
        每个模块只负责一个明确的功能，符合单一职责原则。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5__182">
     </a>
     <strong>
      5. 扩展与优化
     </strong>
    </h3>
    <ul>
     <li>
      <strong>
       支持更多时间格式
      </strong>
      ：
      <ul>
       <li>
        可以在
        <code>
         DateTimeFormatter
        </code>
        中添加更多格式化选项。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       动态切换时间提供者
      </strong>
      ：
      <ul>
       <li>
        可以在运行时动态切换
        <code>
         IDateTimeProvider
        </code>
        的实现类。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       使用智能指针
      </strong>
      ：
      <ul>
       <li>
        可以使用
        <code>
         std::shared_ptr
        </code>
        或
        <code>
         QSharedPointer
        </code>
        来管理依赖对象的生命周期，避免内存泄漏。
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="6__192">
     </a>
     <strong>
      6. 完整代码
     </strong>
    </h3>
    <p>
     以下是完整的代码实现：
    </p>
    <h4>
     <a id="IDateTimeProviderh_195">
     </a>
     <strong>
      <code>
       IDateTimeProvider.h
      </code>
     </strong>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">IDATETIMEPROVIDER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IDATETIMEPROVIDER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDateTime&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">IDateTimeProvider</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">IDateTimeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> QDateTime <span class="token function">getCurrentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// IDATETIMEPROVIDER_H</span></span>
</code></pre>
    <h4>
     <a id="SystemDateTimeProviderh_211">
     </a>
     <strong>
      <code>
       SystemDateTimeProvider.h
      </code>
     </strong>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SYSTEMDATETIMEPROVIDER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SYSTEMDATETIMEPROVIDER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IDateTimeProvider.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDateTime&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">SystemDateTimeProvider</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">IDateTimeProvider</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    QDateTime <span class="token function">getCurrentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">QDateTime</span><span class="token double-colon punctuation">::</span><span class="token function">currentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// SYSTEMDATETIMEPROVIDER_H</span></span>
</code></pre>
    <h4>
     <a id="DateTimeFormatterh_229">
     </a>
     <strong>
      <code>
       DateTimeFormatter.h
      </code>
     </strong>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">DATETIMEFORMATTER_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DATETIMEFORMATTER_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IDateTimeProvider.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QString&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">DateTimeFormatter</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">DateTimeFormatter</span><span class="token punctuation">(</span>IDateTimeProvider<span class="token operator">*</span> provider<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m_provider</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    QString <span class="token function">getFormattedDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
        QDateTime dateTime <span class="token operator">=</span> m_provider<span class="token operator">-&gt;</span><span class="token function">getCurrentDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    IDateTimeProvider<span class="token operator">*</span> m_provider<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// DATETIMEFORMATTER_H</span></span>
</code></pre>
    <h4>
     <a id="DateTimeWindowh_253">
     </a>
     <strong>
      <code>
       DateTimeWindow.h
      </code>
     </strong>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">DATETIMEWINDOW_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DATETIMEWINDOW_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWidget&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QLabel&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DateTimeFormatter.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">DateTimeWindow</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QWidget</span></span> <span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">DateTimeWindow</span><span class="token punctuation">(</span>DateTimeFormatter<span class="token operator">*</span> formatter<span class="token punctuation">,</span> QWidget<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_formatter</span><span class="token punctuation">(</span>formatter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setupUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setupUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        QVBoxLayout<span class="token operator">*</span> layout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QVBoxLayout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        QLabel<span class="token operator">*</span> label <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLabel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        label<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span>m_formatter<span class="token operator">-&gt;</span><span class="token function">getFormattedDateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        layout<span class="token operator">-&gt;</span><span class="token function">addWidget</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setLayout</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    DateTimeFormatter<span class="token operator">*</span> m_formatter<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// DATETIMEWINDOW_H</span></span>
</code></pre>
    <h4>
     <a id="maincpp_289">
     </a>
     <strong>
      <code>
       main.cpp
      </code>
     </strong>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DateTimeWindow.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DateTimeFormatter.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SystemDateTimeProvider.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    SystemDateTimeProvider provider<span class="token punctuation">;</span>
    DateTimeFormatter <span class="token function">formatter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
    DateTimeWindow <span class="token function">window</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>formatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <p>
     通过这种方式，我们可以有效地解耦模块，并确保系统的可扩展性和可维护性。如果需要进一步扩展或优化，可以根据实际需求调整代码！
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35353537363239302f:61727469636c652f64657461696c732f313436313531373637" class_="artid" style="display:none">
 </p>
</div>


