---
layout: post
title: "go个人论坛项目"
date: 2025-03-12 17:19:11 +0800
description: "PS：有些地方没有写好，请选择性查看。"
keywords: "go个人论坛项目"
categories: ['未分类']
tags: ['开发语言', '后端', 'Golang']
artid: "146210114"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146210114
    alt: "go个人论坛项目"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146210114
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146210114
cover: https://bing.ee123.net/img/rand?artid=146210114
image: https://bing.ee123.net/img/rand?artid=146210114
img: https://bing.ee123.net/img/rand?artid=146210114
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     go个人论坛项目
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     搭建个人论坛
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/30871a2c5579462cbfb326f8f91ed695.jpeg"/>
    </p>
    <p>
     项目地址：
     <a href="https://gitee.com/why151/my-forum/tree/post-why-3.2/" rel="nofollow">
      MyForum: go+gin+vue搭建论坛 - Gitee.com
     </a>
    </p>
    <p>
     PS：有些地方没有写好，请选择性查看
    </p>
    <h3>
     <a id="_9">
     </a>
     初始化项目
    </h3>
    <ol>
     <li>
      创建目录结构
     </li>
    </ol>
    <p>
     <img alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=C%3A%5CUsers%5C17585%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20250226101407898.png&amp;pos_id=img-xA9evsPn-1741771108195"/>
    </p>
    <ol start="2">
     <li>
      利用ini配置初始化框架
     </li>
    </ol>
    <pre><code class="prism language-ini">[server]
AppMode = debug
HttpPort = :3000
JwtKey = "dhjasdkajh321"

[database]
Db = mysql
DbHost = localhost
DbPort = 3306
DbUser = root
DbPassWord = flzx3qc
DbName = gForum
</code></pre>
    <pre><code class="prism language-golang">package config

import (
	"fmt"

	"gopkg.in/ini.v1"
)

var (
	AppMode string
	HttpPort  string
	JwtKey string

	Db string
	DbHost string
	DbPort string
	DbUser string
	DbPassWord string
	DbName string
)

func init(){
	file, err := ini.Load("config/config.ini")
	if err!=nil{
		fmt.Println("参数初始化错误:",err)
	}
	LoadServer(file)
	LoadDataBase(file)
}

func LoadServer(file *ini.File){
	AppMode = file.Section("server").Key("AppMode").MustString("debug")
	HttpPort = file.Section("server").Key("HttpPort").MustString("3000")
	JwtKey = file.Section("server").Key("JwtKey").MustString("dhajsfkas")
}

func LoadDataBase(file *ini.File){
	Db = file.Section("databse").Key("Db").MustString("")
	DbHost = file.Section("databse").Key("DbHost").MustString("")
	DbPort = file.Section("databse").Key("DbPort").MustString("")
	DbUser = file.Section("databse").Key("DbUser").MustString("")
	DbPassWord = file.Section("databse").Key("DbPassWord").MustString("")
	DbName = file.Section("databse").Key("DbName").MustString("")
}
</code></pre>
    <ol start="3">
     <li>
      搭建gin框架
     </li>
    </ol>
    <pre><code class="prism language-vue">package myforum

import "MY-FORUM/routers"

func main() {
	routers.InitRouter()
}
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">package</span> routers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/config"</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">InitRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	gin<span class="token punctuation">.</span><span class="token function">SetMode</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>AppMode<span class="token punctuation">)</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>HttpPort<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_106">
     </a>
     注册登录模块
    </h3>
    <h4>
     <a id="_108">
     </a>
     创建数据库
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/models"</span>
	<span class="token string">"MY-FORUM/routers"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 连接数据库</span>
	models<span class="token punctuation">.</span><span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 配置路由</span>
	routers<span class="token punctuation">.</span><span class="token function">InitRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/config"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"time"</span>
	<span class="token string">"gorm.io/driver/mysql"</span>
	<span class="token string">"gorm.io/gorm"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB
<span class="token keyword">var</span> err <span class="token builtin">error</span>

<span class="token keyword">func</span> <span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	dsn <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%v:%v@tcp(%v:%v)/%v?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span><span class="token punctuation">,</span>
	config<span class="token punctuation">.</span>DbUser<span class="token punctuation">,</span> config<span class="token punctuation">.</span>DbPassWord<span class="token punctuation">,</span> config<span class="token punctuation">.</span>DbHost<span class="token punctuation">,</span> config<span class="token punctuation">.</span>DbPort<span class="token punctuation">,</span> config<span class="token punctuation">.</span>DbName<span class="token punctuation">)</span>
	db<span class="token punctuation">,</span> err <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dsn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"数据库连接失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	sqlDB<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"数据库连接失败："</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 模型迁移</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 设置连接池最大闲置连接数</span>
	sqlDB<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

	<span class="token comment">// 设置数据库的最大连接数量</span>
	sqlDB<span class="token punctuation">.</span><span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>

	<span class="token comment">// 设置连接的最大可复用时间</span>
	sqlDB<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token string">"gorm.io/gorm"</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	gorm<span class="token punctuation">.</span>Model
	UserId <span class="token builtin">int64</span> <span class="token string">`gorm:"type:bigint(20);primaryKey;autoIncrement" josn:"userid"`</span>
	UserName <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64);not null" json:"username"`</span>
	PassWord <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64);not null" json:"password"`</span>
	Email <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64)" json:"email"`</span>
	Gender <span class="token builtin">int</span> <span class="token string">`gorm:"type:tinyint(4)" json:"gender"`</span>
	Role <span class="token builtin">int</span> <span class="token string">`gorm:"type:tinyint(4);default:1" json:"role"`</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_183">
     </a>
     注册
    </h4>
    <ol>
     <li>
      定义注册接收表单结构体，并利用validator进行参数校验设置
     </li>
    </ol>
    <p>
     PS：binding在绑定时进行校验，validate需要手动调用函数进行校验（参考：
     <a href="https://learnku.com/articles/78391" rel="nofollow">
      Go 验证器 validator 详解 | Go 技术论坛
     </a>
     ）
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> UserSignUp <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span>
	UserName <span class="token builtin">string</span> <span class="token string">`json:"username" validate:"required"`</span>
	PassWord <span class="token builtin">string</span> <span class="token string">`json:"password" validate:"required"`</span>
	ConfirmPassWord <span class="token builtin">string</span> <span class="token string">`json:"confirm_password" validate:"required,eqfield=PassWord"`</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      进行gorm操作
     </li>
    </ol>
    <p>
     查询用户名是否已经存在
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 判断username是否已经存在</span>
<span class="token keyword">func</span> <span class="token function">FindUserNameExist</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> user User
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"user_name = ?"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"用户名称查询失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> user<span class="token punctuation">.</span>ID <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     添加用户
    </p>
    <pre><code class="prism language-go"><span class="token comment">// 添加用户</span>
<span class="token keyword">func</span> <span class="token function">AddUser</span><span class="token punctuation">(</span>user User<span class="token punctuation">)</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>
</code></pre>
    <ol start="3">
     <li>
      进行api函数的编写
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">SignUp</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> userSignUp models<span class="token punctuation">.</span>UserSignUp
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>userSignUp<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> translater<span class="token punctuation">.</span>Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>userSignUp<span class="token punctuation">)</span>
	<span class="token comment">// 参数校验有问题</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token keyword">range</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>translater<span class="token punctuation">.</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> userSignUp<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	username <span class="token operator">:=</span> userSignUp<span class="token punctuation">.</span>UserName
	password <span class="token operator">:=</span> userSignUp<span class="token punctuation">.</span>PassWord
	<span class="token keyword">if</span> models<span class="token punctuation">.</span><span class="token function">FindUserNameExist</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USERNAME_IS_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> userSignUp<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	user <span class="token operator">:=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">{<!-- --></span>
		UserName<span class="token punctuation">:</span> username<span class="token punctuation">,</span>
		PassWord<span class="token punctuation">:</span> password<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">AddUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> userSignUp<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="4">
     <li>
      注册路由
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">InitUserRouter</span><span class="token punctuation">(</span>r <span class="token operator">*</span>gin<span class="token punctuation">.</span>Engine<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	UserRouter <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"v1/user"</span><span class="token punctuation">)</span>
	UserRouter<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>SignUp<span class="token punctuation">)</span> <span class="token comment">// 用户注册</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_283">
     </a>
     登录
    </h4>
    <ol>
     <li>
      定义接收登录表达信息的结构体
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">type</span> UserLogin <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span>
	UserName <span class="token builtin">string</span> <span class="token string">`json:"username" validate:"required"`</span>
	PassWord <span class="token builtin">string</span>  <span class="token string">`json:"password" validate:"required"`</span>
	AccessToken <span class="token builtin">string</span>
	RefreshToken <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="2">
     <li>
      在库中查询密码
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token comment">// 获取用户密码</span>
<span class="token keyword">func</span> <span class="token function">GetPassWord</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> user User
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"user_name = ?"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"密码获取失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> user<span class="token punctuation">.</span>PassWord
<span class="token punctuation">}</span>
</code></pre>
    <ol start="3">
     <li>
      获取Token
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token keyword">package</span> jwt

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/config"</span>
	<span class="token string">"errors"</span>
	<span class="token string">"time"</span>
	<span class="token string">"github.com/dgrijalva/jwt-go"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> MyClaims <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	UserName <span class="token builtin">string</span> <span class="token string">`json:"username"`</span>
	jwt<span class="token punctuation">.</span>StandardClaims
<span class="token punctuation">}</span>

<span class="token keyword">var</span> mySecret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>JwtKey<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">keyFunc</span><span class="token punctuation">(</span><span class="token boolean">_</span> <span class="token operator">*</span>jwt<span class="token punctuation">.</span>Token<span class="token punctuation">)</span> <span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> mySecret<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> tokenExpire <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Hour


<span class="token comment">// 生成accessToken refreshToken</span>
<span class="token keyword">func</span> <span class="token function">GenToken</span><span class="token punctuation">(</span>username <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>aToken<span class="token punctuation">,</span> rToken <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建一个自己的声明</span>
	c <span class="token operator">:=</span> MyClaims<span class="token punctuation">{<!-- --></span>
		username<span class="token punctuation">,</span>
		jwt<span class="token punctuation">.</span>StandardClaims<span class="token punctuation">{<!-- --></span>	<span class="token comment">// JWT规定的7个官方字段</span>
			ExpiresAt<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>tokenExpire<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 过期时间</span>
			Issuer<span class="token punctuation">:</span>    <span class="token string">"why"</span><span class="token punctuation">,</span>                                 <span class="token comment">// 签发人</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 加密并获得完整的编码后的字符串token</span>
	aToken<span class="token punctuation">,</span> err <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">NewWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span>mySecret<span class="token punctuation">)</span>

	<span class="token comment">// refresh token 不需要存任何自定义数据</span>
	rToken<span class="token punctuation">,</span> err <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">NewWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>StandardClaims<span class="token punctuation">{<!-- --></span>
		ExpiresAt<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 过期时间</span>
		Issuer<span class="token punctuation">:</span>    <span class="token string">"bluebell"</span><span class="token punctuation">,</span>                              <span class="token comment">// 签发人</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span>mySecret<span class="token punctuation">)</span>
	<span class="token comment">// 使用指定的secret签名并获得完整的编码后的字符串token</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="4">
     <li>
      编写登录api
     </li>
    </ol>
    <pre><code class="prism language-go"><span class="token comment">// 登录</span>
<span class="token keyword">func</span> <span class="token function">Login</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> userLogin models<span class="token punctuation">.</span>UserLogin
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>userLogin<span class="token punctuation">)</span>
	err <span class="token operator">:=</span> Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>userLogin<span class="token punctuation">)</span>
	<span class="token comment">// 参数校验错误</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token keyword">range</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> userLogin<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断用户是否存在</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>models<span class="token punctuation">.</span><span class="token function">FindUserNameExist</span><span class="token punctuation">(</span>userLogin<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USER_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> userLogin<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 验证密码是否正确</span>
	password <span class="token operator">:=</span> encrypt<span class="token punctuation">.</span><span class="token function">GenerateSpw</span><span class="token punctuation">(</span>userLogin<span class="token punctuation">.</span>PassWord<span class="token punctuation">)</span>
	truePassword <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPassWord</span><span class="token punctuation">(</span>userLogin<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
	<span class="token keyword">if</span> password<span class="token operator">!=</span>truePassword<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>PASSWORD_IS_WRONG<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> userLogin<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 获取token</span>
	atoken<span class="token punctuation">,</span>rtoken<span class="token punctuation">,</span> err <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">GenToken</span><span class="token punctuation">(</span>userLogin<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>TOKEN_GET_ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> userLogin<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	userLogin<span class="token punctuation">.</span>AccessToken <span class="token operator">=</span> atoken
	userLogin<span class="token punctuation">.</span>RefreshToken <span class="token operator">=</span> rtoken
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>SUCCES<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> userLogin<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_420">
     </a>
     鉴权
    </h4>
    <p>
     jwt鉴权中间件
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">JwtAuthMiddle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 验证header中是否有Authorization</span>
		authHeader <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">GetHeader</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> authHeader<span class="token operator">==</span><span class="token string">""</span> <span class="token operator">||</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>authHeader<span class="token punctuation">,</span><span class="token string">"Bearer "</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
				<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">"msg"</span> <span class="token punctuation">:</span> <span class="token string">"用户权限不足"</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 解析atoken</span>
		atoken <span class="token operator">:=</span> authHeader<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
		claims<span class="token punctuation">,</span> err <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">ParseToken</span><span class="token punctuation">(</span>atoken<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
				<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>TOKEN_PARSE_ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">"data"</span> <span class="token punctuation">:</span> atoken<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 验证用户</span>
		username <span class="token operator">:=</span> claims<span class="token punctuation">.</span>UserName
		<span class="token keyword">if</span> <span class="token operator">!</span>models<span class="token punctuation">.</span><span class="token function">FindUserNameExist</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
				<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USER_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token string">"data"</span> <span class="token punctuation">:</span> username<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 将username写入上下文</span>
		c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     rtoken refresh atoken
    </p>
    <pre><code class="prism language-go"><span class="token comment">// rtoken刷新atoken</span>
<span class="token keyword">func</span> <span class="token function">RefreshToken</span><span class="token punctuation">(</span>atoken<span class="token punctuation">,</span> rtoken <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">(</span>token <span class="token builtin">string</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 判断rtoken是否有效</span>
	<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>rtoken<span class="token punctuation">,</span> keyFunc<span class="token punctuation">)</span><span class="token punctuation">;</span>err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 从旧的atoken中解析出来username</span>
	claims<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">ParseToken</span><span class="token punctuation">(</span>atoken<span class="token punctuation">)</span>
	<span class="token comment">// 如果还未过期,则返回开始的atoken</span>
	<span class="token keyword">if</span> err<span class="token operator">==</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		token <span class="token operator">=</span> atoken
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断atoken是否为过期类型的错误</span>
	v<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>jwt<span class="token punctuation">.</span>ValidationError<span class="token punctuation">)</span>
	<span class="token keyword">if</span> v<span class="token punctuation">.</span>Errors <span class="token operator">==</span> jwt<span class="token punctuation">.</span>ValidationErrorExpired<span class="token punctuation">{<!-- --></span>
		token<span class="token punctuation">,</span>err <span class="token operator">=</span> <span class="token function">GetaToken</span><span class="token punctuation">(</span>claims<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
		err <span class="token operator">=</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token comment">// 刷新atoken</span>
<span class="token keyword">func</span> <span class="token function">RefreshToken</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	rtoken <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"rtoken"</span><span class="token punctuation">)</span>
	<span class="token comment">// 验证header中是否有Authorization</span>
	authHeader <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">GetHeader</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> authHeader<span class="token operator">==</span><span class="token string">""</span> <span class="token operator">||</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>authHeader<span class="token punctuation">,</span><span class="token string">"Bearer "</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> <span class="token string">"Token不存在"</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 解析atoken</span>
	atoken <span class="token operator">:=</span> authHeader<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	atoken<span class="token punctuation">,</span>err <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">RefreshToken</span><span class="token punctuation">(</span>atoken<span class="token punctuation">,</span> rtoken<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> <span class="token string">"Token解析失败"</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>SUCCES<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"atoken"</span> <span class="token punctuation">:</span> atoken<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_523">
     </a>
     优化
    </h4>
    <h5>
     <a id="_525">
     </a>
     密码加密存储
    </h5>
    <pre><code class="prism language-go"><span class="token keyword">package</span> encrypt

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/config"</span>
	<span class="token string">"encoding/base64"</span>
	<span class="token string">"fmt"</span>

	<span class="token string">"golang.org/x/crypto/scrypt"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">GenerateSpw</span><span class="token punctuation">(</span>pw <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> KeyLen <span class="token operator">=</span> <span class="token number">22</span>
	<span class="token keyword">const</span> N <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span>                             <span class="token comment">// CPU内存成本参数，必须是一个大于1的2的幂</span>
	<span class="token keyword">const</span> r<span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span>                             <span class="token comment">// r*p &lt;2^30</span>
	<span class="token comment">// salt长度为8比较好</span>
	npw<span class="token punctuation">,</span> err <span class="token operator">:=</span> scrypt<span class="token punctuation">.</span><span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>pw<span class="token punctuation">)</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>Salt<span class="token punctuation">,</span> N<span class="token punctuation">,</span> r<span class="token punctuation">,</span> p<span class="token punctuation">,</span> KeyLen<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"密码加密失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> base64<span class="token punctuation">.</span>StdEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>npw<span class="token punctuation">)</span> <span class="token comment">// 获取编码后的字符串</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span><span class="token function">BeforeSave</span><span class="token punctuation">(</span><span class="token boolean">_</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	u<span class="token punctuation">.</span>PassWord <span class="token operator">=</span> encrypt<span class="token punctuation">.</span><span class="token function">GenerateSpw</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>PassWord<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="ID_558">
     </a>
     雪花算法生成用户ID
    </h5>
    <h3>
     <a id="_562">
     </a>
     社区分类及详情模块
    </h3>
    <h4>
     <a id="_564">
     </a>
     创建数据库
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token string">"gorm.io/gorm"</span>

<span class="token keyword">type</span> Community <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	gorm<span class="token punctuation">.</span>Model
	CommunityId <span class="token builtin">int</span> <span class="token string">`gorm:"type:int(10)" json:"community_id"`</span>
	CommunityName <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64)" json:"community_name"`</span>
	Introduction <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(256)" json:"introduction"`</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token comment">// 模型迁移</span>
db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>Community<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/utils/errmsg"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"time"</span>

	<span class="token string">"gorm.io/gorm"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Community <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	gorm<span class="token punctuation">.</span>Model
	CommunityName <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64)" json:"community_name" validate:"required"`</span>
	Introduction  <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(256)" json:"introduction" validate:"required"`</span>
	Issure <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(256)" json:"issure" validate:"required"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> CommunityDetail <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	ID            <span class="token builtin">int</span>       <span class="token string">`json:"id" db:"id"`</span>
	CommunityName <span class="token builtin">string</span>    <span class="token string">`json:"community_name" db:"community_name"`</span>
	Introduction  <span class="token builtin">string</span>    <span class="token string">`json:"introduction" db:"introduction"`</span>
	CreatedAt      time<span class="token punctuation">.</span>Time <span class="token string">`json:"created_at" db:"created_at"`</span>
	UpdatedAt     time<span class="token punctuation">.</span>Time <span class="token string">`json:"updated_at" db:"updated_at"`</span>
	Issure <span class="token builtin">string</span> <span class="token string">`json:"issure" db:"issure"`</span>
<span class="token punctuation">}</span>

<span class="token comment">// 判断社区是否存在</span>
<span class="token keyword">func</span> <span class="token function">FindCommunity</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> comm Community
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"community_name = ?"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comm<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"社区查询失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> comm<span class="token punctuation">.</span>ID <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token comment">// 判断id是否存在</span>
<span class="token keyword">func</span> <span class="token function">FindCommunityByID</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> comm Community
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id = ?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comm<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"社区查询失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> comm<span class="token punctuation">.</span>ID <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">,</span> comm<span class="token punctuation">.</span>Issure
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">""</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加社区</span>
<span class="token keyword">func</span> <span class="token function">AddCommunity</span><span class="token punctuation">(</span>comm Community<span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comm<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 修改社区</span>
<span class="token keyword">func</span> <span class="token function">ChangeCommunity</span><span class="token punctuation">(</span>comm Community<span class="token punctuation">)</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	mp <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	mp<span class="token punctuation">[</span><span class="token string">"Community_name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> comm<span class="token punctuation">.</span>CommunityName
	mp<span class="token punctuation">[</span><span class="token string">"introduction"</span><span class="token punctuation">]</span> <span class="token operator">=</span> comm<span class="token punctuation">.</span>Introduction
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 删除社区</span>
<span class="token keyword">func</span> <span class="token function">DeleteCommunity</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> comm Community
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id = ?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comm<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 查询社区列表(分页)</span>
<span class="token keyword">func</span> <span class="token function">GetCommunityList</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">,</span> pagenum <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Community<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> commList <span class="token punctuation">[</span><span class="token punctuation">]</span>Community
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"community_name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pagenum<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>commList<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> commList<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> commList<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 查询社区详情</span>
<span class="token keyword">func</span> <span class="token function">GetCommunityDetail</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>CommunityDetail<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> comm CommunityDetail
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Community<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id = ?"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comm<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"社区详情查询失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> comm<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> comm<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_690">
     </a>
     增加社区类别（鉴权）
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// 添加社区</span>
<span class="token keyword">func</span> <span class="token function">AddCommunity</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> community models<span class="token punctuation">.</span>Community
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>community<span class="token punctuation">)</span>
	<span class="token comment">// 获取中间件的username</span>
	username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
	community<span class="token punctuation">.</span>Issure <span class="token operator">=</span> username
	<span class="token comment">// 参数校验</span>
	errs <span class="token operator">:=</span> Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>community<span class="token punctuation">)</span>
	<span class="token keyword">if</span> errs<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span> <span class="token keyword">range</span> errs<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断社区是否存在</span>
	<span class="token keyword">if</span> models<span class="token punctuation">.</span><span class="token function">FindCommunity</span><span class="token punctuation">(</span>community<span class="token punctuation">.</span>CommunityName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>COMMUNITY_IS_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 添加社区</span>
	code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">AddCommunity</span><span class="token punctuation">(</span>community<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_733">
     </a>
     获取社区分类列表
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">GetCommunityList</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	pagesize<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"pagesize"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	pagenum<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"pagenum"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> pagesize<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">{<!-- --></span>
		pagesize <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> pagenum<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">{<!-- --></span>
		pagenum <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
	commList<span class="token punctuation">,</span> code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetCommunityList</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">,</span> pagenum<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> commList<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="ID_753">
     </a>
     根据社区ID查找分类详情
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// 查询单个社区详情</span>
<span class="token keyword">func</span> <span class="token function">GetCommunityDetail</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	id<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	comm<span class="token punctuation">,</span> code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetCommunityDetail</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> comm<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_767">
     </a>
     修改社区（鉴权）
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// 修改社区</span>
<span class="token keyword">func</span> <span class="token function">ChangeCommunity</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> community models<span class="token punctuation">.</span>Community
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>community<span class="token punctuation">)</span>
	<span class="token comment">// 获取中间件的username</span>
	username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
	community<span class="token punctuation">.</span>Issure <span class="token operator">=</span> username
	<span class="token comment">// 参数校验</span>
	errs <span class="token operator">:=</span> Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>community<span class="token punctuation">)</span>
	<span class="token keyword">if</span> errs<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span> <span class="token keyword">range</span> errs<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断id是否存在</span>
	flag<span class="token punctuation">,</span> issure <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">FindCommunityByID</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>community<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>flag<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>COMMUNITY_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断是否为issure</span>
	<span class="token keyword">if</span> issure<span class="token operator">!=</span>c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USER_NOT_TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断社区名称是否存在</span>
	<span class="token keyword">if</span> models<span class="token punctuation">.</span><span class="token function">FindCommunity</span><span class="token punctuation">(</span>community<span class="token punctuation">.</span>CommunityName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>COMMUNITY_IS_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 修改社区</span>
	code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">ChangeCommunity</span><span class="token punctuation">(</span>community<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> community<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_829">
     </a>
     删除社区（鉴权）
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// 删除社区</span>
<span class="token keyword">func</span> <span class="token function">DeleteCommunity</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	id<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span>strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 判断id是否存在</span>
	flag<span class="token punctuation">,</span> issure <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">FindCommunityByID</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>flag<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>COMMUNITY_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> id<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断是否为issure</span>
	<span class="token keyword">if</span> issure<span class="token operator">!=</span>c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USER_NOT_TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> id<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">DeleteCommunity</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> id<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_862">
     </a>
     论坛帖子模块
    </h3>
    <h4>
     <a id="_864">
     </a>
     创建数据库
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/utils/errmsg"</span>

	<span class="token string">"gorm.io/gorm"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	gorm<span class="token punctuation">.</span>Model
	Title <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64)" json:"title" validate:"required"`</span>
	Content <span class="token builtin">string</span> <span class="token string">`gorm:"type:longtext" json:"content" validate:"required"`</span>
	AuthorName <span class="token builtin">string</span> <span class="token string">`gorm:"type:varchar(64);not null" json:"author_name"`</span>
	CommunityId <span class="token builtin">int</span> <span class="token string">`gorm:"type:bigint;not null" json:"community_id" validate:"required"`</span>
	Status <span class="token builtin">int</span> <span class="token string">`gorm:"type:tinyint(4);default:0" json:"status"`</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加帖子数据</span>
<span class="token keyword">func</span> <span class="token function">AddPost</span><span class="token punctuation">(</span>post Post<span class="token punctuation">)</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 分页展示帖子列表</span>
<span class="token keyword">func</span> <span class="token function">GetPostList</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">,</span> pagenum <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Post<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> posts <span class="token punctuation">[</span><span class="token punctuation">]</span>Post
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pagenum<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>posts<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> posts<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> posts<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 获取帖子详情</span>
<span class="token keyword">func</span> <span class="token function">GetPostDetail</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Post<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> post Post
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id = ?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> post<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> post<span class="token punctuation">,</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 修改帖子</span>
<span class="token keyword">func</span> <span class="token function">ChangePost</span><span class="token punctuation">(</span>post Post<span class="token punctuation">)</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	mp <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	mp<span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">]</span> <span class="token operator">=</span> post<span class="token punctuation">.</span>Title
	mp<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> post<span class="token punctuation">.</span>Content
	mp<span class="token punctuation">[</span><span class="token string">"community_id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> post<span class="token punctuation">.</span>CommunityId
	mp<span class="token punctuation">[</span><span class="token string">"status"</span><span class="token punctuation">]</span> <span class="token operator">=</span> post<span class="token punctuation">.</span>Status
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Post<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id = ?"</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>

<span class="token comment">// 删除帖子</span>
<span class="token keyword">func</span> <span class="token function">DeletePost</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> post Post
	err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"id = ?"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token comment">// 模型迁移</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>Community<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>Post<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="_943">
     </a>
     创建帖子
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">AddPost</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> post models<span class="token punctuation">.</span>Post
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>post<span class="token punctuation">)</span>
	post<span class="token punctuation">.</span>AuthorName <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
	<span class="token comment">// 进行参数校验</span>
	err <span class="token operator">:=</span> Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span> <span class="token keyword">range</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断社区是否存在</span>
	<span class="token keyword">if</span> flag<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span>models<span class="token punctuation">.</span><span class="token function">FindCommunityByID</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>CommunityId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">!</span>flag<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>COMMUNITY_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 创建帖子</span>
	code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">AddPost</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
	<span class="token keyword">if</span> code<span class="token operator">!=</span>errmsg<span class="token punctuation">.</span>SUCCES<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// redis创建帖子</span>
	code <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">CreatePost</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>CommunityId<span class="token punctuation">,</span> post<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> post<span class="token punctuation">.</span>Content<span class="token punctuation">,</span> post<span class="token punctuation">.</span>AuthorName<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_993">
     </a>
     分页展示帖子列表
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">GetPostList</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	pagesize<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"pagesize"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	pagenum<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"pagenum"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> pagesize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">{<!-- --></span>
		pagesize <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> pagenum <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">{<!-- --></span>
		pagenum <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
	posts<span class="token punctuation">,</span> code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPostList</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">,</span> pagenum<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> posts<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1013">
     </a>
     获取帖子详情
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">GetPostDetail</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	id<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span>strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"post_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span>code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPostDetail</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> code<span class="token operator">==</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>POST_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	post<span class="token punctuation">,</span> code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPostDetail</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1034">
     </a>
     修改帖子
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">ChangePost</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> post models<span class="token punctuation">.</span>Post
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>post<span class="token punctuation">)</span>
	<span class="token comment">// 进行参数校验</span>
	err <span class="token operator">:=</span> Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span> <span class="token keyword">range</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断帖子是否存在</span>
	findPost<span class="token punctuation">,</span>code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPostDetail</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>ID<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> code<span class="token operator">==</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>POST_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断是否为自己的帖子</span>
	<span class="token keyword">if</span> findPost<span class="token punctuation">.</span>AuthorName <span class="token operator">!=</span> c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USER_NOT_TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断社区是否存在</span>
	<span class="token keyword">if</span> flag<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span>models<span class="token punctuation">.</span><span class="token function">FindCommunityByID</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>CommunityId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">!</span>flag<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>COMMUNITY_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 修改帖子内容</span>
	code <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">ChangePost</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> post<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1092">
     </a>
     删除帖子
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">DeletePost</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	id<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"post_id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 判断帖子是否存在</span>
	findPost<span class="token punctuation">,</span>code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPostDetail</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> code<span class="token operator">==</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>POST_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"post_id"</span> <span class="token punctuation">:</span> id<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断是否为自己的帖子</span>
	<span class="token keyword">if</span> findPost<span class="token punctuation">.</span>AuthorName <span class="token operator">!=</span> c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>USER_NOT_TRUE<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> findPost<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 删除帖子</span>
	code <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">DeletePost</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span> <span class="token punctuation">:</span> findPost<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="or_1125">
     </a>
     按照时间or分数排序展示帖子列表
    </h4>
    <h5>
     <a id="_1127">
     </a>
     全部帖子
    </h5>
    <h5>
     <a id="_1131">
     </a>
     某一社区帖子
    </h5>
    <h4>
     <a id="_1135">
     </a>
     优化
    </h4>
    <h5>
     <a id="redis_1137">
     </a>
     redis缓存帖子列表
    </h5>
    <h5>
     <a id="redis_mysql__1141">
     </a>
     redis mysql 数据一致性
    </h5>
    <h3>
     <a id="_1145">
     </a>
     投票模块
    </h3>
    <h4>
     <a id="redis_1147">
     </a>
     redis数据库
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">package</span> redis

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"MY-FORUM/config"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/go-redis/redis"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	client <span class="token operator">*</span>redis<span class="token punctuation">.</span>Client
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	client <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>redis<span class="token punctuation">.</span>Options<span class="token punctuation">{<!-- --></span>
		Addr <span class="token punctuation">:</span> config<span class="token punctuation">.</span>RedisHost<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>config<span class="token punctuation">.</span>RedisPort<span class="token punctuation">,</span>
		Password <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
		DB <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		PoolSize<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">,</span>
		MinIdleConns<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span>client<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"redis连接失败"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token boolean">_</span> <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="redis_1183">
     </a>
     在redis中添加帖子相关信息
    </h4>
    <pre><code class="prism language-go"><span class="token comment">// redis存储帖子信息</span>
<span class="token keyword">func</span> <span class="token function">CreatePost</span><span class="token punctuation">(</span>postid<span class="token punctuation">,</span> community <span class="token builtin">int</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> author_name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	now <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	votedKey <span class="token operator">:=</span> PostVotedZSet<span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>postid<span class="token punctuation">)</span>
	communityKey <span class="token operator">:=</span> CommunityPostSet<span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>community<span class="token punctuation">)</span>
	<span class="token comment">// 事务操作</span>
	<span class="token comment">// 创建一个事务管道</span>
	pipeline <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TxPipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 设置投票过期时间</span>
	pipeline<span class="token punctuation">.</span><span class="token function">Expire</span><span class="token punctuation">(</span>votedKey<span class="token punctuation">,</span> time<span class="token punctuation">.</span>Second<span class="token operator">*</span>OneWekSecond<span class="token punctuation">)</span>
	<span class="token comment">// 添加帖子时间排序</span>
	pipeline<span class="token punctuation">.</span><span class="token function">ZAdd</span><span class="token punctuation">(</span>PostTimeZSet<span class="token punctuation">,</span> redis<span class="token punctuation">.</span>Z<span class="token punctuation">{<!-- --></span>
		Score<span class="token punctuation">:</span> <span class="token function">float64</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Member<span class="token punctuation">:</span> postid<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 添加帖子分数排序</span>
	pipeline<span class="token punctuation">.</span><span class="token function">ZAdd</span><span class="token punctuation">(</span>PostScoreZSet<span class="token punctuation">,</span> redis<span class="token punctuation">.</span>Z<span class="token punctuation">{<!-- --></span>
		Score<span class="token punctuation">:</span> <span class="token function">float64</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		Member<span class="token punctuation">:</span> postid<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 添加到对应的社区</span>
	pipeline<span class="token punctuation">.</span><span class="token function">SAdd</span><span class="token punctuation">(</span>communityKey<span class="token punctuation">,</span> postid<span class="token punctuation">)</span>
	<span class="token comment">// 执行管道中所有命令</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> pipeline<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1217">
     </a>
     为帖子投票
    </h4>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">PostVoteHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> item PostVote
	<span class="token boolean">_</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>item<span class="token punctuation">)</span>
	<span class="token comment">// 进行参数校验</span>
	errs <span class="token operator">:=</span> Validate<span class="token punctuation">.</span><span class="token function">Struct</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
	<span class="token keyword">if</span> errs<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		msg <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span> <span class="token keyword">range</span> errs<span class="token punctuation">.</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>ValidationErrors<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			msg <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Translate</span><span class="token punctuation">(</span>Trans<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"msg"</span> <span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> item<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断帖子是否存在</span>
	post_id<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>PostId<span class="token punctuation">)</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span>code <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetPostDetail</span><span class="token punctuation">(</span>post_id<span class="token punctuation">)</span>
	<span class="token keyword">if</span> code<span class="token operator">==</span>errmsg<span class="token punctuation">.</span>ERROR<span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
			<span class="token string">"status"</span> <span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">.</span>POST_IS_NOT_EXIST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token string">"data"</span> <span class="token punctuation">:</span> item<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 进行投票</span>
	code <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">VoteForPost</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>PostId<span class="token punctuation">,</span> <span class="token function">float64</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>Direction<span class="token punctuation">)</span><span class="token punctuation">)</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
		<span class="token string">"status"</span><span class="token punctuation">:</span> errmsg<span class="token punctuation">.</span><span class="token function">GetErrMsg</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"data"</span><span class="token punctuation">:</span> item<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-go"><span class="token comment">// 为帖子投票</span>
<span class="token keyword">func</span> <span class="token function">VoteForPost</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> postid <span class="token builtin">string</span><span class="token punctuation">,</span> v <span class="token builtin">float64</span><span class="token punctuation">)</span><span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 判断现在是否还在投票期</span>
	<span class="token comment">// 获取帖子发布日期</span>
	postTime <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ZScore</span><span class="token punctuation">(</span>PostTimeZSet<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>postid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">float64</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">int64</span><span class="token punctuation">(</span>postTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>OneWekSecond<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>POST_VOTE_IS_EXPIRE
	<span class="token punctuation">}</span>
	key <span class="token operator">:=</span> PostVotedZSet<span class="token operator">+</span>postid
	<span class="token comment">// 查看当前用户给帖子的投票记录</span>
	ov <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">ZScore</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 判断是否重复投票</span>
	<span class="token keyword">if</span> ov<span class="token operator">==</span>v<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>POST_USER_VOTED
	<span class="token punctuation">}</span>
	<span class="token comment">// 计算两次投票的差值</span>
	diff <span class="token operator">:=</span> v<span class="token operator">-</span>ov
	<span class="token comment">// 创建一个事务管道</span>
	pipeline <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TxPipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 更新帖子分数</span>
	pipeline<span class="token punctuation">.</span><span class="token function">ZIncrBy</span><span class="token punctuation">(</span>PostScoreZSet<span class="token punctuation">,</span> VoteScore<span class="token operator">*</span>diff<span class="token punctuation">,</span> postid<span class="token punctuation">)</span>
	<span class="token comment">// 更新用户投票记录</span>
	pipeline<span class="token punctuation">.</span><span class="token function">ZRem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
	pipeline<span class="token punctuation">.</span><span class="token function">ZAdd</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> redis<span class="token punctuation">.</span>Z<span class="token punctuation">{<!-- --></span>
		Score<span class="token punctuation">:</span> v<span class="token punctuation">,</span>
		Member<span class="token punctuation">:</span> username<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span>err <span class="token operator">:=</span> pipeline<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err<span class="token operator">!=</span><span class="token boolean">nil</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>ERROR
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> errmsg<span class="token punctuation">.</span>SUCCES
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1294">
     </a>
     优化
    </h4>
    <h5>
     <a id="Reddit_1296">
     </a>
     利用Reddit算法计算帖子排名分数
    </h5>
    <h3>
     <a id="_1300">
     </a>
     评论模块
    </h3>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f35343338353130342f:61727469636c652f64657461696c732f313436323130313134" class_="artid" style="display:none">
 </p>
</div>


