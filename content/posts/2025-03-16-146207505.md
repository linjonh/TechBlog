---
layout: post
title: "MyBatis-SqlSessionFactoryBuilder-的作用是什么"
date: 2025-03-16 11:12:54 +0800
description: "建造者模式的核心思想是将一个复杂对象的构建过程与其表示分离，使得同样的构建过程可以创建不同的表示。一旦工厂组装完成，工程师的任务就完成了，他就可以离开了 (一次性使用)。这种多配置源的支持，使得 MyBatis 的配置方式更加灵活，可以适应不同的应用场景和配置管理需求。) 负责根据设计图纸 (MyBatis 配置) 和原材料 (配置源)，一步步地组装出最终的工厂 (在 MyBatis 中扮演着至关重要的角色，它的主要作用是。理解为 SqlSessionFactory。的创建逻辑解耦，提高了代码的灵活性。"
keywords: "MyBatis SqlSessionFactoryBuilder 的作用是什么？"
categories: ['源码系列', 'Mybatis', 'Java', '2025']
tags: ['Mybatis', 'Java']
artid: "146207505"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146207505
    alt: "MyBatis-SqlSessionFactoryBuilder-的作用是什么"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146207505
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146207505
cover: https://bing.ee123.net/img/rand?artid=146207505
image: https://bing.ee123.net/img/rand?artid=146207505
img: https://bing.ee123.net/img/rand?artid=146207505
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MyBatis SqlSessionFactoryBuilder 的作用是什么？
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <code>
      SqlSessionFactoryBuilder
     </code>
     在 MyBatis 中扮演着至关重要的角色，它的主要作用是
     <strong>
      构建 (Build)
      <code>
       SqlSessionFactory
      </code>
      实例
     </strong>
     。 你可以将
     <code>
      SqlSessionFactoryBuilder
     </code>
     理解为
     <strong>
      <code>
       SqlSessionFactory
      </code>
      的工厂的建造者
     </strong>
     。
    </p>
    <p>
     <strong>
      核心作用概括:
     </strong>
    </p>
    <p>
     <code>
      SqlSessionFactoryBuilder
     </code>
     的核心作用就是
     <strong>
      抽象了
      <code>
       SqlSessionFactory
      </code>
      的创建过程，并提供了灵活、便捷的方式来从不同的配置源 (XML 配置文件、Java 代码配置) 构建
      <code>
       SqlSessionFactory
      </code>
      实例。
     </strong>
    </p>
    <p>
     <strong>
      更详细的解释和作用分解:
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        抽象
        <code>
         SqlSessionFactory
        </code>
        的构建过程:
       </strong>
      </p>
      <ul>
       <li>
        <code>
         SqlSessionFactory
        </code>
        的创建并非一个简单的实例化过程，它涉及到
        <strong>
         加载和解析 MyBatis 的配置信息、初始化各种 MyBatis 组件 (例如数据源、事务管理器、Mapper 注册器等)、并将这些组件组装起来
        </strong>
        ，最终才能得到一个可用的
        <code>
         SqlSessionFactory
        </code>
        实例。
       </li>
       <li>
        <code>
         SqlSessionFactoryBuilder
        </code>
        将这个复杂的构建过程封装起来，对外提供简洁的
        <code>
         build()
        </code>
        方法，隐藏了内部的构建细节。 开发者只需要调用
        <code>
         SqlSessionFactoryBuilder.build()
        </code>
        方法，传入配置信息，就可以获得
        <code>
         SqlSessionFactory
        </code>
        实例，无需关心底层的构建细节。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        支持多种配置源 (Configuration Source):
       </strong>
      </p>
      <p>
       <code>
        SqlSessionFactoryBuilder
       </code>
       提供了多个重载的
       <code>
        build()
       </code>
       方法，可以接受不同类型的配置源，从而支持从多种方式加载 MyBatis 配置：
      </p>
      <ul>
       <li>
        <strong>
         从 XML 配置文件 (
         <code>
          InputStream
         </code>
         ):
        </strong>
        这是最常用的方式，通过
        <code>
         build(InputStream inputStream)
        </code>
        方法，传入指向 MyBatis XML 配置文件的
        <code>
         InputStream
        </code>
        ，
        <code>
         SqlSessionFactoryBuilder
        </code>
        会解析 XML 文件并构建
        <code>
         SqlSessionFactory
        </code>
        。
       </li>
       <li>
        <strong>
         从
         <code>
          Configuration
         </code>
         对象 (
         <code>
          Configuration
         </code>
         ):
        </strong>
        通过
        <code>
         build(Configuration config)
        </code>
        方法，可以直接传入一个已经构建好的
        <code>
         Configuration
        </code>
        对象。 这种方式适用于使用 Java 代码配置 MyBatis 的场景。
       </li>
       <li>
        <strong>
         从
         <code>
          Reader
         </code>
         对象 (
         <code>
          Reader
         </code>
         ):
        </strong>
        类似于
        <code>
         InputStream
        </code>
        ，但使用
        <code>
         Reader
        </code>
        读取字符流，适用于从字符流读取 XML 配置的情况。
       </li>
       <li>
        <strong>
         从
         <code>
          XMLMapperBuilder
         </code>
         对象 (
         <code>
          XMLMapperBuilder
         </code>
         ):
        </strong>
        更底层的构建方式，通常不直接使用，用于更精细的配置解析控制。
       </li>
      </ul>
      <p>
       这种多配置源的支持，使得 MyBatis 的配置方式更加灵活，可以适应不同的应用场景和配置管理需求。
      </p>
     </li>
     <li>
      <p>
       <strong>
        作为
        <code>
         SqlSessionFactory
        </code>
        的建造者 (Builder Pattern):
       </strong>
      </p>
      <p>
       <code>
        SqlSessionFactoryBuilder
       </code>
       遵循了
       <strong>
        建造者模式 (Builder Pattern)
       </strong>
       设计模式。 建造者模式的核心思想是将一个复杂对象的构建过程与其表示分离，使得同样的构建过程可以创建不同的表示。
      </p>
      <p>
       在 MyBatis 中：
      </p>
      <ul>
       <li>
        <strong>
         建造者 (Builder):
        </strong>
        <code>
         SqlSessionFactoryBuilder
        </code>
        类。
       </li>
       <li>
        <strong>
         产品 (Product):
        </strong>
        <code>
         SqlSessionFactory
        </code>
        接口及其实现类 (通常是
        <code>
         DefaultSqlSessionFactory
        </code>
        )。
       </li>
       <li>
        <strong>
         导演 (Director - 隐含):
        </strong>
        <code>
         SqlSessionFactoryBuilder.build()
        </code>
        方法及其内部的解析和构建逻辑，它控制着
        <code>
         SqlSessionFactory
        </code>
        的构建步骤。
       </li>
       <li>
        <strong>
         具体建造者 (Concrete Builder - 隐含):
        </strong>
        <code>
         XMLConfigBuilder
        </code>
        等类，负责解析 XML 配置并填充
        <code>
         Configuration
        </code>
        对象，可以看作是
        <code>
         SqlSessionFactoryBuilder
        </code>
        构建过程中的具体步骤的实现。
       </li>
      </ul>
      <p>
       通过建造者模式，
       <code>
        SqlSessionFactoryBuilder
       </code>
       使得
       <code>
        SqlSessionFactory
       </code>
       的创建过程更加清晰、可维护、可扩展。 也使得配置加载和
       <code>
        SqlSessionFactory
       </code>
       的创建逻辑解耦，提高了代码的灵活性。
      </p>
     </li>
     <li>
      <p>
       <strong>
        一次性使用，生命周期短暂:
       </strong>
      </p>
      <p>
       <code>
        SqlSessionFactoryBuilder
       </code>
       的设计意图是
       <strong>
        一次性使用 (One-time use)
       </strong>
       的。 它的生命周期很短暂，主要用于构建
       <code>
        SqlSessionFactory
       </code>
       实例。
       <strong>
        一旦
        <code>
         SqlSessionFactory
        </code>
        被成功构建，
        <code>
         SqlSessionFactoryBuilder
        </code>
        就完成了它的使命，可以被丢弃，不再需要长期持有。
       </strong>
      </p>
      <p>
       通常，在 MyBatis 应用的启动阶段，你会使用
       <code>
        SqlSessionFactoryBuilder
       </code>
       构建
       <code>
        SqlSessionFactory
       </code>
       ，然后将
       <code>
        SqlSessionFactory
       </code>
       对象缓存起来 (例如作为单例 Spring Bean 管理)，供整个应用生命周期使用。
       <strong>
        你不会在每次需要
        <code>
         SqlSession
        </code>
        时都去创建
        <code>
         SqlSessionFactoryBuilder
        </code>
        。
       </strong>
      </p>
     </li>
     <li>
      <p>
       <strong>
        核心方法：
        <code>
         build()
        </code>
        方法:
       </strong>
      </p>
      <p>
       <code>
        SqlSessionFactoryBuilder
       </code>
       的核心方法是
       <code>
        build()
       </code>
       方法。 所有重载的
       <code>
        build()
       </code>
       方法最终都会返回一个
       <code>
        SqlSessionFactory
       </code>
       实例。
       <code>
        build()
       </code>
       方法内部会完成以下主要工作：
      </p>
      <ul>
       <li>
        <strong>
         解析配置源:
        </strong>
        根据传入的配置源 (例如
        <code>
         InputStream
        </code>
        )，解析 MyBatis 配置信息。 如果是 XML 配置，会使用
        <code>
         XMLConfigBuilder
        </code>
        进行解析。
       </li>
       <li>
        <strong>
         构建
         <code>
          Configuration
         </code>
         对象:
        </strong>
        将解析得到的配置信息构建成一个
        <code>
         Configuration
        </code>
        对象。
        <code>
         Configuration
        </code>
        对象包含了 MyBatis 的所有配置 (数据源、事务管理器、Mapper 映射、全局设置等)。
       </li>
       <li>
        <strong>
         创建
         <code>
          SqlSessionFactory
         </code>
         实例:
        </strong>
        使用构建好的
        <code>
         Configuration
        </code>
        对象，创建
        <code>
         SqlSessionFactory
        </code>
        实例 (通常是
        <code>
         DefaultSqlSessionFactory
        </code>
        实例)。
       </li>
       <li>
        <strong>
         返回
         <code>
          SqlSessionFactory
         </code>
         实例:
        </strong>
        将创建好的
        <code>
         SqlSessionFactory
        </code>
        实例返回给调用者。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     <strong>
      总结
      <code>
       SqlSessionFactoryBuilder
      </code>
      的作用:
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       构建
       <code>
        SqlSessionFactory
       </code>
       实例:
      </strong>
      这是
      <code>
       SqlSessionFactoryBuilder
      </code>
      的核心和唯一目的。
     </li>
     <li>
      <strong>
       抽象
       <code>
        SqlSessionFactory
       </code>
       的复杂创建过程:
      </strong>
      简化
      <code>
       SqlSessionFactory
      </code>
      的创建流程，隐藏内部细节。
     </li>
     <li>
      <strong>
       支持多种配置源:
      </strong>
      允许从 XML 配置文件、Java 代码配置等多种方式加载 MyBatis 配置。
     </li>
     <li>
      <strong>
       遵循建造者模式:
      </strong>
      使得
      <code>
       SqlSessionFactory
      </code>
      的构建过程更加清晰、灵活、可扩展。
     </li>
     <li>
      <strong>
       一次性使用，生命周期短暂:
      </strong>
      主要用于构建
      <code>
       SqlSessionFactory
      </code>
      ，构建完成后即可丢弃。
     </li>
     <li>
      <strong>
       提供
       <code>
        build()
       </code>
       方法作为入口:
      </strong>
      通过
      <code>
       build()
      </code>
      方法对外提供简洁的
      <code>
       SqlSessionFactory
      </code>
      构建 API。
     </li>
    </ul>
    <p>
     <strong>
      简单比喻:
     </strong>
    </p>
    <p>
     你可以将
     <code>
      SqlSessionFactoryBuilder
     </code>
     比喻成一个
     <strong>
      组装工厂的工程师
     </strong>
     。 工程师 (
     <code>
      SqlSessionFactoryBuilder
     </code>
     ) 负责根据设计图纸 (MyBatis 配置) 和原材料 (配置源)，一步步地组装出最终的工厂 (
     <code>
      SqlSessionFactory
     </code>
     )。 一旦工厂组装完成，工程师的任务就完成了，他就可以离开了 (一次性使用)。 而组装好的工厂 (
     <code>
      SqlSessionFactory
     </code>
     ) 就可以开始源源不断地生产产品 (
     <code>
      SqlSession
     </code>
     ) 了。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6e6d736f66746b6c622f:61727469636c652f64657461696c732f313436323037353035" class_="artid" style="display:none">
 </p>
</div>


