---
layout: post
title: "2-kafka集群环境搭建"
date: 2025-03-09 00:32:36 +0800
description: "本文介绍kafka集群环境的搭建，我利用三个虚拟机搭建。文中我一步步演示了过程中可能会碰到的问题，在文章的最后，利用jmx，能看到详细的各个kafka broker的运行情况。"
keywords: "2-kafka集群环境搭建"
categories: ['Kafka']
tags: ['分布式', 'Kafka']
artid: "146081863"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146081863
    alt: "2-kafka集群环境搭建"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146081863
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146081863
cover: https://bing.ee123.net/img/rand?artid=146081863
image: https://bing.ee123.net/img/rand?artid=146081863
img: https://bing.ee123.net/img/rand?artid=146081863
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     2-kafka集群环境搭建
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     本文介绍kafka集群环境的搭建，我利用三个虚拟机搭建。文中我一步步演示了过程中可能会碰到的问题，在文章的最后，利用jmx，能看到详细的各个kafka broker的运行情况。
    </p>
    <h2>
     <a id="1_1">
     </a>
     -1、环境
    </h2>
    <ul>
     <li>
      ubuntu ：22.04-lts
     </li>
     <li>
      kafka: 2.8
     </li>
     <li>
      java: 17
     </li>
    </ul>
    <h2>
     <a id="0_7">
     </a>
     0、规划
    </h2>
    <p>
     整体规划图如下：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9599f50bbbf24ddb9790931cfff75101.png" width="380"/>
    </p>
    <p>
     可以看到我们利用一个zookeeper搭建了3个broker的kafka集群。详细的规划如下表：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        序号
       </th>
       <th>
        borker.id
       </th>
       <th>
        ip
       </th>
       <th>
        port
       </th>
       <th>
        jmx port
       </th>
       <th>
        <mark>
         zk
        </mark>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        1
       </td>
       <td>
        100
       </td>
       <td>
        192.168.99.100
       </td>
       <td>
        9092
       </td>
       <td>
        9992
       </td>
       <td>
        localhost:2181
       </td>
      </tr>
      <tr>
       <td>
        2
       </td>
       <td>
        120
       </td>
       <td>
        192.168.99.120
       </td>
       <td>
        9092
       </td>
       <td>
        9999
       </td>
       <td>
        192.168.99.100:2181
       </td>
      </tr>
      <tr>
       <td>
        3
       </td>
       <td>
        130
       </td>
       <td>
        192.168.99.130
       </td>
       <td>
        9092
       </td>
       <td>
        9993
       </td>
       <td>
        192.168.99.100:2181
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="1kafka1_20">
     </a>
     1、kafka-1搭建
    </h2>
    <p>
     对应上面列表的“序号1”。
     <mark>
      注意这里有坑
     </mark>
     ，ubuntu下（centos没测，大家可以试试）跑kafka目录下的zookeeper时，报java找不到的错误（启动kafka一样会报错，都按下面方法处理）。这是因为你机器上的java不是/usr/bin/java，和kafka要的不同。这里通过软链解决：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 找到你机器上java的目录</span>
<span class="token function">which</span> <span class="token function">java</span>  

<span class="token comment"># 第一个地址是我机器上java的路径，通过上面命令查出来的，第二个照着抄，因为就是kafka要的地址</span>
<span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /home/jackie/.sdkman/candidates/java/current/bin/java /usr/bin/java

</code></pre>
    <h3>
     <a id="11zookeeper_31">
     </a>
     1.1、启动zookeeper
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># 后台启动，日志文件写到zk.log文件内</span>
<span class="token function">sudo</span> bin/zookeeper-server-start.sh <span class="token parameter variable">-daemon</span> config/zookeeper.properties 

</code></pre>
    <p>
     kafka自带的zookeeper可以
     <mark>
      使用-daemon参数
     </mark>
     后台启动。如果你要改zookeeper的端口信息，在config/zookeeper.properties文件里。
    </p>
    <h3>
     <a id="12kafka1_40">
     </a>
     1.2、配置kafka-1
    </h3>
    <p>
     修改config/server.properties文件，至少有3出要改：
    </p>
    <ul>
     <li>
      borker.id：集群中broker的id，必须与其他机器不同。这里配成100，按上面规划表中的来。
     </li>
     <li>
      listeners：配置borker监听的端口，写你机器的ip，一定别写localhost或127.0.0.1。前面的PLAINTEXT表示明文传输，我们保持默认即可。
     </li>
     <li>
      zookeeper.connect：指定连接zookeeper的地址和端口，如果是zookeeper集群，多个机器逗号分割即可。
     </li>
    </ul>
    <p>
     贴个图，看看我配的值，大家按我的来即可。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/4098c40a59da40a3b374211878300e5b.png" width="380">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2ed38698c2fa4fabb65e147394f51ee5.png" width="380">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c3dc239950d642c38270040b2fc8b48b.png" width="380">
        <br/>
        当然还有别的参数可以配置，比如数据文件的保存路径等，这里咱们保持默认。
       </img>
      </img>
     </img>
    </p>
    <h3>
     <a id="13kafka1_56">
     </a>
     1.3、启动kafka-1
    </h3>
    <p>
     修改config/server.properties文件，
    </p>
    <pre><code class="prism language-bash">bin/kafka-server-start.sh <span class="token parameter variable">-daemon</span> config/server.properties 
</code></pre>
    <ul>
     <li>
      -daemon: 代表后台启动，有些同学喜欢用nohup命令，其实效果一样。
     </li>
    </ul>
    <p>
     这样第一个kafka就配置完成，并且启动了。kafka-2和kafka-3按照同样的步骤一步步执行即可。但是
     <mark>
      注意：kafka-2、kafka-3的zookeeper地址都是用的kafka-1的，别填错了
     </mark>
     。实际生产环境要配置zookeeper集群，别让zookeeper产生单点瓶颈。
    </p>
    <h2>
     <a id="2jmx_68">
     </a>
     2、配置jmx
    </h2>
    <p>
     配置jmx后，我们可以通过kafka-manager查看详细的运行参数。配置过程简单，咱们在bin/kafka-server.start.sh文件中，加入jmx的端口配置即可，如下图，
     <mark>
      别加错地方
     </mark>
     ：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/6436dea5498748d4b7a049e86ac88386.png" width="380">
      <br/>
      这是kafka-1配置，其他两个机器按照上面规划来哦。配置好了咱们用
      <mark>
       java Visualvm
      </mark>
      看看效果。用Windows或mac，找到你jdk安装的目录，
      <mark>
       执行bin/jvisualvm
      </mark>
      命令，并远程连接这三个机器，注意jmx端口要和上面的对上。
     </img>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/aec73b9fc8224a17b4b0684a155d04c6.png" width="380"/>
    </p>
    <p>
     注意：kafka机器上的防火器要么开放jmx的端口要么关闭防火墙。否则连接不上哦。至此kafka的集群配置完成了，上节咱们配置过kafka-manager，咱们在此看看效果(当然集群要重新配置，上节是单机）。
    </p>
    <h2>
     <a id="3kafkamanager_77">
     </a>
     3、kafka-manager效果
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/edf3bcbbd8984379952eaed4f0a6173d.png" width="380">
      <br/>
      能够看到咱们规划的集群已经完整的显示到kafka-manager里了，也算验证了我们的配置。
      <br/>
      好了，先到这里吧。大家动手试试。
      <br/>
      //~~
     </img>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d616f646f7539353833382f:61727469636c652f64657461696c732f313436303831383633" class_="artid" style="display:none">
 </p>
</div>


