---
layout: post
title: "推荐一个基于Koin,-Ktor-Paging等组件的KMM-Compose-Multiplatform项目"
date: 2025-03-06 22:24:49 +0800
description: "KMM是一个在多个平台上无缝共享代码的能力的框架。已成为跨平台开发领域的改变者。"
keywords: "推荐一个基于Koin, Ktor & Paging等组件的KMM Compose Multiplatform项目"
categories: ['Kotlin', 'Android']
tags: ['Kotlin', 'Android']
artid: "146081553"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146081553
    alt: "推荐一个基于Koin,-Ktor-Paging等组件的KMM-Compose-Multiplatform项目"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146081553
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146081553
cover: https://bing.ee123.net/img/rand?artid=146081553
image: https://bing.ee123.net/img/rand?artid=146081553
img: https://bing.ee123.net/img/rand?artid=146081553
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     推荐一个基于Koin, Ktor &amp; Paging等组件的KMM Compose Multiplatform项目
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     Kotlin Multiplatform Mobile（KMM）已经从一个雄心勃勃的想法发展成为一个稳定而强大的框架，为开发人员提供了在多个平台上无缝共享代码的能力。通过最近的稳定版本里程碑，KMM已成为跨平台开发领域的改变者。
    </p>
    <h3>
     <a id="_3">
     </a>
     环境设置
    </h3>
    <p>
     <a href="https://link.juejin.cn/?target=https://plugins.jetbrains.com/plugin/14936-kotlin-multiplatform-mobile" rel="nofollow">
      带有Kotlin Multiplatform插件的Android Studio
     </a>
    </p>
    <h3>
     <a id="KoinKtor_7">
     </a>
     设置Koin和Ktor
    </h3>
    <ol>
     <li>
      将两个依赖项添加到：shared模块中，我使用gradlelibrary目录作为依赖项。 io.insert-koin:koin-core:3.5.0
     </li>
     <li>
      对于Ktor，根据您的API，有多个依赖项各自具有自己的目的。
     </li>
     <li>
      由于注入将在平台级别进行，因此我们需要将初始化部分暴露给两个平台。为此，我们将创建一个带有initKoin()方法的Helper类，并从iOS和Android的应用程序类调用此方法。
     </li>
     <li>
      initKoin() → 我们在这里定义我们稍后需要的所有依赖项。
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token comment">//shared/src/commonMain/kotlin/di/Koin.kt</span>
<span class="token keyword">fun</span> <span class="token function">initKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> startKoin <span class="token punctuation">{<!-- --></span>
    <span class="token function">modules</span><span class="token punctuation">(</span>networkModule<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">val</span> networkModule <span class="token operator">=</span> module <span class="token punctuation">{<!-- --></span>
    single <span class="token punctuation">{<!-- --></span>
        HttpClient <span class="token punctuation">{<!-- --></span>
            defaultRequest <span class="token punctuation">{<!-- --></span>
                url<span class="token punctuation">.</span><span class="token function">takeFrom</span><span class="token punctuation">(</span><span class="token function">URLBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">takeFrom</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"https://internshala.com/"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">install</span><span class="token punctuation">(</span>HttpTimeout<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                requestTimeoutMillis <span class="token operator">=</span> <span class="token number">15_000</span>
            <span class="token punctuation">}</span>
            <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">json</span><span class="token punctuation">(</span>Json <span class="token punctuation">{<!-- --></span>
                    ignoreUnknownKeys <span class="token operator">=</span> <span class="token boolean">true</span>
                    prettyPrint <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">install</span><span class="token punctuation">(</span>Logging<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                level <span class="token operator">=</span> LogLevel<span class="token punctuation">.</span>ALL
                logger <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> Logger <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="2_48">
     </a>
     2个平台调用此方法：
    </h4>
    <ol>
     <li>
      iOS：我们需要在2个不同的文件中进行更改。（共享iOS文件和特定于平台的文件）
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token comment">// :shared/src/iosMain/kotlin/Koin.ios.kt</span>
<span class="token keyword">class</span> Koin <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">fun</span> <span class="token function">initKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        di<span class="token punctuation">.</span><span class="token function">initKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-kotlin"><span class="token comment">// iosApp/iosApp/iOSApp.swift</span>
<span class="token keyword">import</span> SwiftUI
<span class="token keyword">import</span> shared
<span class="token label symbol">@main</span>
struct iOSApp<span class="token operator">:</span> App <span class="token punctuation">{<!-- --></span>
 <span class="token keyword">var</span> body<span class="token operator">:</span> some Scene <span class="token punctuation">{<!-- --></span>
  WindowGroup <span class="token punctuation">{<!-- --></span>
   <span class="token function">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

  <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       KoinKt<span class="token punctuation">.</span><span class="token function">doInitKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>


</code></pre>
    <ol start="2">
     <li>
      Android：与iOS不同，对于Android，我们可以直接调用：shared initKoin()方法并初始化Koin。
     </li>
    </ol>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> App <span class="token operator">:</span> <span class="token function">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">initKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="APIResult_92">
     </a>
     将API响应与Result类进行映射
    </h3>
    <p>
     我们将在Ktor的HttpClient上编写一个小的扩展，用于执行所有API调用并将响应包装在Result（成功/错误）中，并附带适当的消息。
    </p>
    <pre><code class="prism language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">inline</span> <span class="token keyword">fun</span> <span class="token operator">&lt;</span><span class="token keyword">reified</span> T<span class="token operator">&gt;</span> HttpClient<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>
    block<span class="token operator">:</span> HttpRequestBuilder<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">val</span> response <span class="token operator">=</span> <span class="token function">request</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>
        Result<span class="token punctuation">.</span><span class="token function">Success</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        Result<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token function">Throwable</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">response<span class="token punctuation">.</span>status</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">response<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Result<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">sealed</span> <span class="token keyword">interface</span> Result<span class="token operator">&lt;</span><span class="token keyword">out</span> R<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">class</span> Success<span class="token operator">&lt;</span><span class="token keyword">out</span> R<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">val</span> value<span class="token operator">:</span> R<span class="token punctuation">)</span> <span class="token operator">:</span> Result<span class="token operator">&lt;</span>R<span class="token operator">&gt;</span>
    <span class="token keyword">data</span> <span class="token keyword">object</span> Loading <span class="token operator">:</span> Result<span class="token operator">&lt;</span>Nothing<span class="token operator">&gt;</span>
    <span class="token keyword">class</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token keyword">val</span> throwable<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token operator">:</span> Result<span class="token operator">&lt;</span>Nothing<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="_117">
     </a>
     设置分页库
    </h3>
    <p>
     在实施Koin和Ktor之后，接下来是分页库。我们将使用来自cashapp的开源库。 由于Paging提供了多种方法来处理错误和API响应，我们将创建一个组合，以处理这种行为。
    </p>
    <pre><code class="prism language-kotlin"><span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token operator">&lt;</span>T <span class="token operator">:</span> Any<span class="token operator">&gt;</span> <span class="token function">PagingListUI</span><span class="token punctuation">(</span>
    <span class="token keyword">data</span><span class="token operator">:</span> LazyPagingItems<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token annotation builtin">@Composable</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">LazyColumn</span><span class="token punctuation">(</span>
        modifier <span class="token operator">=</span> Modifier
            <span class="token punctuation">.</span><span class="token function">fillMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token function">items</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">.</span>itemCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> index <span class="token operator">-&gt;</span>
            <span class="token keyword">val</span> item <span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span>
            item<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span> <span class="token function">content</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token function">Divider</span><span class="token punctuation">(</span>
                color <span class="token operator">=</span> UiColor<span class="token punctuation">.</span>background<span class="token punctuation">,</span>
                thickness <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span>
                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">border</span><span class="token punctuation">(</span>border <span class="token operator">=</span> <span class="token function">BorderStroke</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>LightGray<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">data</span><span class="token punctuation">.</span>loadState<span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">when</span> <span class="token punctuation">{<!-- --></span>
                refresh <span class="token keyword">is</span> LoadStateNotLoading <span class="token operator">&amp;&amp;</span> <span class="token keyword">data</span><span class="token punctuation">.</span>itemCount <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    item <span class="token punctuation">{<!-- --></span>
                        <span class="token function">Box</span><span class="token punctuation">(</span>
                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillParentMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            contentAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>Center
                        <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">Text</span><span class="token punctuation">(</span>
                                text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"No Items"</span></span><span class="token punctuation">,</span>
                                modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">align</span><span class="token punctuation">(</span>Alignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                textAlign <span class="token operator">=</span> TextAlign<span class="token punctuation">.</span>Center
                            <span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                refresh <span class="token keyword">is</span> LoadStateLoading <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    item <span class="token punctuation">{<!-- --></span>
                        <span class="token function">Box</span><span class="token punctuation">(</span>
                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillParentMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            contentAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>Center
                        <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span>
                                color <span class="token operator">=</span> UiColor<span class="token punctuation">.</span>primary
                            <span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                append <span class="token keyword">is</span> LoadStateLoading <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    item <span class="token punctuation">{<!-- --></span>
                        <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span>
                            color <span class="token operator">=</span> UiColor<span class="token punctuation">.</span>primary<span class="token punctuation">,</span>
                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">wrapContentWidth</span><span class="token punctuation">(</span>Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                refresh <span class="token keyword">is</span> LoadStateError <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    item <span class="token punctuation">{<!-- --></span>
                        <span class="token function">ErrorView</span><span class="token punctuation">(</span>
                            message <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"No Internet Connection."</span></span><span class="token punctuation">,</span>
                            onClickRetry <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">data</span><span class="token punctuation">.</span><span class="token function">retry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">fillParentMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                append <span class="token keyword">is</span> LoadStateError <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    item <span class="token punctuation">{<!-- --></span>
                        <span class="token function">ErrorItem</span><span class="token punctuation">(</span>
                            message <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"No Internet Connection"</span></span><span class="token punctuation">,</span>
                            onClickRetry <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">data</span><span class="token punctuation">.</span><span class="token function">retry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">ErrorItem</span><span class="token punctuation">(</span>
    message<span class="token operator">:</span> String<span class="token punctuation">,</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier<span class="token punctuation">,</span>
    onClickRetry<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Row</span><span class="token punctuation">(</span>
        modifier <span class="token operator">=</span> modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span>
        horizontalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span>SpaceBetween<span class="token punctuation">,</span>
        verticalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterVertically
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
            text <span class="token operator">=</span> message<span class="token punctuation">,</span>
            maxLines <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">weight</span><span class="token punctuation">(</span><span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            color <span class="token operator">=</span> androidx<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>Color<span class="token punctuation">.</span>Red
        <span class="token punctuation">)</span>
        <span class="token function">OutlinedButton</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> onClickRetry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Try again"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">ErrorView</span><span class="token punctuation">(</span>
    message<span class="token operator">:</span> String<span class="token punctuation">,</span>
    modifier<span class="token operator">:</span> Modifier <span class="token operator">=</span> Modifier<span class="token punctuation">,</span>
    onClickRetry<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">Column</span><span class="token punctuation">(</span>
        modifier <span class="token operator">=</span> modifier<span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onPlaced</span> <span class="token punctuation">{<!-- --></span> _ <span class="token operator">-&gt;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        verticalArrangement <span class="token operator">=</span> Arrangement<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
        horizontalAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>CenterHorizontally
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">Text</span><span class="token punctuation">(</span>
            text <span class="token operator">=</span> message<span class="token punctuation">,</span>
            maxLines <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">align</span><span class="token punctuation">(</span>Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">)</span><span class="token punctuation">,</span>
            color <span class="token operator">=</span> androidx<span class="token punctuation">.</span>compose<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>Color<span class="token punctuation">.</span>Red
        <span class="token punctuation">)</span>
        <span class="token function">OutlinedButton</span><span class="token punctuation">(</span>
            onClick <span class="token operator">=</span> onClickRetry<span class="token punctuation">,</span> modifier <span class="token operator">=</span> Modifier
                <span class="token punctuation">.</span><span class="token function">fillMaxWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">wrapContentWidth</span><span class="token punctuation">(</span>Alignment<span class="token punctuation">.</span>CenterHorizontally<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Try again"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="AppInternshipUI_262">
     </a>
     设置App和Internship屏幕的UI部分
    </h3>
    <h4>
     <a id="__Appkt_264">
     </a>
     我们的应用程序入口点 - App.kt
    </h4>
    <pre><code class="prism language-kotlin"><span class="token comment">// :shared/src/commonMain/kotlin/App.kt</span>
<span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    MaterialTheme <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> screens <span class="token operator">=</span> Screen<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> selectedScreen <span class="token keyword">by</span> remember <span class="token punctuation">{<!-- --></span> <span class="token function">mutableStateOf</span><span class="token punctuation">(</span>screens<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

        <span class="token function">Scaffold</span><span class="token punctuation">(</span>
            bottomBar <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">BottomNavigation</span><span class="token punctuation">(</span>
                    backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>White<span class="token punctuation">,</span>
                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span>
                <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    screens<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{<!-- --></span> screen <span class="token operator">-&gt;</span>
                        <span class="token function">BottomNavigationItem</span><span class="token punctuation">(</span>
                            modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">background</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            selectedContentColor <span class="token operator">=</span> ui<span class="token punctuation">.</span>theme<span class="token punctuation">.</span>Color<span class="token punctuation">.</span>textOnPrimary<span class="token punctuation">,</span>
                            unselectedContentColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>Gray<span class="token punctuation">,</span>
                            icon <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token function">Icon</span><span class="token punctuation">(</span>
                                    imageVector <span class="token operator">=</span> <span class="token function">getIconForScreen</span><span class="token punctuation">(</span>screen<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    contentDescription <span class="token operator">=</span> screen<span class="token punctuation">.</span>textValue
                                <span class="token punctuation">)</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            label <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">Text</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span>textValue<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            selected <span class="token operator">=</span> screen <span class="token operator">==</span> selectedScreen<span class="token punctuation">,</span>
                            onClick <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> selectedScreen <span class="token operator">=</span> screen <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            content <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">getScreen</span><span class="token punctuation">(</span>selectedScreen<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">getIconForScreen</span><span class="token punctuation">(</span>screen<span class="token operator">:</span> Screen<span class="token punctuation">)</span><span class="token operator">:</span> ImageVector <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>screen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Screen<span class="token punctuation">.</span>INTERNSHIPS <span class="token operator">-&gt;</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>AccountBox
        Screen<span class="token punctuation">.</span>JOBS <span class="token operator">-&gt;</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Add
        Screen<span class="token punctuation">.</span>COURSES <span class="token operator">-&gt;</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Notifications
        <span class="token keyword">else</span> <span class="token operator">-&gt;</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Home
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Composable</span>
<span class="token keyword">fun</span> <span class="token function">getScreen</span><span class="token punctuation">(</span>selectedScreen<span class="token operator">:</span> Screen<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>selectedScreen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Screen<span class="token punctuation">.</span>INTERNSHIPS <span class="token operator">-&gt;</span> <span class="token function">InternshipsScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    Screen<span class="token punctuation">.</span>JOBS <span class="token operator">-&gt;</span> <span class="token function">JobsScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    Screen<span class="token punctuation">.</span>COURSES <span class="token operator">-&gt;</span> <span class="token function">CoursesScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="_323">
     </a>
     获取分页数据的实习界面
    </h4>
    <pre><code class="prism language-kotlin"><span class="token keyword">class</span> InternshipsScreen <span class="token operator">:</span> KoinComponent <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> viewModel<span class="token operator">:</span> InternshipViewModel <span class="token keyword">by</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token annotation builtin">@Composable</span>
    <span class="token keyword">fun</span> <span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> result <span class="token keyword">by</span> <span class="token function">rememberUpdatedState</span><span class="token punctuation">(</span>viewModel<span class="token punctuation">.</span>internships<span class="token punctuation">.</span><span class="token function">collectAsLazyPagingItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
            topBar <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">TopAppBar</span><span class="token punctuation">(</span>
                    title <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Internships"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    elevation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>dp<span class="token punctuation">,</span>
                    navigationIcon <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">IconButton</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Drawer clicked"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">Icon</span><span class="token punctuation">(</span>imageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Menu<span class="token punctuation">,</span> contentDescription <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Menu"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    actions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">IconButton</span><span class="token punctuation">(</span>onClick <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Search Internships!"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">Icon</span><span class="token punctuation">(</span>imageVector <span class="token operator">=</span> Icons<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Search<span class="token punctuation">,</span> contentDescription <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Search"</span></span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>White
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            drawerContent <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">/*Drawer content*/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            content <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">PagingListUI</span><span class="token punctuation">(</span><span class="token keyword">data</span> <span class="token operator">=</span> result<span class="token punctuation">,</span> content <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token function">InternshipCard</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h3>
     <a id="_358">
     </a>
     总结：
    </h3>
    <p>
     KMM是一个在多个平台上无缝共享代码的能力的框架。已成为跨平台开发领域的改变者。后续我会自己实战一个KMM项目，包括Ktor的详细讲解，敬请期待。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f6c6a78313430303035323535302f:61727469636c652f64657461696c732f313436303831353533" class_="artid" style="display:none">
 </p>
</div>


