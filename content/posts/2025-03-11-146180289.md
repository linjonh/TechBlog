---
layout: post
title: "OSPF的LSA详解报文分析具体例子"
date: 2025-03-11 15:28:22 +0800
description: "要点掌握:名称携带的内容作用传播的范围由谁产生。"
keywords: "如何看ospf tpe lsa类别"
categories: ['数通知识补充']
tags: ['计算机网络', '网络', '智能路由器', 'Tcp']
artid: "146180289"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146180289
    alt: "OSPF的LSA详解报文分析具体例子"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146180289
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146180289
cover: https://bing.ee123.net/img/rand?artid=146180289
image: https://bing.ee123.net/img/rand?artid=146180289
img: https://bing.ee123.net/img/rand?artid=146180289
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     OSPF的LSA详解(报文分析+具体例子)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     OSPF LSA
    </h2>
    <ul>
     <li>
      <p>
       要点掌握:
      </p>
      <ul>
       <li>
        <p>
         名称
        </p>
       </li>
       <li>
        <p>
         携带的内容
        </p>
       </li>
       <li>
        <p>
         作用
        </p>
       </li>
       <li>
        <p>
         传播的范围
        </p>
       </li>
       <li>
        <p>
         由谁产生
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     LSA报头格式
    </h2>
    <ul>
     <li>
      <p>
       所有的LSA都有相同的报文头
      </p>
      <p class="img-center">
       <img alt="image-20250311093339955" height="226" src="https://i-blog.csdnimg.cn/img_convert/a496d69c06434a227b9aa08ee21a8282.png" width="814"/>
      </p>
      <ul>
       <li>
        <p>
         <strong>
          LS age：
         </strong>
         LSA产生后所经过的时间，以秒为单位。LSA在本路由器的LSDB中会随时间老化（每秒钟加1），但在网络的传输过程中却不会
        </p>
       </li>
       <li>
        <p>
         LS type：LSA的类型
        </p>
       </li>
       <li>
        <p>
         Link State ID：具体数值根据LSA的类型而定。
        </p>
       </li>
       <li>
        <p>
         <strong>
          Advertising Router：
         </strong>
         始发LSA的路由器的ID
        </p>
       </li>
       <li>
        <p>
         <strong>
          LS sequence number：
         </strong>
         LSA的序列号，其他路由器根据这个值可以判断哪个LSA是最新的
        </p>
       </li>
       <li>
        <p>
         LS checksum：除了LS age字段外，关于LSA的全部信息的校验和
        </p>
       </li>
       <li>
        <p>
         length：LSA的总长度，包括LSA Header，以字节为单位
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     Type1-LSA
    </h2>
    <ul>
     <li>
      <p>
       定义:
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Router LSA , 路由LSA:
         </strong>
        </p>
       </li>
       <li>
        <p>
         描述区域内部与路由器直连的链路信息
        </p>
       </li>
       <li>
        <p>
         仅在区域内部传播
        </p>
       </li>
       <li>
        <p>
         每台路由器都会产生Type1 LSA
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       内容:
      </p>
      <ul>
       <li>
        <p>
         (链路状态ID)LS ID :发出该LSA的路由器的Router-id
        </p>
       </li>
       <li>
        <p>
         (通告路由器)Adv Rtr:产生LSA的路由器的Router-id
        </p>
       </li>
       <li>
        <p>
         (链路类型)Link-Type
        </p>
        <ul>
         <li>
          <p>
           描述该链路的二层类型 , 类型取值:
          </p>
         </li>
        </ul>
        <ul>
         <li>
          <p>
           1: 点对点连接到另一台路由器 ;链路ID:邻居的RID;链路数据:产生该LSA路由器的接口IP;
          </p>
         </li>
         <li>
          <p>
           2:连接到一个传输网络;链路ID:DR的接口IP地址;链路数据:产生该 LSA的路由器的接口地址
          </p>
         </li>
         <li>
          <p>
           3:连接到一个末梢(stub)网络;链路ID:网络IP地址;网络掩码
          </p>
         </li>
         <li>
          <p>
           4:虚链路;链路ID:邻居的RID;链路数据产生该 LSA的路由器的接口地址
          </p>
         </li>
         <li>
          <p>
           <strong>
            Type：链路类型
           </strong>
           ，取值:
          </p>
          <table>
           <thead>
            <tr>
             <th>
              链路类型
             </th>
             <th>
              描述
             </th>
             <th>
              链路ID
             </th>
             <th>
              链路数据
             </th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td>
              <strong>
               1
              </strong>
             </td>
             <td>
              <strong>
               点对点连接到另外一台路由器
              </strong>
             </td>
             <td>
              <strong>
               邻居的Router-id
              </strong>
             </td>
             <td>
              <strong>
               产生该LSA的路由器的接口的IP地址
              </strong>
             </td>
            </tr>
            <tr>
             <td>
              <strong>
               2
              </strong>
             </td>
             <td>
              <strong>
               连接到一个传输网络
              </strong>
             </td>
             <td>
              <strong>
               DR的接口IP地址
              </strong>
             </td>
             <td>
              <strong>
               产生该LSA的路由器的接口的IP地址
              </strong>
             </td>
            </tr>
            <tr>
             <td>
              <strong>
               3
              </strong>
             </td>
             <td>
              <strong>
               连接到一个末梢网络
              </strong>
             </td>
             <td>
              <strong>
               网络IP地址
              </strong>
             </td>
             <td>
              <strong>
               网络掩码
              </strong>
             </td>
            </tr>
            <tr>
             <td>
              <strong>
               4
              </strong>
             </td>
             <td>
              <strong>
               虚链路
              </strong>
             </td>
             <td>
              <strong>
               邻居的Router-ID
              </strong>
             </td>
             <td>
              <strong>
               产生该LSA的路由器的接口的IP地址
              </strong>
             </td>
            </tr>
           </tbody>
          </table>
          <p>
          </p>
          <p class="img-center">
           <img alt="image-20250311094657694" height="351" src="https://i-blog.csdnimg.cn/img_convert/910db04ebcdd4a74cda6e584a98898b6.png" width="759"/>
          </p>
         </li>
        </ul>
       </li>
      </ul>
     </li>
     <li>
      <p>
       报头内容:
      </p>
      <p class="img-center">
       <img alt="image-20250311093642995" height="555" src="https://i-blog.csdnimg.cn/img_convert/988b4712b3cc70d63656b260ed819736.png" width="817"/>
      </p>
      <ul>
       <li>
        <p>
         特殊位:
        </p>
        <ul>
         <li>
          <p>
           V：如果产生此LSA的路由器是虚连接的端点，则置为1
          </p>
         </li>
         <li>
          <p>
           E：如果产生此LSA的路由器是ASBR，则置为1
          </p>
         </li>
         <li>
          <p>
           B：如果产生此LSA的路由器是ABR，则置为1
          </p>
         </li>
        </ul>
       </li>
       <li>
        <p>
         # Links：LSA中所描述的链路信息的数量，包括路由器上处于某区域中的所有链路和接口
        </p>
       </li>
       <li>
        <p>
         <strong>
          Link ID
         </strong>
         ：链路标识，具体的数值根据链路类型而定(发出该LSA路由器的RID)
        </p>
       </li>
       <li>
        <p>
         Link data：链路数据，具体的数值根据链路类型而定
        </p>
        <p>
         例子:
        </p>
        <p class="img-center">
         <img alt="img" height="334" src="https://i-blog.csdnimg.cn/img_convert/56b54f624f88c0986aa46e01a969f06e.png" width="716"/>
        </p>
        <p>
        </p>
        <p class="img-center">
         <img alt="image-20250311150035811" height="509" src="https://i-blog.csdnimg.cn/img_convert/fd7d8208fd361b21788f2f187b92f9b4.png" width="989"/>
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <p>
    </p>
    <h2>
     Type2-LSA
    </h2>
    <ul>
     <li>
      <p>
       定义:
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Network LSA 网段LSA:
         </strong>
        </p>
       </li>
       <li>
        <p>
         描述区域内的MA网络链路的路由器RID以及网段掩码信息; (通过类型1和类型2得到区域内部路由)
        </p>
       </li>
       <li>
        <p>
         仅在区域内部传输
        </p>
       </li>
       <li>
        <p>
         只有DR会产生Type2 LSA
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       内容:
      </p>
      <ul>
       <li>
        <p>
         (链路状态ID)LS ID :该网段的DR的ip地址
        </p>
       </li>
       <li>
        <p>
         (通告路由器)Adv Rtr:该网段DR的Router-id
        </p>
       </li>
       <li>
        <p>
         网络掩码
        </p>
       </li>
       <li>
        <p>
         (相连的路由器)Attached Router:该网段所有路由器的Router-id
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       报头内容
      </p>
      <p class="img-center">
       <img alt="image-20250311110029503" height="486" src="https://i-blog.csdnimg.cn/img_convert/f86a2bf4c5d763938fde1f72b616eee2.png" width="717"/>
      </p>
      <ul>
       <li>
        <p>
         Link State ID：DR的IP地址
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         Network mask：广播网或NBMA网络地址的掩码
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         Attached router：连接在同一个网段上的所有与DR形成了完全邻接关系的路由器的Router ID，也包括DR自身的Router ID
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       例子:
      </p>
      <p class="img-center">
       <img alt="image-20250311150858075" height="472" src="https://i-blog.csdnimg.cn/img_convert/a4b577c81f299a54495376fbea79fb8c.png" width="933"/>
      </p>
     </li>
    </ul>
    <p>
    </p>
    <p>
    </p>
    <h2>
     Type3-LSA
    </h2>
    <ul>
     <li>
      <p>
       定义:
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Summary LSA 网络汇总LSA
         </strong>
        </p>
       </li>
       <li>
        <p>
         描述其他区域的链路信息 -- 解决区域间路由计算
        </p>
        <ul>
         <li>
          <p>
           以子网形式传播，类似直接传递路由
          </p>
         </li>
         <li>
          <p>
           收集区域内的1,2类LSA信息以子网形式传播
          </p>
         </li>
        </ul>
       </li>
       <li>
        <p>
         在除了生成该LSA的所有其他区域传播
        </p>
       </li>
       <li>
        <p>
         只有ABR会产生Type3 LSA
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       内容:
      </p>
      <ul>
       <li>
        <p>
         (链路状态)LS ID :其他区域某个网段的网络地址
        </p>
       </li>
       <li>
        <p>
         Net mask :该网段的子网掩码
        </p>
       </li>
       <li>
        <p>
         (通告路由器)Adv Rtr:通告该LSA的ABR的Router-id
        </p>
       </li>
       <li>
        <p>
         cost值
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <ul>
     <li>
      <p>
       报头内容
      </p>
      <p>
      </p>
      <p class="img-center">
       <img alt="image-20250311110148383" height="311" src="https://i-blog.csdnimg.cn/img_convert/c88652f075e05f48367ac42a2780e02d.png" width="717"/>
      </p>
      <ul>
       <li>
        <p>
         Link State ID：所通告的区域外的网络地址；
        </p>
       </li>
       <li>
        <p>
         Network mask：Type3 LSA的网络地址掩码。
        </p>
       </li>
       <li>
        <p>
         Metric：到目的地址的路由开销
        </p>
       </li>
       <li>
        <p>
         说明:Type3的LSA可以用来通告缺省路由，此时Link State ID和Network Mask都设置为0.0.0.0。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       例子:
      </p>
      <p class="img-center">
       <img alt="image-20250311151307631" height="387" src="https://i-blog.csdnimg.cn/img_convert/ecdc709a5cf758244d51213cf14b29d7.png" width="849"/>
      </p>
      <p>
      </p>
      <p class="img-center">
       <img alt="image-20250311151317232" height="453" src="https://i-blog.csdnimg.cn/img_convert/fc3def2bcbec52f5d61a9a32aa31e48b.png" width="782"/>
      </p>
     </li>
    </ul>
    <p>
    </p>
    <h2>
     Type4-LSA
    </h2>
    <p>
     (Type-4 LSA和Type-3 LSA 除Link State ID字段有所不同外，有着相同的格式，它们都是由ABR产生)
    </p>
    <ul>
     <li>
      <p>
       定义:
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Asbr-summary ASBR汇总LSA
         </strong>
        </p>
       </li>
       <li>
        <p>
         描述ASBR的信息(RID),让区域内部路由器知道如何到达ASBR
        </p>
       </li>
       <li>
        <p>
         只有ABR会产生Type4 LSA 触发条件是ABR收到第一个5类LSA
        </p>
       </li>
       <li>
        <p>
         在ASBR本区域的内部路由器，不会产生到达该ASBR的4类LSA
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       内容:
      </p>
      <ul>
       <li>
        <p>
         LS ID:ASBR的router-id
        </p>
       </li>
       <li>
        <p>
         网络掩码:字段全0 ,没有意义
        </p>
       </li>
       <li>
        <p>
         Adv Rtr:通告ASBR的ABR的router-id
        </p>
       </li>
       <li>
        <p>
         cost:该ABR到ASBR的cost值
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       报头格式与Type-3 LSA类似
      </p>
     </li>
    </ul>
    <p>
    </p>
    <h2>
     Type5-LSA
    </h2>
    <ul>
     <li>
      <p>
       定义:
      </p>
      <ul>
       <li>
        <p>
         <strong>
          AS-extenal LSA 外部LSA
         </strong>
        </p>
       </li>
       <li>
        <p>
         描述AS外部引入的路由信息
        </p>
       </li>
       <li>
        <p>
         只有ASBR会产生Type5_LSA E位置1
        </p>
       </li>
       <li>
        <p>
         在所有区域传播 除了个别特殊区域
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       内容:
      </p>
      <ul>
       <li>
        <p>
         网络掩码
        </p>
       </li>
       <li>
        <p>
         E位:度量值类型
        </p>
        <ul>
         <li>
          <p>
           置位1:二类外部路由 ,可信程度低,ASBR到目的地址(默认)
          </p>
         </li>
         <li>
          <p>
           置位2:一类外部路由, 可信程度高,开销=本路由器到ASBR+ASBR到目的地址
          </p>
         </li>
        </ul>
       </li>
       <li>
        <p>
         Cost值
        </p>
       </li>
       <li>
        <p>
         外部路由标记,部署策略
        </p>
       </li>
       <li>
        <p>
         FA 转发地址
        </p>
        <ul>
         <li>
          <p>
           为0:到达该外部网段的流量发往引入该路由的ASBR
          </p>
         </li>
         <li>
          <p>
           不为0:发往该地址
          </p>
         </li>
        </ul>
       </li>
       <li>
        <p>
         LS ID:外部某个网段的网络路由
        </p>
       </li>
       <li>
        <p>
         Adv Rtv:引入该网段路由的ASBR的Router-id
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       报文格式
      </p>
      <p class="img-center">
       <img alt="image-20250311110306314" height="438" src="https://i-blog.csdnimg.cn/img_convert/85ac0750249c9bc9410ee2a437f72fa8.png" width="701"/>
      </p>
      <ul>
       <li>
        <p>
         Link State ID：所要通告的其他外部AS的目的地址，如果通告的是一条缺省路由，那么链路状态ID（Link State ID）和网络掩码（Network Mask）字段都将设置为0.0.0.0。
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         Network mask：所通告的目的地址的掩码。
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         （External Metric）：外部度量值的类型。如果是第2类外部路由就设置为1，如果是第1类外部路由则设置为0。
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         Metirc：路由开销
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         Forwarding Address：到所通告的目的地址的报文将被转发到的地址
        </p>
       </li>
      </ul>
      <ul>
       <li>
        <p>
         External Route Tag：添加到外部路由上的标记。OSPF本身并不使用这个字段，它可以用来对外部路由进行管理
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       例子:
      </p>
      <p class="img-center">
       <img alt="image-20250311152118506" height="525" src="https://i-blog.csdnimg.cn/img_convert/c5cfbd4cf824b7301253a187aa7c188f.png" width="907"/>
      </p>
     </li>
    </ul>
    <p>
    </p>
    <h2>
     Type7-LSA
    </h2>
    <ul>
     <li>
      <p>
       定义:
      </p>
      <ul>
       <li>
        <p>
         <strong>
          NSSA(非完全末梢区域)外部LSA
         </strong>
        </p>
       </li>
       <li>
        <p>
         描述在NSSA区域引入的AS外部路由信息
        </p>
       </li>
       <li>
        <p>
         由NSSA区域的ASBR产生
        </p>
       </li>
       <li>
        <p>
         只会出现在NSSA和Totolly NSSA区域
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       内容:
      </p>
      <ul>
       <li>
        <p>
         LS ID:外部某个网段的网络地址
        </p>
       </li>
       <li>
        <p>
         Adv Rtr:引入该路由的ASBR的router-id
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       报文格式与5类LSA一致
      </p>
     </li>
     <li>
      <p>
       7-5转
      </p>
      <ul>
       <li>
        <p>
         ABR为了让NSSA区域内的路由器能够通过骨干区域访问被过滤掉的5类LSA的外部路由,会向NSSA中发布一条默认路由(7类LSA描述)
        </p>
       </li>
       <li>
        <p>
         NSSA允许用7类LSA引入少量外部路由,不被注入area0
        </p>
       </li>
       <li>
        <p>
         ABR将NSSA泛洪的7类LSA转换成5类LSA再OSPF域内传播
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       FA地址不为0,是一个具体地址
      </p>
     </li>
     <li>
      <p>
       例子;
      </p>
      <p class="img-center">
       <img alt="image-20250311152342386" height="586" src="https://i-blog.csdnimg.cn/img_convert/038586acc89d6a3dbb7e3b365e0777a9.png" width="807"/>
      </p>
     </li>
    </ul>
    <h2>
     判断LSA的新旧
    </h2>
    <ul>
     <li>
      <p>
       拥有更高链路状态序列号的LSA实例被认为最新 -- 每次刷新LSA会将序列号+1
      </p>
     </li>
     <li>
      <p>
       序列号相同,拥有更大校验和的LSA实例被认为最新
      </p>
     </li>
     <li>
      <p>
       如果序列号和校验和相同,老化时间设置为Max-age(默认1h),则最新
      </p>
     </li>
     <li>
      <p>
       当本地LSA和新收到的LSA老化时间超过Max-Age-Diff（缺省为15m）时,被认为两个不同实例,老化时间小的LSA最新
      </p>
     </li>
     <li>
      <p>
       如果上面4点都一样则被认为是相同LSA
      </p>
     </li>
    </ul>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f4c696e5f4a756d70696e672f:61727469636c652f64657461696c732f313436313830323839" class_="artid" style="display:none">
 </p>
</div>


