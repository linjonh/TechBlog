---
layout: post
title: "electronvuewebview内嵌网页并注入js"
date: 2025-03-11 10:30:07 +0800
description: "vue内嵌网页可以使用iframe实现内嵌网页，但是只能通过postMessage间接通信，在electron环境下，vue可以直接使用webview来内嵌网页，支持 executeJavaScript、postMessage、send 等丰富的通信机制。更强的 API 控制：支持 executeJavaScript、postMessage、send 等丰富的通信机制。在 Electron 主进程中，需要配置 webview 的权限。兼容性更好：更接近标准 Web 技术，适用于更广泛的项目场景。"
keywords: "electron+vue+webview内嵌网页并注入js"
categories: ['Electron']
tags: ['Vue', 'Javascript', 'Electron']
artid: "146171907"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146171907
    alt: "electronvuewebview内嵌网页并注入js"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146171907
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146171907
cover: https://bing.ee123.net/img/rand?artid=146171907
image: https://bing.ee123.net/img/rand?artid=146171907
img: https://bing.ee123.net/img/rand?artid=146171907
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     electron+vue+webview内嵌网页并注入js
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     vue内嵌网页可以使用iframe实现内嵌网页，但是只能通过postMessage间接通信，在electron环境下，vue可以直接使用webview来内嵌网页，支持 executeJavaScript、postMessage、send 等丰富的通信机制。
     <br/>
     <strong>
      使用 webview的优势
     </strong>
     <br/>
     性能更佳：独立进程，适合加载复杂网页或 Web App。
     <br/>
     更强的 API 控制：支持 executeJavaScript、postMessage、send 等丰富的通信机制。
     <br/>
     更强的安全性：启用 contextIsolation、sandbox 等参数可大幅降低攻击面。
     <br/>
     <strong>
      使用 iframe的优势
     </strong>
     <br/>
     轻量快捷：无需额外配置，简单加载外部网页或静态内容。
     <br/>
     兼容性更好：更接近标准 Web 技术，适用于更广泛的项目场景。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/30ae4abdafcd432b9b631f4ac106998d.png">
      <br/>
      <a href="https://www.electronjs.org/zh/docs/latest/tutorial/web-embeds" rel="nofollow">
       注：官方更推荐WebContentsView，webview已经不推荐，但还是能够使用
      </a>
     </img>
    </p>
    <p>
     <strong>
      前端代码 (Vue 3 组件)
     </strong>
    </p>
    <pre><code>&lt;template&gt;
    &lt;div class="content-layout" &gt;     
        &lt;webview ref="webviewRef" :src="url" style="width: 100%; height: 100%;"
        @dom-ready="onDomReady"&gt;&lt;/webview&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang="ts" setup &gt;

    import { ref, onMounted } from 'vue';

    const url = ref('https://www.baidu.com');

    const webviewRef = ref&lt;Electron.WebviewTag | null&gt;(null);

    onMounted(() =&gt; {
        if (webviewRef.value) {
            webviewRef.value.addEventListener('dom-ready', () =&gt; {
            webviewRef.value!.executeJavaScript(`
                console.log("Injected JavaScript: Hello from Electron!");
                document.body.style.backgroundColor = 'lightblue';
            `);
            });
        }
    });

    function onDomReady () {
      console.log('Webview DOM Ready!');
    };

&lt;/script&gt;

&lt;style scoped&gt;
    .content-layout {
        width: 100%;
        background-color: var(--color-background-content);

    }
&lt;/style&gt;

</code></pre>
    <p>
     <strong>
      主进程 (main.js)
     </strong>
     <br/>
     在 Electron 主进程中，需要配置 webview 的权限。
    </p>
    <pre><code>const { app, BrowserWindow } = require('electron');

let mainWindow;

app.whenReady().then(() =&gt; {
  mainWindow = new BrowserWindow({
    width: 1000,
    height: 800,
    webPreferences: {
      preload: `${__dirname}/preload.js`,  // 为 webview 提供安全预加载脚本
      webviewTag: true,                   // 启用 webview 标签
      contextIsolation: true,             // 提高安全性
      enableRemoteModule: false           // 禁止远程模块，减少安全风险
    }
  });
  
  // HMR for renderer base on electron-vite cli.
  // Load the remote URL for development or the local html file for production.
  if (is.dev &amp;&amp; process.env['ELECTRON_RENDERER_URL']) {
    mainWindow.loadURL(process.env['ELECTRON_RENDERER_URL'])
  } else {
    mainWindow.loadFile(join(__dirname, '../renderer/index.html'))
  }
  
});

</code></pre>
    <p>
     <strong>
      预加载脚本 (preload.js)
     </strong>
     <br/>
     预加载脚本用于在 webview 和 主进程 之间安全地通信
    </p>
    <pre><code>const { contextBridge, ipcRenderer } = require('electron');

// 暴露安全 API 给 Webview
contextBridge.exposeInMainWorld('electronAPI', {
  sendMessage: (message) =&gt; ipcRenderer.send('message', message)
});

// 监听来自主进程的消息
ipcRenderer.on('reply', (event, response) =&gt; {
  console.log('Received from main process:', response);
});

</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f57524649ac2452cacc64464d20e0014.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363635313234332f:61727469636c652f64657461696c732f313436313731393037" class_="artid" style="display:none">
 </p>
</div>


