---
layout: post
title: "Mybatis-框架学习"
date: 2025-03-14 22:52:54 +0800
description: "介绍了 Mybatis 框架的概念以及使用方法"
keywords: "Mybatis 框架学习"
categories: ['Ssm']
tags: ['学习', 'Ssm', 'Mybatis', 'Java']
artid: "146268937"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146268937
    alt: "Mybatis-框架学习"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146268937
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146268937
cover: https://bing.ee123.net/img/rand?artid=146268937
image: https://bing.ee123.net/img/rand?artid=146268937
img: https://bing.ee123.net/img/rand?artid=146268937
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Mybatis 框架学习
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="ORM__0">
     </a>
     ORM 思想
    </h2>
    <h3>
     <a id="_ORM_2">
     </a>
     什么是 ORM
    </h3>
    <p>
     <strong>
      ORM（Object-Relational Mapping，对象关系映射）
     </strong>
     是一种编程技术，旨在通过
     <strong>
      面向对象的方式
     </strong>
     操作关系型数据库。其核心思想是将
     <strong>
      数据库表
     </strong>
     映射为
     <strong>
      编程语言中的类
     </strong>
     ，将
     <strong>
      表中的行
     </strong>
     映射为
     <strong>
      对象实例
     </strong>
     ，将
     <strong>
      表的列
     </strong>
     映射为
     <strong>
      对象的属性
     </strong>
     ，从而屏蔽底层数据库的细节，让开发者以操作对象的方式操作数据库。
    </p>
    <h3>
     <a id="_ORM_8">
     </a>
     为什么需要 ORM
    </h3>
    <h4>
     <a id="_10">
     </a>
     传统数据库操作的痛点
    </h4>
    <ul>
     <li>
      <strong>
       繁琐的 SQL 硬编码
      </strong>
      ：需手动编写 SQL 语句，维护困难。
     </li>
     <li>
      <strong>
       重复的结果集处理
      </strong>
      ：需将
      <code>
       ResultSet
      </code>
      逐行解析为对象。
     </li>
     <li>
      <strong>
       数据库耦合性高
      </strong>
      ：SQL 语法与具体数据库绑定，移植性差。
     </li>
     <li>
      <strong>
       安全隐患
      </strong>
      ：手动拼接 SQL 易引发 SQL 注入攻击。
     </li>
    </ul>
    <h4>
     <a id="ORM__19">
     </a>
     ORM 的解决思路
    </h4>
    <ul>
     <li>
      <strong>
       抽象数据库操作
      </strong>
      ：通过面向对象 API 替代原生 SQL。
     </li>
     <li>
      <strong>
       自动化映射
      </strong>
      ：自动将对象属性与表字段绑定。
     </li>
     <li>
      <strong>
       统一数据访问层
      </strong>
      ：屏蔽数据库差异，提升代码可移植性。
     </li>
    </ul>
    <h3>
     <a id="ORM__27">
     </a>
     ORM 的核心思想
    </h3>
    <h4>
     <a id="_29">
     </a>
     表与类的映射
    </h4>
    <ul>
     <li>
      <strong>
       表（Table）
      </strong>
      ↔
      <strong>
       类（Class）
      </strong>
     </li>
     <li>
      <strong>
       行（Row）
      </strong>
      ↔
      <strong>
       对象实例（Object）
      </strong>
     </li>
     <li>
      <strong>
       列（Column）
      </strong>
      ↔
      <strong>
       对象属性（Property）
      </strong>
     </li>
    </ul>
    <p>
     <strong>
      示例
     </strong>
     ：
    </p>
    <ul>
     <li>
      <p>
       数据库表
       <code>
        user
       </code>
       ：
      </p>
      <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">user</span> <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       对应的 Java 类：
      </p>
      <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token comment">// Getter &amp; Setter</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="_60">
     </a>
     关系的映射
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        一对一
       </strong>
       （如
       <code>
        User
       </code>
       ↔
       <code>
        IDCard
       </code>
       ）
      </p>
      <p>
       通过外键或共享主键实现。
      </p>
     </li>
     <li>
      <p>
       <strong>
        一对多
       </strong>
       （如
       <code>
        Department
       </code>
       ↔
       <code>
        User
       </code>
       ）
      </p>
      <p>
       通过外键在“多”的一方建立关联。
      </p>
     </li>
     <li>
      <p>
       <strong>
        多对多
       </strong>
       （如
       <code>
        User
       </code>
       ↔
       <code>
        Role
       </code>
       ）
      </p>
      <p>
       通过中间表（如
       <code>
        user_role
       </code>
       ）实现。
      </p>
     </li>
    </ul>
    <h4>
     <a id="CRUD__76">
     </a>
     CRUD 操作的抽象
    </h4>
    <ul>
     <li>
      <strong>
       Create
      </strong>
      ：
      <code>
       userDao.save(user)
      </code>
      →
      <code>
       INSERT INTO user ...
      </code>
     </li>
     <li>
      <strong>
       Read
      </strong>
      ：
      <code>
       userDao.findById(1)
      </code>
      →
      <code>
       SELECT * FROM user WHERE id=1
      </code>
     </li>
     <li>
      <strong>
       Update
      </strong>
      ：
      <code>
       userDao.update(user)
      </code>
      →
      <code>
       UPDATE user SET ...
      </code>
     </li>
     <li>
      <strong>
       Delete
      </strong>
      ：
      <code>
       userDao.delete(1)
      </code>
      →
      <code>
       DELETE FROM user WHERE id=1
      </code>
     </li>
    </ul>
    <h3>
     <a id="ORM__85">
     </a>
     ORM 的优势
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         优势
        </strong>
       </th>
       <th align="left">
        <strong>
         说明
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         提高开发效率
        </strong>
       </td>
       <td align="left">
        减少 SQL 编写和结果集解析代码。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         代码可维护性高
        </strong>
       </td>
       <td align="left">
        数据操作集中在对象层面，逻辑清晰。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         数据库无关性
        </strong>
       </td>
       <td align="left">
        更换数据库时只需修改配置，无需重写 SQL。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         防止 SQL 注入
        </strong>
       </td>
       <td align="left">
        通过参数化查询（如
        <code>
         PreparedStatement
        </code>
        ）自动处理。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         支持高级特性
        </strong>
       </td>
       <td align="left">
        如事务管理、缓存、延迟加载等。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="ORM__97">
     </a>
     ORM 的局限性
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         局限性
        </strong>
       </th>
       <th align="left">
        <strong>
         说明
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         性能开销
        </strong>
       </td>
       <td align="left">
        自动生成的 SQL 可能不够优化，复杂查询效率低。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         学习成本
        </strong>
       </td>
       <td align="left">
        需掌握 ORM 框架的配置和特性（如 Hibernate 的 HQL、Session 管理）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         灵活性受限
        </strong>
       </td>
       <td align="left">
        复杂查询或数据库特性（如存储过程）难以通过 ORM 直接实现。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         对象与表的阻抗失配
        </strong>
       </td>
       <td align="left">
        继承、多态等面向对象特性在关系模型中无直接对应。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_ORM__108">
     </a>
     常见 ORM 框架
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         框架
        </strong>
       </th>
       <th align="left">
        <strong>
         语言
        </strong>
       </th>
       <th align="left">
        <strong>
         特点
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         Hibernate
        </strong>
       </td>
       <td align="left">
        Java
       </td>
       <td align="left">
        全自动 ORM，支持 JPA 标准，强调对象化操作。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         MyBatis
        </strong>
       </td>
       <td align="left">
        Java
       </td>
       <td align="left">
        半自动 ORM，SQL 与代码解耦，灵活性高。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         SQLAlchemy
        </strong>
       </td>
       <td align="left">
        Python
       </td>
       <td align="left">
        支持 ORM 和原生 SQL，适用于复杂查询。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         Entity Framework
        </strong>
       </td>
       <td align="left">
        .NET
       </td>
       <td align="left">
        微软官方 ORM，集成 LINQ，支持 Code First 开发模式。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         Django ORM
        </strong>
       </td>
       <td align="left">
        Python
       </td>
       <td align="left">
        高度集成于 Django 框架，简单易用。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="ORM__120">
     </a>
     ORM 使用场景
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         场景
        </strong>
       </th>
       <th align="left">
        <strong>
         是否适合 ORM
        </strong>
       </th>
       <th align="left">
        <strong>
         说明
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         常规 CRUD 操作
        </strong>
       </td>
       <td align="left">
        ✔️ 适合
       </td>
       <td align="left">
        ORM 自动生成高效 SQL，简化开发。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         复杂报表查询
        </strong>
       </td>
       <td align="left">
        ⚠️ 谨慎使用
       </td>
       <td align="left">
        手动编写 SQL 或结合原生查询更灵活。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         高频事务系统
        </strong>
       </td>
       <td align="left">
        ⚠️ 需优化配置
       </td>
       <td align="left">
        ORM 缓存和批量操作可提升性能，但需避免 N+1 查询等问题。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         微服务架构
        </strong>
       </td>
       <td align="left">
        ✔️ 适合
       </td>
       <td align="left">
        ORM 帮助快速实现数据访问层，适配不同数据库。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="ORM__131">
     </a>
     ORM 最佳实践
    </h3>
    <ol>
     <li>
      <p>
       <strong>
        合理设计数据模型
       </strong>
      </p>
      <ul>
       <li>
        避免过度嵌套对象，优先使用扁平化结构。
       </li>
       <li>
        合理使用懒加载（Lazy Loading）避免不必要的数据加载。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        优化查询性能
       </strong>
      </p>
      <ul>
       <li>
        使用批量操作（如
        <code>
         saveAll()
        </code>
        ）减少数据库交互。
       </li>
       <li>
        避免
        <code>
         SELECT *
        </code>
        ，按需查询字段。
       </li>
       <li>
        通过
        <code>
         JOIN FETCH
        </code>
        （Hibernate）或
        <code>
         &lt;association&gt;
        </code>
        （MyBatis）解决 N+1 查询问题。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        结合原生 SQL
       </strong>
      </p>
      <ul>
       <li>
        复杂查询直接使用原生 SQL 或存储过程。
       </li>
      </ul>
      <pre><code class="prism language-java"><span class="token comment">// JPA 原生 SQL 示例</span>
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"SELECT * FROM user WHERE age &gt; :age"</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUsersByAge</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        事务管理
       </strong>
      </p>
      <ul>
       <li>
        使用声明式事务（如
        <code>
         @Transactional
        </code>
        ）确保操作原子性。
       </li>
       <li>
        控制事务粒度，避免长事务占用连接。
       </li>
      </ul>
     </li>
    </ol>
    <h3>
     <a id="_161">
     </a>
     总结
    </h3>
    <p>
     ORM 思想通过
     <strong>
      对象与关系的映射
     </strong>
     ，将数据库操作抽象为面向对象的 API，显著提升了开发效率和代码可维护性。尽管存在性能调优和复杂查询的挑战，但在大多数企业应用中，ORM 仍是平衡开发效率与维护成本的最佳选择。选择合适的 ORM 框架（如 Hibernate 的全面性、MyBatis 的灵活性），并结合原生 SQL 补充其不足，是构建高效数据访问层的关键。
    </p>
    <h2>
     <a id="Mybatis__167">
     </a>
     Mybatis 简介
    </h2>
    <p>
     MyBatis 是一款
     <strong>
      半自动化的持久层 ORM 框架
     </strong>
     （Persistence Framework），它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作，通过 XML 或注解实现 Java 对象与关系型数据库的映射（ORM）。其核心思想是
     <strong>
      将 SQL 与业务代码解耦
     </strong>
     ，开发者可完全控制 SQL 语句，同时实现参数映射和结果集转换的自动化。
    </p>
    <p>
     <strong>
      核心定位
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       轻量级 ORM 框架
      </strong>
      ：比 Hibernate 更轻量，仅关注 SQL 映射，避免全 ORM 的复杂性。
     </li>
     <li>
      <strong>
       SQL 与 Java 解耦
      </strong>
      ：SQL 语句独立于 Java 代码，便于维护和优化。
     </li>
     <li>
      <strong>
       灵活性与高性能
      </strong>
      ：支持动态 SQL、批量操作和缓存机制，提升开发效率。
     </li>
    </ul>
    <h3>
     <a id="_179">
     </a>
     核心特性
    </h3>
    <ol>
     <li>
      <p>
       <strong>
        半自动化设计
       </strong>
      </p>
      <ul>
       <li>
        相比全自动化的 Hibernate，需要手动编写 SQL。
       </li>
       <li>
        提供结果集到对象的自动映射
       </li>
       <li>
        支持存储过程、复杂联表查询等高级功能
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        动态SQL能力
       </strong>
      </p>
      <p>
       通过 XML 标签实现条件分支（
       <code>
        &lt;if&gt;
       </code>
       、
       <code>
        &lt;choose&gt;
       </code>
       ）、循环（
       <code>
        &lt;foreach&gt;
       </code>
       ）等逻辑处理
      </p>
      <p>
       动态 SQL = 传统 JDBC 条件拼接 + 自动防注入处理
      </p>
     </li>
     <li>
      <p>
       <strong>
        轻量级架构
       </strong>
      </p>
      <p>
       核心 JAR 包仅约2.7MB，无第三方依赖。
      </p>
     </li>
    </ol>
    <h3>
     <a id="_199">
     </a>
     核心架构组成
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        组件
       </th>
       <th>
        作用描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         SqlSessionFactory
        </code>
       </td>
       <td>
        全局单例，通过
        <code>
         mybatis-config.xml
        </code>
        构建
       </td>
      </tr>
      <tr>
       <td>
        <code>
         SqlSession
        </code>
       </td>
       <td>
        线程非安全的数据库会话对象，生命周期与请求绑定
       </td>
      </tr>
      <tr>
       <td>
        <code>
         Mapper
        </code>
        接口
       </td>
       <td>
        通过动态代理绑定到 XML 映射文件
       </td>
      </tr>
      <tr>
       <td>
        <code>
         Executor
        </code>
       </td>
       <td>
        执行器，处理缓存、事务等底层操作
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_210">
     </a>
     优点与缺点
    </h3>
    <p>
     <strong>
      优点
     </strong>
     ：
    </p>
    <ul>
     <li>
      灵活控制 SQL，适合复杂查询优化。
     </li>
     <li>
      学习曲线平缓，易于调试。
     </li>
     <li>
      与 Spring 等框架集成良好。
     </li>
    </ul>
    <p>
     <strong>
      缺点
     </strong>
     ：
    </p>
    <ul>
     <li>
      需要手动编写较多 SQL。
     </li>
     <li>
      多表关联映射配置较复杂。
     </li>
    </ul>
    <h3>
     <a id="_225">
     </a>
     使用场景
    </h3>
    <ul>
     <li>
      需要高度优化 SQL 性能的项目。
     </li>
     <li>
      遗留数据库系统（表结构不规范）。
     </li>
     <li>
      需同时使用存储过程与 ORM 的场景。
     </li>
    </ul>
    <h3>
     <a id="_233">
     </a>
     持久层框架对比
    </h3>
    <ul>
     <li>
      <strong>
       JDBC
      </strong>
      <ul>
       <li>
        SQL 夹杂在 Java 代码中耦合度高，导致硬编码内伤。
       </li>
       <li>
        维护不易且实际开发需求中 SQL 有变化，频繁修改的情况多见。
       </li>
       <li>
        代码冗长，开发效率低
       </li>
      </ul>
     </li>
     <li>
      <strong>
       Hibernate
      </strong>
      和
      <strong>
       JPA
      </strong>
      <ul>
       <li>
        操作简便，开发效率高。
       </li>
       <li>
        程序中的长难复杂 SQL 需要绕过框架。
       </li>
       <li>
        内部自动生成的 SQL，不容易做特殊优化。
       </li>
       <li>
        基于全映射的全自动框架，大量字段的 POJO 进行部分映射时比较困难。
       </li>
       <li>
        反射操作太多，导致数据库性能下降。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       MyBatis
      </strong>
      <ul>
       <li>
        轻量级，性能出色
       </li>
       <li>
        SQL 和 Java 编码分开，功能边界清晰。Java 代码专注业务、SQL 语句专注数据。
       </li>
       <li>
        开发效率稍逊于 Hibernate，但是完全能够接收
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     <a id="_252">
     </a>
     快速开始
    </h2>
    <ol>
     <li>
      准备数据库
     </li>
    </ol>
    <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token identifier"><span class="token punctuation">`</span>mybatis-test<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">USE</span> <span class="token identifier"><span class="token punctuation">`</span>mybatis-test<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'王五'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'赵六'</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      创建项目，导入依赖
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- mybatis依赖 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- MySQL驱动 mybatis底层依赖jdbc驱动实现,本次不需要导入连接池,mybatis自带! --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--junit5测试--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Lombok 依赖 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="3">
     <li>
      准备实体类
     </li>
    </ol>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <ol start="4">
     <li>
      <p>
       准备 Mapper 接口和 Mapper XML 文件。
      </p>
      <p>
       MyBatis 框架下，SQL 语句编写位置发生改变，从原来的 Java 类，改成
       <strong>
        XML
       </strong>
       或者注解定义。
      </p>
      <p>
       推荐在 XML 文件中编写 SQL 语句，让用户能更专注于 SQL 代码，不用关注其他的 JDBC 代码。
      </p>
      <p>
       如果拿它跟具有相同功能的 JDBC 代码进行对比，你会立即发现省掉了将近 95% 的代码。
      </p>
      <p>
       一般编写 SQL 语句的文件命名：
       <code>
        XxxMapper.xml
       </code>
       Xxx 一般取表名。
      </p>
      <p>
       Mybatis 中的 Mapper 接口相当于以前的 Dao。但是区别在于，Mapper 仅仅只是建接口即可，我们不需要提供实现类，具体的 SQL 写到对应的 Mapper 文件，该用法的思路如下图所示：
      </p>
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/aa0a644b20734f1d9f6e64cc54d3d1eb.png#pic_center"/>
    </p>
    <p>
     mapper 接口：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
	
	<span class="token comment">// 根据id查询用户</span>
	<span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
</code></pre>
    <p>
     编写 mapper xml 文件：
    </p>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>
        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="token string">"https://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- namespace等于mapper接口类的全限定名,这样实现对应 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 查询使用 select标签
            id = 方法名
            resultType = 返回值类型
            标签内编写SQL语句
     --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- #{id}代表动态传入的参数,id为方法的形参名,并且进行赋值!后面详细讲解 --&gt;</span>
        select id, name, age, sex from user where id = #{id};
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      注意：
     </strong>
    </p>
    <ul>
     <li>
      方法名和 SQL 的 id 一致。
     </li>
     <li>
      方法返回值和 resultType 一致。
     </li>
     <li>
      方法的参数和 SQL 的参数一致。
     </li>
     <li>
      接口的全类名和映射配置文件的名称空间一致。
     </li>
    </ul>
    <ol start="5">
     <li>
      <p>
       编写 Mybatis 配置文件
      </p>
      <p>
       mybatis 框架配置文件： 数据库连接信息，性能配置，
       <code>
        mapper.xml
       </code>
       配置等！
      </p>
      <p>
       习惯上命名为
       <code>
        mybatis-config.xml
       </code>
       ，这个文件名仅仅只是建议，并非强制要求。将来整合 Spring 之后，这个配置文件可以省略。
      </p>
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>
        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>
        <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- environments表示配置Mybatis的开发环境，可以配置多个环境，在众多具体环境中，使用default属性指定实际运行时使用的环境。default属性的取值是environment标签的id属性的值。 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- environment表示配置Mybatis的一个具体的环境 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Mybatis的内置的事务管理器 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- 配置数据源 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 建立数据库连接的具体信息 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/mybatis-test<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Mapper注册：指定Mybatis映射文件的具体位置 --&gt;</span>
        <span class="token comment">&lt;!-- mapper标签：配置一个具体的Mapper映射文件 --&gt;</span>
        <span class="token comment">&lt;!-- resource属性：指定Mapper映射文件的实际存储位置，这里需要使用一个以类路径根目录为基准的相对路径 --&gt;</span>
        <span class="token comment">&lt;!--    对Maven工程的目录结构来说，resources目录下的内容会直接放入类路径，所以这里我们可以以resources目录为基准 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mappers/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="6">
     <li>
      测试
     </li>
    </ol>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBatisTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectEmployee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 1.创建SqlSessionFactory对象</span>
        <span class="token comment">// ①声明Mybatis全局配置文件的路径</span>
        <span class="token class-name">String</span> mybatisConfigFilePath <span class="token operator">=</span> <span class="token string">"mybatis-config.xml"</span><span class="token punctuation">;</span>

        <span class="token comment">// ②以输入流的形式加载Mybatis配置文件</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>mybatisConfigFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ③基于读取Mybatis配置文件的输入流创建SqlSessionFactory对象</span>
        <span class="token class-name">SqlSessionFactory</span> sessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.使用SqlSessionFactory对象开启一个会话</span>
        <span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.根据EmployeeMapper接口的Class对象获取Mapper接口类型的对象(动态代理技术)</span>
        <span class="token class-name">EmployeeMapper</span> employeeMapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">EmployeeMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. 调用代理类方法既可以触发对应的SQL语句</span>
        <span class="token class-name">Employee</span> employee <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">selectEmployee</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"employee = "</span> <span class="token operator">+</span> employee<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4.关闭SqlSession</span>
        session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//提交事务 [DQL不需要,其他需要]</span>
        session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭会话</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     说明：
    </p>
    <ul>
     <li>
      <code>
       SqlSession
      </code>
      ：代表 Java 程序和数据库之间的会话。（
      <code>
       HttpSession
      </code>
      是 Java 程序和浏览器之间的会话）
     </li>
     <li>
      <code>
       SqlSessionFactory
      </code>
      ：是“生产” SqlSession 的“工厂”。
     </li>
     <li>
      工厂模式：如果创建某一个对象，使用的过程基本固定，那么我们就可以把创建这个对象的相关代码封装到一个“工厂类”中，以后都使用这个工厂类来“生产”我们需要的对象。
     </li>
    </ul>
    <h2>
     <a id="Mybatis__464">
     </a>
     Mybatis 基本使用
    </h2>
    <h3>
     <a id="Mybatis__466">
     </a>
     Mybatis 配置文件常用属性
    </h3>
    <p>
     Mybatis 配置文件就是上面的
     <code>
      mybatis-config.xml
     </code>
     文件。
    </p>
    <p>
     结果如下：
    </p>
    <ul>
     <li>
      <code>
       configuration
      </code>
      （配置）
      <ul>
       <li>
        <code>
         properties
        </code>
        （属性）
       </li>
       <li>
        <code>
         settings
        </code>
        （设置）
       </li>
       <li>
        <code>
         typeAliases
        </code>
        （类型别名）
       </li>
       <li>
        <code>
         typeHandlers
        </code>
        （类型处理器）
       </li>
       <li>
        <code>
         objectFactory
        </code>
        （对象工厂）
       </li>
       <li>
        <code>
         plugins
        </code>
        （插件）
       </li>
       <li>
        <code>
         environments
        </code>
        （环境配置）
        <ul>
         <li>
          <code>
           environment
          </code>
          （环境变量）
          <ul>
           <li>
            <code>
             transactionManager
            </code>
            （事务管理器）
           </li>
           <li>
            <code>
             dataSource
            </code>
            （数据源）
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <code>
         databaseIdProvider
        </code>
        （数据库厂商标识）
       </li>
       <li>
        <code>
         mappers
        </code>
        （映射器）
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      配置文件的元素配置时需要严格按照上面的顺序来配置，否则报错。
     </strong>
    </p>
    <p>
     我们上面的配置文件配置了
     <code>
      environments
     </code>
     和
     <code>
      mappers
     </code>
     元素，
     <strong>
      <code>
       environments
      </code>
      元素必须要在
      <code>
       mappers
      </code>
      上面
     </strong>
     。
    </p>
    <h4>
     <a id="environments__492">
     </a>
     <code>
      environments
     </code>
     元素
    </h4>
    <p>
     <code>
      environments
     </code>
     属性是用于配置数据库环境的核心部分，可以配置多个数据库环境，例如实际开发中会有生产环境和测试环境。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>生产环境<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>生产环境<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>测试环境<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     不同的环境分别使用
     <code>
      environment
     </code>
     标签指定，最后在
     <code>
      environments
     </code>
     标签的
     <code>
      default
     </code>
     指定要使用哪个环境。
    </p>
    <h5>
     <a id="environment__509">
     </a>
     <code>
      environment
     </code>
     子元素
    </h5>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Mybatis的内置的事务管理器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 配置数据源 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 建立数据库连接的具体信息 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>jdbc:mysql://localhost:3306/mybatis-test<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <code>
      id
     </code>
     属性：唯一标识一个环境（如
     <code>
      development
     </code>
     、
     <code>
      test
     </code>
     、
     <code>
      production
     </code>
     ）。
    </p>
    <p>
     <code>
      transactionManager
     </code>
     标签：定义事务管理器，可选类型：
    </p>
    <ul>
     <li>
      <code>
       JDBC
      </code>
      ：使用 JDBC 的事务管理（默认），依赖 Connection 的提交和回滚。
     </li>
     <li>
      <code>
       MANAGED
      </code>
      ：由容器（如 Spring）管理事务，MyBatis 不干预事务生命周期。
     </li>
    </ul>
    <p>
     <code>
      dataSource
     </code>
     标签：配置数据库连接池，管理数据库连接的获取和释放，可选类型：
    </p>
    <ul>
     <li>
      <code>
       UNPOOLED
      </code>
      ：每次请求时新建连接，适合简单场景（无连接池）。
     </li>
     <li>
      <code>
       POOLED
      </code>
      ：使用连接池（默认），适合高并发场景。
     </li>
     <li>
      <code>
       JNDI
      </code>
      ：从容器（如 Tomcat）的 JNDI 资源中获取数据源。（不常用）
     </li>
    </ul>
    <h4>
     <a id="mappers__541">
     </a>
     <code>
      mappers
     </code>
     元素
    </h4>
    <p>
     用于
     <strong>
      注册 SQL 映射文件或 Mapper 接口
     </strong>
     。它告诉 MyBatis 框架到哪里加载 SQL 映射规则，从而将 Java 接口方法与对应的 SQL 语句绑定。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mappers/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="_Mapper__553">
     </a>
     注册 Mapper 的四种方式
    </h5>
    <ol>
     <li>
      <strong>
       通过 XML 文件路径注册
      </strong>
     </li>
    </ol>
    <p>
     使用
     <code>
      &lt;mapper resource&gt;
     </code>
     直接指定 Mapper XML 文件的类路径（推荐方式）。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mappers/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     <strong>
      要求
     </strong>
     ：XML 文件需放在类路径（
     <code>
      resources
     </code>
     目录）对应的位置。
    </p>
    <ol start="2">
     <li>
      <strong>
       通过 mapper 接口全限定名注册
      </strong>
     </li>
    </ol>
    <p>
     使用
     <code>
      &lt;mapper class&gt;
     </code>
     直接指定 Mapper 接口的完全限定名（需配合注解或 XML 文件）。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     <strong>
      要求
     </strong>
     ：
    </p>
    <ul>
     <li>
      如果使用 XML 文件，XML 必须与接口同名且在同一包下（如
      <code>
       ProductMapper.java
      </code>
      和
      <code>
       ProductMapper.xml
      </code>
      ）。
     </li>
     <li>
      如果使用注解（如
      <code>
       @Select
      </code>
      ），则无需 XML 文件。
     </li>
    </ul>
    <ol start="3">
     <li>
      <strong>
       通过包名批量注册
      </strong>
     </li>
    </ol>
    <p>
     使用
     <code>
      &lt;package&gt;
     </code>
     扫描指定包下的所有 Mapper 接口或 XML 文件。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.mapper<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <p>
     <strong>
      要求
     </strong>
     ：
    </p>
    <ul>
     <li>
      接口与 XML 文件需同名且在同一包下（如
      <code>
       UserMapper.java
      </code>
      和
      <code>
       UserMapper.xml
      </code>
      ）。
     </li>
    </ul>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c89ea268cdce469f9f572ef7dce74ce5.png#pic_center"/>
    </p>
    <p>
     <strong>
      包名结构必须完全相同。
     </strong>
    </p>
    <ul>
     <li>
      适用于大量 Mapper 的场景，避免逐个注册。
     </li>
    </ul>
    <ol start="4">
     <li>
      <strong>
       通过绝对路径文件注册
      </strong>
     </li>
    </ol>
    <p>
     使用
     <code>
      &lt;mapper url&gt;
     </code>
     指定 XML 文件的绝对磁盘路径（不常用，适用于特殊场景）。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///D:/project/mappers/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <h5>
     <a id="_607">
     </a>
     常见问题及注意事项
    </h5>
    <ol>
     <li>
      <strong>
       路径问题
      </strong>
      <ul>
       <li>
        XML 文件路径需与
        <code>
         &lt;mapper resource&gt;
        </code>
        或
        <code>
         &lt;package&gt;
        </code>
        配置严格匹配。
       </li>
       <li>
        若使用 Maven 项目，需确保 XML 文件位于
        <code>
         resources
        </code>
        目录的对应包路径下。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       同名冲突
      </strong>
      <ul>
       <li>
        同一 SQL 语句在 XML 和注解中重复定义时，XML 优先级更高。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       包扫描限制
      </strong>
      <ul>
       <li>
        <code>
         &lt;package&gt;
        </code>
        仅扫描接口，不自动加载 XML 文件，需保证 XML 与接口位置一致。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     其余元素用到时再介绍。
    </p>
    <h3>
     <a id="Mybatis__621">
     </a>
     Mybatis 日志输出
    </h3>
    <p>
     如果想要输出 sql 语句的日志，需要使用 Mybatis 配置文件的
     <code>
      settings
     </code>
     元素。
    </p>
    <h4>
     <a id="settings__627">
     </a>
     <code>
      settings
     </code>
     元素
    </h4>
    <p>
     用于
     <strong>
      调整框架的全局运行时行为
     </strong>
     。通过它，可以启用或禁用缓存、控制延迟加载、配置日志实现等，从而优化性能和定制化功能。
    </p>
    <h5>
     <a id="_633">
     </a>
     常用配置项及说明
    </h5>
    <p>
     完整列表参考
     <a href="https://mybatis.org/mybatis-3/zh_CN/configuration.html#settings" rel="nofollow">
      官方文档
     </a>
    </p>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         配置项
        </strong>
       </th>
       <th align="left">
        <strong>
         默认值
        </strong>
       </th>
       <th align="left">
        <strong>
         说明
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         <code>
          cacheEnabled
         </code>
        </strong>
       </td>
       <td align="left">
        <code>
         true
        </code>
       </td>
       <td align="left">
        是否开启二级缓存（Mapper 级别缓存）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          lazyLoadingEnabled
         </code>
        </strong>
       </td>
       <td align="left">
        <code>
         false
        </code>
       </td>
       <td align="left">
        是否启用延迟加载（关联对象的延迟初始化）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          aggressiveLazyLoading
         </code>
        </strong>
       </td>
       <td align="left">
        <code>
         false
        </code>
       </td>
       <td align="left">
        是否“激进”延迟加载。若为
        <code>
         true
        </code>
        ，访问任意属性会立即加载所有延迟对象；若为
        <code>
         false
        </code>
        ，按需加载。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          mapUnderscoreToCamelCase
         </code>
        </strong>
       </td>
       <td align="left">
        <code>
         false
        </code>
       </td>
       <td align="left">
        是否自动将数据库字段的下划线命名（如
        <code>
         user_name
        </code>
        ）映射为 Java 属性的驼峰命名（如
        <code>
         userName
        </code>
        ）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          logImpl
         </code>
        </strong>
       </td>
       <td align="left">
        未指定
       </td>
       <td align="left">
        指定 MyBatis 使用的日志框架（如
        <code>
         SLF4J
        </code>
        、
        <code>
         LOG4J2
        </code>
        ）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          jdbcTypeForNull
         </code>
        </strong>
       </td>
       <td align="left">
        <code>
         OTHER
        </code>
       </td>
       <td align="left">
        当参数为
        <code>
         null
        </code>
        时，指定 JDBC 类型（某些数据库要求明确类型，可设为
        <code>
         NULL
        </code>
        ）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          useGeneratedKeys
         </code>
        </strong>
       </td>
       <td align="left">
        <code>
         false
        </code>
       </td>
       <td align="left">
        是否允许 JDBC 支持自动生成主键（需数据库驱动支持）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          defaultStatementTimeout
         </code>
        </strong>
       </td>
       <td align="left">
        未设置
       </td>
       <td align="left">
        设置数据库操作默认超时时间（秒）。
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     使用
     <code>
      name
     </code>
     属性指定配置项，
     <code>
      value
     </code>
     属性指定属性值。
    </p>
    <h5>
     <a id="_652">
     </a>
     配置示例
    </h5>
    <ol>
     <li>
      <strong>
       开启驼峰命名自动映射
      </strong>
     </li>
    </ol>
    <p>
     在实际开放中，由于表非常多且复杂，需要名字进行区分，各个字段名都要加上业务类型。
    </p>
    <p>
     例如 User 用户类，它的字段名通常是
     <code>
      userId
     </code>
     、
     <code>
      userName
     </code>
     、
     <code>
      userAge
     </code>
     等。
    </p>
    <p>
     在 java 中，实体类的属性命名规则是驼峰命名法（多个单词组合时，首字母小写，其它单词首字母大写），例如：
     <code>
      userId
     </code>
     、
     <code>
      userName
     </code>
     、
     <code>
      updateTime
     </code>
     等。
    </p>
    <p>
     在数据库中，字段名是单词_单词的形式命名，例如：
     <code>
      user_id
     </code>
     、
     <code>
      user_name
     </code>
     。
    </p>
    <p>
     这样两者名对不上了，如果名字严格符合上面要求，我们就可以配置驼峰命名自动映射去匹配。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mapUnderscoreToCamelCase<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       效果
      </strong>
      ：无需手动编写
      <code>
       &lt;resultMap&gt;
      </code>
      ，自动将
      <code>
       user_name
      </code>
      映射到
      <code>
       userName
      </code>
      属性。
     </li>
    </ul>
    <ol start="2">
     <li>
      <strong>
       配置延迟加载
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazyLoadingEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>aggressiveLazyLoading<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       效果
      </strong>
      ：关联对象（如
      <code>
       Order
      </code>
      关联的
      <code>
       User
      </code>
      ）仅在访问时加载，避免不必要的查询。
     </li>
    </ul>
    <ol start="3">
     <li>
      <strong>
       指定日志框架
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SLF4J<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ul>
     <li>
      <strong>
       支持的值
      </strong>
      ：
      <code>
       SLF4J
      </code>
      、
      <code>
       LOG4J2
      </code>
      、
      <code>
       LOG4J
      </code>
      、
      <code>
       STDOUT_LOGGING
      </code>
      （控制台输出）等。
     </li>
    </ul>
    <p>
     我们测试配置日志使用
     <code>
      STDOUT_LOGGING
     </code>
     ，
     <code>
      SLF4J
     </code>
     、
     <code>
      LOG4J2
     </code>
     等需要导入依赖才能使用。
    </p>
    <p>
     在快速开始的测试代码配置文件
     <code>
      environments
     </code>
     元素上面配置：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logImpl<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT_LOGGING<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     查看输出：
    </p>
    <pre><code class="prism language-txt">Logging initialized using 'class org.apache.ibatis.logging.stdout.StdOutImpl' adapter.
PooledDataSource forcefully closed/removed all connections.
PooledDataSource forcefully closed/removed all connections.
PooledDataSource forcefully closed/removed all connections.
PooledDataSource forcefully closed/removed all connections.
Opening JDBC Connection
Created connection 1866229258.
Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@6f3c660a]
==&gt;  Preparing: select id, name, age, sex from user where id = ?;
==&gt; Parameters: 1(Integer)
&lt;==    Columns: id, name, age, sex
&lt;==        Row: 1, 张三, 18, 男
&lt;==      Total: 1
User(id=1, name=张三, age=18, sex=男)
Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@6f3c660a]
Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@6f3c660a]
Returned connection 1866229258 to pool.
</code></pre>
    <h3>
     <a id="___729">
     </a>
     #{} 和 ${}
    </h3>
    <p>
     它们的用途都是为 sql 语句传入参数值，下面是对比：
    </p>
    <table>
     <thead>
      <tr>
       <th>
        特性
       </th>
       <th>
        <code>
         #{}
        </code>
        （井号占位符）
       </th>
       <th>
        <code>
         ${}
        </code>
        （美元占位符）
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         处理方式
        </strong>
       </td>
       <td>
        预编译参数（PreparedStatement）
       </td>
       <td>
        直接字符串替换（字符串拼接）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         防 SQL 注入
        </strong>
       </td>
       <td>
        ✅ 自动防止
       </td>
       <td>
        ❌ 存在风险（需手动过滤）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         参数类型转换
        </strong>
       </td>
       <td>
        自动匹配 JDBC 类型
       </td>
       <td>
        按原样插入（可能需手动加引号）
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         适用场景
        </strong>
       </td>
       <td>
        动态
        <strong>
         值
        </strong>
        的传递（如 WHERE 条件值）
       </td>
       <td>
        动态
        <strong>
         SQL 片段
        </strong>
        （如表名、列名、ORDER BY）
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="_742">
     </a>
     典型使用场景示例
    </h4>
    <ol>
     <li>
      必须用
      <code>
       #{}
      </code>
      的场景（安全优先）
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!-- 动态条件值 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findUser<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM user 
  WHERE username = #{name} AND age &gt; #{minAge}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="2">
     <li>
      必须用
      <code>
       ${}
      </code>
      的场景（动态结构）
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!-- 动态表名（需确保 tableName 值可信） --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectFromTable<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM ${tableName}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 动态排序字段 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUsers<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM user ORDER BY ${orderColumn}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="Mybatis__770">
     </a>
     Mybatis 数据输入
    </h3>
    <p>
     这里数据输入具体是指上层方法（例如 Service 接口方法）调用Mapper接口时，数据传入的形式。
    </p>
    <ul>
     <li>
      简单类型：只包含一个值的数据类型
      <ul>
       <li>
        基本数据类型：
        <code>
         int
        </code>
        、
        <code>
         byte
        </code>
        、
        <code>
         short
        </code>
        、
        <code>
         double
        </code>
        、……
       </li>
       <li>
        基本数据类型的包装类型：
        <code>
         Integer
        </code>
        、
        <code>
         Character
        </code>
        、
        <code>
         Double
        </code>
        、……
       </li>
       <li>
        字符串类型：
        <code>
         String
        </code>
       </li>
      </ul>
     </li>
     <li>
      复杂类型：包含多个值的数据类型
      <ul>
       <li>
        实体类类型：
        <code>
         User
        </code>
        、
        <code>
         Student
        </code>
        、……
       </li>
       <li>
        集合类型：
        <code>
         List
        </code>
        、
        <code>
         Set
        </code>
        、
        <code>
         Map
        </code>
        、……
       </li>
       <li>
        数组类型：
        <code>
         int[]
        </code>
        、String[]、……
       </li>
       <li>
        复合类型：
        <code>
         List&lt;User&gt;
        </code>
        、实体类中包含集合……
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_786">
     </a>
     单个简单类型参数
    </h4>
    <p>
     我们快速开始的代码就是单个简单类型参数（
     <code>
      Integer id
     </code>
     ）
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select id, name, age, sex from user where id = #{id};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     单个简单类型参数，在
     <code>
      #{}
     </code>
     中可以随意命名，但是没有必要。通常还是使用和接口方法参数同名。
    </p>
    <h4>
     <a id="_800">
     </a>
     单个复杂类型参数
    </h4>
    <p>
     插入一条数据，参数就是实体类
     <code>
      User
     </code>
     。
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
     ：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into user (name, age, sex) VALUE (#{name},#{age},#{sex});
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     测试：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"田七"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> result <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"插入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      单个复杂类型参数，在
      <code>
       #{}
      </code>
      中必须为实体类的属性名。
     </strong>
    </p>
    <p>
     Mybatis 会根据
     <code>
      #{}
     </code>
     中传入的数据，加工成
     <code>
      getXxx()
     </code>
     方法，通过反射在实体类对象中调用这个方法，从而获取到对应的数据。填充到
     <code>
      #{}
     </code>
     解析后的问号占位符这个位置。
    </p>
    <p>
     因为默认是开启事务的，所以插入语句需要提交事务。
    </p>
    <h4>
     <a id="_841">
     </a>
     多个简单类型参数
    </h4>
    <p>
     场景：根据用户的姓名，年龄查找用户
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">User</span> <span class="token function">getUserByNameAndAge</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByNameAndAge<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from user where name = #{name} and age = #{6}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      <code>
       #{}
      </code>
      不能任意命名，也不能单纯得使用参数名，而是必要要在接口方法的参数上使用
      <code>
       @Param
      </code>
      注解指定名称
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token class-name">User</span> <span class="token function">getUserByNameAndAge</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     两个名称对应。
    </p>
    <h4>
     <a id="map__869">
     </a>
     map 类型参数
    </h4>
    <p>
     场景：插入数据，参数为 map 类型
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">addUserMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUserMap<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into user (name, age, sex) VALUE (#{name},#{age},#{sex});
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     测试
    </p>
    <pre><code class="prism language-java"><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"田七"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">,</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> result <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">addUserMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"插入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      <code>
       #{}
      </code>
      为 map 的 key 名字
     </strong>
    </p>
    <h3>
     <a id="Mybatis__905">
     </a>
     Mybatis 数据输出
    </h3>
    <h4>
     <a id="_907">
     </a>
     输出概述
    </h4>
    <p>
     数据输出总体上有两种形式：
    </p>
    <ul>
     <li>
      增删改操作返回的受影响行数：直接使用
      <code>
       int
      </code>
      或
      <code>
       long
      </code>
      类型接收即可。
     </li>
     <li>
      查询操作的查询结果，可能为各种类型。
     </li>
    </ul>
    <p>
     我们需要指定查询的输出数据类型。
    </p>
    <p>
     并且插入场景下，实现主键数据回显示。
    </p>
    <p>
     对于 select 语句，需要使用
     <code>
      resultType
     </code>
     指明返回值类型，其它 dml 语句（insert、update、delete）不需要指定
     <code>
      resultType
     </code>
     ，因为都是
     <code>
      int
     </code>
     类型。
    </p>
    <h4>
     <a id="resultType__922">
     </a>
     resultType 属性
    </h4>
    <ol>
     <li>
      <strong>
       值
      </strong>
      ：类的全限定名或者别名。例如
      <code>
       Integer
      </code>
      类型的全限定名是
      <code>
       java.lang.Integer
      </code>
      ，Mybatis 设置了很多别名
      <code>
       int Integer integer Int INT INTEGER
      </code>
      。基本数据类型的别名是名称前加
      <code>
       _
      </code>
      ，例如
      <code>
       int
      </code>
      类型的别名是
      <code>
       _int
      </code>
      。
     </li>
     <li>
      <strong>
       作用
      </strong>
      ：指定 SQL 返回结果的映射类型，可以是简单类型、POJO 对象或 Map。
     </li>
     <li>
      <strong>
       使用场景
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       基本类型
      </strong>
      ：返回单个字段值（如
      <code>
       int
      </code>
      ,
      <code>
       String
      </code>
      ）。
     </li>
     <li>
      <strong>
       POJO 对象
      </strong>
      ：返回结果自动映射到对象的属性（字段名与属性名一致）。
     </li>
     <li>
      <strong>
       Map
      </strong>
      ：以键值对形式返回结果（键为列名，值为数据）。
     </li>
    </ul>
    <ol start="4">
     <li>
      <strong>
       注意事项
      </strong>
     </li>
    </ol>
    <ul>
     <li>
      <strong>
       必须显式指定
      </strong>
      ：
      <code>
       resultType
      </code>
      不可省略（除非使用
      <code>
       resultMap
      </code>
      ）。
     </li>
     <li>
      <strong>
       自动映射规则
      </strong>
      ：
      <ul>
       <li>
        默认按列名与属性名匹配（可开启
        <code>
         mapUnderscoreToCamelCase
        </code>
        支持驼峰转换）。
       </li>
       <li>
        若列名与属性名不一致，需使用
        <code>
         &lt;resultMap&gt;
        </code>
        或别名。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       集合处理
      </strong>
      ：
      <ul>
       <li>
        返回多行数据时，
        <code>
         resultType
        </code>
        仍指定单条记录的类型（MyBatis 自动包装为
        <code>
         List&lt;T&gt;
        </code>
        ）。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_943">
     </a>
     返回单个简单类型
    </h4>
    <p>
     场景：查询数据总数
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getCount<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select count(*) from user;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     使用
     <code>
      Integer
     </code>
     类型的别名
     <code>
      int
     </code>
    </p>
    <h4>
     <a id="_965">
     </a>
     返回单个复杂类型
    </h4>
    <p>
     根据 id 查询用户，最开始的例子。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- #{id}代表动态传入的参数,id为方法的形参名,并且进行赋值!后面详细讲解 --&gt;</span>
    select id, name, age, sex from user where id = #{id};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     这里
     <code>
      resultType
     </code>
     为实体类的全限定名
     <code>
      com.yigongsui.pojo.User
     </code>
     ，为了简化，我们可以使用配置别名，用到配置文件的
     <code>
      typeAliases
     </code>
     元素。
    </p>
    <h5>
     <a id="typeAliases__980">
     </a>
     <code>
      typeAliases
     </code>
     元素
    </h5>
    <p>
     类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写。
    </p>
    <p>
     <code>
      typeAliases
     </code>
     元素在
     <code>
      settings
     </code>
     的下面，
     <code>
      environments
     </code>
     的上面
    </p>
    <p>
     配置别名有两种方式。
    </p>
    <ol>
     <li>
      <code>
       typeAlias
      </code>
      将类的全限定名与包名做映射。
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAlias</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     当这样配置时，
     <code>
      user
     </code>
     可以用在任何使用
     <code>
      com.yigongsui.pojo.User
     </code>
     的地方。
    </p>
    <ol start="2">
     <li>
      配置包名
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     配置包名后，包名下的每个实体类都会以类名首字母小写的名字作为别名。
    </p>
    <p>
     例如
     <code>
      com.yigongsui.pojo
     </code>
     包下的
     <code>
      User
     </code>
     实体类，它的别名是
     <code>
      user
     </code>
     。
    </p>
    <p>
     由于这样每个实体类别名都默认为这个，如果想用其它别名，可以在类上设置注解
     <code>
      @Alias
     </code>
     指定别名。
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Alias</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_map__1027">
     </a>
     返回 map 类型
    </h4>
    <p>
     接口
    </p>
    <pre><code class="prism language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserMapById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserMapById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from user where id = #{id};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     测试
    </p>
    <pre><code class="prism language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resultMap <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getUserMapById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> resultMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_list__1054">
     </a>
     返回 list 类型
    </h4>
    <p>
     接口
    </p>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from user 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     测试
    </p>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      <code>
       resultType
      </code>
      指定的是集合的泛型类型，而不是 list
     </strong>
    </p>
    <h4>
     <a id="_1081">
     </a>
     返回主键值
    </h4>
    <h5>
     <a id="_1083">
     </a>
     自增长主键
    </h5>
    <p>
     场景：插入一条数据，获取它的主键值。
    </p>
    <p>
     在
     <code>
      mapper.xml
     </code>
     的
     <code>
      &lt;insert&gt;
     </code>
     标签指定3个属性
     <code>
      useGeneratedKeys
     </code>
     、
     <code>
      keyColumn
     </code>
     、
     <code>
      keyProperty
     </code>
    </p>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         属性
        </strong>
       </th>
       <th align="left">
        <strong>
         作用
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         <code>
          useGeneratedKeys
         </code>
        </strong>
       </td>
       <td align="left">
        是否启用数据库自动生成的主键（如自增 ID、序列等），默认为
        <code>
         false
        </code>
        。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          keyColumn
         </code>
        </strong>
       </td>
       <td align="left">
        指定数据库表中主键列的列名（用于多主键或列名与属性名不一致的场景）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          keyProperty
         </code>
        </strong>
       </td>
       <td align="left">
        指定将生成的主键值赋值给 Java 对象的哪个属性（对象的字段名）。
       </td>
      </tr>
     </tbody>
    </table>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyColumn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into user (name, age, sex) VALUE (#{name},#{age},#{sex});
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     测试
    </p>
    <pre><code class="prism language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"孙八"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> rows <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rows <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"插入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     可以看到，插入前
     <code>
      id
     </code>
     为
     <code>
      null
     </code>
     ，插入后
     <code>
      id
     </code>
     就变成了当前的主键值。
    </p>
    <h5>
     <a id="_1121">
     </a>
     非自增类型主键
    </h5>
    <p>
     而对于不支持自增型主键的数据库（例如 Oracle）或者字符串类型主键，则可以使用
     <code>
      selectKey
     </code>
     子元素：
     <code>
      selectKey
     </code>
     元素将会首先运行，id 会被设置，然后插入语句会被调用！
    </p>
    <p>
     使用
     <code>
      selectKey
     </code>
     帮助插入
     <code>
      UUID
     </code>
     作为字符串类型主键示例：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span>
        <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BEFORE<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        SELECT UUID() as id
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">&gt;</span></span>
    INSERT INTO user (id, name, age, sex) VALUE (#{id},#{name},#{age},#{sex});
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     在上例中，我们定义了一个
     <code>
      addUser
     </code>
     的插入语句来将
     <code>
      User
     </code>
     对象插入到
     <code>
      user
     </code>
     表中。我们使用
     <code>
      selectKey
     </code>
     来查询 UUID 并设置到
     <code>
      uId
     </code>
     字段中，
     <code>
      uId
     </code>
     为
     <code>
      String
     </code>
     类型。
    </p>
    <p>
     通过
     <code>
      keyProperty
     </code>
     属性来指定查询到的 UUID 赋值给对象中的
     <code>
      uId
     </code>
     属性，而
     <code>
      resultType
     </code>
     属性指定了 UUID 的类型为
     <code>
      java.lang.String
     </code>
     。
    </p>
    <p>
     需要注意的是，我们将
     <code>
      selectKey
     </code>
     放在了插入语句的前面，这是因为 MySQL 在
     <code>
      insert
     </code>
     语句中只支持一个
     <code>
      select
     </code>
     子句，而
     <code>
      selectKey
     </code>
     中查询 UUID 的语句就是一个
     <code>
      select
     </code>
     子句，因此我们需要将其放在前面。
    </p>
    <p>
     最后，在将
     <code>
      User
     </code>
     对象插入到
     <code>
      user
     </code>
     表中时，我们直接使用对象中的
     <code>
      id
     </code>
     属性来插入主键值。
    </p>
    <p>
     使用这种方式，我们可以方便地插入 UUID 作为字符串类型主键。当然，还有其他插入方式可以使用，如使用 Java 代码生成 UUID 并在类中显式设置值等。需要根据具体应用场景和需求选择合适的插入方式。
    </p>
    <h3>
     <a id="_1149">
     </a>
     实体类属性和数据库字段映射
    </h3>
    <p>
     在实际开发中，经常会遇到实体类名和字段名不匹配的情况。
    </p>
    <p>
     有3种解决方案：
    </p>
    <ol>
     <li>
      <strong>
       sql 语句使用别名：
      </strong>
     </li>
    </ol>
    <pre><code class="prism language-sql"><span class="token keyword">select</span> user_id <span class="token keyword">as</span> userID<span class="token punctuation">,</span>user_name <span class="token keyword">as</span> userName <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      <strong>
       开启驼峰命名规则
      </strong>
     </li>
    </ol>
    <p>
     在 Mybatis 配置文件
     <code>
      settings
     </code>
     元素配置驼峰命名，上面展示过了。
    </p>
    <p>
     这两种方法均使用
     <code>
      resultType
     </code>
     属性自动配置，适用于单表情况。
    </p>
    <p>
     对于多表情况，最好使用第3种方法：
    </p>
    <ol start="3">
     <li>
      <strong>
       使用
       <code>
        resultMap
       </code>
       自定义映射
      </strong>
     </li>
    </ol>
    <h4>
     <a id="resultMap_1173">
     </a>
     <code>
      resultMap
     </code>
    </h4>
    <p>
     <code>
      resultMap
     </code>
     是 MyBatis 中用于
     <strong>
      自定义结果集映射
     </strong>
     的核心属性，适用于以下场景：
    </p>
    <ul>
     <li>
      <strong>
       字段名与属性名不一致
      </strong>
      ：数据库列名与 Java 对象属性名不匹配时。
     </li>
     <li>
      <strong>
       复杂对象映射
      </strong>
      ：如关联对象（一对一）、集合（一对多）、嵌套查询等。
     </li>
     <li>
      <strong>
       需要显式控制映射规则
      </strong>
      ：例如指定主键列、类型转换器或级联映射。
     </li>
    </ul>
    <h5>
     <a id="resultMap__1183">
     </a>
     <code>
      resultMap
     </code>
     的核心子标签
    </h5>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         子标签
        </strong>
       </th>
       <th align="left">
        <strong>
         作用
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;id&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        映射主键字段，优化性能（标识对象的唯一性）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;result&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        映射普通字段，指定列名与属性名的对应关系。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;association&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        映射
        <strong>
         一对一
        </strong>
        关联对象（如
        <code>
         User
        </code>
        关联
        <code>
         Department
        </code>
        ）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;collection&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        映射
        <strong>
         一对多
        </strong>
        集合对象（如
        <code>
         User
        </code>
        包含多个
        <code>
         Order
        </code>
        ）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;constructor&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        通过构造方法注入结果（替代 setter）。
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="resultMap_vs_resultType_1195">
     </a>
     <code>
      resultMap
     </code>
     vs
     <code>
      resultType
     </code>
    </h5>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         对比项
        </strong>
       </th>
       <th align="left">
        <strong>
         <code>
          resultMap
         </code>
        </strong>
       </th>
       <th align="left">
        <strong>
         <code>
          resultType
         </code>
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         灵活性
        </strong>
       </td>
       <td align="left">
        高（支持复杂映射）
       </td>
       <td align="left">
        低（仅支持简单自动映射）
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         配置方式
        </strong>
       </td>
       <td align="left">
        需显式定义
        <code>
         &lt;resultMap&gt;
        </code>
       </td>
       <td align="left">
        直接指定 Java 类或别名
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         适用场景
        </strong>
       </td>
       <td align="left">
        字段名不一致、关联对象、集合、嵌套查询
       </td>
       <td align="left">
        字段名与属性名一致的简单映射
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="resultMap__1205">
     </a>
     <code>
      resultMap
     </code>
     示例
    </h5>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myMap<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- id的值与select标签的resultMap的值对应 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- id配置主键 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- result配置其它字段 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userName<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_age<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userAge<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_sex<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userSex<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="_1225">
     </a>
     高级特性
    </h5>
    <h6>
     <a id="_resultMap_1227">
     </a>
     继承其他
     <code>
      resultMap
     </code>
    </h6>
    <p>
     通过
     <code>
      extends
     </code>
     属性复用已有的映射配置：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>baseUserMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userWithDeptMap<span class="token punctuation">"</span></span> <span class="token attr-name">extends</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>baseUserMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deptResultMap<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h6>
     <a id="_1244">
     </a>
     自动映射
    </h6>
    <p>
     在
     <code>
      resultMap
     </code>
     中开启
     <code>
      autoMapping="true"
     </code>
     ，自动映射未显式配置的字段：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">autoMapping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 其他字段自动映射 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h6>
     <a id="_1257">
     </a>
     类型处理器
    </h6>
    <p>
     通过
     <code>
      typeHandler
     </code>
     指定自定义类型转换器：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createTime<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>create_time<span class="token punctuation">"</span></span> 
        <span class="token attr-name">typeHandler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.ibatis.type.DateTypeHandler<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <h2>
     <a id="Mybatis__1268">
     </a>
     Mybatis 多表映射
    </h2>
    <p>
     多表映射指通过 MyBatis 实现关系型数据库中多个关联表的数据映射，主要处理三种关系：
    </p>
    <ol>
     <li>
      一对一（1:1）
     </li>
     <li>
      一对多（1:N）
     </li>
     <li>
      多对多（M:N）
     </li>
    </ol>
    <p>
     MyBatis 处理多表关联的两种核心方法：
    </p>
    <ul>
     <li>
      <strong>
       联表查询（JOIN）
      </strong>
      ：通过一条 SQL 查询多表数据，映射到嵌套对象。
     </li>
     <li>
      <strong>
       嵌套查询（分步查询）
      </strong>
      ：先查主表数据，再根据主表结果查询关联表数据（支持延迟加载）。
     </li>
    </ul>
    <h3>
     <a id="_1283">
     </a>
     一对一
    </h3>
    <p>
     一只猫对应一个用户。
    </p>
    <h4>
     <a id="_1289">
     </a>
     环境准备
    </h4>
    <p>
     数据库，用户表，猫表
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>cat<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>cat_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>cat_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  	<span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>cat_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'李四'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>cat<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>cat_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'小花'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>cat<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>cat_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'小红'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     用户表实体类
     <code>
      User.java
     </code>
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     猫实体类
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Integer</span> catId<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> catName<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>

	<span class="token comment">// 一对一</span>
	<span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     环境准备完成。
    </p>
    <p>
     场景：根据 id 查询猫及所属用户的信息。
    </p>
    <h4>
     <a id="_1347">
     </a>
     联表查询
    </h4>
    <p>
     联表查询本质是1条 sql 语句，例如：
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> cat c
<span class="token keyword">left</span> <span class="token keyword">join</span> <span class="token keyword">user</span> u <span class="token keyword">on</span> c<span class="token punctuation">.</span>cat_id <span class="token operator">=</span> u<span class="token punctuation">.</span>user_id
<span class="token keyword">where</span> c<span class="token punctuation">.</span>cat_id <span class="token operator">=</span> <span class="token number">1</span>
</code></pre>
    <p>
     下面使用代码实现：
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">Cat</span> <span class="token function">getCatById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
     ：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.Cat<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat_name<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 一对一配置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>association</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">javaType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>association</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getCatById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catMap<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select *
    from cat c
    left join user u on c.cat_id = u.user_id
    where c.cat_id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     使用
     <code>
      resultMap
     </code>
     配置多表映射，使用
     <code>
      association
     </code>
     给对象属性赋值，配置一对一映射，
     <code>
      javaType
     </code>
     是类的全限定名。
    </p>
    <h4>
     <a id="_1392">
     </a>
     嵌套查询（分步查询）
    </h4>
    <p>
     本质是2条 sql 语句，先根据 id 查询猫，获取用户的 id，再根据用户 id 查询用户信息。
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> <span class="token keyword">user</span> u
<span class="token keyword">where</span> u<span class="token punctuation">.</span>user_id <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> c<span class="token punctuation">.</span>user_id
    <span class="token keyword">from</span> cat c
    <span class="token keyword">where</span> c<span class="token punctuation">.</span>cat_id <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     使用代码实现：
    </p>
    <p>
     <code>
      mapper.xml
     </code>
     ：
    </p>
    <pre><code class="prism language-java"><span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">"catMap"</span> type<span class="token operator">=</span><span class="token string">"com.yigongsui.pojo.Cat"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">"catId"</span> column<span class="token operator">=</span><span class="token string">"cat_id"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"catName"</span> column<span class="token operator">=</span><span class="token string">"cat_name"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">"userId"</span> column<span class="token operator">=</span><span class="token string">"user_id"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>association property<span class="token operator">=</span><span class="token string">"user"</span> column<span class="token operator">=</span><span class="token string">"user_id"</span> select<span class="token operator">=</span><span class="token string">"getUserById"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 主查询 <span class="token operator">--</span>
<span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"getCatById"</span> resultMap<span class="token operator">=</span><span class="token string">"catMap"</span><span class="token operator">&gt;</span>
    select <span class="token operator">*</span> from cat c where c<span class="token punctuation">.</span>cat_id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>catId<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 关联查询 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">"getUserById"</span> resultType<span class="token operator">=</span><span class="token string">"com.yigongsui.pojo.User"</span><span class="token operator">&gt;</span>
    select <span class="token operator">*</span> from user u where u<span class="token punctuation">.</span>user_id <span class="token operator">=</span> #<span class="token punctuation">{<!-- --></span>userId<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">&gt;</span>
</code></pre>
    <p>
     <strong>
      需要在 mybatis 配置文件开启驼峰命名，否则 user 字段无法映射
     </strong>
    </p>
    <p>
     测试结果
    </p>
    <pre><code class="prism language-txt">==&gt;  Preparing: select * from cat c where c.cat_id = ?;
==&gt; Parameters: 1(Integer)
&lt;==    Columns: cat_id, cat_name, user_id
&lt;==        Row: 1, 小花, 1
====&gt;  Preparing: select * from user u where u.user_id = ?
====&gt; Parameters: 1(Integer)
&lt;====    Columns: user_id, user_name
&lt;====        Row: 1, 张三
&lt;====      Total: 1
&lt;==      Total: 1
Cat(catId=1, catName=小花, userId=1, user=User(userId=1, userName=张三))
</code></pre>
    <h3>
     <a id="_1451">
     </a>
     一对多和多对一
    </h3>
    <p>
     场景：一个用户拥有多只猫
    </p>
    <p>
     数据库添加两条数据
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>cat<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>cat_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'小黄'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>cat<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>cat_name<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'小绿'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     用户实体类新增属性
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span><span class="token punctuation">&gt;</span></span> catList<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_1478">
     </a>
     联表查询
    </h4>
    <p>
     sql 语句
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> <span class="token keyword">user</span> u
<span class="token keyword">join</span> cat c <span class="token keyword">on</span> u<span class="token punctuation">.</span>user_id <span class="token operator">=</span> c<span class="token punctuation">.</span>user_id
<span class="token keyword">where</span> u<span class="token punctuation">.</span>user_id <span class="token operator">=</span> <span class="token number">1</span>
</code></pre>
    <p>
     代码实现：
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
     ：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catList<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.Cat<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat_name<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userMap<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select *
    from user u
    join cat c on u.user_id = c.user_id
    where u.user_id = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     使用
     <code>
      collection
     </code>
     配置集合，
     <code>
      ofType
     </code>
     为集合的泛型
    </p>
    <p>
     结果：
    </p>
    <pre><code class="prism language-txt">==&gt;  Preparing: select * from user u join cat c on u.user_id = c.user_id where u.user_id = ?
==&gt; Parameters: 1(Integer)
&lt;==    Columns: user_id, user_name, cat_id, cat_name, user_id
&lt;==        Row: 1, 张三, 1, 小花, 1
&lt;==        Row: 1, 张三, 3, 小黄, 1
&lt;==        Row: 1, 张三, 4, 小绿, 1
&lt;==      Total: 3
User(userId=1, userName=张三, catList=[Cat(catId=1, catName=小花, userId=null, user=null), Cat(catId=3, catName=小黄, userId=null, user=null), Cat(catId=4, catName=小绿, userId=null, user=null)])
</code></pre>
    <h4>
     <a id="_1534">
     </a>
     嵌套查询
    </h4>
    <p>
     先根据 id 查询用户信息，再根据用户 id 获取所有猫的信息。
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userName<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>catList<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getCatByUserId<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 主查询 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userMap<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from user u where u.user_id = #{userId};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 嵌套查询 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getCatByUserId<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.Cat<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from cat c where c.user_id = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     结果：
    </p>
    <pre><code class="prism language-txt">==&gt;  Preparing: select * from user u where u.user_id = ?;
==&gt; Parameters: 1(Integer)
&lt;==    Columns: user_id, user_name
&lt;==        Row: 1, 张三
====&gt;  Preparing: select * from cat c where c.user_id = ?
====&gt; Parameters: 1(Integer)
&lt;====    Columns: cat_id, cat_name, user_id
&lt;====        Row: 1, 小花, 1
&lt;====        Row: 3, 小黄, 1
&lt;====        Row: 4, 小绿, 1
&lt;====      Total: 3
&lt;==      Total: 1
User(userId=1, userName=张三, catList=[Cat(catId=1, catName=小花, userId=1, user=null), Cat(catId=3, catName=小黄, userId=1, user=null), Cat(catId=4, catName=小绿, userId=1, user=null)])
</code></pre>
    <h3>
     <a id="_1576">
     </a>
     多对多
    </h3>
    <p>
     多对多一般发生在3个表之间，步骤同一对多。
    </p>
    <h3>
     <a id="_1582">
     </a>
     多表映射优化
    </h3>
    <p>
     在
     <code>
      settings
     </code>
     配置中有一个
     <code>
      autoMappingBehavior
     </code>
     可以处理多表复杂映射。
    </p>
    <table>
     <thead>
      <tr>
       <th>
        setting属性
       </th>
       <th>
        属性含义
       </th>
       <th>
        可选值
       </th>
       <th>
        默认值
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <code>
         autoMappingBehavior
        </code>
       </td>
       <td>
        指定 MyBatis 应如何自动映射列到字段或属性。
        <code>
         NONE
        </code>
        表示关闭自动映射；
        <code>
         PARTIAL
        </code>
        只会自动映射没有定义嵌套结果映射的字段。
        <code>
         FULL
        </code>
        会自动映射任何复杂的结果集（无论是否嵌套）。
       </td>
       <td>
        <code>
         NONE
        </code>
        ,
        <code>
         PARTIAL
        </code>
        ,
        <code>
         FULL
        </code>
       </td>
       <td>
        <code>
         PARTIAL
        </code>
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     我们可以将
     <code>
      autoMappingBehavior
     </code>
     设置为
     <code>
      full
     </code>
     ，进行多表
     <code>
      resultMap
     </code>
     映射的时候，可以省略符合列和属性命名映射规则（列名 = 属性名，或者开启驼峰映射也可以自定映射）的 result 标签。
    </p>
    <h3>
     <a id="_1594">
     </a>
     总结
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        关联关系
       </th>
       <th>
        配置项关键词
       </th>
       <th>
        所在配置文件和具体位置
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        对一
       </td>
       <td>
        <code>
         association
        </code>
        标签/
        <code>
         javaType
        </code>
        属性/
        <code>
         property
        </code>
        属性
       </td>
       <td>
        <code>
         Mapper
        </code>
        配置文件中的
        <code>
         resultMap
        </code>
        标签内
       </td>
      </tr>
      <tr>
       <td>
        对多
       </td>
       <td>
        <code>
         collection
        </code>
        标签/
        <code>
         ofType
        </code>
        属性/
        <code>
         property
        </code>
        属性
       </td>
       <td>
        <code>
         Mapper
        </code>
        配置文件中的
        <code>
         resultMap
        </code>
        标签内
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="Mybatis__sql_1603">
     </a>
     Mybatis 动态 sql
    </h2>
    <p>
     MyBatis 动态 SQL 允许根据不同条件动态生成 SQL 语句，常用于处理复杂的查询、更新或插入逻辑。
    </p>
    <h3>
     <a id="_1609">
     </a>
     核心标签
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         标签
        </strong>
       </th>
       <th align="left">
        <strong>
         作用
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;if&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        条件判断，根据表达式结果决定是否包含 SQL 片段。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;choose&gt;/&lt;when&gt;/&lt;otherwise&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        多分支选择（类似 Java 的
        <code>
         switch-case
        </code>
        ）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;trim&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        智能去除 SQL 片段中的多余前缀/后缀（如
        <code>
         AND
        </code>
        、
        <code>
         OR
        </code>
        、逗号）。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;where&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        自动处理
        <code>
         WHERE
        </code>
        子句，避免条件为空时生成无效
        <code>
         WHERE
        </code>
        或多余的
        <code>
         AND/OR
        </code>
        。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;set&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        自动处理
        <code>
         UPDATE
        </code>
        语句中的
        <code>
         SET
        </code>
        子句，去除多余的逗号。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;foreach&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        遍历集合参数，生成
        <code>
         IN
        </code>
        查询或批量操作的 SQL 片段。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         <code>
          &lt;bind&gt;
         </code>
        </strong>
       </td>
       <td align="left">
        定义变量，简化复杂表达式或重复逻辑。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="where__if__1623">
     </a>
     where 和 if 标签
    </h3>
    <p>
     两个标签通常要搭配使用，根据条件动态查询数据。
    </p>
    <p>
     场景：根据用户和姓名和年龄查询数据，如果条件不存在就查询所有数据。
    </p>
    <p>
     实体类：
    </p>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> userAge<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserByNameAndAge</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
     ：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByNameAndAge<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.yigongsui.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null and name != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            user_name = #{name}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            and user_age = #{age}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      需要开启驼峰自动映射
     </strong>
     。
    </p>
    <p>
     <strong>
      <code>
       if
      </code>
      标签的
      <code>
       test
      </code>
      属性用于判断查询是否存在，如果满足条件才会拼接语句。
     </strong>
    </p>
    <p>
     <strong>
      拼接的语句从第2条开始，要在前面加上 and 或 or 关键字进行拼接（也可以在第1条语句前也加上），即时第1条语句不满足条件，Mybatis 会自动省略多余的 and、or 避免 sql 语句出错。
     </strong>
    </p>
    <p>
     <strong>
      如果条件均不满足，where 也会省略。
     </strong>
    </p>
    <h3>
     <a id="set__1674">
     </a>
     set 标签
    </h3>
    <p>
     <code>
      set
     </code>
     标签用于更新语句。
    </p>
    <p>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">updateUserById</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <code>
      mapper.xml
     </code>
     ：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateUserById<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    update user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userName != null and userName != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            user_name = #{userName},
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userAge != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            user_age = #{userAge}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
    where user_id = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      使用
      <code>
       set
      </code>
      标签时，
      <code>
       if
      </code>
      下语句需要加上
      <code>
       ,
      </code>
      ，
      <code>
       set
      </code>
      标签会自动删除不需要的
      <code>
       ,
      </code>
      （最后一条语句可加可不加）。
     </strong>
    </p>
    <p>
     <strong>
      至少要有一个条件满足，否则会报错，毕竟修改至少要修改一条字段。
     </strong>
    </p>
    <h3>
     <a id="trim__1707">
     </a>
     trim 标签
    </h3>
    <p>
     <strong>
      作用
     </strong>
     ：自定义去除 SQL 片段的前缀/后缀。
    </p>
    <p>
     <strong>
      属性
     </strong>
     ：
    </p>
    <ul>
     <li>
      <code>
       prefix
      </code>
      ：添加前缀。
     </li>
     <li>
      <code>
       suffix
      </code>
      ：添加后缀。
     </li>
     <li>
      <code>
       prefixOverrides
      </code>
      ：去除前缀。
     </li>
     <li>
      <code>
       suffixOverrides
      </code>
      ：去除后缀。
     </li>
    </ul>
    <p>
     <strong>
      场景
     </strong>
     ：替代
     <code>
      where
     </code>
     标签。
    </p>
    <h3>
     <a id="choosewhenotherwise__1722">
     </a>
     choose/when/otherwise 标签
    </h3>
    <p>
     <strong>
      作用
     </strong>
     ：多条件分支选择，类似于 java 中的
     <code>
      switch-case
     </code>
     。
    </p>
    <p>
     <strong>
      场景
     </strong>
     ：根据优先级查询用户。
    </p>
    <h3>
     <a id="foreach__1730">
     </a>
     foreach 标签
    </h3>
    <p>
     <strong>
      作用
     </strong>
     ：遍历集合参数（如
     <code>
      List
     </code>
     、数组、
     <code>
      Map
     </code>
     ）。
    </p>
    <p>
     <strong>
      属性
     </strong>
     ：
    </p>
    <ul>
     <li>
      <code>
       collection
      </code>
      ：集合参数名。
     </li>
     <li>
      <code>
       item
      </code>
      ：遍历时的元素别名。
     </li>
     <li>
      <code>
       index
      </code>
      ：遍历时的索引别名。
     </li>
     <li>
      <code>
       open
      </code>
      /
      <code>
       close
      </code>
      ：循环体开始/结束时的字符。
     </li>
     <li>
      <code>
       separator
      </code>
      ：元素间的分隔符。
     </li>
    </ul>
    <p>
     <strong>
      示例 1
     </strong>
     ：
     <code>
      IN
     </code>
     查询：
    </p>
    <p>
     <strong>
      需要设置
      <code>
       @Param
      </code>
      属性名。
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserByIds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"ids"</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByIds<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM user
  WHERE user_id IN
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ids<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    #{userId}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     <strong>
      <code>
       item
      </code>
      指定的属性名与
      <code>
       #{}
      </code>
      内名相同。
     </strong>
    </p>
    <p>
     <strong>
      示例 2
     </strong>
     ：批量插入
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>batchInsertUsers<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  INSERT INTO user (user_name, user_age) VALUES
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>users<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    (#{user.userName}, #{user.userAge})
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="sql__1775">
     </a>
     sql 片段
    </h3>
    <p>
     当一条 sql 语句出现多次时，可以将这条 sql 语句提取出来进行复用。
    </p>
    <p>
     提取 sql：
    </p>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!-- 使用sql标签抽取重复出现的SQL片段 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mySelectSql<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select user_id,user_name,user_age from user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     引用 sql：
    </p>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!-- 使用include标签引用声明的SQL片段 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mySelectSql<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
    <h2>
     <a id="Mybatis__1797">
     </a>
     Mybatis 插件机制
    </h2>
    <h3>
     <a id="_1799">
     </a>
     原理
    </h3>
    <p>
     MyBatis 的插件机制基于
     <strong>
      动态代理
     </strong>
     和
     <strong>
      责任链模式
     </strong>
     ，允许开发者拦截以下四大核心接口的方法：
    </p>
    <ul>
     <li>
      <strong>
       <code>
        Executor
       </code>
      </strong>
      ：执行 SQL 的顶层对象，负责增删改查操作。
     </li>
     <li>
      <strong>
       <code>
        StatementHandler
       </code>
      </strong>
      ：处理 SQL 预编译和结果集。
     </li>
     <li>
      <strong>
       <code>
        ParameterHandler
       </code>
      </strong>
      ：处理 SQL 参数映射。
     </li>
     <li>
      <strong>
       <code>
        ResultSetHandler
       </code>
      </strong>
      ：处理结果集映射。
     </li>
    </ul>
    <p>
     <strong>
      插件工作流程
     </strong>
     ：
    </p>
    <ol>
     <li>
      <strong>
       定义拦截器
      </strong>
      ：实现
      <code>
       Interceptor
      </code>
      接口，指定拦截的方法。
     </li>
     <li>
      <strong>
       创建代理对象
      </strong>
      ：MyBatis 通过动态代理生成目标对象的代理。
     </li>
     <li>
      <strong>
       责任链调用
      </strong>
      ：多个插件按配置顺序形成拦截链，依次执行前置处理、原方法、后置处理。
     </li>
    </ol>
    <h3>
     <a id="_1816">
     </a>
     实现步骤
    </h3>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Intercepts</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Signature</span><span class="token punctuation">(</span>
        type <span class="token operator">=</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        method <span class="token operator">=</span> <span class="token string">"query"</span><span class="token punctuation">,</span>
        args <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">MappedStatement</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">RowBounds</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResultHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Invocation</span> invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 拦截逻辑</span>
        <span class="token keyword">return</span> invocation<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在MyBatis配置文件中注册：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">interceptor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.MyPlugin<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h3>
     <a id="_PageHelper_1845">
     </a>
     分页插件 PageHelper
    </h3>
    <p>
     <strong>
      PageHelper
     </strong>
     是基于 MyBatis 插件机制的分页工具，通过拦截
     <code>
      Executor
     </code>
     的查询方法，自动添加分页 SQL（如 MySQL 的
     <code>
      LIMIT
     </code>
     ），并计算总记录数。
    </p>
    <p>
     <strong>
      核心特性
     </strong>
     ：
    </p>
    <ul>
     <li>
      <strong>
       零侵入
      </strong>
      ：无需修改原有 SQL，通过简单 API 触发分页。
     </li>
     <li>
      <strong>
       支持多种数据库
      </strong>
      ：自动识别数据库类型，生成适配的分页语句。
     </li>
     <li>
      <strong>
       性能优化
      </strong>
      ：通过
      <code>
       COUNT
      </code>
      查询获取总记录数，避免全表扫描。
     </li>
    </ul>
    <h4>
     <a id="_1857">
     </a>
     使用步骤
    </h4>
    <ol>
     <li>
      添加依赖
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>pagehelper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="2">
     <li>
      配置插件
     </li>
    </ol>
    <p>
     在配置文件配置：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">interceptor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.github.pagehelper.PageInterceptor<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 配置数据库方言（可选，PageHelper 会自动检测） --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>helperDialect<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mysql<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- 合理化分页参数（页码超出范围时自动修正） --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>reasonable<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="3">
     <li>
      使用
     </li>
    </ol>
    <pre><code class="prism language-java"><span class="token comment">// 1. 开启分页：pageNum - 页码，pageSize - 每页数量</span>
<span class="token class-name">PageHelper</span><span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 执行查询（紧跟 startPage 后的第一个查询会自动分页）</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 封装分页结果</span>
<span class="token class-name">PageInfo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> pageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageInfo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出分页信息</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"总记录数："</span> <span class="token operator">+</span> pageInfo<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前页数据："</span> <span class="token operator">+</span> pageInfo<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_1905">
     </a>
     核心原理
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        拦截
        <code>
         Executor
        </code>
        的查询方法
       </strong>
       ：
      </p>
      <p>
       <code>
        PageInterceptor
       </code>
       拦截
       <code>
        Executor
       </code>
       的
       <code>
        query()
       </code>
       方法，判断是否需要分页。
      </p>
     </li>
     <li>
      <p>
       <strong>
        改写原始 SQL
       </strong>
       ：
      </p>
      <ul>
       <li>
        添加分页语句（如 MySQL 的
        <code>
         LIMIT
        </code>
        ）。
       </li>
       <li>
        执行
        <code>
         COUNT
        </code>
        查询获取总记录数。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        封装分页结果
       </strong>
       ：
      </p>
      <p>
       将分页后的数据与总记录数封装到
       <code>
        Page
       </code>
       或
       <code>
        PageInfo
       </code>
       对象中。
      </p>
     </li>
    </ol>
    <h4>
     <a id="_1922">
     </a>
     高级功能与配置
    </h4>
    <h5>
     <a id="_1924">
     </a>
     分页参数传递
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        直接传递参数
       </strong>
       ：
      </p>
      <pre><code class="prism language-java"><span class="token class-name">PageHelper</span><span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        通过方法参数传递
       </strong>
       （需配置
       <code>
        supportMethodsArguments=true
       </code>
       ）：
      </p>
      <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">PageInfo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUsers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"pageNum"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> pageNum<span class="token punctuation">,</span> 
                                <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"pageSize"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 无需手动调用 startPage</span>
    <span class="token keyword">return</span> <span class="token class-name">PageHelper</span><span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>pageNum<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doSelectPageInfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> userMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
     </li>
    </ul>
    <h5>
     <a id="_1945">
     </a>
     排序支持
    </h5>
    <pre><code class="prism language-java"><span class="token class-name">PageHelper</span><span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"name desc, age asc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="_vs__1954">
     </a>
     物理分页 vs 内存分页
    </h5>
    <ul>
     <li>
      <p>
       <strong>
        物理分页
       </strong>
       ：通过 SQL 分页（默认），性能高。
      </p>
     </li>
     <li>
      <p>
       <strong>
        内存分页
       </strong>
       ：先查全部数据，再在内存中分页（不推荐）：
      </p>
      <pre><code class="prism language-java"><span class="token class-name">PageHelper</span><span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="_1966">
     </a>
     与其他分页方案对比
    </h4>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         方案
        </strong>
       </th>
       <th align="left">
        <strong>
         优点
        </strong>
       </th>
       <th align="left">
        <strong>
         缺点
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         PageHelper
        </strong>
       </td>
       <td align="left">
        无侵入、支持多数据库、使用简单
       </td>
       <td align="left">
        依赖 MyBatis 插件机制
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         手动 LIMIT
        </strong>
       </td>
       <td align="left">
        完全控制 SQL
       </td>
       <td align="left">
        需手动编写分页逻辑和 COUNT 查询
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         Spring Data JPA
        </strong>
       </td>
       <td align="left">
        与 Spring 生态集成好
       </td>
       <td align="left">
        仅适用于 JPA，灵活性较低
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="Mybatis__1976">
     </a>
     Mybatis 的缓存机制
    </h2>
    <p>
     MyBatis 提供了一套灵活的缓存机制，用于减少数据库访问次数，提升查询性能。其缓存分为
     <strong>
      一级缓存
     </strong>
     和
     <strong>
      二级缓存
     </strong>
     ，两者的作用范围、配置方式及生命周期不同。以下是详细解析：
    </p>
    <h3>
     <a id="_1982">
     </a>
     一级缓存（本地缓存）
    </h3>
    <h4>
     <a id="_1984">
     </a>
     作用域
    </h4>
    <ul>
     <li>
      <strong>
       SqlSession 级别
      </strong>
      ：同一个
      <code>
       SqlSession
      </code>
      内有效（默认开启）。
     </li>
     <li>
      <strong>
       生命周期
      </strong>
      ：与
      <code>
       SqlSession
      </code>
      绑定，会话关闭或执行
      <code>
       commit()
      </code>
      、
      <code>
       rollback()
      </code>
      、
      <code>
       clearCache()
      </code>
      时缓存失效。
     </li>
    </ul>
    <h4>
     <a id="_1991">
     </a>
     工作机制
    </h4>
    <ul>
     <li>
      <strong>
       缓存范围
      </strong>
      ：
      <br/>
      同一
      <code>
       SqlSession
      </code>
      多次执行相同的查询（完全相同的 SQL 和参数），会直接返回缓存的结果，不访问数据库。
     </li>
     <li>
      <strong>
       失效条件
      </strong>
      ：
      <ul>
       <li>
        执行
        <code>
         INSERT
        </code>
        /
        <code>
         UPDATE
        </code>
        /
        <code>
         DELETE
        </code>
        操作（无论是否修改缓存数据）。
       </li>
       <li>
        手动调用
        <code>
         sqlSession.clearCache()
        </code>
        。
       </li>
       <li>
        配置
        <code>
         flushCache="true"
        </code>
        的查询（如
        <code>
         &lt;select flushCache="true"&gt;
        </code>
        ）。
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_2002">
     </a>
     示例验证
    </h4>
    <pre><code class="prism language-java"><span class="token class-name">SqlSession</span> session <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第一次查询，访问数据库</span>
<span class="token class-name">User</span> user1 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 第二次查询，命中一级缓存</span>
<span class="token class-name">User</span> user2 <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user1 <span class="token operator">==</span> user2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true（同一对象引用）</span>

session<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交后缓存失效</span>
</code></pre>
    <h4>
     <a id="_2020">
     </a>
     优缺点
    </h4>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         优点
        </strong>
       </th>
       <th align="left">
        <strong>
         缺点
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        自动开启，无需配置。
       </td>
       <td align="left">
        作用域小，仅限同一 SqlSession。
       </td>
      </tr>
      <tr>
       <td align="left">
        减少重复查询开销。
       </td>
       <td align="left">
        多个 SqlSession 无法共享缓存数据。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_2029">
     </a>
     二级缓存（全局缓存）
    </h3>
    <h4>
     <a id="_2031">
     </a>
     作用域
    </h4>
    <ul>
     <li>
      <strong>
       Mapper 级别
      </strong>
      ：跨
      <code>
       SqlSession
      </code>
      共享（需手动开启）。
     </li>
     <li>
      <strong>
       生命周期
      </strong>
      ：与应用程序的生命周期一致，除非显式清除或配置过期时间。
     </li>
    </ul>
    <h4>
     <a id="_2038">
     </a>
     工作机制
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        缓存共享
       </strong>
       ：
      </p>
      <p>
       不同
       <code>
        SqlSession
       </code>
       访问同一 Mapper 的查询，可以共享缓存数据。
      </p>
     </li>
     <li>
      <p>
       <strong>
        存储方式
       </strong>
       ：
      </p>
      <p>
       默认使用内存存储（可集成 Redis、Ehcache 等第三方缓存）。
      </p>
     </li>
    </ul>
    <h4>
     <a id="_2050">
     </a>
     配置步骤
    </h4>
    <h5>
     <a id="_2052">
     </a>
     全局启用二级缓存
    </h5>
    <p>
     在
     <code>
      mybatis-config.xml
     </code>
     中配置：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cacheEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="Mapper__2064">
     </a>
     Mapper 文件中声明缓存
    </h5>
    <p>
     在对应的
     <code>
      Mapper.xml
     </code>
     中添加
     <code>
      &lt;cache&gt;
     </code>
     标签：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 开启二级缓存 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> 
        <span class="token attr-name">eviction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span>              <span class="token attr-name">&lt;!--</span> <span class="token attr-name">淘汰策略（默认LRU）</span> <span class="token attr-name">--</span><span class="token punctuation">&gt;</span></span>
        flushInterval="60000"       <span class="token comment">&lt;!-- 自动刷新间隔（毫秒） --&gt;</span>
        size="1024"                 <span class="token comment">&lt;!-- 缓存最大对象数 --&gt;</span>
        readOnly="true"/&gt;           <span class="token comment">&lt;!-- 是否只读（默认false） --&gt;</span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * FROM user WHERE id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="POJO__2085">
     </a>
     POJO 类实现序列化
    </h5>
    <p>
     若使用默认缓存，需确保返回的对象实现
     <code>
      Serializable
     </code>
     接口：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// Getter &amp; Setter</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="eviction_2099">
     </a>
     缓存淘汰策略（
     <code>
      eviction
     </code>
     ）
    </h4>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         策略
        </strong>
       </th>
       <th align="left">
        <strong>
         说明
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <code>
         LRU
        </code>
       </td>
       <td align="left">
        最近最少使用（默认），移除最长时间未被使用的对象。
       </td>
      </tr>
      <tr>
       <td align="left">
        <code>
         FIFO
        </code>
       </td>
       <td align="left">
        先进先出，按对象进入缓存的顺序移除。
       </td>
      </tr>
      <tr>
       <td align="left">
        <code>
         SOFT
        </code>
       </td>
       <td align="left">
        软引用，基于垃圾回收器状态和软引用规则移除对象。
       </td>
      </tr>
      <tr>
       <td align="left">
        <code>
         WEAK
        </code>
       </td>
       <td align="left">
        弱引用，更积极地移除对象。
       </td>
      </tr>
     </tbody>
    </table>
    <h5>
     <a id="_2110">
     </a>
     缓存失效条件
    </h5>
    <ul>
     <li>
      执行
      <code>
       &lt;insert&gt;
      </code>
      、
      <code>
       &lt;update&gt;
      </code>
      、
      <code>
       &lt;delete&gt;
      </code>
      操作时，同一 Mapper 的缓存自动清空。
     </li>
     <li>
      手动调用
      <code>
       sqlSession.clearCache()
      </code>
      或配置
      <code>
       flushCache="true"
      </code>
      。
     </li>
    </ul>
    <h5>
     <a id="_2117">
     </a>
     示例验证
    </h5>
    <pre><code class="prism language-java"><span class="token comment">// 第一个 SqlSession</span>
<span class="token class-name">SqlSession</span> session1 <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">UserMapper</span> mapper1 <span class="token operator">=</span> session1<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">User</span> user1 <span class="token operator">=</span> mapper1<span class="token punctuation">.</span><span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查询数据库</span>
session1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交并关闭，数据存入二级缓存</span>

<span class="token comment">// 第二个 SqlSession</span>
<span class="token class-name">SqlSession</span> session2 <span class="token operator">=</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">UserMapper</span> mapper2 <span class="token operator">=</span> session2<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">User</span> user2 <span class="token operator">=</span> mapper2<span class="token punctuation">.</span><span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 命中二级缓存</span>
session2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user1 <span class="token operator">==</span> user2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false（不同会话，但数据相同）</span>
</code></pre>
    <h5>
     <a id="_2137">
     </a>
     优缺点
    </h5>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         优点
        </strong>
       </th>
       <th align="left">
        <strong>
         缺点
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        跨会话共享，减少数据库压力。
       </td>
       <td align="left">
        配置复杂，需处理序列化和并发问题。
       </td>
      </tr>
      <tr>
       <td align="left">
        支持第三方缓存扩展。
       </td>
       <td align="left">
        数据实时性差，可能读到旧数据。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_2146">
     </a>
     缓存使用注意事项
    </h3>
    <h4>
     <a id="_2148">
     </a>
     避免脏读
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        场景
       </strong>
       ：多个 Mapper 操作同一张表时，二级缓存可能未及时更新。
      </p>
     </li>
     <li>
      <p>
       <strong>
        解决
       </strong>
       ：在关联的 Mapper 配置中引用同一缓存命名空间：
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache-ref</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="_2160">
     </a>
     细粒度缓存控制
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        关闭单条语句的缓存
       </strong>
       ：
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findUser<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT * FROM user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        强制刷新缓存
       </strong>
       ：
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findUser<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">flushCache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT * FROM user
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
     </li>
    </ul>
    <h4>
     <a id="_2182">
     </a>
     集成第三方缓存
    </h4>
    <p>
     以
     <strong>
      Ehcache
     </strong>
     为例：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        添加依赖
       </strong>
       ：
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.caches<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-ehcache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
     </li>
     <li>
      <p>
       <strong>
        配置 Mapper 缓存
       </strong>
       ：
      </p>
      <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mybatis.caches.ehcache.EhcacheCache<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
     </li>
    </ol>
    <h3>
     <a id="_2204">
     </a>
     缓存的适用场景
    </h3>
    <table>
     <thead>
      <tr>
       <th align="left">
        <strong>
         场景
        </strong>
       </th>
       <th align="left">
        <strong>
         推荐缓存
        </strong>
       </th>
       <th align="left">
        <strong>
         说明
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td align="left">
        <strong>
         频繁读取，极少修改
        </strong>
       </td>
       <td align="left">
        二级缓存
       </td>
       <td align="left">
        如配置表、商品分类等静态数据。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         会话内重复查询
        </strong>
       </td>
       <td align="left">
        一级缓存
       </td>
       <td align="left">
        同一事务中多次查询相同数据。
       </td>
      </tr>
      <tr>
       <td align="left">
        <strong>
         实时性要求高
        </strong>
       </td>
       <td align="left">
        禁用缓存
       </td>
       <td align="left">
        如订单状态、库存数量等需实时获取的数据。
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_2214">
     </a>
     总结
    </h3>
    <ul>
     <li>
      <strong>
       一级缓存
      </strong>
      ：默认开启，会话级别，适合短周期、高重复查询。
     </li>
     <li>
      <strong>
       二级缓存
      </strong>
      ：需手动配置，全局共享，适合读多写少的静态数据。
     </li>
     <li>
      <strong>
       缓存选择
      </strong>
      ：根据业务场景权衡性能与数据一致性，必要时结合第三方缓存（如 Redis）提升扩展性。
     </li>
     <li>
      <strong>
       避坑指南
      </strong>
      ：注意事务提交、缓存刷新策略，避免脏读和内存溢出。
     </li>
    </ul>
    <p>
     通过合理配置 MyBatis 缓存，可显著减少数据库负载，但在高并发或分布式场景中，建议结合分布式缓存（如 Redis）替代默认的本地二级缓存。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34333938303534372f:61727469636c652f64657461696c732f313436323638393337" class_="artid" style="display:none">
 </p>
</div>


