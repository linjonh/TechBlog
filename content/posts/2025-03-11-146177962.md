---
layout: post
title: "1688崖山集群YAC安装备忘"
date: 2025-03-11 20:00:01 +0800
description: "使用UDEV进行绑定，此处与官网方法不同，实现目的是一样的-g-u-d重启udev查看结果。"
keywords: "【1688】崖山集群YAC安装备忘"
categories: ['未分类']
tags: ['数据库', '崖山Yashandb']
artid: "146177962"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146177962
    alt: "1688崖山集群YAC安装备忘"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146177962
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146177962
cover: https://bing.ee123.net/img/rand?artid=146177962
image: https://bing.ee123.net/img/rand?artid=146177962
img: https://bing.ee123.net/img/rand?artid=146177962
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【1688】崖山集群YAC安装备忘
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     环境准备
    </h2>
    <h3>
     <a id="_1">
     </a>
     主机资源
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/c11f7617f71c4f428aaa4795768633d8.png"/>
    </p>
    <h3>
     <a id="_3">
     </a>
     共享存储配置
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/70ac79e239da491fbf879b324e27d0ce.png"/>
    </p>
    <p>
     使用UDEV进行绑定，此处与官网方法不同，实现目的是一样的
    </p>
    <pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /proc/partitions <span class="token operator">|</span> <span class="token function">awk</span> <span class="token punctuation">{<!-- --></span><span class="token string">'print $4'</span><span class="token punctuation">}</span> <span class="token operator">|</span><span class="token function">grep</span> sd<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">"### <span class="token variable">$i</span>: <span class="token variable"><span class="token variable">`</span>/usr/lib/udev/scsi_id <span class="token parameter variable">-g</span> <span class="token parameter variable">-u</span> <span class="token parameter variable">-d</span>  /dev/$i<span class="token variable">`</span></span>"</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

<span class="token comment">### sdb: 36000c2911f7af4d6f8543a0a7409aa11</span>
<span class="token comment">### sdc: 36000c2906f67cf4c00b648db328aa6b7</span>
<span class="token comment">### sdd: 36000c29a675003793720a2a07b2a511d</span>
</code></pre>
    <pre><code class="prism language-bash"><span class="token function">vi</span> yashan-device-rule.rules
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"sd*"</span>, ENV<span class="token punctuation">{<!-- --></span>DEVTYPE<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"disk"</span>, <span class="token assign-left variable">SUBSYSTEM</span><span class="token operator">==</span><span class="token string">"block"</span>, <span class="token assign-left variable">PROGRAM</span><span class="token operator">==</span><span class="token string">"/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/<span class="token variable">$name</span>"</span>, <span class="token assign-left variable">RESULT</span><span class="token operator">==</span><span class="token string">"36000c2911f7af4d6f8543a0a7409aa11"</span>, <span class="token assign-left variable">SYMLINK</span><span class="token operator">+=</span><span class="token string">"yas/data"</span>, <span class="token assign-left variable">OWNER</span><span class="token operator">=</span><span class="token string">"yashan"</span>, <span class="token assign-left variable">GROUP</span><span class="token operator">=</span><span class="token string">"YASDBA"</span>, <span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token string">"0666"</span>, <span class="token assign-left variable">OPTIONS</span><span class="token operator">=</span><span class="token string">"nowatch"</span>
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"sd*"</span>, ENV<span class="token punctuation">{<!-- --></span>DEVTYPE<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"disk"</span>, <span class="token assign-left variable">SUBSYSTEM</span><span class="token operator">==</span><span class="token string">"block"</span>, <span class="token assign-left variable">PROGRAM</span><span class="token operator">==</span><span class="token string">"/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/<span class="token variable">$name</span>"</span>, <span class="token assign-left variable">RESULT</span><span class="token operator">==</span><span class="token string">"36000c2906f67cf4c00b648db328aa6b7"</span>, <span class="token assign-left variable">SYMLINK</span><span class="token operator">+=</span><span class="token string">"yas/vote"</span>, <span class="token assign-left variable">OWNER</span><span class="token operator">=</span><span class="token string">"yashan"</span>, <span class="token assign-left variable">GROUP</span><span class="token operator">=</span><span class="token string">"YASDBA"</span>, <span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token string">"0666"</span>, <span class="token assign-left variable">OPTIONS</span><span class="token operator">=</span><span class="token string">"nowatch"</span>
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"sd*"</span>, ENV<span class="token punctuation">{<!-- --></span>DEVTYPE<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"disk"</span>, <span class="token assign-left variable">SUBSYSTEM</span><span class="token operator">==</span><span class="token string">"block"</span>, <span class="token assign-left variable">PROGRAM</span><span class="token operator">==</span><span class="token string">"/usr/lib/udev/scsi_id --whitelisted --replace-whitespace --device=/dev/<span class="token variable">$name</span>"</span>, <span class="token assign-left variable">RESULT</span><span class="token operator">==</span><span class="token string">"36000c29a675003793720a2a07b2a511d"</span>, <span class="token assign-left variable">SYMLINK</span><span class="token operator">+=</span><span class="token string">"yas/ycr"</span>, <span class="token assign-left variable">OWNER</span><span class="token operator">=</span><span class="token string">"yashan"</span>, <span class="token assign-left variable">GROUP</span><span class="token operator">=</span><span class="token string">"YASDBA"</span>, <span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token string">"0666"</span>, <span class="token assign-left variable">OPTIONS</span><span class="token operator">=</span><span class="token string">"nowatch"</span>
</code></pre>
    <p>
     重启udev
    </p>
    <pre><code class="prism language-bash">/sbin/udevadm control --reload-rules 
/sbin/udevadm trigger <span class="token parameter variable">--type</span><span class="token operator">=</span>devices <span class="token parameter variable">--action</span><span class="token operator">=</span>change
</code></pre>
    <p>
     查看结果
    </p>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>root@yasdb1 ~<span class="token punctuation">]</span><span class="token comment"># ls -l /dev/yas/</span>
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">6</span> Mar <span class="token number">10</span> <span class="token number">11</span>:29 data -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/sdb
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">6</span> Mar <span class="token number">10</span> <span class="token number">11</span>:29 vote -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/sdc
lrwxrwxrwx <span class="token number">1</span> root root <span class="token number">6</span> Mar <span class="token number">10</span> <span class="token number">11</span>:29 ycr -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/sdd
</code></pre>
    <h3>
     <a id="_38">
     </a>
     依赖项配置
    </h3>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/44d2ba28213f434391c60fb9a9560031.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9a2e2a086af143099048b706738c0a63.png"/>
     </img>
    </p>
    <p>
     配置本地yum源进行包安装：
    </p>
    <pre><code class="prism language-bash"><span class="token function">vi</span> /etc/yum.repos.d/local_yum.repo 
<span class="token punctuation">[</span>local_yum<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>local
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///tmp/local_yum
<span class="token assign-left variable">enable</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>

yum clean all
</code></pre>
    <h3>
     <a id="_54">
     </a>
     操作系统参数
    </h3>
    <pre><code class="prism language-bash">root<span class="token comment"># ulimit -c unlimited </span>
root<span class="token comment"># vi /etc/security/limits.conf</span>
<span class="token comment">## 添加以下信息并保存：</span>
  - soft core unlimited
  - hard core unlimited


为保证重启后上述参数生效，执行以下命令：
<span class="token comment"># sysctl --system</span>
</code></pre>
    <h3>
     <a id="hostname_68">
     </a>
     设置主机名hostname
    </h3>
    <p>
     服务器名称要求如下：
     <br/>
     • 名称由字母、数字以及下划线组成，且必须以字母开头，长度为[4,64]个字符。
     <br/>
     • 同一个YashanDB共享集群中的服务器名称不能相同。
     <br/>
     • 建议每台服务器上只运行一个实例，若一台服务器需运行多个实例则要求将服务器名称设置为[3,63]个字符。
    </p>
    <p>
     一节点执行：
     <br/>
     #hostnamectl set-hostname yasdb1
    </p>
    <p>
     二节点执行：
     <br/>
     hostnamectl set-hostname yasdb2
    </p>
    <h3>
     <a id="_81">
     </a>
     关闭交换分区
    </h3>
    <p>
     使用sysctl -a | grep swappiness查看当前状态，建议设置为0以减少内存交换，避免影响系统性能。
    </p>
    <pre><code class="prism language-bash">root<span class="token comment">#sysctl -w vm.swappiness=0</span>
 <span class="token builtin class-name">echo</span> <span class="token string">"vm.swappiness=0"</span><span class="token operator">&gt;&gt;</span> /etc/sysctl.conf
</code></pre>
    <h3>
     <a id="_90">
     </a>
     调整自动分配本地端口范围
    </h3>
    <p>
     使用cat /proc/sys/net/ipv4/ip_local_port_range查看连接可用的本地端口范围，下限值建议大于30000以减少端口冲突。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># sysctl -w net.ipv4.ip_local_port_range='32768 60999' </span>
<span class="token comment"># echo "net.ipv4.ip_local_port_range=32768 60999" &gt;&gt; /etc/sysctl.conf</span>
</code></pre>
    <h3>
     <a id="VMA_99">
     </a>
     调整进程的VMA上限
    </h3>
    <p>
     使用sysctl -a|grep vm.max_map_count查看当前上限值，建议大于2000000以增大数据库进程可拥有的VMA大小。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># sysctl -w vm.max_map_count=2000000</span>
<span class="token comment"># echo "vm.max_map_count=2000000" &gt;&gt; /etc/sysctl.conf</span>
</code></pre>
    <h3>
     <a id="_108">
     </a>
     调整资源限制值
    </h3>
    <p>
     将部分资源限制值（使用ulimit -a可查看所有的资源限制值）调整为推荐值或以上。
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/778cdaa5ce864ff98b56b01800d4d26e.png"/>
    </p>
    <h3>
     <a id="_113">
     </a>
     配置大页内存
    </h3>
    <p>
     1.执行如下命令查看当前大页内存配置：（回显信息以实际为准）
    </p>
    <pre><code class="prism language-bash">$ <span class="token function">grep</span> <span class="token parameter variable">-i</span> huge /proc/meminfo
AnonHugePages:         <span class="token number">0</span> kB
HugePages_Total:       <span class="token number">0</span>
HugePages_Free:        <span class="token number">0</span>
HugePages_Rsvd:        <span class="token number">0</span>
HugePages_Surp:        <span class="token number">0</span>
Hugepagesize:       <span class="token number">2048</span> kB
</code></pre>
    <p>
     • AnonHugePages: 当前透明大页使用的内存总量，可参考本文档关闭。
     <br/>
     • HugePages_Total: 大页池中页面总数。
     <br/>
     • HugePages_Free: 大页池中空闲页面数。
     <br/>
     • HugePages_Rsvd: 系统预留(reserved)的页面数。表示应用已申请了对应数量的大页，但由于应用尚未访问这些页面，系统还没有真正从物理内存分配这些页面。应用最多还能申请HugePages_Free - HugePages_Rsvd个大页。
     <br/>
     • HugePages_Surp: 当开启nr_overcommit_hugepages时，系统允许换出一些大页，使得系统支持应用申请超出大页池容量的页面，如果应用频繁访问大页，可能对性能存在负面影响。
     <br/>
     • Hugepagesize: 大页的尺寸，不同平台支持的大页尺寸有差异，x86平台支持2M、1G，通常为2M。
    </p>
    <p>
     若HugePages_Total = 0、HugePages_Free = 0或HugePages_Free - HugePages_Rsvd &lt; YashanDB需求，则需修改系统配置，启用大页内存或增加大页内存池容量。
    </p>
    <ol start="2">
     <li>
      估算大页内存需求。首先估算YashanDB的大页内存需求：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/747fad3352834ad38a4987defa31c23f.png"/>
     </li>
    </ol>
    <p>
     • 根据配置计算YashanDB所需内存总量UserSize，即上述所有配置项的总和（未配置的项目按默认值计算）
     <br/>
     • 如需规划使用MMS表空间，还需估计MMS表空间所需内存总量MMSSize。
     <br/>
     YashanDB至少需要大页内存空间LargePageSize = (UserSize + MMSSize + 64M) * 1.2。
     <br/>
     YashanDB需要的大页内存页面数HugePages = Ceil(LargePageSize / Hugepagesize)。
     <br/>
     3． 启用大页内存并根据上述估算值更改相关配置：
     <br/>
     本文以大页尺寸 2M、申请16个大页（即规划32M大页内存）为例，生产环境配置请以实际为准。
     <br/>
     编辑/etc/sysctl.conf文件：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># vi /etc/sysctl.conf</span>
追加以下配置：
<span class="token assign-left variable">vm.nr_hugepages</span><span class="token operator">=</span><span class="token number">16</span>
<span class="token assign-left variable">vm.nr_overcommit_hugepages</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre>
    <ol start="3">
     <li>
      重启系统生效。
     </li>
    </ol>
    <pre><code class="prism language-bash"> <span class="token comment">#reboot</span>
</code></pre>
    <h3>
     <a id="_160">
     </a>
     关闭透明大页
    </h3>
    <ol>
     <li>
      部分操作系统默认开启了透明大页选项，可执行以下命令确认：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment">## Red Hat Enterprise Linux 内核</span>
<span class="token comment"># cat /sys/kernel/mm/redhat_transparent_hugepage/enabled</span>

<span class="token comment">## 其他内核</span>
<span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span>

</code></pre>
    <p>
     • 若显示[always] madvise never或always [madvise] never，则说明透明大页已开启。
     <br/>
     • 若显示always madvise [never]，则说明透明大页已关闭。
    </p>
    <ol start="2">
     <li>
      执行vi /etc/default/grub，在GRUB_CMDLINE_LINUX中添加或修改参数
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token assign-left variable">transparent_hugepage</span><span class="token operator">=</span>never。
   <span class="token assign-left variable">GRUB_TIMEOUT</span><span class="token operator">=</span><span class="token number">5</span>
   <span class="token assign-left variable">GRUB_DISTRIBUTOR</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">sed</span> <span class="token string">'s, release .*$,,g'</span> /etc/system-release<span class="token variable">)</span></span>"</span>
   <span class="token assign-left variable">GRUB_DEFAULT</span><span class="token operator">=</span>saved
   <span class="token assign-left variable">GRUB_DISABLE_SUBMENU</span><span class="token operator">=</span>true
   <span class="token assign-left variable">GRUB_TERMINAL_OUTPUT</span><span class="token operator">=</span><span class="token string">"console"</span>
   <span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">"crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet transparent_hugepage=never"</span>
   <span class="token assign-left variable">GRUB_DISABLE_RECOVERY</span><span class="token operator">=</span><span class="token string">"true"</span>
</code></pre>
    <ol start="3">
     <li>
      通过以下指令检查当前系统的引导类型：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment"># [ -d /sys/firmware/efi ] &amp;&amp; echo UEFI || echo BIOS</span>
两种引导的启动文件路径分别为：
•	BIOS：/boot/grub2/grub.cfg
•	UEFI：/boot/efi/EFI/<span class="token punctuation">\</span><span class="token operator">&lt;</span>distro_name<span class="token operator">&gt;</span>/grub.cfg，distro_name为系统发行版本名称，例如ubuntu、fedora、debian等。
</code></pre>
    <ol start="4">
     <li>
      执行grub2–mkconfig指令重新配置grub.cfg。
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment">## BIOS 引导</span>
<span class="token comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span>
<span class="token comment">## UEFI 引导</span>
<span class="token comment"># grub2-mkconfig -o /boot/efi/EFI/&lt;distro_name&gt;/grub.cfg</span>
</code></pre>
    <ol start="5">
     <li>
      重启操作系统，使配置永久生效。
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment"># reboot</span>
</code></pre>
    <ol start="6">
     <li>
      验证透明大页已关闭：
     </li>
    </ol>
    <pre><code class="prism language-bash"><span class="token comment">## Red Hat Enterprise Linux 内核</span>
<span class="token comment"># cat /sys/kernel/mm/redhat_transparent_hugepage/enabled</span>

<span class="token comment">## 其他内核</span>
<span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span>
</code></pre>
    <p>
     应显示always madvise [never]。
    </p>
    <h3>
     <a id="_228">
     </a>
     关闭防火墙
    </h3>
    <pre><code class="prism language-bash"><span class="token comment">## 关闭防火墙</span>
<span class="token comment"># systemctl stop firewalld </span>
<span class="token comment">## 关闭开机自启</span>
<span class="token comment"># systemctl disable firewalld</span>
</code></pre>
    <h3>
     <a id="ssh_237">
     </a>
     开启ssh服务
    </h3>
    <p>
     检查所有服务器上的SSH服务是否已打开：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># systemctl status sshd.service</span>

</code></pre>
    <p>
     如输出信息中无active (running)内容，请参照如下命令开启SSH服务：
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># systemctl start sshd.service</span>

</code></pre>
    <h3>
     <a id="_252">
     </a>
     清理环境
    </h3>
    <p>
     如部署YashanDB共享集群，还需在所有服务器上清理共享内存。
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># ipcrm -a</span>
</code></pre>
    <h3>
     <a id="_259">
     </a>
     创建安装用户
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># useradd -d /home/yashan -m yashan</span>
<span class="token comment"># passwd yashan</span>
</code></pre>
    <p>
     配置sudo免密
    </p>
    <pre><code class="prism language-bash"><span class="token comment">## 对root用户赋权并打开/etc/sudoers文件</span>
<span class="token comment"># cd /etc</span>
<span class="token comment"># ll sudoers</span>
-r--r----- <span class="token number">1</span> root root <span class="token number">4365</span> Oct <span class="token number">28</span> <span class="token number">19</span>:06 sudoers
<span class="token comment"># chmod +w sudoers</span>
<span class="token comment"># vi /etc/sudoers</span>

<span class="token comment">## 在文件的最后添加如下内容后保存退出</span>
<span class="token comment"># yashan  ALL=(ALL)	NOPASSWD:ALL</span>

按需恢复/etc/sudoers文件的属性。
<span class="token comment"># chmod -w sudoers</span>

<span class="token comment"># groupadd YASDBA</span>
<span class="token comment"># usermod -a -G YASDBA yashan</span>
</code></pre>
    <h3>
     <a id="_286">
     </a>
     目录划分
    </h3>
    <pre><code class="prism language-bash"><span class="token comment"># cd /</span>
<span class="token comment"># mkdir data</span>
<span class="token comment"># cd data</span>
<span class="token comment"># mkdir yashan</span>
<span class="token comment"># chown -R yashan:yashan /data/yashan</span>
</code></pre>
    <h3>
     <a id="SELinux_299">
     </a>
     SELinux
    </h3>
    <pre><code class="prism language-bash">修改/etc/selinux/config，禁用SELinux
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disabled
</code></pre>
    <h3>
     <a id="_306">
     </a>
     软件介质
    </h3>
    <p>
     安装前需准备以下安装介质，并放至目录 /home/yashan/install中。
     <br/>
     https://download.yashandb.com/download
    </p>
    <h3>
     <a id="1_309">
     </a>
     解压软件包（仅在节点1上执行）
    </h3>
    <p>
     以yashan用户进行解压操作
     <br/>
     $ cd /home/yashan/install
     <br/>
     $ tar zxf yashandb-23.2.9.100-linux-x86_64.tar.gz
    </p>
    <h2>
     <a id="_313">
     </a>
     安装方式一：命令行安装
    </h2>
    <h3>
     <a id="_314">
     </a>
     生成部署文件
    </h3>
    <pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span> /home/yashan/install

$ ./bin/yasboot package ce gen <span class="token parameter variable">--cluster</span> ljcdb <span class="token punctuation">\</span>
 <span class="token parameter variable">-u</span> yashan <span class="token parameter variable">-p</span> <span class="token number">123456</span> <span class="token parameter variable">--ip</span> <span class="token number">192.168</span>.1.151,192.168.1.152 <span class="token parameter variable">--port</span> <span class="token number">22</span> <span class="token punctuation">\</span>
 --install-path /data/yashan/yasdb_home <span class="token punctuation">\</span>
 --data-path /data/yashan/yasdb_data <span class="token punctuation">\</span>
 --log-path /data/yashan/log <span class="token punctuation">\</span>
 --begin-port <span class="token number">1688</span> <span class="token punctuation">\</span>
 <span class="token parameter variable">--node</span> <span class="token number">2</span> <span class="token punctuation">\</span>
 <span class="token parameter variable">--data</span> /dev/yas/data <span class="token punctuation">\</span>
 <span class="token parameter variable">--vote</span> /dev/yas/vote  <span class="token punctuation">\</span>
 <span class="token parameter variable">--ycr</span> /dev/yas/ycr
</code></pre>
    <p>
     如果报ssh验证失败，可能是上方标红密码不对，或.ssh/config文件权限不对，正确权限为600
    </p>
    <h3>
     <a id="_332">
     </a>
     执行安装
    </h3>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>yashan@yasdb1 install<span class="token punctuation">]</span>$ ./bin/yasboot package <span class="token function">install</span> <span class="token parameter variable">-t</span> hosts.toml
checking <span class="token function">install</span> profile.toml<span class="token punctuation">..</span>.
<span class="token function">install</span> version: yashandb <span class="token number">23.2</span>.9.101
host0001 <span class="token number">100</span>% <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span>    9s
host0002 <span class="token number">100</span>% <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span>    9s
update <span class="token function">host</span> to yasom<span class="token punctuation">..</span>.

</code></pre>
    <h3>
     <a id="_344">
     </a>
     部署数据库
    </h3>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>yashan@yasdb1 install<span class="token punctuation">]</span>$ ./bin/yasboot cluster deploy <span class="token parameter variable">-t</span> ljcdb.toml --yfs-force-create
+---------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> uuid             <span class="token operator">|</span> name               <span class="token operator">|</span> hostid <span class="token operator">|</span> index <span class="token operator">|</span> status  <span class="token operator">|</span> return_code <span class="token operator">|</span> progress <span class="token operator">|</span> cost <span class="token operator">|</span>
+---------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> task <span class="token operator">|</span> 24a1bf229418bb4e <span class="token operator">|</span> DeployYasdbCluster <span class="token operator">|</span> -      <span class="token operator">|</span> ljcdb <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token number">0</span>           <span class="token operator">|</span> <span class="token number">100</span>      <span class="token operator">|</span> <span class="token number">64</span>   <span class="token operator">|</span>
+------+------------------+--------------------+--------+-------+---------+-------------+----------+------+
task completed, status: SUCCESS
</code></pre>
    <h3>
     <a id="_356">
     </a>
     配置环境变量(两个节点操作)
    </h3>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>yashan@yasdb1 install<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /data/yashan/yasdb_home/23.2.9.101/conf/
<span class="token punctuation">[</span>yashan@yasdb1 conf<span class="token punctuation">]</span>$ <span class="token function">ls</span>
ljcdb.bashrc  profile.toml
<span class="token punctuation">[</span>yashan@yasdb1 conf<span class="token punctuation">]</span>$ <span class="token function">cat</span> ljcdb.bashrc <span class="token operator">&gt;&gt;</span> ~/.bashrc
<span class="token punctuation">[</span>yashan@yasdb1 conf<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> ~/.bashrc
</code></pre>
    <pre><code class="prism language-bash"><span class="token comment">#具体路径以实际值为准</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">YASCS_HOME</span><span class="token operator">=</span>/data/yashan/yasdb_data/ycs/ce-1-1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">YASDB_HOME</span><span class="token operator">=</span>/data/yashan/yasdb_home/23.2.9.101
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$YASDB_HOME</span>/bin:<span class="token environment constant">$PATH</span> 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">${YASDB_HOME}</span>/lib:<span class="token variable">$LD_LIBRARY_PATH</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">YASDB_DATA</span><span class="token operator">=</span>/data/yashan/yasdb_data/ce-1-1  
</code></pre>
    <h3>
     <a id="_378">
     </a>
     查看安装后的状态
    </h3>
    <pre><code class="prism language-bash"><span class="token punctuation">[</span>yashan@yasdb1 conf<span class="token punctuation">]</span>$ yasboot cluster password <span class="token builtin class-name">set</span> <span class="token parameter variable">-n</span> Aio_89.dy <span class="token parameter variable">-c</span> ljcdb        
+-------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> uuid             <span class="token operator">|</span> name             <span class="token operator">|</span> hostid <span class="token operator">|</span> index <span class="token operator">|</span> status  <span class="token operator">|</span> return_code <span class="token operator">|</span> progress <span class="token operator">|</span> cost <span class="token operator">|</span>
+-------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> task <span class="token operator">|</span> 720fcfed97acbe0a <span class="token operator">|</span> YasdbPasswordSet <span class="token operator">|</span> -      <span class="token operator">|</span> ljcdb <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token number">0</span>           <span class="token operator">|</span> <span class="token number">100</span>      <span class="token operator">|</span> <span class="token number">2</span>    <span class="token operator">|</span>
+------+------------------+------------------+--------+-------+---------+-------------+----------+------+
task completed, status: SUCCESS


<span class="token punctuation">[</span>yashan@yasdb1 conf<span class="token punctuation">]</span>$ yasboot cluster status <span class="token parameter variable">-c</span> ljcdb <span class="token parameter variable">-d</span>
+-------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> hostid   <span class="token operator">|</span> node_type <span class="token operator">|</span> nodeid <span class="token operator">|</span> pid   <span class="token operator">|</span> instance_status <span class="token operator">|</span> database_status <span class="token operator">|</span> database_role <span class="token operator">|</span> listen_address     <span class="token operator">|</span> data_path                      <span class="token operator">|</span>
+-------------------------------------------------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> host0001 <span class="token operator">|</span> ce        <span class="token operator">|</span> <span class="token number">1</span>-1:1  <span class="token operator">|</span> <span class="token number">28504</span> <span class="token operator">|</span> <span class="token function">open</span>            <span class="token operator">|</span> normal          <span class="token operator">|</span> primary       <span class="token operator">|</span> <span class="token number">192.168</span>.1.151:1688 <span class="token operator">|</span> /data/yashan/yasdb_data/ce-1-1 <span class="token operator">|</span>
+----------+-----------+--------+-------+-----------------+-----------------+---------------+--------------------+--------------------------------+
<span class="token operator">|</span> host0002 <span class="token operator">|</span> ce        <span class="token operator">|</span> <span class="token number">1</span>-2:2  <span class="token operator">|</span> <span class="token number">25758</span> <span class="token operator">|</span> <span class="token function">open</span>            <span class="token operator">|</span> normal          <span class="token operator">|</span> primary       <span class="token operator">|</span> <span class="token number">192.168</span>.1.152:1688 <span class="token operator">|</span> /data/yashan/yasdb_data/ce-1-2 <span class="token operator">|</span>
+----------+-----------+--------+-------+-----------------+-----------------+---------------+--------------------+--------------------------------+
<span class="token punctuation">[</span>yashan@yasdb1 conf<span class="token punctuation">]</span>$


<span class="token punctuation">[</span>yashan@yasdb1 ~<span class="token punctuation">]</span>$ yasql sys/Aio_89.dy
YashanDB SQL Enterprise Edition Release <span class="token number">23.2</span>.9.101 x86_64

Connected to:
YashanDB Server Enterprise Edition Release <span class="token number">23.2</span>.9.101 x86_64 – Linux

SQL<span class="token operator">&gt;</span> <span class="token keyword">select</span> inst_id,status,startup_time from gv<span class="token variable">$instance</span><span class="token punctuation">;</span>

    INST_ID STATUS        STARTUP_TIME                                                     
----------- ------------- ---------------------------------------------------------------- 
          <span class="token number">1</span> OPEN          <span class="token number">2025</span>-03-10 <span class="token number">15</span>:15:20.116283                                      
          <span class="token number">2</span> OPEN          <span class="token number">2025</span>-03-10 <span class="token number">15</span>:15:35.593741                                      

<span class="token number">2</span> rows fetched.

SQL<span class="token operator">&gt;</span> <span class="token keyword">select</span> inst_id,status,database_name from gv<span class="token variable">$database</span><span class="token punctuation">;</span>

    INST_ID STATUS                            DATABASE_NAME                                                    
----------- --------------------------------- ---------------------------------------------------------------- 
          <span class="token number">1</span> NORMAL                            ljcdb                                                           
          <span class="token number">2</span> NORMAL                            ljcdb                                                           

</code></pre>
    <h3>
     <a id="_425">
     </a>
     启动守护进程
    </h3>
    <pre><code class="prism language-bash">通过命令行方式安装的YashanDB默认不开启守护进程monit相关功能，如需开启monit功能，需参考本文完成以下操作。
$ <span class="token builtin class-name">cd</span> /home/yashan/install
$ ./bin/yasboot monit start –-cluster ljcdb

<span class="token punctuation">[</span>yashan@yasdb1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> install/
<span class="token punctuation">[</span>yashan@yasdb1 install<span class="token punctuation">]</span>$ ./bin/yasboot monit start <span class="token parameter variable">--cluster</span> ljcdb
+-------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> uuid             <span class="token operator">|</span> name             <span class="token operator">|</span> hostid <span class="token operator">|</span> index <span class="token operator">|</span> status  <span class="token operator">|</span> return_code <span class="token operator">|</span> progress <span class="token operator">|</span> cost <span class="token operator">|</span>
+-------------------------------------------------------------------------------------------------------+
<span class="token operator">|</span> task <span class="token operator">|</span> 22dea9ab6f3cc273 <span class="token operator">|</span> MonitParentStart <span class="token operator">|</span> -      <span class="token operator">|</span> ljcdb <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token number">0</span>           <span class="token operator">|</span> <span class="token number">100</span>      <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>
+------+------------------+------------------+--------+-------+---------+-------------+----------+------+
task completed, status: SUCCESS


$ yasboot cluster restart <span class="token parameter variable">-c</span> yashandb <span class="token parameter variable">-m</span> <span class="token function">mount</span>
 <span class="token builtin class-name">type</span> <span class="token operator">|</span> uuid             <span class="token operator">|</span> name                <span class="token operator">|</span> hostid <span class="token operator">|</span> index    <span class="token operator">|</span> status  <span class="token operator">|</span> return_code <span class="token operator">|</span> progress <span class="token operator">|</span> cost
-------------------------------------------------------------------------------------------------------------
 task <span class="token operator">|</span> 78d6449df62594b5 <span class="token operator">|</span> ReStartYasdbCluster <span class="token operator">|</span> -      <span class="token operator">|</span> yashandb <span class="token operator">|</span> SUCCESS <span class="token operator">|</span> <span class="token number">0</span>           <span class="token operator">|</span> <span class="token number">100</span>      <span class="token operator">|</span> <span class="token number">3</span>
------+------------------+---------------------+--------+----------+---------+-------------+----------+------
task completed, status: SUCCESS
</code></pre>
    <p>
     手动启动yasom和yasagent进程
    </p>
    <pre><code class="prism language-bash">$ yasboot process yasom start <span class="token parameter variable">-c</span> ljcdb
$ yasboot process yasagent start <span class="token parameter variable">-c</span> ljcdb


</code></pre>
    <p>
     待yasom和yasagent进程启动后，才能启动数据库
    </p>
    <pre><code class="prism language-bash">$ yasboot cluster start <span class="token parameter variable">-c</span> ljcdb
yasboot cluster start <span class="token parameter variable">-c</span> ljcdb  <span class="token comment">###两个节点一起启动</span>
ycsctl start ycs <span class="token comment">##只启动本节点</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031303636333535342f:61727469636c652f64657461696c732f313436313737393632" class_="artid" style="display:none">
 </p>
</div>


