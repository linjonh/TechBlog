---
layout: post
title: "MyBatis-如何解析-XML-配置文件和-SQL-映射文件"
date: 2025-03-14 11:15:42 +0800
description: "MyBatis 使用 SAX（Simple API for XML）解析器来解析 XML 文件，SAX 是一种基于事件驱动的 XML 解析方式，具有高效、低内存消耗的优点。MyBatis 的解析过程是其初始化过程中的关键步骤，理解解析过程有助于我们更好地理解 MyBatis 的工作原理，以及如何进行更高级的配置和定制。MyBatis 对 XML 配置文件的解析是其初始化过程中的关键步骤，它负责读取和解释 XML 文件中的配置信息，并将其转换为 MyBatis 内部使用的。负责解析 SQL 映射文件。"
keywords: "MyBatis 如何解析 XML 配置文件和 SQL 映射文件"
categories: ['源码系列', 'Mybatis', 'Java', '2025']
tags: ['Mybatis']
artid: "146101344"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146101344
    alt: "MyBatis-如何解析-XML-配置文件和-SQL-映射文件"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146101344
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146101344
cover: https://bing.ee123.net/img/rand?artid=146101344
image: https://bing.ee123.net/img/rand?artid=146101344
img: https://bing.ee123.net/img/rand?artid=146101344
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     MyBatis 如何解析 XML 配置文件和 SQL 映射文件
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     MyBatis 使用 SAX（Simple API for XML）解析器来解析 XML 文件，SAX 是一种基于事件驱动的 XML 解析方式，具有高效、低内存消耗的优点。
    </p>
    <p>
     MyBatis 主要解析两种类型的 XML 文件：
    </p>
    <ol>
     <li>
      <strong>
       核心配置文件 (mybatis-config.xml):
      </strong>
      定义 MyBatis 的全局配置信息，如数据源、事务管理器、类型别名、类型处理器、插件、映射器等。
     </li>
     <li>
      <strong>
       SQL 映射文件 (例如 UserMapper.xml):
      </strong>
      定义 SQL 语句和映射规则，将 SQL 语句与 Mapper 接口的方法关联起来。
     </li>
    </ol>
    <p>
     <strong>
      解析过程概述：
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        创建 XMLConfigBuilder (解析核心配置文件):
       </strong>
      </p>
      <ul>
       <li>
        <code>
         SqlSessionFactoryBuilder
        </code>
        的
        <code>
         build()
        </code>
        方法会创建一个
        <code>
         XMLConfigBuilder
        </code>
        对象，用于解析核心配置文件。
       </li>
       <li>
        <code>
         XMLConfigBuilder
        </code>
        内部会创建一个 SAX 解析器 (
        <code>
         XMLMapperEntityResolver
        </code>
        )。
       </li>
       <li>
        <code>
         XMLConfigBuilder
        </code>
        会解析核心配置文件中的各个元素（
        <code>
         &lt;properties&gt;
        </code>
        ,
        <code>
         &lt;settings&gt;
        </code>
        ,
        <code>
         &lt;typeAliases&gt;
        </code>
        ,
        <code>
         &lt;typeHandlers&gt;
        </code>
        ,
        <code>
         &lt;plugins&gt;
        </code>
        ,
        <code>
         &lt;environments&gt;
        </code>
        ,
        <code>
         &lt;mappers&gt;
        </code>
        等），并将解析结果存储到
        <code>
         Configuration
        </code>
        对象中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        创建 XMLMapperBuilder (解析 SQL 映射文件):
       </strong>
      </p>
      <ul>
       <li>
        在解析核心配置文件中的
        <code>
         &lt;mappers&gt;
        </code>
        元素时，
        <code>
         XMLConfigBuilder
        </code>
        会为每个 SQL 映射文件创建一个
        <code>
         XMLMapperBuilder
        </code>
        对象。
       </li>
       <li>
        <code>
         XMLMapperBuilder
        </code>
        内部也会创建一个 SAX 解析器。
       </li>
       <li>
        <code>
         XMLMapperBuilder
        </code>
        会解析 SQL 映射文件中的各个元素（
        <code>
         &lt;mapper&gt;
        </code>
        ,
        <code>
         &lt;select&gt;
        </code>
        ,
        <code>
         &lt;insert&gt;
        </code>
        ,
        <code>
         &lt;update&gt;
        </code>
        ,
        <code>
         &lt;delete&gt;
        </code>
        ,
        <code>
         &lt;resultMap&gt;
        </code>
        ,
        <code>
         &lt;sql&gt;
        </code>
        等），并将解析结果转换为
        <code>
         MappedStatement
        </code>
        对象，并添加到
        <code>
         Configuration
        </code>
        对象的
        <code>
         mappedStatements
        </code>
        集合中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        使用 XPath 解析 XML 元素:
       </strong>
      </p>
      <ul>
       <li>
        MyBatis 使用 XPath 表达式来定位和解析 XML 文件中的各个元素。
       </li>
       <li>
        <code>
         XMLConfigBuilder
        </code>
        和
        <code>
         XMLMapperBuilder
        </code>
        都使用
        <code>
         XPathParser
        </code>
        来解析 XPath 表达式。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     <strong>
      核心配置文件 (mybatis-config.xml) 解析过程 (XMLConfigBuilder):
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;properties&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        读取
        <code>
         &lt;properties&gt;
        </code>
        标签的
        <code>
         resource
        </code>
        或
        <code>
         url
        </code>
        属性，加载外部属性文件。
       </li>
       <li>
        解析
        <code>
         &lt;properties&gt;
        </code>
        标签内部的
        <code>
         &lt;property&gt;
        </code>
        子元素，获取属性名和属性值。
       </li>
       <li>
        将属性存储到
        <code>
         Configuration
        </code>
        对象的
        <code>
         variables
        </code>
        属性中（一个
        <code>
         Properties
        </code>
        对象）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;settings&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;settings&gt;
        </code>
        标签内部的
        <code>
         &lt;setting&gt;
        </code>
        子元素，获取设置名和设置值。
       </li>
       <li>
        将设置存储到
        <code>
         Configuration
        </code>
        对象的相应属性中（例如，
        <code>
         cacheEnabled
        </code>
        、
        <code>
         lazyLoadingEnabled
        </code>
        等）。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;typeAliases&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;typeAliases&gt;
        </code>
        标签内部的
        <code>
         &lt;typeAlias&gt;
        </code>
        子元素，获取别名和对应的 Java 类型。
       </li>
       <li>
        解析
        <code>
         &lt;typeAliases&gt;
        </code>
        标签内部的
        <code>
         &lt;package&gt;
        </code>
        子元素，扫描指定包下的所有类，并自动生成别名（类名首字母小写）。
       </li>
       <li>
        将别名和类型注册到
        <code>
         Configuration
        </code>
        对象的
        <code>
         typeAliasRegistry
        </code>
        中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;typeHandlers&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;typeHandlers&gt;
        </code>
        标签内部的
        <code>
         &lt;typeHandler&gt;
        </code>
        子元素，获取类型处理器类名（或实例）。
       </li>
       <li>
        解析
        <code>
         &lt;typeHandlers&gt;
        </code>
        标签内部的
        <code>
         &lt;package&gt;
        </code>
        子元素，扫描指定包下的所有类型处理器类。
       </li>
       <li>
        将类型处理器注册到
        <code>
         Configuration
        </code>
        对象的
        <code>
         typeHandlerRegistry
        </code>
        中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;objectFactory&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;objectFactory&gt;
        </code>
        的
        <code>
         type
        </code>
        属性，获取对象工厂实现类。
       </li>
       <li>
        反射创建其实例,并设置到
        <code>
         Configuration
        </code>
        对象。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;plugins&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;plugins&gt;
        </code>
        标签内部的
        <code>
         &lt;plugin&gt;
        </code>
        子元素，获取插件类的全限定名。
       </li>
       <li>
        创建插件实例，并将插件添加到
        <code>
         Configuration
        </code>
        对象的
        <code>
         interceptorChain
        </code>
        中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;environments&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;environments&gt;
        </code>
        标签的
        <code>
         default
        </code>
        属性，获取默认的环境 ID。
       </li>
       <li>
        解析
        <code>
         &lt;environments&gt;
        </code>
        标签内部的
        <code>
         &lt;environment&gt;
        </code>
        子元素，获取环境 ID、事务管理器配置和数据源配置。
       </li>
       <li>
        根据配置创建
        <code>
         TransactionFactory
        </code>
        和
        <code>
         DataSourceFactory
        </code>
        ，并创建相应的
        <code>
         Transaction
        </code>
        和
        <code>
         DataSource
        </code>
        实例。
       </li>
       <li>
        将环境配置存储到
        <code>
         Configuration
        </code>
        对象的
        <code>
         environment
        </code>
        属性中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;databaseIdProvider&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;databaseIdProvider&gt;
        </code>
        的
        <code>
         type
        </code>
        属性，获取数据库厂商标识提供类。
       </li>
       <li>
        解析其内部
        <code>
         &lt;property&gt;
        </code>
        子元素，获取不同数据库对应的标识。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;mappers&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;mappers&gt;
        </code>
        标签内部的
        <code>
         &lt;mapper&gt;
        </code>
        子元素，获取 SQL 映射文件的路径（
        <code>
         resource
        </code>
        、
        <code>
         url
        </code>
        或
        <code>
         class
        </code>
        属性）。
       </li>
       <li>
        解析
        <code>
         &lt;mappers&gt;
        </code>
        标签内部的
        <code>
         &lt;package&gt;
        </code>
        子元素，扫描指定包下的所有 Mapper 接口或 XML 映射文件。
       </li>
       <li>
        对于每个 SQL 映射文件，创建一个
        <code>
         XMLMapperBuilder
        </code>
        对象，并调用其
        <code>
         parse()
        </code>
        方法解析 SQL 映射文件。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     <strong>
      SQL 映射文件 (例如 UserMapper.xml) 解析过程 (XMLMapperBuilder):
     </strong>
    </p>
    <ol>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;mapper&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        获取
        <code>
         &lt;mapper&gt;
        </code>
        标签的
        <code>
         namespace
        </code>
        属性，作为 Mapper 接口的全限定名。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;cache&gt;
        </code>
        元素（如果有）:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;cache&gt;
        </code>
        标签，获取缓存配置信息，创建
        <code>
         Cache
        </code>
        对象。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;parameterMap&gt;
        </code>
        元素（已废弃，不建议使用）:
       </strong>
      </p>
     </li>
    </ol>
    <ul>
     <li>
      解析
      <code>
       &lt;parameterMap&gt;
      </code>
      标签及其子元素，获取参数映射信息。
     </li>
    </ul>
    <ol start="4">
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;resultMap&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;resultMap&gt;
        </code>
        标签及其子元素（
        <code>
         &lt;id&gt;
        </code>
        ,
        <code>
         &lt;result&gt;
        </code>
        ,
        <code>
         &lt;association&gt;
        </code>
        ,
        <code>
         &lt;collection&gt;
        </code>
        ,
        <code>
         &lt;discriminator&gt;
        </code>
        ），获取结果映射规则。
       </li>
       <li>
        创建
        <code>
         ResultMap
        </code>
        对象，并添加到
        <code>
         Configuration
        </code>
        对象的
        <code>
         resultMaps
        </code>
        集合中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;sql&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析
        <code>
         &lt;sql&gt;
        </code>
        标签，获取可重用的 SQL 片段。
       </li>
       <li>
        将 SQL 片段存储到
        <code>
         Configuration
        </code>
        对象的
        <code>
         sqlFragments
        </code>
        集合中。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        解析
        <code>
         &lt;select&gt;
        </code>
        ,
        <code>
         &lt;insert&gt;
        </code>
        ,
        <code>
         &lt;update&gt;
        </code>
        ,
        <code>
         &lt;delete&gt;
        </code>
        元素:
       </strong>
      </p>
      <ul>
       <li>
        解析这些标签的属性（
        <code>
         id
        </code>
        ,
        <code>
         parameterType
        </code>
        ,
        <code>
         resultType
        </code>
        ,
        <code>
         resultMap
        </code>
        ,
        <code>
         statementType
        </code>
        ,
        <code>
         flushCache
        </code>
        ,
        <code>
         useCache
        </code>
        ,
        <code>
         timeout
        </code>
        等）。
       </li>
       <li>
        解析 SQL 语句内容，处理占位符（
        <code>
         #{}
        </code>
        和
        <code>
         ${}
        </code>
        ）。
       </li>
       <li>
        创建
        <code>
         MappedStatement
        </code>
        对象，并将 SQL 语句、参数类型、结果类型、SQL 类型（
        <code>
         SELECT
        </code>
        ,
        <code>
         INSERT
        </code>
        ,
        <code>
         UPDATE
        </code>
        ,
        <code>
         DELETE
        </code>
        ）等信息存储到
        <code>
         MappedStatement
        </code>
        对象中。
       </li>
       <li>
        将
        <code>
         MappedStatement
        </code>
        对象添加到
        <code>
         Configuration
        </code>
        对象的
        <code>
         mappedStatements
        </code>
        集合中。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     <strong>
      关键类:
     </strong>
    </p>
    <ul>
     <li>
      <strong>
       <code>
        XMLConfigBuilder
       </code>
       :
      </strong>
      负责解析核心配置文件。
     </li>
     <li>
      <strong>
       <code>
        XMLMapperBuilder
       </code>
       :
      </strong>
      负责解析 SQL 映射文件。
     </li>
     <li>
      <strong>
       <code>
        XPathParser
       </code>
       :
      </strong>
      用于解析 XPath 表达式。
     </li>
     <li>
      <strong>
       <code>
        Configuration
       </code>
       :
      </strong>
      保存 MyBatis 的全局配置信息，以及解析后的
      <code>
       MappedStatement
      </code>
      、
      <code>
       ResultMap
      </code>
      等对象。
     </li>
     <li>
      <strong>
       <code>
        MappedStatement
       </code>
       :
      </strong>
      代表一个 SQL 语句，包含了 SQL 语句的 ID、参数类型、结果类型、SQL 语句内容等信息。
     </li>
     <li>
      <strong>
       <code>
        ResultMap
       </code>
       :
      </strong>
      代表一个结果映射规则，定义了如何将查询结果集映射为 Java 对象。
     </li>
    </ul>
    <p>
     <strong>
      总结:
     </strong>
    </p>
    <p>
     MyBatis 使用 SAX 解析器和 XPath 表达式来解析 XML 配置文件。
     <code>
      XMLConfigBuilder
     </code>
     负责解析核心配置文件，
     <code>
      XMLMapperBuilder
     </code>
     负责解析 SQL 映射文件。解析后的配置信息存储在
     <code>
      Configuration
     </code>
     对象中，
     <code>
      MappedStatement
     </code>
     对象代表 SQL 语句，
     <code>
      ResultMap
     </code>
     对象代表结果映射规则。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f6e6d736f66746b6c622f:61727469636c652f64657461696c732f313436313031333434" class_="artid" style="display:none">
 </p>
</div>


