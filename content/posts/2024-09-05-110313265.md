---
layout: post
title: "单元测试从0到1学习gtestCLion"
date: 2024-09-05 10:07:05 +0800
description: "gtest是一个跨平台的(Liunx、Mac OS X、Windows、Cygwin、Windows"
keywords: "clion c++ 单元测试"
categories: ['C']
tags: ['无标签']
artid: "110313265"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=110313265
    alt: "单元测试从0到1学习gtestCLion"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=110313265
featuredImagePreview: https://bing.ee123.net/img/rand?artid=110313265
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     单元测试：从0到1学习gtest(CLion)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <ul>
      <li>
       gtest是一个跨平台的(Liunx、Mac OS X、Windows、Cygwin、Windows CE and Symbian)C++单元测试框架，由google公司发布。gtest是为在不同平台上为编写C++测试而生成的。它提供了丰富的断言、致命和非致命判断、参数化、”死亡测试”等等。
      </li>
      <li>
       单元测试(Unit Test)是对软件基本组成单元(如函数或是一个类的方法)进行的测试，是开发者编写的一小段代码，用于检验被测试代码一个很小的、很明确的功能是否正确。
      </li>
      <li>
       在gtest中，一个测试用例(test case)可以包含一个或多个测试。一个测试程序可以包含多个测试用例
      </li>
     </ul>
    </blockquote>
    <h2>
     <a id="_4">
     </a>
     理论
    </h2>
    <h3>
     <a id="_5">
     </a>
     定义测试函数
    </h3>
    <p>
     应用 googletest 编写单元测试时，使用 TEST() 宏来声明测试函数：
    </p>
    <pre><code class="prism language-c"><span class="token function">TEST</span><span class="token punctuation">(</span>GlobalConfigurationTest<span class="token punctuation">,</span> configurationDataTest<span class="token punctuation">)</span> 

</code></pre>
    <h3>
     <a id="_11">
     </a>
     断言
    </h3>
    <p>
     gtest中断言的宏可以分为两类：一类是ASSERT宏，另一类就是EXPECT宏了。
     <br/>
     1、ASSERT_系列：如果当前点检测失败则退出当前函数
     <br/>
     2、EXPECT_系列：如果当前点检测失败则继续往下执行
     <br/>
     如果你对自动输出的错误信息不满意的话，也是可以通过operator&lt;&lt;能够在失败的时候打印日志，将一些自定义的信息输出。
     <br/>
     ASSERT_系列：
    </p>
    <h4>
     <a id="_18">
     </a>
     基础断言
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/685527d9e89ea33b805029308bf9d423.png"/>
    </p>
    <h4>
     <a id="_20">
     </a>
     二进制比较断言
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4dbd7ee5aa82a19f83ee6f9b0f76ed8b.png"/>
    </p>
    <h4>
     <a id="_22">
     </a>
     字符串对比断言
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5584d1ffefc2955384e48878190d60a8.png"/>
    </p>
    <h4>
     <a id="_24">
     </a>
     浮点对比断言
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6805dff29c5c28905efaefb9380b82ac.png"/>
    </p>
    <p>
     almost euqal表示两个数只是近似相似，默认的是是指两者的差值在4ULP之内（Units in the Last Place）。我们还可以自己制定精度
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bc3ef83930728727aff2762e633e208d.png">
      <br/>
      使用方法是：
     </img>
    </p>
    <pre><code class="prism language-cpp">  <span class="token function">ASSERT_NEAR</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.1f</span><span class="token punctuation">,</span> <span class="token number">0.2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ASSERT_NEAR</span><span class="token punctuation">(</span><span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="_35">
     </a>
     成功失败断言
    </h4>
    <p>
     该类断言用于直接标记是否成功或者失败。可以使用SUCCEED()宏标记成功，使用FAIL()宏标记致命错误（同ASSERT_
     <em>
      )，ADD_FAILURE()宏标记非致命错误（同EXPECT_
     </em>
     ）。举个例子
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>Check<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">SUCCEED</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">FAIL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_46">
     </a>
     异常断言
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e397c8cdcc7f05ea853e8404a5cb9eef.png"/>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">ThrowException</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
        <span class="token keyword">throw</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        <span class="token keyword">throw</span> <span class="token string">"const char*"</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        <span class="token keyword">throw</span> <span class="token number">1.1f</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token function">TEST</span><span class="token punctuation">(</span>ThrowException<span class="token punctuation">,</span> Check<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">EXPECT_THROW</span><span class="token punctuation">(</span><span class="token function">ThrowException</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_THROW</span><span class="token punctuation">(</span><span class="token function">ThrowException</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_ANY_THROW</span><span class="token punctuation">(</span><span class="token function">ThrowException</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">ASSERT_NO_THROW</span><span class="token punctuation">(</span><span class="token function">ThrowException</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <a href="https://blog.csdn.net/breaksoftware/article/details/51059406">
      参见
     </a>
    </p>
    <h3>
     <a id="_74">
     </a>
     事件机制
    </h3>
    <p>
     gtest提供了多种事件机制，非常方便我们在案例之前或之后做一些操作。总结一下gtest的事件一共有3种：
    </p>
    <ol>
     <li>
      全局的，所有案例执行前后。
     </li>
     <li>
      TestSuite级别的，在某一批案例中第一个案例前，最后一个案例执行后。
     </li>
     <li>
      TestCase级别的，每个TestCase前后。
     </li>
    </ol>
    <h4>
     <a id="_81">
     </a>
     全局事件
    </h4>
    <p>
     要实现全局事件，必须写一个类，继承testing::Environment类，实现里面的SetUp和TearDown方法。
    </p>
    <ol>
     <li>
      <p>
       SetUp()方法在所有案例执行前执行
      </p>
     </li>
     <li>
      <p>
       TearDown()方法在所有案例执行后执行
      </p>
     </li>
    </ol>
    <p>
     还需要告诉gtest添加这个全局事件，我们需要在main函数中通过testing::AddGlobalTestEnvironment方法将事件挂进来，也就是说，我们可以写很多个这样的类，然后将他们的事件都挂上去。
    </p>
    <h2>
     <a id="_90">
     </a>
     实践
    </h2>
    <h3>
     <a id="_92">
     </a>
     入门
    </h3>
    <blockquote>
     <p>
      环境linux
     </p>
    </blockquote>
    <ol>
     <li>
      下载gtest源码
      <br/>
      加入工程中：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c49f79e4541ea0e2d0e0ecebb097a667.png"/>
     </li>
    </ol>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/622d5c37cd71140848a21e816ec1a18a.png">
      <br/>
      2. 编写CMakeList.txt 文件
     </img>
    </p>
    <pre><code>cmake_minimum_required(VERSION 3.16)

project(TestAdd2)
set(CMAKE_CXX_STANDARD 11)


include_directories(
        ${CMAKE_CURRENT_SOURCE_DIR}/include
        ${CMAKE_CURRENT_SOURCE_DIR}/googletest/include
)
link_directories(
        ${CMAKE_CURRENT_SOURCE_DIR}/src
        ${CMAKE_CURRENT_SOURCE_DIR}/googletest
)


# 添加下级目录，生成.a文件
add_subdirectory( ./googletest)

aux_source_directory(./src SRC_LIST)
set(SOUCE_FLIES main.cpp )
add_executable(${PROJECT_NAME} ${SOUCE_FLIES} ${SRC_LIST})


set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/bin")

target_link_libraries(${PROJECT_NAME} gtest)
</code></pre>
    <ol start="3">
     <li>
      编写代码
      <br/>
      add.h
     </li>
    </ol>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> TESTADD2_ADD_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> TESTADD2_ADD_H</span>

<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">//TESTADD2_ADD_H</span>

</code></pre>
    <p>
     add.cpp
    </p>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"../include/add.h"</span></span>

<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> n1<span class="token operator">+</span>n2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <p>
     main.c
    </p>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"add.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>


<span class="token function">TEST</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">,</span>test1 <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">,</span>test2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">,</span>test3<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 是否相等eque</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    testing<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// //将命令行参数传递给gtest</span>
    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// //RUN_ALL_TESTS()运行所有测试案例</span>
<span class="token punctuation">}</span>


</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/283fff2b820cdb4eec58ebd41efd2386.png"/>
    </p>
    <p>
     另外：你会发现即使没有mian函数，每个test都可以单独运行。 比如对于
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1e96736cf467abd8a3ec153a7fd75877.png"/>
     <br/>
     你可以直接执行它（
     <code>
      ASSERT_EQ断言两个数相等
     </code>
     ）
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/7cc5d16b3e494d0327951d0190530463.png"/>
    </p>
    <p>
     上面是表示通过了。如果你想故意不通过的话，比如改变测试用例
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/682f1f4e2308f4e7f066ef037f772c80.png"/>
    </p>
    <p>
     你会发现输出如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/4e7173fc733dcbb702ab53e3f6b59087.png"/>
     <br/>
     如果你对自动输出的出错信息不满意的话，你还可以通过操作符&lt;&lt;将一些自定义的信息输出，通常，这对于调试或是对一些检查点的补充说明来说，非常有用！
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/5c33bd3cda6d18dc8d3decd446f1fcc5.png"/>
     <br/>
     执行如下：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/e54d74399c06193dc6fe7be2175ff8b2.png"/>
    </p>
    <h3>
     <a id="_203">
     </a>
     测试字符串
    </h3>
    <pre><code class="prism language-c"><span class="token function">TEST</span><span class="token punctuation">(</span>StringCmpTest<span class="token punctuation">,</span> Demo<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span><span class="token operator">*</span> pszCoderZh <span class="token operator">=</span> <span class="token string">"CoderZh"</span><span class="token punctuation">;</span>
    wchar_t<span class="token operator">*</span> wszCoderZh <span class="token operator">=</span> L<span class="token string">"CoderZh"</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>string strCoderZh <span class="token operator">=</span> <span class="token string">"CoderZh"</span><span class="token punctuation">;</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>wstring wstrCoderZh <span class="token operator">=</span> L<span class="token string">"CoderZh"</span><span class="token punctuation">;</span>

    <span class="token function">EXPECT_STREQ</span><span class="token punctuation">(</span><span class="token string">"CoderZh"</span><span class="token punctuation">,</span> pszCoderZh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_STREQ</span><span class="token punctuation">(</span>L<span class="token string">"CoderZh"</span><span class="token punctuation">,</span> wszCoderZh<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">EXPECT_STRNE</span><span class="token punctuation">(</span><span class="token string">"CnBlogs"</span><span class="token punctuation">,</span> pszCoderZh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_STRNE</span><span class="token punctuation">(</span>L<span class="token string">"CnBlogs"</span><span class="token punctuation">,</span> wszCoderZh<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">EXPECT_STRCASEEQ</span><span class="token punctuation">(</span><span class="token string">"coderzh"</span><span class="token punctuation">,</span> pszCoderZh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//EXPECT_STRCASEEQ(L"coderzh", wszCoderZh);    不支持</span>

    <span class="token function">EXPECT_STREQ</span><span class="token punctuation">(</span><span class="token string">"CoderZh"</span><span class="token punctuation">,</span> strCoderZh<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_STREQ</span><span class="token punctuation">(</span>L<span class="token string">"CoderZh"</span><span class="token punctuation">,</span> wstrCoderZh<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_227">
     </a>
     全局事件
    </h3>
    <ol>
     <li>
      main函数中
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">FooEnvironment</span><span class="token operator">:</span> <span class="token keyword">public</span> testing<span class="token operator">::</span>Environment<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Foo FooEnvironment SetUP"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">TearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Foo FooEnvironment TearDown"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>StringCmpTest<span class="token punctuation">,</span> Demo<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">// 必须由一个testUnit才会执行事件</span>
    
<span class="token punctuation">}</span>
GTEST_API_ <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Running main() from %s\n"</span><span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    testing<span class="token operator">::</span><span class="token function">AddGlobalTestEnvironment</span><span class="token punctuation">(</span><span class="token keyword">new</span> FooEnvironment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    testing<span class="token operator">::</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f6755a9703b6fee408cdbcfe3cd1e932.png"/>
    </p>
    <h3>
     <a id="_259">
     </a>
     测试普通函数
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8ce08f002f13bb96d1d67433cf5bcd21.png"/>
     <br/>
     CMakeLists.txt同上
    </p>
    <ol>
     <li>
      第1步：编写代码
     </li>
    </ol>
    <p>
     sample1.h
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> GTEST_SAMPLES_SAMPLE1_H_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> GTEST_SAMPLES_SAMPLE1_H_</span>

<span class="token comment">// Returns n! (the factorial of n).  For negative n, n! is defined to be 1.</span>
<span class="token keyword">int</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Returns true if and only if n is a prime number.</span>
<span class="token keyword">bool</span> <span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span>  </span><span class="token comment">// GTEST_SAMPLES_SAMPLE1_H_</span>

</code></pre>
    <p>
     sample1.cc
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample1.h"</span></span>

<span class="token comment">// Returns n! (the factorial of n).  For negative n, n! is defined to be 1.</span>
<span class="token keyword">int</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    result <span class="token operator">*</span><span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Returns true if and only if n is a prime number.</span>
<span class="token keyword">bool</span> <span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// Trivial case 1: small numbers</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// Trivial case 2: even numbers</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token comment">// Now, we have that n is odd and n &gt;= 3.</span>

  <span class="token comment">// Try to divide n by every odd number i, starting from 3</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// We only have to try i up to the square root of n</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> n<span class="token operator">/</span>i<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token comment">// Now, we have i &lt;= n/i &lt; n.</span>
    <span class="token comment">// If n is divisible by i, n is not prime.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// n has no integer factor in the range (1, n), and thus is prime.</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <ol start="2">
     <li>
      第2步：编写测试用例
      <br/>
      sample1_unittest.cc
     </li>
    </ol>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;limits.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample1.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
namespace <span class="token punctuation">{<!-- --></span>

<span class="token function">TEST</span><span class="token punctuation">(</span>FactorialTest<span class="token punctuation">,</span> Negative<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// This test is named "Negative", and belongs to the "FactorialTest"</span>
  <span class="token comment">// test case.</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//equal才返回true</span>
  <span class="token function">EXPECT_GT</span><span class="token punctuation">(</span><span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 大于才返回true</span>

<span class="token punctuation">}</span>

<span class="token comment">// Tests factorial of 0.</span>
<span class="token function">TEST</span><span class="token punctuation">(</span>FactorialTest<span class="token punctuation">,</span> Zero<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Tests factorial of positive numbers.</span>
<span class="token function">TEST</span><span class="token punctuation">(</span>FactorialTest<span class="token punctuation">,</span> Positive<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">40320</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// -------------------------------------------------------------</span>

<span class="token comment">// Tests negative input.</span>
<span class="token function">TEST</span><span class="token punctuation">(</span>IsPrimeTest<span class="token punctuation">,</span> Negative<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// This test belongs to the IsPrimeTest test case.</span>

  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//期待结果是false</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//期待结果是false</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span>INT_MIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//期待结果是false</span>
<span class="token punctuation">}</span>

<span class="token comment">// Tests some trivial cases.</span>
<span class="token function">TEST</span><span class="token punctuation">(</span>IsPrimeTest<span class="token punctuation">,</span> Trivial<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 期待结果是false</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//期待结果是false</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 期待结果是true</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 期待结果是true</span>
<span class="token punctuation">}</span>

<span class="token comment">// Tests positive input.</span>
<span class="token function">TEST</span><span class="token punctuation">(</span>IsPrimeTest<span class="token punctuation">,</span> Positive<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//期待结果是false</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 期待结果是true</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//期待结果是false</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 期待结果是true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>  <span class="token comment">// namespace</span>


</code></pre>
    <ol start="3">
     <li>
      第3步：在main（）中调用RUN_ALL_TESTS（）
     </li>
    </ol>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
GTEST_API_ <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Running main() from %s\n"</span><span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    testing<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3_395">
     </a>
     第3个例子：类具有多个成员函数
    </h3>
    <p>
     项目结构与第一个例子相同
    </p>
    <p>
     除了编写代码部分和编写测试用例部分
    </p>
    <h4>
     <a id="demo1_402">
     </a>
     demo1
    </h4>
    <ol>
     <li>
      第1步：编写代码
     </li>
    </ol>
    <p>
     sample1.h
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>

<span class="token keyword">class</span> <span class="token class-name">Counter</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> counter_<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">counter_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     sample1.cc
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample1.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstdio&gt;</span></span>

<span class="token keyword">int</span> Counter<span class="token operator">::</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> counter_<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> Counter<span class="token operator">::</span><span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>counter_ <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> counter_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span>  <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> counter_<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Counter<span class="token operator">::</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> counter_<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <ol start="2">
     <li>
      编写测试用例
     </li>
    </ol>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample1.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
namespace <span class="token punctuation">{<!-- --></span>
   <span class="token function">TEST</span><span class="token punctuation">(</span>Connter<span class="token punctuation">,</span> Increment<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       Counter c<span class="token punctuation">;</span>

       <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="demo2_462">
     </a>
     demo2
    </h4>
    <ol>
     <li>
      第1步：编写代码
     </li>
    </ol>
    <p>
     sample2.h
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> GTEST_SAMPLES_SAMPLE1_H_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> GTEST_SAMPLES_SAMPLE1_H_</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token keyword">class</span> <span class="token class-name">MyString</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> c_string_<span class="token punctuation">;</span>
    <span class="token keyword">const</span> MyString<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyString <span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//------------------------------------------------------</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">CloneCString</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> a_c_string<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//-------------------------------------</span>
    <span class="token comment">//  The default c'tor constructs a NULL string.</span>
    <span class="token function">MyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">c_string_</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token comment">// Constructs a MyString by cloning a 0-terminated C string.</span>
    <span class="token keyword">explicit</span> <span class="token function">MyString</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> a_c_string<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_string_</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">Set</span><span class="token punctuation">(</span>a_c_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
   <span class="token comment">// Copy c'tor</span>
    <span class="token function">MyString</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyString<span class="token operator">&amp;</span> string<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_string_</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">Set</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span>c_string_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//--------------------------------------</span>
    <span class="token comment">//  D'tor.  MyString is intended to be a final class, so the d'tor doesn't need to be virtual.</span>
    <span class="token operator">~</span><span class="token function">MyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> c_string_<span class="token punctuation">;</span><span class="token punctuation">}</span>

    <span class="token comment">//--------------------------------------</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">return</span> c_string_<span class="token punctuation">;</span><span class="token punctuation">}</span>

    size_t <span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> c_string_ <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">strlen</span><span class="token punctuation">(</span>c_string_<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">void</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>a_c_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre>
    <p>
     sample2.cpp
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample2.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>


<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> MyString<span class="token operator">::</span><span class="token function">CloneCString</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> a_c_string<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a_c_string <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">const</span> size_t  len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>a_c_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span> <span class="token punctuation">[</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>clone<span class="token punctuation">,</span> a_c_string<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> MyString<span class="token operator">::</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> a_c_string<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token comment">//  Makes sure this works when c_string == c_string_</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> temp <span class="token operator">=</span> MyString<span class="token operator">::</span><span class="token function">CloneCString</span><span class="token punctuation">(</span>a_c_string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c_string_<span class="token punctuation">;</span>
    c_string_ <span class="token operator">=</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre>
    <ol start="2">
     <li>
      编写测试用例
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample2.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
<span class="token keyword">namespace</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">TEST</span><span class="token punctuation">(</span>MyString<span class="token punctuation">,</span> DefaultConstructor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> MyString s<span class="token punctuation">;</span>
        <span class="token function">EXPECT_STREQ</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 两个C风格的字符串相等才正确返回</span>

        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token keyword">char</span> kHelloString<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Hello, world!"</span><span class="token punctuation">;</span>
    <span class="token function">TEST</span><span class="token punctuation">(</span>MyString<span class="token punctuation">,</span> ConstructorFromCString<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> MyString <span class="token function">s</span><span class="token punctuation">(</span>kHelloString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> kHelloString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>kHelloString<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>kHelloString<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span><span class="token function">Length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">TEST</span><span class="token punctuation">(</span>MyString<span class="token punctuation">,</span> CopyConstructor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> MyString <span class="token function">s1</span><span class="token punctuation">(</span>kHelloString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> MyString s2 <span class="token operator">=</span> s1<span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> kHelloString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token function">TEST</span><span class="token punctuation">(</span>MyString<span class="token punctuation">,</span> Set<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        MyString s<span class="token punctuation">;</span>

        s<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>kHelloString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> kHelloString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 当输入指针与MyString对象中已有的指针相同时，Set应该可以工作: 分配一个新的内存来存放它</span>
        s<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> kHelloString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 可以设置为null</span>
        s<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_STREQ</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">c_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//两个C风格的字符串相等才正确返回</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="3_Fixtures_581">
     </a>
     第3个例子: Fixtures（预处理）
    </h3>
    <blockquote>
     <p>
      Fixtures 是测试中非常重要的一部分。他们的主要目的是建立一个固定/已知的环境状态以确保 测试可重复并且按照预期方式运行
     </p>
    </blockquote>
    <p>
     我们在单元测试之前会做一些变量初始化等工作，而同一个testcase的不同test之间往往会有一些初始化工作是相同的
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/0d69207cfc693ef68bc8a9d3e7b52446.png"/>
     <br/>
     我们不想做多余的重复的工作，当然同时也不想设置全局变量。
    </p>
    <p>
     这个时候我们可以使用Test Fixture。
    </p>
    <p>
     所谓Test Fixture就是一个类，其包含了公共的设置代码和数据。它必须从googletest的testing命名空间中的Test类派生而来
    </p>
    <h4>
     <a id="_595">
     </a>
     入门
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">ListTest</span> <span class="token operator">:</span> <span class="token keyword">public</span> testing<span class="token operator">::</span>Test <span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _m_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
        _m_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        _m_list<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> _m_list<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">TEST_F</span><span class="token punctuation">(</span>ListTest<span class="token punctuation">,</span> FirstElement<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> _m_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>ListTest<span class="token punctuation">,</span> SecondElement<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> _m_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>ListTest<span class="token punctuation">,</span> ThirdElement<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> _m_list<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    testing<span class="token operator">::</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// //将命令行参数传递给gtest</span>
    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// //RUN_ALL_TESTS()运行所有测试案例</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_628">
     </a>
     普通用法
    </h4>
    <ol>
     <li>
      编写代码
     </li>
    </ol>
    <p>
     sample3-inl.h
    </p>
    <pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>



<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stddef.h&gt;</span></span>


<span class="token comment">// Queue is a simple queue implemented as a singled-linked list.</span>
<span class="token comment">//</span>
<span class="token comment">// The element type must support copy constructor.</span>
template <span class="token operator">&lt;</span>typename E<span class="token operator">&gt;</span>  <span class="token comment">// E is the element type</span>
class Queue<span class="token punctuation">;</span>

<span class="token comment">// QueueNode is a node in a Queue, which consists of an element of</span>
<span class="token comment">// type E and a pointer to the next node.</span>
template <span class="token operator">&lt;</span>typename E<span class="token operator">&gt;</span>  <span class="token comment">// E is the element type</span>
class QueueNode <span class="token punctuation">{<!-- --></span>
    friend class Queue<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token punctuation">;</span>

public<span class="token punctuation">:</span>
    <span class="token comment">// Gets the element in this node.</span>
    <span class="token keyword">const</span> E<span class="token operator">&amp;</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> element_<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// Gets the next node in the queue.</span>
    QueueNode<span class="token operator">*</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> next_<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> QueueNode<span class="token operator">*</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> next_<span class="token punctuation">;</span> <span class="token punctuation">}</span>

private<span class="token punctuation">:</span>
    <span class="token comment">// Creates a node with a given element value.  The next pointer is</span>
    <span class="token comment">// set to NULL.</span>
    explicit <span class="token function">QueueNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> E<span class="token operator">&amp;</span> an_element<span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token function">element_</span><span class="token punctuation">(</span>an_element<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">next_</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token comment">// We disable the default assignment operator and copy c'tor.</span>
    <span class="token keyword">const</span> QueueNode<span class="token operator">&amp;</span> operator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QueueNode<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">QueueNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> QueueNode<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    E element_<span class="token punctuation">;</span>
    QueueNode<span class="token operator">*</span> next_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

template <span class="token operator">&lt;</span>typename E<span class="token operator">&gt;</span>  <span class="token comment">// E is the element type.</span>
class Queue <span class="token punctuation">{<!-- --></span>
public<span class="token punctuation">:</span>
    <span class="token comment">// Creates an empty queue.</span>
    <span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">head_</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">last_</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">size_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token comment">// D'tor.  Clears the queue.</span>
    <span class="token operator">~</span><span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// Clears the queue.</span>
    <span class="token keyword">void</span> <span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size_ <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 1. Deletes every node.</span>
            QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> node <span class="token operator">=</span> head_<span class="token punctuation">;</span>
            QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> next <span class="token operator">=</span> node<span class="token operator">-&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                delete node<span class="token punctuation">;</span>
                node <span class="token operator">=</span> next<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> nullptr<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                next <span class="token operator">=</span> node<span class="token operator">-&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 2. Resets the member variables.</span>
            head_ <span class="token operator">=</span> last_ <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
            size_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Gets the number of elements.</span>
    size_t <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> size_<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// Gets the first element of the queue, or NULL if the queue is empty.</span>
    QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token function">Head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> head_<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token function">Head</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> head_<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// Gets the last element of the queue, or NULL if the queue is empty.</span>
    QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token function">Last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> last_<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token function">Last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> last_<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// Adds an element to the end of the queue.  A copy of the element is</span>
    <span class="token comment">// created using the copy constructor, and then stored in the queue.</span>
    <span class="token comment">// Changes made to the element in the queue doesn't affect the source</span>
    <span class="token comment">// object, and vice versa.</span>
    <span class="token keyword">void</span> <span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token keyword">const</span> E<span class="token operator">&amp;</span> element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> new_node <span class="token operator">=</span> new QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>size_ <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            head_ <span class="token operator">=</span> last_ <span class="token operator">=</span> new_node<span class="token punctuation">;</span>
            size_ <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            last_<span class="token operator">-&gt;</span>next_ <span class="token operator">=</span> new_node<span class="token punctuation">;</span>
            last_ <span class="token operator">=</span> new_node<span class="token punctuation">;</span>
            size_<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Removes the head of the queue and returns it.  Returns NULL if</span>
    <span class="token comment">// the queue is empty.</span>
    E<span class="token operator">*</span> <span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size_ <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> nullptr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> <span class="token keyword">const</span> old_head <span class="token operator">=</span> head_<span class="token punctuation">;</span>
        head_ <span class="token operator">=</span> head_<span class="token operator">-&gt;</span>next_<span class="token punctuation">;</span>
        size_<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size_ <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            last_ <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        E<span class="token operator">*</span> element <span class="token operator">=</span> new <span class="token function">E</span><span class="token punctuation">(</span>old_head<span class="token operator">-&gt;</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        delete old_head<span class="token punctuation">;</span>

        <span class="token keyword">return</span> element<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Applies a function/functor on each element of the queue, and</span>
    <span class="token comment">// returns the result in a new queue.  The original queue is not</span>
    <span class="token comment">// affected.</span>
    template <span class="token operator">&lt;</span>typename F<span class="token operator">&gt;</span>
    Queue<span class="token operator">*</span> <span class="token function">Map</span><span class="token punctuation">(</span>F function<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
        Queue<span class="token operator">*</span> new_queue <span class="token operator">=</span> new <span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> node <span class="token operator">=</span> head_<span class="token punctuation">;</span> node <span class="token operator">!=</span> nullptr<span class="token punctuation">;</span>
             node <span class="token operator">=</span> node<span class="token operator">-&gt;</span>next_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            new_queue<span class="token operator">-&gt;</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span>node<span class="token operator">-&gt;</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> new_queue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

private<span class="token punctuation">:</span>
    QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> head_<span class="token punctuation">;</span>  <span class="token comment">// The first node of the queue.</span>
    QueueNode<span class="token operator">&lt;</span>E<span class="token operator">&gt;</span><span class="token operator">*</span> last_<span class="token punctuation">;</span>  <span class="token comment">// The last node of the queue.</span>
    size_t size_<span class="token punctuation">;</span>  <span class="token comment">// The number of elements in the queue.</span>

    <span class="token comment">// We disallow copying a queue.</span>
    <span class="token function">Queue</span><span class="token punctuation">(</span><span class="token keyword">const</span> Queue<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> Queue<span class="token operator">&amp;</span> operator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Queue<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



</code></pre>
    <ol start="2">
     <li>
      编写测试用例
      <br/>
      sample_unittest.cpp
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample3-inl.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
<span class="token keyword">namespace</span> <span class="token punctuation">{<!-- --></span>
   <span class="token comment">// To use a test fixture, derive a class from testing::Test.</span>
   <span class="token keyword">class</span> <span class="token class-name">QueueTestSmpl3</span><span class="token operator">:</span> <span class="token keyword">public</span> testing<span class="token operator">::</span>Test<span class="token punctuation">{<!-- --></span>
   <span class="token keyword">protected</span><span class="token operator">:</span> <span class="token comment">//你应该把成员设为受保护的s.t.它们可以从子类访问。</span>
       <span class="token comment">// 将在运行每个测试之前调用virtual void SetUp（）。如果需要初始化变量。否则，可以跳过。</span>
       <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{<!-- --></span>
           q1_<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           q2_<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           q2_<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// 每次运行virtual TearDown测试后都将调用virtual TearDown（）。</span>
       <span class="token comment">//如果有清理工作要做，就应该定义它。否则，你不必提供它。</span>
       <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">TearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">}</span>

       <span class="token comment">//一些测试使用的辅助函数</span>
       <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">Double</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">return</span> <span class="token number">2</span><span class="token operator">*</span>n<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">//用于测试Queue:：Map（）的辅助函数</span>
       <span class="token keyword">void</span> <span class="token function">MapTester</span><span class="token punctuation">(</span><span class="token keyword">const</span> Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span>q<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
           <span class="token comment">// 创建一个新队列，其中每个元素的大小是q中相应元素的两倍。</span>
           <span class="token keyword">const</span> Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span><span class="token keyword">const</span> new_q <span class="token operator">=</span> q<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Map</span><span class="token punctuation">(</span>Double<span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> new_q<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QueueNode<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">*</span>n1 <span class="token operator">=</span> q<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>n2 <span class="token operator">=</span> new_q<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">Head</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                n1 <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> n1 <span class="token operator">=</span> n1<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n2 <span class="token operator">=</span> n2<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
               <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n1<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n2<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>

           <span class="token keyword">delete</span> new_q<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

       <span class="token comment">//声明测试要使用的变量。</span>
       Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> q0_<span class="token punctuation">;</span>
       Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> q1_<span class="token punctuation">;</span>
       Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> q2_<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>



   <span class="token comment">// When you have a test fixture, you define a test using TEST_F</span>
<span class="token comment">// instead of TEST.</span>
    <span class="token function">TEST_F</span><span class="token punctuation">(</span>QueueTestSmpl3<span class="token punctuation">,</span> DefaultConstructor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">,</span> q0_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token function">TEST_F</span><span class="token punctuation">(</span>QueueTestSmpl3<span class="token punctuation">,</span> Dequeue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> <span class="token operator">*</span> n <span class="token operator">=</span> q0_<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        n <span class="token operator">=</span> q1_<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_TRUE</span><span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">,</span> q1_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> n<span class="token punctuation">;</span>

        n <span class="token operator">=</span> q2_<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_TRUE</span><span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">*</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">,</span> q2_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">TEST_F</span><span class="token punctuation">(</span>QueueTestSmpl3<span class="token punctuation">,</span> EFF<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">,</span> q1_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">TEST_F</span><span class="token punctuation">(</span>QueueTestSmpl3<span class="token punctuation">,</span> Map<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">MapTester</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q0_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MapTester</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q1_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MapTester</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q2_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_863">
     </a>
     测试函数是否超时
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;limits.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample1.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample3-inl.h"</span></span>
<span class="token keyword">namespace</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 在这个示例中，我们希望确保每个测试都在~5秒。如果一个测试运行的时间较长，我们认为它是失败。</span>
<span class="token keyword">class</span> <span class="token class-name">QuickTest</span> <span class="token operator">:</span> <span class="token keyword">public</span> testing<span class="token operator">::</span>Test <span class="token punctuation">{<!-- --></span>
 <span class="token keyword">protected</span><span class="token operator">:</span>
  <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{<!-- --></span> start_time_ <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>


  <span class="token keyword">void</span> <span class="token function">TearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> time_t end_time <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//期待测试用例不超过5s</span>
    <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span>end_time <span class="token operator">-</span> start_time_ <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"The test took too long."</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  time_t start_time_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// 我们从QuickTest继承了一个IntegerFunctionTest。所有使用这个fixture的test都要求必须块</span>
<span class="token keyword">class</span> <span class="token class-name">IntegerFunctionTest</span> <span class="token operator">:</span> <span class="token keyword">public</span> QuickTest <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 这里什么都不需要干</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// Now we can write tests in the IntegerFunctionTest test case.</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>IntegerFunctionTest<span class="token punctuation">,</span> Factorial<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_GT</span><span class="token punctuation">(</span><span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">40320</span><span class="token punctuation">,</span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// Tests IsPrime()</span>
<span class="token function">TEST_F</span><span class="token punctuation">(</span>IntegerFunctionTest<span class="token punctuation">,</span> IsPrime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span>INT_MIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_FALSE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">QueueTest</span> <span class="token operator">:</span> <span class="token keyword">public</span> QuickTest <span class="token punctuation">{<!-- --></span>
 <span class="token keyword">protected</span><span class="token operator">:</span>
  <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// First, we need to set up the super fixture (QuickTest).</span>
    QuickTest<span class="token operator">::</span><span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Second, some additional setup for this fixture.</span>
    q1_<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    q2_<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    q2_<span class="token punctuation">.</span><span class="token function">Enqueue</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> q0_<span class="token punctuation">;</span>
  Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> q1_<span class="token punctuation">;</span>
  Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> q2_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// Now, let's write tests using the QueueTest fixture.</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>QueueTest<span class="token punctuation">,</span> DefaultConstructor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">,</span> q0_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Tests Dequeue().</span>
<span class="token function">TEST_F</span><span class="token punctuation">(</span>QueueTest<span class="token punctuation">,</span> Dequeue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span><span class="token operator">*</span> n <span class="token operator">=</span> q0_<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  n <span class="token operator">=</span> q1_<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">0u</span><span class="token punctuation">,</span> q1_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span> n<span class="token punctuation">;</span>

  n <span class="token operator">=</span> q2_<span class="token punctuation">.</span><span class="token function">Dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">*</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">EXPECT_EQ</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">,</span> q2_<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>  

</code></pre>
    <h3>
     <a id="4__971">
     </a>
     第4个例子: 参数化测试
    </h3>
    <p>
     在设计测试案例时，经常需要考虑给被测函数传入不同的值的情况。我们之前的做法通常是写一个通用方法，然后编写在测试案例调用它。即使使用了通用方法，这样的工作也是有很多重复性的，比如上面我们测试素数的代码：我需要传入一系列数值让函数IsPrime去判断是否为True
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/ff2860fa99b897810faca3a173abb210.png"/>
     <br/>
     ，在这个测试案例中，我至少复制粘贴了4次，假如参数有50个，100个，怎么办？ 这里我们就要用到参数化测试
    </p>
    <h4>
     <a id="_979">
     </a>
     普通函数参数化测试
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sample1.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"gtest/gtest.h"</span></span>
<span class="token keyword">namespace</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//1. 告诉gtest你的参数类型是什么</span>
   <span class="token comment">// 你必须添加一个类，继承testing::TestWithParam&lt;T&gt;，其中T就是你需要参数化的参数类型，比如上面的例子，我需要参数化一个int型的参数</span>
    <span class="token keyword">class</span> <span class="token class-name">IsPrimeParamTest</span> <span class="token operator">:</span> <span class="token keyword">public</span><span class="token operator">::</span>testing<span class="token operator">::</span>TestWithParam<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 2. 告诉gtest你拿到参数的值后，具体做些什么样的测试</span>
    <span class="token comment">// 这里，我们要使用一个新的宏TEST_P(parameterized)</span>
    <span class="token function">TEST_P</span><span class="token punctuation">(</span>IsPrimeParamTest<span class="token punctuation">,</span> HandleTrueReturn<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> n <span class="token operator">=</span>  <span class="token function">GetParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//在TEST_P宏里，使用GetParam()获取当前的参数的具体值。</span>
        <span class="token function">EXPECT_TRUE</span><span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//  3.使用INSTANTIATE_TEST_CASE_P这宏来告诉gtest你要测试的参数范围：</span>
    <span class="token comment">//  第一个参数是测试案例的前缀，可以任意取。</span>
    <span class="token comment">// 第二个参数是测试案例的名称，需要和之前定义的参数化的类的名称相同</span>
    <span class="token comment">// 第三个参数是可以理解为参数生成器，上面的例子使用test::Values表示使用括号内的参数</span>
    <span class="token function">INSTANTIATE_TEST_CASE_P</span><span class="token punctuation">(</span>TrueReturn<span class="token punctuation">,</span> IsPrimeParamTest<span class="token punctuation">,</span> testing<span class="token operator">::</span><span class="token function">Values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/de36d6619bcaa5df405e6c2f654b0fd9.png"/>
    </p>
    <p>
     从上面的框框中的案例名称大概能够看出案例的命名规则: prefix/test_case_name.test.name/index
    </p>
    <p>
     Google提供了一系列的参数生成的函数：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/65830e888d76a4a4a119fece4171c0d1.png"/>
    </p>
    <h4>
     <a id="_1018">
     </a>
     模板类参数化测试
    </h4>
    <pre><code class="prism language-c"><span class="token comment">//</span>
<span class="token comment">// Created by oceanstar on 2020/11/30.</span>
<span class="token comment">//</span>

<span class="token macro property">#<span class="token directive keyword">ifndef</span> TESTADD2_LINE_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> TESTADD2_LINE_H</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstddef&gt;</span></span>

template <span class="token operator">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t N<span class="token operator">&gt;</span>
class Line <span class="token punctuation">{<!-- --></span>
public<span class="token punctuation">:</span>
    <span class="token keyword">static</span> constexpr std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> N<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    explicit <span class="token function">Line</span><span class="token punctuation">(</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t n<span class="token punctuation">)</span>
            <span class="token punctuation">:</span> _length<span class="token punctuation">{<!-- --></span>n <span class="token operator">&lt;</span> N <span class="token operator">?</span> n <span class="token punctuation">:</span> N<span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> _length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

private<span class="token punctuation">:</span>
    std<span class="token punctuation">:</span><span class="token punctuation">:</span>size_t _length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">//TESTADD2_LINE_H</span>

</code></pre>
    <pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;gtest/gtest.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;type_traits&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"src/line.h"</span></span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">line_tester</span> <span class="token operator">:</span> <span class="token keyword">public</span> <span class="token operator">::</span>testing<span class="token operator">::</span>Test<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> test_types <span class="token operator">=</span> <span class="token operator">::</span>testing<span class="token operator">::</span>Types<span class="token operator">&lt;</span>
        std<span class="token operator">::</span>integral_constant<span class="token operator">&lt;</span>std<span class="token operator">::</span>size_t<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token operator">::</span>integral_constant<span class="token operator">&lt;</span>std<span class="token operator">::</span>size_t<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        std<span class="token operator">::</span>integral_constant<span class="token operator">&lt;</span>std<span class="token operator">::</span>size_t<span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>

<span class="token function">TYPED_TEST_CASE</span><span class="token punctuation">(</span>line_tester<span class="token punctuation">,</span> test_types<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">TYPED_TEST</span><span class="token punctuation">(</span>line_tester<span class="token punctuation">,</span> get_capacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">constexpr</span> std<span class="token operator">::</span>size_t n <span class="token operator">=</span> TypeParam<span class="token operator">::</span>value<span class="token punctuation">;</span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>Line<span class="token operator">&lt;</span>n<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TYPED_TEST</span><span class="token punctuation">(</span>line_tester<span class="token punctuation">,</span> set_length_preserved<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Line<span class="token operator">&lt;</span>TypeParam<span class="token operator">::</span>value<span class="token operator">&gt;</span> line<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TYPED_TEST</span><span class="token punctuation">(</span>line_tester<span class="token punctuation">,</span> set_length_trunctated<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">constexpr</span> std<span class="token operator">::</span>size_t n <span class="token operator">=</span> TypeParam<span class="token operator">::</span>value<span class="token punctuation">;</span>
    Line<span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> line<span class="token punctuation">{<!-- --></span><span class="token number">999</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_EQ</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Line<span class="token operator">&lt;</span>n<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">::</span>testing<span class="token operator">::</span><span class="token function">InitGoogleTest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">RUN_ALL_TESTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="demox_1096">
     </a>
     demox
    </h4>
    <ol>
     <li>
      编写代码
     </li>
    </ol>
    <p>
     prime_tables.h
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// 这提供了确定数字是否为并确定下一个素数。使用此接口在Google测试示例中演示参数化测试的使用。</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> once</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token comment">//  定义接口</span>
<span class="token keyword">class</span> <span class="token class-name">PrimeTable</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PrimeTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token keyword">const</span>  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">GetNextPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// Implementation #1</span>
<span class="token keyword">class</span> <span class="token class-name">OnTheFlyPrimeTable</span> <span class="token operator">:</span> <span class="token keyword">public</span> PrimeTable <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> <span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">*</span>i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">%</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">GetNextPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> n<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Implementation #2</span>
<span class="token keyword">class</span> <span class="token class-name">PreCalculatedPrimeTable</span> <span class="token operator">:</span> <span class="token keyword">public</span> PrimeTable <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">PreCalculatedPrimeTable</span><span class="token punctuation">(</span><span class="token keyword">int</span> max<span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token function">is_prime_size_</span><span class="token punctuation">(</span>max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">is_prime_</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">bool</span><span class="token punctuation">[</span>max <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">CalculatePrimesUpTo</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">PreCalculatedPrimeTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{<!-- --></span> <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> is_prime_<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">bool</span> <span class="token function">IsPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> n <span class="token operator">&amp;&amp;</span> n <span class="token operator">&lt;</span> is_prime_size_ <span class="token operator">&amp;&amp;</span> is_prime_<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">GetNextPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> p<span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> is_prime_size_<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>is_prime_<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> n<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">CalculatePrimesUpTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> max<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token operator">::</span>std<span class="token operator">::</span><span class="token function">fill</span><span class="token punctuation">(</span>is_prime_<span class="token punctuation">,</span> is_prime_ <span class="token operator">+</span> is_prime_size_<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        is_prime_<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> is_prime_<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// 检查每个候选素数（我们知道2是唯一的偶数素数）</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">*</span>i <span class="token operator">&lt;=</span> max<span class="token punctuation">;</span> i <span class="token operator">+</span><span class="token operator">=</span> i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_prime_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token comment">// 将i的所有倍数（除了i本身）标记为非素数。我们从第i个乘法器开始，因为所有较小的复数都已经被标记了。</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token operator">*</span>i<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> max<span class="token punctuation">;</span> j <span class="token operator">+</span><span class="token operator">=</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                is_prime_<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span>  is_prime_size_<span class="token punctuation">;</span>
    <span class="token keyword">bool</span><span class="token operator">*</span> <span class="token keyword">const</span> is_prime_<span class="token punctuation">;</span>
    <span class="token comment">// Disables compiler warning "assignment operator could not be generated."</span>
    <span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> PreCalculatedPrimeTable<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      编写测试用例
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
</code></pre>
    <p>
     <a href="https://www.cnblogs.com/coderzh/archive/2009/04/11/1433744.html" rel="nofollow">
      参考
     </a>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f7a68697a68656e676775616e2f:61727469636c652f64657461696c732f313130333133323635" class_="artid" style="display:none">
 </p>
</div>


