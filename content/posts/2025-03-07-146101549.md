---
layout: post
title: "Flutter-调用原生IOS接口"
date: 2025-03-07 17:50:54 +0800
description: "ios 端代码 Appdelegate。"
keywords: "Flutter 调用原生IOS接口"
categories: ['未分类']
tags: ['Ios', 'Flutter', 'Cocoa']
artid: "146101549"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146101549
    alt: "Flutter-调用原生IOS接口"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146101549
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146101549
cover: https://bing.ee123.net/img/rand?artid=146101549
image: https://bing.ee123.net/img/rand?artid=146101549
img: https://bing.ee123.net/img/rand?artid=146101549
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Flutter 调用原生IOS接口
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     直接上代码有注释
    </p>
    <p>
     服务类
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/services.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TNativeChannel</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> methChanal <span class="token operator">=</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"flutter_native"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> eventChanal <span class="token operator">=</span> <span class="token class-name">EventChannel</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"flutter_native_event"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//获取ios版本信息</span>
  <span class="token keyword">static</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPlatformVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">async</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token operator">?</span> version <span class="token operator">=</span> <span class="token keyword">await</span> methChanal<span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"getPlatformVersion"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> version<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">on</span> <span class="token class-name">PlatformException</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"获取失败 </span><span class="token interpolation"><span class="token punctuation">${<!-- --></span><span class="token expression">e<span class="token punctuation">.</span>message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token keyword">async</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token operator">?</span> response <span class="token operator">=</span> <span class="token keyword">await</span> methChanal<span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"greet"</span></span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string-literal"><span class="token string">'name'</span></span><span class="token punctuation">:</span>name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


 <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">listenToEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    eventChanal<span class="token punctuation">.</span><span class="token function">receiveBroadcastStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"iOS 发送过来的事件 </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">event</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     测试代码块
    </p>
    <pre><code class="prism language-dart"><span class="token class-name">Widget</span> <span class="token function">createWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">ListView</span><span class="token punctuation">(</span>
      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token class-name">ElevatedButton</span><span class="token punctuation">(</span>onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token class-name">TNativeChannel</span><span class="token punctuation">.</span><span class="token function">listenToEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>  child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"测试openNativeView"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        <span class="token class-name">FutureBuilder</span><span class="token punctuation">(</span>future<span class="token punctuation">:</span> <span class="token class-name">TNativeChannel</span><span class="token punctuation">.</span><span class="token function">getPlatformVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span>snop<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">return</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>snop<span class="token punctuation">.</span>data <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">"加载中"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
    <p>
     ios 端代码 Appdelegate
    </p>
    <pre><code class="prism language-dart"><span class="token keyword">import</span> <span class="token class-name">Flutter</span>
<span class="token keyword">import</span> <span class="token class-name">UIKit</span>

<span class="token metadata function">@main</span>
<span class="token metadata function">@objc</span> <span class="token keyword">class</span> <span class="token class-name">AppDelegate</span><span class="token punctuation">:</span> <span class="token class-name">FlutterAppDelegate</span> <span class="token punctuation">{<!-- --></span>
  override func <span class="token function">application</span><span class="token punctuation">(</span>
    _ application<span class="token punctuation">:</span> <span class="token class-name">UIApplication</span><span class="token punctuation">,</span>
    didFinishLaunchingWithOptions launchOptions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UIApplication.LaunchOptionsKey</span><span class="token punctuation">:</span> <span class="token class-name">Any</span><span class="token punctuation">]</span><span class="token operator">?</span>
  <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">Bool</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">GeneratedPluginRegistrant</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">with</span><span class="token punctuation">:</span> self<span class="token punctuation">)</span>
      <span class="token function">setUpFlutter1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">setFlutter2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">setEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">application</span><span class="token punctuation">(</span>application<span class="token punctuation">,</span> didFinishLaunchingWithOptions<span class="token punctuation">:</span> launchOptions<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
    
    
    func <span class="token function">setUpFlutter1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        let flutterVc <span class="token operator">=</span> window<span class="token punctuation">.</span>rootViewController <span class="token operator">as</span><span class="token operator">!</span> <span class="token class-name">FlutterViewController</span>
        <span class="token comment">//通道名称必须和flutter端定义的一致</span>
        let channel <span class="token operator">=</span> <span class="token class-name">FlutterMethodChannel</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"flutter_native"</span></span><span class="token punctuation">,</span> binaryMessenger<span class="token punctuation">:</span> flutterVc<span class="token punctuation">.</span>binaryMessenger<span class="token punctuation">)</span>
        <span class="token comment">//监听方法</span>
        channel<span class="token punctuation">.</span>setMethodCallHandler <span class="token punctuation">{<!-- --></span> call<span class="token punctuation">,</span> result <span class="token keyword">in</span>
            <span class="token keyword">if</span> call<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"getPlatformVersion"</span></span><span class="token punctuation">{<!-- --></span>
                let version <span class="token operator">=</span> <span class="token class-name">UIDevice</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span>systemVersion
                <span class="token function">result</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"iOS \(version)"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token function">result</span><span class="token punctuation">(</span><span class="token class-name">FlutterMethodNotImplemented</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//带参数的调用</span>
    func <span class="token function">setFlutter2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        guard let fluttervc <span class="token operator">=</span> window<span class="token punctuation">.</span>rootViewController <span class="token operator">as</span><span class="token operator">?</span> <span class="token class-name">FlutterViewController</span> <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span><span class="token keyword">return</span><span class="token punctuation">}</span>
        let channel <span class="token operator">=</span> <span class="token class-name">FlutterMethodChannel</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"flutter_native"</span></span><span class="token punctuation">,</span> binaryMessenger<span class="token punctuation">:</span> fluttervc<span class="token punctuation">.</span>binaryMessenger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span>setMethodCallHandler <span class="token punctuation">{<!-- --></span> call<span class="token punctuation">,</span> result <span class="token keyword">in</span>
            <span class="token keyword">if</span> call<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"greet"</span></span><span class="token punctuation">{<!-- --></span>
                let args <span class="token operator">=</span> call<span class="token punctuation">.</span>arguments <span class="token operator">as</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">:</span><span class="token class-name">Any</span><span class="token punctuation">]</span>
                let name <span class="token operator">=</span> args<span class="token operator">?</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"name"</span></span><span class="token punctuation">]</span> <span class="token operator">as</span><span class="token operator">?</span> <span class="token class-name">String</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token string-literal"><span class="token string">"Unknown"</span></span>
                <span class="token function">result</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hello \(name) from iOS"</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token function">result</span><span class="token punctuation">(</span><span class="token class-name">FlutterMethodNotImplemented</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
    <span class="token punctuation">}</span>
    
    
    func <span class="token function">setEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        let flutterVc <span class="token operator">=</span> window<span class="token punctuation">.</span>rootViewController <span class="token operator">as</span><span class="token operator">!</span> <span class="token class-name">FlutterViewController</span>
        let eventChannal <span class="token operator">=</span> <span class="token class-name">FlutterEventChannel</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"flutter_native_event"</span></span><span class="token punctuation">,</span> binaryMessenger<span class="token punctuation">:</span> flutterVc<span class="token punctuation">.</span>binaryMessenger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        let handler <span class="token operator">=</span> <span class="token class-name">FEventStreamHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        eventChannal<span class="token punctuation">.</span><span class="token function">setStreamHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">FEventStreamHandler</span><span class="token punctuation">:</span><span class="token class-name">NSObject</span><span class="token punctuation">,</span><span class="token class-name">FlutterStreamHandler</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> eventSink<span class="token punctuation">:</span><span class="token class-name">FlutterEventSink</span><span class="token operator">?</span>
    func <span class="token function">onListen</span><span class="token punctuation">(</span>withArguments arguments<span class="token punctuation">:</span> <span class="token class-name">Any</span><span class="token operator">?</span><span class="token punctuation">,</span> eventSink events<span class="token punctuation">:</span> <span class="token metadata function">@escaping</span> <span class="token class-name">FlutterEventSink</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">FlutterError</span><span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
        self<span class="token punctuation">.</span>eventSink <span class="token operator">=</span> events
        
        <span class="token comment">//发送测试数据</span>
        <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">asyncAfter</span><span class="token punctuation">(</span>deadline<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            self<span class="token punctuation">.</span>eventSink<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"NFC 扫描成功"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> nil
    <span class="token punctuation">}</span>
    
    func <span class="token function">onCancel</span><span class="token punctuation">(</span>withArguments arguments<span class="token punctuation">:</span> <span class="token class-name">Any</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">FlutterError</span><span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
        eventSink <span class="token operator">=</span> nil
        <span class="token keyword">return</span> nil
    <span class="token punctuation">}</span>
    
    
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f626f62626f6233322f:61727469636c652f64657461696c732f313436313031353439" class_="artid" style="display:none">
 </p>
</div>


