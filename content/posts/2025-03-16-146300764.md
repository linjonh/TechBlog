---
layout: post
title: "linux-ä¸‹æ¶ˆæ¯é˜Ÿåˆ—"
date: 2025-03-16 20:33:39 +0800
description: "linux ä¸‹æ¶ˆæ¯é˜Ÿåˆ—"
keywords: "linux ä¸‹æ¶ˆæ¯é˜Ÿåˆ—"
categories: ['Linux']
tags: ['è¿ç»´', 'æœåŠ¡å™¨', 'Linux', 'C', 'C']
artid: "146300764"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146300764
    alt: "linux-ä¸‹æ¶ˆæ¯é˜Ÿåˆ—"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146300764
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146300764
cover: https://bing.ee123.net/img/rand?artid=146300764
image: https://bing.ee123.net/img/rand?artid=146300764
img: https://bing.ee123.net/img/rand?artid=146300764
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     linux ä¸‹æ¶ˆæ¯é˜Ÿåˆ—
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/d6d70b58e84442aeba129409048457ec.png"/>
    </p>
    <hr/>
    <h2>
     <a id="_Linux_System_V__6">
     </a>
     ğŸ“¨ Linux System V æ¶ˆæ¯é˜Ÿåˆ—å®æˆ˜
    </h2>
    <hr/>
    <h3>
     <a id="__9">
     </a>
     ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—æ ¸å¿ƒæ¦‚å¿µ ğŸ’¡
    </h3>
    <h4>
     <a id="1___11">
     </a>
     1. æ¶ˆæ¯é˜Ÿåˆ—ç‰¹ç‚¹ ğŸŒŸ
    </h4>
    <ul>
     <li>
      ğŸ“¦
      <strong>
       ç»“æ„åŒ–æ•°æ®
      </strong>
      ï¼šæ¶ˆæ¯åŒ…å«ç±»å‹æ ‡è¯†ï¼ˆ
      <code>
       mytype
      </code>
      ï¼‰å’Œæ­£æ–‡ï¼ˆ
      <code>
       data
      </code>
      ï¼‰ï¼Œæ”¯æŒåˆ†ç±»å¤„ç†
     </li>
     <li>
      â³
      <strong>
       å¼‚æ­¥é€šä¿¡
      </strong>
      ï¼šå‘é€æ–¹å’Œæ¥æ”¶æ–¹æ— éœ€åŒæ—¶åœ¨çº¿
     </li>
     <li>
      ğŸ”’
      <strong>
       æŒä¹…æ€§
      </strong>
      ï¼šæ¶ˆæ¯é˜Ÿåˆ—åœ¨å†…æ ¸ä¸­æŒä¹…å­˜åœ¨ï¼Œç›´åˆ°æ˜¾å¼åˆ é™¤
     </li>
     <li>
      ğŸ”‘
      <strong>
       è®¿é—®æ§åˆ¶
      </strong>
      ï¼šé€šè¿‡æƒé™æ ‡å¿—ï¼ˆå¦‚
      <code>
       0666
      </code>
      ï¼‰ç®¡ç†è¯»å†™æƒé™
     </li>
    </ul>
    <h4>
     <a id="2___17">
     </a>
     2. ç”Ÿå‘½å‘¨æœŸ ğŸ”„
    </h4>
    <ul>
     <li>
      <strong>
       åˆ›å»º
      </strong>
      â†’
      <strong>
       å‘é€/æ¥æ”¶
      </strong>
      â†’
      <strong>
       é”€æ¯
      </strong>
     </li>
     <li>
      â—è‹¥ä¸ä¸»åŠ¨é”€æ¯ï¼Œé˜Ÿåˆ—ä¼šæŒç»­å ç”¨å†…æ ¸èµ„æºï¼ˆé€šè¿‡
      <code>
       ipcs -q
      </code>
      å¯æŸ¥çœ‹ï¼‰
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_22">
     </a>
     äºŒã€é¡¹ç›®æ¦‚è¿°
    </h3>
    <p>
     æœ¬ç¤ºä¾‹é€šè¿‡
     <strong>
      System V æ¶ˆæ¯é˜Ÿåˆ—
     </strong>
     å®ç°è·¨è¿›ç¨‹é€šä¿¡ï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼š
    </p>
    <ul>
     <li>
      <strong>
       <code>
        common.hpp
       </code>
      </strong>
      ï¼šæ¶ˆæ¯é˜Ÿåˆ—å…¬å…±é…ç½®
     </li>
     <li>
      <strong>
       <code>
        sender.cpp
       </code>
      </strong>
      ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘é€ç«¯ï¼‰
     </li>
     <li>
      <strong>
       <code>
        receiver.cpp
       </code>
      </strong>
      ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆæ¥æ”¶ç«¯ï¼‰
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="_31">
     </a>
     ä¸‰ã€å®Œæ•´ä»£ç å®ç°
    </h3>
    <h4>
     <a id="1__commonhpp_33">
     </a>
     1. å…¬å…±å¤´æ–‡ä»¶
     <code>
      common.hpp
     </code>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>

<span class="token comment">// æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†é…ç½®</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pathname <span class="token operator">=</span> <span class="token string">"/home"</span><span class="token punctuation">;</span> <span class="token comment">// ftokè·¯å¾„å‚æ•°ï¼ˆéœ€çœŸå®å­˜åœ¨ï¼‰</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> proj_id <span class="token operator">=</span> <span class="token number">666</span><span class="token punctuation">;</span>        <span class="token comment">// é¡¹ç›®IDï¼ˆå–å€¼èŒƒå›´0-255ï¼‰</span>

<span class="token comment">// æ¶ˆæ¯ç»“æ„ä½“ï¼ˆå¿…é¡»åŒ…å«longç±»å‹å­—æ®µï¼‰</span>
<span class="token keyword">struct</span> <span class="token class-name">message</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">long</span> mytype<span class="token punctuation">;</span>    <span class="token comment">// æ¶ˆæ¯ç±»å‹æ ‡è¯†ï¼ˆå¿…é¡» &gt; 0ï¼‰</span>
    <span class="token keyword">char</span> data<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ¶ˆæ¯æ­£æ–‡ï¼ˆæœ€å¤§99å­—ç¬¦ï¼‰</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// é”™è¯¯ç æšä¸¾</span>
<span class="token keyword">enum</span> <span class="token punctuation">{<!-- --></span>
    MSGGET_ERROR <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// é€šç”¨é˜Ÿåˆ—åˆ›å»º/è·å–å‡½æ•°</span>
<span class="token keyword">int</span> <span class="token function">Msgqueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    key_t key <span class="token operator">=</span> <span class="token function">ftok</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> proj_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"ftok failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>MSGGET_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> msgid <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msgid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"msgget failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>MSGGET_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> msgid<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆ›å»ºæ–°é˜Ÿåˆ—ï¼ˆæœåŠ¡ç«¯ï¼‰</span>
<span class="token keyword">int</span> <span class="token function">CreateMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">Msgqueue</span><span class="token punctuation">(</span>IPC_CREAT <span class="token operator">|</span> IPC_EXCL <span class="token operator">|</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è·å–å·²æœ‰é˜Ÿåˆ—ï¼ˆå®¢æˆ·ç«¯ï¼‰</span>
<span class="token keyword">int</span> <span class="token function">Getmsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">Msgqueue</span><span class="token punctuation">(</span>IPC_CREAT <span class="token operator">|</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="2__sendercpp_87">
     </a>
     2. å‘é€ç«¯
     <code>
      sender.cpp
     </code>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"common.hpp"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—</span>
    <span class="token keyword">int</span> msgid <span class="token operator">=</span> <span class="token function">CreateMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" æ¶ˆæ¯é˜Ÿåˆ—åˆ›å»ºæˆåŠŸ! ID: "</span> <span class="token operator">&lt;&lt;</span> msgid <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ æ¶ˆæ¯</span>
    message msg<span class="token punctuation">;</span>
    msg<span class="token punctuation">.</span>mytype <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// æ¶ˆæ¯ç±»å‹æ ‡è¯†</span>
    <span class="token function">snprintf</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello from sender"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å‘é€æ¶ˆæ¯ï¼ˆé˜»å¡æ¨¡å¼ï¼‰</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgsnd</span><span class="token punctuation">(</span>msgid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">" æ¶ˆæ¯å‘é€å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" æ¶ˆæ¯å·²å‘é€: "</span> <span class="token operator">&lt;&lt;</span> msg<span class="token punctuation">.</span>data <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="3__receivercpp_114">
     </a>
     3. æ¥æ”¶ç«¯
     <code>
      receiver.cpp
     </code>
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"common.hpp"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// è·å–æ¶ˆæ¯é˜Ÿåˆ—</span>
    <span class="token keyword">int</span> msgid <span class="token operator">=</span> <span class="token function">Getmsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" è¿æ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ— ID: "</span> <span class="token operator">&lt;&lt;</span> msgid <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">// æ¥æ”¶æ¶ˆæ¯ï¼ˆé˜»å¡ç­‰å¾…ç±»å‹ä¸º1çš„æ¶ˆæ¯ï¼‰</span>
    message msg<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgrcv</span><span class="token punctuation">(</span>msgid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">" æ¶ˆæ¯æ¥æ”¶å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" æ”¶åˆ°æ¶ˆæ¯: "</span> <span class="token operator">&lt;&lt;</span> msg<span class="token punctuation">.</span>data <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">// é”€æ¯é˜Ÿåˆ—ï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼ï¼‰</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgctl</span><span class="token punctuation">(</span>msgid<span class="token punctuation">,</span> IPC_RMID<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">" é˜Ÿåˆ—åˆ é™¤å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"æ¶ˆæ¯é˜Ÿåˆ—å·²é”€æ¯"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="_144">
     </a>
     ä¸‰ã€ç¼–è¯‘ä¸è¿è¡ŒæŒ‡å—
    </h3>
    <h4>
     <a id="1__146">
     </a>
     1. ç¼–è¯‘å‘½ä»¤
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># ç”Ÿæˆå‘é€ç«¯å¯æ‰§è¡Œæ–‡ä»¶</span>
g++ sender.cpp <span class="token parameter variable">-o</span> sender <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11

<span class="token comment"># ç”Ÿæˆæ¥æ”¶ç«¯å¯æ‰§è¡Œæ–‡ä»¶</span>
g++ receiver.cpp <span class="token parameter variable">-o</span> receiver <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11
</code></pre>
    <h4>
     <a id="2__155">
     </a>
     2. è¿è¡Œé¡ºåº
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># ç»ˆç«¯1ï¼šè¿è¡Œå‘é€ç«¯ï¼ˆåˆ›å»ºé˜Ÿåˆ—ï¼‰</span>
./sender

<span class="token comment"># ç»ˆç«¯2ï¼šè¿è¡Œæ¥æ”¶ç«¯ï¼ˆæ¶ˆè´¹æ¶ˆæ¯ï¼‰</span>
./receiver
</code></pre>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/33d209f5155c4466bad547f50c5840ec.png"/>
    </p>
    <h3>
     <a id="__167">
     </a>
     å››ã€ä»£ç åˆ†è§£ä¸æ ¸å¿ƒå‡½æ•° ğŸ› ï¸
    </h3>
    <h4>
     <a id="1__commonhpp__169">
     </a>
     1. å…¬å…±å¤´æ–‡ä»¶
     <code>
      common.hpp
     </code>
     ğŸ“
    </h4>
    <h5>
     <a id="_170">
     </a>
     æ¶ˆæ¯ç»“æ„ä½“å®šä¹‰
    </h5>
    <pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">message</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">long</span> mytype<span class="token punctuation">;</span>    <span class="token comment">// ğŸ”¢ æ¶ˆæ¯ç±»å‹ï¼ˆå¿…é¡» &gt; 0ï¼‰</span>
    <span class="token keyword">char</span> data<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ“ æ¶ˆæ¯æ­£æ–‡ï¼ˆæœ€å¤§é•¿åº¦å¯è°ƒæ•´ï¼‰</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="Key__178">
     </a>
     Key ç”Ÿæˆä¸é˜Ÿåˆ—åˆ›å»º
    </h5>
    <pre><code class="prism language-cpp">key_t key <span class="token operator">=</span> <span class="token function">ftok</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> proj_id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ—ï¸ ç”Ÿæˆå”¯ä¸€é”®å€¼</span>
<span class="token keyword">int</span> msgid <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// ğŸšª åˆ›å»º/è·å–é˜Ÿåˆ—</span>
</code></pre>
    <ul>
     <li>
      <strong>
       <code>
        ftok
       </code>
       å‚æ•°
      </strong>
      ï¼š
      <ul>
       <li>
        ğŸ“‚
        <code>
         pathname
        </code>
        ï¼šä»»æ„å­˜åœ¨çš„æ–‡ä»¶è·¯å¾„ï¼ˆæœ¬æ–‡ä½¿ç”¨
        <code>
         /home
        </code>
        ï¼‰
       </li>
       <li>
        ğŸ†”
        <code>
         proj_id
        </code>
        ï¼šé¡¹ç›®æ ‡è¯†ç¬¦ï¼ˆç¡®ä¿ä¸åŒåº”ç”¨ä½¿ç”¨ä¸åŒå€¼ï¼‰
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="_187">
     </a>
     å°è£…å‡½æ•°
    </h5>
    <ul>
     <li>
      ğŸ†•
      <strong>
       <code>
        CreateMsg()
       </code>
      </strong>
      ï¼šåˆ›å»ºæ–°é˜Ÿåˆ—ï¼ˆ
      <code>
       IPC_CREAT | IPC_EXCL
      </code>
      ç¡®ä¿å”¯ä¸€æ€§ï¼‰
     </li>
     <li>
      ğŸ”
      <strong>
       <code>
        Getmsg()
       </code>
      </strong>
      ï¼šè·å–å·²æœ‰é˜Ÿåˆ—ï¼ˆè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="2___192">
     </a>
     2. å‘é€ç«¯ä»£ç è§£æ ğŸ“¤
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> msgid <span class="token operator">=</span> <span class="token function">CreateMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ—ï¸ åˆ›å»ºé˜Ÿåˆ—</span>
    message msg<span class="token punctuation">;</span>
    msg<span class="token punctuation">.</span>mytype <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ·ï¸ è®¾ç½®æ¶ˆæ¯ç±»å‹</span>
    <span class="token function">snprintf</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello from sender\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// âœˆï¸ å‘é€æ¶ˆæ¯ï¼ˆé˜»å¡æ¨¡å¼ï¼‰</span>
    <span class="token function">msgsnd</span><span class="token punctuation">(</span>msgid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Message sent: "</span> <span class="token operator">&lt;&lt;</span> msg<span class="token punctuation">.</span>data <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="__207">
     </a>
     å…³é”®ç‚¹ ğŸ”‘
    </h5>
    <ul>
     <li>
      ğŸ¯
      <strong>
       æ¶ˆæ¯ç±»å‹
      </strong>
      ï¼šæ¥æ”¶ç«¯é€šè¿‡
      <code>
       mytype
      </code>
      ç­›é€‰æ¶ˆæ¯
     </li>
     <li>
      ğŸš¦
      <strong>
       å‘é€æ¨¡å¼
      </strong>
      ï¼š
      <ul>
       <li>
        ğŸ›‘
        <code>
         0
        </code>
        ï¼šé˜»å¡å‘é€ï¼ˆé˜Ÿåˆ—æ»¡æ—¶ç­‰å¾…ï¼‰
       </li>
       <li>
        ğŸš€
        <code>
         IPC_NOWAIT
        </code>
        ï¼šéé˜»å¡å‘é€ï¼ˆç«‹å³è¿”å›é”™è¯¯ï¼‰
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     <a id="3___215">
     </a>
     3. æ¥æ”¶ç«¯ä»£ç è§£æ ğŸ“¥
    </h4>
    <pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> msgid <span class="token operator">=</span> <span class="token function">Getmsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ” è·å–é˜Ÿåˆ—</span>
    message msg<span class="token punctuation">;</span>
    
    <span class="token comment">// ğŸ“­ æ¥æ”¶ç±»å‹ä¸º1çš„æ¶ˆæ¯ï¼ˆé˜»å¡æ¨¡å¼ï¼‰</span>
    <span class="token function">msgrcv</span><span class="token punctuation">(</span>msgid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> msg<span class="token punctuation">.</span>data <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    
    <span class="token function">msgctl</span><span class="token punctuation">(</span>msgid<span class="token punctuation">,</span> IPC_RMID<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ğŸ—‘ï¸ é”€æ¯é˜Ÿåˆ—</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h5>
     <a id="__230">
     </a>
     å…³é”®ç‚¹ ğŸ”
    </h5>
    <ul>
     <li>
      ğŸ¯
      <strong>
       æ¶ˆæ¯è¿‡æ»¤
      </strong>
      ï¼š
      <code>
       msgrcv
      </code>
      çš„ç¬¬4ä¸ªå‚æ•°æŒ‡å®šæ¥æ”¶çš„æ¶ˆæ¯ç±»å‹
      <ul>
       <li>
        ğŸ¯
        <code>
         1
        </code>
        ï¼šä»…æ¥æ”¶ç±»å‹ä¸º1çš„æ¶ˆæ¯
       </li>
       <li>
        ğŸ²
        <code>
         0
        </code>
        ï¼šæ¥æ”¶é˜Ÿåˆ—ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯
       </li>
       <li>
        ğŸ”
        <code>
         -3
        </code>
        ï¼šæ¥æ”¶ç±»å‹ â‰¤3 çš„æœ€å°æ¶ˆæ¯
       </li>
      </ul>
     </li>
     <li>
      ğŸ§¹
      <strong>
       èµ„æºé‡Šæ”¾
      </strong>
      ï¼š
      <code>
       IPC_RMID
      </code>
      ç«‹å³åˆ é™¤é˜Ÿåˆ—
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="__239">
     </a>
     äº”ã€å¸¸è§é—®é¢˜ä¸è°ƒè¯•æŠ€å·§ ğŸš¨
    </h3>
    <h4>
     <a id="1___240">
     </a>
     1. ç³»ç»Ÿå‘½ä»¤ ğŸ’»
    </h4>
    <pre><code class="prism language-bash">ipcs <span class="token parameter variable">-q</span>          <span class="token comment"># ğŸ” æŸ¥çœ‹æ‰€æœ‰æ¶ˆæ¯é˜Ÿåˆ—</span>
ipcrm <span class="token parameter variable">-q</span> <span class="token operator">&lt;</span>msqid<span class="token operator">&gt;</span> <span class="token comment"># ğŸ—‘ï¸ æ‰‹åŠ¨åˆ é™¤é˜Ÿåˆ—</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f34363533383938352f:61727469636c652f64657461696c732f313436333030373634" class_="artid" style="display:none">
 </p>
</div>


