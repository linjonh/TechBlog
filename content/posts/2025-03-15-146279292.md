---
layout: post
title: "java网络编程UDP协议通信"
date: 2025-03-15 14:47:30 +0800
description: "简单讲解java网络编程中的通过UDP协议通信"
keywords: "【java】网络编程——UDP协议通信"
categories: ['未分类']
tags: ['网络', 'Udp', 'Java']
artid: "146279292"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146279292
    alt: "java网络编程UDP协议通信"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146279292
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146279292
cover: https://bing.ee123.net/img/rand?artid=146279292
image: https://bing.ee123.net/img/rand?artid=146279292
img: https://bing.ee123.net/img/rand?artid=146279292
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【java】网络编程——UDP协议通信
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="UDP_0">
     </a>
     UDP
    </h2>
    <p>
     UDP与TCP最大的区别就是UDP不建立连接就可以发数据报，而TCP一定要建立连接。
    </p>
    <h3>
     <a id="_4">
     </a>
     消息发送（单条）
    </h3>
    <h4>
     <a id="_6">
     </a>
     示例代码
    </h4>
    <p>
     <strong>
      发送方：
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramPacket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramSocket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpSenderDemo01</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1.建立一个DatagramSocket,建立的是数据报的Socket</span>
        <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.建包,这个包就是要发送的东西</span>
        <span class="token comment">// 你要发的内容、发到哪个ip、端口，都可以当参数传</span>
        <span class="token comment">// 传的内容（注意是byte数组） 范围（数组下标）始 末 ip 端口</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"你好UDP"</span><span class="token punctuation">;</span>
        <span class="token class-name">InetAddress</span> address <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">;</span>
        <span class="token class-name">DatagramPacket</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">,</span> address<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.发包，是使用建立的DatagramSocket套接字发包</span>
        <span class="token comment">// 发完就不管了，不论接收方是否接到</span>
        socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.关闭Socket</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="_39">
     </a>
     代码思路
    </h5>
    <ol>
     <li>
      <strong>
       创建
       <code>
        DatagramSocket
       </code>
      </strong>
      ：发送方同样需要创建一个
      <code>
       DatagramSocket
      </code>
      对象，不过这里不需要指定端口，系统会自动分配一个可用的端口。这个
      <code>
       DatagramSocket
      </code>
      用于发送 UDP 数据报。
     </li>
     <li>
      <strong>
       创建
       <code>
        DatagramPacket
       </code>
      </strong>
      ：将要发送的消息转换为字节数组，并指定目标地址（IP 地址）和端口号，创建一个
      <code>
       DatagramPacket
      </code>
      对象。这个对象封装了要发送的数据以及目标地址和端口信息。
     </li>
     <li>
      <strong>
       发送数据报
      </strong>
      ：调用
      <code>
       DatagramSocket
      </code>
      的
      <code>
       send
      </code>
      方法，将创建好的
      <code>
       DatagramPacket
      </code>
      发送出去。UDP 是无连接的协议，发送方发送数据报后不会关心接收方是否成功接收到数据。
     </li>
     <li>
      <strong>
       关闭
       <code>
        DatagramSocket
       </code>
      </strong>
      ：数据报发送完成后，关闭
      <code>
       DatagramSocket
      </code>
      以释放资源。
     </li>
    </ol>
    <p>
     <strong>
      接收方：
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramPacket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramSocket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpReceiverDemo01</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 也要建立DatagramSocket，UDP协议下，发送方和接收方法都要建立DatagramSocket</span>
        <span class="token comment">// 这种构造方法，就是告诉你我这个DatagramSocket对象绑定到了9999端口，发送到这个端口的数据我都能接收</span>
        <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 接收数据包，用缓冲区</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 这个构造方法通常用于创建一个用于接收数据的数据报包。</span>
        <span class="token comment">// 当使用 DatagramSocket 的 receive 方法接收数据时，需要传入一个 DatagramPacket 对象，</span>
        <span class="token comment">// DatagramSocket 会将接收到的数据填充到这个 DatagramPacket 对象中。</span>
        <span class="token class-name">DatagramPacket</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用receive方法时，程序会进入阻塞状态，直到接收到一个数据报为止。</span>
        socket<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发包人的地址为："</span><span class="token operator">+</span>packet<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发包人的端口为："</span><span class="token operator">+</span>packet<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"发的信息为："</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="2_79">
     </a>
     代码思路2
    </h5>
    <ol>
     <li>
      <strong>
       创建
       <code>
        DatagramSocket
       </code>
      </strong>
      ：在 UDP 通信中，接收方需要创建一个
      <code>
       DatagramSocket
      </code>
      对象并将其绑定到一个特定的端口（这里是 9999 端口）。绑定端口后，该
      <code>
       DatagramSocket
      </code>
      就会监听这个端口，接收所有发送到该端口的 UDP 数据报。
     </li>
     <li>
      <strong>
       创建接收缓冲区和
       <code>
        DatagramPacket
       </code>
      </strong>
      ：为了存储接收到的数据，需要创建一个字节数组作为缓冲区（
      <code>
       buf
      </code>
      ），并使用这个缓冲区创建一个
      <code>
       DatagramPacket
      </code>
      对象。
      <code>
       DatagramPacket
      </code>
      就像是一个容器，用于接收和存储从网络中接收到的数据报。
     </li>
     <li>
      <strong>
       接收数据报
      </strong>
      ：调用
      <code>
       DatagramSocket
      </code>
      的
      <code>
       receive
      </code>
      方法，该方法会进入阻塞状态，直到接收到一个发送到绑定端口的数据报。一旦接收到数据报，数据会被填充到
      <code>
       DatagramPacket
      </code>
      对象中。
     </li>
     <li>
      <strong>
       处理接收到的数据
      </strong>
      ：从
      <code>
       DatagramPacket
      </code>
      中获取发送方的地址、端口和发送的消息内容，并将这些信息打印输出。
     </li>
    </ol>
    <h4>
     <a id="_88">
     </a>
     通信过程
    </h4>
    <ol>
     <li>
      <strong>
       接收方启动
      </strong>
      ：接收方程序首先运行，创建一个绑定到 9999 端口的
      <code>
       DatagramSocket
      </code>
      ，并进入等待接收数据报的状态（调用
      <code>
       receive
      </code>
      方法后进入阻塞状态）。
     </li>
     <li>
      <strong>
       发送方发送数据报
      </strong>
      ：发送方程序运行，创建一个
      <code>
       DatagramSocket
      </code>
      和一个包含消息 “你好 UDP” 的
      <code>
       DatagramPacket
      </code>
      ，并将其发送到目标地址
      <code>
       127.0.0.1
      </code>
      的 9999 端口。
     </li>
     <li>
      <strong>
       接收方接收数据报
      </strong>
      ：当发送方的数据报到达接收方的 9999 端口时，接收方的
      <code>
       receive
      </code>
      方法不再阻塞，将数据报填充到
      <code>
       DatagramPacket
      </code>
      对象中。
     </li>
     <li>
      <strong>
       接收方处理数据
      </strong>
      ：接收方从
      <code>
       DatagramPacket
      </code>
      中获取发送方的地址、端口和消息内容，并将这些信息打印输出。
     </li>
    </ol>
    <h3>
     <a id="_97">
     </a>
     消息发送（多条）
    </h3>
    <p>
     思路就是在发送单条消息的基础上增加循环。
    </p>
    <h4>
     <a id="_101">
     </a>
     示例代码
    </h4>
    <p>
     <strong>
      发送方：
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramPacket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramSocket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpSenderDemo02</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> data <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DatagramPacket</span> datagramPacket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>datagramPacket<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"bye"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我要下线了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="1_135">
     </a>
     代码思路1
    </h5>
    <ul>
     <li>
      创建
      <code>
       DatagramSocket
      </code>
      并绑定到本地 9999 端口，作为发送数据报的端口。
     </li>
     <li>
      创建
      <code>
       BufferedReader
      </code>
      用于读取控制台输入的消息。
     </li>
     <li>
      进入无限循环，读取用户输入的一行文本，将其转换为字节数组。
     </li>
     <li>
      创建
      <code>
       DatagramPacket
      </code>
      对象，包含数据、长度、目标地址（本地主机）和目标端口（8888）。
     </li>
     <li>
      调用
      <code>
       send
      </code>
      方法将数据报发送出去。
     </li>
     <li>
      判断用户输入的消息是否为 “bye”，若是则跳出循环。
     </li>
     <li>
      打印下线信息，关闭
      <code>
       DatagramSocket
      </code>
      释放资源。
     </li>
    </ul>
    <p>
     <strong>
      接收方：
     </strong>
    </p>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramPacket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramSocket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UdpReceiverDemo02</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">DatagramPacket</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            socket<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我接收到你的消息："</span><span class="token operator">+</span>data<span class="token operator">+</span><span class="token string">"了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"bye"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"那我也下线了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="2_176">
     </a>
     代码思路2
    </h5>
    <ul>
     <li>
      创建
      <code>
       DatagramSocket
      </code>
      并绑定到本地 8888 端口，用于监听发送方的数据报。
     </li>
     <li>
      进入无限循环，每次循环创建字节数组缓冲区和
      <code>
       DatagramPacket
      </code>
      对象。
     </li>
     <li>
      调用
      <code>
       receive
      </code>
      方法阻塞等待，直到接收到发送到 8888 端口的数据报。
     </li>
     <li>
      将接收到的字节数组转换为字符串，去除首尾空白字符后打印消息。
     </li>
     <li>
      判断接收到的消息是否为 “bye”，若是则跳出循环。
     </li>
     <li>
      打印下线信息，关闭
      <code>
       DatagramSocket
      </code>
      释放资源。
     </li>
    </ul>
    <h4>
     <a id="_185">
     </a>
     通信过程
    </h4>
    <ol>
     <li>
      <strong>
       启动接收方
      </strong>
      ：接收方程序启动，创建一个绑定到 8888 端口的
      <code>
       DatagramSocket
      </code>
      ，并进入循环等待接收数据报。
     </li>
     <li>
      <strong>
       启动发送方
      </strong>
      ：发送方程序启动，创建一个绑定到 9999 端口的
      <code>
       DatagramSocket
      </code>
      ，并等待用户输入消息。
     </li>
     <li>
      <strong>
       发送消息
      </strong>
      ：用户在发送方的控制台输入消息，发送方将消息封装成
      <code>
       DatagramPacket
      </code>
      并发送到接收方的 8888 端口。
     </li>
     <li>
      <strong>
       接收消息
      </strong>
      ：接收方接收到数据报后，将其转换为字符串并打印出来。
     </li>
     <li>
      <strong>
       结束通信
      </strong>
      ：当发送方输入 “bye” 时，发送方结束循环并关闭
      <code>
       DatagramSocket
      </code>
      。接收方接收到 “bye” 消息后，也结束循环并关闭
      <code>
       DatagramSocket
      </code>
      ，双方通信结束。
     </li>
    </ol>
    <h3>
     <a id="_195">
     </a>
     实现对话（可以接收消息也可以发送消息）
    </h3>
    <h4>
     <a id="_197">
     </a>
     核心思路：
    </h4>
    <p>
     使用多线程，让每个使用者都有两个线程，一个是发送消息线程，一个是接收消息线程。
    </p>
    <p>
     所以实现一个简单对话我们要涉及四个类，一个发送消息的线程、一个接收消息的线程、两个对话的人。
    </p>
    <p>
     以学生与老师的对话为例：
    </p>
    <h4>
     <a id="_205">
     </a>
     示例代码
    </h4>
    <h5>
     <a id="_207">
     </a>
     发送消息的线程：
    </h5>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> fromPort<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> toIp<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> toPort<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SendThread</span><span class="token punctuation">(</span><span class="token keyword">int</span> fromPort<span class="token punctuation">,</span> <span class="token class-name">String</span> toIp<span class="token punctuation">,</span> <span class="token keyword">int</span> toPort<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fromPort <span class="token operator">=</span> fromPort<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toIp <span class="token operator">=</span> toIp<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>toPort <span class="token operator">=</span> toPort<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 绑定发送的端口</span>
            socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fromPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                data <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">DatagramPacket</span> datagramPacket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                datagramPacket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bytes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>toIp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>toPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
                socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>datagramPacket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"bye"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="_261">
     </a>
     代码逻辑分析：
    </h5>
    <ul>
     <li>
      <strong>
       类定义与成员变量
      </strong>
      <ul>
       <li>
        定义了一个名为
        <code>
         SendThread
        </code>
        的类，该类实现了
        <code>
         Runnable
        </code>
        接口，表明它是一个可执行的线程任务。
       </li>
       <li>
        声明了几个成员变量：
        <code>
         DatagramSocket
        </code>
        用于进行 UDP 数据报的发送，
        <code>
         BufferedReader
        </code>
        用于从标准输入读取用户输入的消息，
        <code>
         fromPort
        </code>
        表示发送消息时绑定的本地端口，
        <code>
         toIp
        </code>
        是接收方的 IP 地址，
        <code>
         toPort
        </code>
        是接收方的端口号。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       构造函数
      </strong>
      <ul>
       <li>
        构造函数接收三个参数：
        <code>
         fromPort
        </code>
        、
        <code>
         toIp
        </code>
        和
        <code>
         toPort
        </code>
        ，用于初始化相应的成员变量。
       </li>
       <li>
        在构造函数中，尝试创建一个
        <code>
         DatagramSocket
        </code>
        并将其绑定到指定的本地端口
        <code>
         fromPort
        </code>
        ，若创建失败则抛出运行时异常。
       </li>
       <li>
        创建一个
        <code>
         BufferedReader
        </code>
        对象，用于从标准输入（即控制台）读取用户输入的消息。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       线程执行逻辑（
       <code>
        run
       </code>
       方法）
      </strong>
      <ul>
       <li>
        使用一个无限
        <code>
         while
        </code>
        循环，持续等待用户输入消息。
       </li>
       <li>
        在循环内部，通过
        <code>
         reader.readLine()
        </code>
        方法从标准输入读取一行用户输入的消息，并将其存储在
        <code>
         data
        </code>
        变量中。
       </li>
       <li>
        将读取到的消息转换为字节数组
        <code>
         bytes
        </code>
        。
       </li>
       <li>
        创建一个
        <code>
         DatagramPacket
        </code>
        对象，将字节数组作为数据，指定数据的起始位置和长度，同时设置接收方的 IP 地址和端口号。
       </li>
       <li>
        调用
        <code>
         socket.send(datagramPacket)
        </code>
        方法将数据报包发送出去。
       </li>
       <li>
        检查用户输入的消息是否为
        <code>
         bye
        </code>
        ，如果是，则跳出循环，结束消息发送。
       </li>
      </ul>
     </li>
     <li>
      <strong>
       资源关闭
      </strong>
      <ul>
       <li>
        当循环结束后，调用
        <code>
         socket.close()
        </code>
        方法关闭
        <code>
         DatagramSocket
        </code>
        ，释放相关资源。
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="_280">
     </a>
     接收消息的线程：
    </h5>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramPacket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">DatagramSocket</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">DatagramSocket</span> socket <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> fromMsg <span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> myport<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ReceiveThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> fromMsg<span class="token punctuation">,</span> <span class="token keyword">int</span> myport<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fromMsg <span class="token operator">=</span> fromMsg<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>myport <span class="token operator">=</span> myport<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 绑定接收的端口</span>
            socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>myport<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">DatagramPacket</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            socket<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>packet<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fromMsg<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"bye"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="_329">
     </a>
     代码逻辑分析：
    </h5>
    <p>
     <strong>
      类定义与成员变量
     </strong>
    </p>
    <ul>
     <li>
      定义了一个名为
      <code>
       ReceiveThread
      </code>
      的类，该类实现了
      <code>
       Runnable
      </code>
      接口，这意味着它可以作为一个线程任务来执行。
     </li>
     <li>
      声明了三个成员变量：
      <ul>
       <li>
        <code>
         DatagramSocket socket
        </code>
        ：用于接收 UDP 数据报，它是实现网络通信的关键对象。
       </li>
       <li>
        <code>
         String fromMsg
        </code>
        ：用于标识消息的发送方，在输出消息时会显示该信息。
       </li>
       <li>
        <code>
         int myport
        </code>
        ：表示接收消息时绑定的本地端口号，其他设备将数据发送到该端口。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      构造函数
     </strong>
    </p>
    <ul>
     <li>
      构造函数接收两个参数：
      <code>
       fromMsg
      </code>
      和
      <code>
       myport
      </code>
      ，并将其赋值给对应的成员变量。
     </li>
     <li>
      在构造函数内部，尝试创建一个
      <code>
       DatagramSocket
      </code>
      实例，并将其绑定到指定的本地端口
      <code>
       myport
      </code>
      。如果绑定过程中出现
      <code>
       SocketException
      </code>
      异常，将抛出一个运行时异常。
     </li>
    </ul>
    <p>
     <strong>
      线程执行逻辑（
      <code>
       run
      </code>
      方法）
     </strong>
    </p>
    <ul>
     <li>
      使用一个无限
      <code>
       while
      </code>
      循环，以持续接收消息。
     </li>
     <li>
      在循环内部，执行以下操作：
      <ul>
       <li>
        创建一个长度为 1024 的字节数组
        <code>
         buf
        </code>
        ，用于存储接收到的数据。
       </li>
       <li>
        创建一个
        <code>
         DatagramPacket
        </code>
        对象
        <code>
         packet
        </code>
        ，并将
        <code>
         buf
        </code>
        作为数据缓冲区，指定其长度为 1024。
       </li>
       <li>
        调用
        <code>
         socket.receive(packet)
        </code>
        方法，该方法会阻塞线程，直到接收到一个数据报。
       </li>
       <li>
        将接收到的数据报中的数据转换为字符串
        <code>
         data
        </code>
        。
       </li>
       <li>
        对
        <code>
         data
        </code>
        字符串进行
        <code>
         trim()
        </code>
        操作，去除字符串前后的空白字符。
       </li>
       <li>
        打印接收到的消息，格式为
        <code>
         fromMsg:data
        </code>
        ，方便用户识别消息来源。
       </li>
       <li>
        检查接收到的消息是否为
        <code>
         bye
        </code>
        ，如果是，则跳出循环，结束消息接收。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <strong>
      资源关闭
     </strong>
    </p>
    <ul>
     <li>
      当循环结束后，调用
      <code>
       socket.close()
      </code>
      方法关闭
      <code>
       DatagramSocket
      </code>
      ，释放相关的系统资源，确保程序的资源管理合理。
     </li>
    </ul>
    <h5>
     <a id="_360">
     </a>
     对话的学生类：
    </h5>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TalkStudent</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SendThread</span><span class="token punctuation">(</span><span class="token number">5555</span><span class="token punctuation">,</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReceiveThread</span><span class="token punctuation">(</span><span class="token string">"老师"</span><span class="token punctuation">,</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="_374">
     </a>
     代码逻辑分析：
    </h5>
    <p>
     <strong>
      <code>
       main
      </code>
      方法逻辑
     </strong>
    </p>
    <ul>
     <li>
      <p>
       启动发送消息线程
      </p>
      <ul>
       <li>
        <p>
         创建一个
        </p>
        <pre><code class="prism language-java"><span class="token class-name">SendThread</span>
</code></pre>
        <p>
         对象，构造函数传入三个参数：
        </p>
        <ul>
         <li>
          <code>
           5555
          </code>
          ：表示发送消息时绑定的本地端口号，即该线程将使用本地的 5555 端口来发送数据。
         </li>
         <li>
          <code>
           "127.0.0.1"
          </code>
          ：表示接收方的 IP 地址，这里是本地回环地址，意味着消息将发送到本地的另一个程序。
         </li>
         <li>
          <code>
           7777
          </code>
          ：表示接收方的端口号，即消息将被发送到本地 7777 端口的程序。
         </li>
        </ul>
       </li>
       <li>
        <p>
         将
         <code>
          SendThread
         </code>
         对象作为参数传递给
         <code>
          Thread
         </code>
         类的构造函数，创建一个新的线程。
        </p>
       </li>
       <li>
        <p>
         调用新线程的
         <code>
          start()
         </code>
         方法启动线程，该线程会持续从标准输入读取用户输入的消息，并通过 UDP 协议将消息发送到指定的 IP 地址和端口。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       启动接收消息线程
      </p>
      <ul>
       <li>
        <p>
         创建一个
        </p>
        <pre><code>ReceiveThread
</code></pre>
        <p>
         对象，构造函数传入两个参数：
        </p>
        <ul>
         <li>
          <code>
           "老师"
          </code>
          ：用于标识消息的发送方，在输出接收到的消息时会显示该信息。
         </li>
         <li>
          <code>
           8888
          </code>
          ：表示接收消息时绑定的本地端口号，即该线程将监听本地的 8888 端口，等待接收来自其他程序的消息。
         </li>
        </ul>
       </li>
       <li>
        <p>
         将
         <code>
          ReceiveThread
         </code>
         对象作为参数传递给
         <code>
          Thread
         </code>
         类的构造函数，创建另一个新的线程。
        </p>
       </li>
       <li>
        <p>
         调用该线程的
         <code>
          start()
         </code>
         方法启动线程，该线程会持续监听本地 8888 端口，接收来自其他程序的消息，并将消息按特定格式输出到控制台。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <h5>
     <a id="_415">
     </a>
     对话的老师类：
    </h5>
    <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">protocol</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TalkTeacher</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SendThread</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">,</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReceiveThread</span><span class="token punctuation">(</span><span class="token string">"学生"</span><span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <h5>
     <a id="_429">
     </a>
     代码逻辑分析：
    </h5>
    <ul>
     <li>
      <code>
       main
      </code>
      方法逻辑
      <ul>
       <li>
        启动发送消息线程
        <ul>
         <li>
          创建
          <code>
           SendThread
          </code>
          对象，构造函数传入三个参数。
         </li>
         <li>
          <code>
           9999
          </code>
          ：作为发送消息时绑定的本地端口，即使用本地 9999 端口发送数据。
         </li>
         <li>
          <code>
           "127.0.0.1"
          </code>
          ：接收方的 IP 地址，这里是本地回环地址，表明消息将发送到本地的程序。
         </li>
         <li>
          <code>
           8888
          </code>
          ：接收方的端口号，意味着消息会被发送到本地 8888 端口的程序。
         </li>
         <li>
          将
          <code>
           SendThread
          </code>
          对象传入
          <code>
           Thread
          </code>
          构造函数创建新线程。
         </li>
         <li>
          调用新线程的
          <code>
           start()
          </code>
          方法启动线程，此线程会持续从标准输入读取用户输入的消息，通过 UDP 协议发送到指定的 IP 地址和端口。
         </li>
        </ul>
       </li>
       <li>
        启动接收消息线程
        <ul>
         <li>
          创建
          <code>
           ReceiveThread
          </code>
          对象，构造函数传入两个参数。
         </li>
         <li>
          <code>
           "学生"
          </code>
          ：用于标识消息的发送方，在输出接收到的消息时显示该信息。
         </li>
         <li>
          <code>
           7777
          </code>
          ：接收消息时绑定的本地端口号，即该线程会监听本地 7777 端口，等待接收来自其他程序的消息。
         </li>
         <li>
          将
          <code>
           ReceiveThread
          </code>
          对象传入
          <code>
           Thread
          </code>
          构造函数创建新线程。
         </li>
         <li>
          调用该线程的
          <code>
           start()
          </code>
          方法启动线程，该线程会持续监听本地 7777 端口，接收消息并按特定格式输出到控制台。
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
    <h4>
     <a id="_448">
     </a>
     通信过程
    </h4>
    <h5>
     <a id="_450">
     </a>
     学生端通信过程
    </h5>
    <ol>
     <li>
      启动发送线程
      <ul>
       <li>
        <code>
         TalkStudent
        </code>
        类的
        <code>
         main
        </code>
        方法中创建
        <code>
         SendThread
        </code>
        线程，绑定本地端口 5555。
       </li>
       <li>
        线程启动后，持续从标准输入（控制台）读取用户输入的消息。
       </li>
       <li>
        将读取到的消息封装成
        <code>
         DatagramPacket
        </code>
        ，并发送到老师端的 IP 地址
        <code>
         127.0.0.1
        </code>
        和端口 7777。
       </li>
       <li>
        若用户输入
        <code>
         bye
        </code>
        ，则结束发送线程并关闭
        <code>
         DatagramSocket
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      启动接收线程
      <ul>
       <li>
        创建
        <code>
         ReceiveThread
        </code>
        线程，绑定本地端口 8888，用于接收老师发送的消息。
       </li>
       <li>
        线程启动后，持续监听本地 8888 端口。
       </li>
       <li>
        当接收到老师发送的数据报时，将数据转换为字符串并去除前后空白。
       </li>
       <li>
        以
        <code>
         老师:消息内容
        </code>
        的格式将消息输出到控制台。
       </li>
       <li>
        若接收到的消息为
        <code>
         bye
        </code>
        ，则结束接收线程并关闭
        <code>
         DatagramSocket
        </code>
        。
       </li>
      </ul>
     </li>
    </ol>
    <h5>
     <a id="_464">
     </a>
     老师端通信过程
    </h5>
    <ol>
     <li>
      启动发送线程
      <ul>
       <li>
        <code>
         TalkTeacher
        </code>
        类的
        <code>
         main
        </code>
        方法中创建
        <code>
         SendThread
        </code>
        线程，绑定本地端口 9999。
       </li>
       <li>
        线程启动后，持续从标准输入（控制台）读取用户输入的消息。
       </li>
       <li>
        将读取到的消息封装成
        <code>
         DatagramPacket
        </code>
        ，并发送到学生端的 IP 地址
        <code>
         127.0.0.1
        </code>
        和端口 8888。
       </li>
       <li>
        若用户输入
        <code>
         bye
        </code>
        ，则结束发送线程并关闭
        <code>
         DatagramSocket
        </code>
        。
       </li>
      </ul>
     </li>
     <li>
      启动接收线程
      <ul>
       <li>
        创建
        <code>
         ReceiveThread
        </code>
        线程，绑定本地端口 7777，用于接收学生发送的消息。
       </li>
       <li>
        线程启动后，持续监听本地 7777 端口。
       </li>
       <li>
        当接收到学生发送的数据报时，将数据转换为字符串并去除前后空白。
       </li>
       <li>
        以
        <code>
         学生:消息内容
        </code>
        的格式将消息输出到控制台。
       </li>
       <li>
        若接收到的消息为
        <code>
         bye
        </code>
        ，则结束接收线程并关闭
        <code>
         DatagramSocket
        </code>
        。
       </li>
      </ul>
     </li>
    </ol>
    <h5>
     <a id="_478">
     </a>
     通信交互
    </h5>
    <ul>
     <li>
      学生和老师可以在各自的控制台输入消息，输入的消息会通过 UDP 协议发送到对方对应的端口。
     </li>
     <li>
      双方的接收线程会持续监听相应端口，一旦接收到对方发送的消息，就会将消息显示在控制台。
     </li>
     <li>
      当任何一方输入
      <code>
       bye
      </code>
      时，该方的发送和接收线程都会结束，通信过程终止。
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323530315f39303734353832342f:61727469636c652f64657461696c732f313436323739323932" class_="artid" style="display:none">
 </p>
</div>


