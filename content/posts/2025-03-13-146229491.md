---
layout: post
title: "CentOS7安装DNS服务器bind"
date: 2025-03-13 15:40:17 +0800
description: "添加server域名的解析告诉BIND你有一个名为server的主区域，其区域数据文件位于$TTL 864002025031301;序列号3600;刷新时间1800;重试时间1209600;过期时间86400 );最小TTL;定义名称服务器;将ns1.server.mysql指向具体的IP地址;解析server.mysql到指定的IP地址;定义其他子域或服务的A记录;定义邮件交换记录(MX);定义mail.server.mysql的A记录参数解释$TTL 86400。"
keywords: "CentOS7安装DNS服务器bind"
categories: ['应用服务', 'Linux']
tags: ['运维', '服务器']
artid: "146229491"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146229491
    alt: "CentOS7安装DNS服务器bind"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146229491
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146229491
cover: https://bing.ee123.net/img/rand?artid=146229491
image: https://bing.ee123.net/img/rand?artid=146229491
img: https://bing.ee123.net/img/rand?artid=146229491
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CentOS7安装DNS服务器bind
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <br/>
    需求是公司内网服务器无法连接外网，需要在本地搭建DNS服务，这样物理机器迁移到内网后，通过域名解析访问服务
    <p>
    </p>
    <p>
     DNS服务器
     <code>
      172.25.14.215
     </code>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        ip
       </th>
       <th>
        域名
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        172.25.14.216
       </td>
       <td>
        mysql.server
       </td>
      </tr>
      <tr>
       <td>
        172.25.14.217
       </td>
       <td>
        redis.server
       </td>
      </tr>
      <tr>
       <td>
        172.25.14.218
       </td>
       <td>
        kafka.server
       </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <a id="DNS_12">
     </a>
     安装DNS服务
    </h2>
    <pre><code class="prism language-bash">yum update <span class="token parameter variable">-y</span>
yum <span class="token function">install</span> <span class="token builtin class-name">bind</span> bind-utils <span class="token parameter variable">-y</span>
</code></pre>
    <br/>
    <h2>
     <a id="_21">
     </a>
     设置配置文件
    </h2>
    <p>
     <code>
      vim /etc/named.conf
     </code>
    </p>
    <pre><code class="prism language-shell">options <span class="token punctuation">{<!-- --></span>
    listen-on port <span class="token number">53</span> <span class="token punctuation">{<!-- --></span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> // 监听所有IPv4接口上的53端口
    listen-on-v6 port <span class="token number">53</span> <span class="token punctuation">{<!-- --></span> ::1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> // 监听IPv6本地回环地址上的53端口
    directory       <span class="token string">"/var/named"</span><span class="token punctuation">;</span> // 定义工作目录，区域数据文件存放于此
    dump-file       <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>
    statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>
    memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>
    allow-query     <span class="token punctuation">{<!-- --></span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> // 允许任何主机发送查询请求

    recursion no<span class="token punctuation">;</span> // 禁止递归查询（如果作为权威DNS服务器）

    dnssec-enable <span class="token function">yes</span><span class="token punctuation">;</span>
    dnssec-validation <span class="token function">yes</span><span class="token punctuation">;</span>

    /* Path to ISC DLV key */
    bindkeys-file <span class="token string">"/etc/named.iscdlv.key"</span><span class="token punctuation">;</span>

    managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

logging <span class="token punctuation">{<!-- --></span>
        channel default_debug <span class="token punctuation">{<!-- --></span>
                <span class="token function">file</span> <span class="token string">"data/named.run"</span><span class="token punctuation">;</span>
                severity dynamic<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone <span class="token string">"."</span> IN <span class="token punctuation">{<!-- --></span> // 根区配置
    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span>
    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

// 包含额外的默认配置
include <span class="token string">"/etc/named.rfc1912.zones"</span><span class="token punctuation">;</span>
include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     修改允许的连接为所有
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/305db2d4a28546548296d38530cda328.png"/>
    </p>
    <pre><code class="prism language-bash"><span class="token comment"># 启动服务</span>
systemctl start named

<span class="token comment"># 设置开机自启</span>
systemctl <span class="token builtin class-name">enable</span> named

<span class="token comment"># 开放DNS防火墙，允许DNS流量通过</span>
firewall-cmd --add-service<span class="token operator">=</span>dns <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre>
    <p>
     切换DNS前服务无法正常访问
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/edc96bddafc1433d99cb884d71980739.png"/>
    </p>
    <p>
     由于默认设置了
     <code>
      recursion yes
     </code>
     为yes，表示允许DNS递归查询，通过172.25.14.215的DNS再次进行查询
    </p>
    <p>
     所以切换DNS后服务器正常访问
     <code>
      (这个看业务需求是否关闭DNS递归查询)
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5b35af0f4f85475d98c2e5803a654cbf.png"/>
    </p>
    <br/>
    <h2>
     <a id="_93">
     </a>
     自定义域名解析
    </h2>
    <p>
     <code>
      vim /etc/named.conf
     </code>
     添加
     <code>
      server
     </code>
     域名的解析
    </p>
    <pre><code class="prism language-shell">zone <span class="token string">"server"</span> IN <span class="token punctuation">{<!-- --></span>
    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span>
    <span class="token function">file</span> <span class="token string">"/var/named/server.zone"</span><span class="token punctuation">;</span>
    allow-update <span class="token punctuation">{<!-- --></span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     告诉BIND你有一个名为
     <code>
      server
     </code>
     的主区域，其区域数据文件位于
     <code>
      /var/named/server.zone
     </code>
    </p>
    <pre><code class="prism language-bash"><span class="token variable">$TTL</span> <span class="token number">86400</span>
@   IN  SOA ns1.server. admin.server. <span class="token punctuation">(</span>
            <span class="token number">2025031301</span> <span class="token punctuation">;</span> 序列号
            <span class="token number">3600</span>       <span class="token punctuation">;</span> 刷新时间
            <span class="token number">1800</span>       <span class="token punctuation">;</span> 重试时间
            <span class="token number">1209600</span>    <span class="token punctuation">;</span> 过期时间
            <span class="token number">86400</span> <span class="token punctuation">)</span>    <span class="token punctuation">;</span> 最小TTL

<span class="token punctuation">;</span> 定义名称服务器
@       IN  NS      ns1.server.

<span class="token punctuation">;</span> 将ns1.server.mysql指向具体的IP地址
ns1     IN  A       <span class="token number">192.168</span>.1.10

<span class="token punctuation">;</span> 解析server.mysql到指定的IP地址
@       IN  A       <span class="token number">192.168</span>.1.11

<span class="token punctuation">;</span> 定义其他子域或服务的A记录
www     IN  A       <span class="token number">192.168</span>.1.12
<span class="token function">ftp</span>     IN  A       <span class="token number">192.168</span>.1.13

<span class="token punctuation">;</span> 定义邮件交换记录<span class="token punctuation">(</span>MX<span class="token punctuation">)</span>
@       IN  MX  <span class="token number">10</span>  mail.server.

<span class="token punctuation">;</span> 定义mail.server.mysql的A记录
mail    IN  A       <span class="token number">192.168</span>.1.14
</code></pre>
    <p>
     <strong>
      参数解释
     </strong>
     <br/>
     <code>
      $TTL 86400
     </code>
     ：设置默认的TTL（生存时间），表示该区域中所有资源记录在缓存中的有效期，默认为86400秒（即1天）。可以被单个记录中的TTL覆盖。
    </p>
    <p>
     <code>
      SOA记录
     </code>
     ：
    </p>
    <ul>
     <li>
      <code>
       @ IN SOA ns1.server.mysql. admin.server.mysql. ( ... )
      </code>
     </li>
     <li>
      <code>
       @
      </code>
      表示当前域（本例中是server.mysql）
     </li>
     <li>
      <code>
       IN
      </code>
      表示Internet类记录
     </li>
     <li>
      <code>
       SOA
      </code>
      是Start of Authority的缩写，标记了权威开始的记录
     </li>
     <li>
      <code>
       ns1.server.mysql
      </code>
      . 是主名称服务器的名字
     </li>
     <li>
      <code>
       admin.server.mysql
      </code>
      . 是负责该区域的管理员邮箱地址（注意，在这里使用
      <code>
       .
      </code>
      代替
      <code>
       @
      </code>
      ）。
     </li>
     <li>
      接下来的括号内的数字分别是：
      <ul>
       <li>
        序列号：每次更新区域文件时应该增加这个值，以通知从服务器同步新的数据。
       </li>
       <li>
        刷新时间：从服务器等待多久后再次尝试与主服务器同步。
       </li>
       <li>
        重试时间：如果同步失败，从服务器等待多久后再进行重试。
       </li>
       <li>
        过期时间：如果无法联系上主服务器，从服务器继续使用过期数据的时间长度。
       </li>
       <li>
        最小TTL：设定该区域内所有记录的最小TTL值。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     <code>
      NS记录
     </code>
     ：
    </p>
    <ul>
     <li>
      <code>
       @ IN NS ns1.server.mysql
      </code>
      . 指定
      <code>
       server.mysql
      </code>
      的权威名称服务器是
      <code>
       ns1.server.mysql
      </code>
      .。
     </li>
    </ul>
    <p>
     <code>
      A记录
     </code>
     ：
    </p>
    <ul>
     <li>
      <code>
       ns1 IN A 192.168.1.10
      </code>
      将主机名ns1映射到IP地址
      <code>
       192.168.1.10
      </code>
      。
     </li>
     <li>
      同样地，其他A记录将不同的主机名映射到相应的IP地址。
     </li>
    </ul>
    <p>
     <code>
      MX记录
     </code>
     ：
    </p>
    <ul>
     <li>
      <code>
       @ IN MX 10 mail.server.mysql
      </code>
      . 定义了邮件交换服务器，优先级为10，指向
      <code>
       mail.server.mysql.
      </code>
      。
     </li>
    </ul>
    <br/>
    <h2>
     <a id="_165">
     </a>
     完整配置
    </h2>
    <p>
     <code>
      vim /etc/named.conf
     </code>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/31ab04b619a54ccdb2e53c7ecbc2ac90.png"/>
    </p>
    <p>
     <code>
      vim /var/named/server.zone
     </code>
    </p>
    <pre><code class="prism language-shell"><span class="token variable">$TTL</span> <span class="token number">86400</span>
@   IN  SOA ns1.server. admin.server. <span class="token punctuation">(</span>
            <span class="token number">2025031301</span> <span class="token punctuation">;</span> 序列号
            <span class="token number">3600</span>       <span class="token punctuation">;</span> 刷新时间
            <span class="token number">1800</span>       <span class="token punctuation">;</span> 重试时间
            <span class="token number">1209600</span>    <span class="token punctuation">;</span> 过期时间
            <span class="token number">86400</span> <span class="token punctuation">)</span>    <span class="token punctuation">;</span> 最小TTL

<span class="token punctuation">;</span> 定义名称服务器
@       IN  NS      ns1.server.

<span class="token punctuation">;</span> 将ns1.server指向具体的IP地址
ns1     IN  A       <span class="token number">172.25</span>.14.215

<span class="token punctuation">;</span> 解析server到指定的IP地址
@       IN  A       <span class="token number">172.25</span>.14.215

<span class="token punctuation">;</span> 定义其他子域或服务的A记录
www     IN  A       <span class="token number">172.25</span>.14.215
mysql   IN  A       <span class="token number">172.25</span>.14.216
redis   IN  A       <span class="token number">172.25</span>.14.217
kafka   IN  A       <span class="token number">172.25</span>.14.218
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9d706c54df7e46cdb06824c19da58aa1.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34353635323135302f:61727469636c652f64657461696c732f313436323239343931" class_="artid" style="display:none">
 </p>
</div>


