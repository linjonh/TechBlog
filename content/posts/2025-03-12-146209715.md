---
layout: post
title: "封装AJAX带详细注释"
date: 2025-03-12 17:03:49 +0800
description: "headers: { 'Content-Type': 'application/json' }, // 设置请求头，根据需要修改Content-Type。// 如果不是，则抛出错误。JSON.stringify(data) : null // 如果是POST或PUT请求，可以传递数据体。// 返回一个Promise对象，以便使用async/await处理异步操作。"
keywords: "封装AJAX(带详细注释)"
categories: ['未分类']
tags: ['Okhttp']
artid: "146209715"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146209715
    alt: "封装AJAX带详细注释"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146209715
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146209715
cover: https://bing.ee123.net/img/rand?artid=146209715
image: https://bing.ee123.net/img/rand?artid=146209715
img: https://bing.ee123.net/img/rand?artid=146209715
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     封装AJAX(带详细注释)
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     封装AJAX请求是前端开发中常见的需求，可以帮助我们简化代码，提高可重用性。下面我将通过JavaScript（使用XMLHttpRequest对象）和现代JavaScript（使用Fetch API）两种方式来展示如何封装AJAX请求。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     1. 使用XMLHttpRequest封装AJAX
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     function ajax(method, url, data, callback) {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 创建XMLHttpRequest对象
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     var xhr = new XMLHttpRequest();
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 设置请求方法和URL
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     xhr.open(method, url, true);
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 设置请求头，这里以POST方法为例，如果是GET方法则不需要设置Content-Type
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     if (method === 'POST') {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 定义请求完成后的回调函数
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     xhr.onload = function() {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 请求成功，调用回调函数并传入响应数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     callback(null, xhr.responseText);
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     } else {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 请求失败，调用回调函数并传入错误信息
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     callback(xhr.statusText);
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     };
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 定义请求发生错误时的回调函数
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     xhr.onerror = function() {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     callback('Request failed');
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     };
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 发送请求，如果是POST方法则需要传入data参数，GET方法则不需要
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     xhr.send(data);
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 使用示例
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     ajax('GET', 'https://api.example.com/data', null, function(error, response) {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     if (error) {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     console.error('Error:', error);
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     } else {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     console.log('Response:', response);
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     });
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     2. 使用Fetch API封装AJAX
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     function fetchAjax(method, url, data = null) {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 返回一个Promise对象，以便使用async/await处理异步操作
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     return new Promise((resolve, reject) =&gt; {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 创建fetch请求配置对象
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     const options = {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     method: method, // HTTP方法，如GET、POST等
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     headers: { 'Content-Type': 'application/json' }, // 设置请求头，根据需要修改Content-Type
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     body: data ? JSON.stringify(data) : null // 如果是POST或PUT请求，可以传递数据体
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     };
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 发送fetch请求
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     fetch(url, options)
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .then(response =&gt; {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 检查响应状态码是否在200-299之间，即成功响应范围
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     if (!response.ok) { // 注意这里的!response.ok是检查状态码是否不是2xx的快捷方式
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     throw new Error('Network response was not ok'); // 如果不是，则抛出错误
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     return response.json(); // 将响应体解析为JSON格式，以便后续处理
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     })
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .then(data =&gt; { // 处理解析后的JSON数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     resolve(data); // 使用resolve传递成功结果给Promise的then链或async/await调用者
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     })
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     .catch(error =&gt; { // 捕获并处理错误情况，例如网络错误或解析JSON失败等
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     reject(error); // 使用reject传递错误信息给Promise的catch链或async/await调用者
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     });
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     });
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     // 使用示例（使用async/await）
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     async function fetchData() {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     try {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     const data = await fetchAjax('GET', 'https://api.example.com/data'); // 等待Promise解析完成并获取数据
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     console.log('Data:', data); // 成功获取数据后打印到控制台
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     } catch (error) {
     <!-- -->
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     console.error('Error:', error); // 捕获并打印错误信息到控制台
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     }
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     fetchData(); // 调用函数执行AJAX请求和数据处理流程
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     总结：
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     XMLHttpRequest 是早期浏览器支持的标准方式，适用于所有浏览器。但代码比较繁琐，特别是在处理异步操作时。
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
    </p>
    <p style="margin-left:.0001pt; margin-right:0; text-align:justify">
     Fetch API 是现代浏览器支持的标准方式，提供了更简洁的语法和更好的错误处理机制。它基于Promise，可以轻松与async/await结合使用，使异步代码更加直观和易于管理。推荐在支持Fetch API的现代浏览器中使用。
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f52766572646f7365722f:61727469636c652f64657461696c732f313436323039373135" class_="artid" style="display:none">
 </p>
</div>


