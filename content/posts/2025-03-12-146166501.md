---
layout: post
title: "K8S的搭建"
date: 2025-03-12 10:07:21 +0800
description: "注释：openEuler 系统在跟换源后需要将/etc/yum.repos.d/kubernetes.repo 中的$release 跟换成 8。7.3kubeadm config print init-defaults > kubeadm-init.yaml：设置初始化文件。2.2sysctl -p /etc/sysctl.d/k8s.conf ：让文件生效。永久关闭：sed -i 's/.*swap.*/#&/' /etc/fstab。注释：查看是否出现文件calico.yaml。"
keywords: "K8S的搭建"
categories: ['未分类']
tags: ['容器', '云原生', 'Kubernetes']
artid: "146166501"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146166501
    alt: "K8S的搭建"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146166501
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146166501
cover: https://bing.ee123.net/img/rand?artid=146166501
image: https://bing.ee123.net/img/rand?artid=146166501
img: https://bing.ee123.net/img/rand?artid=146166501
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     K8S的搭建
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      一。关闭防火墙和SELinux
     </strong>
    </p>
    <p>
     1.1systemctl stop firewalld
    </p>
    <p>
     1.2setenfoce 0
    </p>
    <p>
     <strong>
      二。配置内核转发以及网桥过滤
     </strong>
    </p>
    <p>
     2.1vi /etc/sysctl.d/k8s.conf
    </p>
    <p>
     <img alt="" height="124" src="https://i-blog.csdnimg.cn/direct/5edd770d792d4f248d679bebbac3f972.png" width="526"/>
    </p>
    <p>
     2.2sysctl -p /etc/sysctl.d/k8s.conf ：让文件生效
    </p>
    <p>
     2.3modprobe br_netfilter：加载模块
     <br/>
     <img alt="" height="121" src="https://i-blog.csdnimg.cn/direct/ef08e8eb93d0481698bd70bda69e707c.png" width="547"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      三。启动ipvs：
     </strong>
    </p>
    <p>
     3.1vi /etc/sysconfig/modules/ipvs.modules
    </p>
    <p>
     <img alt="" height="268" src="https://i-blog.csdnimg.cn/direct/e1b20230ef5946bc977e23f1c0dda9ad.png" width="1192"/>
    </p>
    <p>
     3.2chmod +x /etc/sysconfig/modules/ipvs.modules
    </p>
    <p>
     3.3bash /etc/sysconfig/modules/ipvs.modules
    </p>
    <p>
    </p>
    <p>
     <strong>
      四。关闭swap分区
     </strong>
    </p>
    <p>
     临时关闭：swapoff  -a
    </p>
    <p>
     永久关闭：sed -i 's/.*swap.*/#&amp;/' /etc/fstab
    </p>
    <p>
    </p>
    <p>
     <strong>
      五。安装docker
     </strong>
    </p>
    <p>
     5.1cd /etc/yum.repos.d/
    </p>
    <p>
     5.2wget  https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
    </p>
    <p>
     注释：openEuler 系统在跟换源后需要将/etc/yum.repos.d/kubernetes.repo 中的$release 跟换成 8
    </p>
    <p>
     5.3yum makecache
    </p>
    <p>
     5.4yum install docker-ce
    </p>
    <p>
     5.5vi /etc/docker/daemon.json
     <br/>
     <img alt="" height="238" src="https://i-blog.csdnimg.cn/direct/056be7fddf3641ab870058d33a105310.png" width="595"/>
    </p>
    <p>
     5.6systemctl restart docker
    </p>
    <p>
    </p>
    <p>
     <strong>
      六。配置cri-dockerd
     </strong>
    </p>
    <p>
     6.1wget -c http://github.com/Mirantis/cri-dockerd/releases/doenload/v0.3.4/cri-dockerd-0.3.14-3.fc36.x86_64.rpm
    </p>
    <p>
     <img alt="" height="39" src="https://i-blog.csdnimg.cn/direct/b76ed2046d744610bf484f77b47ecc43.png" width="448"/>
    </p>
    <p>
     6.2 yum install cri-dockerd-0.3.14-3.fc36.x86_64.rpm
    </p>
    <p>
     6.3vi /usr/lib/systemd/system/cri-docker.service
     <br/>
     <img alt="" height="168" src="https://i-blog.csdnimg.cn/direct/5e9055ab1f1a442c811e432c0bf2ee6f.png" width="1516"/>
    </p>
    <p>
     6.4systemctl start cri-docker.socket cri-docker.service
    </p>
    <p>
     6.5systemctl daemon-reload &amp;&amp; systemctl enable cri-docker.socket &amp;&amp; systemctl status cri-docker.socket cri-docker docker
     <br/>
     <img alt="" height="1194" src="https://i-blog.csdnimg.cn/direct/371f51028b8845d1b7553e738ab5a97a.png" width="1957"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      七。master配置K8s
     </strong>
    </p>
    <p>
     7.1vi /etc/yum.repo.d/kubernets.repo
     <br/>
     <img alt="" height="169" src="https://i-blog.csdnimg.cn/direct/f15ee53c7420487b888cd4061071aa92.png" width="1255"/>
    </p>
    <p>
     7.2yum install  kubeadm-1.30.2 kubelet-1.30.2 kubectl-1.30.2 -y
     <br/>
     如果没有此版本：yum list kubeadm --showduplicates | sort -r 进行选择合适版本
    </p>
    <p>
     7.3kubeadm config print init-defaults &gt; kubeadm-init.yaml：设置初始化文件
    </p>
    <p>
     7.4vi  /var/lib/kubelet/kubeadm-init.yaml
    </p>
    <p>
     <img alt="" height="811" src="https://i-blog.csdnimg.cn/direct/7e5bc2482ac744789da13ff8633fe8e4.png" width="961"/>
    </p>
    <p>
     7.5systemctl restart containerd
     <br/>
     7.6systemctl restart kubelet
    </p>
    <p>
     7.7kubeadm init --config=kubeadm-init.yaml --upload-certs --v=6
    </p>
    <p>
     <img alt="" height="124" src="https://i-blog.csdnimg.cn/direct/d528b79ee42843fb9344827470c14279.png" width="942"/>
    </p>
    <p>
     7.8mkdir -p $HOME/.kube
     <br/>
     7.9sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
     <br/>
     7.10sudo chown $(id -u):$(id -g) $HOME/.kube/config
    </p>
    <p>
     进行检测：
    </p>
    <p>
     <img alt="" height="111" src="https://i-blog.csdnimg.cn/direct/ad93445c8a224dc3967c23e06e8c15ce.png" width="646"/>
    </p>
    <p>
     <img alt="" height="522" src="https://i-blog.csdnimg.cn/direct/ab0bc75401ae48d6a2080c6c6b5295f0.png" width="1171"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      八。其他节点加入master：
     </strong>
    </p>
    <p>
     8.1kubeadm join 192.168.142.133:6443 --token abcdef.0123456789abcdef    --discovery-token-ca-cert-hash sha256:2401632cc943e003df8a840986f340e68b3be20acaf1fdda658049d160c580f3 --cri-socket unix:///var/run/cri-dockerd.sock
     <br/>
     <img alt="" height="418" src="https://i-blog.csdnimg.cn/direct/f78d3e63a6ed4f409c70527e08b129e5.png" width="1185"/>
    </p>
    <p>
     最后验证：
    </p>
    <p>
     <img alt="" height="148" src="https://i-blog.csdnimg.cn/direct/09be443d1fff4393833c33a0a3ed883a.png" width="598"/>
    </p>
    <p>
    </p>
    <p>
     <strong>
      九。master加入网络插件：
     </strong>
    </p>
    <p>
     9.1curl -O https://docs.projectcalico.org/archive/v3.27/manifests/calico.yaml
     <br/>
     <img alt="" height="133" src="https://i-blog.csdnimg.cn/direct/a01e96f149df4d9b9910d5b8322d31ca.png" width="1099"/>
    </p>
    <p>
     9.2vi /root/calico.yaml
    </p>
    <p>
     <img alt="" height="57" src="https://i-blog.csdnimg.cn/direct/cdc96648aa6d421783cee4b20256a0a6.png" width="1081"/>
    </p>
    <p>
     9.3kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml
    </p>
    <p>
     注释：查看是否出现文件calico.yaml
     <br/>
     <img alt="" height="481" src="https://i-blog.csdnimg.cn/direct/a0cfc0910785451b94cc01ada8036a11.png" width="1222"/>
    </p>
    <p>
     9.4kubectl create -f  calico.yaml
    </p>
    <p>
     <img alt="" height="151" src="https://i-blog.csdnimg.cn/direct/3951c21c04fb420086bbd1e434e8948f.png" width="636"/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37383533303833302f:61727469636c652f64657461696c732f313436313636353031" class_="artid" style="display:none">
 </p>
</div>


