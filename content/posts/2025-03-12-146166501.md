---
layout: post
title: "K8S的搭建"
date: 2025-03-12 10:07:21 +0800
description: "注释：openEuler 系统在跟换源后需要将/etc/yum.repos.d/kubernetes.repo 中的$release 跟换成 8。7.3kubeadm config print init-defaults > kubeadm-init.yaml：设置初始化文件。2.2sysctl -p /etc/sysctl.d/k8s.conf ：让文件生效。永久关闭：sed -i 's/.*swap.*/#&/' /etc/fstab。注释：查看是否出现文件calico.yaml。"
keywords: "K8S的搭建"
categories: ['未分类']
tags: ['容器', '云原生', 'Kubernetes']
artid: "146166501"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146166501
    alt: "K8S的搭建"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146166501
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146166501
cover: https://bing.ee123.net/img/rand?artid=146166501
image: https://bing.ee123.net/img/rand?artid=146166501
img: https://bing.ee123.net/img/rand?artid=146166501
---

# K8S的搭建

**一。关闭防火墙和SELinux**

1.1systemctl stop firewalld

1.2setenfoce 0

**二。配置内核转发以及网桥过滤**

2.1vi /etc/sysctl.d/k8s.conf

![](https://i-blog.csdnimg.cn/direct/5edd770d792d4f248d679bebbac3f972.png)

2.2sysctl -p /etc/sysctl.d/k8s.conf ：让文件生效

2.3modprobe br_netfilter：加载模块  
![](https://i-blog.csdnimg.cn/direct/ef08e8eb93d0481698bd70bda69e707c.png)

**三。启动ipvs：**

3.1vi /etc/sysconfig/modules/ipvs.modules

![](https://i-blog.csdnimg.cn/direct/e1b20230ef5946bc977e23f1c0dda9ad.png)

3.2chmod +x /etc/sysconfig/modules/ipvs.modules

3.3bash /etc/sysconfig/modules/ipvs.modules

**四。关闭swap分区**

临时关闭：swapoff -a

永久关闭：sed -i 's/.*swap.*/#&/' /etc/fstab

**五。安装docker**

5.1cd /etc/yum.repos.d/

5.2wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

注释：openEuler 系统在跟换源后需要将/etc/yum.repos.d/kubernetes.repo 中的$release 跟换成 8

5.3yum makecache

5.4yum install docker-ce

5.5vi /etc/docker/daemon.json  
![](https://i-blog.csdnimg.cn/direct/056be7fddf3641ab870058d33a105310.png)

5.6systemctl restart docker

**六。配置cri-dockerd**

6.1wget -c http://github.com/Mirantis/cri-
dockerd/releases/doenload/v0.3.4/cri-dockerd-0.3.14-3.fc36.x86_64.rpm

![](https://i-blog.csdnimg.cn/direct/b76ed2046d744610bf484f77b47ecc43.png)

6.2 yum install cri-dockerd-0.3.14-3.fc36.x86_64.rpm

6.3vi /usr/lib/systemd/system/cri-docker.service  
![](https://i-blog.csdnimg.cn/direct/5e9055ab1f1a442c811e432c0bf2ee6f.png)

6.4systemctl start cri-docker.socket cri-docker.service

6.5systemctl daemon-reload && systemctl enable cri-docker.socket && systemctl
status cri-docker.socket cri-docker docker  
![](https://i-blog.csdnimg.cn/direct/371f51028b8845d1b7553e738ab5a97a.png)

**七。master配置K8s**

7.1vi /etc/yum.repo.d/kubernets.repo  
![](https://i-blog.csdnimg.cn/direct/f15ee53c7420487b888cd4061071aa92.png)

7.2yum install kubeadm-1.30.2 kubelet-1.30.2 kubectl-1.30.2 -y  
如果没有此版本：yum list kubeadm --showduplicates | sort -r 进行选择合适版本

7.3kubeadm config print init-defaults > kubeadm-init.yaml：设置初始化文件

7.4vi /var/lib/kubelet/kubeadm-init.yaml

![](https://i-blog.csdnimg.cn/direct/7e5bc2482ac744789da13ff8633fe8e4.png)

7.5systemctl restart containerd  
7.6systemctl restart kubelet

7.7kubeadm init --config=kubeadm-init.yaml --upload-certs --v=6

![](https://i-blog.csdnimg.cn/direct/d528b79ee42843fb9344827470c14279.png)

7.8mkdir -p $HOME/.kube  
7.9sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config  
7.10sudo chown $(id -u):$(id -g) $HOME/.kube/config

进行检测：

![](https://i-blog.csdnimg.cn/direct/ad93445c8a224dc3967c23e06e8c15ce.png)

![](https://i-blog.csdnimg.cn/direct/ab0bc75401ae48d6a2080c6c6b5295f0.png)

**八。其他节点加入master：**

8.1kubeadm join 192.168.142.133:6443 --token abcdef.0123456789abcdef
--discovery-token-ca-cert-hash
sha256:2401632cc943e003df8a840986f340e68b3be20acaf1fdda658049d160c580f3 --cri-
socket unix:///var/run/cri-dockerd.sock  
![](https://i-blog.csdnimg.cn/direct/f78d3e63a6ed4f409c70527e08b129e5.png)

最后验证：

![](https://i-blog.csdnimg.cn/direct/09be443d1fff4393833c33a0a3ed883a.png)

**九。master加入网络插件：**

9.1curl -O https://docs.projectcalico.org/archive/v3.27/manifests/calico.yaml  
![](https://i-blog.csdnimg.cn/direct/a01e96f149df4d9b9910d5b8322d31ca.png)

9.2vi /root/calico.yaml

![](https://i-blog.csdnimg.cn/direct/cdc96648aa6d421783cee4b20256a0a6.png)

9.3kubectl create -f
https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/calico.yaml

注释：查看是否出现文件calico.yaml  
![](https://i-blog.csdnimg.cn/direct/a0cfc0910785451b94cc01ada8036a11.png)

9.4kubectl create -f calico.yaml

![](https://i-blog.csdnimg.cn/direct/3951c21c04fb420086bbd1e434e8948f.png)



