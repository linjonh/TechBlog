---
layout: post
title: "OSPF-的工作过程Router-ID-机制报文结构"
date: 2025-08-26T11:28:51+0800
description: "视频版讲解&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"
keywords: "ospf执行过程"
categories: ['未分类']
tags: ['网络工程师', '网络', '智能路由器', '数据通信', '开发语言', '华为认证', '华为']
artid: "150849434"
arturl: "https://blog.csdn.net/IT99_/article/details/150849434"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150849434
    alt: "OSPF-的工作过程Router-ID-机制报文结构"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150849434
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150849434
cover: https://bing.ee123.net/img/rand?artid=150849434
image: https://bing.ee123.net/img/rand?artid=150849434
img: https://bing.ee123.net/img/rand?artid=150849434
---



# OSPF 的工作过程、Router ID 机制、报文结构

视频版讲解>>>>>>>>>>>>>>[路由协议深度解析：从静态路由到 OSPF 实战](https://www.borimooc.com/study/1708.htm#118736 "路由协议深度解析：从静态路由到 OSPF 实战")

### 一、回顾静态路由：拓扑与核心逻辑

我们先回到上周讲解的拓扑图，这张图是理解静态路由的核心载体 —— 路由器作为网段分割的核心设备，而两台交换机仅用于扩展端口，不具备分割网段的功能，因此全网可简化为三个网段。默认情况下，PC1 与 PC2 处于不同网段，无法直接互通；要实现二者通信，需在 R1 上配置指向 PC2 所在网段的静态路由，同时在 R2 上配置指向 PC1 所在网段的静态路由，通过手工指定 “目的网段 + 下一跳” 的方式，构建跨网段转发路径。

![](https://i-blog.csdnimg.cn/direct/4809fc81e7d34557b5c0d08de2e65b11.png)

### 二、静态路由的局限性：为何需要动态路由？

静态路由虽能实现基础互通，但在实际网络中存在不可忽视的问题，无法满足复杂场景需求：

1.手工配置易出错：所有路由需管理员逐台设备配置，网络规模越大，配置条目越多，输错网段、下一跳的概率越高；

2.大型网络配置复杂：若网络包含数十台路由器、上百个网段，需维护的静态路由条目呈指数级增长，后期运维成本极高；

3.无法动态适应网络变化：以 “R1→R2→PC2” 为主路径、“R1→R3→PC2” 为备份路径为例，若 R2 与 PC2 之间的链路（如 R2-R4 链路）故障，R1 仅能检测到 “下一跳 R2 可达”，仍会将流量发往 R2，导致数据丢失 ——R1 无法感知 R2 后端的链路故障，无法自动切换到备份路径。

![](https://i-blog.csdnimg.cn/direct/25a2ab86e93d4f7f8afc2ad3b3a04b60.png)

不过静态路由并非完全无用：在小型网络（如仅 2-3 台路由器）或固定网络出口场景（如企业仅一条专线连外网）中，因其 “配置简单、无协议开销” 的特点，仍有广泛应用（后续讲解 NAT 时会进一步展开）。

### 三、动态路由协议：核心特点与分类

静态路由的痛点，正是动态路由协议的优势所在 —— 无需手工配置路由，能自动感知网络变化并调整转发路径。

#### 3.1 动态路由协议的核心优势

1.自动计算路由：无需管理员指定 “目的网段 + 下一跳”，协议会基于网络拓扑自动生成路由条目；

2.动态适配拓扑变化：当链路故障、新增设备或网段时，协议能实时检测变化，自动更新路由表，确保流量始终走最优路径。

#### 3.2 按工作机制分类：距离矢量 vs 链路状态

动态路由协议按算法可分为两类，核心区别在于 “是否传递全网拓扑信息”：

##### （1）距离矢量路由协议（如 RIP、BGP）

仅传递路由信息（目的网段、距离、下一跳），不传递拓扑信息，因此运行该协议的设备 “无法得知全网结构”。

通俗类比：去黑龙江时，打开地图仅搜索 “黑龙江” 的几条候选路径，选标注 “最短” 的一条就出发 —— 但地图可能不是最新版（未标注新修道路或某条路已封闭），最终选的路径可能不是最优的。

![](https://i-blog.csdnimg.cn/direct/968fa3e77b354f848b675bfd665ff500.png)

##### （2）链路状态路由协议（如 OSPF、IS-IS）

既传递路由信息，也传递拓扑信息（全网设备、链路连接关系），运行该协议的设备 “能构建完整的全网拓扑图”。

通俗类比：去黑龙江前，先下载 “全国完整交通地图”（包含所有道路、桥梁、隧道的实时状态），再基于地图遍历所有可能路径，选出真正最优的一条 —— 因考虑了全网信息，不会出现 “选到无效路径” 的问题。

![](https://i-blog.csdnimg.cn/direct/a09c113b7dd648e49c114983545d8665.png)

注：BGP 虽属于距离矢量协议，但因应用场景特殊（多用于跨自治系统路由），IA 阶段暂不深入，重点聚焦链路状态协议中的 OSPF。

### 四、OSPF 实战：链路状态路由协议的核心解析

OSPF（Open Shortest Path First，开放式最短路径优先协议）是 IA 阶段唯一需要掌握的动态路由协议，其名字已点明核心特性：“开放式”（协议标准公开，所有厂商设备支持）、“最短路径优先”（基于全网拓扑计算最优路径）。

#### 4.1 OSPF 的工作过程：三步自动构建路由表

OSPF 的核心目标是 “自动生成路由表”，整个过程无需人工干预，仅需基础配置即可触发，分为三个关键步骤：

##### 步骤 1：建立 OSPF 邻居关系

两台运行 OSPF 的路由器（如 R1 和 R2）初始 “互不认识”，需先通过发送 Hello 报文 建立邻居关系 ——Hello 报文会携带 “OSPF 版本、区域 ID、Router ID” 等信息，确认对方是否为 “同一区域的 OSPF 设备”，完成初步 “认识”。

![](https://i-blog.csdnimg.cn/direct/0479b33326664796a4db27479968d769.png)

##### 步骤 2：同步 LSDB（链路状态数据库）

邻居关系建立后，路由器会开始传递核心信息 ——LSA（链路状态通告），并同步各自的 LSDB（链路状态数据库）：

LSDB：每台 OSPF 路由器都有的 “数据库”，存储全网的路由信息和拓扑信息，相当于 “全网拓扑地图”；

LSA：承载信息的 “载体”，每台路由器会生成包含自身直连网段、邻居信息的 LSA，通过 LSA 与邻居交换信息；

同步逻辑：邻居间互相发送 LSA，“你没有的我发给你，我没有的你发给我”，最终让所有邻居的 LSDB 完全一致（即 “同频”）。

![](https://i-blog.csdnimg.cn/direct/a47eb5d4d58048059bf191c5e435f3d5.png)

##### 步骤 3：SPF 算法计算最优路由

LSDB 同步完成后，每台 OSPF 路由器会自动执行 SPF（最短路径优先）算法：基于同步后的 LSDB（全网拓扑图），计算去往每个网段的 “最短路径”，并将最优路由条目写入自身路由表 —— 至此，OSPF 构建路由表的任务完成，后续数据转发可直接基于路由表进行。

![](https://i-blog.csdnimg.cn/direct/2fd47275facf4258b2dd61bc63bba6bd.png)

#### 4.2 OSPF 报文：驱动协议运行的 “核心载体”

OSPF 的所有工作过程（建立邻居、同步 LSDB、更新路由）都依赖报文实现，需重点掌握 “报文结构” 和 “核心报文类型”。

##### （1）报文三层结构

OSPF 报文工作在 “网络层之上”，自上而下分为三层，各层功能明确：

1.以太网层（数据链路层）：包含源 MAC、目的 MAC，用于局域网内设备间的报文转发；

2.IP 层（网络层）：包含源 IP、目的 IP，且 IP 头部的 “协议号” 为 89（用于标识上层为 OSPF 协议，需重点记忆，常考）；

3.OSPF 层：所有 OSPF 报文的核心，分为 “OSPF 头部” 和 “报文详细内容”—— 所有类型的 OSPF 报文共用相同的 OSPF 头部，仅 “详细内容” 不同。

![](https://i-blog.csdnimg.cn/direct/a338671fc1994f8e96c82b0b7374cbd0.png)

##### （2）核心报文类型

通过抓包可观察到 OSPF 有 5 类核心报文，对应不同工作阶段：

Hello 报文：用于建立和保活邻居关系（步骤 1 核心）；

DD 报文（Database Description）：描述自身 LSDB 的 “摘要”（如包含哪些 LSA 的标识），用于邻居间确认 “哪些 LSA 是对方有而自己没有的”；

LSR 报文（Link State Request）：向邻居请求缺失的 LSA（如发现 DD 报文中有自己没有的 LSA，发送 LSR 索要）；

LSU 报文（Link State Update）：携带具体的 LSA 内容，响应 LSR 请求或主动更新 LSA（步骤 2 核心）；

LSACK 报文（Link State Acknowledgment）：确认收到 LSU 报文，保证 LSA 传递的可靠性。

![](https://i-blog.csdnimg.cn/direct/ee2d2d1abf8b48589d54a663d039d8e2.png)

##### （3）OSPF 头部关键字段

所有 OSPF 报文的头部结构相同，关键字段需理解：

1.Version（版本）：OSPFv2（用于 IPv4 网络，IA 阶段重点）、OSPFv3（用于 IPv6 网络）；

2.Router ID：OSPF 路由器的 “身份证”，唯一标识一台 OSPF 设备（无通信功能，仅用于标识，如 R1 可配置为 1.1.1.1，R2 配置为 2.2.2.2）；

3.区域 ID：OSPF 支持区域划分，IA 阶段仅学 “单区域”—— 骨干区域 ID 为 0，非骨干区域 ID≠0；

4.认证字段：默认全 0（无认证），配置认证后携带认证信息，用于提高 OSPF 网络安全性。

![](https://i-blog.csdnimg.cn/direct/2790a36a6e25494cb1ddecc31a39cf85.png)

#### 4.3 Router ID：OSPF 路由器的 “唯一标识”

Router ID 是 OSPF 的核心标识，需掌握其 “配置方式” 和 “自动选举规则”，确保每台路由器的 Router ID 唯一。

##### （1）手工配置（推荐）

命令：全局视图下执行 `ospf 进程号 router-id 路由器 ID`（如 R1 配置 `ospf 1 router-id 1.1.1.1`）；

作用：① 创建 OSPF 进程；② 指定 Router ID；③ 进入 OSPF 进程视图，用于后续配置；

注意：修改 Router ID 后，需重启 OSPF 进程（用户视图下执行 `reset ospf 进程号`），新 Router ID 才能生效。

![](https://i-blog.csdnimg.cn/direct/17cf5d348adc4c7f8a7ce93af0f01550.png)

##### （2）自动选举（无手工配置时）

若未手工指定 Router ID，设备会按以下优先级自动选举：

![](https://i-blog.csdnimg.cn/direct/5bd96d0cf5a248a89e28d34f63ad548c.png)

1.优先从 Loopback 接口 中选择 “IP 地址最大” 的作为 Router ID（Loopback 接口稳定性高，推荐配置）；

2.若无 Loopback 接口，从 物理接口 中选择 “IP 地址最大” 的作为 Router ID（如 R1 物理接口 IP 为 192.168.1.254 和 10.1.12.1，自动选 192.168.1.254）。



