---
layout: post
title: "嵌入式软件测试的10条秘诀"
date: 2022-05-31 16:32:34 +0800
description: "本文详细介绍了嵌入式软件测试的十大秘诀，强调了使用工具的重要性，如源码级调试器、内存测试工具等，并提"
keywords: "嵌入式测试"
categories: ['Rtos', 'Mcu', 'Linux']
tags: ['测试工具']
artid: "125068225"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=125068225
    alt: "嵌入式软件测试的10条秘诀"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=125068225
featuredImagePreview: https://bing.ee123.net/img/rand?artid=125068225
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     嵌入式软件测试的10条秘诀
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <p>
      文章来源：
      <a href="https://mp.weixin.qq.com/s?__biz=MzI4MDI4MDE5Ng==&amp;mid=2247490992&amp;idx=1&amp;sn=a57af9045049778352f79143cb5cd554&amp;chksm=ebbbb05bdccc394d5c37d3b4cea07542b7fb06453d68bb346f9b64e495b2dacada8668320bec&amp;scene=21#wechat_redirect" rel="nofollow">
       嵌入式软件测试的10条秘诀
      </a>
     </p>
    </blockquote>
    <p>
    </p>
    <div class="toc">
     <h4>
      ...
     </h4>
     <ul>
      <li>
       <a href="#1_15" rel="nofollow">
        1、懂得使用工具
       </a>
      </li>
      <li>
       <a href="#2_90" rel="nofollow">
        2、尽早发现内存问题
       </a>
      </li>
      <li>
       <a href="#3_107" rel="nofollow">
        3、深入理解代码优化
       </a>
      </li>
      <li>
       <a href="#4_116" rel="nofollow">
        4、不要让自己大海捞针
       </a>
      </li>
      <li>
       <a href="#5_129" rel="nofollow">
        5、重现并隔离问题
       </a>
      </li>
      <li>
       <a href="#6_138" rel="nofollow">
        6、以退为进
       </a>
      </li>
      <li>
       <a href="#7_146" rel="nofollow">
        7、确定测试的完整性
       </a>
      </li>
      <li>
       <a href="#8_162" rel="nofollow">
        8、提高代码质量意味着节省时间
       </a>
      </li>
      <li>
       <a href="#9_167" rel="nofollow">
        9、发现它，分析它，解决它
       </a>
      </li>
      <li>
       <a href="#10_172" rel="nofollow">
        10、请利用初学者思维
       </a>
      </li>
      <li>
       <a href="#_176" rel="nofollow">
        总结
       </a>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <p>
     在嵌入式软件开发过程中，一般来说，花在测试和花在编码的时间比为3:1（实际上可能更多）。这个比例随着你的编程和测试水平的提高而不断下降，但不论怎样，软件测试对一般人来讲很重要。
    </p>
    <p>
     很多年前，一位开发人员为了在对嵌入式有更深层次的理解，询问了这样的一个问题：我怎么才能知道并懂得我的系统到底在干些什么呢？
    </p>
    <p>
     面对这个问题有些吃惊，因为在当时没有人这么问过，而同时代的嵌入式开发人员问的最多的大都围绕“我怎么才能使程序跑得更快”、“什么编译器最好”等肤浅的问题。
    </p>
    <p>
     所以，面对这个不同寻常却异乎成熟的问题，我感到欣喜并认真回复了他：你的问题很有深度很成熟，因为只有不断地去深入理解才有可能不断地提高水平。为了鼓励这位执着的程序员，把10条关于嵌入式软件开发测试的秘诀告诉了他。下面我们一起来看看。
    </p>
    <p>
     这十条秘诀在业界广为流传，使很多人受益。本文围绕这十条秘诀展开论述。
    </p>
    <h2>
     <a id="1_15">
     </a>
     1、懂得使用工具
    </h2>
    <p>
     通常嵌入式系统对可靠性的要求比较高。嵌入式系统安全性的失效可能会导致灾难性的后果，即使是非安全性系统，由于大批量生产也会导致严重的经济损失。这就要求对嵌入式系统，包括嵌入式软件进行严格的测试、确认和验证。随着越来越多的领域使用软件和微处理器控制各种嵌入式设备，对日益复杂的嵌入式软件进行快速有效的测试愈加显得重要。
    </p>
    <p>
     就像修车需要工具一样，好的程序员应该能够熟练运用各种软件工具。不同的工具，有不同的使用范围，有不同的功能。使用这些工具，你可以看到你的系统在干些什么，它又占用什么资源，它到底和哪些外界的东西打交道。让你郁闷好几天的问题可能通过某个工具就能轻松搞定，可惜你就是不知道。
    </p>
    <p>
     那么为什么那么多的人总是在折腾个半死之后才想到要用测试工具呢？原因很多，主要有两个：
    </p>
    <p>
     1.一个是害怕；
    </p>
    <p>
     2.另一个是惰性；
    </p>
    <p>
     害怕是因为加入测试工具或测试模块到代码需要技巧同时有可能引入新的错误，所以他们总喜欢寄希望于通过不断地修改重编译代码来消除bug，结果却无济于事。
    </p>
    <p>
     懒惰是因为他们习惯了使用printf之类的简单测试手段。
    </p>
    <p>
     下面来介绍一些嵌入式常用的测试工具
    </p>
    <p>
     <strong>
      (1)、源码级调试器👉[Source-levelDebugger]
     </strong>
    </p>
    <p>
     这种调试器一般提供单步或多步调试、断点设置、内存检测、变量查看等功能，是嵌入式调试最根本有效的调试方法。比如VxWorksTornadoII提供的gdb就属于这一种。
    </p>
    <p>
     <strong>
      (2)、简单实用的打印显示工具👉 [printf]
     </strong>
    </p>
    <p>
     printf或其它类似的打印显示工具估计是最灵活最简单的调试工具。打印代码执行过程中的各种变量可以让你知道代码执行的情况。但是，printf对正常的代码执行干扰比较大（一般printf占用CPU比较长的时间），需要慎重使用，最好设置打印开关来控制打印。
    </p>
    <p>
     <strong>
      (3)、ICE或JTAG调试器👉[In- circuitEmulator]
     </strong>
    </p>
    <p>
     ICE是用来仿真CPU核心的设备，它可以在不干扰运算器的正常运行情况下，实时的检测CPU的内部工作情况。像桌面调试软件所提供的：复杂的条件断点、先进的实时跟踪、性能分析和端口分析这些功能，它也都能提供。ICE一般都有一个比较特殊的CPU，称为外合（bond-out）CPU.这是一种被打开了封装的CPU，并且通过特殊的连接，可以访问到CPU的内部信号，而这些信号，在CPU被封装时，是没法 “看到”的。当和工作站上强大的调试软件联合使用时，ICE就能提供你所能找到的最全面的调试功能。但ICE同样有一些缺点：昂贵；不能全速工作；同样，并不是所有的CPU都可以作为外合CPU的，从另一个角度说，这些外合CPU也不大可能及时的被新出的CPU所更换。JTAG（JointTestActionGroup）虽然它最初开发出来是为了监测IC和电路连接，但是这种串行接口扩展了用途，包括对调试的支持。
    </p>
    <p>
     <strong>
      (4)、ROM监视器👉 [ROMMonitor]
     </strong>
    </p>
    <p>
     ROM监控器是一小程序，驻留在嵌入系统ROM中，通过串行的或网络的连接和运行在工作站上的调试软件通信。这是一种便宜的方式，当然也是最低端的技术。它除了要求一个通信端口和少量的内存空间外，不需要其它任何专门的硬件。
    </p>
    <p>
     提供了如下功能：下载代码、运行控制、断点、单步步进、以及观察、修改寄存器和内存。因为ROM监控器是操作软件的一部分，只有当你的应用程序运行时，它才会工作。如果你想检查CPU和应用程序的状态，你就必须停下应用程序，再次进入ROM监控器。
    </p>
    <p>
     <strong>
      (5)、Data监视器👉 [DataMonitor]
     </strong>
    </p>
    <p>
     这种监视器在不停止CPU运行的情况下不仅可以显示指定变量内容，还可以收集并以图形形式显示各个变量的变化过程。
    </p>
    <p>
     <strong>
      (6)、OS监视器👉 [OperatingSystemMonitor]
     </strong>
    </p>
    <p>
     操作系统监视器可以显示诸如任务切换、信号量收发、中断等事件。一方面，这些监视器能够为你呈现事件之间的关系和时间联系；另一方面，还可以提供对信号量优先级反转、死锁和中断延时等问题的诊断。
    </p>
    <p>
     <strong>
      (7)、性能分析工具👉 [Profiler]
     </strong>
    </p>
    <p>
     可以用来测试CPU到底耗在哪里。profiler工具可以让你知道系统的瓶颈在哪里、CPU的使用率以及需要优化的地方。
    </p>
    <p>
     <strong>
      (8)、内存测试工具👉 [MemoryTeseter]
     </strong>
    </p>
    <p>
     可以找到内存使用的问题所在，比如内存泄露、内存碎片、内存崩溃等问题。如果发现系统出现一些不可预知的或间歇性的问题，就应该使用内存测试工具测测看。
    </p>
    <p>
     <strong>
      (8)、运行跟踪器👉 [ExecutionTracer]
     </strong>
    </p>
    <p>
     可以显示CPU执行了哪些函数、谁在调用、参数是什么、何时调用等情况。这种工具主要用于测试代码逻辑，可以在大量的事件中发现异常。
    </p>
    <p>
     <strong>
      (9)、覆盖工具[CoverageTester]
     </strong>
    </p>
    <p>
     主要显示CPU具体执行了哪些代码，并让你知道那些代码分支没有被执行到哪里。这样有助于提高代码质量并消除无用代码。
    </p>
    <p>
     <strong>
      (10)、GUI测试工具👉 [GUITester]
     </strong>
    </p>
    <p>
     很多嵌入式应用带有某种形式的图形用户界面进行交互，有些系统性能测试是根据用户输入响应时间进行的。GUI测试工具可以作为脚本工具有开发环境中运行测试用例，其功能包括对操作的记录和回放、抓取屏幕显示供以后分析和比较、设置和管理测试过程（Rational 公司的robot和Mercury的Loadrunner工具是杰出的代表）。
    </p>
    <p>
     很多嵌入式设备没有GUI，但常常可以对嵌入式设备进行插装来运行GUI测试脚本，虽然这种方式可能要求对被测代码进行更改，但是节省了功能测试和回归测试的时间。
    </p>
    <p>
     <strong>
      (11)、自制工具👉 [Home-madetester]
     </strong>
    </p>
    <p>
     在嵌入式应用中，有时候为了特定的目的，需要自行编写一些工具来达到某种测试目的。本人曾经编写的视频流录显工具在测试视频会议数据流向和变化上帮了大忙，帮公司找到了几个隐藏很深的bug。
    </p>
    <h2>
     <a id="2_90">
     </a>
     2、尽早发现内存问题
    </h2>
    <p>
     内存问题危害很大，不容易排查，主要有三种类型：内存泄露、内存碎片和内存崩溃。对于内存问题态度必须要明确，那就是早发现早“治疗”。在软件设计中，内存泄露的“名气”最大，主要由于不断分配的内存无法及时地被释放，久而久之，系统的内存耗尽。
    </p>
    <p>
     即使细心的编程老手有时后也会遭遇内存泄露问题。有测试过内存泄露的朋友估计都有深刻地体验，那就是内存泄露问题一般隐藏很深，很难通过代码阅读来发现。有些内存泄露甚至可能出现在库当中。有可能这本身是库中的bug，也有可能是因为程序员没有正确理解它们的接口说明文档造成错用。
    </p>
    <p>
     在很多时候，大多数的内存泄露问题无法探测，但可能表现为随机的故障。程序员们往往会把这种现象怪罪于硬件问题。如果用户对系统稳定性不是很高，那么重启系统问题也不大；但，如果用户对系统稳定很高，那么这种故障就有可能使用户对产品失去信心，同时也意味着你的项目是个失败的项目。
    </p>
    <p>
     由于内存泄露危害巨大，现在已经有许多工具来解决这个问题。这些工具通过查找没有引用或重复使用的代码块、垃圾内存收集、库跟踪等技术来发现内存泄露的问题。每个工具都有利有弊，不过总的来说，用要比不用好。总之，负责的开发人员应该去测试内存泄露的问题，做到防患于未然。
    </p>
    <p>
     内存碎片比内存泄露隐藏还要深。随着内存的不断分配并释放，大块内存不断分解为小块内存，从而形成碎片，久而久之，当需要申请大块内存是，有可能就会失败。如果系统内存够大，那么坚持的时间会长一些，但最终还是逃不出分配失败的厄运。在使用动态分配的系统中，内存碎片经常发生。
    </p>
    <p>
     目前，解决这个问题最效的方法就是使用工具通过显示系统中内存的使用情况来发现谁是导致内存碎片的罪魁祸首，然后改进相应的部分。由于动态内存管理的种种问题，在嵌入式应用中，很多公司干脆就禁用malloc/free的以绝后患。
    </p>
    <p>
     内存崩溃是内存使用最严重的结果，主要原因有数组访问越界、写已经释放的内存、指针计算错误、访问堆栈地址越界等等。这种内存崩溃造成系统故障是随机的，而且很难查找，目前提供用于排查的工具也很少。
    </p>
    <p>
     总之，如果要使用内存管理单元的话，必须要小心，并严格遵守它们的使用规则，比如谁分配谁释放。
    </p>
    <h2>
     <a id="3_107">
     </a>
     3、深入理解代码优化
    </h2>
    <p>
     讲到系统稳定性，人们更多地会想到实时性和速度，因为代码效率对嵌入式系统来说太重要了。知道怎么优化代码是每个嵌入式软件开发人员必须具备的技能。就像女孩子减肥一样，起码知道她哪个地方最需要减，才能去购买减肥药或器材来减掉它。
    </p>
    <p>
     可见，代码优化的前提是找到真正需要优化的地方，然后对症下药，优化相应部分的代码。前面提到的profile（性能分析工具，一些功能齐全IDE都提供这种内置的工具）能够记录各种情况比如各个任务的CPU占用率、各个任务的优先级是否分配妥当、某个数据被拷贝了多少次、访问磁盘多少次、是否调用了网络收发的程序、测试代码是否已经关闭等等。
    </p>
    <p>
     但是，profile工具在分析实时系统性能方面还是有不够的地方。一方面，人们使用profile工具往往是在系统出现问题即CPU耗尽之后，而 profile工具本身对CPU占用较大，所以profile对这种情况很可能不起作用。根据Heisenberg效应，任何测试手段或多或少都会改变系统运行，这个对profiler同样适用！
    </p>
    <p>
     总之，提高运行效率的前提是你必须要知道CPU到底干了些什么干的怎么样。
    </p>
    <h2>
     <a id="4_116">
     </a>
     4、不要让自己大海捞针
    </h2>
    <p>
     大海捞针只是对调试的一种生动比喻。经常听到组里有人对自己正在调试的代码说shit！可以理解，因为代码不是他写的，他有足够的理由去 shitbug百出的代码，只要他自己不要写出这种代码，否则有一天同组的其它人可能同样会shit他写的代码。为何会有大海捞针呢？肯定是有人把针掉到海里咯；那针为何会掉在海里呢？肯定是有人不小心或草率呗。
    </p>
    <p>
     所以当你在抱怨针那么难找的时候，你是否想过是你自己草率地丢掉的。同样，当你调试个半死的时候，你是否想过你要好好反省一下当初为了寻求捷径可能没有严格地遵守好的编码设计规范、没有检测一些假设条件或算法的正确性、没有将一些可能存在问题的代码打上记号呢？
    </p>
    <p>
     关于如何写高质量请参考林锐的《高质量c++/c编程指南》或《关于C的0x8本“经书》。
    </p>
    <p>
     如果你确实已经把针掉在海里是，为了防止在找到之前刺到自己，你必须要做一些防范工作，比如戴上安全手套。同样，为了尽能地暴露和捕捉问题根源，我们可以设计比较全面的错误跟踪代码。
    </p>
    <p>
     怎么来做呢？
    </p>
    <p>
     尽可能对每个函数调用失败作出处理，尽可能检测每个参数输入输出的有效性，包括指针以及检测是否过多或过少地调用某个过程。错误跟踪能够让你知道你大概把针掉在哪个位置。
    </p>
    <h2>
     <a id="5_129">
     </a>
     5、重现并隔离问题
    </h2>
    <p>
     如果你不是把针掉在大海了，而是掉在草堆里，那要好办些。因为至少我们可以把草堆分成很多块，一块一块的找。对于模块独立的大型项目，使用隔离方法往往是对付那些隐藏极深bug的最后方法。
    </p>
    <p>
     如果问题的出现是间歇性的，我们有必要设法去重现它并记录使其重现的整个过程以备在下一次可以利用这些条件去重现问题。如果你确信可以使用记录的那些条件去重现问题，那么我们就可以着手去隔离问题。
    </p>
    <p>
     怎么隔离呢？
    </p>
    <p>
     我们可以用#ifdef把一些可能和问题无关的代码关闭，把系统最小化到仍能够重现问题的地步。如果还是无法定位问题所在，那么有必要打开“工具箱”了。可以试着用ICE或数据监视器去查看某个可疑变量的变化；可以使用跟踪工具获得函数调用的情况包括参数的传递；检查内存是否崩溃以及堆栈溢出的问题。
    </p>
    <h2>
     <a id="6_138">
     </a>
     6、以退为进
    </h2>
    <p>
     猎人为了不使自己在森林里迷路，他常常会在树木上流下一些标记，以备自己将来有一天迷路时可以根据这些标记找到出路。对过去代码的修改进行跟踪记录对将来出现问题之后的调试很有帮助。
    </p>
    <p>
     假如有一天，你最近一次修改的程序跑了很久之后忽然死掉了，那么你这时的第一反映就是我到底改动了些什么呢，因为上次修改之前是好的。那么如何检测这次相对于上次的修改呢？没错，代码控制系统SCS或称版本控制系统 VCS可以很好地解决这个问题。
    </p>
    <p>
     将上个版本checkin下来后和当前测试版本比较。比较的工 具可以是SCS/VCS/CVS自带的diff工具或其它功能更强的比较工具，比如BeyondCompare和 ExamDiff。通过比较，记录所有改动的代码，分析所有可能导致问题的可疑代码。
    </p>
    <h2>
     <a id="7_146">
     </a>
     7、确定测试的完整性
    </h2>
    <p>
     你怎么知道你的测试有多全面呢？覆盖测试（coveragetesting）可以回答这个问题。覆盖测试工具可以告诉你CPU到底执行了哪些代码。好的覆盖工具通常可以告诉你大概20%到40% 代码没有问题，而其余的可能存在bug.覆盖工具有不同的测试级别，用户可以根据自己的需要选择某个级别。
    </p>
    <p>
     即使你很确信你的单元测试已经很全面并且没有 deadcode，覆盖工具还是可以为你指出一些潜在的问题。
    </p>
    <p>
     看下面的代码：
    </p>
    <pre><code class="prism language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>almostAlwaysZero<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span><span class="token punctuation">(</span>last<span class="token operator">=</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     如果almostAlwaysZero为非０，那么last=i赋值语句就被跳过，这可能不是你所期望的。
    </p>
    <p>
     这种问题通过覆盖工具的条件测试功能可以轻松得被发现。总之，覆盖测试对于提高代码质量很有帮助。
    </p>
    <h2>
     <a id="8_162">
     </a>
     8、提高代码质量意味着节省时间
    </h2>
    <p>
     有研究表明软件开发的时间超过80%被用在下面几个方面：调试自己的代码（单元测试）。调试自己和其他相关的代码（模块间测试）。调试整个系统（系统测试），更糟糕的是你可能需要花费10-200倍的时间来找一个 bug，而这个bug在开始的时候可能很容易就能找到。
    </p>
    <p>
     一个小bug可能让你付出巨大的代价，即使这个bug对整个系统的性能没有太大的影响，但很可能会影响让那些你可以看得到的部分。所以我们必须要养成良好的编码和测试手段以求更高的代码质量，以便缩短调试的代码。
    </p>
    <h2>
     <a id="9_167">
     </a>
     9、发现它，分析它，解决它
    </h2>
    <p>
     这世界没有万能的膏药。profile再强大也有力不从心的时候；内存监视器再好，也有无法发现的时候；覆盖工具再好用，也有不能覆盖的地方。
    </p>
    <p>
     一些隐藏很深的问题即使用尽所有工具也有可能无法查到其根源，这时我们能做的就是通过这些问题所表现出来的外在现象或一些数据输出来发现其中的规律或异常。一旦发现任何异常，一定要深入地理解并回溯其根源，直到解决为止。
    </p>
    <h2>
     <a id="10_172">
     </a>
     10、请利用初学者思维
    </h2>
    <p>
     有人这样说过：“有些事情在初学者的脑子里可能有各种各样的情况，可在专家的头脑里可能就很单一”。有时候，有些简单的问题会被想得很复杂，有些简单的系统被设计得很复杂，就是由于你的“专家思维”。当你被问题难住时，关掉电脑，出去走走，把你的问题和你的朋友甚至你的小狗说说，或许他们可以给你意想不到的启发。
    </p>
    <h2>
     <a id="_176">
     </a>
     总结
    </h2>
    <p>
     嵌入式调试也是一门艺术。就想其它的艺术一样，如果你想取得成功，你必须具备智慧、经验并懂得使用工具。只要我们能够很好地领悟Oracle这十条秘诀，我相信我们在嵌入式测试方面就能够取得成功。
    </p>
    <p>
     <strong>
      版权归原作者所有，如有侵权，请联系删除。
     </strong>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33383237353733352f:61727469636c652f64657461696c732f313235303638323235" class_="artid" style="display:none">
 </p>
</div>


