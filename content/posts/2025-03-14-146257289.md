---
layout: post
title: "使用GitHub-Actions实现Git推送自动部署到服务器"
date: 2025-03-14 14:43:08 +0800
description: "将网站一键部署到服务器的方案很多，比如纯Shell脚本结合SSH、Jenkins等工具。本文将介绍如何利用GitHub Actions这一免费且轻量的CI/CD工具，实现代码推送后自动部署到云服务器。之前一直在使用github的工作流，确实是一个比较好用的工具。我之前用来构建公开静态文件仓库，让vercel来管理静态网站，这次我把所有的服务都迁移到了云服务器，所以所有的部署都需要重新调整一下。还是老样子，先介绍一下我的场景和配置。"
keywords: "使用GitHub Actions实现Git推送自动部署到服务器"
categories: ['博客']
tags: ['服务器', 'Github', 'Git']
artid: "146257289"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146257289
    alt: "使用GitHub-Actions实现Git推送自动部署到服务器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146257289
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146257289
cover: https://bing.ee123.net/img/rand?artid=146257289
image: https://bing.ee123.net/img/rand?artid=146257289
img: https://bing.ee123.net/img/rand?artid=146257289
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用GitHub Actions实现Git推送自动部署到服务器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <pre><span style='color:#4d4d4d; font-family:-apple-system,"SF UI Text",Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif,SimHei,SimSun; font-size:16px'>将网站一键部署到服务器的方案很多，比如纯Shell脚本结合SSH、Jenkins等工具。本文将介绍如何利用GitHub Actions这一免费且轻量的CI/CD工具，实现代码推送后自动部署到云服务器。</span></pre>
    <p>
    </p>
    <p class="img-center">
     <img alt="image-20250314144041545" height="799" src="https://i-blog.csdnimg.cn/img_convert/c93ab1ba3158df48aaab5d384a33f3ad.png" width="1933"/>
    </p>
    <p>
     之前一直在使用github的工作流，确实是一个比较好用的工具。
    </p>
    <p>
     我之前用来构建公开静态文件仓库，让vercel来管理静态网站，这次我把所有的服务都迁移到了云服务器，所以所有的部署都需要重新调整一下。
    </p>
    <p>
     还是老样子，先介绍一下我的场景和配置。
    </p>
    <h3>
     前置条件
    </h3>
    <ul>
     <li>
      <p>
       <strong>
        项目类型
       </strong>
       : 静态网站（示例使用Hexo）
      </p>
     </li>
     <li>
      <p>
       <strong>
        服务器环境
       </strong>
       : Linux系统（示例为Ubuntu）
      </p>
     </li>
    </ul>
    <h3>
     服务器配置
    </h3>
    <h5>
     1. 创建专用部署用户
    </h5>
    <pre># 创建新用户
sudo adduser git --disabled-password
​
# 切换到该用户
sudo su - git
​
# 创建.ssh目录
mkdir -p ~/.ssh &amp;&amp; chmod 700 ~/.ssh</pre>
    <h5>
     2. 生成 SSH 密钥对
    </h5>
    <pre># 在服务器生成密钥（也可本地生成后传公钥）
sudo ssh-keygen -t ed25519 -C "github-actions-deploy-key" -f ~/.ssh/github_actions</pre>
    <h5>
     3. 配置授权公钥
    </h5>
    <pre># 将公钥加入授权列表
sudo sh -c 'cat /home/git/.ssh/github_actions.pub &gt;&gt; /home/git/.ssh/authorized_keys'
​
# 设置权限
sudo chmod 600 ~/.ssh/authorized_keys
sudo chmod 644 ~/.ssh/github_actions.pub</pre>
    <h5>
     4. 目标目录权限
    </h5>
    <pre># 假设部署目录为 /var/www/blog
sudo mkdir -p /var/www/blog
sudo chown -R deployer:deployer /var/www/blog</pre>
    <h5>
     5.获取private key
    </h5>
    <pre>sudo cat ~/.ssh/github_actions</pre>
    <p>
     正常情况会返回这样的文本：
    </p>
    <pre>-----BEGIN OPENSSH PRIVATE KEY-----
-----END OPENSSH PRIVATE KEY-----</pre>
    <h5>
     6.调整ssh配置
    </h5>
    <pre>/etc/ssh/sshd_config</pre>
    <pre># 启用密钥认证
PubkeyAuthentication yes      
# 禁用密码登录
PasswordAuthentication no      
# 允许部署用户
AllowUsers deployer            </pre>
    <pre>sudo systemctl restart ssh</pre>
    <h5>
     如果遇到权限问题
    </h5>
    <pre># 切换到root再执行
chmod 700 ~git/.ssh
chmod 600 ~git/.ssh/authorized_keys
chown -R git:git ~git/.ssh
​
# 最后的路径调整成静态文件路径
sudo chown -R git:git /www/wwwroot
​
sudo setfacl -R -m u:git:rwx /www/wwwroot
sudo setfacl -Rd -m u:git:rwx /www/wwwroot</pre>
    <h3>
     Github仓库配置
    </h3>
    <h4>
     1. 添加仓库密钥
    </h4>
    <ol>
     <li>
      <p>
       访问仓库 Settings &gt; Secrets &gt; Actions
      </p>
     </li>
     <li>
      <p>
       点击 New repository secret
      </p>
     </li>
     <li>
      <p>
       输入名称
       <code>
        SERVER_SSH_KEY
       </code>
       ，值粘贴前文获取的
       <a href="5.%E8%8E%B7%E5%8F%96private%20key" rel="nofollow">
        私钥内容
       </a>
      </p>
     </li>
    </ol>
    <h4>
     2. 配置工作流文件
    </h4>
    <p>
     创建
     <code>
      .github/workflows/deploy.yml
     </code>
     内容如下：
    </p>
    <pre>name: Deploy Blog  # 工作流名称，显示在Actions面板

on: [push]  # 触发条件：任何git push操作

jobs:
  build:   # 任务ID，可自定义
    runs-on: ubuntu-latest  # 使用GitHub托管的Ubuntu运行器

    steps:
      - name: Checkout code  # 步骤1：拉取仓库代码
        uses: actions/checkout@v4  # 官方检出插件

      - name: Install and Build  # 步骤2：安装依赖并构建
        run: |                   # 多行命令执行器
          npm install
          npm run build

      - name: Deploy to Server  # 步骤3：部署到服务器
        uses: easingthemes/ssh-deploy@main  # 第三方SSH部署插件
        env:
          SSH_PRIVATE_KEY: ${<!-- -->{ secrets.SERVER_SSH_KEY }}  # 从仓库密钥读取私钥
          REMOTE_HOST: ""  # 服务器公网IP或域名
          REMOTE_USER: "git"  # 步骤1创建的用户
          SOURCE: "public/"  # 本地构建输出目录
          TARGET: "/www/wwwroot/guoshunfa.com"  # 服务器目标目录
          ARGS: "-avz --chown=git:git"  # rsync参数：归档模式/压缩/删除多余文件</pre>
    <p>
     到这所有的配置就结束了。
    </p>
    <h3>
     验证效果
    </h3>
    <ol>
     <li>
      <p>
       本地修改后执行Git推送：
      </p>
      <pre>git add .
git commit -m "触发自动部署"
git push origin main</pre>
     </li>
     <li>
      <p>
       登录GitHub仓库，进入
       <strong>
        Actions
       </strong>
       标签页查看执行状态
      </p>
     </li>
     <li>
      <p>
       成功完成后，访问服务器目标目录确认文件更新
      </p>
     </li>
    </ol>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34343435303934372f:61727469636c652f64657461696c732f313436323537323839" class_="artid" style="display:none">
 </p>
</div>


