---
layout: post
title: "银河麒麟V10服务器系统UEFI模式PXE部署"
date: 2024-12-08 12:11:45 +0800
description: "本文详细介绍了如何在银河麒麟V10服务器上通过UEFI模式进行PXE部署，包括PXE的基本概念、所需"
keywords: "pxe uefi"
categories: ['麒麟操作系统运维', 'Linux']
tags: ['运维', '服务器', 'Linux', 'Kylin']
artid: "130845884"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=130845884
    alt: "银河麒麟V10服务器系统UEFI模式PXE部署"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=130845884
featuredImagePreview: https://bing.ee123.net/img/rand?artid=130845884
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     银河麒麟V10服务器系统UEFI模式PXE部署
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     <strong>
      银河麒麟V10服务器UEFI模式PXE部署
     </strong>
    </p>
    <h2>
     <a id="PXE_2">
     </a>
     一、PXE简介
    </h2>
    <p>
     ​ 所谓的PXE是Preboot Execution Environment的缩写，字面上的意思是开机前的执行环境。
    </p>
    <p>
     ​ PXE是由Intel设计的协议，它可以使计算机通过网络启动。协议分为client和server两端，PXE client在网卡的ROM中，当计算机引导时，BIOS把PXE client调入内存执行，并显示出命令菜单，经用户选择后，PXE client将放置在远端的操作系统通过网络下载到本地运行。
    </p>
    <p>
     ​ vmlinuz：核心文件(kernel file)
    </p>
    <p>
     ​ initrd.img：开启过程中核心组件的参数
    </p>
    <p>
     ​ kylin-ks.cfg --&gt; demo：开机pxe选择参考
    </p>
    <h2>
     <a id="PXE_14">
     </a>
     二、PXE基本条件
    </h2>
    <p>
     ​ DHCP：提供网络参数，告知客户端TFTP位置
    </p>
    <p>
     ​ TFTP：提供boot loader及kernel file下载路径
    </p>
    <p>
     ​ HTTP/FTP/NFS:三种架构提供内核文件
    </p>
    <h2>
     <a id="PXEV10_Server_GFB_22">
     </a>
     三、PXE服务端部署(V10_Server_GFB为例)
    </h2>
    <h3>
     <a id="1_24">
     </a>
     1.挂载镜像
    </h3>
    <p>
     ​ mkdir /tmpmnt
    </p>
    <p>
     ​ mkdir /tmpmedia
    </p>
    <p>
     ​ mount -o loop Kylin-Server-V10_U1-Release-Build02-20210824-GFB-x86_64.iso /tmpmnt/
    </p>
    <p>
     ​ mount /tmpmnt/images/efiboot.img /tmpmedia/
    </p>
    <h3>
     <a id="2selinux_36">
     </a>
     2.关闭防火墙和selinux
    </h3>
    <p>
     ​ systemctl stop firewalld
    </p>
    <p>
     ​ setenforce 0
    </p>
    <p>
     ​ sed -i ‘s/SELINUX=enforcing/SELINUX=disabled/’ /etc/selinux/config
    </p>
    <h3>
     <a id="3DHCP_46">
     </a>
     3.安装DHCP
    </h3>
    <p>
     ​ yum install -y dhcp
    </p>
    <p>
     ​ 配置文件: /etc/dhcp/dhcpd.conf
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/fe0ae2fdc7d51d2369a0deae6bbec52c.png"/>
    </p>
    <p>
     <strong>
      filename值取uefi模式x86为grubx64.efi，arm为grubaa64.efi，subnet请按照现场实际情况填写。
     </strong>
    </p>
    <p>
     启动服务：systemctl start dhcpd systemctl enable dhcpd
    </p>
    <h3>
     <a id="4tftpxinetd_62">
     </a>
     4.安装tftp和xinetd
    </h3>
    <h4>
     <a id="1yum_install_y_tftp_tftpserver_xinetd_64">
     </a>
     (1)yum install -y tftp tftp-server xinetd
    </h4>
    <h4>
     <a id="2_vim_etcxinetddtftp_66">
     </a>
     (2)配置: vim /etc/xinetd.d/tftp
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/c6068b7087e67febb685216af9b8bc28.png"/>
    </p>
    <h4>
     <a id="3pxebootgrubefigrubcfgtftp_71">
     </a>
     (3)拷贝pxeboot目录下的文件、grub*.efi、grub.cfg到tftp
    </h4>
    <p>
     ​ rm -rf /var/lib/tftpboot/*
    </p>
    <p>
     ​ cp -rf /tmpmnt/images/pxeboot/* /var/lib/tftpboot
    </p>
    <p>
     ​ cp -f /tmpmnt/EFI/BOOT/grub*.efi /var/lib/tftpboot
    </p>
    <p>
     ​ cp -f /tmpmnt/EFI/BOOT/grub.cfg /var/lib/tftpboot
    </p>
    <h4>
     <a id="4varlibtftpbootgrubcfg_83">
     </a>
     (4)配置/var/lib/tftpboot/grub.cfg
    </h4>
    <p>
     ​ 删除所有系统菜单，只添加PXE菜单即可(### BEGIN /etc/grub.d/10_linux ###这一行以后全部删除)，添加内容如下：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/3b6ccca5c0161d94df8fe6ecf1466b2c.png"/>
    </p>
    <h4>
     <a id="5_90">
     </a>
     (5)启动服务
    </h4>
    <p>
     ​ chmod -R 755 /var/lib/tftpboot
    </p>
    <p>
     ​ systemctl start xinetd
    </p>
    <p>
     ​ systemctl enable xinetd
    </p>
    <p>
     ​ systemctl start tftp
    </p>
    <p>
     ​ systemctl enable tftp
    </p>
    <h3>
     <a id="5http_102">
     </a>
     5.安装http
    </h3>
    <p>
     ​ yum install -y httpd
    </p>
    <p>
     ​ mkdir /var/www/html/kylin
    </p>
    <h4>
     <a id="1_108">
     </a>
     (1)同步镜像文件
    </h4>
    <p>
     ​ rsync -a /tmpmnt/ /var/www/html/kylin/
    </p>
    <p>
     ​ chmod -R 755 /var/www/html/kylin
    </p>
    <h4>
     <a id="2grubcfg_114">
     </a>
     (2)拷贝grub.cfg
    </h4>
    <p>
     ​ cp -f /var/lib/tftpboot/grub.cfg /var/www/html/kylin/EFI/BOOT/grub.cfg
    </p>
    <h4>
     <a id="3_118">
     </a>
     (3)启动服务
    </h4>
    <p>
     ​ systemctl start httpd
    </p>
    <p>
     ​ systemctl enable httpd
    </p>
    <h3>
     <a id="6kickstart_126">
     </a>
     6.kickstart
    </h3>
    <p>
     ​ mkdir /var/www/html/ks
    </p>
    <p>
     ​ cp /root/anaconda-ks.cfg /var/www/html/ks/kylin-ks.cfg
    </p>
    <p>
     ​ chmod 755 /var/www/html/ks/kylin-ks.cfg
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/6107b10d4fe38665df388736938eb8cd.png"/>
    </p>
    <p>
     ​ 只需要修改部分参数：
    </p>
    <p>
     ​
     <strong>
      rootpw –iscrypted:这个参数是设置PXE客户机的root密码，默认是密文，不修改就是当前PXE服务器的密码。
     </strong>
    </p>
    <p>
     ​
     <strong>
      密文生成方式：
     </strong>
    </p>
    <p>
     ​ vim /tmp/rootpw.py
    </p>
    <p>
     ​ #!/usr/bin/python
    </p>
    <p>
     ​ import crypt
    </p>
    <p>
     ​ print(crypt.crypt(“
     <strong>
      qwer1234!@#$
     </strong>
     ”)) 这里填写想要设置的密码即可
    </p>
    <h3>
     <a id="7YUM_151">
     </a>
     7.YUM源配置
    </h3>
    <p>
     ​ vim /etc/yum.repos.d/network.repo
    </p>
    <p>
     ​ [network]
    </p>
    <p>
     ​ name=network repo
    </p>
    <p>
     ​ baseurl=http://192.168.253.242/kylin
    </p>
    <p>
     ​ enable=1
    </p>
    <p>
     ​ gpgcheck=0
    </p>
    <p>
     ​
     <strong>
      到这里PXE服务端配置完成，客户端在启动时候选择网络安装即可
     </strong>
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2722796700f64b7bc3a4a7cc89d71eba.png"/>
    </p>
    <h2>
     <a id="kickstart_174">
     </a>
     四、kickstart自动安装脚本文件
    </h2>
    <h3>
     <a id="1kickstart_176">
     </a>
     1.在kickstart安装脚本中自定义安装软件包/组
    </h3>
    <p>
     在kickstart文件里使用****%packages***
     <em>
      命令来列出想安装的软件包，相关软件包的组的列表,参考系统Linux光盘里的/repodata/
     </em>
     -comps.xml. 每个组都有一个编号,用户可见性的值,名字,描述和软件包列表.在软件包列表里,如果这个组被选择的话,组里的标记为"mandatory"的软件包就必须被安装；标记为"default"的软件包缺省被选择；而标记为"optional"的软件包必须被明确地选定才会被安装。
    </p>
    <p>
     语法格式如下：
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/f792869212fa335dffe4f12c54bd9d70.png"/>
    </p>
    <p>
     <strong>
      注： @^ 开头指定环境组包
      <br/>
      ​ @ 开头指定软件组包
     </strong>
    </p>
    <h3>
     <a id="2kickstart_188">
     </a>
     2.kickstart安装脚本中指定自定义分区
    </h3>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/8acbabf4c93f1c82508d42b3efc3859d.png"/>
    </p>
    <p>
     volgroup：创建卷组，klas为卷组名称，pesize用来设置默认pe大小，pv.316是物理卷
    </p>
    <p>
     logvol：创建逻辑卷，/为挂载点，fstype指定文件系统类型，size指定大小，name指定名字，后面根卷组名称
    </p>
    <p>
     part：创建分区，后面根挂载点，fstype指定文件系统类型，ondisk指定分区落在哪块磁盘，szie指定大小。
    </p>
    <p>
     注：以上指定的为系统分区为逻辑卷的场景，如果系统分区不采用逻辑卷模式，使用part命令指定挂载点、分区类型、大小即可。
    </p>
    <h3>
     <a id="3PXE_209">
     </a>
     3.PXE环境自定义分区和按需装包测试
    </h3>
    <h4>
     <a id="1kshttp_211">
     </a>
     (1)拷贝ks文件到http共享路径下：
    </h4>
    <p>
     ​ cp anaconda-ks.cfg /var/www/html/ks/kylin-ks.cfg
    </p>
    <h4>
     <a id="2kylinkscfg_215">
     </a>
     (2)修改kylin-ks.cfg,指定分区和要安装的软件包
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9ce18a422dfec144a4b326a8f52f67eb.png"/>
    </p>
    <p>
     ​ --size=1 --grow 就是把剩余空间都给了根分区
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/88fbd70588e9aa4bea5e3a8ce4277cba.png"/>
    </p>
    <p>
     ​ 自定义安装rabbitmq-server和虚拟化组包
    </p>
    <h4>
     <a id="3_230">
     </a>
     (3)客户端验证
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/828ead0e5f21124e15c7dfcb6157d653.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f636c656172343532312f:61727469636c652f64657461696c732f313330383435383834" class_="artid" style="display:none">
 </p>
</div>


