---
layout: post
title: "机器学习-决策树"
date: 2025-03-12 15:34:35 +0800
description: "决策树通过递归地选择最优特征对数据集进行分割，最终生成一棵树状模型。每个节点代表一个特征的分裂规则，每个分支代表一个可能的特征值，叶节点则代表最终的预测结果（分类或回归值）。"
keywords: "机器学习-----决策树"
categories: ['机器学习']
tags: ['机器学习', '决策树', '人工智能']
artid: "146199729"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146199729
    alt: "机器学习-决策树"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146199729
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146199729
cover: https://bing.ee123.net/img/rand?artid=146199729
image: https://bing.ee123.net/img/rand?artid=146199729
img: https://bing.ee123.net/img/rand?artid=146199729
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     机器学习-----决策树
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <hr/>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h3>
     <a id="1_9">
     </a>
     1、概念
    </h3>
    <p>
     1.1决策树是什么
     <br/>
     决策树是通过对样本的训练，建立出分类规则，并对新样本进行预测，属于有监督学习。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f61e25c6e50c4d9e93f46d2c7a0e1dd5.png"/>
    </p>
    <blockquote>
     <p>
      根节点：最上面的节点。
      <br/>
      叶子节点：能直接看到结果的节点。
      <br/>
      非叶子节点：位于中间的节点。
     </p>
    </blockquote>
    <p>
     1.2决策树的类型
    </p>
    <blockquote>
     <p>
      分类树：用于分类任务，叶节点代表类别标签
      <br/>
      回归树：用于回归任务，叶节点代表连续值。
     </p>
    </blockquote>
    <h3>
     <a id="2__23">
     </a>
     2. 决策树的构建过程
    </h3>
    <h4>
     <a id="21__24">
     </a>
     2.1 特征选择
    </h4>
    <p>
     特征选择是决策树构建过程中的关键步骤。常用的特征选择方法有：
    </p>
    <blockquote>
     <ul>
      <li>
       信息增益：基于信息熵的减少量来选择特征。
      </li>
      <li>
       信息增益比：信息增益的归一化版本，用于解决信息增益偏向于取值较多的特征的问题。
      </li>
      <li>
       基尼指数：用于CART算法，表示数据的不纯度。
      </li>
     </ul>
    </blockquote>
    <h4>
     <a id="22__31">
     </a>
     2.2 树的生成
    </h4>
    <p>
     决策树的生成过程是一个递归的过程，具体步骤如下：
    </p>
    <blockquote>
     <p>
      1.选择最佳特征：根据特征选择方法，选择当前数据集的最佳特征。
      <br/>
      2. 划分数据集：根据最佳特征的取值，将数据集划分为若干子集。
      <br/>
      3.递归生成子树：对每个子集递归地应用上述步骤，直到满足停止条件（如所有样本属于同一类别，或没有更多特征可供选择）。
     </p>
    </blockquote>
    <h4>
     <a id="23__38">
     </a>
     2.3 树的剪枝
    </h4>
    <p>
     为了防止过拟合，决策树通常需要进行剪枝。剪枝分为预剪枝和后剪枝：
    </p>
    <blockquote>
     <ul>
      <li>
       预剪枝：在树的生成过程中，提前停止树的生长。
      </li>
      <li>
       后剪枝：先生成完整的树，然后自底向上地剪去一些子树。
      </li>
     </ul>
    </blockquote>
    <h3>
     <a id="3__44">
     </a>
     3. 决策树的优缺点
    </h3>
    <p>
     优点
    </p>
    <blockquote>
     <ul>
      <li>
       易于理解和解释：决策树的结构直观，易于理解和解释。
      </li>
      <li>
       处理多种数据类型：可以处理数值型和类别型数据。
      </li>
      <li>
       不需要数据标准化：决策树不需要对数据进行标准化或归一化处理。
      </li>
     </ul>
    </blockquote>
    <p>
     缺点
    </p>
    <blockquote>
     <ul>
      <li>
       容易过拟合：决策树容易生成过于复杂的树，导致过拟合。
      </li>
      <li>
       对噪声敏感：决策树对噪声数据较为敏感，可能导致错误的决策路径。
      </li>
      <li>
       不稳定性：数据的微小变化可能导致生成完全不同的树。
      </li>
     </ul>
    </blockquote>
    <h3>
     <a id="4__57">
     </a>
     4. 决策树的应用
    </h3>
    <h4>
     <a id="41__58">
     </a>
     4.1 分类任务
    </h4>
    <blockquote>
     <p>
      决策树广泛应用于分类任务，如垃圾邮件过滤、疾病诊断等。
     </p>
    </blockquote>
    <h4>
     <a id="42__62">
     </a>
     4.2 回归任务
    </h4>
    <blockquote>
     <p>
      决策树也可以用于回归任务，如房价预测、股票价格预测等。
     </p>
    </blockquote>
    <h4>
     <a id="43__66">
     </a>
     4.3 集成学习
    </h4>
    <blockquote>
     <p>
      决策树是许多集成学习方法的基础，如随机森林、梯度提升树（GBDT）等。
     </p>
    </blockquote>
    <h3>
     <a id="_72">
     </a>
     代码示例
    </h3>
    <p>
     需要用到sk-learn库
    </p>
    <pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">def</span> <span class="token function">cm_plot</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> yp<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cm <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y<span class="token punctuation">,</span> yp<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>matshow<span class="token punctuation">(</span>cm<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>cm<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> xy<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalalignment<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> verticalalignment<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True label'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Predicted label'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> plt

<span class="token comment">#导入数据</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'电信客户流失数据.xlsx'</span><span class="token punctuation">)</span>

<span class="token comment">#将变量与结果划分开</span>
datas <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span> <span class="token punctuation">:</span> <span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
target <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span> <span class="token punctuation">:</span> <span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>


<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

datas_train<span class="token punctuation">,</span> datas_test<span class="token punctuation">,</span> target_train<span class="token punctuation">,</span> target_test <span class="token operator">=</span> \
        train_test_split<span class="token punctuation">(</span>datas<span class="token punctuation">,</span>target<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>

<span class="token comment">#定义决策树</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> tree
tr <span class="token operator">=</span> tree<span class="token punctuation">.</span>DecisionTreeClassifier<span class="token punctuation">(</span>criterion<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span> max_depth<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>min_samples_split<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>min_samples_leaf<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>
tr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>datas_train<span class="token punctuation">,</span>target_train<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
训练集混淆矩阵
'''</span>
<span class="token comment">#训练集预测值</span>
train_predicted <span class="token operator">=</span> tr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>datas_train<span class="token punctuation">)</span>

<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics
<span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>target_train<span class="token punctuation">,</span>train_predicted<span class="token punctuation">)</span><span class="token punctuation">)</span>

cm_plot<span class="token punctuation">(</span>target_train<span class="token punctuation">,</span> train_predicted<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token triple-quoted-string string">'''
测试集混淆矩阵
'''</span>

test_predicted <span class="token operator">=</span> tr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>datas_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>target_test<span class="token punctuation">,</span>test_predicted<span class="token punctuation">)</span><span class="token punctuation">)</span>
cm_plot<span class="token punctuation">(</span>target_test<span class="token punctuation">,</span> test_predicted<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
tr<span class="token punctuation">.</span>score<span class="token punctuation">(</span>datas_test<span class="token punctuation">,</span>target_test<span class="token punctuation">)</span>


<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> plot_tree
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plot_tree<span class="token punctuation">(</span>tr<span class="token punctuation">,</span>filled<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <hr/>
    <h2>
     <a id="_141">
     </a>
     总结
    </h2>
    <p>
     决策树通过递归地选择最优特征对数据集进行分割，最终生成一棵树状模型。每个节点代表一个特征的分裂规则，每个分支代表一个可能的特征值，叶节点则代表最终的预测结果（分类或回归值）。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36353036353039352f:61727469636c652f64657461696c732f313436313939373239" class_="artid" style="display:none">
 </p>
</div>


