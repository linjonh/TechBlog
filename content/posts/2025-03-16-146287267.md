---
layout: post
title: "MySQL多表查询笛卡尔积现象,联合查询内连接左外连接右外连接子查询-通过练习快速掌握法"
date: 2025-03-16 17:06:43 +0800
description: "本文我们将系统的讲解多表查询。包括面试可能问到的笛卡尔积现象，以及多种多表查询的类型：联合查询、内连接、左外连接、右外连接、子查询，通过练习的方式快速掌握知识。每次练习都可能设计新的知识盲区，都会进行补充，欢迎阅读。"
keywords: "【MySQL】多表查询（笛卡尔积现象，联合查询、内连接、左外连接、右外连接、子查询）-通过练习快速掌握法"
categories: ['Mysql']
tags: ['数据库', '后端', 'Sql', 'Mysql']
artid: "146287267"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146287267
    alt: "MySQL多表查询笛卡尔积现象,联合查询内连接左外连接右外连接子查询-通过练习快速掌握法"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146287267
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146287267
cover: https://bing.ee123.net/img/rand?artid=146287267
image: https://bing.ee123.net/img/rand?artid=146287267
img: https://bing.ee123.net/img/rand?artid=146287267
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【MySQL】多表查询（笛卡尔积现象，联合查询、内连接、左外连接、右外连接、子查询）-通过练习快速掌握法
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     在DQL的基础查询中，我们已经学过了多表查询的一种：联合查询（union）。本文我们将系统的讲解多表查询。
    </p>
    <h2>
     笛卡尔积现象
    </h2>
    <p>
     首先，我们想要查询emp表和stu表两个表，按照我们之前的知识栈，我们直接使用：
    </p>
    <pre><code class="language-sql">select * from emp,stu;</code></pre>
    <p>
     当查询emp时：15条记录被查询
    </p>
    <p>
     当查询stu时：5条记录被查询
    </p>
    <p>
     但是让我们来观察结果：
    </p>
    <p>
     <img alt="" height="779" src="https://i-blog.csdnimg.cn/direct/1c486e7b2e794f528caaa6df25354c69.png" width="1568"/>
    </p>
    <p>
     哇，查询到了70条记录 。而且根据结果我们可以看出：左表emp的每条记录都会与右表stu的每条记录组成一条新的记录，也就是14*5=70条记录。这种现象非常符合离散数学中学到的笛卡尔积的结果，所以我们将这种现象称为笛卡尔积现象。
    </p>
    <blockquote>
     <p>
      笛卡尔积（Cartesian Product）：表示两个集合之间的所有可能的有序对的集合
     </p>
    </blockquote>
    <p>
     <img alt="" height="279" src="https://i-blog.csdnimg.cn/direct/6c613813661c4ebf91d2b0ed2df16747.png" width="943"/>
    </p>
    <blockquote>
     <p>
      笛卡尔积的性质包括：
     </p>
     <ol>
      <li>
       笛卡尔积的结果是一个新集合。
      </li>
      <li>
       如果 AA 和 BB 其中一个为空集，则结果也为空集。
      </li>
      <li>
       笛卡尔积的顺序是重要的，即 A×B≠B×A。
      </li>
     </ol>
    </blockquote>
    <p>
     我们如何实现15+4的结果呢？直接使用上面的select肯定是不行了。
    </p>
    <p>
     那么，此时有一个叫联合查询的方式出现在脑海里：
    </p>
    <h2>
     联合查询
    </h2>
    <p>
     关键字：【union all】
    </p>
    <pre><code class="language-sql">select empno,ename,job from emp
union all
select id,nick,pwd from stu;</code></pre>
    <p>
     观察结果：19=15+4条记录 （使用union代替union all可以实现去重的功能）
    </p>
    <p>
     <img alt="" height="781" src="https://i-blog.csdnimg.cn/direct/5018bd647c8f4e25bdd3bb50458bb55e.png" width="1568"/>
    </p>
    <p>
     但是为了将记录查询出来，我们 必须合适选择每个表的字段，将
     <strong>
      两个表查询的字段的数据类型一一对应
     </strong>
     。empno int = id int，ename varchar = nick varchar ......
    </p>
    <p>
     如果数据类型对应不上，那么将无法查询，结果是：
    </p>
    <p>
     <img alt="" height="718" src="https://i-blog.csdnimg.cn/direct/843c5119794e42b38246459e78a331ff.png" width="1286"/>
    </p>
    <h2>
     直接查询的条件限制法
    </h2>
    <p>
     那么联合查询也不能符合我们对查询结果的预期，这时候需要我们转换思路。从笛卡尔积现象开始：【需求：查询员工表以及每个员工对应的部门信息】
    </p>
    <p>
     首先直接查询：
    </p>
    <p>
     <img alt="" height="515" src="https://i-blog.csdnimg.cn/direct/a075c57fe4c1468c8992930666cfc74a.png" width="1218"/>
    </p>
    <p>
     对于查询的结果，虽然有重复， 但至少有我们需要的结果，那么只需要将这个表中的有效记录提取出来，就可以了。也就是使用where条件进行限定：
    </p>
    <p>
     <img alt="" height="530" src="https://i-blog.csdnimg.cn/direct/c2812fa36b5e42fcb4b354883abe221f.png" width="1263"/>
    </p>
    <p>
     此时我们查询的结果就符合我们的预期了。但注意，这时候我们操作时必须给每个字段指定上是哪个表的字段，不然的话，该字段属于二义性字段，无法通过语法分析，也就不能执行了。
    </p>
    <h2>
     内连接
    </h2>
    <pre><code class="language-sql">select field from tb1 
[inner] join tb2 on condition;</code></pre>
    <h4>
     等值连接
    </h4>
    <p>
     eg.根据一个编号查另一个表中改编号对应的内容。常见于：根据子表外键连接父表主键
    </p>
    <p>
     【练习：查询员工表以及每个员工对应的部门信息】
    </p>
    <pre><code class="language-sql">select * from emp [inner]join dept on emp.DEPTNO = dept.DEPTNO;</code></pre>
    <p>
     <img alt="" height="500" src="https://i-blog.csdnimg.cn/direct/b33b7b801ed14098aa94d72689ea3ab7.png" width="1221">
     </img>
    </p>
    <h4>
     非等值连接
    </h4>
    <p>
     eg.根据一个表的某个字段，查另一个表中该字段属于哪段区间的信息。实际用途：等级划分
    </p>
    <p>
     【练习：根据员工的薪水查出薪水的等级】
    </p>
    <p>
     <img alt="" height="476" src="https://i-blog.csdnimg.cn/direct/ddb4108755464d24bd57989c77469bd2.png" width="673"/>
    </p>
    <h4>
     自连接
    </h4>
    <p>
     eg.自连接是某个表的某个字段信息存储的数据是本表的另一条记录的信息。常用于：事物关联
    </p>
    <p>
     【练习：根据员工表的领导编号查询领导的名字】
    </p>
    <p class="img-center">
     <img alt="" height="474" src="https://i-blog.csdnimg.cn/direct/9b55a305629945fcb58b3e86e73ae764.png" width="568"/>
    </p>
    <p>
     <span style="background-color:#ffd900">
      自连接的流程：为显示的字段起别名(避免两个结果字段名冲突，非必须)=》from选择查询表=》join 连接表（本表），并起别名（避免二义性，必须）=》连接条件。[过程中的每个字段都需要明确指出是哪个表]
     </span>
    </p>
    <h2>
     外连接
    </h2>
    <p>
     由于内连接会将连接条件的字段中空值的记录给过滤掉，所以为了显示较为全面的记录，我们采用外连接的方式进行多表查询。
    </p>
    <h4>
     左外连接
    </h4>
    <p>
     左外连接就是(left [outer] join ... on...)。显示主表的所有字段，并将被连接的从表符合连接条件的记录连接到主表，如果没有，主表显示原本记录，从表的字段中为空。
    </p>
    <p>
     【练习：查询员工表以及每个员工对应的部门信息---显示所有员工】
    </p>
    <p>
     <img alt="" height="496" src="https://i-blog.csdnimg.cn/direct/528817fe030e4c88808f9cbc1ae30093.png" width="1233"/>
    </p>
    <h4>
     右外连接
    </h4>
    <p>
     右外连接就是(right [outer] join ... on...)。与左外连接类似。
    </p>
    <p>
     【练习：查询员工表以及每个员工对应的部门信息---显示所有部门】
    </p>
    <p>
     <img alt="" height="458" src="https://i-blog.csdnimg.cn/direct/c7d3b1cd0e0e4e8ca54209fe2d432e77.png" width="1244"/>
    </p>
    <p>
     我们对比发现，右外连接显示的记录比左外连接的记录多一条，多出的一条是部门表中的数据，但该部门在员工表中没有员工，所以全部显示为空。
    </p>
    <p>
     <strong>
      注
     </strong>
     ：外连接查询的结果记录数
     <strong>
      &gt;=
     </strong>
     内连接查询到的结果记录数
    </p>
    <p>
     左外连接【左图】、右外连接【右图】
    </p>
    <p>
     <img alt="" height="257" src="https://i-blog.csdnimg.cn/direct/d277f0e732534da195e0f1a5d4a1bcf0.png" width="801"/>
    </p>
    <h2>
     子查询
    </h2>
    <p>
     子查询：嵌套在其它SQL语句内的查询语句，且必须出现在圆括号内（查询一般是指select语句）：子查询的结果可以作为外层查询的过滤条件或计算字段。
    </p>
    <h4>
     标量子查询
    </h4>
    <p>
     子查询返回结果是单个值，如数字、字符串、日期等最简单的形式。这种子查询称为
     <strong>
      <span style="color:#fe2c24">
       标量子查询
      </span>
     </strong>
     。【常用的操作符：| = | &lt;&gt; | &gt; | &gt;= | &lt; | &lt;= |】
    </p>
    <p>
     【练习：查询销售部的部门员工信息】
    </p>
    <p>
     第一步：查询销售部的部门编号
    </p>
    <pre><code class="language-sql">select deptno from dept where dname="SALES";</code></pre>
    <p>
     第二步：查询部门编号为上述结果的员工
    </p>
    <pre><code class="language-sql">select * from emp where deptno = 上条语句的结果;</code></pre>
    <p>
     第三步：合并一条语句：
    </p>
    <pre><code class="language-sql">select * from emp where deptno = (select deptno from dept where dname="SALES");</code></pre>
    <p class="img-center">
     <img alt="" height="380" src="https://i-blog.csdnimg.cn/direct/6dddd467de2740e693487dada54983a9.png" width="849"/>
    </p>
    <p>
     <strong>
      <span style="background-color:#ffd900">
       标量子查询可以在子句中使用聚合函数、而且子句的位置还可以出现在select后作为字段出现：
      </span>
     </strong>
    </p>
    <p>
     【练习：查询部门名，以及每个部门的人数】
    </p>
    <pre><code class="language-sql">select dname, (select count(*) from emp where dept.deptno=emp.deptno) emps 
from dept;</code></pre>
    <p>
     <img alt="" height="299" src="https://i-blog.csdnimg.cn/direct/91660c7f677c470497c75e7db477c968.png" width="761"/>
    </p>
    <h4>
     列子查询
    </h4>
    <p>
     子查询的结果是一列(或者多列)，这种子查询称为
     <strong>
      <span style="color:#fe2c24">
       列子查询
      </span>
     </strong>
     。
    </p>
    <p>
     【常用操作符：in、not in、any、some、all】
    </p>
    <blockquote>
     <p>
      IN：在指定的集合范围之内，多选一
     </p>
     <p>
      NOT IN：不再指定的集合范围之内
     </p>
     <p>
      ANY：子查询返回列表中，有任意一个满足即可【相当于集合所有元素作 or 运算】
     </p>
     <p>
      SOME：与ANY相同，SOME与ANY等价
     </p>
     <p>
      ALL：子查询返回列表的所有值都要满足【相当于集合所有元素之间作 and 运算】
     </p>
    </blockquote>
    <p>
     【练习：查询销售部（SALES）和调研部（RESEARCH）所有员工信息】
    </p>
    <pre><code class="language-sql">select * 
from emp 
where deptno in (select deptno from dept where dname in ("SALES","RESEARCH"));

-- or:
select * 
from emp 
where deptno in (select deptno from dept where dname="SALES" or dname="RESEARCH");</code></pre>
    <p>
     <img alt="" height="478" src="https://i-blog.csdnimg.cn/direct/2142de2cc9874bd2865b33b43eddc329.png" width="836"/>
    </p>
    <p>
     【练习：查询比销售部的所有人的工资都高的员工信息】
    </p>
    <p>
     比所有人都高，也就是sal &gt; all( {...} )
    </p>
    <p>
     <img alt="" height="295" src="https://i-blog.csdnimg.cn/direct/f8ef6532497f472683646dc7bcfc251c.png" width="971"/>
    </p>
    <p>
     通过这个练习，我们不仅练习了all运算，我们还知道了，子句可以嵌套子句。
    </p>
    <h4>
     行子查询
    </h4>
    <p>
     子查询的返回结果是一行（可以是多行），这种子查询称为
     <strong>
      <span style="color:#fe2c24">
       行子查询
      </span>
     </strong>
     。
    </p>
    <p>
     【常用操作符：| = | &lt;&gt; | in | not in】
    </p>
    <p>
     【练习：查询与“SMITH”的 薪资以及直属领导 都相同的员工信息】
    </p>
    <pre><code class="language-sql">-- (单行结果)
select * from emp where (sal,mgr) = (select sal,mgr from emp where ename = "SMITH");

-- (多行结果)
select * from emp where (sal,mgr) in (select sal,mgr from emp where ename = "SMITH");
</code></pre>
    <p>
     <img alt="" height="226" src="https://i-blog.csdnimg.cn/direct/b54f4ccc6c954fd3bc09dced1c7e2b8c.png" width="876"/>
    </p>
    <p>
     通过该练习，我们掌握了新的知识：
    </p>
    <blockquote>
     <p>
      (field1,field2,...,fieldn) 可以通过加圆括号的方式直接与行结果进行运算【= | &lt;&gt; | in | not in】
     </p>
    </blockquote>
    <h4>
     表子查询
    </h4>
    <p>
     子查询的结果可以是多行多列，产生这种结果的子查询称为
     <span style="color:#fe2c24">
      <strong>
       表子查询
      </strong>
     </span>
     。【常用操作符：IN】
    </p>
    <p>
     这种就是行子查询的 in 操作。
    </p>
    <pre><code class="language-sql">-- (多行结果)
select * from emp where (sal,mgr) in (select sal,mgr from emp where ename = "SMITH");
</code></pre>
    <hr/>
    <p>
     感谢大家！欢迎指导、询问、探讨知识！
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f55323339363537333633372f:61727469636c652f64657461696c732f313436323837323637" class_="artid" style="display:none">
 </p>
</div>


