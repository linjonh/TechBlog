---
layout: post
title: "linux-docker-安装dify本地运行,及部署后运行出现502问题"
date: 2025-03-12 18:32:19 +0800
description: "linux下，本地部署dify，及遇到的502问题解决"
keywords: "linux docker 安装dify本地运行,及部署后运行出现502问题"
categories: ['Dify']
tags: ['Linux', 'Docker', 'Dify']
artid: "146210898"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146210898
    alt: "linux-docker-安装dify本地运行,及部署后运行出现502问题"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146210898
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146210898
cover: https://bing.ee123.net/img/rand?artid=146210898
image: https://bing.ee123.net/img/rand?artid=146210898
img: https://bing.ee123.net/img/rand?artid=146210898
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     linux docker 安装dify本地运行,及部署后运行出现502问题
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     1、git 拉取代码:git（ https://github.com/langgenius/dify.git）
    </p>
    <pre><code class="prism language-php">git <span class="token keyword">clone</span>  https<span class="token punctuation">:</span><span class="token comment">//github.com/langgenius/dify.git</span>
</code></pre>
    <p>
     2、进入项目目录 的docker下
    </p>
    <pre><code class="prism language-php">cd docker
</code></pre>
    <p>
     3、复制一份本地运行的环境
    </p>
    <pre><code class="prism language-php">cp <span class="token operator">.</span>\<span class="token operator">.</span>env<span class="token operator">.</span>example <span class="token operator">.</span>env
</code></pre>
    <p>
     查看本地的端口：80和443端口是否被占用，如果被占用需要修改 .env文件中的端口，我这边是都修改后运行的
     <br/>
     EXPOSE_NGINX_PORT
     <br/>
     EXPOSE_NGINX_SSL_PORT
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/b8052b9a853c41ffb5fff3f65e5a10b1.png">
      <br/>
      4、第三步如果修改了端口，则需要在 docker-compose.yaml中对应的都修改端口，如下图
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9f15dc5153a94ec0a5ae1764ad56df01.png">
       <br/>
       5、我们主要看三个文件
      </img>
     </img>
    </p>
    <pre><code class="prism language-php"><span class="token number">5.1</span> dify<span class="token operator">/</span>docker<span class="token operator">/</span><span class="token operator">.</span>env
<span class="token number">5.2</span> dify<span class="token operator">/</span>docker<span class="token operator">/</span>docker<span class="token operator">-</span>compose<span class="token operator">.</span>yaml
<span class="token number">5.3</span> dify<span class="token operator">/</span>docker<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">.</span>d<span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">.</span>conf <span class="token punctuation">[</span>这个是如果安装运行出现<span class="token number">502</span>，需要修改的文件<span class="token punctuation">]</span>
</code></pre>
    <p>
     6、运行项目，运行命令可以在项目的
     <strong>
      dify/README_CN.md
     </strong>
     查看
    </p>
    <pre><code class="prism language-php">cd docker
cp <span class="token operator">.</span>env<span class="token operator">.</span>example <span class="token operator">.</span>env
docker compose up <span class="token operator">-</span>d 【如果docker版本低，需要安装docker<span class="token operator">-</span>compose，安装后用命令： docker<span class="token operator">-</span>compose up <span class="token operator">-</span>d 】启动项目
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a2e0d459033d4ece85efafb5843893ca.png"/>
    </p>
    <p>
     7、启动后，查看是否启动成功
     <br/>
     7.1：http://localhost:8044/install 查看网址是否成功出现登录页面
     <br/>
     7.2：用命令查看是否全部启动成功：
    </p>
    <pre><code class="prism language-php">docker ps <span class="token operator">-</span><span class="token class-name">q</span> <span class="token operator">|</span> <span class="token class-name">xargs</span> <span class="token operator">-</span>n <span class="token number">1</span> docker inspect <span class="token operator">--</span>format <span class="token string single-quoted-string">'{<!-- -->{ .Name }}: {<!-- -->{range .NetworkSettings.Networks}}{<!-- -->{.IPAddress}}{<!-- -->{end}}'</span> 
</code></pre>
    <p>
     启动失败实例：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/57ca4b53512946a6adebae3986b1a0bd.png"/>
    </p>
    <p>
     启动成功实例
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/abf4cbc2af98444cbaea40aa0c51a66e.png">
      <br/>
      8：如果失败，则需要用docker命令查看log是什么报错
     </img>
    </p>
    <pre><code class="prism language-php"><span class="token number">8.1</span> docker logs docker<span class="token operator">-</span>sandbox<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token class-name">grep</span> errors
</code></pre>
    <p>
     我的报错是：如下图，显示权限不足导致出现502问题。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8bf099844a574c4899dfec2af481915c.png">
      <br/>
      出现上面权限不够的问题，需要修改启动文件
      <strong>
       docker-compose.yaml
      </strong>
      ,哪个镜像运行出现权限不足，则在对应的后面添加全部权限
     </img>
    </p>
    <pre><code class="prism language-php"><span class="token number">8.2</span>  privileged<span class="token punctuation">:</span> <span class="token constant boolean">true</span>
</code></pre>
    <p>
     如下图修改：
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7939c78063cf479cb97403168cc68276.png">
      <br/>
      8.3：修改权限后，先把服务停止，再重启
     </img>
    </p>
    <pre><code class="prism language-php">docker<span class="token operator">-</span>compose down  停止
docker<span class="token operator">-</span>compose up <span class="token operator">-</span>d 启动
</code></pre>
    <p>
     8.4：启动后，再查看是否10个镜像全部启动成功
    </p>
    <pre><code class="prism language-php">docker ps <span class="token operator">-</span><span class="token class-name">q</span> <span class="token operator">|</span> <span class="token class-name">xargs</span> <span class="token operator">-</span>n <span class="token number">1</span> docker inspect <span class="token operator">--</span>format <span class="token string single-quoted-string">'{<!-- -->{ .Name }}: {<!-- -->{range .NetworkSettings.Networks}}{<!-- -->{.IPAddress}}{<!-- -->{end}}'</span> 
</code></pre>
    <p>
     8.5：全部成功后，需要替换文件 【dify/docker/nginx/conf.d/default.conf】中的地址为ip地址
     <br/>
     替换后结果如下
    </p>
    <pre><code class="prism language-php">docker<span class="token operator">-</span>nginx<span class="token operator">-</span><span class="token number">1</span>：服务的nginx服务
docker<span class="token operator">-</span>api<span class="token operator">-</span><span class="token number">1</span>：api服务
docker<span class="token operator">-</span>web<span class="token operator">-</span><span class="token number">1</span>：web服务
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/f2a4cd6ac9554a32b70f66effdb62867.png">
      <br/>
      8.6：复制成功后，重启nginx加载文件
     </img>
    </p>
    <pre><code class="prism language-php">docker exec docker<span class="token operator">-</span>nginx<span class="token operator">-</span><span class="token number">1</span> nginx <span class="token operator">-</span>s reload 
</code></pre>
    <p>
     9：成功后图
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/8e38f028672d40f596d26e8f69246f66.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6875617a6563692f:61727469636c652f64657461696c732f313436323130383938" class_="artid" style="display:none">
 </p>
</div>


