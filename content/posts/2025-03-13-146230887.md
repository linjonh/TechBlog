---
layout: post
title: "使用sequelize对mysql进行原生sql查询"
date: 2025-03-13 14:51:20 +0800
description: "\"名称\", \"优秀\", \"良好\",\"一般\", \"较差\", \"校级优秀\",\"校级良好\",\"校级一般\",\"校级较差\"],//     // 如果属性名存在（即 s.checked 是一个有效的键），则更新 b 的对应属性。//     // 如果需要处理这种情况，可以添加一个 else 分支来处理未知值。//     // 注意：这里我们没有处理 s.checked 不在映射中的情况，//     // 因为根据代码逻辑，这应该是不可能的，除非数据有误。"
keywords: "使用sequelize对mysql进行原生sql查询"
categories: ['未分类']
tags: ['开发语言', '前端', 'Javascript']
artid: "146230887"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146230887
    alt: "使用sequelize对mysql进行原生sql查询"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146230887
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146230887
cover: https://bing.ee123.net/img/rand?artid=146230887
image: https://bing.ee123.net/img/rand?artid=146230887
img: https://bing.ee123.net/img/rand?artid=146230887
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     使用sequelize对mysql进行原生sql查询
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     import sequelize  from "./conn/index.js";
    </p>
    <p>
     // import Denglu  from "./entity/denglu";
    </p>
    <p>
    </p>
    <p>
     import fs from 'fs';
    </p>
    <p>
     import xlsx from 'node-xlsx'
    </p>
    <p>
     <br/>
     <br/>
    </p>
    <p>
     const start = process.hrtime();
    </p>
    <p>
     <br/>
    </p>
    <p>
     const { QueryTypes } = sequelize;
    </p>
    <p>
     <br/>
    </p>
    <p>
     // (async ()=&gt;{
     <!-- -->
    </p>
    <p>
     //     let res = await sequelize.query("select * from denglu ", {type: QueryTypes.SELECT } )
    </p>
    <p>
    </p>
    <p>
     //     console.log(res.length)
    </p>
    <p>
     <br/>
    </p>
    <p>
     //     res.forEach(item =&gt; console.log(item))
    </p>
    <p>
    </p>
    <p>
     // })()
    </p>
    <p>
    </p>
    <p>
     // let res = await sequelize.query("select count(*) from denglu  where cishu &gt; 0 ", {type: QueryTypes.SELECT } )
    </p>
    <p>
    </p>
    <p>
     // console.log(res)
    </p>
    <p>
    </p>
    <p>
     let names = await sequelize.query("select distinct(name) from score1 ", { type: QueryTypes.SELECT })
    </p>
    <p>
    </p>
    <p>
     //  console.log(names)
    </p>
    <p>
    </p>
    <p>
     // const name = "学校办公室"
    </p>
    <p>
    </p>
    <p>
     // let str = "SELECT checked, COUNT(*) AS count FROM score1  where name ='"+ name+"' GROUP BY checked "
    </p>
    <p>
    </p>
    <p>
     let a =[]
    </p>
    <p>
    </p>
    <p>
     const checkedMapping = {
     <!-- -->
    </p>
    <p>
     '优秀': 'youxiu',
    </p>
    <p>
     '良好': 'lianghao',
    </p>
    <p>
    </p>
    <p>
     '一般': 'yiban',
    </p>
    <p>
     '较差': 'buhege'
    </p>
    <p>
     };
    </p>
    <p>
    </p>
    <p>
     const fu = ( fenshu,unitName)=&gt;{
     <!-- -->
    </p>
    <p>
     const b = {
     <!-- -->
    </p>
    <p>
     name: unitName,
    </p>
    <p>
     youxiu: 0,   // 优秀
    </p>
    <p>
     lianghao: 0, // 良好
    </p>
    <p>
     yiban: 0,    // 一般
    </p>
    <p>
     buhege: 0    // 不合格
    </p>
    <p>
     }
    </p>
    <p>
     fenshu.forEach(s =&gt; {
     <!-- -->
    </p>
    <p>
     // 使用映射对象来获取正确的属性名
    </p>
    <p>
     const propertyName = checkedMapping[s.checked];
    </p>
    <p>
    </p>
    <p>
     // 如果属性名存在（即 s.checked 是一个有效的键），则更新 b 的对应属性
    </p>
    <p>
     if (propertyName) {
     <!-- -->
    </p>
    <p>
     b[propertyName] = s.count;
    </p>
    <p>
     }
    </p>
    <p>
     // 注意：这里我们没有处理 s.checked 不在映射中的情况，
    </p>
    <p>
     // 因为根据代码逻辑，这应该是不可能的，除非数据有误。
    </p>
    <p>
     // 如果需要处理这种情况，可以添加一个 else 分支来处理未知值。
    </p>
    <p>
     });
    </p>
    <p>
    </p>
    <p>
     a.push(b)
    </p>
    <p>
     }
    </p>
    <p>
     <br/>
    </p>
    <p>
     const fu2 = ( fenshu,fenshu2,unitName)=&gt;{
     <!-- -->
    </p>
    <p>
     const b = {
     <!-- -->
    </p>
    <p>
     name: unitName,
    </p>
    <p>
     youxiu: 0,   // 优秀
    </p>
    <p>
     lianghao: 0, // 良好
    </p>
    <p>
     yiban: 0,    // 一般
    </p>
    <p>
     buhege: 0,
    </p>
    <p>
     x_youxiu:0,
    </p>
    <p>
     x_lianghao:0,
    </p>
    <p>
     x_yiban:0,
    </p>
    <p>
     x_buhege:0
    </p>
    <p>
     }
    </p>
    <p>
     fenshu.forEach(s =&gt; {
     <!-- -->
    </p>
    <p>
     // 使用映射对象来获取正确的属性名
    </p>
    <p>
     const propertyName = checkedMapping[s.checked];
    </p>
    <p>
    </p>
    <p>
     // 如果属性名存在（即 s.checked 是一个有效的键），则更新 b 的对应属性
    </p>
    <p>
     if (propertyName) {
     <!-- -->
    </p>
    <p>
     b[propertyName] = s.count;
    </p>
    <p>
     }
    </p>
    <p>
     // 注意：这里我们没有处理 s.checked 不在映射中的情况，
    </p>
    <p>
     // 因为根据代码逻辑，这应该是不可能的，除非数据有误。
    </p>
    <p>
     // 如果需要处理这种情况，可以添加一个 else 分支来处理未知值。
    </p>
    <p>
     });
    </p>
    <p>
    </p>
    <p>
     fenshu2.forEach(s=&gt;{
     <!-- -->
    </p>
    <p>
     const propertyName = checkedMapping[s.checked];
    </p>
    <p>
     if(propertyName){
     <!-- -->
    </p>
    <p>
     b['x_'+propertyName]=s.count
    </p>
    <p>
     }
    </p>
    <p>
    </p>
    <p>
     })
    </p>
    <p>
     a.push(b)
    </p>
    <p>
     }
    </p>
    <p>
     <br/>
     <br/>
     <br/>
     <br/>
    </p>
    <p>
     const excel01 = (list)=&gt;{
     <!-- -->
    </p>
    <p>
     let excelData = []
    </p>
    <p>
     try{
     <!-- -->
    </p>
    <p>
    </p>
    <p>
     //添加数据
    </p>
    <p>
     var addInfo = {};
    </p>
    <p>
     //名称
    </p>
    <p>
     addInfo.name = "用户表";
    </p>
    <p>
     //数据数组
    </p>
    <p>
     addInfo.data = [
    </p>
    <p>
     ["名称", "优秀", "良好","一般", "较差", "校级优秀","校级良好","校级一般","校级较差"],
    </p>
    <p>
     ];
    </p>
    <p>
    </p>
    <p>
     list.forEach(item =&gt; addInfo.data.push([item.name, item.youxiu, item.lianghao, item.yiban, item.buhege,
    </p>
    <p>
     item.x_youxiu, item.x_lianghao,item.x_yiban, item.x_buhege
    </p>
    <p>
     ]))
    </p>
    <p>
    </p>
    <p>
     //添加数据
    </p>
    <p>
     excelData.push(addInfo);
    </p>
    <p>
     // 写xlsx
    </p>
    <p>
     var buffer = xlsx.build(excelData);
    </p>
    <p>
     //写入数据
    </p>
    <p>
     fs.writeFile('./score1.xlsx', buffer, function (err) {
     <!-- -->
    </p>
    <p>
     if (err) {
     <!-- -->
    </p>
    <p>
     throw err;
    </p>
    <p>
     }
    </p>
    <p>
     //输出日志
    </p>
    <p>
     console.log('Write to xls has finished');
    </p>
    <p>
     const [seconds, nanoseconds] = process.hrtime(start);
    </p>
    <p>
     const milliseconds = seconds * 1000 + nanoseconds / 1e6;
    </p>
    <p>
     console.log(`运行时间: ${milliseconds.toFixed(2)} 毫秒`);
    </p>
    <p>
     });
    </p>
    <p>
    </p>
    <p>
     }catch(e){
     <!-- -->
    </p>
    <p>
     //输出日志
    </p>
    <p>
     console.log("excel读取异常,error=%s", e.stack)
    </p>
    <p>
     }
    </p>
    <p>
     }
    </p>
    <p>
    </p>
    <p>
     // for (const jk of names) {
     <!-- -->
    </p>
    <p>
     //     console.log("jk : ", jk.name )
    </p>
    <p>
     // }
    </p>
    <p>
    </p>
    <p>
     (async () =&gt; {
     <!-- -->
    </p>
    <p>
     for (const obj of names) {
     <!-- -->
    </p>
    <p>
     let str = `SELECT checked, COUNT(*) AS count FROM score1 WHERE name = '${obj.name}' and length(work_number) = 36 GROUP BY checked`;
    </p>
    <p>
     let so = await sequelize.query(str, { type: sequelize.QueryTypes.SELECT });
    </p>
    <p>
     let str2 = `SELECT checked, COUNT(*) AS count FROM score1 WHERE name = '${obj.name}' and length(work_number) =28 GROUP BY checked`;
    </p>
    <p>
     let so2 = await sequelize.query(str2 , {type: sequelize.QueryTypes.SELECT});
    </p>
    <p>
     fu2(so,so2,obj.name);
    </p>
    <p>
     }
    </p>
    <p>
     // console.log(a.length)
    </p>
    <p>
     excel01(a)
    </p>
    <p>
     <br/>
     <br/>
    </p>
    <p>
     })();
    </p>
    <p>
     <br/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
     <br/>
     <br/>
    </p>
    <p>
     // 初始化对象 b
    </p>
    <p>
     // const b = {
     <!-- -->
    </p>
    <p>
     //     name: '学校办公室',
    </p>
    <p>
    </p>
    <p>
     //     youxiu: 0,   // 优秀
    </p>
    <p>
     //     lianghao: 0, // 良好
    </p>
    <p>
     //     yiban: 0,    // 一般
    </p>
    <p>
     //     buhege: 0    // 不合格
    </p>
    <p>
     //   };
    </p>
    <p>
    </p>
    <p>
     // 创建一个映射对象来将 checked 值映射到 b 的属性
    </p>
    <p>
    </p>
    <p>
     //   so.forEach(s =&gt; {
     <!-- -->
    </p>
    <p>
     //     // 使用映射对象来获取正确的属性名
    </p>
    <p>
     //     const propertyName = checkedMapping[s.checked];
    </p>
    <p>
    </p>
    <p>
     //     // 如果属性名存在（即 s.checked 是一个有效的键），则更新 b 的对应属性
    </p>
    <p>
     //     if (propertyName) {
     <!-- -->
    </p>
    <p>
     //       b[propertyName] = s.count;
    </p>
    <p>
     //     }
    </p>
    <p>
     //     // 注意：这里我们没有处理 s.checked 不在映射中的情况，
    </p>
    <p>
     //     // 因为根据代码逻辑，这应该是不可能的，除非数据有误。
    </p>
    <p>
     //     // 如果需要处理这种情况，可以添加一个 else 分支来处理未知值。
    </p>
    <p>
     //   });
    </p>
    <p>
     // let b ={}
    </p>
    <p>
     // b.name= '学校办公室'
    </p>
    <p>
     // b.lianghao = 0
    </p>
    <p>
     // b.youxiu =0
    </p>
    <p>
     // b.yiban =0
    </p>
    <p>
     // b.buhege =0
    </p>
    <p>
     // so.forEach( s =&gt; {
     <!-- -->
    </p>
    <p>
     //     if(s.checked == '良好'){
     <!-- -->
    </p>
    <p>
     //        b.lianghao = s.count
    </p>
    <p>
     //     }else if(s.checked == '优秀'){
     <!-- -->
    </p>
    <p>
     //         b.youxiu = s.count
    </p>
    <p>
     //     }else if(s.checked == '一般'){
     <!-- -->
    </p>
    <p>
     //         b.yiban = s.count
    </p>
    <p>
     //     }else if(s.checked == '不合格'){
     <!-- -->
    </p>
    <p>
    </p>
    <p>
     //     }
    </p>
    <p>
     // })
    </p>
    <p>
    </p>
    <p>
     // console.log(b)
    </p>
    <p>
     <br/>
    </p>
    <p>
     // names.forEach(item =&gt; {
     <!-- -->
    </p>
    <p>
    </p>
    <p>
     // })
    </p>
    <p>
    </p>
    <p>
     // let users;
    </p>
    <p>
    </p>
    <p>
     // (async () =&gt; {
     <!-- -->
    </p>
    <p>
     //     console.log("^^^^^^^^^")
    </p>
    <p>
     //     users = await sequelize.query("select *  from users ", { type: QueryTypes.SELECT })
    </p>
    <p>
    </p>
    <p>
     //     console.log(users)
    </p>
    <p>
     // })()
    </p>
    <p>
     // async function test(){
     <!-- -->
    </p>
    <p>
     //     users  = await sequelize.query("select distinct(firstName) from users ", { type: QueryTypes.SELECT })
    </p>
    <p>
    </p>
    <p>
     // }
    </p>
    <p>
    </p>
    <p>
     // test()
    </p>
    <p>
    </p>
    <p>
     // console.log(users)
    </p>
    <p>
     // console.log("khjkhjklhj")
    </p>
    <p>
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34313431353832302f:61727469636c652f64657461696c732f313436323330383837" class_="artid" style="display:none">
 </p>
</div>


