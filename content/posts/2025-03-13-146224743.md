---
layout: post
title: "每日学习Java之一万个为什么"
date: 2025-03-13 14:57:35 +0800
description: "人生的容错远比你想象的要大的多，但是意志消沉会带走你不多的人生。不忘盲目考研失去的500天。"
keywords: "每日学习Java之一万个为什么"
categories: ['修炼']
tags: ['学习', 'Java']
artid: "146224743"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146224743
    alt: "每日学习Java之一万个为什么"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146224743
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146224743
cover: https://bing.ee123.net/img/rand?artid=146224743
image: https://bing.ee123.net/img/rand?artid=146224743
img: https://bing.ee123.net/img/rand?artid=146224743
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     每日学习Java之一万个为什么
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="JVM_0">
     </a>
     JVM的加载过程
    </h2>
    <ul>
     <li>
      启动阶段：启动JVM实例，设置初始配置参数，加载核心类库如java.lang
     </li>
     <li>
      类加载器：自举加载器，扩展加载器，系统加载器，自定义加载器。分别负责- 1.核心类库rt.jar等 2.扩展目录下的类库ext目录 3.应用类路径下的类库 classpath
     </li>
     <li>
      类加载：加载二进制数据存储方法区，检查安全性，准备分配内存并设置初始默认值，解析常量池中的符号引用转换为直接引用，执行静态变量赋值和静态代码块，完成类的初始化工作。
     </li>
     <li>
      字节码执行：解释执行，即时编译，垃圾回收
     </li>
    </ul>
    <pre><code class="prism language-java">graph <span class="token constant">TD</span><span class="token punctuation">;</span>
    <span class="token class-name">A</span><span class="token punctuation">[</span>启动<span class="token constant">JVM</span><span class="token punctuation">]</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">B</span><span class="token punctuation">[</span>初始化<span class="token constant">JVM</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">B</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">C</span><span class="token punctuation">[</span>加载核心类库<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">C</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">D</span><span class="token punctuation">[</span>类加载器<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">D</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">E</span><span class="token punctuation">[</span><span class="token class-name">Bootstrap</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">D</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">F</span><span class="token punctuation">[</span><span class="token class-name">Extension</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">D</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">G</span><span class="token punctuation">[</span><span class="token class-name">System</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">D</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">H</span><span class="token punctuation">[</span>自定义类加载器<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">E</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">I</span><span class="token punctuation">[</span><span class="token string">"加载核心类 (rt.jar, etc.)"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">F</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">J</span><span class="token punctuation">[</span><span class="token string">"加载扩展类 (ext目录)"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">G</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">K</span><span class="token punctuation">[</span><span class="token string">"加载应用类 (classpath)"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">H</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">L</span><span class="token punctuation">[</span><span class="token string">"加载自定义类"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">I</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">M</span><span class="token punctuation">[</span>验证<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">J</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
    <span class="token class-name">K</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
    <span class="token class-name">L</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
    <span class="token class-name">M</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">N</span><span class="token punctuation">[</span>准备<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">N</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">O</span><span class="token punctuation">[</span>解析<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">O</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">P</span><span class="token punctuation">[</span>初始化<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">P</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">Q</span><span class="token punctuation">[</span>字节码执行<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">Q</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">R</span><span class="token punctuation">[</span>解释执行<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">Q</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">S</span><span class="token punctuation">[</span><span class="token constant">JIT</span> 编译<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">Q</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token class-name">T</span><span class="token punctuation">[</span>垃圾回收<span class="token punctuation">]</span><span class="token punctuation">;</span>

    subgraph 初始化<span class="token constant">JVM</span>
        <span class="token constant">B1</span><span class="token punctuation">[</span>设置系统属性<span class="token punctuation">]</span>
        <span class="token constant">B2</span><span class="token punctuation">[</span>加载安全管理器<span class="token punctuation">]</span>
        <span class="token constant">B3</span><span class="token punctuation">[</span>初始化内存管理<span class="token punctuation">]</span>
        <span class="token constant">B4</span><span class="token punctuation">[</span>初始化线程调度<span class="token punctuation">]</span>
        <span class="token constant">B5</span><span class="token punctuation">[</span>初始化信号处理<span class="token punctuation">]</span>
        <span class="token constant">B6</span><span class="token punctuation">[</span>初始化<span class="token constant">JNI</span>接口<span class="token punctuation">]</span>
        <span class="token class-name">B</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">B1</span> <span class="token operator">&amp;</span> <span class="token constant">B2</span> <span class="token operator">&amp;</span> <span class="token constant">B3</span> <span class="token operator">&amp;</span> <span class="token constant">B4</span> <span class="token operator">&amp;</span> <span class="token constant">B5</span> <span class="token operator">&amp;</span> <span class="token constant">B6</span>
    end

    subgraph 加载核心类库
        <span class="token constant">C1</span><span class="token punctuation">[</span>加载 rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
        <span class="token constant">C2</span><span class="token punctuation">[</span>加载其他核心库<span class="token punctuation">]</span>
        <span class="token class-name">C</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">C1</span> <span class="token operator">&amp;</span> <span class="token constant">C2</span>
    end

    subgraph 类加载器
        <span class="token constant">E1</span><span class="token punctuation">[</span>加载 <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> 等核心类<span class="token punctuation">]</span>
        <span class="token constant">F1</span><span class="token punctuation">[</span>加载 javax<span class="token punctuation">.</span>swing 等扩展类<span class="token punctuation">]</span>
        <span class="token constant">G1</span><span class="token punctuation">[</span>加载用户应用程序类<span class="token punctuation">]</span>
        <span class="token constant">H1</span><span class="token punctuation">[</span>加载特定位置或方式的类<span class="token punctuation">]</span>
        <span class="token class-name">E</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">E1</span>
        <span class="token class-name">F</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">F1</span>
        <span class="token class-name">G</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">G1</span>
        <span class="token class-name">H</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">H1</span>
    end

    subgraph 验证
        <span class="token constant">M1</span><span class="token punctuation">[</span>文件格式验证<span class="token punctuation">]</span>
        <span class="token constant">M2</span><span class="token punctuation">[</span>元数据验证<span class="token punctuation">]</span>
        <span class="token constant">M3</span><span class="token punctuation">[</span>字节码验证<span class="token punctuation">]</span>
        <span class="token constant">M4</span><span class="token punctuation">[</span>符号引用验证<span class="token punctuation">]</span>
        <span class="token class-name">M</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">M1</span> <span class="token operator">&amp;</span> <span class="token constant">M2</span> <span class="token operator">&amp;</span> <span class="token constant">M3</span> <span class="token operator">&amp;</span> <span class="token constant">M4</span>
    end

    subgraph 准备
        <span class="token constant">N1</span><span class="token punctuation">[</span>为静态变量分配内存<span class="token punctuation">]</span>
        <span class="token constant">N2</span><span class="token punctuation">[</span>设置默认初始值<span class="token punctuation">]</span>
        <span class="token class-name">N</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">N1</span> <span class="token operator">&amp;</span> <span class="token constant">N2</span>
    end

    subgraph 解析
        <span class="token constant">O1</span><span class="token punctuation">[</span>将常量池中的符号引用转换为直接引用<span class="token punctuation">]</span>
        <span class="token class-name">O</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">O1</span>
    end

    subgraph 初始化
        <span class="token constant">P1</span><span class="token punctuation">[</span>执行静态变量赋值<span class="token punctuation">]</span>
        <span class="token constant">P2</span><span class="token punctuation">[</span>执行静态代码块<span class="token punctuation">]</span>
        <span class="token class-name">P</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">P1</span> <span class="token operator">&amp;</span> <span class="token constant">P2</span>
    end

    subgraph 字节码执行
        <span class="token constant">R1</span><span class="token punctuation">[</span>逐条解释执行字节码指令<span class="token punctuation">]</span>
        <span class="token constant">S1</span><span class="token punctuation">[</span>将热点代码编译为本地机器码<span class="token punctuation">]</span>
        <span class="token constant">T1</span><span class="token punctuation">[</span>识别并回收不再使用的对象<span class="token punctuation">]</span>
        <span class="token class-name">Q</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token constant">R1</span> <span class="token operator">&amp;</span> <span class="token constant">S1</span> <span class="token operator">&amp;</span> <span class="token constant">T1</span>
    end
</code></pre>
    <h2>
     <a id="Javanative_92">
     </a>
     Java中的本地方法native
    </h2>
    <p>
     在Java中，本地方法是一种机制，允许java代码调用非java代码。这些代码被编译成共享库如Windows上的DDL文件，通过JNI java native interface 与JVM虚拟机交互。
    </p>
    <p>
     通过这种方式，java程序可以利用底层操作系统的功能，提高性能和访问特定硬件资源。
    </p>
    <p>
     本地方法实现：
    </p>
    <ul>
     <li>
      native声明
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">myNativeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      头文件生成
     </li>
    </ul>
    <pre><code class="prism language-java">javac <span class="token operator">-</span><span class="token class-name"><span class="token namespace">h <span class="token punctuation">.</span></span> MyClass</span><span class="token punctuation">.</span>java
</code></pre>
    <ul>
     <li>
      使用System.loadLibrary（“libName”）加载共享库
     </li>
     <li>
      实现本地方法并通过JNI与JVM通信
     </li>
    </ul>
    <pre><code class="prism language-java">#include <span class="token string">"MyClass.h"</span>
#include <span class="token generics"><span class="token punctuation">&lt;</span>jni<span class="token punctuation">.</span>h<span class="token punctuation">&gt;</span></span>

<span class="token constant">JNIEXPORT</span> <span class="token keyword">void</span> <span class="token constant">JNICALL</span> <span class="token class-name">Java_MyClass_myNativeMethod</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span> <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// C/C++ 实现</span>
<span class="token punctuation">}</span>


gcc <span class="token operator">-</span>shared <span class="token operator">-</span>o libmylib<span class="token punctuation">.</span>so <span class="token operator">-</span><span class="token class-name">I</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>include <span class="token operator">-</span><span class="token class-name">I</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">JAVA_HOME</span><span class="token punctuation">}</span><span class="token operator">/</span>include<span class="token operator">/</span>linux <span class="token class-name">MyClass</span><span class="token punctuation">.</span>c



<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">"mylib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MyClass</span> myClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myClass<span class="token punctuation">.</span><span class="token function">myNativeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="Javanative_144">
     </a>
     Java中的常见native方法
    </h2>
    <ul>
     <li>
      System类中的arraycopy currenTimeMillis
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token comment">// 声明本地方法</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">arraycopy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> srcPos<span class="token punctuation">,</span> <span class="token class-name">Object</span> dest<span class="token punctuation">,</span> <span class="token keyword">int</span> destPos<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实现本地方法</span>
<span class="token constant">JNIEXPORT</span> <span class="token keyword">void</span> <span class="token constant">JNICALL</span> <span class="token class-name">Java_java_lang_System_arraycopy</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span> <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass cls<span class="token punctuation">,</span> jobject src<span class="token punctuation">,</span> jint srcPos<span class="token punctuation">,</span> jobject dest<span class="token punctuation">,</span> jint destPos<span class="token punctuation">,</span> jint length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// C/C++ 实现</span>
<span class="token punctuation">}</span>

<span class="token constant">JNIEXPORT</span> jlong <span class="token constant">JNICALL</span> <span class="token class-name">Java_java_lang_System_currentTimeMillis</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span> <span class="token operator">*</span>env<span class="token punctuation">,</span> jclass cls<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// C/C++ 实现</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      java.io.FileInputStream 中的 readBytes
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token comment">// 声明本地方法</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">int</span> <span class="token function">readBytes</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> off<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token comment">// 实现本地方法</span>
<span class="token constant">JNIEXPORT</span> jint <span class="token constant">JNICALL</span> <span class="token class-name">Java_java_io_FileInputStream_readBytes</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span> <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject thisObj<span class="token punctuation">,</span> jbyteArray bytes<span class="token punctuation">,</span> jint offset<span class="token punctuation">,</span> jint length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// C/C++ 实现</span>
<span class="token punctuation">}</span>
</code></pre>
    <ul>
     <li>
      java.util.zip.ZipFile :open 和 getNextEntry
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token comment">// 声明本地方法</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">long</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> shared<span class="token punctuation">,</span> <span class="token keyword">long</span> lastModified<span class="token punctuation">,</span> <span class="token class-name">FileDescriptor</span> fdobj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token class-name">ZipEntry</span> <span class="token function">getNextEntry</span><span class="token punctuation">(</span><span class="token keyword">long</span> jzfile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实现本地方法</span>
<span class="token constant">JNIEXPORT</span> jlong <span class="token constant">JNICALL</span> <span class="token class-name">Java_java_util_zip_ZipFile_open</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span> <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject zipFileObj<span class="token punctuation">,</span> jstring name<span class="token punctuation">,</span> jboolean shared<span class="token punctuation">,</span> jlong lastModified<span class="token punctuation">,</span> jobject fdObj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// C/C++ 实现</span>
<span class="token punctuation">}</span>

<span class="token constant">JNIEXPORT</span> jobject <span class="token constant">JNICALL</span> <span class="token class-name">Java_java_util_zip_ZipFile_getNextEntry</span><span class="token punctuation">(</span><span class="token class-name">JNIEnv</span> <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject zipFileObj<span class="token punctuation">,</span> jlong jzfile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// C/C++ 实现</span>
<span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="Entry_192">
     </a>
     编程中的Entry出处
    </h2>
    <p>
     entry有两个意思，代码中的entry通常就有两类方法，一个指的是入口。
     <br/>
     例如汇编程序中的伪指令 ENTRY 指的是程序入口
     <br/>
     一个指的是条目例如键值对，数据行。
    </p>
    <h2>
     <a id="JavaEntry__198">
     </a>
     Java中的Entry 接口
    </h2>
    <p>
     <a href="https://docs.pingcode.com/baike/179737" rel="nofollow">
      参考文章
     </a>
    </p>
    <h2>
     <a id="toString____201">
     </a>
     为什么流的toString 有 $ 号
    </h2>
    <p>
     常规toString，Object类下的实现
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"@"</span> <span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     在Java中，$ 符号出现在类名中通常是因为该类是内部类或辅助类。具体到ReferencePipeline$Head，这里的 $用于区分外部类和内部类的名字。ReferencePipeline是一个实现流（Stream）操作的基础抽象类，而Head是它的一个静态内部类。
    </p>
    <p>
     ReferencePipeline.Head代表了流的头部或者说是起始点，它是流的第一个处理阶段，负责从数据源获取元素，并开始一系列中间操作和终端操作。使用内部类可以帮助组织代码，使代码更加模块化和清晰，同时也有助于封装实现细节，避免不必要的暴露。
    </p>
    <p>
     在Java编译器生成的字节码文件中，内部类的名字通常会包含一个 $符号，以示区分。例如，如果有一个名为OuterClass的外部类和一个名为InnerClass的内部类，那么编译后的字节码文件可能会被命名为OuterClass $InnerClass.class。这是Java语言规范的一部分，用以确保不同类之间的名字空间隔离。因此，在查看类名或调试时看到 $符号是正常的，它指示了一个内部类的存在。
    </p>
    <p>
     <a href="https://blog.csdn.net/qq_26664043/article/details/141337548">
      参考文章
     </a>
    </p>
    <p>
     静态内部类Head源码：
    </p>
    <pre><code class="prism language-java">   <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Head</span><span class="token generics"><span class="token punctuation">&lt;</span>E_IN<span class="token punctuation">,</span> E_OUT<span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">ReferencePipeline</span><span class="token generics"><span class="token punctuation">&lt;</span>E_IN<span class="token punctuation">,</span> E_OUT<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * Constructor for the source stage of a Stream.
         *
         * @param source {@code Supplier&lt;Spliterator&gt;} describing the stream
         *               source
         * @param sourceFlags the source flags for the stream source, described
         *                    in {@link StreamOpFlag}
         */</span>
        <span class="token class-name">Head</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Spliterator</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
             <span class="token keyword">int</span> sourceFlags<span class="token punctuation">,</span> <span class="token keyword">boolean</span> parallel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> sourceFlags<span class="token punctuation">,</span> parallel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/**
         * Constructor for the source stage of a Stream.
         *
         * @param source {@code Spliterator} describing the stream source
         * @param sourceFlags the source flags for the stream source, described
         *                    in {@link StreamOpFlag}
         */</span>
        <span class="token class-name">Head</span><span class="token punctuation">(</span><span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
             <span class="token keyword">int</span> sourceFlags<span class="token punctuation">,</span> <span class="token keyword">boolean</span> parallel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> sourceFlags<span class="token punctuation">,</span> parallel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">opIsStateful</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">final</span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>E_IN<span class="token punctuation">&gt;</span></span> <span class="token function">opWrapSink</span><span class="token punctuation">(</span><span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>E_OUT<span class="token punctuation">&gt;</span></span> sink<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Optimized sequential terminal operations for the head of the pipeline</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> E_OUT<span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isParallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">sourceStageSpliterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachRemaining</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forEachOrdered</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> E_OUT<span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isParallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">sourceStageSpliterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEachRemaining</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">forEachOrdered</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="Object_281">
     </a>
     Object类下的本地方法
    </h2>
    <ul>
     <li>
      getClass
     </li>
    </ul>
    <pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">CONSTRUCTOR</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">IntrinsicCandidate</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@IntrinsicCandidate</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      hashCode
     </li>
    </ul>
    <pre><code class="prism language-java">    <span class="token annotation punctuation">@IntrinsicCandidate</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      clone
     </li>
    </ul>
    <pre><code class="prism language-java">    <span class="token annotation punctuation">@IntrinsicCandidate</span>
    <span class="token keyword">protected</span> <span class="token keyword">native</span> <span class="token class-name">Object</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      notify
     </li>
    </ul>
    <pre><code class="prism language-java">    <span class="token annotation punctuation">@IntrinsicCandidate</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      notifyAll
     </li>
    </ul>
    <pre><code class="prism language-java">    <span class="token annotation punctuation">@IntrinsicCandidate</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ul>
     <li>
      wait
     </li>
    </ul>
    <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeoutMillis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
</code></pre>
    <h2>
     <a id="stream_328">
     </a>
     stream（）方法
    </h2>
    <p>
     <a href="https://zhuanlan.zhihu.com/p/47478339" rel="nofollow">
      参考
     </a>
    </p>
    <pre><code class="prism language-java">    <span class="token keyword">default</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">StreamSupport</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token function">spliterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">,</span> <span class="token keyword">boolean</span> parallel<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>spliterator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReferencePipeline<span class="token punctuation">.</span>Head</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>spliterator<span class="token punctuation">,</span>
                                            <span class="token class-name">StreamOpFlag</span><span class="token punctuation">.</span><span class="token function">fromCharacteristics</span><span class="token punctuation">(</span>spliterator<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                            parallel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h2>
     <a id="javautilfunction__consumer__StreamBuilder_346">
     </a>
     java.util.function 中的 consumer 以及 Stream接口中的接口Builder
    </h2>
    <h2>
     <a id="Java_348">
     </a>
     Java中的自我类型引用
    </h2>
    <pre><code class="prism language-java"><span class="token keyword">interface</span> <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">BaseStream</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> 
</code></pre>
    <p>
     这种设计在Java的流式APi中被广泛使用，例如Stream IntStream接口。
    </p>
    <p>
     T 是第一个泛型参数，代表流中的元素类型。例如，在Stream&lt; String&gt; 中，T就是String。
    </p>
    <p>
     S 是第二个泛型参数，它表示一个具体的子类型，并且必须是BaseStream的某个实现类或者子接口。
    </p>
    <p>
     S extends BaseStream &lt;T,S&gt; 这种设计允许你在接口中返回当前类型的实例，从而实现链式调用。
    </p>
    <p>
     也就是说，我这个接口的实现类支持返回自己，从而再次调用stream中的方法。
    </p>
    <p>
     <a href="https://zhuanlan.zhihu.com/p/47478339" rel="nofollow">
      参考
     </a>
    </p>
    <p>
     如果没有子类型引用会是这样：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> predicate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BaseStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     那么我方法返回值就无法进行链式调用，因为无法访问stream的特有方法
    </p>
    <h2>
     <a id="_377">
     </a>
     今日灵感（文字功底有限）
    </h2>
    <p>
     到底什么是学习：无论是Spring轻量级框架，数据库，还是中间件八股文算法。这些东西的本质好像都没有变过，就是解决问题。所以学习就是一个不断解决问题的过程，如果你看到了问题却没有解决，选择安于现状或者取捷径，这无疑会毁了你自己。如果你对陌生问题急切地寻求答案，也许你需要冷静一下。如果你决定去寻找经典问题、母题，亲身体验解决过程后再附上一个小故事，这样，史书上的一页就轻轻印刻在我们后来人的灵魂中。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f36333439373630372f:61727469636c652f64657461696c732f313436323234373433" class_="artid" style="display:none">
 </p>
</div>


