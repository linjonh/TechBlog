---
layout: post
title: 操作系统计组页面大小-与-页表项-二级页表-多级页表-
date: 2024-12-27 14:10:16 +0800
categories: ['考研408']
tags: ['操作系统']
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=122118245
    alt: 操作系统计组页面大小-与-页表项-二级页表-多级页表-
artid: 122118245
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=122118245
featuredImagePreview: https://bing.ee123.net/img/rand?artid=122118245
---

# 【操作系统/计组】页面大小 与 页表项 （ 二级页表 、多级页表 ）

#### 【操作系统/计组】页面大小 与 页表项

* + - * [结论1（一级页表）](#1_25)
      * [结论2（二级、多级页表）](#2_57)
    - [例题](#_76)

  
首先，不论一级页表还是多级页表：
  
页面大小 = 2^（页内地址位数）
  
页号有多少，页就有多少个
  
用于存放页的地址空间就可以写为

| 页号 | 页内地址(或叫位移量） |
| --- | --- |

接下来，分别来看一级页表和多级页表

**1. 一级页表**
  
页表是系统为每个进程建立的页面映射表
  
进程中的每一页在页表中都有一项，这个项就是页表项，大小可以理解为页表中一行的大小
  
每个页表项的结构为：

| 页号 | 物理块号 |
| --- | --- |

此时，存储页号和物理块号的空间大小是页表项的大小

整个页表的内容就是：

| 页号 | 物理块号 |
| --- | --- |
| 页号 | 物理块号 |
| 页号 | 物理块号 |
| 页号 | 物理块号 |
| …… | …… |

易知，页表大小 = 页表项的大小 x 页表项的个数

##### 结论1（一级页表）

**在一级页表，可以认为页表项大小与页面大小没有关系**

**2.二级页表**
  
当页面数量很多时，需要标很多页号，导致页号占的位数很多。
  
如果将所有的页号及对应的物理块号写入一个页表，页表会非常长，页表需要占据太多连续地址空间，而内存空间不够，因此需要将一页拆分

将原先页号的部分

| 页号 |
| --- |

按照原始页面大小，拆分为页号 和 “页面”。注意，还是行使页表的功能，实现页号与物理块号的映射，只是改变了结构

| 页号 | 页面 |
| --- | --- |

现在拥有存放页的地址空间就变成了

| 页号 | 页面1 | 页面2 |
| --- | --- | --- |

将现在的页号命名为【外层页号】
  
将从页号拆分出来的页面1命名为【外层页】
  
原始的页面视为【内层页】

| 外层页号 | 外层页 | 内层页 |
| --- | --- | --- |

接下来看位数
  
内层页还是原始页面的大小
  
上文提到，外层页面大小 = 内层页面大小
  
但外层页是要履行页表功能，存放内层页的索引，页表项还是“一行”的大小
  
因此外层页的位数 = log2（内层页面大小 / 页表项的大小），即外层页还是表示存放页表项的个数
  
这就是页面大小与页表项大小的关系

在课本中，二级页表结构为

| 外层页号 | 外层页内地址 | 页内地址 |
| --- | --- | --- |

##### 结论2（二级、多级页表）

**1）外层页号对外层页的计数，存放外层页号，位数 = log2（外层页个数）**

**2） 外层页存放的页表项是内层页的索引，外层页大小 = 内层页大小，外层页内地址位数 = log2（页面大小 / 页表项的大小）**

**3）页内地址位数 = log2（页面大小），存放物理地址**

**3.多级页表**
  
在二级页表的基础上，如果页表还是大，没有足够连续内存空间，就再将页号的空间划分，可理解为：

| 外层页号 | 外层页n | …… | 外层页3 | 外层页2 | 外层页1 | 内层页 |
| --- | --- | --- | --- | --- | --- | --- |

称为n+1级页表。例如外层页共分3页，称为四级页表。
  
多级页表的最高页表项，即外层页n的大小不能超出一页大小了
  
同样，每个外层页的大小 = 内层页面大小
  
每个外层页的位数 = log2( 页面大小 / 页表项大小 )

**按理来说，外层页号占的空间需不超过一个页面大小，外层页以及内层页的大小都为一个页面大小**

---

#### 例题

已知系统为48位地址，页面大小4KB，页表项大小为8B，使用页式存储，则要采用多少级页表，页内偏移多少位 ?

页面大小 = 2 ^12 B，故页内偏移12位
  
页号位数 = 48-12 = 36
  
4KB / 8B = 2 ^9 ，一个页面能装下2 ^9个页表项
  
按理来说，外层页以及内层页的大小都应为一个页面大小，外层页号需不超过一个页面大小，不然需要对外层页号再次分页
  
因此，36/9 = 4 ，需要四级页表

---

以上是本人理解，欢迎各位指正