---
layout: post
title: "CANOE-仿真测试"
date: 2023-10-28 14:47:43 +0800
description: "基于CANoe的自动化测试系统架构，根据ECU的测试环境和测试规范，搭建基于CANoe的测试系统，通"
keywords: "canoe测试工具"
categories: ['车载测试']
tags: ['网络']
artid: "134090143"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=134090143
    alt: "CANOE-仿真测试"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=134090143
featuredImagePreview: https://bing.ee123.net/img/rand?artid=134090143
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CANOE 仿真+测试
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <div class="toc">
     <h4>
      仿真+测试
     </h4>
     <ul>
      <li>
       <a href="#CANoe_1" rel="nofollow">
        CANoe的自动化测试系统简介
       </a>
      </li>
      <li>
       <a href="#Canoe_TFSTest_Feature_Set_3" rel="nofollow">
        Canoe TFS(Test Feature Set)
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_7" rel="nofollow">
          测试判别函数
         </a>
        </li>
        <li>
         <a href="#_15" rel="nofollow">
          测试架构函数
         </a>
        </li>
        <li>
         <a href="#_37" rel="nofollow">
          测试报告函数
         </a>
        </li>
        <li>
         <a href="#_53" rel="nofollow">
          检测函数
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#_59" rel="nofollow">
        创建自动化测试工程
       </a>
      </li>
      <li>
       <ul>
        <li>
         <a href="#_127" rel="nofollow">
          其他常用函数
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <p>
    </p>
    <h2>
     <a id="CANoe_1">
     </a>
     CANoe的自动化测试系统简介
    </h2>
    <p>
     基于CANoe的自动化测试系统架构，根据ECU的测试环境和测试规范，搭建基于CANoe的测试系统，通过开始测试模块(Test Module)或测试单元(Test Unit)、网络控制硬件接口(如VN2600)、外围的硬件在环设备(如TV System)以及数据采集和控制I/O等板卡,实现高效的自动化测试。
    </p>
    <h2>
     <a id="Canoe_TFSTest_Feature_Set_3">
     </a>
     Canoe TFS(Test Feature Set)
    </h2>
    <p>
     Canoe Test Feature Set是一套专为Canoe测试工具开发的功能集，旨在提供全面、完善的测试功能，帮助测试工程师进行各种测试任务，TFS包含一系列测试功能函数。
    </p>
    <h3>
     <a id="_7">
     </a>
     测试判别函数
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        函数
       </th>
       <th>
        功能描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        TestCaseFail
       </td>
       <td>
        用于将当前测试用例的判别设为fail
       </td>
      </tr>
      <tr>
       <td>
        TestGetVerdictLastTestCase
       </td>
       <td>
        用于返回上一次测试用例的判别结果
       </td>
      </tr>
      <tr>
       <td>
        TestGetVerdictModule
       </td>
       <td>
        用于返回测试模块的当前判别结果
       </td>
      </tr>
      <tr>
       <td>
        TestSetVerdictModule
       </td>
       <td>
        用于设定测试模块的当前判别结果
       </td>
      </tr>
      <tr>
       <td>
        TestStepFail
       </td>
       <td>
        用于描述当前测试步骤的错误信息
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_15">
     </a>
     测试架构函数
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        函数
       </th>
       <th>
        功能描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        TestCaseDescription
       </td>
       <td>
        用于将测试用例的描述写入测试报告
       </td>
      </tr>
      <tr>
       <td>
        TestCaseSkipped
       </td>
       <td>
        用于在测试报告描述中跳过某个测试用例
       </td>
      </tr>
      <tr>
       <td>
        TestCaseTitle
       </td>
       <td>
        用于设定测试用例的标题
       </td>
      </tr>
      <tr>
       <td>
        TestCaseReportMeasuredValue
       </td>
       <td>
        用于在测试报告中添加测试参数的测量值
       </td>
      </tr>
      <tr>
       <td>
        TestGroupBegin
       </td>
       <td>
        用于测试分组的开始
       </td>
      </tr>
      <tr>
       <td>
        TestGroupEnd
       </td>
       <td>
        用于测试分组的结尾
       </td>
      </tr>
      <tr>
       <td>
        TestModuleDescription
       </td>
       <td>
        用于在测试报告中描述测试模块
       </td>
      </tr>
      <tr>
       <td>
        TestModuleTitle
       </td>
       <td>
        用于设定测试模块的标题
       </td>
      </tr>
      <tr>
       <td>
        TestStep
       </td>
       <td>
        用于报告测试步骤信息，而不对测试结果有任何影响
       </td>
      </tr>
      <tr>
       <td>
        TestStepErrorInTestSystem
       </td>
       <td>
        用于描述某个测试步骤在测试系统中发生一个错误
       </td>
      </tr>
      <tr>
       <td>
        TestStepFail
       </td>
       <td>
        用于描述某个测试步骤发生错误
       </td>
      </tr>
      <tr>
       <td>
        TestStepInconclusive
       </td>
       <td>
        用于描述某个测试步骤测试结果无法判别通过（pass）还是失败（fail）
       </td>
      </tr>
      <tr>
       <td>
        TestStepPass
       </td>
       <td>
        用于描述某个测试步骤测试结果通过（pass），满足期望结果
       </td>
      </tr>
      <tr>
       <td>
        TestStepWarning
       </td>
       <td>
        用于描述某个测试步骤的警示信息
       </td>
      </tr>
      <tr>
       <td>
        TestInfoTable
       </td>
       <td>
        用于创建一个新表格，使测试报告显示更加结构化
       </td>
      </tr>
      <tr>
       <td>
        TestInfoHeadingBegin
       </td>
       <td>
        用于在表格中添加一个表头
       </td>
      </tr>
      <tr>
       <td>
        TestInfoHeadingEnd
       </td>
       <td>
        用于在表格中添加表头结束
       </td>
      </tr>
      <tr>
       <td>
        TestInfoRow
       </td>
       <td>
        用于在表格中添加一个行
       </td>
      </tr>
      <tr>
       <td>
        TestInfoCell
       </td>
       <td>
        用于在表格或者表头行添加单元格内容
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_37">
     </a>
     测试报告函数
    </h3>
    <table>
     <thead>
      <tr>
       <th>
        函数
       </th>
       <th>
        功能描述
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        TestCaseComment
       </td>
       <td>
        用于在测试用例中添加一个备注信息
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddEngineerInfo
       </td>
       <td>
        用于在测试报告中添加一些测试配置信息，如测试员、测试设定和待测样品等
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddSetupInfo
       </td>
       <td>
        用于在测试报告中添加一些测试配置信息，如测试员、测试设定和待测样品等
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddSUTInfo
       </td>
       <td>
        用于在测试报告中添加一些测试配置信息，如测试员、测试设定和待测样品等
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddExtendedInfo
       </td>
       <td>
        用于在测试报告中直接添加其他协议的信息（如HTML、text或XML），而处理不依赖于CANoe
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddExternalRef
       </td>
       <td>
        用于在测试报告中添加外部应用（如URL）
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddImage
       </td>
       <td>
        用于在测试报告中添加图片
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddMiscInfo
       </td>
       <td>
        用于在测试报告中添加一些额外信息
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddMiscInfoBlock
       </td>
       <td>
        用于在测试报告中添加一些额外信息区域
       </td>
      </tr>
      <tr>
       <td>
        TestReportAddWindowCapture
       </td>
       <td>
        用于在测试报告中对某个测试用例抓取指定窗口图片
       </td>
      </tr>
      <tr>
       <td>
        TestReportFileName
       </td>
       <td>
        用于动态设定测试报告名称
       </td>
      </tr>
      <tr>
       <td>
        TestReportWriteDiagObject
       </td>
       <td>
        用于将某些指定对象以HTML表格形式写入测试报告
       </td>
      </tr>
      <tr>
       <td>
        TestReportWriteDiagResponse
       </td>
       <td>
        用于将接收到的诊断响应以一个HTML表格的形式写入测试报告
       </td>
      </tr>
     </tbody>
    </table>
    <h3>
     <a id="_53">
     </a>
     检测函数
    </h3>
    <p>
     CANoe为用户提供了多种检测函数(CheckDescriptions),主要包括以下几个方面的检测。
    </p>
    <ol>
     <li>
      SignalEvaluation〔信号验证〕：包括信号的数值有效性、周期和稳定性等检测。
     </li>
     <li>
      MessageEvaluation(报文验证〕：包括报文丢失、周期、数据长度、错误帧等检测。
     </li>
     <li>
      TimeEvaluation〔时间验证〕：包括连续帧及超时等检测。
     </li>
    </ol>
    <h2>
     <a id="_59">
     </a>
     创建自动化测试工程
    </h2>
    <ol>
     <li>
      <p>
       点击Test下面的Test Setup
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/2bd11c4618e364e5f0461d4dd0695cfa.png"/>
      </p>
     </li>
     <li>
      <p>
       空白位置右击，新建测试环境，并命名。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cdf5342787f70f3cc989d101709f0c7e.png"/>
      </p>
     </li>
     <li>
      <p>
       插入CAPL测试模块，并简单配置该模块。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/9414b356102683b45da4f53d1c3c153f.png"/>
      </p>
     </li>
     <li>
      <p>
       双击该测试名称，进入编辑界面，点击下方的小铅笔，可以开始进行测试脚本编写。
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/92bd9fbfa3d1480e4ed4c812aaef9c06.png"/>
      </p>
     </li>
     <li>
      <p>
       测试脚本样例
      </p>
     </li>
    </ol>
    <pre><code class="prism language-go">variables
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> kTIMEOUT<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">;</span><span class="token comment">//常变量 测试等待时间为5s</span>
<span class="token punctuation">}</span>

void <span class="token function">MainTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//void返回值为空 ，测试程序的主入口</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token function">testModuleTitle</span><span class="token punctuation">(</span><span class="token string">"TestDemo002"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试模块名称</span>
  <span class="token function">testModuleDescription</span><span class="token punctuation">(</span><span class="token string">"这是Demo002的测试集"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试模块描述</span>
  <span class="token function">testGroupBegin</span><span class="token punctuation">(</span><span class="token string">"测试组"</span><span class="token punctuation">,</span><span class="token string">"测试组描述"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试组开始</span>
  <span class="token function">checkEngineSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">testGroupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试组结束</span>

<span class="token punctuation">}</span>


testcase <span class="token function">checkEngineSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  dword checkId<span class="token punctuation">;</span><span class="token comment">//存放检测函数的返回值</span>
  <span class="token function">testCaseTitle</span><span class="token punctuation">(</span><span class="token string">"TC-1"</span><span class="token punctuation">,</span><span class="token string">"TC-1测试引擎转速区间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试用例标题</span>
  <span class="token function">testCaseDescription</span><span class="token punctuation">(</span><span class="token string">"应用报文的功能测试"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试用例描述</span>
  <span class="token comment">//判断信号的值所在区间</span>
  checkId<span class="token operator">=</span><span class="token function">ChkStart_MsgSignalValueRangeViolation</span><span class="token punctuation">(</span>Engine<span class="token punctuation">:</span><span class="token punctuation">:</span>EngineSpeed<span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">testAddCondition</span><span class="token punctuation">(</span>checkId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加测试条件</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>checkId<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">testStepPass</span><span class="token punctuation">(</span><span class="token string">"引擎转速区间在2000-5000之间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token function">testStepFail</span><span class="token punctuation">(</span><span class="token string">"引擎转速区间不在2000-5000之间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">testWaitForTimeout</span><span class="token punctuation">(</span>kTIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加测试等待时间</span>
  <span class="token function">testRemoveCondition</span><span class="token punctuation">(</span>checkId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//测试结束后 移除测试条件</span>
  <span class="token comment">//测试报告的测试用例处添加</span>
  <span class="token function">TestReportAddMiscInfoBlock</span><span class="token punctuation">(</span><span class="token string">"测试参数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//额外信息区域</span>
  <span class="token function">TestReportAddMiscInfo</span><span class="token punctuation">(</span><span class="token string">"Max. voltage"</span><span class="token punctuation">,</span> <span class="token string">"19.5 V"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//额外信息</span>
  <span class="token function">TestReportAddMiscInfo</span><span class="token punctuation">(</span><span class="token string">"Max. current"</span><span class="token punctuation">,</span> <span class="token string">"560 mA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">TestReportAddImage</span><span class="token punctuation">(</span><span class="token string">"IP Snapshot"</span><span class="token punctuation">,</span> <span class="token string">"IP.png"</span><span class="token punctuation">,</span> <span class="token string">"400px"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <ol start="6">
     <li>
      仿真测试
      <br/>
      此测试项目参考 https://blog.csdn.net/m0_48468018/article/details/133847476?spm=1001.2014.3001.5501，需要先运行项目，然后进行仿真，最后测试面板点击三角符号，进行仿真测试
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/a1dc0b9bdda4dd71f558e27296e431d9.png"/>
     </li>
     <li>
      测试结果查看
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cbb68754c6b9f3eaa26277431c44594f.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/bbfe4681ef3067964c01d690f5539147.png"/>
      </img>
     </li>
     <li>
      查看函数的含义，测试过程中有一个比较重要的函数是
      <strong>
       ChkStart_MsgSignalValueRangeViolation
      </strong>
      ，如果不清楚函数的含义，可以鼠标移动到函数的位置，点击F1查看官方的帮助文档。
      <br/>
      <img alt="9." src="https://i-blog.csdnimg.cn/blog_migrate/0a6db882f2c68095b6a1b2c54916e401.png"/>
     </li>
    </ol>
    <h3>
     <a id="_127">
     </a>
     其他常用函数
    </h3>
    <ol>
     <li>
      ChkStart_InconsistentDlc：检查DLC（数据长度代码）不一致的情况。
     </li>
     <li>
      ChkStart_UndefinedMessageReceived：检查是否接收到未定义的消息。
     </li>
     <li>
      ChkStart_MsgAbsCycleTimeViolation：检查消息的绝对周期时间是否超出限制。
     </li>
     <li>
      ChkStart_MsgRelCycleTimeViolation：检查消息的相对周期时间是否超出限制。
     </li>
     <li>
      ChkStart_NodeMsgsRelCycleTimeViolation：检查节点消息的相对周期时间是否超出限制。
     </li>
     <li>
      ChkStart_ErrorFramesOccured：检查是否发生错误帧。
     </li>
     <li>
      ChkQuery_NumEvents：查询事件数量。
     </li>
     <li>
      ChkStart_MsgOccurrenceCount：检查消息的出现次数是否超出限制。
     </li>
     <li>
      ChkStart_MsgDistViolation：检查消息分布是否超出限制。
     </li>
     <li>
      ChkStart_AllNodesDead：检查所有节点是否都不存活。
     </li>
     <li>
      ChkStart_AllNodesBabbling：一个时间间隔，在这个时间间隔内传输是被允许的。一旦超过了这个时间间隔，所有节点都不能再发送消息。
     </li>
     <li>
      ChkStart_NodeMsgsAbsDistViolation：检查节点消息的绝对分布是否超出限制。
     </li>
     <li>
      ChkStart_MsgRelOccurrenceViolation：检查消息的相对出现次数是否超出限制。
     </li>
     <li>
      ChkStart_MsgSignalValueInvalid：检查消息的信号值是否无效。
     </li>
     <li>
      ChkStart_SignalValueChange：检查信号值是否发生改变。
     </li>
     <li>
      ChkStart_SignalCycleTimeViolation：检查信号的周期时间是否超出限制。
     </li>
     <li>
      ChkStart_Timeout：检查是否发生超时。
     </li>
     <li>
      故障注入函数
     </li>
    </ol>
    <pre><code class="prism language-go">On key <span class="token char">'z'</span>
<span class="token punctuation">{<!-- --></span>
<span class="token function">testSetMsgDlc</span><span class="token punctuation">(</span>EngineState<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>将报文EngineState的DLC设置为<span class="token number">5</span>。
<span class="token function">testResetMsgDlc</span><span class="token punctuation">(</span>EngineState<span class="token punctuation">)</span><span class="token punctuation">;</span>将报文EngineState的DLC重置为默认值。
<span class="token function">testSetMsgCycleTime</span><span class="token punctuation">(</span><span class="token number">0x150</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>故障注入，将引擎报文的循环周期设置为50ms。
<span class="token function">TestDisableMsg</span><span class="token punctuation">(</span><span class="token number">0x250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>禁用报文<span class="token number">0x250</span>。
<span class="token function">TestWaitForTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>等待超时时间为<span class="token number">2000</span>毫秒。
<span class="token function">TestSetMsgEvent</span><span class="token punctuation">(</span><span class="token number">0x250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>设置报文<span class="token number">0x250</span>的事件。
<span class="token function">TestEnableMsg</span><span class="token punctuation">(</span><span class="token number">0x250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>启用报文<span class="token number">0x250</span>。
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f34383436383031382f:61727469636c652f64657461696c732f313334303930313433" class_="artid" style="display:none">
 </p>
</div>


