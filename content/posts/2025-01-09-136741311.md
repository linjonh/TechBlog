---
layout: post
title: "HarmonyOS下拉刷新组件使用详情"
date: 2025-01-09 23:47:19 +0800
description: "主要介绍在HarmonyOs下第三方下拉刷新组件refresh的RefreshLayout形式详细使"
keywords: "鸿蒙下拉刷新"
categories: ['Harmonyos']
tags: ['移动端', '华为', 'Harmonyos', 'Arkts']
artid: "136741311"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=136741311
    alt: "HarmonyOS下拉刷新组件使用详情"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=136741311
featuredImagePreview: https://bing.ee123.net/img/rand?artid=136741311
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     「HarmonyOS」下拉刷新组件使用详情
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h6>
     <a id="refreshRefreshLayout_0">
     </a>
     前言：在客户端开发过程中，经常会出现下拉刷新的功能，用于重新加载数据和加载更多数据，通过查找相关资料，查找到一个refresh下拉刷新的第三方库，今天主要介绍一下其中比较常用的RefreshLayout形式下拉刷新使用方法
    </h6>
    <h4>
     <a id="_2">
     </a>
     一、组件介绍
    </h4>
    <p>
     Harmony系统其实提供了一个Refresh组件，但是系统的功能与日常的开发，还是存在这个比较大的出入，比较难以满足我们实际的需求，所以我找到了一个开发者写的第三方库
     <br/>
     相关链接：
     <a href="https://juejin.cn/post/7294556533931802676" rel="nofollow">
      HarmonyOS开发：开源一个刷新加载组件
     </a>
    </p>
    <h4>
     <a id="har_6">
     </a>
     二、引入本地静态共享包har包
    </h4>
    <p>
     1.下载har包，
     <a href="https://github.com/AbnerMing888/HarmonyOsRefresh/raw/master/entry/libs/refresh-1.0.0.har">
      点击下载
     </a>
     <br/>
     2.把har包复制到项目中，目录我这边创建了一个libs目录，复制进去，引入之后，在"oh-package.json5"文件中进行同步项目，点击右上角Sync Now即可
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/51c7ff8b371b91264ec174a4d5c02855.png">
      <br/>
      3.检查是否引入成功
      <br/>
      如果引入成功，最终都会在使用的模块中，生成一个oh_modules文件，并创建源代码文件，有则成功，无则失效，如下图：
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/cf99c1513d3899c1b416671ffa8442b5.png"/>
     </img>
    </p>
    <h4>
     <a id="_14">
     </a>
     三、使用组件
    </h4>
    <p>
     目前库中主要提供的用法有三种。
     <br/>
     1.ListView形式，单列表形式
     <br/>
     2.GridView形式，网格列表形式
     <br/>
     3.RefreshLayout形式，支持任何组件形式，如Column，Row等
    </p>
    <p>
     在使用下来，个人最喜欢使用第三种形式，这种形式使用起来最为方便和容易实现预期样式，所以本文主要介绍第三种RefreshLayout形式，其他形式介绍可前往组件作者的博客：
     <a href="https://juejin.cn/post/7294556533931802676" rel="nofollow">
      HarmonyOS开发：开源一个刷新加载组件
     </a>
     ，进行查看学习
    </p>
    <pre><code class="prism language-ArkTs">import router from '@ohos.router'
import { NewsBean } from '../../bean/NewsBean'
import { RefreshController, RefreshLayout } from '@app/refresh'
import { HttpApiManager } from '../../http/HttpApiManager'

@Entry
@Component
export struct RefreshPage {
	@State pageNo: number = 1
	@State refreshController: RefreshController = new RefreshController()
	@State dataArray: Array&lt;NewsBean&gt; = []
  build() {
        Column() {
			RefreshLayout({
			            controller: this.refreshController,
			            onRefresh: () =&gt; {
			              //下拉刷新
			              this.getNewList()
			            },
			            onLoadMore: () =&gt; {
			              //上拉加载
			              this.getMoreNewList()
			            }
			          }) {
			          		//可以是任何组件 List/Grid/Column/Row/Text/……
			          		// 以List举例
			          		List() {...}
			          		.onScrollIndex((start: number, end: number) =&gt; {
			                //必须添加，用于控制下拉和上拉何时展示
			                this.refreshController.markLocation(start, end, this.dataArray.length + 1)
			              })
			          }
			 }
	  }

		// 重新加载数据
		getNewList() {
			// 数组清空
		    this.dataArray = []
   			// 参数重置
		    this.pageNo = 1
		
			// 获取数据 每次拿20个
		    HttpApiManager.getInstance().getNewsList('20', this.pageNo.toString())
		      .then((data: Array&lt;NewsBean&gt;) =&gt; {
		        this.refreshController.finishRefresh() //关闭下拉刷新
		        this.dataArray = data
		        this.pageNo++
				// 如果获取的数组少于20个，说明数据已全部取完了
		        if (data.length &lt; 20) {
		          // 下拉控制器不再加载更多数据
		          this.refreshController.finishLoadMore(true)
		
		        } else {
     		       // 下拉控制器可以加载更多数据
		          this.refreshController.finishLoadMore(false)
		        }
		      })
		      .catch(error =&gt; {
		        ToastUtil.getInstance().showToast(error.message)
		      })
		  }

		// 加载更多数据
		getMoreNewList() {
		    HttpApiManager.getInstance().getNewsList('20', this.pageNo.toString())
		      .then((data: Array&lt;NewsBean&gt;) =&gt; {
		        this.refreshController.finishLoadMore() //关闭上拉加载
		        this.dataArray = this.dataArray.concat(data)
		        this.pageNo++
		        
		        if (data.length &lt; 20) {
		          this.refreshController.finishLoadMore(true)
		
		        } else {
		          this.refreshController.finishLoadMore(false)
		        }
		      })
		      .catch(error =&gt; {
		        ToastUtil.getInstance().showToast(error.message)
		      })
		  }
}
</code></pre>
    <h4>
     <a id="_109">
     </a>
     四、效果展示
    </h4>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/847943803940e0dd491993aad4b1068d.gif"/>
    </p>
    <h4>
     <a id="_112">
     </a>
     五、扩展
    </h4>
    <p>
     由上图可以看出，我在下拉加载器上方还有一个title，整体样式如下图所示，这样的样式实现方法，作者在博客中也有写到，具体是必须使用Stack作为根布局，让头组件覆盖在刷新组件上
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/blog_migrate/1aef80703f18cf5e3dfa24f02a7a3ccd.png"/>
    </p>
    <p>
     具体代码实现：
    </p>
    <pre><code class="prism language-ArkTs">build() {
      Stack() {
        Column() {
			// Title
          Text('汽车资讯')
            .fontColor($r('app.color.smart_24292B'))
            .fontSize(24)
            .fontWeight(FontWeight.Medium)
            .backgroundColor($r('app.color.smart_FFFFFF'))
            .padding({left: 32, top: 16, bottom: 14})
            .width(BaseUtils.screenWidth)
            .zIndex(1)

		RefreshLayout({
		            controller: this.refreshController,
		            onRefresh: () =&gt; {
		              //下拉刷新
		              this.getNewList()
		            },
		            onLoadMore: () =&gt; {
		              //上拉加载
		              this.getMoreNewList()
		            }
		          }) {
		          	List() {...}
			          	.onScrollIndex((start: number, end: number) =&gt; {
		                //必须添加，用于控制下拉和上拉何时展示
		                this.refreshController.markLocation(start, end, this.dataArray.length + 1)
		              })
		              .zIndex(0)
	              }
              }
           }
      }
</code></pre>
    <p>
     因为为了代码的可读性，所以我在Title组件和RefreshLayout组件下方分别使用了zIndex属性，让title组件盖在RefreshLayout组件上，以实现样式
    </p>
    <h5>
     <a id="_156">
     </a>
     参考文档：
    </h5>
    <p>
     <a href="https://juejin.cn/post/7294556533931802676" rel="nofollow">
      HarmonyOS开发：开源一个刷新加载组件
     </a>
    </p>
    <p>
     该文章主要介绍了使用
     <strong>
      程序员一鸣
     </strong>
     的刷新加载组件库，其github地址为
     <a href="https://github.com/AbnerMing888/HarmonyOsRefresh">
      https://github.com/AbnerMing888/HarmonyOsRefresh
     </a>
     ，认为对您有帮助的话，也帮作者点点Star
    </p>
    <h4>
     <a id="_161">
     </a>
     总结：
    </h4>
    <p>
     当前HarmonyOs仍在初步学习过程中，大家如果感兴趣或者有问题可以一起沟通交流
     <br/>
     如果该文章对你有所帮助的话，可以
     <strong>
      点赞、收藏并关注一下
     </strong>
     ！后续会持续更新更多技术内容
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f64616e6a69756a69616f68756e2f:61727469636c652f64657461696c732f313336373431333131" class_="artid" style="display:none">
 </p>
</div>


