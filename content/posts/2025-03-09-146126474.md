---
layout: post
title: "Parser-模块HTML-解析与数据清洗"
date: 2025-03-09 02:46:23 +0800
description: "筛选出所有 .html 文件，为后续解析提供数据源；从 .html 文件中提取 title、content ，并构造对应官网的 url 地址；将清洗后的数据按自定义格式存储为文本文件，便于后续建立索引。本文主要讲解编写 Parser 模块过程中涉及的部分知识。boost::filesystem 是 Boost 库中的一个组件，用于跨平台处理文件系统路径、文件操作和目录管理。它提供了面向对象的接口，简化了文件和目录的创建、删除、遍历等操作。"
keywords: "Parser 模块：HTML 解析与数据清洗"
categories: ['Boost']
tags: ['华为云', '华为Od', '华为', '前端', 'Linux', 'Html', 'Harmonyos']
artid: "146126474"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146126474
    alt: "Parser-模块HTML-解析与数据清洗"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146126474
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146126474
cover: https://bing.ee123.net/img/rand?artid=146126474
image: https://bing.ee123.net/img/rand?artid=146126474
img: https://bing.ee123.net/img/rand?artid=146126474
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Parser 模块：HTML 解析与数据清洗
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <blockquote>
     <h4>
      <a id="_3">
      </a>
      前言：
     </h4>
     <p>
      在构建 boost 库站内搜索引擎时，Parser 模块是数据处理的核心环节，它的核心功能包括：
     </p>
     <ul>
      <li>
       筛选出所有 .html 文件，为后续解析提供数据源；
      </li>
      <li>
       从 .html 文件中提取 title、content ，并构造对应官网的 url 地址；
      </li>
      <li>
       将清洗后的数据按自定义格式存储为文本文件，便于后续建立索引。
      </li>
     </ul>
     <p>
      本文主要讲解编写 Parser 模块过程中涉及的部分知识。
     </p>
    </blockquote>
    <h4>
     <a id="1_EnumFile__13">
     </a>
     1. EnumFile() 方法
    </h4>
    <p>
     <code>
      EnumFile()
     </code>
     方法的功能是，递归遍历指定目录及其子目录，收集所有后缀为
     <code>
      .html
     </code>
     的普通文件路径，并将结果存储到传入的 std::vector&lt;std::string&gt; 中。
    </p>
    <h5>
     <a id="11_boostfilesystem__17">
     </a>
     1.1 boost::filesystem 简介
    </h5>
    <p>
     boost::filesystem 是 Boost 库中的一个组件，用于跨平台处理文件系统路径、文件操作和目录管理。它提供了面向对象的接口，简化了文件和目录的创建、删除、遍历等操作。
    </p>
    <p>
     <em>
      <strong>
       使用：
      </strong>
     </em>
    </p>
    <ul>
     <li>
      包含头文件：
      <code>
       #include &lt;boost/filesystem&gt;
      </code>
     </li>
     <li>
      链接 Boost 库：
      <code>
       -lboost_system -lboost_filesystem
      </code>
     </li>
    </ul>
    <h5>
     <a id="12__28">
     </a>
     1.2 核心类及其使用
    </h5>
    <h6>
     <a id="121_path_30">
     </a>
     1.2.1 path
    </h6>
    <p>
     <code>
      boost::filesystem::path
     </code>
     用于表示文件系统路径（如文件或目录的路径），提供了跨平台的路径操作能力。
    </p>
    <blockquote>
     <p>
      在 Windows 平台，
      <code>
       D:\Develop\笔记\Boost库搜索引擎开发
      </code>
      可以被正确解析。
     </p>
     <p>
      在 Linux 平台，
      <code>
       /home/ZhengTongren/boost-search/data/input
      </code>
      可以被正确解析。
     </p>
    </blockquote>
    <p>
     path 可以通过 std::string、const char* 或其它 path 对象进行构造。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string src_path <span class="token operator">=</span> <span class="token string">"data/input/"</span><span class="token punctuation">;</span>
boost<span class="token double-colon punctuation">::</span>filesystem<span class="token double-colon punctuation">::</span>path <span class="token function">root_path</span><span class="token punctuation">(</span>src_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <em>
      <strong>
       相关方法：
      </strong>
     </em>
    </p>
    <ul>
     <li>
      filesystem::exists(path) ：检查路径是否存在
     </li>
     <li>
      is_regular_file(path) ：判断是否为普通文件
     </li>
     <li>
      path.extension() ：获取拓展名，带
      <code>
       .
      </code>
      ，如 .html
     </li>
    </ul>
    <h6>
     <a id="122_recursive_directory_iterator_53">
     </a>
     1.2.2 recursive_directory_iterator
    </h6>
    <blockquote>
     <p>
      recursive adj. 递归的
     </p>
    </blockquote>
    <p>
     boost::filesystem 中，
     <code>
      directory_iterator
     </code>
     和
     <code>
      recursive_directory_iterator
     </code>
     的作用类似于一个 “指针”，用于遍历文件系统中的目录内容。
    </p>
    <p>
     directory_iterator 提供了一种方式来迭代一个指定目录的内容，但它不会递归进入子目录。
    </p>
    <p>
     recursive_directory_iterator 则提供了递归遍历目录的功能，它不仅会列出指定目录下的所有条目，还会进入每个子目录继续遍历，直到遍历完整个目录树。
    </p>
    <pre><code class="prism language-cpp">boost<span class="token double-colon punctuation">::</span>filesystem<span class="token double-colon punctuation">::</span>recursive_directory_iterator <span class="token function">it</span><span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// root_path 是一个 filesystem::path 类对象；</span>
<span class="token comment">// 创建一个递归迭代器，指向 root_path 目录中的第一个条目（文件或子目录）；</span>
<span class="token comment">// 如果 root_path 不存在或无法访问，则抛出 filesystem_error 异常</span>

boost<span class="token double-colon punctuation">::</span>filesystem<span class="token double-colon punctuation">::</span>recursive_directory_iterator end<span class="token punctuation">;</span>
<span class="token comment">// 默认构造的迭代器表示结束</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> end<span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token comment">// 通过循环逐个访问条目，直到等于 end</span>
</code></pre>
    <h5>
     <a id="13__html__78">
     </a>
     1.3 递归遍历、搜集所有 .html 文件路径
    </h5>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;boost/filesystem&gt;</span></span>

<span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string src_path <span class="token operator">=</span> <span class="token string">"data/input/"</span><span class="token punctuation">;</span>

<span class="token keyword">bool</span> <span class="token function">EnumFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> src_path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span><span class="token operator">*</span> files_list<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">namespace</span> fs <span class="token operator">=</span> boost<span class="token double-colon punctuation">::</span>filesystem<span class="token punctuation">;</span>
    <span class="token comment">// 1. 初始化 path</span>
    fs<span class="token double-colon punctuation">::</span>path <span class="token function">root_path</span><span class="token punctuation">(</span>src_path<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 2. 检查路径是否存在 -- 不存在则 return false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token double-colon punctuation">::</span><span class="token function">exists</span><span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cerr <span class="token operator">&lt;&lt;</span> src_path <span class="token operator">&lt;&lt;</span> <span class="token string">" not exits!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3. 递归遍历目录及其子目录文件</span>
    fs<span class="token double-colon punctuation">::</span>recursive_directory_iterator end<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>fs<span class="token double-colon punctuation">::</span>recursive_directory_iterator <span class="token function">it</span><span class="token punctuation">(</span>root_path<span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> end<span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 3.1 跳过目录文件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_regular_file</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.2 跳过非 .html 普通文件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token operator">-&gt;</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extension</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">".html"</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.3 插入</span>
        files_list<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>it<span class="token operator">-&gt;</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="2__getline_116">
     </a>
     2. 文件流操作与 getline
    </h4>
    <h5>
     <a id="21_C__118">
     </a>
     2.1 C++ 文件流类
    </h5>
    <p>
     C++ 中的文件流操作通过
     <code>
      &lt;fstream&gt;
     </code>
     头文件提供的类（如
     <code>
      ifstream
     </code>
     、
     <code>
      ofstream
     </code>
     、
     <code>
      fstream
     </code>
     ）实现，支持对文件的读写操作。
    </p>
    <blockquote>
     <p>
      ifstream 用于从文件中读取数据；ofstream 用于将数据写入文件；fstream 支持同时读写文件。
     </p>
    </blockquote>
    <p>
     <em>
      <strong>
       打开模式：
      </strong>
     </em>
    </p>
    <ul>
     <li>
      std::ios::in ：以输入模式打开文件
     </li>
     <li>
      std::ios::out ：以输出模式打开文件（覆盖模式）
     </li>
     <li>
      std::ios::app ：以追加模式打开文件
     </li>
     <li>
      std::ios::binary ：以二进制模式打开文件
     </li>
    </ul>
    <p>
     <strong>
      文件的读写模式必须保持一致
     </strong>
     ，以默认模式写入则以默认模式读取，以二进制模式写入则以二进制模式读取。
    </p>
    <p>
     对于二进制文件，数据直接按其原始字节序列被读取或写入，没有任何解释或转换，这对于处理图像、音频、视频等非文本数据尤为重要。
    </p>
    <pre><code class="prism language-cpp"><span class="token comment">// 通用写入函数（二进制）</span>
<span class="token keyword">bool</span> <span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> content<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>ofstream <span class="token function">out</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>out <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>out<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    out <span class="token operator">&lt;&lt;</span> content<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 通用读取函数（二进制）</span>
<span class="token keyword">bool</span> <span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">*</span> out<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">in</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>in <span class="token operator">|</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>in<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     C++ 的文件流类（如 ifstream、ofstream）遵循 RAII 原则：
    </p>
    <ul>
     <li>
      资源与对象生命周期绑定：文件流对象在构造时打开文件，在析构时自动调用 close() ；
     </li>
     <li>
      无需手动干预：当流对象离开作用域（即生命周期结束），析构函数会确保文件正确关闭。
     </li>
    </ul>
    <p>
     因此，常规情况下可以不显式调用 close() 方法。
    </p>
    <p>
     在长时间运行的程序中，若需要提前关闭不再使用的文件、立即释放资源，可以显式调用 close() 。
    </p>
    <h5>
     <a id="22_getline__172">
     </a>
     2.2 getline 函数
    </h5>
    <p>
     <code>
      getline
     </code>
     函数用于从输入流中按行读取字符串，它会读取直到遇到换行符
     <code>
      \n
     </code>
     为止，并将此换行符从输入流中提取掉（但 \n 不会包含在返回的字符串中）。
    </p>
    <p>
     <em>
      <strong>
       常见用法：
      </strong>
     </em>
    </p>
    <ol>
     <li>
      从 std::cin 中读取一行
     </li>
    </ol>
    <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
<span class="token function">getline</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="2">
     <li>
      从文件流中逐行读取
     </li>
    </ol>
    <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">in</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>in<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <ol start="3">
     <li>
      getline() 支持自定义分隔符
     </li>
    </ol>
    <pre><code class="prism language-cpp">istream<span class="token operator">&amp;</span> <span class="token function">getline</span> <span class="token punctuation">(</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
istream<span class="token operator">&amp;</span> <span class="token function">getline</span> <span class="token punctuation">(</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> <span class="token keyword">char</span> delim<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 getline 的第三个参数 delim</span>

<span class="token keyword">char</span> delimiter <span class="token operator">=</span> <span class="token char">','</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
<span class="token function">getline</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">,</span> line<span class="token punctuation">,</span> delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h5>
     <a id="23__getline_vs_stringstream_212">
     </a>
     2.3 使用 getline vs stringstream
    </h5>
    <p>
     getline 逐行读取，适合处理大文件，或需要对每一行进行特定处理的情况。
    </p>
    <p>
     stringstream 一次性读取整个文件到内存中，适合小文件处理场景；对于较大的文件，这种方法可能导致内存溢出。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f74616475616e6c616e67616e2f:61727469636c652f64657461696c732f313436313236343734" class_="artid" style="display:none">
 </p>
</div>


