---
layout: post
title: "移动App服务端架构设计"
date: 2024-12-03 03:20:37 +0800
description: "我从事手机app服务端开发现在已经是3个年头，自己也整理出了一套相对好用的服务架构，写出来，跟大家一"
keywords: "移动端服务构建方案"
categories: ['未分类']
tags: ['无标签']
artid: "12958489"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=12958489
  alt: "移动App服务端架构设计"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=12958489
featuredImagePreview: https://bing.ee123.net/img/rand?artid=12958489
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     移动App服务端架构设计
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     我从事手机app服务端开发现在已经是3个年头，自己也整理出了一套相对好用的服务架构，写出来，跟大家一起分享。如有不足，还请多指教。
    </p>
    <h4 style="margin:15px auto 2px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif">
     一：基础流程图。
    </h4>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     <a href="http://images.cnitblog.com/blog/325947/201306/09163809-cf893d28e1c1409cb3fdccc888634e34.png" rel="nofollow noopener noreferrer" style="margin:0px; padding:1px 3px; color:green; text-decoration:none" target="_blank">
      <img alt="image" border="0" height="429" src="http://images.cnitblog.com/blog/325947/201306/09163812-99838d04fe1f44b28d4addf9022b91ae.png" style="margin:0px; padding:0px; border:0px; display:inline" title="image" width="594"/>
     </a>
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     其实有一点还需要加上，就是对json的压缩和加密，一来给用户节约流量，二来防止请求被截取破解我们的参数。具体先压缩后加密还是先加密后压缩这个问题看需求。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     看到这个架构设计时，你们可能会说如果程序入口挂了，所有的服务都不可以用了。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     所以这个架构的弱点在程序入口处，因此要有一(多)台机器做负载，负载的工具可以是HaProxy(软件)或者F5(硬件)的负载。F5比较昂贵，我没用过，haproxy的配置我就不贴了，谷歌一大把。
    </p>
    <h4 style="margin:15px auto 2px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif">
     二：Json参数设计
    </h4>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     手机App的灵魂是用户数，有了用户数才有一切。据我得到的数据，目前一款app从开始制作到推广到注册到充值的费用是14.6元(内部数据)。所以一款App的成功大部分取决于渠道推广。而一款手机的mac.imsi等数据是唯一标识一个手机用户的标准。可能某个用户换了一款手机，但是还想用以前的账号登录，所以userID也是必不可少的字段。但是会出现一个问题，两个mac.imsi，userID，但是他是一个用户，所以对用户信息的更新是至关重要的。但是用户数据的更新不可能放在客户端，当你界面提供了上传imsi.mac.phonenumber等字段到服务端时，用户会义无反顾的选择否。如果你偷偷上传用户的隐私数据到数据库，这是国内通用做法。不排除被用户控告的可能性。所以我们要想一起两全其美的办法。每一次都把这些信息上传上去，美其名曰：唯一标识用户。至于其它的数据，那是运营哥需要的数据，可以在数据中加上。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     {
     <br style="margin:0px; padding:0px"/>
     "context": {
     <br style="margin:0px; padding:0px"/>
     "userID": "1",
     <br style="margin:0px; padding:0px"/>
     "pwd": "fuckGfw",
     <br style="margin:0px; padding:0px"/>
     "imei": "353641012835017",
     <br style="margin:0px; padding:0px"/>
     "imsi": "460000000000000"
     <br style="margin:0px; padding:0px"/>
     },
     <br style="margin:0px; padding:0px"/>
     "reqType": {
     <br style="margin:0px; padding:0px"/>
     "rt": "xxx"
     <br style="margin:0px; padding:0px"/>
     }
     <br style="margin:0px; padding:0px"/>
     }
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     每次把context中的参数进行更新，保持你所拥有的用户数据是真实值钱的。其中的rt字段为每次请求的目的(请求类型)，它用来区分每次请求上来 我们需要调用那一台服务器的服务来处理请求。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     服务架构和数据已经准备OK，我们接下来coding.
    </p>
    <h6 style="margin:15px auto 2px; padding:0px; font-family:Verdana,Arial,Helvetica,sans-serif">
     1：请求入口的承载类型选取
    </h6>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     你是选择传统的.aspx页面为入口还是ashx还是wcf/wcfRest/WebApi 这个自由度很大，具体在项目中的选择主要看心情。我心情不好，所以选择.aspx页面。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     主入口为Default.aspx页面，代码如下
    </p>
    <div class="csharpcode" style="margin:0px; padding:0px; font-size:12px; font-family:consolas,'Courier New',courier,monospace">
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   1:  </span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">protected</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">void</span> Page_Load(<span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">object</span> sender, EventArgs e)</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   2:  </span> {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   3:  </span>    <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">if</span>(!IsPostBack)</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   4:  </span>    {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   5:  </span>        <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">try</span></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   6:  </span>        {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   7:  </span>        }</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   8:  </span>        <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">catch</span> (Exception exc)</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   9:  </span>        {<!-- --></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  10:  </span>        }</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  11:  </span>    }</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  12:  </span> }</pre>
    </div>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     在主入口处加一个大范围的catch，而在catch中输出系统忙。嗯，美其名曰：用户体验。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     对json的压缩我使用了GZip,代码如下：
    </p>
    <div class="csharpcode" style="margin:0px; padding:0px; font-size:12px; font-family:consolas,'Courier New',courier,monospace">
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   1:  </span>    <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">public</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">static</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">class</span> CompressionHelper</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   2:  </span>    {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   3:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;summary&gt; </span></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   4:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// Compress the byte[] </span></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   5:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;/summary&gt; </span></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   6:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;param name="input"&gt;&lt;/param&gt; </span></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   7:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;returns&gt;&lt;/returns&gt; </span></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   8:  </span>        <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">public</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">static</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>[] Compress(<span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>[] input)</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   9:  </span>        {<!-- --></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  10:  </span>            <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>[] output;</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  11:  </span>            <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">using</span> (MemoryStream ms = <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">new</span> MemoryStream())</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  12:  </span>            {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  13:  </span>                <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">using</span> (GZipStream gs = <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">new</span> GZipStream(ms, CompressionMode.Compress))</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  14:  </span>                {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  15:  </span>                    gs.Write(input, 0, input.Length);</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  16:  </span>                    gs.Close();</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  17:  </span>                    output = ms.ToArray();</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  18:  </span>                }</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  19:  </span>                ms.Close();</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  20:  </span>            }</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  21:  </span>            <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span> output;</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  22:  </span>        }</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  23:  </span> </pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  24:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;summary&gt; </span></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  25:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// Decompress the byte[] </span></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  26:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;/summary&gt; </span></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  27:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;param name="input"&gt;&lt;/param&gt; </span></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  28:  </span>        <span class="rem" style="margin:0px; padding:0px; color:rgb(0,128,0)">/// &lt;returns&gt;&lt;/returns&gt; </span></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  29:  </span>        <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">public</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">static</span> <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>[] Decompress(<span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>[] input)</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  30:  </span>        {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  31:  </span>            List&lt;<span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>&gt; output = <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">new</span> List&lt;<span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>&gt;();</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  32:  </span>            <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">using</span> (MemoryStream ms = <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">new</span> MemoryStream(input))</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  33:  </span>            {<!-- --></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  34:  </span>                <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">using</span> (GZipStream gs = <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">new</span> GZipStream(ms, CompressionMode.Decompress))</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  35:  </span>                {<!-- --></pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  36:  </span>                    <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">int</span> readByte = gs.ReadByte();</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  37:  </span>                    <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">while</span> (readByte != -1)</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  38:  </span>                    {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  39:  </span>                        output.Add((<span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">byte</span>)readByte);</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  40:  </span>                        readByte = gs.ReadByte();</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  41:  </span>                    }</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  42:  </span>                    gs.Close();</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  43:  </span>                }</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  44:  </span>                ms.Close();</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  45:  </span>            }</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  46:  </span>            <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">return</span> output.ToArray();</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  47:  </span>        }</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">  48:  </span>    } </pre>
    </div>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     压缩完json后，还需要加密，别脑残的说MD5，小心我抽你。这个看你对数据的安全性如何看待。如支付宝用的RSACryptoServiceProvider加密，如asp.net的ViewState用的base64编码。其实用什么编码无所谓，你只需要定制属于你自己的码表。代码我就不贴了，我怕把我1个月100块的保密费弄成10000的律师费。。。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     接下来到重点了。你反序列化时可以使用
     <a href="http://james.newtonking.com/projects/json-net.aspx" rel="nofollow noopener noreferrer" style="margin:0px; padding:1px 3px; color:green; text-decoration:none" target="_blank">
      Linq to Json
     </a>
     或者Newtonsoft.json随便得到了rt字段的类型。一般同学就开始这样写了：
    </p>
    <div class="csharpcode" style="margin:0px; padding:0px; font-size:12px; font-family:consolas,'Courier New',courier,monospace">
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   1:  </span>            <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">switch</span> (rt)</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   2:  </span>            {<!-- --></pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   3:  </span>                <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">case</span><span class="str" style="margin:0px; padding:0px; color:rgb(0,96,128)">""</span>:</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   4:  </span>                    <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">break</span>;</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   5:  </span>                <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">default</span>:</pre>
     <pre style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(255,255,255)"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   6:  </span>                    <span class="kwrd" style="margin:0px; padding:0px; color:rgb(0,0,255)">break</span>;</pre>
     <pre class="alt" style="margin:0em; padding:0px; white-space:pre-wrap; word-wrap:break-word; font-family:consolas,'Courier New',courier,monospace; background-color:rgb(244,244,244); width:989px"><span class="lnum" style="margin:0px; padding:0px; color:rgb(96,96,96)">   7:  </span>            }</pre>
    </div>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     这样写没错，但是如果你的rt类型比较多了以后就会出现很长很长的流水代码。所以这个地方我更加建议使用依赖注入。接下来就是具体的业务逻辑处理、数据处理。
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
    </p>
    <p style="margin:10px auto!important; padding-top:0px; padding-bottom:0px; font-family:Verdana,Arial,Helvetica,sans-serif; font-size:14px; line-height:20px">
     整片写完，仔细看看这架构，有什么难度？有什么难点？有什么值钱的地方？值得商榷。
    </p>
    <br/>
    <p>
     <br/>
    </p>
    <p>
     <a href="http://www.cnblogs.com/YamatAmain/archive/2013/06/09/3129452.html" rel="nofollow noopener noreferrer" target="_blank">
      http://www.cnblogs.com/YamatAmain/archive/2013/06/09/3129452.html
     </a>
     <br/>
    </p>
   </div>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f6c766a696e313130:2f61727469636c652f64657461696c732f3132393538343839" class_="artid" style="display:none">
 </p>
</div>
