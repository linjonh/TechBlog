---
arturl_encode: "68747470:733a2f2f626c6f672e6373646e2e6e65742f4848573232332f:61727469636c652f64657461696c732f313436313931363833"
layout: post
title: "ä½¿ç”¨AOP-Prometheus-node-exporter-grafana-å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§"
date: 2025-03-11 23:17:33 +0800
description: "æœ¬ç¬”è®°é€‚ç”¨äºæƒ³è¦æ­å»ºä¸šåŠ¡ç³»ç»Ÿç›‘æ§èƒ½åŠ›çš„å·¥ç¨‹ç‹®ã€‚æ­¤ç¬”è®°é€‚ç”¨çš„æ¶æ„ä¸ºå•æœºéƒ¨ç½²æ–¹å¼ï¼Œæ›´å€¾å‘äºä¸€ä¸ªå°demoã€‚"
keywords: "ä½¿ç”¨AOP + Prometheus + node-exporter + grafana å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§"
categories: ['ç¬”è®°', 'æ•™ç¨‹']
tags: ['Prometheus', 'Java', 'Grafana']
artid: "146191683"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191683
    alt: "ä½¿ç”¨AOP-Prometheus-node-exporter-grafana-å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191683
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191683
cover: https://bing.ee123.net/img/rand?artid=146191683
image: https://bing.ee123.net/img/rand?artid=146191683
img: https://bing.ee123.net/img/rand?artid=146191683
---

# ä½¿ç”¨AOP + Prometheus + node-exporter + grafana å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§

## ä½¿ç”¨AOP + Prometheus + node-exporter + grafana å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§

> æœ¬ç¬”è®°é€‚ç”¨äºæƒ³è¦æ­å»ºä¸šåŠ¡ç³»ç»Ÿç›‘æ§èƒ½åŠ›çš„å·¥ç¨‹ç‹®ã€‚æ­¤ç¬”è®°é€‚ç”¨çš„æ¶æ„ä¸ºå•æœºéƒ¨ç½²æ–¹å¼ï¼Œæ›´å€¾å‘äºä¸€ä¸ªå°demoï¼Œæœ¬ç¬”è®°éœ€è¦ç”¨åˆ°cockerã€‚è¯·æå‰å‡†å¤‡ï¼ï¼

#### 1.ç›‘æ§çš„ç›®çš„ä»¥åŠç›‘æ§å“ªäº›å†…å®¹ï¼Ÿ

â€‹
**åœ¨å¹³å¸¸çš„ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä¸€ä¸‹ä¸¤ä¸ªæ–¹é¢çš„ç›‘æ§æ¥å…¨æ–¹ä½äº†è§£æˆ‘ä»¬çš„ç³»ç»Ÿï¼š**

#### **1.1 æœºå™¨å¥åº·åº¦ç›‘æ§**

* **CPUä½¿ç”¨ç‡**
  ã€
  **å†…å­˜ä½¿ç”¨ç‡**
  ã€
  **ç£ç›˜IO**
  ã€
  **ç½‘ç»œæµé‡**
* **ç³»ç»Ÿè´Ÿè½½**
  ï¼ˆLoad Averageï¼‰
* **ç£ç›˜ä½¿ç”¨æƒ…å†µ**
* **è¿›ç¨‹å­˜æ´»çŠ¶æ€**
* **Dockerå®¹å™¨çŠ¶æ€**
  ï¼ˆå¦‚æœä½¿ç”¨å®¹å™¨åŒ–ï¼‰
* **ç³»ç»Ÿæ—¥å¿—å¼‚å¸¸**

#### **1.2 ä¸šåŠ¡ç›‘æ§**

* **è¯·æ±‚QPSã€TPS**
  ï¼ˆååé‡ï¼‰
* **è¯·æ±‚å“åº”æ—¶é—´ï¼ˆP99, P95, P50ï¼‰**
* **HTTPçŠ¶æ€ç ç»Ÿè®¡**
* **æ•°æ®åº“æŸ¥è¯¢è€—æ—¶**
* **ç¼“å­˜å‘½ä¸­ç‡**
* **å¼‚å¸¸æ—¥å¿—ï¼ˆå¦‚è¶…æ—¶ã€é”™è¯¯ï¼‰**

#### **2. æˆ‘ä»¬è¦ç”¨åˆ°å“ªäº›è½¯ä»¶æ¥å®ç°å‘¢ï¼Ÿ**

2.1 Prometheus ä¸»è¦ç”¨æ¥å­˜å‚¨å’ŒæŸ¥è¯¢ç›‘æ§æ•°æ®ã€‚
  
2.2 node Exporter è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥é‡‡é›†æœåŠ¡å™¨çš„CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œæŒ‡æ ‡ç­‰ã€‚ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ä»–åŸºæœ¬ä¸å ä»€ä¹ˆå†…å­˜ï¼‰
  
2.3 grafana é€šè¿‡å¯è§†åŒ–çš„å›¾æ ‡æ¥å±•ç¤ºæœåŠ¡çš„è¿è¡Œæƒ…å†µ
  
2.4 Java spring boot + Micrometer å®ç°ä¸šåŠ¡ç›‘æ§

#### 3. **å¼€å§‹æ­å»ºPrometheus + Grafana**

3.1 åˆ›å»ºdocker-compose.yml

åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹

```cmd
mkdir monitoring-demo && cd monitoring-demo

```

3.2 åˆ›å»ºdocker-compose.yml

```yml
version: '3'
services:
  prometheus:
    image: prom/prometheus
    container_name: prometheus
    volumes:
    - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - "3000:3000"

  node-exporter:
    image: prom/node-exporter
    container_name: node-exporter
    ports:
      - "9100:9100"


```

åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­å…±åˆ›å»ºäº†ä¸‰ä¸ªå®¹å™¨ï¼Œå¹¶ä¸ºä»–ä»¬å¼€æ”¾äº†ä¸åŒçš„ç«¯å£åˆ†åˆ«æ˜¯ 9090ã€3000ä»¥åŠ9100 å…¶ä¸­node-exporterç”¨æ¥é‡‡é›†dockerå®¹å™¨çš„èµ„æºã€‚

```yml
volumes:
    - ./prometheus.yml:/etc/prometheus/prometheus.yml

```

è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥é…ç½®æ™®ç½—ç±³ä¿®æ–¯çš„é‡‡é›†è§„åˆ™ï¼Œåœ¨docker-compose.ymlçš„å¹³çº§ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ymlç”¨æ¥è¿›è¡Œæ•°æ®é‡‡é›†ã€‚

```yml
global:
  scrape_interval: 15s  # å…¨å±€æŠ“å–é—´éš”

scrape_configs:
  - job_name: 'prometheus' # ç›‘æ§ Prometheus è‡ªå·±
    static_configs:
      - targets: ['localhost:9090']
  - job_name: 'node-exporter' # ç›‘æ§ Node Exporter
    static_configs:
      - targets: ['node-exporter:9100']
  - job_name: 'java-demo-app' # Java ä¸šåŠ¡ç³»ç»Ÿ
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['host.docker.internal:8080']

```

3.3 å¯åŠ¨docker
  
å®Œæˆä¸Šé¢çš„æ“ä½œåï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨å®¹å™¨äº†

```bash
docker-compose up -d # -d ä¸å±•ç¤ºå¯åŠ¨logï¼Œåœ¨åå°å¯åŠ¨

```

å¯åŠ¨åï¼š

Prometheus è®¿é—®åœ°å€ï¼šhttp://localhost:9090

Grafana è®¿é—®åœ°å€ï¼šhttp://localhost:3000ï¼ˆé»˜è®¤ç”¨æˆ·
`admin/admin`
ï¼‰ PsğŸ—¡ ç¬¬ä¸€æ¬¡è®¿é—®ä¼šè®©ä½ æ”¹é»˜è®¤å¯†ç 

> ä¸€äº›çŸ¥è¯†ç‚¹ğŸ›© ï¼š
>
> 1. åœ¨æ™®ç½—ç±³ä¿®æ–¯ä¸­å¯ä»¥é€šè¿‡ç®€å•çš„sqlæ¥æŸ¥è¯¢å·²ç»ä¸ŠæŠ¥çš„æ•°æ®ã€‚å¯ä»¥é€šè¿‡ http://localhost:9090/query è¿™ä¸ªè·¯å¾„æ¥æŸ¥è¯¢ã€‚å¦‚æœä½ æƒ³è¦çœ‹åˆ°ä¸€äº›æ•°æ®å¯ä»¥å°è¯•æŸ¥ä¸€ä¸‹
>    **`node_cpu_seconds_total`**
>    è¿™ä¸ªä¿¡æ¯ï¼Œä½ å¤§æ¦‚å¯ä»¥çœ‹åˆ°ä¸€å †æ•°æ®
> 2. å¦‚æœä½ æ²¡çœ‹åˆ°ä»»ä½•ä¿¡æ¯æˆ–è€…ä½ æƒ³è¦çœ‹æ™®ç½—ç±³ä¿®æ–¯æ­£åœ¨ä»æ”¶é›†å“ªäº›åº”ç”¨çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ http://localhost:9090/targets æ¥è¿›è¡ŒæŸ¥çœ‹ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°å“ªäº›åº”ç”¨åœ¨çº¿æˆ–è€…ç¦»çº¿

#### 4. **åœ¨Grafanaä¸­é…ç½®Prometheusæ•°æ®æº**

è®¿é—®Grafana http://localshot:3000

Grafana å·¦ä¾§èœå• â†’
**é½¿è½®å›¾æ ‡ï¼ˆConfigurationï¼‰ â†’ Data Sources**

ç‚¹å‡»
**Add data source**

é€‰æ‹©
**Prometheus**

å¡«å†™
**URL**
ï¼šhttp://prometheus:9090 è¿™é‡Œä¸ºä»€ä¹ˆå†™prometheus:9090å‘¢ï¼Œæ˜¯ä»¥ä¸ºGrafana å’Œ Prometheus åœ¨åŒä¸€ä¸ªdockerç½‘ç»œä¸‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´å‘¼å…¶å

ç‚¹å‡»
**Save & Test**
â†’ æ˜¾ç¤º
`Data source is working`
ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸï¼

#### 5. **å¯¼å…¥ç›‘æ§é¢æ¿ï¼ˆDashboardï¼‰**

##### å¯¼å…¥ç°æˆçš„æœåŠ¡å™¨ç›‘æ§ Dashboardï¼ˆNode Exporterï¼‰

1. å·¦ä¾§ â†’
   **Dashboardï¼ˆå››ä¸ªæ–¹å—å›¾æ ‡ï¼‰ â†’ Import**
2. è¾“å…¥
   **Dashboard ID**
   ï¼š
   `1860`
3. ç‚¹å‡»
   **Load**
4. é€‰æ‹© Prometheus æ•°æ®æº
5. ç‚¹å‡»
   **Import**

**æ•ˆæœ**
ï¼šé©¬ä¸Šçœ‹åˆ°æœåŠ¡å™¨ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå›¾è¡¨ï¼

#### âœ… åˆ°ç›®å‰ä¸ºæ­¢ä½ æ‰€å®Œæˆäº‹æƒ… æ¯ä¸ªç»„ä»¶çš„èŒè´£å’Œæ„ä¹‰

| ç»„ä»¶ | ä½œç”¨ | ä½ åšäº†ä»€ä¹ˆ |
| --- | --- | --- |
| Docker | å¿«é€Ÿæ„å»ºç¯å¢ƒ | è£…äº† Dockerï¼Œéƒ¨ç½²äº†å®¹å™¨ |
| Prometheus | æŠ“å–æŒ‡æ ‡ï¼Œä¿å­˜æ•°æ® | é…äº† prometheus.ymlï¼Œå¯åŠ¨æœåŠ¡ |
| Node Exporter | æä¾›ä¸»æœºæŒ‡æ ‡ | å¯åŠ¨äº† node-exporterï¼Œæš´éœ² 9100 |
| Grafana | æ•°æ®å±•ç¤ºå’Œåˆ†æ | é…äº†æ•°æ®æºã€å¯¼å…¥ Dashboard |

#### 6. **å¯åŠ¨Java DEMO**

1. åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œpomæ–‡ä»¶å¦‚ä¸‹

```xml
<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>
		<dependency>
			<groupId>io.pivotal.spring.cloud</groupId>
			<artifactId>spring-cloud-services-starter-service-registry</artifactId>
		</dependency>

		<dependency>
			<groupId>io.micrometer</groupId>
			<artifactId>micrometer-registry-prometheus</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

```

2. é…ç½®application.yml

```yml
  spring:
    application:
      name: demo
  server:
    port: 8080
  # ä»¥ä¸‹å†…å®¹ä¸»è¦æ˜¯ä¸ŠæŠ¥jvmçš„å¥åº·åº¦
  management:
    endpoints:
      web:
        exposure:
          include: health,info,prometheus
    metrics:
      tags:
        application: demo-app

```

3. å¯åŠ¨Javademoé¡¹ç›®ï¼Œè¿™ä¸ªJavaé¡¹ç›®çš„jvmä¿¡æ¯å°†ä¼šè¢«ä¸ŠæŠ¥ç»™æ™®ç½—ç±³ä¿®æ–¯ã€‚
4. æƒ³è¦çœ‹çœ‹ jvm GCçš„æƒ…å†µï¼Ÿå¯ä»¥åœ¨ä»ªè¡¨ç›˜ä¸­å¯¼å…¥è¿™ä¸ªjsonæ¨¡æ¿

```json
     {
       "annotations": {
         "list": []
       },
       "panels": [
         {
           "type": "stat",
           "title": "GC æ¬¡æ•° (1m)",
           "datasource": "prometheus-1",
           "targets": [
             {
               "expr": "increase(jvm_gc_pause_seconds_count{application=\"demo-app\"}[1m])",
               "interval": "",
               "legendFormat": "GC æ¬¡æ•°",
               "refId": "A"
             }
           ],
           "fieldConfig": {
             "defaults": {
               "unit": "none",
               "thresholds": {
                 "mode": "absolute",
                 "steps": [
                   {
                     "color": "green",
                     "value": null
                   },
                   {
                     "color": "yellow",
                     "value": 5
                   },
                   {
                     "color": "red",
                     "value": 10
                   }
                 ]
               }
             },
             "overrides": []
           },
           "options": {
             "reduceOptions": {
               "calcs": ["lastNotNull"],
               "fields": "",
               "values": false
             },
             "orientation": "horizontal",
             "colorMode": "value",
             "graphMode": "none",
             "justifyMode": "auto"
           },
           "gridPos": {
             "h": 6,
             "w": 6,
             "x": 0,
             "y": 0
           }
         },
         {
           "type": "stat",
           "title": "GC è€—æ—¶ (1m)",
           "datasource": "prometheus-1",
           "targets": [
             {
               "expr": "increase(jvm_gc_pause_seconds_sum{application=\"demo-app\"}[1m])",
               "interval": "",
               "legendFormat": "GC è€—æ—¶ (ç§’)",
               "refId": "B"
             }
           ],
           "fieldConfig": {
             "defaults": {
               "unit": "s",
               "thresholds": {
                 "mode": "absolute",
                 "steps": [
                   {
                     "color": "green",
                     "value": null
                   },
                   {
                     "color": "yellow",
                     "value": 0.5
                   },
                   {
                     "color": "red",
                     "value": 1
                   }
                 ]
               }
             },
             "overrides": []
           },
           "options": {
             "reduceOptions": {
               "calcs": ["lastNotNull"],
               "fields": "",
               "values": false
             },
             "orientation": "horizontal",
             "colorMode": "value",
             "graphMode": "none",
             "justifyMode": "auto"
           },
           "gridPos": {
             "h": 6,
             "w": 6,
             "x": 6,
             "y": 0
           }
         },
         {
           "type": "timeseries",
           "title": "GC æ¬¡æ•°è¶‹åŠ¿",
           "datasource": "prometheus-1",
           "targets": [
             {
               "expr": "rate(jvm_gc_pause_seconds_count{application=\"demo-app\"}[1m])",
               "interval": "",
               "legendFormat": "{{gc}}",
               "refId": "C"
             }
           ],
           "fieldConfig": {
             "defaults": {
               "unit": "none"
             },
             "overrides": []
           },
           "options": {
             "legend": {
               "displayMode": "table",
               "placement": "bottom"
             },
             "tooltip": {
               "mode": "single"
             }
           },
           "gridPos": {
             "h": 8,
             "w": 12,
             "x": 0,
             "y": 6
           }
         },
         {
           "type": "timeseries",
           "title": "GC è€—æ—¶è¶‹åŠ¿",
           "datasource": "prometheus-1",
           "targets": [
             {
               "expr": "rate(jvm_gc_pause_seconds_sum{application=\"demo-app\"}[1m])",
               "interval": "",
               "legendFormat": "{{gc}}",
               "refId": "D"
             }
           ],
           "fieldConfig": {
             "defaults": {
               "unit": "s"
             },
             "overrides": []
           },
           "options": {
             "legend": {
               "displayMode": "table",
               "placement": "bottom"
             },
             "tooltip": {
               "mode": "single"
             }
           },
           "gridPos": {
             "h": 8,
             "w": 12,
             "x": 12,
             "y": 6
           }
         }
       ],
       "schemaVersion": 34,
       "title": "JVM GC ä»ªè¡¨ç›˜",
       "timezone": "browser",
       "version": 1
     }
     

```

5. æƒ³è¦å®ç°controllerå’Œserviceæ¥å£çš„æ‰§è¡Œæƒ…å†µï¼Ÿ é€šè¿‡aopæ¥å®ç° è¿™ä¸ªaopå¯ä»¥ä¸ŠæŠ¥æ‰€æœ‰æ¥å£
   `tp 999`
   `tp 99`
   `tp 50`
   çš„æƒ…å†µ

```java
     import io.micrometer.core.instrument.MeterRegistry;
     import io.micrometer.core.instrument.Timer;
     import org.aspectj.lang.ProceedingJoinPoint;
     import org.aspectj.lang.annotation.Around;
     import org.aspectj.lang.annotation.Aspect;
     import org.springframework.stereotype.Component;
     
     @Aspect
     @Component
     public class MethodTimerAspect {
     
         private final MeterRegistry meterRegistry;
     
         public MethodTimerAspect(MeterRegistry meterRegistry) {
             this.meterRegistry = meterRegistry;
         }
     
         @Around("execution(* com.example..controller..*(..)) || execution(* com.example..service..*(..))")
         public Object timeMethods(ProceedingJoinPoint pjp) throws Throwable {
             String className = pjp.getTarget().getClass().getSimpleName();
             String methodName = pjp.getSignature().getName();
             String timerName = "method_execution_timer";
     
             Timer.Sample sample = Timer.start(meterRegistry);
     
             try {
                 return pjp.proceed();
             } finally {
                 sample.stop(
                         Timer.builder(timerName)
                                 .description("æ–¹æ³•æ‰§è¡Œè€—æ—¶ç»Ÿè®¡")
                                 .tags("class", className, "method", methodName)
                                 .publishPercentiles(0.5, 0.9, 0.99, 0.999)
                                 .publishPercentileHistogram()
                                 .register(meterRegistry)
                 );
             }
         }
     
     }
     ```

     6. å¦‚æœä½ æƒ³è¦çœ‹çœ‹å„ä¸ªæ¥å£çš„æ‰§è¡Œæƒ…å†µï¼Œå¯¼å…¥ä¸‹é¢è¿™ä¸ªjsonæ¨¡æ¿å¯ä»¥çœ‹åˆ°

        ```json
        {
          "annotations": {
            "list": []
          },
          "templating": {
            "list": [
              {
                "name": "datasource",
                "type": "datasource",
                "query": "prometheus",
                "label": "Prometheus æ•°æ®æº",
                "hide": 0
              }
            ]
          },
          "panels": [
            {
              "type": "stat",
              "title": "æ¥å£ TP999 å»¶è¿Ÿ (ms)",
              "datasource": "prometheus-1",
              "targets": [
                {
                  "expr": "histogram_quantile(0.999, sum(rate(method_execution_time_bucket[1m])) by (le, method))",
                  "legendFormat": "{{method}}",
                  "refId": "A"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "unit": "ms",
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      { "color": "green", "value": null },
                      { "color": "yellow", "value": 1000 },
                      { "color": "red", "value": 2000 }
                    ]
                  }
                },
                "overrides": []
              },
              "options": {
                "reduceOptions": {
                  "calcs": ["max"],
                  "fields": "",
                  "values": false
                },
                "orientation": "horizontal",
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto"
              },
              "gridPos": { "h": 6, "w": 12, "x": 0, "y": 0 }
            },
            {
              "type": "timeseries",
              "title": "æ¥å£ TP999 å»¶è¿Ÿè¶‹åŠ¿",
              "datasource": "prometheus-1",
              "targets": [
                {
                  "expr": "histogram_quantile(0.999, sum(rate(method_execution_time_bucket[1m])) by (le, method))",
                  "legendFormat": "{{method}}",
                  "refId": "B"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "unit": "ms"
                },
                "overrides": []
              },
              "options": {
                "legend": {
                  "displayMode": "table",
                  "placement": "bottom"
                },
                "tooltip": {
                  "mode": "single"
                }
              },
              "gridPos": { "h": 8, "w": 24, "x": 0, "y": 6 }
            },
            {
              "type": "stat",
              "title": "æ¥å£ QPS",
              "datasource": "${datasource}",
              "targets": [
                {
                  "expr": "sum(rate(http_server_requests_seconds_count[1m])) by (uri, method)",
                  "legendFormat": "{{uri}} {{method}}",
                  "refId": "C"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "unit": "ops",
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      { "color": "red", "value": null },
                      { "color": "yellow", "value": 5 },
                      { "color": "green", "value": 20 }
                    ]
                  }
                },
                "overrides": []
              },
              "options": {
                "reduceOptions": {
                  "calcs": ["max"],
                  "fields": "",
                  "values": false
                },
                "orientation": "horizontal",
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto"
              },
              "gridPos": { "h": 6, "w": 12, "x": 0, "y": 14 }
            },
            {
              "type": "timeseries",
              "title": "æ¥å£ QPS è¶‹åŠ¿",
              "datasource": "prometheus-1",
              "targets": [
                {
                  "expr": "sum(rate(http_server_requests_seconds_count[1m])) by (uri, method)",
                  "legendFormat": "{{uri}} {{method}}",
                  "refId": "D"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "unit": "ops"
                },
                "overrides": []
              },
              "options": {
                "legend": {
                  "displayMode": "table",
                  "placement": "bottom"
                },
                "tooltip": {
                  "mode": "single"
                }
              },
              "gridPos": { "h": 8, "w": 24, "x": 0, "y": 20 }
            },
            {
              "type": "stat",
              "title": "æ¥å£ 5xx é”™è¯¯æ•°",
              "datasource": "prometheus-1",
              "targets": [
                {
                  "expr": "sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[1m])) by (uri, method)",
                  "legendFormat": "{{uri}} {{method}}",
                  "refId": "E"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "unit": "short",
                  "thresholds": {
                    "mode": "absolute",
                    "steps": [
                      { "color": "green", "value": null },
                      { "color": "yellow", "value": 1 },
                      { "color": "red", "value": 5 }
                    ]
                  }
                },
                "overrides": []
              },
              "options": {
                "reduceOptions": {
                  "calcs": ["max"],
                  "fields": "",
                  "values": false
                },
                "orientation": "horizontal",
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto"
              },
              "gridPos": { "h": 6, "w": 12, "x": 0, "y": 28 }
            },
            {
              "type": "timeseries",
              "title": "æ¥å£ 5xx é”™è¯¯æ•°è¶‹åŠ¿",
              "datasource": "prometheus-1",
              "targets": [
                {
                  "expr": "sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[1m])) by (uri, method)",
                  "legendFormat": "{{uri}} {{method}}",
                  "refId": "F"
                }
              ],
              "fieldConfig": {
                "defaults": {
                  "unit": "short"
                },
                "overrides": []
              },
              "options": {
                "legend": {
                  "displayMode": "table",
                  "placement": "bottom"
                },
                "tooltip": {
                  "mode": "single"
                }
              },
              "gridPos": { "h": 8, "w": 24, "x": 0, "y": 34 }
            }
          ],
          "title": "æ¥å£ TP999 + QPS + é”™è¯¯ç›‘æ§",
          "timezone": "browser",
          "schemaVersion": 34,
          "version": 1
        }
        

```

---

> âœ…é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ä½ åº”è¯¥å°±èƒ½å®ç°ä¸šåŠ¡æ¥å£çš„ç›‘æ§ï¼Œåç»­å¾®æœåŠ¡å¼ç›‘æ§å¯èƒ½è¿˜ä¼šæ›´æ–° æ•¬è¯·æœŸå¾…â€¦