---
layout: post
title: "ä½¿ç”¨AOP-Prometheus-node-exporter-grafana-å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§"
date: 2025-03-11 23:17:33 +0800
description: "æœ¬ç¬”è®°é€‚ç”¨äºæƒ³è¦æ­å»ºä¸šåŠ¡ç³»ç»Ÿç›‘æ§èƒ½åŠ›çš„å·¥ç¨‹ç‹®ã€‚æ­¤ç¬”è®°é€‚ç”¨çš„æ¶æ„ä¸ºå•æœºéƒ¨ç½²æ–¹å¼ï¼Œæ›´å€¾å‘äºä¸€ä¸ªå°demoã€‚"
keywords: "ä½¿ç”¨AOP + Prometheus + node-exporter + grafana å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§"
categories: ['ç¬”è®°', 'æ•™ç¨‹']
tags: ['Prometheus', 'Java', 'Grafana']
artid: "146191683"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191683
    alt: "ä½¿ç”¨AOP-Prometheus-node-exporter-grafana-å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191683
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191683
cover: https://bing.ee123.net/img/rand?artid=146191683
image: https://bing.ee123.net/img/rand?artid=146191683
img: https://bing.ee123.net/img/rand?artid=146191683
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     ä½¿ç”¨AOP + Prometheus + node-exporter + grafana å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="AOP__Prometheus__nodeexporter__grafana_Java_0">
     </a>
     ä½¿ç”¨AOP + Prometheus + node-exporter + grafana å®ç°Javaç³»ç»Ÿçš„æ¥å£ç›‘æ§
    </h2>
    <blockquote>
     <p>
      æœ¬ç¬”è®°é€‚ç”¨äºæƒ³è¦æ­å»ºä¸šåŠ¡ç³»ç»Ÿç›‘æ§èƒ½åŠ›çš„å·¥ç¨‹ç‹®ã€‚æ­¤ç¬”è®°é€‚ç”¨çš„æ¶æ„ä¸ºå•æœºéƒ¨ç½²æ–¹å¼ï¼Œæ›´å€¾å‘äºä¸€ä¸ªå°demoï¼Œæœ¬ç¬”è®°éœ€è¦ç”¨åˆ°cockerã€‚è¯·æå‰å‡†å¤‡ï¼ï¼
     </p>
    </blockquote>
    <h4>
     <a id="1_4">
     </a>
     1.ç›‘æ§çš„ç›®çš„ä»¥åŠç›‘æ§å“ªäº›å†…å®¹ï¼Ÿ
    </h4>
    <p>
     â€‹
     <strong>
      åœ¨å¹³å¸¸çš„ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä¸€ä¸‹ä¸¤ä¸ªæ–¹é¢çš„ç›‘æ§æ¥å…¨æ–¹ä½äº†è§£æˆ‘ä»¬çš„ç³»ç»Ÿï¼š
     </strong>
    </p>
    <h4>
     <a id="11__8">
     </a>
     <strong>
      1.1 æœºå™¨å¥åº·åº¦ç›‘æ§
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       CPUä½¿ç”¨ç‡
      </strong>
      ã€
      <strong>
       å†…å­˜ä½¿ç”¨ç‡
      </strong>
      ã€
      <strong>
       ç£ç›˜IO
      </strong>
      ã€
      <strong>
       ç½‘ç»œæµé‡
      </strong>
     </li>
     <li>
      <strong>
       ç³»ç»Ÿè´Ÿè½½
      </strong>
      ï¼ˆLoad Averageï¼‰
     </li>
     <li>
      <strong>
       ç£ç›˜ä½¿ç”¨æƒ…å†µ
      </strong>
     </li>
     <li>
      <strong>
       è¿›ç¨‹å­˜æ´»çŠ¶æ€
      </strong>
     </li>
     <li>
      <strong>
       Dockerå®¹å™¨çŠ¶æ€
      </strong>
      ï¼ˆå¦‚æœä½¿ç”¨å®¹å™¨åŒ–ï¼‰
     </li>
     <li>
      <strong>
       ç³»ç»Ÿæ—¥å¿—å¼‚å¸¸
      </strong>
     </li>
    </ul>
    <h4>
     <a id="12__17">
     </a>
     <strong>
      1.2 ä¸šåŠ¡ç›‘æ§
     </strong>
    </h4>
    <ul>
     <li>
      <strong>
       è¯·æ±‚QPSã€TPS
      </strong>
      ï¼ˆååé‡ï¼‰
     </li>
     <li>
      <strong>
       è¯·æ±‚å“åº”æ—¶é—´ï¼ˆP99, P95, P50ï¼‰
      </strong>
     </li>
     <li>
      <strong>
       HTTPçŠ¶æ€ç ç»Ÿè®¡
      </strong>
     </li>
     <li>
      <strong>
       æ•°æ®åº“æŸ¥è¯¢è€—æ—¶
      </strong>
     </li>
     <li>
      <strong>
       ç¼“å­˜å‘½ä¸­ç‡
      </strong>
     </li>
     <li>
      <strong>
       å¼‚å¸¸æ—¥å¿—ï¼ˆå¦‚è¶…æ—¶ã€é”™è¯¯ï¼‰
      </strong>
     </li>
    </ul>
    <h4>
     <a id="2__26">
     </a>
     <strong>
      2. æˆ‘ä»¬è¦ç”¨åˆ°å“ªäº›è½¯ä»¶æ¥å®ç°å‘¢ï¼Ÿ
     </strong>
    </h4>
    <p>
     2.1 Prometheus ä¸»è¦ç”¨æ¥å­˜å‚¨å’ŒæŸ¥è¯¢ç›‘æ§æ•°æ®ã€‚
     <br/>
     2.2 node Exporter è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥é‡‡é›†æœåŠ¡å™¨çš„CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œæŒ‡æ ‡ç­‰ã€‚ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ä»–åŸºæœ¬ä¸å ä»€ä¹ˆå†…å­˜ï¼‰
     <br/>
     2.3 grafana é€šè¿‡å¯è§†åŒ–çš„å›¾æ ‡æ¥å±•ç¤ºæœåŠ¡çš„è¿è¡Œæƒ…å†µ
     <br/>
     2.4 Java spring boot + Micrometer å®ç°ä¸šåŠ¡ç›‘æ§
    </p>
    <h4>
     <a id="3_Prometheus__Grafana_33">
     </a>
     3.
     <strong>
      å¼€å§‹æ­å»ºPrometheus + Grafana
     </strong>
    </h4>
    <p>
     3.1 åˆ›å»ºdocker-compose.yml
    </p>
    <p>
     åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹
    </p>
    <pre><code class="prism language-cmd">mkdir monitoring-demo &amp;&amp; cd monitoring-demo
</code></pre>
    <p>
     3.2 åˆ›å»ºdocker-compose.yml
    </p>
    <pre><code class="prism language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/prometheus
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> prometheus
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ./prometheus.yml<span class="token punctuation">:</span>/etc/prometheus/prometheus.yml
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9090:9090"</span>

  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> grafana
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"3000:3000"</span>

  <span class="token key atrule">node-exporter</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/node<span class="token punctuation">-</span>exporter
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9100:9100"</span>

</code></pre>
    <p>
     åœ¨ä¸Šé¢çš„æ–‡ä»¶ä¸­å…±åˆ›å»ºäº†ä¸‰ä¸ªå®¹å™¨ï¼Œå¹¶ä¸ºä»–ä»¬å¼€æ”¾äº†ä¸åŒçš„ç«¯å£åˆ†åˆ«æ˜¯ 9090ã€3000ä»¥åŠ9100 å…¶ä¸­node-exporterç”¨æ¥é‡‡é›†dockerå®¹å™¨çš„èµ„æºã€‚
    </p>
    <pre><code class="prism language-yml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ./prometheus.yml<span class="token punctuation">:</span>/etc/prometheus/prometheus.yml
</code></pre>
    <p>
     è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥é…ç½®æ™®ç½—ç±³ä¿®æ–¯çš„é‡‡é›†è§„åˆ™ï¼Œåœ¨docker-compose.ymlçš„å¹³çº§ç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ymlç”¨æ¥è¿›è¡Œæ•°æ®é‡‡é›†ã€‚
    </p>
    <pre><code class="prism language-yml"><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s  <span class="token comment"># å…¨å±€æŠ“å–é—´éš”</span>

<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'prometheus'</span> <span class="token comment"># ç›‘æ§ Prometheus è‡ªå·±</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'localhost:9090'</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'node-exporter'</span> <span class="token comment"># ç›‘æ§ Node Exporter</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node-exporter:9100'</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'java-demo-app'</span> <span class="token comment"># Java ä¸šåŠ¡ç³»ç»Ÿ</span>
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> <span class="token string">'/actuator/prometheus'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'host.docker.internal:8080'</span><span class="token punctuation">]</span>
</code></pre>
    <p>
     3.3 å¯åŠ¨docker
     <br/>
     å®Œæˆä¸Šé¢çš„æ“ä½œåï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨å®¹å™¨äº†
    </p>
    <pre><code class="prism language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> <span class="token comment"># -d ä¸å±•ç¤ºå¯åŠ¨logï¼Œåœ¨åå°å¯åŠ¨</span>
</code></pre>
    <p>
     å¯åŠ¨åï¼š
    </p>
    <p>
     Prometheus è®¿é—®åœ°å€ï¼šhttp://localhost:9090
    </p>
    <p>
     Grafana è®¿é—®åœ°å€ï¼šhttp://localhost:3000ï¼ˆé»˜è®¤ç”¨æˆ·
     <code>
      admin/admin
     </code>
     ï¼‰ PsğŸ—¡ ç¬¬ä¸€æ¬¡è®¿é—®ä¼šè®©ä½ æ”¹é»˜è®¤å¯†ç 
    </p>
    <blockquote>
     <p>
      ä¸€äº›çŸ¥è¯†ç‚¹ğŸ›© ï¼š
     </p>
     <ol>
      <li>
       åœ¨æ™®ç½—ç±³ä¿®æ–¯ä¸­å¯ä»¥é€šè¿‡ç®€å•çš„sqlæ¥æŸ¥è¯¢å·²ç»ä¸ŠæŠ¥çš„æ•°æ®ã€‚å¯ä»¥é€šè¿‡ http://localhost:9090/query è¿™ä¸ªè·¯å¾„æ¥æŸ¥è¯¢ã€‚å¦‚æœä½ æƒ³è¦çœ‹åˆ°ä¸€äº›æ•°æ®å¯ä»¥å°è¯•æŸ¥ä¸€ä¸‹
       <strong>
        <code>
         node_cpu_seconds_total
        </code>
       </strong>
       è¿™ä¸ªä¿¡æ¯ï¼Œä½ å¤§æ¦‚å¯ä»¥çœ‹åˆ°ä¸€å †æ•°æ®
      </li>
      <li>
       å¦‚æœä½ æ²¡çœ‹åˆ°ä»»ä½•ä¿¡æ¯æˆ–è€…ä½ æƒ³è¦çœ‹æ™®ç½—ç±³ä¿®æ–¯æ­£åœ¨ä»æ”¶é›†å“ªäº›åº”ç”¨çš„ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ http://localhost:9090/targets æ¥è¿›è¡ŒæŸ¥çœ‹ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°å“ªäº›åº”ç”¨åœ¨çº¿æˆ–è€…ç¦»çº¿
      </li>
     </ol>
    </blockquote>
    <h4>
     <a id="4_GrafanaPrometheus_112">
     </a>
     4.
     <strong>
      åœ¨Grafanaä¸­é…ç½®Prometheusæ•°æ®æº
     </strong>
    </h4>
    <p>
     è®¿é—®Grafana http://localshot:3000
    </p>
    <p>
     Grafana å·¦ä¾§èœå• â†’
     <strong>
      é½¿è½®å›¾æ ‡ï¼ˆConfigurationï¼‰ â†’ Data Sources
     </strong>
    </p>
    <p>
     ç‚¹å‡»
     <strong>
      Add data source
     </strong>
    </p>
    <p>
     é€‰æ‹©
     <strong>
      Prometheus
     </strong>
    </p>
    <p>
     å¡«å†™
     <strong>
      URL
     </strong>
     ï¼šhttp://prometheus:9090 è¿™é‡Œä¸ºä»€ä¹ˆå†™prometheus:9090å‘¢ï¼Œæ˜¯ä»¥ä¸ºGrafana å’Œ Prometheus åœ¨åŒä¸€ä¸ªdockerç½‘ç»œä¸‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´å‘¼å…¶å
    </p>
    <p>
     ç‚¹å‡»
     <strong>
      Save &amp; Test
     </strong>
     â†’ æ˜¾ç¤º
     <code>
      Data source is working
     </code>
     ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸï¼
    </p>
    <h4>
     <a id="5_Dashboard_126">
     </a>
     5.
     <strong>
      å¯¼å…¥ç›‘æ§é¢æ¿ï¼ˆDashboardï¼‰
     </strong>
    </h4>
    <h5>
     <a id="_DashboardNode_Exporter_128">
     </a>
     å¯¼å…¥ç°æˆçš„æœåŠ¡å™¨ç›‘æ§ Dashboardï¼ˆNode Exporterï¼‰
    </h5>
    <ol>
     <li>
      å·¦ä¾§ â†’
      <strong>
       Dashboardï¼ˆå››ä¸ªæ–¹å—å›¾æ ‡ï¼‰ â†’ Import
      </strong>
     </li>
     <li>
      è¾“å…¥
      <strong>
       Dashboard ID
      </strong>
      ï¼š
      <code>
       1860
      </code>
     </li>
     <li>
      ç‚¹å‡»
      <strong>
       Load
      </strong>
     </li>
     <li>
      é€‰æ‹© Prometheus æ•°æ®æº
     </li>
     <li>
      ç‚¹å‡»
      <strong>
       Import
      </strong>
     </li>
    </ol>
    <p>
     <strong>
      æ•ˆæœ
     </strong>
     ï¼šé©¬ä¸Šçœ‹åˆ°æœåŠ¡å™¨ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå›¾è¡¨ï¼
    </p>
    <h4>
     <a id="___138">
     </a>
     âœ… åˆ°ç›®å‰ä¸ºæ­¢ä½ æ‰€å®Œæˆäº‹æƒ… æ¯ä¸ªç»„ä»¶çš„èŒè´£å’Œæ„ä¹‰
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        ç»„ä»¶
       </th>
       <th>
        ä½œç”¨
       </th>
       <th>
        ä½ åšäº†ä»€ä¹ˆ
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Docker
       </td>
       <td>
        å¿«é€Ÿæ„å»ºç¯å¢ƒ
       </td>
       <td>
        è£…äº† Dockerï¼Œéƒ¨ç½²äº†å®¹å™¨
       </td>
      </tr>
      <tr>
       <td>
        Prometheus
       </td>
       <td>
        æŠ“å–æŒ‡æ ‡ï¼Œä¿å­˜æ•°æ®
       </td>
       <td>
        é…äº† prometheus.ymlï¼Œå¯åŠ¨æœåŠ¡
       </td>
      </tr>
      <tr>
       <td>
        Node Exporter
       </td>
       <td>
        æä¾›ä¸»æœºæŒ‡æ ‡
       </td>
       <td>
        å¯åŠ¨äº† node-exporterï¼Œæš´éœ² 9100
       </td>
      </tr>
      <tr>
       <td>
        Grafana
       </td>
       <td>
        æ•°æ®å±•ç¤ºå’Œåˆ†æ
       </td>
       <td>
        é…äº†æ•°æ®æºã€å¯¼å…¥ Dashboard
       </td>
      </tr>
     </tbody>
    </table>
    <h4>
     <a id="6_Java_DEMO_147">
     </a>
     6.
     <strong>
      å¯åŠ¨Java DEMO
     </strong>
    </h4>
    <ol>
     <li>
      åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œpomæ–‡ä»¶å¦‚ä¸‹
     </li>
    </ol>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.pivotal.spring.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-services-starter-service-registry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.micrometer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>micrometer-registry-prometheus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <ol start="2">
     <li>
      é…ç½®application.yml
     </li>
    </ol>
    <pre><code class="prism language-yml">  <span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> demo
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token comment"># ä»¥ä¸‹å†…å®¹ä¸»è¦æ˜¯ä¸ŠæŠ¥jvmçš„å¥åº·åº¦</span>
  <span class="token key atrule">management</span><span class="token punctuation">:</span>
    <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
      <span class="token key atrule">web</span><span class="token punctuation">:</span>
        <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
          <span class="token key atrule">include</span><span class="token punctuation">:</span> health<span class="token punctuation">,</span>info<span class="token punctuation">,</span>prometheus
    <span class="token key atrule">metrics</span><span class="token punctuation">:</span>
      <span class="token key atrule">tags</span><span class="token punctuation">:</span>
        <span class="token key atrule">application</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>app
</code></pre>
    <ol start="3">
     <li>
      <p>
       å¯åŠ¨Javademoé¡¹ç›®ï¼Œè¿™ä¸ªJavaé¡¹ç›®çš„jvmä¿¡æ¯å°†ä¼šè¢«ä¸ŠæŠ¥ç»™æ™®ç½—ç±³ä¿®æ–¯ã€‚
      </p>
     </li>
     <li>
      <p>
       æƒ³è¦çœ‹çœ‹ jvm GCçš„æƒ…å†µï¼Ÿå¯ä»¥åœ¨ä»ªè¡¨ç›˜ä¸­å¯¼å…¥è¿™ä¸ªjsonæ¨¡æ¿
      </p>
     </li>
    </ol>
    <pre><code class="prism language-json">     <span class="token punctuation">{<!-- --></span>
       <span class="token string-property property">"annotations"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string-property property">"list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token string-property property">"panels"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{<!-- --></span>
           <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"GC æ¬¡æ•° (1m)"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
             <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"expr"</span><span class="token operator">:</span> <span class="token string">"increase(jvm_gc_pause_seconds_count{application=\"demo-app\"}[1m])"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"interval"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
               <span class="token string-property property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"GC æ¬¡æ•°"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"refId"</span><span class="token operator">:</span> <span class="token string">"A"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string-property property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"unit"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token string-property property">"mode"</span><span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>
                 <span class="token string-property property">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                   <span class="token punctuation">{<!-- --></span>
                     <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span>
                     <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token keyword">null</span>
                   <span class="token punctuation">}</span><span class="token punctuation">,</span>
                   <span class="token punctuation">{<!-- --></span>
                     <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span>
                     <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token number">5</span>
                   <span class="token punctuation">}</span><span class="token punctuation">,</span>
                   <span class="token punctuation">{<!-- --></span>
                     <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
                     <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token number">10</span>
                   <span class="token punctuation">}</span>
                 <span class="token punctuation">]</span>
               <span class="token punctuation">}</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"reduceOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"calcs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lastNotNull"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string-property property">"fields"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
               <span class="token string-property property">"values"</span><span class="token operator">:</span> <span class="token boolean">false</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"orientation"</span><span class="token operator">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
             <span class="token string-property property">"colorMode"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
             <span class="token string-property property">"graphMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
             <span class="token string-property property">"justifyMode"</span><span class="token operator">:</span> <span class="token string">"auto"</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"h"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
             <span class="token string-property property">"w"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
             <span class="token string-property property">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
             <span class="token string-property property">"y"</span><span class="token operator">:</span> <span class="token number">0</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{<!-- --></span>
           <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"GC è€—æ—¶ (1m)"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
             <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"expr"</span><span class="token operator">:</span> <span class="token string">"increase(jvm_gc_pause_seconds_sum{application=\"demo-app\"}[1m])"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"interval"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
               <span class="token string-property property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"GC è€—æ—¶ (ç§’)"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"refId"</span><span class="token operator">:</span> <span class="token string">"B"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string-property property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"unit"</span><span class="token operator">:</span> <span class="token string">"s"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token string-property property">"mode"</span><span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>
                 <span class="token string-property property">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                   <span class="token punctuation">{<!-- --></span>
                     <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span>
                     <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token keyword">null</span>
                   <span class="token punctuation">}</span><span class="token punctuation">,</span>
                   <span class="token punctuation">{<!-- --></span>
                     <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span>
                     <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token number">0.5</span>
                   <span class="token punctuation">}</span><span class="token punctuation">,</span>
                   <span class="token punctuation">{<!-- --></span>
                     <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
                     <span class="token string-property property">"value"</span><span class="token operator">:</span> <span class="token number">1</span>
                   <span class="token punctuation">}</span>
                 <span class="token punctuation">]</span>
               <span class="token punctuation">}</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"reduceOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"calcs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lastNotNull"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token string-property property">"fields"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
               <span class="token string-property property">"values"</span><span class="token operator">:</span> <span class="token boolean">false</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"orientation"</span><span class="token operator">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
             <span class="token string-property property">"colorMode"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
             <span class="token string-property property">"graphMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
             <span class="token string-property property">"justifyMode"</span><span class="token operator">:</span> <span class="token string">"auto"</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"h"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
             <span class="token string-property property">"w"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
             <span class="token string-property property">"x"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
             <span class="token string-property property">"y"</span><span class="token operator">:</span> <span class="token number">0</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{<!-- --></span>
           <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"GC æ¬¡æ•°è¶‹åŠ¿"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
             <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"expr"</span><span class="token operator">:</span> <span class="token string">"rate(jvm_gc_pause_seconds_count{application=\"demo-app\"}[1m])"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"interval"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
               <span class="token string-property property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{gc}}"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"refId"</span><span class="token operator">:</span> <span class="token string">"C"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string-property property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"unit"</span><span class="token operator">:</span> <span class="token string">"none"</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"legend"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"displayMode"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"placement"</span><span class="token operator">:</span> <span class="token string">"bottom"</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"tooltip"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"mode"</span><span class="token operator">:</span> <span class="token string">"single"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
             <span class="token string-property property">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
             <span class="token string-property property">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
             <span class="token string-property property">"y"</span><span class="token operator">:</span> <span class="token number">6</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{<!-- --></span>
           <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"GC è€—æ—¶è¶‹åŠ¿"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
           <span class="token string-property property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
             <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"expr"</span><span class="token operator">:</span> <span class="token string">"rate(jvm_gc_pause_seconds_sum{application=\"demo-app\"}[1m])"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"interval"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
               <span class="token string-property property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{gc}}"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"refId"</span><span class="token operator">:</span> <span class="token string">"D"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string-property property">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"unit"</span><span class="token operator">:</span> <span class="token string">"s"</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"legend"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"displayMode"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
               <span class="token string-property property">"placement"</span><span class="token operator">:</span> <span class="token string">"bottom"</span>
             <span class="token punctuation">}</span><span class="token punctuation">,</span>
             <span class="token string-property property">"tooltip"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-property property">"mode"</span><span class="token operator">:</span> <span class="token string">"single"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token string-property property">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
             <span class="token string-property property">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
             <span class="token string-property property">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
             <span class="token string-property property">"x"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
             <span class="token string-property property">"y"</span><span class="token operator">:</span> <span class="token number">6</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token string-property property">"schemaVersion"</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
       <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"JVM GC ä»ªè¡¨ç›˜"</span><span class="token punctuation">,</span>
       <span class="token string-property property">"timezone"</span><span class="token operator">:</span> <span class="token string">"browser"</span><span class="token punctuation">,</span>
       <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
     
</code></pre>
    <ol start="5">
     <li>
      æƒ³è¦å®ç°controllerå’Œserviceæ¥å£çš„æ‰§è¡Œæƒ…å†µï¼Ÿ é€šè¿‡aopæ¥å®ç° è¿™ä¸ªaopå¯ä»¥ä¸ŠæŠ¥æ‰€æœ‰æ¥å£
      <code>
       tp 999
      </code>
      <code>
       tp 99
      </code>
      <code>
       tp 50
      </code>
      çš„æƒ…å†µ
     </li>
    </ol>
    <pre><code class="prism language-java">     <span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>micrometer<span class="token punctuation">.</span>core<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">MeterRegistry</span></span><span class="token punctuation">;</span>
     <span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>micrometer<span class="token punctuation">.</span>core<span class="token punctuation">.</span>instrument<span class="token punctuation">.</span></span><span class="token class-name">Timer</span></span><span class="token punctuation">;</span>
     <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span>
     <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Around</span></span><span class="token punctuation">;</span>
     <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
     <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
     
     <span class="token annotation punctuation">@Aspect</span>
     <span class="token annotation punctuation">@Component</span>
     <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodTimerAspect</span> <span class="token punctuation">{<!-- --></span>
     
         <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MeterRegistry</span> meterRegistry<span class="token punctuation">;</span>
     
         <span class="token keyword">public</span> <span class="token class-name">MethodTimerAspect</span><span class="token punctuation">(</span><span class="token class-name">MeterRegistry</span> meterRegistry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
             <span class="token keyword">this</span><span class="token punctuation">.</span>meterRegistry <span class="token operator">=</span> meterRegistry<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     
         <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.example..controller..*(..)) || execution(* com.example..service..*(..))"</span><span class="token punctuation">)</span>
         <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">timeMethods</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
             <span class="token class-name">String</span> className <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">String</span> methodName <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token class-name">String</span> timerName <span class="token operator">=</span> <span class="token string">"method_execution_timer"</span><span class="token punctuation">;</span>
     
             <span class="token class-name">Timer<span class="token punctuation">.</span>Sample</span> sample <span class="token operator">=</span> <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>meterRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>
     
             <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token keyword">return</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                 sample<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span>
                         <span class="token class-name">Timer</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>timerName<span class="token punctuation">)</span>
                                 <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"æ–¹æ³•æ‰§è¡Œè€—æ—¶ç»Ÿè®¡"</span><span class="token punctuation">)</span>
                                 <span class="token punctuation">.</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> className<span class="token punctuation">,</span> <span class="token string">"method"</span><span class="token punctuation">,</span> methodName<span class="token punctuation">)</span>
                                 <span class="token punctuation">.</span><span class="token function">publishPercentiles</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.99</span><span class="token punctuation">,</span> <span class="token number">0.999</span><span class="token punctuation">)</span>
                                 <span class="token punctuation">.</span><span class="token function">publishPercentileHistogram</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                 <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>meterRegistry<span class="token punctuation">)</span>
                 <span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
     
     <span class="token punctuation">}</span>
     ```

     <span class="token number">6.</span> å¦‚æœä½ æƒ³è¦çœ‹çœ‹å„ä¸ªæ¥å£çš„æ‰§è¡Œæƒ…å†µï¼Œå¯¼å…¥ä¸‹é¢è¿™ä¸ªjsonæ¨¡æ¿å¯ä»¥çœ‹åˆ°

        ```json
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"annotations"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">"templating"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"list"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{<!-- --></span>
                <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"datasource"</span><span class="token punctuation">,</span>
                <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"datasource"</span><span class="token punctuation">,</span>
                <span class="token string">"query"</span><span class="token operator">:</span> <span class="token string">"prometheus"</span><span class="token punctuation">,</span>
                <span class="token string">"label"</span><span class="token operator">:</span> <span class="token string">"Prometheus æ•°æ®æº"</span><span class="token punctuation">,</span>
                <span class="token string">"hide"</span><span class="token operator">:</span> <span class="token number">0</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">"panels"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span>
              <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ TP999 å»¶è¿Ÿ (ms)"</span><span class="token punctuation">,</span>
              <span class="token string">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
              <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"expr"</span><span class="token operator">:</span> <span class="token string">"histogram_quantile(0.999, sum(rate(method_execution_time_bucket[1m])) by (le, method))"</span><span class="token punctuation">,</span>
                  <span class="token string">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{method}}"</span><span class="token punctuation">,</span>
                  <span class="token string">"refId"</span><span class="token operator">:</span> <span class="token string">"A"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"ms"</span><span class="token punctuation">,</span>
                  <span class="token string">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"mode"</span><span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>
                    <span class="token string">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"reduceOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"calcs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"max"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
                  <span class="token string">"values"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"orientation"</span><span class="token operator">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                <span class="token string">"colorMode"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
                <span class="token string">"graphMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
                <span class="token string">"justifyMode"</span><span class="token operator">:</span> <span class="token string">"auto"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"h"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span>
              <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ TP999 å»¶è¿Ÿè¶‹åŠ¿"</span><span class="token punctuation">,</span>
              <span class="token string">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
              <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"expr"</span><span class="token operator">:</span> <span class="token string">"histogram_quantile(0.999, sum(rate(method_execution_time_bucket[1m])) by (le, method))"</span><span class="token punctuation">,</span>
                  <span class="token string">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{method}}"</span><span class="token punctuation">,</span>
                  <span class="token string">"refId"</span><span class="token operator">:</span> <span class="token string">"B"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"ms"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"legend"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"displayMode"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
                  <span class="token string">"placement"</span><span class="token operator">:</span> <span class="token string">"bottom"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"tooltip"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"mode"</span><span class="token operator">:</span> <span class="token string">"single"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span>
              <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ QPS"</span><span class="token punctuation">,</span>
              <span class="token string">"datasource"</span><span class="token operator">:</span> <span class="token string">"${datasource}"</span><span class="token punctuation">,</span>
              <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"expr"</span><span class="token operator">:</span> <span class="token string">"sum(rate(http_server_requests_seconds_count[1m])) by (uri, method)"</span><span class="token punctuation">,</span>
                  <span class="token string">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{uri}} {<!-- -->{method}}"</span><span class="token punctuation">,</span>
                  <span class="token string">"refId"</span><span class="token operator">:</span> <span class="token string">"C"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"ops"</span><span class="token punctuation">,</span>
                  <span class="token string">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"mode"</span><span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>
                    <span class="token string">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"reduceOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"calcs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"max"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
                  <span class="token string">"values"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"orientation"</span><span class="token operator">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                <span class="token string">"colorMode"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
                <span class="token string">"graphMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
                <span class="token string">"justifyMode"</span><span class="token operator">:</span> <span class="token string">"auto"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"h"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token operator">:</span> <span class="token number">14</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span>
              <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ QPS è¶‹åŠ¿"</span><span class="token punctuation">,</span>
              <span class="token string">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
              <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"expr"</span><span class="token operator">:</span> <span class="token string">"sum(rate(http_server_requests_seconds_count[1m])) by (uri, method)"</span><span class="token punctuation">,</span>
                  <span class="token string">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{uri}} {<!-- -->{method}}"</span><span class="token punctuation">,</span>
                  <span class="token string">"refId"</span><span class="token operator">:</span> <span class="token string">"D"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"ops"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"legend"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"displayMode"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
                  <span class="token string">"placement"</span><span class="token operator">:</span> <span class="token string">"bottom"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"tooltip"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"mode"</span><span class="token operator">:</span> <span class="token string">"single"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"stat"</span><span class="token punctuation">,</span>
              <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ 5xx é”™è¯¯æ•°"</span><span class="token punctuation">,</span>
              <span class="token string">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
              <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"expr"</span><span class="token operator">:</span> <span class="token string">"sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[1m])) by (uri, method)"</span><span class="token punctuation">,</span>
                  <span class="token string">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{uri}} {<!-- -->{method}}"</span><span class="token punctuation">,</span>
                  <span class="token string">"refId"</span><span class="token operator">:</span> <span class="token string">"E"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"short"</span><span class="token punctuation">,</span>
                  <span class="token string">"thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"mode"</span><span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>
                    <span class="token string">"steps"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">{<!-- --></span> <span class="token string">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"reduceOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"calcs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"max"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token string">"fields"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
                  <span class="token string">"values"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"orientation"</span><span class="token operator">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                <span class="token string">"colorMode"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
                <span class="token string">"graphMode"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
                <span class="token string">"justifyMode"</span><span class="token operator">:</span> <span class="token string">"auto"</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"h"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token operator">:</span> <span class="token number">28</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
              <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"timeseries"</span><span class="token punctuation">,</span>
              <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ 5xx é”™è¯¯æ•°è¶‹åŠ¿"</span><span class="token punctuation">,</span>
              <span class="token string">"datasource"</span><span class="token operator">:</span> <span class="token string">"prometheus-1"</span><span class="token punctuation">,</span>
              <span class="token string">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"expr"</span><span class="token operator">:</span> <span class="token string">"sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[1m])) by (uri, method)"</span><span class="token punctuation">,</span>
                  <span class="token string">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"{<!-- -->{uri}} {<!-- -->{method}}"</span><span class="token punctuation">,</span>
                  <span class="token string">"refId"</span><span class="token operator">:</span> <span class="token string">"F"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string">"fieldConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"defaults"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"unit"</span><span class="token operator">:</span> <span class="token string">"short"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"options"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"legend"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"displayMode"</span><span class="token operator">:</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
                  <span class="token string">"placement"</span><span class="token operator">:</span> <span class="token string">"bottom"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string">"tooltip"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                  <span class="token string">"mode"</span><span class="token operator">:</span> <span class="token string">"single"</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">"gridPos"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"h"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token operator">:</span> <span class="token number">34</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"æ¥å£ TP999 + QPS + é”™è¯¯ç›‘æ§"</span><span class="token punctuation">,</span>
          <span class="token string">"timezone"</span><span class="token operator">:</span> <span class="token string">"browser"</span><span class="token punctuation">,</span>
          <span class="token string">"schemaVersion"</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
          <span class="token string">"version"</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
        
</code></pre>
    <hr/>
    <blockquote>
     <p>
      âœ…é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ä½ åº”è¯¥å°±èƒ½å®ç°ä¸šåŠ¡æ¥å£çš„ç›‘æ§ï¼Œåç»­å¾®æœåŠ¡å¼ç›‘æ§å¯èƒ½è¿˜ä¼šæ›´æ–° æ•¬è¯·æœŸå¾…â€¦
     </p>
    </blockquote>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470:733a2f2f626c6f672e6373646e2e6e65742f4848573232332f:61727469636c652f64657461696c732f313436313931363833" class_="artid" style="display:none">
 </p>
</div>


