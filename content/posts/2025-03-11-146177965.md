---
layout: post
title: "K8S中PV和PVC之间的关系"
date: 2025-03-11 14:18:08 +0800
description: "Persistent Volume (PV) 和 Persistent Volume Claim (PVC) 的关系是什么？  "
keywords: "K8S中PV和PVC之间的关系"
categories: ['运维']
tags: ['运维', 'Kubernetes']
artid: "146177965"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146177965
    alt: "K8S中PV和PVC之间的关系"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146177965
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146177965
cover: https://bing.ee123.net/img/rand?artid=146177965
image: https://bing.ee123.net/img/rand?artid=146177965
img: https://bing.ee123.net/img/rand?artid=146177965
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     K8S中PV和PVC之间的关系
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      Persistent Volume (PV)
     </strong>
     和
     <strong>
      Persistent Volume Claim (PVC)
     </strong>
     是 Kubernetes 中管理存储的核心抽象概念，二者的关系可以类比为
     <strong>
      存储资源提供方
     </strong>
     和
     <strong>
      存储资源消费方
     </strong>
     。以下是详细解释：
    </p>
    <h4>
     <strong>
      核心关系
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         对象
        </strong>
       </th>
       <th>
        <strong>
         角色
        </strong>
       </th>
       <th>
        <strong>
         生命周期
        </strong>
       </th>
       <th>
        <strong>
         使用者
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         Persistent Volume (PV)
        </strong>
       </td>
       <td>
        <strong>
         存储资源的实体
        </strong>
        （如 NFS、云磁盘、本地磁盘等）
       </td>
       <td>
        独立于 Pod 和 PVC，需手动或动态创建
       </td>
       <td>
        由集群管理员配置
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         Persistent Volume Claim (PVC)
        </strong>
       </td>
       <td>
        <strong>
         用户对存储资源的请求
        </strong>
        （声明需要的存储特性）
       </td>
       <td>
        与 Pod 绑定，由用户创建和销毁
       </td>
       <td>
        开发者或应用运维人员
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <strong>
      交互流程
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        管理员创建 PV
       </strong>
      </p>
      <ul>
       <li>
        <p>
         定义存储资源的容量、访问模式（如
         <code>
          ReadWriteOnce
         </code>
         ）、存储类型等。
        </p>
       </li>
       <li>
        <p>
         示例 PV 配置（静态供应）：
        </p>
        <pre>apiVersion: v1
kind: PersistentVolume
metadata:
  name: my-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain  # 回收策略（Retain/Delete/Recycle）
  storageClassName: manual              # 关联的 StorageClass
  hostPath:
    path: /data                         # 使用本地存储（仅示例）</pre>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        用户创建 PVC
       </strong>
      </p>
      <ul>
       <li>
        <p>
         声明需要的存储容量、访问模式、存储类（StorageClass）。
        </p>
       </li>
       <li>
        <p>
         示例 PVC 配置：
        </p>
        <pre>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  storageClassName: manual
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi</pre>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        Kubernetes 绑定 PV 和 PVC
       </strong>
      </p>
      <ul>
       <li>
        <p>
         系统根据 PVC 的请求（容量、访问模式、StorageClass）
         <strong>
          匹配可用 PV
         </strong>
         。
        </p>
       </li>
       <li>
        <p>
         若匹配成功，PVC 进入
         <code>
          Bound
         </code>
         状态，与 PV 建立一对一绑定。
        </p>
       </li>
       <li>
        <p>
         若没有可用 PV，且启用了动态供应（通过 StorageClass），则会
         <strong>
          自动创建新 PV
         </strong>
         。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        Pod 挂载 PVC
       </strong>
      </p>
      <ul>
       <li>
        <p>
         在 Pod 中通过
         <code>
          volumes
         </code>
         字段引用 PVC：
        </p>
        <pre>apiVersion: v1
kind: Pod
metadata:
  name: my-pod
spec:
  containers:
    - name: app
      image: nginx
      volumeMounts:
        - name: data
          mountPath: /var/www/html
  volumes:
    - name: data
      persistentVolumeClaim:
        claimName: my-pvc  # 使用已绑定的 PVC</pre>
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <strong>
      关键特性对比
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        <strong>
         特性
        </strong>
       </th>
       <th>
        <strong>
         PV
        </strong>
       </th>
       <th>
        <strong>
         PVC
        </strong>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         定义者
        </strong>
       </td>
       <td>
        集群管理员
       </td>
       <td>
        应用开发者
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         创建方式
        </strong>
       </td>
       <td>
        手动创建或动态供应（通过 StorageClass）
       </td>
       <td>
        用户手动创建
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         绑定关系
        </strong>
       </td>
       <td>
        一个 PV 只能绑定到一个 PVC
       </td>
       <td>
        一个 PVC 只能绑定到一个 PV
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         回收策略
        </strong>
       </td>
       <td>
        支持
        <code>
         Retain
        </code>
        、
        <code>
         Delete
        </code>
        、
        <code>
         Recycle
        </code>
       </td>
       <td>
        无，随 PV 的回收策略处理
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         动态供应
        </strong>
       </td>
       <td>
        依赖 StorageClass 和 Provisioner
       </td>
       <td>
        通过指定 StorageClass 触发动态创建 PV
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h4>
     <strong>
      生命周期与回收策略
     </strong>
    </h4>
    <ol>
     <li>
      <p>
       <strong>
        PV 的回收策略
       </strong>
       （
       <code>
        persistentVolumeReclaimPolicy
       </code>
       ）
      </p>
      <ul>
       <li>
        <p>
         <strong>
          Retain
         </strong>
         （默认）：删除 PVC 后，PV 保留数据，需手动清理。
        </p>
       </li>
       <li>
        <p>
         <strong>
          Delete
         </strong>
         ：删除 PVC 后，自动删除 PV 及底层存储（如云磁盘）。
        </p>
       </li>
       <li>
        <p>
         <strong>
          Recycle
         </strong>
         （已废弃）：删除数据并标记 PV 为可用（仅适用于部分存储类型）。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        PVC 删除后的行为
       </strong>
      </p>
      <ul>
       <li>
        <p>
         若 PV 的回收策略为
         <code>
          Retain
         </code>
         ，则 PV 进入
         <code>
          Released
         </code>
         状态，需管理员手动清理后重新绑定。
        </p>
       </li>
       <li>
        <p>
         若为
         <code>
          Delete
         </code>
         ，则 PV 和底层存储资源会被自动删除。
        </p>
       </li>
      </ul>
     </li>
    </ol>
    <hr/>
    <h4>
     <strong>
      动态供应（Dynamic Provisioning）
     </strong>
    </h4>
    <p>
     当使用
     <strong>
      StorageClass
     </strong>
     时，PVC 可以直接触发 PV 的自动创建，无需管理员预先配置 PV。
    </p>
    <ul>
     <li>
      <p>
       示例 StorageClass（AWS EBS）：
      </p>
      <pre>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: aws-gp2
provisioner: kubernetes.io/aws-ebs  # 指定存储驱动
parameters:
  type: gp2
reclaimPolicy: Delete              # 动态创建的 PV 默认回收策略</pre>
     </li>
     <li>
      <p>
       用户创建 PVC 时指定 StorageClass：
      </p>
      <pre>spec:
  storageClassName: aws-gp2  # 动态创建符合要求的 PV
  accessModes: [ReadWriteOnce]
  resources:
    requests:
      storage: 20Gi</pre>
     </li>
    </ul>
    <hr/>
    <h4>
     <strong>
      总结
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        PV
       </strong>
       是实际的存储资源，
       <strong>
        PVC
       </strong>
       是用户对存储需求的抽象。
      </p>
     </li>
     <li>
      <p>
       <strong>
        PVC 通过匹配 PV 的规格
       </strong>
       （容量、访问模式、StorageClass）来绑定存储资源。
      </p>
     </li>
     <li>
      <p>
       <strong>
        动态供应
       </strong>
       通过 StorageClass 实现按需自动创建 PV，大幅简化存储管理。
      </p>
     </li>
     <li>
      <p>
       二者的分离使得
       <strong>
        存储资源的提供方（管理员）和使用方（开发者）职责清晰
       </strong>
       ，提升灵活性和可维护性。
      </p>
     </li>
    </ul>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f:2f626c6f672e6373646e2e6e65742f626c747975323030302f:61727469636c652f64657461696c732f313436313737393635" class_="artid" style="display:none">
 </p>
</div>


