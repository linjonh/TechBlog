---
layout: post
title: "rust-rust学习"
date: 2025-03-12 12:30:58 +0800
description: "✅。"
keywords: "[rust] rust学习"
categories: ['Rust']
tags: ['开发语言', '学习', 'Rust']
artid: "146201669"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146201669
    alt: "rust-rust学习"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146201669
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146201669
cover: https://bing.ee123.net/img/rand?artid=146201669
image: https://bing.ee123.net/img/rand?artid=146201669
img: https://bing.ee123.net/img/rand?artid=146201669
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     [rust] rust学习
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="rust_0">
     </a>
     rust学习
    </h2>
    <h3>
     <a id="1__1">
     </a>
     1. 项目组织结构
    </h3>
    <h4>
     <a id="_3">
     </a>
     工程
    </h4>
    <pre><code># 创建一个工程
cargo new my-project
</code></pre>
    <h4>
     <a id="_9">
     </a>
     工作空间
    </h4>
    <p>
     在
     <strong>
      Rust
     </strong>
     中，
     <strong>
      工作空间（Workspace）
     </strong>
     是一个
     <strong>
      包含多个 Rust 项目的共享环境
     </strong>
     ，用于管理多个 crate（库或可执行文件）。它允许多个 Rust 项目共享
     <code>
      Cargo.lock
     </code>
     、依赖项和
     <code>
      target/
     </code>
     目录，提高编译效率，并且适用于
     <strong>
      多包管理、模块化开发
     </strong>
     。
    </p>
    <hr/>
    <h3>
     <a id="__Rust__14">
     </a>
     <strong>
      🔹 为什么使用 Rust 工作空间？
     </strong>
    </h3>
    <p>
     Rust 工作空间适用于以下场景：
    </p>
    <ol>
     <li>
      <p>
       <strong>
        管理多个相关的 crate
       </strong>
       （类似于 monorepo）
      </p>
      <ul>
       <li>
        比如，你有一个主程序
        <code>
         app
        </code>
        ，但
        <code>
         app
        </code>
        依赖于
        <code>
         lib1
        </code>
        和
        <code>
         lib2
        </code>
        ，可以用工作空间管理它们。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        共享依赖
       </strong>
       ，减少重复构建，提高编译速度。
      </p>
      <ul>
       <li>
        例如
        <code>
         app
        </code>
        和
        <code>
         lib1
        </code>
        都依赖
        <code>
         serde
        </code>
        ，Rust 只会编译一次。
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        统一管理
        <code>
         Cargo.lock
        </code>
       </strong>
       ，保证所有 crate 依赖版本一致。
      </p>
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="__Rust__26">
     </a>
     <strong>
      🔹 如何创建 Rust 工作空间？
     </strong>
    </h3>
    <h4>
     <a id="1__Rust__27">
     </a>
     <strong>
      1️⃣ 创建一个 Rust 项目
     </strong>
    </h4>
    <pre><code class="prism language-sh"><span class="token function">mkdir</span> my_workspace
<span class="token builtin class-name">cd</span> my_workspace
<span class="token function">cargo</span> new <span class="token parameter variable">--lib</span> lib1
<span class="token function">cargo</span> new <span class="token parameter variable">--lib</span> lib2
<span class="token function">cargo</span> new <span class="token parameter variable">--bin</span> app
</code></pre>
    <p>
     你会得到如下目录结构：
    </p>
    <pre><code>my_workspace/
├── Cargo.toml  # 工作空间的根 Cargo.toml
├── lib1/
│   ├── Cargo.toml
│   ├── src/
│   │   └── lib.rs
├── lib2/
│   ├── Cargo.toml
│   ├── src/
│   │   └── lib.rs
├── app/
│   ├── Cargo.toml
│   ├── src/
│   │   └── main.rs
</code></pre>
    <hr/>
    <h4>
     <a id="2__Cargotoml_55">
     </a>
     <strong>
      2️⃣ 配置
      <code>
       Cargo.toml
      </code>
     </strong>
    </h4>
    <p>
     在
     <code>
      my_workspace/Cargo.toml
     </code>
     （根目录）中添加：
    </p>
    <pre><code class="prism language-toml">[workspace]
members = ["lib1", "lib2", "app"]
resolver = "2" # 使用 Cargo v2 依赖解析
</code></pre>
    <p>
     这样，Rust 知道这 3 个项目属于同一个工作空间。
    </p>
    <hr/>
    <h4>
     <a id="3__app__lib1__lib2_66">
     </a>
     <strong>
      3️⃣ 在
      <code>
       app
      </code>
      依赖
      <code>
       lib1
      </code>
      和
      <code>
       lib2
      </code>
     </strong>
    </h4>
    <p>
     修改
     <code>
      app/Cargo.toml
     </code>
     ：
    </p>
    <pre><code class="prism language-toml">[dependencies]
lib1 = { path = "../lib1" }
lib2 = { path = "../lib2" }
</code></pre>
    <p>
     在
     <code>
      app/src/main.rs
     </code>
     ：
    </p>
    <pre><code class="prism language-rust"><span class="token keyword">use</span> <span class="token namespace">lib1<span class="token punctuation">::</span></span>hello<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">lib2<span class="token punctuation">::</span></span>world<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在
     <code>
      lib1/src/lib.rs
     </code>
     ：
    </p>
    <pre><code class="prism language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello from lib1!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     在
     <code>
      lib2/src/lib.rs
     </code>
     ：
    </p>
    <pre><code class="prism language-rust"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">world</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"World from lib2!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="4__101">
     </a>
     <strong>
      4️⃣ 运行工作空间
     </strong>
    </h4>
    <p>
     你可以在
     <code>
      my_workspace/
     </code>
     目录下直接运行：
    </p>
    <pre><code class="prism language-sh"><span class="token function">cargo</span> run <span class="token parameter variable">-p</span> app
</code></pre>
    <p>
     输出：
    </p>
    <pre><code>Hello from lib1!
World from lib2!
</code></pre>
    <p>
     你也可以
     <strong>
      一次性编译所有 crate
     </strong>
     ：
    </p>
    <pre><code class="prism language-sh"><span class="token function">cargo</span> build
</code></pre>
    <hr/>
    <h3>
     <a id="__119">
     </a>
     <strong>
      🔹 工作空间的额外功能
     </strong>
    </h3>
    <h4>
     <a id="__Cargolock_120">
     </a>
     <strong>
      ✔ 共享
      <code>
       Cargo.lock
      </code>
     </strong>
    </h4>
    <p>
     所有 crate 共享
     <code>
      Cargo.lock
     </code>
     ，保证相同的依赖版本：
    </p>
    <pre><code>my_workspace/
├── Cargo.lock  # 统一管理所有 crate 的依赖
├── ...
</code></pre>
    <h4>
     <a id="__workspacedependencies_128">
     </a>
     <strong>
      ✔ 使用
      <code>
       workspace.dependencies
      </code>
     </strong>
    </h4>
    <p>
     如果多个 crate 需要相同的依赖项，可以在根
     <code>
      Cargo.toml
     </code>
     统一声明：
    </p>
    <pre><code class="prism language-toml">[workspace.dependencies]
serde = "1.0"
</code></pre>
    <p>
     然后，在
     <code>
      lib1/Cargo.toml
     </code>
     和
     <code>
      lib2/Cargo.toml
     </code>
     这样写：
    </p>
    <pre><code class="prism language-toml">[dependencies]
serde = { workspace = true }
</code></pre>
    <p>
     这样可以确保
     <code>
      lib1
     </code>
     和
     <code>
      lib2
     </code>
     使用相同版本的
     <code>
      serde
     </code>
     ，避免版本冲突。
    </p>
    <hr/>
    <h3>
     <a id="__143">
     </a>
     <strong>
      🔹 总结
     </strong>
    </h3>
    <p>
     ✅
     <strong>
      Rust 工作空间
     </strong>
     适用于
     <strong>
      管理多个 crate
     </strong>
     ，优点包括：
    </p>
    <ul>
     <li>
      <strong>
       提高编译效率
      </strong>
      （共享
      <code>
       target/
      </code>
      ）
     </li>
     <li>
      <strong>
       统一依赖管理
      </strong>
      （共享
      <code>
       Cargo.lock
      </code>
      和
      <code>
       workspace.dependencies
      </code>
      ）
     </li>
     <li>
      <strong>
       模块化开发
      </strong>
      （适合 Monorepo）
     </li>
    </ul>
    <p>
     适用于：
    </p>
    <ul>
     <li>
      <strong>
       大型项目（微服务、多组件）
      </strong>
     </li>
     <li>
      <strong>
       库+CLI 工具
      </strong>
     </li>
     <li>
      <strong>
       框架开发（如 Web 框架）
      </strong>
     </li>
    </ul>
    <p>
     你有具体的 Rust 项目需求吗？我可以帮你优化工作空间结构！ 🚀
    </p>
    <h3>
     <a id="2__156">
     </a>
     2. 常使用的库
    </h3>
    <ul>
     <li>
      serde = { version = “1.0”, features = [“derive”] } # 序列化支持
     </li>
     <li>
      serde_json = “1.0” # JSON 序列化
     </li>
     <li>
      tokio = { version = “1.35”, features = [“full”] }
     </li>
     <li>
      axum = “0.7.9”
     </li>
    </ul>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33383733343437322f:61727469636c652f64657461696c732f313436323031363639" class_="artid" style="display:none">
 </p>
</div>


