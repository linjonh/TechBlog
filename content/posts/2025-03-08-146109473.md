---
arturl_encode: "68747470733a2f:2f626c6f672e6373646e2e6e65742f6c6367736b796362792f:61727469636c652f64657461696c732f313436313039343733"
layout: post
title: "ORACLE-执行查询语句慢不走对应索引"
date: 2025-03-08 02:27:32 +0800
description: "确保为查询中涉及的列创建了索引。例如，如果你经常需要按column_name列进行查询，确保已经为该列创建了索引,索引创建语句。"
keywords: "ORACLE 执行查询语句慢（不走对应索引）"
categories: ['未分类']
tags: ['数据库', 'Oracle']
artid: "146109473"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146109473
    alt: "ORACLE-执行查询语句慢不走对应索引"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146109473
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146109473
cover: https://bing.ee123.net/img/rand?artid=146109473
image: https://bing.ee123.net/img/rand?artid=146109473
img: https://bing.ee123.net/img/rand?artid=146109473
---

# ORACLE 执行查询语句慢（不走对应索引）

## 1. 索引未被创建或未正确创建

确保为查询中涉及的列创建了索引。例如，如果你经常需要按column\_name列进行查询，确保已经为该列创建了索引,索引创建语句

> CREATE INDEX idx\_column\_name ON table\_name(column\_name);

## 2、索引不可用

原因:索引可能被标记为不可用（UNUSABLE）通常是由于索引重建失败或数据导入操作导致的。
  
解决方法:检查索引状态并重建索引
  
检查索引状态

> SELECT INDEX\_NAME, STATUS FROM USER\_INDEXES WHERE TABLE\_NAME = 'TABLE\_NAME';

如果索引不可用，重建索引

> ALTER INDEX INDEX\_NAME REBUILD;

## 3、 **统计信息不准确**

**原因**
:
  
Oracle 优化器依赖统计信息来决定执行计划。如果表的统计信息不准确或过时，优化器可能会错误地选择不使用索引。

所以创建索引并且执行语句没有问题，则 可以使用DBMS\_STATS包来收集最新的统计信息：
  
解决方法:

> EXEC DBMS\_STATS.GATHER\_TABLE\_STATS('SCHEMA\_NAME', 'TABLE\_NAME');
>   
> EXEC DBMS\_STATS.GATHER\_TABLE\_STATS('SYMDR', 'LAB\_REPORT\_INFO');

## 4、如果收集最新的统计信息执行报错

错误信息：

ORA-20005: object statistics are locked (stattype = ALL) 则看是否有死锁

> SELECT s.sid, s.serial#, l.object\_id, o.object\_name, l.session\_id blocking\_sid
>   
> FROM v$locked\_object l
>   
> JOIN dba\_objects o ON l.object\_id = o.object\_id
>   
> JOIN v$session s ON l.session\_id = s.sid
>   
> WHERE o.object\_type = 'LAB\_REPORT\_INFO';

## 5、终止会话

如果找到死锁可以使用如下命令终止会话

> ALTER SYSTEM KILL SESSION 'sid,serial#';

## 6、强制更新统计信息

如果确定没有其他会话正在使用统计信息，或者已经终止了阻塞会话，可以尝试强制更新统计信息：

> BEGIN
>   
> DBMS\_STATS.GATHER\_TABLE\_STATS(
>   
> ownname       => 'OWNER',
>   
> tabname       => 'TABLE\_NAME',
>   
> estimate\_percent => DBMS\_STATS.AUTO\_SAMPLE\_SIZE,
>   
> method\_opt    => 'FOR ALL COLUMNS SIZE AUTO',
>   
> cascade       => TRUE,
>   
> force         => TRUE);
>   
> END;
>   
> /
>   
> BEGIN
>   
> DBMS\_STATS.GATHER\_TABLE\_STATS(
>   
> ownname       => 'SYMDR',
>   
> tabname       => 'LAB\_REPORT\_INFO',
>   
> estimate\_percent => DBMS\_STATS.AUTO\_SAMPLE\_SIZE,
>   
> method\_opt    => 'FOR ALL COLUMNS SIZE AUTO',
>   
> cascade       => TRUE,
>   
> force         => TRUE);
>   
> END;
>   
> /

## 7、 检查执行计划

使用 EXPLAIN PLAN 或 DBMS\_XPLAN 查看查询的执行计划，了解优化器为何选择不使用索引：

> EXPLAIN PLAN FOR SELECT \* FROM TABLE\_NAME WHERE COLUMN\_NAME = 'VALUE';
>   
> SELECT \* FROM TABLE(DBMS\_XPLAN.DISPLAY);
>
> EXPLAIN PLAN FOR
>   
> select \* from lab\_report\_info where org\_code='XX'   and request\_no='XX'      and local\_id='XX' ;
>   
> SELECT \* FROM table(DBMS\_XPLAN.DISPLAY());