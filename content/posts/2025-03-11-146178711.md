---
layout: post
title: "UNIAPP获取视频的第一帧作为封面基于视频URL,Canvas复制即用"
date: 2025-03-11 14:46:30 +0800
description: "业务场景：用户选择【图文】or【视频】进行发布文章，如果是图文的话，选择第一个图片作为封面，如果是视频的话，选择视频的第一帧作为封面。注意，包裹这些代码的函数，需要用async修饰。代码版本是vue3的，vue2也适用【自行修改】"
keywords: "【UNIAPP】获取视频的第一帧作为封面（基于视频URL，Canvas）复制即用"
categories: ['Uniapp']
tags: ['音视频', '前端', 'App']
artid: "146178711"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146178711
    alt: "UNIAPP获取视频的第一帧作为封面基于视频URL,Canvas复制即用"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146178711
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146178711
cover: https://bing.ee123.net/img/rand?artid=146178711
image: https://bing.ee123.net/img/rand?artid=146178711
img: https://bing.ee123.net/img/rand?artid=146178711
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【UNIAPP】获取视频的第一帧作为封面（基于视频URL，Canvas）复制即用
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h3>
     <a id="_2">
     </a>
     关键代码(复制即用)
    </h3>
    <p>
     注意，包裹这些代码的函数，需要用async修饰。 代码版本是vue3的，vue2也适用【自行修改】
    </p>
    <pre><code class="prism language-js"><span class="token comment">// 准备好你的视频地址</span>
<span class="token keyword">const</span> videoUrl <span class="token operator">=</span> 【视频地址 例如http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>test<span class="token punctuation">.</span>com<span class="token operator">/</span>xxx<span class="token punctuation">.</span>mp4】<span class="token punctuation">;</span>
<span class="token comment">// 1.创建视频元素</span>
<span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span> <span class="token comment">// 处理跨域问题</span>
video<span class="token punctuation">.</span>muted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>playsInline <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			
<span class="token comment">// 2.创建画布元素</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 等待视频元数据加载</span>
	<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadedmetadata'</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
		video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		video<span class="token punctuation">.</span>src <span class="token operator">=</span> videoUrl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
	<span class="token comment">// 设置视频当前帧到开始位置</span>
	video<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			
	<span class="token comment">// 等待视频帧准备好</span>
	<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'seeked'</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
		video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
	<span class="token comment">// 设置画布尺寸与视频一致</span>
	anvas<span class="token punctuation">.</span>width <span class="token operator">=</span> video<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
	canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> video<span class="token punctuation">.</span>videoHeight<span class="token punctuation">;</span>
			
	<span class="token comment">// 绘制到画布</span>
	ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
	<span class="token comment">// 将画布转换为 Blob</span>
	<span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> 
		canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
	<span class="token comment">// 创建文件对象</span>
	<span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blob<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'【文件名可以自定义】.jpg'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">lastModified</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'封面文件:'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span>
	<span class="token keyword">let</span> fm <span class="token operator">=</span> <span class="token keyword">await</span> 【换成你的上传文件<span class="token constant">API</span><span class="token function">接口】</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上传封面结果'</span><span class="token punctuation">,</span>fm<span class="token punctuation">)</span>
	data<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span> <span class="token operator">=</span> fm<span class="token punctuation">.</span>data
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	 console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'处理失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="js_62">
     </a>
     完整方法业务js
    </h4>
    <p>
     业务场景：用户选择【图文】or【视频】进行发布文章，如果是图文的话，选择第一个图片作为封面，如果是视频的话，选择视频的第一帧作为封面
    </p>
    <pre><code class="prism language-js">
<span class="token keyword">const</span> <span class="token function-variable function">submitDiscover</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'请输入标题'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'请输入内容'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>fileList<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'请上传内容'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 开始提交</span>
		<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">title</span><span class="token operator">:</span> title<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
			<span class="token literal-property property">content</span><span class="token operator">:</span> content<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
			<span class="token literal-property property">type</span><span class="token operator">:</span> submitType<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">'tuwen'</span> <span class="token operator">?</span> <span class="token string">'1'</span> <span class="token operator">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token comment">// 1图文 2视频，</span>
			<span class="token literal-property property">image</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
			<span class="token comment">// contextImg:[],</span>
			<span class="token comment">// video:''</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">let</span> files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>fileList<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token punctuation">(</span>fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rs<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'上传失败!请检查文件大小或格式'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">let</span> fileData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span>
		
			files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileData<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	
		<span class="token keyword">if</span><span class="token punctuation">(</span>submitType<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">'tuwen'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			data<span class="token punctuation">[</span><span class="token string">'contextImg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> files
			data<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span> <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 设置封面图</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 视频</span>
			data<span class="token punctuation">[</span><span class="token string">'video'</span><span class="token punctuation">]</span> <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
			<span class="token comment">// 封面要获取视频的第一帧并上传</span>
			<span class="token comment">// data['image'] = files[0]</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取封面:'</span><span class="token punctuation">,</span>fileList<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			  <span class="token keyword">const</span> videoUrl <span class="token operator">=</span> files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			    <span class="token comment">// 创建视频元素</span>
			    <span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			    video<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span> <span class="token comment">// 处理跨域问题</span>
			    video<span class="token punctuation">.</span>muted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			    video<span class="token punctuation">.</span>playsInline <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			
			    <span class="token comment">// 创建画布元素</span>
			    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			    <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			      <span class="token comment">// 等待视频元数据加载</span>
			      <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadedmetadata'</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
			        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
			        video<span class="token punctuation">.</span>src <span class="token operator">=</span> videoUrl<span class="token punctuation">;</span>
			      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			      <span class="token comment">// 设置视频当前帧到开始位置</span>
			      video<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			
			      <span class="token comment">// 等待视频帧准备好</span>
			      <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'seeked'</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
			        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
			      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			      <span class="token comment">// 设置画布尺寸与视频一致</span>
			      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> video<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
			      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> video<span class="token punctuation">.</span>videoHeight<span class="token punctuation">;</span>
			
			      <span class="token comment">// 绘制到画布</span>
			      ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			      <span class="token comment">// 将画布转换为 Blob</span>
			      <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> 
			        canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">)</span>
			      <span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			      <span class="token comment">// 创建文件对象</span>
			      <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blob<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'file.jpg'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
			        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
			        <span class="token literal-property property">lastModified</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				  <span class="token comment">// 创建一个FileReader实例</span>
				  <span class="token comment">// const reader = new FileReader();</span>
				  <span class="token comment">// reader.onload = function(event) {<!-- --></span>
				  <span class="token comment">//   // event.target.result包含了文件的Data URL（Base64编码的字符串）</span>
				  <span class="token comment">//   const base64String = event.target.result;</span>
				  <span class="token comment">//   // 你可以在这里使用base64String，例如将其显示在页面上或发送到服务器</span>
				  <span class="token comment">//   console.log('封面base64',base64String);</span>
				  <span class="token comment">// };</span>
				  <span class="token comment">// reader.readAsDataURL(file);</span>
				  
				  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'封面文件:'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span>
				  <span class="token keyword">let</span> fm <span class="token operator">=</span> <span class="token keyword">await</span> FileApi<span class="token punctuation">.</span><span class="token function">uploadFileByFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token comment">// TODO改成自己的方法</span>
				  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上传封面结果'</span><span class="token punctuation">,</span>fm<span class="token punctuation">)</span>
				  data<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span> <span class="token operator">=</span> fm<span class="token punctuation">.</span>data
				
					
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'处理失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'submit..'</span> <span class="token punctuation">,</span>data<span class="token punctuation">,</span>files<span class="token punctuation">)</span>
		<span class="token comment">// 发布文章</span>
		DiscoverApi<span class="token punctuation">.</span><span class="token function">publishDiscover</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发布结果'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'发布成功'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'success'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
					title<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
					content<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
					<span class="token comment">// file</span>
					fileList<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
					uni<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

</code></pre>
    <h4>
     <a id="yudaojs_210">
     </a>
     yudao自带的上传js（修改版）
    </h4>
    <pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> baseUrl<span class="token punctuation">,</span> apiPath<span class="token punctuation">,</span> tenantId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/sheep/config'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/sheep/request'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> FileApi <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 上传文件</span>
  <span class="token function-variable function">uploadFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// TODO 芋艿：访问令牌的接入；</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'上传中'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      uni<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> baseUrl <span class="token operator">+</span> apiPath <span class="token operator">+</span> <span class="token string">'/infra/file/upload'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filePath</span><span class="token operator">:</span> file<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// Accept: 'text/json',</span>
          <span class="token literal-property property">Accept</span><span class="token operator">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
          <span class="token string-property property">'tenant-id'</span><span class="token operator">:</span> tenantId<span class="token punctuation">,</span>
          <span class="token comment">// Authorization:  'Bearer test247',</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">uploadFileRes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>uploadFileRes<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>error <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">title</span><span class="token operator">:</span> result<span class="token punctuation">.</span>msg<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上传失败：'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token function-variable function">uploadFileByFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// !!!!就是这个方法加一下</span>
    <span class="token comment">// TODO 芋艿：访问令牌的接入；</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uni<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'上传中'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      uni<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> baseUrl <span class="token operator">+</span> apiPath <span class="token operator">+</span> <span class="token string">'/infra/file/upload'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">formData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string-property property">'file'</span><span class="token operator">:</span>file
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// Accept: 'text/json',</span>
          <span class="token literal-property property">Accept</span><span class="token operator">:</span> <span class="token string">'*/*'</span><span class="token punctuation">,</span>
          <span class="token string-property property">'tenant-id'</span><span class="token operator">:</span> tenantId<span class="token punctuation">,</span>
          <span class="token comment">// Authorization:  'Bearer test247',</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">uploadFileRes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>uploadFileRes<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>error <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
              <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">title</span><span class="token operator">:</span> result<span class="token punctuation">.</span>msg<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上传失败：'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          uni<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 获取文件预签名地址</span>
  <span class="token function-variable function">getFilePresignedUrl</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/infra/file/presigned-url'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        path<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 创建文件</span>
  <span class="token function-variable function">createFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/infra/file/create'</span><span class="token punctuation">,</span> <span class="token comment">// 请求的 URL</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token comment">// 请求方法</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> data<span class="token punctuation">,</span> <span class="token comment">// 要发送的数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FileApi<span class="token punctuation">;</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f753031343133313631372f:61727469636c652f64657461696c732f313436313738373131" class_="artid" style="display:none">
 </p>
</div>


