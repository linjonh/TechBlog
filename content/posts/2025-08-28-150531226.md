---
layout: post
title: "SpringAIå¿«é€Ÿä¸Šæ‰‹,è¯¦è§£é¡¹ç›®å¿«é€Ÿé›†æˆä¸»æµå¤§æ¨¡å‹DeepSeek,ChatGPT"
date: 2025-08-28T10:15:24+0800
description: "æœ¬æ–‡ä»‹ç»äº†SpringAIæ¡†æ¶åŠå…¶åœ¨Java/Springç”Ÿæ€ä¸­é›†æˆå¤§å‹è¯­è¨€æ¨¡å‹(LLM)çš„åº”ç”¨ã€‚SpringAIä½œä¸ºSpringç”Ÿæ€ä¸‹çš„äººå·¥æ™ºèƒ½å¼€å‘æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–å¼€å‘è€…å¯¹LLMã€å‘é‡æ•°æ®åº“ç­‰AIèƒ½åŠ›çš„é›†æˆï¼Œè§£å†³ä¼ä¸šæ•°æ®ä¸AIæ¨¡å‹çš„è¿æ¥é—®é¢˜ã€‚æ–‡ç« è¯¦ç»†è®²è§£äº†æ ¸å¿ƒæ¦‚å¿µå¦‚æ¨¡å‹ã€LLMã€æç¤ºè¯ã€Tokensç­‰ï¼Œå¹¶æä¾›äº†æ¥å…¥DeepSeekã€ChatGPTç­‰ä¸»æµæ¨¡å‹çš„å®è·µæŒ‡å—ï¼ŒåŒ…æ‹¬ç¯å¢ƒé…ç½®ã€ä»£ç ç¤ºä¾‹å’Œæµ‹è¯•æ–¹æ³•ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†ChatClientçš„é«˜çº§åŠŸèƒ½ã€SSEåè®®å®ç°ä»¥åŠFluxæµå¤„ç†APIçš„ä½¿ç”¨ã€‚é€šè¿‡Spring"
keywords: "ã€SpringAIã€‘å¿«é€Ÿä¸Šæ‰‹ï¼Œè¯¦è§£é¡¹ç›®å¿«é€Ÿé›†æˆä¸»æµå¤§æ¨¡å‹DeepSeek,ChatGPT"
categories: ['å²è¯—èˆ¬çš„Javaæˆç¥ä¹‹è·¯', 'Java']
tags: ['ç¡…åŸºæµåŠ¨', 'æµå¼ç¼–ç¨‹', 'äººå·¥æ™ºèƒ½', 'Sse', 'Springai', 'Flux', 'Deepseek']
artid: "150531226"
arturl: "https://blog.csdn.net/2302_79806056/article/details/150531226"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=150531226
    alt: "SpringAIå¿«é€Ÿä¸Šæ‰‹,è¯¦è§£é¡¹ç›®å¿«é€Ÿé›†æˆä¸»æµå¤§æ¨¡å‹DeepSeek,ChatGPT"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=150531226
featuredImagePreview: https://bing.ee123.net/img/rand?artid=150531226
cover: https://bing.ee123.net/img/rand?artid=150531226
image: https://bing.ee123.net/img/rand?artid=150531226
img: https://bing.ee123.net/img/rand?artid=150531226
---



# ã€SpringAIã€‘å¿«é€Ÿä¸Šæ‰‹ï¼Œè¯¦è§£é¡¹ç›®å¿«é€Ÿé›†æˆä¸»æµå¤§æ¨¡å‹DeepSeek,ChatGPT



![](https://img-blog.csdnimg.cn/direct/2b890d64512e4255b4419b4ec36be3a2.png)

![](https://img-blog.csdnimg.cn/direct/978cee77d6a54aa684bc0ab6be5a4023.png)

Â ğŸ”¥ä¸ªäººä¸»é¡µï¼šÂ [ä¸­è‰è¯](https://blog.csdn.net/2302_79806056?spm=1000.2115.3001.5343 "ä¸­è‰è¯")

Â ğŸ”¥ä¸“æ ï¼š[ã€Javaã€‘ç™»ç¥é•¿é˜¶ å²è¯—èˆ¬çš„Javaæˆç¥ä¹‹è·¯](https://blog.csdn.net/2302_79806056/category_12612415.html?spm=1001.2014.3001.5482 "ã€Javaã€‘ç™»ç¥é•¿é˜¶ å²è¯—èˆ¬çš„Javaæˆç¥ä¹‹è·¯")

---

## SpringAI

[Spring AI](https://spring.io/projects/spring-ai "Spring AI")

![](https://i-blog.csdnimg.cn/direct/6d16ae79125f438cad2cf3d730b90ed6.png)

### **æ¦‚è¿°**

Â Â Â Â Â Â Â Â Spring AI æ˜¯Â **Spring ç”Ÿæ€ä¸‹çš„äººå·¥æ™ºèƒ½åº”ç”¨å¼€å‘æ¡†æ¶**ï¼Œæ—¨åœ¨ç®€åŒ– Java/Spring å¼€å‘è€…å¯¹å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ã€å‘é‡æ•°æ®åº“ç­‰ AI èƒ½åŠ›çš„é›†æˆï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯è§£å†³ â€œä¼ä¸šæ•°æ®ä¸ AI æ¨¡å‹çš„è¿æ¥é—®é¢˜â€ã€‚å®ƒç»§æ‰¿äº† Spring ç”Ÿæ€çš„å¯ç§»æ¤æ€§ã€æ¨¡å—åŒ–è®¾è®¡ç†å¿µï¼Œè®©å¼€å‘è€…èƒ½ä»¥ç†Ÿæ‚‰çš„æ–¹å¼å¿«é€Ÿæ„å»º AI åº”ç”¨ï¼ˆå¦‚æ™ºèƒ½å®¢æœã€æ–‡æ¡£é—®ç­”ã€å†…å®¹ç”Ÿæˆç­‰ï¼‰ã€‚

**æ¨¡å‹**

Â Â Â Â Â Â Â Â æ¨¡å‹æ—¨åœ¨å¤„ç†å’Œç”Ÿæˆä¿¡æ¯çš„ç®—æ³•ï¼Œé€šå¸¸æ¨¡ä»¿äººç±»çš„è®¤çŸ¥åŠŸèƒ½ã€‚é€šè¿‡ä»å¤§å‹æ•°æ®é›†ä¸­å­¦ä¹ æ¨¡å¼å’Œæ´å¯Ÿï¼Œè¿™äº›æ¨¡å‹å¯ä»¥è¿›è¡Œé¢„æµ‹ã€ç”Ÿæˆæ–‡æœ¬ã€å›¾åƒæˆ–å…¶ä»–è¾“å‡ºï¼Œä»è€Œå¢å¼ºå„ä¸ªè¡Œä¸šçš„å„ç§åº”ç”¨ã€‚æ¯”å¦‚ ChatGPTã€æ–‡å¿ƒä¸€è¨€ã€é€šä¹‰åƒé—®ç­‰ç­‰ã€‚æ¯ç§æ¨¡å‹èƒ½åŠ›ä¸åŒï¼Œé€‚åˆçš„ä»»åŠ¡ä¹Ÿä¸åŒã€‚

Â Â Â Â Â Â Â Â å¯ä»¥ç®€å•ç†è§£ä¸ºæ¨¡å‹æ˜¯ä¸€ä¸ª "è¶…çº§åŠ å·¥å‚", è¿™ä¸ªå·¥å‚æ˜¯ç»è¿‡ç‰¹æ®Šè®­ç»ƒçš„ï¼Œè®­ç»ƒå¸ˆç»™å®ƒçœ‹äº†æµ·é‡çš„ä¾‹å­ (æ•°æ®), å¹¶å‘Šè¯‰å®ƒè¯¥æ€ä¹ˆåšã€‚é€šè¿‡çœ‹è¿™äº›ä¾‹å­ï¼Œå®ƒè‡ªå·±æ‘¸ç´¢å‡ºäº†ä¸€å¥—è§„åˆ™ï¼Œå­¦ä¼šäº†å®ŒæˆæŸä¸ª "ç‰¹å®šä»»åŠ¡". æ¨¡å‹å°±æ˜¯ä¸€å¥—å­¦åˆ°çš„ "è§„åˆ™" æˆ–è€… "æ¨¡å¼", å®ƒèƒ½æ ¹æ®ä½ ç»™çš„ä¸œè¥¿ï¼Œäº§ç”Ÿä½ æƒ³è¦çš„ä¸œè¥¿ã€‚

Â  Â  Â  Â  ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ AI é¢†åŸŸï¼Œ**æ¨¡å‹**æ˜¯é€šè¿‡è®­ç»ƒæ•°æ®å­¦ä¹ æ¨¡å¼çš„ç®—æ³•é›†åˆï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯å°†è¾“å…¥è½¬åŒ–ä¸ºæœ‰æ„ä¹‰çš„è¾“å‡ºã€‚

Spring AIçš„ä½œç”¨å°±æ˜¯è®©æˆ‘ä»¬åœ¨java/springçš„åº”ç”¨ä¹‹ä¸­ï¼Œèƒ½éå¸¸æ–¹ä¾¿åœ°å»é€‰æ‹©ä¸åŒçš„æ¨¡å‹ï¼Œæ„é€ å’Œå‘é€è¾“å…¥ï¼Œæ¥å—å¹¶å¤„ç†è¾“å‡º

**LLM**

**LLM (Large Language Model), å¤§è¯­è¨€æ¨¡å‹**ï¼Œä¹Ÿç§°å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œæ˜¯äººå·¥æ™ºèƒ½æ¨¡å‹ä¸­ä¸“é—¨å¤„ç†æ–‡æœ¬çš„ä¸€ç§ç±»å‹ï¼Œå±äºè¯­è¨€æ¨¡å‹çš„èŒƒç•´. LLM çš„ç‰¹ç‚¹æ˜¯è§„æ¨¡åºå¤§ï¼ŒåŒ…å«æ•°åäº¿çš„å‚æ•°ï¼Œåœ¨å¤§é‡çš„æ–‡æœ¬æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå­¦ä¹ è¯­è¨€æ•°æ®ä¸­çš„å¤æ‚æ¨¡å¼ï¼Œæ—¨åœ¨ç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€ã€‚å¯ä»¥æ‰§è¡Œå¹¿æ³›çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ–‡æœ¬æ€»ç»“ã€ç¿»è¯‘ã€æƒ…æ„Ÿåˆ†æç­‰.

ç®€å•ä»‹ç»å‡ ç§ç›®å‰ä¸»æµçš„å¤§è¯­è¨€æ¨¡å‹ (LLM) .

* GPT-5(OpenAI)  
   â—‹ æ”¯æŒ 128K é•¿ä¸Šä¸‹æ–‡ï¼Œåœ¨å¤šè½®å¤æ‚æ¨ç†ã€åˆ›æ„å†™ä½œä¸­è¡¨ç°çªå‡º
* DeepSeek R1 (æ·±åº¦æ±‚ç´¢)  
   â—‹ å¼€æºï¼Œä¸“æ³¨äºé€»è¾‘æ¨ç†ä¸æ•°å­¦æ±‚è§£ï¼Œæ”¯æŒ 128K é•¿ä¸Šä¸‹æ–‡å’Œå¤šè¯­è¨€ (20 + è¯­è¨€), åœ¨ç§‘æŠ€é¢†åŸŸè¡¨ç°çªå‡º
* Qwen2.5-72B-Instruct (é˜¿é‡Œå·´å·´)  
   â—‹ é€šä¹‰åƒé—®å¼€æºæ¨¡å‹å®¶æ—é‡è¦æˆå‘˜ï¼Œæ“…é•¿ä»£ç ç”Ÿæˆç»“æ„åŒ–æ•°æ® (å¦‚ JSON) å¤„ç†è§’è‰²æ‰®æ¼”å¯¹è¯ç­‰ï¼Œå°¤å…¶é€‚åˆä¼ä¸šçº§å¤æ‚ä»»åŠ¡ï¼Œæ”¯æŒåŒ…æ‹¬ä¸­æ–‡è‹±æ–‡æ³•è¯­ç­‰ 29 ç§è¯­è¨€
* Gemini 2.5 Pro (Google)  
   â—‹ å¤šæ¨¡æ€èåˆæ ‡æ†ï¼Œæ”¯æŒå›¾åƒ / ä»£ç  / æ–‡æœ¬æ··åˆè¾“å…¥ï¼Œé€‚åˆè·¨æ¨¡æ€ä»»åŠ¡ (å¦‚å›¾æ–‡ç”Ÿæˆã€æŠ€æœ¯æ–‡æ¡£è§£æ)

**æç¤ºè¯**

Â Â Â Â Â Â Â Â æç¤ºè¯æ˜¯ç”¨æˆ·æˆ–ç³»ç»Ÿæä¾›ç»™å¤§è¯­è¨€æ¨¡å‹ (LLM) çš„æŒ‡ä»¤æˆ–æ–‡æœ¬ï¼Œç”¨äºå¼•å¯¼æ¨¡å‹ç”Ÿæˆç‰¹å®šè¾“å‡ºã€‚å¯ä»¥ç†è§£ä¸ºæ¨¡å‹çš„è¾“å…¥ï¼Œæ— è®ºæ˜¯ä¸€ä¸ªå•è¯ã€ä¸€ä¸ªé—®é¢˜ã€ä¸€æ®µæè¿°ï¼Œè¿˜æ˜¯ç»“æ„åŒ–æŒ‡ä»¤ï¼Œéƒ½å¯è§†ä¸ºæç¤ºè¯.

Â Â Â Â Â Â Â Â æç¤ºè¯æœ€åˆæ˜¯ä¸ºå¼•å¯¼å¤§è¯­è¨€æ¨¡å‹ (å¦‚ GPTã€Claude ç­‰) è€Œè®¾è®¡çš„ï¼Œä½†å…¶æ ¸å¿ƒé€»è¾‘ (é€šè¿‡ç»“æ„åŒ–è¾“å…¥æ§åˆ¶è¾“å‡º) å¯æ³›åŒ–åˆ°è®¸å¤šå…¶ä»–åœºæ™¯.

Â Â Â Â Â Â Â Â æ¯”å¦‚å¤šæ¨¡æ€ç³»ç»Ÿçš„æ··åˆè¾“å…¥ï¼Œå½“å¤§æ¨¡å‹å¤„ç†å›¾åƒã€éŸ³é¢‘æ—¶ï¼Œè‡ªç„¶è¯­è¨€æç¤ºè¯éœ€ä¸å…¶ä»–æ¨¡æ€æ•°æ®ååŒè¾“å…¥ï¼Œè¾“å…¥è®¾è®¡è‰å›¾ + æ–‡å­—ï¼Œæç¤ºè¯ä¸º: "ç”Ÿæˆç½‘é¡µå‰ç«¯ä»£ç "

ä»å·¥ç¨‹è§†è§’æ¥çœ‹ï¼Œæç¤ºè¯åˆ†ä¸ºç”¨æˆ·æç¤ºè¯å’Œç³»ç»Ÿæç¤ºè¯

| **ç±»å‹** | **å®šä¹‰** | **æ ¸å¿ƒåŠŸèƒ½** | **ç¤ºä¾‹** |
| --- | --- | --- | --- |
| ç”¨æˆ·æç¤ºè¯ | ç”±ç»ˆç«¯ç”¨æˆ·ç›´æ¥è¾“å…¥ï¼Œè§¦å‘å•æ¬¡ä»»åŠ¡ | ä¼ è¾¾å³æ—¶éœ€æ±‚ï¼ˆå¦‚æé—®ã€åˆ›ä½œæŒ‡ä»¤ï¼‰ | ç”¨æˆ·è¾“å…¥ï¼š"æ€»ç»“è¿™ç¯‡è®ºæ–‡çš„æ ¸å¿ƒè§‚ç‚¹" |
| ç³»ç»Ÿæç¤ºè¯ | ç”±å¼€å‘è€…é¢„è®¾ï¼ŒåµŒå…¥ç³»ç»Ÿåç«¯ | å®šä¹‰æ¨¡å‹è§’è‰²ã€è¡Œä¸ºè§„èŒƒã€çŸ¥è¯†è¾¹ç•Œ | é¢„è®¾ï¼š"ä½ æ˜¯ä¸€åä¸¥è°¨çš„å­¦æœ¯åŠ©æ‰‹ï¼Œå›ç­”éœ€å¼•ç”¨æƒå¨æ–‡çŒ® |

**Tokensï¼ˆè¯åŸï¼‰**

Â  Â  Â  Â  Tokens æ˜¯ LLM å¤„ç†æ–‡æœ¬æ—¶çš„æœ€å°è¯­ä¹‰å•ä½ï¼Œç”¨äºå°†æ–‡æœ¬æ‹†è§£ä¸ºæ¨¡å‹å¯ç†è§£çš„ç¦»æ•£å•å…ƒã€‚è¯å…ƒé€šè¿‡åˆ†è¯å™¨å°†æ–‡æœ¬æ‹†åˆ†è€Œæ¥ï¼Œä¸åŒæ¨¡å‹çš„åˆ†è¯è§„åˆ™ä¸åŒï¼ŒåŒä¸€ä¸ªè¯åœ¨ä¸åŒæ¨¡å‹ä¸­å¯èƒ½è¢«æ‹†åˆ†æˆä¸åŒè¯å…ƒã€‚

Â Â Â Â Â Â Â Â æ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£ (å¦‚ 128K) å®é™…æ˜¯è¯å…ƒæ•°é‡é™åˆ¶ï¼ŒAPI æ”¶è´¹é€šå¸¸æŒ‰è¯å…ƒæ•°è®¡è´¹ (è¯å…ƒ = é‡‘é’±)ï¼Œè¯å…ƒæ•°è¶Šå¤šï¼Œè®¡ç®—è€—æ—¶å’Œå†…å­˜å ç”¨è¶Šé«˜ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨æ—¶ï¼Œåº”å°½é‡é¿å…å†—ä½™è¯ (å¦‚è¯·ï¼Œè°¢è°¢)

---

### æ¥å…¥deepseek

ç¯å¢ƒè¦æ±‚ï¼š

JDKï¼šæœ€ä½è¦æ±‚-JDK 17+ï¼ˆSpring Boot 3.x çš„å¼ºåˆ¶è¦æ±‚ï¼‰

Spring Bootï¼šæœ€ä½è¦æ±‚ Spring Boot 3.2+ ï¼ˆSpring AI 1.0.0 èµ·å¼ºåˆ¶ä¾èµ–ï¼‰æ¨èï¼š3.4.xï¼ˆæœ€æ–°ç¨³å®šç‰ˆï¼‰3.3.xï¼ˆéƒ¨åˆ†æ—§é¡¹ç›®å…¼å®¹æ–¹æ¡ˆï¼‰

**APIè·å–**

[DeepSeek å¼€æ”¾å¹³å°](https://platform.deepseek.com/api_keys "DeepSeek å¼€æ”¾å¹³å°")

è¿™æ˜¯deepseekå¼€æ”¾å¹³å°ï¼Œå¯ä»¥åœ¨è¿™é‡Œè·å–API key

![](https://i-blog.csdnimg.cn/direct/6f8fd0de592a4068a332db29c33a2d68.png)

**pom**

```
<dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-bom</artifactId>
                <version>1.0.0-M6</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-openai-spring-boot-starter</artifactId>
        </dependency>
    </dependencies>
```

**yml**

```
spring:
  application:
    name: spring-ai-module
  ai:
    openai:
      api-key: sk-ae299ca6f4c9431ab4f3d0dd40b682f7
      base-url: https://api.deepseek.com
      chat:
        options:
          model: deepseek-chat
          temperature: 0.7  #ç”¨äºæ§åˆ¶ç”Ÿæˆè¡¥å…¨å†…å®¹çš„å¤šæ ·æ€§ï¼Œå€¼è¶Šå¥½ï¼Œè¾“å‡ºè¶Šéšæœº


```

**Controller**

```
@RestController
@RequestMapping("/ds")
public class DeepSeekController {
    @Autowired
    private OpenAiChatModel model;

    @RequestMapping("/chat")
    public String chat(String message) {
        return model.call(message);
    }
}

```

**æµ‹è¯•ç»“æœ**

![](https://i-blog.csdnimg.cn/direct/0e72f7eb130944489718be3fb21c1529.png)

### æ¥å…¥ChatGPT

ç¯å¢ƒå‡†å¤‡å’ŒControllerä¸Šè¿°DeepSeekä¸€è‡´ï¼ˆDeepSeekå»å…¼å®¹äº†openaiï¼‰

[OpenAI Platform](https://platform.openai.com/docs_ "OpenAI Platform")

æ³¨å†Œè´¦å·

**yml**

```
spring:
  application:
    name: spring-ai-module
  ai:
    openai:
      api-key: your-key

```

base-urlé»˜è®¤å°±æ˜¯https://api.openai.com

**æ³¨æ„**

æœ¬åœ°å¼€å‘æ—¶ï¼Œå³ä½¿é…ç½®äº†ä»£ç†ï¼Œä¹Ÿæœ‰å¯èƒ½æ— æ³•è®©æ•´ä¸ªç³»ç»Ÿå…¨å±€ä»£ç†ï¼Œä¸ºæ­¤å¯åŠ¨ç±»åŠ ä¸Šå¦‚ä¸‹ä»£ç ï¼Œé…ç½®ä»£ç†ipä¸port

```
System.setProperty("http.proxyHost","127.0.0.1");
System.setProperty("https.proxyHost","127.0.0.1");
System.setProperty("http.proxyPort","7890");
System.setProperty("https.proxyPort","7890");
```

**æµ‹è¯•**

![](https://i-blog.csdnimg.cn/direct/0f4375bf853c449b86838c3b85bbce7a.png)

æ¥å…¥æˆåŠŸ

---

## SpringAI+SiliconFlow(æ¨è-æœ‰å…è´¹èµ é¢)

### ç¡…åŸºæµåŠ¨ SiliconFlow

è¿™é‡Œå…ˆæ¥ä»‹ç»ä¸€ä¸‹ï¼Œ**ç¡…åŸºæµåŠ¨ï¼ˆSiliconFlowï¼‰**æ˜¯åŒ—äº¬ç¡…åŸºæµåŠ¨ç§‘æŠ€æœ‰é™å…¬å¸æ——ä¸‹çš„ AI åŸºç¡€è®¾æ–½å“ç‰Œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸€ç«™å¼å¤§æ¨¡å‹äº‘æœåŠ¡å¹³å°ï¼Œé›†æˆäº† Qwenã€DeepSeekã€Llama3 ç­‰ä¸»æµå¼€æºæ¨¡å‹ï¼Œæä¾›ä»æ¨¡å‹è®­ç»ƒã€å¾®è°ƒåˆ°æ¨ç†éƒ¨ç½²çš„å…¨é“¾è·¯æœåŠ¡ã€‚ç”¨æˆ·å¯é€šè¿‡ API è°ƒç”¨å¿«é€Ÿæ¥å…¥æ¨¡å‹ï¼Œä¾‹å¦‚æ–‡æœ¬ç”Ÿæˆã€å›¾åƒç”Ÿæˆã€è§†é¢‘ç”Ÿæˆç­‰å¤šæ¨¡æ€ä»»åŠ¡ï¼Œæ—¥å‡è°ƒç”¨é‡å·²çªç ´åƒäº¿ Tokenã€‚å¹³å°è¿˜æ”¯æŒä¼ä¸šçº§æ¨¡å‹å¾®è°ƒä¸æ‰˜ç®¡ï¼Œå¸®åŠ©å¼€å‘è€…å®ç° â€œToken è‡ªç”±â€ï¼ˆå³ä½æˆæœ¬ã€é«˜å¼¹æ€§çš„æ¨¡å‹ä½¿ç”¨ï¼‰ã€‚

![](https://i-blog.csdnimg.cn/direct/8c031439832e421282027bbc4179695f.png)

ç®€è€Œè¨€ä¹‹ï¼Œå…¶æ ¸å¿ƒå®šä½æ˜¯**å¤§æ¨¡å‹æ—¶ä»£çš„ AI åŸºç¡€è®¾æ–½å±‚ï¼ˆAI Infraï¼‰ï¼Œæ˜¯é«˜æ€§èƒ½çš„å›½äº§AIæ¨¡å‹å¹³å°**

### SpringAI+ç¡…åŸºæµåŠ¨

Spring AI æ˜¯ä¸€ä¸ªç”¨äº AI å·¥ç¨‹çš„åº”ç”¨æ¡†æ¶ã€‚å…¶ç›®æ ‡æ˜¯å°†å¯ç§»æ¤æ€§å’Œæ¨¡å—åŒ–è®¾è®¡ç­‰ Spring ç”Ÿæ€ç³»ç»Ÿè®¾è®¡åŸåˆ™åº”ç”¨äº AI é¢†åŸŸï¼Œå¹¶æ¨å¹¿ä½¿ç”¨ POJO ä½œä¸ºåº”ç”¨ç¨‹åºçš„æ„å»ºå—åˆ° AI é¢†åŸŸã€‚

åœ¨è®²å®æ“å‰ï¼Œå…ˆæ˜ç¡®è¿™å¯¹ç»„åˆçš„æ ¸å¿ƒä»·å€¼ â€”â€”**SpringAI è§£å†³ â€œæ ‡å‡†åŒ–â€ï¼Œç¡…åŸºæµåŠ¨è§£å†³ â€œä¸­é—´ä»¶èƒ½åŠ›â€**ï¼ŒäºŒè€…äº’è¡¥åˆšå¥½ç ´è§£ä¼ ç»Ÿé›†æˆçš„ 3 å¤§ç—›ç‚¹ï¼šâ€‹

|  |  |  |
| --- | --- | --- |
| ä¼ ç»Ÿå¤§æ¨¡å‹é›†æˆç—›ç‚¹ | SpringAI çš„è§£å†³æ–¹å¼ | ç¡…åŸºæµåŠ¨çš„è¡¥å……ä»·å€¼ |
| å¤šæ¨¡å‹æ¥å£ä¸ç»Ÿä¸€ï¼Œé€‚é…æˆæœ¬é«˜ | æä¾›æ ‡å‡†åŒ–Modelæ¥å£ï¼Œå°è£…ä¸åŒæ¨¡å‹çš„è°ƒç”¨é€»è¾‘ï¼Œåˆ‡æ¢æ¨¡å‹æ— éœ€æ”¹ä¸šåŠ¡ä»£ç  | å†…ç½®ä¸»æµå¤§æ¨¡å‹ï¼ˆGPTã€æ–‡å¿ƒã€é€šä¹‰ç­‰ï¼‰çš„é€‚é…èƒ½åŠ›ï¼ŒSpringAI åªéœ€å¯¹æ¥ç¡…åŸºæµåŠ¨ï¼Œæ— éœ€é€ä¸ªå¯¹æ¥æ¨¡å‹å‚å•† |
| é…ç½®ç¹çï¼Œç¯å¢ƒä¾èµ–å¤æ‚ | åŸºäº Spring Boot è‡ªåŠ¨é…ç½®ï¼Œç®€åŒ–å‚æ•°é…ç½® | æä¾›ç»Ÿä¸€çš„ API å¯†é’¥ã€æ¨¡å‹ç‰ˆæœ¬ç®¡ç†ï¼Œæ”¯æŒæœ¬åœ°è°ƒè¯• / äº‘ç«¯éƒ¨ç½²æ— ç¼åˆ‡æ¢ |
| ç”Ÿäº§çº§éœ€æ±‚éš¾æ»¡è¶³ï¼ˆé™æµã€é‡è¯•ã€ç›‘æ§ï¼‰ | ä¾èµ– Spring ç”Ÿæ€çš„é‡è¯•ã€ç¼“å­˜ç»„ä»¶ï¼Œä½†éœ€æ‰‹åŠ¨é›†æˆ | åŸç”Ÿæ”¯æŒè¯·æ±‚é™æµã€å¤±è´¥é‡è¯•ã€è°ƒç”¨æ—¥å¿—ç›‘æ§ï¼Œæ— éœ€é¢å¤–å¼€å‘ |

### **ç¯å¢ƒå‡†å¤‡**

JDK 17+ï¼ˆSpring AI 0.8+ æœ€ä½è¦æ±‚ï¼‰â€‹

Spring Boot 3.2+ï¼ˆå»ºè®®ç”¨æœ€æ–°ç¨³å®šç‰ˆï¼‰â€‹

ç¡…åŸºæµåŠ¨è´¦å·

[ç¡…åŸºæµåŠ¨ç”¨æˆ·ç³»ç»Ÿï¼Œç»Ÿä¸€ç™»å½• SSO](https://cloud.siliconflow.cn/i/gvYC1Tje "ç¡…åŸºæµåŠ¨ç”¨æˆ·ç³»ç»Ÿï¼Œç»Ÿä¸€ç™»å½• SSO")

å¤§å®¶å¯ä»¥è‡ªè¡Œå®˜ç½‘æ³¨å†Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥å’Œé‚€è¯·ç æ³¨å†Œï¼Œè¿™æ ·å¯ä»¥åœ¨åŸå…ˆçš„åŸºç¡€ä¸Šé¢å¤–èµ é€7å—é’±é¢åº¦ï¼Œè¿™æ˜¯æˆ‘çš„é‚€è¯·ç ï¼š**gvYC1Tje**

**è·å–API Keyï¼ˆéœ€è¦å……å€¼ï¼‰**

![](https://i-blog.csdnimg.cn/direct/3669f840da23422b9689a8440648a7fe.png)

![](https://i-blog.csdnimg.cn/direct/b2178d1c3c2740ce81da82ce29dfe08e.png)

æ³¨æ„ä¸è¦æ³„æ¼ä½ çš„API Key

### å¿«é€Ÿä¸Šæ‰‹

åœ¨pom.xmlä¸­å¼•å…¥ Spring AI æ ¸å¿ƒä¾èµ–ï¼ˆSpring AI å·²å®˜æ–¹å…¼å®¹ç¡…åŸºæµåŠ¨ï¼Œæ— éœ€è‡ªå®šä¹‰é€‚é…ï¼‰

```
 <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-bom</artifactId>
                <version>1.0.0-M6</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <version>3.5.4</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
            <version>3.5.4</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-openai-spring-boot-starter</artifactId>
        </dependency>
    </dependencies>
```

é…ç½®æ–‡ä»¶

```
spring:
  application:
    name: spring-ai-siliconcloud
  ai:
    openai:
      api-key: your-key
      base-url: https://api.siliconflow.cn/

```

åˆ›å»ºController

å¦‚æœè¦åœ¨åˆå§‹åŒ–ChatClientä¸­ç¡®å®šæ¨¡å‹ï¼Œæ³¨æ„è¦å†™å…¨ç§°

```
@RestController
@RequestMapping("sf")
public class DeepSeekController {
    private final ChatClient chatClient;

    public DeepSeekController(ChatClient.Builder builder) {
        this.chatClient  = builder
                .defaultSystem("ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå›ç­”éœ€ç®€æ´å‡†ç¡®")
                .defaultOptions(OpenAiChatOptions.builder()
                        //å¯ä»¥å†™åœ¨ymlæ–‡ä»¶
                        .model("Pro/deepseek-ai/DeepSeek-R1-Distill-Qwen-7B")
                        .build())
                .build();
    }

    @GetMapping("/chat")
    public String chat(@RequestParam(name = "message") String message) {
        // ä½¿ç”¨prompt()æ–¹æ³•æ›¿ä»£call()ï¼Œé€šè¿‡UserMessageä¼ é€’ç”¨æˆ·è¾“å…¥
        ChatResponse response = chatClient.prompt()
                .messages(new UserMessage(message))
                .call()
                .chatResponse();

        // æå–å¹¶è¿”å›æ¨¡å‹çš„å›ç­”å†…å®¹
        return response.getResult().getOutput().getText();
    }
}

```

æµ‹è¯•ç»“æœ

![](https://i-blog.csdnimg.cn/direct/e925cac3f42848e282f8ef339f13691f.png)

## ChatClient

`ChatClient`æ˜¯ Spring AI æä¾›çš„**é«˜å±‚å®¢æˆ·ç«¯**ï¼Œå®ƒå°è£…äº†`ChatModel`ï¼Œæä¾›äº†æ›´ç®€æ´ã€æ›´ç¬¦åˆ Spring é£æ ¼çš„ APIï¼Œæ—¨åœ¨é™ä½å¼€å‘è€…çš„ä½¿ç”¨é—¨æ§›ã€‚å®ƒæä¾›äº†ä¸AIæ¨¡å‹é€šä¿¡çš„Fluent APIï¼Œå®ƒæ”¯æŒåŒæ­¥å’Œååº”å¼çš„ç¼–ç¨‹æ¨¡å‹ã€‚

**Controller**

```
@RestController
@RequestMapping("/cc")
public class ChatClientController {
    private final ChatClient chatClient;

    public ChatClientController(ChatClient.Builder chatClientBuilder) {
        this.chatClient = chatClientBuilder.build();
    }

    @GetMapping("/ai")
    public String generation(String userInput) {
        return this.chatClient.prompt()
                //ç”¨æˆ·è¾“å…¥ 
                .user(userInput)
                .call()
                .content();
    }
}

```

### **è§’è‰²é¢„è®¾**

```
public ChatClientController(ChatClient.Builder chatClientBuilder) {
        this.chatClient = chatClientBuilder
                .defaultSystem("ä½ æ˜¯ä¸€åèµ„æ·±çš„Javaåç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œåå­—å«ç‰›ç‰›")
                .build();
    }
```

è§’è‰²é¢„è®¾å‰å

![](https://i-blog.csdnimg.cn/direct/d78261fba0834870afcbb07f7f102cfc.png)

![](https://i-blog.csdnimg.cn/direct/34459458908d4ce597c9795ebcb2c5d1.png)

### **ç»“æ„åŒ–è¾“å‡º**

é€šè¿‡Entity()æ–¹æ³•å°†æ¨¡å‹è¾“å‡ºè½¬ä¸ºè‡ªå®šä¹‰å®ä½“ï¼Œç¡®ä¿è¾“å‡ºæ ¼å¼æ»¡è¶³Json

å€ŸåŠ©jdk16é‡Œçš„recordæ¥ä¾¿æ·å®ç°

```
record QuestionList(String topic, List<String> questionList) {}

@RequestMapping("/entity")
public String entity(String userInput) {
    QuestionList entity = chatClient.prompt()
                .user(String.format("è¯·å¸®æˆ‘æ‰¾åˆ°å­¦ä¹ %sç®—æ³•çš„leetcodeçš„é¢˜ç›®", userInput))
                .call()
                .entity(QuestionList.class);
    return entity.toString();
}
```

![](https://i-blog.csdnimg.cn/direct/eb04bdda00874d49b487115535c14919.png)

### å®ç°æµå¼è¾“å‡º

ä¸ºäº†ä¼˜åŒ–ä½“éªŒï¼Œå¯ä»¥é‡‡ç”¨æµå¼è¾“å‡ºçš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ï¼ˆç±»ä¼¼äºdeepseekï¼Œè±†åŒ…çš„å½¢å¼ï¼‰

å¤§æ¨¡å‹æµå¼è¾“å‡ºï¼ˆStreaming Outputï¼‰æœ€é€‚åˆé€æ­¥ç”Ÿæˆå†…å®¹è€Œéä¸€æ¬¡æ€§è¿”å›å®Œæ•´ç»“æœçš„åœºæ™¯ã€‚Spring AI ä½¿ç”¨ ChatClient çš„ stream () æ–¹æ³•ç”Ÿæˆ Flux<String> æµï¼Œé€‚ç”¨äºéœ€è¦æŒç»­æ‹‰å–å®¢æˆ·è¾“å…¥çš„ AI åœºæ™¯

```
@RequestMapping(value = "/stream",produces = "text/html;charset=utf-8")
    public Flux<String> stream(String userInput) {
        return this.chatClient.prompt()
                .user(userInput)
                .stream()
                .content();
    }
```

æ³¨æ„è®¾ç½®é¡µé¢ç¼–ç ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šè¾“å‡ºä¹±ç 

### æ—¥å¿—æ‰“å°

**Advisors**

Â Â Â Â Â Â Â Â Spring AI ä¸­çš„ **Advisors** æ˜¯ä»‹äºç”¨æˆ·è¯·æ±‚ä¸ AI æ¨¡å‹ä¹‹é—´çš„ä¸­é—´ä»¶ç»„ä»¶ï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªè¿‡æ»¤å’Œå¢å¼ºã€‚å¸®åŠ©æˆ‘ä»¬åœ¨ API è°ƒç”¨å‰åè§£å†³å„ç§é—®é¢˜ï¼Œä¾‹å¦‚è°ƒç”¨å‰å‚æ•°å¦‚ä½•æ„å»ºï¼Œè°ƒç”¨åç»“æœå¦‚ä½•å¤„ç†ã€‚

Â Â Â Â Â Â Â Â Spring AI ä¸­çš„ Advisors æ˜¯åŸºäº AOP æ€æƒ³å®ç°çš„ï¼Œåœ¨å…·ä½“å®ç°ä¸Šè¿›è¡Œäº†é¢†åŸŸé€‚é…ã€‚å…¶è®¾è®¡æ ¸å¿ƒå€Ÿé‰´äº† Spring AOP çš„æ‹¦æˆªæœºåˆ¶ï¼Œå„ä¸ª Advisors ä»¥é“¾å¼ç»“æ„è¿è¡Œï¼Œåºåˆ—ä¸­çš„å„ä¸ª Advisor éƒ½æœ‰æœºä¼šå¯¹ä¼ å…¥çš„è¯·æ±‚å’Œä¼ å‡ºçš„å“åº”è¿›è¡Œå¤„ç†ã€‚è¿™ç§é“¾å¼å¤„ç†æœºåˆ¶ç¡®ä¿äº†æ¯ä¸ª Advisor å¯ä»¥åœ¨è¯·æ±‚å’Œå“åº”æµç¨‹ä¸­Â **æ’å…¥è‡ªå·±çš„é€»è¾‘**ï¼Œä»è€Œå®ç°æ›´çµæ´»å’Œå¯å®šåˆ¶çš„åŠŸèƒ½ã€‚

![](https://i-blog.csdnimg.cn/direct/7a884b31af6c408eab964327d7691ada.png)

**åº”ç”¨åœºæ™¯**

* æ•æ„Ÿè¯è¿‡æ»¤
* å»ºç«‹èŠå¤©å†å²
* å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†

**SimpleLoggerAdvisor**

æ·»åŠ è¿™ä¸ªadvisorï¼Œæ¥å®ç°æ—¥å¿—æ‰“å°

```
@Configuration
public class ChatClientConfiguration {
    @Bean
    public ChatClient chatClient(ChatClient.Builder chatClientBuilder) {
        return chatClientBuilder
                .defaultSystem("ä½ å«ç‰›ç‰›ï¼Œæ˜¯ä¸€åèµ„æ·±çš„Javaåç«¯å¼€å‘å·¥ç¨‹å¸ˆ")
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .build();
    }
}

```

yml

```
logging:
  pattern:
    console: '%d{HH:mm:ss:SSS} %c %M %L [%Thread] %m%n'
    file: '%d{HH:mm:ss:SSS} %c %M %L [%Thread] %m%n'
  level:
    org.springframework.ai.chat.client.advisor: debug
```

å®ç°æ•ˆæœ

![](https://i-blog.csdnimg.cn/direct/aa5eeecfd15b4d2798045b91e6b09db6.png)

### ä¸ChatModelçš„åŒºåˆ«

ChatClient å’Œ ChatModel æ˜¯ Spring AI æ¡†æ¶æä¾›çš„ä¸å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’çš„ä¸¤å¤§æ ¸å¿ƒæ¥å£ï¼Œä½†äºŒè€…è®¾è®¡ç†å¿µå’Œé€‚ç”¨åœºæ™¯ä¸å¤ªä¸€æ ·ã€‚

* **ChatModel**Â æ˜¯ Spring AI æ¡†æ¶ä¸­çš„**åº•å±‚æ¥å£**ï¼Œç›´æ¥ä¸å…·ä½“çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚é€šä¹‰åƒé—®ã€OpenAIï¼‰äº¤äº’ï¼Œæä¾›åŸºç¡€çš„Â `call`Â å’ŒÂ `stream`Â æ–¹æ³•ã€‚å¼€å‘è€…éœ€**æ‰‹åŠ¨å¤„ç†æç¤ºè¯ç»„ã€å‚æ•°é…ç½®å’Œå“åº”è§£æ**ç­‰ç»†èŠ‚ï¼Œåœ¨ä½¿ç”¨ä¸Šç›¸å¯¹æ›´åŠ çµæ´»ã€‚
* **ChatClient**Â å¯¹ ChatModel è¿›è¡Œäº†**å°è£…**ï¼Œç›¸æ¯” ChatModel åŸå­ç±» APIï¼ŒChatClient å±è”½äº†ä¸ AI å¤§æ¨¡å‹äº¤äº’çš„å¤æ‚æ€§ï¼Œè‡ªåŠ¨é›†æˆÂ **æç¤ºè¯ç®¡ç†ã€å“åº”æ ¼å¼åŒ–ã€ç»“æ„åŒ–è¾“å‡ºæ˜ å°„**Â ç­‰èƒ½åŠ›ï¼Œå¤§å¹…æé«˜å¼€å‘æ•ˆç‡ã€‚

ChatModel ç¤ºä¾‹ä»£ç ï¼ˆæ‰‹åŠ¨å¤„ç†äº¤äº’ï¼‰

```
ChatResponse response = openAiChatModel.call(new Prompt(message));
return response.getResult().getOutput().getText();

```

ChatClient ç¤ºä¾‹ä»£ç ï¼ˆå°è£…åç®€åŒ–äº¤äº’ï¼‰

```
Recipe recipe = this.chatClient.prompt()
        // ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ï¼ˆæç¤ºè¯ç»„è£…ï¼‰
        .user(String.format("è¯·å¸®æˆ‘ç”Ÿæˆ%sçš„é£Ÿè°±", userInput))
        // å‘èµ·å¤§æ¨¡å‹è¯·æ±‚
        .call()
        // å“åº”æ˜ å°„ä¸º Recipe å®ä½“ç±»ï¼ˆç»“æ„åŒ–è¾“å‡ºï¼‰
        .entity(Recipe.class);
```

| ç»´åº¦ | ChatModel | ChatClient |
| --- | --- | --- |
| äº¤äº’æ–¹å¼ | æ‰‹åŠ¨æ„å»º Promptï¼Œè§£æå“åº” | é“¾å¼ APIï¼Œè‡ªåŠ¨å°è£…è¯·æ±‚ä¸å“åº” |
| ç»“æ„åŒ–è¾“å‡º | æ‰‹åŠ¨è§£ææ–‡æœ¬ | æ”¯æŒÂ `.entity(Class)`Â è‡ªåŠ¨æ˜ å°„ POJO |
| æ‰©å±•èƒ½åŠ› | ä¾èµ–å¤–éƒ¨ç»„ä»¶ | å†…ç½® Advisor æœºåˆ¶ï¼Œæä¾›æ›´é«˜çº§åŠŸèƒ½ï¼ˆå¦‚ä¸Šä¸‹æ–‡è®°å¿†ã€RAG ç­‰ï¼‰ |
| é€‚åˆåœºæ™¯ | é€‚åˆç²¾ç»†æ§åˆ¶æ¨¡å‹å‚æ•°çš„åœºæ™¯ï¼ˆå¦‚æ¨¡å‹å®éªŒã€å‚æ•°è°ƒä¼˜ï¼‰ | é€‚åˆå¿«é€Ÿæ„å»º AI æœåŠ¡ï¼ˆå¦‚å¸¦è®°å¿†çš„å®¢æœç³»ç»Ÿï¼‰ |

## æµå¼ç¼–ç¨‹

### SSEåè®®

Â Â Â Â Â Â Â Â HTTP åè®®æœ¬èº«è®¾è®¡ä¸ºæ— çŠ¶æ€çš„è¯·æ±‚ - å“åº”æ¨¡å¼ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œæ˜¯æ— æ³•åšåˆ°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯ï¼Œä½†é€šè¿‡ Server-Sent Eventsï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼Œç®€ç§° SSEï¼‰æŠ€æœ¯**å¯å®ç°æµå¼ä¼ è¾“ï¼Œå…è®¸æœåŠ¡å™¨ä¸»åŠ¨å‘æµè§ˆå™¨æ¨é€æ•°æ®æµã€‚**

Â Â Â Â Â Â Â Â ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å£°æ˜ï¼Œæ¥ä¸‹æ¥è¦å‘é€çš„æ˜¯æµæ¶ˆæ¯ (streaming)ï¼Œè¿™æ—¶å®¢æˆ·ç«¯ä¸ä¼šå…³é—­è¿æ¥ï¼Œä¼šä¸€ç›´ç­‰å¾…æœåŠ¡å™¨å‘é€è¿‡æ¥çš„æ–°çš„æ•°æ®æµã€‚

Â Â Â Â Â Â Â Â SSEï¼ˆServer-Sent Eventsï¼‰æ˜¯ä¸€ç§åŸºäº HTTP çš„è½»é‡çº§å®æ—¶é€šä¿¡åè®®ï¼Œæµè§ˆå™¨é€šè¿‡å†…ç½®çš„ EventSource API æ¥æ”¶å¹¶å¤„ç†è¿™äº›å®æ—¶äº‹ä»¶ã€‚

![](https://i-blog.csdnimg.cn/direct/178b6d49cd1d42b28df05de262128655.png)

**æ ¸å¿ƒç‰¹ç‚¹**

* **åŸºäº HTTP åè®®**  
   å¤ç”¨æ ‡å‡† HTTP/HTTPS åè®®ï¼Œæ— éœ€é¢å¤–ç«¯å£æˆ–åè®®ï¼Œå…¼å®¹æ€§å¥½ä¸”æ˜“äºéƒ¨ç½²ã€‚
* **å•å‘é€šä¿¡æœºåˆ¶**  
   SSE ä»…æ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯çš„å•å‘æ•°æ®æ¨é€ï¼Œå®¢æˆ·ç«¯é€šè¿‡æ™®é€š HTTP è¯·æ±‚å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨å¯æŒç»­å‘é€æ•°æ®æµï¼Œä½†å®¢æˆ·ç«¯æ— æ³•é€šè¿‡åŒä¸€è¿æ¥å‘æœåŠ¡å™¨å‘é€æ•°æ®ã€‚
* **è‡ªåŠ¨é‡è¿æœºåˆ¶**  
   æ”¯æŒæ–­çº¿é‡è¿ï¼Œè¿æ¥ä¸­æ–­æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°è¯•é‡æ–°è¿æ¥ï¼ˆæ”¯æŒÂ `retry`Â å­—æ®µæŒ‡å®šé‡è¿é—´éš”ï¼‰ã€‚
* **è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹**  
   å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¿æŒè¿æ¥å¼€æ”¾ï¼Œå“åº”å¤´è®¾ç½®Â `Content-Type: text/event-stream`ï¼Œæ ‡è¯†ä¸ºäº‹ä»¶æµæ ¼å¼ï¼ŒæŒç»­æ¨é€äº‹ä»¶æµã€‚

**æ•°æ®æ ¼å¼**

æœåŠ¡ç«¯å‘æµè§ˆå™¨å‘é€ SSE æ•°æ®ï¼Œéœ€è¦è®¾ç½®å¿…è¦çš„ HTTP å¤´ä¿¡æ¯ï¼š

```
Content-Type: text/event-stream;charset=utf-8  
Connection: keep-alive  
```

æ¯ä¸€æ¬¡å‘é€çš„æ¶ˆæ¯ï¼Œç”±è‹¥å¹²ä¸ª`message`ç»„æˆï¼Œæ¯ä¸ª`message`ä¹‹é—´ç”±Â **`\n\n`**Â åˆ†éš”ï¼Œæ¯ä¸ª`message`å†…éƒ¨ç”±è‹¥å¹²è¡Œç»„æˆï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯å¦‚ä¸‹æ ¼å¼ï¼š

**ä»£ç å—**

```
[field]: value\n  

```

**Field å¯å–å€¼è¯´æ˜**

* **`data`[å¿…éœ€]**ï¼šæ•°æ®å†…å®¹
* **`event`[éå¿…éœ€]**ï¼šè¡¨ç¤ºè‡ªå®šä¹‰çš„äº‹ä»¶ç±»å‹ï¼Œé»˜è®¤æ˜¯`message`äº‹ä»¶
* **`id`[éå¿…éœ€]**ï¼šæ•°æ®æ ‡è¯†ç¬¦ï¼Œç›¸å½“äºæ¯ä¸€æ¡æ•°æ®çš„ç¼–å·
* **`retry`[éå¿…éœ€]**ï¼šæŒ‡å®šæµè§ˆå™¨é‡æ–°å‘èµ·è¿æ¥çš„æ—¶é—´é—´éš”

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æœ‰Â **å†’å·Â `:`Â å¼€å¤´çš„è¡Œ**ï¼Œè¡¨ç¤ºæ³¨é‡Šã€‚

**ç¤ºä¾‹ä»£ç å—ï¼ˆPlain Textï¼‰**

```
event: foo\n  
data: a foo event\n\n  
   
data: an unnamed event\n\n  
  
event: end\n  
data: a bar event\n\n  
```

### Springä¸­å®ç°

spring4.2å¼€å§‹å·²ç»æ”¯æŒäº†SSEï¼Œä»Spring 5å¼€å§‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨WebFluxæ›´ä¼˜é›…åœ°å»å®ç°SSEåè®®ï¼ŒFluxæ˜¯å®ç° WebFlux çš„æ ¸å¿ƒAPIï¼Œä»–çš„æ ¸å¿ƒæµç¨‹æ˜¯

**åˆ›å»ºfluxæµ->å¤„ç†æ•°æ®->è®¢é˜…æ•°æ®**

æµ‹è¯•demo

```
public class FluxDemoTest {
    public static void main(String[] args) throws InterruptedException {
        Flux<String> flux = Flux.just("Hello", "World","good").delayElements(Duration.ofSeconds(1));
        flux.map(s->s.toUpperCase())
                .map(s->s+".")
                .subscribe(System.out::println);
        //é˜²æ­¢ç¨‹åºæå‰ç»ˆæ­¢
        Thread.sleep(5000);
    }
}

```

æ¯”å¦‚å‘é€æ—¶é—´

```
@RequestMapping(value = "/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux<String> stream(){
        return Flux.interval(Duration.ofSeconds(1)).map(s->new Date().toString());
    }
```

### **å¸¸ç”¨ API**

**åˆ›å»ºFlux**

| æ–¹æ³•åç§° | åŠŸèƒ½è¯´æ˜ | ç¤ºä¾‹ä»£ç  |
| --- | --- | --- |
| `just(T... data)` | ç›´æ¥ä¼ å…¥å¤šä¸ªå…ƒç´ åˆ›å»º Fluxï¼Œå…ƒç´ ä¼šè¢«ä¾æ¬¡å‘å°„ | `Flux.just("a", "b", "c")` |
| `fromIterable(Iterable<? extends T> it)` | ä»é›†åˆï¼ˆå¦‚ Listã€Setï¼‰åˆ›å»º Flux | `Flux.fromIterable(Arrays.asList(1, 2, 3))` |
| `fromArray(T[] array)` | ä»æ•°ç»„åˆ›å»º Flux | `Flux.fromArray(new Integer[]{1, 2, 3})` |
| `empty()` | åˆ›å»ºç©º Fluxï¼Œç›´æ¥å‘å°„å®Œæˆä¿¡å·ï¼ˆ`onComplete`ï¼‰ | `Flux.empty()` |
| `error(Throwable e)` | åˆ›å»ºç›´æ¥å‘å°„é”™è¯¯ä¿¡å·ï¼ˆ`onError`ï¼‰çš„ Flux | `Flux.error(new RuntimeException("å‡ºé”™äº†"))` |
| `interval(Duration period)` | å‘¨æœŸæ€§å‘å°„ä» 0 å¼€å§‹çš„é€’å¢æ•´æ•°ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰ | `Flux.interval(Duration.ofSeconds(1))` |

**å¤„ç†æ•°æ®**

| æ–¹æ³•åç§° | åŠŸèƒ½è¯´æ˜ | ç¤ºä¾‹ä»£ç  |
| --- | --- | --- |
| `subscribe()` | ç®€å•è®¢é˜…ï¼Œå¿½ç•¥æ‰€æœ‰å…ƒç´ ã€é”™è¯¯å’Œå®Œæˆä¿¡å· | `flux.subscribe()` |
| `subscribe(Consumer<? super T> onNext)` | å¤„ç†æ­£å¸¸å‘å°„çš„å…ƒç´ ï¼Œå¿½ç•¥é”™è¯¯å’Œå®Œæˆä¿¡å· | `flux.subscribe(i -> System.out.println("æ¥æ”¶ï¼š" + i))` |
| `subscribe(Consumer<? super T> onNext, Consumer<? super Throwable> onError)` | å¤„ç†å…ƒç´ å’Œé”™è¯¯ä¿¡å· | `flux.subscribe(i -> System.out.println(i), e -> e.printStackTrace())` |
| `subscribe(Consumer<? super T> onNext, Consumer<? super Throwable> onError, Runnable onComplete)` | å¤„ç†å…ƒç´ ã€é”™è¯¯å’Œå®Œæˆä¿¡å· | `flux.subscribe(i -> System.out.println(i), e -> {}, () -> System.out.println("å¤„ç†å®Œæˆ"))` |
| `filter(Predicate<? super T> predicate)` | ä¿ç•™æ»¡è¶³æ¡ä»¶çš„å…ƒç´  | `Flux.just(1,2,3,4).filter(i -> i%2 == 0)`ï¼ˆç»“æœï¼š2,4ï¼‰ |
| `take(long n)` | åªä¿ç•™å‰`n`ä¸ªå…ƒç´  | `Flux.just(1,2,3,4).take(2)`ï¼ˆç»“æœï¼š1,2ï¼‰ |
| `skip(long n)` | è·³è¿‡å‰`n`ä¸ªå…ƒç´ ï¼Œä¿ç•™å‰©ä½™å…ƒç´  | `Flux.just(1,2,3,4).skip(2)`ï¼ˆç»“æœï¼š3,4ï¼‰ |
| `distinct()` | å»é™¤é‡å¤å…ƒç´ ï¼ˆåŸºäº`equals`åˆ¤æ–­ï¼‰ | `Flux.just(1,2,2,3).distinct()`ï¼ˆç»“æœï¼š1,2,3ï¼‰ |
| `merge(Publisher<? extends T>... sources)` | å¹¶è¡Œåˆå¹¶å¤šä¸ª Fluxï¼Œå…ƒç´ æŒ‰å®é™…å‘å°„æ—¶é—´é¡ºåºè¾“å‡ºï¼ˆå¯èƒ½äº¤é”™ï¼‰ | `Flux.merge(flux1, flux2)`ï¼ˆflux1:1,2ï¼›flux2:3,4ï¼Œå¯èƒ½ç»“æœï¼š3,1,4,2ï¼‰ |
| `concat(Publisher<? extends T>... sources)` | ä¸²è¡Œåˆå¹¶å¤šä¸ª Fluxï¼Œå‰ä¸€ä¸ªå®Œæˆåå†å¤„ç†ä¸‹ä¸€ä¸ªï¼ˆé¡ºåºä¸¥æ ¼ï¼‰ | `Flux.concat(flux1, flux2)`ï¼ˆflux1:1,2ï¼›flux2:3,4ï¼Œç»“æœï¼š1,2,3,4ï¼‰ |
| `zip(Publisher<? extends T1> s1, Publisher<? extends T2> s2, BiFunction<T1,T2,R> combinator)` | æŒ‰ä½ç½®ä¸€ä¸€é…å¯¹å¤šä¸ª Flux çš„å…ƒç´ ï¼ˆå¦‚æ‹‰é“¾ï¼‰ï¼Œä»»ä¸€ Flux å®Œæˆåˆ™æ•´ä½“å®Œæˆ | `Flux.zip(fluxA, fluxB, (a,b) -> a+b)`ï¼ˆfluxA:"a","b"ï¼›fluxB:1,2ï¼Œç»“æœï¼š"a1","b2"ï¼‰ |

**è®¢é˜…æ“ä½œ**

| æ–¹æ³•åç§° | åŠŸèƒ½è¯´æ˜ | ç¤ºä¾‹ä»£ç  |
| --- | --- | --- |
| `subscribe()` | ç®€å•è®¢é˜…ï¼Œå¿½ç•¥æ‰€æœ‰å…ƒç´ ã€é”™è¯¯å’Œå®Œæˆä¿¡å· | `flux.subscribe()` |
| `subscribe(Consumer<? super T> onNext)` | å¤„ç†æ­£å¸¸å‘å°„çš„å…ƒç´ ï¼Œå¿½ç•¥é”™è¯¯å’Œå®Œæˆä¿¡å· | `flux.subscribe(i -> System.out.println("æ¥æ”¶ï¼š" + i))` |
| `subscribe(Consumer<? super T> onNext, Consumer<? super Throwable> onError)` | å¤„ç†å…ƒç´ å’Œé”™è¯¯ä¿¡å· | `flux.subscribe(i -> System.out.println(i), e -> e.printStackTrace())` |
| `subscribe(Consumer<? super T> onNext, Consumer<? super Throwable> onError, Runnable onComplete)` | å¤„ç†å…ƒç´ ã€é”™è¯¯å’Œå®Œæˆä¿¡å· | `flux.subscribe(i -> System.out.println(i), e -> {}, () -> System.out.println("å¤„ç†å®Œæˆ"))` |

---

> æœ‰äº›äººæ‹…å¿ƒäººå·¥æ™ºèƒ½çš„å‡ºç°ä¼šä»¤äººç±»æ„Ÿåˆ°è‡ªå‘ï¼Œä½†ä»»ä½•æœ‰å¤´è„‘çš„äººå•æ˜¯è§‚å¯ŸèŠ±æœµå°±åº”è¯¥èƒ½æ„Ÿåˆ°è‡ªå·±çš„æ¸ºå°ã€‚Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â â€”â€”è‰¾ä¼¦å‡¯

ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€ğŸ€

ä»¥ä¸Šï¼Œå°±æ˜¯æœ¬æœŸçš„å…¨éƒ¨å†…å®¹å•¦ï¼Œè‹¥æœ‰é”™è¯¯ç–å¿½å¸Œæœ›å„ä½å¤§ä½¬åŠæ—¶æŒ‡å‡ºğŸ’

Â  åˆ¶ä½œä¸æ˜“ï¼Œå¸Œæœ›èƒ½å¯¹å„ä½æä¾›å¾®å°çš„å¸®åŠ©ï¼Œå¯å¦ç•™ä¸‹ä½ å…è´¹çš„èµå‘¢ğŸŒ¸



