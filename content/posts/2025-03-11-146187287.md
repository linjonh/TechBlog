---
layout: post
title: "实战DHCP服务器配置与防御欺骗攻击附华为设备命令"
date: 2025-03-11 19:41:48 +0800
description: "​DHCP安全要点必须启用DHCP Snooping并设置信任端口定期检查DHCP服务器日志​防御增强建议结合IP Source Guard防止IP欺骗配置DAI防御ARP欺骗​排错技巧display dhcp server ip-in-use all # 查看地址分配情况display arp all # 检查ARP表项一致性。"
keywords: "实战：DHCP服务器配置与防御欺骗攻击（附华为设备命令）"
categories: ['未分类']
tags: ['网络', '智能路由器', 'Ip', 'Dhcp']
artid: "146187287"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146187287
    alt: "实战DHCP服务器配置与防御欺骗攻击附华为设备命令"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146187287
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146187287
cover: https://bing.ee123.net/img/rand?artid=146187287
image: https://bing.ee123.net/img/rand?artid=146187287
img: https://bing.ee123.net/img/rand?artid=146187287
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     实战：DHCP服务器配置与防御欺骗攻击（附华为设备命令）
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h3 id="%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E8%83%8C%E6%99%AF" name="%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E8%83%8C%E6%99%AF">
     一、实验背景
    </h3>
    <p>
     本实验基于华为网络设备，通过搭建包含DHCP服务器、DNS服务器、Web服务器及客户端的网络环境，演示DHCP服务配置过程，并模拟攻击者通过伪造DHCP服务器实施钓鱼攻击。最后通过交换机安全功能实现防御。
    </p>
    <hr/>
    <h3 id="%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91%E2%80%8B%E7%BC%96%E8%BE%91" name="%E4%BA%8C%E3%80%81%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91%E2%80%8B%E7%BC%96%E8%BE%91">
     二、实验拓扑
     <img alt="" height="509" src="https://i-blog.csdnimg.cn/direct/2c02e0d6415845adb9e0fc2a4a10b141.png" width="1149"/>
    </h3>
    <hr/>
    <h3 id="%E4%B8%89%E3%80%81DHCP%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E5%85%A8%E6%B5%81%E7%A8%8B" name="%E4%B8%89%E3%80%81DHCP%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E5%85%A8%E6%B5%81%E7%A8%8B">
     三、DHCP服务配置全流程
    </h3>
    <h4 id="1.%20%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE" name="1.%20%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE">
     1. 基础网络配置
    </h4>
    <pre><code># 配置路由器R1接口
&lt;Huawei&gt;sys
[Huawei]sysname R1
[R1]int g0/0/0
[R1-GigabitEthernet0/0/0]ip add 192.1.1.254 24
[R1-GigabitEthernet0/0/0]int g0/0/1
[R1-GigabitEthernet0/0/1]ip add 192.1.2.254 24</code></pre>
    <h4 id="2.%20DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%EF%BC%88R2%EF%BC%89" name="2.%20DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%EF%BC%88R2%EF%BC%89">
     2. DHCP服务器配置（R2）
    </h4>
    <pre><code># 创建地址池
[R2]ip pool R2_POOL
[R2-ip-pool-R2_POOL]network 192.1.1.0 mask 24
[R2-ip-pool-R2_POOL]gateway-list 192.1.1.254
[R2-ip-pool-R2_POOL]dns-list 192.1.2.7  # 合法DNS服务器
[R2-ip-pool-R2_POOL]excluded-ip-address 192.1.1.1 192.1.1.5  # 保留地址

# 启用DHCP服务
[R2]dhcp enable
[R2]interface g0/0/0
[R2-GigabitEthernet0/0/0]dhcp select global</code></pre>
    <h4 id="3.%20DHCP%E4%B8%AD%E7%BB%A7%E9%85%8D%E7%BD%AE%EF%BC%88R1%EF%BC%89" name="3.%20DHCP%E4%B8%AD%E7%BB%A7%E9%85%8D%E7%BD%AE%EF%BC%88R1%EF%BC%89">
     3. DHCP中继配置（R1）
    </h4>
    <pre><code>[R1]dhcp enable
[R1]interface g0/0/0
[R1-GigabitEthernet0/0/0]dhcp select relay
[R1-GigabitEthernet0/0/0]dhcp relay server-ip 192.1.2.253  # 指向R2的接口IP</code></pre>
    <h4>
     <strong>
      4. IP地址自动分配
     </strong>
    </h4>
    <p>
     <img alt="" height="425" src="https://i-blog.csdnimg.cn/direct/d5a3b090f7fe4c8da4b28316c901c6dc.png" width="830"/>
    </p>
    <p>
     <img alt="" height="546" src="https://i-blog.csdnimg.cn/direct/aaaf7a6d79f64dc39ad3392fcdcb491b.png" width="830"/>
    </p>
    <p>
     之后在主机上开启DHCP功能就可以自动获取ip地址了
    </p>
    <hr/>
    <h3 id="%E5%9B%9B%E3%80%81DHCP%E6%AC%BA%E9%AA%97%E6%94%BB%E5%87%BB%E6%A8%A1%E6%8B%9F" name="%E5%9B%9B%E3%80%81DHCP%E6%AC%BA%E9%AA%97%E6%94%BB%E5%87%BB%E6%A8%A1%E6%8B%9F">
     四、DHCP欺骗攻击模拟
    </h3>
    <h4 id="%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4%EF%BC%9A" name="%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4%EF%BC%9A">
     攻击步骤：
    </h4>
    <ol>
     <li>
      接入伪造DHCP服务器（IP：192.1.2.2）
     </li>
     <li>
      配置恶意地址池：
      <ul>
       <li>
        网关指向攻击者控制的路由器
       </li>
       <li>
        DNS指向伪造的DNS服务器（192.1.2.2）
       </li>
      </ul>
     </li>
     <li>
      客户端获取恶意配置后，访问http://www.a.com将被解析到钓鱼网站
     </li>
    </ol>
    <p>
     <strong>
      攻击效果验证：​
     </strong>
    </p>
    <pre><code>PC&gt; ipconfig
IPv4 Address........: 192.1.1.6  # 来自伪造地址池
Subnet Mask.........: 255.255.255.0
Default Gateway.....: 192.1.1.253  # 恶意网关
DNS Server..........: 192.1.2.2   # 伪造DNS</code></pre>
    <hr/>
    <h3 id="%E4%BA%94%E3%80%81%E9%98%B2%E5%BE%A1DHCP%E6%AC%BA%E9%AA%97%E6%94%BB%E5%87%BB" name="%E4%BA%94%E3%80%81%E9%98%B2%E5%BE%A1DHCP%E6%AC%BA%E9%AA%97%E6%94%BB%E5%87%BB">
     五、防御DHCP欺骗攻击
    </h3>
    <h4 id="1.%20%E5%90%AF%E7%94%A8DHCP%20Snooping" name="1.%20%E5%90%AF%E7%94%A8DHCP%20Snooping">
     1. 启用DHCP Snooping
    </h4>
    <pre><code>[SW1]dhcp enable
[SW1]dhcp snooping enable</code></pre>
    <h4 id="2.%20%E8%AE%BE%E7%BD%AE%E4%BF%A1%E4%BB%BB%E7%AB%AF%E5%8F%A3" name="2.%20%E8%AE%BE%E7%BD%AE%E4%BF%A1%E4%BB%BB%E7%AB%AF%E5%8F%A3">
     2. 设置信任端口
    </h4>
    <pre><code>[SW1]interface g0/0/1  # 连接合法DHCP服务器的端口
[SW1-GigabitEthernet0/0/1]dhcp snooping trusted</code></pre>
    <h4 id="3.%20%E9%AA%8C%E8%AF%81%E9%98%B2%E5%BE%A1%E6%95%88%E6%9E%9C" name="3.%20%E9%AA%8C%E8%AF%81%E9%98%B2%E5%BE%A1%E6%95%88%E6%9E%9C">
     3. 验证防御效果
    </h4>
    <pre><code># 非信任端口收到DHCP Offer将被丢弃
[SW1]display dhcp snooping packet statistics
  Discarded packets : 5  # 显示拦截的恶意报文</code></pre>
    <hr/>
    <h3 id="%E4%B8%83%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93" name="%E4%B8%83%E3%80%81%E5%AE%9E%E9%AA%8C%E6%80%BB%E7%BB%93">
     六、实验总结
    </h3>
    <ol>
     <li>
      <p>
       ​
       <strong>
        DHCP安全要点
       </strong>
      </p>
      <ul>
       <li>
        必须启用DHCP Snooping并设置信任端口
       </li>
       <li>
        定期检查DHCP服务器日志
       </li>
      </ul>
     </li>
     <li>
      <p>
       ​
       <strong>
        防御增强建议
       </strong>
      </p>
      <ul>
       <li>
        结合IP Source Guard防止IP欺骗
       </li>
       <li>
        配置DAI防御ARP欺骗
       </li>
      </ul>
     </li>
     <li>
      <p>
       ​
       <strong>
        排错技巧
       </strong>
      </p>
      <pre><code>display dhcp server ip-in-use all  # 查看地址分配情况
display arp all  # 检查ARP表项一致性</code></pre>
     </li>
    </ol>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f77323336313733343630312f:61727469636c652f64657461696c732f313436313837323837" class_="artid" style="display:none">
 </p>
</div>


