---
layout: post
title: "HeadFirst系列之HeadFirst设计模式第17天之深入责任链模式应对复杂请求处理的设计思路"
date: 2025-03-07 07:38:25 +0800
description: "责任链模式属于行为型设计模式，它通过将多个处理请求的对象串联成一条链来实现请求的分发。当一个请求到来时，链上的每个对象都有机会处理该请求，或者将其传递给链中的下一个对象，直到有一个对象处理该请求为止。责任链模式为我们提供了一种非常灵活和高效的请求处理方式，它通过将多个处理逻辑按顺序连接成链，解耦了请求发送者和处理者的关系。通过责任链模式，可以使得代码更加清晰、易于扩展，并减少了代码间的紧密耦合。责任链模式通过将多个处理者链接成链条，让请求在链条中传递，并由合适的处理者处理。优点。"
keywords: "【HeadFirst系列之HeadFirst设计模式】第17天之深入责任链模式：应对复杂请求处理的设计思路"
categories: ['系统设计', 'Headfirst', 'Headfirst']
tags: ['责任链模式', '设计模式', 'Java']
artid: "146085025"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146085025
    alt: "HeadFirst系列之HeadFirst设计模式第17天之深入责任链模式应对复杂请求处理的设计思路"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146085025
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146085025
cover: https://bing.ee123.net/img/rand?artid=146085025
image: https://bing.ee123.net/img/rand?artid=146085025
img: https://bing.ee123.net/img/rand?artid=146085025
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【HeadFirst系列之HeadFirst设计模式】第17天之深入责任链模式：应对复杂请求处理的设计思路
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_0">
     </a>
     深入责任链模式：应对复杂请求处理的设计思路
    </h2>
    <p>
     在《Head First 设计模式》一书中，责任链模式（Chain of Responsibility Pattern）被介绍为一种帮助我们解决请求处理的设计模式。它能够让多个处理对象以链条的形式依次处理请求，每个对象可以决定是否处理请求，或者将请求转发给下一个对象。这种模式为我们提供了一个松耦合的解决方案，有助于改善代码的可扩展性和灵活性。
    </p>
    <p>
     本文将基于书中的内容，深入解析责任链模式的核心要点，提供代码示例，探讨其优缺点，应用场景，以及在 JDK 和 Spring 等框架中的应用。
    </p>
    <hr/>
    <h3>
     <a id="1__8">
     </a>
     1. 责任链模式简介
    </h3>
    <p>
     责任链模式属于行为型设计模式，它通过将多个处理请求的对象串联成一条链来实现请求的分发。当一个请求到来时，链上的每个对象都有机会处理该请求，或者将其传递给链中的下一个对象，直到有一个对象处理该请求为止。
    </p>
    <h4>
     <a id="_12">
     </a>
     主要组件：
    </h4>
    <ul>
     <li>
      <strong>
       Handler（处理者）
      </strong>
      ：定义一个处理请求的接口，包含一个指向下一个处理者的引用。每个具体的处理者会根据自身的条件来判断是否处理请求，若不能处理，则将请求传递给下一个处理者。
     </li>
     <li>
      <strong>
       ConcreteHandler（具体处理者）
      </strong>
      ：实现处理请求的具体逻辑，并决定是否转发请求。
     </li>
     <li>
      <strong>
       Client（客户端）
      </strong>
      ：发出请求，选择链条中的第一个处理者来处理请求。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="2__19">
     </a>
     2. 遇到的问题：传统代码的耦合度太高
    </h3>
    <p>
     在没有设计模式的情况下，处理请求通常是通过条件语句（如
     <code>
      if-else
     </code>
     或
     <code>
      switch-case
     </code>
     ）来实现的。例如，假设有多个审批环节，传统方式可能需要将每个环节的判断条件硬编码到代码中：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">approveByManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">approveByDirector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">approveByCEO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     这种做法的缺点：
    </p>
    <ol>
     <li>
      <strong>
       代码扩展性差
      </strong>
      ：每次添加新的处理环节，都需要修改现有代码，容易出错。
     </li>
     <li>
      <strong>
       耦合度高
      </strong>
      ：每个请求处理的逻辑紧密耦合，增加了代码的复杂度，难以维护。
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="3__39">
     </a>
     3. 责任链模式的解决方案
    </h3>
    <p>
     责任链模式提供了一种松耦合的方式来处理这种问题。通过将每个请求处理逻辑封装成一个处理者（Handler），并通过链条的形式组织起来，每个处理者负责自己能够处理的请求，链条上的下一个处理者负责处理它不能处理的请求。
    </p>
    <p>
     通过责任链模式，新增处理者时不再修改已有代码，只需要新增处理者并将其加入链中即可。
    </p>
    <h4>
     <a id="_45">
     </a>
     示例代码：简单的审批链
    </h4>
    <pre><code class="prism language-java"><span class="token comment">// 请求类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Request</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> amount<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token keyword">int</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>amount <span class="token operator">=</span> amount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> amount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 处理者接口</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Approver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">Approver</span> nextApprover<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNextApprover</span><span class="token punctuation">(</span><span class="token class-name">Approver</span> nextApprover<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nextApprover <span class="token operator">=</span> nextApprover<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 经理审批</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Approver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Manager approves the request of amount "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nextApprover <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nextApprover<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 董事审批</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token keyword">extends</span> <span class="token class-name">Approver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Director approves the request of amount "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nextApprover <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nextApprover<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// CEO审批</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CEO</span> <span class="token keyword">extends</span> <span class="token class-name">Approver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"CEO approves the request of amount "</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端代码</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建处理者</span>
        <span class="token class-name">Approver</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Approver</span> director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Approver</span> ceo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CEO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 设置责任链</span>
        manager<span class="token punctuation">.</span><span class="token function">setNextApprover</span><span class="token punctuation">(</span>director<span class="token punctuation">)</span><span class="token punctuation">;</span>
        director<span class="token punctuation">.</span><span class="token function">setNextApprover</span><span class="token punctuation">(</span>ceo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 创建请求</span>
        <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token number">4500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 发起请求</span>
        manager<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_125">
     </a>
     代码解析：
    </h4>
    <ul>
     <li>
      <strong>
       Request 类
      </strong>
      ：封装请求的基本信息，如审批金额。
     </li>
     <li>
      <strong>
       Approver 类
      </strong>
      ：定义一个处理请求的接口，具体处理者继承此类并实现请求处理逻辑。
     </li>
     <li>
      <strong>
       Manager, Director, CEO 类
      </strong>
      ：分别为具体的处理者，判断请求金额是否符合条件，决定是否处理该请求或将请求传递给下一个处理者。
     </li>
     <li>
      <strong>
       Client 类
      </strong>
      ：创建责任链并发起请求。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="4__133">
     </a>
     4. 责任链模式的优缺点
    </h3>
    <h4>
     <a id="_135">
     </a>
     优点：
    </h4>
    <ul>
     <li>
      <strong>
       降低耦合度
      </strong>
      ：每个处理者与其他处理者的联系非常松散，只通过链条传递请求，不需要了解其他处理者的具体实现。
     </li>
     <li>
      <strong>
       灵活性强
      </strong>
      ：添加或删除处理者时，不需要修改已有代码，只需要调整链条即可。
     </li>
     <li>
      <strong>
       职责分明
      </strong>
      ：每个处理者有明确的职责，关注自己能够处理的业务，符合单一职责原则。
     </li>
    </ul>
    <h4>
     <a id="_140">
     </a>
     缺点：
    </h4>
    <ul>
     <li>
      <strong>
       请求可能得不到处理
      </strong>
      ：如果链中的所有处理者都不能处理请求，最终请求将得不到处理，可能需要做额外的异常处理。
     </li>
     <li>
      <strong>
       调试困难
      </strong>
      ：责任链模式使得调试变得稍微复杂，因为请求沿着链条传递，可能会跨越多个处理者。
     </li>
    </ul>
    <hr/>
    <h3>
     <a id="5__146">
     </a>
     5. 责任链模式的应用场景
    </h3>
    <p>
     责任链模式适用于以下场景：
    </p>
    <ul>
     <li>
      <strong>
       审批流程
      </strong>
      ：例如，多个环节的审批流程（经理、董事、CEO）可以通过责任链模式来设计。
     </li>
     <li>
      <strong>
       日志处理
      </strong>
      ：在日志系统中，可以根据日志的级别（如 INFO、DEBUG、ERROR）将日志传递给不同的处理者。
     </li>
     <li>
      <strong>
       UI 事件处理
      </strong>
      ：在事件驱动的 GUI 系统中，可以通过责任链模式来处理用户的输入事件。
     </li>
    </ul>
    <h4>
     <a id="JDK_153">
     </a>
     JDK中的应用：
    </h4>
    <p>
     在 JDK 中，责任链模式的一个经典应用场景是
     <strong>
      过滤器链（Filter Chain）
     </strong>
     。例如，Servlet 过滤器链（
     <code>
      javax.servlet.FilterChain
     </code>
     ）就采用了责任链模式。每个过滤器处理请求并决定是否继续传递给下一个过滤器。
    </p>
    <h4>
     <a id="Spring_156">
     </a>
     Spring中的应用：
    </h4>
    <p>
     Spring 中也有类似的设计，
     <strong>
      Spring AOP（面向切面编程）
     </strong>
     就利用了责任链模式来执行多个切面。每个切面可以处理请求或操作，之后的切面会继续处理该请求，直到链的末端。
    </p>
    <hr/>
    <h3>
     <a id="6__161">
     </a>
     6. 总结
    </h3>
    <p>
     责任链模式为我们提供了一种非常灵活和高效的请求处理方式，它通过将多个处理逻辑按顺序连接成链，解耦了请求发送者和处理者的关系。通过责任链模式，可以使得代码更加清晰、易于扩展，并减少了代码间的紧密耦合。
    </p>
    <h4>
     <a id="_165">
     </a>
     核心总结：
    </h4>
    <ul>
     <li>
      <strong>
       责任链模式
      </strong>
      通过将多个处理者链接成链条，让请求在链条中传递，并由合适的处理者处理。
     </li>
     <li>
      <strong>
       优点
      </strong>
      ：降低耦合度、增强灵活性和可扩展性。
     </li>
     <li>
      <strong>
       缺点
      </strong>
      ：请求可能得不到处理，调试较为复杂。
     </li>
     <li>
      <strong>
       应用场景
      </strong>
      ：审批流程、事件处理、日志过滤等。
     </li>
    </ul>
    <p>
     希望这篇文章能够帮助你理解责任链模式的精髓，并能在实际开发中有效运用这一设计模式。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c:6f672e6373646e2e6e65742f5072696e63653134303637382f:61727469636c652f64657461696c732f313436303835303235" class_="artid" style="display:none">
 </p>
</div>


