---
layout: post
title: "BGP三联盟反射器"
date: 2025-03-08 09:12:44 +0800
description: "在一个AS内，其中一台路由器作为路由反射器RR，其他路由器作为客户机，路由反射器在客户机之间反射路由信息，客户机之间不需要建立BGP连接。"
keywords: "BGP（三）联盟、反射器"
categories: ['未分类']
tags: ['网络协议', '网络']
artid: "146110824"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146110824
    alt: "BGP三联盟反射器"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146110824
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146110824
cover: https://bing.ee123.net/img/rand?artid=146110824
image: https://bing.ee123.net/img/rand?artid=146110824
img: https://bing.ee123.net/img/rand?artid=146110824
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     BGP（三）联盟、反射器
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h5 id="rRDqO">
     背景：
    </h5>
    <p id="ue562611d">
     在一个大型的AS当中受到iBGP水平分割(从iBGP的邻居接收到的路由不能再传递给其他的iBGP邻居)的影响，将会造成BGP的路由无法通过iBGP邻居接收。解决办法有三种：
    </p>
    <ol>
     <li id="ub2a78c73">
      成员自治区域系统内建立全互联的IBGP邻居
     </li>
     <li id="ufabdb44c">
      成员自治区域系统之间使用特殊的EBGP连接，我们称之为联盟EBGP
     </li>
     <li id="u13b6c2f0">
      路由反射器
     </li>
    </ol>
    <h5 id="E2qcD">
     BGP联盟
    </h5>
    <p id="uf8839ee3">
     BGP联盟是一种用于优化大型自治系统内部BGP连接的技术。通过将一个大型AS分割成多个子自治系统，BGP联盟能够降低内部IBGP连接的数量，同时对外表现为一个统一的AS。这种方法不仅减少了网络资源和CPU资源的消耗，还提高了网络的管理性。
    </p>
    <h6 id="Bm7XQ">
     <strong>
      BGP联盟的工作原理
     </strong>
    </h6>
    <p id="u2deb2ce2">
     在BGP联盟中，每个子自治系统内部需要建立全连接的IBGP关系，而子自治系统之间则通过特殊的EBGP连接进行通信。对外部AS来说，整个联盟看起来像是一个单一的AS，外部无法看到内部的子自治系统。联盟内部的路由器会保留外部的next_hop属性，同时在联盟内传递的路由的MED和Local Preference属性也会被保留。在联盟内部，成员AS号会被加入到AS_PATH中，但不会传递到联盟外部。联盟内的AS_PATH属性在选择最短路径时不会比较联盟AS号，而且在传出联盟时相关的属性会被自动删除。
    </p>
    <h5 id="CkSiE">
     AS-Path属性在联盟中的应用：
    </h5>
    <p id="u196180fc">
     分类：
    </p>
    <p id="ufcd4c045">
     1：AS_SET，一个无序的AS号列表。
    </p>
    <p id="uc90fe9d1">
     2：AS_SEQENCE，一个有序的AS号列表。
    </p>
    <p id="ub0b42a31">
     3：AS_CONFED_SET，BGP联盟中特有的AS_PATH类型，类似AS_SET，其列表中含有的AS号均属于BGP联盟中的AS号。
    </p>
    <p id="u9f0ab192">
     4：AS_CONFED_SEQUENCE，BGP联盟中特有AS_PATH类型，类似AS_SEQENCE，其列表中含有的AS号均属于BGP联盟中的AS号。
    </p>
    <h5 id="G8N1b">
     路由器反射器
    </h5>
    <h6 id="WrTms">
     路由反射器简介
    </h6>
    <p id="ue4f974ee">
     在一个AS内，其中一台路由器作为路由反射器RR，其他路由器作为客户机，路由反射器在客户机之间反射路由信息，客户机之间不需要建立BGP连接。
    </p>
    <h6 id="I60TZ">
     反射器角色
    </h6>
    <ul>
     <li id="u9ef03fa1">
      路由反射器RR：允许把从IBGP对等体学到的路由反射到其他IBGP对等体的BGP设备。
     </li>
     <li id="u4572734f">
      客户机：与RR形成反射邻居关系的IBGP设备。在AS内部客户机只需要与RR直连。
     </li>
     <li id="ucaa3729d">
      非客户机：既不是RR也不是客户机的IBGP设备。在AS内部非客户机与RR之间，以及所有的非客户机之间依然必须建立全连接关系。
     </li>
     <li id="u7d1cbfd3">
      始发者：在AS内部始发路由的设备。Originator_ID属性用于防止集群内产生路由环路
     </li>
     <li id="u2189ccc5">
      集群：路由反射器及其他客户机的集合。Cluster_List属性用于防止集群间产生路由环路
     </li>
    </ul>
    <p id="ub5dd39db">
     目的：让整个IBGP客户机能够获得相应的BGP路由条目
    </p>
    <h6 id="l6peM">
     路由反射器工作原理：
    </h6>
    <p id="u417f1eb5">
     从非客户机学到的路由，发布给所有客户机。（非非不互传）
    </p>
    <p id="ub4ca6fce">
     从客户机学到的路由，发布给所有非客户机和客户机（发起此路由的客户机除外）。
    </p>
    <p id="u3a9ff0bb">
     从EBGP对等体学到的路由，发布给所有的非客户机和客户机。
    </p>
    <h6 id="MV1VW">
     RR场景下的路由防环
    </h6>
    <p id="u9de461ab">
     RR的设定使得IBGP水平分割原则失效，这就可能导致环路产生，为此RR会为BGP路由添加两个特殊的路径属性来避免出现环路：
    </p>
    <ul>
     <li id="u864a6dee">
      Originator_ID
     </li>
     <li id="ue6e20670">
      Cluster_List
     </li>
     <li id="u46b4a59e">
      Originator_lD、Cluster_List属性都属于可选非过渡类型。
     </li>
    </ul>
    <p id="u88e9cf92">
     1）Originator_lD
    </p>
    <ul>
     <li id="u972d077a">
      RR将一条BGP路由进行反射时会在反射出去的路由中增加Originator_ID，其值为本地AS中通告该路由的BGP路由器RouterID
     </li>
     <li id="uab611086">
      若AS内存在多个RR，则Originator_lD属性由第一个RR创建，并且不被后续的RR（若有）所更改。
     </li>
     <li id="u7f2954f9">
      当BGP路由器收到一条携带Originator_D属性的IBGP路由，并且Originator_ID属性值与自身的RouterID相同，则它会忽略关于该条路由的更新。
     </li>
    </ul>
    <p id="u83446d1d">
    </p>
    <p class="img-center">
     <img alt="" height="580" id="ue3f7c2df" src="https://i-blog.csdnimg.cn/img_convert/7c1eef3e0b8cce2730b9d4af4a008539.png" width="677"/>
    </p>
    <p id="u8d32122d">
     2）路由器反射簇
    </p>
    <ul>
     <li id="u78d9f4ca">
      路由器反射簇包括反射器RR及其Client。一个AS内允许存在多个路由反射簇。
     </li>
     <li id="u6c01fe67">
      每一个簇都有唯一的簇ID（Cluster_ID,缺省时为RR的BGP RouterID)
     </li>
     <li id="u2c8f08ee">
      当一条路由被反射器反射后，该RR的Cluster_ID就会被添加至路由的Cluster_list属性中。
     </li>
     <li id="u972206f9">
      当RR收到一条携带Cluster_list属性的BGP路由，且该属性值中包含该簇的Cluster_ID时，RR认为该条路由存在环路，因此将忽略关于该条路由的更新。
     </li>
    </ul>
    <p id="u522c627d">
    </p>
    <p class="img-center">
     <img alt="" height="270" id="u8fc5bb02" src="https://i-blog.csdnimg.cn/img_convert/28d7ab15369d7fd95cb9a8729d5b50ef.png" width="706"/>
    </p>
    <p id="u4dfcb435">
     3）Cluster_List
    </p>
    <p id="u4eb748fd">
    </p>
    <p class="img-center">
     <img alt="" height="386" id="uf70eabef" src="https://i-blog.csdnimg.cn/img_convert/9c77524eb61240262f5ec774bddcbdd8.png" width="1216"/>
    </p>
    <ul>
     <li id="uae702c45">
      R2发送给R1的路由，经过R1反射给R3时除了添加Originator_ID之外还会添加Cluster
      <em>
       List：10.0.1.1。
      </em>
      <br/>
      <em>
       R3再次反射给R4时，Cluster_List值为：10.0.3.3 10.0.1.1，
      </em>
      <br/>
      <em>
       R4再次反射给R1时Cluster_List值为：10.0.4.4 10.0.3.3 10.0.1.1
      </em>
     </li>
     <li id="u5480fd5f">
      <em>
       当R4将路由反射给R1时，R1发现Cluster_List包含了自身Cluster_id,判断存在环路，从而忽略该路由更新。
      </em>
     </li>
    </ul>
    <p id="uc28479a9">
    </p>
    <h5 id="T5uMh">
     反射器和联盟的对比
    </h5>
    <table id="wifCe">
     <tbody>
      <tr>
       <td>
        <p id="u7fad7da2">
         反射器
        </p>
       </td>
       <td>
        <p id="u4430aaac">
         联盟
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p id="u376cb268">
         不需要更改现有的网络拓扑，兼容性好
        </p>
       </td>
       <td>
        <p id="ua22bf09f">
         需要修改逻辑拓扑
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p id="u19598bb5">
         配置方便，客户机不知道自己是客户机
        </p>
       </td>
       <td>
        <p id="ub0660064">
         所有设备需要重新进行配置，且所有设备必须支持联盟功能
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p id="ubd9a53de">
         集群与集群之间仍然需要全连接
        </p>
       </td>
       <td>
        <p id="u328731ee">
         联盟之间的子AS之间是特殊的EBGP连接，不需要全连接，子AS内部是IBGP全连接。
        </p>
       </td>
      </tr>
      <tr>
       <td>
        <p id="uf4b8ced1">
         在大型网络中应用广泛
        </p>
       </td>
       <td>
        <p id="uab87e93f">
         同样适用于大型网络中，但应用较少
        </p>
       </td>
      </tr>
     </tbody>
    </table>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330315f37393036353531342f:61727469636c652f64657461696c732f313436313130383234" class_="artid" style="display:none">
 </p>
</div>


