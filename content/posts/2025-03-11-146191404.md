---
arturl_encode: "68747470733a2f2f626c6f:672e6373646e2e6e65742f323430315f38373138393731372f:61727469636c652f64657461696c732f313436313931343034"
layout: post
title: "Javaé«˜é¢‘é¢è¯•ä¹‹é›†åˆ-09"
date: 2025-03-11 23:04:32 +0800
description: "helloå•Šï¼Œå„ä½è§‚ä¼—å§¥çˆ·ä»¬ï¼ï¼ï¼æœ¬babyä»Šå¤©æ¥æŠ¥é“äº†ï¼å“ˆå“ˆå“ˆå“ˆå“ˆå—ğŸ¶ã€‚"
keywords: "Javaé«˜é¢‘é¢è¯•ä¹‹é›†åˆ-09"
categories: ['æœªåˆ†ç±»']
tags: ['é¢è¯•', 'å“ˆå¸Œç®—æ³•', 'Java']
artid: "146191404"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191404
    alt: "Javaé«˜é¢‘é¢è¯•ä¹‹é›†åˆ-09"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191404
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191404
cover: https://bing.ee123.net/img/rand?artid=146191404
image: https://bing.ee123.net/img/rand?artid=146191404
img: https://bing.ee123.net/img/rand?artid=146191404
---

# Javaé«˜é¢‘é¢è¯•ä¹‹é›†åˆ-09

helloå•Šï¼Œå„ä½è§‚ä¼—å§¥çˆ·ä»¬ï¼ï¼ï¼æœ¬babyä»Šå¤©æ¥æŠ¥é“äº†ï¼å“ˆå“ˆå“ˆå“ˆå“ˆå—ğŸ¶

### é¢è¯•å®˜ï¼šè¯¦ç»†è¯´è¯´HashMap

---

#### HashMap æ•°æ®ç»“æ„è¯¦è§£

HashMap æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„é”®å€¼å¯¹å­˜å‚¨ç»“æ„ï¼ŒåŸºäº
**å“ˆå¸Œè¡¨**
å®ç°ï¼Œæ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯
**é«˜æ•ˆæŸ¥æ‰¾ä¸æ’å…¥**
ã€‚ä»¥ä¸‹æ˜¯å…¶åº•å±‚å®ç°åŸç†ä¸å…³é”®ä¼˜åŒ–ï¼š

---

##### ä¸€ã€æ ¸å¿ƒæ•°æ®ç»“æ„

åœ¨ JDK 1.8 åï¼ŒHashMap é‡‡ç”¨
**æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘**
çš„å¤åˆç»“æ„ï¼š

1. **æ•°ç»„ï¼ˆæ¡¶æ•°ç»„ï¼‰**

   * åˆå§‹å®¹é‡ä¸º
     `16`
     ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ï¼Œå­˜å‚¨é“¾è¡¨çš„å¤´èŠ‚ç‚¹æˆ–çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚
   * æ•°ç»„ç´¢å¼•é€šè¿‡
     **å“ˆå¸Œå€¼ & (æ•°ç»„é•¿åº¦ - 1)**
     è®¡ç®—ï¼ˆç­‰ä»·äºå–æ¨¡ï¼Œä½†æ€§èƒ½æ›´é«˜ï¼‰ã€‚
2. **é“¾è¡¨**

   * å“ˆå¸Œå†²çªæ—¶ï¼Œé”®å€¼å¯¹ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨åœ¨åŒä¸€æ¡¶ä¸­ï¼ˆæ‹‰é“¾æ³•ï¼‰ã€‚
   * é“¾è¡¨èŠ‚ç‚¹ä¸º
     `Node<K,V>`
     ï¼ŒåŒ…å«
     `key`
     ã€
     `value`
     ã€
     `hash`
     å’Œ
     `next`
     æŒ‡é’ˆã€‚
3. **çº¢é»‘æ ‘**

   * å½“é“¾è¡¨é•¿åº¦
     `â‰¥8`
     ä¸”æ•°ç»„é•¿åº¦
     `â‰¥64`
     æ—¶ï¼Œé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼ˆ
     `TreeNode`
     ï¼‰ï¼Œå°†æŸ¥è¯¢å¤æ‚åº¦ä»
     `O(n)`
     ä¼˜åŒ–ä¸º
     `O(log n)`
     ã€‚
   * æ ‘èŠ‚ç‚¹é€€åŒ–ä¸ºé“¾è¡¨çš„æ¡ä»¶ï¼šèŠ‚ç‚¹æ•°
     `â‰¤6`
     ï¼ˆé¿å…é¢‘ç¹è½¬æ¢ï¼‰ã€‚

---

##### äºŒã€å“ˆå¸Œè®¡ç®—ä¸å†²çªè§£å†³

1. **å“ˆå¸Œå€¼è®¡ç®—**

   ```java
   static final int hash(Object key) {
       int h;
       // é«˜16ä½å¼‚æˆ–ä½16ä½ï¼Œå¢å¼ºæ•£åˆ—æ€§
       return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
   }

   ```
2. **å“ˆå¸Œå†²çªå¤„ç†**

   * **æ‹‰é“¾æ³•**
     ï¼šå†²çªçš„é”®å€¼å¯¹å­˜å…¥åŒä¸€æ¡¶çš„é“¾è¡¨æˆ–æ ‘ã€‚
   * **å†å“ˆå¸Œæ³•**
     ï¼šé€šè¿‡æ‰©å®¹é‡æ–°åˆ†å¸ƒé”®å€¼å¯¹ã€‚

---

##### ä¸‰ã€åŠ¨æ€æ‰©å®¹æœºåˆ¶

1. **è§¦å‘æ¡ä»¶**
     
   å½“å…ƒç´ æ•°é‡
   `> å®¹é‡ Ã— è´Ÿè½½å› å­ï¼ˆé»˜è®¤0.75ï¼‰`
   æ—¶è§¦å‘æ‰©å®¹ã€‚
2. **æ‰©å®¹æµç¨‹**

   * åˆ›å»ºæ–°æ•°ç»„ï¼ˆå®¹é‡ç¿»å€ï¼Œä¿æŒ
     `2^n`
     ç‰¹æ€§ï¼‰ã€‚
   * éå†æ—§æ•°ç»„ï¼Œé‡æ–°è®¡ç®—èŠ‚ç‚¹ä½ç½®ï¼ˆåˆ©ç”¨é«˜ä½åŒºåˆ†æ–°æ—§ç´¢å¼•ï¼‰ã€‚
   * é“¾è¡¨èŠ‚ç‚¹æŒ‰
     `(e.hash & oldCap) == 0`
     æ‹†åˆ†ä¸ºä½ä½é“¾è¡¨å’Œé«˜ä½é“¾è¡¨ã€‚
3. **æ‰©å®¹ä¼˜åŒ–ï¼ˆJDK 1.8ï¼‰**

   * **å•é“¾è¡¨æ‹†åˆ†**
     ï¼šé¿å…å¤šçº¿ç¨‹ä¸‹ç¯å½¢é“¾è¡¨é—®é¢˜ã€‚
   * **çº¢é»‘æ ‘æ‹†åˆ†**
     ï¼šæ ‘èŠ‚ç‚¹æŒ‰å“ˆå¸Œå€¼æ‹†åˆ†åï¼Œè‹¥èŠ‚ç‚¹æ•°
     `â‰¤6`
     ï¼Œé€€åŒ–ä¸ºé“¾è¡¨ã€‚

---

##### å››ã€å…³é”®æ“ä½œæºç è§£æ

1. **`put(K key, V value)`**

   ```java
   public V put(K key, V value) {
       // è®¡ç®—å“ˆå¸Œå€¼
       int hash = hash(key);
       Node<K,V>[] tab; Node<K,V> p; int n, i;
       
       // åˆå§‹åŒ–æˆ–æ‰©å®¹
       if ((tab = table) == null || (n = tab.length) == 0)
           n = (tab = resize()).length;
       
       // è®¡ç®—æ¡¶ç´¢å¼•
       i = (n - 1) & hash;
       p = tab[i];
       
       // æ¡¶ä¸ºç©ºï¼Œç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹
       if (p == null)
           tab[i] = newNode(hash, key, value, null);
       else {
           Node<K,V> e; K k;
           // æ¡¶é¦–èŠ‚ç‚¹åŒ¹é…
           if (p.hash == hash && ((k = p.key) == key || (key != null && key.equals(k))))
               e = p;
           // æ ‘èŠ‚ç‚¹å¤„ç†
           else if (p instanceof TreeNode)
               e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
           // é“¾è¡¨éå†
           else {
               for (int binCount = 0; ; ++binCount) {
                   if ((e = p.next) == null) {
                       p.next = newNode(hash, key, value, null);
                       // é“¾è¡¨è½¬æ ‘
                       if (binCount >= TREEIFY_THRESHOLD - 1)
                           treeifyBin(tab, hash);
                       break;
                   }
                   if (e.hash == hash && ((k = e.key) == key || (key != null && key.equals(k))))
                       break;
                   p = e;
               }
           }
           // æ›´æ–°å€¼å¹¶è¿”å›æ—§å€¼
           if (e != null) {
               V oldValue = e.value;
               if (!onlyIfAbsent || oldValue == null)
                   e.value = value;
               afterNodeAccess(e);
               return oldValue;
           }
       }
       ++modCount;
       // æ£€æŸ¥æ‰©å®¹
       if (++size > threshold)
           resize();
       afterNodeInsertion(evict);
       return null;
   }

   ```
2. **`get(Object key)`**

   ```java
   public V get(Object key) {
       Node<K,V> e;
       return (e = getNode(hash(key), key)) == null ? null : e.value;
   }

   final Node<K,V> getNode(int hash, Object key) {
       Node<K,V>[] tab; Node<K,V> first, e; int n; K k;
       if ((tab = table) != null && (n = tab.length) > 0 &&
           (first = tab[(n - 1) & hash]) != null) {
           // æ£€æŸ¥æ¡¶é¦–èŠ‚ç‚¹
           if (first.hash == hash && ((k = first.key) == key || (key != null && key.equals(k))))
               return first;
           if ((e = first.next) != null) {
               // æ ‘èŠ‚ç‚¹æŸ¥æ‰¾
               if (first instanceof TreeNode)
                   return ((TreeNode<K,V>)first).getTreeNode(hash, key);
               // é“¾è¡¨éå†
               do {
                   if (e.hash == hash && ((k = e.key) == key || (key != null && key.equals(k))))
                       return e;
               } while ((e = e.next) != null);
           }
       }
       return null;
   }

   ```

---

##### äº”ã€æ€§èƒ½ä¸ä¼˜åŒ–

1. **æ—¶é—´å¤æ‚åº¦**

   | **æ“ä½œ** | **å¹³å‡** | **æœ€å·®** |
   | --- | --- | --- |
   | `put` / `get` | `O(1)` | `O(log n)` ï¼ˆæ ‘åŒ–åï¼‰ |
2. **è°ƒä¼˜å‚æ•°**

   * **åˆå§‹å®¹é‡**
     ï¼šé¢„ä¼°å…ƒç´ æ•°é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹ï¼ˆå»ºè®®è®¾ä¸º
     `(é¢„æœŸå…ƒç´ æ•° / è´Ÿè½½å› å­) + 1`
     ï¼‰ã€‚
   * **è´Ÿè½½å› å­**
     ï¼šé»˜è®¤
     `0.75`
     ï¼Œæƒè¡¡ç©ºé—´åˆ©ç”¨ä¸å“ˆå¸Œå†²çªã€‚
3. **çº¿ç¨‹å®‰å…¨æ›¿ä»£æ–¹æ¡ˆ**

   * **`ConcurrentHashMap`**
     ï¼šåˆ†æ®µé”æˆ– CAS å®ç°é«˜å¹¶å‘è¯»å†™ã€‚
   * **`Collections.synchronizedMap`**
     ï¼šåŒ…è£…ç±»ï¼Œæ–¹æ³•çº§åŒæ­¥ã€‚

---

##### å…­ã€JDK 1.7 vs 1.8 å¯¹æ¯”

| **ç‰¹æ€§** | **JDK 1.7** | **JDK 1.8** |
| --- | --- | --- |
| **æ•°æ®ç»“æ„** | æ•°ç»„ + é“¾è¡¨ | æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ |
| **å“ˆå¸Œè®¡ç®—** | å¤šæ¬¡æ‰°åŠ¨ï¼ˆ4æ¬¡ä½è¿ç®—+5æ¬¡å¼‚æˆ–ï¼‰ | 1æ¬¡ä½è¿ç®— + 1æ¬¡å¼‚æˆ– |
| **æ‰©å®¹ç­–ç•¥** | å¤´æ’æ³•ï¼ˆå¯èƒ½äº§ç”Ÿç¯å½¢é“¾è¡¨ï¼‰ | å°¾æ’æ³•ï¼ˆé¿å…ç¯å½¢é“¾è¡¨ï¼‰ |
| **èŠ‚ç‚¹æ‹†åˆ†** | å…¨é“¾è¡¨é‡æ–°å“ˆå¸Œ | é«˜ä½ä½é“¾è¡¨æ‹†åˆ† |

---

##### ä¸ƒã€ä½¿ç”¨æ³¨æ„äº‹é¡¹

1. **é”®å¯¹è±¡è¦æ±‚**
   * é‡å†™
     `hashCode()`
     å’Œ
     `equals()`
     ï¼Œç¡®ä¿å“ˆå¸Œåˆ†å¸ƒå‡åŒ€ä¸”ç›¸ç­‰æ€§æ­£ç¡®ã€‚
2. **é¿å…é¢‘ç¹æ‰©å®¹**
   * åˆå§‹åŒ–æ—¶æŒ‡å®šåˆç†å®¹é‡ã€‚
3. **çº¿ç¨‹å®‰å…¨åœºæ™¯**
   * ä½¿ç”¨
     `ConcurrentHashMap`
     æ›¿ä»£ã€‚

---

#### ğŸ®ğŸ

HashMap é€šè¿‡
**æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘**
çš„å¤åˆç»“æ„ï¼Œç»“åˆ
**åŠ¨æ€æ‰©å®¹**
ä¸
**å“ˆå¸Œä¼˜åŒ–**
ï¼Œå®ç°äº†é«˜æ•ˆçš„é”®å€¼å¯¹å­˜å‚¨ã€‚ç†è§£å…¶åº•å±‚æœºåˆ¶æœ‰åŠ©äºåœ¨å®é™…å¼€å‘ä¸­åˆç†è°ƒä¼˜ï¼Œè§„é¿æ€§èƒ½ç“¶é¢ˆä¸çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°