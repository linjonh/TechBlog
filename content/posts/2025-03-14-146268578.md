---
layout: post
title: "Qt开发QtWebEngine中操作选择文本"
date: 2025-03-14 22:27:15 +0800
description: "QWebEngine并没有直接的方法，来取得一段文本的位置，但是QWebEnginePage有一个runJavaScript()方法，所以我们可以通过执行一些JavaScript，来间接地取得这些信息。能够通过选择取得位置，反过来就可以通过位置，进行选择。选中的方法，是新建一个DocumentFragment，把不需要选择的文本，与选择的文本作为子节点加入，之后替换原来的节点为新建的DocumetFragment。选择的时候，需要根据上一步的全局偏移量，对整个页面的DOM进行遍历，找到相应的节点偏移量。"
keywords: "Qt开发：QtWebEngine中操作选择文本"
categories: ['未分类']
tags: ['开发语言', 'Web', 'Qt', 'Javascript']
artid: "146268578"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146268578
    alt: "Qt开发QtWebEngine中操作选择文本"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146268578
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146268578
cover: https://bing.ee123.net/img/rand?artid=146268578
image: https://bing.ee123.net/img/rand?artid=146268578
img: https://bing.ee123.net/img/rand?artid=146268578
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Qt开发：QtWebEngine中操作选择文本
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     查找选择
    </h3>
    <p>
     在QtWebEngine中，可以使用QWebEnginePage的findText方法来查找文本，查找成功以后，将自动选择当前文本。
    </p>
    <p>
     QWebEnginePage可以通过QWebEngineView的page()来取得。
    </p>
    <p>
     比如，如下代码可以在页面中查找hello,world并选择。
    </p>
    <pre><code class="prism language-c++">// view是一个QWebEngineView
auto page = view-&gt;page();
page-&gt;findText("hello,world");
</code></pre>
    <p>
     findText方法的原型为：
    </p>
    <pre><code class="prism language-c++">void QWebEnginePage::findText(const QString &amp;subString, QWebEnginePage::FindFlags options = {}, const std::function&lt;void (const QWebEngineFindTextResult &amp;)&gt; &amp;resultCallback = std::function&lt;void(const QWebEngineFindTextResult &amp;)&gt;());
</code></pre>
    <p>
     可以通过resultCallback这个参数，传递一个回调函数，根据QWebEngineFindTextResult变量，处理查找到的结果。
    </p>
    <p>
     QWebEngineFindTextResult有两个方法，分别是activeMatch()和numberOfMatches()，分别用来表示当前激活的结果，以及一共查找到的结果总数。
    </p>
    <h3>
     <a id="_23">
     </a>
     获取选择文本
    </h3>
    <p>
     除了查找这种编程的方式以外，QWebEngineView作为一款浏览器控件，也支持用户手动选择。
    </p>
    <p>
     当用户通过鼠标选择文本以后，可以通过QWebEnginePage的selectedText()方法来获得文本。
    </p>
    <p>
     如：
    </p>
    <pre><code class="prism language-c++">auto text = mPage-&gt;selectedText ();
qDebug () &lt;&lt; "user selected" &lt;&lt; text;
</code></pre>
    <h3>
     <a id="_35">
     </a>
     获取选择位置
    </h3>
    <p>
     用户选择文本以后，我们除了想知道这段文本的内容以外，可能还需要知道这段文本的位置。即，这段文本在整个页面中处于什么位置。
    </p>
    <p>
     QWebEngine并没有直接的方法，来取得一段文本的位置，但是QWebEnginePage有一个runJavaScript()方法，所以我们可以通过执行一些JavaScript，来间接地取得这些信息。
    </p>
    <p>
     QWebEnginePage的runJavaScript()方法的原型为：
    </p>
    <pre><code class="prism language-c++">
void QWebEnginePage::runJavaScript(const QString &amp;scriptSource, const std::function&lt;void (const QVariant &amp;)&gt; &amp;resultCallback);

void QWebEnginePage::runJavaScript(const QString &amp;scriptSource, quint32 worldId = 0, const std::function&lt;void (const QVariant &amp;)&gt; &amp;resultCallback = {})
</code></pre>
    <p>
     即，我们可以通过回调函数，取得执行的JavaScript的结果。
    </p>
    <p>
     基本的原理如下：
    </p>
    <ol>
     <li>
      通过window.getSelection()取得所选区域Selection。
     </li>
     <li>
      通过Selection的getRangeAt取得第一个Range。
     </li>
     <li>
      分别返回Range的第一个节点的开头的全局偏移量，以及第二个节点的结尾的全局偏移量，为所选文本的偏移。
     </li>
    </ol>
    <p>
     代码如下：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">getSelectionOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">createOffsetRange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">container， offset</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> range<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token function">createOffsetRange</span><span class="token punctuation">(</span>range<span class="token punctuation">.</span>startContainer<span class="token punctuation">,</span> range<span class="token punctuation">.</span>startOffset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">createOffsetRange</span><span class="token punctuation">(</span>range<span class="token punctuation">.</span>endContainer<span class="token punctuation">,</span> range<span class="token punctuation">.</span>endOffset<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error accessing selection range:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     有了上面的JavaScript，我们就可以通过runJavaScript来获取结果了。
    </p>
    <p>
     <em>
      <strong>
       需要注意的是，runJavaScript是异步执行的。
      </strong>
     </em>
    </p>
    <p>
     即，如果我们需要在执行JavaScript结束之后 ，再接着执行runJavaScript后面的过程，需要手动加入同步代码。其中一个方法，是使用一个QEventLoop。
    </p>
    <p>
     QEventLoop调用exec方法以后，遇到quit才会返回。
    </p>
    <p>
     如：
    </p>
    <pre><code class="prism language-c++">  int begin = -1;
  int end = -1;
  QEventLoop loop;
  mPage-&gt;runJavaScript (
      R"(
    var selection = window.getSelection();
    if (selection.rangeCount &gt; 0) {
      let range = selection.getRangeAt(0);

      let start = document.createRange();
      start.setStart(document.documentElement, 0);
      start.setEnd(range.startContainer, range.startOffset);
      let startOffset = start.toString().length;

      let end = document.createRange();
      end.setStart(document.documentElement, 0);
      end.setEnd(range.endContainer, range.endOffset);
      let endOffset = end.toString().length;

      [startOffset, endOffset];
    } else {
      [null, null];
    }
  )",
      [&amp;loop, &amp;begin, &amp;end] (const QVariant &amp;result) {
        if (result.isValid () &amp;&amp; result.typeId () == QMetaType::QVariantList)
          {
            auto offsets = result.toList ();
            begin = offsets[0].toInt ();
            end = offsets[1].toInt ();
            qDebug () &lt;&lt; "Begin offset:" &lt;&lt; offsets[0].toInt();
            qDebug () &lt;&lt; "End offset:" &lt;&lt; offsets[1].toInt();
            loop.quit();  //结束QEventLoop
          }
      });

  loop.exec ();  //上面的loop.quit()之后，这里才返回。

  return std::make_tuple (begin, end);
</code></pre>
    <h3>
     <a id="_129">
     </a>
     通过位置选择
    </h3>
    <p>
     能够通过选择取得位置，反过来就可以通过位置，进行选择。方法仍然是通过runJavaScript，这里不再示意runJavaScript的用法，只演示JavaScript代码。
    </p>
    <p>
     选择的时候，需要根据上一步的全局偏移量，对整个页面的DOM进行遍历，找到相应的节点偏移量。
    </p>
    <p>
     所以，这里分成三个函数实现：
    </p>
    <h4>
     <a id="_137">
     </a>
     选择一个节点的部分文本
    </h4>
    <p>
     选中的方法，是新建一个DocumentFragment，把不需要选择的文本，与选择的文本作为子节点加入，之后替换原来的节点为新建的DocumetFragment。
    </p>
    <p>
     代码如下：
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">underlineTextNode</span><span class="token punctuation">(</span><span class="token parameter">textNode<span class="token punctuation">,</span> startOffset<span class="token punctuation">,</span> endOffset <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>textNode <span class="token keyword">instanceof</span> <span class="token class-name">Text</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid text node provided'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">const</span> textContent <span class="token operator">=</span> textNode<span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>  
    <span class="token keyword">const</span> validEndOffset <span class="token operator">=</span> endOffset <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> textContent<span class="token punctuation">.</span>length <span class="token operator">:</span> endOffset<span class="token punctuation">;</span>  
  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startOffset <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> validEndOffset <span class="token operator">&gt;</span> textContent<span class="token punctuation">.</span>length <span class="token operator">||</span> startOffset <span class="token operator">&gt;</span> validEndOffset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid offset values'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">const</span> parent <span class="token operator">=</span> textNode<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Text node has no parent element'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">const</span> beforeText <span class="token operator">=</span> textContent<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> startOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">const</span> underlinedText <span class="token operator">=</span> textContent<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startOffset<span class="token punctuation">,</span> validEndOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">const</span> afterText <span class="token operator">=</span> textContent<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>validEndOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">const</span> underlineElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    underlineElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> underlinedText<span class="token punctuation">;</span>  
  
    <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beforeText<span class="token punctuation">)</span> fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>beforeText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>underlineElement<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>afterText<span class="token punctuation">)</span> fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>afterText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">,</span> textNode<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
</code></pre>
    <h4>
     <a id="_176">
     </a>
     遍历函数，在回调中确定提前返回
    </h4>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">traverseTextNodes</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">const</span> walker <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTreeWalker</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> NodeFilter<span class="token punctuation">.</span><span class="token constant">SHOW_TEXT</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">let</span> node<span class="token punctuation">;</span>  
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node <span class="token operator">=</span> walker<span class="token punctuation">.</span><span class="token function">nextNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_189">
     </a>
     选择所有节点
    </h4>
    <p>
     方法是通过遍历，在回调函数中找到需要选择的所有节点。
    </p>
    <p>
     然后，依次对每个节点调用第一个选择的函数。
    </p>
    <pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">underlineByOffset</span><span class="token punctuation">(</span><span class="token parameter">startOffset<span class="token punctuation">,</span> endOffset</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startOffset <span class="token operator">&gt;=</span> endOffset <span class="token operator">||</span> startOffset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid offset range'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">let</span> currentOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
    <span class="token keyword">const</span> nodesInfo <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">between</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
    <span class="token punctuation">}</span><span class="token punctuation">;</span>  
  
    <span class="token function">traverseTextNodes</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">textNode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">const</span> nodeLength <span class="token operator">=</span> textNode<span class="token punctuation">.</span>nodeValue<span class="token punctuation">.</span>length<span class="token punctuation">;</span>  
        <span class="token keyword">const</span> nodeEnd <span class="token operator">=</span> currentOffset <span class="token operator">+</span> nodeLength<span class="token punctuation">;</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> currentOffset <span class="token operator">&lt;=</span> startOffset <span class="token operator">&amp;&amp;</span> nodeEnd <span class="token operator">&gt;</span> startOffset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node <span class="token operator">=</span> textNode<span class="token punctuation">;</span>  
            nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>offset <span class="token operator">=</span> startOffset <span class="token operator">-</span> currentOffset<span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> currentOffset <span class="token operator">&lt;=</span> endOffset <span class="token operator">&amp;&amp;</span> nodeEnd <span class="token operator">&gt;</span> endOffset<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node <span class="token operator">=</span> textNode<span class="token punctuation">;</span>  
            nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>offset <span class="token operator">=</span> endOffset <span class="token operator">-</span> currentOffset<span class="token punctuation">;</span>  
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> textNode <span class="token operator">!==</span> nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            nodesInfo<span class="token punctuation">.</span>between<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>textNode<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
  
        currentOffset <span class="token operator">=</span> nodeEnd<span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
        <span class="token function">underlineTextNode</span><span class="token punctuation">(</span>nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node<span class="token punctuation">,</span> nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>offset<span class="token punctuation">,</span> nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node <span class="token operator">===</span> nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node <span class="token operator">?</span> nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>offset <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        nodesInfo<span class="token punctuation">.</span>between<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token function">underlineTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodesInfo<span class="token punctuation">.</span>start<span class="token punctuation">.</span>node <span class="token operator">!==</span> nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  
            <span class="token function">underlineTextNode</span><span class="token punctuation">(</span>nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>node<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nodesInfo<span class="token punctuation">.</span>end<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="6874747073:3a2f2f626c6f672e6373646e2e6e65742f63757871626c742f:61727469636c652f64657461696c732f313436323638353738" class_="artid" style="display:none">
 </p>
</div>


