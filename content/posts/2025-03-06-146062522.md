---
layout: post
title: "DELETE-UPDATE-INSERT-语句会自动加锁"
date: 2025-03-06 10:52:23 +0800
description: "在数据库系统中，DELETEUPDATE和INSERT语句通常会自动加锁，以确保数据的一致性和并发控制。具体的锁类型和效果取决于数据库的实现（如 MySQL、PostgreSQL 等）以及事务的隔离级别。"
keywords: "insert语句会在mysql中加几种锁"
categories: ['Mysql']
tags: ['数据库']
artid: "146062522"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146062522
    alt: "DELETE-UPDATE-INSERT-语句会自动加锁"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146062522
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146062522
cover: https://bing.ee123.net/img/rand?artid=146062522
image: https://bing.ee123.net/img/rand?artid=146062522
img: https://bing.ee123.net/img/rand?artid=146062522
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     DELETE/ UPDATE/ INSERT 语句会自动加锁
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     在数据库系统中，
     <code>
      DELETE
     </code>
     、
     <code>
      UPDATE
     </code>
     和
     <code>
      INSERT
     </code>
     语句通常会自动加锁，以确保数据的一致性和并发控制。具体的锁类型和效果取决于数据库的实现（如 MySQL、PostgreSQL 等）以及事务的隔离级别。以下是这些操作通常加锁的行为和效果：
    </p>
    <hr/>
    <h4>
     1.
     <strong>
      DELETE 语句
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        加锁类型
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          行级锁
         </strong>
         ：
         <code>
          DELETE
         </code>
         会对要删除的行加锁，通常是
         <strong>
          排他锁（X锁）
         </strong>
         。
        </p>
       </li>
       <li>
        <p>
         <strong>
          间隙锁（Gap Lock）
         </strong>
         ：在某些隔离级别（如 MySQL 的
         <code>
          REPEATABLE READ
         </code>
         ），
         <code>
          DELETE
         </code>
         还可能对索引间隙加锁，防止其他事务插入新数据。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        效果
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         其他事务无法对被删除的行加锁或修改，直到当前事务提交或回滚。
        </p>
       </li>
       <li>
        <p>
         如果使用了间隙锁，其他事务也无法在锁定范围内插入新数据。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     2.
     <strong>
      UPDATE 语句
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        加锁类型
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          行级锁
         </strong>
         ：
         <code>
          UPDATE
         </code>
         会对要修改的行加锁，通常是
         <strong>
          排他锁（X锁）
         </strong>
         。
        </p>
       </li>
       <li>
        <p>
         <strong>
          间隙锁（Gap Lock）
         </strong>
         ：在某些隔离级别下，
         <code>
          UPDATE
         </code>
         也可能对索引间隙加锁，防止其他事务插入新数据。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        效果
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         其他事务无法对被修改的行加锁或修改，直到当前事务提交或回滚。
        </p>
       </li>
       <li>
        <p>
         如果使用了间隙锁，其他事务也无法在锁定范围内插入新数据。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     3.
     <strong>
      INSERT 语句
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        加锁类型
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         <strong>
          行级锁
         </strong>
         ：
         <code>
          INSERT
         </code>
         会对新插入的行加锁，通常是
         <strong>
          排他锁（X锁）
         </strong>
         。
        </p>
       </li>
       <li>
        <p>
         <strong>
          插入意向锁（Insert Intention Lock）
         </strong>
         ：在插入数据时，数据库会对插入的位置加插入意向锁，表示有事务准备在此处插入数据。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        效果
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         其他事务无法对新插入的行加锁或修改，直到当前事务提交或回滚。
        </p>
       </li>
       <li>
        <p>
         插入意向锁不会阻塞其他事务的插入操作，除非插入的位置被间隙锁锁定。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     4.
     <strong>
      锁的效果与隔离级别
     </strong>
    </h4>
    <ul>
     <li>
      <p>
       <strong>
        READ UNCOMMITTED
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         不加锁（或只加极少的锁），允许读取未提交的数据。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        READ COMMITTED
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         对修改的行加排他锁，但不会加间隙锁。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        REPEATABLE READ
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         对修改的行加排他锁，并可能加间隙锁，防止幻读。
        </p>
       </li>
      </ul>
     </li>
     <li>
      <p>
       <strong>
        SERIALIZABLE
       </strong>
       ：
      </p>
      <ul>
       <li>
        <p>
         对涉及的范围加锁，包括行锁和间隙锁，确保完全串行化执行。
        </p>
       </li>
      </ul>
     </li>
    </ul>
    <hr/>
    <h4>
     5.
     <strong>
      总结
     </strong>
    </h4>
    <table>
     <thead>
      <tr>
       <th>
        操作
       </th>
       <th>
        锁类型
       </th>
       <th>
        效果
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        DELETE
       </td>
       <td>
        行级锁（X锁）、间隙锁
       </td>
       <td>
        阻止其他事务修改或删除该行，可能阻止插入新数据。
       </td>
      </tr>
      <tr>
       <td>
        UPDATE
       </td>
       <td>
        行级锁（X锁）、间隙锁
       </td>
       <td>
        阻止其他事务修改该行，可能阻止插入新数据。
       </td>
      </tr>
      <tr>
       <td>
        INSERT
       </td>
       <td>
        行级锁（X锁）、插入意向锁
       </td>
       <td>
        阻止其他事务修改新插入的行，但通常不会阻塞其他插入操作（除非有间隙锁）。
       </td>
      </tr>
     </tbody>
    </table>
   </div>
  </div>
 </article>
 <p alt="687474:70733a2f2f626c6f672e6373646e2e6e65742f6a766571692f:61727469636c652f64657461696c732f313436303632353232" class_="artid" style="display:none">
 </p>
</div>


