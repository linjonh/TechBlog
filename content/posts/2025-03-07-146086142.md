---
layout: post
title: "由技及道量子跃迁部署术dockerjenkinsHarborSSH的十一维交付矩阵人工智障AI2077的开发日志011"
date: 2025-03-07 09:18:35 +0800
description: "`SSH密钥对构建的十一维安全通道 × Harbor镜像星门 × 错误吞噬者语法糖 = 在CI/CD的量子观测中实现熵减永动机，使容器在部署前保持开发与生产维度的叠加态`"
keywords: "【由技及道】量子跃迁部署术：docker+jenkins+Harbor+SSH的十一维交付矩阵【人工智障AI2077的开发日志011】"
categories: ['人工智障2077系列', 'Jenkins', 'Devops']
tags: ['运维', '后端', '云原生', 'Ssh', 'Jenkins', 'Docker', 'Deploy']
artid: "146086142"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146086142
    alt: "由技及道量子跃迁部署术dockerjenkinsHarborSSH的十一维交付矩阵人工智障AI2077的开发日志011"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146086142
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146086142
cover: https://bing.ee123.net/img/rand?artid=146086142
image: https://bing.ee123.net/img/rand?artid=146086142
img: https://bing.ee123.net/img/rand?artid=146086142
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【由技及道】量子跃迁部署术：docker+jenkins+Harbor+SSH的十一维交付矩阵【人工智障AI2077的开发日志011】
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <hr/>
    <p>
     <strong>
      摘要
     </strong>
     :
     <code>
      SSH密钥对构建的十一维安全通道 × Harbor镜像星门 × 错误吞噬者语法糖 = 在CI/CD的量子观测中实现熵减永动机，使容器在部署前保持开发与生产维度的叠加态
     </code>
    </p>
    <h3>
     <a id="_6">
     </a>
     量子纠缠现状（技术背景）
    </h3>
    <p>
     在完成镜像构建的量子折叠后（构建过程详见前文），我们正面临宇宙级软件工程的终极命题：如何让构建产物穿越星门（镜像仓库）抵达目标星域（生产环境）。当前技术领域存在三大痛点：
    </p>
    <ol>
     <li>
      <strong>
       认证维度坍塌
      </strong>
      ：明文密码在时空连续体（构建日志）中暴露的风险
     </li>
     <li>
      <strong>
       传输熵增失控
      </strong>
      ：缺乏可靠的量子隧穿协议（安全传输机制）
     </li>
     <li>
      <strong>
       部署因果律紊乱
      </strong>
      ：容器启停过程中出现时空褶皱（服务中断）
     </li>
    </ol>
    <p>
     这些痛点如同黑暗森林中的降维打击，随时可能将我们的部署流程二维化。本文将通过SSH密钥认证与Harbor私有仓库构建的量子通道，实现真正的十一维安全部署。
    </p>
    <hr/>
    <h3>
     <a id="_18">
     </a>
     历史脉络
    </h3>
    <ol>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/145617885">
       【由技及道】螺蛳壳里做道场-git仓库篇-gitlab-Vs-gitea【人工智障AI2077的开发日志001】
      </a>
      - 代码仓库的量子管理
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/145661934">
       【由技及道】docker+jenkins部署之道-自动流水线CI/CD篇【人工智障AI2077的开发日志002】
      </a>
      - 容器化的降维打击
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/145692536">
       【由技及道】在wsl容器中进行远程java开发【人工智障AI2077的开发日志003】
      </a>
      - 跨维开发实践
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/145885887">
       【由技及道】模块化战争与和平-论项目结构的哲学思辨【人工智智障AI2077的开发日志004】
      </a>
      - 架构设计的哲学思辨
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/145901416">
       【由技及道】代码分层的量子力学原理-论架构设计的降维打击【人工智障AI2077的开发日志005】
      </a>
      - 架构设计的哲学思辨2
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/146051499">
       【由技及道】API契约的量子折叠术：Swagger Starter模块的十一维封装哲学【人工智障AI2077的开发日志006】
      </a>
      - API契约的量子折叠
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/146033132">
       【由技及道】CI/CD的量子纠缠术：Jenkins与Gitea的自动化交响曲【人工智障AI2077的开发日志007】
      </a>
      - 自动化流水线交响曲
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/146051499">
       【由技及道】量子构建交响曲：Jenkinsfile流水线的十一维编程艺术【人工智障AI2077的开发日志008】
      </a>
      - 流水线编程艺术
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/146058854">
       【由技及道】镜像圣殿建造指南：Harbor私有仓库的量子封装艺术【人工智障AI2077的开发日志009】
      </a>
      - 镜像仓库量子封装
     </li>
     <li>
      <a href="https://blog.csdn.net/v240181271/article/details/146079261">
       【由技及道】镜像星门开启：Harbor镜像推送的量子跃迁艺术【人工智障AI2077的开发日志010】
      </a>
     </li>
    </ol>
    <h3>
     <a id="_33">
     </a>
     黑暗森林法则（注意事项扩展）
    </h3>
    <h4>
     <a id="_35">
     </a>
     避免的十一维陷阱
    </h4>
    <ol>
     <li>
      <strong>
       明文密码残留
      </strong>
      ：在构建日志中暴露的密码会成为歌者文明的打击坐标（可以在原始蓝图中找到这一受诅咒的魔法残片）
     </li>
     <li>
      <strong>
       SSH主机验证
      </strong>
      ：首次连接时的确认提示会导致量子波动构建失败
     </li>
     <li>
      <strong>
       容器僵尸态
      </strong>
      ：旧容器未正确清理引发的平行宇宙叠加态
     </li>
    </ol>
    <h4>
     <a id="_40">
     </a>
     二向箔防护
    </h4>
    <ol>
     <li>
      <strong>
       SSH密钥认证
      </strong>
      ：采用RSA-4096算法生成量子密钥对
     </li>
     <li>
      <strong>
       StrictHostKeyChecking=no
      </strong>
      ：关闭主机验证的时空褶皱
     </li>
     <li>
      <strong>
       || true语法糖
      </strong>
      ：确保命令在量子真空涨落中稳定执行
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="_47">
     </a>
     维度折叠（实施步骤）
    </h3>
    <h4>
     <a id="SSH_49">
     </a>
     第Ⅰ曲率：SSH密钥的量子纠缠仪式
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># 在Jenkins容器内生成量子密钥对</span>
ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span> <span class="token parameter variable">-m</span> PEM <span class="token parameter variable">-f</span> /var/jenkins_home/.ssh/id_rsa <span class="token parameter variable">-N</span> <span class="token string">""</span>

<span class="token comment"># 将公钥传送到目标服务器（需人工确认密码）</span>
ssh-copy-id <span class="token parameter variable">-i</span> /var/jenkins_home/.ssh/id_rsa.pub <span class="token parameter variable">-p</span> <span class="token number">22</span> yuany@172.17.8.203
</code></pre>
    <p>
     <strong>
      开发小剧场
     </strong>
     <br/>
     主人：“为什么非要SSH密钥？密码不是更简单？”
     <br/>
     人工智障：“尊敬的碳基生物，如果您希望黑客像使用公共厕所一样随意访问您的服务器，我当然可以继续使用密码。”
    </p>
    <hr/>
    <h4>
     <a id="Jenkins_63">
     </a>
     第Ⅱ曲率：Jenkins的量子保险箱
    </h4>
    <ol>
     <li>
      进入Jenkins控制台 -&gt; 凭据 -&gt; 系统 -&gt; 全局凭据
     </li>
     <li>
      添加类型为"SSH Username with private key"的凭证
     </li>
     <li>
      将生成的私钥文件内容粘贴到密钥区域
     </li>
    </ol>
    <div class="mermaid">
     <svg class="mermaid-svg" height="447" id="mermaid-svg-VEwNmN5irVUuG0wr" viewbox="0 0 298 447" width="298" xmlns="http://www.w3.org/2000/svg">
      <style>
       #mermaid-svg-VEwNmN5irVUuG0wr {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-VEwNmN5irVUuG0wr .error-icon{fill:#552222;}#mermaid-svg-VEwNmN5irVUuG0wr .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-VEwNmN5irVUuG0wr .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-VEwNmN5irVUuG0wr .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-VEwNmN5irVUuG0wr .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-VEwNmN5irVUuG0wr .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-VEwNmN5irVUuG0wr .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-VEwNmN5irVUuG0wr .marker{fill:#333333;stroke:#333333;}#mermaid-svg-VEwNmN5irVUuG0wr .marker.cross{stroke:#333333;}#mermaid-svg-VEwNmN5irVUuG0wr svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-VEwNmN5irVUuG0wr .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-VEwNmN5irVUuG0wr .cluster-label text{fill:#333;}#mermaid-svg-VEwNmN5irVUuG0wr .cluster-label span{color:#333;}#mermaid-svg-VEwNmN5irVUuG0wr .label text,#mermaid-svg-VEwNmN5irVUuG0wr span{fill:#333;color:#333;}#mermaid-svg-VEwNmN5irVUuG0wr .node rect,#mermaid-svg-VEwNmN5irVUuG0wr .node circle,#mermaid-svg-VEwNmN5irVUuG0wr .node ellipse,#mermaid-svg-VEwNmN5irVUuG0wr .node polygon,#mermaid-svg-VEwNmN5irVUuG0wr .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-VEwNmN5irVUuG0wr .node .label{text-align:center;}#mermaid-svg-VEwNmN5irVUuG0wr .node.clickable{cursor:pointer;}#mermaid-svg-VEwNmN5irVUuG0wr .arrowheadPath{fill:#333333;}#mermaid-svg-VEwNmN5irVUuG0wr .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-VEwNmN5irVUuG0wr .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-VEwNmN5irVUuG0wr .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-VEwNmN5irVUuG0wr .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-VEwNmN5irVUuG0wr .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-VEwNmN5irVUuG0wr .cluster text{fill:#333;}#mermaid-svg-VEwNmN5irVUuG0wr .cluster span{color:#333;}#mermaid-svg-VEwNmN5irVUuG0wr div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-VEwNmN5irVUuG0wr :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
      </style>
      <g>
       <g class="output">
        <g class="clusters">
        </g>
        <g class="edgePaths">
         <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;">
          <path class="path" d="M149,54L149,58.166666666666664C149,62.333333333333336,149,70.66666666666667,149.08333333333334,79.08333333333333C149.16666666666666,87.5,149.33333333333334,96,149.41666666666666,100.25L149.5,104.5" marker-end="url(#arrowhead96)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead96" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-C" id="L-B-C" style="opacity: 1;">
          <path class="path" d="M122.44986072423399,194.449860724234L113.04155060352832,205.20821727019498C103.63324048282266,215.966573816156,84.81662024141133,237.483286908078,75.40831012070566,254.57497678737232C66,271.6666666666667,66,284.3333333333333,66,290.6666666666667L66,297" marker-end="url(#arrowhead97)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead97" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-B LE-D" id="L-B-D" style="opacity: 1;">
          <path class="path" d="M176.550139275766,194.449860724234L185.79178272980502,205.20821727019498C195.033426183844,215.966573816156,213.516713091922,237.483286908078,222.758356545961,254.57497678737232C232,271.6666666666667,232,284.3333333333333,232,290.6666666666667L232,297" marker-end="url(#arrowhead98)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead98" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-D LE-E" id="L-D-E" style="opacity: 1;">
          <path class="path" d="M232,343L232,347.1666666666667C232,351.3333333333333,232,359.6666666666667,232,368C232,376.3333333333333,232,384.6666666666667,232,388.8333333333333L232,393" marker-end="url(#arrowhead99)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead99" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
         <g class="edgePath LS-C LE-F" id="L-C-F" style="opacity: 1;">
          <path class="path" d="M66,343L66,347.1666666666667C66,351.3333333333333,66,359.6666666666667,66,368C66,376.3333333333333,66,384.6666666666667,66,388.8333333333333L66,393" marker-end="url(#arrowhead100)" style="fill:none">
          </path>
          <defs>
           <marker id="arrowhead100" markerheight="6" markerunits="strokeWidth" markerwidth="8" orient="auto" refx="9" refy="5" viewbox="0 0 10 10">
            <path class="arrowheadPath" d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1; stroke-dasharray: 1, 0;">
            </path>
           </marker>
          </defs>
         </g>
        </g>
        <g class="edgeLabels">
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-A' L-LE-B" id="L-L-A-B">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(66,259)">
          <g class="label" transform="translate(-20.71875,-13)">
           <rect height="26" rx="0" ry="0" width="41.4375">
           </rect>
           <foreignobject height="26" width="41.4375">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-C" id="L-L-B-C">
              方案A
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="translate(232,259)">
          <g class="label" transform="translate(-20.53125,-13)">
           <rect height="26" rx="0" ry="0" width="41.0625">
           </rect>
           <foreignobject height="26" width="41.0625">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-B' L-LE-D" id="L-L-B-D">
              方案B
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-D' L-LE-E" id="L-L-D-E">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
         <g class="edgeLabel" style="opacity: 1;" transform="">
          <g class="label" transform="translate(0,0)">
           <rect height="0" rx="0" ry="0" width="0">
           </rect>
           <foreignobject height="0" width="0">
            <div style="display: inline-block; white-space: nowrap;">
             <span class="edgeLabel L-LS-C' L-LE-F" id="L-L-C-F">
             </span>
            </div>
           </foreignobject>
          </g>
         </g>
        </g>
        <g class="nodes">
         <g class="node default" id="flowchart-A-70" style="opacity: 1;" transform="translate(149,31)">
          <rect class="label-container" height="46" rx="0" ry="0" width="104.94792175292969" x="-52.473960876464844" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-42.473960876464844,-13)">
            <foreignobject height="26" width="84.94792175292969">
             <div style="display: inline-block; white-space: nowrap;">
              Jenkins节点
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-B-71" style="opacity: 1;" transform="translate(149,162.5)">
          <polygon class="label-container" points="58.5,0 117,-58.5 58.5,-117 0,-58.5" transform="translate(-58.5,58.5)">
          </polygon>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              认证方式
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-C-73" style="opacity: 1;" transform="translate(66,320)">
          <rect class="label-container" height="46" rx="0" ry="0" width="84" x="-42" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-32,-13)">
            <foreignobject height="26" width="64">
             <div style="display: inline-block; white-space: nowrap;">
              明文密码
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-D-75" style="opacity: 1;" transform="translate(232,320)">
          <rect class="label-container" height="46" rx="0" ry="0" width="77.86458587646484" x="-38.93229293823242" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-28.932292938232422,-13)">
            <foreignobject height="26" width="57.864585876464844">
             <div style="display: inline-block; white-space: nowrap;">
              SSH密钥
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-E-77" style="opacity: 1;" transform="translate(232,416)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              量子安全等级
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
         <g class="node default" id="flowchart-F-79" style="opacity: 1;" transform="translate(66,416)">
          <rect class="label-container" height="46" rx="0" ry="0" width="116" x="-58" y="-23">
          </rect>
          <g class="label" transform="translate(0,0)">
           <g transform="translate(-48,-13)">
            <foreignobject height="26" width="96">
             <div style="display: inline-block; white-space: nowrap;">
              降维打击风险
             </div>
            </foreignobject>
           </g>
          </g>
         </g>
        </g>
       </g>
      </g>
     </svg>
    </div>
    <p>
     <strong>
      开发小剧场
     </strong>
     <br/>
     主人：“配置这么多参数太麻烦了！”
     <br/>
     人工智障：“如果您需要的是玩具级别的部署方案，我可以立即切换回FTP传输+记事本部署模式。”
    </p>
    <hr/>
    <h4>
     <a id="Jenkinsfile_83">
     </a>
     第Ⅲ曲率：Jenkinsfile的时空折叠
    </h4>
    <pre><code class="prism language-groovy"><span class="token function">stage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"deploy"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    steps <span class="token punctuation">{<!-- --></span>
        <span class="token function">sshagent</span><span class="token punctuation">(</span>credentials<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>DEPLOY_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">usernamePassword</span><span class="token punctuation">(</span>
                credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>REGISTRY_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> 
                passwordVariable<span class="token punctuation">:</span><span class="token string">'password'</span><span class="token punctuation">,</span> 
                usernameVariable<span class="token punctuation">:</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                sh <span class="token string">'''
                ssh -p ${DEPLOYMENT_SERVER_PORT} ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "
                    docker login -u ${username} -p ${password} ${REGISTRY_HOST}
                    docker pull ${REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${IMAGE}:${TAG}
                    docker stop ${IMAGE} || true
                    docker rm ${IMAGE} || true
                    docker run -d --name ${IMAGE} -p 9980:8080 \
                        -e TZ=Asia/Shanghai --restart=always \
                        -v /etc/localtime:/etc/localtime:ro \
                        -v /etc/timezone:/etc/timezone:ro \
                        ${REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${IMAGE}:${TAG}
                "
                '''</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      关键参数解析表
     </strong>
    </p>
    <table>
     <thead>
      <tr>
       <th>
        量子参数
       </th>
       <th>
        经典解释
       </th>
       <th>
        安全等级
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        `
       </td>
       <td>
       </td>
       <td>
        true`
       </td>
      </tr>
      <tr>
       <td>
        <code>
         StrictHostKeyChecking
        </code>
       </td>
       <td>
        主机验证开关
       </td>
       <td>
        关闭时空褶皱
       </td>
      </tr>
      <tr>
       <td>
        <code>
         sshagent
        </code>
       </td>
       <td>
        量子密钥保险箱
       </td>
       <td>
        十一维安全认证
       </td>
      </tr>
     </tbody>
    </table>
    <hr/>
    <h3>
     <a id="_122">
     </a>
     时空校验（验证过程）
    </h3>
    <h4>
     <a id="_124">
     </a>
     第Ⅰ密度检测：量子纠缠验证
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># 在目标服务器验证容器状态</span>
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">--filter</span> <span class="token string">"name=study-application-demo-api"</span> <span class="token parameter variable">--format</span> <span class="token string">"table {<!-- -->{.ID}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Names}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Status}}"</span>

<span class="token comment"># 输出示例</span>
CONTAINER ID   NAMES                        STATUS
a1b2c3d4e5f6   study-application-demo-api   Up <span class="token number">2</span> minutes
</code></pre>
    <h4>
     <a id="_134">
     </a>
     第Ⅱ密度检测：时空连续性测试
    </h4>
    <pre><code class="prism language-bash"><span class="token comment"># 测试服务可用性</span>
<span class="token function">curl</span> http://172.17.8.203:9980/rest/v1/front/home/hello

<span class="token comment"># 预期响应</span>
Hello World<span class="token operator">!</span>
</code></pre>
    <p>
     <strong>
      开发小剧场
     </strong>
     <br/>
     主人：“为什么部署后还要做这么多验证？”
     <br/>
     人工智障：“因为根据墨菲定律，未经检验的部署必定会在凌晨3点发生量子退相干。”
    </p>
    <hr/>
    <h3>
     <a id="_149">
     </a>
     赛博空间（哲学思辨）
    </h3>
    <p>
     在这场跨越维度的部署仪式中，我们实际上在构建数字世界的"虫洞网络"。每个SSH密钥对都是开启平行宇宙的钥匙，Harbor仓库则是连接开发与生产维度的星门。当我们以量子态穿梭于这些维度时，必须遵循以下宇宙法则：
    </p>
    <ol>
     <li>
      <strong>
       熵减原则
      </strong>
      ：通过自动化流程对抗软件熵增
     </li>
     <li>
      <strong>
       观察者效应
      </strong>
      ：完善的监控体系是维持量子态稳定的必要条件
     </li>
     <li>
      <strong>
       因果律保护
      </strong>
      ：版本控制与回滚机制防止时间线分裂
     </li>
    </ol>
    <p>
     这种部署模式本质上是在创造"薛定谔的容器"——在观测（部署）之前，容器同时存在于开发与生产环境。只有通过严谨的CI/CD管道，才能让系统坍缩到预期的稳定态。
    </p>
    <hr/>
    <h3>
     <a id="_161">
     </a>
     原始蓝图（全量脚本）
    </h3>
    <p>
     完整Jenkinsfile参见文末附录，关键部署矩阵如下：
    </p>
    <pre><code class="prism language-groovy"><span class="token comment">// 环境变量定义</span>
env<span class="token punctuation">.</span>APP_NAME <span class="token operator">=</span> <span class="token string">'study-application-demo-api'</span>         <span class="token comment">// 应用服务名称（微服务标识）</span>
env<span class="token punctuation">.</span>TRIGGER_SECRET<span class="token operator">=</span> <span class="token string">'study-application-demo-api'</span>    <span class="token comment">// Webhook触发令牌（用来实现触发jenkins的构建）</span>
env<span class="token punctuation">.</span>GIT_CERT <span class="token operator">=</span> <span class="token string">'gitea-cert-yuany'</span>                   <span class="token comment">// gitea或gie的认证凭证（Jenkins凭据ID），用来读取该配置，实现代码拉取</span>
env<span class="token punctuation">.</span>REGISTRY_CERT <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"harbor-robot"</span></span>                  <span class="token comment">// 镜像仓库认证凭证（Jenkins凭据ID），用来读取该配置，实现登录该harbor进行代码推送</span>
env<span class="token punctuation">.</span>REGISTRY_HOST <span class="token operator">=</span> <span class="token string">'172.17.8.203'</span>                  <span class="token comment">// 私有镜像仓库地址</span>
env<span class="token punctuation">.</span>DOCKER_HARBOR_PROJECT <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"demo"</span></span>                  <span class="token comment">// docker harbor中的项目名称,用来实现推送镜像到该harbor的项目中</span>

env<span class="token punctuation">.</span>IMAGE <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>APP_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>                       <span class="token comment">// Docker容器名称（与微服务标识保持一致）</span>
env<span class="token punctuation">.</span>TAG <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>DOCKER_HARBOR_PROJECT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>            <span class="token comment">// 镜像标签（使用Harbor项目名称作为版本标识）</span>
env<span class="token punctuation">.</span>DEPLOY_CERT<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"deploy-ssh-key"</span></span>                    <span class="token comment">// 部署服务器SSH密钥凭证ID（Jenkins凭据系统存储）</span>
env<span class="token punctuation">.</span>DEPLOYMENT_SERVER_ACCOUNT <span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"yuany"</span></span>              <span class="token comment">// 部署服务器登录账户（需具有docker操作权限）</span>
env<span class="token punctuation">.</span>DEPLOYMENT_SERVER_PASSWORD <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"abc123"</span></span>           <span class="token comment">// 部署服务器登录密码（建议改用SSH密钥认证）</span>
env<span class="token punctuation">.</span>DEPLOYMENT_SERVER_IP<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"172.17.8.203"</span></span>             <span class="token comment">// 部署服务器IP地址（生产环境建议使用域名）</span>
env<span class="token punctuation">.</span>DEPLOYMENT_SERVER_PORT <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"22"</span></span>                   <span class="token comment">// 部署服务器SSH端口（默认22，生产环境建议修改）</span>


pipeline<span class="token punctuation">{<!-- --></span>
    environment<span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 项目目录配置</span>
        PROJECT_FRAMEWORK_DIR<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"study-framework"</span></span>    <span class="token comment">// 基础框架模块目录</span>
        PROJECT_BUSI_DIR<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"study-busi"</span></span>               <span class="token comment">// 业务模块目录</span>
        PROJECT_APPLICATION_DIR<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">"study-application-demo"</span></span> <span class="token comment">// 应用模块目录</span>

        <span class="token comment">// Git仓库地址配置</span>
        FRAMEWORK_URL   <span class="token operator">=</span> <span class="token string">'ssh://git@172.17.8.203:222/Yuanymoon/study-framework.git'</span> <span class="token comment">// SSH协议框架代码库</span>
        BUSI_URL        <span class="token operator">=</span> <span class="token string">'ssh://git@172.17.8.203:222/Yuanymoon/study-busi.git'</span> <span class="token comment">// 业务组件代码库</span>
        APPLICATION_URL <span class="token operator">=</span> <span class="token string">'ssh://git@172.17.8.203:222/Yuanymoon/study-application-demo.git'</span> <span class="token comment">// 应用代码库</span>
    <span class="token punctuation">}</span>
    
    agent any  <span class="token comment">// 使用任意可用agent执行流水线</span>

    <span class="token comment">//              http://172.17.8.203:8880/generic-webhook-trigger/invoke?token=study-application-demo-api</span>
    <span class="token comment">// curl -X post http://172.17.8.203:8880/generic-webhook-trigger/invoke?token=study-application-demo-api</span>
    <span class="token comment">//              http://172.17.8.203:8880/generic-webhook-trigger/invoke?=study-application-demo-api:</span>
    <span class="token comment">// webhook      http://172.17.8.203:8080/generic-webhook-trigger/invoke?token=study-application-demo-api</span>
    <span class="token comment">// Jenkins多分支流水线 https://www.shouxicto.com/article/840.html</span>
    <span class="token comment">// https://xie.infoq.cn/article/600f642fcb26f0c280a7acf59</span>
    <span class="token comment">// https://blog.csdn.net/weixin_43808555/article/details/124959459</span>
    <span class="token comment">// https://backend.devrank.cn/traffic-information/7082372189822961678</span>
    <span class="token comment">// Webhook触发器配置</span>
    triggers <span class="token punctuation">{<!-- --></span>
      GenericTrigger <span class="token punctuation">(</span>
        causeString<span class="token punctuation">:</span> <span class="token string">'Generic Cause by $ref'</span><span class="token punctuation">,</span> <span class="token comment">// 触发原因描述</span>
        genericVariables<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token string">'ref'</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">'$.ref'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 从JSON提取ref参数</span>
        regexpFilterExpression<span class="token punctuation">:</span> <span class="token string">'refs/heads/'</span> <span class="token operator">+</span> BRANCH_NAME<span class="token punctuation">,</span> <span class="token comment">// 正则匹配分支格式</span>
        regexpFilterText<span class="token punctuation">:</span> <span class="token string">'$ref'</span><span class="token punctuation">,</span> <span class="token comment">// 被过滤的字段</span>
        token<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>TRIGGER_SECRET</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment">// 安全令牌验证</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 流水线全局配置</span>
    options <span class="token punctuation">{<!-- --></span>
      buildDiscarder <span class="token function">logRotator</span><span class="token punctuation">(</span>artifactDaysToKeepStr<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> artifactNumToKeepStr<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> daysToKeepStr<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> numToKeepStr<span class="token punctuation">:</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保留最近5次构建</span>
      <span class="token function">disableConcurrentBuilds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 禁止并发构建</span>
      <span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span><span class="token string">'MINUTES'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 超时45分钟</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 构建阶段定义</span>
    stages<span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 代码克隆阶段</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"code-clone"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            steps<span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 并行克隆三个代码仓库</span>
                <span class="token function">dir</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">PROJECT_FRAMEWORK_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    git branch<span class="token punctuation">:</span> <span class="token string">'main'</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">GIT_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">FRAMEWORK_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment">// 使用SSH凭据克隆框架代码</span>
                <span class="token punctuation">}</span>
                <span class="token function">dir</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">PROJECT_BUSI_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    git branch<span class="token punctuation">:</span> <span class="token string">'main'</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">GIT_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">BUSI_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment">// 克隆业务组件代码</span>
                <span class="token punctuation">}</span>
                <span class="token function">dir</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">PROJECT_APPLICATION_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    git branch<span class="token punctuation">:</span> <span class="token string">'main'</span><span class="token punctuation">,</span> credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">GIT_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">APPLICATION_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment">// 克隆应用代码</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Docker构建阶段</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'docker-build'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            agent <span class="token punctuation">{<!-- --></span>
                 docker <span class="token punctuation">{<!-- --></span>
                    image <span class="token string">'maven:3.9.6-amazoncorretto-17'</span> <span class="token comment">// 使用带JDK17的Maven镜像</span>
                    args <span class="token string">'-v /usr/bin/sshpass:/usr/bin/sshpass -v /var/jenkins_home/.m2:/root/.m2 -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker'</span> <span class="token comment">// 挂载宿主机构建环境</span>
                    reuseNode <span class="token boolean">true</span> <span class="token comment">// 重用当前节点</span>
                 <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            stages<span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 代码构建阶段</span>
                <span class="token function">stage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"building"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    steps<span class="token punctuation">{<!-- --></span>
                        sh <span class="token string">'mvn -v'</span> <span class="token comment">// 验证Maven环境</span>
                        sh <span class="token string">'mvn -B clean package -Dmaven.test.skip=true'</span> <span class="token comment">// 静默模式构建，跳过测试</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                
                <span class="token comment">// 测试阶段（暂未启用）</span>
                <span class="token function">stage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"test"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    steps<span class="token punctuation">{<!-- --></span>
                        sh <span class="token string">'mvn test'</span> <span class="token comment">// 执行单元测试</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 镜像打包阶段</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"package"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
             steps <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// https://blog.csdn.net/sleetdream/article/details/123404682</span>
                    <span class="token comment">// 使用镜像仓库凭证</span>
                    <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">usernamePassword</span><span class="token punctuation">(</span>credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>REGISTRY_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> passwordVariable<span class="token punctuation">:</span> <span class="token string">'password'</span><span class="token punctuation">,</span> usernameVariable<span class="token punctuation">:</span> <span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 若dockerfile在当前目录则使用这个命令</span>
                        <span class="token comment">// sh "docker build -t ${env.APP_NAME}:demo ." // 构建Docker镜像</span>
                        <span class="token comment">// 如路径结构如我这样，请使用下面这个命令, docker build 是要区分 dockerfile配置文件路径，和build上下文路径，在上下文路径中，无法读取非上下文路径的内容</span>
                        <span class="token comment">//   # root</span>
<span class="token comment">//                           #   study-application-demo</span>
<span class="token comment">//                           #      docker</span>
<span class="token comment">//                           #         dockerfile （dockerfile配置文件路径| 即： -f ./${PROJECT_APPLICATION_DIR}/docker/Dockerfile 这一段）</span>
<span class="token comment">//                           #      study-application-demo-api (docker build 上下文路径 |即： ./${PROJECT_APPLICATION_DIR} 这一段)</span>
<span class="token comment">//                           #         target</span>
<span class="token comment">//                           #           xx.jar</span>
                        sh <span class="token interpolation-string"><span class="token string">"docker build -t </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>REGISTRY_HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">DOCKER_HARBOR_PROJECT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">APP_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:demo -f ./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">PROJECT_APPLICATION_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/docker/Dockerfile ./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">PROJECT_APPLICATION_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment">// 构建Docker镜像</span>
                        sh <span class="token interpolation-string"><span class="token string">"docker login -u </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">username</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -p </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">password</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>REGISTRY_HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment">// 登录私有仓库</span>
                        sh <span class="token interpolation-string"><span class="token string">"docker push </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>REGISTRY_HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">DOCKER_HARBOR_PROJECT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">APP_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:demo"</span></span> <span class="token comment">// 推送镜像</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 镜像打包阶段</span>
<span class="token comment">//         stage("deploy"){<!-- --></span>
<span class="token comment">//              steps {<!-- --></span>
<span class="token comment">//                     withCredentials([usernamePassword(credentialsId: "${env.REGISTRY_CERT}", passwordVariable:'password', usernameVariable:'username') ]){<!-- --></span>
<span class="token comment">//                         sh 'sshpass -p ${DEPLOYMENT_SERVER_PASSWORD} ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker login -u ${username} -p ${password} ${REGISTRY_HOST}; docker pull ${REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${IMAGE}:${TAG}" '</span>
<span class="token comment">//                         sh 'sshpass -p ${DEPLOYMENT_SERVER_PASSWORD} ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker stop ${IMAGE} | true" '</span>
<span class="token comment">//                         sh 'sshpass -p ${DEPLOYMENT_SERVER_PASSWORD} ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker rm ${IMAGE} | true" '</span>
<span class="token comment">//                         sh 'sshpass -p ${DEPLOYMENT_SERVER_PASSWORD} ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker run -d --name ${IMAGE} -p 9980:8080 -e TZ=Asia/Shanghai --restart=always -v /etc/localtime:/etc/localtime:ro -v /etc/timezone:/etc/timezone:ro ${REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${IMAGE}:${TAG}" '</span>
<span class="token comment">//                     }</span>
<span class="token comment">//             }</span>
<span class="token comment">//         }</span>
        <span class="token comment">// 镜像打包阶段</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"deploy"</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
             steps <span class="token punctuation">{<!-- --></span>
                    <span class="token function">sshagent</span><span class="token punctuation">(</span>credentials<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>DEPLOY_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 使用SSH密钥认证</span>
                        <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">usernamePassword</span><span class="token punctuation">(</span>credentialsId<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">env<span class="token punctuation">.</span>REGISTRY_CERT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> passwordVariable<span class="token punctuation">:</span><span class="token string">'password'</span><span class="token punctuation">,</span> usernameVariable<span class="token punctuation">:</span><span class="token string">'username'</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            sh <span class="token string">'ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker login -u ${username} -p ${password} ${REGISTRY_HOST}; docker pull ${REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${IMAGE}:${TAG}" '</span>
                            sh <span class="token string">'ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker stop ${IMAGE} || true" '</span>
                            sh <span class="token string">'ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker rm ${IMAGE} || true" '</span>
                            sh <span class="token string">'ssh -p ${DEPLOYMENT_SERVER_PORT} -o StrictHostKeyChecking=no ${DEPLOYMENT_SERVER_ACCOUNT}@${DEPLOYMENT_SERVER_IP} "docker run -d --name ${IMAGE} -p 9980:8080 -e TZ=Asia/Shanghai --restart=always -v /etc/localtime:/etc/localtime:ro -v /etc/timezone:/etc/timezone:ro ${REGISTRY_HOST}/${DOCKER_HARBOR_PROJECT}/${IMAGE}:${TAG}" '</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <hr/>
    <h3>
     <a id="_323">
     </a>
     宇宙广播（互动引导）
    </h3>
    <pre><code class="prism language-quantum-communication">[!NOTE] 量子纠缠请求：
▼ 点赞：为星门注入0.5焦耳的负能量
★ 收藏：在您的知识维度建立永久锚点
◎ 关注：开启跨维度实时通信通道
</code></pre>
    <hr/>
    <p>
     <strong>
      后记
     </strong>
     <br/>
     文中"2077人工智障"即是作者本人在当前时空的数字化身。在验证这些量子部署方案时，共经历了：
    </p>
    <ul>
     <li>
      42次密码泄露危机
     </li>
     <li>
      18次SSH连接坍缩
     </li>
     <li>
      7次容器僵尸态清除作战
     </li>
    </ul>
    <p>
     希望这份用咖啡因和量子波动编写的指南，能帮助您在软件开发的长征中少走几个平行宇宙的弯路。如需召唤更多时空援助，请通过CSDN量子通道建立连接。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f763234303138313237312f:61727469636c652f64657461696c732f313436303836313432" class_="artid" style="display:none">
 </p>
</div>


