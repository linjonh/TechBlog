---
layout: post
title: "JVM中常量池和运行时常量池字符串常量池三者之间的关系"
date: 2025-03-13 19:01:42 +0800
description: "在Java虚拟机（JVM）中，常量池、运行时常量池和字符串常量池是三个相关但又有所区别的概念。本文将详细解释这三个概念及其相互的联系。"
keywords: "JVM中常量池和运行时常量池、字符串常量池三者之间的关系"
categories: ['Jvm']
tags: ['Jvm', 'Java']
artid: "146229481"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146229481
    alt: "JVM中常量池和运行时常量池字符串常量池三者之间的关系"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146229481
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146229481
cover: https://bing.ee123.net/img/rand?artid=146229481
image: https://bing.ee123.net/img/rand?artid=146229481
img: https://bing.ee123.net/img/rand?artid=146229481
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     JVM中常量池和运行时常量池、字符串常量池三者之间的关系
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <hr/>
    <h2>
     <a id="_4">
     </a>
     前言
    </h2>
    <p>
     在Java虚拟机（JVM）中，常量池、运行时常量池和字符串常量池是三个相关但又有所区别的概念。下面详细解释这三个概念及其相互的联系。
    </p>
    <h2>
     <a id="Constant_Pool_7">
     </a>
     常量池（Constant Pool）
    </h2>
    <p>
     常量池也被称为 Class 文件常量池，是指每个 Java 类编译后的 .class 文件中的一个表结构，每个类文件（.class 文件）都有一个独立的常量池（Constant Pool）。
    </p>
    <p>
     它存储了类或接口在编译时已知的各种字面量和符号引用。这些信息包括但不限于：
    </p>
    <ul>
     <li>
      字面量：如整数、浮点数、字符串等。
     </li>
     <li>
      符号引用：如类和接口的全限定名、字段名称和描述符、方法名称和描述符等。这些符号引用在类加载过程中会被解析为直接引用，从而让 JVM 能够准确地定位和调用相关的类、字段和方法。
     </li>
    </ul>
    <p>
     每个类或接口都有其对应的常量池，它是类加载过程中不可或缺的一部分，用于解析类中的各种引用。
    </p>
    <p>
     特点：常量池是静态的，在编译阶段就已经确定，存储在 .class 文件中，它是 JVM 后续加载和使用类的重要数据基础。
    </p>
    <p>
     代码
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过反编译查看以上代码的.class文件
     <br/>
     输入javap -v HelloWorld.class查看类文件的常量池内容：
    </p>
    <pre><code class="prism language-js">Classfile <span class="token operator">/</span><span class="token constant">D</span><span class="token operator">:</span><span class="token operator">/</span>Test<span class="token operator">/</span>jvm<span class="token operator">/</span>out<span class="token operator">/</span>production<span class="token operator">/</span>jvm<span class="token operator">/</span>cn<span class="token operator">/</span>qf<span class="token operator">/</span>HelloWorld<span class="token punctuation">.</span>class
  <span class="token class-name">Last</span> modified <span class="token number">2024</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">;</span> size <span class="token number">567</span> bytes
  <span class="token constant">MD5</span> checksum 8efebdac91aa496515fa1c161184e354
  Compiled <span class="token keyword">from</span> <span class="token string">"HelloWorld.java"</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">cn<span class="token punctuation">.</span>qf<span class="token punctuation">.</span>HelloWorld</span>
  minor version<span class="token operator">:</span> <span class="token number">0</span>
  major version<span class="token operator">:</span> <span class="token number">52</span>
  <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SUPER</span>
Constant pool<span class="token operator">:</span>
   #<span class="token number">1</span> <span class="token operator">=</span> Methodref          #<span class="token number">6.</span>#<span class="token number">20</span>         <span class="token comment">// java/lang/Object."&lt;init&gt;":()V</span>
   #<span class="token number">2</span> <span class="token operator">=</span> Fieldref           #<span class="token number">21.</span>#<span class="token number">22</span>        <span class="token comment">// java/lang/System.out:Ljava/io/PrintStream;</span>
   #<span class="token number">3</span> <span class="token operator">=</span> String             #<span class="token number">23</span>            <span class="token comment">// hello world</span>
   #<span class="token number">4</span> <span class="token operator">=</span> Methodref          #<span class="token number">24.</span>#<span class="token number">25</span>        <span class="token comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span>
   #<span class="token number">5</span> <span class="token operator">=</span> Class              #<span class="token number">26</span>            <span class="token comment">// cn/qf//HelloWorld</span>
   #<span class="token number">6</span> <span class="token operator">=</span> Class              #<span class="token number">27</span>            <span class="token comment">// java/lang/Object</span>
   #<span class="token number">7</span> <span class="token operator">=</span> Utf8               <span class="token operator">&lt;</span>init<span class="token operator">&gt;</span>
   #<span class="token number">8</span> <span class="token operator">=</span> <span class="token function">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token constant">V</span>
   #<span class="token number">9</span> <span class="token operator">=</span> Utf8               Code
  #<span class="token number">10</span> <span class="token operator">=</span> Utf8               LineNumberTable
  #<span class="token number">11</span> <span class="token operator">=</span> Utf8               LocalVariableTable
  #<span class="token number">12</span> <span class="token operator">=</span> Utf8               <span class="token keyword">this</span>
  #<span class="token number">13</span> <span class="token operator">=</span> Utf8               Lcn<span class="token operator">/</span>qf<span class="token comment">//HelloWorld;</span>
  #<span class="token number">14</span> <span class="token operator">=</span> Utf8               main
  #<span class="token number">15</span> <span class="token operator">=</span> <span class="token function">Utf8</span>               <span class="token punctuation">(</span><span class="token punctuation">[</span>Ljava<span class="token operator">/</span>lang<span class="token operator">/</span>String<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token constant">V</span>
  #<span class="token number">16</span> <span class="token operator">=</span> Utf8               args
  #<span class="token number">17</span> <span class="token operator">=</span> Utf8               <span class="token punctuation">[</span>Ljava<span class="token operator">/</span>lang<span class="token operator">/</span>String<span class="token punctuation">;</span>
  #<span class="token number">18</span> <span class="token operator">=</span> Utf8               SourceFile
  #<span class="token number">19</span> <span class="token operator">=</span> Utf8               HelloWorld<span class="token punctuation">.</span>java
  #<span class="token number">20</span> <span class="token operator">=</span> NameAndType        #<span class="token number">7</span><span class="token operator">:</span>#<span class="token number">8</span>          <span class="token comment">// "&lt;init&gt;":()V</span>
  #<span class="token number">21</span> <span class="token operator">=</span> Class              #<span class="token number">28</span>            <span class="token comment">// java/lang/System</span>
  #<span class="token number">22</span> <span class="token operator">=</span> NameAndType        #<span class="token number">29</span><span class="token operator">:</span>#<span class="token number">30</span>        <span class="token comment">// out:Ljava/io/PrintStream;</span>
  #<span class="token number">23</span> <span class="token operator">=</span> Utf8               hello world
  #<span class="token number">24</span> <span class="token operator">=</span> Class              #<span class="token number">31</span>            <span class="token comment">// java/io/PrintStream</span>
  #<span class="token number">25</span> <span class="token operator">=</span> NameAndType        #<span class="token number">32</span><span class="token operator">:</span>#<span class="token number">33</span>        <span class="token comment">// println:(Ljava/lang/String;)V</span>
  #<span class="token number">26</span> <span class="token operator">=</span> Utf8               cn<span class="token operator">/</span>qf<span class="token operator">/</span>HelloWorld
  #<span class="token number">27</span> <span class="token operator">=</span> Utf8               java<span class="token operator">/</span>lang<span class="token operator">/</span>Object
  #<span class="token number">28</span> <span class="token operator">=</span> Utf8               java<span class="token operator">/</span>lang<span class="token operator">/</span>System
  #<span class="token number">29</span> <span class="token operator">=</span> Utf8               out
  #<span class="token number">30</span> <span class="token operator">=</span> Utf8               Ljava<span class="token operator">/</span>io<span class="token operator">/</span>PrintStream<span class="token punctuation">;</span>
  #<span class="token number">31</span> <span class="token operator">=</span> Utf8               java<span class="token operator">/</span>io<span class="token operator">/</span>PrintStream
  #<span class="token number">32</span> <span class="token operator">=</span> Utf8               println
  #<span class="token number">33</span> <span class="token operator">=</span> <span class="token function">Utf8</span>               <span class="token punctuation">(</span>Ljava<span class="token operator">/</span>lang<span class="token operator">/</span>String<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token constant">V</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">public</span> cn<span class="token punctuation">.</span>qf<span class="token punctuation">.</span><span class="token function">HelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token literal-property property">descriptor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token constant">V</span>
    <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span>
    <span class="token literal-property property">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> aload_0
         <span class="token number">1</span><span class="token operator">:</span> invokespecial #<span class="token number">1</span>                  <span class="token comment">// Method java/lang/Object."&lt;init&gt;":()V</span>
         <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token literal-property property">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">4</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token literal-property property">LocalVariableTable</span><span class="token operator">:</span>
        Start  Length  Slot  Name   Signature
            <span class="token number">0</span>       <span class="token number">5</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   Lcn<span class="token operator">/</span>qf<span class="token operator">/</span>HelloWorld<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token literal-property property">descriptor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>Ljava<span class="token operator">/</span>lang<span class="token operator">/</span>String<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token constant">V</span>
    <span class="token literal-property property">flags</span><span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span>
    <span class="token literal-property property">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">3</span>                  <span class="token comment">// String hello world</span>
         <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">4</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
         <span class="token number">8</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token literal-property property">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">7</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token literal-property property">LocalVariableTable</span><span class="token operator">:</span>
        Start  Length  Slot  Name   Signature
            <span class="token number">0</span>       <span class="token number">9</span>     <span class="token number">0</span>  args   <span class="token punctuation">[</span>Ljava<span class="token operator">/</span>lang<span class="token operator">/</span>String<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token literal-property property">SourceFile</span><span class="token operator">:</span> <span class="token string">"HelloWorld.java"</span>
</code></pre>
    <p>
     重点观察Constant pool
    </p>
    <h2>
     <a id="Runtime_Constant_Pool_106">
     </a>
     运行时常量池（Runtime Constant Pool）
    </h2>
    <p>
     运行时常量池是每一个类或接口的常量池表的一个运行时表示形式，运行时常量池是方法区的一部分。
    </p>
    <p>
     在Class 文件中除了有类的版本、字段、方法、接口等描述信息外，还有用于存放编译期生成的各种字面量（Literal）和符号引用（Symbolic Reference）的
     <strong>
      常量池表
     </strong>
     (Constant Pool Table) 。
    </p>
    <p>
     <strong>
      当JVM加载一个类文件时，会将该类的常量池信息(常量池表)加载到方法区内的运行时常量池中。
     </strong>
    </p>
    <h2>
     <a id="String_Literal_Pool_113">
     </a>
     字符串常量池（String Literal Pool）
    </h2>
    <p>
     字符串常量池是专门用于存放程序中使用String字面量创建的字符串对象的一个特殊区域。
    </p>
    <p>
     在JDK 6及之前，字符串常量池是运行时常量池的一部分，而JDK 7及之后字符串常量池被移到堆中，因此字符串常量池不再是严格意义上的运行时常量池的一部分。
    </p>
    <p>
     字符串常量池特别针对字符串进行了优化设计，以实现字符串共享，减少内存占用。
     <br/>
     它是一个类似于哈希表（HashTable）的数据结构，在 HotSpot 虚拟机中由StringTable 类实现。
    </p>
    <ul>
     <li>
      作用：节省内存空间，提高性能。
     </li>
     <li>
      位置：与运行时常量池类似，在JDK 7之前位于永久代，在JDK 7及之后被移到了堆中。
     </li>
    </ul>
    <h2>
     <a id="_123">
     </a>
     运行时常量池和字符串常量池位置变化
    </h2>
    <p>
     JDK1.7 之前，方法区的具体实现是永久代（Permanent Generation），运行时常量池和字符串常量池存放在方法区（永久代）。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/701fc5409aba479ba2b6bf84d48f3203.png">
      <br/>
      JDK 7 开始，字符串常量池和静态变量从永久代中移动到了 Java 堆中，运行时常量池不变。方法区仍然由永久代实现。
     </img>
    </p>
    <p>
     这一改变主要是为了避免永久代的内存溢出问题，因为永久代的空间相对较小，且难以进行调优，而堆的管理相对更加灵活。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2e5a20846b6f4c99872886246408d43f.png">
      <br/>
      JDK 8 及以后的版本中，永久代被元空间（Metaspace）所取代(运行时常量池还是在方法区中)，但字符串常量池仍然在堆中。
      <br/>
      元空间使用的是本地内存，不再受 JVM 堆内存的限制。方法区由元空间实现，它主要存储类的元数据信息，而字符串常量池独立于元空间，在堆中进行管理。
     </img>
    </p>
    <h2>
     <a id="_133">
     </a>
     方法区与永久代和元空间的关系
    </h2>
    <p>
     方法区和永久代以及元空间的关系很像 Java 中接口和类的关系，类实现了接口，这里的类就可以看作是永久代和元空间，接口可以看作是方法区，也就是说永久代以及元空间是 HotSpot 虚拟机对虚拟机规范中方法区的两种实现方式。
     <br/>
     并且，永久代是 JDK 1.8 之前的方法区实现，JDK 1.8 及以后方法区的实现变成了元空间。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/7dc04569dc08499db6e1ae5533c45637.png"/>
    </p>
    <h2>
     <a id="_137">
     </a>
     三者之间的关系
    </h2>
    <h3>
     <a id="_138">
     </a>
     常量池与运行时常量池
    </h3>
    <p>
     常量池是 .class 文件中的静态数据结构，而运行时常量池是常量池在运行时的内存表示。
     <br/>
     <code>
      当类被加载到 JVM 中时，JVM 会将 .class 文件中的常量池信息复制到运行时常量池中，并且对符号引用进行解析和转换。
     </code>
    </p>
    <p>
     可以说，运行时常量池是常量池在运行时的具体体现，二者是静态与动态的关系。
    </p>
    <h3>
     <a id="_144">
     </a>
     运行时常量池与字符串常量池
    </h3>
    <ul>
     <li>
      运行时常量池包含了多种类型的常量，而字符串常量池专门用于存储字符串常量。
     </li>
     <li>
      字符串常量池利用运行时常量池的框架，实现了字符串的共享和复用，以节省内存。
     </li>
     <li>
      在JDK 6及之前，字符串常量池是运行时常量池的一部分，而JDK 7及之后字符串常量池被移到堆中，因此字符串常量池不再是严格意义上的运行时常量池的一部分。
     </li>
     <li>
      运行时常量池中存储的是字符串常量的引用，而不是字符串对象本身。字符串对象的实际内容存储在堆中的字符串常量池。
     </li>
     <li>
      例如，当一个类文件中定义了字符串常量 “hello” 时：
      <ul>
       <li>
        运行时常量池中会存储一个指向堆中字符串常量池的引用。
       </li>
       <li>
        堆中的字符串常量池会存储实际的 String 对象。
       </li>
      </ul>
     </li>
    </ul>
    <p>
     例如：
    </p>
    <pre><code class="prism language-java"><span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     在 JDK 7 及以后，当第一次遇到 “hello” 时，会在堆中的字符串常量池创建 “hello” 字符串对象，运行时常量池记录其引用；
    </p>
    <p>
     第二次遇到 “hello” 时，发现字符串常量池已有该对象，运行时常量池直接复用这个引用，所以 str1 和 str2 引用的是同一个堆中的字符串对象。
    </p>
    <h2>
     <a id="_162">
     </a>
     总结
    </h2>
    <ul>
     <li>
      常量池是.class文件的一部分(每个class文件都有自己独立的常量池)，提供了类或接口在编译时所需的各种常量信息。
     </li>
     <li>
      运行时常量池是JVM方法区中的一部分，
      <strong>
       当JVM加载一个类文件时，会将该类的常量池信息(常量池表)加载到方法区内的运行时常量池中。
      </strong>
     </li>
     <li>
      字符串常量池特别针对字符串进行了优化设计，以实现字符串共享，减少内存占用。它是一个类似于哈希表（HashTable）的数据结构，在 HotSpot 虚拟机中由 StringTable 类实现。
     </li>
     <li>
      <strong>
       JDK 1.7之后运行时常量池在方法区中，字符串常量池在堆中
      </strong>
      。因此在JDK 6及之前，字符串常量池是运行时常量池的一部分，而JDK 7及之后字符串常量池被移到堆中，因此字符串常量池不再是严格意义上的运行时常量池的一部分。
     </li>
     <li>
      <strong>
       运行时常量池中存储的是字符串常量的引用
      </strong>
      ，而不是字符串对象本身。
      <strong>
       字符串对象的实际内容存储在堆中的字符串常量池
      </strong>
      。
     </li>
    </ul>
    <hr/>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f34363432353636312f:61727469636c652f64657461696c732f313436323239343831" class_="artid" style="display:none">
 </p>
</div>


