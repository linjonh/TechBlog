---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f33363937393935322f:61727469636c652f64657461696c732f313436313931323034"
layout: post
title: "Linux-Shell-è„šæœ¬ç¼–ç¨‹æç®€å…¥é—¨æŒ‡å—"
date: 2025-03-11 22:52:53 +08:00
description: "15åˆ†é’ŸæŒæ¡Shellè„šæœ¬åŸºç¡€è¯­æ³•ï¼Œæ¶µç›–å˜é‡ã€å¾ªç¯ã€å‡½æ•°ç­‰æ ¸å¿ƒæ“ä½œï¼Œé™„è‡ªåŠ¨åŒ–å®æˆ˜æ¡ˆä¾‹ï¼æœ¬æ–‡é…å¥—æ‰€æœ‰ä»£ç å‡å·²é€šè¿‡ShellCheckéªŒè¯ âœ…"
keywords: "Linux Shell è„šæœ¬ç¼–ç¨‹æç®€å…¥é—¨æŒ‡å—"
categories: ['ç¼–ç¨‹è¯­è¨€']
tags: ['è¿ç»´', 'æœåŠ¡å™¨', 'Linux']
artid: "146191204"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146191204
    alt: "Linux-Shell-è„šæœ¬ç¼–ç¨‹æç®€å…¥é—¨æŒ‡å—"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146191204
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146191204
cover: https://bing.ee123.net/img/rand?artid=146191204
image: https://bing.ee123.net/img/rand?artid=146191204
img: https://bing.ee123.net/img/rand?artid=146191204
---

# Linux Shell è„šæœ¬ç¼–ç¨‹æç®€å…¥é—¨æŒ‡å—

### ä¸€ã€å­¦ä¹ å‰æå‡†å¤‡

âœ…
**ç¯å¢ƒè¦æ±‚**
ï¼š

* Linuxç³»ç»Ÿï¼ˆUbuntu/CentOSç­‰ï¼‰æˆ– WSL (Windowsç”¨æˆ·)
* ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆæ¨èVSCode/Vimï¼‰
* åŸºç¡€å‘½ä»¤è¡Œæ“ä½œèƒ½åŠ›

ğŸ”
**éªŒè¯ç¯å¢ƒ**
ï¼š

```bash
# æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤Shell
echo $SHELL
# æŸ¥çœ‹Bashç‰ˆæœ¬
bash --version 
```

---

### äºŒã€Shellè„šæœ¬åŸºç¡€è®¤çŸ¥

#### 2.1 ä»€ä¹ˆæ˜¯Shellè„šæœ¬ï¼Ÿ

* **è§£é‡Šå‹è¯­è¨€**
  ï¼šé€šè¿‡
  `/bin/bash`
  é€è¡Œè§£ææ‰§è¡Œ
* **æ ¸å¿ƒä»·å€¼**
  ï¼š

  + è‡ªåŠ¨åŒ–é‡å¤æ€§ç³»ç»Ÿæ“ä½œï¼ˆ80%è¿ç»´å·¥ä½œå¯è„šæœ¬åŒ–ï¼‰
  + å¿«é€Ÿå®ç°ä»»åŠ¡è°ƒåº¦ï¼ˆç»“åˆcronï¼‰
  + æå‡æ“ä½œå¯é‡å¤æ€§å’Œç²¾ç¡®åº¦

#### 2.2 è„šæœ¬æ–‡ä»¶æ ‡å‡†ç»“æ„

```bash
#!/bin/bash Â  Â  Â  Â  Â  # Shebangå£°æ˜ï¼ˆå¿…é¡»ç¬¬1è¡Œï¼‰
# æ–‡ä»¶ï¼šdemo.sh Â  Â  Â   # è„šæœ¬æè¿°
# ä½œè€…ï¼šCSDNç”¨æˆ· Â  Â  Â  # ç»´æŠ¤ä¿¡æ¯
â€‹
echo "æ¬¢è¿å­¦ä¹ Shellç¼–ç¨‹" Â  # å¯æ‰§è¡Œè¯­å¥
```

---

### ä¸‰ã€é¦–ä¸ªShellè„šæœ¬å®æˆ˜

#### 3.1 åˆ›å»ºå¹¶è¿è¡Œè„šæœ¬

```bash
# åˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼ˆå»ºè®®.shåç¼€ï¼‰
touch hello_world.sh Â 
chmod +x hello_world.sh Â # æ·»åŠ æ‰§è¡Œæƒé™
```

#### 3.2 ç¼–è¾‘å™¨è¾“å…¥ä»¥ä¸‹ä»£ç 

```bash
#!/bin/bash
# ç¬¬ä¸€ä¸ªShellç¨‹åº
echo "å½“å‰ç”¨æˆ·ï¼š$(whoami)"
echo "ç³»ç»Ÿæ—¶é—´ï¼š$(date +%F)"
```

#### 3.3 ä¸‰ç§æ‰§è¡Œæ–¹å¼å¯¹æ¯”

| æ‰§è¡Œæ–¹å¼ | å‘½ä»¤ç¤ºä¾‹ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- |
| **è·¯å¾„ç›´æ¥æ‰§è¡Œ** | `./hello_world.sh` | å·²æ·»åŠ æ‰§è¡Œæƒé™æ—¶ |
| **æŒ‡å®šè§£é‡Šå™¨æ‰§è¡Œ** | `bash hello_world.sh` | è°ƒè¯•å¿«é€Ÿæ‰§è¡Œ |
| **sourceå‘½ä»¤æ‰§è¡Œ** | `source hello_world.sh` | éœ€ä¿ç•™ç¯å¢ƒå˜é‡æ—¶ |

---

### å››ã€æ ¸å¿ƒç¼–ç¨‹è¯­æ³•ç²¾è¦

#### 4.1 å˜é‡æ“ä½œ

```bash
company="CSDNç¤¾åŒº" Â  Â  Â  Â  Â # å®šä¹‰å˜é‡ï¼ˆç­‰å·æ— ç©ºæ ¼ï¼‰
readonly version="1.0" Â  Â  # åªè¯»å˜é‡ï¼ˆä¸å¯ä¿®æ”¹ï¼‰
today=$(date +%Y-%m-%d) Â  Â # å‘½ä»¤æ‰§è¡Œç»“æœèµ‹å€¼
echo "${company} ${today}" # å»ºè®®å˜é‡ç”¨èŠ±æ‹¬å·åŒ…è£¹
```

#### 4.2 æ¡ä»¶åˆ†æ”¯ç»“æ„

```bash
if [ -f "/etc/passwd" ]; then Â  Â  # åˆ¤æ–­æ–‡ä»¶å­˜åœ¨
 Â echo "ç³»ç»Ÿå¯†ç æ–‡ä»¶å­˜åœ¨"
elif [ -d "/tmp" ]; then Â  Â  Â  Â  Â # åˆ¤æ–­ç›®å½•å­˜åœ¨
 Â echo "/tmpç›®å½•å­˜åœ¨"
else
 Â echo "æ¡ä»¶æœªæ»¡è¶³"
fi
```

#### 4.3 å¾ªç¯ç»“æ„

**forå¾ªç¯å¤„ç†æ–‡ä»¶åˆ—è¡¨**
:

```bash
for file in *.log; do
 Â echo "æ­£åœ¨å¤„ç†æ—¥å¿—æ–‡ä»¶ï¼š${file}"
done
```

**whileæŒ‰è¡Œè¯»å–æ–‡ä»¶**
:

```bash
while read line; do
 Â echo "å½“å‰è¡Œï¼š$line"
done < input.txt
```

#### 4.4 å‡½æ•°å®šä¹‰ä¸è°ƒç”¨

```bash
# å¸¦è¿”å›å€¼å‡½æ•°
file_exists() {
  [ -f "$1" ] && return 0 || return 1
}
â€‹
# è°ƒç”¨å‡½æ•°
file_exists /etc/hosts
if [ $? -eq 0 ]; then Â  Â # $?è·å–ä¸Šä¸€æ¡å‘½ä»¤è¿”å›å€¼
 Â echo "æ–‡ä»¶å­˜åœ¨"
fi
```

---

### äº”ã€å®ç”¨åŠŸèƒ½æ¨¡å—é€ŸæŸ¥

#### 5.1 å‚æ•°ä¼ é€’å¤„ç†

| ç‰¹æ®Šå˜é‡ | å«ä¹‰ | ç¤ºä¾‹ |
| --- | --- | --- |
| `$0` | è„šæœ¬åç§° | `echo "è„šæœ¬ï¼š$0"` |
| `$1` - `$9` | ç¬¬1-9ä¸ªä½ç½®å‚æ•° | `echo "ç¬¬1å‚æ•°ï¼š$1"` |
| `$#` | å‚æ•°æ€»ä¸ªæ•° | `if [ $# -gt 0 ]` |
| `$@` | æ‰€æœ‰å‚æ•°åˆ—è¡¨ | `for param in $@` |

#### 5.2 é€€å‡ºçŠ¶æ€ç 

```bash
check_service() {
  systemctl is-active nginx >/dev/null
  return $? Â  # è¿”å›ä¸Šæ¡å‘½ä»¤çš„é€€å‡ºçŠ¶æ€
}
â€‹
check_service
case $? in
 Â 0) echo "æœåŠ¡è¿è¡Œä¸­";;
  *) echo "æœåŠ¡å¼‚å¸¸ï¼ŒçŠ¶æ€ç ï¼š$?";;
esac
```

#### 5.3 ç®¡é“ä¸é‡å®šå‘

```bash
# ç®¡é“ç»„åˆå‘½ä»¤
cat access.log | grep "404" | awk '{print $7}'
â€‹
# è¾“å‡ºé‡å®šå‘
ls -l > file_list.txt Â  Â # è¦†ç›–å†™å…¥
echo "æ–°å¢å†…å®¹" >> log.txt # è¿½åŠ å†™å…¥
â€‹
# é”™è¯¯è¾“å‡ºå¤„ç†
apt update 2> /dev/null Â # ä¸¢å¼ƒé”™è¯¯è¾“å‡º
```

---

### å…­ã€è‡ªåŠ¨åŒ–å®æˆ˜ï¼šç³»ç»Ÿå¤‡ä»½è„šæœ¬

#### 6.1 éœ€æ±‚è¯´æ˜

* æ¯æ—¥å‡Œæ™¨å‹ç¼©å¤‡ä»½
  `/data`
  ç›®å½•
* è‡ªåŠ¨åˆ é™¤30å¤©å‰çš„å¤‡ä»½æ–‡ä»¶
* è®°å½•æ“ä½œæ—¥å¿—

#### 6.2 å®Œæ•´ä»£ç å®ç°

```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬
â€‹
# é…ç½®å‚æ•°
backup_dir="/data"
dest_path="/backup"
keep_days=30
log_file="/var/log/backup.log"
â€‹
# ç›®å½•æ£€æŸ¥
[ ! -d "$dest_path" ] && mkdir -p "$dest_path"
[ ! -f "$log_file" ] && touch "$log_file"
â€‹
# ç”Ÿæˆå‹ç¼©åŒ…
timestamp=$(date +%Y%m%d%H%M)
tar -czf "${dest_path}/backup_${timestamp}.tar.gz" "$backup_dir" 2>&1 | tee -a "$log_file"
â€‹
# æ¸…ç†æ—§å¤‡ä»½
find "$dest_path" -name "*.tar.gz" -mtime +$keep_days -delete 2>&1 | tee -a "$log_file"
â€‹
# æ—¥å¿—è®°å½•
echo "[$(date)] å¤‡ä»½å®Œæˆï¼Œä¿ç•™æœ€è¿‘${keep_days}å¤©æ–‡ä»¶" | tee -a "$log_file"
```

#### 6.3 éƒ¨ç½²åˆ°cronè®¡åˆ’ä»»åŠ¡

```bash
# æ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œ
crontab -e
# æ·»åŠ å¦‚ä¸‹è¡Œ
0 2 * * * /opt/scripts/backup.sh
```

---

### ä¸ƒã€é«˜é˜¶è°ƒè¯•æŠ€å·§

#### 7.1 æ‰§è¡Œè¿‡ç¨‹è¿½è¸ª

```bash
bash -x script.sh Â # æ˜¾ç¤ºæ¯æ¡æ‰§è¡Œå‘½ä»¤
```

#### 7.2 ä»£ç æ®µè°ƒè¯•

```bash
set -x Â  # å¼€å¯è°ƒè¯•æ¨¡å¼
# éœ€è¦è°ƒè¯•çš„ä»£ç 
set +x Â  # å…³é—­è°ƒè¯•æ¨¡å¼
```

#### 7.3 é”™è¯¯è‡ªåŠ¨é€€å‡º

```bash
#!/bin/bash
set -e Â  # ä»»ä½•è¯­å¥è¿”å›å€¼é0åˆ™ç«‹å³é€€å‡º
set -o pipefail Â # ç®¡é“å‘½ä»¤å‡ºé”™æ—¶ä¹Ÿé€€å‡º
```

---

### å…«ã€å­¦ä¹ è·¯çº¿ä¸èµ„æºæ¨è

ğŸ”¥
**æŠ€èƒ½æå‡è·¯çº¿**
ï¼š

1. æŒæ¡æ­£åˆ™è¡¨è¾¾å¼ï¼ˆgrep/sedï¼‰
2. å­¦ä¹ awké«˜çº§æ–‡æœ¬å¤„ç†
3. ç†è§£Linuxä¿¡å·å¤„ç†ï¼ˆtrapï¼‰
4. ç ”ç©¶Ansibleç­‰è‡ªåŠ¨åŒ–å·¥å…·

ğŸ“š
**æ¨èèµ„æ–™**
ï¼š

* **ä¹¦ç±**
  ï¼šã€ŠLinuxå‘½ä»¤è¡Œä¸Shellè„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹
* **å·¥å…·**
  ï¼š
  [ShellCheckåœ¨çº¿æ£€æµ‹](https://www.shellcheck.net/ "ShellCheckåœ¨çº¿æ£€æµ‹")