---
layout: post
title: "Flink-1.17.2-版本用-java-读取-starrocks"
date: 2025-03-12 21:14:21 +0800
description: "在 Flink 1.17.2 中使用 Java 读取 StarRocks 数据，可以通过 JDBC 连接器 或 StarRocks 官方提供的 Flink Connector 实现。StarRocks 兼容 MySQL 协议，可通过 Flink 的 JDBC 连接器读取数据。StarRocks 提供官方 Connector，支持高效读写。"
keywords: "flink 1.17.2对应版本的rocksdb jni库"
categories: ['Flink']
tags: ['Python', 'Java', 'Flink']
artid: "146213512"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146213512
    alt: "Flink-1.17.2-版本用-java-读取-starrocks"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146213512
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146213512
cover: https://bing.ee123.net/img/rand?artid=146213512
image: https://bing.ee123.net/img/rand?artid=146213512
img: https://bing.ee123.net/img/rand?artid=146213512
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Flink 1.17.2 版本用 java 读取 starrocks
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night-eighties" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <p>
     在 Flink 1.17.2 中使用 Java 读取 StarRocks 数据，可以通过 JDBC 连接器 或 StarRocks 官方提供的 Flink Connector 实现。以下是两种方法的详细步骤：
    </p>
    <h4>
     <a id="_Flink_JDBC__MySQL__3">
     </a>
     方法一：使用 Flink JDBC 连接器（兼容 MySQL 协议）
    </h4>
    <p>
     StarRocks 兼容 MySQL 协议，可通过 Flink 的 JDBC 连接器读取数据。在 pom.xml 中添加以下依赖：
    </p>
    <pre><code class="prism language-xml"><span class="token comment">&lt;!-- Flink JDBC 连接器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.1-1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- MySQL 驱动（兼容 StarRocks） --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     编写 Java 代码：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">TypeInformation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>typeinfo<span class="token punctuation">.</span></span><span class="token class-name">Types</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span><span class="token class-name">DataSet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span><span class="token class-name">ExecutionEnvironment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>java<span class="token punctuation">.</span>typeutils<span class="token punctuation">.</span></span><span class="token class-name">RowTypeInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span><span class="token class-name">JdbcInputFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>types<span class="token punctuation">.</span></span><span class="token class-name">Row</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadStarRocksJDBC</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">ExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">TypeInformation</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fieldTypes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
                <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
                <span class="token class-name">Types</span><span class="token punctuation">.</span><span class="token constant">INT</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name">RowTypeInfo</span> rowTypeInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RowTypeInfo</span><span class="token punctuation">(</span>fieldTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">JdbcInputFormat</span> inputFormat <span class="token operator">=</span> <span class="token class-name">JdbcInputFormat</span><span class="token punctuation">.</span><span class="token function">buildJdbcInputFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDrivername</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDBUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://&lt;starrocks-fe-host&gt;:&lt;port&gt;/&lt;database&gt;"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"&lt;username&gt;"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"&lt;password&gt;"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT teacher_id, student_id, student_num FROM dwd_student = limit 10"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setRowTypeInfo</span><span class="token punctuation">(</span>rowTypeInfo<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">DataSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Row</span><span class="token punctuation">&gt;</span></span> dataSet <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">createInput</span><span class="token punctuation">(</span>inputFormat<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSet<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出：
    </p>
    <pre><code class="prism language-shell">+I<span class="token punctuation">[</span>teacher03, abc01, <span class="token number">2</span><span class="token punctuation">]</span>
+I<span class="token punctuation">[</span>teacher01, abc01, <span class="token number">3</span><span class="token punctuation">]</span>
</code></pre>
    <h4>
     <a id="_StarRocks_Flink_Connector_60">
     </a>
     方法二：使用 StarRocks Flink Connector（推荐）
    </h4>
    <p>
     参考：
     <a href="https://docs.starrocks.io/zh/docs/unloading/Flink_connector/" rel="nofollow">
      使用 Flink Connector 读取数据
     </a>
    </p>
    <p>
     StarRocks 提供官方 Connector，支持高效读写。在 pom.xml 中添加以下依赖：
    </p>
    <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.starrocks.connector<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-starrocks<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.9_flink-1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <h5>
     <a id="21__Flink_SQL__StarRocks__71">
     </a>
     2.1 通过 Flink SQL 直接注册 StarRocks 表：
    </h5>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>java<span class="token punctuation">.</span></span><span class="token class-name">StreamTableEnvironment</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadStarRocksSQL</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StreamTableEnvironment</span> tableEnv <span class="token operator">=</span> <span class="token class-name">StreamTableEnvironment</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> createTableSQL <span class="token operator">=</span> <span class="token string">"CREATE TABLE starrocks_table (\n"</span> <span class="token operator">+</span>
                <span class="token string">"  id INT,\n"</span> <span class="token operator">+</span>
                <span class="token string">"  name STRING,\n"</span> <span class="token operator">+</span>
                <span class="token string">"  score INT\n"</span> <span class="token operator">+</span>
                <span class="token string">") WITH (\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'connector' = 'starrocks',\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'jdbc-url' = 'jdbc:mysql://192.168.101.xx:9030',\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'scan-url' = '192.168.101.xx:8030',\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'database-name' = 'mydatabase',\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'table-name' = 'table1',\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'username' = 'root',\n"</span> <span class="token operator">+</span>
                <span class="token string">"  'password' = ''\n"</span> <span class="token operator">+</span>
                <span class="token string">")"</span><span class="token punctuation">;</span>

        tableEnv<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span>createTableSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tableEnv<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM starrocks_table"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     输出：
    </p>
    <pre><code class="prism language-shell">+----+-------------+--------------------------------+-------------+
<span class="token operator">|</span> <span class="token function">op</span> <span class="token operator">|</span>          <span class="token function">id</span> <span class="token operator">|</span>                           name <span class="token operator">|</span>       score <span class="token operator">|</span>
+----+-------------+--------------------------------+-------------+
<span class="token operator">|</span> +I <span class="token operator">|</span>           <span class="token number">4</span> <span class="token operator">|</span>                          Julia <span class="token operator">|</span>          <span class="token number">25</span> <span class="token operator">|</span>
<span class="token operator">|</span> +I <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>                           Rose <span class="token operator">|</span>          <span class="token number">23</span> <span class="token operator">|</span>
<span class="token operator">|</span> +I <span class="token operator">|</span>           <span class="token number">3</span> <span class="token operator">|</span>                          Alice <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>
<span class="token operator">|</span> +I <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span>                           Lily <span class="token operator">|</span>          <span class="token number">23</span> <span class="token operator">|</span>
+----+-------------+--------------------------------+-------------+
<span class="token number">4</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span>
</code></pre>
    <p>
     备注：StarRocks 表 table1 结构
    </p>
    <pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>table1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">"用户 ID"</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">65533</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">"用户姓名"</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">"用户得分"</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>OLAP 
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">DISTRIBUTED</span> <span class="token keyword">BY</span> <span class="token keyword">HASH</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
PROPERTIES <span class="token punctuation">(</span>
<span class="token string">"compression"</span> <span class="token operator">=</span> <span class="token string">"LZ4"</span><span class="token punctuation">,</span>
<span class="token string">"enable_persistent_index"</span> <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
<span class="token string">"fast_schema_evolution"</span> <span class="token operator">=</span> <span class="token string">"false"</span><span class="token punctuation">,</span>
<span class="token string">"replicated_storage"</span> <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
<span class="token string">"replication_num"</span> <span class="token operator">=</span> <span class="token string">"1"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mydatabase<span class="token punctuation">.</span>table1<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mydatabase<span class="token punctuation">.</span>table1<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Rose'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mydatabase<span class="token punctuation">.</span>table1<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Julia'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mydatabase<span class="token punctuation">.</span>table1<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Lily'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     注：但这遇到了一个问题就是这个映射关系必须和原表一一对应，那如果原表有一百多个字段的话这里还得映射这么多字段感觉很不方便，在网上查了能不能只映射部分字段，但并没有成功。
    </p>
    <h5>
     <a id="22__Flink_DataStream__135">
     </a>
     2.2 使用 Flink DataStream 读取数据
    </h5>
    <p>
     在 pom.xml 文件中添加依赖，如下所示：
    </p>
    <pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-table-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.17.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.17.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.starrocks<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-starrocks<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.8_flink-1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
    <p>
     调用 Flink Connector，读取 StarRocks 中的数据，如下所示：
    </p>
    <pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>starrocks<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>flink<span class="token punctuation">.</span></span><span class="token class-name">StarRocksSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>starrocks<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>source<span class="token punctuation">.</span></span><span class="token class-name">StarRocksSourceOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">DataTypes</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">TableSchema</span></span><span class="token punctuation">;</span>
   
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StarRocksSourceApp</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">StarRocksSourceOptions</span> options <span class="token operator">=</span> <span class="token class-name">StarRocksSourceOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"scan-url"</span><span class="token punctuation">,</span> <span class="token string">"192.168.xxx.xxx:8030"</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"jdbc-url"</span><span class="token punctuation">,</span> <span class="token string">"jdbc:mysql://192.168.xxx.xxx:9030"</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"table-name"</span><span class="token punctuation">,</span> <span class="token string">"table1"</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"database-name"</span><span class="token punctuation">,</span> <span class="token string">"mydatabase"</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TableSchema</span> tableSchema <span class="token operator">=</span> <span class="token class-name">TableSchema</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">INT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">STRING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">INT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token class-name">StarRocksSource</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>tableSchema<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParallelism</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"StarRocks flink source"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre>
    <p>
     输出：
    </p>
    <pre><code class="prism language-shell"><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> +I<span class="token punctuation">(</span><span class="token number">4</span>,Julia,25<span class="token punctuation">)</span>
<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span> +I<span class="token punctuation">(</span><span class="token number">1</span>,Lily,23<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span> +I<span class="token punctuation">(</span><span class="token number">2</span>,Rose,23<span class="token punctuation">)</span>
<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> +I<span class="token punctuation">(</span><span class="token number">3</span>,Alice,24<span class="token punctuation">)</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/5095864e4d1d4acbaa8fce7f01990627.png"/>
    </p>
    <pre><code class="prism language-java">        <span class="token class-name">StarRocksSourceOptions</span> options <span class="token operator">=</span> <span class="token class-name">StarRocksSourceOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"scan-url"</span><span class="token punctuation">,</span> <span class="token string">"192.168.37.11:8030"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"jdbc-url"</span><span class="token punctuation">,</span> <span class="token string">"jdbc:mysql://192.168.37.11:9030"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"table-name"</span><span class="token punctuation">,</span> <span class="token string">"table1"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"database-name"</span><span class="token punctuation">,</span> <span class="token string">"mydatabase"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"scan.columns"</span><span class="token punctuation">,</span> <span class="token string">"id, name"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProperty</span><span class="token punctuation">(</span><span class="token string">"scan.filter"</span><span class="token punctuation">,</span> <span class="token string">"id = 4 or id = 2"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TableSchema</span> tableSchema <span class="token operator">=</span> <span class="token class-name">TableSchema</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">INT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token class-name">DataTypes</span><span class="token punctuation">.</span><span class="token function">STRING</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        env<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span><span class="token class-name">StarRocksSource</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>tableSchema<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setParallelism</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"StarRocks flink source"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     输出：
    </p>
    <pre><code class="prism language-shell"><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span> +I<span class="token punctuation">(</span><span class="token number">2</span>,Rose<span class="token punctuation">)</span>
<span class="token operator"><span class="token file-descriptor important">7</span>&gt;</span> +I<span class="token punctuation">(</span><span class="token number">4</span>,Julia<span class="token punctuation">)</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f33373733393139332f:61727469636c652f64657461696c732f313436323133353132" class_="artid" style="display:none">
 </p>
</div>


