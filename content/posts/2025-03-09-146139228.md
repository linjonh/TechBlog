---
layout: post
title: "006-获取硬件序列号"
date: 2025-03-09 21:35:09 +0800
description: "C++获取硬件序列号的核心技术，并提供可移植性代码实现。"
keywords: "006-获取硬件序列号"
categories: ['C']
tags: ['C']
artid: "146139228"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146139228
    alt: "006-获取硬件序列号"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146139228
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146139228
cover: https://bing.ee123.net/img/rand?artid=146139228
image: https://bing.ee123.net/img/rand?artid=146139228
img: https://bing.ee123.net/img/rand?artid=146139228
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     006-获取硬件序列号
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-dracula" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="_1">
     </a>
     获取硬件序列号
    </h2>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/35433bd6485239a6e5f702ad1f563083.png"/>
    </p>
    <p>
     我将从跨平台角度系统讲解如何通过C++获取硬件序列号的核心技术，并提供可移植性代码实现。
    </p>
    <h4>
     <a id="_7">
     </a>
     一、处理器序列号获取
    </h4>
    <ol>
     <li>
      Windows平台
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;intrin.h&gt;</span></span>

std<span class="token double-colon punctuation">::</span>string <span class="token function">GetCPUSerial_Win</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    DWORD cpuInfo<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">__cpuid</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>cpuInfo<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> cpuSerialNumber<span class="token punctuation">[</span>BUFFERLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">sprintf</span><span class="token punctuation">(</span>cpuSerialNumber<span class="token punctuation">,</span> <span class="token string">"%08x-%08x"</span><span class="token punctuation">,</span> cpuInfo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cpuInfo<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>cpuSerialNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     使用CPUID指令获取完整处理器信息
    </p>
    <ol start="2">
     <li>
      Linux平台
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cpuid.h&gt;</span></span>
 
std<span class="token double-colon punctuation">::</span>string <span class="token function">GetCPUSerial_Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FILE<span class="token operator">*</span> pipe <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span><span class="token string">"dmidecode -t processor | grep 'ID'"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pclose</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回类似F3A56F3E-1A格式 </span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过dmidecode命令获取物理ID
    </p>
    <ol start="3">
     <li>
      macOS平台
     </li>
    </ol>
    <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>string <span class="token function">GetCPUSerial_macOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>string serial <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span><span class="token string">"sysctl -n machdep.cpu.brand_string"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            serial <span class="token operator">+=</span> buffer<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">pclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> serial<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_54">
     </a>
     二、内存序列号获取
    </h4>
    <ol>
     <li>
      跨平台通用方法
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token comment">// Windows需包含wmi查询代码 </span>
<span class="token comment">// Linux/macOS：</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">GetMemorySerial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span></span></span>
    <span class="token comment">// WMI查询Win32_PhysicalMemory </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__linux__<span class="token punctuation">)</span></span></span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    FILE<span class="token operator">*</span> pipe <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span><span class="token string">"dmidecode -t memory | grep 'Serial Number'"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pclose</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__APPLE__<span class="token punctuation">)</span></span></span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"system_profiler SPMemoryDataType | grep 'Serial'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> </span>
    <span class="token keyword">return</span> serial<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
    <p>
     内存序列号通常需要系统级权限获取
    </p>
    <h4>
     <a id="_76">
     </a>
     三、显卡序列号获取
    </h4>
    <ol>
     <li>
      Windows实现
     </li>
    </ol>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;setupapi.h&gt;</span></span>
 
std<span class="token double-colon punctuation">::</span>string <span class="token function">GetGPUSerial_Win</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    DISPLAY_DEVICE dd<span class="token punctuation">;</span>
    dd<span class="token punctuation">.</span>cb  <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DISPLAY_DEVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EnumDisplayDevices</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>dd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> dd<span class="token punctuation">.</span>DeviceID<span class="token punctuation">;</span> <span class="token comment">// 返回PCI\VEN_10DE&amp;DEV_2206格式 </span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过显示设备枚举获取硬件ID
    </p>
    <ol start="2">
     <li>
      Linux实现
     </li>
    </ol>
    <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>string <span class="token function">GetGPUSerial_Linux</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre>
    <p>
     直接从DRM接口读取信息
    </p>
    <h4>
     <a id="_99">
     </a>
     四、硬盘序列号获取
    </h4>
    <ol>
     <li>
      跨平台实现框架
     </li>
    </ol>
    <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>string <span class="token function">GetDiskSerial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span></span></span>
    <span class="token comment">// wmic diskdrive get serialnumber</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__linux__<span class="token punctuation">)</span></span></span>
    <span class="token comment">// udevadm info --query=all --name=/dev/sda | grep ID_SERIAL_SHORT</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__APPLE__<span class="token punctuation">)</span></span></span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"diskutil info disk0 | grep 'Device Identifier'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> </span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     Windows需要管理员权限获取物理序列号
    </p>
    <h4>
     <a id="_114">
     </a>
     五、完整跨平台代码结构
    </h4>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
 
<span class="token keyword">class</span> <span class="token class-name">HardwareInfo</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">GetCPUSerial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span></span></span>
            <span class="token comment">// Windows实现 </span>
        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__linux__<span class="token punctuation">)</span></span></span>
            <span class="token comment">// Linux实现 </span>
        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__APPLE__<span class="token punctuation">)</span></span></span>
            <span class="token comment">// macOS实现 </span>
        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> </span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 其他硬件获取方法同理...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"CPU Serial: "</span> <span class="token operator">&lt;&lt;</span> <span class="token class-name">HardwareInfo</span><span class="token double-colon punctuation">::</span><span class="token function">GetCPUSerial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token comment">// 输出其他硬件信息...</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="_140">
     </a>
     六、注意事项
    </h4>
    <p>
     权限要求：Linux/macOS需root权限获取完整信息
     <br/>
     硬件差异：虚拟机可能返回非物理硬件ID
     <br/>
     RAID阵列：存储设备组RAID后可能无法获取物理序列号
     <br/>
     安全策略：Windows需启用WMI服务，macOS需签名后执行
     <br/>
     完整代码实现参考来源：。不同平台的具体实现细节可查阅各操作系统的硬件访问API文档。
    </p>
    <h4>
     <a id="_147">
     </a>
     七、防止篡改
    </h4>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/e52a0d053ef63e78eceaa3eafa7503e0.png"/>
    </p>
    <p>
     针对硬件信息获取代码防Hook篡改的防护方案，需结合操作系统特性和安全机制设计多层次防御体系。以下从代码防护、运行时检测、系统加固三个维度提供解决方案：
    </p>
    <h5>
     <a id="1_153">
     </a>
     1、核心代码防护策略
    </h5>
    <ul>
     <li>
      关键函数完整性校验
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token comment">// Windows代码段CRC校验示例</span>
DWORD <span class="token function">CalculateFunctionCRC</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> funcAddr<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    DWORD crc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>size_t i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        crc <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span>funcAddr<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">255</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> crc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">VerifyCPUIDFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> DWORD expectedCRC <span class="token operator">=</span> <span class="token number">0x12AB34CD</span><span class="token punctuation">;</span> <span class="token comment">// 预计算的安全哈希值</span>
    DWORD actualCRC <span class="token operator">=</span> <span class="token function">CalculateFunctionCRC</span><span class="token punctuation">(</span>GetCPUSerial_Win<span class="token punctuation">,</span> <span class="token number">0x200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>actualCRC <span class="token operator">!=</span> expectedCRC<span class="token punctuation">)</span> <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 检测到篡改立即终止</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     通过计算关键函数内存哈希值，防范Inline Hook注入
    </p>
    <ul>
     <li>
      系统调用直通技术
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token comment">// Linux直接调用syscall绕过glibc Hook</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">SafeDmidecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">syscall</span><span class="token punctuation">(</span>SYS_execve<span class="token punctuation">,</span> <span class="token string">"/usr/sbin/dmidecode"</span><span class="token punctuation">,</span> <span class="token string">"-t processor"</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 绕过可能被Hook的库函数</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     绕过可能被劫持的库函数，直接使用syscall指令
    </p>
    <h5>
     <a id="2_183">
     </a>
     2、运行时环境检测
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        检测类型
       </th>
       <th>
        Windows实现
       </th>
       <th>
        Linux/macOS实现
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        调试器检测
       </td>
       <td>
        IsDebuggerPresent()+CheckRemoteDebuggerPresent()组合检测
       </td>
       <td>
        检查/proc/self/status中TracerPid值
       </td>
      </tr>
      <tr>
       <td>
        内存篡改检测
       </td>
       <td>
        VirtualQuery检查代码段内存保护属性
       </td>
       <td>
        mprotect设置代码段为只读
       </td>
      </tr>
      <tr>
       <td>
        Hook特征扫描
       </td>
       <td>
        扫描API函数头5字节的JMP指令特征
       </td>
       <td>
        使用dl_iterate_phdr检测PLT Hook
       </td>
      </tr>
      <tr>
       <td>
        环境完整性校验
       </td>
       <td>
        校验硬件信息获取相关系统文件数字签名
       </td>
       <td>
        验证dmidecode等工具的HASH值
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     采用多线程定时轮询检测机制，异常时触发熔断逻辑
    </p>
    <h5>
     <a id="3_194">
     </a>
     3、系统级防护加固
    </h5>
    <ul>
     <li>
      权限最小化原则
     </li>
    </ul>
    <p>
     Windows：为进程配置Mandatory Integrity Control，设置低完整性级别
     <br/>
     Linux：通过capabilities机制限制CAP_SYS_RAWIO等敏感权限
     <br/>
     macOS：启用SIP(System Integrity Protection)并签名可执行文件
    </p>
    <ul>
     <li>
      通信加密通道
     </li>
    </ul>
    <pre><code class="prism language-cpp"><span class="token comment">// 使用TPM模块加密传输</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">GetEncryptedSerial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>string raw <span class="token operator">=</span> <span class="token function">GetCPUSerial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">TpmEncrypt</span><span class="token punctuation">(</span>raw<span class="token punctuation">,</span> TPM_AIK_CERT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过可信平台模块加密</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     结合安全硬件模块实现端到端加密
    </p>
    <ul>
     <li>
      防御性编程模式
     </li>
     <li>
      关键数据采用XOR双存储校验
     </li>
     <li>
      使用std::atexit注册异常清理函数
     </li>
     <li>
      实现反内存dump的代码自修改技术
     </li>
    </ul>
    <h5>
     <a id="4_214">
     </a>
     4、跨平台防御方案对比
    </h5>
    <table>
     <thead>
      <tr>
       <th>
        防护维度
       </th>
       <th>
        Windows优势方案
       </th>
       <th>
        Linux优势方案
       </th>
       <th>
        macOS特色机制
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        API防护
       </td>
       <td>
        Detours库Hook检测
       </td>
       <td>
        LD_PRELOAD环境变量监控
       </td>
       <td>
        dyld插桩检测
       </td>
      </tr>
      <tr>
       <td>
        内存保护
       </td>
       <td>
        VEH异常处理
       </td>
       <td>
        mprotect+seccomp
       </td>
       <td>
        MAP_JIT内存属性
       </td>
      </tr>
      <tr>
       <td>
        可信执行
       </td>
       <td>
        Device Guard
       </td>
       <td>
        IMA完整性测量架构
       </td>
       <td>
        Secure Enclave
       </td>
      </tr>
      <tr>
       <td>
        更新策略
       </td>
       <td>
        驱动签名强制验证
       </td>
       <td>
        内核模块签名验证
       </td>
       <td>
        Notarization公证机制
       </td>
      </tr>
     </tbody>
    </table>
    <p>
     建议采用分层防御架构，组合应用至少3种不同机制的防护方案
    </p>
    <h5>
     <a id="5_225">
     </a>
     5、对抗升级建议
    </h5>
    <ul>
     <li>
      动态混淆技术：每次运行时重构关键代码的指令序列
     </li>
     <li>
      可信验证链：建立从固件层到应用层的完整信任链验证
     </li>
     <li>
      AI行为分析：通过机器学习模型识别异常Hook模式
     </li>
     <li>
      硬件绑定：将关键逻辑与TPM/安全芯片绑定
     </li>
    </ul>
    <p>
     通过上述方案组合实施，可有效对抗90%以上的常规Hook攻击。但需注意，安全防护需持续迭代更新，建议建立自动化攻击模拟测试环境，定期验证防护措施有效性。
    </p>
    <h3>
     <a id="_233">
     </a>
     完整代码
    </h3>
    <p>
     <a href="https://github.com/zhengtianzuo/zhengtianzuo.github.io/tree/master/code/006-GetSerialNumber">
      Github
     </a>
    </p>
    <table>
     <thead>
      <tr>
       <th>
       </th>
       <th>
       </th>
       <th>
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        作者
       </td>
       <td>
        郑天佐
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        邮箱
       </td>
       <td>
        zhengtianzuo06@163.com
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        主页
       </td>
       <td>
        <a href="http://www.zhengtianzuo.com" rel="nofollow">
         http://www.zhengtianzuo.com
        </a>
       </td>
       <td>
       </td>
      </tr>
      <tr>
       <td>
        github
       </td>
       <td>
        <a href="https://github.com/zhengtianzuo">
         https://github.com/zhengtianzuo
        </a>
       </td>
       <td>
       </td>
      </tr>
     </tbody>
    </table>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f67:2e6373646e2e6e65742f7a68656e677469616e7a756f30362f:61727469636c652f64657461696c732f313436313339323238" class_="artid" style="display:none">
 </p>
</div>


