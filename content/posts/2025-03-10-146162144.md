---
layout: post
title: "Go-Ebiten小游戏开发俄罗斯方块"
date: 2025-03-10 19:45:32 +0800
description: "在这篇文章中，我们将一起开发一个简单的俄罗斯方块游戏，使用Go语言和Ebiten游戏库。Ebiten是一个轻量级的游戏库，适合快速开发2D游戏。我们将逐步构建游戏的基本功能，包括游戏逻辑、图形绘制和用户输入处理。"
keywords: "Go Ebiten小游戏开发：俄罗斯方块"
categories: ['小游戏开发', 'Go']
tags: ['Golang']
artid: "146162144"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146162144
    alt: "Go-Ebiten小游戏开发俄罗斯方块"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146162144
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146162144
cover: https://bing.ee123.net/img/rand?artid=146162144
image: https://bing.ee123.net/img/rand?artid=146162144
img: https://bing.ee123.net/img/rand?artid=146162144
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Go Ebiten小游戏开发：俄罗斯方块
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-github-gist" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
     在这篇文章中，我们将一起开发一个简单的俄罗斯方块游戏，使用Go语言和Ebiten游戏库。Ebiten是一个轻量级的游戏库，适合快速开发2D游戏。我们将逐步构建游戏的基本功能，包括游戏逻辑、图形绘制和用户输入处理。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/d9ca872d784941e78099bffce0366db9.png"/>
    </p>
    <h3>
     <a id="_5">
     </a>
     项目结构
    </h3>
    <p>
     我们的项目将包含以下主要部分：
    </p>
    <ul>
     <li>
      游戏状态管理
     </li>
     <li>
      方块生成与移动
     </li>
     <li>
      碰撞检测
     </li>
     <li>
      行消除与计分
     </li>
     <li>
      游戏界面绘制
     </li>
    </ul>
    <h3>
     <a id="_15">
     </a>
     游戏状态管理
    </h3>
    <p>
     首先，我们定义一个
     <code>
      Game
     </code>
     结构体来管理游戏的状态。它包含游戏板、当前方块、下一个方块、分数、等级等信息。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Game <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	board        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
	currentPiece <span class="token operator">*</span>Piece
	nextPiece    <span class="token operator">*</span>Piece <span class="token comment">// 下一个方块</span>
	gameOver     <span class="token builtin">bool</span>
	dropTimer    <span class="token builtin">int</span>
	score        <span class="token builtin">int</span>  <span class="token comment">// 得分</span>
	level        <span class="token builtin">int</span>  <span class="token comment">// 当前等级</span>
	lines        <span class="token builtin">int</span>  <span class="token comment">// 已消除的行数</span>
	paused       <span class="token builtin">bool</span> <span class="token comment">// 暂停状态</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     我们还需要定义一个
     <code>
      Piece
     </code>
     结构体来表示俄罗斯方块的形状和位置。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">type</span> Piece <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	shape <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
	x<span class="token punctuation">,</span> y  <span class="token builtin">int</span>
	color <span class="token builtin">int</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_43">
     </a>
     初始化游戏
    </h3>
    <p>
     在
     <code>
      NewGame
     </code>
     函数中，我们初始化游戏状态，包括创建游戏板和生成初始方块。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">NewGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Game <span class="token punctuation">{<!-- --></span>
	game <span class="token operator">:=</span> <span class="token operator">&amp;</span>Game<span class="token punctuation">{<!-- --></span>
		board<span class="token punctuation">:</span>     <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> boardHeight<span class="token punctuation">)</span><span class="token punctuation">,</span>
		dropTimer<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		level<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span>
		score<span class="token punctuation">:</span>     <span class="token number">0</span><span class="token punctuation">,</span>
		lines<span class="token punctuation">:</span>     <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> game<span class="token punctuation">.</span>board <span class="token punctuation">{<!-- --></span>
		game<span class="token punctuation">.</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> boardWidth<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	game<span class="token punctuation">.</span>nextPiece <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">generateNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	game<span class="token punctuation">.</span><span class="token function">spawnNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> game
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_68">
     </a>
     游戏逻辑
    </h3>
    <p>
     在
     <code>
      Update
     </code>
     方法中，我们处理游戏逻辑，包括用户输入、方块移动和下落。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 处理键盘输入</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyLeft<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">moveLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyRight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">moveRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ebiten<span class="token punctuation">.</span><span class="token function">IsKeyPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyDown<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">moveDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyUp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 控制方块下落速度</span>
	g<span class="token punctuation">.</span>dropTimer<span class="token operator">++</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>dropTimer <span class="token operator">&gt;=</span> dropSpeed <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>dropTimer <span class="token operator">=</span> <span class="token number">0</span>
		g<span class="token punctuation">.</span><span class="token function">moveDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_99">
     </a>
     碰撞检测
    </h3>
    <p>
     我们需要检查方块是否可以移动或旋转，这通过
     <code>
      isValidPosition
     </code>
     方法实现。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				newX <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x <span class="token operator">+</span> x
				newY <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y <span class="token operator">+</span> y

				<span class="token keyword">if</span> newX <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> newX <span class="token operator">&gt;=</span> boardWidth <span class="token operator">||</span> newY <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> newY <span class="token operator">&gt;=</span> boardHeight <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">return</span> <span class="token boolean">false</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>newY<span class="token punctuation">]</span><span class="token punctuation">[</span>newX<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">return</span> <span class="token boolean">false</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_125">
     </a>
     行消除与计分
    </h3>
    <p>
     当方块锁定到游戏板时，我们需要检查是否有完整的行，并进行消除和计分。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">clearLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	linesCleared <span class="token operator">:=</span> <span class="token number">0</span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> boardHeight <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> y<span class="token operator">--</span> <span class="token punctuation">{<!-- --></span>
		isFull <span class="token operator">:=</span> <span class="token boolean">true</span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> boardWidth<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				isFull <span class="token operator">=</span> <span class="token boolean">false</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> isFull <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> moveY <span class="token operator">:=</span> y<span class="token punctuation">;</span> moveY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> moveY<span class="token operator">--</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">copy</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>moveY<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>moveY<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> boardWidth<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				g<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token punctuation">}</span>
			linesCleared<span class="token operator">++</span>
			y<span class="token operator">++</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> linesCleared <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>lines <span class="token operator">+=</span> linesCleared
		g<span class="token punctuation">.</span>score <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">}</span><span class="token punctuation">[</span>linesCleared<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> g<span class="token punctuation">.</span>level
		g<span class="token punctuation">.</span>level <span class="token operator">=</span> g<span class="token punctuation">.</span>lines<span class="token operator">/</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_161">
     </a>
     绘制游戏界面
    </h3>
    <p>
     最后，我们在
     <code>
      Draw
     </code>
     方法中绘制游戏界面，包括游戏板、当前方块、下一个方块和游戏信息。
    </p>
    <pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">Draw</span><span class="token punctuation">(</span>screen <span class="token operator">*</span>ebiten<span class="token punctuation">.</span>Image<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 绘制游戏板</span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> boardHeight<span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> boardWidth<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 绘制当前方块</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x<span class="token operator">+</span>x<span class="token punctuation">,</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y<span class="token operator">+</span>y<span class="token punctuation">,</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 绘制下一个方块预览</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>nextPiece <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> boardWidth<span class="token operator">+</span><span class="token number">2</span><span class="token operator">+</span>x<span class="token punctuation">,</span> <span class="token number">4</span><span class="token operator">+</span>y<span class="token punctuation">,</span> g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 绘制游戏信息</span>
	ebitenutil<span class="token punctuation">.</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"\nScore: %d\nLevel: %d\nLines: %d"</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>score<span class="token punctuation">,</span> g<span class="token punctuation">.</span>level<span class="token punctuation">,</span> g<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="_203">
     </a>
     结论
    </h3>
    <p>
     通过以上步骤，我们已经实现了一个基本的俄罗斯方块游戏。你可以在此基础上添加更多功能，比如音效、菜单、不同的方块形状等。希望这篇文章能帮助你入门Go语言游戏开发，并激发你创造更复杂的游戏项目！
    </p>
    <h3>
     <a id="_207">
     </a>
     完整代码
    </h3>
    <p>
     <code>
      main.go
     </code>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"image/color"</span>
	<span class="token string">"log"</span>
	<span class="token string">"math/rand"</span>

	<span class="token string">"github.com/hajimehoshi/ebiten/v2"</span>
	<span class="token string">"github.com/hajimehoshi/ebiten/v2/ebitenutil"</span>
	<span class="token string">"github.com/hajimehoshi/ebiten/v2/inpututil"</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	screenWidth  <span class="token operator">=</span> <span class="token number">320</span>
	screenHeight <span class="token operator">=</span> <span class="token number">640</span>
	blockSize    <span class="token operator">=</span> <span class="token number">32</span>
	boardWidth   <span class="token operator">=</span> <span class="token number">10</span>
	boardHeight  <span class="token operator">=</span> <span class="token number">20</span>
<span class="token punctuation">)</span>

<span class="token comment">// Game 表示游戏状态</span>
<span class="token keyword">type</span> Game <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	board        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
	currentPiece <span class="token operator">*</span>Piece
	nextPiece    <span class="token operator">*</span>Piece <span class="token comment">// 下一个方块</span>
	gameOver     <span class="token builtin">bool</span>
	dropTimer    <span class="token builtin">int</span>
	score        <span class="token builtin">int</span>  <span class="token comment">// 得分</span>
	level        <span class="token builtin">int</span>  <span class="token comment">// 当前等级</span>
	lines        <span class="token builtin">int</span>  <span class="token comment">// 已消除的行数</span>
	paused       <span class="token builtin">bool</span> <span class="token comment">// 暂停状态</span>
	<span class="token comment">// 添加动画相关字段</span>
	clearingLines  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token comment">// 正在消除的行</span>
	clearAnimation <span class="token builtin">int</span>   <span class="token comment">// 动画计时器</span>
	isClearing     <span class="token builtin">bool</span>  <span class="token comment">// 是否正在播放消除动画</span>
<span class="token punctuation">}</span>

<span class="token comment">// Piece 表示俄罗斯方块的一个方块</span>
<span class="token keyword">type</span> Piece <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	shape <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
	x<span class="token punctuation">,</span> y  <span class="token builtin">int</span>
	color <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// NewGame 创建新游戏实例</span>
<span class="token keyword">func</span> <span class="token function">NewGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Game <span class="token punctuation">{<!-- --></span>
	game <span class="token operator">:=</span> <span class="token operator">&amp;</span>Game<span class="token punctuation">{<!-- --></span>
		board<span class="token punctuation">:</span>     <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> boardHeight<span class="token punctuation">)</span><span class="token punctuation">,</span>
		dropTimer<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		level<span class="token punctuation">:</span>     <span class="token number">1</span><span class="token punctuation">,</span>
		score<span class="token punctuation">:</span>     <span class="token number">0</span><span class="token punctuation">,</span>
		lines<span class="token punctuation">:</span>     <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 初始化游戏板</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> game<span class="token punctuation">.</span>board <span class="token punctuation">{<!-- --></span>
		game<span class="token punctuation">.</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> boardWidth<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 创建初始方块和下一个方块</span>
	game<span class="token punctuation">.</span>nextPiece <span class="token operator">=</span> game<span class="token punctuation">.</span><span class="token function">generateNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	game<span class="token punctuation">.</span><span class="token function">spawnNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> game
<span class="token punctuation">}</span>

<span class="token comment">// Update 处理游戏逻辑</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 重启游戏</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>gameOver <span class="token operator">&amp;&amp;</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeySpace<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token operator">*</span>g <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">NewGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 暂停/继续</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyP<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token operator">!</span>g<span class="token punctuation">.</span>paused
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> g<span class="token punctuation">.</span>gameOver <span class="token operator">||</span> g<span class="token punctuation">.</span>paused <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 更新消除动画</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>isClearing <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">updateClearAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 处理键盘输入</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyLeft<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">moveLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyRight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">moveRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> ebiten<span class="token punctuation">.</span><span class="token function">IsKeyPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyDown<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">moveDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> inpututil<span class="token punctuation">.</span><span class="token function">IsKeyJustPressed</span><span class="token punctuation">(</span>ebiten<span class="token punctuation">.</span>KeyUp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 根据等级调整下落速度</span>
	g<span class="token punctuation">.</span>dropTimer<span class="token operator">++</span>
	dropSpeed <span class="token operator">:=</span> <span class="token number">60</span> <span class="token operator">-</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>level<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span> <span class="token comment">// 每提升一级，加快5帧</span>
	<span class="token keyword">if</span> dropSpeed <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">{<!-- --></span>             <span class="token comment">// 最快速度限制</span>
		dropSpeed <span class="token operator">=</span> <span class="token number">20</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>dropTimer <span class="token operator">&gt;=</span> dropSpeed <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>dropTimer <span class="token operator">=</span> <span class="token number">0</span>
		g<span class="token punctuation">.</span><span class="token function">moveDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// Draw 绘制游戏画面</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">Draw</span><span class="token punctuation">(</span>screen <span class="token operator">*</span>ebiten<span class="token punctuation">.</span>Image<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 绘制游戏板</span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> boardHeight<span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> boardWidth<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 检查是否是正在消除的行</span>
				isClearing <span class="token operator">:=</span> <span class="token boolean">false</span>
				<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> clearY <span class="token operator">:=</span> <span class="token keyword">range</span> g<span class="token punctuation">.</span>clearingLines <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> y <span class="token operator">==</span> clearY <span class="token punctuation">{<!-- --></span>
						isClearing <span class="token operator">=</span> <span class="token boolean">true</span>
						<span class="token keyword">break</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> isClearing <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 闪烁效果</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>g<span class="token punctuation">.</span>clearAnimation<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 绘制发光效果</span>
						<span class="token function">drawGlowingBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 绘制当前方块</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span>
						g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x<span class="token operator">+</span>x<span class="token punctuation">,</span>
						g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y<span class="token operator">+</span>y<span class="token punctuation">,</span>
						g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 绘制下一个方块预览</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>nextPiece <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span>
						boardWidth<span class="token operator">+</span><span class="token number">2</span><span class="token operator">+</span>x<span class="token punctuation">,</span>
						<span class="token number">4</span><span class="token operator">+</span>y<span class="token punctuation">,</span>
						g<span class="token punctuation">.</span>nextPiece<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 绘制游戏信息</span>
	ebitenutil<span class="token punctuation">.</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>
		<span class="token string">"\nScore: %d\nLevel: %d\nLines: %d"</span><span class="token punctuation">,</span>
		g<span class="token punctuation">.</span>score<span class="token punctuation">,</span> g<span class="token punctuation">.</span>level<span class="token punctuation">,</span> g<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// 绘制游戏状态</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>gameOver <span class="token punctuation">{<!-- --></span>
		ebitenutil<span class="token punctuation">.</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span>
			<span class="token string">"\n\n\n\nGame Over!\nPress SPACE to restart"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> g<span class="token punctuation">.</span>paused <span class="token punctuation">{<!-- --></span>
		ebitenutil<span class="token punctuation">.</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span>
			<span class="token string">"\n\n\n\nPAUSED\nPress P to continue"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// drawBlock 绘制单个方块</span>
<span class="token keyword">func</span> <span class="token function">drawBlock</span><span class="token punctuation">(</span>screen <span class="token operator">*</span>ebiten<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> colorIndex <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	ebitenutil<span class="token punctuation">.</span><span class="token function">DrawRect</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>x<span class="token operator">*</span>blockSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>y<span class="token operator">*</span>blockSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>blockSize<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>blockSize<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{<!-- --></span>
			R<span class="token punctuation">:</span> <span class="token function">uint8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			G<span class="token punctuation">:</span> <span class="token function">uint8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			B<span class="token punctuation">:</span> <span class="token function">uint8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			A<span class="token punctuation">:</span> <span class="token function">uint8</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// drawGlowingBlock 绘制发光的方块</span>
<span class="token keyword">func</span> <span class="token function">drawGlowingBlock</span><span class="token punctuation">(</span>screen <span class="token operator">*</span>ebiten<span class="token punctuation">.</span>Image<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> colorIndex <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 绘制发光效果（略大一点的白色半透明方块）</span>
	ebitenutil<span class="token punctuation">.</span><span class="token function">DrawRect</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>x<span class="token operator">*</span>blockSize<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>y<span class="token operator">*</span>blockSize<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>blockSize<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token function">float64</span><span class="token punctuation">(</span>blockSize<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		color<span class="token punctuation">.</span>RGBA<span class="token punctuation">{<!-- --></span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 绘制实际的方块</span>
	<span class="token function">drawBlock</span><span class="token punctuation">(</span>screen<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> colorIndex<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// moveLeft 向左移动当前方块</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">moveLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x<span class="token operator">--</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>g<span class="token punctuation">.</span><span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x<span class="token operator">++</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// moveRight 向右移动当前方块</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">moveRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x<span class="token operator">++</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>g<span class="token punctuation">.</span><span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x<span class="token operator">--</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// moveDown 向下移动当前方块</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">moveDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y<span class="token operator">++</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>g<span class="token punctuation">.</span><span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y<span class="token operator">--</span>
		g<span class="token punctuation">.</span><span class="token function">lockPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// isValidPosition 检查当前方块位置是否有效</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				newX <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x <span class="token operator">+</span> x
				newY <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y <span class="token operator">+</span> y

				<span class="token keyword">if</span> newX <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> newX <span class="token operator">&gt;=</span> boardWidth <span class="token operator">||</span>
					newY <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> newY <span class="token operator">&gt;=</span> boardHeight <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">return</span> <span class="token boolean">false</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>newY<span class="token punctuation">]</span><span class="token punctuation">[</span>newX<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">return</span> <span class="token boolean">false</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// Layout 实现必要的 Ebiten 接口方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">Layout</span><span class="token punctuation">(</span>outsideWidth<span class="token punctuation">,</span> outsideHeight <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> screenWidth<span class="token punctuation">,</span> screenHeight
<span class="token punctuation">}</span>

<span class="token comment">// rotate 旋转当前方块</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 创建新的旋转后的形状</span>
	oldShape <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape
	height <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>oldShape<span class="token punctuation">)</span>
	width <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>oldShape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	newShape <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> newShape <span class="token punctuation">{<!-- --></span>
		newShape<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> height<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 执行90度旋转</span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			newShape<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>height<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> oldShape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 保存原来的形状，以便在新位置无效时恢复</span>
	originalShape <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape
	g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape <span class="token operator">=</span> newShape

	<span class="token comment">// 如果新位置无效，恢复原来的形状</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>g<span class="token punctuation">.</span><span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape <span class="token operator">=</span> originalShape
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// lockPiece 将当前方块锁定到游戏板上</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">lockPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 将方块添加到游戏板</span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span> y<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>shape<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				boardY <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>y <span class="token operator">+</span> y
				boardX <span class="token operator">:=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>x <span class="token operator">+</span> x
				g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>boardY<span class="token punctuation">]</span><span class="token punctuation">[</span>boardX<span class="token punctuation">]</span> <span class="token operator">=</span> g<span class="token punctuation">.</span>currentPiece<span class="token punctuation">.</span>color
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 检查并清除完整的行</span>
	g<span class="token punctuation">.</span><span class="token function">clearLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 生成新的方块</span>
	g<span class="token punctuation">.</span><span class="token function">spawnNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 检查游戏是否结束</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>g<span class="token punctuation">.</span><span class="token function">isValidPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>gameOver <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// clearLines 检查完整的行</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">clearLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>isClearing <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 检查完整的行</span>
	g<span class="token punctuation">.</span>clearingLines <span class="token operator">=</span> <span class="token boolean">nil</span>
	<span class="token keyword">for</span> y <span class="token operator">:=</span> boardHeight <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> y<span class="token operator">--</span> <span class="token punctuation">{<!-- --></span>
		isFull <span class="token operator">:=</span> <span class="token boolean">true</span>
		<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> boardWidth<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				isFull <span class="token operator">=</span> <span class="token boolean">false</span>
				<span class="token keyword">break</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> isFull <span class="token punctuation">{<!-- --></span>
			g<span class="token punctuation">.</span>clearingLines <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>clearingLines<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 如果有要消除的行，开始动画</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>clearingLines<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		g<span class="token punctuation">.</span>isClearing <span class="token operator">=</span> <span class="token boolean">true</span>
		g<span class="token punctuation">.</span>clearAnimation <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// updateClearAnimation 更新消除动画</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">updateClearAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token operator">!</span>g<span class="token punctuation">.</span>isClearing <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	g<span class="token punctuation">.</span>clearAnimation<span class="token operator">++</span>

	<span class="token comment">// 动画结束后执行实际的消除</span>
	<span class="token keyword">if</span> g<span class="token punctuation">.</span>clearAnimation <span class="token operator">&gt;=</span> <span class="token number">30</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 0.5秒动画(30帧)</span>
		<span class="token comment">// 执行实际的消除</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> y <span class="token operator">:=</span> <span class="token keyword">range</span> g<span class="token punctuation">.</span>clearingLines <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 从当前行开始，将每一行都复制为上一行的内容</span>
			<span class="token keyword">for</span> moveY <span class="token operator">:=</span> y<span class="token punctuation">;</span> moveY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> moveY<span class="token operator">--</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">copy</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>moveY<span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>moveY<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 清空最上面的行</span>
			<span class="token keyword">for</span> x <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> boardWidth<span class="token punctuation">;</span> x<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
				g<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 更新分数和等级</span>
		linesCleared <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>clearingLines<span class="token punctuation">)</span>
		g<span class="token punctuation">.</span>lines <span class="token operator">+=</span> linesCleared
		g<span class="token punctuation">.</span>score <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">}</span><span class="token punctuation">[</span>linesCleared<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> g<span class="token punctuation">.</span>level
		g<span class="token punctuation">.</span>level <span class="token operator">=</span> g<span class="token punctuation">.</span>lines<span class="token operator">/</span><span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span>

		<span class="token comment">// 重置动画状态</span>
		g<span class="token punctuation">.</span>isClearing <span class="token operator">=</span> <span class="token boolean">false</span>
		g<span class="token punctuation">.</span>clearingLines <span class="token operator">=</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// generateNewPiece 生成一个新的随机方块</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">generateNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Piece <span class="token punctuation">{<!-- --></span>
	pieceIndex <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>tetrominoes<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Piece<span class="token punctuation">{<!-- --></span>
		shape<span class="token punctuation">:</span> tetrominoes<span class="token punctuation">[</span>pieceIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>
		x<span class="token punctuation">:</span>     boardWidth<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token function">len</span><span class="token punctuation">(</span>tetrominoes<span class="token punctuation">[</span>pieceIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
		y<span class="token punctuation">:</span>     <span class="token number">0</span><span class="token punctuation">,</span>
		color<span class="token punctuation">:</span> pieceIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// spawnNewPiece 生成新的方块</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>g <span class="token operator">*</span>Game<span class="token punctuation">)</span> <span class="token function">spawnNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	g<span class="token punctuation">.</span>currentPiece <span class="token operator">=</span> g<span class="token punctuation">.</span>nextPiece
	g<span class="token punctuation">.</span>nextPiece <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">generateNewPiece</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	game <span class="token operator">:=</span> <span class="token function">NewGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	ebiten<span class="token punctuation">.</span><span class="token function">SetWindowSize</span><span class="token punctuation">(</span>screenWidth<span class="token punctuation">,</span> screenHeight<span class="token punctuation">)</span>
	ebiten<span class="token punctuation">.</span><span class="token function">SetWindowTitle</span><span class="token punctuation">(</span><span class="token string">"俄罗斯方块"</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> err <span class="token operator">:=</span> ebiten<span class="token punctuation">.</span><span class="token function">RunGame</span><span class="token punctuation">(</span>game<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
    <hr/>
    <p>
     <code>
      piece.go
     </code>
    </p>
    <pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"math/rand"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 在init函数中初始化随机数种子</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义所有可能的方块形状</span>
<span class="token keyword">var</span> tetrominoes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// I</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// O</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// T</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// L</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// J</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// S</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{<!-- --></span> <span class="token comment">// Z</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方块颜色定义</span>
<span class="token keyword">var</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{<!-- --></span>
	<span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">0xFF0000FF</span><span class="token punctuation">,</span> <span class="token comment">// 红色</span>
	<span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">0x00FF00FF</span><span class="token punctuation">,</span> <span class="token comment">// 绿色</span>
	<span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">0x0000FFFF</span><span class="token punctuation">,</span> <span class="token comment">// 蓝色</span>
	<span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">0xFFFF00FF</span><span class="token punctuation">,</span> <span class="token comment">// 黄色</span>
	<span class="token number">5</span><span class="token punctuation">:</span> <span class="token number">0xFF00FFFF</span><span class="token punctuation">,</span> <span class="token comment">// 紫色</span>
	<span class="token number">6</span><span class="token punctuation">:</span> <span class="token number">0x00FFFFFF</span><span class="token punctuation">,</span> <span class="token comment">// 青色</span>
	<span class="token number">7</span><span class="token punctuation">:</span> <span class="token number">0xFFA500FF</span><span class="token punctuation">,</span> <span class="token comment">// 橙色</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f71715f32323332383031312f:61727469636c652f64657461696c732f313436313632313434" class_="artid" style="display:none">
 </p>
</div>


