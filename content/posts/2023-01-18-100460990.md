---
layout: post
title: "通过链接服务器把一台服务器的数据insert到另一台服务器上"
date: 2023-01-18 10:47:39 +0800
description: "Server A[10.0.0.1]：建立到Server B的链接服务器Server B[10.0."
keywords: "两个服务器之间的插入和更新语句"
categories: ['未分类']
tags: ['数据库', '操作系统']
artid: "100460990"
image:
  path: https://api.vvhan.com/api/bing?rand=sj&artid=100460990
  alt: "通过链接服务器把一台服务器的数据insert到另一台服务器上"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=100460990
featuredImagePreview: https://bing.ee123.net/img/rand?artid=100460990
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     通过链接服务器把一台服务器的数据insert到另一台服务器上
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <div class="preview-main">
     Server A 
 [10.0.0.1]：
     <br/>
     建立到Server B的链接服务器
     <br/>
     <br/>
     Server B 
 [10.0.0.2]：
     <br/>
     建立用户链接服务器的数据库账号
     <br/>
     <br/>
     Server A：
     <br/>
     执行脚本：
     <br/>
     set XACT_ABORT ON
     <br/>
     Begin Try
     <br/>
     Begin distributed Tran
     <br/>
     Insert Into [10.0.0.2].[B].[dbo].[tableB]
     <br/>
     (bid,
     <br/>
     company,
     <br/>
     tel
     <br/>
     )
     <br/>
     <br/>
     SELECT  [bid]
     <br/>
     ,[company]
     <br/>
     ,[tel]
     <br/>
     FROM [A].[dbo].[tableA] t
     <br/>
     where t.code='11' and  t.type='ERROR'
     <br/>
     <br/>
     Commit Tran
     <br/>
     End Try
     <br/>
     <br/>
     Begin Catch
     <br/>
     Rollback Tran
     <br/>
     End Catch
     <br/>
     <br/>
     由于目标表的id为自增列，可以不insert目标表的id自增列，也可以设置目标表的id自增列可以insert。
     <br/>
     <p align="left" class="MsoNormal">
      SET IDENTITY_INSERT tableB ON
     </p>
     <p align="left" class="MsoNormal">
      让目标表的自增列可以
      <span lang="en-us">
       insert
      </span>
      记录。
     </p>
     <p align="left" class="MsoNormal">
      insert完毕关闭目标表的IDENTITY_INSERT
     </p>
     <p align="left" class="MsoNormal">
      SET IDENTITY_INSERT tableB OFF
     </p>
     <br/>
     这里选择不insert目标表的id自增列，让id自增列自己增加。
     <br/>
     <br/>
     报错：
     <br/>
     <span style="color:#666666;font-family:'宋体', Arial;">
      该伙伴事务管理器已经禁止了它对远程/网络事务的支持
     </span>
     <br/>
     <br/>
     <span style="color:#666666;font-family:'宋体', Arial;">
      在远程主机没有开启网络DTC访问。
     </span>
     <br style="color:#666666;font-family:'宋体', Arial;"/>
     <span style="color:#666666;font-family:'宋体', Arial;">
      http://blog.csdn.net/apollokk/article/details/51543349
     </span>
     <br/>
     <br/>
     <strong style="color:#4B4B4B;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:18px;line-height:19.5px;">
      <span style="line-height:normal;border-collapse:separate;font-family:Simsun;color:#000000;border-spacing:0px;">
       <span style="line-height:23px;font-family:Arial;">
        双方启动MSDTC服务
       </span>
      </span>
     </strong>
     <br style="color:#666666;font-family:'宋体', Arial;"/>
     <div style="color:#4B4B4B;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:19.5px;">
      <span style="line-height:1.5;font-family:'宋体';font-size:12pt;">
       <span style="line-height:1.5;font-size:12pt;">
        <span style="line-height:1.5;font-size:14pt;">
         <span style="line-height:1.5;font-size:12pt;">
          <span style="line-height:1.5;font-family:Arial;font-size:10pt;">
           (1)在windows控制面版--&gt;管理工具--&gt;服务--&gt;Distributed Transaction Coordinator--&gt;属性--&gt;启动
          </span>
         </span>
        </span>
       </span>
      </span>
     </div>
     <div style="color:#4B4B4B;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:19.5px;">
      <span style="line-height:1.5;font-family:'宋体';font-size:12pt;">
       <span style="line-height:1.5;font-size:12pt;">
        <span style="line-height:1.5;font-size:14pt;">
         <span style="line-height:1.5;font-size:12pt;">
          <span style="line-height:1.5;font-size:14pt;">
           <span style="line-height:1.5;font-size:12pt;">
            <span style="line-height:1.5;font-size:12pt;">
             <span style="line-height:1.5;font-size:10pt;">
              <span style="line-height:1.5;font-size:12pt;">
               <span style="line-height:1.5;font-size:10pt;">
                <span style="line-height:1.5;">
                 <span style="line-height:1.5;font-family:Arial;font-size:10pt;">
                  (2)在CMD下运行"net start msdtc"开启服务后正常
                 </span>
                </span>
                <span style="line-height:1.5;font-family:Arial;font-size:10pt;">
                 。
                </span>
               </span>
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </div>
     <br style="color:#666666;font-family:'宋体', Arial;"/>
     <span style="color:#666666;font-family:'宋体', Arial;">
      管理工具-组件服务，全部勾选。
     </span>
     <br/>
     <img alt="" height="589" src="//img.blog.itpub.net/blog/attachment/201712/29/22996654_1514537688O0O3.png?x-oss-process=style/bb" width="700">
      <br/>
      执行成功。
      <br/>
      <br/>
      <p style="clear:both;">
      </p>
      <p class="translate">
       来自 “ ITPUB博客 ” ，链接：http://blog.itpub.net/22996654/viewspace-2149513/，如需转载，请注明出处，否则将追究法律责任。
      </p>
     </img>
    </div>
    <p>
     转载于:http://blog.itpub.net/22996654/viewspace-2149513/
    </p>
   </div>
  </div>
  <div id="recommendDown">
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f63756968656e676a75383933332f:61727469636c652f64657461696c732f313030343630393930" class_="artid" style="display:none">
 </p>
</div>
