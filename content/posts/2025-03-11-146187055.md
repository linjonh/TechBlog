---
layout: post
title: "C设计模式-观察者模式从基本介绍,内部原理应用场景使用方法,常见问题和解决方案进行深度解析"
date: 2025-03-11 20:06:17 +0800
description: "C++设计模式-观察者模式：从基本介绍，内部原理、应用场景、使用方法，常见问题和解决方案进行深度解析"
keywords: "C++设计模式-观察者模式：从基本介绍，内部原理、应用场景、使用方法，常见问题和解决方案进行深度解析"
categories: ['C']
tags: ['设计模式', '观察者模式', 'C']
artid: "146187055"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146187055
    alt: "C设计模式-观察者模式从基本介绍,内部原理应用场景使用方法,常见问题和解决方案进行深度解析"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146187055
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146187055
cover: https://bing.ee123.net/img/rand?artid=146187055
image: https://bing.ee123.net/img/rand?artid=146187055
img: https://bing.ee123.net/img/rand?artid=146187055
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     C++设计模式-观察者模式：从基本介绍，内部原理、应用场景、使用方法，常见问题和解决方案进行深度解析
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     一、基本介绍
    </h3>
    <h4>
     <a id="11__1">
     </a>
     1.1 模式定义与核心思想
    </h4>
    <p>
     观察者模式（Observer Pattern）是一种行为型设计模式，它定义了对象间一对多的依赖关系。当被观察对象（Subject）状态改变时，所有依赖它的观察者（Observer）都会自动收到通知并更新。这种模式类似于报纸订阅机制——报社发布新刊时，所有订阅者都会收到最新报纸。
    </p>
    <h4>
     <a id="12__4">
     </a>
     1.2 模式价值体现
    </h4>
    <ul>
     <li>
      解耦利器：将事件发布者与订阅者解耦，提升系统扩展性
     </li>
     <li>
      动态响应：支持运行时动态添加/移除观察者
     </li>
     <li>
      事件驱动：构建异步事件处理系统的核心模式
     </li>
     <li>
      跨层通信：实现不同模块间的松耦合通信
     </li>
     <li>
     </li>
    </ul>
    <p>
     该模式在Qt信号槽、MVC架构、游戏引擎等领域有广泛应用，是GUI编程的基石模式之一。
    </p>
    <h3>
     <a id="_12">
     </a>
     二、内部原理剖析
    </h3>
    <h4>
     <a id="21__13">
     </a>
     2.1 模式结构分解
    </h4>
    <p>
     <strong>
      核心组件：
     </strong>
    </p>
    <ul>
     <li>
      Subject（主题接口）
      <br/>
      提供观察者注册/注销方法（如attach()/detach()）
      <br/>
      维护观察者容器（通常使用std::vector或std::list）
      <br/>
      定义通知方法notify()
     </li>
     <li>
      Observer（观察者接口）
      <br/>
      声明更新接口（如update()方法）
      <br/>
      定义事件响应逻辑的规范
     </li>
    </ul>
    <h4>
     <a id="22__22">
     </a>
     2.2 消息传递机制
    </h4>
    <p>
     观察者模式中的推模式（Push Model）与拉模式（Pull Model）是两种不同的数据传递策略，它们的核心区别在于主题与观察者之间的数据交互方式：
     <br/>
     <strong>
      推模式（Push）
     </strong>
     <br/>
     主题主动将完整或部分数据推送给观察者，无论观察者是否需要。比如，天气预报系统推送完整的温度、湿度、风力数据给用户。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">int</span> temperature<span class="token punctuation">,</span> <span class="token keyword">int</span> humidity<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      拉模式（Pull）
     </strong>
     <br/>
     主题仅通知观察者状态变化，观察者通过主题接口主动拉取所需数据。比如，股票交易系统通知用户行情变化，用户自行查询感兴趣的股票详情。
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span>WeatherStation<span class="token operator">*</span> station<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> temp <span class="token operator">=</span> station<span class="token operator">-&gt;</span><span class="token function">getTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre>
    <p>
     两种模式的选择本质上是数据控制权的权衡：推模式将控制权交给主题，拉模式则交给观察者。实际开发中常采用混合模式：基础数据通过推送方式，复杂数据通过拉取获取。
    </p>
    <h3>
     <a id="_40">
     </a>
     三、典型应用场景
    </h3>
    <h4>
     <a id="31_GUI_41">
     </a>
     3.1 GUI事件处理
    </h4>
    <p>
     在Qt框架中，按钮点击事件监听是经典案例：
    </p>
    <pre><code class="prism language-cpp">QPushButton<span class="token operator">*</span> btn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span><span class="token string">"Submit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span>btn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QPushButton<span class="token double-colon punctuation">::</span>clicked<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Button clicked!"</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <p>
     按钮作为被观察者，点击事件触发时通知所有连接的槽函数（观察者）。
    </p>
    <h4>
     <a id="32__52">
     </a>
     3.2 实时数据监控系统
    </h4>
    <p>
     以股票行情监控系统架构作为示例：
     <br/>
     [证券交易所] --&gt; [行情服务器(Subject)]
     <br/>
     [行情服务器] --&gt; [交易终端(Observer)]
     <br/>
     [行情服务器] --&gt; [大屏显示器(Observer)]
     <br/>
     当股票价格变动时，所有终端实时更新显示。
    </p>
    <h4>
     <a id="33__59">
     </a>
     3.3 游戏开发中的事件系统
    </h4>
    <p>
     实现角色受伤通知机制：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Character</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Observer<span class="token operator">*</span><span class="token operator">&gt;</span> effects<span class="token punctuation">;</span> <span class="token comment">// 中毒、流血等状态观察者 </span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">takeDamage</span><span class="token punctuation">(</span><span class="token keyword">int</span> damage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发状态效果更新 </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_71">
     </a>
     四、实现方法与最佳实践
    </h3>
    <h4>
     <a id="41__72">
     </a>
     4.1 标准实现步骤
    </h4>
    <p>
     <strong>
      定义抽象接口
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Observer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> o<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> o<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <strong>
      实现具体主题
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">NewsAgency</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Subject</span></span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Observer<span class="token operator">*</span><span class="token operator">&gt;</span> readers<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string latestNews<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> o<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span> 
        readers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">setNews</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> news<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        latestNews <span class="token operator">=</span> news<span class="token punctuation">;</span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="42__105">
     </a>
     4.2 高级实现技巧
    </h4>
    <p>
     <strong>
      使用智能指针管理生命周期
     </strong>
    </p>
    <pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Observer<span class="token operator">&gt;&gt;</span> observers<span class="token punctuation">;</span> <span class="token comment">// 自动内存管理 </span>
 
<span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>weak_ptr<span class="token operator">&lt;</span>Observer<span class="token operator">&gt;</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">auto</span> it <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">find_if</span><span class="token punctuation">(</span>observers<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  observers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token punctuation">[</span><span class="token operator">&amp;</span>o<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> ptr<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> ptr <span class="token operator">==</span> o<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>it <span class="token operator">!=</span> observers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  observers<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
    <p>
     <strong>
      线程安全实现
     </strong>
    </p>
    <pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mutex&gt;</span></span>
 
<span class="token keyword">class</span> <span class="token class-name">ConcurrentSubject</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Subject</span></span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>mutex mtx<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Observer<span class="token operator">*</span> o<span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        observers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token comment">// 类似实现detach和notify...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_132">
     </a>
     五、常见问题与解决方案
    </h3>
    <h4>
     <a id="51__133">
     </a>
     5.1 内存泄漏风险
    </h4>
    <p>
     <strong>
      问题现象
     </strong>
     ：观察者未及时注销导致内存无法释放
     <br/>
     <strong>
      解决方案
     </strong>
     ：
     <br/>
     使用weak_ptr弱引用观察者
     <br/>
     在析构函数中自动注销
    </p>
    <pre><code class="prism language-cpp"><span class="token operator">~</span><span class="token function">ConcreteObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    subject<span class="token operator">-&gt;</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
    <h4>
     <a id="52__144">
     </a>
     5.2 性能瓶颈
    </h4>
    <p>
     <strong>
      问题场景
     </strong>
     ：高频事件导致通知风暴
     <br/>
     <strong>
      优化策略
     </strong>
     ：
    </p>
    <p>
     批量通知机制
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">accumulateUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>updateCount <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        updateCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
     异步通知队列
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">asyncNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span><span class="token function">thread</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <h4>
     <a id="53__165">
     </a>
     5.3 循环引用问题
    </h4>
    <p>
     <strong>
      典型案例
     </strong>
     ：主题与观察者相互持有shared_ptr
     <br/>
     <strong>
      解决方法
     </strong>
     ：
    </p>
    <p>
     将其中一个引用改为weak_ptr
     <br/>
     使用非拥有型指针配合手动生命周期管理
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>weak_ptr<span class="token operator">&lt;</span>Subject<span class="token operator">&gt;</span> subject<span class="token punctuation">;</span> <span class="token comment">// 打破循环引用 </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h3>
     <a id="_177">
     </a>
     六、模式扩展与演进方向
    </h3>
    <h4>
     <a id="61__178">
     </a>
     6.1 事件总线模式
    </h4>
    <p>
     构建全局事件分发中心：
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>EventType<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Handler<span class="token operator">&gt;&gt;</span> handlers<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">subscribe</span><span class="token punctuation">(</span>EventType type<span class="token punctuation">,</span> Handler h<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        handlers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">publish</span><span class="token punctuation">(</span>Event e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> h <span class="token operator">:</span> handlers<span class="token punctuation">[</span>e<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">h</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="62__193">
     </a>
     6.2 响应式编程扩展
    </h4>
    <p>
     实现类似RxJS的流处理：
    </p>
    <pre><code class="prism language-cpp">observable<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> sensorData <span class="token operator">=</span> <span class="token function">createObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sensorData<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span>  v<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> v <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"警告值:"</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <h4>
     <a id="63__201">
     </a>
     6.3 与其它模式结合
    </h4>
    <p>
     观察者+工厂模式
    </p>
    <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">ObserverFactory</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Observer<span class="token operator">&gt;</span> <span class="token function">create</span><span class="token punctuation">(</span>ObserverType type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> Logger<span class="token operator">:</span> <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>LogObserver<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> Notifier<span class="token operator">:</span> <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>EmailObserver<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     总的来说，观察者模式符合开闭原则，新增观察者不影响现有系统，支持广播通信机制，一对多通知高效；但观察者模式的随机顺序通知可能引发逻辑依赖问题，在实际使用中，经常配合其他模式（如中介者模式）解决复杂场景下的消息风暴问题。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f7169616e6e69756c616f72656e2f:61727469636c652f64657461696c732f313436313837303535" class_="artid" style="display:none">
 </p>
</div>


