---
layout: post
title: "Docker-composeNeo4j-数据备份与恢复"
date: 2025-03-15 17:32:33 +0800
description: "【Docker compose】Neo4j 数据备份与恢复"
keywords: "【Docker compose】Neo4j 数据备份与恢复"
categories: ['Neo']
tags: ['容器', 'Neo', 'Docker']
artid: "146282515"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146282515
    alt: "Docker-composeNeo4j-数据备份与恢复"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146282515
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146282515
cover: https://bing.ee123.net/img/rand?artid=146282515
image: https://bing.ee123.net/img/rand?artid=146282515
img: https://bing.ee123.net/img/rand?artid=146282515
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Docker compose】Neo4j 数据备份与恢复
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <p>
     本文使用Neo4j的插件apoc来实现数据备份与恢复
    </p>
    <h4>
     <a id="1__5">
     </a>
     1、 创建示例数据
    </h4>
    <pre><code class="prism language-cypher">// 创建人物节点
CREATE (a:Person {name: 'Alice', age: 30})
CREATE (b:Person {name: 'Bob', age: 25})
CREATE (c:Person {name: 'Charlie', age: 35})

// 创建关系
CREATE (a)-[:FRIEND_WITH]-&gt;(b)
CREATE (b)-[:FRIEND_WITH]-&gt;(c)
CREATE (a)-[:FRIEND_WITH]-&gt;(c)

// 创建地点节点
CREATE (d:Place {name: 'New York'})
CREATE (e:Place {name: 'Los Angeles'})
CREATE (f:Place {name: 'Chicago'})

// 创建事件节点
CREATE (g:Event {name: 'Concert', date: '2025-05-15'})
CREATE (h:Event {name: 'Conference', date: '2025-06-20'})

// 关联人物和事件
CREATE (a)-[:ATTENDS]-&gt;(g)
CREATE (b)-[:ATTENDS]-&gt;(h)
CREATE (c)-[:ATTENDS]-&gt;(g)
</code></pre>
    <ul>
     <li>
      <strong>
       FRIEND_WITH
      </strong>
      ：表示朋友关系。
     </li>
     <li>
      <strong>
       LIVES_IN
      </strong>
      ：表示人物居住地点。
     </li>
     <li>
      <strong>
       ATTENDS
      </strong>
      ：表示人物参加的事件。
     </li>
    </ul>
    <p>
     如果页面无法访问，在容器中执行：
    </p>
    <pre><code class="prism language-shell"><span class="token comment"># 链接终端</span>
cypher-shell <span class="token parameter variable">-u</span> neo4j <span class="token parameter variable">-p</span> <span class="token variable">${password}</span>
<span class="token comment"># 执行如上语句</span>

<span class="token comment"># 查看创建的数据</span>
MATCH <span class="token punctuation">(</span>n<span class="token punctuation">)</span> RETURN n LIMIT <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token comment"># 如果你想查看所有节点的标签：</span>
CALL db.labels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
    </p>
    <h4>
     <a id="2_53">
     </a>
     2、备份操作
    </h4>
    <pre><code class="prism language-cypher">// 备份所有数据为 GraphML 格式
CALL apoc.export.graphml.all('neo4j_backup.graphml', {useTypes:true});
</code></pre>
    <ul>
     <li>
      <code>
       CALL apoc.export.graphml.all
      </code>
      用于将数据库中所有数据导出为
      <code>
       neo4j_backup.graphml
      </code>
      。
     </li>
     <li>
      <code>
       useTypes:true
      </code>
      表示在导出时保留类型信息。
     </li>
    </ul>
    <p>
     notice：
     <br/>
     neo4j默认的备份路径默认从
     <code>
      /var/lib/neo4j/import
     </code>
     开始
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/458af85fd13f45368ef03682d1681755.png"/>
    </p>
    <p>
    </p>
    <h4>
     <a id="3__72">
     </a>
     3、 模拟容器故障：删除容器
    </h4>
    <p>
     docker compose down
    </p>
    <p>
    </p>
    <h4>
     <a id="4__77">
     </a>
     4、 恢复操作
    </h4>
    <pre><code class="prism language-cypher">// 恢复 GraphML 文件
CALL apoc.import.graphml('neo4j_backup.graphml', {batchSize:1000, readLabels:true})
</code></pre>
    <ul>
     <li>
      <code>
       CALL apoc.import.graphml
      </code>
      用于从指定的 GraphML 文件恢复数据。
     </li>
     <li>
      <code>
       batchSize:1000
      </code>
      设置每次导入的批量大小为 1000 条。
     </li>
     <li>
      <code>
       readLabels:true
      </code>
      表示读取并应用标签。
     </li>
    </ul>
    <p>
     说明：neo4j会从默认的备份路径（
     <code>
      /var/lib/neo4j/import
     </code>
     ）中找到备份文件
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2b471513d55c4016800137919ff2552e.png"/>
    </p>
    <p>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f68696c69616e673532312f:61727469636c652f64657461696c732f313436323832353135" class_="artid" style="display:none">
 </p>
</div>


