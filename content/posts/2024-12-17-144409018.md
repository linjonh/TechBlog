---
layout: post
title: "相机Camera成像原理详解"
date: 2024-12-17T16:42:32+0800
description: "本文详细介绍了成像基础原理，透镜与成像公式，光圈与景深控制，数字图像传感器（CCD与CMOS）工作原理，感光灵敏度（ISO）与增益控制"
keywords: "相机成像原理"
categories: ['未分类']
tags: ['相机成像原理', '图像处理']
artid: "144409018"
arturl: "https://blog.csdn.net/m0_66890670/article/details/144409018"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=144409018
    alt: "相机Camera成像原理详解"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=144409018
featuredImagePreview: https://bing.ee123.net/img/rand?artid=144409018
cover: https://bing.ee123.net/img/rand?artid=144409018
image: https://bing.ee123.net/img/rand?artid=144409018
img: https://bing.ee123.net/img/rand?artid=144409018
---



# 相机（Camera）成像原理详解

![](https://i-operation.csdnimg.cn/images/cf31225e169b4512917b2e77694eb0a2.png)相机成像原理全解析



> 简介：个人学习分享，如有错误，欢迎批评指正。

**成像流程**  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/6270008b520f4d3c9a5b37d57d9c0a80.png)

**1、光学相机的定义**  
 顾名思义，光学相机就是利用光学原理进行成像的相机，而且市面上的相机几乎都是光学相机，只不过随着时代的发展，胶卷式存储图像的形式已经被数字图像所代替。

**2、光学相机的构造**  
 ​ 相机由如下三部分所组成：  
 ![相机的三大部件](https://i-blog.csdnimg.cn/direct/802c704b91ed453ebf410ff40b6c5508.png)

以上三个部分在相机中对应的位置如下：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/1536b6c8560849328d2b2ffb8c76e3b3.png)

## 一、成像基础原理（相机暗箱与光学聚焦）

### 1.小孔成像

#### 1.1. 小孔成像由来

在大约两千四五百年前的《墨经》之中，描述过墨子和他的学生做过的实验，其中发现一种自然现象：用一个带有小孔的板遮挡在墙体与物之间，墙体上就会形成物的倒立实像。现在，我们把这样的一种现象叫小孔成像。光线透过小孔在墙上投影出倒立的实像：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fdb41edd71904212b79d2b12d51e413b.png#pic_center)

#### 1.2. 小孔成像原理

为了更加直观地去阐述小孔成像的原理，现在我们假设：在物体与墙之间没有小孔，物体反射的光直接映射到墙上，那么最终的成像会是什么样子？物体反射的光直接在墙上投影：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/687b3fe067ab48a5ad8686a037a0d532.png#pic_center)

首先，我们知道世界上的万物之所以能够被我们的眼睛所看到，是因为白天光照到物体上，物体上的各个点皆会向无数个方向折射出光，光线越弱，则所看到的物体越不清晰。

当没有小孔时，物体与投影墙之间没有任何隔板，因此，物体上所有点发出的光将重叠地映射在墙上：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e3bfde369e7c422598bd160bdc0d0fe2.png#pic_center)

对于墙上的某个点接收了来自物体上每个点所发出的光，重叠在一起，此时就会出现图像模糊现象：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5cd6c088befe4206a661c9501c596054.png#pic_center)

为了避免出现图像模糊现象，我们在物体与墙之间加入一个隔板，该隔板上有一个小孔：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/b793558ec6344a93af093b0abf8b9f38.png#pic_center)

那么此时的光线传播情况就是这个样子，大多数光线被阻挡，每个物体点只有一束光线投影到墙上：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/9cf594982fcc44b797d0a9c7708b3a02.png#pic_center)

隔板挡住了物体的光线传播，物体上的每一个点只有一条光线穿过了隔板上的小孔，并且墙上每个点的光子只由物体上的一个点所贡献，最终的成像效果如下，即小孔成像：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/af226c1c1c5e45ce90c08543137630e7.png#pic_center)

在这个例子中，隔板就是相机快门，小孔就是镜头的光圈。

### 2. 暗箱成像（Camera Obscura）的诞生

#### 2.1.暗箱的基本概念

“暗箱”(Camera Obscura)一词来自拉丁语，意为“黑暗的房间”。最初的暗箱成像并非现代意义上的相机，而是一个密闭、内部无光的箱体或房间。在暗箱的一面墙上开有一个极小的孔（针孔）。当外界场景的光线透过这个小孔进入暗箱时，在暗箱对面（与小孔相对的一面）就会出现外界景物的倒立影像。这便是最古老、最朴素的成像方式。

#### 2.2.成像原理的本质——光线直线传播

**暗箱成像**是`基于光线的直线传播特性`：

* 对于外界物体上的每个点，都有无数光线以各种方向散射和反射。当我们在暗箱上打一个小孔时，只允许来自特定方向的少量光线进入。
* 小孔越小，进入箱内的光线越接近单一方向，从而在箱内底面或对面形成清晰的点影像。
* 将无数来自场景中各点的光线通过针孔压缩和分选后，这些点在暗箱内部合成了一个整体的图像。
* 由此可见，通过单一的小孔路径，外界景物的空间结构被保留并投影到内部平面上，`形成与现实对应但上下和左右方向皆倒置的影像`。

#### 2.3.影响成像质量的因素

* **孔径大小**：`孔径越小，成像越锐利，但进入光线越少，图像越暗`。孔径增大，亮度提升但图像清晰度下降，因为更多角度的光线混入，导致成像模糊。
* **距离和像面大小**：当暗箱的背板（成像面）距离小孔较远时，成像区域更大，但亮度减少且扩散更明显。`较近时，图像更亮但投影面积变小`。
* 没有透镜的暗箱无法聚集更多光线，图像往往较暗、不够明亮清晰。这为后续利用透镜（镜头）改善成像质量打下了基础。

早期的艺术家和科学家常利用暗箱原理来观察外界景色，并辅助绘画草图。这为后来的照相术和光学仪器的诞生做出了铺垫。

### 3. 从暗箱到透镜聚焦——走向精确成像的关键一步

#### 3.1.引入透镜的动机

暗箱成像的基本效果虽然显示了成像原理，但清晰度和亮度严重受限。为了获得更明亮和细节更丰富的图像，需要让更多光线进入并将其汇聚于一个清晰的焦点上。这就引出了透镜（Lens）的使用。

#### 3.2.透镜的光学特性

透镜是由透明介质（如玻璃或塑料）制成的光学元件，一般呈凸形（凸透镜）或凹形（凹透镜），其中凸透镜能够让平行进入的光线在透过透镜后会合于一点（焦点）。

* **凸透镜聚光**：`平行光线通过凸透镜会向焦点收拢，凸透镜能够将来自广阔空间中分散的光线集中到感光平面上，从而显著提高图像亮度和清晰度`。
* **像距与物距的关系**：根据高斯成像原理，当有物体位于透镜前方某一位置（物距u）时，通过透镜折射形成的像（像距v）满足

1
f
=
1
u
+
1
v
\frac{1}{f} = \frac{1}{u} + \frac{1}{v}
f1​=u1​+v1​

这里 
f
f
f 是**透镜焦距**，一个由`透镜材料与曲率决定的固定值`。当物体位于无穷远时，透镜后方的焦点即为会聚平行光线的点。当物体移近或远离透镜，像距也随之变化。`通过移动透镜或感光平面位置来满足此公式，就能在特定位置获得清晰的成像`。

#### 3.3.由针孔到透镜的转变

* **亮度提升**：与针孔相比，透镜的口径更大，让更多光线进入成像系统，因此成像平面更亮，避免了暗箱成像过于昏暗的问题。
* **清晰度增加**：由于透镜会将光线聚集为实际的焦点，而非仅依赖小孔的极限分光，成像的锐度和清晰度获得极大提升。透镜成像不需要极小的孔径来提高清晰度，从而在较大光通量下获得良好细节表现。

### 4. 光学聚焦的核心机制与焦点成像

#### 4.1.单透镜焦点成像

假设一个凸透镜及其焦距f已知。

* 当物体位于无限远（如远处的山峰）时，平行光线进入透镜后在焦点处汇聚，像距为v。此时将感光面放在焦点上即可得到清晰的像。
* 当物体位于有限距离u处，像距v将根据成像公式变化。移动感光平面或改变透镜与感光面的间距，就能使像重新清晰。

#### 4.2.真实像与虚像

当透镜成像在感光平面（相机中的胶片或传感器）上形成的是可投射于屏幕上的实像（真实存在的像）。这与一些放大镜产生的虚像有所不同。相机的关键就在于能够在感光介质上形成真实的实像，能够被记录下来。

#### 4.3.倒置影像的本质

透过凸透镜形成的实像是上下、左右皆倒置的。其原因与针孔成像相同——`光线是以直线传播，当通过透镜后，来自物体上方的光线被折射后会在下方成像点汇聚，来自物体左侧的光线在成像面上偏右侧汇聚，最终结果是一个旋转180度的影像`。  
 在相机中，这种倒置成像在胶片时代并不构成使用障碍，因为底片成像后会通过冲印步骤得到正向的最终图像。数码时代则通过电子显示或计算转换很容易得到正立的影像。

### 5. 从简单透镜到复合镜头的完善

最简单的光学聚焦是利用单个凸透镜，但单透镜存在像差（例如色差、球面像差）。为了获得更高质量成像，人们将多个透镜组合起来，形成镜头组，通过精密研磨和特殊光学玻璃减少像差。这一复杂设计并不改变基本成像机制：光仍然是通过透镜系统聚焦到感光平面上，从而形成图像。

### 6. 光圈与明暗调控在基础光学聚焦中的地位

`透过引入可调节的小孔（即光圈）位于透镜组中，可以控制进入光学系统的光线数量`。在最原始的暗箱中，小孔尺寸是固定的。在透镜时代，我们保留小孔结构，但令其可变，从而在保持成像清晰的前提下，对图像亮度和景深进行控制。

* 减小光圈可减少像差，提高画面边缘清晰度，并加大景深。
* 增大光圈可获取更明亮的像，但景深会变浅。这和暗箱原理中“孔越小成像越清晰”在本质上相通，但透镜为成像系统提供了更多灵活性和可用的光线。

## 二、透镜与成像公式

### 1. 透镜的基本概念与类型

#### 1.1.透镜的定义

透镜是由至少一面或多面曲面（通常为球面或非球面）构成的透明介质（常用玻璃或塑料）光学元件，它能使通过的光线发生折射，使光线发生聚合或发散，从而在一定条件下形成实像或虚像。

在前面，我们利用小孔进行成像，当光线透过小孔后，将会在传感器上投影出倒立的实像。然而，由于隔板阻挡了物体反射的绝大部分光线，将导致投影出的实像并不是很清晰。为了弥补小孔成像的不足，我们由凸透镜来代替小孔，使之成为光线的汇聚组件：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/abfeccf66b3044acaf9a024deaf1b23e.png#pic_center)

上图利用凸透镜进行成像，我们可以发现：物体上一个点所反射的光线将被凸透镜汇聚在传感器上的一个点。凸透镜能够汇聚物体的反射的光线在某点投影，而不是像小孔一样隔开大部分的光线，因此凸透镜成像将会比小孔成像更加清晰。正是因为凸透镜成像的优势，现代相机都采用凸透镜进行成像，采用凸透镜的相机也被称为现代光学相机。

#### 1.2.凸透镜与凹透镜

* **凸透镜（正透镜）**：中央部分比边缘厚，可将平行入射光线会聚到一点（焦点）。对于成像用途，我们最关心的是凸透镜的成像特性，因为凸透镜能在成像平面上得到倒立、缩小或放大的实像。
* **凹透镜（负透镜）**：中央较薄、边缘较厚，将平行入射光线发散开，不适用于直接在感光平面上形成实像。凹透镜常用于矫正像差或与凸透镜组合成复合镜头系统，但单独的凹透镜不能在屏幕上成实像。

#### 1.3.透镜焦距与焦点

* **焦点**（Focal Point）：当一束平行于透镜光轴的光线射入凸透镜后，这束平行光线会在透镜另一侧会聚于一点，这个点就是透镜的焦点。
* **焦距**（f）：`焦点到透镜光学中心（通常定义透镜的主光学平面）之间的距离称为焦距`。焦距是透镜最重要的光学参数之一，它取决于透镜的材质折射率和曲率半径。
* 焦距越短，透镜的会聚能力越强；焦距越长，透镜会聚光线的能力越弱。

#### 1.4. 焦距

隔板与传感器平面之间的距离就称为焦距。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/f6424b01bd534276b2a29c854e7f10cb.png#pic_center)

当我们保持物体与隔板之间的距离不动，并缩小传感器与隔板之间的距离时，就发生了有趣的现象：当焦距缩短一半时，成像的尺寸大小也会缩小一半；当焦距扩大一倍时，成像的尺寸大小也会扩大一倍。如下图所示：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/50fb224a976647b599ae31be751e1d80.png#pic_center)

### 2. 成像公式及其推导逻辑

#### 2.1.成像公式的基本形式

高斯成像公式在薄透镜近轴光学假设下（即忽略高阶像差与仅考虑光轴附近小角度光线）成立。公式为：

1
f
=
1
u
+
1
v
\frac{1}{f} = \frac{1}{u} + \frac{1}{v}
f1​=u1​+v1​

其中：

* f
  f
  f 为**透镜焦距**
* u
  u
  u 为**物距**，即物体到透镜光学中心的距离
* v
  v
  v 为**像距**，即透镜到成像平面的距离（像平面与透镜之间的距离）

#### 2.2.近轴近似与理想透镜

高斯成像公式成立的前提是所谓的“近轴近似”条件：

* 光线接近光轴传播，即光线入射角度很小，不考虑大量像差。
* 透镜薄到可以将其光学属性集中在一个单一平面上，不考虑透镜厚度带来的光线偏移。
* 在此条件下，光路可以用几何光学简单的折射定律来分析，得到简单的代数关系。

#### 2.3.推导思路简介

推导高斯成像公式通常从相似三角形与折射定律出发：

* 将物体抽象为一点光源 
  O
  O
  O，透过透镜在另一侧形成像点I。
* 考虑透镜的光学中心 
  O
  ′
  O'
  O′ 及其前后的两组相似三角形关系，从中得出物距、像距和焦距的关系。
* 在数学推导过程中，定义焦点为平行光线通过透镜后的会聚点，通过相似三角形与几何比例关系，最终得出：
  1
  f
  =
  1
  u
  +
  1
  v
  \frac{1}{f} = \frac{1}{u} + \frac{1}{v}
  f1​=u1​+v1​这一简单优美的形式。

### 3. 成像公式的物理意义

#### 3.1. 物距、像距与焦距之间的依存关系

成像公式表明，对于一个给定焦距的透镜，如果物体位置发生变化（
u
u
u 变动），那么像点位置（
v
v
v）也会随之变化，从而满足公式：

* 当物体很远（
  u
  →
  ∞
  u \to \infty
  u→∞）时，
  1
  u
  ≈
  0
  \frac{1}{u} \approx 0
  u1​≈0，此时 
  1
  v
  ≈
  1
  f
  \frac{1}{v} \approx \frac{1}{f}
  v1​≈f1​，故 
  v
  ≈
  f
  v \approx f
  v≈f。  
   也就是说，当远方物体通过透镜成像，其像点就出现在焦点上。这就是为什么当拍摄远方山峰或星空时，镜头对焦到无限远位置（
  ∞
  \infty
  ∞）时成像平面对应于焦距的附近。

#### 3.2. 成像性质：实像与虚像

通过成像公式可以判断成像的实虚性：

* **当物距大于焦距（
  u
  >
  f
  u > f
  u>f）时**，可以获得实像（像距为正，像可成在实际光平面上）。
* **当物体放在焦点以内（
  u
  <
  f
  u < f
  u<f）时**，
  v
  v
  v 为负值，即 
  v
  v
  v 的负表示无法在透镜另一侧形成实像，只能在同侧形成放大的虚像，如放大镜对近处物体的成像情形。  
   此种情况下，我们说的是虚像的形成。相机拍摄时物体距离一般远大于焦距，确保在透镜背后可以出现正向的实像。

#### 3.3. 成像放大率

成像公式还可与放大率概念结合：

* 放大率 
  m
  m
  m 定义为像高与物高的比值，也等同于像距和物距的比值（在近轴近似下）：

  m
  =
  像高
  物高
  =
  v
  u
  m = \frac{\text{像高}}{\text{物高}} = \frac{v}{u}
  m=物高像高​=uv​
* 改变 
  u
  u
  u 或 
  v
  v
  v，就会改变成像的放大率。
* 对于相机而言，为了拍摄清晰的微距影像，物体距离相对较小，就会使像距增加，从而放大率上升。

### 4. 实际应用与操作

#### 4.1.对焦机制

相机通过移动透镜组或感光平面来改变 
v
v
v，使得对给定的 
u
u
u（物体位置）满足成像公式，从而在感光传感器上形成清晰的像。如果物体还远近变化，相机就需要重新调整镜头焦距或镜头到感光面的距离（在定焦镜头中是移动镜头或者传感器位置，在变焦镜头中可改变有效焦距）来再次满足成像公式。

#### 4.2.固定焦距镜头与变焦镜头

* **固定焦距镜头**：焦距f是固定的，通过改变镜头与传感器间距离（微小调焦）来满足不同比例的 
  u
  u
  u 和 
  v
  v
  v，以确保对焦。
* **变焦镜头**：可通过内部透镜组间距变化改变 
  f
  f
  f，从而在不同焦距下对物体成像，再由微调对焦来准确满足公式。

#### 4.3.拍摄场景下的直观理解

当你对一个比较远的物体对焦时，物距 
u
u
u 非常大，
1
u
\frac{1}{u}
u1​ 几乎为 0，因此像距 
v
v
v 接近 
f
f
f。相机聚焦到无穷远时，其感光面平面几乎固定在 
f
f
f 处。当你试图拍摄较近的物体，如微距拍摄，
u
u
u 减小，
1
u
=
1
f
−
1
v
\frac{1}{u} = \frac{1}{f} - \frac{1}{v}
u1​=f1​−v1​ 变大，
v
v
v 会增加。你的镜头可能需要在机身外伸更远，拉大镜头-感光面距离以获得清晰成像。

## 三、光圈与景深控制

### 1. 光圈的定义与结构

**孔径**

隔板小孔的直径就被称为孔径，也就是相机的光圈直径。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/8b685e98f759442f826fb5f2d8e1e882.png#pic_center)  
 当小孔的直径扩大时，随着孔径扩大，成像效果的变化：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/927b8ebac46c494092b2f990eea0038a.png#pic_center)  
 当孔径比较大时，传感器上一个点的像素由物体上多个点发出的光所贡献，也就导致孔径越大，所呈现的图像越模糊。那是不是孔径越小就越好呢？会不会让呈现的图像更加清晰？

如果按照几何光学的理论来讲，该假设是对的，几何光学认为：光是直线传播的，也就是粒子。但是光具有波粒二象性，光即是粒子也是波，当一束波通过一个小孔后，会发生衍射现象，并且孔越小，衍射现象就会越严重：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/739eb3a4bdc64d0e83d029ed13187a84.png#pic_center)  
 从傅里叶光学的角度来讲：衍射的模式实际上对应着小孔的傅里叶变换。越小的孔，其衍射模式越宽，光的波动性更加显现，而越大的孔，其衍射模式越窄，光的粒子性更加显现：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/56b95dff7b9d490cb42b2978789dd7d2.png#pic_center)  
 所以，孔径并不是越小越好。

**（1）光圈的基本概念**  
 光圈是位于镜头内部的一组呈叶片状分布的金属片，可通过联动机构改变开口直径。`光圈孔径大小决定单位时间内进入相机的光线通量`。当光圈叶片完全收拢成小孔时，进光量减少；当叶片张开到最大时，进光量增加。光圈的控制使摄影师能在各种光线条件下实现合适的曝光组合。

**(2) 光圈值（f值）的定义**

光圈大小通常以 
f
f
f 值（如 
f
/
1.8
f/1.8
f/1.8、
f
/
4
f/4
f/4、
f
/
16
f/16
f/16）表示。
f
f
f 值定义为镜头焦距 
f
f
f 与**光圈有效孔径直径** 
D
D
D 之比：

f
-number
=
f
D
f\text{-number} = \frac{f}{D}
f-number=Df​

举例：若镜头焦距 
f
=
50
mm
f = 50\text{mm}
f=50mm，光圈孔径 
D
=
25
mm
D = 25\text{mm}
D=25mm，则 
f
f
f 值为 
f
/
2
f/2
f/2。`f 值越小，光圈越大`；f 值越大，光圈越小。

**(3) 光圈级别与光线通量的变化**

常见光圈值按 
2
\sqrt{2}
2


​ 级分递进等级：f/1、f/1.4、f/2、f/2.8、f/4、f/5.6、f/8、f/11、f/16、f/22……  
 每缩小一档光圈（f 值增加一档），光线通量减半；每增大一档光圈（f 值降低一档），光线通量加倍。 通过调整光圈，摄影师可与快门速度、感光度（ISO）一起实现曝光控制的微调。

### 2. 景深的定义与影响因素

**（1）景深概念**  
 **景深**是`指在可接受的清晰度范围内，从前景到背景的空间纵深距离`。理论上，只有在焦平面上、与透镜成像公式严格匹配的那个特定距离处，才能得到最清晰锐利的成像。但因人眼视觉特性及显示媒介的限制，只要离焦程度不超过一定阈值，对人眼而言依然能被接受为清晰的区域。这段被认为`清晰的纵深范围`即为**景深**。

**（2）决定景深的三个主要因素**

1. **光圈大小（f值）**：  
    `光圈越大（f值越小），景深越浅`；光圈越小（f值越大），景深越深。`原因在于减小光圈后，进入镜头的光线更加接近于光轴方向`，散焦圆（Circle of Confusion, CoC）相对减小，从而扩大了被看作清晰的范围。
2. **物距（对焦距离）**：  
    `当对焦在较近的物体时，景深通常较浅`；当对焦在远方时，景深会大幅增加。远距离对焦时，景深可趋向无穷大，这是为什么风光摄影常在远处对焦并选用较小光圈来获得从前景到背景都清晰的景象。
3. 焦距（镜头焦距）：  
    在相同构图条件下（即拍摄框架固定），使用`较长焦距镜头往往会呈现更浅的景深效果，而广角镜头容易获得较深的景深`。但需注意，这与拍摄距离和画面构图息息相关。当改变焦距的同时改变与被摄体的距离以保持同样的构图，会间接影响景深。但在相同拍摄距离下，长焦往往会让景深显得更浅。

**（3）散焦圆（CoC）的概念**  
 散焦圆是景深原理的核心。当物点刚好对焦在感光平面上时，它成像为理想的点。当物点不在精确焦点位置前后，则其成像在感光面上呈弥散的光斑。`只要这个光斑直径小于特定视觉阈值（人眼或显示终端的分辨能力），就会被感知为清晰点`，从而扩大了清晰范围的概念区域。  
 不同的最终输出媒介（如小型手机屏幕、放大打印尺寸）会使用不同的CoC标准，因此景深并不是一个绝对值，而是基于成像与观察条件定义的。

### 3. 光圈与景深的直接联系

（1）**大光圈（小f值）带来的浅景深**  
 `当光圈开大（例如f/1.4、f/2），光线的入射角度更大，稍微偏离焦点的点光源在感光面上形成较大的散焦圆`。因此，对焦平面的前后空间一旦偏离焦点，就会迅速变得模糊。这在人像摄影中非常常见，大光圈镜头使背景虚化，主体突出，得到更梦幻的散景效果。

（2）**小光圈（大f值）带来的深景深**  
 当将光圈缩小（例如f/8、f/16甚至f/22），仅允许较接近光轴方向的光线通过。这缩小了焦点前后光斑的尺寸范围，即使物体稍有偏离焦点位置，其成像模糊度仍在可接受范围内，从而增加景深。这在风光摄影中尤为重要，小光圈让从前景石头到远处山峦都能处于清晰状态。

### 4. 景深估算与实践应用

（1）**景深标尺与预设对焦**  
 早期的手动镜头常在镜身上刻有景深标尺，通过选择特定f值即可估算特定距离范围内的清晰区间。摄影师可利用该标尺进行预设对焦，比如在街头摄影中选择f/8并对焦一定距离，从而无需频繁对焦就能保证大范围清晰成像。

（2）**超焦距（Hyperfocal Distance）**  
 超焦距是景深计算中常用的概念。将镜头对焦在此距离上后，从半个该距离到无穷远都在可接受清晰范围内。

其中H为超焦距，f为焦距，N为光圈f数值，CoC为可接受散焦圆直径。风光摄影师常根据超焦距选定对焦点与光圈，从而最大化前景与背景的清晰范围。

**（3）实际应用策略**

* **人像与静物特写**：往往使用较大光圈（f/1.4~f/2.8）突出主体，令背景柔和虚化。
* **风光与建筑摄影**：通常使用较小光圈（f/8~f/16）以保证从近景到远景的较大景深，让整个场景具备清晰细节。
* **纪实与街拍**：利用中等光圈（f/5.6~f/11）和合适的对焦距离，使景深覆盖可能出现的拍摄对象距离范围，减少对焦的负担。

### 5. 光圈、景深与曝光的平衡

景深控制并非独立存在，还需与曝光协调。当缩小光圈以增大景深时，可进入相机的光线减少，需要延长曝光时间或提高ISO以获得足够亮度。但提高ISO会引入噪点，延长曝光会增加运动模糊风险。摄影师需在景深与曝光质量、噪点控制、运动清晰度之间进行平衡。反之，开大光圈增加进光量，可缩短快门时间，但换来了浅景深，这在动感抓拍中有利，但背景虚化并非总是需要的。

## 四、数字图像传感器工作原理

### 1.传感器的分类

我们通过光学部分将光汇聚在传感器上成像之后，就需要利用传感器获取图像信息。

目前，相机传感器可以分为单个传感器、条带传感器、环形条带传感器和阵列传感器：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/0c2656566d2f4d0d9b8218351e63c85c.png#pic_center)  
 单个传感器  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/25cd16b194ee463d8440d694ddf8898e.png#pic_center)  
 线性条带传感器(左) 环形条带传感器(右)

阵列传感器是数字相机中采用的主要传感器，例如CCD队列传感器，CMOS队列传感器，它具有较宽范围的传感特性，并能封装成具有大量单元的稳定阵列，其主要优点是将能量聚焦到阵列表面即可获取到一张完整的图像。

### 2.传感器的构造与原理

#### 2.1.传感器构造

线条传感器和阵列传感器的单元阵列分布：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fc4a079c39d24e30b5f8bc08ff48598a.png#pic_center)  
 阵列传感器的基本组成结构：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e7253c0e2cbc462796170f9e749003ce.png#pic_center)  
 微透镜可以帮助光电二极管收集更多的光，颜色滤镜可以吸取固定颜色的光线，光电二极管负责将光子转换为电子，势阱负责存储电子。

#### 2.2.颜色滤镜原理

##### 2.2.1.什么是颜色？

光是一种电磁波，光的颜色并不是客观属性，客观属性是光的波长。下图展示了几乎完整的电磁波谱，而我们人眼所能看到的只是其中400nm—700nm的一小段，而颜色则是我们对这一小段电磁波的主观感觉而已。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/6e0c76e54eac41769938ca57d0e25c9e.png)

在如上电磁波谱图中，从左到右，光波(Wavelength)长度逐渐变长，频率(Frequency)逐渐变小。注意： `波长越短，频率越大，则热量越高；波长越长，则频率越小，相应的热量越低`。这也为什么紫外线和一系列射线会危害人体生命安全的原因。

人眼对颜色的主观感受与入射光的功率谱分布(SPD) 和人眼对不同光源的光谱敏感度(spectral sensitivity) 都有关。我们接下来分别探讨这两个概念。

人眼对颜色的主观感受与入射光的**功率谱分布(SPD)** 和人眼对不同光源的**光谱敏感度(spectral sensitivity)** 都有关。我们接下来分别探讨这两个概念。

##### 2.2.2.光源的功率谱分布(SPD)

在日常生活中，我们常常会发现不同光源所发出的颜色有所不同，正如下图所示：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/1ed64eb2388e47d0bfc0c478d372f6f3.png#pic_center)  
 那么如何形容不同光源所发出的光？

通常光源是由多个波长的光所组成，而每种波长的光的功率一般都不一样。例如画出每种波长的功率与它波长之间的关系，我们就可以得到光源的**功率谱分布**(SPD)。如下图（不同光源的功率谱分布）所示：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5294533cb51d454d85fa6263b95edeaa.png)

##### 2.2.3.光谱敏感度函数(SSF)

我们提出颜色只是人眼对光的主观感觉，那么人眼对不同波长的敏感度将会决定最终人眼所看到的颜色。实际上人眼包含三种对不同光波敏感的视锥细胞，对光波的敏感度可以用光谱敏感度函数(SSF) 来表示。最终的感觉由这三种细胞的响应共同构成：

"
s
h
o
r
t
"
S
=
∫
λ
Φ
(
λ
)
S
(
λ
)
d
λ
"short" \quad S = \int_\lambda \Phi(\lambda) S(\lambda) d\lambda
"short"S=∫λ​Φ(λ)S(λ)dλ

"
m
e
d
i
u
m
"
M
=
∫
λ
Φ
(
λ
)
M
(
λ
)
d
λ
"medium" \quad M = \int_\lambda \Phi(\lambda) M(\lambda) d\lambda
"medium"M=∫λ​Φ(λ)M(λ)dλ

"
l
o
n
g
"
L
=
∫
λ
Φ
(
λ
)
L
(
λ
)
d
λ
(1)
"long" \quad L = \int_\lambda \Phi(\lambda) L(\lambda) d\lambda \tag{1}
"long"L=∫λ​Φ(λ)L(λ)dλ(1)

其中：

* Φ
  (
  λ
  )
  \Phi(\lambda)
  Φ(λ) 表示入射光线的 **SPD**。
* f
  (
  λ
  )
  f(\lambda)
  f(λ) 代表人眼的 **SSF**。

传感器为了模拟人眼成像的原理，同样对不同波长的入射光线会有不同的敏感度，可以用 **光谱敏感度函数 (SSF)** 来衡量。 传感器对入射光的响应是一个累加了对所有光波响应的值，表示为：  
 
R
=
∫
λ
Φ
(
λ
)
f
(
λ
)
d
λ
(2)
R = \int_\lambda \Phi(\lambda) f(\lambda) d\lambda \tag{2}
R=∫λ​Φ(λ)f(λ)dλ(2)

正如公式 (2) 所示，传感器对光波的响应是入射光 **SPD** 与传感器本身的 **SSF** 乘积的积分。

##### 2.2.4.颜色滤光阵列(Color Filter Array)

从上面的讨论中我们知道了人眼对不同的光波有着不同的**光谱敏感度函数**，那么传感器如何模拟人眼的**SSF**？这里涉及到两个问题：（1）如何设计滤光静对不同光线的敏感度；（2）如何设计不同颜色滤光镜的最佳空间排列。

在传感器中，颜色滤镜以预先设定好的形式来排列，构成**颜色滤光阵列**(Color Filter Array)。那何为颜色滤镜？  
 数码相机中使用数百万个微小的感光元来记录图像（图23）。当按下相机的快门并曝光时，每个感光元都会收集光子并转换为电子进行存储。当曝光结束、快门关闭时，相机将尝试测量电信号的强度来评估每个感光元中的电子数量，然后将电信号量化为数字信号，其数字精度由图像位深确定。例如JPEG照片的图像深度为32位，有RGB三种颜色，将用8位二进制存储每一种颜色的数值，那么对于一种颜色的像素值就有2^8=256种情况，可以发现：位数越高，则颜色越精细。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/94e8d3ad0c4942ada6389627aab6ede2.png)  
 图：感光元捕获图像信息

但是存在一个问题：感光元无法区分每种颜色电子的数量，因此通过上述方法只能捕获灰度图像。为了捕获彩色图像，我们必须为每一个感光元上方设置一个滤镜，该滤镜仅允许特定颜色的光子通过：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d163a45cf4f64a20bd966852ca65f7ba.png)  
 图：颜色滤镜过滤颜色

从（图24）可以得知：每一个感光元只会捕获三种原色之一，会丢弃
2
3
\frac{2}{3}
32​ 的入射光。因此为了尽可能多地捕获图像的色彩，我们就需要设置合理的颜色滤镜阵列。  
 如何设置颜色滤光阵列是一个很热门的研究领域，不同的颜色滤光阵列：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/f6597ff423a74f2c9361273e25a5d86b.png)  
 图：各种类型的颜色滤光阵列

到目前为止，我们常用是**Bayer颜色滤光阵列**。以2 × 2的小区域来看，**Bayer阵列**包含的绿色传感器是红色或蓝色传感器的两倍。这样设计的原因有两个方面：①人眼对绿色更为敏感，所以使用了更多的绿色滤光片采集绿色；②与每种颜色均等相比，带有绿色像素的冗余所产生的图像看起来噪声更少，并且具有更好的细节。  
 设置颜色滤光阵列的过程，其实就是模拟人眼的**SSF**，不同的颜色滤光阵列会很大程度上影响最终图像的色彩。下图是Canon 40D和50D的**光谱敏感函数图**的比较。每个相机厂商，甚至是同一厂商的不同型号的相机传感器的SSF都可能存在不同。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/da0ad27f325e477587cf518824680f2e.png#pic_center)

#### 2.3.光电二极管原理

**光电二极管原理**： 爱因斯坦发现在高于某特定频率的电磁波照射下，某些物质内部的电子吸收能量后逸出而形成电流，这被称为“**光电效应**”（下图）。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/7c7012f91b364f50842961ce8fb8c2da.png#pic_center)  
 以阵列传感器为例：当能量（或光）投影到传感器上时，首先入射光子会被微透镜汇聚，由颜色滤镜吸收对应颜色的光线，然后光电二极管将入射光子转换为电子并存储在势阱中。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/48c8ee0556d64aca87fac2b889657f26.png#pic_center)

上面就是传感器处理入射光的全流程，最终输出电子。

### 3. 数字成像传感器的基本结构与光电转换原理

（1）**感光单元（像素）的核心：光电二极管**  
 无论是CCD还是CMOS传感器，其感光元件单元（Pixel）本质上是半导体构成的**光电二极管**。`当光子射入像素区域并被半导体材料（通常为硅）吸收后，会在像素的势阱中产生电子-空穴对。电子受势阱吸引积累形成电荷信号。积累的电子数与入射光子量基本呈线性关系，从而实现光强信号的转换。`

（2）**传感器与光学滤镜阵列**  
 在传感器表面通常有**微透镜阵列**（Microlens Array）聚焦更多光线进入各像素，从而提高光电转换效率。此外，绝大部分彩色数码相机传感器还覆有**拜尔滤色阵列**（Bayer Filter），由红、绿、蓝（RGB）三色滤色片分布在各像素上，使每个像素对特定色彩波段敏感。最终通过后续插值处理（Demosaicing）重建完整的彩色图像。

### 4. CCD（电荷耦合器件）工作原理详解

**（1）CCD基本结构**  
 CCD传感器的基本单元是`光电二极管或MOS电容构成的感光像素井`。曝光期间，像素井内累积的电荷表示入射光子数量。在读出过程中，CCD依赖严格的时序控制，将积累的电荷逐行、逐列“接力式”地向传感器边缘的输出放大器转移，最终将整块感光阵列中所有像素的电荷移出，并在相同放大器中读出信号。

**（2）电荷转移与读出机制**  
 CCD的关键特性在于：

* **逐行移位传输**：CCD通过时钟脉冲将各行像素电荷依次向读出端（通常在传感器边缘设置的输出放大器）转移。
* 设想一个N×M的像素阵列，曝光结束后，每个像素内含有一定电荷(每个像素本身仅负责收集和存储电荷，不进行像素级放大或独立输出)。`CCD的控制时序使第一行电荷沿行方向转移到输出放大器的寄存器中，然后这一行电荷逐像素输出并转换为电压信号。接着第二行电荷移位到第一行位置，再输出，如此循环，直到所有像素的电荷被读出`。
* 这一过程就像流水线，把全片存储的电荷逐行、逐像素地移向输出放大器。由于此过程电荷严格按照线性顺序移动，像素与像素间匹配性很高，输出信号一致性好，从而`降低固定模式噪声`。

**（3）CCD的优势与问题**

* **优势**：像素间一致性高，输出信号品质均匀，低固定模式噪声，图像质量优异；在早期成像器件中广泛应用于科研、天文成像和专业摄影器材。
* **不足**：CCD逐行移位需要额外的电荷耦合路径，读出速度较慢，且功耗高。此外，制造CCD工艺复杂且成本较高，传感器面积大时的读出速度和复杂性也更具挑战。

### 5. CMOS（互补金属氧化物半导体）传感器工作原理详解

（1）**CMOS像素结构**

CMOS传感器每个像素中不仅有`光电二极管`（感光元件），还内置若干有`源元件`（如MOSFET晶体管）以`实现信号的放大与读出`。典型的CMOS像素包含：

* 光电二极管：将光转化为电荷
* 转换晶体管（Transfer Gate）：控制电荷从光电二极管转移至储存节点或直接到源跟随器
* 源跟随放大器（Source Follower）：每个像素具有自己的小型放大电路，将电荷信号直接转换为电压信号。
* 复位晶体管（Reset）：将存储节点复位到参考电压
* 行选择晶体管（Row Select）：选择性地将该像素输出到列总线上

CMOS像素是一个集成了感光与放大功能的微电路单元，使得每个像素可以直接输出电压信号。换言之，CMOS中每个像素相当于一个微型传感、放大模块。这种结构为随机访问与高速读出奠定基础。

**（2）随机访问与并行读出**

`与CCD需要逐行移位电荷不同，CMOS通过地址逻辑可随意访问任何一行像素`。当行选择晶体管被激活，该行像素的信号通过列线输出到读出电路。

* 这种架构允许CMOS传感器同时对多行进行操作，从而实现高速读出。
* CMOS的读出过程更像在处理一个二维阵列的内存寻址，可以提高帧速率，减少功耗，还能实现局部放大（Region of Interest）读取。

**（3）CMOS的放大与噪声特性**  
 虽然每个像素都有独立放大器，但这会导致像素间存在固定模式噪声（FPN）：由于工艺微差，每个像素的放大器增益或偏置电平略有不同，从而在图像上呈现固定的**条纹或斑点状噪声**。  
 为减小FPN，CMOS传感器通常配备`片上校正电路`和`后期数字校正`，通过双采样（Correlated Double Sampling, CDS）和数字电路减少读出过程中的偏移与噪声。

**（4）CMOS的优势与问题**

* **优势**：低功耗、高速读出、制造成本相对较低（可与标准CMOS工艺兼容），易于集成片上处理电路（ISP）。因此CMOS传感器逐渐在消费级数码相机、手机摄影、车载摄像头和各类嵌入式成像领域占据主流。
* **不足**：早期CMOS器件噪声较高、画质不如CCD，但随着工艺进步和信号处理技术的提升，CMOS画质已大幅改善。在高端应用中（科学成像、医疗或天文）CMOS方案也正快速普及。

### 6. 读出与信号转换

**（1）模拟信号与模数转换（ADC）**  
 无论CCD还是CMOS，在读出端都会将`电荷信号转换为电压`，再通过片上或片外的ADC（Analog-to-Digital Converter）将`电压信号量化为数字信号`（比特值）。  
 CMOS传感器往往集成片上ADC，可以实现更高整合度与快速输出。CCD一般需要外部ADC转换电路。

**（2）信号处理与ISP（Image Signal Processor）**  
 数字信号输出后会进入图像信号处理器（ISP），进行去噪、白平衡、色彩还原、伽马校正及压缩等处理步骤。CMOS架构有利于直接在传感器芯片附近集成这些电路，提高信号处理速度与降低信号路径噪声。

### 7. 传感器特性与性能指标

（1）**灵敏度与动态范围**  
 CCD与CMOS基本的光电子转换原理相同，性能差异更多来自工艺与设计。改良工艺可提升量子效率（QE）、降低读出噪声，提高动态范围。高端CMOS与CCD在灵敏度和动态范围上并无绝对分界，须视具体设计而定。

（2）**暗电流与噪声控制**  
 半导体受热会产生暗电流（无光条件下也有电子产生），影响图像质量。CCD与CMOS都需要对暗电流进行优化，可通过冷却传感器、使用更纯净晶体材料、优化像素结构来降低此问题。

（3）**全局快门与滚动快门**  
 传统CMOS采用逐行扫描，存在滚动快门效应（快速运动物体会出现形变）。为此，部分CMOS引入全局快门像素结构，使所有像素同步曝光，消除滚动失真。这是CMOS设计的进步方向之一。

衡量传感器性能的基本指标：

* **Photodiode quantum efficiency(QE)**： 光电二极管量子效率
* **Photodiode response function**： 光电二极管响应函数
* **Photodiode full well capacity**： 光电二极管满阱容量

**光电二极管量子效率**： 衡量有多少入射光子会被光电二极管转换成电子，也就是转换的电子数量与入射的光子数量的比值：

Q
E
=
#
 
e
l
e
c
t
r
o
n
s
#
 
p
h
o
t
o
n
s
.
(2)
QE=\frac{\#\,electrons}{\#\,photons}.\tag{2}
QE=#photons#electrons​.(2)

​  
 **光电二极管响应函数**： 通常来说，当不断改变入射光的强度时，转换的电子数量也会发生改变，并且光子数量与电子数量之间是线性关系，可以用一个线性函数来表示，而这个函数就是光电二极管的响应函数。注意：当势阱饱和（过曝）、光线过暗或者产生噪音时，响应函数将不会是线性的。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/19a7becf6a4c4cc0a602122a9960c7c1.png#pic_center)

**光电二极管满阱容量**： 势阱的最大容量称为满阱容量，衡量势阱最多可以存储多少电子。由于硅中光子的有限和固定的吸收长度，基本上满阱容量就是关于像素面积的函数。（图23）展示了常见相机传感器的满阱容量。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/8db5b8e343264b7b989a127425a87510.png)

### 8.模拟前端

#### 8.1.模拟前端的工作流程

入射光经过传感器的处理之后，转换为电子，但如何将电子转换为数字图像信号？  
 模拟前端用于将电子转为数字信号，它的转换流程如下图所示：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/197f59352b01441798413bff97cf7cf6.png)

首先，当相机镜头关闭时，模拟前端从传感器的势阱中读出电子，并转为模拟信号。在将模拟信号转换为数字信号之前，我们需要利用**Analog Amplifier(Gain)** 放大信号。相机设置中的ISO就是关于信号放大的倍率，并且相机的Vignetting(渐晕) 也与模拟前端部分有关。

经过放大后的模拟信号将由**Analog-to-digital converter(ADC)** 转为10bits-16bits的数字信号，常见为12bits。

**Look-up table(LUT)** 用于在一定范围内修正传感器响应的非线性，同时还能修复一些损坏的像素输出。

#### 8.2.Vignetting(渐晕)

前面提到了一种现象叫做**Vignetting(渐晕)**，它实际上是指生成的图像四周比中间暗，如下图所示（Vignetting现象）：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d9c2e498d66146dd92746cf955a3796c.png#pic_center)

**Vignetting**的产生原因包括：

* **机械原因**： 边缘的光线被滤镜遮挡
* **镜头原因**： 边缘光线被镜头内组件遮挡
* **物理原因**： 光衰减与光入射到传感器阵列角度的余弦的四次方成比例（cos4定律）
* **像素原因**： 在正常角度下的入射到传感器上的而产生的信号比以斜角入射光的信号强

**Look-up table**(LUT) 可以产生非线性的Gain从而纠正**Vignetting**现象，如下图所示（LUT纠正Vignetting现象）：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/69b56d31b38449648ce52963a0d9f9c0.png)

#### 8.3.模拟信号转为数字信号

**Analog-to-digital converter(ADC)** 将模拟信号转为数字信号的过程中，主要包含两种处理：取样和量化。

取样和量化的基本概念：如下图所示(提取图像的幅度值)，一副连续的图像 
f
f
f ，图像的 
x
x
x 坐标和 
y
y
y 坐标都是连续的，其幅度也是连续的，想要将其图像数字化就需要对该图像的坐标和幅度进行取样，对坐标值进行数字化被称为取样，对幅度值进行数字化被称为量化。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/4fd042a4cd0944d5a550a56c5d8f1ec4.png#pic_center)

首先，我们沿着上图的AB线段提取出图像幅度值的曲线，得到对于如下的一维函数图(像幅度值的曲线)，接下来我们将对其进行取样和量化操作。  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ab84ed192ad64a5db33f87f3d9ab738e.png#pic_center)  
 对于一个连续的幅度值曲线，将样本由叠加在函数上的小方框来表示，每个小方框的离散位置由图像底部对应的刻度标记指出，并将亮度值也转换（量化）为离散量，最终将一条连续的曲线转换了数个离散的样本点,如下图所示（图像幅度值的采样和量化）：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a5cac33180154111af6e027779ba95d2.png)

图像取样和量化之后的效果,如下图所示（传感器输出的连续图像；图像取样和量化后的结果）：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/abea9508cfab49979af364fabbd50df2.png#pic_center)  
 经过图像取样和量化后，我们获取了数字图像。存储数字图像十分简单，例如对于一张灰度图来说，灰度值被归一化到区间[0,1]，每一个像素点的灰度都是0、0.5或1，分别代表黑色、灰色或白色，如下图所示(数字图像的存储)：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/b7d46f7308f04132a908351d4bf57200.png#pic_center)

#### 8.4.生成RAW图像

**RAW格式**的全称是(RAW Image Format)，`记录了由相机拍摄所产生的一些元数据，如ISO的设置、快门速度、光圈值、白平衡等信息`。注意： 每个相机厂商有自己的RAW格式，并不一定以.raw当后缀的文件才是RAW图像。

当入射光经过传感器转换为电子，模拟前端再将电子转换数字信号生成RAW图像时，图像会变成什么样呢？可以看到RAW图像显示出马赛克一样的方块，并且还有大量的噪声。所以，接下来就是通过相机内的图像处理系统对图像进行一系列处理，来使之变成最终美观的RGB图像，如下图所示(JPEG图像(左);RAW图像(右)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/15d8a0a7468e4c249d1565b78940d21d.png#pic_center)

### 9.图像处理部分 ISP(Image Signal Processing)

对于获取的RAW图像，为了获取更加美观的JPEG图像，我们将在本节中对图像白平衡、去马赛克、去噪、颜色空间转换、色调重建以及最终压缩成JPEG图像，如下图所示(ISP的工作流程)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/7674caa317c74c7e95bf4b5b6e906bec.png#pic_center)

#### 9.1.白平衡(white balance)

由于不同的传感器使用的材料和工艺上有所不同，再加上光源差异，经过颜色过滤阵列捕获的RGB三个通道的数据相差很远，这就会导致本来应该是黑白灰的颜色变成其他颜色。幸运的是人眼可以纠正颜色，从而在不同的光源下，我们仍然可以正确地感知颜色，如下图所示(在不同光源下，人眼自动纠正物体的颜色)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/632b65036051491ea466151a47bb0040.png#pic_center)

但相机不具备这样的功能，因此如果不经过颜色的校正，拍出来的图片的颜色就会很失真。这就是白平衡的作用：它使我们人眼所感知的白色与最终照片上呈现的白色保持一致。如下图所示(白平衡前后的效果对比)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/76768eb10e924b76bed97ed316496fd5.png#pic_center)  
 自动白平衡是一个很热门的研究领域，这里我们介绍两种基本的白平衡算法。正如前面所讲，白平衡是要使得我们人眼感知到的白色最后成像也是白色，那么首先就要确定图像中哪些是白色。这里有两种假设：

* **灰色世界假设(Gray World Assumption)**  
   假设图像的平均颜色是灰色，其算法可以表示为：  
   ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/acf66acb5f4a435298816297ccb217f5.png)
* **白色世界假设(While World Assumption)**  
   假设图像中最亮的区域是白色，其算法可以表示为：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/87d1d79f09a14c95b87a7cc747a22919.png)

#### 9.2.去马赛克(Demosaicing)

RAW图像只包含一个通道，我们想要获取彩色图像就必须把RGB三个通道分离出来。如何分离？  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/f6bd84d728c144d780a96d326a2e0f91.png#pic_center)  
 如何从RAW图像中分离RGB三通道，去马赛克的方法主要是通过“插值”的方法来完成。常见的插值方法：

* Bilinear插值
* Bicubic插值
* Edge-Aware插值

在这里，我们使用Bilinear插值来完成去马赛克。思路很简单，就是用待定像素的四个邻居像素的平均值来填充该像素，如下图所示(Bilinear插值方法)：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a4084e068f9944c5868fb8edc1556832.png#pic_center)  
 对于不同的颜色通道则独立的重复这一过程，如下图所示(不同领域的Bilinear插值)：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a641c10a426948618349370f0c7158c5.png#pic_center)  
 最终分离出RGB三个通道，如下图所示(去马赛克的效果)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/c01e83a7f3584b70a586fb2ee68c57dd.png#pic_center)

#### 9.3.去噪(Denoise)

经过去马赛克处理之后，RAW图像将变为彩色图像。此时的图像效果如下图所示，不难看出图像中存在着一些噪声，如下图所示(未去噪的图像)：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ba784f307fca438e9dd48aacbb72a6ba.png#pic_center)  
 未经过去噪处理的图像往往在光线暗淡时，噪声会更多。噪声的种类：

* **散粒噪声**  
   散粒噪声是光子发射的随机性所导致的。比如一个光子可能出现在P1和P2位置，其概率分别为0.2和0.8，那么如果有10个光子，本来应该是2个在P1位置，8个在P2位置，但是存在量子涨落，P1只有1个光子，而P2有9个，那么实际情况与理论情况产生偏差，这个就是所谓的散粒噪声。散粒噪声是最主要的噪声来源。
* **暗粒噪声**  
   ​ 传感器发热导致逸出电子从而产生的噪声，温度越高，噪声越大。
* **读取噪声** ​ 由于读取电路所引起的噪声。

  **那么如何去噪**？ 在本文中，我们只讨论相机内部的去噪算法。由于大部分相机本身的运算能力不高，所以意味着我们只能选取较为简单且利于硬件处理的算法。考虑篇幅问题，本文只介绍均值滤波和中值滤波两种算法：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/b58e2c0acecb40a38e2aeac495d01c0e.png)

#### 9.4.色彩空间转换(Color space transform)

**色彩空间**（Color space） 是对色彩的组织方式，是一个颜色的范围。JPEG这种压缩格式最多可以包含1670万色，但目前尚未有任何一种色彩空间使用到完整的1670万色。而色彩空间就是允许使用者在这1670万色中使用较宽或是较窄的范围。比如：XYZ和sRGB这两种色彩空间设置的色彩范围如下图所示，大范围是XYZ色彩空间，RGB三点所构造的范围是sRGB色彩空间：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/c909994657d040d0ab6de12357e8b5ff.png#pic_center)

我们常说的RGB色彩空间是与设备相关的，也就是说在不同的领域，不同的设备中存在不同的RGB空间。由于RGB色彩空间与设备相关，因此同一张照片在不同的设备上将会出现色彩差异。

为了解决上述问题，CIE提出了CIE XYZ，微软和惠普提出sRGB。这两种色彩空间都是标准色彩空间且与设备无关，意味着，只要相机和电脑采用相同的色彩空间，图像就不会存在色彩差异。

回归主题，在传感器生成RAW图像的过程中，采用的便是与设备相关的RGB色彩空间，因此在生成JPEG图像之前，我们还需要将图像的色彩空间转换为标准的、与设备无关的色彩空间。

**颜色空间的变换**。其实，不同色彩空间的的转换就是一个线性变换的过程，因此只需要乘上一个变换矩阵，就可以变换为相应的色彩空间。例如，**Sensor RGB色彩空间**向**sRGB色彩空间**转换的流程如下所示（Sensor RGB向sRGB的变换流程）：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fe41da1c652a4a09af0a08bbe20c1928.png)

可以看到为了得到sRGB图像，我们经过了Sensor RGB->XYZ->LMS->WB->XYZ->sRGB的过程，其中WB（白平衡）放在了这里，与我们原来描述的白平衡在前的方式不同（这取决于设备生产商，不同的厂商做法不一样，总的来说，在工业界更加倾向于白平衡在前的做法）。

颜色转换与随后的Tone reproduction共同构成了“颜色渲染"部分，这一步每个设备生产商甚至同一生产商的不同设备的做法都是不一样的。这也是为什么我们用不同设备拍摄同一场景时，所看到的照片颜色不一样的原因，如下图所示(同一场景中，不同相机的拍摄效果)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/51fd3d67c05c4c40a050f1acc32160bd.png#pic_center)

#### 9.5.色调重建(Tone reproduction)

**色调重建，也叫做Gamma校正**。 我们知道传感器对光线的响应基本上是线性关系，但是人眼对于光的响应是非线性的。也就是说，如果不对传感器处理的图像进行校正，那么我们会感觉照片的颜色过暗，如下图所示(传感器与人眼对光的响应不一致导致照片颜色过暗)：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/89ba88eac6ca4f0091b27722a871d9a4.png)  
 如何理解人眼对于光的响应是非线性？假如我们在一间漆黑的房间里面，点亮一根蜡烛，那么人眼会很敏锐地注意到这根点燃的蜡烛，如下图所示(点燃一根蜡烛)：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/e3ade22fa39745b6ade51ca9b6dfa25c.png#pic_center)  
 然后我们继续点燃更多的蜡烛，在最开始蜡烛的数量很少时，哪怕点燃一根蜡烛，我们也会很快注意到它的存在，但是当已经点燃很多蜡烛之后，再去点燃几根蜡烛时，人眼已经无法轻易判断出是否有新蜡烛被点燃。如下图所示(当点燃的蜡烛很多时，再点燃一根蜡烛已无法意识到它的存在)：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/b2b23e70b7c04b64b8f52e6750ac030d.png#pic_center)

对于上述现象，究竟是什么原因导致的？其实这就是人眼对光的非线性响应。人眼天生就对黑暗敏感，在光线很暗时，哪怕有一点亮度，也会引起人眼的巨大响应，而随着亮度不断增强，人眼对光的响应也将逐渐降低。如下图所示（人眼对光的非线性响应）：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/b549303efb3b464cb4edc6215ae0c40b.png#pic_center)  
 当我们感知到0.5程度的亮度时，而实际的光强度其实只有0.2程度。如果相机不对图像校正，意味着当为了获取数字图像而进行采样、量化时，会采用线性的方式完成：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5725e07b656c4690ba72a1802e1709d6.png#pic_center)  
 对亮度线性采样的结果为纵轴左边的量化图。可以发现，对于暗部的划分很粗糙，0.1程度的光强度将对应一大块的暗部，而对亮部的划分又很细腻。线性采样保留了大量的亮部细节，而忽略了暗部细节，但人眼恰好对暗部很敏感，而对亮部不敏感，导致最终生成的图像会过暗。

为了避免线性采样的不足，我们可以尝试下列几种采样方式：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fca3e9844ce3462eb6172d7524d92110.png#pic_center)  
 密集型线性采样

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5d20b26bc0ff4448925a53c1649e1987.png#pic_center)非线性采样

密集型线性采样把暗部也进行了细致地划分，但是整体所保留的细节信息过多。非线性采样既细致地划分暗部细节，同时还节省了大量的空间。再对比一下线性采样与非线性采样的差别：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/8f7d551e6f3d43e5836d654f1c94b206.png#pic_center)

由于相机是按照非线性对亮度进行采样，因此显示端同样也需要通过非线性的方式对图像进行渲染。注意：相机生成图像是把光强度映射为亮度编号，显示器则是把亮度编号映射为光强度，因此显示端的图像亮度渲染函数与相机映射图像亮度的函数是相反的。如下图所示（相机采样方式与显示渲染方式）：  
 ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5f4c1273f56f4062981fa15cfdd1702d.png)  
 简单来讲，为了解决传感器与人眼对光亮的响应差异性，我们对传感器所采集到的图像进行了Gamma校正，使线性响应变为非线性响应，从而模拟人眼的对光亮的响应，如下图所示（加入Gamma校正之后效果）：

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/ff90abefa36049409c509b221e9e275e.png)

## 五、感光灵敏度（ISO）与增益控制

### 1. 感光灵敏度（ISO）的定义与本质

**（1）ISO的由来**

**ISO感光度**标准源于胶片时代。传统胶片有固定感光度，如ISO 100或ISO 400，`表示在给定光照条件下达到合适曝光所需的光量`。在数码时代，ISO沿用此概念，成为`衡量传感器系统对光信号敏感度的标度`。

**（2）数码相机中ISO的含义**

数码相机中，ISO并非改变传感器本身对光子的吸收能力，而是`通过电路或信号处理将传感器输出信号进行增益放大`。

当设置为较低ISO（如ISO 100）：传感器信号放大较低，图像较暗但噪声也相对较低。  
 当设置为较高ISO（如ISO 3200或ISO 12800）：信号被强烈放大，图像更亮，但传感器`暗电流、读出噪声和电路噪声`也被同步放大，增加最终图像的颗粒感和噪点。

**（3）底本感光度（Base ISO）**

每款相机和传感器都有设计上的`最低ISO`，即底本感光度（Base ISO）。在此ISO下，传感器输出动态范围与信噪比处于最佳状态。一旦提高ISO，就是在此基础上增加放大倍数，使得弱光信号变得可用，但同时会带来噪声上升和动态范围压缩。

### 2. 增益控制的实现机理

**（1）模拟增益与数字增益**  
 在数码相机中，增益控制可分为模拟增益与数字增益两种方式：

* **模拟增益（Analog Gain）：**  
   在模拟信号从传感器读出后进入ADC（模拟-数字转换器）之前，使用放大电路对信号进行模拟放大。此时被放大的不仅是有效的光电信号，还有噪声信号，如读出噪声和暗电流噪声。  
   模拟增益通常在传感器前端电路中实现，`当提高ISO时，相机会调整模拟增益放大因子，使同样数量的入射光子产生更大的电信号，从而在较短曝光时间内获得更明亮的图像`。
* **数字增益（Digital Gain）：**  
   当模拟信号通过ADC转化为数字信号后，也可在数字域进一步放大像素值。这类似在后期处理软件中提高曝光值。`数字增益不会改变传感器捕获的原始电子数目，只是将数字数值乘以一个因子，因此同样会放大数字噪声`。

高端相机通常将模拟增益和数字增益混合使用，在低ISO时靠模拟增益为主，在极高ISO时会辅以数字增益，以实现更广的ISO范围。

**（2）增益电路的精密度和半导体工艺**  
 增益电路的设计与工艺水平影响提升ISO时的图像质量表现。高品质传感器、低噪声放大器（Low-Noise Amplifier）和高动态范围ADC是提升高ISO画质的关键。随着CMOS工艺不断进步和降噪算法优化，现代相机的高ISO表现不断提升，在极暗条件下仍可获得较清晰、可用的影像。

### 3. ISO的影响：亮度、噪声与动态范围

**（1）亮度提升的代价**  
 当你在暗光环境中拍摄，如夜景或室内昏暗场景，提高ISO可以弥补光线不足，减少需延长快门时间或使用大光圈的必要。更高ISO能用较短曝光时间达到足够亮度，减少运动模糊或手抖影响。

**（2）噪声增加的机理**  
 然而，提高ISO放大的是“信号+噪声”总和：

* 传感器固有的读出噪声（Read Noise）在增益下也同步放大。
* 暗电流噪声（Dark Current）与感光不均匀（Photo Response Non-Uniformity,PRNU）在增益下更显著。
* 整张图像可能出现斑点状的亮度或色彩随机波动（明亮像素噪声、色彩斑点）。

因此，高ISO下，图像较亮但更粗糙，需要依靠机内和后期的降噪算法来平滑杂点，但这些处理会牺牲锐度和细节。

**（3）动态范围缩小**  
 随增益提升，可用的动态范围变窄。低光信号被放大至可见程度，但强光部位更容易达到传感器饱和值，从而丧失高光细节。换句话说，`高ISO拍摄的图像对亮部容忍度变低，更容易出现高光溢出`。

---

参考文献：  
 [【计算摄影】相机成像原理：从光到JPEG图像](https://blog.csdn.net/qq_35149975/article/details/126165705)

结~~~



