---
layout: post
title: "SpringSpring整合以及事务控制"
date: 2025-03-15 11:24:41 +0800
description: "本文包括了Spring整合junit和mybaits的完整代码，介绍了sqlSessionFactoryBean，以及通过注解和xml实现事务，详细讲解了不同的传播行为和隔离级别"
keywords: "【Spring】Spring整合以及事务控制"
categories: ['Ssm']
tags: ['开发语言', '后端', 'Xml', 'Sqlserver', 'Spring', 'Mybatis', 'Java']
artid: "146276496"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146276496
    alt: "SpringSpring整合以及事务控制"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146276496
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146276496
cover: https://bing.ee123.net/img/rand?artid=146276496
image: https://bing.ee123.net/img/rand?artid=146276496
img: https://bing.ee123.net/img/rand?artid=146276496
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     【Spring】Spring整合以及事务控制
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h2>
     <a id="Spring_0">
     </a>
     Spring整合以及事务
    </h2>
    <h3>
     <a id="Spring_2">
     </a>
     Spring整合
    </h3>
    <h4>
     <a id="SpringJunit_4">
     </a>
     Spring整合Junit
    </h4>
    <p>
     导入依赖
    </p>
    <p>
     <img alt="image-20250315103214988" src="https://i-blog.csdnimg.cn/img_convert/062b604a8a824db43c7e1614e8f62b34.png"/>
    </p>
    <p>
     创建测试类
    </p>
    <p>
     <img alt="image-20250315103222602" src="https://i-blog.csdnimg.cn/img_convert/bfd0d2fd11cdbda11ebc34cd3fba8fbd.png"/>
    </p>
    <p>
     也可以使用这种方法找到xml文件位置
    </p>
    <p>
     <img alt="image-20250315103252646" src="https://i-blog.csdnimg.cn/img_convert/3ed931320cd74f29b41ca6b7fe047f81.png"/>
    </p>
    <hr/>
    <h4>
     <a id="SpringMybatis_20">
     </a>
     Spring整合Mybatis
    </h4>
    <p>
     导入依赖
    </p>
    <p>
     <img alt="image-20250315103318430" src="https://i-blog.csdnimg.cn/img_convert/d2556f367cb20acc3bcde6d39beab7df.png"/>
    </p>
    <p>
     JDBC配置文件
    </p>
    <p>
     <img alt="image-20250315103326401" src="https://i-blog.csdnimg.cn/img_convert/1aaa5325af6c86beb9edb4796938fc5c.png"/>
    </p>
    <p>
     spring核心xml文件配置
    </p>
    <p>
     <img alt="image-20250315103340376" src="https://i-blog.csdnimg.cn/img_convert/76473167dd673ed4407224e29b1a5bb1.png"/>
    </p>
    <p>
     mybatis核心配置文件
    </p>
    <p>
     <img alt="image-20250315103353831" src="https://i-blog.csdnimg.cn/img_convert/a91818fda1d7e2f585041eca068410ee.png"/>
    </p>
    <p>
     dao接口和实现类
    </p>
    <p>
     <img alt="image-20250315103425496" src="https://i-blog.csdnimg.cn/img_convert/cee80dde89c4448e3c1e3cb7e3710ebe.png">
      <br/>
      <img alt="" src="https://i-blog.csdnimg.cn/img_convert/b5606cb726cfcab0285aa9fd73586868.png"/>
     </img>
    </p>
    <p>
     实现类对应mapper文件
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/573c13949fdf4458aaa77fe4bc42c72b.png"/>
    </p>
    <hr/>
    <h4>
     <a id="sqlSessionFactoryBean_50">
     </a>
     sqlSessionFactoryBean
    </h4>
    <p>
     <img alt="image-20250315103532804" src="https://i-blog.csdnimg.cn/img_convert/252b636f36904d59fd6370d998f96b7f.png"/>
    </p>
    <p>
     基础的MyBatis中获取sqlSessionFactory对象
    </p>
    <p>
     <img alt="image-20250315103539656" src="https://i-blog.csdnimg.cn/img_convert/a553a0102505d0b7883db7955be878ec.png"/>
    </p>
    <p>
     Spring的xml文件中配置sqlSessionFactoryBean
    </p>
    <p>
     <img alt="image-20250315103549610" src="https://i-blog.csdnimg.cn/img_convert/4b6c1b430a09c1afb5747e890f4b08e0.png"/>
    </p>
    <p>
     实际上就是new了一个sqlSessionFactoryBean对象
     <br/>
     这里是通过getObject()来获取sqlSessionFactory对象
    </p>
    <p>
     源码：
     <br/>
     <img alt="image-20250315103646697" src="https://i-blog.csdnimg.cn/img_convert/f755b9bc52ce0d1d0a469d812a51ba67.png"/>
    </p>
    <hr/>
    <h4>
     <a id="Srping_70">
     </a>
     Srping解耦合
    </h4>
    <p>
     三层架构
    </p>
    <p>
     <img alt="image-20250315103716410" src="https://i-blog.csdnimg.cn/img_convert/2e58aaae2f1c373c4e8f6a83384e75d7.png"/>
    </p>
    <p>
     service实现类需要依赖dao实现类
     <br/>
     没有spring的时候需要new dao接口的实现类
    </p>
    <p>
     <img alt="image-20250315103735956" src="https://i-blog.csdnimg.cn/img_convert/a0ccf646789ddf40b11c72a05bd49afd.png"/>
    </p>
    <p>
     servlet没有实现类,要依赖service实现类
     <br/>
     new了service的实现类
    </p>
    <p>
     <img alt="image-20250315103757217" src="https://i-blog.csdnimg.cn/img_convert/ad00ea6d0d6bcf4335b7c6aa4fa1e718.png"/>
    </p>
    <p>
     <strong>
      spring改进测试类
     </strong>
    </p>
    <p>
     <img alt="image-20250315103812420" src="https://i-blog.csdnimg.cn/img_convert/33712355ccae37578d1dfbebf6068e31.png"/>
    </p>
    <hr/>
    <h3>
     <a id="Spring_92">
     </a>
     Spring事务
    </h3>
    <h4>
     <a id="_94">
     </a>
     注解实现事务
    </h4>
    <p>
     <strong>
      spring配置文件
     </strong>
    </p>
    <p>
     <img alt="image-20250315104945069" src="https://i-blog.csdnimg.cn/img_convert/7cecc4e3ccef87917c281dd73b8331da.png"/>
    </p>
    <p>
     <strong>
      @Transactional添加事务
     </strong>
    </p>
    <p>
     可以添加在方法和类上,添加到类就说明这个类所有的方法都支持事务
     <br/>
     一般都在service层添加事务
    </p>
    <p>
     <img alt="image-20250315104958368" src="https://i-blog.csdnimg.cn/img_convert/807d04eee8f61e3605b68491bf7e180d.png"/>
    </p>
    <p>
     <strong>
      事务的底层逻辑就是通过AOP增强解耦合
     </strong>
    </p>
    <p>
     所以要加上AOP依赖
    </p>
    <p>
     <img alt="image-20250315105028019" src="https://i-blog.csdnimg.cn/img_convert/acac1671a95a5156d46d1587adb205ff.png"/>
    </p>
    <hr/>
    <h4>
     <a id="xml_115">
     </a>
     xml实现事务（可跳过）
    </h4>
    <p>
     <img alt="image-20250315105015069" src="https://i-blog.csdnimg.cn/img_convert/ab3ed6ac251fa5436c8a1e1e0a296f8d.png"/>
    </p>
    <hr/>
    <h4>
     <a id="propagation_121">
     </a>
     传播行为
     <strong>
      propagation
     </strong>
     （重点）
    </h4>
    <p>
     当
     <strong>
      事务方法嵌套调用
     </strong>
     时，需要控制是否开启新事务，可以使用事务传播行为来控制
    </p>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/e48f9864d79e44c69c557d7761ded98a.png"/>
    </p>
    <p>
     <img alt="image-20250315105208039" src="https://i-blog.csdnimg.cn/img_convert/b2b0670b539b141e8b9769df200c806e.png"/>
    </p>
    <p>
     <strong>
      @Transactional本质
     </strong>
    </p>
    <p>
     <img alt="image-20250315105222066" src="https://i-blog.csdnimg.cn/img_convert/b08e7ca5d4307c2c1e81df11f4f9249a.png"/>
    </p>
    <p>
     我们需要
     <strong>
      日志出现异常的时候不需要回滚转账事务
     </strong>
     <br/>
     就需要控制事务的传播行为
    </p>
    <p>
     <img alt="image-20250315105253457" src="https://i-blog.csdnimg.cn/img_convert/8a524c60ec2246489ed501fbb14a7c53.png"/>
    </p>
    <p>
     默认情况下，外层test方法执行的时候有一个外层事务包裹，内层的转账和打印日志两个事务就加入这个外层的事务了，
     <strong>
      本身不会有单独的事务包裹
     </strong>
    </p>
    <p>
     我们可以给转账事务设置REQUIRES_NEW
     <br/>
     这时候这个转账事务就会在外层test事务的包裹下还会新建一个自身单独的事务
     <br/>
     转账完成后会自动提交
    </p>
    <p>
     <img alt="image-20250315111244423" src="https://i-blog.csdnimg.cn/img_convert/caeddd22841a5bba4be9eae2a0127b6f.png"/>
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/direct/444cb2d646fc4d709e8c2fe5ff958550.png"/>
    </p>
    <p>
     <strong>
      实际上就是new了一个新的连接对象，log还是和外层用一个连接对象
     </strong>
    </p>
    <hr/>
    <h4>
     <a id="isolation_154">
     </a>
     隔离级别isolation
    </h4>
    <p>
     <img alt="image-20250315111407323" src="https://i-blog.csdnimg.cn/img_convert/22e7aabc54b7f11fb634c343ff15a85d.png"/>
    </p>
    <p>
     <img alt="image-20250315111415811" src="https://i-blog.csdnimg.cn/img_convert/69d7c5197dac71ca48a906d9b6367b38.png"/>
    </p>
    <hr/>
    <h4>
     <a id="readOnly_162">
     </a>
     只读readOnly
    </h4>
    <p>
     <img alt="image-20250315111506116" src="https://i-blog.csdnimg.cn/img_convert/426c97b6c2adbac25dd8fabfba71180b.png"/>
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f:672e6373646e2e6e65742f323330325f37393434393633342f:61727469636c652f64657461696c732f313436323736343936" class_="artid" style="display:none">
 </p>
</div>


