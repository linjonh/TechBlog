---
layout: post
title: "UDP-Socket"
date: 2025-03-15 15:30:27 +0800
description: "网络编程基础概念，UDP Socket的常用接口和基础实现流程"
keywords: "UDP Socket"
categories: ['网络编程']
tags: ['网络协议', '网络', 'Udp']
artid: "146277512"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146277512
    alt: "UDP-Socket"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146277512
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146277512
cover: https://bing.ee123.net/img/rand?artid=146277512
image: https://bing.ee123.net/img/rand?artid=146277512
img: https://bing.ee123.net/img/rand?artid=146277512
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     UDP Socket
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="_1">
     </a>
     网络编程基础概念理解
    </h2>
    <p>
     <strong>
      IP地址：
     </strong>
     IP地址是互联网上每个设备的唯一标识。
     <br/>
     格式：
    </p>
    <ul>
     <li>
      IPv4：4组数字，如 192.168.1.1（共约43亿个，已不足）。
     </li>
     <li>
      IPv6：8组16进制数，如 2001:0db8:85a3::8a2e:0370:7334（解决IPv4不足的问题）。
     </li>
    </ul>
    <p>
     分类：
    </p>
    <ul>
     <li>
      公有IP：全球唯一，用于互联网通信。
     </li>
     <li>
      私有IP：局域网内使用（如 192.168.x.x，10.x.x.x）。
     </li>
    </ul>
    <p>
     <br/>
     <strong>
      端口号(Port)：
     </strong>
     区分同一设备上的不同服务或应用程序，标识该主机中的进程。
    </p>
    <p>
     端口号分类：
    </p>
    <ul>
     <li>
      知名端口（0-1023）：预留给系统服务，如 80（HTTP）、443（HTTPS）、22（SSH）。
     </li>
     <li>
      注册端口（1024-49151）：分配给常见应用，如 3306（MySQL）、3389（远程桌面）。
     </li>
     <li>
      动态端口（49152-65535）：临时分配给客户端程序（如浏览器访问网站时随机生成）。
     </li>
    </ul>
    <p>
     【
     <strong>
      IP : Port = 标识互联网中该IP对应的主机上对应端口号的进程，也就是套接字Socket。
     </strong>
     】
    </p>
    <p>
     <br/>
     <strong>
      网络字节序：
     </strong>
     <br/>
     计算机在存储多字节数据（如整数、IP地址）时，有两种不同的排列方式：大端序 和 小端序。
    </p>
    <p>
     <strong>
      网络字节序统一规定网络传输时数据的字节序，为大端序。
     </strong>
    </p>
    <p>
     为了保证字节排序方式一定相同，从主机发送数据到网络上 和 从网络上接收数据到主机 都需要对数据字节排序方式进行转换。
    </p>
    <p>
     <strong>
      端口号转换函数：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/2bd0a895a2d24f4197f15f17d2430539.png"/>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span>  <span class="token comment">// Linux</span></span>
<span class="token comment">// #include &lt;winsock2.h&gt;  // Windows</span>

<span class="token class-name">uint16_t</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> network_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 主机序 → 网络序</span>
<span class="token class-name">uint16_t</span> host_port <span class="token operator">=</span> <span class="token function">ntohs</span><span class="token punctuation">(</span>network_port<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 网络序 → 主机序</span>
</code></pre>
    <p>
     <strong>
      IP地址转换函数：
     </strong>
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/75ca832265054b30a8a3d128711f03ed.png"/>
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>

<span class="token comment">// 字符串IP → 网络字节序二进制</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>ip_str <span class="token operator">=</span> <span class="token string">"192.168.1.1"</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">in_addr</span> ip_bin<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">inet_pton</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> ip_str<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ip_bin<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 转换失败处理</span>
<span class="token punctuation">}</span>

<span class="token comment">// 网络字节序二进制 → 字符串IP</span>
<span class="token keyword">char</span> ip_str_buffer<span class="token punctuation">[</span>INET_ADDRSTRLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token function">inet_ntop</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ip_bin<span class="token punctuation">,</span> ip_str_buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>ip_str_buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 转换失败处理</span>
<span class="token punctuation">}</span>
</code></pre>
    <p>
    </p>
    <h2>
     <a id="sockaddr_sockaddr_in_sockaddr_un__62">
     </a>
     sockaddr 结构，sockaddr_in 结构和sockaddr_un 结构
    </h2>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/a8c00c9b66b04b0d8faeaf7f546e30f5.png">
      <br/>
      <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/82e24eeb329a4db5905db48db0c1423a.png">
       <br/>
       <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/1cdd8ef18a6c49e3a76a0c4127f5a661.png">
        <br/>
       </img>
      </img>
     </img>
    </p>
    <h2>
     <a id="UDP_67">
     </a>
     UDP协议
    </h2>
    <p>
     UDP（User Datagram Protocol 用户数据报协议）： 传输层协议，面向数据报，用于需要“高速传输”的场景，例如视频通话、在线游戏等。
    </p>
    <p>
     <strong>
      核心特性：
     </strong>
    </p>
    <ol>
     <li>
      无连接：无需建立连接，直接发送数据（没有三次握手）。
     </li>
     <li>
      不可靠传输：不保证数据是否到达、是否按序到达、是否重复。
     </li>
     <li>
      轻量高效：没有确认应答、重传、流量控制等机制，传输开销极小，速度极快。
     </li>
     <li>
      支持广播/组播：可以一次性向多个设备发送数据（如直播流媒体）。
     </li>
    </ol>
    <p>
    </p>
    <h2>
     <a id="UDP_Socket_79">
     </a>
     UDP Socket编程常用接口
    </h2>
    <h3>
     <a id="Socket_80">
     </a>
     创建Socket
    </h3>
    <p>
     接口：
     <code>
      socket()
     </code>
     创建通信端点。
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/9bee48891923495c937b87c410255abf.png"/>
    </p>
    <pre><code class="prism language-c"> <span class="token keyword">int</span> sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 <span class="token keyword">if</span> <span class="token punctuation">(</span>sockfd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket creation failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <h3>
     <a id="IP_99">
     </a>
     绑定IP和端口（仅服务端需要）
    </h3>
    <p>
     接口：
     <code>
      bind()
     </code>
     用于将套接字与特定的 IP 地址 和 端口号 绑定，使其能够在该地址和端口上监听或接收数据。
    </p>
    <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
    <p>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/436ff578691b43198c93a822f78b8749.png"/>
    </p>
    <pre><code class="prism language-c"> <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> servaddr<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    servaddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    servaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    servaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>servaddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>servaddr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
    <p>
     <br/>
     <strong>
      注：
     </strong>
     udp客户端不需要显示绑定，系统会自动进行绑定。
     <br/>
     服务器端需要一直固定的IP和端口号，而客户端不需要固定的，只需要在每次连接的时候是固定的就行。
    </p>
    <h3>
     <a id="_124">
     </a>
     收发数据
    </h3>
    <p>
     接口：
     <code>
      sendto()
     </code>
     向指定的目标地址发送数据（UDP 是无连接的，每次需明确目标地址）。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/ebec3e5862f54ebd8a604fe6115205a8.png"/>
    </p>
    <pre><code class="prism language-c"><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> msg <span class="token operator">=</span> <span class="token string">"Hello from UDP server"</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> destaddr<span class="token punctuation">;</span>
destaddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
destaddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
destaddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"192.168.1.100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 目标IP</span>

<span class="token class-name">ssize_t</span> n <span class="token operator">=</span> <span class="token function">sendto</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                 <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>destaddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>destaddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 
<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"sendto failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//client发数据给server，虽然客户端不需要绑定，但要发给server还是需要</span>
<span class="token comment">//在struct sockaddr_in server；之后把服务端的端口号和IP赋值给server</span>
<span class="token comment">//因为客户端需要知道服务端的 IP:Port</span>

</code></pre>
    <p>
     接口：
     <code>
      recvfrom()
     </code>
     接收数据并获取发送方的地址信息（UDP 需要获取来源地址以回复）。
     <br/>
     <img alt="在这里插入图片描述" src="https://i-blog.csdnimg.cn/direct/525089c481504c0188b94c0d1e2842e0.png"/>
    </p>
    <pre><code class="prism language-c"><span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> cliaddr<span class="token punctuation">;</span>
<span class="token class-name">socklen_t</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>cliaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ssize_t</span> n <span class="token operator">=</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>cliaddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"recvfrom failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//服务端接收到客户端传来的信息后，cliaddr中就存储进了客户端的IP:端口号</span>
</code></pre>
    <p>
     <strong>
      注： recvfrom() 函数会将接收到的数据包中的源地址信息自动填入传进函数的那个结构体中。
     </strong>
    </p>
    <h3>
     <a id="_168">
     </a>
     关闭连接
    </h3>
    <p>
     接口：
     <code>
      close()
     </code>
     用于释放套接字资源。
    </p>
    <pre><code class="prism language-c"><span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Linux</span>
</code></pre>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f37343139373435352f:61727469636c652f64657461696c732f313436323737353132" class_="artid" style="display:none">
 </p>
</div>


