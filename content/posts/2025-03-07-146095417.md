---
arturl_encode: "68747470733a2f2f62:6c6f672e6373646e2e6e65742f6672616e6b3131303530332f:61727469636c652f64657461696c732f313436303935343137"
layout: post
title: "Hive-JDBC-å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„-Socket-è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
date: 2025-03-07 14:43:56 +0800
description: "Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
keywords: "Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
categories: ['æœªåˆ†ç±»']
tags: ['å¤§æ•°æ®', 'Hive', 'Hadoop']
artid: "146095417"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146095417
    alt: "Hive-JDBC-å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„-Socket-è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146095417
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146095417
cover: https://bing.ee123.net/img/rand?artid=146095417
image: https://bing.ee123.net/img/rand?artid=146095417
img: https://bing.ee123.net/img/rand?artid=146095417
---

# Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ

## Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ

---

### ğŸ” é—®é¢˜èƒŒæ™¯

åœ¨ä½¿ç”¨ Hive JDBC æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¶å‘
`SocketTimeoutException`
å¼‚å¸¸ï¼Œå †æ ˆæ˜¾ç¤ºåœ¨
`ResultSet.next()`
é˜¶æ®µè§¦å‘ã€‚

```text
2022-09-0921:13:02- ERROR java.sql.SQLException:retrieving next row
 at org.apache.hive.jdbc.HiveQueryResultSet.next(HiveQueryResult Set.java:392)
 at java.util.concurrent.FutureTask.run(FutureTask.java:266)
 ...

Caused by: org.apache.thrift.transport.TTransportException:java.net.SocketTimeoutException: Read timed out
 at org.apache.thrift.transport.TIOStreamTransport.read(TIOStrea mTransport.java:129)
at org.apache.thrift.transport.TTransport.readAll(TTransport.ja va:86)
at org.apache.thrift.transport.TSaslTransport.readLength(TSaslT ransport.java:376)
at org.apache.thrift.transport.TSaslTransport.readFrame(TSaslTr ansport.java:453)
at org.apache.thrift.transport.TSaslTransport.read(TSaslTranspo rt.java:435)
at org.apache.thrift.transport.TSaslClientTransport.read(TSaslC lientTransport.java:37)
at org.apache.thrift.transport.TTransport.readAll(TTransport.ja va:86)
at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryPr otocol.java:429)
at org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryPr otocol.java:318)
at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:219)
at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:77)
at org.apache.hive.service.rpc.thrift.TCLIService$Client.recv_F etchResults(TCLIService.java:559)
at org.apache.hive.service.rpc.thrift.TCLIService$Client.FetchR esults(TCLIService.java:546)
at sun.reflect.GeneratedMethodAccessor336.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMe thodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:497)
at org.apache.hive.jdbc.HiveConnection$SynchronizedHandler.invo ke(HiveConnection.java:1524)
at com.sun.proxy.$Proxy151.FetchResults(Unknown Source)
...

```

åŸå› å¦‚ä¸‹ï¼š

1. **é»˜è®¤è¶…æ—¶é™åˆ¶**
   ï¼š
     
   Hive åº•å±‚é€šè¿‡ Thrift åè®®é€šä¿¡ï¼Œé»˜è®¤çš„
   `socketTimeout`
   è¾ƒçŸ­ï¼Œå½“æŸ¥è¯¢è¿”å›å¤§é‡æ•°æ®æˆ–é›†ç¾¤è´Ÿè½½é«˜æ—¶ï¼Œè¯»å–ç»“æœå¯èƒ½è¶…æ—¶ã€‚
2. **ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜**
   ï¼š
     
   Hive 1.x~2.xç‰ˆæœ¬ä¸­ï¼Œ
   `setQueryTimeout`
   æ–¹æ³•å¯èƒ½æœªç”Ÿæ•ˆï¼Œéœ€é€šè¿‡å…¶ä»–å‚æ•°é…ç½®ã€‚

---

### ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šé€šè¿‡JDBC URLç›´æ¥é…ç½®è¶…æ—¶ï¼ˆæ¨èï¼‰

<https://issues.apache.org/jira/browse/HIVE-12371>
ï¼Œå‡çº§é©±åŠ¨ç‰ˆæœ¬åˆ°4.0.0åŠä»¥ä¸Šï¼Œæ”¯æŒä»urlä¸Šè·å–
`socketTimeout`
å±æ€§:

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/e6c8e1f4ff314e47b70653d8392913bf.png)

**ä»£ç ç¤ºä¾‹**
ï¼š

```java
// å®šä¹‰å¸¦è¶…æ—¶å‚æ•°çš„JDBC URL
String jdbcUrl = "jdbc:hive2://hive-server:10000/mydb;socketTimeout=1800000";  // 30åˆ†é’Ÿè¶…æ—¶

try (Connection conn = DriverManager.getConnection(jdbcUrl, "user", "pass");
     Statement stmt = conn.createStatement();
     ResultSet rs = stmt.executeQuery("SELECT * FROM large_table")) {

    // å¤„ç†ç»“æœé›†
    while (rs.next()) {
        String data = rs.getString("column");
        processData(data);  // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
    }
} catch (SQLException e) {
    e.printStackTrace();
}

```

---

#### æ–¹æ¡ˆäºŒï¼šåŠ¨æ€è®¾ç½®å…¨å±€loginTimeoutï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰

**é€‚ç”¨åœºæ™¯**
ï¼šHiveé©±åŠ¨ç‰ˆæœ¬<4.0ï¼Œéœ€å…¼å®¹æ—§ç¯å¢ƒã€‚
  
**æŠ€æœ¯è¦ç‚¹**
ï¼š

* æ¯æ¬¡åˆ›å»ºè¿æ¥å‰ï¼Œé€šè¿‡
  `DriverManager.setLoginTimeout`
  é‡ç½®å…¨å±€è¶…æ—¶
* **çº¿ç¨‹å®‰å…¨**
  ï¼šéœ€ä½¿ç”¨åŒæ­¥æœºåˆ¶é¿å…å¤šçº¿ç¨‹å†²çª

**ä»£ç ç¤ºä¾‹**
ï¼š

```java
public synchronized Connection createHiveConnection() throws SQLException {
    // è®¾ç½®å…¨å±€è¶…æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰
    DriverManager.setLoginTimeout(1800);  // 30åˆ†é’Ÿ
    return DriverManager.getConnection("jdbc:hive2://hive-server:10000/mydb", "user", "pass");
}

public void executeQuery() {
    try (Connection conn = createHiveConnection();
         Statement stmt = conn.createStatement();
         ResultSet rs = stmt.executeQuery("SELECT * FROM large_table")) {

        // å¤„ç†ç»“æœ
        while (rs.next()) {
            saveToFile(rs);  // ç»“æœå†™å…¥æ–‡ä»¶
        }
    } catch (SQLException e) {
        handleError(e);  // è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†
    }
}

```

---

### ğŸ“š æ€»ç»“ä¸å»ºè®®

1. **é©±åŠ¨ç‰ˆæœ¬é€‰æ‹©**
   ï¼š
   * ä¼˜å…ˆä½¿ç”¨Hive 4.0+é©±åŠ¨ï¼Œé€šè¿‡URLå‚æ•°ç²¾å‡†æ§åˆ¶è¶…æ—¶ã€‚
   * æ—§ç‰ˆæœ¬éœ€é…åˆ
     `setLoginTimeout`
     åŠ¨æ€è®¾ç½®ã€‚
2. **è¶…æ—¶å€¼ä¼°ç®—**
   ï¼š
   * æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦ã€æ•°æ®é‡ã€é›†ç¾¤è´Ÿè½½ç»¼åˆè®¾å®šï¼Œå»ºè®®â‰¥30åˆ†é’Ÿã€‚
3. **å¼‚å¸¸ç›‘æ§**
   ï¼š
   * æ•è·
     `SocketTimeoutException`
     åï¼Œå¯åŠ å…¥é‡è¯•æœºåˆ¶æˆ–å‘Šè­¦é€šçŸ¥ã€‚
4. **èµ„æºé‡Šæ”¾**
   ï¼š
   * ä½¿ç”¨
     `try-with-resources`
     ç¡®ä¿
     `Connection`
     ã€
     `Statement`
     ã€
     `ResultSet`
     è‡ªåŠ¨å…³é—­ã€‚