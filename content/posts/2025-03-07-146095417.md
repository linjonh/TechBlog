---
layout: post
title: "Hive-JDBC-å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„-Socket-è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
date: 2025-03-07 14:43:56 +0800
description: "Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
keywords: "Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
categories: ['æœªåˆ†ç±»']
tags: ['å¤§æ•°æ®', 'Hive', 'Hadoop']
artid: "146095417"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146095417
    alt: "Hive-JDBC-å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„-Socket-è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146095417
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146095417
cover: https://bing.ee123.net/img/rand?artid=146095417
image: https://bing.ee123.net/img/rand?artid=146095417
img: https://bing.ee123.net/img/rand?artid=146095417
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-tomorrow-night" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <p>
    </p>
    <p>
    </p>
    <h2>
     <a id="Hive_JDBC__Socket__2">
     </a>
     Hive JDBC å¤§æ•°æ®æŸ¥è¯¢åœºæ™¯ä¸‹çš„ Socket è¯»è¶…æ—¶é—®é¢˜åŠå®æˆ˜è§£å†³æ–¹æ¡ˆ
    </h2>
    <hr/>
    <h3>
     <a id="__6">
     </a>
     ğŸ” é—®é¢˜èƒŒæ™¯
    </h3>
    <p>
     åœ¨ä½¿ç”¨ Hive JDBC æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¶å‘
     <code>
      SocketTimeoutException
     </code>
     å¼‚å¸¸ï¼Œå †æ ˆæ˜¾ç¤ºåœ¨
     <code>
      ResultSet.next()
     </code>
     é˜¶æ®µè§¦å‘ã€‚
    </p>
    <pre><code class="prism language-text">2022-09-0921:13:02- ERROR java.sql.SQLException:retrieving next row
 at org.apache.hive.jdbc.HiveQueryResultSet.next(HiveQueryResult Set.java:392)
 at java.util.concurrent.FutureTask.run(FutureTask.java:266)
 ...

Caused by: org.apache.thrift.transport.TTransportException:java.net.SocketTimeoutException: Read timed out
 at org.apache.thrift.transport.TIOStreamTransport.read(TIOStrea mTransport.java:129)
at org.apache.thrift.transport.TTransport.readAll(TTransport.ja va:86)
at org.apache.thrift.transport.TSaslTransport.readLength(TSaslT ransport.java:376)
at org.apache.thrift.transport.TSaslTransport.readFrame(TSaslTr ansport.java:453)
at org.apache.thrift.transport.TSaslTransport.read(TSaslTranspo rt.java:435)
at org.apache.thrift.transport.TSaslClientTransport.read(TSaslC lientTransport.java:37)
at org.apache.thrift.transport.TTransport.readAll(TTransport.ja va:86)
at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryPr otocol.java:429)
at org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryPr otocol.java:318)
at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:219)
at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:77)
at org.apache.hive.service.rpc.thrift.TCLIService$Client.recv_F etchResults(TCLIService.java:559)
at org.apache.hive.service.rpc.thrift.TCLIService$Client.FetchR esults(TCLIService.java:546)
at sun.reflect.GeneratedMethodAccessor336.invoke(Unknown Source)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMe thodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:497)
at org.apache.hive.jdbc.HiveConnection$SynchronizedHandler.invo ke(HiveConnection.java:1524)
at com.sun.proxy.$Proxy151.FetchResults(Unknown Source)
...
</code></pre>
    <p>
     åŸå› å¦‚ä¸‹ï¼š
    </p>
    <ol>
     <li>
      <strong>
       é»˜è®¤è¶…æ—¶é™åˆ¶
      </strong>
      ï¼š
      <br/>
      Hive åº•å±‚é€šè¿‡ Thrift åè®®é€šä¿¡ï¼Œé»˜è®¤çš„
      <code>
       socketTimeout
      </code>
      è¾ƒçŸ­ï¼Œå½“æŸ¥è¯¢è¿”å›å¤§é‡æ•°æ®æˆ–é›†ç¾¤è´Ÿè½½é«˜æ—¶ï¼Œè¯»å–ç»“æœå¯èƒ½è¶…æ—¶ã€‚
     </li>
     <li>
      <strong>
       ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
      </strong>
      ï¼š
      <br/>
      Hive 1.x~2.xç‰ˆæœ¬ä¸­ï¼Œ
      <code>
       setQueryTimeout
      </code>
      æ–¹æ³•å¯èƒ½æœªç”Ÿæ•ˆï¼Œéœ€é€šè¿‡å…¶ä»–å‚æ•°é…ç½®ã€‚
     </li>
    </ol>
    <hr/>
    <h3>
     <a id="__44">
     </a>
     ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ
    </h3>
    <h4>
     <a id="JDBC_URL_45">
     </a>
     æ–¹æ¡ˆä¸€ï¼šé€šè¿‡JDBC URLç›´æ¥é…ç½®è¶…æ—¶ï¼ˆæ¨èï¼‰
    </h4>
    <p>
     <a href="https://issues.apache.org/jira/browse/HIVE-12371" rel="nofollow">
      https://issues.apache.org/jira/browse/HIVE-12371
     </a>
     ï¼Œå‡çº§é©±åŠ¨ç‰ˆæœ¬åˆ°4.0.0åŠä»¥ä¸Šï¼Œæ”¯æŒä»urlä¸Šè·å–
     <code>
      socketTimeout
     </code>
     å±æ€§:
    </p>
    <p>
     <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://i-blog.csdnimg.cn/direct/e6c8e1f4ff314e47b70653d8392913bf.png"/>
    </p>
    <p>
     <strong>
      ä»£ç ç¤ºä¾‹
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-java"><span class="token comment">// å®šä¹‰å¸¦è¶…æ—¶å‚æ•°çš„JDBC URL</span>
<span class="token class-name">String</span> jdbcUrl <span class="token operator">=</span> <span class="token string">"jdbc:hive2://hive-server:10000/mydb;socketTimeout=1800000"</span><span class="token punctuation">;</span>  <span class="token comment">// 30åˆ†é’Ÿè¶…æ—¶</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>jdbcUrl<span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM large_table"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// å¤„ç†ç»“æœé›†</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> data <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"column"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">processData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è‡ªå®šä¹‰å¤„ç†é€»è¾‘</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h4>
     <a id="loginTimeout_75">
     </a>
     æ–¹æ¡ˆäºŒï¼šåŠ¨æ€è®¾ç½®å…¨å±€loginTimeoutï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
    </h4>
    <p>
     <strong>
      é€‚ç”¨åœºæ™¯
     </strong>
     ï¼šHiveé©±åŠ¨ç‰ˆæœ¬&lt;4.0ï¼Œéœ€å…¼å®¹æ—§ç¯å¢ƒã€‚
     <br/>
     <strong>
      æŠ€æœ¯è¦ç‚¹
     </strong>
     ï¼š
    </p>
    <ul>
     <li>
      æ¯æ¬¡åˆ›å»ºè¿æ¥å‰ï¼Œé€šè¿‡
      <code>
       DriverManager.setLoginTimeout
      </code>
      é‡ç½®å…¨å±€è¶…æ—¶
     </li>
     <li>
      <strong>
       çº¿ç¨‹å®‰å…¨
      </strong>
      ï¼šéœ€ä½¿ç”¨åŒæ­¥æœºåˆ¶é¿å…å¤šçº¿ç¨‹å†²çª
     </li>
    </ul>
    <p>
     <strong>
      ä»£ç ç¤ºä¾‹
     </strong>
     ï¼š
    </p>
    <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Connection</span> <span class="token function">createHiveConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// è®¾ç½®å…¨å±€è¶…æ—¶ï¼ˆå•ä½ï¼šç§’ï¼‰</span>
    <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">setLoginTimeout</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 30åˆ†é’Ÿ</span>
    <span class="token keyword">return</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">"jdbc:hive2://hive-server:10000/mydb"</span><span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"pass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token function">createHiveConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM large_table"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// å¤„ç†ç»“æœ</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">saveToFile</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç»“æœå†™å…¥æ–‡ä»¶</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
    <hr/>
    <h3>
     <a id="__107">
     </a>
     ğŸ“š æ€»ç»“ä¸å»ºè®®
    </h3>
    <ol>
     <li>
      <strong>
       é©±åŠ¨ç‰ˆæœ¬é€‰æ‹©
      </strong>
      ï¼š
      <ul>
       <li>
        ä¼˜å…ˆä½¿ç”¨Hive 4.0+é©±åŠ¨ï¼Œé€šè¿‡URLå‚æ•°ç²¾å‡†æ§åˆ¶è¶…æ—¶ã€‚
       </li>
       <li>
        æ—§ç‰ˆæœ¬éœ€é…åˆ
        <code>
         setLoginTimeout
        </code>
        åŠ¨æ€è®¾ç½®ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       è¶…æ—¶å€¼ä¼°ç®—
      </strong>
      ï¼š
      <ul>
       <li>
        æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦ã€æ•°æ®é‡ã€é›†ç¾¤è´Ÿè½½ç»¼åˆè®¾å®šï¼Œå»ºè®®â‰¥30åˆ†é’Ÿã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       å¼‚å¸¸ç›‘æ§
      </strong>
      ï¼š
      <ul>
       <li>
        æ•è·
        <code>
         SocketTimeoutException
        </code>
        åï¼Œå¯åŠ å…¥é‡è¯•æœºåˆ¶æˆ–å‘Šè­¦é€šçŸ¥ã€‚
       </li>
      </ul>
     </li>
     <li>
      <strong>
       èµ„æºé‡Šæ”¾
      </strong>
      ï¼š
      <ul>
       <li>
        ä½¿ç”¨
        <code>
         try-with-resources
        </code>
        ç¡®ä¿
        <code>
         Connection
        </code>
        ã€
        <code>
         Statement
        </code>
        ã€
        <code>
         ResultSet
        </code>
        è‡ªåŠ¨å…³é—­ã€‚
       </li>
      </ul>
     </li>
    </ol>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6672616e6b3131303530332f:61727469636c652f64657461696c732f313436303935343137" class_="artid" style="display:none">
 </p>
</div>


