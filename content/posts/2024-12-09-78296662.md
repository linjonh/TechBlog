---
layout: post
title: "Android-音视频去回声降噪"
date: 2024-12-09 00:31:11 +0800
description: "好久没写文章了，其实是想记录一下自己在Android开发的成长历程。谈到音视频这块，对于新手来说刚接"
keywords: "安卓降噪"
categories: ['音视频处理']
tags: ['音视频降噪去回声', 'Android']
artid: "78296662"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=78296662
    alt: "Android-音视频去回声降噪"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=78296662
featuredImagePreview: https://bing.ee123.net/img/rand?artid=78296662
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Android 音视频去回声、降噪
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <p>
     <strong>
      <span style="font-size:18px">
       好久没写文章了，其实是想记录一下自己在Android开发的成长历程。谈到音视频这块，对于新手来说刚接触到这一块，那是非常非常的恶心~我自己弄这一块也是从头开始，在 网上也翻阅了无数的资料、浏览了无数的博客，尝试了多种方法，网上大致方法是采用第三方的，如webRtc、speex等。甚至花钱买积分去下demo，也发现了好多demo就是    骗积分的，呵呵~好气~ 不谈了。成长的过程也是比较艰辛的，最后也还是自己解决了这个问题~~也希望这篇文章能帮助处在当时的我的一样的情况下
       <img alt="微笑" src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/smile.gif">
        。
       </img>
      </span>
     </strong>
    </p>
    <p>
     <strong>
     </strong>
    </p>
    <h4 style="line-height:1.7; color:rgb(47,47,47); margin:0px 0px 15px; font-size:22px">
     1.Android声音录制
    </h4>
    <div>
     <span style="color:rgb(47,47,47); font-size:16px">
      1. Android中使用AudioRecord录制声音，
      <span style="color:rgb(47,47,47); font-size:16px">
       在Android中录制声音需要相应的权限，注意动态申请权限的问题（6.0以上）。
      </span>
     </span>
     <br/>
    </div>
    <div>
     <span style="color:rgb(47,47,47); font-size:16px">
      <span style="color:rgb(47,47,47); font-size:16px">
      </span>
     </span>
     <pre><code class="language-html"> //处理权限申请回调
    @Override
    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
        Log.v(TAG, "处理权限申请回调");
        PermissionUtils.requestPermissionsResult(ActivityCameraLiveView.this, requestCode, permissions, grantResults, mPermissionGrant);
    }


    private PermissionUtils.PermissionGrant mPermissionGrant = new PermissionUtils.PermissionGrant() {
        @Override
        public void onPermissionGranted(int requestCode) {
            switch (requestCode) {
                case PermissionUtils.CODE_RECORD_AUDIO:
                    Log.v(TAG, "PermissionGrant: CODE_RECORD_AUDIO audio = true");
                    audio = true;
                    break;
                case PermissionUtils.CODE_READ_EXTERNAL_STORAGE:
                    WRITE_EXTERNAL_STORAGE_PERMISSION = true;
                    Log.v(TAG, "PermissionGrant: WRITE_EXTERNAL_STORAGE_PERMISSION = true");
                    break;
                case PermissionUtils.CODE_STOP_CAMERA:
                    Log.v(TAG, "PermissionUtils.CODE_STOP_CAMERA");
                    break;
                case PermissionUtils.CODE_WRITE_EXTERNAL_STORAGE:
                    break;
                case PermissionUtils.CODE_ACCESS_COARSE_LOCATION:
                    break;
            }
        }
    };</code></pre>
     2.
     <span style="color:rgb(47,47,47); font-size:16px">
      对AudioRecord进行录音前需要对采样率进行设置
     </span>
    </div>
    <div>
     <span style="color:rgb(47,47,47); font-size:16px">
      <span style="color:rgb(47,47,47); font-size:16px">
       <span style="color:rgb(47,47,47); font-size:16px">
       </span>
      </span>
     </span>
     <pre><code class="language-html"> nMinBufSize = AudioRecord.getMinBufferSize(8000,
                        AudioFormat.CHANNEL_IN_MONO,
                        AudioFormat.ENCODING_PCM_16BIT);</code></pre>
    </div>
    <div>
     <span style="color:rgb(47,47,47); font-size:16px">
      <span style="color:rgb(47,47,47); font-size:16px">
       <span style="color:rgb(47,47,47); font-size:16px">
        <br/>
       </span>
      </span>
     </span>
     <h4 style="line-height:1.7; color:rgb(47,47,47); margin:0px 0px 15px; font-size:22px">
      2.Android回声消除
     </h4>
     <div>
      <strong>
       网上回音消除方式大概有两种 ：1.通过安卓自带的
       <span style="color:rgb(47,47,47); font-size:16px">
        VOICE_COMMUNICATION模式进行录音，自动消除回音。2.使用第三方库进行消除（webRtc、Speex..），消除回音。
       </span>
      </strong>
     </div>
     <div>
      <strong>
       用第三方的话，比较麻烦,而且不好实现，用起来效果不是很明显，试了一下
       <span style="color:rgb(47,47,47); font-size:16px">
        Speex的，感觉手机端与手机端语音还可以，但是如果是手机端（APP）和硬件语音的话，就要考虑到码流格式的问题，因为我们公司采用的是G711格式的音频流，所以就必须要先转pcm格式然后再转speex格式，最后转711格式的。实在不行，还有一种就是在录音的时候强制关闭扬声器，在录音的时候就只录到手机的声音隔断了扬声器的声音，不过效果不是很明显，还是会有滋滋的噪声。
       </span>
      </strong>
     </div>
     <div>
     </div>
     <div>
      关闭扬声器
      <pre><code class="language-html">   audioManager = (AudioManager) mcontext.getSystemService(Context.AUDIO_SERVICE);
                                audioManager.setSpeakerphoneOn(false);
                                audioManager.setStreamVolume(AudioManager.STREAM_VOICE_CALL, 0,
                                        AudioManager.STREAM_VOICE_CALL);
                                audioManager.setMode(AudioManager.MODE_IN_CALL);</code></pre>
     </div>
     <div>
      <br/>
     </div>
    </div>
    <p>
     <strong>
      这里我推荐第一种方法，不仅考虑到了手机机型的适配，还比较简单就改变一个参数：
     </strong>
    </p>
    <p>
    </p>
    <pre><code class="language-html">     audioRecord = new AudioRecord(MediaRecorder.AudioSource.VOICE_COMMUNICATION, 8000,
                        AudioFormat.CHANNEL_IN_MONO, AudioFormat.ENCODING_PCM_16BIT, nMinBufSize);
                audioRecord.startRecording();</code></pre>
    <strong>
     写到这里基本上回声和噪声就没有了~
    </strong>
    <p>
    </p>
    <p>
    </p>
    <pre><code class="language-html">    </code></pre>
    <p>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a2f2f:626c6f672e6373646e2e6e65742f776c353332383832383737:2f61727469636c652f64657461696c732f3738323936363632" class_="artid" style="display:none">
 </p>
</div>


