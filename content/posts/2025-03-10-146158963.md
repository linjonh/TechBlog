---
layout: post
title: "Spring-Boot-整合-Apollo-配置中心实战"
date: 2025-03-10 17:11:55 +0800
description: "Apollo 提供了配置修改实时生效、版本管理、灰度发布、权限管控等强大功能，支持多环境（如开发、测试、生产）配置隔离，采用 HTTP 接口供客户端获取配置，适配多种编程语言和框架，极大方便了不同技术栈团队接入。"
keywords: "apoll通过网页配置dev test"
categories: ['面试', '阿里巴巴', '学习路线']
tags: ['后端', 'Spring', 'Java', 'Boot']
artid: "146158963"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146158963
    alt: "Spring-Boot-整合-Apollo-配置中心实战"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146158963
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146158963
cover: https://bing.ee123.net/img/rand?artid=146158963
image: https://bing.ee123.net/img/rand?artid=146158963
img: https://bing.ee123.net/img/rand?artid=146158963
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     Spring Boot 整合 Apollo 配置中心实战
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-dark" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h5>
     <a id="Spring_Boot__Apollo__4">
     </a>
     Spring Boot 整合 Apollo 配置中心实战
    </h5>
    <ul>
     <li>
      <ul>
       <li>
        <a href="#Apollo__4" rel="nofollow">
         一、Apollo 简介
        </a>
       </li>
       <li>
        <a href="#_8" rel="nofollow">
         二、环境准备
        </a>
       </li>
       <li>
        <a href="#_15" rel="nofollow">
         三、项目整合步骤
        </a>
       </li>
       <li>
        <a href="#_67" rel="nofollow">
         四、配置使用示例
        </a>
       </li>
       <li>
        <a href="#_130" rel="nofollow">
         五、常见问题及解决
        </a>
       </li>
      </ul>
     </li>
    </ul>
    <p>
     在分布式系统开发中，配置管理至关重要。Apollo 作为携程开源的一款可靠的配置中心，能高效地集中管理应用配置，实现实时更新推送，助力开发者轻松应对复杂多变的配置场景。本文将带你一步步完成 Spring Boot 项目与 Apollo 配置中心的整合，让你的应用配置管理如鱼得水。
    </p>
    <h4>
     <a id="Apollo__14">
     </a>
     一、Apollo 简介
    </h4>
    <p>
     Apollo 提供了配置修改实时生效、版本管理、灰度发布、权限管控等强大功能，支持多环境（如开发、测试、生产）配置隔离，采用 HTTP 接口供客户端获取配置，适配多种编程语言和框架，极大方便了不同技术栈团队接入。
    </p>
    <h4>
     <a id="_18">
     </a>
     二、环境准备
    </h4>
    <ol>
     <li>
      Apollo 服务端部署
      <ul>
       <li>
        可参考官方文档，使用源码或 Docker 方式快速部署 Apollo 服务端。例如，使用 Docker Compose 编排，准备好
        <code>
         docker-compose.yml
        </code>
        文件，定义好 Config Service、Admin Service、Portal 等服务模块的镜像及端口映射等配置，通过
        <code>
         docker-compose up -d
        </code>
        命令一键拉起服务，确保服务正常运行，能通过浏览器访问 Apollo 管理页面（默认端口 8070）。
       </li>
      </ul>
     </li>
     <li>
      Spring Boot 项目创建
      <ul>
       <li>
        使用 IDE（如 IntelliJ IDEA 或 Eclipse）创建一个新的 Spring Boot 项目，引入
        <code>
         spring-boot-starter-web
        </code>
        等基础依赖，确保项目能正常启动运行，初始端口设为常规的 8080 等用于测试访问。
       </li>
      </ul>
     </li>
    </ol>
    <h4>
     <a id="_25">
     </a>
     三、项目整合步骤
    </h4>
    <ol>
     <li>
      <p>
       添加 Apollo 客户端依赖
      </p>
      <ul>
       <li>
        在项目的
        <code>
         pom.xml
        </code>
        文件中，添加 Apollo 客户端依赖：
       </li>
      </ul>
      com.ctrip.framework.apollo apollo-client [最新版本号，可去 Maven 仓库查询获取]
     </li>
    </ol>
    <ul>
     <li>
      同时，为确保依赖兼容性，可按需添加
      <code>
       spring-cloud-dependencies
      </code>
      等相关 BOM（Bill of Materials）依赖管理，统一版本控制。
     </li>
    </ul>
    <ol>
     <li>
      <p>
       配置 Apollo 客户端
      </p>
      <ul>
       <li>
        在项目的
        <code>
         application.properties
        </code>
        或
        <code>
         application.yml
        </code>
        文件中添加 Apollo 相关配置：
       </li>
      </ul>
      <h2>
       <a id="Apollo__42">
       </a>
       Apollo 配置中心地址，多个用逗号分隔
      </h2>
      <p>
       apollo.meta=http://[Apollo 服务端 IP]:8080
      </p>
      <h2>
       <a id="_ID_Apollo__ID__44">
       </a>
       应用 ID，需与 Apollo 管理端创建的应用 ID 一致
      </h2>
      <p>
       app.id=your-app-id
      </p>
      <h2>
       <a id="_devtestprod__46">
       </a>
       环境，如 dev、test、prod 等
      </h2>
      <p>
       apollo.env=dev
      </p>
      <h2>
       <a id="_default_48">
       </a>
       集群，默认值可设为 default
      </h2>
      <p>
       apollo.cluster=default
      </p>
     </li>
    </ol>
    <ul>
     <li>
      配置加载顺序方面，Apollo 会优先加载系统环境变量中的配置（以
      <code>
       APOLLO_
      </code>
      开头），若未找到则读取上述配置文件内容，开发者可灵活利用这一点在不同部署场景下覆盖配置。
     </li>
    </ul>
    <ol>
     <li>
      <p>
       启用 Apollo 配置注入
      </p>
      <ul>
       <li>
        在 Spring Boot 启动类上添加
        <code>
         @EnableApolloConfig
        </code>
        注解，开启 Apollo 配置自动注入功能：
       </li>
      </ul>
      <p>
       import com.ctrip.framework.apollo.spring.annotation.EnableApolloConfig;
       <br/>
       import org.springframework.boot.SpringApplication;
       <br/>
       import org.springframework.boot.autoconfigure.SpringBootAutoconfigure;
       <br/>
       import org.springframework.context.annotation.Configuration;
      </p>
      <p>
       @Configuration
       <br/>
       @SpringBootAutoconfigure
       <br/>
       @EnableApolloConfig
       <br/>
       public class YourAppApplication {
       <!-- -->
       <br/>
       public static void main(String[] args) {
       <!-- -->
       <br/>
       SpringApplication.run(YourAppApplication.class, args);
       <br/>
       }
       <br/>
       }
      </p>
     </li>
    </ol>
    <ul>
     <li>
      该注解默认会注入
      <code>
       application
      </code>
      命名空间配置，若需指定其他命名空间，可通过
      <code>
       @EnableApolloConfig(namespaces = {"namespace1", "namespace2"})
      </code>
      方式指定。
     </li>
    </ul>
    <h4>
     <a id="_74">
     </a>
     四、配置使用示例
    </h4>
    <ol>
     <li>
      <p>
       注入基本配置项
      </p>
      <ul>
       <li>
        假设在 Apollo 管理端配置了一个
        <code>
         redis.host
        </code>
        的配置项，值为
        <code>
         127.0.0.1
        </code>
        ，在 Spring Boot 项目的
        <code>
         RedisConfig
        </code>
        类中注入使用：
       </li>
      </ul>
      <p>
       import org.springframework.beans.factory.annotation.Value;
       <br/>
       import org.springframework.context.annotation.Bean;
       <br/>
       import org.springframework.context.annotation.Configuration;
       <br/>
       import redis.clients.jedis.JedisPool;
       <br/>
       import redis.clients.jedis.JedisPoolConfig;
      </p>
      <p>
       @Configuration
       <br/>
       public class RedisConfig {
       <!-- -->
       <br/>
       @Value(“${redis.host}”)
       <br/>
       private String redisHost;
      </p>
      <pre><code>@Bean
public JedisPool jedisPool() {
    JedisPoolConfig poolConfig = new JedisPoolConfig();
    // 其他配置参数设置
    return new JedisPool(poolConfig, redisHost);
}
</code></pre>
      <p>
       }
      </p>
     </li>
    </ol>
    <ul>
     <li>
      当 Apollo 中
      <code>
       redis.host
      </code>
      值变更时，Spring Boot 应用无需重启，
      <code>
       JedisPool
      </code>
      初始化时获取的主机地址会实时更新，确保与新配置同步。
     </li>
    </ul>
    <ol>
     <li>
      <p>
       监听配置变化
      </p>
      <ul>
       <li>
        对于一些复杂场景，如动态调整日志级别，可利用 Apollo 的配置变化监听机制：
       </li>
      </ul>
      <p>
       import com.ctrip.framework.apollo.Config;
       <br/>
       import com.ctrip.framework.apollo.model.ConfigChange;
       <br/>
       import com.ctrip.framework.apollo.model.ConfigChangeEvent;
       <br/>
       import com.ctrip.framework.apollo.spring.annotation.ApolloConfig;
       <br/>
       import com.ctrip.framework.apollo.spring.annotation.ApolloConfigChangeListener;
       <br/>
       import org.slf4j.Logger;
       <br/>
       import org.slf4j.LoggerFactory;
       <br/>
       import org.springframework.stereotype.Component;
      </p>
      <p>
       @Component
       <br/>
       public class LogLevelChangeListener {
       <!-- -->
       <br/>
       private static final Logger logger = LoggerFactory.getLogger(LogLevelChangeListener.class);
      </p>
      <pre><code>@ApolloConfig
private Config config;

@ApolloConfigChangeListener("application")
public void onChange(ConfigChangeEvent changeEvent) {
    for (String key : changeEvent.changedKeys()) {
        ConfigChange change = changeEvent.getChange(key);
        if ("logging.level.root".equals(key)) {
            logger.info("日志级别从 {} 变更为 {}", change.getOldValue(), change.getNewValue());
            // 这里可添加代码动态调整日志框架（如 Logback）的日志级别
        }
    }
}
</code></pre>
      <p>
       }
      </p>
     </li>
    </ol>
    <ul>
     <li>
      一旦
      <code>
       application
      </code>
      命名空间下
      <code>
       logging.level.root
      </code>
      配置项改变，监听器立即捕获并可执行自定义逻辑，实现动态配置调整效果。
     </li>
    </ul>
    <h4>
     <a id="_135">
     </a>
     五、常见问题及解决
    </h4>
    <ol>
     <li>
      配置不更新问题
      <ul>
       <li>
        若发现配置在 Apollo 端修改后，Spring Boot 应用未实时更新，首先检查网络连通性，确保应用与 Apollo 服务端能正常通信。其次，确认
        <code>
         @EnableApolloConfig
        </code>
        注解及配置加载顺序无误，可尝试重启应用（极端情况，因缓存等原因首次配置加载异常），查看控制台日志排查 Apollo 客户端初始化异常信息。
       </li>
      </ul>
     </li>
     <li>
      依赖冲突问题
      <ul>
       <li>
        引入 Apollo 客户端可能与项目已有依赖产生冲突，如 Spring Cloud 版本不一致。此时需仔细比对依赖树，利用 Maven 的
        <code>
         dependency:tree
        </code>
        命令查看依赖层次结构，通过
        <code>
         exclusions
        </code>
        标签在
        <code>
         pom.xml
        </code>
        排除冲突依赖，例如排除低版本的 Spring Cloud 相关模块，确保所有依赖和谐共存。
       </li>
      </ul>
     </li>
    </ol>
    <p>
     通过以上整合流程，你的 Spring Boot 项目已成功接入 Apollo 配置中心，享受高效、灵活、可靠的配置管理服务。持续探索 Apollo 更多高级功能，如配置发布审批流程、多数据中心部署等，将进一步提升团队开发运维效率，应对大规模分布式系统挑战。
    </p>
    <p>
     以上就是完整的 Spring Boot 整合 Apollo 配置中心指南，快去实践一番吧！后续可深入研究 Apollo 源码，理解其配置推送、缓存机制，深度定制适配企业级复杂场景。
    </p>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f62:6c6f672e6373646e2e6e65742f6d305f35313237343436342f:61727469636c652f64657461696c732f313436313538393633" class_="artid" style="display:none">
 </p>
</div>


