---
layout: post
title: "CICDGitLab钩子触发Jenkins自动构建项目"
date: 2025-03-10 11:26:32 +0800
description: "浏览器上访问：http://192.168.72.131:8080/job/first-test/build?token=test@1234，就相当于自动提交了一次POST请求自动去构建first-test项目测试机器上可以看出构建的结果上述步骤请求是在Jenkins平台正常登录的情况下进行的，所以在浏览器上访问：http://192.168.72.131:8080/job/first-test/build?token=test@1234 不需要登录，如果换成其他的浏览器或者Jenkins长时间不登录再执行"
keywords: "gitlab jenkins cicd"
categories: ['未分类']
tags: ['Jenkins', 'Gitlab', 'Ci']
artid: "146147419"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146147419
    alt: "CICDGitLab钩子触发Jenkins自动构建项目"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146147419
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146147419
cover: https://bing.ee123.net/img/rand?artid=146147419
image: https://bing.ee123.net/img/rand?artid=146147419
img: https://bing.ee123.net/img/rand?artid=146147419
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     CI/CD—GitLab钩子触发Jenkins自动构建项目
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="htmledit_views" id="content_views">
    <h2>
     GitLab钩子简介：
    </h2>
    <blockquote>
     <h4>
      项目钩子
     </h4>
     <p>
      项目钩子是针对单个项目的钩子，会在项目级别的特定事件发生时触发。这些事件包括代码推送、合并请求创建、问题创建等。项目钩子由项目管理员或具有相应权限的用户进行配置，仅对特定项目生效。
     </p>
     <ul>
      <li>
       <strong>
        使用场景
       </strong>
       ：实现项目的自动化构建、测试和部署，例如在代码推送时自动触发 CI/CD 流水线，或者在合并请求创建时自动通知相关人员进行审查。
      </li>
      <li>
       <strong>
        配置步骤
       </strong>
       <ol>
        <li>
         进入项目的
         <code>
          Settings
         </code>
         （设置） -&gt;
         <code>
          Webhooks
         </code>
         （Web 钩子）页面。
        </li>
        <li>
         输入要触发的目标 URL，该 URL 通常是一个接收并处理事件的服务器地址。
        </li>
        <li>
         选择要监听的事件类型，如
         <code>
          Push events
         </code>
         （代码推送事件）、
         <code>
          Merge request events
         </code>
         （合并请求事件）等。
        </li>
        <li>
         可以根据需要设置其他参数，如触发条件、SSL 验证等。
        </li>
        <li>
         点击
         <code>
          Add webhook
         </code>
         （添加 Web 钩子）保存配置。
        </li>
       </ol>
      </li>
     </ul>
     <h4>
      钩子工作原理
     </h4>
     <p>
      当配置好的事件在 GitLab 中发生时，GitLab 会向配置的目标 URL 发送一个 HTTP 请求，请求中包含了事件的详细信息，如事件类型、相关的项目信息、用户信息等。接收方服务器可以根据这些信息执行相应的操作，例如调用脚本进行代码部署、发送通知邮件等。
     </p>
    </blockquote>
    <p>
    </p>
    <p>
    </p>
    <h2>
     一、在Jenkins上配置构建触发器
    </h2>
    <h4 style="background-color:transparent">
     1、在Jenkins上构建触发器
    </h4>
    <h6>
     1.1、选择之前创建的maven项目的配置
    </h6>
    <p>
     <img alt="" height="271" src="https://i-blog.csdnimg.cn/direct/87f2a70e426547d2af7fe2aaaa093f85.png" width="800"/>
    </p>
    <p>
     <img alt="" height="433" src="https://i-blog.csdnimg.cn/direct/a074ac4ff2b6485a9943cee2426dc964.png" width="800"/>
    </p>
    <p>
    </p>
    <h6>
     1.2、选择构建触发器
    </h6>
    <p>
     <img alt="" height="280" src="https://i-blog.csdnimg.cn/direct/79ec54533bd841a2a5b09fd4dc96578c.png" width="800"/>
    </p>
    <p>
    </p>
    <h6>
     1.3、触发远程构建 (例如,使用脚本) --&gt; 填写身份验证令牌
    </h6>
    <p>
     <img alt="" height="383" src="https://i-blog.csdnimg.cn/direct/cb073f4fc8ab4b349312a8ad6569527a.png" width="800"/>
    </p>
    <p>
    </p>
    <h6>
    </h6>
    <h6>
     1.4、根据提示的url信息在浏览器上输入相关的url相当与发送一次POST请求
    </h6>
    <pre><code class="language-html">JENKINS_URL/job/first-test/build?token=TOKEN_NAME 或者 /buildWithParameters?token=TOKEN_NAME</code></pre>
    <p>
    </p>
    <p>
     <img alt="" height="131" src="https://i-blog.csdnimg.cn/direct/65e166d3b7a94d4c8b19dd82e42e83fb.png" width="800"/>
    </p>
    <p>
     <span style="background-color:#ff9900">
      浏览器上访问：
      <a href="http://192.168.72.131:8080/job/first-test/build?token=test@1234" rel="nofollow" title="http://192.168.72.131:8080/job/first-test/build?token=test@1234">
       http://192.168.72.131:8080/job/first-test/build?token=test@1234
      </a>
      ，就相当于自动提交了一次POST请求自动去构建first-test项目
     </span>
    </p>
    <p>
     <img alt="" height="349" src="https://i-blog.csdnimg.cn/direct/730d3f20f8a44690ab5abc41dba0ec08.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h6>
     1.5、测试结果
    </h6>
    <p>
     测试机器上可以看出构建的结果
    </p>
    <p>
     <img alt="" height="331" src="https://i-blog.csdnimg.cn/direct/756d68bfd8f64e08891ff7c3bf0d5199.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h4>
     2、安装Build Authorization Token Root插件
    </h4>
    <h5>
     安装背景以及插件的作用
    </h5>
    <p>
     上述步骤请求是在Jenkins平台正常登录的情况下进行的，所以在浏览器上访问：
     <a href="http://192.168.72.131:8080/job/first-test/build?token=test@1234" rel="nofollow" title="http://192.168.72.131:8080/job/first-test/build?token=test@1234">
      http://192.168.72.131:8080/job/first-test/build?token=test@1234
     </a>
     不需要登录，如果换成其他的浏览器或者Jenkins长时间不登录再执行此url时就会弹出登录页面。
    </p>
    <p>
     <strong>
      现象：
     </strong>
    </p>
    <p>
     <img alt="" height="463" src="https://i-blog.csdnimg.cn/direct/e031f5a35f3f416ba43dfb499ddac195.png" width="800"/>
    </p>
    <p>
     <strong>
      <span style="color:#0d0016">
       <span style="background-color:#ff9900">
        安装Build Authorization Token Root插件就可以解决此问题，相当于会进行匿名登录。
       </span>
      </span>
     </strong>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h5 style="background-color:transparent">
     2.1、安装
     <a href="https://plugins.jenkins.io/build-token-root" rel="nofollow" title="Build Authorization Token Root">
      Build Authorization Token Root
     </a>
     免登录的插件
    </h5>
    <p>
     <img alt="" height="222" src="https://i-blog.csdnimg.cn/direct/557d228230a844fa8a23259fb93ea36f.png" width="800"/>
    </p>
    <p>
     <img alt="" height="292" src="https://i-blog.csdnimg.cn/direct/dc7df90858844e87b4acf2092485fdda.png" width="800"/>
    </p>
    <p>
     <img alt="" height="318" src="https://i-blog.csdnimg.cn/direct/2101ec7c36394829bab15c388d6ddea9.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h5>
     2.2、安装插件文档中的介绍修改url
    </h5>
    <p>
     改造前：
     <a href="http://192.168.72.131:8080/job/first-test/build?token=test@1234" rel="nofollow" title="http://192.168.72.131:8080/job/first-test/build?token=test@1234">
      http://192.168.72.131:8080/job/first-test/build?token=test@1234
     </a>
    </p>
    <p>
     改造后：
     <a href="http://192.168.72.131:8080/buildByToken/build?job=first-test&amp;token=test@1234" rel="nofollow" title="http://192.168.72.131:8080/buildByToken/build?job=first-test&amp;token=test@1234">
      http://192.168.72.131:8080/buildByToken/build?job=first-test&amp;token=test@1234
     </a>
    </p>
    <h6>
     2.2.1、测试
    </h6>
    <p>
     在浏览器上输入：
     <a href="http://192.168.72.131:8080/buildByToken/build?job=first-test&amp;token=test@1234" rel="nofollow" title="http://192.168.72.131:8080/buildByToken/build?job=first-test&amp;token=test@1234">
      http://192.168.72.131:8080/buildByToken/build?job=first-test&amp;token=test@1234
     </a>
     之后能正常访问，而且能够自动触发构建。
    </p>
    <p>
     <img alt="" height="359" src="https://i-blog.csdnimg.cn/direct/83ccc90f2dba4aeda00e15bb0f6602f0.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h2>
     二、GitLab上创建自动构建钩子
    </h2>
    <p>
    </p>
    <h4>
     1、GitLab项目钩子创建步骤
    </h4>
    <h5>
     1.1、进入项目的 Settings（设置） --&gt; Webhooks
    </h5>
    <h5>
     1.2、输入要触发的目标 URL，该 URL 通常是一个接收并处理事件的服务器地址
    </h5>
    <h5>
     1.3、选择要监听的事件类型，如 Push events（代码推送事件）、Merge request events（合并请求事件）等
     <img alt="" height="498" src="https://i-blog.csdnimg.cn/direct/8d3b8abf227142e899d29203f8069263.png" width="800"/>
    </h5>
    <p>
    </p>
    <h4>
     2、GitLab不允许本地请求报错处理方法
    </h4>
    <p>
     在GitLab上点击创建后报错：Urlis blocked: Requests to the local network are not allowed不允许本地请求
    </p>
    <p>
     <img alt="" height="402" src="https://i-blog.csdnimg.cn/direct/1d85e776af3c4d8eae8cca1918b1dd87.png" width="800"/>
    </p>
    <h5>
     2.1、以管理员身份登录 GitLab
    </h5>
    <h5>
     <br/>
     2.2、进入 Admin Area（管理区域）
    </h5>
    <h5>
     <br/>
     2.3、选择 Settings（设置） -&gt; Network（网络）
    </h5>
    <h5>
     <br/>
     2.4、在 Outbound requests（出站请求）部分，找到 Allow requests to the local network from web hooks and services 选项，将其勾选
    </h5>
    <h5>
     <br/>
     2.5、点击 Save changes（保存更改）
    </h5>
    <h5>
     <img alt="" height="321" src="https://i-blog.csdnimg.cn/direct/07b52389fce345f7a5222bcf87147319.png" width="800"/>
    </h5>
    <p>
     <img alt="" height="909" src="https://i-blog.csdnimg.cn/direct/e87b078aa16245229634afba5e0066ec.png" width="800"/>
    </p>
    <p>
    </p>
    <h5>
     2.6、重新进行添加并保存
    </h5>
    <p>
     <img alt="" height="380" src="https://i-blog.csdnimg.cn/direct/ff3cffb369f847a688caafa8d93a33a5.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h2>
     三、GitLab上进行代码合并触发Jenkins自动构建测试
    </h2>
    <p>
    </p>
    <h4>
     1、配置好之后先在GitLab上根据系统提交的步骤进行测试
    </h4>
    <p>
     <img alt="" height="392" src="https://i-blog.csdnimg.cn/direct/75f562fd7be44a2693ea516c8a99003c.png" width="800"/>
    </p>
    <p>
     <img alt="" height="328" src="https://i-blog.csdnimg.cn/direct/4ad37e0fe6224a6b84d6f5b29dc91b5a.png" width="800"/>
    </p>
    <p>
    </p>
    <h4>
     2、提交并合并代码查看GitLab钩子被触发的情况
    </h4>
    <h5>
     2.1、修改代码
    </h5>
    <p>
     <img alt="" height="258" src="https://i-blog.csdnimg.cn/direct/ae26ba104d614c68b132f1d77de47dc9.png" width="800"/>
    </p>
    <h5>
     2.2、提交代码
    </h5>
    <p>
     <img alt="" height="521" src="https://i-blog.csdnimg.cn/direct/d76a12a0f3464c598506d5ebb5205474.png" width="800"/>
    </p>
    <p>
     <img alt="" height="445" src="https://i-blog.csdnimg.cn/direct/29e960d5736e4847b3001d402c1a6565.png" width="800"/>
    </p>
    <p>
    </p>
    <h5>
     2.3、测试
    </h5>
    <h6>
     2.3.1、查看测试服务器上前端内容
    </h6>
    <p>
     <img alt="" height="157" src="https://i-blog.csdnimg.cn/direct/11be39037d11461dbd8cd8380782b193.png" width="800"/>
    </p>
    <h6>
     2.3.2、合并代码
    </h6>
    <p>
     <img alt="" height="425" src="https://i-blog.csdnimg.cn/direct/e2479cf5b060427d86757b7c22c23955.png" width="800"/>
    </p>
    <p>
    </p>
    <h6>
     2.3.3、审核人不点击比准看是否能触发自动构建
    </h6>
    <p>
     <img alt="" height="654" src="https://i-blog.csdnimg.cn/direct/ea949a73819f4725bf4e755c968ceb11.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
     查看Jenkins日志已经触发构建
    </p>
    <p>
     <img alt="" height="362" src="https://i-blog.csdnimg.cn/direct/ccaf507ca41246aeb7450d6a80a13fcf.png" width="800"/>
    </p>
    <p>
     <br/>
     查看测试服务器前端内容
    </p>
    <p>
     <img alt="" height="339" src="https://i-blog.csdnimg.cn/direct/0fc2de12cbf948dc97b57171562d3fdd.png" width="800"/>
    </p>
    <p>
     <img alt="" height="172" src="https://i-blog.csdnimg.cn/direct/0ec6d918b2c7409cac9ed31ffda32e30.png" width="800"/>
    </p>
    <p>
     <span style="color:#fe2c24">
      <strong>
       虽然审核人没有批准代码合并但是已经触发Jenkins自动构建！！！
      </strong>
     </span>
    </p>
    <p>
    </p>
    <h6>
     2.3.4、审批人审核通过查看是否再次触发构建
    </h6>
    <p>
     <img alt="" height="379" src="https://i-blog.csdnimg.cn/direct/2bb185676fa645f289d85d68cac90af5.png" width="800"/>
    </p>
    <p>
    </p>
    <p>
     <img alt="" height="232" src="https://i-blog.csdnimg.cn/direct/8abcaa2e725648eb96b96175d0f61d48.png" width="800"/>
    </p>
    <p>
     浏览器上进行验证
    </p>
    <p>
     <img alt="" height="141" src="https://i-blog.csdnimg.cn/direct/50428e20a2774f55a15bc89bfff07d25.png" width="800"/>
    </p>
    <p>
     <span style="color:#fe2c24">
      <strong>
       审核人批准代码合并再次触发Jenkins自动构建！！！
      </strong>
     </span>
    </p>
    <p>
    </p>
    <p>
    </p>
    <h2>
     结论：
    </h2>
    <p>
     <strong>
      <span style="background-color:#ff9900">
       采用GitLab钩子触发自动构建的方法在实际的开发环境的某些场景下并不适用，因为代码合并审核人并没有审核通过，在合并过程中就已经多次触发了自动构建，这样在实际的开发环境中会对测试节点的资源造成很大的浪费，同时也影响到测试环境的稳定性。
      </span>
     </strong>
    </p>
   </div>
  </div>
 </article>
 <p alt="68747470733a:2f2f626c6f672e6373646e2e6e65742f64676866747467762f:61727469636c652f64657461696c732f313436313437343139" class_="artid" style="display:none">
 </p>
</div>


