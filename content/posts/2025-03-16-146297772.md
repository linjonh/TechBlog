---
layout: post
title: "k8s学习记录三Pod基础-Node选择"
date: 2025-03-16 17:08:01 +0800
description: "在上一篇文章中我们学习了Pod的一些基本的知识，今天我们将继续学习Pod。今天我们学习了如何手动控制K8S调度Pod，分别可以通过NodeName和NodeSelector来指定，前者通过名称来指定Node而后者是通过标签来指定。接下来的文章我们会继续学习Pod其他知识希望对你有所帮助。"
keywords: "k8s学习记录（三）：Pod基础-Node选择"
categories: ['未分类']
tags: ['学习', 'Kubernetes', 'Docker']
artid: "146297772"
image:
    path: https://api.vvhan.com/api/bing?rand=sj&artid=146297772
    alt: "k8s学习记录三Pod基础-Node选择"
render_with_liquid: false
featuredImage: https://bing.ee123.net/img/rand?artid=146297772
featuredImagePreview: https://bing.ee123.net/img/rand?artid=146297772
cover: https://bing.ee123.net/img/rand?artid=146297772
image: https://bing.ee123.net/img/rand?artid=146297772
img: https://bing.ee123.net/img/rand?artid=146297772
---

<div class="blog-content-box">
 <div class="article-header-box">
  <div class="article-header">
   <div class="article-title-box">
    <h1 class="title-article" id="articleContentId">
     k8s学习记录（三）：Pod基础-Node选择
    </h1>
   </div>
  </div>
 </div>
 <article class="baidu_pl">
  <div class="article_content clearfix" id="article_content">
   <link href="../../assets/css/kdoc_html_views-1a98987dfd.css" rel="stylesheet"/>
   <link href="../../assets/css/ck_htmledit_views-704d5b9767.css" rel="stylesheet"/>
   <div class="markdown_views prism-atom-one-light" id="content_views">
    <svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
     <path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">
     </path>
    </svg>
    <h3>
     <a id="_0">
     </a>
     一、前言
    </h3>
    <p>
     在上一篇文章中我们学习了Pod的一些基本的知识，今天我们将继续学习Pod。
    </p>
    <h3>
     <a id="K8SPod_3">
     </a>
     二、K8S如何选择节点来运行Pod
    </h3>
    <p>
     我们知道在一个K8S集群中，会有多个工作节点（Worker Node），那么k8s会选择那个node呢？接下来我们将学习一下k8s是如何选择适合的node来运行我们所需要的Pod。
    </p>
    <h4>
     <a id="1NodeName_6">
     </a>
     1、NodeName
    </h4>
    <p>
     首先我们可以通过指定Node名称来让k8s将pod调度到指定的Node，目前笔者的环境里有1个Master和2个Worker节点，如下图。
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/96bd27a5b527ea7be82ac9ffa7d0e3f4.png"/>
    </p>
    <h5>
     <a id="1NodeName_11">
     </a>
     1、不指定NodeName
    </h5>
    <p>
     首先我们先什么都不指定，让k8s自动为我们调度，看看会将Pod分配到那个Node上。我们编写一个yaml
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
   <span class="token key atrule">containers</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
     <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
     <span class="token key atrule">ports</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre>
    <p>
     执行命令
    </p>
    <pre><code class="prism language-shell"> kubectl apply <span class="token parameter variable">-f</span> nginx.yaml
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/bd529b95472f2e282a9b046c968cfb8d.png"/>
    </p>
    <p>
     （这里先不用考虑STATUS 为 ImagePullBackOff 这个是因为笔者的网络出了点小问题，导致拉取镜像失败），可以看到我们的Nginx被k8s调度到了node3 节点，那如果我们想指定pod调度到node2节点呢，接下来我们继续实验。
    </p>
    <h5>
     <a id="2NodeName_39">
     </a>
     2、指定NodeName
    </h5>
    <p>
     1、我们先删除之前创建的pod，使用命令
    </p>
    <pre><code class="prism language-shell"> kubectl delete pod my-nginx
</code></pre>
    <p>
     2、修改之前的yaml资源清单
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
   <span class="token key atrule">containers</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
     <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
     <span class="token key atrule">ports</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
   <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> node2
</code></pre>
    <p>
     3、执行命令
    </p>
    <pre><code class="prism language-shell"> kubectl apply <span class="token parameter variable">-f</span> nginx.yaml
</code></pre>
    <p>
     4、创建完成后我们查看Pod使用命令
    </p>
    <pre><code class="prism language-shell">kubectl get pods <span class="token parameter variable">-o</span> wide
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/5443642c7cdce79aecb6df8ec4de584b.png"/>
    </p>
    <p>
     可以看到nginx这个pod已经被调度到了node2节点。
    </p>
    <h5>
     <a id="3_80">
     </a>
     3、小结
    </h5>
    <p>
     使用NodeName可以手动指定Pod调度到那个Node上，那么这种操作适用于什么场景呢？
    </p>
    <pre><code>- 部署基础设施Pod，一些k8s的基础设施需要在指定节点运行，例如监控代理或者日志收集器等，这些Pod的部署和调度必须稳定和可靠，不能被k8s自动调度，这种情况下我们可以指定Node
- 管理节点资源：例如我们要维护某个节点，此时我们可以将当前节点的pod部署到其他我们指定的节点上，从而避免k8s自动分配到当前Node
</code></pre>
    <h4>
     <a id="2nodeSelector_86">
     </a>
     2、nodeSelector
    </h4>
    <p>
     除了使用NameNode我们还可以使用nodeSelector来指定调度的Node。我们下看下NodeSelector的介绍，使用命令
    </p>
    <pre><code class="prism language-shell">kubectl explain pod.spec.nodeSelector
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/aa2637e76d97bfcc28a788f43a7c4713.png">
      可以看到nodeSelector是一个Map结构，官网文档地址
      <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector" rel="nofollow">
       https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector
      </a>
      nodeSelector用于将Pod调度到包含指定label（标签）的Node上
     </img>
    </p>
    <p>
     实验步骤：
    </p>
    <p>
     1、给两个node添加上标签，给node1打上标签 cpu=high （CPU为高性能），给node2打上标签cpu=low（CPU为低性能）
    </p>
    <pre><code class="prism language-shell"> kubectl label nodes node2 <span class="token assign-left variable">cpu</span><span class="token operator">=</span>hgih
 kubectl label nodes node3 <span class="token assign-left variable">cpu</span><span class="token operator">=</span>low
</code></pre>
    <p>
     2、查看一下这个标签
    </p>
    <pre><code class="prism language-shell">kubectl get nodes <span class="token parameter variable">-L</span> cpu
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/39745ea816676e660ffc4b9645b171de.png"/>
    </p>
    <p>
     3、删除刚才的pod
    </p>
    <pre><code class="prism language-shell"> kubectl delete pod my-nginx
</code></pre>
    <p>
     4、编写yaml
    </p>
    <pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
   <span class="token key atrule">containers</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
     <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
     <span class="token key atrule">ports</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
   <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
      <span class="token key atrule">cpu</span><span class="token punctuation">:</span> high
</code></pre>
    <p>
     5、执行创建命令
    </p>
    <p>
     我们预期该pod会被创建在node1上，因为我们这里匹配的标签的是cpu high，我们直接运行命令看一下结果。
    </p>
    <pre><code class="prism language-shell">kubectl apply <span class="token parameter variable">-f</span> nginx.yaml
</code></pre>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/a2116abda06b3b7cddb990bb348846b9.png"/>
    </p>
    <p>
     但是预期的现象并没有发生，pod一直处于pending状态，仔细看一下yaml和标签，结果发现是单词拼错了。node标签是 cpu=high 而我们清单上写的high导致匹配不到node，此时会一直pending住。直到有能匹配上的node。所以现在有两种方案，改资源清单或者改node上的标签，我们选择后者。
    </p>
    <pre><code class="prism language-shell">kubectl label nodes node2 <span class="token assign-left variable">cpu</span><span class="token operator">=</span>high <span class="token parameter variable">--overwrite</span><span class="token operator">=</span>true
</code></pre>
    <p>
     再次查看node上的标签
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/1cad881198eff23e4d4f3635a984629f.png"/>
    </p>
    <p>
     接着查看pod
    </p>
    <p>
     <img alt="" src="https://i-blog.csdnimg.cn/img_convert/8ead3e7a057ad5a5f7fa190514cbe3ec.png"/>
    </p>
    <p>
     至此Pod已经完成了调度
    </p>
    <h3>
     <a id="_163">
     </a>
     三、总结
    </h3>
    <p>
     今天我们学习了如何手动控制K8S调度Pod，分别可以通过NodeName和NodeSelector来指定，前者通过名称来指定Node而后者是通过标签来指定。接下来的文章我们会继续学习Pod其他知识希望对你有所帮助。
    </p>
    <h3>
     <a id="_166">
     </a>
     四、未完待续
    </h3>
   </div>
   <link href="../../assets/css/markdown_views-a5d25dd831.css" rel="stylesheet"/>
   <link href="../../assets/css/style-e504d6a974.css" rel="stylesheet"/>
  </div>
 </article>
 <p alt="68747470733a2f2f626c6f672e:6373646e2e6e65742f77656978696e5f33373632343930332f:61727469636c652f64657461696c732f313436323937373732" class_="artid" style="display:none">
 </p>
</div>


